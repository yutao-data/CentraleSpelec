(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[805610],{986223:(e,t,n)=>{"use strict";n.r(t),n.d(t,{isDiscoverSurfaceSelectedAtom:()=>f,showMessagePreviewsAtom:()=>k,showTimestampsAtom:()=>C,selectedHiddenChannelIdAtom:()=>w,createSimpleCollabStore:()=>O,simpleCollabStore:()=>j,selectedConversationIdAtom:()=>D,selectedTeamIdAtom:()=>M,selectedHiddenChannelIdReadOnlyAtom:()=>T,selectedAppIdAtom:()=>I,seeAllChannelsAtom:()=>R,selectedConversationUnreadMentionAtom:()=>x,selectedStickyFiltersInUnifiedViewAtom:()=>p,selectedStickyFiltersInChatsViewAtom:()=>c,selectedStickyFiltersInChannelsViewAtom:()=>u,selectedConversationDataAtom:()=>L,selectedConversationFolderSeeReadAtom:()=>v,selectedStickyFiltersInUnifiedViewReadOnlyAtom:()=>g,selectedStickyFiltersInChatsViewReadOnlyAtom:()=>d,selectedStickyFiltersInChannelsViewReadOnlyAtom:()=>m,selectionIdAtom:()=>S});var i=n(703076),a=n(270226),o=n(364819),r=n(572909);const s=(e,t)=>(0,a.um)(e,((e,n)=>t(e,n)?e:n)),l=()=>{const e=s({},((e,t)=>(0,o.isEqual)(e.tags,t.tags)&&(0,o.isEqual)(e.text,t.text))),t=(0,i.eU)((t=>t(e)));return{stickyFiltersAtom:e,derivedStickyFiltersReadOnlyAtom:t}},{stickyFiltersAtom:c,derivedStickyFiltersReadOnlyAtom:d}=l(),{stickyFiltersAtom:u,derivedStickyFiltersReadOnlyAtom:m}=l(),{stickyFiltersAtom:p,derivedStickyFiltersReadOnlyAtom:g}=l(),h=(0,i.eU)(""),v=(0,i.eU)((e=>e(h)),((e,t,n)=>{t(h,n)})),y=(0,i.eU)(""),S=(0,i.eU)((e=>e(y)),((e,t,n)=>{t(y,n)})),f=(0,i.eU)(!1),k=(0,i.eU)(null),C=(0,i.eU)(!1),b=(0,i.eU)(""),w=s(void 0,((e,t)=>e===t)),T=(0,i.eU)((e=>e(w))),I=(0,i.eU)(""),N=(0,i.eU)(""),A=(0,i.eU)(""),E=(0,i.eU)(""),F=(0,i.eU)((e=>{const t=e(I);return t===r.ck.simplecollabchats?e(N):t===r.ck.simplecollabchannels?e(A):e(E)}),((e,t,n)=>{const i=e(I);i===r.ck.simplecollabchats?t(N,n):i===r.ck.simplecollabchannels?t(A,n):t(E,n)})),_=(0,i.eU)(""),D=(0,i.eU)((e=>e(f)?"":P(e)),((e,t,n)=>{t(f,!1),t(F,n),t(b,"")})),P=e=>{const t=e(F);return t?JSON.parse(t)?.id:""},M=(0,i.eU)((e=>e(f)?"":(e=>{const t=e(F);return t?JSON.parse(t)?.teamId:""})(e)),((e,t,n)=>{t(f,!1),t(F,n),t(b,"")})),R=(0,i.eU)((e=>e(f)?"":e(b)),((e,t,n)=>{t(b,n)})),x=(0,i.eU)((e=>e(f)?"":e(_)),((e,t,n)=>{t(_,n)})),L=(0,i.eU)({conversationNodeId:void 0,folderNodeId:void 0,currentTeamId:void 0});function O(){const e=(0,i.y$)();return e.set(h,""),e.set(f,!1),e.set(k,null),e.set(C,!1),e.set(b,""),e.set(w,void 0),e.set(I,""),e.set(F,""),e.set(c,{}),e.set(u,{}),e.set(p,{}),e.set(y,""),e.set(_,""),e}const j=O()},920136:(e,t,n)=>{"use strict";n.d(t,{x:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"toggleActivityRead"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isRead"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleActivityRead"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"isRead"},value:{kind:"Variable",name:{kind:"Name",value:"isRead"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FeedActivity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isRead"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivityReadStatusUpdateError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"errorFaced"}}]}}]}}]}}]}},556052:(e,t,n)=>{"use strict";n.d(t,{N:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"updateActivitySettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"settingsUpdate"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActivitySettingsUpdate"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateActivitySettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"settingsUpdate"},value:{kind:"Variable",name:{kind:"Name",value:"settingsUpdate"}}},{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"subCategoryPageId"},value:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"error"}},{kind:"Field",name:{kind:"Name",value:"settingsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]}},48399:(e,t,n)=>{"use strict";n.d(t,{Am:()=>a,L3:()=>r,Ni:()=>s});var i=n(933678);const a=()=>Promise.all([n.e(912845),n.e(867529),n.e(852774),n.e(909600),n.e(693593),n.e(249643),n.e(896791)]).then(n.bind(n,709813)),o=()=>n.e(885744).then(n.t.bind(n,668282,23)),r=()=>(0,i.wg)(a,"search-answer-v2"),s=()=>(0,i.wg)(o,"search-answer-v2-override")},854410:(e,t,n)=>{"use strict";n.d(t,{Iw:()=>a,Lf:()=>r,B8:()=>s});var i=n(933678);const a=()=>Promise.all([n.e(953696),n.e(76772),n.e(548168),n.e(322330),n.e(226164),n.e(88149),n.e(768945),n.e(960677),n.e(814042)]).then(n.bind(n,565714)),o=()=>Promise.all([n.e(88149),n.e(25211)]).then(n.t.bind(n,27211,23)),r=()=>(0,i.wg)(a,"search-answer"),s=()=>(0,i.wg)(o,"search-answer-override")},36252:(e,t,n)=>{"use strict";var i,a,o,r;n.d(t,{nx:()=>i,zw:()=>a,_w:()=>o,jF:()=>r}),function(e){e.Outlook="Outlook",e.Google="Google"}(i||(i={})),function(e){e.Connect="Connect",e.Disconnect="Disconnect"}(a||(a={})),function(e){e.Default="Default",e.Connect="Connect",e.Disconnect="Disconnect"}(o||(o={})),function(e){e.Error="Error",e.Syncing="Syncing"}(r||(r={}))},673040:(e,t,n)=>{"use strict";n.d(t,{C:()=>u,P:()=>s});var i=n(816410),a=n(220192);const o="ðŸ“· GIF",r=e=>!!e&&e.split("giphy.com").length>1;function s(e,t){(0,i.addHook)("uponSanitizeElement",c),(0,i.addHook)("uponSanitizeElement",l),t&&(0,i.addHook)("uponSanitizeElement",d);const n=(0,i.sanitize)(e,{ALLOWED_TAGS:[]});return(0,i.removeHooks)("uponSanitizeElement"),n}function l(e){"BR"===e.tagName&&e.replaceWith(" ")}function c(e){"BLOCKQUOTE"===e.tagName&&e.remove()}function d(e){if("IMG"!==e.tagName)return;const t=e.getAttribute("src")??"";if(r(t))return void e.replaceWith(o);const n=e.getAttribute("alt");if(!n)return;switch(e.getAttribute("itemtype")){case a.A.emoji:e.replaceWith(n);break;case a.A.customEmoji:e.replaceWith(`(${n})`)}}function u(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}},886987:(e,t,n)=>{"use strict";n.d(t,{l:()=>d});var i=n(160606),a=n(410703),o=n(983168),r=n(969037),s=n(506787),l=n(264345),c=n(875094);const d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chatsWithGuardians"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"studentId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"guardians"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"preferredToAlternateMriMappings"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PreferredToAlternateMriMapping"}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chatsWithGuardians"},arguments:[{kind:"Argument",name:{kind:"Name",value:"studentId"},value:{kind:"Variable",name:{kind:"Name",value:"studentId"}}},{kind:"Argument",name:{kind:"Name",value:"teamId"},value:{kind:"Variable",name:{kind:"Name",value:"teamId"}}},{kind:"Argument",name:{kind:"Name",value:"guardians"},value:{kind:"Variable",name:{kind:"Name",value:"guardians"}}},{kind:"Argument",name:{kind:"Name",value:"topicName"},value:{kind:"Variable",name:{kind:"Name",value:"topicName"}}},{kind:"Argument",name:{kind:"Name",value:"preferredToAlternateMriMappings"},value:{kind:"Variable",name:{kind:"Name",value:"preferredToAlternateMriMappings"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOneBotChat"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"meetingChatPolicy"}},{kind:"Field",name:{kind:"Name",value:"chatSubType"}},{kind:"Field",name:{kind:"Name",value:"chatType"}},{kind:"Field",name:{kind:"Name",value:"isSfB"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isMeeting"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isBotBlocked"}},{kind:"Field",name:{kind:"Name",value:"isMuted"}},{kind:"Field",name:{kind:"Name",value:"isFederated"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isRetentionHorizonSet"}},{kind:"Field",name:{kind:"Name",value:"isModerator"}},{kind:"Field",name:{kind:"Name",value:"isAdmin"}},{kind:"Field",name:{kind:"Name",value:"lastMessage"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"lastMessageFields"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonFields"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizonBookmark"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"userConsumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"botMembers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFields"}}]}},{kind:"Field",name:{kind:"Name",value:"creator"}},{kind:"Field",name:{kind:"Name",value:"meetingInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"meetingInformationFieldsShort"}}]}},{kind:"Field",name:{kind:"Name",value:"userAdminSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"adminDeleteEnabled"}},{kind:"Field",name:{kind:"Name",value:"deleteMessagesEnabled"}}]}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}},{kind:"Field",name:{kind:"Name",value:"interopConversationStatus"}},{kind:"Field",name:{kind:"Name",value:"chatHistoryHiddenTime"}},{kind:"Field",name:{kind:"Name",value:"clearHistoryTime"}},{kind:"Field",name:{kind:"Name",value:"userProperties"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userProperties"}}]}},{kind:"Field",name:{kind:"Name",value:"pinnedConversationItems"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"pinnedMessageItemFields"}}]}}]}}]}}]}},...i.L.definitions,...a.U.definitions,...o.q.definitions,...r.x.definitions,...s.v.definitions,...l.p.definitions,...c.M.definitions]}},135197:(e,t,n)=>{"use strict";n.d(t,{G:()=>d,AD:()=>c,FH:()=>s,xB:()=>l});var i=n(835953),a=n(572909),o=n(754255);const r={[a.ck.chatcopilotsynthesis]:{category:"synthesis",type:"crossSession",isEnabled:e=>!!e.get(o.w.Messaging).enableCopilotSynthesisInChatHeader}},{getSidePaneState:s,setSidePaneState:l,getSidePaneEndEntity:c,appendSidePaneDataToCommandScenario:d}=(0,i.R)(r)},479427:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"createNewChat"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNewChat"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"conversation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}}]}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"membersLimited"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"givenName"}}]}},{kind:"Field",name:{kind:"Name",value:"memberDisplayNamesLimited"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"hasIBPolicyRejectedUsers"}}]}}]}}]}},988510:(e,t,n)=>{"use strict";n.d(t,{SH:()=>s,FV:()=>l,ii:()=>c,ye:()=>d,To:()=>u,D1:()=>m,N$:()=>p,n6:()=>g,De:()=>h,IQ:()=>y,Bl:()=>S,Jq:()=>f});var i=n(572909),a=n(131647);const o="communities-selected-id",r="current-enitity-type",s=[i.ck.communities,i.ck.communitiesjoinrequest,i.ck.communitiesmembers,i.ck.communitiesblockmembers],l=()=>localStorage.getItem(o),c=()=>{const e=localStorage.getItem("is-last-visited-community-general");return"true"===e||null===e},d=()=>localStorage.getItem("communities-selected-reply-id"),u=()=>localStorage.getItem(r),m=()=>localStorage.removeItem(r),p=e=>e?.id===e?.teamId,g=e=>[i.ck.communities,i.ck.communitiesjoininviteview].some((t=>t===e)),h=(e,t)=>{const n=[a.p.ActivityFeed,a.p.ActivityFeedBellClick];return e&&n.includes(e)||!!t},v=(e,t,n,i,a)=>{if(t.includes(i)&&n.includes(a))return e},y=(e,t,n)=>{const a=v(e,[i.ck.communitiesonboarding,i.ck.communities],[i.SY.join,i.SY.update],t,n),{inviteLinkUrl:o,deepLinkId:r}=a?.(t,n)||{};return{inviteLinkUrl:o,deepLinkId:r}},S=(e,t,n)=>{const a=v(e,[i.ck.communities],[i.SY.view],t,n),{isPostLink:o,enqueSwitch:r,source:s,owningTeamId:l,deepLinkId:c}=a?.(t,n)||{};return{isPostLink:o,enqueSwitch:r,source:s,owningTeamId:l,deepLinkId:c}},f=e=>/^[{].*[}]$/gim.test(e)},494180:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"publishContactsSyncSettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"syncSettings"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSyncSettingsInput"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"skipMiddleTierUpdate"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"publishContactsSyncSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"syncSettings"},value:{kind:"Variable",name:{kind:"Name",value:"syncSettings"}}},{kind:"Argument",name:{kind:"Name",value:"skipMiddleTierUpdate"},value:{kind:"Variable",name:{kind:"Name",value:"skipMiddleTierUpdate"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]}},367966:(e,t,n)=>{"use strict";n.d(t,{D:()=>i});class i{constructor(){this.registerAppPhase=({phase:e,signals:t,timeout:n})=>{const i=this._phasesMap.get(e);this._phasesMap.set(e,{...i,signals:t,timeout:n})},this._phasesMap=new Map}get appPhases(){return{phases:this._phasesMap}}}},765384:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});const i=e=>t=>t.reduce(((t,n)=>(t[n]=e[n],t)),{})},777883:(e,t,n)=>{"use strict";n.d(t,{T:()=>d});var i=n(432134),a=n(536397),o=n(516404),r=n(10247),s=n(851027);const l=i.A,c=r.A,d={splashStyles:a.A,favicons:o.A,splash:l,preloadTitleBar:c,devtools:s.A}},152270:(e,t,n)=>{"use strict";n.d(t,{fR:()=>i});const i=(e,t)=>{((e,t)=>{const n=e.getElementById("splash-screen");n&&(n.setAttribute("aria-hidden","true"),e.body.removeChild(n),t&&(t.style.display="block"))})(e,t),(e=>{const t=e.getElementsByClassName("preload-title-bar-trim")[0];t&&e.body.removeChild(t)})(e)}},545137:(e,t,n)=>{"use strict";n.d(t,{k:()=>y});var i=n(754255),a=n(933678),o=n(774948),r=n(817797),s=n(957032),l=n(513432),c=n(959022),d=n(446320),u=n(369170);const m=()=>(0,s.Y)(u.X,{client:{},children:(0,s.Y)("div",{})});class p extends l.PureComponent{constructor(){super(...arguments),this.divRef=l.createRef(),this.siblingEl=l.createRef()}componentDidMount(){const{document:e}=this.props.mainWindow,t=e.createElement("div");this.divRef.current&&(this.divRef.current.appendChild(t),t.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0,relatedTarget:this.siblingEl.current})))}render(){return(0,s.Y)("div",{ref:this.divRef,children:(0,s.Y)("div",{ref:this.siblingEl,onMouseEnter:()=>{}})})}}class g extends l.PureComponent{constructor(){super(...arguments),this.state={mounted:!1}}componentDidMount(){this.setState({mounted:!0})}render(){return(0,s.Y)("div",{})}}const h=e=>{(e=>{e.document.body.dispatchEvent(new MouseEvent("click",{bubbles:!0}))})(e)};var v=n(702183);const y=async(e,t,n)=>{const a=await S(t);return e.pipe((0,o.u)((({id:e,window:i,context$:o})=>((e,t,n,i,a,o)=>{if(!e)return null;const s=e.document.getElementById("app");if(!s){const e=a.loggerFactory.newLogger("entry","components-core-layout");return e.errorToTelemetry&&e.errorToTelemetry("element with ID 'app' not found on the document.","webclient_framework_foundation_components_render_windows",void 0,!0),null}a.scenarioFactory.startStep(v.Cu.ExperienceReady,v.BQ.RenderProviders);const l=new r.o({context$:t,coreServices:a,getExperienceProps:n,reactDiagnosticsService:o,rootElement:s,windowId:i,window:e});return l.activate(),{coreRenderer:l,host:e,windowId:i}})(i,o,n,e,t,a)),(async e=>{if(!e)return;const{host:n,coreRenderer:a,windowId:o}=e;h(n),a.deactivate();const r=t.windowProvider;await(async e=>{const t=e.document,n=t.body,i=t.createElement("div");i.setAttribute("id","memory-cleanup");const a=n.appendChild(i);await(0,d.y)(0),c.render((0,s.Y)(l.Fragment,{children:[(0,s.Y)(m,{}),(0,s.Y)(p,{mainWindow:e}),(0,s.Y)(g,{})]}),a),c.unmountComponentAtNode(a),n.removeChild(a)})(r);const{dataCleanupService:u,dataEvictionService:v,coreSettings:y}=t;u?.markDataForWindowAsInactive(o);const{enableSingleApolloCoreCache:S}=y.get(i.w.Core);S&&v?.evict()}),(({id:e})=>e))).subscribe()},S=async e=>{const{enableReactDiagnostics:t,enableReactDiagnosticsConsoleLog:o,enableReactDiagnosticsDisplayNameFix:r}=e.coreSettings.get(i.w.Diagnostics);if(t)try{const{initReactDiagnostics:t,ReactDiagnosticsService:i}=await(0,a.wg)((()=>Promise.all([n.e(814048),n.e(383414),n.e(441883)]).then(n.bind(n,799981))),"react-diagnostics",e.scenarioFactory),s=new i(!!o,!!r);return t(s),s}catch(t){const n=e.loggerFactory.newLogger("react-diagnostics","components-core-layout");n.errorToTelemetry&&n.errorToTelemetry(`Failed to load react-diagnostic ${t}`,"webclient_framework_foundation_components_render_windows",void 0,!0)}}},667279:(e,t,n)=>{"use strict";var i;n.d(t,{M:()=>i}),function(e){e.OOFSettingsPage="general_settings_oof_settings_page_title"}(i||(i={}))},540466:(e,t,n)=>{"use strict";n.d(t,{M3:()=>g,oH:()=>h,Fs:()=>p});var i=n(513432),a=n(757060),o=n(451281),r=n(635899);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsGuardiansApprovalStatusQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"studentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getGuardiansApprovalStatus"},arguments:[{kind:"Argument",name:{kind:"Name",value:"studentId"},value:{kind:"Variable",name:{kind:"Name",value:"studentId"}}},{kind:"Argument",name:{kind:"Name",value:"teamId"},value:{kind:"Variable",name:{kind:"Name",value:"teamId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"approvalId"}},{kind:"Field",name:{kind:"Name",value:"approvalStatus"}}]}}]}}]},l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsGuardiansCreateApprovalMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"studentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"title"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"relatedContacts"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"RelatedContactPayload"}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createGuardiansApproval"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamId"},value:{kind:"Variable",name:{kind:"Name",value:"teamId"}}},{kind:"Argument",name:{kind:"Name",value:"studentId"},value:{kind:"Variable",name:{kind:"Name",value:"studentId"}}},{kind:"Argument",name:{kind:"Name",value:"title"},value:{kind:"Variable",name:{kind:"Name",value:"title"}}},{kind:"Argument",name:{kind:"Name",value:"relatedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"relatedContacts"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"approvalId"}}]}}]}}]};var c=n(899273),d=n(702183),u=n(129123),m=n(754255);const p=(e,t)=>{const{scenarioFactory:n}=(0,c.ur)(),{enableParentsDataIngestion:i}=(0,u.w2)(m.w.Guardians,["enableParentsDataIngestion"]),o=v(n,!!i,e,t),{data:r,error:l,loading:d}=(0,a.I)(s,{variables:{studentId:e,teamId:t},fetchPolicy:"cache-first",context:{callerInfo:"components-student-contact-card-container"},skip:!e||!t||!i});return y(l,o,!!i,r?.getGuardiansApprovalStatus?.approvalStatus||"",d),{guardiansApprovalStatus:r?.getGuardiansApprovalStatus?.approvalStatus,loading:d}},g=async(e,t,n,i,a)=>{try{(a||e.cache).writeQuery({query:s,variables:{studentId:t,teamId:n},data:{getGuardiansApprovalStatus:{approvalStatus:r.gI.Pending,approvalId:i||"",__typename:"GuardiansApprovalStatusResult"}}})}catch(i){await((e,t,n)=>e.query({query:s,variables:{studentId:t,teamId:n},fetchPolicy:"network-only",context:{callerInfo:"components-student-contact-card-container"}}))(e,t,n)}},h=(e,t,n,a)=>{const r=((e,t,n)=>i.useCallback((async(i,a)=>{const o=a.data?.createGuardiansApproval?.approvalId;await g(n,e,t,o,i)}),[n,e,t]))(t,e,a),[s,{loading:c,error:d}]=(0,o.n)(l,{fetchPolicy:"network-only",context:{callerInfo:"guardians-approval-request-dialog-container"},update:r});return{createGuardiansApproval:i.useCallback((i=>s({variables:{teamId:e,studentId:t,title:n,relatedContacts:i}})),[s,e,t,n]),loading:c,error:d}},v=(e,t,n,i)=>{if(t){const t=e.newScenario(d.Cu.GetGuardiansApprovalStatus);return t.appendEventData({studentId:n||"",groupId:i||""}),t}return null},y=(e,t,n,i,a)=>{if(n&&t&&!a)if(e){const{message:n}=e,{code:i,context:a,reason:o}=e?.graphQLErrors?.[0]?.extensions?.prevError??{},r=`ErrorMessage: ${n}`;t.fail({context:a,reason:o,errorCode:i,errors:r})}else t.stop({approvalStatus:i})}},325841:(e,t,n)=>{"use strict";n.d(t,{t$:()=>s,Ue:()=>l,xp:()=>c});var i=n(513432),a=n(899273),o=n(937545),r=n(131647);const s=e=>{const{memberAndRelatedContacts:t,initialAction:n,initialViewMode:s}=e,{entityCommanding:l}=(0,a.ur)();return i.useCallback((()=>{l.guardians.showGuardiansApprovalRequestDialog({stateTransition:o.Ar.extend,visibilityState:o.Rp.show,correlation:{source:r.p.EducationGuardians}},{memberAndRelatedContacts:t,initialAction:n,initialViewMode:s})}),[n,l.guardians,t,s])},l=()=>{const{entityCommanding:e}=(0,a.ur)();return i.useCallback((()=>{e.guardians.showSendApprovalSuccessDialog({stateTransition:o.Ar.new,visibilityState:o.Rp.show,correlation:{source:r.p.EducationGuardians}})}),[e.guardians])},c=()=>{const{entityCommanding:e}=(0,a.ur)();return i.useCallback((t=>{e.guardians.showSendApprovalErrorDialog({stateTransition:o.Ar.new,visibilityState:o.Rp.show,correlation:{source:r.p.EducationGuardians}},{errorCode:t})}),[e.guardians])}},811478:(e,t,n)=>{"use strict";n.d(t,{U:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsLocalizationSettingsUpdateSyncWithAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newSyncWithMSAccount"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"saveCurrentlyDisplayedLanguage"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateSyncWithMSAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newSyncWithMSAccount"},value:{kind:"Variable",name:{kind:"Name",value:"newSyncWithMSAccount"}}},{kind:"Argument",name:{kind:"Name",value:"saveCurrentlyDisplayedLanguage"},value:{kind:"Variable",name:{kind:"Name",value:"saveCurrentlyDisplayedLanguage"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentLocale"}},{kind:"Field",name:{kind:"Name",value:"applicationLocale"}},{kind:"Field",name:{kind:"Name",value:"accountLocale"}},{kind:"Field",name:{kind:"Name",value:"syncWithMSAccount"}}]}}]}}]}},590548:(e,t,n)=>{"use strict";n.d(t,{Bo:()=>i,OK:()=>a,bw:()=>o});const i=e=>{const{removeUrl:t,contentUrl:n,websiteUrl:i,entityId:a,baseInfo:o}=e||{};return{removeUrl:t||void 0,contentUrl:n||"",websiteUrl:i||void 0,entityId:a||void 0,suggestedDisplayName:o?.displayName||void 0}},a=(e,t,n)=>{const i=e=>e&&String(e);let a;return a=n?{contentUrl:i(e.contentUrl)||t?.contentUrl||"",websiteUrl:i(e.websiteUrl)??t?.websiteUrl}:{contentUrl:i(e.contentUrl)||t?.contentUrl||"",removeUrl:i(e.removeUrl)??t?.removeUrl,websiteUrl:i(e.websiteUrl)??t?.websiteUrl,entityId:i(e.entityId)??t?.entityId,suggestedDisplayName:i(e.suggestedDisplayName)||t?.suggestedDisplayName},a},o=(e,t,n,i,a,o)=>{if(n)return e.log("app is not supported because appId not found in the current thread"),n;const r=i?.includes(t);if(r)return e.log("app is not supported because appId is found in the disabledTabAppIds blocklist"),r;if(t&&a){const n=a.includes(t);if(o){if(!n)return e.log("app is not supported because appId is not present in the appIdlist whitelist"),!n}else if(n)return e.log("app is not supported because appId is  present in the appIdlist blocklist"),n}return!1}},906937:(e,t,n)=>{"use strict";n.d(t,{z:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsPrivacySettingsUnlinkExternalAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"provider"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExternalAccountProvider"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"hardDelete"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unlinkExternalAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}},{kind:"Argument",name:{kind:"Name",value:"accountAddress"},value:{kind:"Variable",name:{kind:"Name",value:"accountAddress"}}},{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"Variable",name:{kind:"Name",value:"provider"}}},{kind:"Argument",name:{kind:"Name",value:"hardDelete"},value:{kind:"Variable",name:{kind:"Name",value:"hardDelete"}}}]}]}}]}},789334:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"contactsSyncSettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isContactsSyncEnabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactsSyncSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isContactsSyncEnabled"},value:{kind:"Variable",name:{kind:"Name",value:"isContactsSyncEnabled"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"isSyncAllowed"}},{kind:"Field",name:{kind:"Name",value:"accountId"}},{kind:"Field",name:{kind:"Name",value:"deltaToken"}},{kind:"Field",name:{kind:"Name",value:"currentSyncStatus"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]}},860709:(e,t,n)=>{"use strict";n.d(t,{G:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"deleteCalendarEventsCache"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mailboxAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteCalendarEventsCache"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mailboxAddress"},value:{kind:"Variable",name:{kind:"Name",value:"mailboxAddress"}}}]}]}}]}},431692:(e,t,n)=>{"use strict";n.d(t,{h:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsSimpleCollabCommonSimpleCollabSettingsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateUserPreferencesForSimpleCollab"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"EnumValue",value:"simpleCollabUserSettings"}},{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserPreferences"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"simpleCollabUserSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledAdaptiveRailForDesktop"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledUnifiedAppForDesktop"}}]}}]}}]}}]}}]}},761051:(e,t,n)=>{"use strict";n.d(t,{He:()=>r,AY:()=>l,nD:()=>c,S1:()=>d,pe:()=>u,ST:()=>m,mg:()=>g,Jr:()=>h,vS:()=>v});var i=n(719156),a=n(441161);const o=[a.Fo.Transferring,a.Fo.TransferFailed,a.Fo.TransferSucceeded],r=e=>o.includes(e),s=[a.Fo.Parking,a.Fo.ParkFailed,a.Fo.ParkSucceeded],l=e=>s.includes(e),c=e=>(e=>e===i.CallState.LocalHold)(e)||(e=>e===i.CallState.RemoteHold)(e),d=e=>e===i.CallState.Disconnected,u=e=>!(!e||e!==i.CallOrigin.Park),m=(e,t)=>e===i.CallState.Observing&&t,p=[i.CallState.Notified,i.CallState.EarlyMedia,i.CallState.None],g=e=>!(v(e)||p.includes(e.state))||r(e.extendedCallState)||l(e.extendedCallState),h=[i.CallState.Connected,i.CallState.Connecting,i.CallState.InLobby,i.CallState.Staging],v=e=>h.includes(e.state)},858974:(e,t,n)=>{"use strict";n.d(t,{cl:()=>a,zz:()=>o,mj:()=>r});var i=n(364819);const a=(e,t)=>{const n=t?.tags||[],a=[...o(e),...n];return{tags:(0,i.sortedUniq)((0,i.sortBy)(a)),text:t?.text}},o=e=>"CHATS"===e?["CHATS"]:"TEAMS_AND_CHANNELS"===e?["TEAMS_AND_CHANNELS","SHOWN_AND_HOISTED"]:["SHOWN_AND_HOISTED"],r=e=>{if(!e||0===e.length)return[];const t=[];return["CHATS","HIDDEN","MEETINGS","MENTIONS","MUTED","SHOWN_AND_HOISTED","TEAMS_AND_CHANNELS","UNREAD","DRAFTS"].forEach((n=>{e.includes(n)&&t.push(n)})),t}},502111:(e,t,n)=>{"use strict";n.d(t,{L1:()=>N,d9:()=>b});var i=n(957032),a=n(513432),o=n(865763),r=n(901456),s=n(553882),l=n(960331),c=n(129123),d=n(851075),u=n(754255),m=n(139150);const p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"activeCallsChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeCallsChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"calls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"teamsCallId"}},{kind:"Field",name:{kind:"Name",value:"callInitiator"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"replyChainMessageId"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"organizerId"}}]}}]}}]}}]};var g=n(872600),h=n(74279),v=n(575061),y=n(188468),S=n(329966),f=n(763431),k=n(364819);const[C,b]=(0,o.V)("ActiveCallsContext");function w(e){return null!=e}const T=new Map,I=(e,t,{data:n,error:i})=>{if(i)return e.error(`Failed to receive data from activeCallsChangedEvent: ${i}`),t;const a=n?.activeCallsChangedEvent?.id;if(!a)return t;const o=(n?.activeCallsChangedEvent?.calls||[]).filter(w),r=new Map(t);return 0===o.length?(e.log(`No more calls found in ${a}. Removing from active calls map`),r.delete(a),0===r.size?T:r):(e.log(`Updating key in map for conversation ${a}. Number of active calls: ${o.length}`),new Map(r.set(a,o.reduce(((e,t)=>t.messageId?e.set(t.messageId,t):e),new Map))))},N=({children:e})=>{const t=(0,m.m)(),n=(0,d.U)("ActiveCallsContextContainer"),{enableActiveCallsSubscription:o}=(0,c.w2)(u.w.Channels,["enableActiveCallsSubscription"]),b=(()=>{const e=a.useMemo((()=>new r.B7),[]);return a.useEffect((()=>()=>{e.next(),e.complete()}),[e]),e})(),[w,N]=a.useMemo((()=>{const e=new s.t(T);if(!o)return[e,k.noop];const i=(0,g.K)(t.subscribe({query:p,fetchPolicy:"no-cache"})).pipe((0,h.Q)(b),(0,v.S)(((e,t)=>I(n,e,t)),T),(0,y.F)(),(0,S.t)(1),(0,f.W)((e=>(n.error("An exception occurred while subscribing to active calls",e),(0,l.of)(T))))).subscribe(e);return[e,()=>i.unsubscribe()]}),[t,o,n,b]);return a.useEffect((()=>N)),(0,i.Y)(C,{source$:w,children:e})}},380771:(e,t,n)=>{"use strict";n.d(t,{Vu:()=>I,jv:()=>N,Dg:()=>F,hq:()=>P,Ng:()=>_,dt:()=>k,bR:()=>E,$F:()=>D,P$:()=>T,w8:()=>f,Wq:()=>w,eo:()=>b,Ae:()=>C,Kv:()=>A});var i=n(726723),a=n(131647),o=n(736626),r=n(899855),s=n(81670),l=n(667606);i.i7.sisu,i.E0.auth,i.Od.click,i.nd.nav,i.vB.AuthAddAccount,i.DB.appAuth,i.rP.main,i.HP.AuthSettingsList,i.i7.sisu,i.E0.auth,i.Od.click,i.nd.nav,i.vB.AuthSwitchAccount,i.DB.appAuth,i.rP.main,i.HP.AuthSettingsList;const c={actionSubworkload:i.i7.sisu,actionWorkload:i.E0.auth,actionGesture:i.Od.click,actionOutcome:i.nd.nav,actionScenario:i.vB.AuthRefreshTenants,actionScenarioType:i.DB.appAuth,panelRegion:i.rP.main,panelType:i.HP.AuthSettingsList},d={actionSubworkload:i.i7.sisu,actionWorkload:i.E0.auth,actionGesture:i.Od.click,actionOutcome:i.nd.nav,actionScenario:i.vB.AuthManageAccount,actionScenarioType:i.DB.appAuth,panelRegion:i.rP.main,panelType:i.HP.AuthSettingsList},u={actionSubworkload:i.i7.sisu,actionWorkload:i.E0.auth,actionGesture:i.Od.toggle,actionScenario:i.vB.AuthUpdateAccount,actionScenarioType:i.DB.appAuth,panelRegion:i.rP.main,panelType:i.HP.AuthSettingsList},m={actionSubworkload:i.i7.sisu,actionWorkload:i.E0.auth,actionGesture:i.Od.auto,actionScenario:i.vB.AuthLeaveOrg,actionScenarioType:i.DB.appAuth,panelRegion:i.rP.main,panelType:i.HP.AuthSettingsList},p={actionSubworkload:i.i7.sisu,actionWorkload:i.E0.auth,actionGesture:i.Od.auto,actionScenario:i.vB.AuthAcceptTenant,actionScenarioType:i.DB.appAuth,panelRegion:i.rP.main,panelType:i.HP.AuthSettingsList},g={actionSubworkload:i.i7.sisu,actionWorkload:i.E0.auth,actionGesture:i.Od.auto,actionScenario:i.vB.AuthDeclineTenant,actionScenarioType:i.DB.appAuth,panelRegion:i.rP.main,panelType:i.HP.AuthSettingsList};var h=n(702183);const v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsAuthAccountSettingsGetTenantsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"refreshTenants"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantName"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]},y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsAuthAccountSettingsUpdateTenantsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userHomeAccountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tenantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isTenantHidden"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateTenants"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userHomeAccountId"},value:{kind:"Variable",name:{kind:"Name",value:"userHomeAccountId"}}},{kind:"Argument",name:{kind:"Name",value:"tenantId"},value:{kind:"Variable",name:{kind:"Name",value:"tenantId"}}},{kind:"Argument",name:{kind:"Name",value:"isTenantHidden"},value:{kind:"Variable",name:{kind:"Name",value:"isTenantHidden"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"isTenantHidden"}}]}}]}}]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsAuthAccountSettingsDeleteTenantsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userHomeAccountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tenantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isInvitationRedeemed"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteTenants"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userHomeAccountId"},value:{kind:"Variable",name:{kind:"Name",value:"userHomeAccountId"}}},{kind:"Argument",name:{kind:"Name",value:"tenantId"},value:{kind:"Variable",name:{kind:"Name",value:"tenantId"}}},{kind:"Argument",name:{kind:"Name",value:"isInvitationRedeemed"},value:{kind:"Variable",name:{kind:"Name",value:"isInvitationRedeemed"}}},{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"isInvitationRedeemed"}}]}}]}}]},f=({recordPanelAction:e,emailPhone:t,accountUrlPrefix:n,loginHint:a,disableManageAccountUrlByCloud:o,host:r})=>{const s=o?`https://myaccount.microsoft.com/organizations?ref=AccountSettings&login_hint=${t}`:`${n}?ref=AccountSettings&${a}=${t}`;r.open(s,"_blank"),e({...d,moduleName:i.Sn.ManageAccountButton})},k=async(e,t,n)=>{n({...c,moduleName:i.Sn.RefreshTenantsButton});const l=(0,o.DA)(),d={source:a.p.GetTenantsFromSettings,id:l,scenarioName:h.Cu.AuthWebSetUpTenants},u=r.$C.create({correlation:d,subContext:"getTenantsCallback",timeoutMs:s.zB.ONE_HOUR});u.addScenarioMark("auth_get_tenants_start"),t.mutate({mutation:v,variables:{userContextId:e},context:{correlation:d}}),u.closeScenario()},C=async({userHomeAccountId:e,tenantId:t,isTenantHidden:n,client:c,recordPanelAction:d,dataBag:m})=>{d({...u,moduleName:i.Sn.UpdateTenantsToggle,actionOutcome:n?i.nd.disable:i.nd.enable,dataBag:m});const p={source:a.p.UpdateTenantsFromSettings,id:(0,o.DA)(),scenarioName:h.Cu.AuthWebUpdateTenants},g="updateTenantsCallback",[v,S]=(0,r.we)({options:{correlation:p},source:a.p.UpdateTenantsFromSettings,scenarioName:p.scenarioName,subContext:g});v.addScenarioMark("auth_update_tenants");try{const i=await c.mutate({mutation:y,variables:{userHomeAccountId:e,tenantId:t,isTenantHidden:n},context:{correlation:p}});if(!i?.data?.updateTenants)throw(0,l.$5)({context:p.source,subContext:g,message:"Null response",errorCode:s.tG.EmptyResponse,isExpected:!1,correlationId:p.id});return S(),i?.data?.updateTenants?.isTenantHidden}catch(e){S({error:e})}},b=(e,t,n)=>e&&t!==n,w=(e,t)=>!(e.accountId===t||!e.isActiveAccount&&!e.isHomeTenantInCrossCloud),T=({recordPanelAction:e,host:t,emailPhone:n,tenantId:l,leaveOrgUrl:c,dataBag:d})=>{const u={source:a.p.LeaveOrgFromAccountAndSettingPage,id:(0,o.DA)(),scenarioName:h.Cu.AuthLeaveOrg},[p,g]=(0,r.we)({options:{correlation:u},source:a.p.LeaveOrgFromAccountAndSettingPage,scenarioName:u.scenarioName,subContext:"leaveOrgCallback"});p.addScenarioMark(h.BQ.AuthLeaveOrgStart);let v=!1;if(d?.data?.["Authentication.ifCrossCloud"]&&(p.addEventData(["crossCloud:true"]),v=!0),n&&l&&c)try{let a;a=v?`${c}organizations?ref=AccountSettings&login_hint=${n}&tenantId=${l}`:`${c}organizations?ref=AccountSettings&login_hint=${n}`,t.open(a,"_blank"),e({...m,moduleName:i.Sn.LeaveOrgButton,dataBag:d}),g()}catch(e){g({errorCode:e?.errorCode})}else g({errorCode:s.tG.MissingRequiredFields})},I=async({userId:e,recordPanelAction:t,cloud:n,dataBag:s,switchAccountEntityCommand:l})=>{t({...p,moduleName:i.Sn.AcceptTenantInvitationButton,actionOutcome:i.nd.Accepted,dataBag:s});const c={source:a.p.AcceptInvitationFromAccountAndSettingPage,id:(0,o.DA)(),scenarioName:h.Cu.AuthAcceptTenantInvitation},[d,u]=(0,r.we)({options:{correlation:c},source:a.p.AcceptInvitationFromAccountAndSettingPage,scenarioName:c.scenarioName,subContext:"acceptTenantInviationCallback"});s?.data?.["Authentication.ifCrossCloud"]&&d.addEventData([`crossCloud:true;targetCloud:${n}`]),d.addScenarioMark("auth_accept_tenant_invitation");try{l?(l({userContextId:e,correlation:c,cloud:n}),d.addScenarioMark("auth_accept_tenant_call_entity_success")):d.addScenarioMark("auth_accept_tenant_call_nova_command"),u()}catch(e){d?.addScenarioMark("auth_accept_tenant_call_fail"),u({errorCode:e?.errorCode})}},N=async({recordPanelAction:e,showToast:t,client:n,declineSuccessText:c,declineFailureText:d,tenantName:u,tenantId:m,isInvitationRedeemed:p,homeAccountId:v,userId:y,cloud:f,dataBag:k})=>{e({...g,moduleName:i.Sn.DeclineTenantInvitationButton,actionOutcome:i.nd.Rejected,dataBag:k});const C={source:a.p.DeclineInvitationFromAccountAndSettingPage,id:(0,o.DA)(),scenarioName:h.Cu.AuthDeclineTenantInvitation},[b,w]=(0,r.we)({options:{correlation:C},source:a.p.DeclineInvitationFromAccountAndSettingPage,scenarioName:C.scenarioName,subContext:"declineTenantInviationCallback"});k?.data?.["Authentication.ifCrossCloud"]&&b.addEventData([`crossCloud:true;targetCloud:${f}`]);try{if(y&&!y.startsWith("dummy-user")){return w({error:(0,l.$5)({context:C.source,subContext:"declineTenantInvitationCallback",message:"This user has been redeemed, it is already an active user. ",errorCode:s.tG.UserNotFoundError,isExpected:!1,correlationId:C.id})}),!1}if(!u||!m||!1!==p||!v){const e=(0,l.$5)({context:C.source,subContext:"declineTenantInvitationCallback",message:"Params missing for declining tenant invitation",errorCode:s.tG.MissingRequiredFields,isExpected:!1,correlationId:C.id});throw w({error:e}),e}b.addScenarioMark("auth_decline_tenant_start");const e=await n.mutate({mutation:S,variables:{userHomeAccountId:v,tenantId:m,isInvitationRedeemed:p,userId:y},fetchPolicy:"no-cache",context:{correlation:C}});if(!e?.data?.deleteTenants)throw t({id:C.id,title:d,intent:"Warning",source:a.p.DeclineInvitationFromAccountAndSettingPage}),(0,l.$5)({context:C.source,subContext:"declineTenantInvitationCallback",message:"Null response",errorCode:s.tG.EmptyResponse,isExpected:!1,correlationId:C.id});return t({id:C.id,title:c,intent:"Success",source:a.p.DeclineInvitationFromAccountAndSettingPage}),b.addScenarioMark("auth_decline_tenant_success"),w(),!0}catch(e){b.addScenarioMark("auth_decline_tenant_fail");try{t({id:C.id,title:d,intent:"Warning",source:a.p.DeclineInvitationFromAccountAndSettingPage}),b.addScenarioMark("auth_decline_tenant_stop")}catch(e){b.addScenarioMark("auth_decline_tenant_toast_fail")}return w({error:e}),!1}},A=async({userHomeAccountId:e,isTenantHidden:t,client:n,recordPanelAction:c,dataBag:d,tenantId:m})=>{c({...u,moduleName:i.Sn.UpdateTenantsToggle,actionOutcome:t?i.nd.disable:i.nd.enable,dataBag:d});const p={source:a.p.UpdateTenantsFromSettings,id:(0,o.DA)(),scenarioName:h.Cu.AuthWebUpdateTenants},g="updateTenantsCallback",[v,S]=(0,r.we)({options:{correlation:p},source:a.p.UpdateTenantsFromSettings,scenarioName:p.scenarioName,subContext:g});v.addScenarioMark("auth_update_tenants");try{const i=await n.mutate({mutation:y,variables:{userHomeAccountId:e,tenantId:m,isTenantHidden:t},context:{correlation:p}});if(!i?.data?.updateTenants)throw(0,l.$5)({context:p.source,subContext:g,message:"Null response",errorCode:s.tG.EmptyResponse,isExpected:!1,correlationId:p.id});return S(),i?.data?.updateTenants?.isTenantHidden??void 0}catch(e){S({error:e})}},E=(e,t,n)=>!(e||t===n),F=(e,t,n,i,a)=>{const o=!!i&&i===a?.homeAccountId&&!!a.isCurrentUserEdge&&t===n;return[o&&e,o]},_=e=>({buildCloud:e.get("buildCloud"),disableTenantVisibilityToggle:e.get("disableTenantVisibilityToggle"),enableAcceptDeclineLeaveOrg:e.get("enableAcceptDeclineLeaveOrg"),enableDisplayTenantPrimaryDomainName:e.get("enableDisplayTenantPrimaryDomainName")}),D=(e,t,n,i,a,o)=>{const r=!!i.isCurrentUserEdge,s=i.id===o;if(!a){return!!e&&t!==e||!!n&&t!==n||!r||!!s}return!r||!!n&&e!==n||!!s},P=(e,t)=>{const n=e();return n.tenantType="MTO"===t?"MTO":"NonMTO",n}},81092:(e,t,n)=>{"use strict";n.d(t,{_P:()=>r,JS:()=>s});var i=n(957032),a=n(513432);const o=a.createContext(""),r=a.memo((e=>{const{children:t,joinId:n}=e;return(0,i.Y)(o.Provider,{value:n,children:t})})),s=()=>a.useContext(o)},375687:(e,t,n)=>{"use strict";n.d(t,{Xg:()=>l,qr:()=>c});var i=n(572909),a=n(902376),o=n(851075);const r={RIGEL_GALLERY:i.ck.callsgallery,RIGEL_CONTENT:i.ck.callscontent,RIGEL_GALLERY_AND_CONTENT:i.ck.callsgalleryandcontent,RIGEL_MAIN:i.ck.meetingroomallinonecall,CALL_MONITOR:i.ck.callsmonitor,STAGE:i.ck.calls,STAGE_CONTENT:i.ck.stagecontent},s=Object.fromEntries(Object.entries(r).map((([e,t])=>[t,e])));function l(e){return r[e]}const c=()=>{const{entity:e}=(0,a.At)(),t=(0,o.U)("useWindowingContainerViewType"),n=(i=e.type,s[i]);var i;return n||(t.errorToTelemetry?.(`Unknown entity type: ${e.type}`,"cmd_horizontals_windowing_type_converter",void 0,!0),"STAGE")}},710090:(e,t,n)=>{"use strict";n.d(t,{V:()=>c,k:()=>u});var i=n(957032),a=n(513432),o=n(851075),r=n(757060);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsCommunitiesAppSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"communitiesAppConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"baseImageUrl"}}]}}]}}]},l=a.createContext({baseImageUrl:null,loadingBaseImageUrl:!0}),c=({children:e})=>{const t=(0,o.U)("CommunitiesAppSettingsProvider"),{data:n,loading:a}=(0,r.I)(s),c=n?.communitiesAppConfig?.baseImageUrl||"",u={baseImageUrl:c,loadingBaseImageUrl:!!a};return c||a?c&&t.infoToTelemetry?.("Communities avatar base image URL found","communities_avatar_base_url_found"):t.errorToTelemetry?.("Communities avatar base image URL not found","communities_avatar_base_url_not_found"),(0,i.Y)(l.Provider,{value:d(u),children:e})},d=e=>a.useMemo((()=>({...e})),[e]),u=()=>a.useContext(l)},790628:(e,t,n)=>{"use strict";n.d(t,{IP:()=>o,TS:()=>s,UE:()=>l});var i=n(957032),a=n(513432);const o={isCallModeStreaming:()=>!1,isFullScreenButtonDisabled:()=>!1,isInEmbedContext:()=>!1,isTestUser:()=>!1,isVivaEngageEvent:()=>!1,getCallId:()=>{},getCorrelationId:()=>"",getForceAttendeeStreaming:()=>{},getEnablePlayerControlsForStreamingMode:()=>{},getParticipantId:()=>{},getStreamDetails:()=>{},getStreamingMode:()=>!1,getTelemetryData:()=>{},getThreadId:()=>"",getUiLanguagePreference:()=>{},getCallMode:()=>{},getMeetingRole:()=>{},getEventId:()=>{},getTemplateId:()=>{},getTitle:()=>{},getVivaEventId:()=>{},setVivaEventId:()=>{},setFullScreenButton:()=>{},setStreamDetails:()=>{},sendConveneError:()=>{},sendDataLoadError:()=>{},sendHeartbeat:()=>{},sendMetadata:()=>{},sendData:()=>{},sendServerError:()=>{},createBroadcastEndEventListener:()=>{},createCallDataUpdateEventListener:()=>{},createStreamUpdateEventListener:()=>{},createCaptionsToggleEventListener:()=>{},destroyCaptionsToggleEventListener:()=>{},createSubtitleTrackChangeEventListener:()=>{},destroySubtitleTrackChangeEventListener:()=>{},destroyBroadcastEndEventListener:()=>{},destroyCallDataUpdateEventListener:()=>{},destroyStreamUpdateEventListener:()=>{},sendReadyToRecieveBroadcastEndNotification:()=>{},sendReadyToRecieveCallDataUpdateNotification:()=>{},sendReadyToRecieveStreamUpdatesNotification:()=>{},validateEmbedStreamDetailsArray:()=>({isSuccessful:!0})},r=a.createContext(null),s=a.memo((e=>{const{conveneHostMessaging:t,children:n}=e,a={conveneHostMessaging:t||{...o}};return(0,i.Y)(r.Provider,{value:a,children:n})}));s.displayName="ConveneHostMessagingContextProvider";const l=()=>a.useContext(r)},817797:(e,t,n)=>{"use strict";n.d(t,{o:()=>m});var i=n(957032),a=n(959022),o=(n(513432),n(152270)),r=n(754255),s=n(199448),l=n(850434),c=n(933678),d=n(702183);performance?.mark?.("resolve-main-imports-end");const u=()=>Promise.all([n.e(320494),n.e(224316),n.e(120951),n.e(914945),n.e(311914),n.e(725973),n.e(428348),n.e(669152),n.e(616161),n.e(524147),n.e(296930),n.e(5982),n.e(353927),n.e(505772),n.e(597680),n.e(965787),n.e(674958),n.e(221963),n.e(927767),n.e(524014),n.e(383414),n.e(634370),n.e(475841),n.e(407772)]).then(n.bind(n,705031));class m{constructor(e){this._activationOptions=e,this._mounted=!1,this._logger=this._activationOptions.coreServices.loggerFactory.newLogger("CoreReactRenderer","components-core-layout")}async activate(){this.deactivate();try{return this._activateRoot()}catch(e){const t=(0,s.$5)("Experience",l.O4.Undefined,"activate",e);return this._logger.errorToTelemetry&&this._logger.errorToTelemetry(t.message,"webclient_framework_foundation_components_core_react_renderer",void 0,!0),this._activationOptions.coreServices.errorState.error=t,Promise.reject(t)}}deactivate(){this._mounted&&(a.unmountComponentAtNode(this._activationOptions.rootElement),this._mounted=!1)}async _loadCSS(){const{window:e,coreServices:{coreSettings:t}}=this._activationOptions,{enableCSSExtractionForV9:n}=t.get(r.w.Core);if(n)try{await e.chunkLoader.loadChunk(["griffel"],!0)}catch(e){if(!await this._loadCSSFallback())throw this._logger.errorToTelemetry?.(`Failed to load CSS chunk, window will not have styles: ${e.name}`,"webclient_framework_css_chunk_load",void 0,!0),e}}async _loadCSSFallback(){const{window:e}=this._activationOptions,t=e.document,n=e.parent,i=t.getElementById("griffel-style");if(!i?.href)return!1;try{const e=await n.fetch(i.href);if(200!==e.status)return!1;const a=await e.text(),o=t.createElement("style");return o.textContent=a,o.setAttribute("data-griffel-fallback",""),t.head.appendChild(o),!0}catch{return!1}}async _activateRoot(){const{window:e,rootElement:t,coreServices:{altScenarioService:n,scenarioFactory:r}}=this._activationOptions,s=this._loadCSS(),l=(0,c.wg)(u,"core-essentials",r),[{RootRenderer:m}]=await Promise.all([l,s]);return n?.altScenario?.mark(d.BQ.CoreEssentialsChunkLoad),new Promise((n=>{a.render((0,i.Y)(m,{...this._activationOptions}),t,(()=>{this._mounted=!0,e&&(0,o.fR)(e.document,t),n()}))}))}}},370275:(e,t,n)=>{"use strict";n.d(t,{vq:()=>b});var i=n(957032),a=n(513432),o=n(139150);const r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"presence"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presence"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userPresenceData"}}]}}]}},...n(109587).x.definitions]};var s=n(778803),l=n(846716),c=n(28544),d=n(388593),u=n(513527),m=n(729580),p=n(838376),g=n(484699),h=n(278287),v=n(323321),y=n(635158),S=n(526521);const f=(0,n(965804).O)({isStudentFocus:{Frg6f3:["f1trm9jk","fhevztl"],Bt984gj:"f122n59",Bgfg5da:0,B9xav0g:0,oivjwe:0,Bn0qgzm:0,B4g9neb:0,zhjwy3:0,wvpqe5:0,ibv6hh:0,u1mtju:0,h3c5rm:0,vrafjx:0,Bekrc4i:0,i8vvqc:0,g2u3we:0,icvyot:0,B4j52fo:0,irswps:"faev5xe",Bxa1mx5:0,Brovlpu:0,B3aqqti:0,uky70d:"f1ni9pe4",vu0emg:0,B486eqv:0,Beohmeb:0,Bqkjgwr:"f177yfvr",ui215o:0,B8aurwo:0,B7ww9xo:0,n0gj8w:0,B42scjv:0,r7vpch:0,B290z78:0,kqz2af:0,eadzt8:0,oijq25:0,ub9f5y:0,B3iij4b:0,B67fdqs:0,sj2y4s:0,wirsk4:0,j1926o:0,B2fz1z8:"f8ufbym"},isStudentName:{Bh6795r:"fqerorx"},isParentsEndSlot:{a9b677:"f45u8dm",Be2twd7:"fkhj508",Bhrd7zp:"fl43uef"}}),k=({member:e,ariaLabel:t,isParentsEndSlot:n,isGuardiansApprovalRequestDialog:a})=>{const o=(0,h.b)(),r=f(),{onClick:s,onKeyDown:l,onMouseEnter:k,onMouseLeave:C}=(0,u.q0)({ariaLabel:t,userId:e.id});return(0,i.Y)(g.FN,{userId:e.id,ariaLabel:t,children:(0,i.Y)(v.s,{vAlign:"center",gap:n?"gap.medium":"gap.small",className:r.isStudentFocus,onClick:s,onKeyDown:l,onMouseEnter:k,onMouseLeave:C,...n&&(0,m.L)(p.Q.StudentContactCard,!0),children:[(0,i.Y)(c.j,{users:[e],isFocusable:!1,"aria-hidden":!0,profilePictureSize:d.xi.Medium,size:n?"larger":a?"medium":"small",narrateProfilePicture:!1,v9ClassName:o.isStudentAvatar,callerInfo:"student-renderer"}),(0,i.Y)(y.D,{size:"medium",weight:"regular",className:n?(0,S.z)(r.isParentsEndSlot,r.isStudentName):r.isStudentName,truncate:!0,children:e.displayName})]})})},C=(e,t,n)=>{const i=n?e.stringTranslate("livePersonaCard",n):e.stringTranslate("guardians","guardians_status_unknown_label"),a=t.displayName?t.displayName:e.stringTranslate("guardians","guardians_user_unknown_label");return e.stringTranslate("guardians","guardians_student_label",{studentName:a,status:i})},b=e=>{const{member:t,isParentsEndSlot:n,isGuardiansApprovalRequestDialog:r}=e,s=(e=>{const t=(0,l.PO)(),[n,i]=a.useState(C(t,e)),r=(0,o.m)();return a.useEffect((()=>{let n=!1;return(async()=>{try{const{title:a}=await w(r,e.id,!0);!n&&i(C(t,e,a))}catch(e){}})(),()=>{n=!0}}),[e,r,t]),n})(t);return(0,i.Y)(k,{member:t,ariaLabel:s,isParentsEndSlot:n,isGuardiansApprovalRequestDialog:r})},w=async(e,t,n)=>{if(!e)throw new Error("Apollo Client is not defined");const i=await e.query({query:r,variables:{userId:t,source:"ups"},fetchPolicy:n?"cache-first":"network-only"});return(0,s.CD)(i?.data?.presence)}},778012:(e,t,n)=>{"use strict";n.d(t,{LQ:()=>g,ly:()=>h});var i=n(957032),a=n(513432),o=n(851075),r=n(763588),s=n(406679),l=n(139150);const c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsWebFloatingMonitorNavigateToCallScreenMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"navigateToCallScreen"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}]}]}}]};var d;!function(e){e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden",e[e.Closed=2]="Closed"}(d||(d={}));const u=[d.Hidden,d.Visible],m=a.createContext({setIntentIdOverride:()=>{},mounted:()=>{},hide:()=>Promise.resolve(),unhide:()=>Promise.resolve(),close:()=>Promise.resolve(),showCallWindow:()=>Promise.resolve()}),p=new Map,g=e=>{const t=(0,r.useNovaEventing)(),n=(0,l.m)(),[g,h]=a.useState(e.intentIdOverride),v=a.useCallback((()=>{const e=Array.from(p.values());return 0===e.length?d.Closed:e.includes(d.Visible)?d.Visible:d.Hidden}),[]),y=a.useCallback(((e,t)=>(t in u?p.set(e,t):p.delete(e),v())),[v]),S=a.useCallback((e=>{switch(e){case d.Visible:return t.generateEvent({event:s.AZ.unhideMonitor()});case d.Hidden:return t.generateEvent({event:s.AZ.hideMonitor()});case d.Closed:return t.generateEvent({event:s.AZ.closeMonitor()})}}),[t]),f=a.useCallback((e=>{p.get(e)!==d.Hidden&&y(e,d.Visible)}),[y]),k=a.useCallback(((e,t)=>{const n=v(),i=y(e,t);return n!==i?S(i):Promise.resolve()}),[y,v,S]),C=a.useCallback((e=>k(e,d.Hidden)),[k]),b=a.useCallback((e=>k(e,d.Visible)),[k]),w=a.useCallback((e=>k(e,d.Closed)),[k]),T=(0,o.U)("WebFloatingMonitorContextProvider"),I=a.useCallback((e=>n?.mutate({mutation:c,variables:{teamsCallId:e}}).then((e=>{e.data?.navigateToCallScreen||T.error("Failed to navigate to call screen via navigateToCallScreen mutation")})).catch((e=>T.error(`Failed to navigate to call screen via navigateToCallScreen mutation: ${e.message}`)))),[n,T]),N=a.useMemo((()=>({intentIdOverride:g,setIntentIdOverride:h,mounted:f,hide:C,unhide:b,close:w,showCallWindow:I})),[g,f,C,b,w,I]);return(0,i.Y)(m.Provider,{value:N,children:e.children})},h=()=>a.useContext(m)},278287:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});const i=(0,n(965804).O)({isStudentAvatar:{Bf4jedk:"f1ohpo60"},isParentAvatar:{Bf4jedk:"ff9fk16"}})},516404:(e,t,n)=>{"use strict";function i(e){return'<link\n  rel="shortcut icon"\n  type="image/x-icon"\n  id="teams-favicon"\n  href="[[staticsPath]]/evergreen-assets/icons/microsoft_teams_logo_refresh.ico"\n/>','<link\n  rel="shortcut icon"\n  type="image/x-icon"\n  id="teams-favicon"\n  href="[[staticsPath]]/evergreen-assets/icons/microsoft_teams_logo_refresh.ico"\n/>'}n.d(t,{A:()=>i})},10247:(e,t,n)=>{"use strict";function i(e){var t="";Array.prototype.join;return t+="<style>\n  .preload-title-bar-trim {\n    ","mac"===e.osPlatform?t+="\n    --preload-title-bar-background-color: rgb(98, 100, 167);\n    ":t+="\n    --preload-title-bar-background-color: rgb(70, 71, 117);\n    ",t+='\n\n    background-color: var(--preload-title-bar-background-color);\n    padding: .3rem .3rem 0 .3rem;\n    height: 4rem;\n    width: 100%;\n    position: fixed;\n    top: 0;\n    left: 0;\n    box-sizing: border-box;\n    -webkit-app-region: drag;\n    z-index: -20;\n  }\n\n  .preload-title-bar-trim * {\n    margin: 0;\n    padding: 0;\n    -webkit-margin-before: 0;\n    -webkit-margin-after: 0;\n    box-sizing: inherit;\n  }\n\n  .preload-title-bar {\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: white;\n    position: relative;\n  }\n\n\n  /**\n   * Allows resizing around the edges of the title bar by creating a region that isn\'t draggable\n   * The \'top\' value must be greater than zero, otherwise when the app is maximized,\n   * you won\'t be able to click and drag the window from the very top\n   */\n  .preload-title-bar::before {\n    content: "";\n    top: .2rem;\n    position: absolute;\n    height: .2rem;\n    -webkit-app-region: no-drag;\n    width: 100%;\n    left: 0;\n  }\n\n  .preload-title-bar-text {\n    margin: auto;\n    text-align: center;\n    font-size: 1.4rem;\n    pointer-events: none;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .preload-title-bar-buttons {\n    height: 4rem;\n    display: flex;\n    flex-basis: 0;\n    align-items: center;\n    position: absolute;\n    top: 0;\n    right: 0;\n    margin-top: -.3rem;\n    margin-right: -.3rem;\n  }\n\n  .preload-title-bar-button {\n    background-color: var(--preload-title-bar-background-color);\n    -webkit-app-region: no-drag;\n    user-select: none;\n    border: 0;\n    border-radius: 0;\n    cursor: pointer;\n    height: 100%;\n    width: 4rem;\n    outline: none;\n  }\n\n  .preload-title-bar-button>svg {\n    fill: white;\n    background-color: inherit;\n    width: 1.6rem;\n    height: 1.6rem;\n    display: block;\n    margin: auto;\n  }\n\n  .preload-title-bar-button-close-filled {\n    display: none;\n  }\n\n  .preload-title-bar-button-close-outline {\n    display: block;\n  }\n\n  .preload-title-bar-button:hover {\n    background-color: rgb(51, 52, 74);\n  }\n\n  .preload-title-bar-button-close:hover {\n    background-color: rgb(196, 49, 75);\n  }\n\n  .preload-title-bar-button-close:hover .preload-title-bar-button-close-filled {\n    display: block;\n  }\n\n  .preload-title-bar-button-close:hover .preload-title-bar-button-close-outline {\n    display: none;\n  }\n</style>\n<div class="preload-title-bar-trim">\n  <div id="preload-title-bar" class="preload-title-bar">\n    <span class="preload-title-bar-text" aria-hidden="true">Microsoft Teams</span>\n\n    ',"windows"===osPlatform&&(t+='\n    <div class="preload-title-bar-buttons">\n      \x3c!-- TODO: Hook button up to minimize/maximize/collapse API --\x3e\n      <button class="preload-title-bar-button">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <path d="M10 16v-1h12v1H10z"></path>\n        </svg>\n      </button>\n      \x3c!-- TODO: Hook button up to minimize/maximize/collapse API --\x3e\n      <button class="preload-title-bar-button">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <path d="M10 10h12v12H10V10zm11 11V11H11v10h10z"></path>\n        </svg>\n      </button>\n      \x3c!-- TODO: toggle on when maximized --\x3e\n      \x3c!-- TODO: Hook button up to minimize/maximize/collapse API --\x3e\n      <button class="preload-title-bar-button" style="display:none;">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <path d="M11 9v2H9v12h12v-2h2V9H11zm9 13H10V12h10v10zm2-2h-1v-9h-9v-1h10v10z"></path>\n        </svg>\n      </button>\n      <button class="preload-title-bar-button preload-title-bar-button-close">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <g>\n            <path class="preload-title-bar-button-close-outline"\n              d="M16.707 16l4.243-4.243a.5.5 0 1 0-.707-.707L16 15.293l-4.243-4.243a.5.5 0 1 0-.707.707L15.293 16l-4.243 4.243a.5.5 0 1 0 .707.707L16 16.707l4.243 4.243a.498.498 0 0 0 .707 0 .5.5 0 0 0 0-.707L16.707 16z">\n            </path>\n            <path class="preload-title-bar-button-close-filled"\n              d="M17.414 16l3.89-3.89a1 1 0 1 0-1.415-1.413L16 14.586l-3.89-3.89a1 1 0 1 0-1.413 1.415L14.586 16l-3.89 3.89a1 1 0 1 0 1.415 1.413L16 17.414l3.89 3.89a.997.997 0 0 0 1.413 0 1 1 0 0 0 0-1.415L17.414 16z">\n            </path>\n          </g>\n        </svg>\n      </button>\n    </div>\n    '),t+="\n  </div>\n</div>"}n.d(t,{A:()=>i})},851027:(e,t,n)=>{"use strict";function i(e){var t="";Array.prototype.join;return t}n.d(t,{A:()=>i})},536397:(e,t,n)=>{"use strict";function i(e){return'<style type="text/css" id="splash-styles">\n  /** Remove outline, when focusing splash screen, because it is not necessary to inform user about focus on that element. */\n  div[id="splash-screen"] {\n    outline: none;\n  }\n\n\n  /** Below styles are dedicated for the pre-loading wheel (before React loads) */\n  .ui.loader {\n    display: none;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin: 0;\n    text-align: center;\n    z-index: 1000;\n    -webkit-transform: translateX(-50%) translateY(-50%);\n    transform: translateX(-50%) translateY(-50%);\n  }\n\n  .ui.loader:before {\n    position: absolute;\n    content: "";\n    top: 0;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    border-radius: 500rem;\n    border: 0.2em solid rgba(0, 0, 0, 0.1);\n  }\n\n  .ui.loader:after {\n    position: absolute;\n    content: "";\n    top: 0;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    -webkit-animation: loader 0.6s linear;\n    animation: loader 0.6s linear;\n    -webkit-animation-iteration-count: infinite;\n    animation-iteration-count: infinite;\n    border-radius: 500rem;\n    border-color: #767676 transparent transparent;\n    border-style: solid;\n    border-width: 0.2em;\n    -webkit-box-shadow: 0 0 0 1px transparent;\n    box-shadow: 0 0 0 1px transparent;\n  }\n\n  @-webkit-keyframes loader {\n    from {\n      -webkit-transform: rotate(0);\n      transform: rotate(0);\n    }\n\n    to {\n      -webkit-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n\n  @keyframes loader {\n    from {\n      -webkit-transform: rotate(0);\n      transform: rotate(0);\n    }\n\n    to {\n      -webkit-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n\n  .ui.large.loader:after,\n  .ui.large.loader:before {\n    width: 3.42857143rem;\n    height: 3.42857143rem;\n    margin: 0 0 0 -1.71428571rem;\n  }\n\n  .ui.text.loader {\n    width: auto !important;\n    height: auto !important;\n    text-align: center;\n    font-style: normal;\n  }\n\n  .ui.loader.active,\n  .ui.loader.visible {\n    display: block;\n  }\n\n  .ui.loader.disabled,\n  .ui.loader.hidden {\n    display: none;\n  }\n\n  .ui.large.text.loader {\n    min-width: 3.42857143rem;\n    padding-top: 4.21428571rem;\n  }\n\n  @-webkit-keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n\n    to {\n      opacity: 0;\n    }\n  }\n\n  @keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n\n    to {\n      opacity: 0;\n    }\n  }\n\n  .ui.loader.fadeOut {\n    -webkit-animation: fadeOut 500ms linear;\n    animation: fadeOut 500ms linear;\n  }\n</style>','<style type="text/css" id="splash-styles">\n  /** Remove outline, when focusing splash screen, because it is not necessary to inform user about focus on that element. */\n  div[id="splash-screen"] {\n    outline: none;\n  }\n\n\n  /** Below styles are dedicated for the pre-loading wheel (before React loads) */\n  .ui.loader {\n    display: none;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin: 0;\n    text-align: center;\n    z-index: 1000;\n    -webkit-transform: translateX(-50%) translateY(-50%);\n    transform: translateX(-50%) translateY(-50%);\n  }\n\n  .ui.loader:before {\n    position: absolute;\n    content: "";\n    top: 0;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    border-radius: 500rem;\n    border: 0.2em solid rgba(0, 0, 0, 0.1);\n  }\n\n  .ui.loader:after {\n    position: absolute;\n    content: "";\n    top: 0;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    -webkit-animation: loader 0.6s linear;\n    animation: loader 0.6s linear;\n    -webkit-animation-iteration-count: infinite;\n    animation-iteration-count: infinite;\n    border-radius: 500rem;\n    border-color: #767676 transparent transparent;\n    border-style: solid;\n    border-width: 0.2em;\n    -webkit-box-shadow: 0 0 0 1px transparent;\n    box-shadow: 0 0 0 1px transparent;\n  }\n\n  @-webkit-keyframes loader {\n    from {\n      -webkit-transform: rotate(0);\n      transform: rotate(0);\n    }\n\n    to {\n      -webkit-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n\n  @keyframes loader {\n    from {\n      -webkit-transform: rotate(0);\n      transform: rotate(0);\n    }\n\n    to {\n      -webkit-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n\n  .ui.large.loader:after,\n  .ui.large.loader:before {\n    width: 3.42857143rem;\n    height: 3.42857143rem;\n    margin: 0 0 0 -1.71428571rem;\n  }\n\n  .ui.text.loader {\n    width: auto !important;\n    height: auto !important;\n    text-align: center;\n    font-style: normal;\n  }\n\n  .ui.loader.active,\n  .ui.loader.visible {\n    display: block;\n  }\n\n  .ui.loader.disabled,\n  .ui.loader.hidden {\n    display: none;\n  }\n\n  .ui.large.text.loader {\n    min-width: 3.42857143rem;\n    padding-top: 4.21428571rem;\n  }\n\n  @-webkit-keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n\n    to {\n      opacity: 0;\n    }\n  }\n\n  @keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n\n    to {\n      opacity: 0;\n    }\n  }\n\n  .ui.loader.fadeOut {\n    -webkit-animation: fadeOut 500ms linear;\n    animation: fadeOut 500ms linear;\n  }\n</style>'}n.d(t,{A:()=>i})},432134:(e,t,n)=>{"use strict";function i(e){var t="";Array.prototype.join;return t+='<div id="splash-screen" tabindex="-1" role="progressbar" aria-valuetext="Loading..."\nstyle="height: 100vh; overflow: hidden; -webkit-app-region: drag;">\n  \x3c!-- Inline styles below as once React loads, all of the below will be removed. --\x3e\n  <div style="height: calc(100% - 4rem);\n                -webkit-user-select: none;\n                background-color: transparent;">\n    ',e.titleBar&&(t+='\n      <div style="height:4rem;background-color:#464775"></div>\n    '),t+='\n    <div class="ui large active text loader">\n      <span id="splash-screen-label">Loading...</span>\n    </div>\n  </div>\n</div>\n'}n.d(t,{A:()=>i})},81014:(e,t,n)=>{"use strict";n.d(t,{TR:()=>S,M_:()=>h,hE:()=>g,wj:()=>v,cm:()=>f,fP:()=>k,CS:()=>T,Dk:()=>y});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"firstLoginInfoNS"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Web"}},{kind:"Field",name:{kind:"Name",value:"WebNorthStar"}},{kind:"Field",name:{kind:"Name",value:"CoachMarkSavedWeb"}},{kind:"Field",name:{kind:"Name",value:"PromptCards"}},{kind:"Field",name:{kind:"Name",value:"FreemiumFRE"}},{kind:"Field",name:{kind:"Name",value:"ios"}},{kind:"Field",name:{kind:"Name",value:"android"}},{kind:"Field",name:{kind:"Name",value:"wp"}},{kind:"Field",name:{kind:"Name",value:"electron"}},{kind:"Field",name:{kind:"Name",value:"maglev"}},{kind:"Field",name:{kind:"Name",value:"desktopHwa"}},{kind:"Field",name:{kind:"Name",value:"surfaceHub"}},{kind:"Field",name:{kind:"Name",value:"espFirstRunStarted"}},{kind:"Field",name:{kind:"Name",value:"espFirstRunCompleted"}},{kind:"Field",name:{kind:"Name",value:"unknown"}}]}}]},a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"firstLoginInfoNS"}}]}}]}}]}},...i.definitions]},o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsEspUserPreferenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateUserPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}},{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserPreferences"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"firstLoginInfoNS"}}]}}]}}]}}]}},...i.definitions]},r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"activateEspTarget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"surfaceId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"selector"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activateEspTarget"},arguments:[{kind:"Argument",name:{kind:"Name",value:"surfaceId"},value:{kind:"Variable",name:{kind:"Name",value:"surfaceId"}}},{kind:"Argument",name:{kind:"Name",value:"targetId"},value:{kind:"Variable",name:{kind:"Name",value:"targetId"}}},{kind:"Argument",name:{kind:"Name",value:"selector"},value:{kind:"Variable",name:{kind:"Name",value:"selector"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}]}]}}]},s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEspAppReadyTriggerStatusQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appReadyTriggerStatus"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isAppReadyCompleted"}}]}}]}}]};var l=n(306183),c=n(199448),d=n(850434),u=n(364819);const m="growth_growthplatform_start_esp_job",p="syntheticNotificationRecommendation",g=(e,t)=>{try{const t=e.readQuery({query:s});return t&&t.appReadyTriggerStatus?t.appReadyTriggerStatus:{isAppReadyCompleted:!1}}catch(e){return t.errorToTelemetry?.("Failed to get trigger status",m),{isAppReadyCompleted:!1}}},h=(e,t)=>{try{e.writeQuery({query:s,data:{appReadyTriggerStatus:{__typename:"AppReadyTriggerStatus",isAppReadyCompleted:!0}}})}catch(e){const n=T(e,"Failed to complete app ready trigger status.");throw t.errorToTelemetry?.(n.join(" "),m),e}},v=async(e,t)=>{try{const t=await e.query({query:a});return t.data?.userPreferences?.firstLoginInformation??null}catch(e){return t.errorToTelemetry?.("First Login CDL Query failed",m),null}},y=async(e,t,n,i,r)=>{const s={...i,[t]:n.toISOString()};if(delete s.__typename,s){let e;for(e in s)null===s[e]&&delete s[e]}await e.mutate({mutation:o,variables:{category:"firstLoginInformation",value:JSON.stringify(s)},update:(e,t)=>{if("UserPreferences"===t.data?.updateUserPreferences?.__typename)try{e.writeQuery({query:a,data:{userPreferences:{firstLoginInformation:t.data?.updateUserPreferences?.firstLoginInformation,__typename:"UserPreferences"}}})}catch(e){r.errorToTelemetry?.("Error while updating cache after updating firstLoginInformation.",m)}}})},S=async(e,t,n,i="shell",a,o)=>{const{data:s}=await e.mutate({mutation:r,variables:{surfaceId:n,targetId:i,selector:a,windowId:o},fetchPolicy:"no-cache"});if(!s?.activateEspTarget){const e=`Target Not found for surfaceId at ${i}, ${n}, ${a}, ${o}`;throw t.errorToTelemetry?.(e,"growth_growthplatform_esp_missing_target"),new Error("Failed to activate ESP target component.")}},f=(e,t)=>({surfaceId:e,title:w(t.title??t.titleNotification),description:w(t.description??t.descriptionNotification),visibility:t.visibility,deeplinkUrl:t.deeplinkUrl??t.deeplinkUrlNotification}),k=e=>({teamsAppId:e.teamsAppId,previewText:w(e.previewText),description:w(e.description),source:e.source,deeplinkUrl:e.deeplinkUrl,templateParameters:b(e.title??e.titleTfwNotification),activityType:C(e.activityType,e.title??e.titleTfwNotification)}),C=(e,t)=>t?p:e??p,b=e=>{if(e)return[{name:"SyntheticNotification",value:w(e)}]},w=e=>{if(e){if(function(e){return void 0!==e.localizedContent}(e))return{localizedText:e.localizedContent};return{notLocalizedText:e.key}}},T=(e,t)=>{const n=[t];if(I(e)){const t=(0,l.qD)(e),i=(0,c.xZ)(t,"innerError",void 0);i?.code===d.O4.NotPresent&&n.push((0,c.BA)(i))}return n},I=e=>!!e&&!!(0,u.get)(e,"graphQLErrors")},51653:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"espState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"espState"}}]}}]}},...n(291011).Q.definitions]}},116618:(e,t,n)=>{"use strict";n.d(t,{$:()=>r});var i=n(710225);let a;class o{constructor(e){this.serializeCacheKey=e=>{const{typeName:t,user:n,key:i}=e;return`tmp.auth.v1.${n?.id??"GLOBAL"}.${t}.${i?i.toUpperCase():t}`},this._indexedDbProvider=e}async getValue(e){try{const t=this.serializeCacheKey(e);return await this._indexedDbProvider.getValue(t)}catch(e){return void i.D.log(`getValue:${e}`)}}async put(e,t){try{const n=this.serializeCacheKey(e);return await this._indexedDbProvider.put(n,t),!0}catch(e){return i.D.log(`put:${e}`),!1}}async del(e){try{const t=this.serializeCacheKey(e);return await this._indexedDbProvider.del(t),!0}catch(e){return i.D.log(`delete:${e}`),!1}}}const r=e=>a||(a=new o(e),a)},270560:(e,t,n)=>{"use strict";n.d(t,{K_:()=>g,qf:()=>h,CT:()=>v,G:()=>y,rJ:()=>S,Yc:()=>f,kp:()=>k,GC:()=>C,$Q:()=>b});var i=n(99425),a=n(329809),o=n(913895),r=n(176737),s=n(50737),l=n(81670),c=n(710225),d=n(736626),u=n(509387),m=n(585542),p=n(235133);const g=(e,t,n)=>{let a;if(t&&!n){const n=r.Vh.getAllOfType("User").filter((e=>e.profile.tid===t&&e.type!==i.aS.Anonymous));if(n.length>1){const t=r.Vh.getValue(s.O4.globalUser);if(a=!!e&&n.find((t=>t.id===e))||n.find((e=>e.id===t.id)),a)return a;throw{message:"Multiple users found in cache with same tenantId",errorCode:l.tG.MultipleUsersPresentWithSpecifiedIdentifier}}return n[0]}if(e){const t=r.Vh.getAllOfType("User");a=t?.filter((t=>t.id===e))[0]}else a=r.Vh.getValue(s.O4.globalUser);return a},h=e=>{if(!e)return[];return r.Vh.getAllOfType("User").filter((t=>t.id!==e&&t.homeAccountId===e))||[]},v=(e,t)=>{if(!e||!t)return;return h(e).find((e=>e.profile.tid===t))},y=(e,t)=>{if(!e||!t)return!1;return e.some((e=>e.cloud!==t&&!e.id.startsWith("dummy-user")))},S=async(e,t,n,i)=>{n?.addScenarioMark("auth_get_encryption_key_start");const o=r.Vh.getValue(s.O4.encryptionKey);if("object"==typeof o)return n?.addScenarioMark("auth_get_encryption_key_stop"),o;let l,c;n?.addScenarioMark("auth_get_exported_key_start");try{if(i&&(0,m.Y)(e)){const e=await t.loadModule(a.bx.Auth);l=(await e.acquireEncryptionKey({correlationId:n?.correlation.id||(0,d.DA)()})).result}else{const e=r.Vh.getValue(s.O4.exportedEncryptionKey);l=e?.exportedKey}}catch(e){return n?.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),n?.addScenarioMark("auth_get_encryption_key_stop"),null}if(!l)return n?.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),void n?.addScenarioMark("auth_get_encryption_key_stop");try{c=await e.crypto.subtle.importKey("raw",(0,u.X)(l),{name:"AES-CBC"},!0,["encrypt","decrypt"]),r.Vh.put(s.O4.encryptionKey,c),n?.addScenarioMark("auth_get_exported_key_stop")}catch(e){n?.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),c=null}return n?.addScenarioMark("auth_get_encryption_key_stop"),c},f=(e,t,n)=>{const a=i.p8[o.k[e]],l=g(t,void 0);if(!l)return void c.D.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);const u=(0,p.X_)(l),m=(0,d.hR)(n?.reason)||a;r.Vh.put((0,s.Xr)(u).userAuthState,{state:a,reason:m,customError:n?{errorCode:n.errorCode||n.code,message:n.message,isExpected:n.isExpected,context:n.context,subContext:n.subContext,correlationId:n.correlationId}:null}),n?c.D.warn(`[AuthState] UserAuthState updated - ${t} : ${a} errorCode: ${n.errorCode} isExpected: ${n.isExpected} correlationId: ${n.correlationId}`):c.D.log(`[AuthState] UserAuthState updated - ${t} : ${a}`)},k=()=>r.Vh.getValue(s.O4.logoutState),C=()=>r.Vh.getValue(s.O4.previousSignInProgressState),b=()=>r.Vh.del(s.O4.previousSignInProgressState)},176737:(e,t,n)=>{"use strict";n.d(t,{Vh:()=>d,Fq:()=>y});var i=n(81670),a=n(710225),o=n(736626),r=n(235133),s=n(50737);const l=[i.yq,i.QF,i.ct],c={KeyVersion:"v1",UseAccountIdKey:!0};let d;const u=e=>c.UseAccountIdKey?e?.id||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),m=(e,t,n)=>`tmp.auth.${c.KeyVersion}.${e}.${t}.${n}`,p=e=>{const{typeName:t,user:n}=e;return{user:e.user?u(n):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},g=(e,t)=>({storageKey:c.UseAccountIdKey?m(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:m(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class h{constructor(e,t){this._coreSettings=t,this._expireOffsetSeconds=i.zB.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=i.zB.SECONDS_PER_MINUTE,this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=async(e,t)=>{let n=t;t.item.encryptedToken&&(n=this._deepCopyEncryptedToken(t));const i=p(e),{storageKey:r,loggingKey:s}=g(e,i);try{this._storage.setItem(r,(0,o.hR)(n))}catch(e){a.D.error(`error in putting key [${s}] in storage, error - [${(0,o.Nw)(e)}]`)}},this._deepCopyEncryptedToken=e=>{const t={...e.item};return t.skypeToken?t.skypeToken="":t.token="",{item:t,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh,refreshAfter:e.refreshAfter}},this._deleteFromExternalCache=async e=>{const t=p(e),{storageKey:n,loggingKey:i}=g(e,t);try{this._storage.removeItem(n)}catch(e){a.D.error(`error in deleting key [${i}] in storage, error - [${(0,o.Nw)(e)}]`)}},this._flushExternalCache=async e=>{try{const t={};Object.keys(this._storage).forEach((n=>{l.forEach((e=>{if(-1!==n.indexOf(e)){const e=this._storage.getItem(n);e&&(t[n]=e)}})),(!e&&0===n.indexOf("$[")||!e&&0===n.indexOf("tmp.auth")||e&&-1!==n.indexOf("tmp.auth")&&(-1!==n.indexOf(e.oid)||e.id&&-1!==n.indexOf(e.id)))&&this._storage.removeItem(n)})),Object.keys(t).forEach((e=>{this._storage.setItem(e,t[e])}))}catch(e){a.D.error(`error in clearing storage, error - [${(0,o.Nw)(e)}]`)}},this._isGlobalUser=e=>{let t=this.internalCache.GLOBAL?.User?.User;return t||(t=this.get(s.O4.globalUser)),t&&(0,r.gn)((0,r.X_)(t.item),e)},this._putGlobalUserInCache=(e,t)=>{if(this._shouldSkipUpdatingGlobalUser(e,t))return;const n=e.user?"GLOBAL":u((0,r.X_)(t.item));this._initializeCacheForCacheItem("User",n),this.internalCache[n].User.User=t;const i=c.UseAccountIdKey?m(n,"User","User"):`$[${n}][User][User]`;this._storage.setItem(i,JSON.stringify(t))},this._shouldSkipUpdatingGlobalUser=(e,t)=>{const n=this.internalCache.GLOBAL?.User?.User;if(n&&e.user&&!this._isGlobalUser(e.user))return!0;const i=t.item,a=this._coreSettings?.("buildCloud"),o=this._coreSettings?.("disableSetOnlyCurrentCloudGlobalUser");return!(o||!i||!a)&&i.cloud!==a},this._validateValue=(e,t)=>{if(!("Token"!==e.typeName||"object"==typeof t&&t.token&&t.expires))throw new Error("Invalid value for Token.");if(!("Discover"!==e.typeName||e.key!==i.xM||"object"==typeof t&&t.skypeToken&&t.expiration))throw new Error("Invalid value for Skype token.");if("User"!==e.typeName)return;const n=t;if(!(n.userName&&n.type&&n.role&&n.profile&&void 0!==n.isAuthenticated))throw new Error(`Invalid value for user. userName exists: [${!!n.userName}], type: [${n.type}], role: [${n.role}], profile exists: [${!!n.profile}],isAuthenticated: [${n.isAuthenticated}]`);const a=this.internalCache.GLOBAL?.User?.User,o=(0,r.X_)(n);if(a&&!e.user&&!this._isGlobalUser(o))throw new Error("there is already global user in auth cache")},this._storage=e.localStorage,a.D.info("auth_cache initialized")}updateSetting(e,t){a.D.log(`Updating authCache setting ${e} from ${c[e]} to ${t}.`),"KeyVersion"===e&&(t!==c.KeyVersion&&(this.internalCache={}),c.KeyVersion=t),"UseAccountIdKey"===e&&(t!==c.UseAccountIdKey&&(this.internalCache={}),c.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){v(e),this._validateValue(e,t);const{typeName:n,key:i,user:a}=p(e),o="Token"===n||"Discover"===n&&"SKYPE-TOKEN"===i;o&&(t.fromCache=!0);let r=this.internalCache[a]?.[n]?.[i];return r?(r.hitCount=0,r.item=t):r={item:t,shouldRefresh:!1,hitCount:0},o&&(r.refreshAfter=function(e,t,n){const i=f(e,t);if(i&&n)return C(S(),i,n);return}(n,t,this.refreshPercents)),"User"===n&&this._putGlobalUserInCache(e,r),this._initializeCacheForCacheItem(n,a),this.internalCache[a][n][i]=r,this._addToExternalCache(e,r),!0}updateGlobalUser(e){const t="GLOBAL",n={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache[t].User.User=n,this._addToExternalCache(s.O4.globalUser,n),!0}get(e){v(e);const t=p(e),{storageKey:n,loggingKey:i}=g(e,t),{typeName:r,key:s,user:l}=t;let c=this.internalCache[l]?.[r]?.[s];const d=!!c;if(!c)try{const e=this._storage?.getItem(n);e&&(c=JSON.parse(e))}catch(e){a.D.error(`value for key [${i}] throw error. ${(0,o.Nw)(e)}`)}if(c)return this._initializeCacheForCacheItem(r,l),this.internalCache[l][r][s]=c,("Token"===r||"Discover"===r&&"SKYPE-TOKEN"===s)&&(c.shouldRefresh=this._shouldRefresh(c,r),c.hitCount++,this.internalCache[l][r][s]=c,this._addToExternalCache(e,c)),void 0===c.shouldRefresh?(a.D.info(`cacheItem '[${n}]' need to refresh`),void this.del(e)):(a.D.info(`returning cacheItem '[${n}]' from cache${c.shouldRefresh?", will be refreshed in background":""}. In memory:${+d} found: [${+!!c}]`),c);a.D.info(`value for key [${i}] not found in memory or storage`)}getValue(e){const t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){const t=[],n=[];return Object.keys(this.internalCache).forEach((i=>{"GLOBAL"!==i&&Object.keys(this.internalCache[i][e]||{}).forEach((a=>{const{storageKey:o}=g({},{user:i,typeName:e,key:a});n.push(o),t.push(this.internalCache[i][e][a].item)}))})),Object.keys(this._storage).forEach((i=>{if(-1===n.indexOf(i)&&-1===i.indexOf(".GLOBAL.")&&-1!==i.indexOf(`.${e}.`))try{const e=this._storage.getItem(i);e&&t.push(JSON.parse(e)?.item)}catch(e){a.D.error(`value for key [${i}] throw error. ${(0,o.Nw)(e)}`)}})),t}del(e){if(!e)return a.D.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return a.D.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;const t=p(e),{loggingKey:n}=g(e,t),{typeName:i,key:o,user:r}=t;this.internalCache[r]?.[i]?.[o]&&a.D.info(`Value of key: [${n}] exists before deletion]`);const s=this.internalCache[r]?.[i]?.[o]&&delete this.internalCache[r][i][o],l=this._deleteFromExternalCache(e);return a.D.info(`deleted from local auth-cache. key: [${n}], done - local: [${s}], storage: [${l}]`),s}delTokensWithError(e,t){const{user:n,typeName:i}=p({user:e,typeName:"Token"});if(this.internalCache[n]?.[i]){const a=this.internalCache[n][i];for(const n in a)a[n]?.item?.error?.errorCode===t&&this.del({user:e,typeName:i,key:n})}}deleteType(e,t){const{user:n,typeName:i}=p({user:e,typeName:t});if(this.internalCache[n]?.[i]){let t;if("Token"===i)t=this.internalCache[n][i];else{if("Discover"!==i)return;t=this.internalCache[n][i]}for(const n in t)n&&this.del({user:e,typeName:i,key:n})}}flush(e){if(!e){a.D.info("no user provided, flushing global user from cache");const t=this.internalCache.GLOBAL?.User?.User;if(!t)return;e=(0,r.X_)(t.item)}a.D.info(`flushing user ${e.id} data from cache`);const t=u(e);this.internalCache[t]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),a.D.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){if(!["Discover","Token"].includes(t)||!e.item)return;const n=e.item,i=f(t,n);if(e.refreshAfter&&this.refreshPercents)return b(S(),e.refreshAfter,i,this._expireOffsetSecondsMin);if(n&&i){const e=i-this._expireOffsetSeconds,t=i-this._expireOffsetSecondsMin,n=S();if(n<=t)return n>=e}}get refreshPercents(){const e=this._coreSettings?.("proactiveTokenRefreshPercents");return Number(e??0)}}const v=e=>{if(!(-1===["Token","Discover"].indexOf(e.typeName)||e.key&&e.user))throw new Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},y=(e,t)=>d||(d=new h(e,t),e.localStorage?.getItem("localDebug")&&e.loader&&(e.loader.authCache=d),d);function S(){return Math.round(Date.now()/i.zB.MILLI_PER_SECOND)}function f(e,t){return"Discover"===e?Math.round(t?.expiration/i.zB.MILLI_PER_SECOND):"Token"===e?t?.expires:void 0}const k=i.zB.SECONDS_PER_MINUTE*i.FQ.TEN;function C(e,t,n=.67){const i=t-e,a=e+Math.round(i*n),o=t-k;return Math.min(a,o)}function b(e,t,n,a=i.zB.SECONDS_PER_MINUTE){return!n||n<e+a?void 0:t<e}},50737:(e,t,n)=>{"use strict";n.d(t,{Xr:()=>a,bV:()=>o,O4:()=>r});var i=n(81670);const a=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"},meetingDetails:{user:e,typeName:"MeetingDetails"},telemetryInfo:{user:e,typeName:"TelemetryInfo"}}),o=(e,t,n)=>({user:e,typeName:"Token",key:`${t}${n?`-external-${n}`:""}`}),r={addAccountsSuggestionCoachMarkTimeStamp:{typeName:"addAccountsSuggestionCoachMarkTimeStamp"},logoutState:{typeName:i.QF},authSessionId:{typeName:i.ct},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"},previousSignInProgressState:{typeName:"PreviousSignInProgressState"},ropcLogoutState:{typeName:"RopcLogoutState"}}},235855:(e,t,n)=>{"use strict";n.d(t,{X4:()=>h,hl:()=>v,zR:()=>y,pz:()=>S,Dp:()=>f,xN:()=>k,x$:()=>C,VM:()=>b,Rr:()=>T,IO:()=>I});var i=n(99425),a=n(329809),o=n(702183),r=n(667606),s=n(899855),l=n(81670),c=n(710225),d=n(235133),u=n(736626),m=n(176737),p=n(50737),g=n(270560);const h=(e,t,n)=>{const i=S(e,t,n);return{...i,message:i.message,stack:i.stack,errorMetaData:{accountId:t?.result?.profile?.id,name:t?.result?.profile?.displayName,email:t?.result?.profile?.email}}},v=(e,t)=>{const n=t?.("buildCloud")||"",a=e.extraQueryParameters?.tenantId,o=A(a,e.domainHint||n,t),r=e.extraQueryParameters?.accountType||i.aS.Aad;return{correlation:e.correlation,silent:e.silent,extraQueryParameters:{...e.extraQueryParameters,authority:o},userIdentifier:{accountType:r,tenantId:a,id:e.accountId||"",userName:"",oid:""}}},y=e=>e.accountId&&e.extraQueryParameters?.tenantId,S=(e,t,n)=>{const i=t.isExpected||t.message?.includes("657rv")||t.errorMessage?.includes("657rv")||!1;return(0,r.$5)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:t?.errorMessage||t.message||"ErrorMessageMissing",isExpected:i,correlationId:n.id})},f=(e,t,n)=>{const{accountId:i,correlation:o,prompt:r,loginHint:s,extraQueryParameters:l,windowId:c}=e,u=!!n?.("enableRopcFlow"),m={accountId:i,correlationId:o.id,domainHint:n?.("enableAad")?n?.("enableMultiCloud")?void 0:a.Zr.prod:a.Zr.life,extraQueryParameters:(0,d.pj)(l),loginHint:s,silent:"none"===r,windowId:c,useRopcFlow:u};return t.addEventData([`nativeArgs:{domainPresent:${m.domainHint}`,`extraParams:${m.extraQueryParameters?.length}`,"idPresent:"+ +!!m.accountId,"loginHintPresent:"+ +!!m.loginHint,`silent:${m.silent}`,`useRopcFlow:${m.useRopcFlow}}`]),m},k=(e,t,n,i)=>{const a=C(t.userIdentifier);if(!t.extraQueryParameters?.authority&&i?.("enableSetAuthorityAlways")){const e=t.tenantId||a.tenantId,n=i?.("buildCloud")||"",o=A(e,n,i);t.extraQueryParameters=t.extraQueryParameters||{},t.extraQueryParameters.authority=o}const o={resource:e,correlationId:t.correlation.id,accessTokenToRenew:t.accessTokenToRenew,claim:t.claim,silent:t.silent??"login"!==t.prompt,userIdentifier:a,tenantId:t.tenantId,extraQueryParameters:(0,d.pj)(t.extraQueryParameters),windowId:t.windowId};return n.addEventData(["nativeArgs:{","accessTokenPresent:"+ +!!o.accessTokenToRenew,"claimPresent:"+ +(0,d.uY)(t.claim),"idPresent:"+ +!!a?.id,`silent:${o.silent}`,"userToUse:"+ +!!a,"externalTenant:"+ +!!o.tenantId,"}"]),o},C=e=>({id:e.id,tenantId:e.tenantId,oid:e.oid,upn:e.userName}),b=(e,t,n)=>{let a;c.D.info("Getting user profile");const o=e.extendedProperties?.find((e=>"acct"===e.name));let r;o&&(a=+o.value);try{r=e.profile.id||(e.profile.oid.startsWith("000")?e.profile.oid.replace(/[0-]/g,""):e.profile.oid)}catch{r=e.profile.oid}const s=e.extendedProperties?.find((e=>"isCrossCloudUser"===e.name)),l=N(e,s?.value),u={tenantId:e.profile.tenantId,oid:e.profile.oid,accountType:(0,d.TF)(e.profile.tenantId),userName:e.userName,id:r};m.Vh.put((0,p.Xr)(u).telemetryInfo,{isCrossCloudUser:l});const g=w(e,!!t?.("enableMTO"),!!t?.("enableCCM"));let h=1===a?i.a7.Guest:i.a7.Member;g===i.as.Ccm&&(h=i.a7.Anonymous);const v=e.profile.isHomeAccount?r:(0,d.xq)(e);return{id:r,userName:e.userName||e.profile.email,profile:{acct:a,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile.email,family_name:"",given_name:e.profile.displayName,iat:1,iss:"",name:e.profile.displayName,preferred_username:e.userName||e.profile.email,nbf:-1,nonce:"",oid:e.profile.oid,onprem_sid:"",sub:"",tid:e.profile.tenantId,unique_name:e.profile.displayName,upn:e.profile.email,ver:"1.0",isHomeAccount:e.profile.isHomeAccount},isAuthenticated:!1,type:(0,d.TF)(e.profile.tenantId),cloud:(0,d.xb)(e,t,n,r,v),homeAccountId:v,role:h,subType:g}},w=(e,t,n)=>{let a=i.as.Default;if(t||n){const r={id:(0,u.DA)(),scenarioName:o.Cu.AuthGetUserSubType,source:"core-auth::getUserSubType"},[c,d]=(0,s.we)({options:{correlation:r},subContext:"auth-helper::getUserSubType",scenarioName:o.Cu.AuthGetUserSubType,source:"core-auth::getUserSubType"}),m=e.extendedProperties?.find((e=>e.name===l.bw));if(m){const e=t&&m.value.indexOf(l.Xz)>-1,o=n&&m.value.indexOf(l.Oi)>-1;e?a=i.as.Mto:o&&(a=i.as.Ccm)}d({reason:"Extended properties wids claim check done.",userSubType:a},"success")}return c.D.log(`User subType set to ${a}, enableMTO: ${t}`),a},T=e=>({token:e.result.token,idToken:e.result.idToken,expires:e.result.expires,fromCache:!1,account:e.result.account}),I=e=>e.errorCode===l.Cd.ApiContractViolation&&e.message.includes(l.Cd.UiAlreadyShowing),N=(e,t)=>{if(!e.homeAccountId)return!1;if(e.profile.id===e.homeAccountId)return!1;const n=(0,g.K_)(e.homeAccountId,void 0);return(!n||e.profile.sovereignty!==i.Av.gcc||n.cloud!==i.el.prod)&&"1"===t},A=(e,t,n)=>`${(0,d.kR)(t,n)}${e}`},585542:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i});const i=e=>!!e?.chrome?.webview},235133:(e,t,n)=>{"use strict";n.d(t,{nt:()=>h,O0:()=>y,al:()=>S,ge:()=>f,i3:()=>k,Jk:()=>C,rF:()=>b,xq:()=>w,YH:()=>T,TF:()=>I,kR:()=>N,xb:()=>A,nJ:()=>E,gP:()=>_,M_:()=>D,X_:()=>x,oh:()=>L,pj:()=>O,oF:()=>j,Z0:()=>B,gn:()=>U,mq:()=>$,ce:()=>W,kO:()=>V,ni:()=>H,TK:()=>z,bE:()=>q,P9:()=>G,uY:()=>Y,rA:()=>Q,RU:()=>J,XQ:()=>Z,Iw:()=>X,V6:()=>oe,BR:()=>ce,eN:()=>ue,li:()=>me,QO:()=>pe,QB:()=>ge});var i=n(364819),a=n(99425),o=n(455051),r=n(329809),s=n(710225),l=n(81670),c=n(176737),d=n(667606),u=n(736626),m=n(50737),p=n(270560),g=n(235855);const h="9188040d-6c67-4c5b-b112-36a304b66dad";var v;!function(e){e.Otp="mail",e.GFed="google.com"}(v||(v={}));const y=({type:e,profile:t})=>(e===a.aS.Otp||e===a.aS.GFed||t.idp===v.Otp||t.idp===v.GFed)&&t.tid===l.xD.services,S=({cloud:e,profile:t},n)=>e===a.el.life&&t.tid===l.J&&n===a.el.prod;function f(e,t){return void 0!==t&&e!==t}const k=e=>(s.D.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor((new Date).setMinutes(l.FQ.FIFTEEN)/l.zB.MILLI_PER_SECOND),fromCache:!0}),C=(e,t)=>{if(!e)return"";const n=t?.("instanceUrl"),i=n?`${n}${e??"common"}`:"";return s.D.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${i}`),i},b=(e,t,n,i)=>{const a=t?.profile.tid||n||e?.tenantId;if(a&&(t||i||e?.isAnonEligible&&e?.isAnonRestrictionSatisfied))return T(a,void 0,t)},w=e=>{const t=e.homeAccountId,n=t?.split(".")[0];return n?.startsWith("00000000-0000-0000")?n.replace("00000000-0000-0000-","").replace("-",""):n},T=(e,t,n,i)=>{s.D.info("Anon flow - anonymous user created");const o=`anon.${t=t||(e===l.J?a.el.life:a.el.prod)}.${e}.${i}`;return{id:o,isAuthenticated:!0,userName:n?.userName||"anonymous",profile:{oid:L(o),tid:e,upn:n?.profile?.upn||"",puid:""},role:a.a7.Anonymous,type:a.aS.Anonymous,homeAccountId:o,cloud:n?.cloud||t,subType:a.as.Default}},I=e=>e===o.lV?a.aS.MsaLife:a.aS.Aad,N=(e,t)=>{if(!e)return l.p2;const n=t?.("cloudAuthorityMap")??l.Pj,i=n.find((t=>t.cloud.toString()===e))?.authority;return i||l.p2},A=(e,t,n,i,o)=>{if(I(e.profile.tenantId)===a.aS.MsaLife)return a.el.life;if(t?.("enableMTMAAuthDataInMaglevStorage")){const a=e.profile.sovereignty;if(o===i)return F(a);if(n)return n;const r=e.profile.environment;return E(r,e.profile.tenantId,t)}{const t=e.profile.sovereignty;return F(t)}},E=(e,t,n)=>{if(t===h)return a.el.life;switch(e){case a.nb.prod:return a.el.prod;case a.nb.gallatin:return a.el.gallatin;case a.nb.airgap08:return a.el.airgap08;case a.nb.airgap09:return a.el.airgap09;case a.nb.gov:const e=n?.("buildCloud");return e;default:return a.el.prod}},F=e=>{switch(e){case a.Av.prod:case a.Av.gcc:return a.el.prod;case a.Av.gcch:return a.el.gcch;case a.Av.dod:return a.el.dod;case a.Av.ag08:return a.el.airgap08;case a.Av.ag09:return a.el.airgap09;case a.Av.gallatin:return a.el.gallatin;default:return a.el.prod}},_=e=>{switch(e){case a.el.prod:return r.Zr.prod;case a.el.life:return r.Zr.life;case a.el.gcch:return r.Zr.gcch;case a.el.dod:return r.Zr.dod;case a.el.airgap08:return r.Zr.airgap08;case a.el.airgap09:return r.Zr.airgap09;case a.el.gallatin:return r.Zr.gallatin;default:return r.Zr.prod}},D=(e,t,n,o)=>t?.subType===a.as.Ccm?t:!t||(0,i.isEmpty)(t.profile)||t.role===a.a7.Anonymous||t.userRole===l.FQ.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&o?(s.D.info("checking anon flow"),b(e,t,n,o)):(t.role=t.role===a.a7.Guest||1===t.profile?.acct?a.a7.Guest:a.a7.Member,P(t),M(t),R(t)),P=e=>{if(e.profile?.tid===o.lV)return void(e.type=a.aS.MsaLife);const t=[a.aS.Msa,a.aS.Otp,a.aS.GFed];if(e.type&&-1!==t.indexOf(e.type))return;let n=0===e.profile?.altsecid?.indexOf("1:")?a.aS.Msa:a.aS.Aad;e.profile?.idp&&e.profile?.iss!==e.profile.idp&&(n=e.profile.idp===v.Otp?a.aS.Otp:n,n=e.profile.idp===v.GFed?a.aS.GFed:n),0===e.profile?.altsecid?.indexOf("1:")&&e.cloud===a.el.prod&&e.profile?.tid&&e.profile.tid!==l.xD.services&&(n=a.aS.Aad),e.type=n},M=e=>{e.type!==a.aS.MsaLife?e.cloud&&e.cloud!==a.el.prod||(e.cloud=a.el.prod):e.cloud=a.el.life},R=e=>(e.profile.oid=e.profile.oid||L(e.profile.tid),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=a.as.Default),s.D.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e),x=e=>{if(!e)throw new Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},L=e=>`8:defaultOid:${e}`,O=e=>{const t=[];for(const n in e)Object.hasOwnProperty.call(e,n)&&e[n]&&t.push({name:n,key:n,value:"string"==typeof e[n]?e[n]:(0,u.hR)(e[n])});return t},j=(e,t)=>{t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");const n=(0,p.K_)(e,void 0);if(n)return t.addScenarioMark("auth_update_global_user_foundUser"),c.Vh.updateGlobalUser(n);throw t.addScenarioMark("auth_update_global_user_noUserFound"),i=t.correlation?.id,(0,d.$5)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:i,errorCode:l.tG.UserNotFoundError,message:"Cannot update global user ude to missing user"});var i},B=e=>e?e?.id?e?.id:`${e?.oid}-${e?.tenantId}`:"unknown user",U=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),$=(e,t,n)=>{const i=new CustomEvent(t,{detail:n});e?.dispatchEvent?.(i)},W=(e,t,n,i,a)=>{const o=D(e,t,i,a);return o&&(s.D.info(`[auth-helper][getMappedUserAndSetItToCache][${n}] put user in cache.`),c.Vh.put((0,m.Xr)(x(o)).user,o)),o},V=(e,t,n,i)=>{if(l.Ib(e))throw i.addEventData(["scope_invalid:1"]),s.D.warn(`[core-auth-base][acquireToken][${n.source}][${n.id}] invalid scope. resource: [${e}]`),(0,d.$5)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${t?.id}-${t?.oid}-${t?.tenantId}] sent from invalid resource: ${e}`,errorCode:l.tG.InvalidScopeResource,isExpected:!0,correlationId:n.id})},H=(e,t,n,i,a)=>(i.push("user_missing"),(0,d.$5)({context:"core-auth-base",subContext:e,errorCode:l.tG.UserNotFoundError,isExpected:n,message:`request sent with [${t}] failed as user not found`,innerError:new Error("User Null or empty"),correlationId:a})),z=(e,t,n,i)=>(0,d.$5)({context:"core-auth-base",subContext:e,errorCode:l.tG.UnsupportedParameter,isExpected:n,message:`${t} parameter is not currently supported`,innerError:new Error(`${t} parameter is not currently supported`),correlationId:i});const q=(e,t,n,i,a,o)=>{i?.push(`errorCode:${t?.errorCode||"undefined"},errorMessage:${t?.message||"undefined"}`),i&&i.length>0&&i.push("$");const r=function(e,t,n="",i,a){return{contentType:n,context:"core-auth-base",correlationId:t?.correlationId,endpointUrl:a||"unset",errorCode:t?.errorCode||"AcquireToken Error",innerError:t,isExpected:t?.isExpected,message:(0,u.Nw)(t),reason:i?.join(";")||"",subContext:e}}(e,t,a,i,o),c=r.errorCode.includes(l.tG.InvalidScopeResource)||r.message?.includes(l.tG.InvalidScopeResource)||r.isExpected||r.innerError?.isExpected;return c?s.D.warning(`Error found ${(0,u.Nw)(t)}`):s.D.error(`Error found ${(0,u.Nw)(t)}`),c?n?.incomplete(r):n?.fail(r),r},G=JSON.stringify({access_token:{xms_cc:{values:["CP1"]}}}),Y=e=>!(!e||e===G),Q=(e,t,n,i,a)=>(n.tflClaim&&(n.accessTokenToRenew=n.tflClaim),void 0===n.prompt&&void 0===n.silent&&(!n.accessTokenToRenew&&!Y(n.claim)||i?.("disablePromptFor401")&&!((e,t)=>{const n=t?.("enablePromptResourcesFor401")||[];return!(!e||!n)&&Array.isArray(n)&&n.findIndex((t=>e.includes(t)))>-1})(e,i)?(n.prompt="none",n.silent=!0):(n.prompt="login",n.silent=!1)),a&&!n.accessTokenToRenew&&(n.forceRenew||!1===n.silent||"login"===n.prompt)&&(s.D.info("[core-auth-base][acquireToken] force renewing."),n.accessTokenToRenew=a.item.token),t.addEventData(["cacheToken:"+ +!!a,"tflClaim:"+ +!!n.tflClaim,"accessTokenToRenew:"+ +!!n.accessTokenToRenew,"forceRenew:"+ +!!n.forceRenew,`prompt: ${n.prompt}`,"silent:"+ +!!n.silent]),a?.item?.error?.errorCode&&t.addEventData([`errorInToken:[${a?.item?.error?.errorCode||""}]`]),n),J=async(e,t,n,i,o,r)=>{const u=r?.("buildCloud"),m=r?.("enableMultiCloud"),p=r?.("enableCCM"),g=r?.("enableRefreshTenantsForGuestDeeplink");if(s.D.log(`starting cloud misMatch check. Env: ${n}, buildCloud: ${u}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`),ee(e,r)){const t=await le(e,o.correlation,i);return Promise.reject(t)}if(!e.cloud||!u||e.cloud===u&&e.subType!==a.as.Ccm)return s.D.log("No cloud mismatch detected."),t.addEventData(["cloudMismatch:0"]),e;const h=((e,t)=>{const n=t?.("enableMSAGuest"),i=t?.("enableTFLOnT21");return n&&!i&&e.cloud===a.el.life})(e,r);if(t.addEventData(["cloudMismatch:1","isMsaGuest:"+ +!!h,"enableCCM:"+ +!!p,"meetingDetails:"+ +!!o.meetingDetails]),h){t.addScenarioMark("msa_flow_start");const n=await te(e,o,i,t,u,r);if(n)return n}if(g&&o.extraQueryParameters?.isNewGuestUser){t.addScenarioMark("try_login_to_new_tenant_start");const n=await K(e,o,i,t,u,r);if(n)return n}if(p&&o.meetingDetails){t.addScenarioMark("ccm_flow_start");const n=await ne(e,o,i,t,u,o.meetingDetails,r);if(n)return n}if(m){t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${n}, enableMultiCloud: ${m}, buildCloud: ${u}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`});const a=await re(e,o.correlation,i);return Promise.reject(a)}c.Vh.del({user:x(e),typeName:"User"}),i.removeWebActiveUser?.();const v=await(0,d.pz)({name:l.tG.CloudMismatchNoMultiCloud,message:"cloud mismatch, reboot required",correlationId:o.correlation.id,context:"Login",subContext:"checkForCloudMismatch",errorCode:l.tG.CloudMismatchNoMultiCloud,isExpected:!0});return Promise.reject(v)},K=async(e,t,n,i,a,o)=>{try{const r=await ie(e,t,n,t.extraQueryParameters?.tenantId,a,o),s=ae(r,o);if(i.addEventData(["account:"+ +!!s,`sub:${s?.subType}`,`buildCloud:${a}`,`userCloud:${s?.cloud}`]),s)return i.addEventData(["newCcgaUser:1"]),i.addScenarioMark("try_login_to_new_tenant_end"),s;i.addScenarioMark("try_login_to_new_tenant_end")}catch(e){i.addScenarioMark("try_login_to_new_tenant_end",e)}},Z=(e,t,n,i)=>{if(i?.("disableCrossCloudMeetingBlock")||!t)return;const a=t.includes("teams.live.com"),o=!(a||t.includes("teams.microsoft.com")),r=!("life"===e.cloud||"prod"===e.cloud);if(o&&"life"===e.cloud||r&&a)throw(0,d.pz)({message:"User attempted to join an invalid cross cloud meeting",name:"",errorCode:"InvalidMeeting",correlationId:n.correlation.id,context:"account-selection-dialog-renderer",subContext:"onItemClick",authSubErrorCode:"GenericAuthError"})},X=(e,t)=>{t?.("enableWebTflMsaGuestFlow")&&(e?.profile?.altsecid?.indexOf("1:live")<0||"prod"!==e.cloud||c.Vh.put((0,m.Xr)(x(e)).userAuthState,{state:a.p8.Up,reason:"",visibilityState:a.cy.Shown}))},ee=(e,t)=>{if(e.cloud!==a.el.life||!t?.("enableMultiMsaRoadBlock")||!t?.("enableTFLOnT21"))return!1;return!!c.Vh.getAllOfType("User").find((t=>t.id!==e.id&&t.cloud===a.el.life&&t.type!==a.aS.Anonymous))},te=async(e,t,n,i,o,r)=>{try{const s=await ie(e,t,n,l.xD.services,o,r),d=s.webAccount??ae(s,r),u=!!r?.("enableWebTflMsaGuestFlow");if(i.addEventData(["msa-account:"+ +!!d]),i.addScenarioMark("msa_flow_end"),d){u&&(d.id=d.homeAccountId??d.id);const e=await ue(d,i.correlation,n);return c.Vh.put((0,m.Xr)(x(d)).userAuthState,{state:a.p8.Unknown,customError:{errorCode:e.errorCode,isExpected:e.isExpected,message:e.message,context:e.context,subContext:e.subContext,correlationId:e.correlationId,errorMetadata:e.errorMetaData},reason:"MsaUserNotAllowed"}),u||(d.homeAccountId=d.id),d.type=a.aS.Msa,d}}catch(e){i.addScenarioMark("msa_flow_end",e)}},ne=async(e,t,n,i,o,r,s)=>{if(e.subType===a.as.Ccm)return de(e,i,r,e.profile.name);try{const l=await ie(e,t,n,r.tenantId,o,s),c=ae(l,s);if(i.addEventData(["account:"+ +!!c,`sub:${c?.subType}`]),c)return c.subType===a.as.Ccm?de(c,i,r,e.profile.name):(i.addEventData(["ccgaUser:1"]),c);i.addScenarioMark("ccm_flow_end")}catch(e){i.addScenarioMark("ccm_flow_end",e)}},ie=async(e,t,n,i,a,r)=>{const s=`${N(a,r)}${i}`,l=r?.("mtResource")||o.fP.MT;return await n.acquireToken(l,{correlation:t.correlation,silent:t.silent,userIdentifier:x(e),extraQueryParameters:{authority:s}})},ae=(e,t)=>e&&e.account?(0,g.VM)(e.account,t):void 0,oe=async(e,t,n)=>new Promise((async i=>{if(e.length<=0)return i({count:0,failure:[]});let a=0;const o=[];for(const r of e){a++;try{const n=t(r);await n,a>=e.length&&i({count:a,failure:o})}catch(t){o.push(a),n?.(t,a,r),a>=e.length&&i({count:a,failure:o})}}})),re=async(e,t,n)=>(0,d.pz)({errorMetaData:await se(e,t,n),authSubErrorCode:"MultiCloudMismatch",name:l.tG.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t.id,errorCode:l.tG.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0}),se=async(e,t,n)=>{const i=await(n.getUserImage?.({id:e.id,correlation:t}))||"";return{cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:i}},le=async(e,t,n)=>(0,d.pz)({errorMetaData:await se(e,t,n),authSubErrorCode:"MultiCloudMismatch",name:l.tG.MultiMSARoadBlock,message:"MultiMSARoadBlock Detected",context:"Login",correlationId:t.id,errorCode:l.tG.MultiMSARoadBlock,subContext:"MultiMSARoadBlock",isExpected:!0}),ce=(e,t,n,i)=>{Y(n)&&e.addEventData([`isSameToken: ${i===t.token}`]);const a=(e=>{const t=(e-Math.floor((new Date).getTime()/l.zB.MILLI_PER_SECOND))*l.zB.MILLI_PER_SECOND/l.zB.ONE_MINUTE;return Math.floor(t)})(t.expires);e.addEventData([`tokenLifeTime: ${a}`,`fromCache: ${t.fromCache}`])},de=(e,t,n,i)=>(t.addEventData(["ccmUser:1"]),e.id=`${e.id}_${n.conversationId}`,e.type=a.aS.Anonymous,e.profile.name=i,c.Vh.put((0,m.Xr)(x(e)).meetingDetails,n),t.addScenarioMark("ccm_flow_end"),e),ue=async(e,t,n)=>{const i=await(n.getUserImage?.({id:e.id,correlation:t}))||"",a={cloud:e.cloud,accountId:e.id,email:e.profile.email||e.userName,name:e.profile.name,pictureBlob:i};return(0,d.pz)({errorMetaData:a,authSubErrorCode:"MsaUserNotAllowed",name:l.tG.CloudMismatch,message:"msa user Detected",context:"Login",correlationId:t.id,errorCode:l.tG.MsaUserNotAllowed,subContext:"msaUserNotAllowedError",isExpected:!0})},me=e=>({id:`dummy-user-${e.profile?.tid}-${e.homeAccountId}`,userName:e.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile?.email,family_name:"",given_name:e.profile?.given_name,iat:1,iss:"",name:e.profile?.name,preferred_username:e.userName||e.profile?.email,nbf:-1,nonce:"",oid:`dummy-user-${e.profile?.tid}`,onprem_sid:"",sub:"",tid:e.profile?.tid,unique_name:e.profile?.unique_name,upn:e.profile?.email,ver:"1.0",isHomeAccount:!1},homeAccountId:e.homeAccountId||e.id,isAuthenticated:!1,type:a.aS.Aad,cloud:e.cloud,role:e.role}),pe=(e,t)=>!t.some((t=>t.cloud===e)),ge=(e,t)=>{const n=t?.("cloudAuthorityMap");if(!n||!e)return;const i=e.split("/");if(i.length<4)return;const r=i?.[2],s=i?.[3];if(s&&s===o.lV)return a.el.life;const l=n.find((e=>e.authority===`https://${r}/`))?.cloud,c=t?.("buildCloud");return c!==a.el.dod&&c!==a.el.gcch||"dod"!==l&&"gcch"!==l?l?a.el[l]:void 0:c}},509387:(e,t,n)=>{"use strict";n.d(t,{J:()=>a,X:()=>o});var i=n(614979);const a=e=>i.Buffer.from(e).toString("base64"),o=e=>i.Buffer.from(e,"base64")},408605:(e,t,n)=>{"use strict";function i(e){const t={};return(n,...i)=>{try{let a=t[n];return a||(a=t[n]=e(...i).then((e=>(delete t[n],e))).catch((e=>{throw delete t[n],e}))),a}catch(e){throw e}}}n.d(t,{A:()=>i})},994915:(e,t,n)=>{"use strict";n.d(t,{lZ:()=>l,cR:()=>c,sG:()=>d,Rq:()=>u,Ni:()=>m,KD:()=>p,O8:()=>g,TE:()=>h,oQ:()=>v});var i=n(99425),a=n(270560),o=n(176737),r=n(50737),s=n(235133);const l=e=>o.Vh.getValue((0,r.Xr)((0,s.X_)(e)).userAuthState),c=e=>{if(!e)return;const t=(0,a.K_)(e,void 0);if(!t||!t.homeAccountId||t.homeAccountId===t.id)return t;return(0,a.K_)(t.homeAccountId,void 0)},d=(e,t)=>{if(!e||!t)return;return o.Vh.getAllOfType("User").find((n=>n.homeAccountId===e&&n.profile.tid===t))},u=()=>o.Vh.getAllOfType("User")?.filter((e=>g(e)&&!p(e)))?.[0],m=e=>{let t=(0,a.K_)(e,void 0);if(e||!t)return t;if(t.homeAccountId!==t.id){t=(0,a.K_)(t.homeAccountId,void 0)||t}return t},p=e=>!(!e||!e.homeAccountId||e.homeAccountId===e.id),g=e=>e.type!==i.aS.Anonymous&&!e.id.startsWith("dummy-user-"),h=e=>{const t=o.Vh.getAllOfType("User")?.filter(Boolean)?.filter((t=>g(t)&&t.cloud===e)),n=t?.filter((e=>!p(e)));return n?.[0]||t?.[0]},v=e=>({message:`user for id: '${e}' not found. if id is undefined, global user should return`,errorCode:"NoAccountFoundForLogout",isExpected:!0,context:"get-user-utilities",subContext:"getUserForLogout",correlationId:"",name:"NoAccountFoundForLogout"})},252251:(e,t,n)=>{"use strict";n.d(t,{x:()=>g});var i=n(99425),a=n(667606),o=n(736626),r=n(235133),s=n(81670),l=n(710225),c=n(405161),d=n(364819);let u,m,p;function g(e,t,n,i){if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{p=!0},disable:()=>{p=!1},setConfig:h}}),function(e,t){u||(u={});u[t]=e}(e,t),p=i,p){try{m="string"==typeof n?{...m,...JSON.parse(decodeURIComponent(n))}:{...m,...n}}catch(e){l.D.warning(`[MOCK-API] cannot parse config: ${n}`)}v(e,t)}else m={}}function h(e,t={}){m||(m={}),m[e]=t;const n=e.split(".")[0];v(u?.[n],n)}function v(e,t){Object.getOwnPropertyNames(m).filter((e=>e.startsWith(`${t}.`))).map((e=>e.replace(`${t}.`,""))).forEach((n=>{const i=Object.getOwnPropertyDescriptor(e,n)?.value||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),n)?.value,a=m?.[`${t}.${n}`];a&&a.delay&&a.delay>0?Object.defineProperty(e,n,{configurable:!0,value:async(...o)=>{if(p){if(l.D.warning(`[MOCK-API] returning delayed mocked response for ${t}.${n}`),a&&a.delay){const e=void 0!==a.delay?a.delay:0;await new Promise((t=>(0,d.delay)(t,e)))}return y(t,n)||i.apply(e,o)}return i.apply(e,o)}}):Object.defineProperty(e,n,{configurable:!0,value:(...a)=>p?(l.D.warning(`[MOCK-API] returning mocked response for ${t}.${n}`),y(t,n)||i.apply(e,a)):i.apply(e,a)})}))}function y(e,t){const n=m?.[`${e}.${t}`];if(n&&n.error)throw function(e,t,n){return(0,a.pz)({name:e?.name||"",context:e?.context||t,subContext:e?.subContext||n,reason:e?.reason,errorCode:e?.errorCode||"ErrorCodeNotFound",correlationId:e?.correlationId||(0,o.DA)(),isExpected:e?.isExpected||!1,message:e?.message||`[MockApi][${t}][${n}]`,authSubErrorCode:e?.authSubErrorCode,errorMetaData:e?.errorMetaData,serverResponse:e?.serverResponse})}(n.error,e,t);if(n&&n.success){const e=function(e){switch(e){case"aquireToken":return f;case"user":return S();case"hostMachineUsers":return[k];case"users":return[S()];case"emptyList":return[]}return{}}(n.success.defaultValue);return Array.isArray(e)?n.success.returnValue?Array.isArray(n.success.returnValue)?[...e,...n.success.returnValue]:[...e,n.success.returnValue]:e:{...e,...n.success?.returnValue}}}const S=()=>(0,r.M_)(new c.c("https://test.msft.com"),{userName:"TestUserName@email.com",role:i.a7.Member,profile:{name:"Test",oid:(0,r.oh)("123456789"),tid:"123456789"}}),f={token:"TestToken",expires:Date.now()+s.zB.SECONDS_FIVE_MINUTES,fromCache:!1},k={accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}},405161:(e,t,n)=>{"use strict";n.d(t,{c:()=>o,i:()=>c});var i=n(81670),a=n(710225);class o{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"!=typeof e?t:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach((e=>{const n=e.replace(/\+/g," ").split("=");let i=n.shift();const o=n.length>0?decodeURIComponent(n.join("=")):null;if(i){if(i=decodeURIComponent(i),"context"===i&&0===o?.indexOf("{"))try{const e=JSON.parse(o);for(const t in e)!e.hasOwnProperty(t)||"tid"!==t.toLowerCase()&&"tenantid"!==t.toLowerCase()||(this._tid=e[t]);t={...t,...e}}catch(e){a.D.error(e)}if(Object.prototype.hasOwnProperty.call(t,i))Array.isArray(t[i])?t[i].push(o):t[i]=[t[i],o];else{t[i]=o;const e=i.toLowerCase();!o||"tid"!==e&&"tenantid"!==e||(this._tid=o)}}})),t):t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw new Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){const e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));const n=this._hash.indexOf("?");n>=0&&(this._search=this._hash.substr(n))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);const t=r(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?i.J:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){const e=new URL(this._currenttUrl.href);return this.isLocal?(e.port?e.port="":e.port="8080",e.href):(0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href)}get hasPostMessageAgent(){return"postmessage"===this._queryStrings.agent?.toLowerCase()}}const r=e=>{if(!l)return[!1,!1];for(const t of l)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,s(t,e.href)];return[!1,!1]},s=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const n of e.restrictions)if(t.indexOf(n)>-1)return!0;return!1};let l=[];const c=e=>{e&&(l=e)}},913895:(e,t,n)=>{"use strict";var i,a;n.d(t,{k:()=>i,n:()=>a}),function(e){e.Up="Up",e.InteractionRequired="InteractionRequired",e.AADReconnecting="AADReconnecting",e.SkypeReconnecting="SkypeReconnecting",e.LicenseError="LicenseError",e.SignInRestriction="SignInRestriction"}(i||(i={})),function(e){e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.Success="Success",e.LicenseError="LicenseError",e.SignInRestriction="SignInRestriction",e.Unknown="Unknown"}(a||(a={}))},329809:(e,t,n)=>{"use strict";var i,a,o,r,s;n.d(t,{Uh:()=>i,Zr:()=>a,F7:()=>o,C2:()=>r,bx:()=>s}),function(e){e.SUCCESS="SUCCESS",e.CANCELLED="CANCELLED",e.FAILED="FAILED",e.TIMEOUT="TIMEOUT"}(i||(i={})),function(e){e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap08="airgap08",e.airgap09="airgap09"}(a||(a={})),function(e){e.Aad="Aad",e.MsaLife="MsaLife"}(o||(o={})),function(e){e.AADReconnecting="AADReconnecting",e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.SignInRestriction="SignInRestriction",e.SkypeReconnecting="SkypeReconnecting",e.Up="Up"}(r||(r={})),function(e){e.UserDataXCloud="userdataxcloud",e.Auth="auth",e.Core="core",e.Hostcapabilities="hostcapabilities"}(s||(s={}))},662365:(e,t,n)=>{"use strict";var i;n.d(t,{Yq:()=>i}),function(e){e.authWarmLaunch="authWarmLaunch",e.authWarmLaunchAfterLoginValidation="authWarmLaunchAfterLoginValidation",e.authAnonLaunch="authAnonLaunch",e.authLoginSsoComplete="authLoginSsoComplete",e.authDisableSsoLaunch="authDisableSsoLaunch",e.authSsoAttempted="authSsoAttempted",e.authSsoSuccessful="authSsoSuccessful",e.authSsoIncomplete="authSsoIncomplete",e.authInitComplete="authInitComplete",e.authCloudMismatch="authCloudMismatch",e.authLaunchCloud="authLaunchCloud",e.authAfterLogoutLaunch="authAfterLogoutLaunch",e.authLoginPage="authLoginPage",e.authMtoUser="authMtoUser",e.authHasMtoTenant="authHasMtoTenant"}(i||(i={}))},651519:(e,t,n)=>{"use strict";n.d(t,{d:()=>i,w:()=>a});const i=e=>{const t=e.requestWindowId?`:${e.requestWindowId}`:"";return`${e.requestRendererId}${t}:${e.requestId}`},a=e=>({correlationId:e.correlationId,contextId:e.requestRendererId,context:e.hostRendererId,operationName:e.operationName,operationType:e.operationType,windowId:e.requestWindowId,queryId:e.requestId,commandSource:e.callerInfo,origin:e.component})},175170:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={activity:"14d6962d-6eeb-4f48-8890-de55454bb136",chat:"86fcd49b-61a2-4701-b771-54728cd291fb",calendar:"ef56c0de-36fc-4ef8-b417-3d82ba9d073c",channel:"2a84919f-59d8-4441-a975-2a8c2643b741",calling:"20c3440d-c67e-4420-9f80-0e50c39693df",files:"5af6a76b-40fc-4ba1-af29-8f49b08e44fd",meet:"957ed0e3-e5ca-4c82-9676-fd037185c4d8",meetForWork:"a63f7012-8cc9-42d5-99c3-e35f526fab17",communities:"3b95919f-59d8-4441-a975-2a8c2643c852",virtualConsumerEvents:"40472f6e-248f-4599-842c-ff3ed8f0ae34",store:"ac40aa4a-fef1-4896-aea2-46d1c14dbfd5",simpleCollab:"3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40",homepage:"7133fca9-0853-4e7a-bb5d-32d4e5f6020a",saved:"34b01851-c13d-4604-bb3b-5de1ecbf0288",search:"a2da8768-95d5-419e-9441-3b539865b118",assignments:"66aeee93-507d-479a-a3ef-8f494af43945",queues:"a02e4d17-af86-4ceb-9c97-4c2626eb3587",peopleApp:"7831feaf-c4c4-4669-ba64-ce4ea0b56d31",calendarM365:"5966c135-e05f-4ce0-81e0-e138fe8e9583"};i.activity,i.chat,i.channel,i.simpleCollab,i.files},309906:(e,t,n)=>{"use strict";var i;n.d(t,{X:()=>i}),function(e){e.auth="auth",e.appService="appService",e.appState="appState",e.control="control",e.database="database",e.diagnostics="diagnostics",e.endpointHealth="endpointHealth",e.graphql="graphql",e.networkState="networkState",e.supportedResolvers="supportedResolvers",e.syncEngine="syncEngine",e.tenantSwitch="tenantSwitch",e.telemetry="telemetry"}(i||(i={}))},512445:(e,t,n)=>{"use strict";n.d(t,{od:()=>T,rF:()=>I,V7:()=>N,FN:()=>A,ZB:()=>E,WA:()=>F,M_:()=>_,pk:()=>R,UO:()=>x,Og:()=>L,mt:()=>O,$x:()=>B,DZ:()=>$,vK:()=>W,mI:()=>V,QT:()=>H,V8:()=>z,KF:()=>q,oe:()=>G,ZN:()=>Y,H$:()=>Q,$8:()=>J,ll:()=>K,gp:()=>Z});var i,a=n(364819),o=n(99425),r=n(754255),s=n(854190),l=n(953730),c=n(131647),d=n(134005),u=n(446320),m=n(943982),p=n(199448),g=n(850434),h=n(455051),v=n(702183),y=n(81670),S=n(728887),f=n(667606),k=n(899855),C=n(176737),b=n(50737),w=n(235133);!function(e){e.Otp="mail",e.GFed="google.com"}(i||(i={}));const T="9188040d-6c67-4c5b-b112-36a304b66dad",I=(e,t,n,i=!1)=>{let a={};try{a=(0,d.i)().state.getSearchState()}catch{}const r=n?.profile?.tid||a.tid||a.Tid||a.tenantId||a.tenantid;if(n||e[0]&&e[1]){if(r){t.log("Anon flow - anonymous user created");const e=r===T?o.el.life:o.el.prod;return{isAuthenticated:!0,userName:n?.userName||"anonymous",profile:{oid:`8:anon:${r}`,tid:r,upn:n?.profile?.upn||"",puid:""},role:o.a7.Anonymous,type:o.aS.Anonymous,cloud:n?.cloud||e}}if(i)return t.log("Anon flow - anonymous user created without tid"),{isAuthenticated:!0,userName:n?.userName||"anonymous",profile:{oid:"8:anon:",tid:"",upn:n?.profile?.upn||"",puid:""},role:o.a7.Anonymous,type:o.aS.Anonymous,cloud:n?.cloud||o.el.prod}}t.log("non anon flow - user undefined")},N=(e,t,n,i)=>{const{enableMTO:a}=i?.get(r.w.Auth)||{},o=C.Vh.getValue((0,b.Xr)(e).regionGtm);return{method:t,url:`${`${o?.middleTier||"https://teams.microsoft.com/api/mt/part/dogfood"}${y.Qc.TENANTSV2}`}?invalidate=${+new Date(Date.now())}`,serviceName:s.p.Auth,authOptions:{account:e.id,source:"core-auth-base"},apiName:n,headers:a?{"content-type":"application/json","x-ms-client-capabilities":"x-ms-mto-enabled"}:{"content-type":"application/json"}}},A=e=>!!e&&e.status===l.nW.NOT_AUTHORIZED&&"SkypeToken"===e.headers["x-invalid-token"],E=(e,t,n,i,a,o,s)=>{const{ic3CaeResource:l,ic3NonCaeResource:c}=s?.get(r.w.Auth)??{};if("True"!==t?.headers?.[y.OF]||e!==y.oF.IC3_GATEWAY_CAE_KEY&&e!==y.oF.IC3_GATEWAY_AAD_KEY&&e!==y.oF.IC3_GATEWAY_CAE_KEY_INT&&e!==y.oF.IC3_GATEWAY_AAD_KEY_INT&&e!==l&&e!==c)return e;if(!n)return a?.addEventData(["missingWwwAuthHeader"]),e;if(!(0,S.tT)(n))return a?.addEventData(["missingStmHeader"]),e;const d=t.authOptions||{};a?.addEventData([`source:${d?.source}`]);const u=(0,S.YL)(n);switch(a?.addEventData([`highestProtocol:${u}`]),e){case y.oF.IC3_GATEWAY_CAE_KEY:case y.oF.IC3_GATEWAY_CAE_KEY_INT:case l:if(u===h.Wx.CAE)return e;break;case y.oF.IC3_GATEWAY_AAD_KEY:case y.oF.IC3_GATEWAY_AAD_KEY_INT:case c:if(u===h.Wx.AAD||u===h.Wx.CAE)return e}if(u===h.Wx.AAD)return d?.source&&(0,S.hG)(i,d.source,h.Wx.AAD),a?.appendScenarioEventData({tokenFallbackType:"CAE_to_AAD"}),a?.addEventData([`stmResource:${y.oF.IC3_GATEWAY_AAD_KEY}`,"stmFallbackWithAadToken"]),c??y.oF.IC3_GATEWAY_AAD_KEY;if(u===h.Wx.Skype){d?.source&&(0,S.hG)(i,d.source,h.Wx.Skype),a?.appendScenarioEventData({tokenFallbackType:(e===y.oF.IC3_GATEWAY_CAE_KEY||y.oF.IC3_GATEWAY_CAE_KEY_INT?"CAE":"AAD")+"_to_Skype"}),a?.addEventData(["stmResource:skype"]);const n={context:"auth-helper",subContext:"getRetryResourceForStMigration",errorCode:y.tG.FallbackWithSkypeToken,message:"Highest protocal is Skype, retry with skypeToken",correlationId:t?.headers?.correlationId,isExpected:!0};throw o?.({error:{...n,name:"authError"}}),(0,f.$5)(n)}return e},F=async(e,t,n,i,a)=>{const{buildCloud:s,enableTenantPickerForTFL:l}=a?.get(r.w.Auth)||{};if(!l||e.cloud!==o.el.life||s!==o.el.life)return;const c={tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id};let d;try{t.addScenarioMark("show_tenant_picker_for_life_tenant_fetch_start"),d=await n(c,t),t.addScenarioMark("show_tenant_picker_for_life_tenant_fetch_end")}catch(e){return void t.addEventData(["msaTenantPickerFail:1"])}if(!d||d.length<2)return;t.addEventData(["msaTenantPickerShown:1"]);const u=await D(e,t.correlation,d,i),m={state:o.p8.OnTenantPicker};throw C.Vh.put((0,b.Xr)((0,w.X_)(e)).userAuthState,{...m,reason:"TenantPickerShown"}),u},_=(e,t,n,i=!1,r=!1)=>e.subType===o.as.Ccm?e:(0,a.isEmpty)(e.profile)||!e.profile.oid&&i||e.role===o.a7.Anonymous||e.userRole===o.Mb.Anonymous||!e.isAuthenticated&&t[0]?(n.log("checking anon flow"),I(t,n,e,r)):(e.role=e.role===o.a7.Guest||1===e.profile?.acct?o.a7.Guest:o.a7.Member,P(e),M(e),e.profile.oid=e.profile.oid||`8:defaultOid:${e.profile.tid}`,!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.userRole===o.Mb.CrossCloudMeeting&&(e.role=o.a7.Anonymous,e.type=o.aS.Anonymous),n.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e),D=async(e,t,n,i)=>{const a=await i,o={cloud:e.cloud,accountId:e.id,email:e.profile.email||e.userName,name:e.profile.name,pictureBlob:a,tenants:n};return(0,f.pz)({errorMetaData:o,authSubErrorCode:"MsaUserNotAllowed",name:y.tG.CloudMismatch,message:"msa user Detected",context:"Login",correlationId:t.id,errorCode:y.tG.ShowTenantPicker,subContext:"msaUserNotAllowedError",isExpected:!0})},P=e=>{if(e.profile?.tid===T)return void(e.type=o.aS.MsaLife);const t=[o.aS.Msa,o.aS.Otp,o.aS.GFed];if(e.type&&-1!==t.indexOf(e.type))return;let n=0===e.profile?.altsecid?.indexOf("1:")?o.aS.Msa:o.aS.Aad;e.profile?.idp&&e.profile?.iss!==e.profile.idp&&(n=e.profile.idp===i.Otp?o.aS.Otp:n,n=e.profile.idp===i.GFed?o.aS.GFed:n),e.type=n},M=e=>{e.type!==o.aS.MsaLife?e.cloud&&e.cloud!==o.el.prod||(e.cloud=o.el.prod):e.cloud=o.el.life},R=(e,t)=>{if(!e.anon||!t)return[!1,!1];t=decodeURIComponent(t);for(const n of e.anon)if(n.anonUrlMatch&&t.indexOf(n.anonUrlMatch)>-1)return[!0,j(n,t)];return[!1,!1]},x=(e,t)=>{const n=new Error("Tenant has not completed redemption");return Object.assign(n,{context:"global-auth",subContext:"_performLoginForTenants",reason:"",errorCode:e,serverResponse:"",correlationId:t,isExpected:!0,innerError:""})},L=(e,t,n,i)=>{const a=i?.get(r.w.Auth).isWebClientType,o=i?.get(r.w.Auth).buildCloud||"";if(a&&o&&e.cloudType&&e.cloudType!==o){n.addEventData(["loginSkipped-crossCloudInWeb"]);const e=new Error("Cross cloud tenant login to be skipped for Web.");throw Object.assign(e,{context:"global-auth",subContext:"_performLoginForTenants",reason:"",errorCode:y.tG.CrossCloudTenantInWeb,serverResponse:"",correlationId:t,isExpected:!0,innerError:""})}},O=e=>{const t=new Error("Tenant is has not completed redemption");return Object.assign(t,{context:"global-auth",subContext:"handleGetTenants",reason:"",errorCode:y.tG.MissingRequiredFields,serverResponse:"",correlationId:e,isExpected:!0,innerError:""})},j=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const n of e.restrictions)if(t.indexOf(n)>-1)return!0;return!1},B=(e,t)=>{const{maxRetries:n,retryWindow:i,backoffTime:a,shouldRetry:o}=t,r=e=>i-(Date.now()-e);return async(...t)=>{const i=Date.now();let s=0,l=r(i),c="";for(;s++<=n&&l>0;)try{return await Promise.resolve(e.apply(e,t))}catch(e){if(o&&!o(e))throw e;if(e&&o&&o(e)&&s>=n){const t=`;All retries elapsed or retryWindow expired, RetryCount: ${s}, RemainingTime: ${l}`;throw(0,p.$5)(e.context,e.code,e.subContext?e.subContext:"",e.reason,e.message+t,e.serverResponse)}if(s>=n||r(i)<=0){c=e?.message;break}await(0,u.y)(a),l=r(i)}throw U(s,c,r(i))}},U=(e,t,n)=>(0,p.$5)("AuthRetryWithBackoff",g.O4.MaxLimitReached,"elapsed",void 0,`${t}; All retries elapsed or retryWindow expired, RetryCount: ${e}, RemainingTime: ${n}`);var $;!function(e){e.WWW_AUTHENTICATE_HEADER="www-authenticate",e.ERROR_PREFIX="error=",e.CLAIMS_PREFIX="claims=",e.INSUFFICIENT_CLAIMS="insufficient_claims"}($||($={}));const W=(e,t)=>{const n={error:void 0,claims:void 0},i=e?.[$.WWW_AUTHENTICATE_HEADER];if(!i)return n;const a=i.split(",").filter(Boolean).map((e=>e.trim()));for(const e of a){const i=e.split('"');if(3===i.length)switch(i[0].toLocaleLowerCase()){case $.ERROR_PREFIX:n.error=i[1];break;case $.CLAIMS_PREFIX:n.claims=t?i[1]:(0,m.b)(i[1])}}return n},V=e=>({id:e.id,tenantId:e.profile.tenantId,oid:e.profile.objectId,userName:e.loginUserName??"",accountType:e.type}),H=(e,t)=>{if(e?.isPartialContent&&t?.length>0){return t.filter((e=>e.tenantRelationship===y.gl.MTO)).concat(e.tenants)}return e.tenants},z=(e,t)=>{const{enableRenderingCrossCloudTenant:n,buildCloud:i}=t?.get(r.w.Auth)??{};return e.cloudType!==i&&!n},q=(e,t,n,i)=>{const a=(e=>e&&"string"==typeof e?{claim:e}:e||{})(n),[o,r]=(0,k.we)({options:a,source:e,scenarioName:v.Cu.AcquireToken,subContext:t,startWithoutScenario:!0,scenarioEventData:{accountId:i}});return[a,o,r]},G=(e,t)=>({id:`dummy-user-${e.tenantId}-${t.homeAccountId}`,userName:t.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:t.profile.email,family_name:"",given_name:t.profile.given_name,iat:1,iss:"",name:t.profile.name,preferred_username:t.userName||t.profile.email,nbf:-1,nonce:"",oid:`dummy-user-${e.tenantId}`,onprem_sid:"",sub:"",tid:e.tenantId,unique_name:t.profile.unique_name,upn:t.profile.email||t.profile.upn,ver:"1.0",isHomeAccount:!1},homeAccountId:t.homeAccountId||t.id,isAuthenticated:!1,type:e.tenantId===h.lV?o.aS.MsaLife:o.aS.Aad,cloud:e.cloudType,role:o.a7.Guest,subtype:e.tenantRelationship===y.gl.MTO?o.as.Mto:o.as.Default}),Y=(e,t,n)=>({id:t.homeAccountId,userName:t.userName,profile:{acct:0,altsecid:"",amr:[],aud:"",exp:-1,email:t.profile.email,family_name:"",given_name:t.profile.given_name,iat:1,iss:"",name:t.profile.name,preferred_username:t.userName||t.profile.email,nbf:-1,nonce:"",oid:t.homeAccountId||e.userId,onprem_sid:"",sub:"",tid:e.tenantId,unique_name:t.profile.unique_name,upn:t.userName,ver:"1.0",isHomeAccount:!0},homeAccountId:t.homeAccountId||e.userId,isAuthenticated:!1,type:e.tenantId===h.lV?o.aS.MsaLife:o.aS.Aad,cloud:n?Q(e.cloudType):e.cloudType,role:o.a7.Member}),Q=e=>{switch(e){case o.Jw.prod:case o.Jw.gcc:return o.el.prod;case o.Jw.dod:return o.el.dod;case o.Jw.gcch:return o.el.gcch;case o.Jw.gallatin:return o.el.gallatin;case o.Jw.airgap08:return o.el.airgap08;case o.Jw.airgap09:return o.el.airgap09;default:return o.el.prod}},J=(e,t,n,i,a,o)=>{const r=a?v.Cu.AuthorizeRequest:v.Cu.AcquireToken;n.correlation.scenarioName=r;const[s,l]=(0,k.we)({options:n,source:"auth-service-module",scenarioName:r,subContext:e,timeoutMs:!1===n.silent?y.zB.ONE_HOUR:void 0,scenarioEventData:{isSilent:n.silent,endpointUrl:t,stmSource:i.source},eventData:["silent:"+(void 0===n.silent?-1:+!!n.silent),"uid:"+ +!!i.userIdentifier,`scheme:${i.scheme}`],startWithoutScenario:!o,isBatch:a});return[s,l]},K=(e,t)=>{const n=e.newLogger("AuthContextChange","create-auth-task-cross-tab-callbacks");let i;return{contextChangePost:e=>(n.debugToTelemetry?.(`Sent auth context changed cross tab message: ${e}`,"auth_context_change_cross_tab_post_message",{reason:e},!0),t?.postMessage("RefreshForAuthContextChange")),contextChangeSubscribe:e=>(i=t?.subscribeToMessage("RefreshForAuthContextChange",(t=>(n.debugToTelemetry?.("Recieved auth context changed cross tab message","auth_context_change_cross_tab_subscription",void 0,!0),i?.(),e.authentication.showRefreshModal(c.p.Authentication)))),i)}},Z=e=>{const t=[];for(let n=0;n<e.length;n++){e.charCodeAt(n)>y.FQ.TWO_HUNDRED_FIFTY_FIVE&&t.push(e.charAt(n))}return t}},686180:(e,t,n)=>{"use strict";n.d(t,{tM:()=>c,T4:()=>d});var i=n(681256),a=n(210841),o=n(188468),r=n(432720),s=n(879462),l=n(638763);let c;const d=(e,t)=>(c||(c=new u(e,t)),c);class u{constructor(e,t){this._hostStateProvider=e,this._networkStateProvider=t}observeMachineOnline(){return this._networkStateProvider.observe().pipe((0,o.F)()).pipe((0,r.T)((e=>e===i.Q.Online))).pipe((0,s.p)((e=>!0===e)))}observeMachineAwake(){return this._hostStateProvider.observe().pipe((0,l.w)("suspendedState")).pipe((0,r.T)((e=>e.suspendedState===a.tJ.Resumed))).pipe((0,s.p)((e=>!0===e)))}isMachineAwake(){return this._hostStateProvider.getState().suspendedState===a.tJ.Resumed}isMachineOnline(){return this._networkStateProvider.getState()===i.Q.Online}}},957234:(e,t,n)=>{"use strict";n.d(t,{j:()=>d});var i,a,o=n(953730),r=n(850434),s=n(199448),l=n(364819),c=n(195695);!function(e){e[e.clean=0]="clean",e[e.registrationToken=1]="registrationToken",e[e.skypeToken=2]="skypeToken"}(i||(i={})),function(e){e.orgid="orgid",e.teamsvisitor="teamsvisitor",e.live="live",e.guest="guest"}(a||(a={}));class d{constructor(e){this.discover=e,this._getSkypeIdType=async()=>{const e=await this.discover.skypeid((0,c.$q)("skype:_getSkypeIdType")),t=e?.split(":")?.[1];return a[t]}}async authorizeRequest(e,t="Authentication"){let n,i;const r=async(e,a)=>{const o={...e.headers};if(this.registrationToken)o.RegistrationToken=this.registrationToken;else{n=i;const r=performance.now(),s=await this._validateSkypeToken({invalidSkypeToken:i,forceRenew:a,correlation:(0,c.$q)("skype:decorate")});i=s.skypeToken,await this.validateAndThrowIfTokensAreSameOrInvalid("Skype::authorizeRequest",i,n,a),e.authPerformanceLogs={...e.authPerformanceLogs,skypeTokenDelta:performance.now()-r,skypeTokenFromCache:s.fromCache},o[t]=this.formatAuthHeader(t,i)}return e.headers=o,e};return{request:await r(e),resolver:async(e,t)=>{const{status:i,headers:{"set-registrationtoken":s}}=e;if(i===o.nW.NOT_AUTHORIZED){const e=await this._getSkypeIdType(),i=this.discover.shouldSkipTokenRefreshForAnon&&this.discover.shouldSkipTokenRefreshForAnon();if(e===a.teamsvisitor&&i)return;if(this.registrationToken&&delete this.registrationToken,!n)return r(t,!0)}else s&&i!==o.nW.NOT_FOUND&&this.parseToken(s)}}}authorize(e,t="Authentication"){return async n=>{let r,s,l=!1,d=i.clean;for(let u=0;u<=2;++u){const u={...n.headers},m=this.registrationToken;if(m)u.RegistrationToken=m;else{const e=performance.now(),i=await this._validateSkypeToken({invalidSkypeToken:r,forceRenew:l,correlation:(0,c.$q)("skype:authorize")});await this.validateAndThrowIfTokensAreSameOrInvalid("Skype::authorize",i?.skypeToken,r,l),r=i.skypeToken,n.authPerformanceLogs={...n.authPerformanceLogs,skypeTokenDelta:performance.now()-e,skypeTokenFromCache:i.fromCache},u[t]=this.formatAuthHeader(t,r)}n.headers=u,s=await e(n);const{status:p,headers:{"set-registrationtoken":g}}=s;if(p===o.nW.NOT_AUTHORIZED){const e=await this._getSkypeIdType(),t=this.discover.shouldSkipTokenRefreshForAnon&&this.discover.shouldSkipTokenRefreshForAnon();if(e===a.teamsvisitor&&t)break;if(m){if(m===this.registrationToken&&delete this.registrationToken,d===i.clean){r=void 0,d=i.registrationToken;continue}}else if(!l&&d!==i.skypeToken){l=!0,d=i.skypeToken;continue}}return g&&p!==o.nW.NOT_FOUND&&this.parseToken(g),s}return this.validateResponse(s)}}async validateAndThrowIfTokensAreSameOrInvalid(e,t,n,i){const a=t===n;if(this.discover.getSettingToDisableSkypeTokenValidation&&this.discover.getSettingToDisableSkypeTokenValidation(i,a))return;const o=this.discover.shouldThrowErrorIfSkypeTokenIsEmpty&&this.discover.shouldThrowErrorIfSkypeTokenIsEmpty(),c=!t||(0,l.isEmpty)(t.trim());if(a||o&&c){const n=await this._getSkypeIdType();throw(0,s.$5)("Discover",r.O4.FailedToUpdate,e,void 0,`Failed to update token. skypeId startsWith: ${n}, new token: ${+!!t}, isTokenSame: ${a}, isNewTokenEmptyOrUndefined: ${c}, forceRenew: ${i}`)}}async _validateSkypeToken(e){return this.discover.validateSkypeTokenV2?this.discover.validateSkypeTokenV2(e):{skypeToken:await this.discover.validateSkypeToken(e)}}validateResponse(e){if(!e)throw(0,s.$5)(r.Ir.Authentication,r.O4.UndefinedGlobalError,"",void 0,"Failed to authenticate response");return e}formatAuthHeader(e,t){return"Authentication"===e?`skypetoken=${t}`:"x-skypetoken"===e?t:`skype_token ${t}`}parseToken(e){const{expires:t,...n}=(0,l.fromPairs)(e.split(";").map((e=>e.split("=",2).map((e=>e.trim())))));n.endpointId&&(this.registrationToken=(0,l.toPairs)(n).map((e=>e.join("="))).join("; "))}}},741706:(e,t,n)=>{"use strict";n.d(t,{e:()=>i,R:()=>l});var i,a=n(553882),o=n(210841),r=n(754255),s=n(364819);!function(e){e.Active="Active",e.Inactive="Inactive",e.LongInactive="LongInactive"}(i||(i={}));class l{constructor(e,t,n,o,r){this._host=e,this._activityCallback=o,this._trackDocumentVisibility=r,this.msUntilIdle=l.MsUntilIdleDefault,this.msUntilLongIdle=l.MsUntilLongIdleDefault,this.handleMonitoredWindowEvent=(0,s.debounce)((()=>{this._idleStateBehaviorSubject.value!==i.Active&&this._idleStateBehaviorSubject.next(i.Active),this.restartIdleTimer(),this._activityCallback&&this._activityCallback()}),l.msDelayTime,{maxWait:this.msUntilIdle-l.msDelayTime*l.msMaxWaitTimeFactor,leading:!0}),this.handleIdleTimerTimeout=()=>{this._idleCountdownTimer=void 0,this.transitionToIdle()},this.transitionToIdle=()=>{void 0!==this._idleCountdownTimer&&(this._host.clearTimeout(this._idleCountdownTimer),this._idleCountdownTimer=void 0),this._idleStateBehaviorSubject.next(i.Inactive),this.restartLongIdleTimer()},this.transitionToLongInactive=()=>{this._idleStateBehaviorSubject.next(i.LongInactive),this._longIdleCountdownTimer=void 0},this.handleDocumentVisibilityChange=()=>{this._host.document.hidden?this.transitionToIdle():this.handleMonitoredWindowEvent()},this._idleStateBehaviorSubject=new a.t(i.Inactive),n&&this.setSettings(n),this.restartLongIdleTimer(),l.monitoredWindowEvents.forEach((t=>{e.addEventListener(t,this.handleMonitoredWindowEvent)})),r&&e.addEventListener("visibilitychange",this.handleDocumentVisibilityChange),t.newLogger("IdleTracker","core-services-client-state").log("Initialized")}observe(){return this._idleStateBehaviorSubject.asObservable()}getState(){return this._idleStateBehaviorSubject.value}createChildWindowIdleTracker(e,t,n){const i=this._activityCallback||this.handleMonitoredWindowEvent;return new l(e,t,n,i)}restartIdleTimer(){this.stopIdleTimers(),this._idleCountdownTimer=this._host.setTimeout(this.handleIdleTimerTimeout,this.msUntilIdle)}handleHostStateChange(e){if(!this._lastHostState)return void(this._lastHostState=e);const t=this.getState();e.machineLockState!==this._lastHostState.machineLockState&&(e.machineLockState===o.iP.Active&&t===i.Inactive?this.restartLongIdleTimer():e.machineLockState===o.iP.Locked&&(t===i.Active&&(this.stopIdleTimers(),this.transitionToIdle()),e.suspendedState===o.tJ.Suspending&&this.stopIdleTimers())),e.suspendedState!==this._lastHostState.suspendedState&&e.suspendedState===o.tJ.Suspending&&(t===i.Active&&this.transitionToIdle(),this.stopIdleTimers()),this._lastHostState=e}dispose(){this.stopIdleTimers(),l.monitoredWindowEvents.forEach((e=>{this._host.removeEventListener(e,this.handleMonitoredWindowEvent)})),this._trackDocumentVisibility&&this._host.removeEventListener("visibilitychange",this.handleDocumentVisibilityChange),this._idleStateBehaviorSubject.complete(),this.handleMonitoredWindowEvent.cancel()}setSettings(e){const{appIdleTimeoutInMs:t,appLongIdleTimeoutInMs:n}=e.get(r.w.Core,["appIdleTimeoutInMs","appLongIdleTimeoutInMs"]);this.msUntilIdle=t||l.MsUntilIdleDefault,this.msUntilLongIdle=n||l.MsUntilLongIdleDefault}restartLongIdleTimer(){void 0!==this._longIdleCountdownTimer&&(this._host.clearTimeout(this._longIdleCountdownTimer),this._longIdleCountdownTimer=void 0),this._longIdleCountdownTimer=this._host.setTimeout(this.transitionToLongInactive,this.msUntilLongIdle)}stopIdleTimers(){void 0!==this._idleCountdownTimer&&(this._host.clearTimeout(this._idleCountdownTimer),this._idleCountdownTimer=void 0),void 0!==this._longIdleCountdownTimer&&(this._host.clearTimeout(this._longIdleCountdownTimer),this._longIdleCountdownTimer=void 0)}}l.monitoredWindowEvents=["scroll","DOMMouseScroll","mousewheel","touchstart","touchmove","mousemove","keydown"],l.msDelayTime=1e3,l.msMaxWaitTimeFactor=30,l.MsUntilLongIdleDefault=12e5,l.MsUntilIdleDefault=3e5},81758:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});const i="APC::"},426387:(e,t,n)=>{"use strict";var i,a,o,r,s,l,c;n.d(t,{uF:()=>i,sc:()=>a,AY:()=>s,IW:()=>l}),function(e){e.PASSED="PASSED",e.EDU="EDU",e.PSTN_CALLING="PSTN_CALLING",e.USER_CHOICE="USER_CHOICE",e.ADMIN_DISABLED="ADMIN_DISABLED",e.GUEST_USER="GUEST_USER",e.USER_FTS="USER_FTS",e.T1_DEFAULT="T1DEFAULT",e.T21_DEFAULT="T21DEFAULT",e.T21_ONLY="T21ONLY"}(i||(i={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohort",e.EarlyEnterpriseCohort="EarlyEnterpriseCohort",e.MidEnterpriseCohort="MidEnterpriseCohort",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohort",e.LateEnterpriseCohort="LateEnterpriseCohort",e.GovCloudCohort="GovCloudCohort",e.MacR36Cohort="MacR36Cohort",e.MacR4Cohort="MacR4Cohort",e.EduCohort="EduCohort",e.InternalRingCohort="InternalRingCohort",e.ExternalTapCohort="ExternalTapCohort",e.NoPPChannelCohort="NoPPChannelCohort",e.WebCohort="WebCohort"}(a||(a={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohortUplevel",e.EarlyEnterpriseCohort="EarlyEnterpriseCohortUplevel",e.MidEnterpriseCohort="MidEnterpriseCohortUplevel",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohortUplevel",e.LateEnterpriseCohort="LateEnterpriseCohortUplevel",e.GovCloudCohort="GovCloudCohortUplevel",e.MacR36Cohort="MacR36CohortUplevel",e.MacR4Cohort="MacR4CohortUplevel",e.EduCohort="EduCohortUplevel",e.InternalRingCohort="InternalRingCohortUplevel",e.ExternalTapCohort="ExternalTapCohortUplevel",e.NoPPChannelCohort="NoPPChannelCohortUplevel"}(o||(o={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohortDownlevel",e.EarlyEnterpriseCohort="EarlyEnterpriseCohortDownlevel",e.MidEnterpriseCohort="MidEnterpriseCohortDownlevel",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohortDownlevel",e.LateEnterpriseCohort="LateEnterpriseCohortDownlevel",e.GovCloudCohort="GovCloudCohortDownlevel",e.MacR36Cohort="MacR36CohortDownlevel",e.MacR4Cohort="MacR4CohortDownlevel",e.EduCohort="EduCohortDownlevel",e.InternalRingCohort="InternalRingCohortDownlevel",e.ExternalTapCohort="ExternalTapCohortDownlevel",e.NoPPChannelCohort="NoPPChannelCohortDownlevel"}(r||(r={})),function(e){e.M365_BusinessBasic="M365_BusinessBasic",e.M365_BusinessStandard="M365_BusinessStandard",e.M365_BusinessPremium="M365_BusinessPremium",e.M365_BusinessApps="M365_BusinessApps",e.M365_BusinessEssentials="M365_BusinessEssentials"}(s||(s={})),function(e){e.NONE="NONE",e.ALL_UP_POLICY_EXPIRATION="ALL_UP_POLICY_EXPIRATION",e.COHORT_BASED_EXPIRATION="COHORT_BASED_EXPIRATION",e.COHORT_AND_TAC_BASED_EXPIRATION="COHORT_AND_TAC_POLICY_EXPIRATION",e.NO_COHORT_BASED_EXPIRATION="NO_COHORT_BASED_EXPIRATION"}(l||(l={})),function(e){e.T1_DEFAULT="T1DEFAULT",e.T21_DEFAULT="T21DEFAULT",e.T21_ONLY="T21ONLY",e.NONE="NONE"}(c||(c={}))},401178:(e,t,n)=>{"use strict";var i;n.d(t,{K:()=>i}),function(e){e.BottomLeft="BottomLeft",e.BottomRight="BottomRight",e.TopLeft="TopLeft",e.TopRight="TopRight"}(i||(i={}))},486616:(e,t,n)=>{"use strict";var i;n.d(t,{IO:()=>i,jO:()=>a,nz:()=>o,Gr:()=>r,Sj:()=>s}),function(e){e.POP="pop",e.BEARER="Bearer"}(i||(i={}));const a="https://api.spaces.skype.com",o="ForceFallbackToWebAuth",r="ForceReloadIfSkypeAuthFail";var s;!function(e){e.InteractionBanner="interactionBanner",e.Logout="logout",e.UpdateMostRecentUser="updateMostRecentUser"}(s||(s={}))},164657:(e,t,n)=>{"use strict";var i;n.d(t,{U:()=>i,z:()=>a}),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ONLINE=1]="ONLINE",e[e.OFFLINE=0]="OFFLINE"}(i||(i={}));const a=["ChatSync","Presence","Files","OneNote","Groups","Video","MasterTab","IndexDb","AdalTokens","AdalLogin","AdalReauth","SkypeTokens","SkypeLicense","SupportedBrowser","MSAGuestLicense","AppSession","CSAStartup"]},879647:(e,t,n)=>{"use strict";n.d(t,{CB:()=>i,f5:()=>a,yb:()=>o,F6:()=>r,V9:()=>s,hF:()=>l});const i="cdl-worker-startup-status",a="cdl-worker-verbose-log",o="cdl-worker-aggregated-user-data",r="cdl-worker-aggregated-user-badge-data",s="cdl-worker-global-user-data",l="secure-global-user-data"},441985:(e,t,n)=>{"use strict";var i;n.d(t,{I:()=>i}),function(e){e.Abandoned="Abandoned",e.AfterOnCommandReceived="AfterOnCommandReceived",e.AfterOnEventReceived="AfterOnEventReceived",e.AlreadyFocused="AlreadyFocused",e.ApplicationHookReceivedCommand="ApplicationHookReceivedCommand",e.ApplicationHookContinuedCommand="ApplicationHookContinuedCommand",e.BeforeOnCommandReceived="BeforeOnCommandReceived",e.BeforeOnEventReceived="BeforeOnEventReceived",e.Blanked="Blanked",e.ChunkLoadStarted="ChunkLoadStarted",e.ChunkLoadSucceeded="ChunkLoadSucceeded",e.Close="Close",e.CommandAfterGetAppViewEntitiesSucceeded="CommandAfterGetAppViewEntitiesSucceeded",e.CommandBeforeGetAppViewEntities="CommandBeforeGetAppViewEntities",e.CommandHandledByOnCommandReceived="CommandHandledByOnCommandReceived",e.CommandHandledPriorToResolution="CommandHandledPriorToResolution",e.CommandMetaDataAdded="CommandMetaDataAdded",e.CommandReceived="CommandReceived",e.CommandReportingTimedOut="CommandReportingTimedOut",e.CommandResolutionStarted="CommandResolutionStarted",e.CommandStart="CommandStart",e.CommandTimeout="CommandTimeout",e.ContinueHandlingAtHost="ContinueHandlingAtHost",e.DeeplinkReceived="DeeplinkReceived",e.DeeplinkParsed="DeeplinkParsed",e.DeeplinkParseByAppStarted="DeeplinkParseByAppStarted",e.DeeplinkParseByAppSucceeded="DeeplinkParseByAppSucceeded",e.DelegatedCommandReceived="DelegatedCommandReceived",e.EventBubbled="EventBubbled",e.EventHandled="EventHandled",e.Hidden="Hidden",e.IntentReceived="IntentReceived",e.IntentTransferredCrossCloud="IntentTransferredCrossCloud",e.IntentTransferringCrossCloud="IntentTransferringCrossCloud",e.OnBeforeIntentAuthenticatedStarted="OnBeforeIntentAuthenticatedStarted",e.OnBeforeIntentAuthenticatedCompleted="OnBeforeIntentAuthenticatedCompleted",e.OnLoadingScreenDisplayStarted="OnLoadingScreenDisplayStarted",e.OnLoadingScreenDisplayCompleted="OnLoadingScreenDisplayCompleted",e.WaitForUserContextStarted="WaitForUserContextStarted",e.WaitForUserContextCompleted="WaitForUserContextCompleted",e.WaitForUserContextFailed="WaitForUserContextFailed",e.OnAfterIntentAuthenticatedStarted="OnAfterIntentAuthenticatedStarted",e.OnAfterIntentAuthenticatedCompleted="OnAfterIntentAuthenticatedCompleted",e.IntentHookStarted="IntentHookStarted",e.IntentHookResolved="IntentHookResolved",e.IntentHookRejected="IntentHookRejected",e.IntentHookCompleted="IntentCompleted",e.IntentExecuted="IntentExecuted",e.Failure="Failure",e.Focus="Focus",e.Incomplete="Incomplete",e.LayoutRendered="LayoutRendered",e.LayoutRenderUpdated="LayoutRenderUpdated",e.NavigationCommandStart="NavigationCommandStart",e.NoPendingIntent="NoPendingIntent",e.NotHandled="NotHandled",e.Rendered="Rendered",e.RenderStarted="RenderStarted",e.ScenarioEventDataAppended="ScenarioEventDataAppended",e.ScenarioMarked="ScenarioMarked",e.SlotPhasedRenderingTimedOut="SlotPhasedRenderingTimedOut",e.TimeoutRunningApp="TimeoutRunningApp",e.TimeoutRunningCore="TimeoutRunningCore",e.Toggled="Toggled",e.UnmountStarted="UnmountStarted",e.WindowCreated="WindowCreated",e.WindowUpdateStart="WindowUpdateStart",e.WindowUpdated="WindowUpdated",e.WindowNotUpdated="WindowNotUpdated",e.WindowUpdatedButNotRendered="WindowUpdatedButNotRendered",e.ModalRendered="ModalRendered"}(i||(i={}))},803444:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{Mk:()=>i,TZ:()=>a,no:()=>o}),function(e){e.ActiveEntitiesResolved="active_entities_resolved",e.ActiveEntitiesDestroyed="active_entities_destroyed",e.AppSelectionChanged="app_selection_changed_resolved",e.ExperienceIdleStateChanged="experience_idle_state_changed",e.InitialDeeplinkResolved="initial_deep_link_resolved",e.NavigationIntentExecuted="navigation_intent_executed",e.UserAuthenticated="user_authenticated",e.UserConsentedToConsumeResources="user_consented_to_consume_resources",e.PreWarmJobsCompleted="pre_warm_jobs_completed",e.WindowWarmJobsCompleted="window_warm_jobs_completed",e.ExperienceWarmJobsCompleted="experience_warm_jobs_completed",e.ClientStartFinished="client_start_finished"}(i||(i={})),function(e){e.LayoutRenderComplete="layout_render_complete",e.WindowStateChange="window_state_change",e.WindowOptionsChange="window_options_change",e.IdleCallback="idle_callback",e.FirstRenderStarted="first_render_started"}(a||(a={})),function(e){e.Started="app_started",e.Initialized="app_initialized",e.ExperienceWarm="experience_warm",e.UserWarm="user_warm",e.ExperienceLongIdle="experience_long_idle",e.WindowWarm="window_warm",e.Idle="idle"}(o||(o={}))},914020:(e,t,n)=>{"use strict";var i;n.d(t,{T:()=>i}),function(e){e.tenantLogin="tenantLogin",e.tenantRedemption="tenantRedemption"}(i||(i={}))},898011:(e,t,n)=>{"use strict";var i;n.d(t,{Y:()=>i}),function(e){e.Default="default",e.MobileSync="mobileSync",e.MobileUnsync="mobileUnsync"}(i||(i={}))},785294:(e,t,n)=>{"use strict";var i,a;n.d(t,{_:()=>i,a:()=>a}),function(e){e.List="List",e.Form="Form"}(i||(i={})),function(e){e.Add="Add",e.Edit="Edit"}(a||(a={}))},726464:(e,t,n)=>{"use strict";var i,a;n.d(t,{J:()=>i,v:()=>a}),function(e){e.TeamsPremium="TeamsPremium"}(i||(i={})),function(e){e.Home="TPCHome",e.Benefits="TPCBenefits",e.StartTrial="TPCStartTrial",e.TryPremium="TPCTryPremium",e.PostTrial="TPCPostTrial",e.DiscoverPremiumFeature="TPCDiscoverPremiumFeature"}(a||(a={}))},247681:(e,t,n)=>{"use strict";var i,a,o,r;n.d(t,{YH:()=>i,Ck:()=>a,b7:()=>o,aZ:()=>r}),function(e){e[e.Call=0]="Call",e[e.High=1]="High",e[e.Normal=2]="Normal",e[e.Low=3]="Low"}(i||(i={})),function(e){e.Calling="Calling",e.MSN="MSN",e.MeetingNudge="MeetingNudge",e.Standard="Standard"}(a||(a={})),function(e){e.Rtl="rtl",e.Auto="auto",e.Ltr="ltr"}(o||(o={})),function(e){e.Alert="alert-icon"}(r||(r={}))},784728:(e,t,n)=>{"use strict";var i;n.d(t,{$:()=>i}),function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Debug=4]="Debug",e[e.Verbose=5]="Verbose",e[e.Max=6]="Max"}(i||(i={}))},868670:(e,t,n)=>{"use strict";n.d(t,{AR:()=>i,f5:()=>a,dr:()=>o});const i=["/l/auth-callback","/convene/events","/convene/meet","/convene/townhall","/embed-client/chats","/light-meetings","/l/app","/l/auth/google","/l/auth/signout","/l/autoinstallnotification","/l/broadcast/create","/l/broadcast","/l/calendar/scheduling-form","/l/calendar/surface","/l/campaign/chat","/l/campaign/do-it-later","/l/campaign/meeting","/l/channel-dashboard","/l/channel","/l/chat","/l/m365chat","/l/call","/l/launch-queuesapp","/l/launch-callsapp","/l/claim","/l/community/create-event","/l/community/events","/l/community/create-post","/l/community/create","/l/community/edit","/l/community/add-member","/l/community/invite","/l/community","/l/discover-teams","/l/entity","/l/esp/whats-new-content","/l/exploratory-awareness","/l/file","/l/fileshare","/l/help-action-button","/l/invite/","/l/lobnotifications","/l/manageApps","/l/manage-teams/myinvites","/l/meeting/new","/l/meeting/details","/l/meetingrecap","/l/meetinganalytics","/l/meetup-join","/l/message","/l/meeting-share","/l/phonelink","/l/present","/l/sensitivity-update","/l/share-email","/l/store","/l/task","/l/team-dashboard","/l/team","/l/trial/teamsPremiumLicenseRequest","/l/trial/teamsPremiumTrial","/l/teamsInsider","/meet","/meet/meet-now","/notdefaultapp","/l/stage","/l/subscriptionmanagement","/subscriptionmanagement","/l/copilot","/l/virtualevent/duplicate","/l/virtualevent/new","/l/virtualevent","/l/change-file-open-preference","/l/loopthread","/l/marketplace","/l/useractivityrecall"];var a,o;!function(e){e.core="core",e.flyout="flyout",e.default="default"}(a||(a={})),function(e){e.mini="mini",e.main="main"}(o||(o={}))},272978:(e,t,n)=>{"use strict";n.d(t,{ed:()=>r,Y0:()=>s});var i=n(853551);const a=i.Yj.pipe(new i.ZU("URL",(e=>e instanceof URL),((e,t)=>{try{return(0,i.kX)(new URL(e))}catch{return(0,i.V2)(e,t)}}),(e=>e.href))),o=(0,i.KC)([(0,i.eu)("NA"),a.pipe(new i.ZU("GTM URL",(e=>e instanceof URL&&e.pathname.endsWith("/")),(e=>(e.pathname.endsWith("/")||(e.pathname+="/"),(0,i.kX)(e))),i.D_))]),r=(0,i.OH)({isFreemium:i.zM,isBasicLiveEventsEnabled:i.zM,isAdvComms:i.zM,isTranscriptEnabled:i.zM,eduLicenseSkuAndCategory:(0,i.KC)([i.Yj,i.sJ]),isCopilot:i.zM,isGroupCopilot:i.zM,isM365CopilotBusinessChat:i.zM,isTPProtection:i.zM,isTPCustomization:i.zM,isTPManagement:i.zM,isTPWebinar:i.zM,isTPVirtualAppointments:i.zM,isInfoProtectionPremium:i.zM,isTeamsPhonePremium:i.zM,isTeamsSmb:i.zM,isAvatarsEnabled:i.zM,isImmersiveSpaceEnabled:i.zM,isTeamsPremiumSelfAssigned:i.zM,isTeamsSharedDevices:i.zM,exploratoryTrialLicenseEndDate:(0,i.KC)([i.Yj,i.sJ]),hasOnlyTeamsSharedDevices:i.zM,isTeamsDeviceManagementEnabled:i.zM,experimentationTeamsAddOnPlans:(0,i.YO)(i.Yj),experimentationTeamsLicenseCategories:(0,i.YO)(i.Yj),meetingRoomLicenseCategories:(0,i.YO)(i.Yj),isWebinarEnabled:i.zM}),s=(0,i.OH)({ams:o,amsV2:o,appMonetizationService:o,appsSuggestionService:o,appService:o,biometricService:o,chatService:o,chatServiceAfd:o,chatSvcAggAfd:o,eventService:o,teamsPushServiceAfd:o,cmdArtifactsService:o,groupsServiceV2:o,searchService:o,graphService:o,iC3LocationService:o,mcpService:o,middleTier:o,mtImageService:o,phonelinkSmsService:o,powerPointStateService:o,peopleProfileService:o,search:o,tdmService:o,teamsAndChannelsProvisioningService:o,teamsEventsIntegration:o,unifiedPresence:o,presenceUPS:o,urlp:o,urlpV2:o,userProfileService:o,calling_conversationServiceUrl:o,calling_conversationServiceCaptchaUrl:o,calling_TeamsCopilotAggregatorUrl:o,calling_trouterUrl:o,calling_registrarUrl:o,consumerLicenses:o,virtualEventsService:o,userIntelligenceService:o},"region Gtms")},182710:(e,t,n)=>{"use strict";var i;n.d(t,{Ad:()=>i,dp:()=>a,si:()=>o}),function(e){e[e.Background=0]="Background",e[e.Macro=1]="Macro",e[e.RenderBlocking=2]="RenderBlocking",e[e.UserVisible=3]="UserVisible"}(i||(i={}));const a=-1;var o;!function(e){e[e.None=0]="None",e[e.Canceled=1]="Canceled",e[e.Received=2]="Received",e[e.Started=3]="Started",e[e.Complete=4]="Complete"}(o||(o={}))},681256:(e,t,n)=>{"use strict";var i,a;n.d(t,{Q:()=>i,_:()=>a}),function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(i||(i={})),function(e){e.Offline="Offline",e.Online="Online",e.Unknown="Unknown",e.SuspectedOffline="Suspected Offline"}(a||(a={}))},302151:(e,t,n)=>{"use strict";var i,a;n.d(t,{g:()=>i,Z:()=>a}),function(e){e.AppUpdatedUsingServiceWorker="AppUpdatedUsingServiceWorker",e.AuthTokenForceRefresh="AuthTokenForceRefresh",e.ClearContainer="ClearContainer",e.CloudMismatchOnLogIn="CloudMismatchOnLogIn",e.ErrorPageReboot="ErrorPageReboot",e.ErrorPageSignOut="ErrorPageSignOut",e.RemoveAuthenticatedUser="RemoveAuthenticatedUser",e.RingSwitch="RingSwitch",e.LanguageSwitch="LanguageSwitch",e.HighMemory="HighMemory",e.TeamsInsiderSwitch="TeamsInsiderSwitch",e.ServiceSwitch="ServiceSwitch",e.SimpleCollabSwitch="SimpleCollabSwitch",e.VDIRestartWorkflow="VDIRestartWorkflow",e.ClientAccessPolicyAdminDisabled="ClientAccessPolicyAdminDisabled",e.ClientAccessPolicyUserAllowed="ClientAccessPolicyUserAllowed",e.ClientAccessLeakedPolicyCleanup="ClientAccessLeakedPolicyCleanup",e.ClientAccessWebOptInPolicyCleanup="ClientAccessWebOptInPolicyCleanup",e.SidecarUpdate="SidecarUpdate",e.ExperienceLoaderSettingsUpdate="ExperienceLoaderSettingsUpdate"}(i||(i={})),function(e){e.Auth="Auth",e.DeveloperSwitchersService="DeveloperSwitchersService",e.ReloadAppTask="ReloadAppTask",e.WebClientUpdateService="WebClientUpdateService",e.RemoveAuthenticatedUserResolver="RemoveAuthenticatedUserResolver",e.Core="Core",e.SimpleCollabSwitch="SimpleCollabSwitch",e.ClientAccessAdminPolicyCheckService="ClientAccessAdminPolicyCheckService",e.MeetingRoomPublicPreviewSwitch="MeetingRoomPublicPreviewSwitch",e.AccountLocaleChangeNotificationBanner="AccountLocaleChangeNotificationBanner",e.Sidecar="Sidecar",e.ExperienceLoaderSettingsUpdate="ExperienceLoaderSettingsUpdate",e.VDIGlobalPlatformHelpers="VDIGlobalPlatformHelpers"}(a||(a={}))},232755:(e,t,n)=>{"use strict";var i,a;n.d(t,{J:()=>i,i:()=>a}),function(e){e.core="core",e.window="window",e.mtmaCore="mtmaCore",e.mtmaUser="mtmaUser",e.mtmaWindow="mtmaWindow",e.viewSchema="viewSchema",e.embed="embed",e.cmd="cmd",e.other="other",e.relay="relay"}(i||(i={})),function(e){e.query="query",e.watchQuery="watchQuery",e.mutate="mutate",e.subscribe="subscribe",e.readQuery="readQuery",e.writeQuery="writeQuery",e.readFragment="readFragment",e.writeFragment="writeFragment"}(a||(a={}))},463331:(e,t,n)=>{"use strict";var i,a;n.d(t,{J:()=>i,B:()=>a}),function(e){e[e.SingleAccount=0]="SingleAccount",e[e.MultipleAccounts=1]="MultipleAccounts"}(i||(i={})),function(e){e[e.SingleCloud=0]="SingleCloud",e[e.MultiCloud=1]="MultiCloud"}(a||(a={}))},202042:(e,t,n)=>{"use strict";var i,a;n.d(t,{O:()=>i,Z:()=>a}),function(e){e.Unknown="unknown",e.Prod="prod"}(i||(i={})),function(e){e.MW="MW",e.Anglr="Anglr",e.ShareToTeams="ShareToTeams",e.Files="Files",e.Calendar="Calendar",e.MtgOpt="MtgOpt",e.EmbedClient="EmbedClient",e.LmsIntegration="LmsIntegration",e.CallingEmbed="CallingEmbed",e.ReactWebClient="ReactWebClient",e.Example="Example"}(a||(a={}))},82346:(e,t,n)=>{"use strict";n.d(t,{JN:()=>a,br:()=>o,Jl:()=>r,zw:()=>s,aF:()=>d,sb:()=>u});var i=n(458648);const a="[Authentication][DiscoverV2]";var o,r,s,l,c;!function(e){e.userLocale="X-Client-UI-Language",e.skypeTokenAuthzTypeHeader="ms-teams-authz-type",e.claimsChallengeCapable="claimsChallengeCapable",e.consistencyValue="ConsistencyLevel"}(o||(o={})),function(e){e.skypeTokenRefresh="TokenRefresh",e.skypeTokenExplicitLogin="ExplicitLogin",e.strongConsistencyMsInternalUserSignup="MS-Internal-UserSignup",e.strongConsistencyDefaultValue="Organization;ScenarioId={id}"}(r||(r={})),function(e){e[e.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD=i.YM.Two*i.YM.SECONDS_PER_MINUTE*i.YM.MILLI_PER_SECOND]="DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD"}(s||(s={})),function(e){e.skypeAuthAnonReloadJoinLocation="skypeAuthAnonReloadJoinLocation",e.skypeAuthForceAnonReload="skypeAuthForceAnonReload"}(l||(l={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FIVE=5]="FIVE",e[e.TEN=10]="TEN",e[e.FIFTEEN=15]="FIFTEEN",e[e.SIXTEEN=16]="SIXTEEN",e[e.THIRTY=30]="THIRTY",e[e.TWO_HUNDRED_FIFTY_FIVE=255]="TWO_HUNDRED_FIFTY_FIVE"}(c||(c={}));const d={SKYPE_SEND_REQUEST:"skype_send_request",SKYPE_RECEIVED_RESPONSE:"skype_received_response",SKYPE_RECEIVED_SAME_TOKEN:"skype_received_same_token",SKYPE_SEND_REQUEST_DESKTOP:"skype_send_request_desktop",SKYPE_SEND_REQUEST_WORKER:"skype_send_request_worker",SKYPE_TOKEN_RECEIVED_WORKER:"skype_token_received_worker",RECEIVE_CLAIM:"receive_claim"},u="NA"},588111:(e,t,n)=>{"use strict";n.d(t,{_P:()=>F,_Q:()=>_,St:()=>D,Sv:()=>M,Op:()=>x,Sl:()=>L,RU:()=>O,vL:()=>j,pG:()=>B,BB:()=>$,WB:()=>W,uq:()=>V,xT:()=>z,Ln:()=>q,JV:()=>G,tl:()=>Y,vV:()=>Q,Lc:()=>J,ZH:()=>K,$X:()=>X,S6:()=>ee,Zy:()=>te,Se:()=>ne,QK:()=>ie,d2:()=>ae,Ud:()=>le,M7:()=>ce});var i=n(850434),a=n(199448),o=n(953730),r=n(272978),s=n(754255),l=n(854190),c=n(403097),d=n(853551),u=n(795269),m=n(702183),p=n(99425),g=n(455051),h=n(81670),v=n(667606),y=n(736626),S=n(235133),f=n(176737),k=n(50737),C=n(899855),b=n(458648),w=n(634664),T=n(943982),I=n(82346),N=n(924820),A=n(44522);const E=[i.O4.NetworkOffline,i.O4.Forbidden,i.O4.ProxyAuthenticationRequired],F={context:I.JN,subContext:"_getDiscoverResponse",errorCode:i.O4.NetworkOffline,message:"Network is offline, not making any call",isExpected:!0},_={context:I.JN,subContext:"_getDiscoverResponse",errorCode:h.tG.InteractionRequired,message:"Interaction is required to get a skype token, not making any call",isExpected:!0},D=(e,t,n)=>{let o;if(!n){const{response:t}=e;o=t?.isExpected}let r=e;r.context||(r=(0,a.J4)(e,i.Ir.Discover,i.O4.InvalidResponse,"",{error:e.stack},e.message||("string"==typeof e?e:(0,w.hR)(e))));const{serverResponse:{status:s,body:l,headers:c={}}={},context:d}=r;let{reason:u,message:m,code:p=i.O4.InvalidResponse,subContext:g=""}=r;return u=c?{...u,responseCorrelationId:c["correlation-id"],innerError:r}:u,m=l?.message||m,g=l?.errorCode||d,p=t?P(s):i.O4.NetworkOffline,(0,a.$5)(i.Ir.Discover,p,g,{...u,innerError:e},m,r.serverResponse,o)},P=e=>{if(void 0===e)return i.O4.InvalidResponse;switch(e){case o.nW.FORBIDDEN:return i.O4.Forbidden;case o.nW.NOT_AUTHORIZED:return i.O4.Unauthorized;case o.nW.PROXY_AUTHENTICATION_REQUIRED:return i.O4.ProxyAuthenticationRequired;default:return i.O4.FailedToFetch}},M=(e,t,n,i)=>{if(!e&&!i)throw t;const a={...t,errorCode:t.code,reason:(0,w.hR)(t.reason)};if(i)return t.reason&&(t.reason.isExpectedError=Z(t)),i(a),t;if(!e)throw t;return(0,v.$z)(t)?e.incomplete(a):Z(t)||!n&&t?.isExpected?e.cancel(a):e.fail(a),t.reason&&(t.reason.isExpectedError=Z(t)),t},R=(0,d.NW)({skypeid:d.Yj}),x=((0,d.NW)({skypeTokenData:(0,d.NW)({regionGtms:r.Y0,token:(0,d.NW)({skypeToken:d.Yj,expiration:d.ai,userDetails:(0,d.OH)({region:d.Yj})})})},"token"),(e,t)=>{if(!e)return t.error("Can not get userId due to skypeToken is undefined"),"";const{skypeid:n}=(0,u.as)(R,(0,T.f)(e));return`8:${n}`}),L=e=>{let t=e.findScenario(m.Cu.GetSkypeToken);return t||(t=e.newScenario(m.Cu.GetSkypeToken),t.mark("Non authz error scenario")),t},O=async(e,t,n)=>{const i=(0,y.DA)();n?.push("fn:getuid");const a=await e.getUser({correlation:{id:i,source:"discover-helper::getUserIdentifierForDiscover",scenarioName:m.Cu.AuthWebUser}});if(n?.push("user:"+ +!!a),a?.isAuthenticated){t.log(`[_getUserIdentifier][${i}]user found by getUser call`);return(0,S.X_)(a)}const o=`[_getUserIdentifier] ${a?`User is not authenticated. UserId: [${a.id}] tenantId: [${a.profile.tid}]`:"user missing"}. ${n?.join(";")}`;throw(0,v.$5)({context:I.JN,subContext:"_getUserIdentifier",errorCode:a?h.tG.UserNotAuthenticated:h.tG.UserNotFoundError,isExpected:!0,message:o,correlationId:i??(0,y.DA)()})},j=async(e,t,n,i,a,o,r,s,l)=>{f.Vh.put((0,k.Xr)(e).userDetail,t.userDetails),n?.push("userDetails:1"),await(0,A.m)(t,r,o,s,l),f.Vh.put((0,k.Xr)(e).skypeToken,t),n?.push("skypeToken:1");const c=t?.regionGtms;c&&(0,w.hR)(c).length>b.uM.DEFAULT_REGION_GTM_MIN_LENGTH?(f.Vh.put((0,k.Xr)(e).regionGtm,c),n?.push("regionGtms:1")):(n?.push("regionGtms:-1"),a.error(`[_getDiscoverResponse][${i}] RegionGtm is missing in response, not able to cache.`))},B=async(e,t,n,i)=>{const a=Date.now();let o;try{o=await e.body.clone().json()}catch(n){throw await U(I.JN,"mapToDiscoveryResponse",n,t.correlationId,e,i)}const{regionGtms:r,licenseDetails:s,skypeToken:l,tokens:c,region:d,regionOverride:u,regionSettings:m,skypeGuestUserToken:p,consumerLicenseDetails:g,userRegion:h,partition:v,userPartition:y}=o;t.eventData?.push("parsejson:1");const S=l||c||p,f=S?.skypeToken??S?.skypetoken;let k;return n.log(`[_acquireSkypeTokenWeb][${t?.correlationId}] Response parsed succeed.`),g&&(k={timeStamp:new Date(a),consumerLicenseDetails:g}),{userId:x(f,n),regionGtms:r,licenseDetails:s,skypeToken:f,expires:new Date(a+S?.expiresIn*b.YM.MILLI_PER_SECOND),region:d,userRegion:h,partition:v,userPartition:y,regionOverride:u,regionSettings:m,consumerLicenseDetails:k}},U=async(e,t,n,i,a,o)=>{if(o)throw n;const r=await a.body.text(),s=`${n&&n.message}`,l=(0,N.y)(`${s} - ${r.substring(0,250)}`);return(0,v.$5)({context:e,subContext:t,correlationId:i??(0,y.DA)(),errorCode:h.tG.SkypeTokenResponseInvalidJson,isExpected:!1,message:l})},$=(e,t,n)=>{if(e.push("fn:_getUserDetailFromHost"),!t)return void e.push("_bootstrapData:0");const{userId:i,region:a,licenseDetails:o,userRegion:r,partition:s,userPartition:l}=t;return i&&a&&o?{id:i,licenseDetails:o,region:a,userRegion:r,partition:s,userPartition:l}:(n.log(`[_getUserDetailFromHost] userId:${!!i}|region:${!!a}|licenseDetails:${!!o}|userRegionForMultiGeo:${!!r}|partition${!!s}|userPartition${!!l}`),void e.push(`userId:${!!i}|region:${!!a}|licenseDetails:${!!o}|userRegionForMultiGeo:${!!r}|partition${!!s}|userPartition${!!l}`))},W=(e,t)=>{const n=x(e.skypeToken,t);return t.log(`[convertResponseToISkypeToken] Skypeid received from discovery. Region: ${e?.region}`),{skypeToken:e?.skypeToken,expiration:e?.expires?.getTime(),regionGtms:e?.regionGtms,userDetails:{id:n,licenseDetails:{...e?.licenseDetails,consumerLicenseDetails:e?.consumerLicenseDetails},region:e?.region,userRegion:e?.userRegion,partition:e?.partition,userPartition:e?.userPartition,regionOverride:e?.regionOverride,regionSettings:e?.regionSettings}}},V=(e,t,n,i,a)=>{const{skypeTokenValidationDisabled:o}=n.get(s.w.Auth),r=n.get(s.w.Host).skypeTokenValidationDisabled,l=o||r;return l&&H(e,t,i,a),!!l},H=(e,t,n,i)=>{if(t){n.log(`Skype token validation skipped. forceRenew:${e};isTokenSame:${t}`);const a=i.newScenario(m.Cu.SkypeTokenValidationSkipped);a.appendEventData({message:`forceRenew:${e};isTokenSame:${t}`}),a.stop()}},z=(e,t,n)=>{if(!(0,S.gn)(e.userIdentifier,(0,S.X_)(t)))throw e.eventData?.push("userMismatch"),n.warn("[_acquireSkypeTokenWeb] user obtained does not match provided userIdentifier, throw error."),(0,v.$5)({context:I.JN,subContext:"_acquireSkypeTokenWeb",errorCode:h.tG.UserNotFoundError,message:"User obtained does not match provided userIdentifier.",correlationId:e.correlationId,isExpected:!0})},q=(e,t,n,i,a,o,r)=>{const{authOverrides:c}=n.get(s.w.Host),{authzEndpointUrl:d,authzUrl:u,regionGtmsEnv:m,disableT21AuthZDefaultUrl:y}=n.get(s.w.Auth),S=y?h.oF.AUTHZ_DEPRECATED_DEFAULT_BASE_URL:h.oF.AUTHZ_DEFAULT_BASE_URL,f=((e,t,n,i,a)=>{const{environment:o}=i?.get(s.w.Metadata)||{},{doNotPassTenantIdForAnonMeetingJoins:r}=i?.get(s.w.Calling)||{};let c={method:"POST",url:n?`${e}?region_gtms_env=${n}`:`${e}`,serviceName:l.p.Auth,apiName:"acquireSkypeTokenWeb"};if("Anonymous"===t.role)if(t.subType===p.as.Ccm){const e=oe(t);if(!e)throw(0,v.$5)({context:"Authentication",subContext:"DiscoverHelper::getRequestConfig",errorCode:"MeetingDetailsNotFound",message:"No meetingUrl present for CCM user",correlationId:a,isExpected:!1});c={...c,body:`{"meetingURL": "${e}"}`}}else c=r?{...c,url:`${e}/visitor`}:{...c,url:`${e}/visitor`,body:`{"tenantId": "${t.profile.tid}"}`};return o!==g.BV.life||"Guest"!==t.role&&"Anonymous"!==t.role||(c={...c,url:`${e}/guest${n?`?region_gtms_env=${n}`:""}`}),c})(c?.authzEndpointUrl||d||u||S,e,m,n,t);return i.log(`[_getFormatRequest][${t}] Request formatted. `),f.headers=((e,t,n,i,a)=>{const o={},r=t?.locale,{disableClaimsChallenge:l,enableSTMHeaderForAuthZ:c,disableCorrelationHeaders:d}=n.get(s.w.Auth);return r&&(o[I.br.userLocale]=r),l||(o[I.br.claimsChallengeCapable]="true"),c&&(o["X-MS-Migration"]="True"),o.clientRequestId=e,o["x-ms-skip-phone"]="true",void 0!==i&&(o["ms-teams-authz-type"]=i?I.Jl.skypeTokenRefresh:I.Jl.skypeTokenExplicitLogin),d||(o["x-ms-request-id"]=e,a?.clientVersion&&(o["x-ms-client-version"]=a.clientVersion),o["x-ms-client-type"]=a?.clientType?a.clientType:"web"),o})(t,a,n,o,r),f},G=(e,t)=>{const n=re(e.licenseDetails,t);return{id:e.id,region:e.region,userRegion:e.userRegion||void 0,partition:e.partition||void 0,userPartition:e.userPartition||void 0,tenant:{type:e.licenseDetails?.isFreemium?c.qv.Freemium:c.qv.Work},...n}},Y=(e,t,n)=>{"object"==typeof e&&(e.context=e.context||I.JN,e.subContext=e.subContext||t,e.correlationId=e.correlationId||n)},Q=(e,t,n,i,a)=>{const o=`${e?.subContext}: Failed to get skype token; correlationId:${e.correlationId}, status:${a}, message:${t}, eventData: ${n?.join(";")}`;return e.isExpected?i.debug(o):i.error(o),e},J=(e,t,n)=>{const i=e?.join(";"),a=n?.get(s.w.Metadata)||{},o=n.get(s.w.Auth);return{message:`${i}::isOnline-${t}::environment:${a?.environment}`,endpointUrl:o?.authzUrl,resource:o?.authzResource}},K=(e,t,n,a,r,l,c)=>{const{serverResponse:{status:d,body:u}={}}=e;let{message:m,errorCode:p}=e;const{reason:g,code:h}=e,y=n&&!(e.context===i.Ir.RejectHttpError&&h===i.O4.RemoteOperationFailed),S=t?.join(";");d&&(p=P(d),m=u.message);const f={reason:g,message:m,eventData:S},k=(0,N.y)((0,w.hR)(f)),C=e.correlationId,b=l?.get(s.w.Metadata)||{},T=l.get(s.w.Auth);void 0===e.isExpected&&(e.isExpected=!y||E.indexOf(p)>-1);const A={context:e?.context??I.JN,subContext:e?.subContext,message:`${m}::isOnline-${y}::env:${b?.environment}`,errorCode:y?p??h:i.O4.NetworkOffline,statusCode:d,correlationId:C,reason:k,endpointUrl:T?.authzUrl,resource:T?.authzResource,isExpected:!y||e.isExpected};if(c&&c(A),!((0,w.hR)(e.reason)?.indexOf("LoggedAlready")>-1)&&a){let t=((e,t,n)=>{const{errorCode:a,code:r}=t;if(!e||t.isExpected||n===o.nW.FORBIDDEN||n===o.nW.PROXY_AUTHENTICATION_REQUIRED||a===i.O4.NetworkOffline||r===i.O4.NetworkOffline)return"cancel";if(a===i.O4.TimedOut||r===i.O4.TimedOut)return"incomplete";switch(n){case o.nW.NOT_AUTHORIZED:case-1:case o.nW.THROTTLED:return"incomplete";default:return"fail"}})(y,e,d);switch(t=(0,v.$z)(e)?"incomplete":t,t){case"stop":a.stop(A);break;case"incomplete":a.incomplete(A);break;case"cancel":a.cancel(A);break;default:a.fail(A)}}return Q(e,m,t,r,d)};function Z(e){return E.indexOf(e.code)>-1||"Authentication::getUser"===e.subContext&&e.message.indexOf("User information is not available")>-1||e.message.indexOf("getUser: MSAL account not found")>-1||e.message.indexOf("Get skype token promise timed out, keep retrying. Is expected:true")>-1}function X(e,t,n,i,a){return t.getUser().then((()=>{const o=ne(i,a),{requireSkypetokenForMT:r}=i.get(s.w.Auth),l=t.authorize(e,o);return r?n.authorize(l,"x-skypetoken"):l}))}function ee(e,t,n,i){return t.getUser().then((()=>{const a=ne(n,i);return t.authorize(e,a)}))}function te(e,t,n){return t.getUser().then((()=>{const{cmdMeetingArtifactsServiceResource:i}=n.get(s.w.CMDMeetingArtifactsService);return t.authorize(e,i??"")}))}function ne(e,t){const{isRunningGlassjar:n,mtAuthResourceOverride:i}=e.get(s.w.Test);if(n&&i)return i;const{authOverrides:a}=e.get(s.w.Host),{mtResource:o,mtResourceV2:r}=e.get(s.w.Auth);return t?r||g.fP.AAD_V2_TFL:a?.mtResource||o||g.fP.MT}const ie=(e,t,n,i,a)=>{if(!e)return void i.log("Failed to obtain telemetry details from discovery.");if(!n)return void i.log("Failed to obtain telemetry provider from getTelemetryProviderInstance.");const o=e.licenseDetails?.isFreemium,{environment:r}=t.get(s.w.Metadata);(e.licenseDetails?.experimentationTeamsLicenseCategories||e.licenseDetails?.experimentationTeamsAddOnPlans||e.licenseDetails?.isTeamsSmb)&&a.getUser().then((t=>{n.setContext("UserInfo.ExpTeamsLicense",e.licenseDetails?.experimentationTeamsLicenseCategories,void 0,t.profile.oid),n.setContext("UserInfo.ExpTeamsAddOnPlan",e.licenseDetails?.experimentationTeamsAddOnPlans,void 0,t.profile.oid),e.licenseDetails?.isTeamsSmb&&n.setContext("UserInfo.IsSmb",e.licenseDetails?.isTeamsSmb,void 0,t.profile.oid)})).catch((e=>i.error("Failed to get Oid from User Profile",e)));const l=r===g.BV.life?c.qv.Life:o?c.qv.Freemium:c.qv.Work;if(r===g.BV.life&&o&&i.warn("The Environment indicates TFL, but Freemium is true - defaulting telemetry to TFL Tenant.Model"),n.setContext("UserInfo.Region",e.region),n.setContext("Tenant.Model",l),e.consumerLicenseDetails?.consumerLicenseDetails){const t=e.consumerLicenseDetails?.consumerLicenseDetails?.licensedProducts?.map((e=>e.skuName)).sort().join(",");n.setContext("UserInfo.IsLicensed",!!e.consumerLicenseDetails?.consumerLicenseDetails?.hasTeamsLicense),n.setContext("UserInfo.Licenses",t)}},ae=async(e,t,n,i,a)=>{const{disableClaimsChallenge:o}=i.get(s.w.Auth);if(o)a.log("[unauthorizedErrorHandler] Claims challenge handling disabled.");else if(e)if(t)f.Vh.deleteType(t,"Token");else{const e=await n.getUser();f.Vh.deleteType((0,S.X_)(e),"Token")}else a.log("[unauthorizedErrorHandler] No header passed in.")},oe=e=>{const t=f.Vh.getValue((0,k.Xr)((0,S.X_)(e)).meetingDetails);if(!t)return;const{messageId:n,conversationId:i,tenantId:a,rootMessageId:o}=t;return n===o?`${a}${i}${n}`:`${a}${i}${n}${o}`},re=(e,t)=>({isAdvComms:de(e?.isAdvComms),isTranscriptEnabled:de(e?.isTranscriptEnabled),isFreemium:de(e?.isFreemium),isTrial:de(e?.isTrial),isWebinarEnabled:de(e?.isWebinarEnabled),isPrivacyDataControlEnabled:de(e?.isPrivacyDataControlEnabled),eduLicenseSkuAndCategory:e?.eduLicenseSkuAndCategory||void 0,isBasicLiveEventsEnabled:de(e?.isBasicLiveEventsEnabled),isCopilot:de(e?.isCopilot),isGroupCopilot:de(e?.isGroupCopilot),isM365CopilotBusinessChat:de(e?.isM365CopilotBusinessChat),isTPProtection:de(e?.isTPProtection),isTPCustomization:de(e?.isTPCustomization),isTPManagement:de(e?.isTPManagement),isTPWebinar:de(e?.isTPWebinar),isTPVirtualAppointments:de(e?.isTPVirtualAppointments),isInfoProtectionPremium:de(e?.isInfoProtectionPremium),isTeamsPhonePremium:de(e?.isTeamsPhonePremium),isTeamsSmb:de(e?.isTeamsSmb),isAvatarsEnabled:de(e?.isAvatarsEnabled),isImmersiveSpacesEnabled:de(e?.isImmersiveSpacesEnabled),isTeamsPremiumSelfAssigned:de(e?.isTeamsPremiumSelfAssigned),isTeamsSharedDevices:de(e?.isTeamsSharedDevices),exploratoryTrialLicenseEndDate:le(e?.exploratoryTrialLicenseEndDate,t),hasOnlyTeamsSharedDevices:de(e?.hasOnlyTeamsSharedDevices),isTeamsDeviceManagementEnabled:de(e?.isTeamsDeviceManagementEnabled),...se(e),meetingRoomLicenseCategories:e?.meetingRoomLicenseCategories||void 0}),se=e=>({experimentationTeamsLicenseCategories:e?.experimentationTeamsLicenseCategories||void 0,experimentationTeamsAddOnPlans:e?.experimentationTeamsAddOnPlans||void 0}),le=(e,t)=>{try{if(e&&!isNaN(Date.parse(e)))return new Date(e)}catch{t.log("Failed to parse date string from license details")}},ce=(e,t,n,i,a=m.Cu.GetSkypeToken)=>{const{disableAuthTelemetryForDiscover:o}=t.get(s.w.Auth);let r,l,c;return!e||o?r=i.newScenario(a):([c,l]=(0,C.we)({scenarioName:a,source:e.source,subContext:n,options:{correlation:{...e,scenarioName:a}}}),c.addEventData(["using auth telemetry"])),{scenario:r,closeTelemetry:l,authTelemetry:c}},de=e=>e||!1},44522:(e,t,n)=>{"use strict";n.d(t,{m:()=>d,V:()=>u});var i=n(270560),a=n(509387),o=n(176737),r=n(50737),s=n(754255),l=n(702183),c=n(81670);async function d(e,t,n,o,r){const{enableSkypeTokenEncryption:d,enableEncryptionKeyMaglev:u}=r.get(s.w.Auth);if(!d)return e;const m=n.newScenario(l.Cu.AuthWebEncryptToken);m.mark("auth_web_encrypt_token_start");const p=await(0,i.rJ)(t,o,void 0,!!u);if(!p)return m.mark("auth_web_encrypt_token_stop",{reason:"tokenEncryption:MissingEncryptionKey"}),m.stop(),e;try{const n=t.crypto.getRandomValues(new Uint8Array(c.FQ.SIXTEEN)),i=(new TextEncoder).encode(e.skypeToken),o=await t.crypto.subtle.encrypt({name:"AES-CBC",iv:n},p,i);e.encryptedToken=(0,a.J)(o),e.iv=(0,a.J)(n),m.mark("auth_web_encrypt_token_stop",{reason:"tokenEncryption:success"}),m.stop()}catch(e){m.mark("auth_web_encrypt_token_stop",{error:e,reason:e?.message},"failure"),m.fail()}return e}async function u(e,t,n,c,d){const{enableSkypeTokenEncryption:u,enableEncryptionKeyMaglev:m}=d.get(s.w.Auth);if(!u||!e.encryptedToken||e.skypeToken)return e;const p=n.newScenario(l.Cu.AuthWebDecryptToken);p.mark("auth_web_decrypt_token_start");const g=await(0,i.rJ)(t,c,void 0,!!m);if(!g)return p.mark("auth_web_decrypt_token_stop",{reason:"Missing encryption key for decryption"}),p.stop(),e;let h=e.iv;if(h||(h=o.Vh.getValue(r.O4.initializationVector)),!h)return p.mark("auth_web_decrypt_token_stop",{reason:"Missing initialization vector for decryption"}),p.stop(),e;try{const n=(0,a.X)(h),i=(0,a.X)(e.encryptedToken),o=await t.crypto.subtle.decrypt({name:"AES-CBC",iv:n},g,i);e.skypeToken=(new TextDecoder).decode(o),p.mark("auth_web_decrypt_token_stop"),p.stop()}catch(e){p.mark("auth_web_decrypt_token_stop",{error:e,reason:e?.message},"failure"),p.fail()}return e}},340506:(e,t,n)=>{"use strict";n.d(t,{w2:()=>G});var i=n(272978),a=n(754255),o=n(403097),r=n(921103),s=n(854190),l=n(99425),c=n(953730),d=n(702183),u=n(127671),m=n(943982),p=n(634664),g=n(779898),h=n(364836),v=n(553882),y=n(879462),S=n(458648),f=n(82346),k=n(588111),C=n(880607);const b=(e,t)=>{const n=e.decode(t);if("Left"===n._tag){const e=C.pN.report(n);throw new TypeError(e.join("\n"))}return n.right};var w=n(853551),T=n(795269),I=n(199448),N=n(850434),A=n(657120),E=n(899855);const F=(0,w.OH)({isNotificationEnabled:w.zM,isUnifiedPresenceEnabled:w.zM,isOutOfOfficeIntegrationEnabled:w.zM,isContactMigrationEnabled:w.zM,isAppsDiscoveryEnabled:w.zM,isFederationEnabled:w.zM}),_=(0,w.OH)({licenseDetails:i.ed}),D=(0,w.OH)({regionSettings:F}),P=(0,w.OH)({userRegion:w.Yj}),M=(0,w.OH)({partition:w.Yj}),R=(0,w.OH)({userPartition:w.Yj}),x=(0,w.E$)([(0,w.NW)({region:w.Yj,regionGtms:i.Y0,tokens:(0,w.NW)({skypeToken:w.Yj,expiresIn:w.ai})}),(0,w.E$)([D,_,P,M,R])]),L=(0,w.NW)({skuId:w.Yj,skuName:w.Yj,maxMeetingDurationMinutes:w.ai,maxMeetingParticipants:w.ai}),O=(0,w.E$)([(0,w.NW)({hasTeamsLicense:w.zM}),(0,w.OH)({teamsFree:(0,w.NW)({maxMeetingDurationMinutes:w.ai,maxMeetingParticipants:w.ai}),licensedProducts:(0,w.YO)(L)})]),j=(0,w.OH)({consumerLicenseDetails:O}),B=(0,w.E$)([(0,w.NW)({regionGtms:i.Y0,skypeToken:(0,w.NW)({skypetoken:w.Yj,expiresIn:w.ai})}),j,_]),U=(0,w.NW)({skypeTokenData:(0,w.NW)({regionGtms:i.Y0,token:(0,w.NW)({skypeToken:w.Yj,expiration:w.ai,userDetails:(0,w.OH)({region:w.Yj})})})},"token"),$=(0,w.NW)({skypeid:w.Yj}),W=1e3,V="Discover",H="https://api.spaces.skype.com",z="retry_skype_token_step";function q(e){return h.getParser(e.navigator.userAgent).isBrowser("ie",!0)}class G{constructor(e,t,n,d,m,p,h,y,f,k,C,w=(0,g.z)()){this.aad=e,this.coreSettings=d,this.scenarioFactory=m,this.isOnline=p,this.shouldNotDecodeTokenForIE=h,this.onDiscoverSuccess=y,this.onDiscoverFail=f,this.isCDLWorker=k,this.cdlAuthClient=C,this.globalScope=w,this._localStorageKeys=[],this.licenseTypeToTenantType=e=>e?o.qv.Freemium:o.qv.Work,this._canGetSkypeTokenFromHost=()=>!!this.bootstrapData,this._acquireSkypeTokenWorker=async(e=!1)=>{if(!this.cdlAuthClient)return Promise.reject("CDL worker auth client unavailable");try{const t=await this.cdlAuthClient.getSkypeToken(e);return{...t.userDetails,skypeToken:t.skypeToken,regionGtms:b(i.Y0,t.regionGtms),expires:new Date(t.expiration)}}catch(e){throw e.response?.serverResponse&&(e.serverResponse=e.response.serverResponse),e.context=e.context??V,e}},this._acquireRegionGtmTableWorker=async()=>{if(!this.cdlAuthClient?.getRegionGtmTable)return this.logger.log("cdl getRegionGtmTable not implemented"),Promise.resolve(void 0);const e=await this.cdlAuthClient.getRegionGtmTable();return e?b(i.Y0,e):(this.logger.log("cdl getRegionGtmTable did not get the table"),Promise.resolve(void 0))},this._acquireUserDetailsWorker=async()=>{if(!this.cdlAuthClient)return Promise.reject("CDL worker auth client unavailable");const e=await this.cdlAuthClient.getUserDetails();return this._mapUserDetailsToUser(e.id,e.userDetails)},this._acquireSkypeTokenDesktop=()=>this.globalScope.opener.requestMessage(r.pI.GetStateData,{requestType:"skypeToken",timeout:S.uM.ACQUIRE_TOKEN_TIMEOUT}).then((e=>b(U,e))).then((({skypeTokenData:{regionGtms:e,token:{skypeToken:t,expiration:n,userDetails:i}}})=>({...i,skypeToken:t,regionGtms:e,expires:new Date(n)}))),this._acquireSkypeTokenWeb=()=>{const e=Date.now(),{authOverrides:t}=this.coreSettings.get(a.w.Host),{authzEndpointUrl:n,authzUrl:i,regionGtmsEnv:o,disableT21AuthZDefaultUrl:r}=this.coreSettings.get(a.w.Auth),{doNotPassTenantIdForAnonMeetingJoins:c}=this.coreSettings.get(a.w.Calling)||{},d=r?"https://authsvc.teams.microsoft.com/v1.0/authz":"https://teams.microsoft.com/api/authsvc/v1.0/authz",u=t?.authzEndpointUrl||n||i||d;return this.aad.getUser().then((t=>{const n=this.getResponseFromLocalStorage(t.profile.oid,t.profile.tid);if(n)return n;let i={method:"POST",url:o?`${u}?region_gtms_env=${o}`:`${u}`,serviceName:s.p.Auth,apiName:"acquireSkypeTokenWeb"};if(t.role===l.a7.Anonymous&&(i=c?{...i,url:`${u}/visitor`}:{...i,url:`${u}/visitor`,body:`{"tenantId": "${t.profile.tid}"}`}),q(this.globalScope)&&this.shouldNotDecodeTokenForIE)return this.send().then((t=>t(i).then((({body:e})=>e.json())).then((t=>({...t,tokens:{...t.tokens,expires:new Date(e+t.tokens.expiresIn*W)}})))));{const n=this.send().then((e=>e(i).then((({body:e})=>e.json())))),a=t.type===l.aS.MsaLife;return this.parseAuthzResponse(n,a,e)}}))},this._copilotLicenseFromBootstrapData=()=>{const e=this.bootstrapData?.licenseDetails;return{isCopilot:e?.isCopilot||!1,isGroupCopilot:e?.isGroupCopilot||!1,isM365CopilotBusinessChat:e?.isM365CopilotBusinessChat||!1}},this._copilotLicense=e=>({isCopilot:e?.isCopilot||!1,isGroupCopilot:e?.isGroupCopilot||!1,isM365CopilotBusinessChat:e?.isM365CopilotBusinessChat||!1}),this.logger=t.newLogger("Discover","core-services-discover"),this.send=()=>function(e,t,n){return t.getUser().then((()=>{const{authzResource:i}=n.get(a.w.Auth);return t.authorize(e,i||H)}))}(n,e,this.coreSettings).then((e=>(0,u.c)(e,c.nW.OK))),this._skypeToken=new v.t(null),this.bootstrapData=this.coreSettings.get(a.w.Host).authBootstrapData,this.telemetryProvider=(0,A.AR)(),e.observeMiddleTierToken?.()?.subscribe((e=>{void 0===e&&(this._discoveryResponse=void 0)}))}observeSkypeToken(){return this._skypeToken.pipe((0,y.p)((e=>null!==e)))}shouldThrowErrorIfSkypeTokenIsEmpty(){return!this.coreSettings.get(a.w.Auth).disableThrowingErrorIfSkypeTokenIsEmpty}getSettingToDisableSkypeTokenValidation(e,t){return(0,k.uq)(e,t,this.coreSettings,this.logger,this.scenarioFactory)}shouldSkipTokenRefreshForAnon(){return!this.coreSettings.get(a.w.Auth).disableSkipTokenRefreshForAnon}regionGtm(e){return q(this.globalScope)&&this.shouldNotDecodeTokenForIE?this.getDiscovery().then((t=>{let n=t.regionGtms[e];if(n)return n===f.sb||n.endsWith("/")||(n+="/"),n;throw(0,I.$5)(V,N.O4.InvalidResponse,"regionGtm")})):this._getRegionGtmTable().then((e=>({regionGtms:e}))).catch((e=>{if(this._canGetSkypeTokenFromHost()){return{regionGtms:b(i.Y0,this.bootstrapData?.regionGtms)}}throw e})).then((({regionGtms:{[e]:t}})=>{if(void 0===t)throw(0,I.$5)(V,N.O4.InvalidResponse,"regionGtm",{},`${V}::regionGtm::${N.O4.InvalidResponse} - ${e} is missing in discover response`);return t===f.sb?t:t.href}))}async skypeid(e){const t=await this.getUser(e);return new Promise((e=>e(t.id)))}getRegion(){return this.getDiscovery().then((({region:e})=>e)).catch((e=>{if(this._canGetSkypeTokenFromHost()){const e=this.bootstrapData?.region;if(!e)throw(0,I.$5)(V,N.O4.InvalidResponse,"getRegion");return e}throw e}))}getUserRegionAndPartitionForMultiGeo(e,t){return this.getDiscovery(!1,t).then((({userRegion:e,userPartition:t,partition:n})=>({userRegion:e,userPartition:t,partition:n}))).catch((e=>{if(this._canGetSkypeTokenFromHost()){const e=this.bootstrapData?.userRegion,t=this.bootstrapData?.userPartition,n=this.bootstrapData?.partition;if(!e||!t||!n)throw(0,I.$5)(V,N.O4.InvalidResponse,"getUserRegionAndPartitionForMultiGeo");return{userRegion:e,userPartition:t,partition:n}}throw e}))}getUser(e){let t;if(this._canGetSkypeTokenFromHost()){const e=this.bootstrapData?.userId,t=this.bootstrapData?.region;if(e)return this.logger.log(`skypeid and region received from host: ${e} ${t}`),Promise.resolve(this._mapHostSkypeTokenToUser(e,t||void 0));this.logger.warn("skypeid or region was not received from host when expected")}return this.isCDLWorker?this._acquireUserDetailsWorker():this.getSkypeTokenInfoFromDiscoveryResponse({correlation:e}).then((e=>(t={id:e.userDetails.id,region:e.userDetails.region,userRegion:e.userDetails.userRegion||void 0,partition:e.userDetails.partition||void 0,userPartition:e.userDetails.userPartition||void 0,tenant:{type:this.licenseTypeToTenantType(e.userDetails.licenseDetails?.isFreemium)},isAdvComms:e.userDetails.licenseDetails?.isAdvComms,isTranscriptEnabled:e.userDetails.licenseDetails?.isTranscriptEnabled,isFreemium:e.userDetails.licenseDetails?.isFreemium||!1,isTrial:e.userDetails.licenseDetails?.isTrial||!1,isWebinarEnabled:e.userDetails.licenseDetails?.isWebinarEnabled||!1,isBasicLiveEventsEnabled:e.userDetails.licenseDetails?.isBasicLiveEventsEnabled||!1,eduLicenseSkuAndCategory:e.userDetails.licenseDetails?.eduLicenseSkuAndCategory||void 0,isTPProtection:e.userDetails.licenseDetails?.isTPProtection||!1,isTPCustomization:e.userDetails.licenseDetails?.isTPCustomization||!1,isTPManagement:e.userDetails.licenseDetails?.isTPManagement||!1,isTPWebinar:e.userDetails.licenseDetails?.isTPWebinar||!1,isTPVirtualAppointments:e.userDetails.licenseDetails?.isTPVirtualAppointments||!1,isInfoProtectionPremium:e.userDetails.licenseDetails?.isInfoProtectionPremium||!1,isTeamsPhonePremium:e.userDetails.licenseDetails?.isTeamsPhonePremium||!1,isTeamsSmb:e.userDetails.licenseDetails?.isTeamsSmb||!1,isAvatarsEnabled:e.userDetails.licenseDetails?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:e.userDetails.licenseDetails?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:e.userDetails.licenseDetails?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:e.userDetails.licenseDetails?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:(0,k.Ud)(e.userDetails.licenseDetails?.exploratoryTrialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:e.userDetails.licenseDetails?.hasOnlyTeamsSharedDevices||!1,isTeamsDeviceManagementEnabled:e.userDetails.licenseDetails?.isTeamsDeviceManagementEnabled||!1,meetingRoomLicenseCategories:e.userDetails.licenseDetails?.meetingRoomLicenseCategories,...this._copilotLicense(e.userDetails.licenseDetails)},t)))}async validateSkypeToken(e){return(await this.validateSkypeTokenV2(e)).skypeToken}validateSkypeTokenV2(e){const t=this.getDiscovery(!1,e.correlation),n=e?.forceRenew,i=e?.invalidSkypeToken;return t.then((({expires:t,skypeToken:a})=>{if(!n&&a!==i&&t.getTime()>Date.now()&&a)return{skypeToken:a,fromCache:!0};if(!a){const[t,n]=(0,E.we)({scenarioName:d.Cu.SkypeTokenUndefined,source:e.correlation.source,subContext:"discover",options:{correlation:{...e.correlation,scenarioName:d.Cu.SkypeTokenUndefined}}});n()}return this.resetDiscoveryResponse(),this.getDiscovery(n,e.correlation).then((({skypeToken:e})=>({skypeToken:e,fromCache:!1})))}))}async getSkypeTokenInfoFromDiscoveryResponse(e){return this.getDiscovery(!1,e.correlation).then((e=>{const{skypeid:t}=(0,T.as)($,(0,m.f)(e.skypeToken)),n=`8:${t}`;this.logger.log(`skypeid received from discovery: ${n}. Region: ${e.region}`);const i={id:n,region:e.region,userRegion:e?.userRegion,partition:e?.partition,userPartition:e?.userPartition,licenseDetails:{...e.licenseDetails,consumerLicenseDetails:e?.consumerLicenseDetails},regionOverride:e?.regionOverride,regionSettings:e.regionSettings};return{regionGtms:e.regionGtms,skypeToken:e.skypeToken,expiration:e.expires.getTime(),userDetails:i}})).catch((e=>{throw this.logger.error(`failed to get skypeid from discovery: ${(0,p.hR)(e)}â€‹â€‹`),e}))}async getConsumerLicenseDetails(e,t){return this.getSkypeTokenInfoFromDiscoveryResponse({correlation:t}).then((e=>e?.userDetails?.licenseDetails?.consumerLicenseDetails))}async _getRegionGtmTable(){if(this._regionGtmTable)return this._regionGtmTable;if(this.isCDLWorker){const e=await this._acquireRegionGtmTableWorker();if(e)return this.logger.log("regionGtm table received from main thread"),this._regionGtmTable=e,e}return this.logger.log("regionGtm table will be obtained via discoveryResponse"),(await this.getDiscovery()).regionGtms}parseAuthzResponse(e,t,n){return t?e.then((e=>b(B,e))).then((({regionGtms:e,licenseDetails:t,skypeToken:{skypetoken:i,expiresIn:a},consumerLicenseDetails:o})=>({regionGtms:e,skypeToken:i,expires:new Date(n+a*W),licenseDetails:t,consumerLicenseDetails:o?{consumerLicenseDetails:o,timeStamp:new Date}:void 0}))):e.then((e=>b(x,e))).then((({region:e,userRegion:t,partition:i,userPartition:a,licenseDetails:o,regionGtms:r,tokens:{skypeToken:s,expiresIn:l},regionSettings:c})=>({region:e,userRegion:t,partition:i,userPartition:a,regionGtms:r,skypeToken:s,expires:new Date(n+l*W),licenseDetails:o,regionSettings:c})))}getDiscovery(e=!1,t){if(!this._discoveryResponse){const{scenario:n,authTelemetry:i,closeTelemetry:a}=(0,k.M7)(t,this.coreSettings,"discover",this.scenarioFactory),o=this._canGetSkypeTokenFromHost()?this._acquireSkypeTokenDesktop:this.isCDLWorker?this._acquireSkypeTokenWorker:this._acquireSkypeTokenWeb,r=this.getDiscoveryResponse(o,n,0,e,i,a);return this.setDiscoveryResponse(r)}return this._discoveryResponse}async getDiscoveryResponse(e,t,n=0,i=!1,o,r){try{const n=await e(i);return t?t.stop():r?.(),this.onDiscoverSuccess&&this.onDiscoverSuccess(),(0,k.QK)(n,this.coreSettings,this.telemetryProvider,this.logger,this.aad),n}catch(s){let l=s;l.serverResponse?.body&&l.serverResponse?.body.json&&(l.serverResponse.body=await l.serverResponse.body.json().catch((e=>{s.message+=`::${e.message}`})));const{disableResponseParsing:c}=this.coreSettings.get(a.w.Auth);if(l=(0,k.St)(s,this.isOnline(),!!c),this.canRetry(n,l))return t&&t.mark(z,{message:l.message,reason:(0,p.hR)(l)}),o&&o.addScenarioMark(z,{message:l.message,reason:(0,p.hR)(l)}),this.getDiscoveryResponse(e,t,++n,this.coreSettings.get(a.w.Auth).useForceRenewInSkypeTokenRetry?i:void 0,o,r);throw this.onDiscoverFail&&this.onDiscoverFail(this._canGetSkypeTokenFromHost()),this.resetDiscoveryResponse(),(0,k.Sv)(t,l,!!c,r)}}resetDiscoveryResponse(){this._discoveryResponse=void 0,this.clearFromLocalStorage()}canRetry(e,t){return e<1&&t.code!==N.O4.NetworkOffline&&t.code!==N.O4.Forbidden&&t.code!==N.O4.ProxyAuthenticationRequired}setDiscoveryResponse(e){return e=e.then((e=>(this.logger.log("discoveryResponse set in memory"),this._regionGtmTable=e.regionGtms,this._skypeToken.next(e.skypeToken),e))),this._discoveryResponse=e}getResponseFromLocalStorage(e,t){let n=this.getFromLocalStorage(e,t,"auth.gtm.table");const a=this.getFromLocalStorage(e,t,"auth.skype.token");return n&&a?(q(this.globalScope)&&this.shouldNotDecodeTokenForIE||(n=b(i.Y0,n)),{...a.userDetails,skypeToken:a.skypeToken,expires:new Date(a.expiration),regionGtms:n}):null}getFromLocalStorage(e,t,n){if(!this.globalScope?.localStorage)return;let i=`ts.${t}-${e}.${n}`,a=this.globalScope.localStorage.getItem(i);if(a||(i=`ts.${e}.${n}`,a=this.globalScope.localStorage.getItem(i)),a){this._localStorageKeys.push(i);try{return JSON.parse(a)}catch(e){this.logger.error(e)}}}clearFromLocalStorage(){this.globalScope?.localStorage&&(this._localStorageKeys.forEach((e=>{this.globalScope.localStorage.removeItem(e)})),this._localStorageKeys=[])}getAdditionalUserInfo(){const e=this.bootstrapData?.userRegion,t=this.bootstrapData?.userPartition,n=this.bootstrapData?.partition;return{userRegion:e||void 0,userPartition:t||void 0,partition:n||void 0}}_mapHostSkypeTokenToUser(e,t){const n=this.bootstrapData?.licenseDetails,i=this.getAdditionalUserInfo();return{id:e,region:t||void 0,tenant:{type:this.licenseTypeToTenantType(n?.isFreemium)},isAdvComms:n?.isAdvComms||!1,isTranscriptEnabled:n?.isTranscriptEnabled||!1,isFreemium:n?.isFreemium||!1,isTrial:n?.isTrial||!1,isWebinarEnabled:n?.isWebinarEnabled||!1,isPrivacyDataControlEnabled:n?.isPrivacyDataControlEnabled||!1,eduLicenseSkuAndCategory:n?.eduLicenseSkuAndCategory||void 0,isBasicLiveEventsEnabled:n?.isBasicLiveEventsEnabled||!1,isTPProtection:n?.isTPProtection||!1,isTPCustomization:n?.isTPCustomization||!1,isTPManagement:n?.isTPManagement||!1,isTPWebinar:n?.isTPWebinar||!1,isTPVirtualAppointments:n?.isTPVirtualAppointments||!1,isInfoProtectionPremium:n?.isInfoProtectionPremium||!1,isTeamsPhonePremium:n?.isTeamsPhonePremium||!1,isTeamsSmb:n?.isTeamsSmb||!1,isAvatarsEnabled:n?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:n?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:n?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:n?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:(0,k.Ud)(n?.exploratoryTrialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:n?.hasOnlyTeamsSharedDevices||!1,...i,...this._copilotLicenseFromBootstrapData()}}_mapUserDetailsToUser(e,t){const{region:n,userRegion:i,partition:a,userPartition:o,licenseDetails:r}=t;return{id:e,region:n,userRegion:i,partition:a,userPartition:o,tenant:{type:this.licenseTypeToTenantType(r?.isFreemium)},isAdvComms:r?.isAdvComms||!1,isTranscriptEnabled:r?.isTranscriptEnabled||!1,isFreemium:r?.isFreemium||!1,isTrial:r?.isTrial||!1,isWebinarEnabled:r?.isWebinarEnabled||!1,isBasicLiveEventsEnabled:r?.isBasicLiveEventsEnabled||!1,eduLicenseSkuAndCategory:r?.eduLicenseSkuAndCategory||void 0,isTPProtection:r?.isTPProtection||!1,isTPCustomization:r?.isTPCustomization||!1,isTPManagement:r?.isTPManagement||!1,isTPWebinar:r?.isTPWebinar||!1,isTPVirtualAppointments:r?.isTPVirtualAppointments||!1,isInfoProtectionPremium:r?.isInfoProtectionPremium||!1,isTeamsPhonePremium:r?.isTeamsPhonePremium||!1,isTeamsSmb:r?.isTeamsSmb||!1,isAvatarsEnabled:r?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:r?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:r?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:r?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:(0,k.Ud)(r?.exploratoryTrialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:r?.hasOnlyTeamsSharedDevices||!1,...this._copilotLicense(r)}}}},561884:(e,t,n)=>{"use strict";n.d(t,{u:()=>m});var i=n(957234),a=n(953730),o=n(647561);var r=n(809038),s=n(588111),l=n(754255),c=n(854190),d=n(81670),u=n(792767);class m{constructor(e,t,n,a,o,r){this.aad=e,this.discover=t,this.coreSettings=n,this.loggerFactory=a,this.platformService=o,this.experienceConfig=r,this.skype=new i.j(this.discover);const{enableAadV2TokenForMiddleTier:s}=n.get(l.w.Auth);this.useAadV2Token=!!s}bind(e,t){switch(t){case"chatService":return this.chatServiceBind(e);case"cmdArtifactsService":return this.cmdArtifactsServiceBind(e);case"userProfileService":return async n=>(0,o.V)(await(0,s.S6)(this.addAdditionalHeadersToSend(e),this.aad,this.coreSettings,this.useAadV2Token),await this.discover.regionGtm(t))(n);case"middleTier":const n=this.coreSettings.get(l.w.Auth).sendMigrationHeaderToMtInGtm,i=this.coreSettings.get(l.w.Auth).disableSkypeTokenToMtInGtm,a={[d.OF]:"True"};return i?async n=>(0,o.V)(await(0,s.S6)(this.addAdditionalHeadersToSend(e,a),this.aad,this.coreSettings,this.useAadV2Token),await this.discover.regionGtm(t))(n):async i=>(0,o.V)(await(0,s.$X)(this.addAdditionalHeadersToSend(e,n?a:void 0),this.aad,this.skype,this.coreSettings,this.useAadV2Token),await this.discover.regionGtm(t))(i);case"unifiedPresence":return this.unifiedPresence||(this.unifiedPresence=this.unifiedPresenceBind(t)),this.unifiedPresence(e);case"urlp":case"urlpV2":case"ams":case"amsV2":return async n=>(0,o.V)(this.skype.authorize(e,"Authorization"),await this.discover.regionGtm(t))(n);case"mtImageService":return async n=>{const{mtImageServiceOverrideUrl:i}=this.coreSettings.get(l.w.Test),a=i||await this.discover.regionGtm(t);return(0,o.V)(e,a)(n)};default:return this.defaultBind(e,t)}}defaultBind(e,t){return async n=>{const i=await this.discover.regionGtm(t);return(0,o.V)(this.aad.authorize(e,i),i)(n)}}unifiedPresenceBind(e){const{requireConsumerTypeHeader:t,requireSkypetoken:n}=this.coreSettings.get(l.w.Presence);return function(e,t){let n;return i=>async r=>{for(let s=0;;++s){n||(n=await t());const l=await(0,o.V)(e(i,n),n)({...r,headers:{...r.headers,BehaviorOverride:"redirectAs404"}}),{status:c,headers:{location:d}}=l;if(c!==a.nW.NOT_FOUND||!d||s>2)return l;n=new URL("/",d).href}}}(((e,i)=>{const a=n?this.skype.authorize(e,"x-skypetoken"):this.aad.authorize(e,i);return t?async e=>(e={...e,headers:{...e.headers,"x-ms-client-consumer-type":"teams4life"}},a(e)):a}),(()=>this.discover.regionGtm(e)))}chatServiceBind(e){return this.chatService||(this.chatService=(0,r.yv)((e=>this.skype.authorize(e)),(e=>this.discover.regionGtm(e)),this.coreSettings,this.loggerFactory)),this.chatService(e)}cmdArtifactsServiceBind(e){const{cmdMeetingArtifactsServiceEndpoint:t}=this.coreSettings.get(l.w.CMDMeetingArtifactsService);return async n=>(0,o.V)(await(0,s.Zy)(e,this.aad,this.coreSettings),t??"")(n)}addAdditionalHeadersToSend(e,t){if(this.coreSettings.get(l.w.Core).enableCommonMtHeadersWithSend){const n=(0,u.B)(this.platformService,this.experienceConfig);return i=>e({...i,headers:{...n,...t,[c.f.xMsRequestId]:i.correlationId||"",...i.headers}})}return e}}},515490:(e,t,n)=>{"use strict";var i,a;n.d(t,{n:()=>i,g:()=>a}),function(e){e.AssignExternalIcon="AssignExternalIcon",e.AssignedPriorityStatusToToast="AssignedPriorityStatusToToast",e.CallsActionTypeToNotificationActionFailed="CallsActionTypeToNotificationActionFailed",e.CallingToastActionMutationFailed="CallingToastActionMutationFailed",e.ChatActionTypeToNotificationActionFailed="ChatActionTypeToNotificationActionFailed",e.ChatTabsFetchFailed="ChatTabsFetchFailed",e.ChatToastActionMutationFailed="ChatToastActionMutationFailed",e.ChatToastEmoticonsQueryFailed="ChatToastEmoticonsQueryFailed",e.ChannelToastEmoticonsQueryFailed="ChannelToastEmoticonsQueryFailed",e.CollectionIdUndefined="CollectionIdUndefined",e.ConversionToHostEntityOptionsFailed="ConversionToHostEntityOptionsFailed",e.ConversationAlerts="ConversationAlerts",e.ConversationIsMuted="ConversationIsMuted",e.ConversationFetchFailed="ConversationFetchFailed",e.DateConversionFailed="DateConversionFailed",e.DefinedIfToastCanIgnoreConversationMuted="DefinedIfToastCanIgnoreConversationMuted",e.DuplicateToast="DuplicateToast",e.EmptyEvent="EmptyEvent",e.EventFromSelf="EventFromSelf",e.EventDiscarded="EventDiscarded",e.ExtractedSettings="ExtractedSettings",e.ImageFetchFailed="ImageFetchFailed",e.ImageUrlGenerationFailed="ImageUrlGenerationFailed",e.LogToastInfo="LogToastInfo",e.MappingCommandOptions="MappingCommandOptions",e.MappingOfToastInResolver="MappingOfToastInResolver",e.GraphItemToastUnhandledType="GraphItemToastUnhandledType",e.NoAutheticatedUserOrTrackingService="NoAutheticatedUserOrTrackingService",e.NotEnabled="NotEnabled",e.PriorityAssignmentSkipped="PriorityAssignmentSkipped",e.RequiredFieldMissing="RequiredFieldMissing",e.ReturningFetchedImage="ReturningFetchedImage",e.ReturningHardcodedImage="ReturningHardcodedImage",e.ReturningUserKeyForToastCollection="ReturningUserKeyForToastCollection",e.SkippingPriorityMessageFromLongpoll="SkippingPriorityMessageFromLongpoll",e.SubscriptionFailed="SubscriptionFailed",e.Subscribing="Subscribing",e.ToastCommandSent="ToastCommandSent",e.ToastEventIsAlreadyRead="ToastEventIsAlreadyRead",e.ToastEventReceivedInJob="ToastEventReceivedInJob",e.ToastEventReceivedInWorkerResolver="ToastEventReceivedInWorkerResolver",e.ToastImageAsDataUriIsUndefined="ToastImageAsDataUriIsUndefined",e.ToastNavigationDataNotFound="ToastNavigationDataNotFound",e.ToastSuppressedForWindowInFocus="ToastSuppressedForWindowInFocus",e.UnhandledType="UnhandledType",e.UnhandledSubtype="UnhandledSubtype",e.UpdateBlockingCacheWithOSDnD="UpdateBlockingCacheWithOSDnD",e.OSDnDBannerJobUserFetchFailed="OSDnDBannerJobUserFetchFailed",e.YieldingToastFromWorkerResolver="YieldingToastFromWorkerResolver",e.MentionHandledByActivityManager="MentionHandledByActivityManager",e.InvalidType="InvalidType",e.ToastDisabledByCoreSettings="ToastDisabledByCoreSettings",e.MissingConversationId="MissingConversationId",e.CommunityEvent="CommunityEvent",e.MappingException="MappingException",e.ProfileFetchFailed="ProfileFetchFailed",e.ToastThrottled="ToastThrottled",e.GetNearbyTagQueryFailed="GetNearbyTagQueryFailed"}(i||(i={})),function(e){e.PhonelinkSmsPrefix="phonelink:"}(a||(a={}))},489294:(e,t,n)=>{"use strict";n.d(t,{x:()=>r,r:()=>s});var i=n(199448),a=n(850434);let o;const r=e=>async t=>{if(!o)return e(t);return e(t).then((e=>(o?.processResponse(e),e))).catch((e=>{throw o?.processError(e),e}))};function s(e,t){if(o){throw(0,i.$5)(a.Ir.Tasks,a.O4.AlreadyInitialized,"subscribeToSendNetworkTracking",void 0,"subscription exists")}o={processResponse:e,processError:t};return()=>{o=void 0}}},134005:(e,t,n)=>{"use strict";n.d(t,{h:()=>y,i:()=>S});var i=n(767435),a=n(364819);function o(e,t){const n=t?":":"",i=e.id?`/${n}${e.id}`:"",a=e.action?`/${e.action}`:"";return`${e.resource}${i}${a}`}function r(e){const{descriptor:t,asPath:n,stem:i="",...a}=e;let r=i;const s=t?t.resources:void 0;if(s&&s.length>0)for(const e of s)r=`${r}/${o(e,n)}`;return{...a,descriptor:t,asPath:n,stem:r}}function s(e){const{context:t,asPath:n,stem:i=""}=e;let a=i;if(t){const e=t.router;if(!e)throw new Error("Cannot generate a relative path without a context. Verify a context was added provided");{const t=n?e.route.match.path:e.route.match.url;a="/"!==t?`${t}${a}`:a}}return{...e,stem:a}}function l(e){const{descriptor:t,asPath:n,stem:a=""}=e;let o=a;if(t){const e=(r=t.search,(0,i.stringify)(r||{}));e&&(o=`${o}${n?`/:${e}`:`?${e}`}`)}var r;return{...e,stem:o}}class c{constructor(e,t,n){this._location=t,this._history=n,this._logger=e.newLogger("State Routing Service","core-services-routing")}getSearchState(){const e=this.getLocation();if(!e)return{};const t=e.search;return t!==this._previousSearch&&(this._previousSearch=t,this._currentState=function(e){return(0,i.parse)(e||"")}(t)),this._currentState||{}}getOrigin(){const e=this.getLocation();return e&&e.origin}getHost(){const e=this.getLocation();return e&&e.host}getPathname(){const e=this.getLocation();return e&&e.pathname}getLocation(){if(this._location||this._logger.error("Unable to execute on location. Location initialized with undefined"),this._location&&this._history&&this._history.location){const{search:e,pathname:t}=this._history.location;return{...this._location,search:e,pathname:t}}return this._location}}var d,u,m=n(199448),p=n(850434);!function(e){e.apps="apps",e.broadcasts="broadcasts",e.chats="chats",e.calls="calls",e.calendars="calendars",e.extensions="extensions",e.files="files",e.licenses="licenses",e.meetings="meetings",e.teamgallery="teamgallery"}(d||(d={})),function(e){e.list="list",e.create="create",e.join="join",e.error="error",e.view="view"}(u||(u={}));class g{meetingOptionsPageDescriptor(e){const{tenantId:t,organizerId:n,threadId:i,messageId:a,additionalMessageId:o,search:r}=e;return{resources:[{resource:d.meetings,id:JSON.stringify({tenantId:t,organizerId:n,threadId:i,messageId:a,additionalMessageId:o})}],search:r}}meetingOptionsLicenseDescriptor(e){return{resources:[{resource:d.licenses,action:u.list}],search:e?e.search:void 0}}}class h{constructor(e,t){this._history=t,this._logger=e.newLogger("External Routing Service","core-services-routing")}serializeToPath(e){const{descriptor:t,exact:n}=e;let i="";return t&&(i=function(e){return(0,a.flow)([r,s,l])(e).stem}({descriptor:t})),this._history?n||(i=this._history.createHref({pathname:i}).toString()):n&&this._logger.error("Unable to execute on history to generate absolute path. History initialized with undefined"),i}}let v;const y=(e,t,n)=>{const i={state:new c(e,n,t),meeting:new g,external:new h(e,t)};return v=i,v},S=()=>{if(!v)throw(0,m.$5)("RoutingServices",p.O4.NotInitialized,"getInstance");return v}},478237:(e,t,n)=>{"use strict";n.d(t,{CC:()=>s,ZG:()=>o,Pq:()=>r});var i=n(754255),a=n(364819);const o=e=>{const t=e.get(i.w.Host).enableSyncEngine;return(0,a.isNil)(t)?!!e.get(i.w.CdlWorker).enableSyncEngine:t},r=e=>{const t=e.get(i.w.Host).enableProfileManagerStore;return(0,a.isNil)(t)?!!e.get(i.w.People).enableProfileManagerStore:t},s=e=>{const{dataStoreMapType:t,disableDataStoreInMemoryProvider:n}=e.get(i.w.CdlWorker);return n?"none":t||"red-black-tree"}},363424:(e,t,n)=>{"use strict";n.d(t,{nY:()=>c,Bx:()=>d,el:()=>u,S1:()=>m,_l:()=>p,Ck:()=>g,pZ:()=>k});var i=n(136723),a=n(327402),o=n(754255),r=n(105878);const s="99999999999",l="ringFinder",c="https://config.teams.microsoft.com",d="1.0.0.0",u="1415",m="MicrosoftTeams";function p(e){const t=Object.keys(r.S).filter((e=>isNaN(Number(e))));for(let n=0;n<t.length;n++)if(e===t[n])return n}function g({experienceName:e,coreSettings:t,platformService:n,user:a,locale:r,logger:s}){const p=function(e,t,n){const{primaryUserProfile:a}=e.get(o.w.Host);if(a){const{oid:e,tid:t}=a;return{userId:e,tenantId:t}}return n||function(e){try{const e=i.get(l);if(!e)return;const{oid:t,tid:n}=JSON.parse(decodeURIComponent(e));return{userId:t,tenantId:n}}catch(t){return void e.warn(`Error parsing ringFinder cookie when user not authenticated: ${t}`)}}(t)}(t,s,a),{ecsOverrides:g,config:{platformId:k,buildVersion:C,buildType:b,browser:w,osPlatform:T,isOcdi:I}}=n,{ecsNamespaces:N,criticalEcsNamespaces:A,ecsEndpoint:E,enableEcsNativeRingResolution:F,disableSendOsVersionWithEcsRequest:_,enableUbrInOsVersion:D}=t.get(o.w.Core),P=function(e,t){const{environment:n="prod",ring:i,originalRing:a}=e,o={environment:n};t&&!a||(o.audienceGroup=i,o.teamsRing=i);return o}(g,F),{ecsHostUrl:M,electronVersion:R,windowsInsiderChannel:x,windowsInsiderRing:L}=t.get(o.w.Host),{deviceInfo:O,isPwa:j}=t.get(o.w.Platform),B=g.hostUrl||M||E||c,U=k||u,$=f(p?.userId,s,"userId"),W=f(p?.tenantId,s,"tenantId");return{version:`${U}_${d}`,domain:B,client:m,agents:N,criticalAgents:A,filters:{...P,experience:e,buildType:b,virtualization:y(t,n),browser:w,osPlatform:T,wipChannel:x,wipRing:L,osVersion:_?void 0:h(O,!!D,s),isOcdi:I?.toString(),isPwa:j?.toString(),id:$,aaduserid:$,tenantId:W,experienceBuild:S(b,C),desktopVersion:v(t,n),electronVersion:R,teamsLocale:r,teamsLicenseCategory:p?.teamsLicenseCategories,teamsAddOnPlan:p?.teamsAddOnPlans,mtmaCount:p?.mtmaCount}}}function h(e,t,n){if(!e||!e.osVersion)return;let i=e.osVersion;if(t&&e.ubrVersion&&!isNaN(parseInt(e.ubrVersion,10))&&(i=`${e.osVersion}.${e.ubrVersion}`),(0,a.validate)(i))return i;n.errorNoPii?.(`osVersion parsed from deviceInfo is not a proper semver '${i}'.`)}function v(e,t){const{desktopVersion:n}=e.get(o.w.Host);if(n){const e=n.indexOf("/");return e>-1?n.substr(e+1):n}return t.host.hostAppVersion}function y(e,t){const{virtualization:n}=e.get(o.w.Host);return n??t.config.vdi?.configFilter??""}function S(e,t){if("local"===e||"container"===e)return s;if(t){const e="1.0.0.20",n=6;if((t=`${t}`).startsWith(e)){const i=t.substring(e.length,e.length+n),a=t.substring(e.length+n);t=`${i}000${a}`}const i=parseInt(t,10);if(!isNaN(i))return i.toString()}}function f(e,t,n){if(e){if(/^[0-9a-fA-F\-]*$/i.test(e))return e;t.warn(`ID contains illegal characters: ${e}, context: ${n}`),t.warnToTelemetry?.(`Verification of ${n} failed.`,"ecs_utils_id_verification_failed_event",void 0,!0)}}function k(e){if(!e)return;const t=e.getTime(),n=(new Date).getTime();return t<n?n-t:0}},21534:(e,t,n)=>{"use strict";n.d(t,{tg:()=>w,s_:()=>E});var i,a=n(754255),o=n(700188),r=n(953730),s=n(403097);!function(e){e.HEALTHY="healthy",e.UNHEALTHY="unhealthy",e.UNKNOWN="unknown"}(i||(i={}));var l=n(762322),c=n(817542),d=n(634664),u=n(657120),m=n(554186),p=n(199448),g=n(364819);const h={headers:{sharePoint:{SPRequestGuid:"SPRequestGuid",SPClientServiceRequestDuration:"SPClientServiceRequestDuration",SPRequestDuration:"SPRequestDuration"}}},v="cache",y="cache-control",S="x-cache",f="electron";var k;!function(e){e.CDN="CDN",e.Shared="Shared",e.Browser="Browser",e.None="None"}(k||(k={}));let C="";async function b(e){const{status:t,responseHeaders:n,requestHeaders:i,performance:a}=e,o=await a;return Object.assign(e,{requestHeaders:(r=i,I(["clientRequestId","x-ms-request-id","x-ms-client-caller","x-ms-request-priority"],r)),responseHeaders:A(t,n),performance:D(o)});var r}const w=(e,t,n,r="")=>{const s=(t.get(a.w.Telemetry).httpnsDisabledServices??[]).map((e=>e.toLowerCase()));return async t=>{const{serviceName:a,apiName:h,result:v,innerError:y,operationLogs:S}=t;if(y&&(0,p.WZ)(y))return;t.operationLogs=await function(e){const t=e.map((async e=>{const{type:t,duration:n,result:i,request:a}=e;return{type:t,duration:n,result:i,request:a&&await b(a)}}));return Promise.all(t)}(S);const f=a.toLowerCase(),k=s.some((e=>e===f));C=r;const w=t.correlationId||(0,m.v4)(),I=R(a,h),N=(0,g.first)(t.operationLogs.map((e=>e.request?.responseHeaders?.serverRequestId)).filter(Boolean)),A=`Data call ${I} is completed with ${v}. CorrelationId: ${w}. ServerRequestId: ${N}.`;n.log(A),k||t.operationLogs.forEach((t=>{if(t.request){const{name:n,method:i}=t.request;F(e,M(a,n||h,i),"EM",t,w)}})),function(e,t,n){const{serviceName:a,apiName:r,createdTime:s,duration:m,parameters:p,result:g,statusCode:h,innerError:v,operationLogs:y}=e,S=function(e,t){const n=(0,u.AR)().getEndpointHealth(e,t);return void 0===n?i.UNKNOWN:n?i.HEALTHY:i.UNHEALTHY}(a,r);y.forEach((e=>{if(e.request){const{method:t}=e.request;!function(e,t,n,i,a,r,s){const l=t.request;if(l){const{duration:u,result:m}=t,{method:p,hostname:g,performance:h,responseHeaders:v,requestHeaders:y,dateTime:S,authPerformanceLogs:f}=l,k={apiName:i,serviceName:a,duration:u,result:T(m),correlationId:n,method:p,hostname:g,responseHeaders:(0,d.hR)(v),requestHeaders:(0,d.hR)(y),healthState:r,timestamp:S.toISOString(),hasInnerError:!!s};h&&(h.duration&&(k.perf_duration=h.duration.toString()),k.perf_details=(0,d.hR)({...h,...f})),(0,c.wW)(o.Q.Endpoint,e,k,void 0,void 0,void 0,C)}}(M(a,r,t),e,n,r,a,S,v)}}));const f=g===l.B.RequireStatusFailed?`${g}-${h}`:g,k={apiName:r,serviceName:a,duration:m,result:f,innerError:(0,d.hR)(v),correlationId:n,userAgent:t.navigator.userAgent,timestamp:s,operationLogs:(0,d.hR)(y),parameters:(0,d.hR)(p),ECT:t.navigator?.connection?.effectiveType,healthState:S},b=R(a,r);(0,c.wW)(o.Q.Endpoint,b,k,void 0,void 0,void 0,C)}(t,e,w)}};function T(e){let t;return e instanceof Error&&(t=e.innerException?`${e.reason} / ${(0,d.hR)(e.innerException)}`:e.reason),t||e||""}function I(e,t){const n={};return t&&e.forEach((e=>{t[e]&&(n[e]=t[e])})),n}function N(e=""){if(!e)return e;let t=0;return e.split(",").forEach((e=>{const n=e.split("/");t+=+n[0]+ +n[1]})),`${t}`}function A(e,t){return t?{contentLength:t["content-length"]||"-1",serverRequestId:t.contextid||t["x-serverrequestid"]||t["request-id"]||_(t),[v]:P(e,t),requestId:t["x-ms-request-id"],invalidToken:t["x-invalid-token"],afdCorrelationId:t["x-msedge-ref"],serverLatency:t["x-end2endlatencyms"],serviceOrigin:t["x-servicering"],cafeLatency:N(t["x-cafeproxylatency"]),requestPriority:t["x-ms-request-priority"]}:{}}const E=(e,t,n,i,a,o,s)=>{const l=s||r.nW[i?.status]||"",c=function(e){const t={};if(e)for(const n of Object.keys(e.headers)){t[n.toLowerCase()]=e.headers[n]}return t}(i),{serviceName:d,apiName:u,method:m,authPerformanceLogs:p}=n;F(o,M(d,u,m),"SEND",{type:r.ew.Initial,duration:e,result:l,request:{name:u||"undefined",dateTime:t,method:n.method,hostname:i&&new URL(i.url).hostname,status:i?.status,requestHeaders:n.headers||{},responseHeaders:c,performance:a,authPerformanceLogs:p}},n.correlationId)};const F=({navigator:e},t,n,i,a)=>{const l=i.request;if(l){const{dateTime:u,method:m,hostname:p,status:g,requestHeaders:h,responseHeaders:y,performance:S,authPerformanceLogs:k}=l,b={ECT:e?.connection?.effectiveType,hostname:p,transport:n,requestCreatedTime:u.toISOString(),networkState:e.onLine?s.Kv.ONLINE:s.Kv.OFFLINE,method:m,resultCode:g,requestResult:T(i.result),contentLength:y["content-length"]||-1,serverRequestId:y.contextid||y["x-serverrequestid"]||y["request-id"]||_(y),correlationId:a,duration:i.duration,authPerformanceLogs:(0,d.hR)(k)};!function(e,t,n,i,a){const o=i&&i.clientRequestId,s=n["x-ms-request-id"]||i["x-ms-request-id"];e.requestId=s,o&&(e.clientRequestId=o);n["x-invalid-token"]&&(e.invalidToken=n["x-invalid-token"]);t!==r.nW.OK&&(e.afdCorrelationId=n["x-msedge-ref"]);e.hasClaims=!!a&&!!a.hasClaims}(b,g,y,h,k),b[v]=P(g,y),function(e,t,n){if(n){const i=n.domainLookupEnd-n.domainLookupStart,a=n.connectEnd-n.connectStart,o=n.redirectEnd-n.redirectStart;if(i>0&&(e.dns=i),a>0&&(e.tcp=a),o>0&&(e.redirect=o),e.size=n.transferSize,e.payload=n.encodedBodySize,e.start=n.startTime,e.reqStart=n.requestStart,e.respStart=n.responseStart,n.duration){const i=n.duration;(-1===t.userAgent.toLowerCase().indexOf(f)||e.duration&&i>e.duration)&&(e.duration=i)}}}(b,e,S),(0,c.wW)(o.Q.Http,t,b,void 0,void 0,void 0,C)}};function _(e){let t=e[h.headers.sharePoint.SPRequestGuid.toLowerCase()]||"";return"[object String]"===Object.prototype.toString.call(t)&&t.length>0&&(t=[`${h.headers.sharePoint.SPRequestGuid}=${t}`,`${h.headers.sharePoint.SPClientServiceRequestDuration}=${e[h.headers.sharePoint.SPClientServiceRequestDuration.toLowerCase()]||""}`,`${h.headers.sharePoint.SPRequestDuration}=${e[h.headers.sharePoint.SPRequestDuration.toLowerCase()]||""}`].join(";")),t}function D(e){if(e){const{duration:t,domainLookupStart:n,domainLookupEnd:i,connectStart:a,connectEnd:o,redirectStart:r,redirectEnd:s,transferSize:l,encodedBodySize:c,startTime:d,requestStart:u,responseStart:m}=e;return{duration:t,dns:i-n,tcpHandshakeTime:o-a,redirectTime:s-r,transferSize:l,encodedBodySize:c,startTime:d,requestStart:u,responseStart:m}}return{}}function P(e,t){let n=k.None;if(t.hasOwnProperty(y)){const i=t[y];e===r.nW.NOT_MODIFIED?n=k.Browser:i.includes("no-store")||i.includes("no-cache")||(n=k.Browser,i.includes("public")&&(n+=", ".concat(k.Shared)))}else t.hasOwnProperty("expires")&&(n=k.Browser);if(t.hasOwnProperty(S)){t[S].toLowerCase().includes("hit")&&(n===k.None?n=k.CDN:n+=", ".concat(k.CDN))}return n}function M(e,t,n){return`${e}_${t||"undefined"}_${n}`}function R(e,t){return`${t}_${e}`}},720639:(e,t,n)=>{"use strict";n.d(t,{g:()=>s});var i=n(953730),a=n(199448),o=n(850434),r=n(867564);function s(e){return async t=>{try{return await e(t)}catch(e){if(e instanceof TypeError&&e.message?.toLowerCase()===r.p7){const n=t.headers&&t.headers.cache;if(n&&-1!==n.indexOf("only-if-cached"))return{status:i.nW.GATEWAY_TIMEOUT};e=(0,a.$5)(o.Ir.RejectHttpError,o.O4.RemoteOperationFailed,"rejectHttpError",void 0,e.message)}throw e}}}},809038:(e,t,n)=>{"use strict";n.d(t,{yv:()=>d,Q2:()=>u,sm:()=>m});var i=n(953730),a=n(754255),o=n(141102),r=n(647561);const s=10,l="",c=/\/api\/chatsvc\/.*?\//;function d(e,t,n,a){let o=l;const c=a.newLogger("chat-service-redirect","core-services-transport");return a=>async d=>{let g=0;for(;;){p(o)&&(o=await m(t,n,c));const h=await(0,r.V)(e(a),o)({...d,headers:{...d.headers,BehaviorOverride:"redirectAs404"}}),{status:v,headers:{location:y}}=h;if(!y||v!==i.nW.NOT_FOUND)return v===i.nW.SERVICE_UNAVAILABLE||v===i.nW.BAD_GATEWAY?(o=l,h):h;if(g>=s)return h;if(o=u(y,n,c),o===l)return h;g+=1}}}function u(e,t,n){let i;try{i=new URL(e)}catch(t){return n.error(`Location header ${e} is invalid: error message ${t.message}`),l}const{chatServiceAfdHostnames:o}=t.get(a.w.ChatService,["chatServiceAfdHostnames"]);if((o||[]).includes(i.hostname)){const t=i.pathname.match(c);return t&&t[0]?`${i.origin}${t[0]}`:(n.error(`No match of chatServiceAfd 404 location with regex, url is ${e}`),l)}return n.log("Url is a ATM Url, use previous parsing strategy."),new URL("/",e).href}async function m(e,t,n){const{chatServiceHostOverrideUrl:i}=t.get(a.w.Test);if(i)return(r=i).endsWith("/")?r:`${r}/`;var r;if(function(e){return e.get(a.w.Host).enableUseChatServiceAfd??e.get(a.w.ChatService).useChatServiceAfd??void 0}(t))try{return await e("chatServiceAfd")}catch(t){if((0,o.$)(t))return n.warn("Flag useChatServiceAfd is set but chatServiceAfd was not found in the GTM table. Falling back to chatService."),e("chatService");throw t}return e("chatService")}function p(e){return e===l}},867564:(e,t,n)=>{"use strict";n.d(t,{cS:()=>i,p7:()=>a,Us:()=>o});const i=3e4,a="failed to fetch",o="Request Timed Out"},119872:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(953730),a=n(199448),o=n(850434);function r(e){return async t=>{const n=await e(t);if(n.status>=i.nW.BAD_REQUEST)throw(0,a.$5)(o.Ir.RejectHttpError,o.O4.RemoteOperationFailed,"rejectHttpError",void 0,void 0,n);return n}}},24959:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>S,sc:()=>f,nC:()=>y});var i=n(850434),a=n(859876),o=n(825141),r=n(575061),s=n(751076),l=n(263183),c=n(846659),d=n(431047),u=n(432720),m=n(924988),p=n(667665),g=n(185026);const h=([e,t])=>(t&&e.do((()=>{}),(e=>{throw e})),e),v=(e,t)=>{const n=e.pipe((0,r.S)(((e,n)=>e||!t(n)),!1)),i=e.pipe((0,s.$)(t),(0,l.w)(5e3));return(0,o.F)((0,c.O)(),(0,d.E)(n),(0,u.T)(h),(0,m.l)((e=>e.pipe((0,p.S)(i)))),(0,g.Z)())};function y(e,t){return(...n)=>(0,a.v)((()=>e(...n))).pipe(v(t,k)).toPromise()}const S=e=>(e=>{switch(e){case i.TL.Disabled:case i.TL.Offline:return!1;default:return!0}})(e),f=e=>()=>S(e.getState()),k=e=>e},489431:(e,t,n)=>{"use strict";n.d(t,{H:()=>r,w:()=>s});var i=n(850434),a=n(113901),o=n(780952);function r(e,t){return n=>c((()=>e(n)),t)}function s(e,t){return n=>d(c((()=>e(n)),t),t)}const l=(e,t)=>{if(e.context===i.Ir.RejectHttpError&&t.retryCount++<(t.policy.maxRetryCountForOffline||t.policy.maxRetryCount)&&t.policy.shouldRetryRejectHttpError)return t.policy.errorHandler(e,t);if(!e.serverResponse)throw e;const{serverResponse:{status:n}}=e;if(n&&t.retryCount++<t.policy.maxRetryCount&&t.policy.shouldRetry(n))return t.retriesTable[n]=(t.retriesTable[n]||0)+1,t.policy.errorHandler(e,t);throw e},c=(e,t)=>(0,a.L)(e,l)({policy:t,delay:t.createDelay(),retryCount:0,retriesTable:{}}),d=(e,t)=>(0,o.a)(e,t.retryMaxTimeMs)},378193:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});var i=n(34412),a=n.n(i),o=n(780952),r=n(867564);const s=({url:e,method:t,body:n,headers:i,credentials:s,timeout:l=r.cS,skipHeaders:c=!1})=>{const d=new AbortController;return(0,o.a)(a()(e,{method:t,headers:c?{}:i&&new Headers(i),body:n,credentials:s,signal:d.signal}),l,r.Us,d).then((e=>{const t={};return e.headers.forEach(((e,n)=>t[n]=e)),{status:e.status,headers:t,body:e,url:e.url}}))}},291678:(e,t,n)=>{"use strict";n.d(t,{t:()=>s});var i=n(489294),a=n(21534);var o=n(378193),r=n(720639);const s=(0,i.x)(function(e){return async t=>{let i,o;const r=performance.now(),s=new Date;try{return o=await e(t),o}catch(e){throw i=e.code||e.message,o=e.serverResponse,e}finally{!function(e,t,i,o,r){const s=n.g;(0,a.s_)(o,t,i,e,e&&function(e){const t=performance.getEntriesByName(e);if(t.length>0&&"resource"===t[t.length-1].entryType)return t[t.length-1];return}(e.url),s,r)}(o,s,t,performance.now()-r,i)}}}((0,r.g)(o.b)))},917947:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataApolloClientCommunitiesHeaderStateMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isExpanded"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateCommunitiesHeaderState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isExpanded"},value:{kind:"Variable",name:{kind:"Name",value:"isExpanded"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommunitiesHeaderState"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isExpanded"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommunitiesHeaderStateError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}}]}}]}}]}}]}},163358:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataApolloClientCommunitiesHeaderStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"communitiesHeaderState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isExpanded"}}]}}]}}]}},435010:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataApolloClientTacoArchiveTeamInfoQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"archiveTeamResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"archiveSharepointSite"}}]}}]}}]}},418633:(e,t,n)=>{"use strict";n.d(t,{sV:()=>E,Rm:()=>I,o:()=>N,s3:()=>F,dX:()=>A,UV:()=>_});var i=n(269483);const a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageFieldsForDeletedMessages"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentHash"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"users"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"time"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"itemId"}},{kind:"Field",name:{kind:"Name",value:"userId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"mentionType"}}]}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"userHasSaved"}},{kind:"Field",name:{kind:"Name",value:"diagnosticInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"diagnosticErrorCode"}},{kind:"Field",name:{kind:"Name",value:"diagnosticMessage"}}]}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"baseUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"previewUrl"}},{kind:"Field",name:{kind:"Name",value:"previewHeight"}},{kind:"Field",name:{kind:"Name",value:"previewWidth"}}]}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"FragmentSpread",name:{kind:"Name",value:"deletionInfo"}}]}},...a.definitions]},r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"deletedMessages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletedMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"message"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"messageFieldsForDeletedMessages"}}]}}]}}]}},...o.definitions]};var s=n(878451);const l={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedReplyChainMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ReplyChainMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};s.W.definitions,l.definitions;var c=n(392003);const d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedMeetingReplyMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingReplyMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};c.f.definitions,d.definitions;var u=n(1997);const m={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedStandardPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StandardPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};u.f.definitions,m.definitions;var p=n(145635);const g={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedAnnouncementPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnnouncementPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};p.P.definitions,g.definitions;var h=n(607630);const v={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedEmailPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmailPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};h.g.definitions,v.definitions;var y=n(313923);const S={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedMeetingPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};y.v.definitions,S.definitions;var f=n(214898);const k={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedConnectorPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ConnectorPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};f.T.definitions,k.definitions;var C=n(961286);const b={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedGuardiansPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"GuardiansPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};C.m.definitions,b.definitions;var w=n(435793);const T="cacheDeletedMessages";function I(e,t){const{message:n}=P(e,t.id,t.clientMessageId,void 0,!t?.deleteTime),i=n&&n.message&&"Urgent"===n.message.importance;return{__typename:"MessageDeletionInfo",showMessageAsDeleted:!!n,canBeUndeleted:!!n&&!i,deleteFailed:!1}}function N(e,t,n,i){try{const{message:a}=P(e,t,n,i);if(a){const{message:n}=a,i={...n,id:t},r=`Message:${t}`;return e.writeFragment({id:r,fragmentName:"messageFieldsForDeletedMessages",fragment:o,data:i}),i}}catch(e){i.errorToTelemetry?.(`Failed to recoverDeletedMessageInCache for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function A(e,t,n,i,o,r,s=!1){const{fragment:c,fragmentName:u}=function(e){switch(e){case"Message":default:return{fragment:a,fragmentName:"deletionInfo"};case"ReplyChainMessage":return{fragment:l,fragmentName:"DataClientChatDeletedReplyChainMessageFragment_deletionInfo"};case"MeetingReplyMessage":return{fragment:d,fragmentName:"DataClientChatDeletedMeetingReplyMessageFragment_deletionInfo"};case"StandardPostMessage":return{fragment:m,fragmentName:"DataClientChatDeletedStandardPostMessageFragment_deletionInfo"};case"AnnouncementPostMessage":return{fragment:g,fragmentName:"DataClientChatDeletedAnnouncementPostMessageFragment_deletionInfo"};case"EmailPostMessage":return{fragment:v,fragmentName:"DataClientChatDeletedEmailPostMessageFragment_deletionInfo"};case"MeetingPostMessage":return{fragment:S,fragmentName:"DataClientChatDeletedMeetingPostMessageFragment_deletionInfo"};case"ConnectorPostMessage":return{fragment:k,fragmentName:"DataClientChatDeletedConnectorPostMessageFragment_deletionInfo"};case"GuardiansPostMessage":return{fragment:b,fragmentName:"DataClientChatDeletedGuardiansPostMessageFragment_deletionInfo"}}}(n),p=`${n}:${t}`;try{const n=e.readFragment({id:p,fragment:c,fragmentName:u});n&&e.writeFragment({id:p,fragment:c,data:{...n,id:t,deleteTime:r,isDeletedByAdmin:s,deletionInfo:{__typename:"MessageDeletionInfo",showMessageAsDeleted:!1,canBeUndeleted:!i,deleteFailed:i},version:(0,w.yT)()[0].toString()}})}catch(e){o.errorToTelemetry?.(`Failed to updateCachedMessageForDelete for messageId: ${t}, fragmentName: ${u}, deleteFailed: ${i}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function E(e,t,n){let i=[];try{if(i=D(e,n),i.find((e=>e.id===t)))return;const a=`Message:${t}`,s=e.readFragment({id:a,fragment:o,fragmentName:"messageFieldsForDeletedMessages"}),l={...s,id:`${s.id}_deleted`},c={id:t,message:l,__typename:"DeletedMessage"};return i=[c,...i],e.writeQuery({query:r,data:{deletedMessages:i}}),c}catch(e){n.errorToTelemetry?.(`Failed to addDeletedMessageToCacheForUndelete for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function F(e,t,n,i){try{const a=D(e,i),{message:s,isDeletedLieMessage:l}=P(e,t,n,i,!1,a);if(s){const i=a.filter((e=>l?e.message?.clientMessageId!==n:e.id!==t)),c={...s.message,id:t,isDeletedByAdmin:!1,deletionInfo:{__typename:"MessageDeletionInfo",showMessageAsDeleted:!1,canBeUndeleted:!1,deleteFailed:!1},version:(0,w.yT)()[0].toString(),__typename:"Message"};e.writeQuery({query:r,data:{deletedMessages:i}});const d=`Message:${t}`;return e.writeFragment({id:d,fragment:o,data:c}),c}}catch(e){i.errorToTelemetry?.(`Failed to removeDeletedMessageFromCacheForUndelete for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function _(e,t,n,a){const o=i.J1`
    fragment messageFieldsNeeded on Message {
      deleteTime
      importance
      deletionInfo {
        showMessageAsDeleted
        canBeUndeleted
        deleteFailed
      }
      version
    }
  `,r=`Message:${t}`;try{const t=e.readFragment({id:r,fragment:o});t&&e.writeFragment({id:r,fragment:o,data:{deleteTime:n,importance:t.importance,deletionInfo:{__typename:"MessageDeletionInfo",showMessageAsDeleted:!!n,canBeUndeleted:!!n,deleteFailed:!1},version:(0,w.yT)()[0].toString(),__typename:"Message"}})}catch(e){a.errorToTelemetry?.(`Failed to updateCachedMessageForUndelete for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}const D=(e,t)=>{let n;try{n=e.readQuery({query:r})}catch(e){t?.errorToTelemetry?.("Failed to queryDeletedMessages","messaging_delete_message",{operationType:T},!0)}return n&&n.deletedMessages||[]},P=(e,t,n,i,a,o)=>{const r={message:null,isDeletedLieMessage:!1};if(!(o=o||D(e,i))||0===o.length)return r;if(!a){const e=o.find((e=>e.id===t));if(e)return{message:e,isDeletedLieMessage:!1}}const s=o.find((e=>e.message&&e.message.clientMessageId===n));return s?{message:s,isDeletedLieMessage:!0}:r}},668746:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"dlpDialogData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dlpDialogData"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isReport"}},{kind:"Field",name:{kind:"Name",value:"isOverride"}},{kind:"Field",name:{kind:"Name",value:"justification"}}]}}]}}]}},560266:(e,t,n)=>{"use strict";n.d(t,{UB:()=>s});var i=n(364819),a=n(754255);const o=[{predicate:e=>!!e.get(a.w.Presence).enablePresenceInWorker,resolvers:{query:["presence","presences"],mutation:["setPresence","setStatusNote","setCallStatePresence"],subscription:["presenceUpdateEvent","presenceUpdateEventBatch","presenceAvailabilityEvent","followPresenceUpdateEvent"]}},{predicate:e=>!!e.get(a.w.Host).enableEspInWorker||!!e.get(a.w.Esp).enableEsp,resolvers:{query:["espState","irisCampaign"],mutation:["recordEligibleSurface","recordDisplayedSurface","recordEspCompletedActions","triggerNotificationDisplay","triggerTfwNotificationDisplay","recordIrisExternalTelemetry"],subscription:["espTriggerEvent","espSurfaceShownEvent","espSurfacesUpdateEvent"]}},{predicate:e=>!!e.get(a.w.Guardians).enableMembersAndRelatedContactsWorkerResolver,resolvers:{query:["membersAndRelatedContacts"],mutation:[],subscription:[]}},{predicate:e=>!!e.get(a.w.Guardians).enableRelatedContactsWorkerResolver,resolvers:{query:["relatedContacts"],mutation:[],subscription:[]}},{predicate:e=>!(!e.get(a.w.Host)?.enableHybridDiscoverSurface&&!e.get(a.w.DiscoverSurface)?.enableHybridDiscoverSurface),resolvers:{query:["feed"],mutation:["feedback","discoverSurfaceUserPreferenceForEntities","removeHasUpdatedItemsFlag","startPolling","stopPolling","userActionFeedbackLog","sendDiscoverFeedRenderAction","setLastVisitedSurface"],subscription:["replyChainSummaryEvent","discoverFeedHasUpdatedItems","feedEvent"]}},{predicate:e=>!!e.get(a.w.WhatsNew).enableWhatsNew,resolvers:{query:["whatsNewState"],mutation:["recordWhatsNewDisplayedFeature","recordWhatsNewEntryPointPromotion","recordWhatsNewEntryPointUserAction"],subscription:[]}},{predicate:e=>!!e.get(a.w.VirtualConsumerEvents).enableVirtualConsumerEvents,resolvers:{mutation:["createVirtualConsumerEvent","deleteVirtualConsumerEvent","editVirtualConsumerEvent","rsvpToVirtualConsumerEvent"],query:["virtualConsumerEvent","virtualConsumerEventParticipants","virtualConsumerEvents","virtualConsumerEventsUserRecommendations"],subscription:["syncVirtualConsumerEvent","syncVirtualConsumerEventParticipants","syncVirtualConsumerEvents"]}},{predicate:e=>!!e.get(a.w.Onboarding).enableArkoseCaptchaChallenge,resolvers:{mutation:["resolveCaptchaChallenge"],query:["tflCaptchaChallenge"],subscription:["subscribeToCaptchaChallenge"]}},{predicate:e=>!!e.get(a.w.People).enableBatchUsersByEmailsAndPhonesWorkerResolver,resolvers:{query:["batchUsersByEmailsAndPhones"],mutation:[],subscription:[]}}],r=()=>({query:[],mutation:[],subscription:[]});function s(e,t,n,s){const d=function(e,t){let n;try{if(!t)throw new Error("CDL Worker did not return supported operations");n=JSON.parse(t)}catch(t){e.errorToTelemetry?.(`getWorkerSupportedOperations: Failed to set CDL Worker supported operations: ${t&&t.message}`,"cdl_worker_manager_get_worker_supported_operations_error",void 0,!0),n={query:[],mutation:[],subscription:[]}}const a=(0,i.mapValues)(n,(e=>e?new Set(e):new Set));return(0,i.pick)(a,["query","mutation","subscription"])}(t,n),{supportedResolvers:u,activitySupportedResolvers:m,mtmaMissedNotificationsSupportedResolvers:p,calendarSupportedResolvers:g,chatSupportedResolvers:h,chatPartiallySupportedResolvers:v,phonelinkSmsSupportedResolvers:y,appsUsageResolvers:S,tabsUsageResolvers:f,peopleTargetingSupportedResolvers:k,tflFeaturedCommunitiesSupportedResolvers:C}=e.get(a.w.CdlWorker),b=function(e){const t=r();return e.forEach((e=>e&&(0,i.mergeWith)(t,e,c))),t}([u,m,p,g,h,v,y,S,f,k,C]),w=(0,i.pick)(b,["query","mutation","subscription"]);return function(e,t,n,a){const o=r();t.forEach((({predicate:e,resolvers:t})=>{e(n)&&(0,i.mergeWith)(o,t,c)})),a.log(`Supported additional operations: ${JSON.stringify(o,l)}`),(0,i.mergeWith)(e,o,c)}(w,o,e,t),s?function(e,t,n,a){if(!e)return{query:new Set,mutation:new Set,subscription:new Set};n.log(`Supported operations received from ${a}: ${JSON.stringify(e,l)}`);const o=(0,i.mapValues)(e,((e,n)=>new Set(e.filter((e=>t[n]&&t[n].has(e))))));return n.log(`Merged datalayer settings with config: ${JSON.stringify(o,l)}`),o}(w,d,t,"Worker"):function(e,t,n,i,a,o){const r=function(e,t,n){const i={query:{},mutation:{},subscription:{}};return Object.keys(i).forEach((a=>{const o=e[a];if(o)for(const e of o)i[a][e]={fieldName:e,active:n,configurationDescription:t}})),i}(n,i,!1);if(!e)return a.log(`No supported resolvers for ${o}`),r;return Object.keys(e).forEach((n=>{if(!r[n])return;const i=e[n];if(i)for(const e of i){const i=r[n][e];i?i.active=!0:r[n][e]={fieldName:e,active:!1,configurationDescription:t}}})),function(e,t,n){const i={};Object.keys(t).forEach((e=>{const n=t[e];Object.keys(n).forEach((t=>{const a=n[t];if(!a.active){const t=a.configurationDescription;i[t]||(i[t]={query:[],mutation:[],subscription:[]}),i[t][e].push(a.fieldName)}}))})),Object.keys(i).forEach((t=>{const a=i[t],o=a.query,r=a.mutation,s=a.subscription;if(o.length>0||r.length>0||s.length>0){const i=`GraphQL Link for ${e}: ${t} has unsupported resolvers: query= ${o.length}, mutation=${r.length}, subscription=${s.length}.`;n.log(i)}}))}(o,r,a),r}(w,"resolversFromConfiguration",d,"supportedOperationsFromCDLWorker",t,"Worker")}const l=(e,t)=>"object"==typeof t&&t instanceof Set?Array.from(t):t,c=(e,t)=>(0,i.isArray)(e)?e.concat(t):void 0},46751:(e,t,n)=>{"use strict";n.d(t,{OI:()=>c,HB:()=>l,J9:()=>d});var i=n(199448),a=n(850434),o=n(364819),r=n(983959);const s=(e,t)=>{let n=null;try{n=e.readQuery({query:r.wX.currentFilesQuery,variables:{fileContainerId:t}})}catch(e){}return n||(n={currentFiles:[]}),n.currentFiles},l=(e,t,n)=>s(n,t).find((t=>t.id===e)),c=(e,t,n)=>{const i={currentFiles:[...s(t,n).map((t=>{const n=e.findIndex((e=>e.id===t.id));if(-1===n)return t;const i=e[n];e.splice(n,1);return(0,o.merge)({},t,i)})),...e]};t.writeQuery({query:r.wX.currentFilesQuery,variables:{fileContainerId:n},data:i})},d=(e,t,n)=>{const o=s(n,t),l=o.find((t=>t.id===e));if(!l)throw(0,i.$5)("FileUploadResolver",a.O4.NotPresent,"removecachefile",{logErrorMessage:`File with id: ${e} not found  in the cache`});const c=o.filter((t=>t.id!==e));return n.writeQuery({query:r.wX.currentFilesQuery,variables:{fileContainerId:t},data:{currentFiles:c}}),l}},759528:(e,t,n)=>{"use strict";n.d(t,{m:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"customAppUploadResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAppUploadResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAppType"}}]}}]}}]}},603912:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppDevicePermissionsUpdatedQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDevicePermissionsUpdated"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"status"}}]}}]}}]}},958956:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppsBadgeReadQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appsBadgeRead"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},785279:(e,t,n)=>{"use strict";n.d(t,{O:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformInContextStoreLaunchInstalledAppResultQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"inContextStoreLaunchInstalledAppResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"capability"}},{kind:"Field",name:{kind:"Name",value:"appDisplayName"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"botId"}},{kind:"Field",name:{kind:"Name",value:"appCommand"}}]}}]}}]}},513199:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformTabDeletionResultQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelMeetingMessageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tabDeletionResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"threadId"},value:{kind:"Variable",name:{kind:"Name",value:"threadId"}}},{kind:"Argument",name:{kind:"Name",value:"channelMeetingMessageId"},value:{kind:"Variable",name:{kind:"Name",value:"channelMeetingMessageId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"channelMeetingMessageId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}}]}}]}}]}},182747:(e,t,n)=>{"use strict";n.d(t,{a:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageExtensionsAppsState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageExtensionsAppsState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleRefetch"}}]}}]}}]}},763499:(e,t,n)=>{"use strict";n.d(t,{w:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"tabConfigurationResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tabConfigurationResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"threadId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"tabId"}}]}}]}}]}},756160:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webhookConfirmationResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webhookConfirmationResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},722428:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var i=n(441985),a=n(364819);function o(e,t,n){let i=[];try{i=n.getActiveWindows()}catch(t){e.errorToTelemetry?.("cache.readQuery failed for activeWindowsQuery","webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}return t?(0,a.cloneDeep)(i):i}const r=()=>({Query:{activeWindows:(e,t,{activeWindowsService:n,loggerFactory:i})=>o(i.newLogger("activeWindows-query","data-client-windows"),!1,n)},Mutation:{removeWindow(e,{windowId:t},{activeWindowsService:n,commandChangeReportingService:a,loggerFactory:r}){const s=r.newLogger("removeWindow-mutation","data-client-windows"),l=o(s,!0,n),c=l.findIndex((e=>e.id===t));if(c>=0){const e=function(e,t,n){const i=e.splice(t,1);return n.removeActiveWindowById(i[0].id),i[0]}(l,c,n);return a.report({type:i.I.Close,correlationId:e.correlation.id,context:{target:"remove-window-mutation"},userContextId:e.userContextId||void 0}),e}return s.warn(`Removing window that does not exist ${t}`),null}}})},82096:(e,t,n)=>{"use strict";n.d(t,{S:()=>a});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"sdnFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SDNDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"playbackInfo"}},{kind:"Field",name:{kind:"Name",value:"pluginUrl"}},{kind:"Field",name:{kind:"Name",value:"sdkUrl"}},{kind:"Field",name:{kind:"Name",value:"networkInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"mac"}},{kind:"Field",name:{kind:"Name",value:"bssid"}},{kind:"Field",name:{kind:"Name",value:"ssid"}},{kind:"Field",name:{kind:"Name",value:"primary"}},{kind:"Field",name:{kind:"Name",value:"primaryv4"}},{kind:"Field",name:{kind:"Name",value:"primaryv6"}},{kind:"Field",name:{kind:"Name",value:"ifUp"}},{kind:"Field",name:{kind:"Name",value:"addresses"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ipv4"}},{kind:"Field",name:{kind:"Name",value:"subnetLengthIpv4"}},{kind:"Field",name:{kind:"Name",value:"ipv6"}},{kind:"Field",name:{kind:"Name",value:"subnetLengthIpv6"}}]}}]}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"broadcastFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Broadcast"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"admissionType"}},{kind:"Field",name:{kind:"Name",value:"userRole"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"streamingDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"streamingDetailsFields"}}]}},{kind:"Field",name:{kind:"Name",value:"qna"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}},{kind:"Field",name:{kind:"Name",value:"attendeeUrl"}},{kind:"Field",name:{kind:"Name",value:"moderatorUrl"}},{kind:"Field",name:{kind:"Name",value:"iosAutodiscoverUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"yammer"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}},{kind:"Field",name:{kind:"Name",value:"broadcastId"}},{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"eventUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"meetingStatus"}},{kind:"Field",name:{kind:"Name",value:"sdn"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"sdnFields"}}]}},{kind:"Field",name:{kind:"Name",value:"transcription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}},{kind:"Field",name:{kind:"Name",value:"isSuppressed"}},{kind:"Field",name:{kind:"Name",value:"transcriptionLanguage"}},{kind:"Field",name:{kind:"Name",value:"translationLanguages"}},{kind:"Field",name:{kind:"Name",value:"captionsCacheUrl"}},{kind:"Field",name:{kind:"Name",value:"captionsOriginUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"aesKey"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"iv"}},{kind:"Field",name:{kind:"Name",value:"expiry"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"aesKeyRefresh"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"errorFields"}}]}},{kind:"Field",name:{kind:"Name",value:"utcStart"}},{kind:"Field",name:{kind:"Name",value:"utcEnd"}},{kind:"Field",name:{kind:"Name",value:"location"}},{kind:"Field",name:{kind:"Name",value:"supportUrl"}},{kind:"Field",name:{kind:"Name",value:"streamResource"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attendeeEmbed"}}]}},{kind:"Field",name:{kind:"Name",value:"signalR"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attendeeHubName"}},{kind:"Field",name:{kind:"Name",value:"eventTeamHubName"}},{kind:"Field",name:{kind:"Name",value:"setCookieUrl"}},{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"querystrings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"joinid"}},{kind:"Field",name:{kind:"Name",value:"msgid"}},{kind:"Field",name:{kind:"Name",value:"organizerid"}},{kind:"Field",name:{kind:"Name",value:"tenantid"}},{kind:"Field",name:{kind:"Name",value:"threadid"}},{kind:"Field",name:{kind:"Name",value:"uid"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"broadcastRestartVersion"}},{kind:"Field",name:{kind:"Name",value:"odspVodShareUrl"}},{kind:"Field",name:{kind:"Name",value:"access"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attendeeAuthorization"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"details"}},{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"subCode"}}]}},{kind:"Field",name:{kind:"Name",value:"disableLobby"}},{kind:"Field",name:{kind:"Name",value:"inInvitation"}},{kind:"Field",name:{kind:"Name",value:"useLiveEventAuthorizationV2"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"streamingDetailsFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BroadcastStreamingDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"stream"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"streamFields"}}]}},{kind:"Field",name:{kind:"Name",value:"altStream"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"streamFields"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"streamFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BroadcastStreamingInfo"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"wamsStreamingUrl"}},{kind:"Field",name:{kind:"Name",value:"wamsHlsStreamingUrls"}},{kind:"Field",name:{kind:"Name",value:"playbackCoordinates"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonPlaybackCoordinatesFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"decryptionToken"}},{kind:"Field",name:{kind:"Name",value:"decryptionKey"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"decryptionKeyFields"}}]}},{kind:"Field",name:{kind:"Name",value:"keyAuthorizationToken"}},{kind:"Field",name:{kind:"Name",value:"setKeyAuthorizationCookieUri"}},{kind:"Field",name:{kind:"Name",value:"sdn"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"sdnFields"}}]}},{kind:"Field",name:{kind:"Name",value:"deliveryPipelineType"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonPlaybackCoordinatesFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PlaybackCoordinate"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"sdnContext"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"decryptionKeyFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StreamDecryptionKey"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}.definitions,...i.definitions]}.definitions]}.definitions,...i.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"errorFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BroadcastErrorDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}},{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"errorSubCode"}}]}}]}.definitions]}},42857:(e,t,n)=>{"use strict";n.d(t,{e:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonActivitiesConnectionFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivitiesConnection"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"workerResponseTime"}},{kind:"Field",name:{kind:"Name",value:"workerExitTimestamp"}},{kind:"Field",name:{kind:"Name",value:"deletedActivityInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deletedActivityIds"}}]}},{kind:"Field",name:{kind:"Name",value:"isActivityTranslated"}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},...n(452593).K.definitions]}},452593:(e,t,n)=>{"use strict";n.d(t,{K:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FeedActivity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isRead"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"icon"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"titleParams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DefaultFeedLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"count"}},{kind:"Field",name:{kind:"Name",value:"isTranslated"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChannelFeedTitleLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"mentionName"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommunitiesFeedTitleLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"communityName"}},{kind:"Field",name:{kind:"Name",value:"userNickname"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"translatedTitle"}},{kind:"Field",name:{kind:"Name",value:"translatedTimestamp"}},{kind:"Field",name:{kind:"Name",value:"translatedLocation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"ignoreInSearch"}}]}},{kind:"Field",name:{kind:"Name",value:"translatedMessagePreview"}},{kind:"Field",name:{kind:"Name",value:"actorAriaLabel"}},{kind:"Field",name:{kind:"Name",value:"actorDisplayName"}},{kind:"Field",name:{kind:"Name",value:"location"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"ignoreInSearch"}},{kind:"Field",name:{kind:"Name",value:"isTranslated"}}]}},{kind:"Field",name:{kind:"Name",value:"locationInHeadlineSlice"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isNeededForHeadlineSlice"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"ignoreInSearch"}},{kind:"Field",name:{kind:"Name",value:"isTranslated"}}]}},{kind:"Field",name:{kind:"Name",value:"locationParams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DefaultFeedLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChannelFeedLocationLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"channelName"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommunitiesFeedLocationLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"communityName"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"messagePreview"}},{kind:"Field",name:{kind:"Name",value:"messagePreviewTemplateOption"}},{kind:"Field",name:{kind:"Name",value:"workerProcessingCompleteTimeStamp"}},{kind:"Field",name:{kind:"Name",value:"activity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activityId"}},{kind:"Field",name:{kind:"Name",value:"activityType"}},{kind:"Field",name:{kind:"Name",value:"activitySubtype"}},{kind:"Field",name:{kind:"Name",value:"threadType"}},{kind:"Field",name:{kind:"Name",value:"sourceMessageId"}},{kind:"Field",name:{kind:"Name",value:"sourceUserImDisplayName"}},{kind:"Field",name:{kind:"Name",value:"activityProcessingLatency"}},{kind:"Field",name:{kind:"Name",value:"webhookCorrelationId"}},{kind:"Field",name:{kind:"Name",value:"teamsAppId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"sourceApplicationType"}}]}},{kind:"Field",name:{kind:"Name",value:"activityNavigationParams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"replyChainId"}},{kind:"Field",name:{kind:"Name",value:"navigationTarget"}},{kind:"Field",name:{kind:"Name",value:"campaignType"}},{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}},{kind:"Field",name:{kind:"Name",value:"customParams"}}]}},{kind:"Field",name:{kind:"Name",value:"analytics"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamId"}},{kind:"Field",name:{kind:"Name",value:"chatModality"}},{kind:"Field",name:{kind:"Name",value:"isReplyMessage"}}]}},{kind:"Field",name:{kind:"Name",value:"supportedActions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"isDivided"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment_user"}}]}},{kind:"Field",name:{kind:"Name",value:"preferredProps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"isUnknownUser"}},{kind:"Field",name:{kind:"Name",value:"activityCustomProps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customIconUrl"}},{kind:"Field",name:{kind:"Name",value:"customAvatarMedia"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"avatarMediaType"}},{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"square"}},{kind:"Field",name:{kind:"Name",value:"hidePersonaCard"}},{kind:"Field",name:{kind:"Name",value:"team"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"badgeType"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment_user"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"userType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"enableAvatarUrlResolutionInActivityFeeds"}}}]}]},{kind:"Field",name:{kind:"Name",value:"givenName"}},{kind:"Field",name:{kind:"Name",value:"surname"}},{kind:"Field",name:{kind:"Name",value:"profileType"}},{kind:"Field",name:{kind:"Name",value:"mtoLabel"}}]}}]}.definitions]}},145635:(e,t,n)=>{"use strict";n.d(t,{P:()=>h});var i=n(568513),a=n(406909),o=n(954312),r=n(411234),s=n(46229),l=n(373558),c=n(952809),d=n(120157),u=n(509094),m=n(656074),p=n(136134),g=n(96562);const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonAnnouncementPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnnouncementPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"announcement"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"originalImageUrl"}},{kind:"Field",name:{kind:"Name",value:"croppedImageUrl"}},{kind:"Field",name:{kind:"Name",value:"colorTheme"}},{kind:"Field",name:{kind:"Name",value:"croppedImageHeight"}},{kind:"Field",name:{kind:"Name",value:"croppedImageWidth"}},{kind:"Field",name:{kind:"Name",value:"croppedImageAltText"}},{kind:"Field",name:{kind:"Name",value:"isTeamsIllustration"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"scheduledSendTime"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"meeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"languageSeenBefore"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"embeddedLinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmbeddedLinkFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"botMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageBotMetadataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"sendPipelineStatus"}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.S.definitions,...a.M.definitions,...o.r.definitions,...r.Z.definitions,...s.$.definitions,...l.p.definitions,...c.n.definitions,...d.K.definitions,...u.g.definitions,...m.u.definitions,...p.R.definitions,...g.C.definitions]}},42163:(e,t,n)=>{"use strict";n.d(t,{l:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChannelListChannelFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Channel"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"archivalLevel"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"explicitlyAdded"}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}},{kind:"Field",name:{kind:"Name",value:"isShown"}},{kind:"Field",name:{kind:"Name",value:"isShownByDefault"}},{kind:"Field",name:{kind:"Name",value:"isGeneral"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"isLie"}},{kind:"Field",name:{kind:"Name",value:"realThreadId"}},{kind:"Field",name:{kind:"Name",value:"isCreationFailed"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"isNewForUser"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"isUserMember"}},{kind:"Field",name:{kind:"Name",value:"hasBookmark"}},{kind:"Field",name:{kind:"Name",value:"unreadMessageCount"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}},{kind:"Field",name:{kind:"Name",value:"channelResourceTenantId"}},{kind:"Field",name:{kind:"Name",value:"areWorkflowsEnabled"}},{kind:"Field",name:{kind:"Name",value:"parentTeamId"}},{kind:"Field",name:{kind:"Name",value:"isSharedWithParentTeam"}},{kind:"Field",name:{kind:"Name",value:"substrateGroupId"}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Channel"}},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activityCount"}},{kind:"Field",name:{kind:"Name",value:"hasChannelMention"}},{kind:"Field",name:{kind:"Name",value:"hasTeamMention"}}]}}]}}]}},126469:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChannelListTeamFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Team"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelOnlyMember"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"dynamicMembership"}},{kind:"Field",name:{kind:"Name",value:"hasNewHiddenChannels"}},{kind:"Field",name:{kind:"Name",value:"hiddenChannelsCount"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"isCollapsed"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}},{kind:"Field",name:{kind:"Name",value:"isFavorite"}},{kind:"Field",name:{kind:"Name",value:"isUserMember"}},{kind:"Field",name:{kind:"Name",value:"isTenantWide"}},{kind:"Field",name:{kind:"Name",value:"isNewForUser"}},{kind:"Field",name:{kind:"Name",value:"lastJoinAt"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"pictureETag"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"teamGuestSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}},{kind:"Field",name:{kind:"Name",value:"deleteChannel"}}]}},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}},{kind:"Field",name:{kind:"Name",value:"deleteChannel"}},{kind:"Field",name:{kind:"Name",value:"updateConnectors"}}]}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"visibility"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Team"}},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalActivityCount"}},{kind:"Field",name:{kind:"Name",value:"hasChannelMention"}},{kind:"Field",name:{kind:"Name",value:"hasTeamMention"}}]}},{kind:"Field",name:{kind:"Name",value:"shouldShowHideTeamOnChannelShowHide"}}]}}]}},169885:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=n(91501),a=n(186827),o=n(2986);const r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChatCachedTitleFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"shortTitle"}},{kind:"Field",name:{kind:"Name",value:"creator"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"picture"}},{kind:"Field",name:{kind:"Name",value:"guardianChatInfo"}},{kind:"Field",name:{kind:"Name",value:"groupTemplate"}},{kind:"Field",name:{kind:"Name",value:"isBotBlocked"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOneBotChat"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"isMuted"}},{kind:"Field",name:{kind:"Name",value:"lastMessage"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListItemLastMessageFragment"}}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListItemLastUpdateFragment"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeLastUpdate"}}}]}]},{kind:"Field",name:{kind:"Name",value:"memberCount"}},{kind:"Field",name:{kind:"Name",value:"hasFederatedUser"}},{kind:"Field",name:{kind:"Name",value:"hasTflSmsUser"}},{kind:"Field",name:{kind:"Name",value:"hasTflSmsVerifiedUser"}},{kind:"Field",name:{kind:"Name",value:"hasTflConsumerUser"}},{kind:"Field",name:{kind:"Name",value:"cfet"}},{kind:"Field",name:{kind:"Name",value:"hasTypingUsers"}},{kind:"Field",name:{kind:"Name",value:"tflOffNetworkUserLength"}},{kind:"Field",name:{kind:"Name",value:"isUserMember"}},{kind:"Field",name:{kind:"Name",value:"localClientId"}},{kind:"Field",name:{kind:"Name",value:"isRead"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"isSfB"}},{kind:"Field",name:{kind:"Name",value:"isSmsOnly"}},{kind:"Field",name:{kind:"Name",value:"isFederated"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}},{kind:"Field",name:{kind:"Name",value:"isMeeting"}},{kind:"Field",name:{kind:"Name",value:"extendedDirectoryRedemptionRequired"}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}},{kind:"Field",name:{kind:"Name",value:"isBotMember"}},{kind:"Field",name:{kind:"Name",value:"hasMissedCall"}},{kind:"Field",name:{kind:"Name",value:"hasMissedMention"}},{kind:"Field",name:{kind:"Name",value:"hasMissedReaction"}},{kind:"Field",name:{kind:"Name",value:"arrivalTimeAriaLabel"}},{kind:"Field",name:{kind:"Name",value:"quarantineCounter"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}},{kind:"Field",name:{kind:"Name",value:"isPhonelinkSmsChat"}},{kind:"Field",name:{kind:"Name",value:"interopConversationStatus"}},{kind:"Field",name:{kind:"Name",value:"activeCall"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActiveCallFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"oneOnOneOtherMemberId"}},{kind:"Field",name:{kind:"Name",value:"hasGuestUser"}},{kind:"Field",name:{kind:"Name",value:"isTFWSmsChat"}}]}},...i.J.definitions,...a.n.definitions,...o.n.definitions]}},324419:(e,t,n)=>{"use strict";n.d(t,{V:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"activityId"}},{kind:"Field",name:{kind:"Name",value:"icon"}},{kind:"Field",name:{kind:"Name",value:"sourceMessageId"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}},607630:(e,t,n)=>{"use strict";n.d(t,{g:()=>h});var i=n(568513),a=n(406909),o=n(954312),r=n(411234),s=n(46229),l=n(394792),c=n(373558),d=n(952809),u=n(120157),m=n(509094),p=n(136134),g=n(96562);const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonEmailPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmailPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"emailDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"scheduledSendTime"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"languageSeenBefore"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"embeddedLinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmbeddedLinkFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"botMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageBotMetadataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"sendPipelineStatus"}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.S.definitions,...a.M.definitions,...o.r.definitions,...r.Z.definitions,...s.$.definitions,...l.V.definitions,...c.p.definitions,...d.n.definitions,...u.K.definitions,...m.g.definitions,...p.R.definitions,...g.C.definitions]}},313923:(e,t,n)=>{"use strict";n.d(t,{v:()=>h});var i=n(406909),a=n(954312),o=n(411234),r=n(46229),s=n(568513),l=n(656074),c=n(373558),d=n(952809),u=n(120157),m=n(509094),p=n(136134),g=n(96562);const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonMeetingPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"meeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"scheduledSendTime"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"languageSeenBefore"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"embeddedLinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmbeddedLinkFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"botMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageBotMetadataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"sendPipelineStatus"}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.M.definitions,...a.r.definitions,...o.Z.definitions,...r.$.definitions,...s.S.definitions,...l.u.definitions,...c.p.definitions,...d.n.definitions,...u.K.definitions,...m.g.definitions,...p.R.definitions,...g.C.definitions]}},392003:(e,t,n)=>{"use strict";n.d(t,{f:()=>h});var i=n(954312),a=n(411234),o=n(46229),r=n(406909),s=n(373558),l=n(952809),c=n(568513),d=n(656074),u=n(120157),m=n(509094),p=n(136134),g=n(96562);const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonMeetingReplyMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingReplyMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"isImportant"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"meeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"scheduledSendTime"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"attached"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"languageSeenBefore"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"embeddedLinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmbeddedLinkFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"botMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageBotMetadataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"sendPipelineStatus"}}]}},...i.r.definitions,...a.Z.definitions,...o.$.definitions,...r.M.definitions,...s.p.definitions,...l.n.definitions,...c.S.definitions,...d.u.definitions,...u.K.definitions,...m.g.definitions,...p.R.definitions,...g.C.definitions]}},878451:(e,t,n)=>{"use strict";n.d(t,{W:()=>h});var i=n(568513),a=n(954312),o=n(411234),r=n(46229),s=n(406909),l=n(373558),c=n(952809),d=n(509094),u=n(120157),m=n(136134),p=n(756806),g=n(96562);const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonReplyMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ReplyChainMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}},{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"isImportant"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"scheduledSendTime"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"attached"}},{kind:"Field",name:{kind:"Name",value:"urlPreview"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"previewEnabled"}},{kind:"Field",name:{kind:"Name",value:"thumbnail"}},{kind:"Field",name:{kind:"Name",value:"thumbnailMeta"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"languageSeenBefore"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"embeddedLinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmbeddedLinkFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"feedbackLoopEnabled"}},{kind:"Field",name:{kind:"Name",value:"sensitivity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}},{kind:"Field",name:{kind:"Name",value:"poweredByAI"}},{kind:"Field",name:{kind:"Name",value:"citations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageCitationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"botMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageBotMetadataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"sendPipelineStatus"}}]}},...i.S.definitions,...a.r.definitions,...o.Z.definitions,...r.$.definitions,...s.M.definitions,...l.p.definitions,...c.n.definitions,...d.g.definitions,...u.K.definitions,...m.R.definitions,...p.B.definitions,...g.C.definitions]}},1997:(e,t,n)=>{"use strict";n.d(t,{f:()=>h});var i=n(568513),a=n(406909),o=n(954312),r=n(411234),s=n(46229),l=n(373558),c=n(952809),d=n(509094),u=n(120157),m=n(136134),p=n(96562),g=n(756806);const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonStandardPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StandardPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"scheduledSendTime"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"urlPreview"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"previewEnabled"}},{kind:"Field",name:{kind:"Name",value:"thumbnail"}},{kind:"Field",name:{kind:"Name",value:"thumbnailMeta"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"languageSeenBefore"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"embeddedLinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmbeddedLinkFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"botMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageBotMetadataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"sendPipelineStatus"}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}},{kind:"Field",name:{kind:"Name",value:"feedbackLoopEnabled"}},{kind:"Field",name:{kind:"Name",value:"sensitivity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}},{kind:"Field",name:{kind:"Name",value:"poweredByAI"}},{kind:"Field",name:{kind:"Name",value:"citations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMessageCitationFragment"}}]}}]}},...i.S.definitions,...a.M.definitions,...o.r.definitions,...r.Z.definitions,...s.$.definitions,...l.p.definitions,...c.n.definitions,...d.g.definitions,...u.K.definitions,...m.R.definitions,...p.C.definitions,...g.B.definitions]}},513774:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});const i={M365Application:["M365HubApplication","M365PlatformApplication"],M365Link:["M365PlatformLink"],M365ApplicationIcon:["InternalIcon","RemoteImage"],M365ApplicationsUpdated:["M365ApplicationsBadgeUpdated","M365ApplicationsConnectionUpdated"],M365ApplicationBadge:["M365ApplicationNumericBadge","M365ApplicationDotBadge","M365ApplicationStringBadge"],EventTrigger:["AppAcquisitionLink","AppSecondaryAction"],Node:["M365HubApplication","M365PlatformApplication","M365PlatformLink","Conversation","Me","FullAccount","Cloud","ActiveTenant","InactiveTenant","MeInOtherTenant","Person","MePresence","PersonPresence","AvailabilityOption"],ConnectionEdge:["M365ApplicationEdge","AccountEdge","TenantEdge","M365LinkEdge"],ConnectionEdgeWithCursorPagination:[],Connection:["M365ApplicationConnection","M365LinkConnection","AccountConnection","TenantConnection"],ConnectionWithCursorPagination:[],MutationFailure:["PresenceMutationFailure","PresenceMutationFailureNetworkOffline"],BaseAccount:["FullAccount","Cloud"],Account:["FullAccount","Cloud"],Tenant:["ActiveTenant","InactiveTenant"],BaseTenant:["ActiveTenant","InactiveTenant"],Persona:["Me","MeInOtherTenant","Person"],Individual:["Me","MeInOtherTenant","Person"],Presence:["MePresence","PersonPresence"],PresenceExpiry:["PresenceExpiryPreDefined","PresenceExpiryCustom"],PresenceMutationResult:["PresenceMutationSuccess","PresenceMutationFailure","PresenceMutationFailureNetworkOffline"]}},665467:(e,t,n)=>{"use strict";n.d(t,{Dd:()=>B,K6:()=>j});const i=e=>e&&!!e.wamsStreamingUrl&&!!e.decryptionToken,a=(e,t,n)=>({__typename:"Broadcast",id:e,admissionType:n.admissionType,type:t?"Overflow":"QuickStart",userRole:n.userRole||"Attendee",correlationId:n.correlationId,title:n.subject,utcStart:n.utcStart||null,utcEnd:n.utcEnd||null,location:n.location||null,streamingDetails:s(e,n),qna:{...n.qna,isEnabled:n.qna?.isEnabled||!1,attendeeUrl:n.qna?.attendeeUrl||"",moderatorUrl:n.qna?.moderatorUrl||"",iosAutodiscoverUrl:n.qna?.iosAutodiscoverUrl||"",__typename:"BroadcastQnaMetadata"},yammer:n.yammer&&{__typename:"BroadcastYammerMetadata",broadcastId:n.yammer.broadcastId,groupId:n.yammer.groupId,isEnabled:n.yammer.isEnabled,eventUrl:n.yammer.event}||null,meetingStatus:n.meetingStatus||(i(n.stream)||i(n.altStream)?"Live":"Created"),supportUrl:n.supportUrl,sdn:c(n)||null,transcription:u(e,n),aesKey:{__typename:"AESKey",...m(n)},aesKeyRefresh:n.aesKeyRefresh,error:n.error||null,signalR:{__typename:"SignalRDetails",...p(n)},streamResource:g(n),broadcastRestartVersion:n.broadcastRestartVersion||0,odspVodShareUrl:n.odspVodShareUrl||null,access:h(n),byoe:n?.byoe||null}),o=e=>({__typename:"BroadcastAttendeeStream",wamsStreamingUrl:e?.wamsStreamingUrl,decryptionToken:e?.decryptionToken}),r=e=>({__typename:"BroadcastStreamingInfo",wamsStreamingUrl:e?.wamsStreamingUrl||null,wamsHlsStreamingUrls:null,playbackCoordinates:[],decryptionToken:e?.decryptionToken||null,decryptionKey:{key:null,value:null},setKeyAuthorizationCookieUri:null,keyAuthorizationToken:null,sdn:l(e)||null,deliveryPipelineType:"AMS"}),s=(e,t)=>({__typename:"BroadcastStreamingDetails",id:e,stream:r(t.stream),altStream:r(t.altStream)}),l=e=>e&&e.sdnName&&e.sdnPluginUrl&&{__typename:"SDNDetails",name:e.sdnName,playbackInfo:e.sdnPlaybackInfo||"",pluginUrl:e.sdnPluginUrl,sdkUrl:"",networkInfo:e.sdnNetworkInfo||void 0}||void 0,c=e=>e.stream&&l(e.stream)||e.altStream&&l(e.altStream),d=e=>e/1e3,u=(e,t,n=null)=>({__typename:"BroadcastTranscription",id:e,isEnabled:t.transcription?.isEnabled??n?.isEnabled,isSuppressed:t.transcription?.isSuppressed??n?.isSuppressed,translationLanguages:t.transcription?.translationLanguages??n?.translationLanguages,transcriptionLanguage:t.transcription?.transcriptionLanguage??n?.transcriptionLanguage,captionsOriginUrl:t.transcription?.captionsOriginUrl??n?.captionsOriginUrl,captionsCacheUrl:t.transcription?.captionsCacheUrl??n?.captionsCacheUrl}),m=e=>({id:e.aesKey?.id||"",iv:e.aesKey?.iv||"",expiry:e.aesKey?.expiry||"",key:e.aesKey?.key||""}),p=e=>({attendeeHubName:e?.signalR?.attendeeHubName||null,eventTeamHubName:e?.signalR?.eventTeamHubName||null,url:e?.signalR?.url||null,querystrings:e?.signalR?.querystrings||null,setCookieUrl:e?.signalR?.setCookieUrl||null}),g=e=>({__typename:"StreamResource",attendeeEmbed:e.streamResource?.attendeeEmbed||"",encoderSource:e.streamResource?.encoderSource||null}),h=e=>e?.access&&{__typename:"BroadcastAccess",useLiveEventAuthorizationV2:e?.access?.useLiveEventAuthorizationV2,disableLobby:e?.access?.disableLobby,inInvitation:e?.access?.inInvitation,attendeeAuthorization:v(e)}||void 0,v=e=>e?.access?.attendeeAuthorization&&{__typename:"BroadcastAttendeeAuthorization",errorCode:e.access.attendeeAuthorization.errorCode,subCode:e.access.attendeeAuthorization.subCode,details:e.access.attendeeAuthorization.details}||void 0;const y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"broadcast"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"broadcast"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"roleHint"},value:{kind:"Variable",name:{kind:"Name",value:"roleHint"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"broadcastFragment"}}]}}]}},...n(82096).S.definitions]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showInMeetingReport"}}]}}]}}]};var f=n(401565),k=n(702183),C=n(345640),b=n(199448);const w=e=>{const[t,n,i,a,o]=e.split("__");return{tenantId:t,organizerId:n,threadId:i,messageId:a,sessionId:o,roleHint:"Attendee"}},T=async(e,t,n,i,o,r)=>{try{const s=(0,C.Si)(t),l=e.readQuery({query:y,variables:{id:s}});if(l)return l.broadcast;{const l=await n.getAttendeeMeeting(i),c=a(t,o,l);return I(e,r,s,c),c}}catch(e){throw r.error(e),e}},I=(e,t,n,i)=>{const a={broadcast:i};try{e.writeQuery({query:y,variables:{id:n},data:a})}catch(e){t.error(e)}},N=async(e,t,n,i,a,o,r,s,l,c,d)=>{if(A(e))return!1;const u=E(r,i,a,l,s,c),m=R(i,n);o.joinId=e?.signalR?.querystrings?.joinid;const p=x(i,o,n,u,s,r,a,e.meetingStatus);try{const r=!a||d;return e.signalR&&e.signalR.url&&!e.error&&r?(await t.subscribeToBroadcast(i,e.signalR,u,m,p),!0):!e.error&&(n.startPollingAttendeeMeeting(i,o,u,e.meetingStatus,!0),!0)}catch(t){return s.error(t),n.startPollingAttendeeMeeting(i,o,u,e.meetingStatus,!0),!0}},A=e=>"Stopped"===e.meetingStatus&&e.streamingDetails?.stream.wamsStreamingUrl,E=(e,t,n,i,o,r)=>(l,c)=>{const d=F(r,t);let m="",p="";try{const r=(0,C.Si)(t),g=i.readQuery({query:y,variables:{id:r}}),h=g?.broadcast;let v;if(h)if(v={...h},c===f.B.transcriptionStateUpdate)v.transcription=u(t,l,h.transcription),m="SignalR",p=f.B.transcriptionStateUpdate;else if(c===f.B.streamUpdateHubEvent){const e=s(t,l);if(_(e,h.streamingDetails))return void d.stop({broadcastData:"Duplicated update skipped"});v.streamingDetails=D(h,e),v.broadcastRestartVersion=l.broadcastRestartVersion,v.meetingStatus=P(h.broadcastRestartVersion,l.broadcastRestartVersion),m="SignalR",p=f.B.streamUpdateHubEvent}else v={...a(t,n,l)},m="Attendee Polling";else v={...a(t,n,l)};const S=M(v);o.log(S),d.stop({broadcastData:JSON.stringify({updateSource:m,updateType:p,details:S})}),e.publish(`${f.V}-${t}`,{broadcastUpdatedEvent:v}),o.log(`New broadcast info successfully published for ${t}`),I(i,o,r,v)}catch(e){o.error(e),d.fail({broadcastData:`Error while processing broadcast update. updateSource: ${m}, updateType: ${p}`,broadcastError:e&&e.message})}},F=(e,t)=>{const n=e.newScenario(k.Cu.BroadcastSubscriptionUpdate);return n.appendEventData({"Thread.Id":(0,C.Si)(t)}),n},_=(e,t)=>e?.stream.wamsStreamingUrl===t?.stream.wamsStreamingUrl&&e?.altStream.wamsStreamingUrl===t?.altStream.wamsStreamingUrl,D=(e,t)=>({__typename:"BroadcastStreamingDetails",stream:t?.stream||e.streamingDetails?.stream,altStream:t?.altStream||e.streamingDetails?.altStream,id:t?.id||e.streamingDetails?.id}),P=(e,t)=>(t=t||0)>(e=e||0)?"Suspended":"Created",M=e=>{const t=e.broadcastRestartVersion,n=e.meetingStatus,i=e.streamingDetails?.stream?.wamsStreamingUrl,a=!!e.streamingDetails?.stream?.decryptionToken,o=e.streamingDetails?.altStream?.wamsStreamingUrl,r=!!e.streamingDetails?.altStream?.decryptionToken,s=e.transcription,l=s?.isEnabled,c=s?.isSuppressed;return`broadcastRestartVersion: ${t}, meetingStatus: ${n}, stream: ${i}, isDecryptionTokenAvailable: ${a}, altStream: ${o}, isAltDecryptionTokenAvailable: ${r}, isTranscriptionEnabled: ${l}, isTranscriptionSuppressed: ${c}`},R=(e,t)=>()=>{t.stopPollingAttendeeMeeting(e)},x=(e,t,n,i,a,o,r,s)=>l=>{if(!l){a.log("broadcast-subscripotion disconnect callback called not intentionally. Subscribing to attendee service polling.");try{n.startPollingAttendeeMeeting(e,t,i,s,!1)}catch(t){L(a,o,t.message,e,r)}}},L=(e,t,n,i,o)=>{e.error("Error while starting broadcast updates subscription");const r=a(i,o,{error:{errorMessage:n}});t.publish(`${f.V}-${i}`,{broadcastUpdatedEvent:r})};var O=n(754255);const j={Query:{async broadcastAttendeeMeeting(e,{broadcastAttendeeMeetingParams:t},{cache:n,coreSettings:i,getBroadcastAttendeeService:a,loggerFactory:r}){const s=i.get(O.w.MeetingArtifacts);let l=!0;const c=r.newLogger("broadcastAttendeeMeetingQuery","data-resolvers-browser-broadcast-attendee"),{overflowAttendance:d}=s;if(t){if(d)try{l=((e,t)=>{if("Disabled"===t)return!1;if("Enabled"===t)return!0;const n=!(!e||!e.userPreferences||"true"!==e.userPreferences.showInMeetingReport&&"false"!==e.userPreferences.showInMeetingReport);return"EnabledUserOverride"===t?!n||"false"!==e?.userPreferences?.showInMeetingReport:"DisabledUserOverride"!==t||!!n&&"false"!==e?.userPreferences.showInMeetingReport})(n.readQuery({query:S}),s.allowTrackingInReportPolicy)}catch(e){c.error("Failed to fetch allowTrackingInReportPolicy"),c.error(e)}return{__typename:"BroadcastAttendeeMeeting",id:(u=await(await a()).getAttendeeMeeting({...t,allowTrackingInReport:l})).correlationId,title:u.subject,stream:o(u.stream),altStream:o(u.altStream),qna:u.qna,yammer:u.yammer&&{__typename:"YammerMetadata",broadcastId:u.yammer.broadcastId,groupId:u.yammer.groupId,isEnabled:u.yammer.isEnabled,eventUrl:u.yammer.event},supportUrl:u.supportUrl}}return null;var u},async broadcastCaptions(e,{id:t,broadcastId:n,culture:i,currentPlayerTime:a},{cache:o,getBroadcastCaptionsService:r,loggerFactory:s}){const l=s.newLogger("broadcastCaptionsQuery","data-resolvers-browser-broadcast-attendee");if(!t&&!n||!i)return l.error("Invalid params sent to broadcastCaptions Query"),Promise.reject("Invalid params sent to broadcastCaptions Query");l.log(`Fetching the captions for: ID: ${t}, Culture: ${i}, Time: ${a}`);const c=t||(0,C.Si)(n);try{const e=o.readQuery({query:y,variables:{id:c}});if(e&&e.broadcast.aesKey&&e.broadcast.transcription){const t={aesKey:e.broadcast.aesKey,aesKeyRefresh:e.broadcast.aesKeyRefresh,correlationId:e.broadcast.correlationId,transcription:e.broadcast.transcription},n=await r();n.setCurrentCaptionLanguage(c,i);return(e=>{const t=[];for(const n of e){if(""===n.Text)continue;const e={__typename:"Captions",start:d(n.TimestampMs),text:n.Text,end:d(n.EndTimestampMs)};t.push(e)}return t})(await n.getCaptions(a,c,t,i))}}catch(e){l.error("Failed to fetch captions"),l.error(e)}return Promise.resolve([])},async broadcast(e,{id:t,roleHint:n,joinId:i},{getBroadcastAttendeeService:o,loggerFactory:r}){const[s,l,c,d,u]=t.split("__");if(!(s&&l&&c&&d)){const e=`Invalid Id: ${t}`;throw r.newLogger("broadcast","data-resolvers-browser-broadcast-attendee").error(e),new Error(e)}const m=!!u,p=m?"Overflow":"QuickStart",g=await(await o()).getAttendeeMeeting({tenantId:s,organizerId:l,threadId:c,messageId:d,sessionId:u,roleHint:n,broadcastType:p,joinId:i||void 0});return a(t,m,g)},async downloadBroadcastMeetingResource(e,{endpoint:t},{getBroadcastAttendeeService:n,getFileDownloadManagerService:i,windowProvider:a,correlationId:o}){const[r,s]=await Promise.all([n(),i()]);return r.downloadBroadcastMeetingResource(t,o).then((e=>(s.downloadUrlWithSubContext(a,e.url,`${e.fileContentType}Download`,e.meetingResourceFileName),!0))).catch((()=>!1))}},Mutation:{async startLiveStreamCaptions(e,{id:t,liveStreamId:n,culture:i},{cache:a,getBroadcastCaptionsService:o,getLiveStreamRenderingService:r,loggerFactory:s}){const l=s.newLogger("liveStreamCaptionsMutation","data-resolvers-browser-broadcast-attendee");try{const e=a.readQuery({query:y,variables:{id:t}});if(!e)throw new Error("Could not find broadcast data");const s=await r(),c=await o(),d=()=>s.getDiagnosticData(n).then((e=>(l.log(`The times are: ${e.currentAbsoluteTime}, ${e.currentMediaTime}, ${e.currentPlayPosition}`),e.currentAbsoluteTime))),u=e=>{s.addCues(n,e)},m={aesKey:e.broadcast.aesKey,aesKeyRefresh:e.broadcast.aesKeyRefresh,correlationId:e.broadcast.correlationId,transcription:e.broadcast.transcription};c.startCaptionsForStream(n,t,m,i,!1,"AzureMediaPlayer",d,u)}catch(e){l.error("Failed to fetch captions"),l.error(e)}return null},async stopLiveStreamCaptions(e,{liveStreamId:t},{getBroadcastCaptionsService:n,getLiveStreamRenderingService:i,loggerFactory:a}){const o=a.newLogger("liveStreamCaptionsMutation","data-resolvers-browser-broadcast-attendee");o.log(`Stopping captions for stream ${t}`);try{const e=await n(),a=await i();return e.stopCaptionsForStream(t),a.clearCues(t),!0}catch(e){return o.error(`Error while stopping captions for stream ${t}`),o.error(e),!1}},async toggleLiveStreamCaptionButton(e,{liveStreamId:t,shouldShowButton:n},{getLiveStreamRenderingService:i,loggerFactory:a}){const o=a.newLogger("toggleLiveStreamCaptionButton","data-resolvers-browser-broadcast-attendee");o.log(`Setting the caption button visibility in the player to ${n} for stream ${t}`);try{return(await i()).showCaptions(t,n),!0}catch(e){return o.error(`Error while setting the caption button to ${n} for stream ${t}`),!1}},async subscribeToBroadcastUpdates(e,{id:t},{loggerFactory:n,getBroadcastAttendeeService:i,getBroadcastSignalRService:a,pubsub:o,cache:r,coreSettings:s,scenarioFactory:l}){const c=await i(),d=await a(),u=n.newLogger("broadcastSubscribe","data-resolvers-browser-broadcast-attendee"),{enableSignalrForOverflow:m}=s.get(O.w.Broadcast),p=await(async(e,t,n,i,a,o,r,s)=>{const l=w(e),c=!!l.sessionId;try{const d=await T(a,e,t,l,c,o);return d?(i.publish(`${f.V}-${e}`,{broadcastUpdatedEvent:d}),await N(d,n,t,e,c,l,i,o,a,r,s)):(L(o,i,"Error subscribing to broadcast updates",e,c),!1)}catch(t){return o.error(t),L(o,i,(0,b.Nw)(t),e,c),!1}})(t,c,d,o,r,u,l,!!m);return p},async unsubscribeFromBroadcastUpdates(e,{id:t},{getBroadcastAttendeeService:n,getBroadcastSignalRService:i,loggerFactory:a}){const o=a.newLogger("broadcastUnsubscribe","data-resolvers-browser-broadcast-attendee");o.log(`Stopping subscription for broadcast ${t}`);try{(await n()).stopPollingAttendeeMeeting(t);return(await i()).unsubscribeFromBroadcast(t),!0}catch(e){return o.error(`Error while unsubscribing from broadcast ${t}`),o.error(e),!1}},async deleteAllBroadcastMeetingResources(e,{endpoint:t},{getBroadcastAttendeeService:n,correlationId:i}){const a=await n();return await a.deleteAllBroadcastMeetingResources(t,i)},async restoreAllBroadcastMeetingResources(e,{endpoint:t},{getBroadcastAttendeeService:n,correlationId:i}){const a=await n();return await a.restoreAllBroadcastMeetingResources(t,i)}},Subscription:{broadcastQnaFeedStatusEvent:{subscribe:(e,{id:t},{pubsub:n})=>n.asyncIterator(t)},broadcastUpdatedEvent:{subscribe:async(e,{broadcastId:t},{pubsub:n})=>n.asyncIterator(`${f.V}-${t}`)}}},B=()=>({Mutation:{updateBroadcastQnaFeedStatus:(e,{id:t,isQnaFeedLoaded:n,hasNewMessages:i},{pubsub:a})=>(null==i&&null==n||a.publish(t,{broadcastQnaFeedStatusEvent:{isQnaFeedLoaded:!!n,hasNewMessages:!!i}}),{__typename:"BroadcastQnaFeedStatus",isQnaFeedLoaded:!!n,hasNewMessages:!!i})}})},942096:(e,t,n)=>{"use strict";n.d(t,{D:()=>s});var i=n(364819),a=n(668625);const o="calendarv2",r=e=>{const t=e.get(o);return t?(0,a.j)(t):{}},s={Query:{calendarSettingsFromLocalStorage:(e,t,{localStorage:n})=>(({shouldGetDateRangeType:e,shouldGetWorkHours:t,shouldGetWorkWeekDays:n},i)=>{const a=r(i);return{__typename:"ICalendarSettings",dateRangeType:e&&a.dateRangeType||null,workHours:t&&a.workHours?{__typename:"IWorkHours",...a.workHours}:null,workWeekDays:n&&a.workWeekDays||null,isLeftRailExpanded:a.isLeftRailExpanded}})(t,n)},Mutation:{saveCalendarSettingsInLocalStorage:(e,t,{localStorage:n})=>((e,t)=>{const n=r(t);return(0,i.forOwn)(e,((e,t)=>{null!=e&&(n[t]=e)})),t.trySet(o,JSON.stringify(n),"Calendar"),!0})(t,n)}}},375474:(e,t,n)=>{"use strict";n.d(t,{e:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataResolversBrowserCallingUpdateCallingStateMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newState"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CurrentCallingState"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateCallingState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newState"},value:{kind:"Variable",name:{kind:"Name",value:"newState"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},641361:(e,t,n)=>{"use strict";n.d(t,{K:()=>Q});var i=n(462874),a=n(776708),o=n(754255),r=n(678937),s=n(702183),l=n(405947),c=n(250212),d=n(850434),u=n(199448),m=n(694257);const p=async(e,t,n)=>{const i=n.filter((e=>!e.shareUrl)).map((e=>e.id));if(0===i.length)return n;const a=await e.shareDriveItems(i),o=new Map;a.forEach(((e,t)=>o.set(i[t],e)));const r=[];for(const e of n){const n=o.get(e.id);if(n){if(!n.link){const n=`ShareUrl (link.webUrl) is not present in createLink response for fileId: ${e.id}`,i={[m.b.internalErrorCode]:"ShareUrlIsMissingFromResponse",[m.b.logErrorMessage]:n};throw t.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat").error(`${n}. ${JSON.stringify(i)}`),(0,u.$5)(d.Ir.AddShareUrlOnSendMessage,d.O4.Undefined,"",i,n)}r.push({...e,shareUrl:n.link.webUrl,shareId:n.shareId})}else r.push(e)}return r},g=e=>!!e?.files?.length,h=(e,t,n)=>{const i=e.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat"),{reason:a}=n;if(a){const e={errorCode:a[m.b.internalErrorCode]||n.code||"ErrorCodeMissing",correlationId:a[m.b.correlationId],statusCode:a[m.b.httpCode],message:a[m.b.logErrorMessage]||"Log message is not present in reason bag",errors:a[m.b.logErrorMessage]};throw t.fail(e),i.error(`Failed to generate ShareUrl for files. ${JSON.stringify(e)}`),n}const o={errorCode:n.code||d.O4.Unknown,message:"thrown error is not an instance of IError. So not much data available",errors:`${n.context}_${n.subContext}`};throw t.fail(o),i.error(`Failed to generate ShareUrl for files and as well error is not instance of IError ${JSON.stringify(o)}`),n},v=async(e,t,n)=>{try{return await e()}catch(e){const i="Failed to lazy load drive item share service",a={[m.b.internalErrorCode]:e.code||"FailedToLazyLoadDriveItemShareService",[m.b.logErrorMessage]:i,innerError:e},o={errorCode:a[m.b.internalErrorCode],message:a[m.b.logErrorMessage]};n.fail(o);throw t.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat").error(`Failed to get DriveItemShareService. error: ${JSON.stringify(o)}`),(0,u.$5)(d.Ir.AddShareUrlOnSendMessage,d.O4.FailedToLazyLoadService,"",a,i)}},y=e=>!!e?.files&&!!e?.files.find((e=>"deeplink"===e.type));var S=n(897982),f=n(364819),k=n(403097),C=n(726723),b=n(712839),w=n(806658),T=n(84646),I=n(645095),N=n(220192);const A={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedAppsV2"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallContext"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedAppsV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedContext"},value:{kind:"Variable",name:{kind:"Name",value:"installedContext"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]}}]}},...n(570947).B.definitions]};var E=n(659726);const F={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"optionalTelemetry"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"optionalTelemetry"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidCorrelationId"}},{kind:"Field",name:{kind:"Name",value:"fluidDataLossOccurred"}},{kind:"Field",name:{kind:"Name",value:"fluidDataLossPrevented"}},{kind:"Field",name:{kind:"Name",value:"hasLoopComponentAndContent"}},{kind:"Field",name:{kind:"Name",value:"embedLoopLinks"}}]}}]}}]};var _=n(800079),D=n(276952),P=n(851490);const M=e=>{switch(e){case"Standard":return"NORMAL";case"Important":return"HIGH";case"Urgent":return"URGENT"}return null},R=e=>{const t=e.computed?.cards;if(!t)return!1;return!!(0,f.find)(t,(e=>"application/vnd.microsoft.card.fluid"===e.contentType||"application/vnd.microsoft.card.fluidEmbedCard"===e.contentType))},x=(e,t)=>{const n=e.computed?.cards;return!!n&&n.some((e=>e.appName===t))},L=(e,t)=>{const n=[],i=e.computed?.cards;i&&i.forEach((e=>{n.push(e.appId)}));const a=e.computed?.mentions;return a&&a.forEach((e=>{"bot"===e.mentionType&&(0,w.MX)(e.userId,t)&&n.push(e.userId.substring(T.gN.BotPrefix.length))})),n.length>0?n.join(","):""},O=e=>{const t=new RegExp(N.A.reply,"g");return(e.match(t)||[]).length},j=e=>e?e.replace(/(<([^>]+)>)/gi,""):"",B=(e,t)=>{const n={};if(e&&t?.isOneOnOne&&t?.hasFederatedUser){const e=_.af.getTflExtendedDirectoryMembership(t?.extendedDirectoryRedemptionRequired);e&&(n["DataBag.TFLUserInED"]=!0,n["DataBag.TFLUserEDState"]=e)}return n},U=(e,t,n)=>{if(t)return n?"replyConversation":"newConversation";const i="Update"===e;return n?i?"editThreadedChat":"replyThreadedChat":i?"chatEdit":"newP2PMessage"},$=e=>e?.guardianChatInfo?k.Kt.GuardianChat:null,W=e=>e?.awarenessLiveState?"sync":"async",V=(e,t)=>t===C.bF.Channel?b.bY.team:e?.isOneOnOne?b.bY.personal:e?.isMeeting?b.bY.meeting:e?.isOneOnOneBotChat||e?.isOneOnOne?b.bY.general:b.bY.group,H=(e,t,n,i,a,o,r,s,c,d,u,m,p,g,h,v,y,S)=>{const F=((e,t,n)=>{if(!e||e.chatSubType===I.vW.Channel)return t?n?C.bF.Communities:C.bF.Channel:void 0;const i=e.memberIds?.map((e=>e))??[],a=(0,w.wD)(e.id,e.isFederated,e.isOneOnOne,e.hasFederatedUser,i);return(0,l.Dc)(e.id,e.chatType,e.isMeeting,e.isOneOnOne,e.isOneOnOneBotChat,a,e.isFederated)})(u,g,r&&v===e);let _={};F===C.bF.Botchat&&(_=((e,t)=>{const n=e?.memberIds?.find(w.Iz);if(n){const e=n.substring(T.gN.BotPrefix.length);try{const n=t.readQuery({query:A,variables:{installedContext:{scope:"Personal"}}});if(n){const t=n.installedAppsV2?.filter((t=>t?.definition?.bots?.[0]?.id===e));if(t&&t.length>0)return{id:t[0]?.id,capabilityId:e,scenarioCapability:b.n3.bots}}}catch(e){}}return{}})(u,p));let H={};F!==C.bF.Channel&&F!==C.bF.Communities||(H=((e,t,n,i)=>{let a;try{a=e.readQuery({query:E.r,variables:{conversationId:t}})}catch(e){i.error(`Failed to retrieve Team.Id and Team.OfficeGroupId from cache. Thread.Id: ${t}. Thread.Type: ${n}.`)}return{channelType:a?.channelByID.channelType,teamId:a?.channelByID?.owningTeam?.id,officeGroupId:a?.channelByID?.owningTeam?.teamSiteInformation?.groupId,memberCount:a?.channelByID?.owningTeam?.membershipSummary?.memberCount,channelResourceTeamId:a?.channelByID.parentTeamId??"",memberRole:a?.channelByID.memberRole,channelResourceTenantId:a?.channelByID.channelResourceTenantId}})(p,e,F,o));const{panelType:q,panelRegion:G}=function(e,t,n){let i=C.HP.Chat,a=C.rP.main;e&&(i=t?C.HP.discoverSurface:C.HP.Channel);n&&(i=C.HP.CommentStreamChat,a=C.rP.right);return{panelType:i,panelRegion:a}}(g,y,d),Y=g?"channel":"chat",Q=((e,t,n,i,a,o,r,s,l,c,d)=>{return{"DataBag.messagelength":j(e.content).length,"DataBag.size":e.content.length,"DataBag.importantflag":M(e.importance),"DataBag.messageType":U(t,s,l),"DataBag.postType":"Announcement"===e.postType?"announcement":"normal","DataBag.richText":(m=e.messageType,"RichText/Html"===m),"DataBag.fluidCard":R(e),"DataBag.appId":L(e,d),"DataBag.sfbInteropMessage":"SfBInteropChat"===o?.chatType,"DataBag.mricollection":o?.memberIds?.map((e=>(0,w.Mq)(e)))?.join(" ")||"","DataBag.rostersize":o?.memberIds?.length||0,"DataBag.attachments":e.files?.length||0,"DataBag.attachmentIds":e.files?.map((e=>e.id))?.join(" ")||"","DataBag.fileTypeList":e.files?.map((e=>e.type))?.filter((e=>!(0,f.isNil)(e)))||[],"DataBag.suggestedFile":e.files?.some((e=>"smartReply"===e.context)),"DataBag.leftRailDirective":s?"channel-list":"chat-list","Messaging.messageChannelType":c.channelType??null,"DataBag.messageID":e.id!==e.clientMessageId?e.id:void 0,"DataBag.replyChainId":l,"DataBag.isNewChat":!!r,"DataBag.newChatIntentId":r,"DataBag.tflOffNetworkEmailCount":o?.memberIds?o.memberIds.filter((e=>e.startsWith(T.Cl))).length:0,"DataBag.tflOffNetworkOneWayPhoneCount":o?.memberIds?o.memberIds.filter((e=>e.startsWith(T.I8))).length:0,"DataBag.tflSMSMembersCount":o?.memberIds?o.memberIds.filter(w.vd).length:0,"DataBag.offNetworkContactsSelected":o?.memberIds?o.memberIds.filter(w.mD).length:0,"DataBag.hasAADFederatedMembers":o?.hasFederatedUser||!1,"DataBag.hasMSAFederatedMembers":o?.hasTflConsumerUser||!1,"DataBag.quotedReplyCount":O(e.content),"DataBag.groupTemplateType":o?.groupTemplate,"DataBag.chatType":$(o),"DataBag.GIF":(0,P.x)(e.content,N.A.giphy),"DataBag.Sticker":(0,P.x)(e.content,N.A.sticker),"DataBag.customEmoji":(0,P.x)(e.content,N.A.customEmoji),"DataBag.emoji":(0,P.x)(e.content,N.A.emoji),"Designer.containsImageFromDesigner":x(e,D.M_)||(u=e.content,u.split(" ").filter((e=>e===`type="${D.Zj}"`)).length>0),"DataBag.composeVersion":i?"Simplified":"Classic",...B(n,o),"DataBag.lifeCycleFlavor":W(o),"DataBag.wasEdited":"Update"===t,"Messaging.additionalContentPresent":a?j(e.content).length>0:void 0,"Messaging.additionalContentLength":a?j(e.content).length:void 0,"TeamsAndChannels.channelType":"Standard"===c.channelType?k.Cu.Regular:c.channelType,"TeamsAndChannels.channelResourceTeamId":c.channelResourceTeamId,"TeamsAndChannels.channelRole":c.memberRole,"TeamsAndChannels.channelResourceTenantId":c.channelResourceTenantId??""};var u,m})(t,n,r,s,c,u,m,g,h,H,S);a.recordPanelAction({actionGesture:C.Od.click,actionOutcome:C.nd.submit,actionOutcomeNew:C.nd.submit,actionScenarioType:c?C.DB.forwardMessage:C.DB.composeMsg,actionScenario:C.vB.composeSendMessage,appId:Q["DataBag.appId"]||"",appScope:V(u,F).toString(),appScenarioCapability:void 0!==Q["DataBag.appId"]?b.n3.messaging.toString():"",moduleName:c?C.Sn.forwardButton:C.Sn.sendButton,moduleNameNew:c?C.Sn.forwardButton:C.Sn.sendButton,moduleType:C.nR.sendMessageButton,moduleTypeNew:C.nR.sendMessageButton,officeGroupId:null!=H?.officeGroupId?H?.officeGroupId:void 0,panelRegion:G,panelType:q,panelRegionNew:G,panelTypeNew:q,panelUri:c?"app.conversation":void 0,threadId:e,childThreadId:u?.isConversationalUXEnabled?h??void 0:void 0,teamId:v??H?.teamId,threadMembers:H?.memberCount??u?.memberIds?.length,threadType:F,actionWorkload:g?C.E0.channelContent:C.E0.chatContent,actionSubworkload:C.i7.composeMsg,tabId:"",tabType:"conversations",tabIdNew:"",tabTypeNew:"conversations",tabOrdinal:1,appName:Y,dataBag:{id:"",data:{...i,...Q,...z(p,t,y,h)},dispose:()=>{}},extensibilityData:_},o)};function z(e,t,n,i){const a={};let o=null;try{o=e.readQuery({query:F})}catch{}const r=o?.optionalTelemetry;return null!=r?.fluidDataLossOccurred&&(a["DataBag.fluidDataLossOccurred"]=o?.optionalTelemetry?.fluidDataLossOccurred),null!=r?.fluidDataLossPrevented&&(a["DataBag.fluidDataLossPrevented"]=o?.optionalTelemetry?.fluidDataLossPrevented),null!=r?.fluidCorrelationId&&(a["Messaging.fluidCorrelationId"]=o?.optionalTelemetry?.fluidCorrelationId),null!=r?.embedLoopLinks&&(a["Messaging.embedLoopLinks"]=o?.optionalTelemetry?.embedLoopLinks),null!=r?.hasLoopComponentAndContent&&(a["Messaging.hasLoopComponentAndContent"]=o?.optionalTelemetry?.hasLoopComponentAndContent),n&&(a["DiscoverSurface.requestId"]=n,a["DataBag.messageID"]=i),"Announcement"===t.postType&&(a["Channels.containsImageBanner"]=x(t,D.RG)),a}var q=n(498252),G=n(289362),Y=n(860342);const Q={Mutation:{sendMessageWorker:async(e,t)=>J(e,t),sendMessage:async(e,t)=>J(e,t)}},J=async(e,t)=>{const{message:n,convId:i,action:a,originalConvId:o,sendFromChannel_ToBeRefactored:r,isCommentStream:l,cache:c,loggerFactory:d,offlineCacheManager:u,getDriveItemShareService:m,scenarioFactory:f,teamId:k,getPeopleService:C,requestId:b,authenticationUser:w,themeType:T,enableBotsFileSharing:N,botFileInfoFetchTimeout:A,enableFilesShareLinksInvite:E,enableSharingByCreateLinkAPI:F,enableFilesShareLinksFetchFederatedUsersAPI:_,enableFilesShareLinksFetchTflConsumerUsersAPI:D,enableSendMessageLoggingForDebugging:P,enableFileSharingSecurityFixInChannels:M,enableScheduleMessage:R,enableCrossPostFileSharing:x,isSimplifiedCompose:L,enableMeetingChatAttachmentsInMCO:O,meetingChatAttachmentsMap:j,enableSPODataInSaveArtifacts:B,userIdPrefix:U,isTflApp:$,chat:W,scenario:V,logger:z,linkUnfurlingAppDetails:Q}=await K(e,t);V?.mark(s.BQ.ChatSendMessageGotChat);const J=X(o,c,z),ie=await Z(t);V?.mark(s.BQ.ChatSendMessageServicesLazyLoadComplete);const ae=ee(t,z);O&&async function(e,t,n,i,a,o,r,l,c,d){const{scenario:u}=(0,G.k5)(s.Cu.AddAttachmentToMCO,a);if(t?.chatSubType===I.vW.Channel)return;const m=e?.files?.length;try{if(m&&("Recurring"===t?.meetingInformation?.meetingType||"Scheduled"===t?.meetingInformation?.meetingType)){const s=await l(),m=await te(t?.meetingInformation?.organizerId||"",s,c)||"",p=`${t.me?.objectId}@${t.addedByTenantId}`,g=`${t.meetingInformation.organizerId}@${t.meetingInformation.tenantId}`,h=t.meetingInformation.iCalUid||"",v=t.meetingInformation.organizerId,y=m,f=e.files,k=(0,G.No)(t?.me?.objectId||"",f,n);if(k.length>0){const e=(0,S.uJ)(t,h,g,p,m);e?(r.errorToTelemetry?.(e,"cmd_meetings_collab_object_add_resources_to_collab_object_event"),u.fail({reason:e})):(0,Y._h)(o,a,i,"MeetingChat",h,h,g,p,k,(0,G.GQ)(t.id,m,t.meetingInformation?.meetingJoinUrl,"0"),v,y,d)}}u.stop()}catch(e){(0,G.zH)(e,u)}}(n,W,j,d,f,t.getCollabObjectService,z,C,U,!!B);const oe=ne(e,t,W);let re=await(0,S.Ex)(t,n,a,i,ae,{...ie,cache:c,offlineCacheManager:u,telemetryDatabag:oe,convId:i,conversationMembers:W?.memberIds,currentUserId:W?.me?.id,authenticationUser:w,linkUnfurlingAppDetails:Q,getPeopleTargetingService:t.getPeopleTargetingService},V,!!r,l??!1,T,W?.isExternal??!1,e.correlationId);return F&&n&&((0,S.P1)(z,"Adding share url to files payload pram- addShareUrlToFiles","send_message_forward_resolver",P),re=await(async(e,t,n,i)=>{if(g(i)){const a=t.newScenario(s.Cu.FilesCreateShareLink),o=await v(e,n,a);try{const e=await p(o,n,i.files);return a.stop(),{...i,files:e}}catch(e){h(n,a,e)}}return{...i}})(m,f,d,re)),(0,S.P1)(z,"calling updateFluidMessageShareUrl","send_message_forward_resolver",P),re=await(0,S.l1)(re,z,t),(0,S.P1)(z,"calling getBotDownloadUrlForFiles","send_message_forward_resolver",P),re=await(0,S.zI)(ie.botsPlatformService,re,N,d,W,A),re=(0,S.nG)(re,W),(E||R)&&W&&(0,S.Z9)(W)&&!y(re)&&(V?.mark(s.BQ.ChatSendMessageFileShareLinksChats),(0,S.P1)(z,"Creating Sharelinks if the files attached in Chat with no share url getMessageWithFileShareLinks","send_message_forward_resolver",P),re=await(0,S.I9)(re,W,t,z,_,D,e.correlationId)),(E||R)&&r&&!y(re)&&(V?.mark(s.BQ.ChatSendMessageFileShareLinksChannels),(0,S.P1)(z,"Creating Sharelinks if the files attached in Channel with no share url getMessageWithFileShareLinksForChannel","send_message_forward_resolver",P),re=await(0,S.MM)(re,c,i,z,t,!!x,!!M)),V?.mark(s.BQ.ChatSendMessageBiTelemetry),((e,t,n,i,{loggerFactory:a,userBiService:o,cache:r,coreSettings:s},l,c,d,u,m,p,g,h,v,y)=>{const S=a.newLogger("sendMessageTelemetry","data-resolvers-browser-chat");o?H(e,t,n,i,o,S,l,c,d,u,m,p,r,g,h,v,y,s):S.warn("userBiService is null")})(i,re,a,oe,t,$,L,(0,S.Q$)(n),!!l,W,J,r,n?.replyChainId,k,b),V?.mark(s.BQ.ChatSendMessageForwardResolverComplete),(0,q.J)({scenario:V,message:re,oamRetryCount:0,logger:z}),{...e,message:re}},K=async(e,t)=>{const{message:n,convId:i,action:a,originalConvId:s,withChatNetworkFallback:l,sendFromChannel_ToBeRefactored:d,isCommentStream:u,linkUnfurlingAppDetails:m}=e,{cache:p,coreSettings:g,loggerFactory:h,offlineCacheManager:v,getDriveItemShareService:y,scenarioFactory:f,teamId:k,getPeopleService:C,requestId:b,authenticationUser:w,themeType:T}=t,{enableInstalledAppsV2:I,enableBotsFileSharing:N,enableAppsQueryOptimization:A,botFileInfoFetchTimeout:E}=g.get(o.w.Extensibility),{enableFilesShareLinksInvite:F,enableSharingByCreateLinkAPI:_,enableFilesShareLinksFetchFederatedUsersAPI:D,enableFilesShareLinksFetchTflConsumerUsersAPI:P,enableSendMessageLoggingForDebugging:M,enableFileSharingSecurityFixInChannels:R}=g.get(o.w.Files),{enableScheduleMessage:x,enableSimplifiedCompose:L}=g.get(o.w.Messaging),{enableCrossPostFileSharing:O}=g.get(o.w.Channels),j=!!L,{enableMeetingChatAttachmentsInMCO:B,meetingChatAttachmentsMap:U,enableSPODataInSaveArtifacts:$}=g.get(o.w.ArtifactsPlatform),{userIdPrefix:W}=g.get(o.w.Calling),{environment:V}=g.get(o.w.Metadata),H=V===r.B.life,z=h.newLogger("chatMutationForwardResolvers","data-resolvers-browser-chat"),q=function(e,t,n){const i=(0,c.xU)(e,t);return n.findScenario(i)}(a,n,f);return{message:n,convId:i,action:a,originalConvId:s,sendFromChannel_ToBeRefactored:d,isCommentStream:u,cache:p,loggerFactory:h,offlineCacheManager:v,getDriveItemShareService:y,scenarioFactory:f,teamId:k,getPeopleService:C,requestId:b,authenticationUser:w,themeType:T,enableInstalledAppsV2:I,enableBotsFileSharing:N,enableAppsQueryOptimization:A,botFileInfoFetchTimeout:E,enableFilesShareLinksInvite:F,enableSharingByCreateLinkAPI:_,enableFilesShareLinksFetchFederatedUsersAPI:D,enableFilesShareLinksFetchTflConsumerUsersAPI:P,enableSendMessageLoggingForDebugging:M,enableFileSharingSecurityFixInChannels:R,enableScheduleMessage:x,enableCrossPostFileSharing:O,isSimplifiedCompose:j,enableMeetingChatAttachmentsInMCO:B,meetingChatAttachmentsMap:U,enableSPODataInSaveArtifacts:$,userIdPrefix:W,isTflApp:H,chat:await(0,S.PB)(i,p,t,z,h,l,null,null,void 0,s||""),scenario:q,logger:z,linkUnfurlingAppDetails:m}},Z=async e=>{const{getAppBasedLinkService:t,getAsyncMediaService:n,getUrlPreviewService:i,getImageProxyService:a,getFilesReferenceService:o,getBotsPlatformService:r}=e,[s,l,c,d,u,m]=await Promise.all([n(),a(),i(),o(),t(),r()]);return{asyncMediaService:s,imageProxyService:l,urlPreviewService:c,fileReferenceService:d,appBasedLinkService:u,botsPlatformService:m}},X=(e,t,n)=>{let a=null;if((0,l.Fz)(e))try{const n=t.readQuery({query:i.N,variables:{convId:e}});a=n?.newChatIntentId??null}catch(e){n.error("Failed to find newChatIntentId in cache")}return a},ee=(e,t)=>{let n=!0;const{cache:i,coreSettings:r}=e,{enableConnectedExperiences:s}=r.get(o.w.Messaging);if(!s)return n;try{const e=i.readQuery({query:a.Z});n="false"!==e?.userPreferences?.controllerConnectedServicesEnabled}catch{t.error("Failed to find userPreferences in cache")}return n},te=async(e,t,n)=>{const i=`${n}${e}`,a=(await t.getPeopleProfilesByMris([i],"MeetingChat")).get(i),o=a?.userPrincipalName;return o};const ne=(e,t,n)=>{const{message:i,searchSessionId:a,composeCopilotSessionId:r}=e,{channelOrder:s,channelView:l,conversationSelectionSource:c,coreSettings:d,authenticationUser:u}=t,{msgEnableChannelsV2:m}=d.get(o.w.Host);return{"DataBag.searchSessionId":a,"DataBag.isChannelsV2":!!m,"DataBag.channelView":l,"Channels.channelOrder":s,"Compose.sendPostAsEmail":!!i?.sendPostAsEmail,"Messaging.isShadowMTOMember":"Mto"===u?.subType,"Messaging.isMTOMember":null,"Messaging.hasMTOMembers":n?.hasFederatedMTOUser,"Compose.composeCopilotSessionId":r,"Messaging.conversationSelectionSource":c??null}}},897982:(e,t,n)=>{"use strict";n.d(t,{Td:()=>M,zI:()=>z,PB:()=>ae,uJ:()=>se,I9:()=>G,MM:()=>Y,Z9:()=>oe,Q$:()=>H,P1:()=>le,f0:()=>V,Ex:()=>U,nG:()=>re,l1:()=>ee});var i=n(364819),a=n(420645),o=n(702183),r=n(724404),s=n(405947),l=n(600824),c=n(383851);let d=class{transform(e,t){if(e.parent&&1===e.parent.children.length&&"div"===e.parent.name?.toLowerCase()&&"root"===e.parent.parent?.type){if((!e.children||0===e.children.length)&&"text"===e.type)return t.isPureText=!0,void(t.textContent=(0,i.unescape)(e.data));if("tag"===e.type&&"p"===e.name?.toLowerCase()&&1===e.children?.length&&"text"===e.children[0].type)return t.isPureText=!0,void(t.textContent=(0,i.unescape)(e.children?.[0].data));if("tag"===e.type&&"p"===e.name?.toLowerCase())return e.name="div",e}}};d=(0,c.__decorate)([(0,l.dL)({name:"BotMessageContentSerializer",filter:"*"})],d);var u=n(729555),m=n(581386),p=n(692184),g=n(806658),h=n(797922),v=n(84646),y=n(750400),S=n(754255);var f=n(649288),k=n(276952),C=n(639908),b=n(780952),w=n(220192),T=n(556139),I=n(102029),N=n(507011),A=n(659726);const E={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatChannelsByIdsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeTeams"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelsByIds"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationIds"},value:{kind:"Variable",name:{kind:"Name",value:"conversationIds"}}},{kind:"Argument",name:{kind:"Name",value:"includeTeams"},value:{kind:"Variable",name:{kind:"Name",value:"includeTeams"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversBrowserChatChannelsByIdsFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataResolversBrowserChatChannelsByIdsFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Channel"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}}]}}]}}]}.definitions]};var F=n(435793);const _={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};let D=class{transform(e,t){if(e&&e.attribs&&T.eS.cacheKey in e.attribs&&e.attribs[T.eS.cacheKey]===t.cacheKey)return t.instancesReplaced++,void 0!==t.value?e.attribs[t.prop]=t.value:t.prop in e.attribs&&void 0===t.value&&delete e.attribs[t.prop],e}};D=(0,c.__decorate)([(0,l.dL)({name:"InlineVideoUpdater",filter:[{itemtype:w.A.amsVideo}]})],D);var P=n(195695);const M="app-preview-card-ps",R="external_tfw_tfl_users",x="external_tfw_users",L="external_tfl_users",O="internal_users",j=async(e,t)=>{const n=e.loggerFactory.newLogger("postTransformationCleanup","data-resolvers-browser-chat");e.nonBlockingDeletableCacheKeys.length&&(n.log(`AsyncSendSerialization: Cleaning up ${e.nonBlockingDeletableCacheKeys.length} cached items.`),t?.mark(o.BQ.ChatSendMessageSerializationCacheCleanup));for(const t of e.nonBlockingDeletableCacheKeys)try{await e.offlineCacheManager.delete(t)||n.warn(`AsyncSendSerialization: Failed to delete cached image with key: ${t}`)}catch(e){n.warn(`AsyncSendSerialization: Failed to delete cache image with key: ${t}. Also, we experienced an error, which is being considered non blocking to ensure we do not cause a terminal send issue.`)}},B=async(e,t,n,i,a,r,s,c)=>{const{cache:d,loggerFactory:p}=e,g=p.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),h=u.PJ.test(t)?t.replace(u.PJ,u.en):t,v=(0,l.Xy)(m.fS,h,n);try{H(a)||(await(0,N.ZV)(d,e,i,a,r,v,n.messageProperties,c),s?.mark(o.BQ.ChatSendMessageOptimisticResponsePosted))}catch(e){g.error(`client lie generation failed for conversation: ${i} clientMessageId: ${a.clientMessageId} error: ${e}`)}return(0,l.Rs)(m.cn,v,{...n,videoMessageLieUpdater:(e,t,n)=>((e,t,n,i,a)=>{if(!t)throw Error("clientMessageId undefined");const o=`Message:${t}`;let r;try{r=e.readFragment({id:o,fragment:_})}catch(e){throw e}if(!r)throw Error(`Message lie ${o} not found.`);if(!r.content)throw Error(`Message lie ${o} has no content.`);const s={cacheKey:n,prop:i,value:a,instancesReplaced:0},c=(0,l.Xy)([D],r.content,s);if(1!==s.instancesReplaced)throw Error(`${s.instancesReplaced} instances found instead of 1`);{const n=(0,F.yT)()[0].toString();try{e.writeFragment({id:o,fragment:_,data:{__typename:"Message",id:t,content:c,version:n}})}catch(e){throw e}}})(d,a.clientMessageId,e,t,n)},j)},U=async(e,t,n,i,a,r,s,l,c,d,u,m)=>{const{content:p,computed:g,files:h,clientMessageId:v,deeplinks:f,title:k,hasEdit:C,...b}=t,{coreSettings:w,i18n:T,loggerFactory:I,scenarioFactory:N}=e,A={conversationId:i,connectedExperienceEnabled:a,existingLinks:g?.embeddedLinks||[],messageProperties:g?{...g,embeddedLinks:[],mentions:g.mentions?[...g.mentions]:void 0,onBehalfOf:g.onBehalfOf?[...g.onBehalfOf]:void 0}:{},files:h?[...h]:[],coreSettings:w,loggerFactory:I,i18n:T,isExternalChat:u,scenarioFactory:N,nonBlockingDeletableCacheKeys:[],hasEdit:C??!1,...c&&{isLiteEmoticon:!0,disableBigEmoticons:!0},...r,...d&&{themeType:d},correlationId:m??""},E=I.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),F=await B(e,p,A,i,t,n,s,l),_=((e,t)=>{const{enableEntityConversationInMWTab:n}=e.get(S.w.Extensibility);if(!n)return[];const i=y.P.getInstance(),a=i.getSubEntityDeepLinkInfo();return a&&t&&i.getClientMessageId()===t?(i.setSubEntityDeepLinkInfo(void 0),i.setClientMessageId(void 0),[a]):[]})(w,v||void 0),{updatedTitle:D,updatedCards:P,updatedAmsReferences:M}=await $(k||"",A);E.log(`serialized message ${v}`),s?.mark(o.BQ.ChatSendMessageSerializationComplete);return W({content:F,computed:{...A.messageProperties,cards:P,amsReferences:M},files:A.files,deeplinks:_.length>0?_:f,clientMessageId:v,title:D,...b})},$=async(e,t)=>{let n=t.messageProperties.cards,i=t.messageProperties.amsReferences;if(n?.length){const e=n.find((e=>e.appId===k.Kv&&e.contentType===k.rj));if(e){let a=JSON.parse(e.content);if(a.imageData?.origImage&&a.imageData?.croppedImage?.src?.startsWith("blob:")){const o=await(0,C.cP)(a.imageData.croppedImage.src),r="MicrosoftTeams-image.png",s=await t.asyncMediaService.uploadItem(o,t.conversationId,"IMAGE",r,f.vV.Inline),l=s.inlineSizeUrl.replace("/imgo","/imgpsh_fullsize");a={...a,imageData:{...a.imageData,croppedImage:{...a.imageData.croppedImage,id:s.objectId,src:l},origImage:{...a.imageData.origImage,id:s.objectId,src:l}}},i=i?.length?[...i,s.objectId]:[s.objectId];const c={...e,content:JSON.stringify(a)};n=n.map((e=>e.appId===k.Kv&&e.contentType===k.rj?c:e))}}}return{updatedTitle:e,updatedCards:n,updatedAmsReferences:i}},W=e=>{if(e.computed?.cards&&e.computed.cards.length>0){const{computed:{cards:t}}=e,[n,a]=(0,i.partition)(t,(e=>e.cardClientId&&e.cardClientId.startsWith(M)));if(!(0,i.isEmpty)(n)){const t=n[0];return{...e,content:`${e.content}<span class="inline-compose-card" itemid="${t.cardClientId}" itemscope="" itemtype="http://schema.skype.com/InputExtension"><span content="${t.cardClientId}" itemprop="cardId"></span></span>`,computed:{...e.computed,cards:[t,...a]}}}}return e},V=(e,t)=>{const{loggerFactory:n,offlineCacheManager:i}=e,a={logger:n.newLogger("chat-resolvers-utils","data-resolvers-browser-chat"),offlineCacheManager:i},o=(0,l.Xy)(m.WI,t.content,a);return{...t,content:o}},H=e=>!!e?.forwardMessageId&&!!e?.forwardMessageOriginalConvId,z=async(e,t,n,i,a,o)=>{if(!a||!n||!t.files||0===t.files.length)return t;if(!a?.isOneOnOneBotChat)return t;const r=i.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),s=o||1e4,l=await Promise.all(t.files.map((t=>q(t,e,r,s))));return{...t,files:l}},q=async(e,t,n,i)=>{const a=e.objectUrl;if(a){let o;try{o=await(0,b.a)(t.getBotFileDownloadUrl(a,n),i,"get bot downlaod url timed out")}catch{o=null,n.error("getBotDownloadUrlForFiles: failed to get file info")}if(o)return{...e,downloadUrl:o}}return e},G=async(e,t,{getSharepointShareService:n,getPeopleService:i,discover:a,scenarioFactory:r},s,l,c,d)=>{if(e?.files?.length&&!t?.isOneOnOneBotChat){const u=r.newScenario(o.Cu.FileSharelinkMessageSend),m=await n(),p=await i(),g=await a.skypeid((0,P.$q)("[resolvers-browser]chat-resolvers-utils:getMessageWithFileShareLinks"));let h=[];try{u.mark(o.BQ.FetchingUserDetailsStarted);h=(await ie(t,p,u,s,l,c)).filter((e=>e.mri!==g)),u.mark(o.BQ.ShareUrlInviteCallForChatStarted);const n=await m.shareFiles(e.files,h,u,!0,d);return u.stop(),{...e,files:n}}catch(e){K(e,u,h.length);const t=JSON.stringify({errorCode:`${e.serverResponse?.status}`,errors:JSON.stringify([e.code]),correlationId:e.reason?.correlationId,errorMessage:e.reason?.logErrorMessage,numOfUsers:h.length,reason:e.reason?.reason});throw s.error(`getMessageWithFileShareLinks: Failed to create the shareLink for Chat's message. Error: ${t}`),e}}return e},Y=async(e,t,n,i,{getSharepointShareService:a,scenarioFactory:r},s,l)=>{if(!e?.files?.length)return e;const c=!(!s||!e.crossPostChannels?.length),[d,u]=c?J(e,t,i):Q(e,t,n,i,l);if(!d.length||!u.length)return e;const m=r.newScenario(o.Cu.FileSharelinkMessageSend);try{const t=await a();m.mark(o.BQ.ShareUrlInviteCallForChannelStarted);const n=await t.shareFiles(d,u,m);return m.stop({message:c?"CrossPostFileSharing":"StandardPostFileSharing"}),{...e,files:n}}catch(e){K(e,m,u.length);const t=JSON.stringify({errorCode:`${e.serverResponse?.status}`,errors:JSON.stringify([e.code?.toString()]),correlationId:e.reason?.correlationId,errorMessage:e.reason?.logErrorMessage,numOfUsers:u.length,reason:e.reason?.reason});i.error(`getMessageWithFileShareLinksForChannel: Failed to create the shareLink for Channel's message. isCrossPostFileSharing: ${c}, Error: ${t}`)}return e},Q=(e,t,n,i,a)=>{const o=[],r=[],s=Z(t,n,i),{teamSiteInformation:l,smtpAddress:c}=s?.channelByID?.owningTeam||{};let d=null;a?s?.channelByID?.channelType&&(d="Private"===s?.channelByID?.channelType||"Shared"===s?.channelByID?.channelType?s?.channelByID?.sharepointSiteUrl||null:l?.sharepointSiteUrl||null):d=l?.sharepointSiteUrl||null;const u=l?.groupId||null;return d&&c&&u&&e?.files?.length&&e.files[0].baseUrl!==d&&(o.push(...e.files),r.push({id:u,smtpAddresses:[c],objectId:u})),[o,r]},J=(e,t,n)=>{const i=[],a=[],o=e.crossPostChannels?[...e.crossPostChannels]:[],r=X(t,o,n);return e.files?.forEach((e=>{let t=!1;r?.channelsByIds?.forEach((n=>{const{teamSiteInformation:i,smtpAddress:o}=n?.owningTeam||{},r=i?.sharepointSiteUrl||null,s=i?.groupId||null;s&&r&&o&&e.baseUrl!==r&&(t=!0,a.some((e=>e.id===s))||a.push({id:s,smtpAddresses:[o],objectId:s}))})),t&&i.push(e)})),n.log(`getFilesAndRecipientsForCrossPost: ${i.length} files and ${a.length} recipients.`),[i,a]},K=(e,t,n)=>{const i={errorCode:`${e.serverResponse?.status}`,errors:JSON.stringify([e.code?.toString()]),correlationId:e.reason?.correlationId,errorMessage:e.reason?.logErrorMessage,numOfUsers:n,reason:e.reason?.reason};t.fail(i)},Z=(e,t,n)=>{try{return e.readQuery({query:A.r,variables:{conversationId:t}})}catch(e){return n.error("getChannelFieldsForFileSharing: Failed to find channels related data"),null}},X=(e,t,n)=>{try{return e.readQuery({query:E,variables:{conversationIds:t,includeTeams:!0}})}catch(e){return n.error("getChannelsFieldsForFileSharing: Failed to find channels related data"),null}},ee=async(e,t,{getFluidService:n})=>{if(e&&e.content&&e.fluidUrlPermissionInfo&&e.fluidUrlPermissionInfo.grantPermissionVariables){const{siteUrl:i,driveId:a,itemId:o,queryParams:r,linkType:s,scope:l,recipientList:c,createShareLinkOptions:d}=e.fluidUrlPermissionInfo.grantPermissionVariables,u=await n();try{const t=await u.createShareLink(i,a,o,r,s,l,c,d),n=t?.link?.webUrl,m=e.computed?.cards;if(m&&n){const t=m.find((e=>e.contentType===p.b.FluidEmbed||"fluid-card"===e.appId));if(t&&t.contentType===p.b.FluidEmbed){const i=t.cardClientId,a=JSON.parse(t.content).componentUrl,o=te(t,n),r=ne(e.content,w.A.fluidEmbedLink,n,a,i);return{...e,content:r,computed:{...e.computed,cards:o}}}if(t&&"fluid-card"===t.appId){const i=te(t,n);return{...e,computed:{...e.computed,cards:i}}}}}catch(e){t.warn(`Error creating fluid sharelink in chat resolvers: ${e}`)}}return e},te=(e,t)=>{const n=[],i=e.contentType===p.b.FluidEmbed?JSON.parse(e.content).sourceType:null,a=JSON.stringify({componentUrl:t,sourceType:i}),o={...e,content:a};return n.push(o),n},ne=(e,t=w.A.fluidLink,n,i,a)=>{const o=I.L.parseDOM(e),r=I.L.DomUtils.findAll((e=>"a"===e.name&&I.L.DomUtils.getAttributeValue(e,T.eS.itemtype)===t&&!!I.L.DomUtils.getAttributeValue(e,"href")),o),s=I.L.DomUtils.getAttributeValue(o[1],"itemid"),l=I.L.DomUtils.getAttributeValue(r[0],"href");if((e=>e.length>=1)(r)&&r[0]&&s&&a&&l&&i&&n&&s===a&&l===i){return e.replace(/href="(.*?)"/,`href="${n}`)}return e},ie=async(e,t,n,a,s,l)=>{try{const a=e.hasFederatedUser,c=e.hasTflConsumerUser,[d,u]=c?(0,i.partition)(e.memberIds,(t=>(0,g.W4)(t)&&!(0,h.xl)(e.id))):[[],e.memberIds];let m;s&&a?(n.mark(o.BQ.FetchingFederatedUser),m=await(0,r.w_)(u||[],t)):m=await(0,r.O$)(u||[],t);let p,v=[];return l&&c&&(n.mark(o.BQ.FetchingTflConsumerUser),v=await(0,r.gW)(d||[],t)),p=a&&c?R:a?x:c?L:O,n.mark(o.BQ.FetchingUserDetailsCompleted,{message:p}),m.concat(v)}catch(e){throw a.error("getUsersForShareLink: Failed to fetch users from People Service(mt)."),e}},ae=async(e,t,n,i,o,r,l,c,d,u)=>{let m;try{m=t.readQuery({query:a.A,variables:{convId:e}})?.chat}catch(e){i.error("Failed to find chat in cache")}if(r&&!m){const t=await n.getCSAService(),i=await t.getChat(e);i&&(m=(0,s.FC)(i,o,l,{id:c},d))}const p=(0,s.Fz)(u)||(0,s.fc)(u);if(!m&&p&&u){e=u;try{m=t.readQuery({query:a.A,variables:{convId:e}})?.chat}catch(e){i.error("Failed to find chat in cache")}}return m},oe=({chatType:e})=>"Chat"===e||"Meeting"===e,re=(e,t)=>{const n=!(0,i.isEmpty)(t?.botMembers),a=!!e.computed?.mentions?.find((e=>"bot"===e.mentionType));if(!(t?.isOneOnOneBotChat||n&&a))return e;const o={},r=(0,l.Xy)([d],e.content,o);return o.isPureText&&!(0,i.isNil)(o.textContent)?{...e,content:o.textContent,messageType:"BotMessageBack"===e.messageType?"BotMessageBack":v.Go.Text}:{...e,content:r}},se=(e,t,n,i,a)=>{let o="";return e||(o=o?o.concat(", Chat Object ( thus meetingUrl)"):o.concat("Missing Chat Object ( thus meetingUrl)")),t||(o=o?o.concat(", externalEntityKey"):o.concat("Missing externalEntityKey")),n||(o=o?o.concat(", organizer"):o.concat("Missing organizer")),i||(o=o?o.concat(", user"):o.concat("Missing user")),e&&!e.meetingInformation?.meetingJoinUrl&&(o=o?o.concat(", meetingUrl"):o.concat("Missing meetingUrl")),a||(o=o?o.concat(", organizerUpn"):o.concat("Missing organizerUpn")),o||void 0},le=(e,t,n,i)=>{i&&e.log(t,n)}},659726:(e,t,n)=>{"use strict";n.d(t,{r:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatChannelIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"parentTeamId"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"channelResourceTenantId"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"membershipSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"memberCount"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}}]}}]}},970548:(e,t,n)=>{"use strict";n.d(t,{R:()=>a});var i=n(975021);function a(e){switch(e.__typename){case"BreakoutRoom":return`${e.__typename}:${e.coordinates?.threadId}`;case"Participant":return`${e.__typename}:${e.participantId}`;case"TeamTagCards":return`${e.__typename}:${e.teamId}`;case"TagCard":return`${e.__typename}:${e.tagId}`;case"Entity":return e.linkedEntity?`${e.__typename}:${e.id}:${e.type}:${e.action}:${e.options}:${e.linkedEntity.id}:${e.linkedEntity.type}:${e.linkedEntity.action}`:`${e.__typename}:${e.id}:${e.type}:${e.action}:${e.options}`;case"LinkedEntity":return`${e.__typename}:${e.id}:${e.type}:${e.action}`;case"ExtensibilityAppPickerCategory":return e.conversationId?`${(0,i.or)(e)}:${e.conversationId}`:(0,i.or)(e);case"InstalledApp":const t=`${(0,i.or)(e)}:${e.installedScope}`;return e.conversationId?`${t}:${e.conversationId}`:t;case"AppDefinition":return`${(0,i.or)(e)}:${e.version}`;case"MessageExtensionCommand":return`${(0,i.or)(e)}:${e.appKey}`;case"BotDynamicCommands":return`${e.__typename}:${e.botMri}:${e.commandContext}`;case"Device":return`${e.__typename}:${e.type}:${e.id}`;case"DeviceList":if(!e.id)throw new Error("dataIdFromObject(), no id on DeviceList object.");return(0,i.or)(e);case"TransportCompanionDeviceInfo":case"UserPreferences":case"UserSettings":case"MessagingSettings":case"MeetingChatSettings":case"AppsUsage":case"TranslationSettingsV2":return e.__typename;case"StagedApp":return`${(0,i.or)(e)}:${e.reviewStatus}`;case"CallLogParticipant":return`${(0,i.or)(e)}:${e.displayName}:${e.type}:${e.applicationType}`;case"WebApplicationInfo":return`${e.__typename}:${e.appKey}`;case"DeepLink":return`${e.__typename}:${e.id}:${e.serverRelativeUrl}`;case"MeetingThreadProperties":return e.hideOneOnOneMeetingReport?`${(0,i.or)(e)}:${e.hideOneOnOneMeetingReport}`:(0,i.or)(e);default:return(0,i.or)(e)}}},653171:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});var i=n(269483);const a={Mutation:{updateFilePermission(e,{updateFilePermissionInput:t},{cache:n}){if(!t)return!1;const{fileId:a,shareUrl:o,shareId:r,scope:s}=t,l=i.J1`
  fragment filePermissionUpdate on FileUpload {
    id
    shareUrl
    shareId
    permissionScope
  }
`;let c;const d=`FileUpload:${a}`;try{c=n.readFragment({fragment:l,id:d})}catch(e){throw e}if(!c)throw new Error("Expected initial files to be populated before a command is executed");const u={...c,shareUrl:o,shareId:r,permissionScope:s};return n.writeFragment({fragment:l,id:d,data:u}),!0},updatePermissionScopeInFileUpload(e,{updatePermissionScopeInput:t},{cache:n}){if(!t)return!1;const{fileId:a,scope:o}=t;if(!a)return!1;const r={permissionScope:o,__typename:"FileUpload"};try{n.writeFragment({fragment:i.J1`
  fragment updatePermissionScope on FileUpload {
    permissionScope
  }
`,id:`FileUpload:${a}`,data:r})}catch(e){return!1}return!0},updateMessageApiFileProperties(e,{fileUploadRedeemPayload:t},{cache:n,loggerFactory:a}){const r=a.newLogger("updateMessageApiFileProperties","data-resolvers-browser-files");if(!t)return!1;const{fileId:s}=t;if(!s)return!1;const l=i.J1`
  fragment filePropertiesUpdate on FileUpload {
    id
    sharepointIds
    site
    publication
  }
`;let c;const d=`FileUpload:${s}`;try{c=n.readFragment({fragment:l,id:d})}catch(e){throw e}if(!c)throw new Error("Expected initial files to be populated before a command is executed");if(c.sharepointIds?.siteUrl||c.site?.dataLocationCode||c.publication?.level){const e=`SWM file properties should already be populated via sharelink flow for fileId: ${s}`;return r.infoToTelemetry?.(e,"file_permission_client_resolvers",void 0,!0),!1}const u=o(c,t);try{n.writeFragment({fragment:l,id:d,data:u});const e=`Updated SWM file poperties for fileId: ${s}`;r.infoToTelemetry?.(e,"file_permission_client_resolvers",void 0,!0)}catch(e){const t=`Failed updating SWM file properties for fileId: ${s}`;return r.infoToTelemetry?.(t,"file_permission_client_resolvers",void 0,!0),!1}return!0}}},o=(e,t)=>({...e,sharepointIds:t.sharepointIds,site:t.site,publication:t.publication})},106752:(e,t,n)=>{"use strict";n.d(t,{l:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataResolversBrowserLiveMeetingStatusBarAddMeetingToLiveMeetingStatusBarMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AddMeetingToLiveMeetingStatusBarInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMeetingToLiveMeetingStatusBar"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AddMeetingToLiveMeetingStatusBarPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"liveMeeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"rsvpStatus"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"iCalUid"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeetingError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]}},883791:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataResolversBrowserLiveMeetingStatusBarRemoveAllMeetingsFromLiveMeetingStatusBarMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAllMeetingsFromLiveMeetingStatusBar"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RemoveAllMeetingsFromLiveMeetingStatusBarPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"liveMeetings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"rsvpStatus"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"iCalUid"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeetingError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]}},508648:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataResolversBrowserLiveMeetingStatusBarRemoveMeetingFromLiveMeetingStatusBarMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RemoveMeetingFromLiveMeetingStatusBarInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeMeetingFromLiveMeetingStatusBar"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RemoveMeetingFromLiveMeetingStatusBarPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"liveMeeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"rsvpStatus"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"iCalUid"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeetingError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]}},894772:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserLiveMeetingStatusBarLiveMeetingStatusBarQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"liveMeetingStatusBar"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeetingStatusBarPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"liveMeetings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"rsvpStatus"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"iCalUid"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeetingError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]}},860342:(e,t,n)=>{"use strict";n.d(t,{_h:()=>C,K6:()=>k});var i=n(754255),a=n(850434),o=n(702183),r=n(839623),s=n(369664);var l=n(930891),c=n(639884),d=n(199448),u=n(364819),m=n(924820);const p=e=>(0,m.y)(e)||"<scrubbed>",g=e=>e.map((e=>e.type)).sort().toString(),h=e=>new RegExp(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i).test(e);var v=n(289362),y=n(806658);let S;const f=e=>S||(S=e.newLogger("meeting-artifacts-resolvers","data-resolvers-browser-meeting-artifacts")),k={Query:{async meetingArtifacts(e,{meetingArtifactType:t,externalEntityKey:n,organizer:i,user:a,organizedByUserId:r,organizedByUserUpn:s},{getCollabObjectService:l,scenarioFactory:c,loggerFactory:d,callerApp:u}){const{scenario:m,correlationId:h}=(0,v.k5)(o.Cu.ReadCollabObject,c),y=p(n);m.appendEventData({externalEntityKey:y}),f(d),S.log(`Read collab object for ${y}`);try{const e=await l(),o=await e.readCollabObject(h,n,i,a,r=r||"",s=s||"",void 0,void 0,u),c=(o?.resources||[]).filter((e=>e.type.toLowerCase()===t.toLowerCase())).map((e=>({id:e.id,type:w(e.type),location:e.location,metadata:e.metadata})));S.log(`type of resources received after reading collabObject ${g(c)}`);const d={changeKey:o?.changeKey,resources:c};return m.stop({message:g(c)}),d}catch(e){return(0,v.zH)(e,m),Promise.reject(e)}},async allMeetingArtifacts(e,{externalEntityKey:t,organizer:n,user:i,organizedByUserId:a,organizedByUserUpn:r},{getCollabObjectService:s,scenarioFactory:l,loggerFactory:c,callerApp:d}){const{scenario:u,correlationId:m}=(0,v.k5)(o.Cu.ReadCollabObject,l),h=p(t);u.appendEventData({externalEntityKey:h}),f(c),S.log(`Read collab object to get all meeting artifacts for ${h}`);try{const e=await s(),o=await e.readCollabObject(m,t,n,i,a=a||"",r=r||"",void 0,void 0,d),l=(o?.resources||[]).filter((e=>T(e.type))).map((e=>({id:e.id,type:w(e.type),location:e.location,subType:e.subType,...e.metadata})));S.log(`type of resources received after reading collabObject to get all meeting artifacts are ${g(l)}`);const c={changeKey:o?.changeKey,resources:l};return u.stop({message:g(l)}),c}catch(e){return(0,v.zH)(e,u),Promise.reject(e)}},async allMeetingArtifactsBatch(e,{meetingArtifactsBatchInputList:t},{getCollabObjectService:n,scenarioFactory:i,loggerFactory:a}){const{scenario:r,correlationId:c}=(0,v.k5)(o.Cu.ReadCollabObjectBatchRequest,i);f(a),S.log(`Read group of meeting artifacts for ${t.length} meetings start`);try{const e=await n(),i=await e.readCollabObjectBatchRequest(c,function(e,t){const n={collabIds:{}};return e.forEach((i=>{if((e=>{const t=e.split("@");return 2===t.length&&(0,s.a)(t[0])&&(0,s.a)(t[1])})(i.organizer))n.collabIds={...n.collabIds,[i.iCalUid]:{organizer:i.organizer}};else if((0,l.B)(i.organizer))e.forEach((e=>{n.collabIds={...n.collabIds,[e.iCalUid]:{smtp:e.organizer}}}));else{let e="organizer is not valid uuid@uuid or email id";(0,y.AF)(i.organizer)&&(e=`${e} but it is a skype mri`),t&&t.appendEventData({message:e})}})),n}(t,r)),a=function(e){const t=[];if(e?.collabMap){const n=e.collabMap;Object.keys(n).forEach((e=>{const i=n[e],a={iCalUid:e,value:{resources:(i.collab?.resources||[]).filter((e=>T(e.type))).map((e=>({id:e.id,type:w(e.type),location:e.location,subType:e.subType,...e.metadata})))}};t.push(a)}))}return t}(i);return S.log(`Read group of meeting artifacts for ${a.length} meetings success`),r.stop(),a}catch(e){return(0,v.zH)(e,r),Promise.reject(e)}},async reserveMeetingArtifact(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:a,meetingParams:r,organizedByUserId:s,organizedByUserUpn:l},{getCollabObjectService:c,scenarioFactory:d,loggerFactory:u,callerApp:m}){const{scenario:g,correlationId:y}=(0,v.k5)(o.Cu.ReserveResourceToCollabObject,d),k=p(t),C=p(n);g.appendEventData({externalEntityKey:k,seriesExternalEntityKey:C}),f(u),S.log(`Reserve meeting artifact for instance externalEntityKey: ${k}, series externalEntityKey: ${C}`);try{if(s&&!h(s)){const e="organizedByUserId is not valid uuid";throw g.appendEventData({message:e}),new Error(e)}const e="Notes",o=await c(),d=await o.reserveResourceToCollabObject(y,function(e,t,n,i,a,o,r,s){return{type:e.toLowerCase(),externalEntityKey:t,seriesExternalEntityKey:n,meetingUrl:s.meetingUrl,threadId:s.threadId,messageId:s.messageId,organizerUpn:s.organizerUpn,organizer:i,user:r,organizedByUserId:a,organizedByUserUpn:o}}(e,t,n,i,s||i.split("@")[0],l||r.organizerUpn,a,r),m);if(d?.collab){const t=b(e,d);return g.stop(),{...d,collab:{changeKey:d?.collab.changeKey,resources:t}}}return g.stop(),d}catch(e){return(0,v.zH)(e,g),Promise.reject(e)}},async readAndOptionallyReserveMeetingArtifact(e,{externalEntityKey:t,organizer:n,user:i},{getCollabObjectService:a,scenarioFactory:r,loggerFactory:s,callerApp:l}){const{scenario:c,correlationId:d}=(0,v.k5)(o.Cu.ReadAndOptionallyReserveResourceToCollabObject,r),u=p(t);c.appendEventData({externalEntityKey:u}),f(s),S.log(`Read and Optionally Reserve meeting artifact for instance externalEntityKey: ${u}`);try{const e="Notes",o=await a(),r=await o.readAndOptionallyReserveResourceToCollabObject(d,function(e,t,n,i){return{type:e.toLowerCase(),externalEntityKey:t,organizer:n,user:i}}(e,t,n,i),l);if(r?.collab){const t=b(e,r);return c.stop(),{...r,collab:{changeKey:r?.collab.changeKey,resources:t}}}return c.stop(),r}catch(e){return(0,v.zH)(e,c),Promise.reject(e)}}},Mutation:{async addMeetingArtifacts(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:a,user:o,meetingParams:r,meetingArtifacts:s,organizedByUserId:l,organizedByUserUpn:c},{getCollabObjectService:d,scenarioFactory:u,loggerFactory:m,callerApp:p,coreSettings:g}){const{enableSPODataInSaveArtifacts:h}=g.get(i.w.ArtifactsPlatform);return C(d,u,m,p,t,n,a,o,s,r,l||"",c||"",!!h)},async commitMeetingArtifact(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:a,secret:s,resourceUri:l,metadata:c},{getCollabObjectService:d,scenarioFactory:m,loggerFactory:g,callerApp:h}){const y=f(g),{scenario:S,correlationId:k}=(0,v.k5)(o.Cu.CommitResourceToCollabObject,m);try{const e=await d(),o=p(t),m=p(n);return y.log(`commit Meeting Artifact to instance externalEntityKey: ${o}, series externalEntityKey: ${m}`),S.appendEventData({externalEntityKey:o,seriesExternalEntityKey:m}),s?(await e.commitResourceToCollabObject(k,function(e,t,n,i,a,o,r,s){const l=s??{};return{type:e.toLowerCase(),externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:a,secret:o,resourceUri:r,metadata:(0,u.omitBy)((0,v.aA)(l),u.isEmpty)}}("Notes",t,n,i,a,s,l,c),h),S.stop(),!0):(y.error("commit Meeting Artifact API called without secret"),S.fail({errorCode:r.MG.INVALID_SECRET.toString(),message:r.D6.INVALID_SECRET}),!1)}catch(e){return(0,v.zH)(e,S),Promise.reject(e)}},async updateMeetingArtifacts(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:s,meetingParams:l,changeKey:c,meetingArtifacts:u,organizedByUserId:m,organizedByUserUpn:y},{getCollabObjectService:S,scenarioFactory:k,loggerFactory:C,callerApp:b}){const w=f(C),{scenario:T,correlationId:I}=(0,v.k5)(o.Cu.UpdateResourcesOnCollabObject,k),N=p(t),A=p(n);w.log(`Update meeting artifacts for externalEntityKey: ${N} and seriesExternalEntityKey: ${A}`);try{if(m&&!h(m)){const e="organizedByUserId is not valid uuid";throw T.appendEventData({externalEntityKey:N,seriesExternalEntityKey:A,message:e}),new Error(e)}const e=await S(),o=u??[];if(T.appendEventData({externalEntityKey:N,seriesExternalEntityKey:A,message:g(o)}),0===o.length){const e=(0,d.$5)(a.Ir.CmdArtifactsServiceClient,a.O4.InvalidInput,"meetingArtifactsResolver.updateMeetingArtifacts",{[r.bf.internalErrorCode]:r.MG.EMPTY_INPUT,[r.bf.logErrorMessage]:r.D6.EMPTY_INPUT},r.D6.EMPTY_INPUT.toString());return(0,v.zH)(e,T),!1}return await e.updateResourcesOnCollabObject(I,function(e,t,n,i,a,o,r,s,l){return{externalEntityKey:e,seriesExternalEntityKey:t,organizer:n,user:i,meetingUrl:a.meetingUrl,threadId:a.threadId,messageId:a.messageId,organizerUpn:a.organizerUpn,changeKey:o,resources:(0,v.nd)(r),organizedByUserId:s,organizedByUserUpn:l}}(t,n,i,s,l,c,o,m||i.split("@")[0],y||l.organizerUpn),b),T.stop(),!0}catch(e){return(0,v.zH)(e,T),Promise.reject(e)}}},MeetingArtifactV2Union:{__resolveType:e=>"Transcript"===e.type?"MeetingArtifactV2Transcript":"TranscriptV2"===e.type?"MeetingArtifactV2TranscriptV2":"Recording"===e.type?"MeetingArtifactV2Recording":"Notes"===e.type?"MeetingArtifactV2Notes":"MeetingContent"===e.type?"MeetingArtifactV2MeetingContent":"MeetingArtifactV2Default"}};async function C(e,t,n,i,a,s,l,c,d,u,m,h,y){const S=f(n),{scenario:k,correlationId:C}=(0,v.k5)(o.Cu.AddResourcesToCollabObject,t);k.appendEventData({callerApp:i});try{const t=await e(),n=p(a);S.log(`Adding meeting artifacts to externalEntityKey: ${n}`);const o=d??[];return k.appendEventData({externalEntityKey:n,message:g(o)}),0===o.length?(S.error("addMeetingArtifacts called with and empty array of meeting artifacts"),k.fail({errorCode:r.MG.EMPTY_INPUT.toString(),message:r.D6.EMPTY_INPUT}),!1):(await t.addResourcesToCollabObject(C,(0,v.f4)(a,s,l,c,u,o,m,h,y),i),k.stop(),!0)}catch(e){return(0,v.zH)(e,k),Promise.reject(e)}}const b=(e,t)=>{const n=(0,c.K)()("Attachment","AttendanceReport","AttendanceReportV3","Decisions","ExplicitActionItems","ExternalParticipants","ImplicitActionItems","ManualActionItems","MeetingChat","MeetingCoach","MeetingContent","MeetingInfo","MeetingInfoV3","MeetingStage","NgcParticipantsActivity","Notes","Playground","Recommendation","Recording","Transcript","TranscriptEntities","TranscriptEvents","TranscriptV2");return t?.collab?.resources?.filter((t=>t.type.toLowerCase()===n.find((t=>t===e))?.toLowerCase())).map((e=>({...e,id:e.id,type:w(e.type),location:e.location,metadata:e.metadata,subType:e.subType})))},w=e=>{const t=(0,c.K)()("Attachment","AttendanceReport","AttendanceReportV3","Decisions","ExplicitActionItems","ExternalParticipants","ImplicitActionItems","ManualActionItems","MeetingChat","MeetingCoach","MeetingContent","MeetingInfo","MeetingInfoV3","MeetingStage","NgcParticipantsActivity","Notes","Playground","Recommendation","Recording","Transcript","TranscriptEntities","TranscriptEvents","TranscriptV2");for(const n of t)if(n.toLowerCase()===e.toLowerCase())return n;return e},T=e=>{const t=(0,c.K)()("Attachment","AttendanceReport","AttendanceReportV3","Decisions","ExplicitActionItems","ExternalParticipants","ImplicitActionItems","ManualActionItems","MeetingChat","MeetingCoach","MeetingContent","MeetingInfo","MeetingInfoV3","MeetingStage","NgcParticipantsActivity","Notes","Playground","Recommendation","Recording","Transcript","TranscriptEntities","TranscriptEvents","TranscriptV2");for(const n of t)if(n.toLowerCase()===e.toLowerCase())return!0;return!1}},505038:(e,t,n)=>{"use strict";n.d(t,{D:()=>o,K:()=>r});var i=n(881035),a=n(114618);const o={Query:{async meetingBotMetaInfo(e,t,n){const{getMeetingBotService:i}=n,a=await i();return{meetingBotMri:await a.getBotId(),__typename:"MeetingBotMetaInfo"}},async meetingBotCalendarEvents(e,{start:t,end:n},i){const a=await i.getMeetingBotService();return(await a.fetchCalendarEvents(t,n)).filter((e=>!e.isAllDayEvent&&e.isOnlineMeeting)).map((e=>({id:e.objectId,start:new Date(e.startTime).toUTCString(),end:new Date(e.endTime).toUTCString(),iCalUID:e.iCalUID,subject:e.subject,objectId:e.objectId,conversationId:e.skypeTeamsDataObj?.cid,skypeTeamsMeetingUrl:e.skypeTeamsMeetingUrl,isCancelled:e.isCancelled,isAllDayEvent:e.isAllDayEvent})))},meetingBotChatIdForCalendarEvent:async(e,{eventId:t},n)=>(await n.getMeetingBotService()).fetchChatIdForCalendarEvent(t)},Mutation:{async postMeetingStarted(e,{absentAttendees:t,hasRecordingStarted:n,meetingId:a,isForced:o},r){const s=await r.getMeetingBotService();if(!o&&s.isMeetingEventSent(a,i.N.MeetingStart))return"absentAttendee checked";if(s.setMeetingEventSent(a,i.N.MeetingStart),t&&t.length>0){const e=await s.postEventToBot({Scenario:i.N.MeetingStart,MeetingInfo:{HasRecordingStarted:n,AbsentAttendee:t}});return`${e?.status}`}return"no absent attendees"},async postGreetingToMeetingBot(e,{input:{meetingId:t,organizerId:n,recordingState:a,hasPresentedDeck:o,hasRecordingStarted:r,hasProactiveAction:s,absentAttendee:l,timeElapedSinceMeetingStartedInMinutes:c,hasNextMeeting:d,endTime:u,isRecurrent:m}},p){const g=await p.getMeetingBotService();if(g.isMeetingEventSent(t,i.N.InMeetingGreeting)||g.isMeetingEventSent(t,i.N.MeetingStart))return!1;g.setMeetingEventSent(t,i.N.InMeetingGreeting);return!!await g.postEventToBot({Scenario:i.N.InMeetingGreeting,MeetingInfo:{MeetingId:t,AbsentAttendee:l,OrganizerId:n,RecordingState:a,HasPresentedFile:o,HasProactiveAction:s,HasRecordingStarted:r,TimeElapedSinceMeetingStartedInMinutes:c,HasNextMeeting:d,EndTime:u,IsRecurrent:m,Subject:"Subject"}})},async tryStartMeetingBotPublisher(e,t,n){const{getMeetingBotService:i,loggerFactory:a}=n;a.newLogger("MeetingBot Resolver","data-resolvers-browser-meeting-artifacts").log("tryStartMeetingBotPublisher");const o=await i();return await o.startPublisher(),!0},async sendActionStatus(e,{botAction:t,isActionSucess:n,nextMeetingName:a},o){const r=await o.getMeetingBotService();return await r.postEventToBot({Scenario:i.N.InMeetingActionStatusUpdated,MeetingInfo:{InMeetingAction:t,IsActionSucceed:n,NextMeetingName:a}}),!0},async sendRunningLateForNextMeetingNotification(e,{iCalUID:t,subject:n,objectId:a,conversationId:o},r){const s=await r.getMeetingBotService();return await s.postEventToBot({Scenario:i.N.RunningLate,MeetingInfo:{CallId:t,ThreadId:o,Subject:n,MeetingUid:a}}),!0},async removeCalendarEvent(e,{eventId:t},n){const i=await n.getMeetingBotService();return await i.removeCalendarEvent(t),"Message sent"},sendMeetingBotMessage:async(e,{text:t,conversationId:n},i)=>(await i.getMeetingBotService()).sendMeetingBotMessage(t,n),async sendMeetingObjectId(e,{meetingObjectId:t},n){const a=await n.getMeetingBotService();return await a.postEventToBot({Scenario:i.N.InMeetingShareFile,MeetingInfo:{MeetingId:t}}),!0},reportUsageToMeetingBot:async(e,t,n)=>(await n.getMeetingBotService()).reportUsageToMeetingBot(),async triggerBotAction(e,{conversationId:t,botAction:n,actionId:i},a){const o=await a.getMeetingBotService(),r=await o.fetchChatIdForCalendarEvent(t);return a.pubsub.publish("meetingBotActionEvent",{meetingBotActionEvent:{conversationId:r,botAction:n,actionId:i},__typename:"meetingBotActionEvent"}),!0},async sendMessageToConversation(e,{conversationId:t,message:n,files:i},a){if(i&&!i.length)return!1;const o=await a.getMeetingBotService();return await o.sendToConversation(t,n,i),!0}}},r={Subscription:{meetingBotActionEvent:{subscribe:(0,a.pZ)(((e,t,{pubsub:n})=>n.asyncIterator(["meetingBotActionEvent"])),((e,t)=>t.conversationId===e.meetingBotActionEvent.conversationId))}}}},380840:(e,t,n)=>{"use strict";n.d(t,{G:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserMeetingRoomMeetingRoomFrontOfRoomCallPanelsStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meetingRoomFrontOfRoomCallPanelsState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"rightPanel"}}]}}]}}]}},413555:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var i=n(129185),a=n(380840);const o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserMeetingRoomWhiteboardWalkUpStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"whiteboardWalkUpState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},r={Query:{meetingRoomFrontOfRoomCallPanelsState:(e,{teamsCallId:t},{cache:n})=>{let o=(0,i.HV)(t);try{const e=n.readQuery({query:a.G,variables:{teamsCallId:t}}),i=e?.meetingRoomFrontOfRoomCallPanelsState;o=i??o}catch(e){}return o},whiteboardWalkUpState:(e,t,{cache:n,loggerFactory:i})=>{try{const e=n.readQuery({query:o});return e?.whiteboardWalkUpState??"Inactive"}catch(e){const t=i?.newLogger("whiteboardWalkUpState","data-resolvers-browser-meeting-room");t?.error("failed to get data")}return"Inactive"}},Mutation:{setMeetingRoomFrontOfRoomCallPanelsState:(e,{teamsCallId:t,state:n},{cache:o,loggerFactory:r})=>{const s=r?.newLogger("setMeetingRoomFrontOfRoomCallPanelsState","data-resolvers-browser-meeting-room");let l=(0,i.HV)(t);try{const e=o.readQuery({query:a.G,variables:{teamsCallId:t}});e?.meetingRoomFrontOfRoomCallPanelsState&&(l=e.meetingRoomFrontOfRoomCallPanelsState)}catch(e){s?.error("No data found in cache for meetingRoomFrontOfRoomCallPanelsState, using default value")}const c={__typename:"MeetingRoomFrontOfRoomCallPanelsState",id:l.id,rightPanel:n.rightPanel??null};try{o.writeQuery({query:a.G,variables:{teamsCallId:t},data:{meetingRoomFrontOfRoomCallPanelsState:c}})}catch(e){s?.error("setMeetingRoomFrontOfRoomCallPanelsState to cache failed.")}return c},updateWhiteboardWalkUpState:async(e,{state:t},{cache:n,loggerFactory:i})=>{const a=i?.newLogger("updateWhiteboardWalkUpState","data-resolvers-browser-meeting-room");try{n.writeQuery({query:o,data:{whiteboardWalkUpState:t.whiteboardWalkUpState}})}catch(e){a?.error("updateWhiteboardWalkUpState to cache failed.")}return!0}}}},129185:(e,t,n)=>{"use strict";n.d(t,{HV:()=>i,Jc:()=>a});const i=e=>({__typename:"MeetingRoomFrontOfRoomCallPanelsState",id:e,rightPanel:null}),a=async({entrypointType:e,dataRequestContext:t,callback:n})=>{const{getCallingService:i,loggerFactory:a,cancellationListener:r}=t,s=a.newLogger("invokeCallingApi","data-resolvers-browser-meeting-room"),l=await i(e);return s.log(`Emitting meeting-room event request via api for endpoint: ${e}`),n(l,o(),r)},o=()=>({hostRendererId:"",component:"Resolver"})},128299:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i="payment-service"},735544:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var i=n(128299),a=n(527807);let o;const r={Mutation:{updatePaymentDetailsInCache:(e,{eventId:t,paymentDetails:n},{cache:r,loggerFactory:s})=>{(e=>{o||(o=e.newLogger(i.A,"data-resolvers-browser-payment"))})(s);try{const e={...r.readQuery({query:a.M,variables:{eventId:t}})?.paymentDetails||{},...n,__typename:"PaymentDetails"};return r.writeQuery({query:a.M,variables:{eventId:t},data:{paymentDetails:e}}),{...e,__typename:"PaymentDetails"}}catch(e){throw o.error("Payment client resolver failed to update payment details in cache",e),e}}}}},527807:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"paymentDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paymentDetails"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventId"},value:{kind:"Variable",name:{kind:"Name",value:"eventId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"paymentProvider"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"product"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"price"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}}]}}]}}]}}]}}]}},922114:(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var i=n(554186);const a={Query:{},Mutation:{async groupCopilotSendThreadMetadata(e,{callId:t,threadId:n,organizerId:a,iCalUid:o,startTime:r},{getTeamsCopilotAggregator:s,loggerFactory:l,callerApp:c}){const d=l.newLogger("teams-copilot-resolvers","components-meeting-collaboration"),u=(0,i.v4)();let m;try{const e=await s(),i={callId:t,threadId:n,organizerId:a,iCalUid:o,startTime:r};m=await e.saveThreadMetadata(u,i,c)}catch(e){return d.error(`[teamsCopilotResolvers] Could not save initial thread metadata to TCA with errorCode: ${e?.errorCode}`),Promise.reject(e)}if(200===m.statusCode)return!0;{const e=`[teamsCopilotResolvers] Response from TCS and TCA is not success, with statusCode: ${m.statusCode}`;return d.error(e),Promise.reject(e)}},async sendMeetingAgenda(e,{callId:t,agenda:n,notesUrl:a,iCalUid:o,organizerTenantId:r,threadId:s},{getTeamsCopilotAggregator:l,getTeamsCopilotService:c,loggerFactory:d,callerApp:u}){const m=d.newLogger("teams-copilot-resolvers","components-meeting-collaboration"),p=(0,i.v4)();let g;try{const e=await c(),i={callId:t,agenda:n,notesUrl:a};g=await e.addCopilotResources(p,i,u)}catch(e){m.log(`Could not save meeting agenda to TCS with errorCode: ${e?.errorCode}`)}try{const e=await l(),i={callId:t,agenda:n,notesUrl:a,iCalUid:o,organizerTenantId:r,threadId:s};g=await e.saveNotesData(p,i,u)}catch(e){return m.error(`[teamsCopilotResolvers] Could not save meeting agenda to TCA with errorCode: ${e?.errorCode}`),Promise.reject(e)}if(200===g.statusCode)return!0;{const e=`[teamsCopilotResolvers] Response from TCS and TCA is not success, with statusCode: ${g.statusCode}`;return m.error(e),Promise.reject(e)}},async sendCalendarEvent(e,{callId:t,calendarEvent:n},{getTeamsCopilotService:a,loggerFactory:r,callerApp:s}){const l=r.newLogger("teams-copilot-resolvers","components-meeting-collaboration");try{const e=(0,i.v4)(),r=await a(),c={callId:t,calendarEvent:o(n)},d=await r.saveCalendarData(e,c,s);return d?.body?d?.body:(l.log("No response from teams copilot service"),Promise.reject("No response teams copilot service"))}catch(e){return l.log(`Could not save calendar event ${e?.errorCode}`),Promise.reject(e)}},async sendCalendarEventV2(e,{callId:t,calendarEvent:n,threadId:a},{getTeamsCopilotAggregator:o,getTeamsCopilotService:r,loggerFactory:s,callerApp:l}){const c=s.newLogger("teams-copilot-resolvers","components-meeting-collaboration"),d=(0,i.v4)();let u;try{const e=await r(),i={callId:t,calendarEvent:n};u=await e.saveCalendarDataV2(d,i,l)}catch(e){c.log(`Could not save calendar event v2 to TCS with errorCode: ${e?.errorCode}`)}try{const e=JSON.parse(n).callCopilotEventDetails,i=await o(),r={callId:t,organizerTenantId:e?.organizerTenantId,iCalUid:e?.iCalUid,startTime:e?.startTime,endTime:e?.endTime,isCancelled:e?.isCancelled,subject:e?.subject,eventType:e?.eventType,attendees:e?.attendees||[],threadId:a};u=await i.saveCalendarData(d,r,l)}catch(e){return c.error(`[teamsCopilotResolvers] Could not save calendar data to TCA with errorCode: ${e?.message}`),Promise.reject(e)}if(200===u.statusCode)return!0;{const e=`[teamsCopilotResolvers] Response from TCS and TCA is not success, with statusCode: ${u.statusCode}`;return c.error(e),Promise.reject(e)}},async sendConfiguationEvent(e,{callId:t,requestUrl:n,tcsEndpointUrl:a},{getTeamsCopilotService:o,loggerFactory:r,callerApp:s}){const l=r.newLogger("teams-copilot-resolvers","components-meeting-collaboration");try{const e=(0,i.v4)(),r=await o(),l={callId:t,requestUrl:n,tcsEndpointUrl:a},c=await r.sendConfigurationData(e,l,s);return c?.body?c?.body:Promise.reject("No response from copilot bot")}catch(e){return l.error(`Could not send configuration  event v2 ${e?.errorCode}`),Promise.reject(e)}}}},o=e=>({CallCopilotEventDetails:{id:e.callCopilotEventDetails.id,startTime:e.callCopilotEventDetails.startTime,endTime:e.callCopilotEventDetails.endTime,eventType:e.callCopilotEventDetails.eventType,iCalUid:e.callCopilotEventDetails.iCalUid,isCancelled:e.callCopilotEventDetails.isCancelled,subject:e.callCopilotEventDetails.subject}})},18995:(e,t,n)=>{"use strict";n.d(t,{D:()=>m});var i=n(299902),a=n(364819);function o(e,t){return e.isUserMuted?"MutedTeamMember":function(e,t){return t.isGeneral&&"Admin"!==e.memberRole&&function(e){return e.teamSettings&&"OwnersPost"===e.teamSettings.generalChannelPosting}(e)}(e,t)?"OnlyOwnersCanPost":"None"}var r=n(12426);function s(e,t){return{id:t.id,channelType:c(t.channelType),isGeneral:t.isGeneral||!1,displayName:t.displayName,disallowedToPostReason:o(e,t),consumptionHorizon:t.consumptionHorizon?{...t.consumptionHorizon,__typename:"ClientConsumptionHorizon"}:null,filesRelativePath:t.defaultFileSettings?.filesRelativePath||null,memberRole:d(t.memberRole),isModerator:t.isModerator||!1,channelSettings:{__typename:"ChannelSettings",channelPostPermissions:u(t.channelSettings?.channelPostPermissions)},sharepointSiteUrl:t.sharepointSiteUrl||null,team:{id:e.id,displayName:e.displayName,groupId:e.teamSiteInformation.groupId,sharepointSiteUrl:e.teamSiteInformation.sharepointSiteUrl||null,pictureETag:e.pictureETag||null,smtpAddress:e.smtpAddress,teamSettings:e.teamSettings,__typename:"ClientTeam"},isArchived:t.isArchived,isDeleted:t.isDeleted,__typename:"ChannelWithTeam"}}function l(e){return(0,a.flatMap)(e,(e=>e.filteredChannels.map(s.bind(void 0,e))))}function c(e){switch(e){case"Standard":return"Standard";case"Private":return"Private";case"Shared":return"Shared";default:return null}}const d=e=>{switch(e){case"Admin":return"Admin";case"Guest":return"Guest";case"User":return"User";default:return"Undefined"}},u=e=>{switch(e){case"Moderators":return"Moderators";case"EveryoneButGuests":return"EveryoneButGuests";default:return"Everyone"}},m={Query:{channelSearch:async(e,{searchQuery:t},n)=>{let i=await p(n);if(0===i.length)return{__typename:"ChannelSearchResults",resultsByChannelName:[],resultsByTeamName:[]};i=i.filter((e=>!e.isDeleted)).map((e=>({...e,channels:e.channels.filter((e=>!e.isDeleted))})));const o=new RegExp((0,a.escapeRegExp)(t.toLowerCase())),r=(0,a.cloneDeep)(i).filter((e=>o.test(e.displayName.toLowerCase()))).map((e=>(e.filteredChannels=e.channels,e)));return{__typename:"ChannelSearchResults",resultsByChannelName:l(i.map((e=>(e.filteredChannels=e.channels.filter((e=>o.test(e.displayName.toLowerCase()))),e)))),resultsByTeamName:l(r)}},channel:async(e,{channelId:t},n)=>{const i=await p(n);let o;return(0,a.forEach)(i,(e=>{const n=(0,a.find)(e.channels,{id:t});return!n||(o=s(e,n),!1)})),o}}};async function p(e){const{authenticationUser:t,cache:n,coreSettings:a,localStorage:o,loggerFactory:s,scenarioFactory:l}=e;let c;try{({teams:c}=n.readQuery({query:i.y}))}catch(e){s.newLogger("ClientResolvers","data-resolvers-browser-teams").warn("Cache error, returning empty data instead");const d=t&&await(0,r.DB)(t,a,o,l);if(d){const e=d.map(r.fb);n.writeQuery({query:i.y,data:{teams:e}})}c=d||[]}return c}},299902:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"teamsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"isUserMuted"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"pictureETag"}},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"generalChannelPosting"}}]}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"channels"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"isGeneral"}},{kind:"Field",name:{kind:"Name",value:"isShown"}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}}]}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"channelSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelPostPermissions"}}]}},{kind:"Field",name:{kind:"Name",value:"isModerator"}}]}}]}}]}}]}},12426:(e,t,n)=>{"use strict";n.d(t,{fb:()=>k,DB:()=>A,p9:()=>P,aC:()=>R});var i=n(364819),a=n(754255),o=n(702183),r=n(269996),s=n(797922),l=n(84646),c=n(645095),d=n(405947),u=n(779898);const m=7,p=2,g="conversations",h="skypexspaces",v="Teams:conversation-manager",y="teams-list",S=7;function f(e){return{__typename:"Channel",...(0,i.defaults)((0,i.pick)(e,["id","channelType","displayName","isArchived","isDeleted","isGeneral","isModerator","isShown","memberRole"]),{channelType:null,isArchived:null,isDeleted:null,isModerator:null,memberRole:null}),channelSettings:(0,i.defaults)(e.channelSettings,{__typename:"ChannelSettings",channelPostPermissions:null}),defaultFileSettings:{__typename:"DefaultFileSettings",filesRelativePath:e.defaultFileSettings?.filesRelativePath||null},sharepointSiteUrl:e.sharepointSiteUrl||null,...e.consumptionHorizon?.id?{consumptionHorizon:{__typename:"ConsumptionHorizon",id:e.consumptionHorizon.id,timeStamp:e.consumptionHorizon.timeStamp||null}}:{consumptionHorizon:null}}}function k(e){return{__typename:"Team",...(0,i.defaults)((0,i.pick)(e,["id","displayName","isDeleted","isUserMuted","memberRole","smtpAddress","pictureETag","teamType"]),{isUserMuted:null,pictureETag:null,smtpAddress:null,teamType:null}),teamSettings:{__typename:"TeamSettings",generalChannelPosting:e.teamSettings?.generalChannelPosting||null},teamSiteInformation:{__typename:"TeamSiteInformation",...(0,i.defaults)((0,i.pick)(e.teamSiteInformation,["groupId","sharepointSiteUrl"]),{groupId:null,sharepointSiteUrl:null})},channels:(e.channels||[]).map(f)}}function C(e){try{return JSON.parse(e)}catch(e){return}}function b(e){if(!e||0===e.length)return;const t=new Map,n=new Map;e.filter((e=>e&&(0,s.IJ)(e))).map((e=>t.set(e.id,function(e){const t=e.threadProperties;return{id:e.id,displayName:t[l.iy.SpaceThreadTopic]||"",isDeleted:(0,s.oy)(e),memberRole:N(e.memberProperties?.role||l.mz.None),teamSiteInformation:{groupId:t[l.iy.GroupId]||"",sharepointSiteUrl:t[l.iy.SiteUrl]},smtpAddress:t[l.iy.TeamSmtpAddress],pictureETag:t[l.iy.PictureETag],isFavorite:(0,s.BA)(e),channels:[],...I(e)}}(e)))),e.filter((e=>e&&(0,s.IV)(e)&&e.threadProperties)).map((e=>n.set(e.id,{teamId:e.threadProperties[l.iy.SpaceId],channel:w(e)}))),n.forEach((e=>{const{teamId:n,channel:i}=e,a=n&&t.get(n);a&&(i.team=a,a.channels.push(i))}));const i=Array.from(t.values());return i.length>0?i:void 0}function w(e){const t=e.threadProperties,n=t[l.iy.SpaceTypes]===c.QU.Private;return{id:e.id,displayName:(n?t[l.iy.SpaceThreadTopic]:(0,s.NX)(e))||"",description:t[l.iy.TopicDescription]||"",isDeleted:(0,s.oy)(e),isGeneral:(0,s.IJ)(e),channelType:T(t[l.iy.SpaceTypes]),tabs:[],isShown:(0,s.BA)(e),isShownByDefault:"true"===t[l.iy.FavDefault]?.toLowerCase(),sharepointSiteUrl:n?t[l.iy.SiteUrl]:void 0,defaultFileSettings:{filesRelativePath:t[l.iy.FolderRelativeUrl]},consumptionHorizon:(0,d.FQ)(e)}}function T(e){switch(e){case c.QU.Private:return"Private";case c.QU.Shared:return"Shared";case c.QU.None:default:return"Standard"}}function I(e){const t=C(e.threadProperties[l.iy.TeamAdminSettings]);return t?{teamSettings:t.userSettings,teamGuestSettings:t.guestSettings}:{teamSettings:{}}}function N(e){switch(e){case l.mz.Admin:return"Admin";case l.mz.Guest:return"Guest";case l.mz.User:return"User";case l.mz.None:default:return"Undefined"}}async function A(e,t,n,i){const{enableChannelLocalCache:o,channelLocalCacheMaxDays:r,enableChannelIndexedDBCache:s,disableChannelIndexedDBNextCache:l}=t.get(a.w.Search);let c,d=!1;if(s&&(c=await P(e.profile.objectId,e.profile.tenantId,i,!!l),d=void 0!==c),o&&(function(e,t){const n=M(e),i=new Date(Date.now()),a=new Date(n?.timestamp||0);a.setDate(a.getDate()+t),a<i&&e.remove(y)}(n,d?0:r||S),!c)){const e=M(n);c=e?.teams}return c}let E;const F=3e5;let _;const D=(0,u.z)();async function P(e,t,n,i){return E||(E=async function(e,t,n,i){const a=n.newScenario(o.Cu.GetTeamsChannelsFromIndexedDB),s=async i=>{try{return await async function(e,t,n,i){const a=function(e,t,n){return n?`${v}:${t}:${e}`:`${h}-${e}`}(e,t,n),o=function(e){return e?p:m}(n);return(0,r.sD)(a,o,g,"",i,!0)}(e,t,i,n)}catch(e){return void a.appendEventData({errors:JSON.stringify(e)})}};let l;i||(l=await s(!0));l||(l=await s(!1));if(!l)return void a.fail({errors:"unable to read conversations from indexedbd"});try{const e=b(l);return a.stop({message:e?"Successfully fetched.":"Conversations store does not contain any teams or channels."}),e}catch{return void a.fail({errors:"Fails to convert conversations to teams."})}}(e,t,n,i),_=D.setTimeout((()=>{E=void 0,D.clearTimeout(_),_=void 0}),F),E)}function M(e){const t=e.get(y);if(t)return C(t)}function R(e,t){e.trySet(y,JSON.stringify({timestamp:Date.now(),teams:t}),"Messaging")}},604507:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i="webinar-service"},243952:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webinarImageQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webinarImage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"webinarId"},value:{kind:"Variable",name:{kind:"Name",value:"webinarId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"image"}}]}}]}}]}},802448:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webinar"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webinar"},arguments:[{kind:"Argument",name:{kind:"Name",value:"webinarId"},value:{kind:"Variable",name:{kind:"Name",value:"webinarId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"allWebinarFiels"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"allWebinarFiels"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Webinar"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"eventDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"startTime"}},{kind:"Field",name:{kind:"Name",value:"endTime"}},{kind:"Field",name:{kind:"Name",value:"accessPolicy"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"isFull"}},{kind:"Field",name:{kind:"Name",value:"privacyProfileStatementLink"}},{kind:"Field",name:{kind:"Name",value:"capacity"}},{kind:"Field",name:{kind:"Name",value:"price"}}]}},{kind:"Field",name:{kind:"Name",value:"speakerBios"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"speakerId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}},{kind:"Field",name:{kind:"Name",value:"questionnaire"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"questionId"}},{kind:"Field",name:{kind:"Name",value:"order"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"options"}},{kind:"Field",name:{kind:"Name",value:"isRequired"}},{kind:"Field",name:{kind:"Name",value:"isPredefined"}}]}},{kind:"Field",name:{kind:"Name",value:"isUserAlreadyRegistered"}},{kind:"Field",name:{kind:"Name",value:"joinLink"}},{kind:"Field",name:{kind:"Name",value:"participantRole"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"registrationId"}},{kind:"Field",name:{kind:"Name",value:"paymentTransactionId"}}]}}]}.definitions]}},426176:(e,t,n)=>{"use strict";n.d(t,{N:()=>a,x:()=>o});var i=n(802448);const a=(e,t)=>{try{const n=e.readQuery({query:i._,variables:{webinarId:t}});if(!n||!n.webinar)throw new Error("Invalid cached webinar data");return n.webinar}catch(e){throw e}},o=(e,t,n,o)=>{try{const o={...a(n,e),questionnaire:t.map((e=>({...e,name:e.name??null,displayName:e.displayName??null,options:e.options??null,__typename:"WebinarQuestion"})))};n.writeQuery({variables:{webinarId:e},query:i._,data:{webinar:o}})}catch(e){throw o.error("Webinar resolver fails to update webinar questions in cache."),e}}},728856:(e,t,n)=>{"use strict";n.d(t,{K:()=>c});var i=n(604507),a=n(802448),o=n(243952),r=n(426176);let s;const l=e=>s||(s=e.newLogger(i.A,"data-resolvers-browser-webinar")),c={Mutation:{updateWebinarDetails:(e,{webinarId:t,detailsInput:n},{cache:i,loggerFactory:o})=>{l(o);try{const e=(0,r.N)(i,t),o={...e,eventDetails:{...e.eventDetails,...n,__typename:"WebinarDetails"}};return i.writeQuery({variables:{webinarId:t},query:a._,data:{webinar:o}}),{_:!0,__typename:"Webinar"}}catch(e){throw s.error("Webinar resolver fails to update webinar details in cache."),e}},updateWebinarQuestions:(e,{webinarId:t,questionsInput:n},{cache:i,loggerFactory:a})=>(l(a),(0,r.x)(t,n,i,s),{_:!0,__typename:"Webinar"}),updateWebinarSpeakers:(e,{webinarId:t,speakersInput:n},{cache:i,loggerFactory:o})=>{l(o);try{const e={...(0,r.N)(i,t),speakerBios:n.map((e=>({...e,__typename:"WebinarSpeakerBio"})))};return i.writeQuery({variables:{webinarId:t},query:a._,data:{webinar:e}}),{_:!0,__typename:"Webinar"}}catch(e){throw s.error("Webinar resolver fails to update webinar speakers in cache."),e}},updateWebinarImage:(e,{webinarId:t,webinarImageInput:n},{cache:i,loggerFactory:a})=>{l(a);try{return i.writeQuery({variables:{webinarId:t},query:o.T,data:{webinarImage:{image:n.image,__typename:"WebinarImage"}}}),{_:!0,__typename:"Webinar"}}catch(e){throw s.error("Webinar resolver fails to update webinar image in cache."),e}}}}},724404:(e,t,n)=>{"use strict";n.d(t,{O$:()=>o,Uo:()=>r,w_:()=>l,gW:()=>c,D7:()=>d,Bc:()=>u});var i=n(364819),a=n(810886);async function o(e,t){return s(e,t)}async function r(e,t,n,i){return s(e,t,n,i)}async function s(e,t,n,o){const r=(0,i.uniqBy)(e,(e=>e)),s=(0,i.chunk)(r.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT),l=await Promise.all(s.map((async e=>{const i=await t.getPeopleProfilesByMris(e,n,!0,!1,!0);return await u(i,n,o),i})));let c=[];return l.forEach((e=>{c=c.concat(Array.from(e.values(),(e=>(0,a.qK)(e))))})),c}async function l(e,t,n){const o=(0,i.uniqBy)(e,(e=>e)),r=(0,i.chunk)(o.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(await Promise.all(r.map((e=>t.getPeopleProfilesIncludeFederatedByMris(e,!0,!1,n))))).map((e=>Array.from(e.values(),(e=>(0,a.qK)(e))))).reduce(((e,t)=>e.concat(t)),[])}async function c(e,t,n){const o=(0,i.uniqBy)(e,(e=>e)),r=(0,i.chunk)(o.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(await Promise.all(r.map((e=>t.getTflConsumerProfilesByMris(e,n||null))))).map((e=>Array.from(e.values(),(e=>(0,a.qK)(e))))).reduce(((e,t)=>e.concat(t)),[])}async function d(e,t,n){const o=(0,i.uniqBy)(e,(e=>e)),r=(0,i.chunk)(o.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(await Promise.all(r.map((e=>t.getSkypeConsumerProfilesByMris(e,n||null))))).map((e=>Array.from(e.values(),(e=>(0,a.qK)(e))))).reduce(((e,t)=>e.concat(t)),[])}const u=async(e,t,n)=>{n&&await n.combineFeatureSettingsWithProfiles(e,t||"combine feature settings")}},929024:(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var i=n(169885),a=n(324419);const o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chatListWithCachedTitle"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentChatsFirst"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsFirst"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsAfter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsLocale"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}},type:{kind:"NamedType",name:{kind:"Name",value:"ChatTypeFilter"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includePinnedChats"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedContacts"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!0}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeOnlineContacts"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"alwaysShowSuggestedContacts"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxChatCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedGroupChats"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeTopFixedChatListItems"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeLastUpdate"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"enableChatRequests"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"excludeRecents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recentsChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsFirst"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}},{kind:"Argument",name:{kind:"Name",value:"excludePinnedChats"},value:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}}},{kind:"Argument",name:{kind:"Name",value:"excludeChatRequests"},value:{kind:"Variable",name:{kind:"Name",value:"enableChatRequests"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatCachedTitleFragment"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"chatRequests"},arguments:[{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}},{kind:"Argument",name:{kind:"Name",value:"excludePinnedChats"},value:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"enableChatRequests"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatCachedTitleFragment"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pinnedChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includePinnedChats"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatCachedTitleFragment"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",alias:{kind:"Name",value:"suggestedContacts"},name:{kind:"Name",value:"suggestedContactsInChatList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsFirst"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsAfter"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"locale"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsLocale"}}},{kind:"Argument",name:{kind:"Name",value:"alwaysShowSuggestedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"alwaysShowSuggestedContacts"}}},{kind:"Argument",name:{kind:"Name",value:"filterOutFrequentlyUsedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}}},{kind:"Argument",name:{kind:"Name",value:"excludeRecents"},value:{kind:"Variable",name:{kind:"Name",value:"excludeRecents"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedContacts"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"}},{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"phone"}},{kind:"Field",name:{kind:"Name",value:"dbKey"}},{kind:"Field",name:{kind:"Name",value:"userType"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"suggestedGroupChats"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedGroupChats"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"groupChatName"}},{kind:"Field",name:{kind:"Name",value:"groupChatMembers"}},{kind:"Field",name:{kind:"Name",value:"chatListDummyItemDisplayName"}},{kind:"Field",name:{kind:"Name",value:"chatListDummyItemSubtitle"}}]}},{kind:"Field",name:{kind:"Name",value:"frequentlyUsedContacts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"maxChatCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxChatCount"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"phone"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"onlineContacts"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeOnlineContacts"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"phone"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"topFixedChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeTopFixedChatListItems"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatCachedTitleFragment"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}}]}},...i.j.definitions,...a.V.definitions]}},162365:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversConnectedCalendarShowHardDeleteSurfaceDialogQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shouldShowHardDeleteConnectedCalendarSurfaceDialog"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},786498:(e,t,n)=>{"use strict";n.d(t,{K:()=>a});var i=n(162365);const a={Mutation:{setShouldShowHardDeleteConnectedCalendarSurfaceDialog:async(e,{showDialog:t},{cache:n,loggerFactory:a})=>{try{n.writeQuery({query:i.q,data:{shouldShowHardDeleteConnectedCalendarSurfaceDialog:t}})}catch(e){a.newLogger("setShouldShowHardDeleteConnectedCalendarSurfaceDialogMutation","data-resolvers-connected-calendar").error("Failed to write to client cache the show hard-delete connected calendar surface dialog mutation")}return t}}}},164796:(e,t,n)=>{"use strict";n.d(t,{K6:()=>u,D0:()=>v,cI:()=>y});var i=n(289242),a=n(754255),o=n(836176),r=n(770620),s=n(781108),l=n.n(s),c=n(9012),d=n(430426);const u={Query:{async localizationSettings(e,t,{hostCommunicationService:n,platformService:a,routingServices:s,i18n:l,localStorage:c,coreSettings:d,loggerFactory:u}){const m=u.newLogger("LocalizationSettingsResolvers","data-resolvers-localization-settings"),v=await h(c,d,n,m),y=await g(s.state.getSearchState()||{});if(y)return{currentLocale:y,...v};if(localStorage.getItem(r.G6.GENERAL_LOCALE_CODE))return{currentLocale:localStorage.getItem(r.G6.GENERAL_LOCALE_CODE),...v};if(a.config.clientType===i.sK.Web)return{currentLocale:l.locale,...v};let S;try{const e=await p(n);e?(S=(0,o.N6)(e).locale,await l.setLocale(S)):S=l.locale}catch{S=l.locale}return{currentLocale:S,...v}}},Mutation:{async updateCurrentLocale(e,{newLocale:t},{hostCommunicationService:n,loggerFactory:a,platformService:o,i18n:s,localStorage:l,coreSettings:c}){const d=await h(l,c,n),u=a.newLogger("LocalizationSettingsResolvers","data-resolvers-localization-settings");try{return await s.setLocale(t),localStorage.setItem(r.G6.GENERAL_LOCALE_CODE,t),(0,r.bR)(c)&&!d.syncWithMSAccount&&(d.applicationLocale=t),o.config.clientType!==i.sK.Web&&await m(a,n,t),v(d,l),u.log("Current locale has been successfully updated to: ",t),{currentLocale:t,...d}}catch(e){return u.error("Error occurred while updating the current locale. Error code: ",e?.code||"unknown"),{currentLocale:s.locale,...await h(l,c,n)}}},async updateSyncWithMSAccount(e,{newSyncWithMSAccount:t,saveCurrentlyDisplayedLanguage:n},{i18n:i,coreSettings:a,localStorage:o,loggerFactory:s,hostCommunicationService:l}){const c=s.newLogger("LocalizationSettingsResolvers","data-resolvers-localization-settings"),d=await h(o,a,l),u={currentLocale:i.locale,...d};try{const e=await(0,r.z3)(a,l);return(0,r.bR)(a)&&e?(d.syncWithMSAccount=t,d.accountLocale=e,n&&(d.applicationLocale=i.locale,u.applicationLocale=i.locale),v(d,o),c.log("Locale synchronization with account has been successfully updated to: ",t),{...u,syncWithMSAccount:t}):(e||c.warn("The account locale code is not available."),u)}catch(e){const t=e?.code||"unknown";return c.error("Error occurred while updating the locale synchronization with account. Error code: ",t),{currentLocale:i.locale,...await h(o,a,l)}}}},Subscription:{localizationSettings:{async subscribe(e,t,{i18n:n,localStorage:o,coreSettings:s,hostCommunicationService:u,platformService:m}){const p=await h(o,s,u),g={currentLocale:n.locale,...p},v=new(l())((e=>{if(m.config.clientType===i.sK.Web&&(0,r.bR)(s)){const t=s?.getObservable(a.w.Localization,["userAccountLocaleCodePolicy"]).subscribe((({userAccountLocaleCodePolicy:t})=>{t&&e.next({newLocale:t})}));return()=>{t.unsubscribe()}}e.complete()}));return(0,c.VQ)((0,d.V)(v,void 0,void 0,"localizationSettings"),(e=>({localizationSettings:{...g,syncedAccountLocale:e.newLocale||g.syncedAccountLocale}})))}}}},m=async(e,t,n)=>{const i=e.newLogger("LocalizationSettingsResolvers","data-resolvers-localization-settings");try{const e=await t.loadModule("osutils");await(e?.setAppLocale?.({localeName:n}))||i.warn("hostingCommunicationService language set has failed")}catch(e){i.warn("hostingCommunicationService failed to load")}},p=async e=>{const t=await e.loadModule("osutils"),n=await(t?.getAppLocale?.());return n?.localeName},g=async e=>{if(e.localeCode)return e.localeCode;if(e.language)return e.language.toLowerCase();if(!e.setting)return;const t=e.setting;let n;if(Array.isArray(t)){for(const e of t)if(e.startsWith("localeCode:")){n=e;break}}else t.startsWith("localeCode:")&&(n=t);return n?n.split(":")[1]:void 0},h=async(e,t,n,i)=>{const a=(0,r.TJ)(e),o=await y(t,n);return i?.log(`Detected account locale: ${o}`),{applicationLocale:a.applicationLocaleCode,accountLocale:a.accountLocaleCode,syncedAccountLocale:o,syncWithMSAccount:!!a?.isLocaleInSyncWithAccount&&"1"===a?.isLocaleInSyncWithAccount}},v=(e,t)=>{e.accountLocale&&t.set(r.G6.ACCOUNT_LOCALE_CODE,e.accountLocale,"Localization"),e.applicationLocale&&t.set(r.G6.APPLICATION_LOCALE_CODE,e.applicationLocale,"Localization"),e.syncWithMSAccount&&e.accountLocale?(t.set(r.G6.IS_LOCALE_IN_SYNC_WITH_ACCOUNT,"1","Localization"),localStorage.setItem(r.G6.GENERAL_LOCALE_CODE,e.accountLocale)):t.set(r.G6.IS_LOCALE_IN_SYNC_WITH_ACCOUNT,"0","Localization")},y=async(e,t)=>{const{enableLocaleSyncWithMSAccount:n,enableLocaleSyncWithOS:i,userAccountLocaleCodePolicy:o}=e.get(a.w.Localization);if(n&&o)return o;if(i){const e=await t.loadModule("osutils");return(await(e?.getUserLocale?.()))?.localeName}return null}},15774:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{yJ:()=>i,hS:()=>a,pz:()=>o}),function(e){e.InviteJoined="InviteJoined",e.TeamsTasks="TeamsTasks",e.GroupMessage="GroupMessage",e.Message="Message",e.Follow="Follow",e.ForwardMessage="ForwardMessage",e.Reply="Reply",e.PersonalReply="PersonalReply",e.ReplyToReply="ReplyToReply",e.RecordingUploadFailed="RecordingUploadFailed",e.ChannelRecordingUploadFailed="ChannelRecordingUploadFailed"}(i||(i={})),function(e){e.joinInvite="joinInvite",e.teamsTasks="teamsTasks",e.communityFollow="communityFollow",e.communityReplyToReply="communityReplyToReply",e.communityReply="communityReply"}(a||(a={})),function(e){e.inviteeJoined="inviteeJoined",e.tFLPlanCreated="tFLPlanCreated",e.communityNewMessage="communityNewMessage",e.communityReplyMessage="communityReplyMessage",e.inviteeJoinedOne2One="inviteeJoinedOne2One",e.inviteeJoinedGroupChat="inviteeJoinedGroupChat",e.inviteeJoinedCommunity="inviteeJoinedCommunity"}(o||(o={}))},860643:(e,t,n)=>{"use strict";var i;n.d(t,{cs:()=>i,cM:()=>a,LU:()=>o,zW:()=>r}),function(e){e.Chat="chat",e.Channel="channel",e.SyntheticNotification="syntheticNotification",e.Communities="communities",e.GraphItemToast="graphItemToast"}(i||(i={}));var a;!function(e){e.FILE="file",e.IMAGE="image",e.VOICE="voice",e.LOCATION="location",e.TEXT="text",e.VIDEO="video"}(a||(a={}));const o="giphy.com",r="bfb101ece45946be988be560a74322f2"},609476:(e,t,n)=>{"use strict";n.d(t,{c:()=>i,N:()=>a});const i="AccountsSettings",a={getDataBag:"getDataBag",handleTenantVisibility:"handleTenantVisibility",manageAccount:"manageAccount",tenantInvitationAccept:"tenantInvitationAccept",tenantInvitationDecline:"tenantInvitationDecline",tenantsLeaveOrg:"tenantsLeaveOrg",tenantsUpdate:"tenantsUpdate"}},265830:(e,t,n)=>{"use strict";n.d(t,{N:()=>i,a:()=>a});const i="ActivitySlices",a={viewSliceFeedItems:"viewSliceFeedItems"}},396579:(e,t,n)=>{"use strict";n.d(t,{BJ:()=>a});const i={about:"about",markAllAsRead:"markAllAsRead",blockUnblockBotChat:"blockUnblockBotChat",newChat:"newChat",popNewChat:"popNewChat",share:"share"},a={PlatformEvents:i}},805997:(e,t,n)=>{"use strict";n.d(t,{h:()=>i,AZ:()=>a});const i={leaveBroadcastQualityFeedback:"leaveBroadcastQualityFeedback"},a={leaveBroadcastQualityFeedback:()=>({originator:"Broadcast",type:i.leaveBroadcastQualityFeedback})}},574892:(e,t,n)=>{"use strict";n.d(t,{N:()=>i,P:()=>a});const i="HeadlineSlices",a={itemClick:"itemClick",feedMounted:"feedMounted",feedLoadStarted:"feedLoadStarted",feedLoadMoreStarted:"feedLoadMoreStarted",feedUnmounted:"feedUnmounted",feedPainted:"feedPainted",feedDataReceived:"feedDataReceived",prefetchTriggered:"prefetchTriggered",errorWhileFetchingFeeds:"errorWhileFetchingFeeds",headlineCriticalPhaseCompleted:"headlineCriticalPhaseCompleted",upfrontFilterClick:"upfrontFilterClick",contextMenuOpenClose:"contextMenuOpenClose",escapeKeyPressed:"escapeKeyPressed"}},469115:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>o,AZ:()=>p,v0:()=>g,z1:()=>h,$H:()=>v});var i=n(726723),a=n(131647);const o="MessageThreading",r="fetchThreadListPaneData",s="threadListPaneRendered",l="openThreadPane",c="hideThreadPane",d="popoutThread",u="toggleThreadListPane",m="goBackToThreadedConversation",p={fetchThreadListPaneData:e=>({originator:o,type:r,data:()=>e}),threadListPaneRendered:e=>({originator:o,type:s,data:()=>e}),openThreadPane:e=>({originator:o,type:l,data:()=>e}),hideThreadPane:e=>({originator:o,type:c,data:()=>e}),goBackToThreadedConversation:e=>({originator:o,type:m,data:()=>e}),popoutThread:e=>({originator:o,type:d,data:()=>e}),toggleThreadListPane:e=>({originator:o,type:u,data:()=>e})},g={isFetchThreadListPaneDataEvent:e=>e.type===r,isThreadListPaneRenderedEvent:e=>e.type===s,isOpenThreadPaneEvent:e=>e.type===l,isHideThreadPaneEvent:e=>e.type===c,isGoBackToThreadedConversationEvent:e=>e.type===m,isPopoutThreadEvent:e=>e.type===d,isThreadListPaneEvent:e=>e.type===u},h=(e,t,n,o,r)=>{if(!e.data)return;const s=e.data(),{commandSource:l,replyChainId:c,threadType:d}=s,u=r.newLogger("open_thread_pane","components-thread-list"),{recordPanelAction:m}=o,p=i.Od.click,g=i.nd.submit,h=c;let v,y,S,f,k;switch(l){case a.p.ThreadList:v=i.vB.openConversationFromThreadList,y=i.Sn.threadList,S=i.nR.nav,f=i.rP.sidePane,k=i.HP.threadList;break;case a.p.ThreadedReplyMessageAction:v=i.vB.messageReplyInThread,y=i.Sn.messageReplyInThread,S=i.nR.rightClickMenu,f=i.rP.main,k=i.HP.Chat;break;case a.p.RepliesSummary:v=i.vB.openConversationFromReplySummary,y=i.Sn.replySummary,S=i.nR.deeplink,f=i.rP.main,k=i.HP.Chat}m({actionGesture:p,actionOutcome:g,actionScenario:v,appId:n,appName:t,childThreadId:h,moduleName:y,moduleType:S,panelRegion:f,panelType:k,threadType:d},u)},v=(e,t,n,o,r)=>{if(!e.data)return;const s=e.data(),{commandSource:l,newThreadListPaneState:c}=s;if(l===a.p.ToggleThreadListPane&&"open"===c){const e=r.newLogger("open_thread_list_pane","components-thread-list"),{recordPanelAction:a}=o;a({actionGesture:i.Od.click,actionOutcome:i.nd.submit,actionScenario:i.vB.openThreadListFromChatHeader,appId:n,appName:t,moduleName:i.Sn.threadPaneButton,moduleType:i.nR.button,panelRegion:i.rP.header,panelType:i.HP.ChatHeader},e)}}},479459:(e,t,n)=>{"use strict";n.d(t,{mu:()=>i,AZ:()=>a});const i={openPhonelinkDialog:"openPhonelinkDialog"},a={openPhonelinkDialog:()=>({originator:"MoreOptionsMenu",type:i.openPhonelinkDialog})}},881072:(e,t,n)=>{"use strict";n.d(t,{B:()=>i,C:()=>a});const i="MissedNotification",a={switchAccount:"switchAccount",renderComplete:"renderComplete",scroll:"scroll"}},704695:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>a,mu:()=>o,AZ:()=>s});var i=n(523661);const a="Notifications",o={activateAlerts:"activateAlerts",activateCallToast:"activeCallToast",activateChatToast:"activateChatToast",activateCommunitiesToast:"activateCommunitiesToast",activateRemindersToast:"activateRemindersToast",activateGraphItemToast:"activateGraphItemToast",activateNotificationDeeplink:"activateNotificationDeeplink",offsetNotificationsWindow:"offsetNotificationsWindow",resizeWindow:"resizeWindow",sendTelemetry:"sendTelemetry",sendDismissToastTelemetry:"sendDismissToastTelemetry",focusWindow:"focusWindow",settingsstore:"settingsstore",files:"files"},r=e=>{switch(e){case i.w$.activity:return o.activateGraphItemToast;case i.w$.notificationsdeeplink:return o.activateNotificationDeeplink;case i.w$.calls:case i.w$.callingdeeplink:return o.activateCallToast;case i.w$.communities:case i.w$.communitiesevents:case i.w$.communitiesjoinrequest:case i.w$.communitiesmembers:return o.activateCommunitiesToast;case i.w$.reminders:return o.activateRemindersToast;case i.w$.settingsstore:return o.settingsstore;case i.w$.alerts:return o.activateAlerts;case i.w$.files:return o.files;case i.w$.chats:default:return o.activateChatToast}},s={activateToast:(e,t)=>({originator:a,type:r(e.type),data:()=>({targetEntity:e,startTimestamp:t})}),resizeWindow:e=>({originator:a,type:o.resizeWindow,data:()=>({windowFeatures:e})}),focusWindow:()=>({originator:a,type:o.focusWindow}),sendTelemetry:e=>({originator:a,type:o.sendTelemetry,data:()=>e}),offsetNotificationsWindow:e=>({originator:a,type:o.offsetNotificationsWindow,data:()=>e}),sendDismissToastTelemetry:({reason:e,correlationId:t,toastType:n})=>({originator:a,type:o.sendDismissToastTelemetry,data:()=>({reason:e,correlationId:t,toastType:n})})}},865561:(e,t,n)=>{"use strict";n.d(t,{z6:()=>a,AZ:()=>o});const i="Platform",a={launchDefaultPersonalApp:"launchDefaultPersonalApp",openDeeplinkStageConsentDialog:"openDeeplinkStageConsentDialog",openPresentAppNowConfirmationDialog:"openPresentAppNowConfirmationDialog",launchAppError:"launchAppError",launchManifestParsingErrorDialog:"launchManifestParsingErrorDialog"},o={launchDefaultPersonalApp:()=>({originator:i,type:a.launchDefaultPersonalApp}),openDeeplinkStageConsentDialog:e=>({data:e,originator:i,type:a.openDeeplinkStageConsentDialog}),openPresentAppNowConfirmationDialog:e=>({data:e,originator:i,type:a.openPresentAppNowConfirmationDialog}),launchAppError:e=>({data:e,originator:i,type:a.launchAppError}),launchManifestParsingErrorDialog:e=>({data:e,originator:i,type:a.launchManifestParsingErrorDialog})}},718645:(e,t,n)=>{"use strict";var i;n.d(t,{V5:()=>i,mu:()=>a,K9:()=>o,AZ:()=>r,By:()=>s,SP:()=>l,Zt:()=>c,tn:()=>d}),function(e){e.QueuesAnalyticsFooter="QueuesAnalyticsFooter",e.QueuesAnalyticsLeftNavigation="QueuesAnalyticsLeftNavigation",e.QueuesAppAnalyticsSummary="QueuesAppAnalyticsSummary",e.QueuesAppHeader="QueuesAppHeader",e.QueuesCallHistoryRow="QueuesCallHistoryRow",e.QueuesPeopleManagement="QueuesPeopleManagement",e.QueuesQuickAccess="QueuesQuickAccess",e.QueuesUserDetails="QueuesUserDetails",e.Layout="Layout",e.CallHistory="CallHistory"}(i||(i={}));const a={switchToCallQueue:"switchToCallQueue",selectQueueUser:"selectQueueUser",selectCallHistoryRow:"selectCallHistoryRow",selectRealTimeAnalyticsNavigationItem:"selectRealTimeAnalyticsNavigationItem",selectHistoricalAnalyticsNavigationItem:"selectHistoricalAnalyticsNavigationItem",switchToQueuesAnalytics:"switchToQueuesAnalytics",selectCallQueueOverview:"selectCallQueueOverview",navigateToChannel:"navigateToChannel",navigateToSettings:"navigateToSettings",displayErrorMessage:"displayErrorMessage",goBack:"goBack",toggleStartRail:"toggleStartRail"},o={RTA_LEFT_NAV_ERROR_RELOAD:"RTA_LEFT_NAV_ERROR_RELOAD",RTA_LEFT_NAV_ERROR:"RTA_LEFT_NAV_ERROR",RTA_LEFT_NAV_LOADING:"RTA_LEFT_NAV_LOADING",NO_RTA_LEFT_NAV_DATA:"NO_RTA_LEFT_NAV_DATA"},r={selectRealTimeAnalyticsNavigationItem:(e=i.QueuesAnalyticsLeftNavigation,t)=>({data:t,originator:e,type:a.selectRealTimeAnalyticsNavigationItem}),selectHistoricalAnalyticsNavigationItem:(e=i.QueuesAnalyticsLeftNavigation,t)=>({data:t,originator:e,type:a.selectHistoricalAnalyticsNavigationItem}),switchToQueuesAnalytics:(e=i.QueuesAppHeader,t)=>({data:t,originator:e,type:a.switchToQueuesAnalytics}),switchToCallQueue:(e,t)=>({data:t,originator:e,type:a.switchToCallQueue}),selectQueueUser:(e,t)=>({data:t,originator:e,type:a.selectQueueUser}),selectCallHistoryRow:(e,t)=>({data:t,originator:e,type:a.selectCallHistoryRow}),selectCallQueueOverview:(e,t)=>({data:t,originator:e,type:a.selectCallQueueOverview}),navigateToChannelEvent:(e,t)=>({data:t,originator:e,type:a.navigateToChannel}),navigateToSettingsEvent:(e,t)=>({data:t,originator:e,type:a.navigateToSettings}),toggleStartRailEvent:(e,t)=>({data:t,originator:e,type:a.toggleStartRail}),displayErrorMessage:(e,t)=>({data:t,originator:e,type:a.displayErrorMessage})};var s,l,c;!function(e){e.SomethingWentWrong="somethingWentWrong",e.NoQueuesAvailable="noQueuesAvailable"}(s||(s={})),function(e){e.Queue="queue",e.Agent="agent"}(l||(l={})),function(e){e.AutoAttendants="AutoAttendants",e.CallQueues="CallQueues",e.Agents="Agents"}(c||(c={}));const d=e=>Object.keys(i).includes(e.originator)},405958:(e,t,n)=>{"use strict";n.d(t,{N:()=>i,m:()=>a});const i="EntitySearch",a={openContextualSearch:"openContextualSearch"}},812589:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>i,mu:()=>a,AZ:()=>o});const i="Settings",a={changeAppTheme:"changeAppTheme"},o={changeAppTheme:e=>({originator:i,type:a.changeAppTheme,data:()=>({...e})})}},358625:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>i,$G:()=>a,lP:()=>o,sU:()=>r,T8:()=>s,TS:()=>l,Bm:()=>c});const i="SimpleCollabList",a={switchToChat:"switchToChat",switchToSuggestedChat:"switchToSuggestedChat",switchToChannel:"switchToChannel",switchToActivitySlice:"switchToActivitySlice",channelNotificationSettings:"channelNotificationSettings",filterLeftRail:"filterLeftRail",filterLeftRailComplete:"filterLeftRailComplete",filterLeftRailFail:"filterLeftRailFail",channelWorkflows:"channelWorkflows",archiveChannel:"archiveChannel",toastMessageChannelEvent:"toastMessageChannelEvent",deleteChannel:"deleteChannel",editChannel:"editChannel",getLinkToChannel:"getLinkToChannel",manageChannel:"manageChannel",manageChannelMembers:"manageChannelMembers",manageChannelTags:"manageChannelTags",showHideChannel:"showHideChannel",chatContextMenuClick:"chatContextMenuClick",channelContextMenuClick:"channelContextMenuClick",teamContextMenuClick:"teamContextMenuClick",viewChannelEmail:"viewChannelEmail",channelAddMembers:"channelAddMembers",leaveChannel:"leaveChannel",shareChannelWithUser:"shareChannelWithUser",shareChannelWithTeam:"shareChannelWithTeam",shareChannelWithTeamYouOwn:"shareChannelWithTeamYouOwn",viewDiscover:"viewDiscover",viewSavedMessageSlice:"viewSavedMessageSlice",manageTeam:"manageTeam",manageTeamChannels:"manageTeamChannels",manageTags:"manageTags",deleteTeam:"deleteTeam",getLinkToTeam:"getLinkToTeam",leaveTeam:"leaveTeam",hideAllChannelsDialog:"hideAllChannelsDialog",hideAllChannelsSucceeded:"hideAllChannelsSucceeded",hideAllChannelsFailed:"hideAllChannelsFailed",hideAllChannelsDialogCancelAction:"hideAllChannelsDialogCancelAction",hideAllChannelsDialogConfirmAction:"hideAllChannelsDialogConfirmAction",teamAddMember:"teamAddMember",teamAddChannel:"teamAddChannel",leftRailRenderComplete:"leftRailRenderComplete",leftRailRenderFail:"leftRailRenderFail",leftRailRenderAbandonIfActive:"leftRailRenderAbandonIfActive",leftRailRenderDataLoaded:"leftRailRenderDataLoaded",leftRailRenderStart:"leftRailRenderStart",forceHideTeam:"forceHideTeam",simpleCollabNavigation:"simpleCollabNavigation",simpleCollabConversationFolderNavigation:"simpleCollabConversationFolderNavigation",seeMoreRenderComplete:"seeMoreRenderComplete",seeMoreRenderStart:"seeMoreRenderStart",seeMoreRenderFail:"seeMoreRenderFail",chatManageApps:"chatManageApps",leaveChat:"leaveChat",blockChat:"blockChat",deleteChat:"deleteChat",chatWorkflows:"chatWorkflows",muteChat:"muteChat",unmuteChat:"unmuteChat",markAsReadChat:"markAsReadChat",markAsUnreadChat:"markAsUnreadChat",openInNewWindowChat:"openInNewWindowChat",viewTeamSeeAllChannels:"viewTeamSeeAllChannels",joinTeam:"joinTeam",newMessage:"newMessage",createChannel:"createChannel",createTeam:"createTeam",manageTeams:"manageTeams",viewMoreSettings:"viewMoreSettings",clickLeftRailHeaderShowAtTopFilterMenu:"clickLeftRailHeaderShowAtTopFilterMenu",leftRailHeaderPlusMenuOpen:"leftRailHeaderPlusMenuOpen",openFilterLeftRail:"openFilterLeftRail",switchToBizChatMetaOS:"switchToBizChatMetaOS",stopBizChatMetaOSE2EScenarioIfActive:"stopBizChatMetaOSE2EScenarioIfActive",openManageTeams:"openManageTeams",reorderTeamsStart:"reorderTeamsStart",reorderTeamsSucceeded:"reorderTeamsSucceeded",reorderTeamsFailed:"reorderTeamsFailed",createTeamOnMainView:"createTeamOnMainView",teamDiscover:"teamDiscover",leftRailFilterPillClick:"leftRailFilterPillClick",leftRailFilterTextClick:"leftRailFilterTextClick",leftRailFilterTextClearButtonClick:"leftRailFilterTextClearButtonClick",stickyFilterUpdated:"stickyFilterUpdated",leftRailFilterOverflowButtonClick:"leftRailFilterOverflowButtonClick",leftRailFilterMoreFilterPillsClick:"leftRailFilterMoreFilterPillsClick",setChannelRecommendation:"setChannelRecommendation",setFolderViewType:"setFolderViewType",staleChannelsAdhocDialog:"staleChannelsAdhocDialog",setFolderViewTypeSwitch:"setFolderViewTypeSwitch",teamsAndChannelFolderRenderCompleted:"teamsAndChannelFolderRenderCompleted",setFolderViewTypeFailed:"setFolderViewTypeFailed",setTeamExpandedStateAction:"setTeamExpandedStateAction",setTeamExpandedStateSucceeded:"setTeamExpandedStateSucceeded",setTeamExpandedStateFailed:"setTeamExpandedStateFailed",logConnectionSortMessages:"logConnectionSortMessages",suggestedChatsRenderCompleted:"suggestedChatsRenderCompleted",followPresence:"followPresence",startTimerSelectedUnreadMention:"startTimerSelectedUnreadMention",stopTimerSelectedUnreadMention:"stopTimerSelectedUnreadMention"},o={hideBizChatMetaOS:"hideBizChatMetaOS",hideBizChatMetaOSSucceeded:"hideBizChatMetaOSSucceeded",hideBizChatMetaOSFailed:"hideBizChatMetaOSFailed"},r={createConversationFolder:"createConversationFolder",removeConversationFolder:"removeConversationFolder",renameConversationFolder:"renameConversationFolder",folderMutationUpdaterStarted:"folderMutationUpdaterStarted",folderMutationUpdaterFailed:"folderMutationUpdaterFailed",folderMutationUpdaterCompleted:"folderMutationUpdaterCompleted",logTelemetryForSubscriptionEvent:"logTelemetryForSubscriptionEvent",folderMutationOptimisticUpdaterCompleted:"folderMutationOptimisticUpdaterCompleted"},s={createConversationFolderCancelAction:"createConversationFolderCancelAction",createConversationFolderConfirmAction:"createConversationFolderConfirmAction",createConversationFolderSucceeded:"createConversationFolderSucceeded",createConversationFolderFailed:"createConversationFolderFailed",renameConversationFolderCancelAction:"renameConversationFolderCancelAction",renameConversationFolderConfirmAction:"renameConversationFolderConfirmAction",renameConversationFolderSucceeded:"renameConversationFolderSucceeded",renameConversationFolderFailed:"renameConversationFolderFailed",removeConversationFolderCancelAction:"removeConversationFolderCancelAction",removeConversationFolderConfirmAction:"removeConversationFolderConfirmAction",removeConversationFolderSucceeded:"removeConversationFolderSucceeded",removeConversationFolderFailed:"removeConversationFolderFailed",removeFromFolderAction:"removeFromFolderAction",removeFromFolderSucceeded:"removeFromFolderSucceeded",removeFromFolderFailed:"removeFromFolderFailed",moveToSubMenuClick:"moveToSubMenuClick",moveConversationToFolderAction:"moveConversationToFolderAction",moveConversationToFolderSucceeded:"moveConversationToFolderSucceeded",moveConversationToFolderFailed:"moveConversationToFolderFailed",setConversationFolderSeeReadsExpandedStateAction:"setConversationFolderSeeReadsExpandedStateAction",setConversationFolderExpandedStateAction:"setConversationFolderExpandedStateAction",setConversationFolderExpandedStateSucceeded:"setConversationFolderExpandedStateSucceeded",setConversationFolderExpandedStateFailed:"setConversationFolderExpandedStateFailed",setConversationFoldersExpandedStateAction:"setConversationFoldersExpandedStateAction",setConversationFoldersExpandedStateSucceeded:"setConversationFoldersExpandedStateSucceeded",setConversationFoldersExpandedStateFailed:"setConversationFoldersExpandedStateFailed",reorderConversationFoldersAction:"reorderConversationFoldersAction",reorderConversationFoldersSucceeded:"reorderConversationFoldersSucceeded",reorderConversationFoldersFailed:"reorderConversationFoldersFailed",reorderConversationFolderItemsAction:"reorderConversationFolderItemsAction",reorderConversationFolderItemsSucceeded:"reorderConversationFolderItemsSucceeded",reorderConversationFolderItemsFailed:"reorderConversationFolderItemsFailed",dndItemToConversationFolderAction:"dndItemToConversationFolderAction",dndItemToConversationFolderSucceeded:"dndItemToConversationFolderSucceeded",dndItemToConversationFolderFailed:"dndItemToConversationFolderFailed",markAllAsReadByAppAction:"markAllAsReadByAppAction",markAllAsReadByAppSucceeded:"markAllAsReadByAppSucceeded",markAllAsReadByAppFailed:"markAllAsReadByAppFailed",markAllAsReadByAppLog:"markAllAsReadByAppLog",sortConversationFolderAction:"sortConversationFolderAction",sortConversationFolderSucceeded:"sortConversationFolderSucceeded",sortConversationFolderFailed:"sortConversationFolderFailed"},l={switchToChat:e=>({data:e,originator:i,type:a.switchToChat}),switchToSuggestedChat:e=>({data:e,originator:i,type:a.switchToSuggestedChat}),switchToBizChatMetaOS:e=>({data:e,originator:i,type:a.switchToBizChatMetaOS}),switchToActivitySlice:e=>({data:e,originator:i,type:a.switchToActivitySlice}),stopBizChatMetaOSE2EScenarioIfActive:()=>({originator:i,type:a.stopBizChatMetaOSE2EScenarioIfActive}),hideBizChatMetaOS:e=>({data:e,originator:i,type:o.hideBizChatMetaOS}),hideBizChatMetaOSSucceeded:e=>({data:e,originator:i,type:o.hideBizChatMetaOSSucceeded}),hideBizChatMetaOSFailed:e=>({data:e,originator:i,type:o.hideBizChatMetaOSFailed}),switchToChannel:e=>({data:e,originator:i,type:a.switchToChannel}),channelNotificationSettings:e=>({data:e,originator:i,type:a.channelNotificationSettings}),channelWorkflows:e=>({data:e,originator:i,type:a.channelWorkflows}),archiveChannel:e=>({data:e,originator:i,type:a.archiveChannel}),toastMessageChannelEvent:e=>({data:e,originator:i,type:a.toastMessageChannelEvent}),deleteChannel:e=>({data:e,originator:i,type:a.deleteChannel}),editChannel:e=>({data:e,originator:i,type:a.editChannel}),getLinkToChannel:e=>({data:e,originator:i,type:a.getLinkToChannel}),filterLeftRail:e=>({data:e,originator:i,type:a.filterLeftRail}),clickLeftRailHeaderShowAtTopFilterMenu:e=>({data:e,originator:i,type:a.clickLeftRailHeaderShowAtTopFilterMenu}),leftRailFilterPillClick:e=>({data:e,originator:i,type:a.leftRailFilterPillClick}),leftRailFilterOverflowButtonClick:e=>({data:e,originator:i,type:a.leftRailFilterOverflowButtonClick}),leftRailFilterMoreFilterPillsClick:e=>({data:e,originator:i,type:a.leftRailFilterMoreFilterPillsClick}),filterLeftRailComplete:e=>({data:e,originator:i,type:a.filterLeftRailComplete}),filterLeftRailFail:()=>({originator:i,type:a.filterLeftRailFail}),manageChannel:e=>({data:e,originator:i,type:a.manageChannel}),manageChannelMembers:e=>({data:e,originator:i,type:a.manageChannelMembers}),manageChannelTags:e=>({data:e,originator:i,type:a.manageChannelTags}),showHideChannel:e=>({data:e,originator:i,type:a.showHideChannel}),chatContextMenuClick:()=>({originator:i,type:a.chatContextMenuClick}),channelContextMenuClick:()=>({originator:i,type:a.channelContextMenuClick}),setChannelRecommendation:()=>({originator:i,type:a.setChannelRecommendation}),teamContextMenuClick:()=>({originator:i,type:a.teamContextMenuClick}),viewChannelEmail:e=>({data:e,originator:i,type:a.viewChannelEmail}),channelAddMembers:e=>({data:e,originator:i,type:a.channelAddMembers}),leaveChannel:e=>({data:e,originator:i,type:a.leaveChannel}),shareChannelWithUser:e=>({data:e,originator:i,type:a.shareChannelWithUser}),shareChannelWithTeam:e=>({data:e,originator:i,type:a.shareChannelWithTeam}),shareChannelWithTeamYouOwn:e=>({data:e,originator:i,type:a.shareChannelWithTeamYouOwn}),createConversationFolder:e=>({data:e,originator:i,type:r.createConversationFolder}),removeConversationFolder:e=>({data:e,originator:i,type:r.removeConversationFolder}),renameConversationFolder:e=>({data:e,originator:i,type:r.renameConversationFolder}),staleChannelsAdhocDialog:e=>({data:e,originator:i,type:a.staleChannelsAdhocDialog}),createConversationFolderCancelAction:e=>({data:e,originator:i,type:s.createConversationFolderCancelAction}),createConversationFolderConfirmAction:e=>({data:e,originator:i,type:s.createConversationFolderConfirmAction}),folderMutationUpdaterStarted:e=>({data:e,originator:i,type:r.folderMutationUpdaterStarted}),logTelemetryForSubscriptionEvent:e=>({data:e,originator:i,type:r.logTelemetryForSubscriptionEvent}),folderMutationUpdaterFailed:e=>({data:e,originator:i,type:r.folderMutationUpdaterFailed}),folderMutationUpdaterCompleted:e=>({data:e,originator:i,type:r.folderMutationUpdaterCompleted}),folderMutationOptimisticUpdaterCompleted:e=>({data:e,originator:i,type:r.folderMutationOptimisticUpdaterCompleted}),createConversationFolderSucceeded:e=>({data:e,originator:i,type:s.createConversationFolderSucceeded}),createConversationFolderFailed:e=>({data:e,originator:i,type:s.createConversationFolderFailed}),renameConversationFolderCancelAction:e=>({data:e,originator:i,type:s.renameConversationFolderCancelAction}),renameConversationFolderConfirmAction:e=>({data:e,originator:i,type:s.renameConversationFolderConfirmAction}),renameConversationFolderSucceeded:e=>({data:e,originator:i,type:s.renameConversationFolderSucceeded}),renameConversationFolderFailed:e=>({data:e,originator:i,type:s.renameConversationFolderFailed}),removeConversationFolderCancelAction:e=>({data:e,originator:i,type:s.removeConversationFolderCancelAction}),removeConversationFolderConfirmAction:e=>({data:e,originator:i,type:s.removeConversationFolderConfirmAction}),removeConversationFolderSucceeded:e=>({data:e,originator:i,type:s.removeConversationFolderSucceeded}),removeConversationFolderFailed:e=>({data:e,originator:i,type:s.removeConversationFolderFailed}),removeFromFolderAction:e=>({data:e,originator:i,type:s.removeFromFolderAction}),removeFromFolderSucceeded:e=>({data:e,originator:i,type:s.removeFromFolderSucceeded}),removeFromFolderFailed:e=>({data:e,originator:i,type:s.removeFromFolderFailed}),moveToSubMenuClick:e=>({data:e,originator:i,type:s.moveToSubMenuClick}),moveConversationToFolderAction:e=>({data:e,originator:i,type:s.moveConversationToFolderAction}),moveConversationToFolderSucceeded:e=>({data:e,originator:i,type:s.moveConversationToFolderSucceeded}),moveConversationToFolderFailed:e=>({data:e,originator:i,type:s.moveConversationToFolderFailed}),setConversationFolderSeeReadsExpandedStateAction:e=>({data:e,originator:i,type:s.setConversationFolderSeeReadsExpandedStateAction}),setConversationFolderExpandedStateAction:e=>({data:e,originator:i,type:s.setConversationFolderExpandedStateAction}),setConversationFolderExpandedStateSucceeded:e=>({data:e,originator:i,type:s.setConversationFolderExpandedStateSucceeded}),setConversationFolderExpandedStateFailed:e=>({data:e,originator:i,type:s.setConversationFolderExpandedStateFailed}),setConversationFoldersExpandedStateAction:e=>({data:e,originator:i,type:s.setConversationFoldersExpandedStateAction}),setConversationFoldersExpandedStateSucceeded:e=>({data:e,originator:i,type:s.setConversationFoldersExpandedStateSucceeded}),setConversationFoldersExpandedStateFailed:e=>({data:e,originator:i,type:s.setConversationFoldersExpandedStateFailed}),reorderConversationFoldersAction:e=>({data:e,originator:i,type:s.reorderConversationFoldersAction}),reorderConversationFoldersSucceeded:e=>({data:e,originator:i,type:s.reorderConversationFoldersSucceeded}),reorderConversationFoldersFailed:e=>({data:e,originator:i,type:s.reorderConversationFoldersFailed}),reorderTeamsStart:e=>({data:e,originator:i,type:a.reorderTeamsStart}),reorderTeamsSucceeded:e=>({data:e,originator:i,type:a.reorderTeamsSucceeded}),reorderTeamsFailed:e=>({data:e,originator:i,type:a.reorderTeamsFailed}),reorderConversationFolderItemsAction:e=>({data:e,originator:i,type:s.reorderConversationFolderItemsAction}),reorderConversationFolderItemsSucceeded:e=>({data:e,originator:i,type:s.reorderConversationFolderItemsSucceeded}),reorderConversationFolderItemsFailed:e=>({data:e,originator:i,type:s.reorderConversationFolderItemsFailed}),dndItemToConversationFolderAction:e=>({data:e,originator:i,type:s.dndItemToConversationFolderAction}),dndItemToConversationFolderSucceeded:e=>({data:e,originator:i,type:s.dndItemToConversationFolderSucceeded}),dndItemToConversationFolderFailed:e=>({data:e,originator:i,type:s.dndItemToConversationFolderFailed}),markAllAsReadByAppAction:e=>({data:e,originator:i,type:s.markAllAsReadByAppAction}),markAllAsReadByAppSucceeded:e=>({data:e,originator:i,type:s.markAllAsReadByAppSucceeded}),markAllAsReadByAppFailed:e=>({data:e,originator:i,type:s.markAllAsReadByAppFailed}),markAllAsReadByAppLog:e=>({data:e,originator:i,type:s.markAllAsReadByAppLog}),setFolderViewType:e=>({data:e,originator:i,type:a.setFolderViewType}),forceHideTeam:e=>({data:e,originator:i,type:a.forceHideTeam}),manageTeam:e=>({data:e,originator:i,type:a.manageTeam}),manageTeamChannels:e=>({data:e,originator:i,type:a.manageTeamChannels}),manageTags:e=>({data:e,originator:i,type:a.manageTags}),getLinkToTeam:e=>({data:e,originator:i,type:a.getLinkToTeam}),deleteTeam:e=>({data:e,originator:i,type:a.deleteTeam}),leaveTeam:e=>({data:e,originator:i,type:a.leaveTeam}),hideAllChannelsDialog:e=>({data:e,originator:i,type:a.hideAllChannelsDialog}),hideAllChannelsSucceeded:e=>({data:e,originator:i,type:a.hideAllChannelsSucceeded}),hideAllChannelsFailed:e=>({data:e,originator:i,type:a.hideAllChannelsFailed}),hideAllChannelsDialogCancelAction:e=>({data:e,originator:i,type:a.hideAllChannelsDialogCancelAction}),hideAllChannelsDialogConfirmAction:e=>({data:e,originator:i,type:a.hideAllChannelsDialogConfirmAction}),teamAddMember:e=>({data:e,originator:i,type:a.teamAddMember}),teamAddChannel:e=>({data:e,originator:i,type:a.teamAddChannel}),chatManageApps:e=>({data:e,originator:i,type:a.chatManageApps}),leaveChat:e=>({data:e,originator:i,type:a.leaveChat}),blockChat:e=>({data:e,originator:i,type:a.blockChat}),deleteChat:e=>({data:e,originator:i,type:a.deleteChat}),chatWorkflows:e=>({data:e,originator:i,type:a.chatWorkflows}),muteChat:e=>({data:e,originator:i,type:a.muteChat}),unmuteChat:e=>({data:e,originator:i,type:a.unmuteChat}),markAsReadChat:e=>({data:e,originator:i,type:a.markAsReadChat}),markAsUnreadChat:e=>({data:e,originator:i,type:a.markAsUnreadChat}),openInNewWindowChat:e=>({data:e,originator:i,type:a.openInNewWindowChat}),viewDiscover:e=>({data:e,originator:i,type:a.viewDiscover}),viewSavedMessageSlice:e=>({data:e,originator:i,type:a.viewSavedMessageSlice}),leftRailRenderStart:()=>({originator:i,type:a.leftRailRenderStart}),leftRailRenderDataLoaded:e=>({data:e,originator:i,type:a.leftRailRenderDataLoaded}),leftRailRenderComplete:e=>({data:e,originator:i,type:a.leftRailRenderComplete}),leftRailRenderFail:e=>({data:e,originator:i,type:a.leftRailRenderFail}),leftRailRenderAbandonIfActive:()=>({originator:i,type:a.leftRailRenderAbandonIfActive}),simpleCollabNavigation:e=>({data:e,originator:i,type:a.simpleCollabNavigation}),simpleCollabConversationFolderNavigation:e=>({data:e,originator:i,type:a.simpleCollabConversationFolderNavigation}),seeMoreRenderStart:e=>({data:e,originator:i,type:a.seeMoreRenderStart}),seeMoreRenderComplete:()=>({originator:i,type:a.seeMoreRenderComplete}),seeMoreRenderFail:()=>({originator:i,type:a.seeMoreRenderFail}),viewTeamSeeAllChannels:e=>({data:e,originator:i,type:a.viewTeamSeeAllChannels}),joinTeam:e=>({data:e,originator:i,type:a.joinTeam}),newMessage:e=>({data:e,originator:i,type:a.newMessage}),createChannel:e=>({data:e,originator:i,type:a.createChannel}),createTeam:e=>({data:e,originator:i,type:a.createTeam}),manageTeams:e=>({data:e,originator:i,type:a.manageTeams}),viewMoreSettings:e=>({data:e,originator:i,type:a.viewMoreSettings}),leftRailHeaderPlusMenuOpen:e=>({data:e,originator:i,type:a.leftRailHeaderPlusMenuOpen}),openFilterLeftRail:e=>({data:e,originator:i,type:a.openFilterLeftRail}),openManageTeams:()=>({originator:i,type:a.openManageTeams}),createTeamOnMainView:e=>({data:e,originator:i,type:a.createTeamOnMainView}),teamDiscover:e=>({data:e,originator:i,type:a.teamDiscover}),leftRailFilterTextClick:e=>({data:e,originator:i,type:a.leftRailFilterTextClick}),leftRailFilterTextClearButtonClick:e=>({data:e,originator:i,type:a.leftRailFilterTextClearButtonClick}),simpleCollabStickyFilterUpdated:e=>({data:e,originator:i,type:a.stickyFilterUpdated}),setFolderViewTypeSwitch:e=>({data:e,originator:i,type:a.setFolderViewTypeSwitch}),teamsAndChannelFolderRenderCompleted:()=>({originator:i,type:a.teamsAndChannelFolderRenderCompleted}),setFolderViewTypeFailed:e=>({data:e,originator:i,type:a.setFolderViewTypeFailed}),setTeamExpandedStateAction:e=>({data:e,originator:i,type:a.setTeamExpandedStateAction}),setTeamExpandedStateSucceeded:e=>({data:e,originator:i,type:a.setTeamExpandedStateSucceeded}),setTeamExpandedStateFailed:e=>({data:e,originator:i,type:a.setTeamExpandedStateFailed}),logConnectionSortMessages:e=>({data:e,originator:i,type:a.logConnectionSortMessages}),sortConversationFolderAction:e=>({data:e,originator:i,type:s.sortConversationFolderAction}),sortConversationFolderSucceeded:e=>({data:e,originator:i,type:s.sortConversationFolderSucceeded}),sortConversationFolderFailed:e=>({data:e,originator:i,type:s.sortConversationFolderFailed}),suggestedChatsRenderCompleted:e=>({data:e,originator:i,type:a.suggestedChatsRenderCompleted}),followPresence:e=>({data:e,originator:i,type:a.followPresence}),startTimerSelectedUnreadMention:e=>({data:e,originator:i,type:a.startTimerSelectedUnreadMention}),stopTimerSelectedUnreadMention:e=>({data:e,originator:i,type:a.stopTimerSelectedUnreadMention})},c={completedBySubscription:"completedBySubscription",failedBySubscription:"failedBySubscription"}},995316:(e,t,n)=>{"use strict";n.d(t,{l:()=>i,z:()=>a});const i={SimpleCollabSwitcher:"simple-collab-switcher",SimpleCollabUpdater:"simple-collab-updater"},a={SwitchOnSimpleCollab:"SwitchOnSimpleCollab",SwitchOffSimpleCollab:"SwitchOffSimpleCollab",SwitchOnSplitView:"SwitchOnSplitView",SwitchOffSimpleCollabConfirmation:"SwitchOffSimpleCollabConfirmation",SwitchBackSurveySimpleCollab:"SwitchBackSurveySimpleCollab"}},629693:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>i,W3:()=>a,Am:()=>o});const i="TrinityChannelsTab",a={switchToChannel:"switchToChannel",loadTrinityChannelsTabPage:"loadTrinityChannelsTabPage",seeAllChannelsLoadMoreRenderStart:"seeAllLoadMoreRenderStart",seeAllChannelsLoadMoreRenderFail:"seeAllChannelsLoadMoreRenderFail",seeAllChannelsLoadMoreRenderComplete:"seeAllChannelsLoadMoreRenderComplete",trinitychannelstabFilterSortLoadStart:"trinitychannelstabFilterSortLoadStart",trinitychannelstabFilterSortLoadFail:"trinitychannelstabFilterSortLoadFail",trinitychannelstabFilterSortLoadComplete:"trinitychannelstabFilterSortLoadComplete",seeAllChannelsAction:"seeAllChannelsAction",seeAllChannelsOnLoadAction:"seeAllChannelsOnLoadAction",channelPreviewAction:"channelPreviewAction",openContextMenuAction:"openContextMenuAction",showChannelAction:"showChannelAction",hideChannelAction:"hideChannelAction",allPillAction:"allPillAction",shownForYouPillAction:"shownForYouPillAction",hiddenPillAction:"hiddenPillAction",sharedFromOtherTeamsPillAction:"sharedFromOtherTeamsPillAction",archivedPillAction:"archivedPillAction",deletedPillAction:"deletedPillAction",sortByAction:"sortByAction",searchAction:"searchAction",searchResultsAction:"searchResultsAction",searchNoResultsAction:"searchNoResultsAction",trinitychannelstabRenderStart:"trinitychannelstabRenderStart",trinitychannelstabRenderFail:"trinitychannelstabRenderFail",trinitychannelstabRenderComplete:"trinitychannelstabRenderComplete",addChannel:"addChannel"},o={switchToChannel:e=>({data:e,originator:i,type:a.switchToChannel}),loadTrinityChannelsTabPage:e=>({data:e,originator:i,type:a.loadTrinityChannelsTabPage}),trinitychannelstabFilterSortLoadStart:e=>({data:e,originator:i,type:a.trinitychannelstabFilterSortLoadStart}),trinitychannelstabFilterSortLoadFail:()=>({originator:i,type:a.trinitychannelstabFilterSortLoadFail}),trinitychannelstabFilterSortLoadComplete:()=>({originator:i,type:a.trinitychannelstabFilterSortLoadComplete}),trinitychannelstabRenderStart:()=>({originator:i,type:a.trinitychannelstabRenderStart}),trinitychannelstabRenderFail:()=>({originator:i,type:a.trinitychannelstabRenderFail}),trinitychannelstabRenderComplete:()=>({originator:i,type:a.trinitychannelstabRenderComplete}),seeAllChannelsLoadMoreRenderStart:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderStart}),seeAllChannelsLoadMoreRenderFail:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderFail}),seeAllChannelsLoadMoreRenderComplete:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderComplete}),seeAllChannelsAction:()=>({originator:i,type:a.seeAllChannelsAction}),seeAllChannelsOnLoadAction:()=>({originator:i,type:a.seeAllChannelsOnLoadAction}),channelPreviewAction:e=>({data:e,originator:i,type:a.channelPreviewAction}),openContextMenuAction:e=>({data:e,originator:i,type:a.openContextMenuAction}),showChannelAction:e=>({data:e,originator:i,type:a.showChannelAction}),hideChannelAction:e=>({data:e,originator:i,type:a.hideChannelAction}),addChannel:e=>({data:e,originator:i,type:a.addChannel}),allPillAction:e=>({data:e,originator:i,type:a.allPillAction}),shownForYouPillAction:e=>({data:e,originator:i,type:a.shownForYouPillAction}),hiddenPillAction:e=>({data:e,originator:i,type:a.hiddenPillAction}),sharedFromOtherTeamsPillAction:e=>({data:e,originator:i,type:a.sharedFromOtherTeamsPillAction}),archivedPillAction:e=>({data:e,originator:i,type:a.archivedPillAction}),deletedPillAction:e=>({data:e,originator:i,type:a.deletedPillAction}),sortByAction:e=>({data:e,originator:i,type:a.sortByAction}),searchAction:e=>({data:e,originator:i,type:a.searchAction}),searchResultsAction:e=>({data:e,originator:i,type:a.searchResultsAction}),searchNoResultsAction:e=>({data:e,originator:i,type:a.searchNoResultsAction})}},506453:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>i,w6:()=>a,ah:()=>o});const i="UseronboardingToTeam",a={switchToChannel:"switchToChannel",loadUserOnboardingToTeamPage:"loadUserOnboardingToTeamPage",seeAllChannelsLoadMoreRenderStart:"seeAllLoadMoreRenderStart",seeAllChannelsLoadMoreRenderFail:"seeAllChannelsLoadMoreRenderFail",seeAllChannelsLoadMoreRenderComplete:"seeAllChannelsLoadMoreRenderComplete",useronboardingFilterSortLoadStart:"useronboardingFilterSortLoadStart",useronboardingFilterSortLoadFail:"useronboardingFilterSortLoadFail",useronboardingFilterSortLoadComplete:"useronboardingFilterSortLoadComplete",seeAllChannelsAction:"seeAllChannelsAction",seeAllChannelsOnLoadAction:"seeAllChannelsOnLoadAction",channelPreviewAction:"channelPreviewAction",channelBackAction:"channelBackAction",openContextMenuAction:"openContextMenuAction",goToTeamAction:"goToTeamAction",activityFeedOnLoadAction:"activityFeedOnLoadAction",showChannelAction:"showChannelAction",hideChannelAction:"hideChannelAction",allPillAction:"allPillAction",shownPillAction:"shownPillAction",hiddenPillAction:"hiddenPillAction",sortByAction:"sortByAction",searchAction:"searchAction",searchResultsAction:"searchResultsAction",searchNoResultsAction:"searchNoResultsAction",userOnboardingRenderStart:"userOnboardingRenderStart",userOnboardingRenderFail:"userOnboardingRenderFail",userOnboardingRenderComplete:"userOnboardingRenderComplete"},o={switchToChannel:e=>({data:e,originator:i,type:a.switchToChannel}),loadUserOnboardingToTeamPage:e=>({data:e,originator:i,type:a.loadUserOnboardingToTeamPage}),useronboardingFilterSortLoadStart:e=>({data:e,originator:i,type:a.useronboardingFilterSortLoadStart}),useronboardingFilterSortLoadFail:()=>({originator:i,type:a.useronboardingFilterSortLoadFail}),useronboardingFilterSortLoadComplete:()=>({originator:i,type:a.useronboardingFilterSortLoadComplete}),seeAllChannelsLoadMoreRenderStart:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderStart}),seeAllChannelsLoadMoreRenderFail:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderFail}),seeAllChannelsLoadMoreRenderComplete:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderComplete}),seeAllChannelsAction:()=>({originator:i,type:a.seeAllChannelsAction}),seeAllChannelsOnLoadAction:()=>({originator:i,type:a.seeAllChannelsOnLoadAction}),channelPreviewAction:e=>({data:e,originator:i,type:a.channelPreviewAction}),channelBackAction:()=>({originator:i,type:a.channelBackAction}),openContextMenuAction:e=>({data:e,originator:i,type:a.openContextMenuAction}),goToTeamAction:e=>({data:e,originator:i,type:a.goToTeamAction}),activityFeedOnLoadAction:()=>({originator:i,type:a.activityFeedOnLoadAction}),showChannelAction:e=>({data:e,originator:i,type:a.showChannelAction}),hideChannelAction:e=>({data:e,originator:i,type:a.hideChannelAction}),allPillAction:e=>({data:e,originator:i,type:a.allPillAction}),shownPillAction:e=>({data:e,originator:i,type:a.shownPillAction}),hiddenPillAction:e=>({data:e,originator:i,type:a.hiddenPillAction}),sortByAction:e=>({data:e,originator:i,type:a.sortByAction}),searchAction:e=>({data:e,originator:i,type:a.searchAction}),searchResultsAction:e=>({data:e,originator:i,type:a.searchResultsAction}),searchNoResultsAction:e=>({data:e,originator:i,type:a.searchNoResultsAction}),userOnboardingRenderStart:()=>({originator:i,type:a.userOnboardingRenderStart}),userOnboardingRenderFail:()=>({originator:i,type:a.userOnboardingRenderFail}),userOnboardingRenderComplete:()=>({originator:i,type:a.userOnboardingRenderComplete})}},314551:(e,t,n)=>{"use strict";n.d(t,{Nv:()=>i,mu:()=>a,Yv:()=>o,x8:()=>r,OE:()=>s,Er:()=>l,xl:()=>c,Jj:()=>d,AZ:()=>u});const i="VirtualConsumerEvents",a={closeViewVirtualConsumerEvent:"closeViewVirtualConsumerEvent",createVirtualConsumerEvent:"createVirtualConsumerEvent",editVirtualConsumerEvent:"editVirtualConsumerEvent",joinVirtualConsumerEvent:"joinVirtualConsumerEvent",shareVirtualConsumerEvent:"shareVirtualConsumerEvent",viewVirtualConsumerEvent:"viewVirtualConsumerEvent",deleteVirtualConsumerEvent:"deleteVirtualConsumerEvent"},o=e=>"object"==typeof e&&!!e&&"communityId"in e,r=e=>"object"==typeof e&&!!e&&"eventId"in e,s=e=>"object"==typeof e&&!!e&&"eventId"in e&&"isMainSeriesEvent"in e&&"communityId"in e,l=e=>"object"==typeof e&&!!e&&"joinLink"in e&&"title"in e,c=e=>"object"==typeof e&&!!e&&"eventId"in e,d=e=>"object"==typeof e&&!!e&&"eventId"in e,u={closeViewVirtualConsumerEvent:()=>({originator:i,type:a.closeViewVirtualConsumerEvent}),createVirtualConsumerEvent:e=>({originator:i,type:a.createVirtualConsumerEvent,data:e}),deleteVirtualConsumerEvent:e=>({originator:i,type:a.deleteVirtualConsumerEvent,data:e}),editVirtualConsumerEvent:e=>({originator:i,type:a.editVirtualConsumerEvent,data:e}),joinVirtualConsumerEvent:e=>({originator:i,type:a.joinVirtualConsumerEvent,data:e}),shareVirtualConsumerEvent:e=>({originator:i,type:a.shareVirtualConsumerEvent,data:e}),viewVirtualConsumerEvent:e=>({originator:i,type:a.viewVirtualConsumerEvent,data:e})}},447310:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>bFe,getPlatformConfigurationOverrides:()=>CFe});n(845850),n(442503);var i=n(545137),a=n(765384),o=n(432720),r=n(329966),s=n(638763),l=n(579024),c=n(754255),d=n(850434);class u{constructor(e,t,n){this.eventHandler=e,this.commandHandler=t,this.commandDelegator=n}bubble(e){return this.eventHandler(e,this.commandHandler,this.commandDelegator)}}var m=n(115100),p=n(441985),g=n(937545);const h=new Set([g.x9,g.T3,g.Qp]),v=e=>"viewStateRegistration"in e,y=e=>h.has(e.manifest.id),S=e=>e.current?.midNavEntity??e.current?.subNavEntity??e.current?.headerEntity??e.current?.startEntity??e.current?.mainEntity,f=e=>e.manifest.id===g.jx;var k=n(240892);const C="internal-event-handler",b=({commandChangeReportingService:e,correlation:t,type:n})=>{if(n===p.I.DelegatedCommandReceived)e.report({type:n,correlationId:t.id,context:{target:C,correlation:t}});else e.report({type:n,correlationId:t.id,context:{target:C}})},w=({commandChangeReportingService:e,correlation:t,errorInfo:n=k.Q.DelegatedCommandError,errorMessage:i,logger:a})=>{a.errorToTelemetry?.(i,"webclient_framework_foundation_core_services_internal_command_delegator",void 0,!0),e.report({correlationId:t.id,type:p.I.Failure,context:{target:C,errorMessage:i,errorInfo:n}})},T=(e,t,n)=>i=>{e.report({correlationId:t,type:p.I.ScenarioEventDataAppended,context:{target:n,eventData:i}})},I=(e,t,n)=>(i,a,o,r)=>{e.report({correlationId:t,type:p.I.ScenarioMarked,context:{target:n,step:i,eventData:a,status:o,monitoringData:r}})},N=(e,t,n)=>({appendCommandScenarioEventData:T(e,t,n),markCommandScenarioStep:I(e,t,n)});var A=n(131647),E=n(554186);function F(e){return{...e,id:(t=e,t&&t.id||(0,E.v4)()),startTimestamp:_(e),source:e?.source||A.p.StandAlone};var t}function _(e){return e&&e.startTimestamp||Date.now()}var D=n(163930);const P="corelayout",M="closeMonitor",R="collapseHeader",x="defaultCommand",L="expandHeader",O="expandTab",j="updateDialogState",B="goBack",U="hideHeader",$="hideMonitor",W="maximizeTab",V="openCoreDialog",H="resetLayoutOverrides",z="showMonitor",q="showOopsPage",G="displayTitleBar",Y="toggleAppBar",Q="toggleEndRail",J="toggleStartRail",K="publishCdlCapabilities",Z="unhideHeader",X="unhideMonitor",ee={toggleAppBar:()=>({actor:P,action:Y}),displayTitleBar:e=>({actor:P,action:G,data:e}),goBack:()=>({actor:P,action:B}),collapseHeader:()=>({actor:P,action:R}),expandHeader:()=>({actor:P,action:L}),hideHeader:()=>({actor:P,action:U}),unhideHeader:()=>({actor:P,action:Z}),defaultCommand:e=>({actor:P,action:"defaultCommand",data:e}),expandTab:e=>({actor:P,action:O,data:e}),maximizeTab:()=>({actor:P,action:W}),closeMonitor:()=>({actor:P,action:M}),hideMonitor:()=>({actor:P,action:$}),updateDialogState:e=>({actor:P,action:j,data:e}),openCoreDialog:e=>({actor:P,action:V,data:e}),showMonitor:e=>({actor:P,action:z,data:e}),toggleEndRail:e=>({actor:P,action:Q,data:e}),toggleStartRail:e=>({actor:P,action:J,data:e}),unhideMonitor:()=>({actor:P,action:X}),showOopsPage:e=>({actor:P,action:q,data:e}),publishCdlCapabilities:e=>({actor:P,action:K,data:e}),resetLayoutOverrides:()=>({actor:P,action:H})},te=async({activeWindowsService:e,appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,commandHandler:o,commandInput:r,coreSettings:s,correlation:l,executionContext:c,host:u,isInSecondHop:g=!1,loggerFactory:h,scenarioFactory:f,shortcutExecutionService:k,stateManagementServices:C,userBiService:T,windowId:I})=>{const A=h.newLogger("internalCommandDelegator","core-services-entity-commanding"),E=ne(l,r);b({commandChangeReportingService:a,correlation:E,type:p.I.DelegatedCommandReceived});const F=function(e,t){return e.getAppByActor(t.command.actor)}(t,r);if(!F){const e=`Command for actor ${r.command.actor} does not map to any registered app.`;return w({commandChangeReportingService:a,correlation:E,errorMessage:e,logger:A}),Promise.resolve(void 0)}const _=ae(I,F,r);if(!F.onCommandReceived){const e=`Command for actor ${r.command.actor} maps to app ${F.manifest.name}, but the app hasn't registered onCommandReceived handler.`;return w({commandChangeReportingService:a,correlation:E,errorMessage:e,logger:A}),Promise.resolve(void 0)}const{navigationalReactiveValues:P,nonNavigationalReactiveValues:M}=t.getAppViewStateForWindow(_||d.N2,F.manifest.id)||{};let R=!1,x={};P&&(x=Object.keys(P).reduce(((e,t)=>{const n=P[t];return{...e,[t]:{read:n.read,update:e=>{e!==n.read()&&(n.update(e),R=!0)}}}}),{}));const L=function(e,t,n,i,a,o,{viewEntitiesRef:r,viewEntity:s}={},l,c,{storeManager:d,...u}){const m=r&&S(r);return{stateManagementServices:u,client:e,clientPreferences:t.getAllPreferences(),clientPreferencesService:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,shortcutExecutionService:c,executionContext:{viewEntities:{endEntity:r?.current?.endEntity,mainEntity:r?.current?.mainEntity},viewEntity:s,isHandlingAppActiveApp:!!m&&o.getApp({entityType:m.type})?.manifest.id===l}}}(n,i,s,h,f,t,c,F.manifest.id,k,C);let O;try{const i={commandInput:r,requestContext:L,commandReportingCallbacks:N(a,E.id,"on-command-received")};b({commandChangeReportingService:a,correlation:E,type:p.I.BeforeOnCommandReceived});const o={...x,...M};O=await(async({activeWindowsService:e,delegatedApp:t,reactiveValues:n,hookOptions:i,host:a,windowId:o,userBiService:r,appsRegistryService:s})=>{if(!t.onCommandReceived)return Promise.resolve(void 0);if(v(t)&&y(t)){if(n){const l={...i,activeWindowsService:e,appsRegistryService:s,appViewState:n,host:a,slotDimensionsOptions:m.As,userBiService:r,windowId:o};return t.onCommandReceived(l)}}else{if(!v(t)){if(y(t)){const n={...i,activeWindowsService:e,appsRegistryService:s,slotDimensionsOptions:m.As,windowId:o};return t.onCommandReceived(n)}return t.onCommandReceived(i)}if(n){const e={...i,appViewState:n};return t.onCommandReceived(e)}}return Promise.resolve(void 0)})({activeWindowsService:e,delegatedApp:F,reactiveValues:o,hookOptions:i,host:u,windowId:_,userBiService:T,appsRegistryService:t}),R&&(n.mutate({mutation:D.H,variables:{windowId:_,appIds:[F.manifest.id]}}).catch((e=>{A.warn(`saveReactiveVarToHistory failed ${e.message}`)})),R=!1),b({commandChangeReportingService:a,correlation:E,type:p.I.AfterOnCommandReceived})}catch(e){const t=`Command for actor ${r.command.actor} and action ${r.command.action} encountered an error inside onCommandReceived of ${F.manifest.name}.`;return w({commandChangeReportingService:a,correlation:E,errorMessage:t,logger:A}),Promise.reject(e)}if(!O)return b({correlation:E,commandChangeReportingService:a,type:p.I.CommandHandledByOnCommandReceived}),Promise.resolve(void 0);const j=e=>"entity"in e;if(!g&&!j(O)&&oe(O,F))return A.log(`onCommandReceived for ${F.manifest.name} is requesting a second hop to CoreLayoutApp`),te({activeWindowsService:e,appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,commandHandler:o,commandInput:O,coreSettings:s,executionContext:c,host:u,isInSecondHop:!0,loggerFactory:h,scenarioFactory:f,shortcutExecutionService:k,userBiService:T,windowId:_,correlation:E,stateManagementServices:C});if(!j(O)){const e=`Command for actor ${r.command.actor} inside onCommandReceived of ${F.manifest.name}, should return an IEntityCommand or undefined.`;return w({commandChangeReportingService:a,correlation:E,errorMessage:e,logger:A}),Promise.reject(e)}const{layoutMode:B,clientLaunchId:U}=r.command?.data||{};o(ie(O,E,_,B),U)},ne=(e,t)=>e||t.correlation||F(),ie=(e,t,n,i)=>({...e,command:{...e.command,correlation:t,...n&&{__UNSAFE_windowId:n},...i&&{layoutMode:i}}}),ae=(e,t,n)=>y(t)&&n.command.data?.windowId||e,oe=(e,t)=>e.command.actor===P||"com.microsoft.teams.corelayout"===t.manifest.id;class re{constructor(e,t){this.commandHandler=e,this.commandDelegator=t}execute(e){return this.commandDelegator(e,this.commandHandler)}}var se=n(663896);const le="internal-event-handler",ce=({commandChangeReportingService:e,correlation:t,type:n,eventInput:i})=>{const a=i.event.type;if(n===p.I.EventBubbled)e.report({type:n,correlationId:t.id,context:{target:le,correlation:t,eventType:a}});else e.report({type:n,correlationId:t.id,context:{target:le,eventType:a}})},de=({commandChangeReportingService:e,correlation:t,errorMessage:n,logger:i})=>{const a=k.Q.EventError;i.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_internal_event_handler",void 0,!0),e.report({correlationId:t.id,type:p.I.Failure,context:{target:le,errorMessage:n,errorInfo:a}})},ue=["MeControlCore","MeControlMeAccount","MeControlMTMA"],me=async({appsRegistryService:e,client:t,clientPreferences:n,commandChangeReportingService:i,commandDelegator:a,commandHandler:o,coreSettings:r,eventInput:s,executionContext:l,hostCommunicationService:u,i18n:m,loggerFactory:h,notificationsHandler:k,phaseStateMachine:C,scenarioFactory:b,shortcutExecutionService:w,userBiService:T,viewportContext:I,windowId:A,stateManagementServices:E})=>{const _=h.newLogger("internalEventHandler","core-services-entity-commanding");let P=function(e,t){return t?t&&e.getApp({entityType:t.viewEntity?.type}):e.getAppByID(g.x9)}(e,l);const M=((e,t,n,i,a,o)=>{const{scenarioName:r,id:s,source:l,eventData:d}=t?.getEventScenarioData?.(e,i,a,o)||{};let u;u=a.get(c.w.Core).enableEventTimestamp?e.source.timeStamp:Date.now();const m=F({id:s,scenarioName:r,source:l,startTimestamp:u});return ce({commandChangeReportingService:n,correlation:m,type:p.I.EventBubbled,eventInput:e}),d&&n.report({type:p.I.ScenarioEventDataAppended,correlationId:m.id,context:{target:le,eventData:d}}),m})(s,P,i,_,r,n);if("com.microsoft.teams.search"===P?.manifest.id&&ue.includes(s.event.originator)&&(P=e.getApp({renderMode:se.k.TitleBar})),"updateDialogState"===s.event.type&&(P=e.getAppByID(g.x9)),!P){return de({commandChangeReportingService:i,correlation:M,errorMessage:"Error mapping event to slot.",logger:_}),Promise.resolve(void 0)}if(!P.eventHandlers?.onEventReceived){const e=`Event '${s.event.type}' was received for app ${P.manifest.name}, but it hasn't registered an event handler.`;return de({commandChangeReportingService:i,correlation:M,errorMessage:e,logger:_}),Promise.resolve(void 0)}const R=function(e,t,n,i,a,o,r,{viewEntitiesRef:s,viewEntity:l}={},c,d,u,m,p,{storeManager:g,...h},v){const y=s&&S(s);return{client:e,clientPreferences:t.getAllPreferences(),clientPreferencesService:t,coreSettings:n,hostCommunicationService:u,i18n:m,loggerFactory:i,scenarioFactory:a,shortcutExecutionService:d,userBiService:o,executionContext:{viewEntities:{endEntity:s?.current?.endEntity,mainEntity:s?.current?.mainEntity},viewEntity:l,isHandlingAppActiveApp:!!y&&r.getApp({entityType:y.type})?.manifest.id===c},phaseStateMachine:p,stateManagementServices:h,viewportContext:v}}(t,n,r,h,b,T,e,l,P.manifest.id,w,u,m,C,E,I);let x;try{const n={eventInput:s,requestContext:R,commandReportingCallbacks:N(i,M.id,"on-event-received")};ce({commandChangeReportingService:i,correlation:M,eventInput:s,type:p.I.BeforeOnEventReceived});const{navigationalReactiveValues:a,nonNavigationalReactiveValues:o}=e.getAppViewStateForWindow(A||d.N2,P.manifest.id)||{};let r=!1,l={};a&&(l=Object.keys(a).reduce(((e,t)=>{const n=a[t];return{...e,[t]:{read:n.read,update:e=>{e!==n.read()&&(n.update(e),r=!0)}}}}),{}));const c=(l||o)&&{...l,...o};x=await(async({sourceApp:e,reactiveValues:t,hookOptions:n,notificationsHandler:i,windowId:a})=>{let o;if(!e.eventHandlers?.onEventReceived)return Promise.resolve(void 0);if(v(e)&&y(e)){if(t){const i={...n,appViewState:t,windowId:a};o=await e.eventHandlers.onEventReceived(i)}}else if(v(e)){if(t){const i={...n,appViewState:t};o=await e.eventHandlers.onEventReceived(i)}}else if(y(e)){const t={...n,windowId:a};o=await e.eventHandlers.onEventReceived(t)}else if(f(e)&&i){const t={...n,notificationsHandler:i};o=await e.eventHandlers.onEventReceived(t)}else o=await e.eventHandlers.onEventReceived(n);return Promise.resolve(o)})({sourceApp:P,reactiveValues:c,hookOptions:n,notificationsHandler:k,windowId:A}),r&&(t.mutate({mutation:D.H,variables:{windowId:A,appIds:[P.manifest.id]}}).catch((e=>{_.warn(`saveReactiveVarToHistory mutation failed ${e.message}`)})),r=!1),ce({correlation:M,commandChangeReportingService:i,type:p.I.AfterOnEventReceived,eventInput:s})}catch(e){const t=`Event '${s.event.type}' encountered an error inside onEventReceived of ${P.manifest.name}.`;return de({commandChangeReportingService:i,correlation:M,errorMessage:t,logger:_}),Promise.reject(e)}if(!x)return ce({correlation:M,commandChangeReportingService:i,type:p.I.EventHandled,eventInput:s}),Promise.resolve(void 0);return a({...x,correlation:M},o)};var pe=n(312726),ge=n(634664),he=n(740875);const ve="DeepLink:: ";var ye,Se;!function(e){e.DecodeURIComponentFailed="DecodeURIComponentFailed",e.DeeplinkNotHandledByRegisteredApps="DeeplinkNotHandledByRegisteredApps",e.DeeplinkTerminatedByApp="DeeplinkTerminatedByApp",e.ExecuteFromUrlFailed="ExecuteFromUrlFailed",e.IntentServiceExecutionFailed="IntentServiceExecutionFailed",e.InvalidDeepLinkUrl="InvalidDeepLinkUrl",e.InvalidOrigin="InvalidOrigin",e.OnBeforeDeeplinkParsedFailed="OnBeforeDeeplinkParsedFailed",e.OpenCrossCloudDeeplinkFailed="OpenCrossCloudDeeplinkFailed",e.ToNavigationIntentFailed="ToNavigationIntentFailed"}(ye||(ye={})),function(e){e.NavigationIntentNotFound="NavigationIntentNotFound"}(Se||(Se={}));var fe=n(226107),ke=n(572909),Ce=n(43372),be=n(702183),we=n(364819);const Te="https://teams.microsoft.com/l",Ie="/task/",Ne="/stage/",Ae="/entity/",Ee="context",Fe="application/vnd.microsoft.card.adaptive",_e=(e,t,n)=>{const i=e=>n?.(e);return e.executeCommand(t.entity,{entityCommand:t.command,entityOptions:t.entityOptions}).subscribe({complete:i,error:i}),Promise.resolve()},De=(e,t,n,i,a,o)=>{const r=e.executeCommand(t.entity,{entityCommand:t.command,entityOptions:t.entityOptions}),s=n.newScenario(be.Cu.ExtTaskModuleLaunch),l=fe.t7.DeepLink;return r.subscribe({complete:()=>{i.log(`task module complete for entrypoint ${l}`),s.stop(Re(a,l)),o&&o()},error:e=>{i.error(`error launching task module for entry point ${l}.  Error:`,e),s.fail(Re(a,l,e)),o&&o(e)},next:e=>{e.containerState===g.iW.Open&&s.stop(Re(a,l))}}),Promise.resolve()},Pe=(e,t)=>{const n=new URL(e).pathname.split("/");if(n.length===t){const[,,e,t,i]=n;return!(!e||!t)}return!1},Me=e=>!(!e||!e.startsWith(Te)),Re=(e,t,n)=>{const i={};return e&&(i["App.Id"]=e),t&&(i["App.EntryPoint"]=fe.t7[t]),n&&(i.errors=n),i},xe=(e,t)=>{if(!t)throw new Error("Could not find app context");switch(e.type){case ke.ck.extensions:return{...t,type:Ce.Y.tab};case ke.ck.channels:return{...t,type:Ce.Y.channel};case ke.ck.chats:return{...t,type:Ce.Y.chat};default:throw new Error("unsupported launch context")}},Le=e=>!!e&&"0"!==e,Oe=e=>e?JSON.parse(e):{},je=(e,t)=>{switch(e&&e.type){case ke.ck.extensions:return $e(e);case ke.ck.chats:return{chatId:e.id||""};case ke.ck.channels:{const{channelId:n,replyChainId:i}=Oe(e.id);return{channelId:n,parentMessageId:i,chatId:Ue(i,n,t),meetingId:Be(n,i),channelMeetingMessageId:i}}default:return}},Be=(e,t)=>{if(e){const n=e.split(";")[0];return Le(t)?btoa(`0#${n}#${t}`):btoa(`0#${n}#0`)}return""},Ue=(e,t,n)=>Le(e)&&n?t.includes("messageid")?t:`${t};messageid=${e}`:t,$e=e=>{if(e.linkedEntity)switch(e.linkedEntity.type){case ke.ck.chats:return{chatId:e.linkedEntity.id};case ke.ck.channels:{const{channelId:t,replyChainId:n}=Oe(e.linkedEntity.id);return{channelId:t,parentMessageId:n,channelMeetingMessageId:n}}case ke.ck.extensions:return e.linkedEntity.id?JSON.parse(e.linkedEntity.id):void 0}},We=(e,t)=>{const n=e.search.indexOf("=")+1,i=e.search.substring(n)||"",a=decodeURIComponent(i),{contentUrl:o,websiteUrl:r,removeUrl:s,name:l}=JSON.parse(a);return{type:"tab/tabInfoAction",tabInfo:{contentUrl:o,websiteUrl:r,removeUrl:s,name:l,entityId:t}}},Ve=e=>{const t=e.search.indexOf("?")+1;return(e.search.substring(t)||"").split("&").reduce(((e,t)=>{const[n,i]=t.split("="),a=decodeURIComponent(i);return{...e,[n]:(0,we.isString)(n)&&"card"===n.toLowerCase()?He(a):a}}),{})},He=e=>{try{const t=JSON.parse(e),n=(0,we.isString)(t.contentType)&&t.contentType.toLowerCase()===Fe.toLowerCase(),i=(0,we.isString)(t.type)&&"adaptivecard"===t.type.toLowerCase();return n?{content:JSON.stringify(t.content),contentType:t.contentType}:i?{content:e,contentType:Fe}:null}catch{return null}};var ze=n(983292);class qe{constructor(e,t,n,i,a,o,r,s,l,c){this.host=e,this.commandHandler=t,this.extensionCommandingService=n,this.scenarioFactory=i,this.deeplinkService=o,this.coreSettings=r,this.executionContext=s,this.sourceViewEntity=l,this.clientLaunchId=c,this.logger=a.newLogger("DeepLinkCommandingService","core-services-entity-commanding")}checkForPendingDeeplink(e,t){return this.deeplinkService.checkForPendingIntent(e,this.clientLaunchId,t??this.executionContext.userContextId)}launchMainApp(e,t,n){return this.deeplinkService.launchMainApp(e,this.clientLaunchId,t,n)}launchMinimode(e,t){return this.deeplinkService.launchMinimode(e,this.clientLaunchId,t)}switchAccount(e,t,n,i,a,o){return this.deeplinkService.switchAccount(e,t,this.clientLaunchId,n,i,a,o)}prewarmFlyout(e){return this.deeplinkService.prewarmFlyout(e)}prewarmMinimode(e){return this.deeplinkService.prewarmFlyout(e,!0)}async executeFromUrlV2(e,t,n,i){this.logger.log(`executeFromUrlV2::deepLink::'${e}'`);const a=this.allowV2Flow(e),o=i||(0,he.sB)(e,this.coreSettings);if(!a)return!1;try{return await this.deeplinkService.executeFromUrlAsync(e,t,n,this.clientLaunchId,{...this.executionContext,...this.isCrossCloudNonMeetingDeeplink(e)&&{userContextId:void 0}},this.sourceViewEntity,o)}catch(e){const t=`DeepLinkCommanding:: ${ye.ExecuteFromUrlFailed} ${(0,ge.hR)(e)}`;throw this.logger.errorToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0),new Error(t)}}async executeDeepLinkFromUrl(e,t,n,i){this.coreSettings.get(c.w.Core).forceHostOpenForDeepLink&&this.host.open(e);const a=!!this.coreSettings.get(c.w.Core)?.handleInternalDeepLinks,o=!!this.coreSettings.get(c.w.Extensibility)?.enableChatIdChangeInGetContextCall;try{if(await this.executeFromUrlV2(e,n,void 0))return}catch(e){this.logger.errorToTelemetry?.(e?.message,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}const r=this.createEntityCommandFromDeepLink(e,t,o);return r?((e,t,n,i,a,o,r)=>{switch(e.entity.type){case ke.ck.taskmodule:const s=new URL(t),[,,,l]=s.pathname.split("/");return De(i,e,o,a,l,r);case ke.ck.platformStage:return _e(i,e,r);default:return n(e)}})(r,e,this.commandHandler,this.extensionCommandingService,this.logger,this.scenarioFactory,i):a?void this.host.open(e):this.host.opener.open(pe.h.OpenOnMainRenderer,pe.F.DeepLink,{url:e})}async executeIntent(e,t){const n=await this.deeplinkService.executeIntent({...e,metadata:{userContextId:e.metadata.userContextId??this.executionContext.userContextId,...e.metadata}},t),i=this.coreSettings.get(c.w.Core).enableOpenCrossCloudDeeplink,a=e.metadata.deepLink;if(a&&!n&&i)try{const e=new URL(a);this.host.open(e,"_blank")}catch(e){const t=`${ve}${ye.OpenCrossCloudDeeplinkFailed}::${e?.name}`;this.logger.warnToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}}createEntityCommandFromDeepLink(e,t,n){return Pe(e,4)&&(e=>{if(Me(e))return e.substr(29).toLowerCase().substring(0,6)===Ie;return!1})(e)?((e,t,n)=>{const i=(0,E.v4)(),a=new URL(e),[,,,o]=a.pathname.split("/"),r={entryPoint:fe.t7.DeepLink,appId:o,taskInfo:Ve(new URL(e))};return{entity:{id:i,type:ke.ck.taskmodule,action:ke.SY.create},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},entityOptions:{input:r,launchContext:xe(t,je(t,n))}}})(e,t,n):(e=>Pe(e,5))(e)&&(e=>!!Me(e)&&e.substr(29).toLowerCase().substring(0,7)===Ne)(e)?(e=>{try{const t=new URL(e),[,,,n]=t.pathname.split("/"),i=(0,E.v4)();return{entity:{id:i,type:ke.ck.platformStage,action:ke.SY.view},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},entityOptions:{appId:n,tabInfo:JSON.stringify(We(t,i))}}}catch{return null}})(e):null}allowV2Flow(e){return!!(this.coreSettings.get(c.w.Extensibility).handleDeepLinkToMeetingSidePanel&&(e=>{if(!Pe(e,5))return!1;const{searchParams:t}=new URL(e),n=t.has(Ee)&&t.get(Ee);if(!n)return!1;try{const e=JSON.parse(decodeURIComponent(n));return!(!e||!e.chatId||"chat"!==e.contextType&&"meeting"!==e.contextType||"false"===t.get("openInMeeting"))}catch(e){return!1}})(e)&&(t=e,Me(t)&&t.substring(29).toLowerCase().substring(0,8)===Ae))||!!this.coreSettings.get(c.w.Core)?.handleInternalDeepLinks;var t}isCrossCloudNonMeetingDeeplink(e){let t;try{t=new URL(e)}catch{return!1}const n=(0,ze.JT)(t.host,this.coreSettings);return!!n&&n!==(0,ze.nv)(this.coreSettings)&&!(0,he.BD)(e)}}var Ge=n(74279),Ye=n(901456),Qe=n(568834),Je=n(199448);const Ke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"addBlockingExtension"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"removeBlock"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addBlockingExtension"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}},{kind:"Argument",name:{kind:"Name",value:"removeBlock"},value:{kind:"Variable",name:{kind:"Name",value:"removeBlock"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};class Ze{constructor(e,t,n,i,a,o){this.commandHandler=e,this.client=t,this.windowId=n,this.scenarioFactory=i,this._windowModalManager=o,this.subscribers=[],this.onDestroy=new Ye.B7,this.logger=a.newLogger("ExtensionCommandingService","core-services-entity-commanding")}async destroy(){try{this.onDestroy.next(),this.reset()}catch(e){this.logger.warn(`Unable to destroy, error ocurred in persisting delete of extension entity. e.name: ${e.name}, e.message: ${e.message}`)}}executeCommand(e,t){const n=t?.entityCommand||{stateTransition:g.Ar.none,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}};n.stateTransition=g.Ar.extend;const i={entity:e,command:n,entityOptions:t?.entityOptions};return this.processRequest(i)}async addBlockingExtension(e,t,n=!1){if(!n&&await this.isWindowBlocked())return void this.logger.log("Window is currently blocked, addBlockingExtension no-op");this.logger.log(`addBlockingExtension, requesting an extension of type ${e.type} to block the window`);const i={entity:e,entityOptions:JSON.stringify(t),windowId:this.windowId,removeBlock:n};await this.client.mutate({mutation:Ke,variables:i})}isBlockedByEntity(e){return this._windowModalManager.isBlockedByEntity(e)}async isWindowBlocked(){return this._windowModalManager.isBlockingEntityExtension()}pipeWhileStateIsValid(e){return e.pipe((0,Ge.Q)(this.onDestroy),(0,o.T)((e=>({containerState:e.containerState}))))}processRequest(e){this.scenarioFactory.newScenario(be.Cu.ExtensionOpen);const t=this._windowModalManager.observeContainerState().pipe(),n=this.pipeWhileStateIsValid(t);this.commandHandler(e).then((()=>{n.subscribe({next:e=>{this.stopActiveScenario(e.containerState),this.nextSubscriber(e),e.containerState===g.iW.Error&&this.resetSubscriber((0,Je.$5)("ExtensionCommanding",d.O4.Unknown,`ExtendedContainerState ${e.containerState}`,void 0,"Error processing entity extension"))},complete:()=>{this.resetSubscriber()},error:e=>{this.resetSubscriber(e)}})})).catch((e=>{this.resetSubscriber(e)}));return new Qe.c((e=>{this.subscribers.push(e)}))}nextSubscriber(e){this.subscribers.forEach((t=>t.next(e)))}resetSubscriber(e){const t=this.subscribers;this.reset(),e?(this.failActiveScenarios(),t.length&&t.forEach((t=>t.error(e)))):(this.stopActiveScenarios(),t.length&&t.forEach((e=>e.complete())))}reset(){this.subscribers=[]}stopActiveScenarios(){this.scenarioFactory.findScenario(be.Cu.ExtensionClose)?.stop(),this.scenarioFactory.findScenario(be.Cu.ExtensionOpen)?.stop()}failActiveScenarios(){this.scenarioFactory.findScenario(be.Cu.ExtensionClose)?.fail(),this.scenarioFactory.findScenario(be.Cu.ExtensionOpen)?.fail()}stopActiveScenario(e){switch(e){case g.iW.Error:this.failActiveScenarios();break;case g.iW.Open:case g.iW.Closed:case g.iW.Cancelled:case g.iW.Confirmed:this.stopActiveScenarios();break;default:this.logger.errorToTelemetry&&this.logger.errorToTelemetry(`Unable to stop active scenario, no case mapped to container state provided: ${e}`,"webclient_framework_foundation_core_services_extension_commanding",void 0,!0)}}}const Xe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"executeEntityCommand"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"executionContext"}},type:{kind:"NamedType",name:{kind:"Name",value:"ExecutionContextInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"command"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityCommandInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"clientLaunchId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptionsInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"defaultEntityBehindExtension"}},type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"executeEntityCommand"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"executionContext"},value:{kind:"Variable",name:{kind:"Name",value:"executionContext"}}},{kind:"Argument",name:{kind:"Name",value:"command"},value:{kind:"Variable",name:{kind:"Name",value:"command"}}},{kind:"Argument",name:{kind:"Name",value:"clientLaunchId"},value:{kind:"Variable",name:{kind:"Name",value:"clientLaunchId"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}},{kind:"Argument",name:{kind:"Name",value:"windowOptions"},value:{kind:"Variable",name:{kind:"Name",value:"windowOptions"}}},{kind:"Argument",name:{kind:"Name",value:"defaultEntityBehindExtension"},value:{kind:"Variable",name:{kind:"Name",value:"defaultEntityBehindExtension"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var et=n(924820),tt=n(642123),nt=n(289242);const it=/(maglev|Teams)\/(\d+\.\d+\.\d+\.\d+)/,at="teams-precache-v2";function ot(e){return e.includes("local")?"local":e.includes("-oncdn-")?"container":"production"}function rt(e,t){try{const t=st(e),n=t?.dataset?.config;return n?JSON.parse(decodeURIComponent(n)):{}}catch(e){const n=`Failed to parse head-data config with error: ${e}`;t?.errorToTelemetry?t?.errorToTelemetry?.(n,"webclient_framework_head_config",void 0,!0):t?.error?.(n)}return{}}function st(e){const t=e?.document.getElementsByTagName("head");if(t)return t[0]}function lt(e){const t=e?.navigator.userAgent||"";return-1!==t.indexOf("maglev/")||-1!==t.indexOf("Teams/")}const ct=e=>function(e){const t=e.match(/(maglev|Teams)\/(\d+\.\d+\.\d+\.\d+)(?:\/| \()(\d+)(?:\s|\)|$)/);if(t&&t.length>3)switch(t[3]){case"49":return nt.PU.MaglevT21;case"50":return nt.PU.MaglevMacT21;case"51":return nt.PU.MaglevRoomsT21}return nt.PU.Maglev}(e?.navigator.userAgent||"");function dt(e){const t=e.navigator.userAgent.match(it);return t&&t.length>2?t[2]:void 0}function ut(e){const t=e.config.clientType;return t!==nt.sK.Web?t:e.config.isPwa?nt.sK.PWA:t}function mt(e){const t=e.navigator?.serviceWorker?.controller;return"activated"===t?.state}async function pt(e,t,n){let i="";try{if(t){let n=0;const a=new Promise((t=>{n=e.setTimeout((()=>{t()}),5e3)})),o=gt(t,"getSWVersion").then((t=>{i=t,e.clearTimeout(n),n=0}));await Promise.race([o,a])}}catch{n?.error("Get registerred SW version failed.")}return i}async function gt(e,t){return new Promise(((n,i)=>{const a=new MessageChannel;a.port1.onmessage=e=>{e.data.error?i(e.data.error):n(e.data)},e.postMessage(t,[a.port2])}))}async function ht({app:e,commandChangeReportingService:t,entityCommand:n,hookRequestContext:i,logger:a,windowProvider:o,notificationsHandler:r}){let s=n;if(e.onBeforeCommandHandled){const l=n.command.correlation,c=l.id,d="internal-command-handler-execute-before-command-handled-hook";t.report({type:p.I.ApplicationHookReceivedCommand,context:{target:d},correlationId:c});try{const t={entityCommand:n,requestContext:i,windowProvider:o||void 0,notificationsHandler:f(e)&&r?r:void 0};s=await e.onBeforeCommandHandled(t)}catch(n){const i=`Command 'onBeforeCommandHandled' rejected. An attempt to handle the command was made by app:${e.manifest.name}, but failed. Error: ${(0,et.y)((0,Je.Nw)(n))}`;let r,s;return a.errorToTelemetry?.(i,"webclient_framework_foundation_core_services_internal_command_handler",void 0,!0),o&&function(e){return e.indexOf("failed to load bundle:")>=0}(i)&&(r=mt(o),r&&(s=await async function(e,t,n){try{const n="failed to load bundle: ",i=e.indexOf(n),a=e.indexOf('","stack":');if(i>=0&&a>i){const o=e.substring(i+n.length,a);if(o){const e=await async function(e,t,n){let i=!1;try{if(e&&mt(t)){const n=await t.caches.open(at);if(n){const t=await n.keys(),a=new RegExp(`https:\\/\\/staticsint\\.teams\\.cdn\\.office\\.net\\/teams-modular-packages\\/hashed-assets\\/${e}-[a-f0-9]{16}\\.js$`,"i");void 0!==t.find((e=>a.test(e.url)))&&(i=!0)}}}catch{n?.error(`Checking assets in sw cache by name failed, chunk name: ${e}`)}return i}(o,t);return e}}}catch{n.errorNoPii?.(`Check for isChunckInSWCache error, errorMessage: ${e}`)}return Promise.resolve(void 0)}(i,o,a))),t.report({type:p.I.Failure,context:{errorInfo:k.Q.OnBeforeCommandHandledRejected,errorMessage:i,target:d,isServiceWorkerActive:r,isLoadedFromServiceWorkerCache:s},correlationId:c}),Promise.reject(n)}void 0!==s&&(t.report({type:p.I.ApplicationHookContinuedCommand,context:{target:d},correlationId:c}),s.command.correlation=l,t.report({type:p.I.CommandStart,correlationId:c,context:{target:d,entityCommand:s}}))}return Promise.resolve(s)}function vt({appName:e,commandChangeReportingService:t,entityCommand:n,getCommandScenarioName:i,logger:a,coreSettings:o,clientPreferences:r}){const s=n.command.correlation,l=void 0===s.scenarioName||s.scenarioName===be.Cu.EntityCommand;if(i&&l){try{s.scenarioName=i(n,a,o,r)}catch(n){t.report({type:p.I.Failure,context:{errorInfo:k.Q.GetCommandScenarioNameHookFailed,errorMessage:`App ${e} failed to execute entity command hook GetCommandScenarioName with ${n.name}`,target:"internal-command-handler"},correlationId:s.id})}a.log(`App ${e} is overwriting default scenario name to ${s.scenarioName} for command with entityType ${n.entity.type}`)}}function yt(e){return{...e,command:St(e.command)}}function St(e){return{...e,correlation:F(e.correlation)}}const ft=new tt.M(50);var kt=n(636310);const Ct=async({activeWindowsService:e,appsRegistryService:t,authenticationUser:n,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,entityCommandInput:l,executionContext:u,hostCommunicationService:m,loggerFactory:h,notificationsHandler:v,platformService:y,rebootService:S,scenarioFactory:f,userBiService:C,userTrackingService:b,windowId:w,windowProvider:T})=>{const I=h.newLogger("internalCommandHandler","core-services-entity-commanding");let N=yt(function(e){const t=e.command||St({stateTransition:g.Ar.none,visibilityState:g.Rp.show,correlation:{source:A.p.Unknown}});return{...e,command:t}}(l));const E=N.command.correlation.id,{enableDestroyedClientCommandError:F}=s.get(c.w.Core);if(F&&!i.getContext()){const e=k.Q.DestroyedClientCommandError;return I.errorToTelemetry?.("Context already removed from apollo client","webclient_framework_foundation_core_services_entity_commanding",void 0,!0),void r.report({correlationId:E,type:p.I.Incomplete,context:{errorInfo:e,target:"internal-command-handler"}})}const _=l.command?.__UNSAFE_windowId??w;if(_!==w&&I.log(`window id overridden to ${_}`),((e,t,n,i,a)=>{const{enableRejectOnDuplicateCorrelationId:o}=n.get(c.w.Core);if(!o)return!1;if(ft.has(t)){const n=`Error, duplicate entity command correlation id, ${t}, entity: ${e.entity.type}/${e.entity.action}`;return i.report({type:p.I.Failure,correlationId:t,context:{target:"internal-command-handler",errorMessage:n,eventData:{mainEntityType:e.entity.type,mainEntityAction:e.entity.action}}}),a.error(n),!0}return ft.set(t,!0),!1})(N,E,s,r,I))return Promise.resolve(void 0);const D=function(e,t){return t&&e.getApp({entityType:t.viewEntity?.type})}(t,u),P=function(e,t){return e.getApp({entityType:t.entity.type})}(t,N);if(function({commandChangeReportingService:e,entityCommand:t,logger:n,sourceApp:i,renderingApp:a,coreSettings:o,clientPreferences:r}){const{scenarioName:s}=t.command.correlation;s||t.entity.type!==ke.ck.default||(t.command.correlation.scenarioName=be.Cu.DefaultCommand),i&&vt({appName:i.manifest.name,commandChangeReportingService:e,entityCommand:t,getCommandScenarioName:i.getCommandScenarioNameFromSource,logger:n,coreSettings:o,clientPreferences:r}),a&&vt({appName:a.manifest.name,commandChangeReportingService:e,entityCommand:t,getCommandScenarioName:a.getCommandScenarioName,logger:n,coreSettings:o,clientPreferences:r})}({commandChangeReportingService:r,entityCommand:N,renderingApp:P,sourceApp:D,logger:I,coreSettings:s,clientPreferences:o}),function({commandChangeReportingService:e,entityCommand:t,executionContextEntity:n}){const i=t.command.correlation.id;e.report({type:p.I.CommandStart,correlationId:i,context:{target:"internal-command-handler",entityCommand:t,executionContextEntity:n}})}({commandChangeReportingService:r,entityCommand:N,executionContextEntity:u?.viewEntity}),P){const e=function(e,t,n,i,a,o,r,s,l,c){return{client:e,coreSettings:t,loggerFactory:n,platformService:i,scenarioFactory:a,userBiService:o,userTrackingService:r,authenticationUser:s,rebootService:l,hostCommunicationService:c}}(i,s,h,y,f,C,b,n,S,m),t=T||void 0;N=await ht({app:P,commandChangeReportingService:r,entityCommand:N,hookRequestContext:e,logger:I,windowProvider:t,notificationsHandler:v})}if(!N)return r.report({type:p.I.CommandHandledPriorToResolution,context:{target:"internal-command-handler"},correlationId:E}),Promise.resolve(void 0);((e,t)=>{const n=e.getWindowLayoutService().preCacheManager;n.shouldInterruptPreCaching(t)&&n.interruptPreCaching()})(e,N.entity);const{enableDecoupleCommandingFromResolvers:M}=s.get(c.w.Core);if(M){const t=await(async({activeWindowsService:e,commandChangeReportingService:t,coreSettings:n,entityCommand:i,executionContext:a,loggerFactory:o,authenticationUser:r,windowId:s=d.N2})=>{const{enableDecoupleCommandingFromResolversExtend:l}=n.get(c.w.Core);if(!l)return!1;if(["flush","forceFlush"].includes(i.command.stateTransition)&&"default"!==i.entity?.action&&"hide"!==i.command.visibilityState&&e.getWindowLayoutService(s)?.modalManager.setContainerState("Closed",!0),"extend"!==i.command.stateTransition)return!1;if(i.metadata?.deepLink)return!1;if(i.defaultEntityBehindExtension&&!e.getStandardMainWindow())return!1;const u=o.newLogger("dispatchCommand","core-services-entity-commanding");t.report({correlationId:i.command.correlation.id,type:p.I.CommandResolutionStarted,context:{target:"executeEntityCommand"}}),u.log(`Command received for entity ${JSON.stringify(i.entity)}`),u.log(`Command received :${JSON.stringify(i.command)}`),u.log(`Command with id ${i.command.correlation.id} received on window context ${s}`),u.log(`Command received with execution context: ${a?.viewEntityName}`);const m=a?.userContextId||r&&(0,kt.Lw)(r)||"extend"===i.command.stateTransition&&e.getStandardMainWindow()?.id&&e.getStandardMainWindow()?.userContextId||null;if("extend"===i.command.stateTransition){const t=i.command.correlation;return e.executeCommand("handleExtendCommand")({correlation:t,entity:{...i.entity,options:JSON.stringify(i.entityOptions)},openOnMainWindow:s===d.N2,userContextId:m,windowId:s,visibilityState:i.command.visibilityState}),!0}return!1})({activeWindowsService:e,authenticationUser:n,commandChangeReportingService:r,coreSettings:s,entityCommand:N,executionContext:u,loggerFactory:h,windowId:_});if(t)return void I.log("Command was handled without resolvers")}return function({entityCommand:e,mutateContext:{client:t,executionContext:n,windowId:i,clientLaunchId:a}}){return t.mutate({mutation:Xe,variables:{...e,entityOptions:JSON.stringify(e.entityOptions),executionContext:n,windowId:i,clientLaunchId:a},fetchPolicy:"no-cache"}).then((e=>e?.data?.executeEntityCommand?.id))}({entityCommand:N,mutateContext:{client:i,executionContext:u,windowId:_,clientLaunchId:a}})};var bt=n(530267);class wt{constructor(e){this.commandHandler=e}trigger(e){return this.commandHandler({entity:It(e.entity),command:Ft(e.command)})}}const Tt=e=>{switch(e){case bt.SY.view:return ke.SY.view;case bt.SY.list:return ke.SY.list;case bt.SY.default:return ke.SY.default;default:throw(0,Je.$5)(d.Ir.Commanding,d.O4.NotImplemented,"Nova",void 0,`Mapping for Nova action type ${e} not implemented in Teams!`)}},It=e=>{switch(e.type){case bt.ck.identity:return Nt(e);case bt.ck.teams_chat:return{type:ke.ck.chats,id:e.entityId,action:Tt(e.action)};case bt.ck.teams_channel:return{type:ke.ck.channels,id:e.entityId,action:Tt(e.action)};case bt.ck.office_home:return{type:ke.ck.communitiesonboarding,id:e.entityId,action:Tt(e.action)};case bt.ck.office_people:return{type:ke.ck.homepage,id:e.entityId,action:Tt(e.action)};case bt.ck.teams_activity:return{type:ke.ck.activity,id:e.entityId,action:Tt(e.action)};case bt.ck.teams_calendar:return{type:ke.ck.calendar,id:e.entityId,action:Tt(e.action)};case bt.ck.teams_meet:return{type:ke.ck.meet,id:e.entityId,action:Tt(e.action)};case bt.ck.m365_app:return{type:ke.ck.extensions,id:e.entityId,action:Tt(e.action)};case bt.ck.teams_calling:return{type:ke.ck.callsmain,id:e.entityId,action:ke.SY.view};default:throw(0,Je.$5)(d.Ir.Commanding,d.O4.NotImplemented,"Nova",void 0,`Mapping for Nova entity type ${e.type} not implemented in Teams!`)}},Nt=e=>{switch(e.action){case bt.SY.signout:return{type:ke.ck.signoutdialog,id:e.entityId,action:ke.SY.view};case bt.SY.updateProfilePicture:return{type:ke.ck.updatemsaprofileavatardialog,id:e.entityId,action:ke.SY.view};case bt.SY.updateDisplayName:return{type:ke.ck.updatemsaprofilenamedialog,id:e.entityId,action:ke.SY.view};default:throw(0,Je.$5)(d.Ir.Commanding,d.O4.NotImplemented,"Nova",void 0,`Mapping for Nova identity entity with action type ${e.action} not implemented in Teams!`)}},At=e=>{switch(e){case bt.Rp.hide:return g.Rp.hide;case bt.Rp.show:return g.Rp.show;case bt.Rp.toggle:return g.Rp.toggle}},Et=e=>{switch(e){case bt.Ar.extend:return g.Ar.extend;case bt.Ar.flush:return g.Ar.flush;case bt.Ar.forceFlush:return g.Ar.forceFlush;case bt.Ar.new:return g.Ar.new;case bt.Ar.none:return g.Ar.none}},Ft=e=>({visibilityState:At(e.visibilityState),stateTransition:Et(e.stateTransition),correlation:{source:A.p.Nova}});var _t=n(955626),Dt=n(901208),Pt=n(657120);class Mt{constructor(e,t,n,i,a,o,r){this.commandHandler=e,this.extensionCommanding=t,this.hostCommunicationService=n,this.windowId=i,this.host=a,this.coreSettings=o,this._logger=r.newLogger("ShellCommandingService","core-services-entity-commanding")}async bringWindowToFront(e){const t=await this.hostCommunicationService.loadModule("osutils");return this._logger.log(`Performing action: bringWindowToFront on ${e}`),t?.bringWindowToFront?.(e)||Promise.resolve(!1)}desktopActiveCallDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.appswitcherdesktopactivecalldialog,action:ke.SY.view},{entityCommand:e})}async desktopNotice(){const e=await this.hostCommunicationService.loadModule("osutils");return this._logger.log("Performing action: desktopNotice"),e?.openThirdPartyNotice?.()}dismissBanner(e,t=A.p.Unknown){return this.dismissNotification(e,ke.ck.bannerNotification,t)}dismissToast(e,t=A.p.Unknown){return this.dismissNotification(e,ke.ck.inAppToast,t)}executeNotificationAction(e,t,n,i,a){let o;try{o=JSON.parse(i)}catch(e){return this._logger.errorNoPii?.(`Notification command can't be parsed: ${i}`),Promise.resolve()}return a?this.dismissNotification(e,t,n):t===ke.ck.bannerNotification&&(o.entityOptions={...o.entityOptions,bannerId:e}),this.commandHandler(o)}exitFullscreen(){if(this.coreSettings.get(c.w.Core).routeWindowActionsThroughHostComms){const e=this.host.document,t=(e.exitFullscreen?"exitFullscreen":e.mozCancelFullScreen&&"mozCancelFullScreen")||e.webkitExitFullscreen&&"webkitExitFullscreen"||e.webkitExitFullScreen&&"webkitExitFullScreen";return Promise.resolve(e[t]()).then((()=>(this._logger.log(`WindowAction[${t}] succeeded.`),Promise.resolve()))).catch((e=>{const n=(0,et.y)(e?.message);return this._logger.error(`WindowAction[${t}] failed due to: ${n}.`),Promise.reject(n)}))}return this.host.exitFullscreen(),Promise.resolve()}async getScreenshots(e,t){const n=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: getScreenshots on ${this.windowId}`),n?.getScreenshots?.(e,t)}async installAndLaunchT1(){const e=await this.hostCommunicationService.loadModule("appswitcher"),t=await(e?.downloadAndInstallPearApp?.(_t.sS.Teams1));switch(t?.status){case _t.b4.DownloadedAndInstalled:await this.launchT1AndQuitT2(!0),this._logger.log("T1 is downloaded and installed");break;case _t.b4.FailedToDownload:this._logger.errorNoPii?.(`T1 failed to download: ${t?.errorMessage}`);break;case _t.b4.FailedToInstall:this._logger.errorNoPii?.(`T1 failed to install: ${t?.errorMessage}`);break;default:this._logger.errorNoPii?.(`T1 download and install failed: ${t?.errorMessage}`)}}joinLinkDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.joinlinkdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}async launchT1AndQuitT2(e,t){const n=await this.hostCommunicationService.loadModule("appswitcher");e&&(this._logger.log("launchT1AndQuitT2, Switcher default app to T1"),await(n?.switchDefaultAppTo?.(_t.sS.Teams1))),this._logger.log("launchT1AndQuitT2, launch T1"),await(n?.launchPearApp?.(_t.sS.Teams1,t)),this._logger.log("Flushing T2 telemetry events"),await(0,Pt.AR)().flush(),this._logger.log("launchT1AndQuitT2, quit T2"),await(n?.quitApp?.())}async setWindowControlsTheme(e){const t=await this.hostCommunicationService.loadModule("windowcontrols");return t?.setCustomFrameOptions?.(this.windowId,{titleBarMode:Dt.PC.ButtonsOnly,theme:e})}licenseRequestDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.licenserequestdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}async maximizeWindow(){if(!this.coreSettings.get(c.w.Core).routeWindowActionsThroughHostComms)return this.host.maximize();const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: maximizeWindow on ${this.windowId}`),e?.maximize?.(this.windowId)}async minimizeWindow(){if(!this.coreSettings.get(c.w.Core).routeWindowActionsThroughHostComms)return this.host.minimize();const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: maximizeWindow on ${this.windowId}`),e?.minimize?.(this.windowId)}msaProfileAvatarUpdateDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.updatemsaprofileavatardialog,action:ke.SY.view},{entityCommand:e})}msaProfileNameUpdateDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.updatemsaprofilenamedialog,action:ke.SY.view},{entityCommand:e})}noticeDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.tpndialog,action:ke.SY.view},{entityCommand:e})}openFreDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.officeintegrationfredialog,action:ke.SY.info},{entityCommand:e})}premiumTrialDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.premiumtrialdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}requestFullscreen(){if(this.coreSettings.get(c.w.Core).routeWindowActionsThroughHostComms){const e=this.host.document.documentElement,t=(e.requestFullscreen?"requestFullscreen":e.mozRequestFullScreen&&"mozRequestFullScreen")||e.webkitRequestFullscreen&&"webkitRequestFullscreen"||e.webkitRequestFullScreen&&"webkitRequestFullScreen"||e.webkitEnterFullScreen&&"webkitEnterFullScreen"||e.webkitEnterFullscreen&&"webkitEnterFullscreen";return Promise.resolve(e[t]()).then((()=>(this._logger.log(`WindowAction[${t}] succeeded.`),Promise.resolve()))).catch((e=>{const n=(0,et.y)(e?.message);return this._logger.error(`WindowAction[${t}] failed due to: ${n}.`),Promise.reject(n)}))}return this.host.requestFullscreen(),Promise.resolve()}async restoreWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: restoreWindow on ${this.windowId}`),e?.restore?.(this.windowId)}async setMinimumWindowSize(e,t){const n=await this.hostCommunicationService.loadModule("windowcontrols");return n?.setMinimumWindowSize?.(this.windowId,e,t)}async setWindowBounds(e,t,n,i){const a=await this.hostCommunicationService.loadModule("windowcontrols");return a?.setWindowBounds?.(this.windowId,Math.trunc(e),Math.trunc(t),Math.trunc(n),Math.trunc(i))}async updateWindowTransparency(e,t){const n=await this.hostCommunicationService.loadModule("windowcontrols");let i,a=!0;return e<947?a=!1:i="mercury"===t?this.calculateMercuryWindowTransparencyBorders(e):this.calculateDefaultWindowTransparencyBorders(e),n?.setBackdropEffectState?.(this.windowId,a,i)}async showContextMenu(e){const t=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: showContextMenu on ${this.windowId} and position ${e}`),t?.showTitleBarContextMenu?.(this.windowId,e)}showBanner({id:e,dismissable:t=!0,duration:n=4,source:i=A.p.Unknown,...a}){return this.commandHandler({command:{correlation:{source:i},stateTransition:g.Ar.none,visibilityState:g.Rp.show},entity:{type:ke.ck.bannerNotification,action:ke.SY.create,id:e},entityOptions:{...a,dismissable:t,duration:n}})}showToast({id:e,duration:t=7e3,source:n=A.p.Unknown,...i}){return this.commandHandler({command:{correlation:{source:n},stateTransition:g.Ar.none,visibilityState:g.Rp.show},entity:{type:ke.ck.inAppToast,action:ke.SY.create,id:e},entityOptions:{...i,duration:t}})}signOutDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.signoutdialog,action:ke.SY.view},{entityCommand:e})}async startWindowDragListener(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: startWindowDragListener on ${this.windowId}`),e?.startWindowDragListener?.(this.windowId)}async swapMeetingRoomFrontOfRoomWindows(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log("Performing action: swapMeetingRoomFrontOfRoomWindows"),e?.swapMeetingRoomFrontOfRoomWindows?.()}async switchDefaultAppTo(e){const t=await this.hostCommunicationService.loadModule("appswitcher");this._logger.log(`switchDefaultAppTo ${e}`),await(t?.switchDefaultAppTo?.(e))}t1DownloadDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.appswitchert1downloaddialog,action:ke.SY.view},{entityCommand:e})}webActiveCallDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.appswitcherwebactivecalldialog,action:ke.SY.view},{entityCommand:e})}webMultipleTabsDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.appswitcherwebmultipletabsdialog,action:ke.SY.view},{entityCommand:e})}async zoomInWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomInWindow on ${this.windowId}`),e?.zoomIn?.(this.windowId)}async zoomOutWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomOutWindow on ${this.windowId}`),e?.zoomOut?.(this.windowId)}async zoomResetWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomResetWindow on ${this.windowId}`),e?.zoomReset?.(this.windowId)}dismissNotification(e,t,n=A.p.Unknown){return this.commandHandler({command:{correlation:{source:n},stateTransition:g.Ar.none,visibilityState:g.Rp.hide},entity:{type:t,action:ke.SY.delete,id:e}})}calculateDefaultWindowTransparencyBorders(e){let t=0,n=0;if(e>=1500){t=360,n=200}else if(e>=1350){t=320,n=200}else if(e>=947){t=280,n=200}return{left:68+n+t,top:48,right:0,bottom:0}}calculateMercuryWindowTransparencyBorders(e){let t=0;if(e>=1500){t=408}else if(e>=1350){t=408}else if(e>=947){t=340}return{left:67+t+10,top:58,right:10,bottom:10}}}var Rt,xt,Lt,Ot=n(523661);!function(e){e.openInExplorer="openInExplorer"}(Rt||(Rt={})),function(e){e.quickReply="quickReply",e.unknown="unknown",e.view="view",e.toast="toast"}(xt||(xt={})),function(e){e.unknown="unknown",e.deeplink="deeplink"}(Lt||(Lt={}));var jt,Bt=n(903502);!function(e){e.unknown="unknown",e.toast="toast",e.activity="activity"}(jt||(jt={}));var Ut=n(262462),$t=n(515490);class Wt{constructor(e,t){this.commandHandler=e,this.userContextId=t}showMessage(e,{collectionId:t,conversationId:n,mainImage:i,discardDuringMeetingsAndCalls:a,messageId:o,quickReply:r,quickReplyButton:s,quickReplyPlaceholder:l,text:c,time:d,title:u,isUrgent:m,isFromPriorityContact:p,externalAppIconType:h}){const v={collectionId:t,isUrgent:p||m,mainImage:i,discardDuringMeetingsAndCalls:a,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,messageId:o,userContextId:this.userContextId,toastType:Vt(n)?"phoneLinkSmsToast":void 0},id:n,type:Ot.w$.chats},textInput:r?Ht(n,s,l,this.userContextId):void 0,text:c,time:d,title:u,telemetryClientId:e,externalAppIconType:h},y={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:d.valueOf(),scenarioName:be.Cu.CrossClientToastView},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:v};return this.commandHandler(y)}showReminder(e,{collectionId:t,conversationId:n,mainImage:i,messageId:a,text:o,time:r,title:s,buttonText:l,type:c}){const d={collectionId:t,mainImage:i,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,messageId:a,userContextId:this.userContextId,toastType:c},id:n,type:Ot.w$.reminders},textInput:void 0,text:o,time:r,title:s,telemetryClientId:e,buttons:[{targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,messageId:a,userContextId:this.userContextId},id:n,type:Ot.w$.reminders},text:l}]},u={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:r.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:d};return this.commandHandler(u)}showChatTabEntityNotification(e,{collectionId:t,conversationId:n,mainImage:i,tabId:a,text:o,time:r,title:s}){const l={collectionId:t,mainImage:i,targetEntity:{id:a,type:Ot.w$.extensions,action:Ot.qj.view,dataOptions:{actionType:xt.unknown,userContextId:this.userContextId},linkedEntity:{id:n,action:Ot.qj.view,type:Ot.w$.chats}},text:o,time:r,title:s,telemetryClientId:e},c={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:r.valueOf()},stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:l};return this.commandHandler(c)}showChannelsNotification(e,{collectionId:t,conversationId:n,mainImage:i,discardDuringMeetingsAndCalls:a,messageId:o,text:r,time:s,title:l,replyChainId:c}){const d={collectionId:t,mainImage:i,discardDuringMeetingsAndCalls:a,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,messageId:o,userContextId:this.userContextId,focusOnLoad:Bt.I.DoNotMove},id:JSON.stringify({channelId:n,replyChainId:c,deepLinkId:c}),type:Ot.w$.channels},text:r,time:s,title:l,telemetryClientId:e},u={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:s.valueOf(),scenarioName:be.Cu.CrossClientToastView},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:d};return this.commandHandler(u)}showCommunitiesNotifications(e,{collectionId:t,conversationId:n,mainImage:i,messageId:a,text:o,time:r,title:s,replyChainId:l,type:c,parentTeamId:d}){const u={collectionId:t,mainImage:i,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,messageId:a,userContextId:this.userContextId,toastType:c,teamId:d||n,deepLinkId:a},id:JSON.stringify({channelId:n,replyChainId:l}),type:Ot.w$.communities},text:o,time:r,title:s,telemetryClientId:e},m={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:r.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:u};return this.commandHandler(m)}showCommunitiesMembersViewNotifications(e,{collectionId:t,conversationId:n,mainImage:i,text:a,time:o,title:r,type:s}){const l={collectionId:t,mainImage:i,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,userContextId:this.userContextId,toastType:s,teamId:n},id:n,type:Ot.w$.communitiesmembers},text:a,time:o,title:r,telemetryClientId:e},c={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:o.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:l};return this.commandHandler(c)}showCommunitiesMemberRequestsNotifications(e,{collectionId:t,conversationId:n,mainImage:i,text:a,time:o,title:r,type:s}){const l={collectionId:t,mainImage:i,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,userContextId:this.userContextId,toastType:s,teamId:n},id:n,type:Ot.w$.communitiesjoinrequest},text:a,time:o,title:r,telemetryClientId:e},c={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:o.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:l};return this.commandHandler(c)}showCommunitiesCalendarEventsNotifications(e,{collectionId:t,conversationId:n,mainImage:i,text:a,time:o,title:r}){const s={collectionId:t,mainImage:i,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,userContextId:this.userContextId},id:JSON.stringify({channelId:n}),type:Ot.w$.communitiesevents},text:a,time:o,title:r},l={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:o.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:s};return this.commandHandler(l)}showEspSyntheticNotification(e,{collectionId:t,mainImage:n,text:i,time:a,title:o,deeplinkUrl:r}){const s={dataOptions:{actionType:xt.view,userContextId:this.userContextId,focusOnLoad:Bt.I.DeeplinkedMessage},action:Ot.qj.list,type:Ot.w$.activity},l={action:Ot.qj.view,dataOptions:{actionType:Lt.deeplink,userContextId:this.userContextId,deeplinkUrl:r},id:"msGraph",type:Ot.w$.notificationsdeeplink},c={collectionId:t,targetEntity:r?l:s,textInput:void 0,text:i,time:a,title:o,mainImage:n,telemetryClientId:e},d={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:a.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:c};return this.commandHandler(d)}showEspSyntheticNotificationWithCampaignType(e,{collectionId:t,mainImage:n,text:i,time:a,title:o,campaignType:r}){const s={type:Ot.w$.chats,action:Ot.qj.view,id:"newchat",dataOptions:{actionType:jt.toast,userContextId:this.userContextId,campaignType:r}},l={type:Ot.w$.campaignnotifications,action:Ot.qj.view,id:r,dataOptions:{actionType:jt.toast,userContextId:this.userContextId}},c={collectionId:t,mainImage:n,targetEntity:r===Ut.pR.files?s:l,text:i,time:a,title:o,telemetryClientId:e},d={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:a.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:c};return this.commandHandler(d)}showGraphItemNotification(e,{collectionId:t,mainImage:n,discardDuringMeetingsAndCalls:i,text:a,time:o,title:r,isSquareImage:s,deeplinkUrl:l,type:c="msGraph"}){const d="msGraph",u={action:Ot.qj.view,dataOptions:{actionType:Lt.deeplink,userContextId:this.userContextId,deeplinkUrl:l,toastType:c},id:d,type:Ot.w$.notificationsdeeplink},m={action:Ot.qj.list,dataOptions:{actionType:xt.view,userContextId:this.userContextId,focusOnLoad:Bt.I.DeeplinkedMessage},id:d,type:Ot.w$.activity},p={collectionId:t,mainImage:n,discardDuringMeetingsAndCalls:i,targetEntity:l?u:m,text:a,time:o,title:r,isSquareImage:s,telemetryClientId:e},h={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:o.valueOf(),scenarioName:be.Cu.CrossClientToastView},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:p};return this.commandHandler(h)}showReEngageNudge(e,{conversationId:t,text:n,time:i,title:a,type:o}){const r={targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,userContextId:this.userContextId,toastType:o},id:t,type:Ot.w$.reminders},textInput:void 0,text:n,time:i,title:a,telemetryClientId:e},s={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:i.valueOf()},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:r};return this.commandHandler(s)}showLocalRecordingAssemblyNotification(e,{text:t,time:n,title:i,mainImage:a},o){const r={targetEntity:{action:Ot.qj.view,dataOptions:{actionType:Rt.openInExplorer,userContextId:this.userContextId,fileId:o},id:"localRecordingAssembly",type:Ot.w$.files},mainImage:a,textInput:void 0,text:t,time:n,title:i,telemetryClientId:e},s={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:n.valueOf()},stateTransition:g.Ar.none,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:r};return this.commandHandler(s)}showMeetNowNudge(e,{conversationId:t,text:n,time:i,title:a,type:o,deeplinkUrl:r,deepLinkId:s}){const l={targetEntity:{action:Ot.qj.join,dataOptions:{actionType:xt.view,userContextId:this.userContextId,toastType:o,deeplinkUrl:r,coordinates:{joinType:"MeetingData",meetingData:{meetingUrl:r}},deepLinkId:s},id:t,type:Ot.w$.callingdeeplink},textInput:void 0,text:n,time:i,title:a,telemetryClientId:e},c={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:i.valueOf()},stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:l};return this.commandHandler(c)}showInteractionRequiredToast(e,{text:t,time:n,title:i,mainImage:a}){const o={targetEntity:{action:Ot.qj.view,dataOptions:{actionType:"cannot-be-empty",userContextId:this.userContextId,toastType:"interactionRequired"},id:e,type:Ot.w$.alerts},mainImage:a,text:t,time:n,title:i,telemetryClientId:e},r={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:n.valueOf()},stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:o};return this.commandHandler(r)}showFollowPresenceToast(e,{conversationId:t,mainImage:n,text:i,time:a,title:o}){const r={mainImage:n,targetEntity:{action:Ot.qj.view,dataOptions:{actionType:xt.view,userContextId:this.userContextId},id:t,type:Ot.w$.chats},text:i,time:a,title:o,telemetryClientId:e},s={command:{correlation:{id:e,source:A.p.Notifications,startTimestamp:a.valueOf(),scenarioName:be.Cu.CrossClientToastView},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entity:{action:ke.SY.view,type:ke.ck.toasts},entityOptions:r};return this.commandHandler(s)}}const Vt=e=>!!e?.startsWith($t.g.PhonelinkSmsPrefix),Ht=(e,t,n,i)=>({placeholderText:n||"Send a quick reply",sendButton:{text:t||"Send",targetEntity:{action:Ot.qj.mutate,type:Ot.w$.chats,dataOptions:{actionType:xt.quickReply,convId:e,userContextId:i,toastType:Vt(e)?"phoneLinkSmsToast":void 0}}}});class zt{constructor(e){this.commandHandler=e}showAccounts(){return this.commandHandler({entity:{type:ke.ck.accounts,action:ke.SY.list}})}}class qt{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}default(e){return this.commandHandler({entity:{type:ke.ck.activity,action:ke.SY.default},command:e})}empty(e){return this.commandHandler({entity:{type:ke.ck.activity,action:ke.SY.empty},command:e})}launchDeleteActivityFeedItemDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.activity,action:ke.SY.delete},{entityCommand:e})}launchActivityErrorDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.activity,action:ke.SY.error},{entityCommand:t})}openEmptyFeedMainPane(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.activity,action:ke.SY.empty},command:t,scenarioEventData:n})}}var Gt=n(914020),Yt=n(693973),Qt=n(81670),Jt=n(667606);const Kt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataAuthUserAuthStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAuthState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"reason"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"isExpected"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"errorMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accountId"}},{kind:"Field",name:{kind:"Name",value:"cloud"}}]}}]}}]}}]}}]},Zt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataAuthEndPagesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMRU"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEndPageData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"isMRU"},value:{kind:"Variable",name:{kind:"Name",value:"isMRU"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"pictureBlob"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"subContext"}}]}},{kind:"Field",name:{kind:"Name",value:"shouldBypassEndPageLogout"}}]}}]}}]};class Xt{constructor(e,t,n,i){this.commandHandler=e,this.extensionCommanding=t,this.deeplinkCommandingService=n,this.client=i}signinPage(e){return this.commandHandler({entity:{type:ke.ck.identity,action:ke.SY.default},command:e})}accountList(e){return this.commandHandler({entity:{type:ke.ck.identity,action:ke.SY.list},command:e})}async switchAccount({correlation:e,userContextId:t,targetEntity:n,cloud:i,entityOptions:a}){if(!this.client)throw new Error("client missing in switch account commanding");const{data:o}=await this.client.query({query:Kt,variables:{userContextId:t},context:{correlation:e}})||{},r=o?.userAuthState;if(r&&"Up"!==r.state){let n,a,s;const l=r.customError?.errorCode;if("UnRedeemed"===r.state&&(s=Gt.T.tenantRedemption,n=ke.SY.create),"LoginError"===r.state)switch(r.customError?.errorCode){case Qt.tG.TenantUnredeemed:s=Gt.T.tenantRedemption,n=ke.SY.create;break;case Qt.tG.InteractionRequired:s=Gt.T.tenantLogin,n=ke.SY.create;break;case Qt.tG.CloudMismatch:const e=r.customError?.errorMetadata;i=e?.cloud,t=e?.accountId;break;default:n=ke.SY.error}if("LicenseError"===r.state||"SignInRestriction"===r.state||"MsaUserNotAllowed"===l){const i=await this.client.query({query:Zt,variables:{userContextId:t,isMRU:!1},context:{correlation:e}}),o="MsaUserNotAllowed"===l?l:"LicenseError"===r.state?"LicenseError":"SignInRestriction",s=i.data.userEndPageData;n=ke.SY.error,a=(0,Jt.Oi)(s,o,t)}if(n)return this.commandHandler({entity:{type:ke.ck.identitydialog,action:n},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:e},entityOptions:{correlation:e,userContextId:t,userAuthState:o?.userAuthState,error:a,dialogName:s}})}return this.deeplinkCommandingService.switchAccount(e,t,n,i,a)}signOutDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.signoutdialog,action:ke.SY.view},{entityCommand:e})}smartDeviceSignOutDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.smartdevicelogoutdialog,action:ke.SY.view},{entityCommand:e})}addAccountDialog(e){return this.commandHandler({entity:{type:ke.ck.identitydialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.focus,correlation:e.correlation},entityOptions:e})}accountSelectionDialog(e){return this.commandHandler({entity:{type:ke.ck.accountselectiondialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.focus,correlation:e.correlation},entityOptions:e})}closeAccountSelectionDialog(e){return this.commandHandler({entity:{type:ke.ck.accountselectiondialog,action:ke.SY.create},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.focus,correlation:{source:e}}})}addAccount(e){return this.commandHandler({entity:{type:ke.ck.identity,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus,correlation:e},entityOptions:{correlation:e}})}closeAccountListDialog(e){return this.commandHandler({entity:{type:ke.ck.identitydialog,action:ke.SY.create},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.focus,correlation:{source:e}}})}closeEntity(e,t){return this.commandHandler({entity:t,command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.focus,correlation:{source:e}}})}executeEntity(e){return this.commandHandler(e)}closeAccountLoginDialog(e){return this.commandHandler({entity:{type:ke.ck.identitydialog,action:ke.SY.create},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.focus,correlation:{source:e}}})}closeAddAccountListWindow(e){return this.commandHandler({entity:{type:ke.ck.identity,action:ke.SY.create},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.focus,correlation:{source:e}}})}closeAccountListWindow(e){return this.commandHandler({entity:{id:Yt.Rm.focus,type:ke.ck.identity,action:ke.SY.list},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.focus,correlation:{source:e}}})}showAuthEndPage(e,t,n){return this.commandHandler({entity:{type:n?ke.ck.identitydialog:ke.ck.identity,action:ke.SY.error},command:{visibilityState:g.Rp.show,stateTransition:n?g.Ar.extend:g.Ar.flush,layoutMode:n?Yt.Rm.focus:Yt.Rm.standard,correlation:{source:e}},entityOptions:{error:t.error}})}showRefreshModal(e){return this.commandHandler({entity:{type:ke.ck.authrefreshdialog,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.standard,correlation:{source:e}}})}}class en{constructor(e){this.commandHandler=e}viewAutoInstallNotification(e,t){return this.commandHandler({entity:{type:ke.ck.autoinstallnotification,action:ke.SY.view},command:t,entityOptions:e})}}class tn{constructor(e){this.commandHandler=e}navigateToFaceEnrollment(){return this.commandHandler({entity:{type:ke.ck.faceenrollment,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{startTimestamp:Date.now(),source:A.p.FaceEnrollmentGetStartedButton}}})}navigateToVoiceEnrollment(){return this.commandHandler({entity:{type:ke.ck.voiceenrollment,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{startTimestamp:Date.now(),source:A.p.VoiceEnrollmentGetStartedButton}}})}}class nn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}brbFeedbackDialogInMainWindow(e,t){return this.commandHandler({entity:{type:ke.ck.brbfeedbackdialog,action:ke.SY.view},command:e,entityOptions:t})}brbFeedbackDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.brbfeedbackdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}autoBrbConfirmationDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.autobrbconfirmationdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}autoBrbFlowDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.autobrbflowdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}brbMemorySnapshotConsentDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.brbmemorysnapshotconsentdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}}class an{constructor(e){this.commandHandler=e}openBreakoutRooms(e,t){return this.commandHandler({entity:{type:ke.ck.breakoutrooms,action:ke.SY.view},entityOptions:t,command:e})}openBreakoutRoomsInChat(e,t){return this.commandHandler({entity:{type:ke.ck.breakoutrooms,action:ke.SY.view,linkedEntity:{type:ke.ck.chats,id:e}},command:t})}showAssignmentDialog(e){return this.showDialog(ke.ck.breakoutroomsassignment,e)}showAssignmentTypeDialog(e){return this.showDialog(ke.ck.breakoutroomsassignmenttype,e)}showCreateRoomsDialog(e){return this.showDialog(ke.ck.breakoutroomscreaterooms,e)}showDeleteRoomDialog(e){return this.showDialog(ke.ck.breakoutroomsdeleteroom,e)}showDeleteRoomsDialog(e){return this.showDialog(ke.ck.breakoutroomsdeleterooms,e)}showEditRoomDialog(e){return this.showDialog(ke.ck.breakoutroomseditroom,e)}showSettingsDialog(e){return this.showDialog(ke.ck.breakoutroomssettings,e)}showDialog(e,t){return this.commandHandler({entity:{type:e,action:ke.SY.view},command:{stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding},visibilityState:t}})}}class on{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}qnaPanelById(e,t){return this.commandHandler({entity:{type:ke.ck.broadcastqna,action:ke.SY.view,id:e,linkedEntity:{type:ke.ck.calls,id:e}},command:t})}broadcastQnaPanelById(e,t){return this.commandHandler({entity:{type:ke.ck.eventsbroadcastqna,action:ke.SY.view,id:e,linkedEntity:{type:ke.ck.calls,id:e}},command:t})}infoPanelById(e,t){return this.commandHandler({entity:{type:ke.ck.broadcasts,action:ke.SY.info,id:e,linkedEntity:{type:ke.ck.calls,id:e}},command:t})}broadcastWebJoinUnsupportedDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.broadcastwebjoinnotsupporteddialog,action:ke.SY.view},{entityOptions:{originalDeeplink:e}})}broadcastById(e,t,n){return this.commandHandler({entity:{type:ke.ck.broadcasts,action:ke.SY.view,id:e},command:t,entityOptions:n})}broadcastFeedbackById(e,t,n){return this.commandHandler({entity:{type:ke.ck.broadcastfeedback,action:ke.SY.view,id:e},command:t,entityOptions:n})}broadcastLeave(e,t,n){return this.commandHandler({entity:{type:ke.ck.broadcasts,action:ke.SY.leave,id:e},command:t,entityOptions:n})}joinBroadcastAsAttendee(e){return this.commandHandler(e)}}class rn{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}meetingDetails(e,t,n,i){const a=i||ke.ck.schedulingform;return this.commandHandler({entity:{type:a,action:ke.SY.view,id:e},command:t,entityOptions:n})}openCalendarSurface(e,t,n,i){return this.commandHandler({entity:{type:ke.ck.calendar,action:ke.SY.view,id:e,linkedEntity:i},command:t,entityOptions:n})}openM365CalendarSurface(e){return this.commandHandler({entity:{type:ke.ck.extensions,action:ke.SY.view,id:JSON.stringify({appId:"5966c135-e05f-4ce0-81e0-e138fe8e9583"})},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:e||A.p.Calendar}}})}openCalendarAgendaView(e,t,n){return this.commandHandler({entity:{type:ke.ck.calendar,action:ke.SY.list,linkedEntity:n},command:e,entityOptions:t})}openChannelCalendarSurface(e,t,n,i){const a={entity:{action:ke.SY.view,id:e,linkedEntity:i,type:ke.ck.channelcalendar},command:t,entityOptions:n};return this.commandHandler(a)}openSchedulingFormInMainWindow(e,t,n){return this.commandHandler({entity:{type:ke.ck.schedulingform,action:ke.SY.create,id:e},command:t,entityOptions:n})}openBroadcast(e,t,n,i){const a={type:ke.ck.broadcastliveevent,id:e,action:t};return this.extensionCommanding.executeCommand(a,{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:n}},entityOptions:i})}closeSchedulingForm(e,t,n){return this.commandHandler({entity:e,command:t,entityOptions:n})}showCalendarErrorModal(e){return this.extensionCommanding.executeCommand({type:ke.ck.calendar,action:ke.SY.error},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.CalendarEventAction}},entityOptions:e})}addBlockingConfirmationDialog(e,t){return this.extensionCommanding.addBlockingExtension({type:ke.ck.calendar,action:ke.SY.confirm},e,t)}isBlockedByCalendar(){return this.extensionCommanding.isBlockedByEntity(ke.ck.calendar)}showConfirmationDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.calendar,action:ke.SY.confirm},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.CalendarEventAction}},entityOptions:e})}showMultiMeetingsViewDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.calendarmultimeetingsviewdialog,action:ke.SY.view},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:e}}})}showShareDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.calendar,action:ke.SY.share},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.CalendarEventAction}},entityOptions:e})}showEmbedDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.calendar,action:ke.SY.info},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.CalendarEventAction}},entityOptions:e})}openConnectedCalendarDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.connectedcalendardialog,action:ke.SY.view},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.CalendarSettings}},entityOptions:e})}openConnectedCalendarSurfaceDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.connectedcalendarsurfacedialog,action:ke.SY.view},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Calendar}},entityOptions:e})}}class sn{constructor(e,t,n=void 0){this.commandHandler=e,this.extensionCommanding=t,this.userContextId=n}call(e,t){return this.commandHandler({entity:{type:ke.ck.calls,action:ke.SY.list,id:e},command:t})}callDebug(e){return this.commandHandler({entity:{type:ke.ck.calls,action:ke.SY.info},command:e})}dialPad(e){return this.commandHandler({entity:{type:ke.ck.calls,action:ke.SY.join},command:e})}callById(e,t,n,i,a){let o;return n&&(o={type:ke.ck.chats,id:n}),a&&(o={type:ke.ck.callingdeeplink,id:a}),this.commandHandler({entity:{type:i||ke.ck.calls,action:ke.SY.view,id:e,linkedEntity:o},command:t})}callStageContentById(e,t){return this.commandHandler({entity:{type:ke.ck.stagecontent,action:ke.SY.view},entityOptions:t,command:e})}callList(e){return this.commandHandler({entity:{type:ke.ck.calls,action:ke.SY.list},command:e})}extensibilityAppPickerCallingPanel(e,t,n,i){return this.commandHandler({entity:{type:ke.ck.extensibilityapppickercallingpanel,action:ke.SY.info,id:e},command:t,entityOptions:{messageId:i,conversationId:e,config:n}})}callNotification(e,t,n,i){const a=e.entityOptions;return a.targetEntity.dataOptions.userContextId=this.userContextId,a.telemetryClientId=n,a.buttons?.forEach((e=>{e.targetEntity.dataOptions.userContextId=this.userContextId})),a.timeoutEntity&&a.timeoutEntity.dataOptions&&(a.timeoutEntity.dataOptions.userContextId=this.userContextId),"Hide"===i?this.commandHandler({entity:{id:t,action:ke.SY.view,type:ke.ck.toasts},command:{correlation:{id:n,source:A.p.Calling},stateTransition:g.Ar.new,visibilityState:g.Rp.hide},entityOptions:a}):this.commandHandler({entity:{action:ke.SY.view,type:ke.ck.toasts,id:t},command:e.command,entityOptions:a})}callDeeplinkDialog(e){return this.commandHandler({entity:{type:ke.ck.callingdeeplinkDialog,action:ke.SY.view},command:e})}createById(e,t,n,i){return this.commandHandler({entity:{id:e,type:t,action:ke.SY.create},command:n,windowOptions:i})}callMonitorById(e,t,n){return this.commandHandler({entity:{type:ke.ck.callsmonitor,action:ke.SY.view},entityOptions:e&&{callingIntentId:e},command:t,windowOptions:n})}callShareMeetingInviteDialogById(e,t,n){return this.extensionCommanding.executeCommand(e,{entityOptions:t,entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:n}}})}contentCameraSetupDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.contentcamerasetup,action:ke.SY.create},{entityOptions:t,entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:n}}})}startMeetingStream(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.meetingstream,action:ke.SY.create},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:e}},entityOptions:t})}stagingRoomStartMeetingConfirmationDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.stagingroomstartmeetingconfirmationdialog,action:ke.SY.create},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:t}},entityOptions:n})}stagingRoomEndMeetingConfirmationDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.stagingroomendmeetingconfirmationdialog,action:ke.SY.create},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:e}},entityOptions:t})}openDialog(e,t,n,i){if(!e.id)throw new Error("[openDialog] entity.id is required");return i?this.commandHandler({entity:{id:e.id,type:ke.ck.callingdialog,action:ke.SY.create},entityOptions:{entity:e,command:t,options:n},command:{...t,...i}}):(this.extensionCommanding.executeCommand({id:e.id,type:ke.ck.callingdialog,action:ke.SY.create},{entityCommand:t,entityOptions:{entity:e,command:t,options:n}}),Promise.resolve())}callableChannelById(e,t,n){return this.commandHandler({entity:{id:t,type:ke.ck.callablechannels,action:ke.SY.list,linkedEntity:{id:e,type:ke.ck.channels,action:ke.SY.view}},command:n})}closedCaptionsFlyoutById(e,t){return this.commandHandler({entity:{type:ke.ck.closedcaptionsflyout,action:ke.SY.view},entityOptions:e&&{callingIntentId:e},command:t})}openCopilotInRecap(e,t,n){return this.commandHandler({entity:{type:ke.ck.meetingcollaboration,action:ke.SY.view,id:e.callId||e.threadId||t,linkedEntity:{type:ke.ck.meetingrecap,id:e.threadId}},entityOptions:e,command:n})}presenterToolbarById(e,t,n){return this.commandHandler({entity:{type:ke.ck.presentertoolbar,action:ke.SY.view},entityOptions:{callingIntentId:t,teamsCallId:e},command:n})}floatingUfdById(e,t,n){return this.commandHandler({entity:{type:ke.ck.floatingufd,action:ke.SY.view},entityOptions:{callingIntentId:e,teamsCallId:t},command:n})}pstnCallMeDialogToggle(e,t,n){return this.extensionCommanding.executeCommand(e,{entityOptions:n,entityCommand:t})}openStageCustomizationPanel(e,t){return this.commandHandler({entity:{type:ke.ck.stagecustomizationpanel,action:ke.SY.view},entityOptions:{teamsCallId:e},command:t})}openBYODAttendeeView(e,t){return this.commandHandler({entity:{type:ke.ck.byodattendeewindow,action:ke.SY.view,id:t?.intentId},entityOptions:t,command:e})}}class ln{constructor(e){this.commandHandler=e}callList(e,t){return this.commandHandler({entity:{id:e,type:ke.ck.callsmain,action:ke.SY.view},command:t})}contactList(e,t){return this.commandHandler({entity:{type:ke.ck.callsmain,action:ke.SY.list},command:e,entityOptions:t?.entityOptions,scenarioEventData:t?.scenarioEventData})}peopleAppAsContacts(e,t){return this.commandHandler({entity:{type:ke.ck.peopleapp,action:ke.SY.view},command:e,scenarioEventData:t?.scenarioEventData})}}class cn{constructor(e){this.commandHandler=e}async navigateById(e,t){return this.commandHandler({entity:{type:ke.ck.campaignnotifications,action:ke.SY.view,id:e},entityOptions:t?.entityOptions,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData})}}class dn{constructor(e){this.commandHandler=e}viewCaptchaChallenge(e){const t={id:(0,E.v4)(),source:A.p.CaptchaChallenge,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.captchachallenge,action:ke.SY.view},command:{correlation:t,stateTransition:g.Ar.extend,visibilityState:g.Rp.show},entityOptions:{arkoseCaptchaToken:e}})}closeCaptchaChallenge(){const e={id:(0,E.v4)(),source:A.p.CaptchaChallenge,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.captchachallenge,action:ke.SY.view},command:{correlation:e,visibilityState:g.Rp.hide,stateTransition:g.Ar.flush}})}}class un{constructor(e){this.commandHandler=e}launch(e){return this.commandHandler({entity:{type:ke.ck.cast,action:ke.SY.view},command:e})}}class mn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}default(e=this.getDefaultEntityCommand(A.p.Unknown)){return this.commandHandler({entity:{type:ke.ck.channels,action:ke.SY.default},command:e})}channelDeeplinkWithMessageId(e,t,n){return this.commandHandler({entity:{type:ke.ck.channels,action:ke.SY.view,id:e},command:t,entityOptions:n})}channelMessagesById(e,t){const n={channelId:e,replyChainId:t?.replyChainId};return this.commandHandler({entity:{type:ke.ck.channels,action:ke.SY.view,id:JSON.stringify(n)},command:t.entityCommand,entityOptions:{...t.entityOptions,deepLinkId:t.deepLinkId,pinned:t.pinned,parentTeamId:t.parentTeamId??t.entityOptions?.parentTeamId,source:t.entityCommand?.correlation?.source},scenarioEventData:t.extendedOptions?.scenarioEventData})}showDefaultNavigationDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.defaultchannelnavdialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}showJoinTeamDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.teamjoindialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchCrossPostChannelSelectionDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.crosspostchannelselectiondialog,action:ke.SY.view},{entityCommand:this.getDefaultEntityCommand(t,g.Ar.extend),entityOptions:{selectedChannelIds:e}})}launchCrossPostChannelSelectionDialogV2(e,t,n){return this.extensionCommanding.executeCommand({type:ke.ck.crosspostchannelselectiondialogV2,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:n}},entityOptions:{selectedChannelIds:e,currentChannelId:t}})}launchAppEnableDialogOnSendMessage(e,t,n,i,a,o,r,s){return this.extensionCommanding.executeCommand({type:ke.ck.appenabledialog,action:ke.SY.view},{entityCommand:i,entityOptions:{appId:e,channelType:o,channelId:t,context:n,scope:a,callerInfo:r,appCapability:s}})}openChannelCopilotFromL1View(e,t){return this.commandHandler({entity:{type:ke.ck.channels,action:ke.SY.view,id:e},command:t.entityCommand,entityOptions:{...t.entityOptions,channelCopilotOpen:!0,source:t.entityCommand.correlation?.source}})}launchCrossPostDeleteDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.crosspostdeletedialog,action:ke.SY.view},{entityCommand:this.getDefaultEntityCommand(t,g.Ar.extend),entityOptions:e})}launchSharedChannelsPastePermissionsFluid(e){return this.extensionCommanding.executeCommand({type:ke.ck.fluid,action:ke.SY.info},{entityCommand:e})}getDefaultEntityCommand(e,t=g.Ar.flush){return{stateTransition:t,visibilityState:g.Rp.show,correlation:{source:e}}}}var pn=n(501790);class gn{constructor(e,t,n,i){this.commandHandler=e,this.extensionCommanding=t,this.coreSettings=n,this._logger=i.newLogger("ChatCommandingService","core-services-entity-commanding")}default(e){return this.handleCommandWithChecks({entity:{type:ke.ck.chats,action:ke.SY.default},command:e})}empty(e){return this.handleCommandWithChecks({entity:{type:ke.ck.chats,action:ke.SY.empty},command:e})}chatList(e,t){return this.handleCommandWithChecks({entity:{type:ke.ck.chats,action:ke.SY.list},entityOptions:t?.entityOptions,command:e})}chatRequests(...e){const t=this.getChatRequestByIdCommand(...e);return this.commandHandler(t)}getChatByIdCommand(e,t,n){const{enableThreadingInChat:i}=this.coreSettings.get(c.w.Messaging),a=t?.replyChainId,o=t?.entityOptions?.messageId,r=t?.entityOptions?.replyChainId,s=t?.entityCommand?.correlation?.source,l=this.getShouldNavigateToChatSidePane(s,a,o),d=n&&t?.entityOptions?.isByodPoppedOut?{type:ke.ck.calls,id:n}:null,u=l?a:"",m=t?.entityOptions&&{...t?.entityOptions,replyChainId:i&&r&&r!==o?r:void 0},p={entity:{type:l?ke.ck.chatthread:ke.ck.chats,action:l?ke.SY.info:ke.SY.view,id:u?`${e};replyChainId=${u}`:e,linkedEntity:d},entityOptions:m,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData};return this.checkPolicies(p),p}getChatRequestByIdCommand(e,t,n){const i={entity:{type:ke.ck.chatrequests,action:ke.SY.view,id:e,linkedEntity:null},entityOptions:t?.entityOptions,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData};return this.checkPolicies(i),i}holisticRecap(e){return this.handleCommandWithChecks({command:e,entity:{type:ke.ck.holisticrecap,action:ke.SY.view}})}chatById(...e){const t=this.getChatByIdCommand(...e);return this.commandHandler(t)}chatRequestById(...e){const t=this.getChatRequestByIdCommand(...e);return this.commandHandler(t)}byodChatById(...e){const t=this.getByodChatByIdCommand(...e);return this.commandHandler(t)}chatWithUsers(e){const t=(0,pn.Xp)(e?.userIds||[],e?.entityCommand);return this.handleCommandWithChecks({...t,entityOptions:e?.entityOptions})}chatWithGuardians(e,t,n,i,a,o){const r=(0,pn.Xp)(t||[],o),s={groupName:n,isGuardiansChat:!0,guardiansChatGroupId:e,guardiansChatStudentId:i,guardiansPreferredToAlternateMriMappings:a};return this.handleCommandWithChecks({...r,entityOptions:s})}orgChat(e,t){return this.handleCommandWithChecks({entity:{type:ke.ck.extensions,action:ke.SY.view,id:g.F1.organization,linkedEntity:{type:ke.ck.chats,id:(0,pn.AX)([e])}},command:t})}linkedIn(e,t){return this.handleCommandWithChecks({entity:{type:ke.ck.extensions,action:ke.SY.view,id:g.F1.linkedin,linkedEntity:{type:ke.ck.chats,id:(0,pn.AX)([e])}},command:t})}openLpcInMainWindow(e,t){return this.commandHandler({entity:{type:ke.ck.livepersonacard,action:ke.SY.view},command:t,entityOptions:e})}launchAltText(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.alttext,action:ke.SY.view},{entityCommand:t,entityOptions:{element:e}})}launchAddNewComponentFluid(e){return this.extensionCommanding.executeCommand({type:ke.ck.fluid,action:ke.SY.confirm},{entityCommand:e})}launchInsertHyperlink(e,t,n){return this.extensionCommanding.executeCommand({type:ke.ck.hyperlink,action:ke.SY.view},{entityCommand:n,entityOptions:{displayText:e,address:t}})}launchDiscardCodeSnippet(e){return this.extensionCommanding.executeCommand({type:ke.ck.codesnippet,action:ke.SY.delete},{entityCommand:e})}launchTranslationFeedbackDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.translationfeedback,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchTwoWaySmsFriendlyNameDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.twowaysmsfriendlyname,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchDeleteChat(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.deletechat,action:ke.SY.delete},{entityCommand:t,entityOptions:e})}launchDiscardFluid(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.fluid,action:ke.SY.delete},{entityCommand:t,entityOptions:{isCompose:e}})}launchPastePermissionsFluid(e,t,n,i,a){return this.extensionCommanding.executeCommand({type:ke.ck.fluid,action:ke.SY.manage},{entityCommand:a,entityOptions:{displayTitle:e,displayText:t,cancelButtonContent:n,confirmButtonContent:i}})}launchUpdatePermissionsFluid(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.fluid,action:ke.SY.update},{entityCommand:t,entityOptions:{recipientList:e}})}launchUnpinMessageFromChat(e){return this.extensionCommanding.executeCommand({type:ke.ck.pinnedconversationitems,action:ke.SY.delete},{entityCommand:e})}launchReplaceMessageFromChat(e){return this.extensionCommanding.executeCommand({type:ke.ck.pinnedconversationitems,action:ke.SY.update},{entityCommand:e})}launchDiscardMessageDraft(e,t,n,i){return this.extensionCommanding.executeCommand({type:ke.ck.messagedraft,action:ke.SY.delete},{entityCommand:i,entityOptions:{isBranded:e,workload:t,isEditing:n}})}launchGiphyConsent(e){return this.extensionCommanding.executeCommand({type:ke.ck.giphyconsent,action:ke.SY.view},{entityCommand:e})}launchLeaveChat(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.leavechat,action:ke.SY.delete},{entityCommand:e,entityOptions:t})}launchChatInviteConfirmation(e){return this.extensionCommanding.executeCommand({type:ke.ck.chatInviteConfirmation,action:ke.SY.view},{entityCommand:e})}launchMaxPinnedChatsReached(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.pinnedchatsmaxreached,action:ke.SY.view},{entityCommand:t,entityOptions:{maxPinnedChats:e}})}launchUpdateGroupChatAvatar(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.updategroupchatavatar,action:ke.SY.view},{entityCommand:t,entityOptions:{threadId:e}})}launchTfwUpdateGroupChatAvatar(e,t,n){return this.extensionCommanding.executeCommand({type:ke.ck.tfwupdategroupchatavatar,action:ke.SY.view},{entityCommand:n,entityOptions:{threadId:e,avatarUrl:t}})}launchRemoveChatUser(e,t,n,i,a){return this.extensionCommanding.executeCommand({type:ke.ck.removechatuser,action:ke.SY.delete},{entityCommand:a,entityOptions:{userName:e,isRemoveTfwUserInTflChat:t,isRemoveGroupCopilot:n,isRemoveBot:i}})}launchShareChatLink(e,t,n,i,a,o,r,s){return this.extensionCommanding.executeCommand({action:ke.SY.view,id:e,type:ke.ck.sharechatlink},{entityCommand:s,entityOptions:{chatTitle:t,tenantId:n,hasError:i,sharedLink:a,cfet:o,panelType:r}})}launchChatError(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.chats,action:ke.SY.error},{entityCommand:t})}launchStreamCamera(e){return this.extensionCommanding.executeCommand({type:ke.ck.streamcamera,action:ke.SY.default,id:e?.correlation.id},{entityCommand:e})}launchStreamCameraInChannels(e){return this.extensionCommanding.executeCommand({type:ke.ck.streamcamerainchannels,action:ke.SY.default,id:e?.correlation.id},{entityCommand:e})}launchMaxPinnedMesssagesReachedDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.chatmaxmultiplepinnedmessages,action:ke.SY.view},{entityCommand:e})}launchStreamCameraInCommunities(e){return this.extensionCommanding.executeCommand({type:ke.ck.streamcameraincommunities,action:ke.SY.default,id:e?.correlation.id},{entityCommand:e})}meetingRecapTab(e,t,n){return this.handleCommandWithChecks({entity:{type:n||ke.ck.meetingrecaptab,action:ke.SY.view,id:e.threadId},command:t,entityOptions:e})}transcriptTab(e,t,n,i,a,o,r,s,l,c,d,u){return this.handleCommandWithChecks({entity:{type:ke.ck.transcripttab,action:ke.SY.view,id:t},entityOptions:{conversationId:e,storageId:n,teamsCallId:i,meetingOrganizerId:a,meetingTenantId:o,eventId:r,isOdspTranscript:s,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u}})}launchReportConcern(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.reportConcern,action:ke.SY.create},{entityCommand:t,entityOptions:e})}launchForwardMessage(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.forwardMessage,action:ke.SY.create},{entityCommand:t,entityOptions:e})}launchFilesQuickShare(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.filesQuickShare,action:ke.SY.create},{entityCommand:t,entityOptions:e})}launchReportConcernV2(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.reportConcernForTFW,action:ke.SY.create},{entityCommand:t,entityOptions:e})}launchReportConcernTY(e){return this.extensionCommanding.executeCommand({type:ke.ck.reportConcern,action:ke.SY.info},{entityCommand:e})}launchReportConcernV2Confirmation(e){return this.extensionCommanding.executeCommand({type:ke.ck.reportConcernForTFW,action:ke.SY.info},{entityCommand:e})}launchDlpDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.dlp,action:ke.SY.view},{entityCommand:t,entityOptions:e})}manage(e,t){return this.handleCommandWithChecks({entity:{type:ke.ck.chatManageApps,action:ke.SY.manage,id:e,linkedEntity:{type:ke.ck.chats,id:e,action:ke.SY.list}},command:t})}launchBlockChatDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.blockChat,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchMultiStepAcceptChatDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.multiStepAcceptChat,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchLeaveGroupAndBlockUserDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.leaveGroupAndBlockUser,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchCustomizeReactions(e){return this.extensionCommanding.executeCommand({type:ke.ck.customizereactions,action:ke.SY.view},{entityCommand:e})}launchCustomEmojiUpload(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.customemojiupload,action:ke.SY.view},{entityCommand:t,entityOptions:{blobUrl:e}})}launchReportUserDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.reportuser,action:ke.SY.create},{entityCommand:t,entityOptions:{contactMri:e}})}launchAppEnableDialogInChat(e,t,n,i,a){return this.extensionCommanding.executeCommand({type:ke.ck.chatappenabledialog,action:ke.SY.view},{entityCommand:i,entityOptions:{appId:e,chatId:t,context:n,scope:a}})}handleCommandWithChecks(e){return this.checkPolicies(e),this.commandHandler(e)}checkPolicies(e){if(this.coreSettings.get(c.w.Messaging).allowUserChat||e.entity.id?.startsWith("19:meeting"))return;const{type:t,action:n}=e.entity,i=`${d.Ir.Commanding}::${d.O4.PolicyCheckFailed}::Chat command not allowed due to policy (allowUserChat=false)`;this._logger.errorToTelemetry?.(i,"messaging_command_policy_violation",{mainEntityType:t,mainEntityAction:n})}getByodChatByIdCommand(e,t,n){const i={entity:{type:ke.ck.byodchat,action:ke.SY.view,id:e,linkedEntity:{type:ke.ck.byodattendeewindow,id:n||""}},entityOptions:t?.entityOptions,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData};return this.checkPolicies(i),i}getShouldNavigateToChatSidePane(e,t,n){const{enableThreadingInChat:i}=this.coreSettings.get(c.w.Messaging);return!(!i||!t||!n)&&(e===A.p.ChatQuotedReply||t!==n)}}class hn{constructor(e){this.commandHandler=e}coachReport(e,t){return this.commandHandler({entity:{type:ke.ck.coachreport,action:ke.SY.view,linkedEntity:{type:ke.ck.chats,id:t?t.threadId:""}},command:e,entityOptions:t})}}class vn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}showAddMemberDialog(e,t,n){const i=n??{};return this.commandHandler({entity:{id:e,type:ke.ck.communitiesaddmember,action:ke.SY.view},entityOptions:{...i,source:t?.correlation?.source},command:t})}showCreateChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:ke.ck.communitiescreatechannel,action:ke.SY.view},entityOptions:{},command:t})}showEditChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:ke.ck.communitieseditchannel,action:ke.SY.view},entityOptions:{},command:t})}showDeleteChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:ke.ck.communitiesdeletechannel,action:ke.SY.view},entityOptions:{},command:t})}showCommunityLinkDialog(e,t,n){const i=n??{};return this.commandHandler({entity:{action:ke.SY.view,id:e,type:ke.ck.sharecommunitieslink},entityOptions:{...i,source:t?.correlation?.source},command:t})}showEmbedCommunityCodeDialog(e,t){return this.commandHandler({entity:{action:ke.SY.view,id:e,type:ke.ck.embedcommunitycodedialog},entityOptions:{},command:t})}showCommunityGuidelinesDialog(e,t){return this.commandHandler({entity:{action:ke.SY.view,id:e,type:ke.ck.communitiesguidelinesdialog},entityOptions:{},command:t})}showCommunityGetAppDialog(e){return this.commandHandler({entity:{action:ke.SY.view,type:ke.ck.communitiesgetappdialog},entityOptions:{},command:e})}showCommunitiesCreateDialog(e,t){return this.commandHandler({entity:{action:ke.SY.view,type:ke.ck.communitiescreatedialog},entityOptions:{templateId:t},command:e})}showCommunitiesEditDialog(e,t){return this.commandHandler({entity:{action:ke.SY.view,type:ke.ck.communitieseditdialog,id:e},entityOptions:{},command:t})}showReportConcernDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.reportconcerncommunities,action:ke.SY.create},{entityOptions:{source:t?.correlation?.source},entityCommand:t})}showRemoveMemberDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.communitiesremovemember,action:ke.SY.view},{entityOptions:{...t,source:n?.correlation?.source},entityCommand:n})}showNicknameDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.communitiesnickname,action:ke.SY.view},{entityOptions:{...t},entityCommand:n})}showCommunitiesWebsiteLinkDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.communitieswebsitelink,id:e,action:ke.SY.view},{entityOptions:{...t},entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.CommunitiesWebsiteLinkDialog}}})}showReportConcernTY(e,t){return this.commandHandler({entity:{type:ke.ck.reportconcerncommunities,action:ke.SY.view,id:e},entityOptions:{},command:t})}showSendPostAsEmailDialog(e,t){return this.commandHandler({entity:{type:ke.ck.communitiessendpostasemaildialog,action:ke.SY.view,id:e},entityOptions:{},command:t})}showWelcomeBotConfigDialog(e,t){return this.commandHandler({entity:{type:ke.ck.communitieswelcomebotconfigdialog,action:ke.SY.view,id:e},entityOptions:{},command:t})}showLeaveCommunityDialog(e,t){return this.commandHandler({entity:{id:e,type:ke.ck.leavecommunity,action:ke.SY.view},entityOptions:{},command:t})}showOwnerLeaveCommunityDialog(e,t){return this.commandHandler({entity:{id:e,type:ke.ck.ownerleavecommunity,action:ke.SY.view},entityOptions:{},command:t})}openDialog(e,t,n,i){return this.commandHandler({entity:{id:t,type:e,action:i??ke.SY.view},entityOptions:{},command:n})}communityMessagesById(e,t,n,i,a,o,r,s){const l={channelId:e,replyChainId:n},c=a?.correlation?.source||A.p.Unknown;return[A.p.ActivityFeed,A.p.ActivityFeedBellClick].includes(c)||(localStorage.setItem("communities-selected-id",e),localStorage.setItem("is-last-visited-community-general",t.toString()),localStorage.setItem("communities-selected-reply-id",n||"")),this.commandHandler({entity:{type:ke.ck.communities,action:s??ke.SY.view,id:JSON.stringify(l)},command:a,entityOptions:{...o,source:a?.correlation.source,deepLinkId:i,isThreadTypeCommunity:t},scenarioEventData:r?.scenarioEventData})}getCommunityEvents(e,t){return this.commandHandler({entity:{type:ke.ck.communitiesevents,action:ke.SY.view,id:JSON.stringify({channelId:e})},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.CommunitiesEventsButton},...t}})}showCreateCommunityEvent(e){const t={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.CommunitiesCreateEventButton}};return this.commandHandler({entity:{type:ke.ck.communitiescreateevent,action:ke.SY.view,id:JSON.stringify({channelId:e})},command:t,entityOptions:{isGroup:!0,conversationId:e}})}getOnboardingView(e,t,n,i){return this.getView(ke.ck.communitiesonboarding,e??ke.SY.view,t,n,A.p.CommunitiesOnboarding,i)}getCommunitiesJoinView(e,t,n,i,a,o){const r={channelId:e,replyChainId:t},s=e?JSON.stringify(r):void 0;return this.commandHandler({entity:{type:a??ke.ck.communities,action:ke.SY.join,id:s},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:o||A.p.CommunitiesInviteLink}},entityOptions:{messageId:t,inviteLinkUrl:n,source:o,deepLinkId:i??(0,E.v4)()}})}navigateToCommunityId(e,t,n,i,a,o){const r={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:i||A.p.Unknown}};return this.communityMessagesById(e,t,a,void 0,r,o?{enqueSwitch:!0}:void 0,void 0,n?ke.SY.default:void 0)}showCommunitiesManage(e,t,n,i){localStorage.setItem("current-enitity-type",ke.ck.communitiesmembers);const a=n?.source||t?.correlation?.source||A.p.CommunitiesManage;return this.commandHandler({entity:{type:ke.ck.communitiesmembers,action:ke.SY.view,id:e},entityOptions:{...n,source:a},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:a},...t},scenarioEventData:i?.scenarioEventData})}showCommunitiesBlockMembers(e,t){return this.commandHandler({entity:{type:ke.ck.communitiesblockmembers,action:ke.SY.view,id:e},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:t?.correlation?.source||A.p.CommunitiesManage},...t}})}showCommunitiesSettings(e,t){return localStorage.setItem("current-enitity-type",ke.ck.communitiessettings),this.commandHandler({entity:{type:ke.ck.communitiessettings,action:ke.SY.view,id:e},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.CommunitiesManageLink},...t}})}showCommunitiesManageMemberRequests(e,t,n,i){const a=n?.source||t?.correlation?.source||A.p.CommunitiesManage;return this.commandHandler({entity:{type:ke.ck.communitiesjoinrequest,action:ke.SY.view,id:e},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:a},...t},entityOptions:{...n,source:a},scenarioEventData:i?.scenarioEventData})}showCommunityJoinView(e,t,n,i,a){return this.commandHandler({entity:{type:ke.ck.communitiesjoininviteview,action:ke.SY.join,id:e},command:t,entityOptions:{...n,activityId:a,deepLinkId:a??(0,E.v4)()},scenarioEventData:i?.scenarioEventData})}showPerCommunityNotificationSettingsDialog(e,t){return this.commandHandler({entity:{action:ke.SY.view,id:e,type:ke.ck.percommunitynotificationsettingsdialog},entityOptions:{},command:t})}showCommunityDeleteReplyChainDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.communitiesreplychain,action:ke.SY.delete},{entityOptions:{...e},entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.CommunitiesDeleteReplyChainDialogButton}}})}toggleCommunitiesCopilotView(e,t,n){return this.commandHandler({entity:{type:n,action:ke.SY.info,id:e,linkedEntity:{id:e,type:ke.ck.communities}},command:t,entityOptions:{source:A.p.CommunitiesCopilot}})}showCommunitiesGallery(e,t){return this.commandHandler({entity:{type:ke.ck.communitiesgallery,action:ke.SY.view,id:e},command:t})}showCommunitiesFiles(e,t){return this.commandHandler({entity:{type:ke.ck.communitiesfiles,action:ke.SY.view,id:e},command:t})}showFeatureCommunityApplicationDialog(e,t,n){const i=t?.correlation?.source||A.p.FeatureCommunityApplicationButton;return this.commandHandler({entity:{action:ke.SY.view,id:e,type:ke.ck.featurecommunityapplicationdialog},entityOptions:{...n,source:i},command:t})}showCommunitiesExplore(e){return localStorage.setItem("current-enitity-type",ke.ck.communitiesexplore),localStorage.setItem("communities-selected-id",""),this.commandHandler({entity:{type:ke.ck.communitiesexplore,action:ke.SY.view},command:e})}showCommunitiesJoinViewForCommunitiesInvitesList(e){localStorage.setItem("communities-selected-id",e),localStorage.setItem("communities-selected-reply-id","");const t={channelId:e,replyChainId:""},n={deepLinkId:(0,E.v4)(),source:A.p.CommunitiesPendingInvitesList},i={command:{correlation:{source:A.p.CommunitiesPendingInvitesList},stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.show},entity:{action:ke.SY.join,id:JSON.stringify(t),type:ke.ck.communitiespendinginvite},entityOptions:n};return this.commandHandler(i)}showPinnedPostsConfirmDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.communitiespinnedposts,action:ke.SY.confirm},{entityOptions:{isPinned:e},entityCommand:t})}getView(e,t,n,i,a,o,r){const s={channelId:r,replyChainId:o},l=r?JSON.stringify(s):void 0;return this.commandHandler({entity:{id:l,type:e,action:t??ke.SY.default},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:a||A.p.ChannelListItem}},...t===ke.SY.join||t===ke.SY.update?{entityOptions:{inviteLinkUrl:n,messageId:o,deepLinkId:i??(0,E.v4)()}}:{}})}}class yn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}openContactsSyncPopout(e){return this.commandHandler({entity:{type:ke.ck.contactssync,action:ke.SY.default,id:"default"},command:e?.entityCommand||{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{source:A.p.Flyout}},windowOptions:e?.windowOptions})}openContactsSyncModal(){return this.extensionCommanding.executeCommand({type:ke.ck.contactssync,action:ke.SY.view,id:"default"})}launchContactsModal(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.contactssync,action:ke.SY.info,id:e},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:t}})}showHideContactsView(e,t,n){return this.commandHandler({entity:{type:ke.ck.contactssync,action:ke.SY.view,id:e},command:{stateTransition:g.Ar.flush,visibilityState:n?g.Rp.show:g.Rp.hide,correlation:t}})}}class Sn{constructor(e){this.commandHandler=e}discoverApps(e,t){return this.commandHandler({entity:{type:ke.ck.discoverappsnotifications,action:ke.SY.view},command:t,entityOptions:e})}}class fn{constructor(e,t){this.commandHandler=e,this.loggerFactory=t,this.logger=this.loggerFactory.newLogger("DiscoverSurfaceCommandingService","core-services-entity-commanding")}showDiscoverSurface(e){return this.logger.log(`showDiscoverSurface: called with - ${ke.ck.discoversurface}:${ke.SY.view}`),this.commandHandler({entity:{type:ke.ck.discoversurface,action:ke.SY.view},command:e?.entityCommand,entityOptions:e?.entityOptions})}showDiscoverSurfaceSettings(e){return this.logger.log(`showDiscoverSurfaceSettings: called with - ${ke.ck.discoversurface}:${ke.SY.view}`),this.commandHandler({entity:{type:ke.ck.discoversurfacesettings,action:ke.SY.view},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:e?.commandSource??A.p.DiscoverSurfaceHeader}},entityOptions:e?.entityOptions})}}class kn{constructor(e){this.commandHandler=e}launchErrorApp(e){return this.commandHandler({entity:{type:ke.ck.error,action:ke.SY.view},command:{stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.show,correlation:{source:A.p.LayoutError}},entityOptions:{errorReason:e.code}})}}class Cn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t,this.entityAllowList=[ke.ck.esp,ke.ck.esppinteamstotaskbar,ke.ck.help,ke.ck.premiumtrialdialogesp,ke.ck.storefre,ke.ck.whatsnewdialog]}displaySurface(e,t,n,i){return this.commandHandler({entity:{type:ke.ck.esp,action:ke.SY.create,id:e},entityOptions:{forceShow:t,customParams:n,windowId:i}})}displayFollowUpSurface(e,t){return this.commandHandler({entity:{type:ke.ck.esp,action:ke.SY.create,id:e},entityOptions:{forceShow:t,espTrigger:"FollowUp"}})}launchDialog(e,t){let n=ke.ck.esp;if(t){if(!this.entityAllowList.includes(t))throw new Error("launchDialog must be called with Entity from the allow list.");n=t}return this.extensionCommanding.executeCommand({id:e,type:n,action:ke.SY.view})}closeDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:t??ke.ck.esp,action:ke.SY.view},{entityCommand:{visibilityState:g.Rp.hide,stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding}}})}navigate(e,t,n){return this.commandHandler({entity:e,command:t,entityOptions:n})}}class bn{constructor(e){this.commandHandler=e}async acquireExploratoryLicense(e){return this.commandHandler({entity:{type:ke.ck.exploratorylicense,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:e}}})}async licenseAcquirementFailed(e,t){return this.commandHandler({entity:{type:ke.ck.exploratorylicense,action:ke.SY.error},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:e}},entityOptions:t})}}class wn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}surveyDialogWithObserver(e,t,n){const i={...n,source:t?.correlation?.source,entityStateTransition:t?.stateTransition};return this.extensionCommanding.executeCommand({action:ke.SY.view,type:ke.ck.survey,id:e},{entityCommand:t,entityOptions:i})}surveyDialog(e,t,n){const i={...n,source:t?.correlation?.source,entityStateTransition:t?.stateTransition};return this.commandHandler({entity:{type:ke.ck.survey,action:ke.SY.view,id:e},command:t,entityOptions:i})}giveFeedbackDialog(e){return this.commandHandler({entity:{type:ke.ck.givefeedbackchoices,action:ke.SY.view},command:e})}}class Tn{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}galleryImage(e,t){const n=e.galleryId,i={type:ke.ck.galleryImages,action:ke.SY.view,id:n};return this.commandHandler({entity:i,command:t,entityOptions:e})}galleryImageExtended(e,t){const n=e.galleryId,i={type:ke.ck.galleryImages,action:ke.SY.view,id:n};return this.extensionCommanding.executeCommand(i,{entityCommand:t,entityOptions:e})}fileById(e){const t=e.fileId;return this.commandHandler({entity:{type:ke.ck.file,action:ke.SY.view,id:t},entityOptions:e})}launchFileViewApp(e,t,n=A.p.FileViewer){const i={subEntityId:JSON.stringify(t)};return this.commandHandler({entity:{type:ke.ck.extensions,action:ke.SY.view,id:JSON.stringify({appId:e,fileId:t.fileId.toLowerCase()}),linkedEntity:{id:JSON.stringify(i),type:ke.ck.extensions}},command:{visibilityState:g.Rp.show,stateTransition:t.shouldOpenInMultiWindow?g.Ar.new:g.Ar.flush,correlation:{source:n}},entityOptions:{entryPoint:"personalApp"}})}openInOneup(e,t=A.p.FileViewer){const n=e.fileId;let i,a;switch(e.context){case"channelsPDFTab":{const t={channelId:e.threadId,replyChainId:void 0};a={type:ke.ck.filesoneupviewer,action:ke.SY.view,id:e.entityId,linkedEntity:{id:JSON.stringify(t),type:ke.ck.channels}},i=A.p.ChannelHeader;break}case"chatPDFTab":a={type:ke.ck.filesoneupviewer,action:ke.SY.view,id:e.entityId,linkedEntity:{id:e.threadId?e.threadId:"",type:ke.ck.chats}},i=A.p.ChatHeader;break;case"ChannelMakeAsATab":{const t={channelId:e.threadId,replyChainId:void 0};a={type:ke.ck.extensions,action:ke.SY.view,id:e.entityId,linkedEntity:{id:JSON.stringify(t),type:ke.ck.channels}},i=A.p.ChannelHeader;break}default:a={type:ke.ck.filesoneupviewer,action:ke.SY.view,id:n},i=t}return this.commandHandler({entity:a,command:{visibilityState:g.Rp.show,stateTransition:e.shouldOpenInMultiWindow?g.Ar.new:g.Ar.flush,correlation:{id:(0,E.v4)(),source:i}},entityOptions:e})}closeOneup(e,t=A.p.FileViewer){return this.commandHandler({entity:{type:ke.ck.filesoneupviewer,action:ke.SY.view,id:e},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.flush,correlation:{source:t}}})}fileOpenSettingsSuggestion(e){return this.commandHandler({entity:{type:ke.ck.fileopensettings,action:ke.SY.info},entityOptions:e})}fileOpenSettingsUpdate(e){return this.commandHandler({entity:{type:ke.ck.fileopensettings,action:ke.SY.update},entityOptions:e})}fileOpenSettingsUpdateV2(e,t){return this.commandHandler({entity:{type:ke.ck.fileopensettings,action:ke.SY.update},entityOptions:e,command:t})}chatFilesList(e,t,n){return this.commandHandler({entity:{id:null,type:ke.ck.file,action:ke.SY.list,linkedEntity:n??{type:ke.ck.chats,action:ke.SY.view,id:e}},command:t})}photosList(e,t){return this.commandHandler({entity:{id:null,type:ke.ck.gallery,action:ke.SY.view,linkedEntity:{type:ke.ck.chats,id:e}},command:t})}launchFilePicker(e,t,n,i){return this.extensionCommanding.executeCommand({type:ke.ck.filepicker,action:ke.SY.view},{entityCommand:n,entityOptions:{fileContainerKey:e,filePickerContext:t,filePickerConfigurationOverrides:i}})}launchCloudStorageDialog(e,t,n){return this.extensionCommanding.executeCommand({type:ke.ck.cloudStorageDialog,action:ke.SY.view},{entityCommand:n,entityOptions:{isClassMaterialRequired:e,channelId:t}})}launchFloraFreDialogApp(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.florafredialog,action:ke.SY.view},{entityCommand:t,entityOptions:{currentFloraFileOpenPreference:e}})}}class In{constructor(e){this.commandHandler=e}launchFlyoutHomePage(){const e={id:(0,E.v4)(),source:A.p.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.flyout,action:ke.SY.default},command:{correlation:e,stateTransition:g.Ar.flush,visibilityState:g.Rp.show,layoutMode:Yt.Rm.minimal}})}showPhonelinkPairingPage(e){const t={id:(0,E.v4)(),source:A.p.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{id:e,type:ke.ck.flyoutphonelink,action:ke.SY.default},command:{correlation:t,stateTransition:g.Ar.flush,visibilityState:g.Rp.show,layoutMode:Yt.Rm.minimal}})}showFlyoutWhatsNew(){const e={id:(0,E.v4)(),source:A.p.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.flyoutwhatsnew,action:ke.SY.default},command:{correlation:e,stateTransition:g.Ar.flush,visibilityState:g.Rp.show,layoutMode:Yt.Rm.minimal}})}openMinimodeMeetingScheduler(){const e={id:(0,E.v4)(),source:A.p.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.minimodeMeetingScheduler,action:ke.SY.view},command:{correlation:e,stateTransition:g.Ar.new,visibilityState:g.Rp.show}})}closeMinimodeMeetingScheduler(){const e={id:(0,E.v4)(),source:A.p.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.minimodeMeetingScheduler,action:ke.SY.view},command:{correlation:e,visibilityState:g.Rp.hide,stateTransition:g.Ar.forceFlush}})}}class Nn{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}guardiansTabInChannelById(e,t,n,i){const a={type:ke.ck.guardians,action:ke.SY.list,id:e,linkedEntity:n};return this.commandHandler({entity:a,command:t,entityOptions:i})}showGuardiansApprovalRequestDialog(e,t){const n={type:ke.ck.guardiansapprovalrequest,action:ke.SY.create};return this.commandHandler({entity:n,command:e,entityOptions:t})}showSendApprovalSuccessDialog(e){const t={type:ke.ck.guardianssendapprovalsuccess,action:ke.SY.create};return this.extensionCommanding.executeCommand(t,{entityCommand:e})}showSendApprovalErrorDialog(e,t){const n={type:ke.ck.guardianssendapprovalerror,action:ke.SY.create};return this.extensionCommanding.executeCommand(n,{entityCommand:e,entityOptions:t})}}class An{constructor(e){this.commandHandler=e}launchTflHomepage(){const e={id:(0,E.v4)(),source:A.p.Homepage,startTimestamp:Date.now()};return this.commandHandler({entity:{type:ke.ck.homepage,action:ke.SY.default},command:{correlation:e,stateTransition:g.Ar.flush,visibilityState:g.Rp.show}})}}class En{constructor(e){this.extensionCommanding=e}showCreatePostDialog(e,t,n,i){return this.extensionCommanding.executeCommand({type:ke.ck.classesintegrationcontent,action:ke.SY.create},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.LmsCourseTeams}},entityOptions:{teamId:e,teamName:t,groupId:n,tenantId:i}})}}class Fn{constructor(e){this.commandHandler=e}viewLobNotifications(e,t){return this.commandHandler({entity:{type:ke.ck.lobnotifications,action:ke.SY.view},command:t,entityOptions:e})}}class _n{constructor(e){this.commandHandler=e}analytics(e,t){return this.commandHandler({entity:{type:ke.ck.meetinganalytics,action:ke.SY.view},command:e,entityOptions:t})}openAttendanceTabInSchedulingForm(e,t,n="",i=0){return this.commandHandler({entity:{type:ke.ck.attendancereport,action:ke.SY.view,linkedEntity:{type:ke.ck.schedulingform,action:ke.SY.view,id:JSON.stringify({eventId:(0,pn.WD)(n),providerType:i})}},command:e,entityOptions:{...t,eventId:(0,pn.WD)(n)}})}openAnalyticsInSchedulingForm(e,t,n="",i=0){return this.commandHandler({entity:{type:ke.ck.meetinganalytics,action:ke.SY.view,linkedEntity:{type:ke.ck.schedulingform,action:ke.SY.view,id:JSON.stringify({eventId:(0,pn.WD)(n),providerType:i,tabId:"Attendance",key:(0,E.v4)()})}},command:e,entityOptions:{...t,eventId:(0,pn.WD)(n)}})}openAttendanceTabInMeetingChat(e,t,n){return this.commandHandler({entity:{type:ke.ck.meetinganalytics,action:ke.SY.view},command:e,entityOptions:{threadId:t,...n,subType:"meetingchat"}})}openAttendanceTabInMeetingRecapOfChat(e,t,n){return this.commandHandler({entity:{type:ke.ck.meetinganalytics,action:ke.SY.view,linkedEntity:{type:n&&n.type?n.type:ke.ck.chats,action:ke.SY.view,id:t?.threadId||""}},command:e,entityOptions:t})}}class Dn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}meetingOptionsFormView(e,t,n,i,a,o){return this.commandHandler({entity:{type:ke.ck.meetings,action:ke.SY.view,id:this.serializeMeetingCoordinates(e,t,n,i,a)},command:o})}meetingOptionsCreateViewDialog(e,t,n){const i={type:ke.ck.meetingoptionscreatedialog,id:e.id,action:e.action};return this.extensionCommanding.executeCommand(i,{entityCommand:t,entityOptions:n})}serializeMeetingCoordinates(e,t,n,i,a){return JSON.stringify({tenantId:e,organizerId:t,threadId:n,messageId:i,additionalMessageId:a})}}class Pn{constructor(e,t){this.commandHandler=e,this.coreSettings=t}intelligentRecap(e,t,n,i){return this.commandHandler({entity:{type:ke.ck.meetingrecap,action:ke.SY.view,id:`recap-${e}`,linkedEntity:i},command:t,entityOptions:n})}recapTabInMeetingChat(e,t,n,i){const{enableRecapVNextForTab:a}=this.coreSettings.get(c.w.MeetingRecap);return this.commandHandler({entity:{id:a?`recap-${t?.threadId}`:void 0,type:ke.ck.meetingrecap,action:ke.SY.view,linkedEntity:n?i??{type:ke.ck.chats,action:ke.SY.view,id:t?.threadId||""}:null},command:e,entityOptions:t})}recapTabInSchedulingForm(e,t,n,i){return this.commandHandler({entity:{id:i||"",type:ke.ck.meetingrecap,action:ke.SY.view,linkedEntity:{type:ke.ck.schedulingform,action:ke.SY.view,id:JSON.stringify({eventId:(0,pn.WD)(t?.externalEntityKey||""),providerType:n,tabId:"Recap",key:(0,E.v4)()})}},command:e,entityOptions:t})}popOutMeetingRecap(e,t){const n={id:(0,E.v4)(),source:t||A.p.Unknown,startTimestamp:Date.now()},{externalEntityKey:i,threadId:a}=e||{};return this.commandHandler({entity:{type:ke.ck.meetingrecap,action:ke.SY.view,id:i||a},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:n},entityOptions:{...e,openType:"popout"}})}recapPageInChannel(e,t){const{externalEntityKey:n,threadId:i}=t||{};return this.commandHandler({entity:{type:ke.ck.meetingrecap,action:ke.SY.view,id:n||i},command:e,entityOptions:t})}}var Mn;!function(e){e.JoinByCode="JoinByCode",e.Dialpad="Dialpad",e.Cortana="Cortana",e.SmartDeviceJoinByCode="SmartDeviceJoinByCode"}(Mn||(Mn={}));class Rn{constructor(e){this.commandHandler=e}meetingRoomConsoleInCallById(e,t,n,i){return this.commandHandler({entity:{type:e,action:ke.SY.view,id:t},entityOptions:n,command:i})}meetingRoomNewCall(e){return this.commandHandler({entity:{type:e,action:ke.SY.create},entityOptions:{stateParams:{isPstnCall:!0},createCallType:Mn.Dialpad},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.Calling}}})}meetingRoomBroadcast(e,t,n){return this.commandHandler({entity:{type:e,action:ke.SY.share},entityOptions:n,command:t})}meetingRoomSmartDeviceJoinByCode(e){return this.commandHandler({entity:{type:ke.ck.meetingroomconsolecall,action:ke.SY.create},entityOptions:{createCallType:Mn.SmartDeviceJoinByCode},command:e})}meetingRoomJoinByCode(e,t,n){return this.commandHandler({entity:{type:e,action:ke.SY.create},entityOptions:{stateParams:n?.stateParams,createCallType:Mn.JoinByCode},command:t})}meetingRoomHome(e,t){return this.commandHandler({entity:{type:e,action:ke.SY.list},entityOptions:{},command:t})}meetingRoomPostCall(e,t,n){return this.commandHandler({entity:{type:e,action:ke.SY.health},entityOptions:n,command:t})}meetingRoomFrontOfRoom(e,t,n){return this.commandHandler({entity:{id:e,type:t,action:ke.SY.create},command:n})}}class xn{constructor(e){this.commandHandler=e}viewOnboardingNotifications(e,t){return this.commandHandler({entity:{type:ke.ck.onboardingnotifications,action:ke.SY.view},command:t,entityOptions:e})}}var Ln=n(363678);class On{constructor(e,t,n){this.commandHandler=e,this.extensionCommanding=t,this.coreSettings=n}launchTaskModule(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.taskmodule,action:ke.SY.create},{entityCommand:n,entityOptions:t?.taskModuleOptions})}launchHWCTaskModule(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.hwctaskmodule,action:ke.SY.create},{entityCommand:n,entityOptions:t?.taskModuleOptions})}launchStage(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({type:ke.ck.platformStage,action:ke.SY.view},{entityCommand:t,entityOptions:e?.stageOptions})}launchReactStageModal(e,t,n){const i=n||this.getDefaultExtensionCommand();return this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformstagemodal,action:ke.SY.view},{entityCommand:i,entityOptions:t})}launchStageMW(e){return this.commandHandler({entity:{id:e.id,type:ke.ck.platformStage,action:ke.SY.create,linkedEntity:e.linkedEntity},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{id:e.stageOptions.correlationId,source:e.commandSource||A.p.PlatformExtension,startTimestamp:e.stageOptions.scenarioStartTime}},entityOptions:e.stageOptions})}launchStageMWWithoutChat(e){const t=void 0===e.stageOptions.reloadToggle?g.Ar.new:g.Ar.flush;return this.commandHandler({entity:{id:e.id,type:ke.ck.platformstagewithoutchat,action:ke.SY.view},command:{stateTransition:t,visibilityState:g.Rp.show,correlation:{id:e.stageOptions.correlationId,source:e.commandSource||A.p.PlatformExtension,startTimestamp:e.stageOptions.scenarioStartTime}},entityOptions:e.stageOptions})}launchAppEnableDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.enableappdialog,action:ke.SY.view},{entityCommand:{...this.getDefaultExtensionCommand(),correlation:{source:e.commandSource||A.p.ExtensionCommanding}},entityOptions:e})}launchTabGallery(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({type:ke.ck.platformTabGallery,action:ke.SY.view},{entityCommand:t,entityOptions:e?.tabGalleryOptions})}launchUnsupportedDeeplinkDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.unsupporteddeeplinkdialog,action:ke.SY.view},{entityOptions:{originalDeeplink:e}})}launchAppDetails(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformapp,action:ke.SY.create},{entityCommand:n,entityOptions:t?.platformAppDetailsOptions})}launchAppDetailsTutorial(e){return this.extensionCommanding.executeCommand({type:ke.ck.platformappdetails,action:ke.SY.info},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchAppRevokeConsent(e){return this.extensionCommanding.executeCommand({type:ke.ck.platformappconsent,action:ke.SY.delete},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}appDetailsPostInstall(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=g.Ar.none,this.commandHandler({entity:{type:ke.ck.platformappdetails,action:ke.SY.config},command:t,entityOptions:e})}appDetailsPostInstallV2(e){return this.extensionCommanding.executeCommand({type:ke.ck.platformappdetails,action:ke.SY.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}appDetailsOnDone(e,t){const n=this.getDefaultExtensionCommand();return n.stateTransition=g.Ar.none,this.commandHandler({entity:{id:e,type:ke.ck.platformappdetails,action:ke.SY.update},command:n,entityOptions:t})}launchInContextStore(e){return this.extensionCommanding.executeCommand({type:ke.ck.incontextstore,action:ke.SY.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}inContextStorePostInstall(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=g.Ar.none,this.commandHandler({entity:{type:ke.ck.incontextstore,action:ke.SY.config},command:t,entityOptions:e})}inContextStoreOnDone(e,t){const n=this.getDefaultExtensionCommand();return n.stateTransition=g.Ar.none,this.commandHandler({entity:{id:e,type:ke.ck.incontextstore,action:ke.SY.update},command:n,entityOptions:t})}launchAppStore(e,t){return this.commandHandler({entity:{type:ke.ck.platformapps,action:ke.SY.list},command:t,entityOptions:e})}launchPersonalApp(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=g.Ar.none,this.commandHandler({entity:{type:ke.ck.platformapp,action:ke.SY.view},command:t,entityOptions:e})}launchAppUninstall(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformapp,action:ke.SY.delete},{entityCommand:n,entityOptions:t?.uninstallOptions})}launchAppError(e){return this.extensionCommanding.executeCommand({type:ke.ck.platformapp,action:ke.SY.error},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchContextlessConfigDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.platformapp,action:ke.SY.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchManifestParsingErrorDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.customapp,action:ke.SY.error},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchUploadCustomApp(){return this.extensionCommanding.executeCommand({type:ke.ck.customapp,action:ke.SY.view},{entityCommand:this.getDefaultExtensionCommand()})}launchRequestSubmittedDialog(){return this.extensionCommanding.executeCommand({type:ke.ck.customapp,action:ke.SY.info},{entityCommand:this.getDefaultExtensionCommand()})}launchLocationDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.locationapi,action:ke.SY.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchSelectMediaDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.selectMediaApi,action:ke.SY.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchViewImagesDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.viewImagesApi,action:ke.SY.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchSelectPeoplePickerDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.selectpeoplepicker,action:ke.SY.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchAppRatingCoachmark(e){return this.extensionCommanding.executeCommand({type:ke.ck.platformappratingcoachmark,action:ke.SY.view},{entityCommand:e??this.getDefaultExtensionCommand()})}launchAppConfig(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformapp,action:ke.SY.config},{entityCommand:n,entityOptions:t?.launchAppConfigOptions})}launchTabInfo(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformtab,action:ke.SY.info},{entityCommand:n,entityOptions:t?.launchTabInfoOptions})}launchStagedApps(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({type:ke.ck.stagedapps,action:ke.SY.info},{entityCommand:t,entityOptions:e?.launchStagedAppsOptions})}launchAppAuthConsent(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformauthconsentdialog,action:ke.SY.create},{entityCommand:n,entityOptions:t?.launchAuthConsentOptions})}platformTabById(e,t,n,i){return this.commandHandler({entity:{id:e,type:ke.ck.extensions,action:ke.SY.view,linkedEntity:n},command:t,entityOptions:i})}launchPersonalPlatformApp(e,t,n,i,a,o){return this.commandHandler({entity:{id:JSON.stringify({appId:e,tabEntityId:n}),type:ke.ck.extensions,action:ke.SY.view,linkedEntity:a},command:{visibilityState:g.Rp.show,stateTransition:t?g.Ar.new:g.Ar.flush,correlation:{source:i??A.p.AppBar,startTimestamp:Date.now()}},entityOptions:{isMultiWindow:t,entryPoint:Ln.hB.personalApp,...o}})}platformAppById(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.extensions,action:ke.SY.view,linkedEntity:n},command:t})}navigateToManageApps(e){return this.commandHandler({entity:{type:ke.ck.platformapps,action:ke.SY.manage},entityOptions:e})}launchSubscriptionPlansDialog(e,t,n){const i=n||this.getDefaultExtensionCommand();return i.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformsubscriptionplans,action:ke.SY.info},{entityCommand:i,entityOptions:t})}launchAngularAppDetails(e,t,n){const{enableAppDetailsAngularFeatureParity:i}=this.coreSettings.get(c.w.Host);if(i)return this.launchAppDetails(e,{platformAppDetailsOptions:t,entityCommand:n});const a=n||this.getDefaultExtensionCommand();return a.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformapp,action:ke.SY.info},{entityCommand:a,entityOptions:t})}launchCustomAppFilePicker(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.customapp,action:ke.SY.create},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:n||A.p.Store}},entityOptions:t})}launchWorkflowsDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.workflows,action:ke.SY.create},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:n||A.p.Store}},entityOptions:t})}launchWorkflowSelectionDialog(e,t,n,i){let a=ke.ck.chatworkflows;const o=ke.SY.view;switch(t){case A.p.ChatListItem:a=ke.ck.chatworkflows;break;case A.p.ChannelListItem:a=ke.ck.channelworkflows;break;case A.p.MessageExtensionFlyout:a=ke.ck.messageextensionworkflows;break;case A.p.MessageAction:a=ke.ck.messageactionworkflows;break;case A.p.OnedriveFileContextMenu:a=ke.ck.onedrivefileworkflows;break;case A.p.SharepointFileContextMenu:a=ke.ck.sharepointfileworkflows}return this.extensionCommanding.executeCommand({id:e,type:a,action:o},{entityCommand:n,entityOptions:i})}launchManageWorkflows(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.workflows,action:ke.SY.manage},entityOptions:t,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:n||A.p.Store}}})}launchSettingsDialog(e,t,n){const i={visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:n||A.p.Card}};return this.extensionCommanding.executeCommand({id:e,type:ke.ck.settingsdialog,action:ke.SY.view},{entityCommand:i,entityOptions:t})}updatePlatformTabById(e,t,n,i){return this.commandHandler({entity:{id:e,type:ke.ck.extensions,action:ke.SY.update,linkedEntity:n},command:t,entityOptions:i})}launchManageAppsUninstall(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.manageapps,action:ke.SY.delete},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchManageAppsWebhook(e,t){const n=t.editMode?ke.SY.update:ke.SY.create;return this.extensionCommanding.executeCommand({id:e,type:ke.ck.manageappswebhook,action:n},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchManageAppsWebhookConfirmation(e){const t={webhookToken:e};return this.extensionCommanding.executeCommand({type:ke.ck.manageappswebhook,action:ke.SY.info},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}selectAppEntity(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=g.Rp.show,this.extensionCommanding.executeCommand({type:ke.ck.platformTabGallery,action:ke.SY.create},{entityCommand:t,entityOptions:e?.selectAppEntityOptions})}launchAppDevicePermissions(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformappdevicepermissions,action:ke.SY.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchAppDevicePermissionsFirstRun(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformappdevicepermissions,action:ke.SY.update},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchRefreshConfirmationAfterAppDevicePermissionsUpdate(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformappdevicepermissions,action:ke.SY.confirm},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}hideExtension(e){return this.extensionCommanding.executeCommand(e,{entityCommand:{visibilityState:g.Rp.hide,stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding}}})}getDefaultExtensionCommand(){return{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}}}}class jn{constructor(e){this.extensionCommanding=e}launchAppDevicePermissionsConsent(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.platformappdevicepermissions,action:ke.SY.manage},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}getDefaultExtensionCommand(){return{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}}}}class Bn{constructor(e){this.commandHandler=e}presenterChatById(e,t,n){return this.commandHandler({entity:{type:ke.ck.presenterchat,action:ke.SY.view},entityOptions:e,command:t,windowOptions:n})}}var Un=n(779898);class $n{constructor(e,t){this.commandHandler=e,this.coreSettings=t}registration(e){const{enableMultiWindowWebinarRegistration:t}=this.coreSettings.get(c.w.WebinarRegistration);return t?this.commandHandler({entity:{action:ke.SY.view,id:e,type:ke.ck.registration},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:A.p.Calendar}}}):((0,Un.z)().open(`${(0,Un.z)().location.origin}/registration/${e}?mode=edit`,"_blank"),Promise.resolve())}}class Wn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}showTeamsGrid(e){return this.commandHandler({entity:{type:ke.ck.schoolteams,action:ke.SY.list},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.SchoolTeams}},entityOptions:{lastVisitedTeamId:e}})}gridTeamDiscover(){return this.commandHandler({entity:{type:ke.ck.schoolteams,action:ke.SY.join},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.SchoolTeams}}})}showSingleTeam(e){return this.commandHandler({entity:{type:ke.ck.channels,action:ke.SY.view,id:e},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.SchoolTeams}}})}showUnlockDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.schoolteams,action:ke.SY.update,id:e},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.UnlockTeam}}})}}class Vn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t,this.updateSearchState=(e,t,n,i,a,o)=>{const r={type:ke.ck.search,action:ke.SY.view};let s;const l=n?`${e?.searchQuery}${e?.currentTab?` | ${e?.currentTab}`:""}`:e?.searchQuery;s=t?{...r}:i&&i.type===ke.ck.search&&i.action===ke.SY.view?{...i,...n?{id:l}:{}}:{...r,id:l};const c=o||g.Ar.none;return a&&c===g.Ar.flush&&(e={...e,entrySource:"MainSlot"}),this.commandHandler({entity:s,command:{correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.Search},stateTransition:c,visibilityState:g.Rp.show},entityOptions:e})},this.updateSearchStateRW=(e,t,n)=>{const i=e?.currentTab??"all";return this.commandHandler({entity:{id:`${t||e&&e.searchQuery} | ${i}`,type:ke.ck.search,action:ke.SY.view},command:{correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.Search},stateTransition:n||g.Ar.flush,visibilityState:g.Rp.show},entityOptions:e})},this.sendSearchStateToMetaOSSearchService=(e,t)=>this.commandHandler({entity:{id:JSON.stringify({appId:t}),type:ke.ck.extensions,action:ke.SY.view},command:{correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.Search},stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entityOptions:e}),this.open3SFeedback=e=>this.commandHandler({entity:{type:ke.ck.open3sfeedback,action:ke.SY.view},command:{correlation:{source:A.p.Search},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entityOptions:e}),this.exitSearchState=()=>this.commandHandler({entity:{type:ke.ck.search,action:ke.SY.view,id:"search"},command:{correlation:{source:A.p.Search},stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.hide}})}openFeedback(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.openfeedbackdialog,action:ke.SY.view},{entityCommand:e,entityOptions:t})}launchReactHelpApp(e){this.commandHandler({entity:{type:ke.ck.help,action:ke.SY.view},command:{correlation:{source:A.p.Search},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entityOptions:e})}}class Hn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}launch(e,t){return this.commandHandler({entity:{type:ke.ck.settingsstore,action:ke.SY.default,id:t},command:e})}launchSection(e,t,n,i){return this.commandHandler({entity:{type:i??ke.ck.settingsstore,action:ke.SY.view,id:e},command:t,entityOptions:{...n,commandSource:t?.correlation.source}})}launchDeleteContact(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.deletecontact,action:ke.SY.delete},{entityCommand:t,entityOptions:e})}}class zn{constructor(e){this.extensionCommanding=e}launchShareFormDialog(e,t){const n=t?.entityCommand||this.getDefaultCommand();return n.visibilityState=g.Rp.show,n.stateTransition=g.Ar.extend,this.extensionCommanding.executeCommand({id:e,type:ke.ck.shareformdialog,action:ke.SY.view},{entityCommand:n,entityOptions:t?.entityOptions})}getDefaultCommand(){return{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}}}}class qn{constructor(e){this.commandHandler=e}viewStore(e,t,n){return this.commandHandler({entity:{type:ke.ck.store,action:ke.SY.view,id:e},command:n,entityOptions:t})}showStoreFre(e,t){return this.commandHandler({entity:{type:ke.ck.storefre,action:ke.SY.view,id:t},command:{visibilityState:e?g.Rp.show:g.Rp.hide,stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding}}})}viewManageAppsTab(e,t){return this.commandHandler({entity:{type:ke.ck.store,action:ke.SY.manage},command:t,entityOptions:e})}}var Gn,Yn=n(370054);function Qn(e){return{id:e||"",type:ke.ck.channels,action:ke.SY.list}}function Jn(e,t=g.Ar.flush){return{stateTransition:t,visibilityState:g.Rp.show,correlation:{source:e}}}!function(e){e.User="user",e.Team="team",e.TeamOwned="teamowned"}(Gn||(Gn={}));class Kn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}editTeamPicture(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teampicture,action:ke.SY.view})}viewTeamJoinCode(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamjoincode,action:ke.SY.view},{entityOptions:{teamJoinCode:t}})}viewTeamRenewal(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamrenewal,action:ke.SY.view},{entityOptions:{expiryTime:t}})}editTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamedit,action:ke.SY.view},{entityOptions:t})}addMember(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.addmember,action:ke.SY.view})}addMemberToTeamDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.addmembertoteamdialog,action:ke.SY.view},{entityOptions:t})}hideAllChannelsDialog(e,t){const n={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChannelListItem}},i={teamName:t,teamId:e};return this.extensionCommanding.executeCommand({id:e,action:ke.SY.view,type:ke.ck.simplecollabhideallchannelsdialog},{entityCommand:n,entityOptions:i})}addMemberToPrivateChannelDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.addmembertoprivatechanneldialog,action:ke.SY.view},{entityOptions:t})}shareChannelWithUserDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.sharechannelwithuserdialog,action:ke.SY.view},{entityOptions:t})}addMemberToNewTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.addmembernewteam,action:ke.SY.view},{entityOptions:t})}addChannel(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.addchannel,action:ke.SY.view})}createChannel(e){return this.extensionCommanding.executeCommand({type:ke.ck.createchanneldialog,action:ke.SY.view},{entityOptions:e})}createChannelOnLeftRail(e){return this.extensionCommanding.executeCommand({type:ke.ck.createchannelleftraildialog,action:ke.SY.view},{entityOptions:e})}manageApps(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teammanageapps,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}manageTags(e,t,n,i){return this.commandHandler({entity:{id:e,type:ke.ck.teammanagetags,action:ke.SY.view,linkedEntity:i?.linkedEntity??Qn(e)},entityOptions:{...i?.entityOptions,tagId:n,commandSource:t},scenarioEventData:i?.scenarioEventData,command:i?.entityCommand||Jn(t??A.p.ChannelListItem)})}leaveTeam(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamleave,action:ke.SY.view})}createTeam(){return this.extensionCommanding.executeCommand({type:ke.ck.teamcreate,action:ke.SY.view})}archiveTeam(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamarchive,action:ke.SY.view})}restoreTeam(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamrestore,action:ke.SY.view})}launchConfirmPinUnpinPost(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.pinunpinpost,action:ke.SY.view},{entityCommand:t,entityOptions:e})}createTeamOnMainView(e,t){const n=e?.source||Yn.$D.template;return this.commandHandler({entity:{id:n,type:ke.ck.teams,action:ke.SY.create},entityOptions:e,command:Jn(t??A.p.ChannelList)})}createTeamV2(e){return this.extensionCommanding.executeCommand({type:ke.ck.teamcreatedialog,action:ke.SY.view},{entityOptions:e})}showListView(){return this.commandHandler({entity:{type:ke.ck.channels,action:ke.SY.view},command:Jn(A.p.SchoolTeams)})}teamDiscover(){return this.commandHandler({entity:{type:ke.ck.teamdiscover,action:ke.SY.view},command:Jn(A.p.ChannelListItem)})}manageTeam(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teammanage,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}manageTeams(e){return this.commandHandler({entity:{type:ke.ck.teams,action:ke.SY.config},command:Jn(e)})}manageSharedChannelsPendingInvites(e,t,n){return this.commandHandler({entity:{id:n,type:ke.ck.sharedchannelspendinginvites,action:ke.SY.view,linkedEntity:Qn(n)},command:t?.entityCommand||Jn(e,g.Ar.flow),scenarioEventData:t?.scenarioEventData,entityOptions:t?.entityOptions||{commandSource:e}})}manageTeamsList(e,t,n){return this.commandHandler({entity:{id:n,type:ke.ck.teamslist,action:ke.SY.view,linkedEntity:Qn(n)},command:t?.entityCommand||Jn(e,g.Ar.flow),scenarioEventData:t?.scenarioEventData,entityOptions:t?.entityOptions||{commandSource:e}})}crossTeamAnalytics(e,t,n){return this.commandHandler({entity:{id:n,type:ke.ck.crossteamanalytics,action:ke.SY.view,linkedEntity:Qn(n)},command:t?.entityCommand||Jn(e,g.Ar.flow),scenarioEventData:t?.scenarioEventData,entityOptions:t?.entityOptions})}acceptInvitation(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.sharedchannelacceptinvitation,action:ke.SY.view},{entityOptions:t})}declineInvitation(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.sharedchanneldeclineinvitation,action:ke.SY.view},{entityOptions:t})}teamDeepLink(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamdeeplink,action:ke.SY.view})}channelDeepLink(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channeldeeplink,action:ke.SY.view})}viewChannelEmail(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channelemail,action:ke.SY.view})}viewChannelEmailV2(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.channelemailv2,action:ke.SY.view},{entityCommand:t,entityOptions:e})}removeChannelEmail(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.removechannelemail,action:ke.SY.view},{entityCommand:t})}launchChannelEmailErrorDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.channelemailerror,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ChannelEmail}},entityOptions:{errorCode:e}})}manageChannelConnectors(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channelconnectors,action:ke.SY.view},{entityCommand:n,entityOptions:t})}connectorInstanceConfiguration(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.connectorinstanceconfiguration,action:ke.SY.view},{entityCommand:n,entityOptions:t})}deleteChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channeldelete,action:ke.SY.view},{entityOptions:t})}editChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channeledit,action:ke.SY.view},{entityOptions:t})}channelModerators(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channelmoderators,action:ke.SY.view})}manageChannel(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channelmanage,action:ke.SY.view,linkedEntity:t?.linkedEntity??Qn(e)},entityOptions:{parentTeamId:t?.parentTeamId,commandSource:n},command:Jn(n||A.p.ChannelListItem)})}manageChannelApps(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channelapps,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},entityOptions:{...n?.entityOptions,commandSource:t,parentTeamId:n?.parentTeamId},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData})}manageChannelAnalytics(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channelanalytics,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},entityOptions:{...n?.entityOptions,commandSource:t,parentTeamId:n?.parentTeamId},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData})}manageChannelMembers(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channelmembers,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},entityOptions:{...n?.entityOptions,commandSource:t,parentTeamId:n?.parentTeamId},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData})}manageChannelSettings(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channelsettings,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},entityOptions:{...n?.entityOptions,commandSource:t,parentTeamId:n?.parentTeamId},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData})}manageChannelInvitations(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channelinvitations,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},entityOptions:{...n?.entityOptions,commandSource:t,parentTeamId:n?.parentTeamId},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData})}manageChannelTags(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.channeltags,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},entityOptions:{...n?.entityOptions,commandSource:t,parentTeamId:n?.parentTeamId,tagId:n?.tagId},command:n?.entityCommand||Jn(t??A.p.ChannelListItem),scenarioEventData:n?.scenarioEventData})}addChannelMember(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channelroster,action:ke.SY.manage})}leaveChannel(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channels,action:ke.SY.leave})}showHideGeneralChannel(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channels,action:ke.SY.confirm})}channelNotificationSettings(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channelnotificationsettings,action:ke.SY.view},{entityCommand:Jn(t||A.p.ChannelListItem),entityOptions:{commandSource:t||A.p.ChannelListItem,teamName:n?.teamName,channelName:n?.channelName}})}shareChannelWithUser(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channels,action:ke.SY.share},{entityOptions:{shareWith:Gn.User}})}shareChannelWithTeam(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channels,action:ke.SY.share},{entityOptions:{shareWith:Gn.Team}})}shareChannelWithTeamOwned(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.channels,action:ke.SY.share},{entityOptions:{shareWith:Gn.TeamOwned}})}manageTeamSettings(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teamsettings,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}manageTeamAnalytics(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teamanalytics,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}manageTeamMembers(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teammembers,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}manageTeamChannels(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teamchannels,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}manageTeamPendingJoinRequest(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teampendingrequests,action:ke.SY.view,linkedEntity:n?.linkedEntity??Qn(e)},command:n?.entityCommand||Jn(t),scenarioEventData:n?.scenarioEventData,entityOptions:{...n?.entityOptions,commandSource:t}})}deleteTeam(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teams,action:ke.SY.delete})}restoreChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.restorechannel,action:ke.SY.view},{entityOptions:t?.entityOptions})}showChannelOwners(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.showChannelOwners,action:ke.SY.view},{entityOptions:t})}showChannelOwnersReactDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.showchannelownersreactdialog,action:ke.SY.view},{entityOptions:e})}showForMemberDialog(e){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.showformemberdialog,action:ke.SY.view})}userOnboardingTeam(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.useronboardingteam,action:ke.SY.view},command:n?.entityCommand||Jn(t||A.p.ChannelList),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}}class Zn{constructor(e){this.extensionCommanding=e}launchTeamsErrorDialog(e,t,n,i,a){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.teamserrordialog,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:a}},entityOptions:{titleString:t,contentString:n,buttonString:i}})}getLinkToTeamOrChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.getlinktoteamorchanneldialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}staleChannelsAdhocDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.stalechannelsadhocdialog,action:ke.SY.view},{entityCommand:t,entityOptions:{commandSource:e.commandSource}})}denyInvitationConfirmDialog(){return this.extensionCommanding.executeCommand({type:ke.ck.sharedchanneldenyinvitation,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ChannelInvitations}}})}declineJoinChannelRequestConfirmDialog(){return this.extensionCommanding.executeCommand({type:ke.ck.sharedchanneldeclinejoinrequestdialog,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ChannelInvitations}}})}launchConfirmLeaveChannel(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.leavechanneldialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchShowHideGeneralChannelWarningDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.showhidegeneralchannelwarningdialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchLeaveChannelLastOwnerDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.leavechannellastownerdialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchRestoreChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.restorechannelreactdialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchDeleteChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.deletechannelreactdialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}launchStopSharingChannelWithTeamDialog(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.stopsharingchannelwithteamreactdialog,action:ke.SY.view},{entityCommand:t,entityOptions:e})}archiveTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:ke.ck.archiveteam,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}deleteTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:ke.ck.deleteteam,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}leaveTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:ke.ck.leaveteam,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}restoreTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:ke.ck.restoreteam,action:ke.SY.view},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}}class Xn{constructor(e){this.extensionCommanding=e}stopSharingChannelWithTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.stopsharingchannelwithteam,action:ke.SY.view},{entityOptions:t?.entityOptions})}createSharedChannelInvitationDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.sharedchannelcreateinvitationsdialog,action:ke.SY.view,linkedEntity:this.getChannelLinkedEntity(e)},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:t}},entityOptions:n})}acceptSharedChannelInvitationDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.acceptsharedchannelinvitationdialog,action:ke.SY.view},{entityOptions:t})}shareWithTeamYouOwnDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.sharewithteamyouowndialog,action:ke.SY.view},{entityOptions:t})}archiveChannel(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:ke.ck.archivechannel,action:ke.SY.view},{entityOptions:{teamId:e,channelId:t,channelDisplayName:n,channelType:i}})}unArchiveChannel(e,t,n){return this.extensionCommanding.executeCommand({id:t,type:ke.ck.unarchivechannel,action:ke.SY.view},{entityOptions:{teamId:e,channelId:t,channelDisplayName:n}})}editTeamPicture(e,t,n,i,a,o){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.changeteampicture,action:ke.SY.view},{entityCommand:o,entityOptions:{teamId:e,threadId:t,teamDisplayName:n,pictureETag:i,defaultTeamInitialsPicture:a}})}showForMemberDialogV2(e,t){return this.extensionCommanding.executeCommand({id:e,type:ke.ck.showformemberdialogv2,action:ke.SY.view},{entityOptions:t})}joinChannelDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.channeljoindialog,action:ke.SY.view},{entityOptions:e})}getChannelLinkedEntity(e){return{id:e||"",type:ke.ck.channels,action:ke.SY.list}}}class ei{constructor(e){this.commandHandler=e}launch(e){return this.commandHandler({entity:{type:ke.ck.teamsgallery,action:ke.SY.view},command:e})}launchSection(e){return this.commandHandler({entity:{type:ke.ck.teamsgallery,action:ke.SY.view,id:e},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.TeamsGallery}}})}launchTeamsGallery(){return this.commandHandler({entity:{type:ke.ck.teamsgallery,action:ke.SY.view,id:""},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.TeamsGallery}}})}manageAppsInTeam(e,t,n){return this.commandHandler({entity:{id:e,type:ke.ck.teammanageapps,action:ke.SY.view,linkedEntity:{id:e||"",type:ke.ck.channels,action:ke.SY.list}},command:n?.entityCommand||this.getDefaultEntityCommand(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}getDefaultEntityCommand(e,t=g.Ar.flush){return{stateTransition:t,visibilityState:g.Rp.show,correlation:{source:e},targetWindow:g.BA.main}}}class ti{constructor(e){this.commandHandler=e}openTranscriptTab({entityCommand:e,messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,iCalUid:s,disableCallRecap:l,entryPoint:c},d){return this.commandHandler({entity:{type:ke.ck.transcriptcontent,action:ke.SY.view},command:e,entityOptions:{messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,eventId:d,iCalUid:s,disableCallRecap:l,entryPoint:c}})}openTranscriptInSchedulingForm({entityCommand:e,messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,iCalUid:s,entryPoint:l},c,d,u){return this.commandHandler({entity:{type:ke.ck.transcriptcontent,action:ke.SY.view,linkedEntity:{type:ke.ck.schedulingform,action:ke.SY.view,id:JSON.stringify({eventId:(0,pn.WD)(c),providerType:d,tabId:u?"Recap":"Recordings & Transcripts",key:(0,E.v4)()})}},command:e,entityOptions:{messageId:t,threadId:n,transcriptId:i,isOrganizer:a,eventId:(0,pn.WD)(c),meetingOrganizerId:o,meetingTenantId:r,iCalUid:s,entryPoint:l}})}openTranscriptInChatApp({entityCommand:e,messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,isOdspTranscript:s,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u,iCalUid:m,entryPoint:p,defaultRightTab:g,isFileSaving:h},v,y){return this.commandHandler({entity:{id:i,type:ke.ck.transcriptcontent,action:ke.SY.view,linkedEntity:y?{type:ke.ck.chats,action:ke.SY.view,id:n||""}:null},command:e,entityOptions:{eventId:v?(0,pn.WD)(v):"",isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,messageId:t,threadId:n,transcriptId:i,isOdspTranscript:s,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u,iCalUid:m,entryPoint:p,defaultRightTab:g,isFileSaving:h}})}}class ni{constructor(e){this.extensionCommanding=e}launchUnifiedConsent(e){this.extensionCommanding.executeCommand({type:ke.ck.unifiedconsentdialog,action:ke.SY.view},{entityOptions:{...e}})}}class ii{constructor(e){this.extensionCommanding=e}vdiRestartDialogWorkflow(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.vdirestartworkflow,action:ke.SY.view},{entityCommand:e,entityOptions:t})}}var ai=n(987444);class oi{constructor(e,t,n,i){this.extensionCommanding=e,this.commandHandler=t,this.host=n,this.coreSettings=i}virtualEventsList(e){return this.commandHandler({entity:{type:ke.ck.virtualevents,action:ke.SY.list},command:e})}virtualEventById(e,t){const{useMeetingExperienceForSchedulingVirtualEvents:n,virtualEventByIdLinkUrl:i}=this.coreSettings.get(c.w.VirtualEvents);return n&&t?.stateTransition===g.Ar.new?(this.host.open(i?.replace("{eventId}",e)),Promise.resolve()):this.commandHandler({entity:{type:ke.ck.virtualevents,action:ke.SY.view,id:e},command:t})}createVirtualEvent(e,t){const{eventType:n}=e,{useMeetingExperienceForSchedulingVirtualEvents:i,createVirtualEventsLinkUrl:a}=this.coreSettings.get(c.w.VirtualEvents);return i?(this.host.open(a?.replace("{eventType}",n)),Promise.resolve()):this.commandHandler({entity:{type:ke.ck.virtualevents,action:ke.SY.create,id:(0,ai.aq)()},command:t,entityOptions:e})}showConfirmationDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.virtualevents,action:ke.SY.confirm},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.VirtualEventDetails}},entityOptions:e})}showShareDialog(e){return this.extensionCommanding.executeCommand({type:ke.ck.virtualevents,action:ke.SY.share},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.VirtualEventDetails}},entityOptions:e})}navigateVirtualEvent(e,t,n,i,a){return this.commandHandler({entity:{type:ke.ck.virtualevents,action:i||ke.SY.view,id:`${e}-${n}`},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,correlation:{source:A.p.VirtualEventDetails}},entityOptions:{selectedNavItem:n,sessionId:a,eventId:e,eventType:t}})}showFormErrorsDialog(){return this.extensionCommanding.executeCommand({type:ke.ck.virtualevents,action:ke.SY.error},{entityCommand:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.VirtualEventDetails}}})}eventJoin(e,t){return this.commandHandler({entity:{type:ke.ck.events,action:ke.SY.join},command:e,entityOptions:t})}}class ri{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}openWhiteboardTabInChat(e,t,n){return this.commandHandler({entity:{type:ke.ck.whiteboard,action:ke.SY.view,id:e},command:t,entityOptions:n})}openWhiteboardModal(e,t){return this.extensionCommanding.executeCommand({type:ke.ck.whiteboard,action:ke.SY.create,id:e},{entityCommand:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:t}})}}class si{constructor(e){this.commandHandler=e}openWikiTab(e,t,n,i){const a={entity:{action:ke.SY.view,id:e,linkedEntity:i,type:ke.ck.wiki},command:t,entityOptions:n};return this.commandHandler(a)}}class li{constructor(e){this.commandHandler=e}qnaById(e,t,n){return this.commandHandler({entity:{type:ke.ck.yammerqna,action:ke.SY.view,id:e},command:t,entityOptions:n})}}const ci=(e,t,n,i,a,o,r,s,l,c,m,p=d.N2,g,h,v)=>{const y=new Ze(e,i,p,r,s,g.modalManager),S=new qe(o,e,y,r,s,l,a,{userContextId:m,windowId:p},h,v);return{entityCommanding:{account:new zt(e),activity:new qt(e,y),authentication:new Xt(e,y,S,i),autoinstallnotification:new en(e),biometricEnrollment:new tn(e),brbFeedback:new nn(e,y),breakoutRooms:new an(e),broadcast:new on(e,y),calendar:new rn(y,e),call:new sn(e,y,m),callsMain:new ln(e),campaignNotifications:new cn(e),captchaChallenge:new dn(e),cast:new un(e),channel:new mn(e,y),chat:new gn(e,y,a,s),coachReport:new hn(e),contacts:new yn(e,y),deepLink:S,destroy:()=>y.destroy(),discoverSurface:new fn(e,s),discoverappsnotifications:new Sn(e),error:new kn(e),esp:new Cn(e,y),exploratory:new bn(e),feedback:new wn(e,y),file:new Tn(y,e),flyout:new In(e),guardians:new Nn(y,e),homepage:new An(e),meetingAnalytics:new _n(e),meetingRecap:new Pn(e,a),meetingRoom:new Rn(e),meetingOptions:new Dn(e,y),nova:new wt(e),platform:new On(e,y,a),platformDevicePermissionDialogs:new jn(y),presenterTools:new Bn(e),registration:new $n(e,a),school:new Wn(e,y),search:new Vn(e,y),settings:new Hn(e,y),shareForm:new zn(y),shell:new Mt(e,y,c,p,o,a,s),store:new qn(e),lobnotifications:new Fn(e),lms:new En(y),onboardingnotifications:new xn(e),teamsAndChannels:new Kn(e,y),teamsAndChannelsDialogs:new Xn(y),teamsAndChannelsConfirmationDialogs:new Zn(y),teamsGallery:new ei(e),toasts:new Wt(e,m),transcript:new ti(e),unifiedConsent:new ni(y),virtualEvents:new oi(y,e,o,a),yammerQna:new li(e),wiki:new si(e),communities:new vn(e,y),vdi:new ii(y),whiteboard:new ri(e,y)},eventing:new u(n,e,t),delegatedCommanding:new re(e,t)}};var di=n(879462);const ui=new Set(["com.microsoft.teams.activity","com.microsoft.teams.notifications","com.microsoft.teams.calling","com.microsoft.teams.collab-stage-view"]);class mi{constructor(e,t,n,i,a,o,r,s){this._appsRegistry=e,this._client=t,this._commandResultChangeReportingService=n,this._coreSettings=i,this._entityCommanding=a,this._loggerFactory=o,this._scenarioFactory=r,this._userContextId=s}init(){this._changes&&this.destroy(),this._changes=this._commandResultChangeReportingService.observeChanges().pipe((0,di.p)((e=>e.userContextId===this._userContextId))).subscribe((e=>this.executeOnCommandResultAppHooks(e)))}destroy(){this._changes?.unsubscribe(),this._changes=void 0}executeOnCommandResultAppHooks({context:{entityCommand:e,error:t},type:n}){if(!e)return;const i=e.command.correlation.scenarioName===be.Cu.ActivitySwitch,a=e.entity.type,o=a&&this._appsRegistry.getApp({entityType:i?ke.ck.activity:a}),r=o?.onCommandResult;if(o&&ui.has(o.manifest.id)&&r)try{r({requestContext:{client:this._client,coreSettings:this._coreSettings,entityCommanding:this._entityCommanding,error:t,loggerFactory:this._loggerFactory,scenarioFactory:this._scenarioFactory},entityCommand:e,result:n})}catch(e){this._loggerFactory.newLogger("command-result-hooks-service","core-services-entity-commanding").errorToTelemetry?.(`App ${o?.manifest.name} failed to execute entity command hook 'OnAfterCommandResolved' with ""${e.name}"" error`,"entity_command_hook",{errors:`${e.name}`},!0)}}}var pi=n(921103),gi=n(784728),hi=n(817542),vi=n(387037),yi=n(780952);function Si(e){return function(e){const t=ki(e),n=1,i=2,a=3;if(!t)return e;if(t[a])return t[n].replace(t[i],t[a]);return t[n]}(e)}function fi(e){return e.message&&(e.message=Si(e.message)),e.stack&&(e.stack=function(e){if(ki(e.message))return"Sanitized due to potential PII leaks.";return e.stack}(e)),e}function ki(e){return new RegExp(/(Can't find field ((chat)\(.*\)|.*) on object)/).exec(e)}const Ci=/-extension:\/\//;function bi(e){return e===d.O4.TimedOut}class wi{constructor(e,t,n,i,a,o,r){this.host=e,this.scenarioFactory=t,this.platformService=n,this.networkStateProvider=i,this.diagnosticsService=a,this.coreSettings=o,this._onWindowError=e=>{if(function(e){return e&&("resizeobserver loop limit exceeded"===e.message.toLowerCase()||Ci.test(e.filename))}(e))return!0;const{colno:t,filename:n,lineno:i,message:a}=e;let{error:o}=e;const r=!!o&&bi(o.code);return o=o?fi(o):new Error(Si(a)),this._reportError(be.Cu.GlobalWindowError,Object.assign(o,{colno:t,filename:n,lineno:i}),d.O4.UndefinedWindowError,r),!0},this._onUnhandledPromiseRejection=async e=>{const{reason:t}=e,n=!!t&&bi(t.code);return this._reportError(be.Cu.UnhandledRejection,t,d.O4.UnhandledPromiseRejection,n)},this._logger=r.newLogger("ErrorStateProvider","core-services-error-state"),e.addEventListener(pi.$f.UnhandledRejection,this._onUnhandledPromiseRejection),e.addEventListener(pi.$f.GlobalWindowError,this._onWindowError)}dispose(){this.host.removeEventListener(pi.$f.UnhandledRejection,this._onUnhandledPromiseRejection),this.host.removeEventListener(pi.$f.GlobalWindowError,this._onWindowError)}set error(e){this.persistDiagnostics(),void 0!==e&&(this._error=e,this._reportError(be.Cu.FatalError,e,d.O4.UndefinedGlobalError,!0))}get error(){return this._error}async _reportError(e,t,n,i){const{code:a=n,context:o="",stack:r}=t||{},s=this.safeRemoveUrlQueryParams(a),l=""===o?`${s}`:`${o}:${s}`,d=(0,Je.Mr)((0,et.y)((0,Je.BA)(t)));let u="";try{u=this.extractError(t)}catch(e){u="Stringifying error failed"}const m=`[errorCode:${l};filename:${t?.filename};lineno:${t?.lineno};colno:${t?.colno}]`,p=t?.originSlotName,g=t?.originAppId,h=g||p?`${g}/${p}: ${l}`:l;this._logger.error(`Reported error for scenario ${e}: ${h}`),this._logger.error(`showOops: ${i}, errors: ${m}`),this._logger.error("extractedError: ",u),this._logger.error("stack: ",r),this.scenarioFactory.newScenario(e).fail({message:h,errorCode:l,errors:m,showOops:i,"AppInfo.NetworkState":this.networkStateProvider.isOnline()?"Online":"Offline",errorSlotName:p,errorAppId:g});let v=Promise.resolve();if(i){const e=1e3;v=(0,yi.a)(hi.Tn.getInstance().flush(),e),this.persistDiagnostics()}const y=this.platformService.config.clientVersion;return v.catch((()=>this.diagnosticsService.pushDiagnosticsEvent(gi.$.Warn,"Could not flush telemetry logs in time",!0))).then((async()=>{const{disableSendingLogsToHost:e}=this.coreSettings.get(c.w.Diagnostics);if(!e){const e=await this.diagnosticsService.getDiagnosticsEvents(1e3);this.host.opener.postMessage(pi.pI.WindowErrored,{errorCode:l,errorDescription:d,errorMsg:u,logs:e,showOops:i,clientVersion:y})}}))}extractError(e){const{scrubStackTrace:t}=this.coreSettings.get(c.w.Core),n=t?[]:[vi.f0.SmtpAddress,vi.f0.IPV4Address,vi.f0.IPv6Address,vi.f0.PhoneNumber];return(0,et.y)(JSON.stringify(e,(0,Je.V$)()),n)}persistDiagnostics(){this.diagnosticsService.persistDiagnostics()}safeRemoveUrlQueryParams(e){if("string"!=typeof e)return e;try{return(0,Je.f2)(e)}catch{return"An error happened while removing query params from the error code."}}}var Ti=n(182710);const Ii={[Ti.Ad.Background]:"background",[Ti.Ad.UserVisible]:"user-visible"};class Ni{constructor(e,t,n){this.host=e,this.postTaskSchedulerDiagnosticsService=n,this.postTaskMap=new Map,this.logger=t.newLogger("PostTaskScheduler","core-services-scheduling")}schedule(e,t,n,i){const a=Ii[t.priority],o=new AbortController;return this.host.scheduler.postTask((()=>(this.postTaskSchedulerDiagnosticsService.markTaskDequeued(i,t.id),e())),{signal:o.signal,priority:a}).then((()=>{this.postTaskMap.delete(i)})).catch((()=>{this.postTaskMap.delete(i),this.logger.errorToTelemetry?.(`PostTaskScheduler: Job failed ${i}, ${t.id}`,"webclient_framework_foundation_core_services_scheduling")})),this.postTaskMap.set(i,{controller:o}),this.postTaskSchedulerDiagnosticsService.markTaskEnqueued(i,t.id),i}cancel(e){const{controller:t}=this.postTaskMap.get(e)||{};t&&(t.abort(),this.postTaskMap.delete(e))}destroy(){this.postTaskMap.forEach(((e,t)=>{this.cancel(t),this.postTaskMap.delete(t)}))}}var Ai;!function(e){e.JobChange="job_change"}(Ai||(Ai={}));class Ei{constructor(e,t,n,i,a,o,r){this._jobHandle=e,this._changes=t,this._meta=n,this._job=i,this._windowId=o,this._correlationId=r,this._timing={received:0,started:0,completed:0,canceled:0},this._execution=Ti.si.None,this._logger=a.newLogger("Scheduled Job","core-services-scheduling")}receive(){this._timing.received=Date.now(),this._execution=Ti.si.Received,this.reportJobChange()}execute(){if(this._execution===Ti.si.Canceled)return;if(this._execution!==Ti.si.Received)throw new Error("Unable to execute a job that has not been received");let e;this._timing.started=Date.now(),this._execution=Ti.si.Started;try{this.reportJobChange();const t=this._job();e=t instanceof Promise?t:Promise.resolve(t)}catch(t){this._logger.error(`Job with ID:${this._meta.id} failed to execute or rejected with error: ${t.message?t.message:t}`),e=Promise.reject(t)}this.complete(e)}equals(e){return this._jobHandle===e}cancel(){return this._timing.canceled=Date.now(),this._execution=Ti.si.Canceled,this.reportJobChange(),{meta:this._meta,job:this._job}}complete(e){const t=e=>{let t;return this._timing.completed=Date.now(),this._execution=Ti.si.Complete,this.isError(e)&&(t={message:e.message,code:e.code,context:e.context,name:e.name}),this.reportJobChange(t),e};e.then(t).catch(t)}isError(e){return!!e&&e instanceof Error}reportJobChange(e){this._changes.report({correlationId:this._correlationId,type:Ai.JobChange,context:{...this.toChangeState(),target:"job",error:e},windowId:this._windowId})}toChangeState(){return{handle:this._jobHandle,timing:this._timing,execution:this._execution,meta:this._meta}}}var Fi=n(867396);class _i extends Fi.default{remove(e,t){const n=[];let i;return this.forEach((a=>{t(a,e)?i=a:n.push(a)})),i&&(this.clear(),n.forEach((e=>this.enqueue(e)))),i}}const Di=(e,t)=>e.equals(t),Pi=()=>0;class Mi{constructor(e,t,n,i){this._jobExecutor=e,this._supportedPriority=t,this._changes=n,this._loggerFactory=i,this._logger=i.newLogger("GreedyJobExecutionQueue","core-services-scheduling"),this._queue=new _i(Pi)}clearExecutionSchedule(){this._jobExecutor.clearExecutionSchedule(),this._queue.clear()}cancel(e){const t=this._queue.remove(e,Di);return t&&t.cancel()}enqueue(e,t,n,i,a){if(n.priority!==this._supportedPriority)return this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job priroty [${Ti.Ad[n.priority]}] not supported by this queue, this queue supports [${Ti.Ad[this._supportedPriority]}]`,"webclient_framework_foundation_core_services_scheduling",void 0,!0),!1;const o=new Ei(e,this._changes,n,t,this._loggerFactory,i,a);return this._queue.enqueue(o)?(o.receive(),this._jobExecutor.scheduleExecution({getJob:()=>this._queue.dequeue()}),!0):(this._logger.errorToTelemetry&&this._logger.errorToTelemetry("PriorityQueue did not enqueue the job","webclient_framework_foundation_core_services_scheduling",void 0,!0),!1)}}class Ri{constructor(e,t,n){this._schedule=e,this._clearSchedule=t,this._logger=n}clearExecutionSchedule(){this._executionHandle&&this._clearSchedule(this._executionHandle)}scheduleExecution(e){this._executionHandle||(this._executionHandle=this._schedule((()=>{this._executionHandle=void 0,this.execute(e)})))}execute({getJob:e}){let t;for(;t=e();)try{t.execute()}catch(e){this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job executor caught an exception executing a job. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}}}class xi{constructor(e,t,n,i){this._changes=e,this._loggerFactory=n,this._windowId=i,this._logger=n.newLogger("QueueScheduler","core-services-scheduling"),this._queues=new Map,this.createQueues(t)}destroy(){this._queues.forEach((e=>{e.clearExecutionSchedule()}))}schedule(e,t,n,i){const a=this._queues.get(t.priority);return a?(a.enqueue(i,e,t,this._windowId,n),i):(this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job priority [${Ti.Ad[t.priority]}] supplied by ${t.scheduledById} not supported by scheduling`,"webclient_framework_foundation_core_services_scheduling",void 0,!0),Ti.dp)}cancel(e){let t;if(e===Ti.dp)return t;const n=Array.from(this._queues.values());for(const i of n)if(t=i.cancel(e),t)break;return t}createQueues(e){this.createQueue(Ti.Ad.Macro,(t=>e.setTimeout(t)),(t=>e.clearTimeout(t))),this.createQueue(Ti.Ad.RenderBlocking,(t=>e.requestAnimationFrame(t)),(t=>e.cancelAnimationFrame(t)))}createQueue(e,t,n){const i=new Ri(t,n,this._logger),a=new Mi(i,e,this._changes,this._loggerFactory);this._queues.set(e,a)}}var Li;!function(e){e.PostTask="PostTask",e.Queue="Queue"}(Li||(Li={}));const Oi={[Ti.Ad.Background]:Li.PostTask,[Ti.Ad.Macro]:Li.Queue,[Ti.Ad.RenderBlocking]:Li.Queue,[Ti.Ad.UserVisible]:Li.PostTask};class ji{constructor(e,t,n,i,a){const o=new xi(e,t,n,i),r=new Ni(t,n,a);this.activeSchedulers=new Map([[Li.PostTask,r],[Li.Queue,o]])}static get nextJobHandle(){return this._nextJobHandle===Number.MAX_SAFE_INTEGER&&(this._nextJobHandle=0),++this._nextJobHandle}destroy(){this.activeSchedulers.forEach((e=>{e.destroy()}))}schedule(e,t,n){return this.findScheduler(t.priority).schedule(e,t,n,ji.nextJobHandle)}cancel(e){for(const t of this.activeSchedulers.values()){const n=t.cancel(e);if(n)return n}}findScheduler(e){const t=this.activeSchedulers.get(Oi[e]);if(!t)throw new Error("No scheduler found for priority");return t}}ji._nextJobHandle=0;var Bi=n(985234);class Ui{constructor(){this.debugLogging=""}initialize(e){this.logger=e,this.logger.debug("Telemetry Utility-Service initialized")}static getInstance(){return this.instance}}function $i(){return Ui.getInstance()}Ui.instance=new Ui;class Wi{constructor(e,t,n,i="",a=""){this.diagnosticsService=e,this.label=t,this.loggerName=n,this.contextId=i,this.userContextId=a,this.enableDebugLogging=!1,this.cidLabel="",this.logsCount=0,this.lastReportTime=0,this.throttleAllowance=0,this.currentWindow=0,this.throttledCount=0,this.logsCountPerLoggerNameMap=new Map;try{const e=(0,Un.z)();$i().debugLogging||($i().debugLogging=e.localStorage.getItem("localDebug")??"default"),this.enableDebugLogging="true"===$i().debugLogging}catch{}this.cidLabel=i?i.concat(" ",t):t}log(e,...t){return this.invoke(console.log,e,gi.$.Info,!1,...t)}warn(e,...t){return this.invoke(console.warn,e,gi.$.Warn,!1,...t)}error(e,...t){return this.invoke(console.error,e,gi.$.Error,!1,...t)}debug(e,...t){return this.enableDebugLogging||this.consoleLogLevel>=gi.$.Debug?this.invoke(console.debug,e,gi.$.Debug,!1,...t):Bi.Y.None}logNoPii(e,...t){return this.invoke(console.log,e,gi.$.Info,!0,...t)}warnNoPii(e,...t){return this.invoke(console.warn,e,gi.$.Warn,!0,...t)}errorNoPii(e,...t){return this.invoke(console.error,e,gi.$.Error,!0,...t)}debugNoPii(e,...t){return this.enableDebugLogging||this.consoleLogLevel>=gi.$.Debug?this.invoke(console.debug,e,gi.$.Debug,!0,...t):Bi.Y.None}errorToTelemetry(e,t,n,i){return this.toTelemetry(console.error,e,t,gi.$.Error,n,i)}warnToTelemetry(e,t,n,i){return this.toTelemetry(console.warn,e,t,gi.$.Warn,n,i)}debugToTelemetry(e,t,n,i){return this.toTelemetry(console.debug,e,t,gi.$.Debug,n,i)}infoToTelemetry(e,t,n,i){return this.toTelemetry(console.log,e,t,gi.$.Info,n,i)}sendToDiagnosticLogs(e,t,n,i,a,...o){if((0,ai.Df)(i,Bi.Y.AddedIntoDiagnostics)||(0,ai.Df)(i,Bi.Y.ThrottledForDiagnostics)){if(o?.length>0){e=`${e} ${o.map((e=>(0,ge.oJ)(e))).join(", ")}`}e=(0,ge.Gu)(e),(0,ai.Df)(i,Bi.Y.AddedIntoDiagnostics)?this.diagnosticsService.pushDiagnosticsEvent(t,e,a,n):["Enabled","EnabledQuiet"].includes(this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling)||this.diagnosticsService.pushDiagnosticsEvent(t,e,a,n)}}toTelemetry(e,t,n,i,a,o=!1){t=(0,ge.Gu)(`${t}`);let r=Bi.Y.SentToTelemetry;return o&&(r=(0,ai.UQ)(this.invoke(e,t,i,!0),Bi.Y.SentToTelemetry)),(a=a||{}).message=t,a.logLevel=gi.$[i],a.contextId=this.contextId,(0,hi.Oq)(this.label,a,n,void 0,void 0,this.userContextId),r}invoke(e,t,n,i,...a){const o=this.getLogResult(n);if(o!==Bi.Y.None){let r=this.loggerName;if(a?.length>0&&a[0]&&"object"==typeof a[0]&&"loggerName"in a[0])try{r=a[0].loggerName,1===Object.keys(a[0]).length?a.shift():delete a[0].loggerName}catch{}if(this.increaseLogCount(n,o,r),t=`${this.cidLabel}: ${t}`,(0,ai.Df)(o,Bi.Y.LoggedInConsole)){const n=this.diagnosticsService.userId;e.call(console,n?`[${n}] - ${t}`:t,...a)}this.sendToDiagnosticLogs(t,n,new Date,o,i,...a)}return o}getLogResult(e){let t=Bi.Y.None;return(e<=this.consoleLogLevel||this.enableDebugLogging)&&(t=(0,ai.UQ)(t,Bi.Y.LoggedInConsole)),(e<gi.$.Debug||e<=this.consoleLogLevel)&&!this.isLoggerThrottledForDiagnostics()&&(e===gi.$.Error||this.diagnosticsService.loggerSettings.isUserEnableIDBLogs||!this.shouldThrottle()?t=(0,ai.UQ)(t,Bi.Y.AddedIntoDiagnostics):(this.throttledCount++,t=(0,ai.UQ)(t,Bi.Y.ThrottledForDiagnostics))),t}increaseLogCount(e,t,n){if(-1===this.diagnosticsService.loggerSettings.loggerReportCountInterval)this.updateCountToReporterForOneEvent(n,t,e);else{0===this.lastReportTime&&(this.lastReportTime=Date.now());let i=this.logsCountPerLoggerNameMap.get(n);void 0===i&&(i={total:0,error:0,diagnostics:0,throttled:0},this.logsCountPerLoggerNameMap.set(n,i)),this.logsCount++,i.total++,e===gi.$.Error&&i.error++;((0,ai.Df)(t,Bi.Y.AddedIntoDiagnostics)||(0,ai.Df)(t,Bi.Y.ThrottledForDiagnostics))&&(i.diagnostics++,(0,ai.Df)(t,Bi.Y.ThrottledForDiagnostics)&&(this.throttledCount++,i.throttled++)),this.updateLogsCountToReporter(e===gi.$.Error)}}updateLogsCountToReporter(e){if(this.logsCount>0&&this.diagnosticsService.loggerSettings.loggerReportCountInterval>0&&this.diagnosticsService.loggerSettings.loggerReportTimeInterval>0&&this.diagnosticsService.logCountReporter){const t=Date.now();(t-this.lastReportTime>this.diagnosticsService.loggerSettings.loggerReportTimeInterval||this.logsCount>=this.diagnosticsService.loggerSettings.loggerReportCountInterval||e)&&(this.diagnosticsService.logCountReporter.updateLogsCounts(this.logsCountPerLoggerNameMap),this.logsCount=0,this.throttledCount=0,this.lastReportTime=t,this.logsCountPerLoggerNameMap=new Map)}}updateCountToReporterForOneEvent(e,t,n){if(this.diagnosticsService.logCountReporter){const i={total:1,error:0,diagnostics:0,throttled:0};((0,ai.Df)(t,Bi.Y.AddedIntoDiagnostics)||(0,ai.Df)(t,Bi.Y.ThrottledForDiagnostics))&&(i.diagnostics=1,(0,ai.Df)(t,Bi.Y.ThrottledForDiagnostics)&&(i.throttled=1)),n===gi.$.Error&&(i.error=1),this.diagnosticsService.logCountReporter.updateLogsCountForOneLogger(e,i)}}shouldThrottle(){const e=this.diagnosticsService.loggerSettings;if("Disabled"===e.diagnosticsLogsThrottling||0===e.throttleCapacity)return!1;const t=Date.now();return t-this.currentWindow>e.throttleWindowSize&&(this.sendThrottledCount(),this.currentWindow=t,this.throttleAllowance=e.throttleCapacity),this.throttleAllowance<1||(this.throttleAllowance-=1,!1)}sendThrottledCount(){if(!(this.throttledCount<1)&&["DryRun","Enabled"].includes(this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling)){const e="DryRun"===this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling?"would have been throttled":"were throttled",t=`${this.cidLabel}: ${this.throttledCount} logs ${e} from ${new Date(this.currentWindow).toISOString()}`;this.diagnosticsService.pushDiagnosticsEvent(gi.$.Info,t,!0,new Date)}}get consoleLogLevel(){const e=this.diagnosticsService.loggerSettings.consoleLogLevel;return void 0===e?gi.$.Warn:e}isLoggerThrottledForDiagnostics(){return!!this.loggerName&&this.diagnosticsService?.loggerSettings?.throttleLoggers?.has(this.loggerName)}}class Vi{constructor(e,t,n=""){this.diagnosticsService=e,this.contextId=t,this.userContextId=n,this.newLogger=(e,t)=>{e=(0,ge.Gu)(`${e}`);return new Wi(this.diagnosticsService,e,t,this._contextId,this.userContextId)},this._contextId=t&&"00000000-0000-0000-0000-000000000000"!==t?(0,ge.Gu)(`CID[${t}]`):""}get cID(){return this.contextId}notifyDiagnosticsALTDone(){this.diagnosticsService.setALTDone()}}const Hi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"performWindowHistoryNavigation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"navigationDirection"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NavigationDirection"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"performWindowHistoryNavigation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"navigationDirection"},value:{kind:"Variable",name:{kind:"Name",value:"navigationDirection"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},zi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"navigateToWindowHistoryIndex"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowHistoryIndex"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"navigateToWindowHistoryIndex"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"windowHistoryIndex"},value:{kind:"Variable",name:{kind:"Name",value:"windowHistoryIndex"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},qi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesWindowHistoryNavigationPushToWindowHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pushToWindowHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},Gi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesWindowHistoryNavigationRemoveFromWindowHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeFromWindowHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},Yi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataWindowHistoryUpdateWindowHistoryWithEntityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewEntityName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SupportedViewEntities"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateWindowHistoryWithEntity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}},{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"viewEntityName"},value:{kind:"Variable",name:{kind:"Name",value:"viewEntityName"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};class Qi{constructor(e,t,n,i,a){this._client=e,this._host=t,this._coreSettings=n,this._windowId=i,this._activeWindowsService=a,this.onPopState=async e=>{void 0!==e.state?.windowHistoryIndex&&this.navigateTo(e.state?.windowHistoryIndex)}}async init(){this.hostHistoryNavigationEnabled&&this._host.addEventListener("popstate",this.onPopState)}async destroy(){this.hostHistoryNavigationEnabled&&this._host.removeEventListener("popstate",this.onPopState)}async navigate(e){return this.mutate(Hi,{navigationDirection:e})}async navigateTo(e){return this.mutate(zi,{windowHistoryIndex:e})}isEnableDecoupleCommandingFromApollo(){return this._activeWindowsService.enableDecoupleCommandingFromApollo}canNavigateObservable(){return this._activeWindowsService.getActiveWindowObservable(this._windowId).pipe((0,di.p)((e=>e?.isMainWindow&&e?.layoutConfig.layoutMode===Yt.Rm.standard||!1)),(0,o.T)((e=>({canNavigateBack:e?.windowHistoryNavigationState?.canNavigateBack||!1,canNavigateForward:e?.windowHistoryNavigationState?.canNavigateForward||!1}))))}historyNavigationObservable(){return this._activeWindowsService.getActiveWindowObservable(this._windowId).pipe((0,di.p)((e=>e?.isMainWindow&&e?.layoutConfig.layoutMode===Yt.Rm.standard||!1)),(0,o.T)((e=>({backHistory:e?.windowHistoryNavigationState?.backHistory||[],forwardHistory:e?.windowHistoryNavigationState?.forwardHistory||[]}))))}async pushToWindowHistory(e,t){return this.mutate(qi,{entity:e,entityOptions:JSON.stringify(t)})}async updateWindowHistoryWithEntity(e,t,n,i){return this.mutate(Yi,{entity:e,entityOptions:JSON.stringify(i),appId:n,viewEntityName:t})}async removeFromWindowHistory(e){if(!this.hostHistoryNavigationEnabled)return this.mutate(Gi,{entity:e})}get hostHistoryNavigationEnabled(){return this._coreSettings.get(c.w.Core)?.enableHostHistoryNavigation||!1}async mutate(e,t){return this._client.mutate({mutation:e,variables:{...t,windowId:this._windowId},fetchPolicy:"no-cache"})}}class Ji{report(e){if(!this._changes||0===this._changes.observers.length)return;const t=e.changeCorrelationId||(0,E.v4)();this.changes.next({...e,changeCorrelationId:t})}observeChanges(){return this.changes.asObservable()}get changes(){return this._changes||(this._changes=new Ye.B7),this._changes}}class Ki{constructor(e,t){this.parentContext=e,this.pulsarLibraryInstance=t}startSignal(e,t){return this.pulsarLibraryInstance.startSignal(e,t,this.parentContext)}}class Zi{constructor(e,t,n,i){this.logger=e,this.span=t,this.pulsarLibraryInstance=i,this.pulsarLibraryInstance.otlDependencies?this.signalContext=this.pulsarLibraryInstance.otlDependencies.trace.setSpan(n,t):this.logger.error("PulsarSignal: otlDependencies is not defined")}stop(e){this.span.setStatus(e),this.span.end()}appendEventData(e,t){this.span.setAttributes(Zi.eventDataToAttributes(e,t))}addEvent(e){this.span.addEvent(e)}getPulsarContext(){return new Ki(this.signalContext,this.pulsarLibraryInstance)}propagate(){if(!this.signalContext)return void this.logger.error("propagate: signalContext is not defined");const{W3CTraceContextPropagator:e,defaultTextMapSetter:t}=this.pulsarLibraryInstance.otlDependencies,n={};return(new e).inject(this.signalContext,n,t),n}static eventDataToAttributes(e,t){const n={};return Object.keys(t).forEach((i=>{n[`${e}.${i}`]=t[i]})),n}}var Xi,ea,ta;!function(e){e.TEAMS_CORE="Teams.Core",e.TEAMS_RENDERING="Teams.Rendering",e.TEAMS_RESOLVER="Teams.Resolver"}(Xi||(Xi={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(ea||(ea={})),function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(ta||(ta={}));class na{constructor(e,t){this.exporter=e,this.otlDependencies=t,this._shutdownOnce=new this.otlDependencies.BindOnceFuture(this._shutdown,this)}forceFlush(){return Promise.resolve()}onStart(e){this.export(e,"onStart")}onEnd(e){this._shutdownOnce.isCalled||0!=(e.spanContext().traceFlags&ta.SAMPLED)&&this.export(e,"onEnd")}shutdown(){return this._shutdownOnce.call()}export(e,t){const{context:n,suppressTracing:i,ExportResultCode:a,globalErrorHandler:o}=this.otlDependencies;n.with(i(n.active()),(()=>{this.exporter.export([e],(e=>{e.code!==a.SUCCESS&&o(e.error??new Error(`PulsarSpanProcessor: span export failed (status ${e})`))}),t)}))}_shutdown(){return this.exporter.shutdown()}}var ia=n(779191);class aa{constructor(e,t){this.serviceName=e,this.config=t,this.consumerNotificationObserver=new Ye.B7,this.logger=t.loggerFactory.newLogger("PulsarLib","frameworks-pulsar"),this.sessionId=t.sessionId}async initialize(){await this.importOTLDependencies(),this.initOTL()}async shutdown(){await(this.provider?.shutdown())}startSignal(e,t,n){if(!this.tracer)return void this.logger.error("startSignal: tracer is not initialized");const i=n||this.otlDependencies?.ROOT_CONTEXT;if("string"!=typeof e)return void this.logger.error("startSignal: name is not a string");const a=this.tracer.startSpan(e,t,i);if(a.setAttribute("sessionId",this.sessionId),i)return new Zi(this.logger,a,i,this);this.logger.error("startSignal: ctx is not defined")}startSignalFromCarrier(e,t,n){if(!t)return;if(!this.otlDependencies)return void this.logger.error("startSignalFromCarrier: OTL dependencies are not initialized");const{W3CTraceContextPropagator:i,ROOT_CONTEXT:a,defaultTextMapGetter:o}=this.otlDependencies,r=(new i).extract(a,t,o);return this.startSignal(e,n,r)}observeConsumerNotifications(){return this.consumerNotificationObserver.asObservable()}initOTL(){if(!this.otlDependencies)return void this.logger.error("initOTL: OTL dependencies are not initialized");const{WebTracerProvider:e,Resource:t,SemanticResourceAttributes:n,SimpleSpanProcessor:i,OTLPTraceExporter:a}=this.otlDependencies;this.provider=new e({resource:new t({[n.SERVICE_NAME]:this.serviceName})}),this.config.spanExporter.registerConsumerNotificationCallback((e=>{this.consumerNotificationObserver.next(e)})),this.provider.addSpanProcessor(new na(this.config.spanExporter,this.otlDependencies)),this.config.logToOTLCollector&&this.provider.addSpanProcessor(new i(new a({url:"http://localhost:4318/v1/traces"}))),this.tracer=this.provider.getTracer("pulsar-tracer")}async importOTLDependencies(){this.otlDependencies=await(0,ia.X)()}}class oa{constructor(){this.hasShutdown=!1,this.telemetryProvider=(0,Pt.AR)(),this.telemetryProvider.registerPulsarBackchannelListener(this.notify.bind(this))}export(e,t,n){this.hasShutdown||e.forEach((e=>{switch(n){case"onStart":this.telemetryProvider.sendPulsarSignal({type:"onStart",span:this.sanitizeSpan(e)});break;case"onEnd":this.telemetryProvider.sendPulsarSignal({type:"onEnd",span:this.sanitizeSpan(e)})}}))}registerConsumerNotificationCallback(e){this.consumerNotificationCallback=e}shutdown(){return this.hasShutdown=!0,Promise.resolve()}notify(e){this.consumerNotificationCallback?.(e)}sanitizeSpan(e){return{...e,_spanProcessor:void 0,_clock:void 0}}}class ra{constructor(e,t,n){this.storeManager=e,this.scope=t,this.sliceKey=n,this.storeManager.setSlice(t,this.sliceKey,{})}get(e){return this.storeManager.getSlice(this.scope,this.sliceKey)[e]}set(e,t){this.storeManager.updateSlice(this.scope,this.sliceKey,(n=>({...n,[e]:t})))}subscribe(e,t){return this.storeManager.subscribeToSlice(this.scope,this.sliceKey,((n,i)=>{const a=n[e],o=i[e];!1===(0,we.isEqual)(a,o)&&t(a)}))}dispose(){this.storeManager.removeSlice(this.scope,this.sliceKey)}}const sa=(e,t)=>(0,o.T)((n=>((e,t,n)=>(n&&(e._cleanupFns||(e._cleanupFns=[]),e._cleanupFns.push(n)),{...e,...t}))(n,e(n),t))),la=e=>sa((t=>({regenerateEntityCommandingServices:(n,i,a,o)=>(({activeWindowsService:e,appsRegistryService:t,authenticationUser:n,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,deeplinkService:l,hostCommunicationService:c,i18n:d,loggerFactory:u,notificationsHandler:m,phaseStateMachine:p,platformService:g,rebootService:h,scenarioFactory:v,shortcutExecutionService:y,stateManagementServices:S,userBiService:f,userContextId:k,userTrackingService:C,viewEntitiesRef:b,viewEntity:w,viewEntityName:T,windowId:I,windowLayoutService:N,windowProvider:A})=>ci((l=>Ct({activeWindowsService:e,authenticationUser:n,appsRegistryService:t,client:i,clientLaunchId:a,commandChangeReportingService:r,coreSettings:s,entityCommandInput:l,loggerFactory:u,platformService:g,scenarioFactory:v,windowId:I,executionContext:{userContextId:k,viewEntity:w,viewEntityName:T},windowProvider:A,userBiService:f,notificationsHandler:m,clientPreferences:o,userTrackingService:C,rebootService:h,hostCommunicationService:c})),((n,l)=>te({activeWindowsService:e,appsRegistryService:t,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,commandHandler:l,commandInput:n,coreSettings:s,executionContext:{userContextId:k,viewEntitiesRef:b,viewEntity:w,viewEntityName:T},host:A,loggerFactory:u,scenarioFactory:v,shortcutExecutionService:y,stateManagementServices:S,userBiService:f,windowId:I})),((e,n,l)=>me({appsRegistryService:t,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,commandDelegator:l,commandHandler:n,coreSettings:s,eventInput:e,executionContext:{userContextId:k,viewEntitiesRef:b,viewEntity:w,viewEntityName:T},viewportContext:A?.viewportContext,hostCommunicationService:c,i18n:d,loggerFactory:u,notificationsHandler:m,phaseStateMachine:p,scenarioFactory:v,shortcutExecutionService:y,stateManagementServices:S,userBiService:f,windowId:I})),i,s,A,v,u,l,c,k,I,N,w,a))({activeWindowsService:t.activeWindowsService,appsRegistryService:t.appsRegistryService,authenticationUser:t.authenticationUser,client:t.client,clientLaunchId:t.correlation.clientLaunchId||void 0,clientPreferences:t.clientPreferences,commandChangeReportingService:t.commandChangeReportingService,coreSettings:t.coreSettings,deeplinkService:t.deeplinkService,hostCommunicationService:t.hostCommunicationService,i18n:t.i18n,loggerFactory:t.loggerFactory,notificationsHandler:t.notificationsHandler,phaseStateMachine:o,platformService:t.platformService,rebootService:t.rebootService,scenarioFactory:t.scenarioFactory,shortcutExecutionService:t.shortcutExecutionService,stateManagementServices:t.stateManagementServices,userBiService:t.userBiService,userContextId:t.authenticationUser?(0,kt.Lw)(t.authenticationUser):void 0,userTrackingService:t.userTrackingService,viewEntitiesRef:n,viewEntity:i,viewEntityName:a,windowId:e,windowLayoutService:t.activeWindowsService.getWindowLayoutService(e),windowProvider:t.windowProvider})}))),ca=e=>{const{clientState:t,context$:n,isMainWindow:i,isNotificationsWindow:a,mainEntity:o,newHost:s,scenarioFactory:l,windowId:d}=e;return n.pipe((e=>e.pipe((e=>sa((()=>({windowProvider:e}))))(s),(e=>sa((t=>({loggerFactory:new Vi(t.diagnosticsService,e)}))))(d),((e,t)=>sa((({loggerFactory:n,postTaskSchedulerDiagnosticsService:i})=>({scheduler:new ji(new Ji,t,n,e,i)})),(({scheduler:e})=>e.destroy())))(d,s),((e,t)=>sa((n=>{const i=n.windowProvider.viewportContext,a=t.type,o=n.coreSettingsContext.createContextForViewport({id:e,viewportContext:i,entityType:a}),r=o.getCoreSettings();return{coreSettingsContext:o,coreSettings:r}}),(({coreSettingsContext:e})=>e.cleanup())))(d,o),(e=>sa((()=>({scenarioFactory:e})),(({scenarioFactory:e})=>e.destroy())))(l),(e=>sa((t=>({userBiService:t.telemetryService.createUserBiService(t,e,{id:t.correlation.id,startTimestamp:+t.correlation.startTimestamp||0,source:t.correlation.source})})),(({userBiService:e})=>e.destroy())))(d),((e,t)=>sa((({experienceChangeReportingService:n,authenticationUser:i})=>({experienceChangeReportingService:{...n,report:a=>{n.report({windowId:e,isMainWindow:t,userContextId:i?(0,kt.Lw)(i):void 0,...a})}}}))))(d,i),((e,t)=>sa((({activeWindowsService:n,appBarService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,authenticationService:s,authenticationUser:l,cacheStorage:d,cdlWorkerRegistrarService:u,cdlWorkerService:m,client:p,clientPreferences:g,clientState:h,commandChangeReportingService:v,coreSettings:y,dataCleanupService:S,discover:f,experienceChangeReportingService:k,hostCommunicationService:C,localStorage:b,loggerFactory:w,notificationsHandler:T,offlineCacheManager:I,platformService:N,rebootService:A,scenarioFactory:E,user:F,userBiService:_,windowProvider:D,i18n:P,brbServiceManager:M,entityCommanding:R,pulsar:x,cdlAppStateService:L,telemetryContextService:O,userActivityRecallService:j})=>{const B=p,U={activeWindowsService:n,appBarService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,authenticationService:s,authenticationUser:l,cacheStorage:d,cdlWorkerRegistrarService:u,cdlWorkerService:m,clientPreferences:g,clientState:h,commandChangeReportingService:v,coreSettings:y,dataCleanupService:S,discover:f,entityType:t,experienceChangeReportingService:k,hostCommunicationService:C,localStorage:b,loggerFactory:w,notificationsHandler:T,offlineCacheManager:I,platformService:N,pubsub:B.getServices().pubsub,rebootService:A,scenarioFactory:E,telemetryContextService:O,user:F,userBiService:_,windowId:e,windowProvider:D,i18n:P,brbServiceManager:M,entityCommanding:R,pulsar:x,cdlAppStateService:L,userActivityRecallService:j},{enableViewSchema:$}=y.get(c.w.Core);return{client:B.clone(U),viewSchemaClient:$?B.cloneForViewSchema?.(U):null}}),(({client:e,entityCommanding:t,viewSchemaClient:n,coreSettings:i})=>(n?.destroy(),e.destroy(),i.get(c.w.Core).enableMTMA&&e?.clearCache(),t.destroy()))))(d,o.type))),(e=>e.pipe(((e,t,n)=>sa((i=>(e&&i.notificationsHandler.initializeWithWindow(t,n,i.client),{notificationsHandler:i.notificationsHandler})),(()=>{})))(a,d,s),(e=>sa((t=>{const{stateManagementServices:n,authenticationUser:i}=t,{storeManager:a}=n;if(!i)return t;const o=new ra(a,"userwindow",`${i.id}/${e}`);return{stateManagementServices:{...n,userWindowStore:o}}}),(({stateManagementServices:e})=>{e.userWindowStore?.dispose()})))(d),((e,t)=>sa((n=>{const{appsRegistryService:i,authenticationUser:a,client:o,commandResultChangeReportingService:r,coreSettings:s,correlation:{clientLaunchId:l},deeplinkService:d,hostCommunicationService:u,loggerFactory:m,scenarioFactory:p}=n,{delegatedCommanding:g,entityCommanding:h,eventing:v}=ci((t=>Ct({activeWindowsService:n.activeWindowsService,appsRegistryService:n.appsRegistryService,authenticationUser:n.authenticationUser,client:n.client,clientLaunchId:n.correlation.clientLaunchId||void 0,commandChangeReportingService:n.commandChangeReportingService,coreSettings:n.coreSettings,entityCommandInput:t,loggerFactory:n.loggerFactory,notificationsHandler:n.notificationsHandler,platformService:n.platformService,rebootService:n.rebootService,scenarioFactory:n.scenarioFactory,executionContext:{userContextId:n.authenticationUser?(0,kt.Lw)(n.authenticationUser):void 0},windowId:e,userBiService:n.userBiService,clientPreferences:n.clientPreferences,userTrackingService:n.userTrackingService,hostCommunicationService:n.hostCommunicationService}).then()),((i,a)=>te({activeWindowsService:n.activeWindowsService,appsRegistryService:n.appsRegistryService,client:n.client,clientPreferences:n.clientPreferences,commandChangeReportingService:n.commandChangeReportingService,coreSettings:n.coreSettings,commandInput:i,commandHandler:a,loggerFactory:n.loggerFactory,scenarioFactory:n.scenarioFactory,shortcutExecutionService:n.shortcutExecutionService,windowId:e,host:t,userBiService:n.userBiService,stateManagementServices:n.stateManagementServices})),((t,i,a)=>me({appsRegistryService:n.appsRegistryService,client:n.client,clientPreferences:n.clientPreferences,commandChangeReportingService:n.commandChangeReportingService,commandDelegator:a,commandHandler:i,coreSettings:n.coreSettings,eventInput:t,hostCommunicationService:n.hostCommunicationService,i18n:n.i18n,loggerFactory:n.loggerFactory,notificationsHandler:n.notificationsHandler,scenarioFactory:n.scenarioFactory,shortcutExecutionService:n.shortcutExecutionService,stateManagementServices:n.stateManagementServices,userBiService:n.userBiService,windowId:e})),o,s,t,p,m,d,u,a?(0,kt.Lw)(a):void 0,e,n.activeWindowsService.getWindowLayoutService(e),void 0,l||void 0);let y=n.commandResultHooksService;return y&&s.get(c.w.Core)?.enableStandaloneCommandReportingService&&(y=new mi(i,o,r,s,h,m,p,n.authenticationUser&&(0,kt.Lw)(n.authenticationUser)),y.init()),{entityCommanding:h,eventing:v,commandResultHooksService:y,delegatedCommanding:g}}),(({commandResultHooksService:e})=>e?.destroy())))(d,s),sa((e=>({errorState:new wi(e.windowProvider,e.scenarioFactory,e.platformService,e.networkState,e.diagnosticsService,e.coreSettings,e.loggerFactory)})),(({errorState:e})=>e.dispose())),(e=>sa((()=>({clientState:e}))))(t),la(d),(e=>sa((t=>{const n=new Qi(t.client,t.windowProvider,t.coreSettings,e,t.activeWindowsService);return n.init(),{windowHistoryNavigationService:n}}),(({windowHistoryNavigationService:e})=>e.destroy())))(d),sa((e=>{const{enablePulsarTelemetry:t,logToOTLCollector:n}=e.coreSettings.get(c.w.Pulsar),i=new aa(Xi.TEAMS_RENDERING,{sessionId:e.platformService.host.sessionId,spanExporter:new oa,loggerFactory:e.loggerFactory,logToOTLCollector:!!n});return t&&i.initialize(),{pulsar:i}}),(({pulsar:e})=>e.shutdown())))),(e=>e.pipe(((e,t,n)=>sa((i=>(i.authenticationUser&&i.experienceLifecycleManager.manageWindow(e,i.authenticationUser.id,{...i,isMainWindow:t,isNotificationsWindow:n}),{})),(t=>t.authenticationUser&&t.experienceLifecycleManager.removeWindow(t.authenticationUser.id,e,"window_closed"))))(d,i,a))),(0,r.t)({bufferSize:1,refCount:!0}))},da=e=>{const{scenarioFactory:t,windowId:n,newHost:i,clientState:a,mainEntity:r,isMainStandardWindow:c,isNotificationsWindow:d,userContextId$:u,getRenderingContextById:m}=e,p=u.pipe((0,s.w)("userContextId"),(0,l.n)((({userContextId:e,correlation:t})=>m(e||void 0).pipe((0,o.T)((e=>({context:e,correlation:t})))))),(0,s.w)("context"),(0,o.T)((({context:e,correlation:t})=>({...e,correlation:t}))));return ca({clientState:a,context$:p,isMainWindow:c,isNotificationsWindow:d,mainEntity:r,newHost:i,scenarioFactory:t,windowId:n})},ua=e=>{const{coreServices:t,windowId:n,correlation:i,viewportContext:a,userContextId:o}=e;return t.telemetryService.createScenarioFactory(t,n,{id:i.id,startTimestamp:parseInt(i.startTimestamp,10)||0,source:i.source},i.clientLaunchId??void 0,a,o||"")};var ma;!function(e){e.DiagnosticsLogsMain="diagnostics-event-logs-main",e.DiagnosticsLogsWorker="diagnostics-event-logs-worker"}(ma||(ma={}));var pa,ga,ha,va,ya=n(553882),Sa=n(48842),fa=n(825141),ka=n(423534),Ca=n(751076),ba=n(763431),wa=n(773587);!function(e){e.Cold="Cold",e.Warm="Warm",e.Rollback="Rollback",e.Update="Update",e.Local="Local",e.Container="Container",e.Unknown="Unknown"}(pa||(pa={})),function(e){e.SessionID="tmp.sessionId",e.DeviceID="tmp.deviceId",e.IsRelaunchFromOOPs="tmp.relaunchFromOOPs",e.PreAuthUserID="tmp.preAuthUserId",e.T2WebOptInSessionId="tmp.t2WebOptInSessionId",e.AttemptedWebBootCount="tmp.numT2WebBootAttempts"}(ga||(ga={})),function(e){e.IndexPageReadStart="read-index-html",e.IndexPageSlowReadStart="slow-read-index-html",e.IndexPageStart="execute-index-html-script",e.CoreModuleLoaded="exp_loader_core_module_loaded",e.NotifyDesktop="exp_loader_notified_desktop",e.ConfigLoaded="exp_loader_config_loaded",e.MainChunksLoadingStart="exp_loader_load_bundles_start",e.MainChunksLoadingStop="exp_loader_load_bundles_stop",e.IndexPageStop="exp_loader_index_stop",e.AsyncEntryModuleFederationUrlsInited="exp_loader_init_module_federation_remote_urls_failure",e.AsyncEntryDownloadStart="exp_loader_async_entry_load_start",e.AsyncEntryDownloadStop="exp_loader_async_entry_load_stop",e.AsyncEntryImportFailure="exp_loader_import_async_entry_failure",e.ActivateAppStart="exp_loader_start_activate_app",e.ClientStartStop="client_start_stop"}(ha||(ha={})),function(e){e.ExpLoaderFailure="ExpLoaderFailure",e.LoadBundlesFailure="LoadBundlesFailure",e.ParseIndexPageFailure="ParseIndexPageFailure",e.CoreStartTimeout="CoreStartTimeout",e.PreTelemetryCoreInitFailure="PreTelemetryCoreInitFailure"}(va||(va={}));var Ta=n(622229);const Ia="core_life_cycle_start_",Na="core_task_end_",Aa="core_init_complete";var Ea=n(729720),Fa=n(306183),_a=n(129995),Da=n(565920);const Pa=(e,t,n,i)=>(0,fa.F)((0,_a.it)((async(n,a)=>async function(e,t,n,i){const a=e[Symbol.iterator](),o=t[Symbol.iterator]();let r=a.next(),s=o.next();const l=[];for(;!s.done||!r.done;)s.done||!r.done&&s.value.id>r.value[0].id?(await i(r.value[1]),r=a.next()):r.done||s.value.id<r.value[0].id?(l.push([s.value,n(s.value)]),s=o.next()):(l.push([s.value,r.value[1]]),r=a.next(),s=o.next());return l}(n,Array.from(a).sort(((e,t)=>e.id.localeCompare(t.id))),(t=>Ma(t,e,i)),(e=>Ra(e,t)))),[]),(0,o.T)((e=>xa(e,n))),(0,Da.H)((async e=>{const t=await e;return Promise.all(t)}))),Ma=async(e,t,n)=>{try{return{type:"value",value:await t(e)}}catch(t){return n&&n(e,t),{type:"error",error:t}}},Ra=async(e,t)=>{const n=await e;if("error"!==n.type)return t(Promise.resolve(n.value))},xa=async(e,t)=>{const n=[],i=await Promise.all(e);for(const e of i){const i=await e[1];"value"===i.type&&n.push(t(e[0],Promise.resolve(i.value)))}return n};var La=n(872600);const Oa={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"authenticationUsersEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsersEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"puid"}}]}},{kind:"Field",name:{kind:"Name",value:"subType"}},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"loginUserName"}},{kind:"Field",name:{kind:"Name",value:"homeAccountId"}}]}}]}}]}}]},ja={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"authenticationUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"puid"}}]}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"subType"}},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"loginUserName"}},{kind:"Field",name:{kind:"Name",value:"homeAccountId"}}]}}]}}]};var Ba=n(210841),Ua=n(803444),$a=n(678937),Wa=n(816410),Va=n(523861),Ha=n(747587),za=n(285793);const qa={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesActivatorIsEntityInActiveWindowQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEntityInActiveWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},Ga={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeWindow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},Ya={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"windowStateEvent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"windowStateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isFocused"}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"shouldClose"}}]}}]}}]};async function Qa(e,t,n,i,a){const o=function(e,t,n){const i=e.getValue().find((e=>{const n=!(!e||!e.window.document.hasFocus()),i=t.getState(),a=i===Ba.Lg.LongInactive||i===Ba.Lg.Inactive;return n&&!a}));return n.log(`Current window in focus is ${i?.id}`),i?.id}(i,n,a);if(a.log("Window in focus: ",o),!o)return a.log("There are no windows in focus"),!1;try{return(await t.query({query:qa,variables:{entity:e,windowId:o},fetchPolicy:"no-cache"})).data.isEntityInActiveWindow}catch(e){return a.error("isEntityInActiveWindowQuery failed"),!1}}const Ja=(e,t,n,i,a,o,r)=>{const{isFocused:s,shouldClose:l,correlation:c}=e&&e.data&&e.data.windowStateEvent;let d;const u=c?.id;l?(t.close(),r.log(`host.close() called through window state event with correlationId ${u}`),d=p.I.Close):s&&(t.isFocused()?(r.log(`host.isFocused() returns true with correlationId ${u}`),d=p.I.AlreadyFocused):(t.focus(),r.log(`host.focus() called through window state event with correlationId ${u}`),d=p.I.Focus,o.loadModule("windowcontrols").then((e=>{e?.focus?.(n),r.log(`HostComms focus() called through window state event with correlationId ${u}`)})))),d&&u&&(i.report({context:{target:"handle-window-state-event"},correlationId:u,type:d}),a.report({type:Ua.TZ.WindowStateChange,context:{target:"context-providers-handle-window-event"},correlationId:u,windowId:n}))},Ka=(e,t,n)=>{n.log(`Removing window ${e} from apollo cache`),t.client.mutate({mutation:Ga,variables:{windowId:e}}).catch((e=>n.error("Error in removing window: ",e)))},Za=(e,t)=>e.subscribe({query:Ya,variables:{windowId:t}});function Xa(e){return function(e,t){return(0,Wa.sanitize)(e,t)}(e,function(e,t){return{ADD_ATTR:e,ADD_TAGS:t,RETURN_TRUSTED_TYPE:!0,WHOLE_DOCUMENT:!0}}(["content","focusable","nonce","onclick"],["link","meta","script","#comment","!doctype"]))}const eo=(e,t,n)=>{const{enableThemePreferenceResolution:i}=t.get(c.w.Core),{environment:a}=t.get(c.w.Metadata);if(i){const t=(0,za.$E)(a??$a.B.prod);return(0,za.nv)(e,n,t)}return t.get(c.w.Host).theme||"default"};function to(e){return[e?.findScenario(be.Cu.ClientStart)??null,e?.findScenario(be.Cu.ExperienceReady)??null]}function no(e,t){return e instanceof Va.C?e:new Ha.a(Ha.D.UNKNOWN,e,t)}function io(e,t,n,i){return ao.bind(void 0,e,t,n,i)}async function ao(e,t,n,i){let a="";const o=e?.host;o&&(a=`SessionId:\t${o.sessionId}\r\nDeviceId:\t${o.deviceId}\r\nHostVersion:\t${o.hostAppVersion}\r\n`);const r=e?.config;if(r&&(a=`${a}WebVersion:\t${r?.clientVersion}\r\n`),t){a=`${a}Language(App):\t${t.locale}\r\nUserLanguage:\t${t.userLanguage}\r\n`;const e=t.osLocaleInfo;e&&(a=`${a}LocaleInfo:\r\n`,a=`${a}\tRegionalFormat:\t${e.regionalFormat}\r\n`,a=`${a}\tShortDate:\t${e.date?.shortDate}\r\n`,a=`${a}\tLongDate:\t${e.date?.longDate}\r\n`,a=`${a}\tShortTime:\t${e.date?.shortTime}\r\n`,a=`${a}\tLongTime:\t${e.date?.longTime}\r\n`,a=`${a}\tCalendar:\t${e.date?.calendar}\r\n`,a=`${a}\tFirstDayOfWeek:\t${e.date?.firstDayOfWeek}\r\n`)}const s=Intl.DateTimeFormat().resolvedOptions().timeZone,l=(new Date).getTimezoneOffset();(s||l)&&(a=`${a}TimeZone:\t${s}\tTimeZone Offset:\t${l}\r\n`);const d=i?.get(c.w.Metadata);d?.ring?.id&&(a=`${a}Ring:\t${d.ring.id}\r\n`),r?.vdi&&(a=`${a}Virtualization:\t${r?.vdi?.configFilter}\r\n`,a=`${a}vdiMode:\t${r?.vdi?.mode}\r\n`);const u=await(n?.getCachedUsers?.({...F({source:A.p.Core}),scenarioName:be.Cu.AuthWebCachedUser}));if(u?.length){a=`${a}Logged in users:\r\n`;for(const e of u)a=`${a}\t${e.userName}  ${e.profile.name}  TId:${e.profile.tid}  OId:${e.profile.oid}  UserId:${e.id}\r\n`}return a}var oo=n(136723);const ro=new Set([Ot.NV.quit,Ot.NV.restart]);async function so({hostCommunicationService:e,logger:t,reason:n,renderingContextManager:i}){let a;const o=i.getDefaultRenderingContext();switch(o?.scenarioFactory&&(a=co(n,o.scenarioFactory)),n){case"quit":try{await i.removeAllRenderingContexts(n),a?.mark(be.BQ.RemoveAllRenderingContexts),await async function(e,t,n){let i,a;try{i=await t.loadModule("core")}catch(e){a="LoadModuleCoreFailed"}try{await(i?.reportReadyToQuit?.())}catch(e){a="ReportReadyToQuitFailed"}if(!a)return;po(a,e,n)}(t,e,a),a?.stop()}catch(e){mo(e,t,a)}break;case"restart":try{await i.cleanupWithPriority(n),a?.stop()}catch(e){mo(e,t,a)}break;default:return}}async function lo({logger:e,reason:t,renderingContextManager:n,user:i}){let a;try{const e=i&&(0,kt.Lw)(i);if(!e)throw new Ha.a(Ha.D.CLEANUP,new Error("signout::UserContextIdNotFound"));const o=await n.getUserRenderingContext(e);if(!o)return;o.scenarioFactory&&(a=co(t,o.scenarioFactory)),await n.removeUserRenderingContext(t,e),a?.mark(be.BQ.RemoveUserRenderingContext);const r=["TestCookie","ringFinder"];!function(e){try{(0,Un.z)().sessionStorage.clear()}catch(t){uo(e,"ClearSessionStorageFailed")}}(a),function(e,t){try{Object.keys(oo.getJSON()).forEach((t=>{e.includes(t)||oo.remove(t)}))}catch(e){uo(t,"DeleteCookiesFailed")}}(r,a),a?.stop()}catch(t){mo(t,e,a)}}function co(e,t){const n=t.newScenario(be.Cu.CoreCleanup),i={reason:e};return n.appendEventData(i),n}function uo(e,t){const n={errorCode:t};e&&e.fail(n)}function mo(e,t,n){const i="UnknownCleanupFailure";let a;a=e instanceof Ha.a&&Va.C.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():e instanceof Error?`${Ha.D.CLEANUP}::${i}::${e?.name}::${e?.message}`:`${Ha.D.CLEANUP}::${i}::${(0,ge.hR)(e)}`,po(a,t,n)}function po(e,t,n){n&&uo(n,e),t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services",void 0,!0)}var go=n(339953),ho=n(867491);function vo(e,t){const n=t?.get(c.w.Core)?.enableStackTraceCollection;return{errorCode:e instanceof Va.C&&Va.C.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():void 0,stack:n&&e instanceof Va.C?e.stack:void 0}}function yo(e,t){return`${e}_core_task_end_${t||""}`}const So=(e,t)=>e.markStep(be.Cu.WindowLaunchTime,t);function fo(e,t,n,i,a=!1){const o=e.createScenarioWithoutStarting(be.Cu.CoreUserContextCreate,{startTime:n}),r=a?d.dy.OnUserAuthenticated_MTMA:d.dy.OnUserAuthenticated;return i&&function(e,t,n,i){const a=i.timeOrigin,o=i.getEntriesByName(t,"mark")||[];for(const t of o){const i=t.detail.taskId,o=t.detail.errorCode;e.mark(`${n}_${i}`,{overrideTimestamp:Math.round(t.startTime+a),errorCode:o})}i.clearMarks(t)}(o,yo(r,t),`core_task_${r}`,i),o}var ko=n(578640);const Co={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"setWindowFullscreen"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isFullscreen"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setWindowFullscreen"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"isFullscreen"},value:{kind:"Variable",name:{kind:"Name",value:"isFullscreen"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var bo=n(757346);const wo=(e,t)=>e.opener.postMessage(pi.yG.Destroy,{windowId:t});async function To(e,t,n,i,a,o,r,s){So(i,be.BQ.BeginWindowCreation);const l=e.windowProvider;if(t===d.N2)return l;const c=await function(e,t,n,i){return new Promise(((a,o)=>{const r=e.setTimeout((()=>{o("New Frame did not report in 10000ms")}),1e4),s=e.self;return s.frameResolvers=s.frameResolvers||{},s.frameResolvers[t]=n=>{e.clearTimeout(r),Po(e,t),a(n)},e.opener.postMessage(pi.yG.Create,{windowId:t,correlation:n,activeEntities:i})}))}(l,t,a,s);if(!c)return l;const u=(0,ko.W3)(c,e,t,o,r),m=u.getHostedWindowContext();return Object.assign(u,{getHostedWindowContext:()=>({...m,windowId:t}),viewportContext:go.k.iFrame}),So(i,be.BQ.EndWindowCreation),Ro(c,t,u.viewportContext,s),Ro(u,t,u.viewportContext,s),Io(c,u,e,t,n),u.close=()=>wo(l,t),u}const Io=(e,t,n,i,a,o)=>{No(n,e,t);const r="onpagehide"in t?"pagehide":"unload",s=t.onFullscreen().subscribe((e=>{n.client.mutate({mutation:Co,variables:{isFullscreen:e,windowId:i}})})),l=()=>{e&&xo(e),xo(t),Ka(i,n,a),o&&o(),t.removeEventListener(r,l),s.unsubscribe()};t.addEventListener(r,l)},No=(e,t,n)=>{const i=e.leakDetectorService?.create();i?.track(bo.J.UnwrappedIFrame,t),i?.track(bo.J.IFrameWrapper,n)},Ao=async({id:e,activeEntities:t},n)=>{const{window:i,context$:a}=await n;return{id:e,window:i,context$:a,activeEntities:t}},Eo=(e,t,n,i,a,o)=>(0,fa.F)(Pa((async a=>_o(a,e,t,n,i,o)),(e=>async function(e,t){const{window:n,subscription:i,clientState:a}=await t,o=n.location.hash?.slice(1);o?wo(n,o):n.close(),i&&i.unsubscribe(),a&&a.dispose(),e?.cleanup(),n.destroy(0)}(t.leakDetectorService,e)),Ao,((e,n)=>((e,t,n)=>{const i=n.loggerFactory.newLogger("IframeStateManager","core-services-activator");i.error(`Creation for window ${e.id} failed with ${t}. Removing window from cache`),n.commandChangeReportingService.report({context:{target:"iframe-state-manager",errorInfo:k.Q.CreateWindowError},correlationId:e.correlation.id,type:p.I.Failure}),Ka(e.id,n,i)})(e,n,t)))),Fo=async(e,t,n,i,a,o,r,s,l,c,d)=>e&&t?Promise.resolve(((e,t,n,i,a,o,r)=>{const s=t.windowProvider,l=s.open(void 0,e,"width=600px,height=500px,toolbar=no,menubar=no,location=no");if(r){const{clientPreferences:e,coreSettings:n}=t,i=r({theme:eo(e,n,s),viewportContext:go.k.iFrame});l.document.write(i),l.document.close()}const c=()=>{const e=new URL(s.location.href);e.searchParams.append("random",Date.now().toString()),e.hash=[s.location.pathname,i.mainEntity.type,encodeURIComponent(i.mainEntity.id)].join("/"),l.location.href=decodeURIComponent(e.href)};s.addEventListener("unload",c);let d=(0,ko.W3)(l,t,e,a,o);return d=Object.assign(d,{getHostedWindowContext:()=>({startReason:ho.bG.userInitiated,panelContext:ho.GM.secondary})}),Ro(l,e,d.viewportContext,i),Ro(d,e,d.viewportContext,i),Io(l,d,t,e,n,(()=>{s.removeEventListener("unload",c)})),d})(i,n,a,s,l,c,d)):To(n,i,a,o,r,l,c,s),_o=async(e,t,n,i,a,o)=>{const{id:r,correlation:s,activeEntities:l,isMainWindow:d,layoutConfig:{layoutMode:u}}=e,{coreSettings:m}=n,p=s.source===A.p.PopOutButton,{enablePopOutChats:g}=m.get(c.w.Messaging),h=new Vi(n.diagnosticsService,r),v=h.newLogger("IframeStateManager","core-services-activator"),y={...n,loggerFactory:h},S=i({coreServices:y,windowId:r,correlation:s,viewportContext:go.k.iFrame});return Do(t,y,v,r,s,l,p,g,S,d,u,a,o)},Do=async(e,t,n,i,a,o,r,s,l,c,d,u,m)=>{const p=await Fo(s,r,t,i,n,l,a,o,c,d,m),g=Za(t.client,i).subscribe((e=>Ja(e,p,i,t.commandChangeReportingService,t.experienceChangeReportingService,t.hostCommunicationService,n))),h=t.clientState.getChildWindowStateProvider(p,t.loggerFactory,t.coreSettings),{mainEntity:v}=o,y=Mo(p,i,c,g,h,e,l,a,v,u);return So(l,be.BQ.WindowContextProvider),y},Po=(e,t)=>e.opener.postMessage(pi.yG.Acquired,{windowId:t}),Mo=(e,t,n,i,a,r,s,l,c,d)=>({window:e,subscription:i,clientState:a,context$:d({context$:r(void 0).pipe((0,o.T)((e=>({...e,correlation:l})))),scenarioFactory:s,windowId:t,isMainWindow:n,isNotificationsWindow:!1,newHost:e,clientState:a,mainEntity:c})}),Ro=(e,t,n,i)=>{e.iframeLeakInfo={iframeLeakInfoStartTime:(new Date).toISOString(),iframeLeakInfoEntities:Object.keys(i).reduce(((e,t)=>{const n=i[t],a=n&&"object"==typeof n&&"type"in n?n?.type:void 0;return a&&(e[t]=a),e}),{}),iframeLeakInfoViewportContext:n,iframeLeakInfoWindowId:t}},xo=e=>{e.iframeLeakInfo||(e.iframeLeakInfo={}),e.iframeLeakInfo.iframeLeakInfoEndTime=(new Date).toISOString()};var Lo=n(583216),Oo=n(878138),jo=n(575061),Bo=n(193406),Uo=n(490850),$o=n(774948);const Wo=(e,t)=>!!(e===t||!e&&!t||e&&t&&e.id===t.id&&e.type===t.type&&e.action===t.action);function Vo(e,t){if(!t||!t.activeEntities)return!1;const n=t.activeEntities?.mainEntity,i=e.activeEntities?.mainEntity;return!Wo(i,n)&&!function(e,t){const n=["midNavEntity","subNavEntity","headerEntity","startEntity","mainEntity","endEntity"];for(const i of n)if(e[i]||t[i])return Wo(e[i],t[i]);return!1}(e.activeEntities,t.activeEntities)}const Ho=({dataCleanupService:e})=>({isChanged:zo,execute:t=>{e?.markDataForWindowAsInactive(t.id)}});function zo(e,t){return function(e){return!!e.isMainWindow&&e.layoutConfig?.layoutMode===Yt.Rm.standard}(e)&&function(e,t){if(!t||!t.activeEntities)return!1;const n=t.activeEntities?.mainEntity,i=e.activeEntities?.mainEntity;return!Wo(i,n)}(e,t)}const qo=e=>({isChanged:(e,t)=>!e.isMainWindow&&!e.isNotificationsWindow&&Vo(e,t),execute:(t,n)=>function(e,t,n){const i=t.activeEntities.mainEntity,a=n?.activeEntities.mainEntity,o=e.appsRegistryService.getApp({entityType:i.type});if(!o)throw new Error("Entity does not match to an existing app");const r=o.getAppWindowFeatures?.({coreServices:e,host:t.window,isResize:!0,prevEntityType:a?.type,entityType:i?.type});if(!r)return;const{width:s,height:l,minWidth:c,minHeight:d}=r,{window:u}=t,m=e.loggerFactory.newLogger("WindowResizeCommand","core-services-activator");m.log(`From ${a?.type} of height ${u.innerHeight} and width ${u.innerWidth}, to ${i.type} of height ${l} and width ${s}`),c&&d&&(u.setMinimumSize&&u.setMinimumSize(c,d),e.hostCommunicationService.loadModule("windowcontrols").then((e=>e?.setMinimumWindowSize?.(t.id,c,d))));s&&l&&(u.setBounds&&u.setBounds({x:u.screenX,y:u.screenY,width:s,height:l}),e.hostCommunicationService.loadModule("windowcontrols").then((e=>e?.setWindowBounds?.(t.id,void 0,void 0,Math.trunc(s),Math.trunc(l)))))}(e,t,n)});const Go=({coreSettings:e,hostCommunicationService:t,platformService:n})=>({isChanged:(e,t)=>!(!e.isMainWindow||e.layoutConfig&&e.layoutConfig.layoutMode!==Yt.Rm.standard||e.userContextId===t?.userContextId),execute:async i=>{const{enableSettingUserContextIdOnWindow:a}=e.get(c.w.Core);if((a||(0,Uo.J)(e,n))&&i.userContextId){const e=await t.loadModule("core");e?.setUserContextIdOnWindow?.(i.userContextId,i.id)}}});function Yo(e){return!e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"bigint"==typeof e||"symbol"==typeof e}function Qo(e){return function(t){const n=t&&("error"in t&&t.error||"reason"in t&&t.reason);return e.setTimeout((()=>function(e){if(e instanceof Error){const t=e.stack,n=e.message,i=e.code;Error.captureStackTrace?.(e),Object.setPrototypeOf(e,{});for(const t of Reflect.ownKeys(e))delete e[t];e.message=Yo(n)?n:JSON.stringify(n),e.stack=Yo(t)?t:JSON.stringify(t),e.code=Yo(i)?i:JSON.stringify(i),Reflect.preventExtensions(e)}}(n)),0),console.error("Unhandled error/rejection",t),t&&t.preventDefault&&t.preventDefault(),!0}}function Jo(e){!function(e){for(const t in e.console){const n=t;if("function"!=typeof e.console[n]||"Console"===n||"assert"===n||"dir"===n||"dirxml"===n||"table"===n)continue;const i=e.console[n];e.console[n]=function(...e){return i(...e.map((e=>{if(Yo(e))return e;try{return JSON.stringify(e)}catch{return`Can't stringify ${e} - circular reference`}})))},Object.defineProperty(e.console[n],"name",{value:n,writable:!1})}}(e);const t=Qo(e);e.addEventListener("unhandledrejection",t),e.addEventListener("error",t)}const Ko=({coreSettings:e,windowProvider:t})=>({isChanged:(e,t)=>Vo(e,t),execute:n=>{const{enableUpdateViewportOverride:i}=e.get(c.w.Core);if(!i)return;const a=t.viewportContext;n.context$.subscribe((e=>e.coreSettingsContext.updateViewportOverrideProviderSettings({id:n.id,viewportContext:a,entityType:n.activeEntities.mainEntity.type}))).unsubscribe()}});function Zo(e,t,n,i,a,o,r,s,l){let d={},u={};if(l)d=l({coreServices:e,host:t,screenState:a,windowOptions:i,entityType:n,entityOptions:s})||{};else{const o=e.appsRegistryService.getApp({entityType:n});if(!o)throw new Error("Entity does not match to an existing app");u=o.getAppWindowFeatures?.({coreServices:e,host:t,screenState:a,windowOptions:i,entityType:n,entityOptions:s})||{}}const{additionalFeatures:m={},...p}={...d,...u};if(e.coreSettings.get(c.w.Core).enableReflow){const e=Math.min(p.minWidth?p.minWidth:p.width||0,360),t=Math.min(p.minHeight?p.minHeight:p.height||0,360);m.minHeight=`${t}`,m.minWidth=`${e}`,p.minHeight=t,p.minWidth=e}const{width:g,height:h,minWidth:v,minHeight:y}=p;void 0!==g&&void 0!==v&&g<v&&(p.width=v),void 0!==h&&void 0!==y&&h<y&&(p.height=y);let S=Object.keys(p).reduce(((e,t)=>`${e}${e?",":""}${t}=${p[t]}`),"");return S=e.platformService.config.clientType===nt.sK.Web?`${S},toolbar=no,menubar=no,location=no`:S,r=Object.keys(m).reduce(((e,t)=>m?(0,Bo.rs)(e,t,m[t]):e),r),o.log(`windowFeatures: ${S}, url: ${r}`),{url:r,windowFeatures:S}}const Xo=(e,t)=>{switch(t){case"standard":return(0,Bo.rs)(e,"window",ho.zl.main);case"minimal":return(0,Bo.rs)(e,"window",ho.zl.flyout);case"minimode":return(0,Bo.rs)(e,"window",ho.zl.minimode);default:return e}},er=(e,t,n,i,a,o,r,s,l,d,u,m,p,g,h,v)=>{let y="",S="about:blank";const{coreSettings:f,platformService:k}=t;"minimode"!==u&&(S=k.config.clientType!==nt.sK.Web?(0,Bo.rs)(S,"entityType",r.type):S);const C={url:S,windowId:n,windowFeatures:y,globalWindow:e,coreServices:t,logger:i,scenarioFactory:a,windowState:o,mainEntityType:r.type,isMainWindow:l,isNotificationsWindow:d,layoutMode:u,userContextId$:p,templateGenerator:h};if(k.config.clientType===nt.sK.Maglev){const{addWindowIdQsp:a,enableSettingUserContextIdOnWindow:o}=f.get(c.w.Core),{enablePinchToZoomTouchpad:h}=f.get(c.w.Calling);a&&(S=(0,Bo.rs)(S,"windowId",n)),h&&(S=(0,Bo.rs)(S,"pinchzoom","true"));const v=p.value.userContextId;if((o||(0,Uo.J)(f,k))&&v&&(S=(0,Bo.rs)(S,"userContextId",v)),S=((e,t)=>t?(0,Bo.rs)(e,"show","false"):e)(S,m),l)return tr(e,t,i,r,s,u,g,S,y,C);d&&(S=nr(S,f)),S=(0,Bo.rs)(S,"customframetheme","default")}return({url:S,windowFeatures:y}=Zo(t,e,r.type,g??r.windowOptions,s,i,S,r.options,v)),ir({...C,url:S,windowFeatures:y})},tr=(e,t,n,i,a,o,r,s,l,d)=>{if("standard"===o){const{flushViewSchemaClient:e}=t.coreSettings.get(c.w.Core);e&&t.client?.viewSchemaClient?.clearStore(),s=(0,Bo.rs)(s,"customframetheme","main")}else"minimode"===o&&(({url:s,windowFeatures:l}=Zo(t,e,i.type,r??i.windowOptions,a,n,s,null)),s=(0,Bo.rs)(s,"customframetheme","nobuttons"),l.split(",")?.forEach((e=>{s=(0,Bo.rs)(s,e.split("=")[0],e.split("=")[1])})));return ir({...d,url:Xo(s,o),windowFeatures:l})},nr=(e,t)=>{const{enableToastContentProtection:n}=t.get(c.w.Notifications);let i=e;return n&&(i=(0,Bo.rs)(i,"contentprotection","true")),i=(0,Bo.rs)(i,"window",ho.zl.notifications),i=(0,Bo.rs)(i,"show","false"),i},ir=({url:e,windowId:t,windowFeatures:n,globalWindow:i,coreServices:a,logger:o,scenarioFactory:r,windowState:s,mainEntityType:l,isMainWindow:d,isNotificationsWindow:u,layoutMode:m,userContextId$:p,templateGenerator:g})=>{let h=i.open(e,t,n||void 0);const{enableRetryWindowOpen:v}=a.coreSettings.get(c.w.Core);if(v){const a=(e,t)=>{const n=e;let i=!1;try{i=!n||!n.ResizeObserver||!n.caches}catch{i=!0}return i?o?.errorToTelemetry?.(`${t}, window is missing APIs.`,"webclient_framework_foundation_core_services_activator",void 0,!0):o?.infoToTelemetry?.(`${t}, window is not missing APIs.`,"webclient_framework_foundation_core_services_activator",void 0,!0),i};a(h,"Initial window.open")&&(h=i.open(e,t,n||void 0),a(h,"Retried window.open"))}if(!h)throw new Ha.a(Ha.D.WINDOW_UNDEFINED);var y;(y=h)._leakOverrides||(y._leakOverrides=!0,Jo(y));const S=(0,ko.W3)(h,a,t,d,m);yr(h,t,S.viewportContext,e),yr(S,t,S.viewportContext,e),o.log(`windowState: ${JSON.stringify(s)}`);const{minWidth:f=0,minHeight:k=0}=s;S.setMinimumSize&&S.setMinimumSize(f,k),ar(i,S,a,g),So(r,be.BQ.EndWindowCreation),or(h,S,l,a,m,r,p,t,o),rr(a,S,h);const{enableHostHistoryNavigation:C}=a.coreSettings.get(c.w.Core);return C||u||S.history.pushState("defaultBrowserHistory",""),S},ar=(e,t,n,i)=>{if(!i)return;if(!!t.document.getElementById("app"))return;const{clientPreferences:a,coreSettings:o,platformService:r}=n,s=r.config.clientVersion.split("/").pop(),l=Xa(i({theme:eo(a,o,e),osPlatform:r.config.osPlatform,cspNonce:e.__webpack_nonce__,publicPathScript:`window.__webpack_public_path__="${r.config.publicPath}"`,containerVer:s,environment:o.get(c.w.Metadata).environment||"",viewportContext:t.viewportContext,shouldStubConsoleError:!0}));t.document.write(l),t.document.close()},or=(e,t,n,i,a,o,r,s,l)=>{const{disableMainWindowMouseListeners:u,enableActiveWindowsHistoryRecovery:m}=i.coreSettings.get(c.w.Core),{interactionToNextPaintService:p}=i,g=p?.track(t,n),h=()=>{t.opener.postMessage(pi.pI.UnhandledMouseEvent,{type:"mousemove"})},v=()=>{t.opener.postMessage(pi.pI.UnhandledMouseEvent,{type:"click"})},y=e=>{if(!(e=>{const t=e.target,n=t.nodeName?.toLowerCase(),i=t.type?.toLowerCase();return!(!t||!(t.isContentEditable||"textarea"===n||"input"===n&&/^(?:text|email|number|search|tel|url|password)$/i.test(i)))})(e))return e.preventDefault(),!1},S="onpagehide"in t?"pagehide":"unload",f=(e=>{const{disableContextMenu:t}=e.get(c.w.Core);return!!t})(i.coreSettings),k=t.onFullscreen().subscribe((e=>{i.client.mutate({mutation:Co,variables:{isFullscreen:e,windowId:s}})})),C=()=>{if(r.isStopped)return;const{correlation:{id:e},userContextId:n}=r.value;i.experienceChangeReportingService.report({correlationId:e,type:Ua.TZ.WindowOptionsChange,userContextId:n||void 0,windowId:s,context:{target:"window-state-manager",height:t.innerHeight,left:t.screenX,top:t.screenY,width:t.innerWidth}})},b=m&&i.platformService.config.clientType===nt.sK.Maglev&&"focus"===a&&s!==d.N2,w=b&&(0,Lo.R)(t,"resize").pipe((0,Oo.B)(500)).subscribe(C),T=b&&r.pipe((0,Oo.B)(500)).subscribe(C),I=()=>{l.log(`${S} called for window ${s}`),e&&Sr(e),Sr(t),vr(o),Ka(s,i,l),t.document.removeEventListener("mouseenter",h),t.document.removeEventListener("click",v),f&&t.removeEventListener("contextmenu",y),t.removeEventListener(S,I),l.log(`blur/unload listeners removed for windowId: ${s}`),k.unsubscribe(),w&&w.unsubscribe(),T&&T.unsubscribe(),g?.()};s!==d.N2||u||(t.document.addEventListener("mouseenter",h),t.document.addEventListener("click",v)),t.addEventListener(S,I),f&&t.addEventListener("contextmenu",y)},rr=(e,t,n)=>{const i=e.leakDetectorService?.create();i?.track(bo.J.UnwrappedWindow,n),i?.track(bo.J.WindowWrapper,t)},sr=(e,t,n,i,a,o,r)=>{return(0,fa.F)((0,$o.u)((i=>lr(i,e,t,n,a,o,r)),(e=>ur(e,t)),mr,((e,n)=>((e,t,n)=>{let i,a;const o=n.loggerFactory.newLogger("WindowStateManager","core-services-activator");t instanceof Ha.a&&Va.C.isFunction(t.toTelemetryEntry)?(i=t.code,a=t.toTelemetryEntry()):(i=k.Q.CreateWindowError,a=(0,ge.hR)(t)),o.error(`Creation for window ${e.id} failed with ${a}. Removing window from cache`),n.commandChangeReportingService.report({context:{target:"window-state-manager",errorInfo:i,errorMessage:a},correlationId:e.correlation.id,type:p.I.Failure}),Ka(e.id,n,o)})(e,n,t))),hr([Go(t),qo(t),Ko(t),Ho(t)]),(s=t.platformService.config.clientType===nt.sK.Web,l=e=>gr(e,t),e=>s?e.pipe((0,wa.M)((e=>l(e)))):e));var s,l},lr=(e,t,n,i,a,o,r)=>{const{id:s,activeEntities:l,correlation:c,screenState:d,isMainWindow:u,isNotificationsWindow:m,layoutConfig:{layoutMode:p},isInitialWindowStateHidden:g,userContextId:h,windowOptions:v}=e,{mainEntity:y,endEntity:S}=l,f=new Vi(n.diagnosticsService,s),k=f.newLogger("WindowStateManager","core-services-activator"),C={...n,loggerFactory:f},b=i({coreServices:C,windowId:s,correlation:c,viewportContext:(0,ko.Q7)(u,p),userContextId:h}),w=b.findScenario(be.Cu.WindowLaunchTime);let T;return w?.appendEventData({mainEntityType:y.type,endEntityType:S?.type}),T=r?r({coreServices:n,isResize:!0,entityType:y.type,windowOptions:v})||{}:((e,t,n)=>{const i=e.appsRegistryService.getApp({entityType:t.type}),a=i?.getAppWindowFeatures?.({coreServices:e,isResize:!0,entityType:t.type,windowOptions:n});return a||{}})(C,y,v??y.windowOptions),cr(t,h,C,s,y,k,b,T,c,d,u,m,p,g,v,a,o,r)},cr=(e,t,n,i,a,o,r,s,l,c,u,m,g,h,v,y,S,f)=>{const k=new ya.t({userContextId:t,correlation:l}),C=((e,t,n,i,a,o,r,s,l,c,u,m,p,g,h)=>{So(i,be.BQ.BeginWindowCreation),n.log(`mainEntityId: ${o.id}, mainEntityType: ${o.type}, mainEntityAction: ${o.action}`);const v=e.windowProvider;return t===d.N2?(or(void 0,v,o.type,e,c,i,m,t,n),v):er(v,e,t,n,i,a,o,r,s,l,c,u,m,p,g,h)})(n,i,o,r,s,a,c,u,m,g,h,k,v,S,f),b=((e,t,n,i)=>Za(e.client,t).subscribe((a=>Ja(a,n,t,e.commandChangeReportingService,e.experienceChangeReportingService,e.hostCommunicationService,i))))(n,i,C,o),w=n.clientState.getChildWindowStateProvider(C,n.loggerFactory,n.coreSettings),T=dr(C,i,k,b,w,e,r,a,u&&"standard"===g,m,n.loggerFactory,y,n.leakDetectorService);return So(r,be.BQ.WindowContextProvider),n.commandChangeReportingService.report({context:{target:"window-state-manager-create-window",layoutMode:g},correlationId:l.id,type:p.I.WindowCreated,isMainWindow:u,userContextId:t}),T},dr=(e,t,n,i,a,o,r,s,l,c,d,u,m)=>({id:t,window:e,windowStateSubscription:i,clientState:a,leakDetectorService:m,loggerFactory:d,userContextId$:n,context$:u({scenarioFactory:r,windowId:t,newHost:e,clientState:a,mainEntity:s,isMainStandardWindow:l,isNotificationsWindow:c,userContextId$:n,getRenderingContextById:o})}),ur=({clientState:e,id:t,window:n,windowStateSubscription:i,loggerFactory:a,leakDetectorService:o},r)=>{const s=a.newLogger("WindowStateManager","core-services-activator");s.log(`Destroy called on window ${t}`),t!==d.N2&&(n&&n.close(),s.log(`Window.close() called for window ${t}`),n?.destroy(500)),i?.unsubscribe(),o?.cleanup(),e.dispose(),r.appsRegistryService.removeWindowViewState(t)},mr=({activeEntities:e,correlation:t,id:n,isMainWindow:i,isNotificationsWindow:a,layoutConfig:o,userContextId:r},{context$:s,window:l,userContextId$:c})=>(c.next({userContextId:r,correlation:t}),{activeEntities:e,context$:s,id:n,isMainWindow:i,isNotificationsWindow:a,layoutConfig:o,userContextId:r,window:l});let pr;const gr=(e,t)=>{const n=t.loggerFactory.newLogger("WindowStateManager","core-services-activator"),{isChatHybridArchitectureEnabled:i}=t.coreSettings.get(c.w.Host);if(i){if(!e.find((e=>e.id===d.N2)))return}const a=t.windowProvider,o="onpagehide"in a?"pagehide":"unload";a.removeEventListener(o,pr),pr=()=>{n.log(`Global window unload handler called for ${e.length} windows`),e.forEach((e=>{e.id!==d.N2&&e.window.close()}))},a.addEventListener(o,pr,{once:!0})},hr=e=>(0,jo.S)(((t,n)=>(n.forEach((n=>{const i=t.find((e=>e.id===n.id));e.forEach((e=>{e.isChanged(n,i)&&e.execute(n,i)}))})),n)),[]),vr=e=>{e.stopScenarioIfActive(be.Cu.WindowLaunchTime,{},"abandoned")},yr=(e,t,n,i)=>{const a=new URL(i);e.windowLeakInfo={windowLeakInfoStartTime:(new Date).toISOString(),windowLeakInfoEntityType:a.searchParams.get("entityType")||i,windowLeakInfoViewportContext:n,windowLeakInfoWindowId:t}},Sr=e=>{e.windowLeakInfo||(e.windowLeakInfo={}),e.windowLeakInfo.windowLeakInfoEndTime=(new Date).toISOString()},fr="HostComms:: ";var kr,Cr;!function(e){e.LoadModuleCoreFailed="LoadModuleCoreFailed",e.LoadModuleOsUtilsFailed="LoadModuleOsUtilsFailed",e.LoadModuleScenarioFailed="LoadModuleScenarioFailed",e.LoadModuleTelemetryFailed="LoadModuleTelemetryFailed",e.LoadModuleWebClientStatesFailed="LoadModuleWebClientStatesFailed",e.ExecuteCommandFailed="ExecuteCommandFailed",e.RegisterForAppStateChangedFailed="RegisterForAppStateChangedFailed",e.ReportReadyToQuitFailed="ReportReadyToQuitFailed"}(kr||(kr={})),function(e){e.LoadModuleCoreSuccess="LoadModuleCoreSuccess",e.ExecuteCommandSuccess="ExecuteCommandSuccess"}(Cr||(Cr={}));class br extends Va.C{static fromExecutionError(e,t){return new br({code:"EXECUTION_FAILURE",taskName:e,prevError:t})}static fromMissingDependencies(e,t){return new br({code:"MISSING_DEPENDENCIES",taskName:e,dependencies:t,message:`${JSON.stringify(t)} are required, but not initialized.`})}constructor({code:e,taskName:t,prevError:n,dependencies:i,message:a}){super({type:"TaskError",code:e,prevError:n,message:a}),this.taskName=t,this.missingDependencies=i}getBoundaryProps(){return"EXECUTION_FAILURE"===this.code&&this.prevError instanceof Va.C?this.prevError.getBoundaryProps():super.getBoundaryProps()}toJSON(){return{...super.toJSON(),taskName:this.taskName,prevError:this.prevError,missingDependencies:JSON.stringify(this.missingDependencies)}}toTelemetryCode(){return`[${this.type}::${this.taskName}::${this.code}::${this.missingDependencies?.join()}]`}static fromSerialized(e){if("TaskError"!==e?.type)return null;const t=new br({code:e.code,taskName:e.taskName,prevError:e.prevError,dependencies:e.dependencies});return t.deserialize(e),t}}var wr=n(316178);class Tr{get defaultCoreSettings(){return this.defaultRenderingContext?.context.coreSettings}constructor(e,t,n){this.contextFactory=e,this.handleError=t,this.userRenderingContextMap=new Map,this.logger=n.newLogger("RenderingContextManager","core-services-activator")}async cleanupWithPriority(e){if(!this.defaultRenderingContext)return Promise.reject(new Ha.a(Ha.D.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=this.userRenderingContextMap.keys(),n=Array.from(t).map((t=>()=>this.cleanupActiveWindowsHistoryService(e,t)));await Nr(n,this.defaultCoreSettings)}async createCoreServices(){this.logger.log("createCoreServices: start");const e=await this.contextFactory.createContext();this.defaultRenderingContext=e,this.logger.log("createCoreServices: done");const t=e.context,n=t&&Object.keys(t).sort(),i=`createCoreServices: ${(0,ge.hR)(n)}`;return this.logger.infoToTelemetry?.(i,"webclient_framework_foundation_rendering_context_manager",void 0,!0),e.coreServicesCriticalError=Ir(e.coreTaskErrors,this.defaultCoreSettings,this.logger),e}async executePrimaryUserTasks(e){if(!this.defaultRenderingContext)return Promise.reject(new Ha.a(Ha.D.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=(0,kt.Lw)(e);this.logger.log(`executePrimaryUserTasks(${t}): start`);const n=await this.contextFactory.createContext({authenticationUser:e,defaultCoreSettings:this.defaultCoreSettings,defaultRenderingContext:this.defaultRenderingContext,isPrimaryUser:!0}),i=Ir(n.coreTaskErrors,this.defaultCoreSettings,this.logger);return delete n.context.authenticationUser,this.primaryUserContext=n,i&&this.handleError(i),this.logger.log(`executePrimaryUserTasks(${t}): done`),this.primaryUserContext.context}async removeAllRenderingContexts(e){if(!this.defaultRenderingContext)return Promise.reject(new Ha.a(Ha.D.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=this.userRenderingContextMap.keys(),n=Array.from(t).map((t=>()=>this.removeUserRenderingContext(e,t)));await Nr(n,this.defaultCoreSettings),this.primaryUserContext&&await this.contextFactory.destroyContext({context:this.primaryUserContext,reason:e}),await this.contextFactory.destroyContext({context:this.defaultRenderingContext,reason:e})}getUserRenderingContext(e){return this.userRenderingContextMap.get(e)?.then((e=>e.context))}getDefaultRenderingContext(){return this.defaultRenderingContext?.context}async getOrCreateUserRenderingContext(e){const t=(0,kt.Lw)(e);if(!this.defaultRenderingContext)return Promise.reject(new Ha.a(Ha.D.RENDERING_CONTEXT_DOES_NOT_EXIST,void 0,t));let n=this.userRenderingContextMap.get(t);if(n){!!this.defaultCoreSettings?.get(c.w.Core)?.enableExperienceLifeCycleSignalsLogging&&this.logger.infoToTelemetry?.("User context already exists","webclient_framework_foundation_core_services_life_cycle_signals",{userId:t})}else n=this.createUserContextWithTelemetry(e,this.defaultRenderingContext),this.userRenderingContextMap.set(t,n);return(await n).context}async removeUserRenderingContext(e,t){const n=this.userRenderingContextMap.get(t);if(n){let i;"unknown_destroy"===e&&this.logger.errorToTelemetry?.(`Removing user context due to unknown. userRenderingContextSize: ${this.userRenderingContextMap.size}`,"webclient_framework_foundation_rendering_context_manager",void 0,!0),this.userRenderingContextMap.delete(t);try{i=await n}catch(e){let t;return t=e instanceof Va.C&&Va.C.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():e&&`${e.name}::${e.message}`,this.logger.errorToTelemetry?.(`${Ha.D.CLEANUP}::contextPromise::${t}`,"webclient_framework_foundation_rendering_context_manager",void 0,!0),!1}return e="unknown_destroy"===e?"signout":e,await this.cleanupUserRenderingContext(i,e),this.primaryUserContext?.context.primaryUser?.id===t&&await this.cleanupPrimaryUserContext(e),!0}return this.logger.warn("RenderingContextManager::contextPromise is not defined"),!1}getExistingContextForId(e){if(!e){const e=this.getDefaultRenderingContext();return e&&Promise.resolve(e)||Promise.reject(new Ha.a(Ha.D.RENDERING_CONTEXT_DOES_NOT_EXIST))}return this.getUserRenderingContext(e)}async createUserContextWithTelemetry(e,t){const{coreSettings:n,scenarioFactory:i}=t.context,a=!!n.get(c.w.Core)?.enableMTMA,o=i.findScenario(be.Cu.GetAuthUser),[r,s]=to(i);r?.mark(be.BQ.CoreUserContextStart);const l=Date.now(),d=(0,kt.Lw)(e);try{const t=await this.createUserRenderingContext(e,a),{scenarioFactory:n}=t.context;return this.reportUserContextSuccess({getUserAuthScenario:o,expReadyScenario:s,clientStartScenario:r,scenarioStartTime:l,userContextId:d,isMTMAEnabled:a,scenarioFactory:n}),t}catch(e){const t=no(e,d);throw this.reportUserContextFailure({getUserAuthScenario:o,expReadyScenario:s,scenarioStartTime:l,error:t,userContextId:d,isMTMAEnabled:a,scenarioFactory:i}),t}}reportUserContextSuccess({getUserAuthScenario:e,expReadyScenario:t,clientStartScenario:n,scenarioStartTime:i,userContextId:a,isMTMAEnabled:o,scenarioFactory:r}){e&&e.stop(),t?.mark(be.BQ.GetAuthUser),n?.mark(be.BQ.CoreUserContextStop),fo(r,a,i,this.defaultRenderingContext?.context.windowProvider.performance,o).stop(void 0,"success")}reportUserContextFailure({getUserAuthScenario:e,expReadyScenario:t,scenarioStartTime:n,error:i,userContextId:a,isMTMAEnabled:o,scenarioFactory:r}){e&&e.fail(),t?.mark(be.BQ.GetAuthUser,void 0,"failure"),fo(r,a,n,this.defaultRenderingContext?.context.windowProvider.performance,o).fail({message:`Failed to create user context for ${a}`,...vo(i,this.defaultCoreSettings)})}async cleanupActiveWindowsHistoryService(e,t){let n;try{n=await this.getUserRenderingContext(t)}catch(e){return}try{n?.activeWindowsHistoryService?.cleanup(e)}catch(e){const t=new Ha.a(Ha.D.CLEANUP,e);this.logger.errorToTelemetry?.(t.toTelemetryEntry(),"webclient_framework_foundation_core_services_active_windows_history",void 0,!0)}}async cleanupUserRenderingContext(e,t){await this.contextFactory.destroyContext({context:e,reason:t})}async cleanupPrimaryUserContext(e){this.logger.log("Cleaning up primary user context..."),this.primaryUserContext?await this.contextFactory.destroyContext({context:this.primaryUserContext,reason:e}):this.logger.errorToTelemetry?.("No primary user context to clean up (inside cleanupPrimaryUserContext).","webclient_framework_foundation_rendering_context_manager",void 0,!0)}async createUserRenderingContext(e,t){const n=(0,kt.Lw)(e);this.logger.log(`createUserContext(${n}): start`);const i=await this.contextFactory.createContext({authenticationUser:e,defaultCoreSettings:this.defaultCoreSettings,defaultRenderingContext:this.defaultRenderingContext,isMTMAEnabled:t}),a=Ir(i.coreTaskErrors,this.defaultCoreSettings,this.logger);if(a)throw a;return this.logger.log(`createUserContext(${n}): done`),i}}function Ir(e,t,n){let i;if(e&&e?.length>0)if(t?.get(c.w.Core).strictErrorMode)i=e[0];else{const t=e.filter((e=>e instanceof br));t.length>0&&t.forEach((e=>{n.errorToTelemetry?.(e.toTelemetryEntry(),"webclient_framework_foundation_rendering_context_manager",void 0,!0)})),i=e.find((e=>e instanceof Ha.a||e instanceof wr.l||e instanceof br&&(e.prevError instanceof Ha.a||e.prevError instanceof wr.l)))}return i}async function Nr(e,t){const n=t?.get(c.w.Core)?.readInSequence;if(n)for(const t of e)await t();else await Promise.all(e.map((e=>e())))}const Ar=(e,t)=>{const n=t?.get(c.w.Auth)?.enableIntegratedAuthApp;return!!n&&!!e.supportsAsyncUserContext},Er="authenticated_user_subscription_failed",Fr="create_user_context_failed",_r="init_core_service_failure",Dr="show_taskbar_caution_indicator_failed",Pr="user_data_undefined",Mr="user_renderingContext_generation_error",Rr=(e,t,n)=>{e.errorToTelemetry&&e.errorToTelemetry(t,n,void 0,!0)};class xr{constructor({config:e,createNewScenarioFactory:t,generateChildWindowTemplate:n,getContextFactory:i,loggerFactory:a,onUserAuthenticated:r,regenerateContextStream:s,regenerateContextStreamForWindowAndUser:l}){this._activeWindows=new ya.t([]),this._contextSubject=new Sa.m(1),this._isCleanupRunning=!1,this.AppStateToCleanupReasonMap=new Map([[Ot.NV.quit,"quit"],[Ot.NV.restart,"restart"]]),this.cleanupOnAppStateChangedCallback=async e=>{const{appState:t}=e;if(!ro.has(t))return;if(this._isCleanupRunning){const e=new Ha.a(Ha.D.CLEANUP,new Error(`cleanupOnAppStateChangedCallback run more than once ${t}`));return void(this._logger.warnToTelemetry&&this._logger.warnToTelemetry(e.toTelemetryEntry(),"webclient_framework_foundation_core_services",void 0,!0))}this._isCleanupRunning=!0;const n=this.AppStateToCleanupReasonMap.get(t);if(!n){const e=new Ha.a(Ha.D.CLEANUP,new Error(`cleanupOnAppStateChangedCallback has undefined reason from ${t}`));throw Rr(this._logger,e.toTelemetryEntry(),"webclient_framework_foundation_core_services"),e}await so({hostCommunicationService:this.coreServices.hostCommunicationService,logger:this._logger,reason:n,renderingContextManager:this._renderingContextManager})},this.trackAuthUsers=e=>{const t=this.isMTMACoreEnabled(e.coreSettings),n=!!e.coreSettings.get(c.w.Core)?.enableExperienceLifeCycleSignalsLogging;return(0,fa.F)((0,o.T)((e=>t?e:e.slice(0,1))),(0,o.T)((e=>e.map((e=>({...e,id:(0,kt.Lw)(e)}))))),Pa((async e=>this.onUserAuthenticated(e)),(async e=>this.onUserDestroy(await e)),(async(e,t)=>t),((e,i)=>{if(!t)throw i;n&&this._logger.errorToTelemetry?.("Failed to create user context","webclient_framework_foundation_core_services_life_cycle_signals",{userId:e.id})})))},this._logger=a.newLogger("Core","core-services-activator"),this._templateGenerator=n,this._trackWindowsOperator=sr,this._config=e;const{contextFactory:d,coreServicesManager:u}=i({getOrCreateRenderingContextForId:this.getOrCreateRenderingContextForId.bind(this),contextSubject:this._contextSubject,isEntityInView:this.isEntityInView.bind(this)});this._renderingContextManager=new Tr(d,this.handleError.bind(this),a),this.createNewScenarioFactory=t,this.regenerateContextStream=s,this.regenerateContextStreamForWindowAndUser=l,this.onUserAuthenticated=e=>r({authUser:e,renderingContextManager:this._renderingContextManager,coreServices:this._coreServices,setCoreServices:this.setCoreServices.bind(this),coreServicesManagerService:u,config:this._config})}get activeWindows(){return this._activeWindows}async init(){try{const e=await this.initializeCoreServices(),{coreSettings:t,logsCollectorService:n}=e;!function(e,t){const{testAutomation:n}=e.get(c.w.Test);if(n){const e=window;e.WeakRef&&(e.hooks||(e.hooks={}),e.hooks.__TEST_ONLY_LOGS_COLLECTOR_SERVICE_REF=new e.WeakRef(t))}}(t,n),this._config.supportsAsyncUserContext||await this.awaitUserContextIfAvailable(),this.signalCoreInitSuccess(e);const i={logger:this._logger,renderingContextManager:this._renderingContextManager};e.authenticationService?.registerCleanUpOnLogoutCallback?.(A.p.Core,(e=>lo({...i,reason:"signout",user:e&&(0,kt.aj)(e)}))),this.registerForAppStateChanged(e.hostCommunicationService)}catch(e){throw this.reportCoreInitError(e,this._coreServices),e}}get coreServices(){if(!this._coreServices)throw(0,Je.$5)("Entry",d.O4.NotPresent,"CoreServices not available");return this._coreServices}async initializeCoreServices(){const{coreServicesCriticalError:e,context:t}=await this._renderingContextManager.createCoreServices();this._coreServices=t,this.initializeKPIs(t.scenarioFactory),e&&this.handleError(e);return this._coreServices.coreSettings.get(c.w.Core).chainObserveUsersAfter1stNavigationCompletes?this.setupNavigationHandling(t,!!e).then((()=>{const e=this._coreServices?.coreSettings.get(c.w.Core).enableSkipObserveAuthUsers;e||this.observeAuthenticatedUsers(t)})):(this.setupNavigationHandling(t,!!e),this.observeAuthenticatedUsers(t)),t}signalCoreInitSuccess(e){const[t,n]=to(e.scenarioFactory);n?.mark(be.BQ.InitCoreServicesComplete),t?.mark(be.BQ.CoreInitStop),t&&(0,Un.z)()?.loader?.stopPieTimer?.(),this._logger.log("hostComms::setCoreInitialized"),e.hostCommunicationService.loadModule("core").then((e=>{e?.setCoreInitialized?.()})),this.markCoreInitCompleteInAltScenario(e.altScenarioService);const i=Date.now();e.telemetryService.setCoreInitTime(i),e.logsCollectorService.setGetSummaryFunction(io(this._coreServices?.platformService,this._coreServices?.i18n,this._coreServices?.authenticationService,this._coreServices?.coreSettings))}handleError(e){if(!this.canDisplayCriticalErrorPage(this._coreServices))throw this.reportCoreInitError(e,this._coreServices),e;this.reportCoreInitError(e,this._coreServices,be.BQ.CoreInitFailure),this._contextSubject.error(no(e))}setupNavigationHandling(e,t){if(!this.canHandleNavigationIntents(e)){const t=e&&Object.keys(e).sort(),n=`Unable to process navigation intents, ${`${(0,ge.hR)(t)}`}:: dataClient::${Boolean(e?.client)}, deeplink::${Boolean(e.deeplinkService)}, entityCommanding::${Boolean(e.entityCommanding)}`;throw(0,Je.$5)(d.Ir.Core,d.O4.CoreNavigationServicesMissing,n)}return e.coreSettings.get(c.w.Core).enableIframeTracking&&(this._trackWindowsOperator=Eo),this.observeWindowsWithoutApollo(e).subscribe(this._activeWindows),e.deeplinkService.init(t)}async awaitUserContextIfAvailable(){await this._contextSubject.pipe((0,Ca.$)()).toPromise()}initializeKPIs(e){if(e){const t=e.findScenario(be.Cu.ClientStart),n=(0,Un.z)()?.loader?.getProperties?.();n?.deeplinkId&&t?.appendEventData({deeplinkId:n.deeplinkId}),n?.RelaunchReason&&t?.appendEventData({RelaunchReason:n.RelaunchReason});const i=(0,Un.z)()?.localStorage.getItem(ga.T2WebOptInSessionId);i&&t?.appendEventData({t2WebOptInSessionId:i});const a=(0,Un.z)()?.localStorage.getItem(ga.AttemptedWebBootCount);a&&t?.appendEventData({attemptedWebBootCount:a}),t?.mark(be.BQ.CoreInitStart)}const t=e?.findScenario(be.Cu.ExperienceReady);t?.mark(be.BQ.InitCoreServices),t?.startStep(be.BQ.GetAuthUser)}reportCoreInitError(e,t={},n){const i=e instanceof Va.C?(e=>e.prevError||(0,Je.$5)(d.Ir.Core,d.O4.NotInitialized,e.code,void 0,e.message))(e):e,a=i.context===d.Ir.Core?i:(0,Je.$5)(d.Ir.Core,i.code||d.O4.NotInitialized,i.context,{innerError:i}),o=a.subContext||"UnknownCoreInitFailure",r=(0,et.y)((0,Je.BA)(a));this._logger.warn(`Initializing Core failed. Message: ${r}, subContext: ${o}`);const[s,l]=to(t.scenarioFactory),u={errorCode:e instanceof Va.C&&Va.C.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():a.code??d.O4.CoreInitFailure,reason:d.O4.CoreInitFailure},m=(0,Un.z)()?.loader;n?(s?.mark(n,u),t?.altScenarioService?.altScenario?.mark(n,u)):(s?.fail(u),t?.altScenarioService?.altScenario?.fail(u),m?.checkClientStartFailureCount?.()),s&&m?.stopPieTimer?.(),this._coreServices?.diagnosticsService?.persistDiagnosticsAsPreviousSessionLogs(),m?.persistLoaderLogsAsPreviousSession(),l?.fail({contentType:(0,et.y)(`${a.context}-${a.subContext}`),errorCode:(0,Je.rX)(a),errors:r,reason:_r}),t?.windowProvider?.opener.postMessage(Ta.z.CoreInitializationFailed,{errorDescription:o}),t?.coreSettings?.get(c.w.Core)?.enableTaskbarIconOnCoreInitFailure&&async function(e,t){try{const t=await(e?.loadModule("taskbar"));t?.showBadge?.({icon:{glyphBadge:{glyph:Ea.r.attention}}})}catch(e){Rr(t,`${Dr}: ${e}`,"webclient_framework_foundation_core_services")}}(t?.hostCommunicationService,this._logger)}markCoreInitCompleteInAltScenario(e){performance?.mark?.(Aa),e?.altScenario?.mark(be.BQ.PostCoreInitializationTasks)}getExistingContextForId(e){return this._renderingContextManager.getExistingContextForId(e)}getContextObservable(e){return!Ar(this._config,this._coreServices?.coreSettings)||this._contextSubject.hasError?this._contextSubject:(0,ka.H)(this.getExistingContextForId(e)??Promise.reject(new Ha.a(Ha.D.RENDERING_CONTEXT_DOES_NOT_EXIST)))}async getOrCreateRenderingContextForId(e){const t=await this.getExistingContextForId(e);if(t)return t;const n=this.coreServices?.authenticationService;if(!n)return Promise.reject(new Ha.a(Ha.D.CORE_SERVICES_MISSING,void 0,e));const i=await async function(e,t,n){if(!t)throw new Ha.a(Ha.D.USERCONTEXTID_EMPTY,void 0,t);const i=await n.getUser({correlation:e,accountId:t});if(!i)throw new Ha.a(Ha.D.USER_DOES_NOT_EXIST,void 0,t);if(!i.isAuthenticated)throw new Ha.a(Ha.D.USER_NOT_AUTHENTICATED,void 0,t);return(0,kt.aj)(i)}({...F({source:A.p.Core}),scenarioName:be.Cu.AuthWebCachedUser},e,n);return this.onUserAuthenticated(i)}setCoreServices(e){this._coreServices=e}isMTMACoreEnabled(e){const t=e?.get(c.w.Core)?.enableMTMA;return!!t&&!!Ar(this._config,e)}observeAuthenticatedUsers(e){this.observeUsers(e,this._logger).pipe(this.trackAuthUsers(e),(0,ba.W)((t=>{const n=t instanceof Va.C&&Va.C.isFunction(t.toTelemetryEntry)?t:new Ha.a(t?.code,t||new Error("Unknown error"));this._logger.errorToTelemetry?.(`Core Initialization: ${Mr}`,"webclient_framework_foundation_core_services",{errorCode:n.toTelemetryEntry()},!0);const i=(0,Je.$5)("Core",d.O4.NotInitialized,n.prevError?.context,{innerError:n.prevError});throw e.errorState.error=i,e.coreSettings.get(c.w.Core).enableCoreErrorsV2?n:i})),(0,wa.M)((()=>{const[t,n]=to(e.scenarioFactory);t?.mark(be.BQ.CoreRenderingContextReady)})),(0,o.T)((e=>e.length>0?e[0]:this._renderingContextManager.getDefaultRenderingContext()))).subscribe(this._contextSubject)}canDisplayCriticalErrorPage(e){return!!(e?.rebootService&&e.i18n&&e.scenarioFactory&&e.coreSettings&&e.hostCommunicationService&&!e.coreSettings.get(c.w.Core).enableThrowingToExperienceEntry&&e.coreSettings.get(c.w.Core).enableCoreErrorsV2)}canHandleNavigationIntents(e){return!!(e?.client&&e.deeplinkService&&e.entityCommanding)}async registerForAppStateChanged(e){let t;try{t=await e.loadModule("core")}catch(e){const t=`${fr}${kr.LoadModuleCoreFailed} registerForAppStateChanged`;return void Rr(this._logger,t,"webclient_framework_host_comms")}try{t?.registerForAppStateChanged?.(this.cleanupOnAppStateChangedCallback)}catch(e){const t=`${fr}${kr.RegisterForAppStateChangedFailed}`;return void Rr(this._logger,t,"webclient_framework_host_comms")}}observeWindowsWithoutApollo(e){return e.activeWindowsService.getActiveWindowsObservable().pipe((0,o.T)((e=>e.map((t=>({...t,screenState:{numOpenWindows:e.length}}))))),this._trackWindowsOperator(this.getContextObservable.bind(this),e,this.createNewScenarioFactory,this.regenerateContextStream,this.regenerateContextStreamForWindowAndUser,this._templateGenerator,this._config.getExperienceWindowFeatures))}observeUsers(e,t){const n=this.observeUsersEvents(e.client);return(0,La.K)(n).pipe((0,o.T)((e=>this.toUserContexts(e,t))),(0,ba.W)((e=>{const t=`Core Initialization: ${Er}`;throw this._logger.errorToTelemetry?.(`${t} ${e.message}`,"webclient_framework_foundation_core_services",{errorCode:e.code,context:e.context,errors:`${e?.reason}-${(0,ge.hR)(e?.serverResponse)}`},!0),no(e)})))}observeUsersEvents(e){const t={filter:{isAuthenticated:!0}},n=e.watchQuery({query:ja,variables:t});return n.subscribeToMore({document:Oa,variables:t,updateQuery:(e,t)=>t.subscriptionData.data.authenticationUsersEvent}),n}onUserDestroy(e){const t={logger:this._logger,renderingContextManager:this._renderingContextManager},n=e.authenticationUser,i=`[onUserDestroy] role: ${n?.role}, isAuthenticated: ${n?.isAuthenticated}`;this._logger.log(`${i}, id: ${n?.id}`),this._logger.infoToTelemetry&&this._logger.infoToTelemetry(i,"webclient_framework_foundation_core_services",void 0,!0),n&&lo({...t,reason:"unknown_destroy",user:n})}toUserContexts({data:e,loading:t,errors:n},i){if(n)throw Rr(i,Fr,"webclient_framework_foundation_core_services"),(0,Fa.qD)({graphQLErrors:n.concat(),extraInfo:void 0,networkError:null,name:"AuthenticationUsers subscription error",message:"Error in authentication users subscription"});if(!t){if(!e)return Rr(i,Pr,"webclient_framework_foundation_core_services"),[];return(e.authenticationUsers??[]).filter((e=>!0===e.isAuthenticated)).map(this.toUserContext)}return[]}toUserContext(e){const{id:t,isAuthenticated:n,cloud:i,profile:{tenantId:a,objectId:o,puid:r},role:s,type:l,subType:c,loginUserName:d,homeAccountId:u}=e;return{id:t,isAuthenticated:n,profile:{tenantId:a,objectId:o,puid:r},cloud:i,role:s,type:l,subType:c,loginUserName:d,homeAccountId:u||void 0}}async isEntityInView(e,t){if(!this._coreServices)return Promise.resolve(!1);const{clientState:n}=this._coreServices;return Qa(e,t,n,this._activeWindows,this._logger)}}var Lr=n(957032),Or=n(513432);const jr={id:"com.microsoft.teams.corelayout",actors:["corelayout"],name:"CoreLayoutApp"};var Br=n(406679);const Ur={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutResizeSlotDimensionsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"width"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slotName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resizeSlotDimensions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"Variable",name:{kind:"Name",value:"width"}}},{kind:"Argument",name:{kind:"Name",value:"slotName"},value:{kind:"Variable",name:{kind:"Name",value:"slotName"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};const $r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutResizeHeaderMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"height"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resizeHeaderSlot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"Variable",name:{kind:"Name",value:"height"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},Wr={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutChangeSlotsVisibilityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slotNames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isHidden"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSlotsVisibility"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"slotNames"},value:{kind:"Variable",name:{kind:"Name",value:"slotNames"}}},{kind:"Argument",name:{kind:"Name",value:"isHidden"},value:{kind:"Variable",name:{kind:"Name",value:"isHidden"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},Vr={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutChangeMonitorSlotMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityAction"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeMonitorSlotContent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entityType"},value:{kind:"Variable",name:{kind:"Name",value:"entityType"}}},{kind:"Argument",name:{kind:"Name",value:"entityAction"},value:{kind:"Variable",name:{kind:"Name",value:"entityAction"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},Hr="activity",zr="viewActivityApp",qr="viewSliceFeedItems",Gr=()=>({actor:Hr,action:zr}),Yr=e=>({actor:Hr,action:qr,data:e}),Qr=e=>e.action===qr,Jr="calendar",Kr="viewCalendarApp",Zr=()=>({actor:Jr,action:Kr}),Xr="communities",es="viewCommunitiesApp",ts=()=>({actor:Xr,action:es}),ns="VirtualConsumerEvents",is="closeViewVirtualConsumerEvent",as="createVirtualConsumerEvent",os="deleteVirtualConsumerEvent",rs="editVirtualConsumerEvent",ss="joinVirtualConsumerEvent",ls="shareVirtualConsumerEvent",cs="viewVirtualConsumerEvent",ds="viewVirtualConsumerEvents",us=()=>({actor:ns,action:is}),ms=e=>({actor:ns,action:as,data:e}),ps=e=>({actor:ns,action:os,data:e}),gs=e=>({actor:ns,action:rs,data:e}),hs=e=>({actor:ns,action:ss,data:e}),vs=e=>({actor:ns,action:ls,data:e}),ys=e=>({actor:ns,action:cs,data:e}),Ss=()=>({actor:ns,action:ds}),fs="calls-main",ks="viewCallsMainApp",Cs="markAllAsRead",bs="startAudioCall",ws="viewCallHistoryDetails",Ts="viewSpeedDial",Is="showCopilotSummary",Ns=()=>({actor:fs,action:ks}),As=()=>({actor:fs,action:Cs}),Es=e=>({actor:fs,action:bs,data:e}),Fs=()=>({actor:fs,action:Ts}),_s=e=>({actor:fs,action:Is,data:e}),Ds="chat",Ps="viewChatApp",Ms="chatWithUsers",Rs="newChat",xs="popNewChat",Ls="openChatThreadPane",Os="openChatThreadPaneWithinSinglePane",js="hideChatThreadPane",Bs="hideChatThreadPaneWithinSinglePane",Us="popoutChatThread",$s="toggleThreadListPane",Ws="goBackToThreadedConversation",Vs=()=>({actor:Ds,action:Ps}),Hs=e=>({actor:Ds,action:Ms,data:e}),zs=()=>({actor:Ds,action:Rs}),qs=()=>({actor:Ds,action:xs}),Gs=e=>({actor:Ds,action:$s,data:e}),Ys=e=>({actor:Ds,action:Ls,data:e}),Qs=e=>({actor:Ds,action:Os,data:e}),Js=e=>({actor:Ds,action:js,data:e}),Ks=e=>({actor:Ds,action:Bs,data:e}),Zs=e=>({actor:Ds,action:Us,data:e}),Xs=e=>({actor:Ds,action:Ws,data:e}),el=e=>e.action===Ms,tl=e=>e.action===$s,nl=e=>e.action===Ls,il=e=>e.action===Os,al=e=>e.action===js,ol=e=>e.action===Bs,rl=e=>e.action===Us,sl=e=>e.action===Ws,ll="meet",cl="viewMeetApp",dl=()=>({actor:ll,action:cl}),ul="teamsandchannels",ml="viewTeamsAndChannelsApp",pl="switchToChannel",gl="loadUserOnboardingToTeamPage",hl="getLinkToChannel",vl="viewChannelEmail",yl="manageChannelMembers",Sl="manageTeam",fl="leaveChannel",kl="manageChannel",Cl="channelAddMembers",bl="shareChannelWithUser",wl="shareChannelWithTeam",Tl="channelNotificationSettings",Il="manageTeamMembers",Nl="manageTeamChannels",Al="toggleThreadListPane",El="openChannelThreadPane",Fl="hideChannelThreadPane",_l="popoutChannelThread",Dl="addChannel",Pl="teamAddMember",Ml="teamAddChannel",Rl="manageTags",xl="leaveTeam",Ll="hideAllChannelsDialog",Ol="getLinkToTeam",jl="deleteTeam",Bl=()=>({actor:ul,action:ml}),Ul=e=>({actor:ul,action:pl,data:e}),$l=e=>({actor:ul,action:gl,data:e}),Wl=e=>({actor:ul,action:hl,data:e}),Vl=e=>({actor:ul,action:vl,data:e}),Hl=e=>({actor:ul,action:yl,data:e}),zl=e=>({actor:ul,action:Sl,data:e}),ql=e=>({actor:ul,action:Nl,data:e}),Gl=e=>({actor:ul,action:Il,data:e}),Yl=e=>({actor:ul,action:fl,data:e}),Ql=e=>({actor:ul,action:kl,data:e}),Jl=e=>({actor:ul,action:Cl,data:e}),Kl=e=>({actor:ul,action:Dl,data:e}),Zl=e=>({actor:ul,action:bl,data:e}),Xl=e=>({actor:ul,action:wl,data:e}),ec=e=>({actor:ul,action:Tl,data:e}),tc=e=>({actor:ul,action:Al,data:e}),nc=e=>({actor:ul,action:El,data:e}),ic=e=>({actor:ul,action:Fl,data:e}),ac=e=>({actor:ul,action:_l,data:e}),oc=e=>({actor:ul,action:Pl,data:e}),rc=e=>({actor:ul,action:Ml,data:e}),sc=e=>({actor:ul,action:Rl,data:e}),lc=e=>({actor:ul,action:xl,data:e}),cc=e=>({actor:ul,action:Ll,data:e}),dc=e=>({actor:ul,action:Ol,data:e}),uc=e=>({actor:ul,action:jl,data:e}),mc=e=>e.action===Al,pc=e=>e.action===El,gc=e=>e.action===Fl,hc=e=>e.action===_l,vc="simplecollab",yc="viewSimpleCollabApp",Sc="viewSimpleCollabSplitApp",fc="viewSimpleCollabSwitchbackSurvey",kc="viewSimpleCollabSwitchBackConfirmationDialog",Cc="switchToChat",bc="switchToSuggestedChat",wc="switchToChannel",Tc="channelNotificationSettings",Ic="channelWorkflows",Nc="archiveChannel",Ac="deleteChannel",Ec="editChannel",Fc="getLinkToChannel",_c="staleChannelsAdhocDialog",Dc="manageChannel",Pc="manageChannelTags",Mc="manageChannelMembers",Rc="viewChannelEmail",xc="manageTeam",Lc="manageTags",Oc="getLinkToTeam",jc="leaveTeam",Bc="hideAllChannelsDialog",Uc="teamAddMember",$c="teamAddChannel",Wc="deleteTeam",Vc="channelAddMembers",Hc="leaveChannel",zc="shareChannelWithUser",qc="shareChannelWithTeam",Gc="shareChannelWithTeamYouOwn",Yc="viewDiscover",Qc="createConversationFolder",Jc="removeConversationFolder",Kc="renameConversationFolder",Zc="chatManageApps",Xc="leaveChat",ed="blockChat",td="deleteChat",nd="chatWorkflows",id="viewTeamSeeAllChannels",ad="joinTeam",od="newMessage",rd="createChannel",sd="createTeam",ld="manageTeams",cd="viewMoreSettings",dd="manageTeamMembers",ud="manageTeamChannels",md="openFilterLeftRail",pd="switchToBizChatMetaOS",gd="openManageTeams",hd="createTeamOnMainView",vd=e=>({actor:vc,action:kc,data:e}),yd=()=>({actor:vc,action:yc}),Sd=()=>({actor:vc,action:Sc}),fd=e=>({actor:vc,action:fc,data:e}),kd=e=>({actor:vc,action:Cc,data:e}),Cd=e=>({actor:vc,action:bc,data:e}),bd=e=>({actor:vc,action:pd,data:e}),wd=e=>({actor:vc,action:wc,data:e}),Td=e=>({actor:vc,action:Tc,data:e}),Id=e=>({actor:vc,action:Ic,data:e}),Nd=e=>({actor:vc,action:Nc,data:e}),Ad=e=>({actor:vc,action:Ac,data:e}),Ed=e=>({actor:vc,action:Ec,data:e}),Fd=e=>({actor:vc,action:Fc,data:e}),_d=e=>({actor:vc,action:_c,data:e}),Dd=e=>({actor:vc,action:Dc,data:e}),Pd=e=>({actor:vc,action:Mc,data:e}),Md=e=>({actor:vc,action:Pc,data:e}),Rd=e=>({actor:vc,action:Rc,data:e}),xd=e=>({actor:vc,action:Vc,data:e}),Ld=e=>({actor:vc,action:Hc,data:e}),Od=e=>({actor:vc,action:zc,data:e}),jd=e=>({actor:vc,action:qc,data:e}),Bd=e=>({actor:vc,action:Gc,data:e}),Ud=e=>({actor:vc,action:xc,data:e}),$d=e=>({actor:vc,action:ud,data:e}),Wd=e=>({actor:vc,action:dd,data:e}),Vd=e=>({actor:vc,action:Lc,data:e}),Hd=e=>({actor:vc,action:Oc,data:e}),zd=e=>({actor:vc,action:jc,data:e}),qd=e=>({actor:vc,action:Bc,data:e}),Gd=e=>({actor:vc,action:Uc,data:e}),Yd=e=>({actor:vc,action:$c,data:e}),Qd=e=>({actor:vc,action:Wc,data:e}),Jd=e=>({actor:vc,action:Zc,data:e}),Kd=e=>({actor:vc,action:Xc,data:e}),Zd=e=>({actor:vc,action:ed,data:e}),Xd=e=>({actor:vc,action:td,data:e}),eu=e=>({actor:vc,action:nd,data:e}),tu=e=>({actor:vc,action:Yc,data:e}),nu=e=>({actor:vc,action:Qc,data:e}),iu=e=>({actor:vc,action:Jc,data:e}),au=e=>({actor:vc,action:Kc,data:e}),ou=e=>({actor:vc,action:id,data:e}),ru=e=>({actor:vc,action:ad,data:e}),su=e=>({actor:vc,action:od,data:e}),lu=e=>({actor:vc,action:rd,data:e}),cu=e=>({actor:vc,action:sd,data:e}),du=e=>({actor:vc,action:ld,data:e}),uu=e=>({actor:vc,action:cd,data:e}),mu=e=>({actor:vc,action:"",data:e}),pu=e=>({actor:vc,action:md,data:e}),gu=()=>({actor:vc,action:gd}),hu=e=>({actor:vc,action:hd,data:e}),vu="platform",yu="viewPlatformApp",Su="loadPlatformChunks",fu="openAppDetailsDialog",ku="openAboutDialog",Cu="installPlatformApp",bu="uninstallPlatformApp",wu="blockUnblockBotChat",Tu="openSuggestedLink",Iu="openDeeplinkStageConsentDialog",Nu="openPresentAppNowConfirmationDialog",Au="launchAppError",Eu="launchManifestParsingErrorDialog",Fu="openShareDialog",_u=(e,t,n=!1)=>({actor:vu,action:yu,data:{appId:e,isMultiWindow:t,isDefaultCommand:n}}),Du=()=>({actor:vu,action:Su}),Pu=(e,t)=>({actor:vu,action:fu,data:{appId:e,scrollToSection:t}}),Mu=e=>({actor:vu,action:Cu,data:{appId:e}}),Ru=(e,t,n)=>({actor:vu,action:bu,data:{appId:e,appName:t,isInUse:n}}),xu=e=>({actor:vu,action:ku,data:{appId:e}}),Lu=e=>({actor:vu,action:Fu,data:{appId:e}}),Ou=e=>({actor:vu,action:wu,data:{appId:e}}),ju=e=>({actor:vu,action:Tu,data:{tileId:e}}),Bu=e=>({actor:vu,action:Iu,data:e}),Uu=e=>({actor:vu,action:Nu,data:e}),$u=e=>({actor:vu,action:Au,data:e}),Wu=e=>({actor:vu,action:Eu,data:e}),Vu="queues",Hu="viewDefaultQueuesApp",zu="viewQueuesApp",qu="switchToCallQueue",Gu="selectQueueUser",Yu="selectCallHistoryRow",Qu="switchToQueuesAnalytics",Ju="selectRealTimeAnalyticsNavigationItem",Ku="selectHistoricalAnalyticsNavigationItem",Zu="selectCallQueueOverview",Xu="navigateToChannel",em="navigateToSettings",tm="displayErrorMessage",nm=()=>({actor:Vu,action:Hu}),im=e=>({actor:Vu,action:Qu,data:e}),am=e=>({actor:Vu,action:Ju,data:e}),om=e=>({actor:Vu,action:Ku,data:e}),rm=e=>({actor:Vu,action:qu,data:e}),sm=e=>({actor:Vu,action:Gu,data:e}),lm=e=>({actor:Vu,action:Yu,data:e}),cm=e=>({actor:Vu,action:Zu,data:e}),dm=e=>({actor:Vu,action:Xu,data:e}),um=e=>({actor:Vu,action:em,data:e}),mm=e=>({actor:Vu,action:tm,data:e}),pm="store",gm="viewStoreApp",hm=()=>({actor:pm,action:gm}),vm="homepage",ym="viewHomepageApp",Sm=()=>({actor:vm,action:ym}),fm={People:"People",LivePersonaEditor:"LivePersonaEditor"},km="viewPeopleApp",Cm="switchToContactTag",bm="openLivePersonaEditorDialog",wm="closeLivePersonaEditorDialog",Tm="openAddContactDialog",Im=e=>({actor:fm.LivePersonaEditor,action:bm,data:e}),Nm=()=>({actor:fm.LivePersonaEditor,action:wm}),Am=e=>({actor:fm.People,action:Cm,data:e}),Em=()=>({actor:fm.People,action:km}),Fm=()=>({actor:fm.People,action:Tm}),_m="14d6962d-6eeb-4f48-8890-de55454bb136",Dm="86fcd49b-61a2-4701-b771-54728cd291fb",Pm="ef56c0de-36fc-4ef8-b417-3d82ba9d073c",Mm="2a84919f-59d8-4441-a975-2a8c2643b741",Rm="3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40",xm="20c3440d-c67e-4420-9f80-0e50c39693df",Lm="5af6a76b-40fc-4ba1-af29-8f49b08e44fd",Om="957ed0e3-e5ca-4c82-9676-fd037185c4d8",jm="a63f7012-8cc9-42d5-99c3-e35f526fab17",Bm="3b95919f-59d8-4441-a975-2a8c2643c852",Um="40472f6e-248f-4599-842c-ff3ed8f0ae34",$m="66aeee93-507d-479a-a3ef-8f494af43945",Wm="ac40aa4a-fef1-4896-aea2-46d1c14dbfd5",Vm="7133fca9-0853-4e7a-bb5d-32d4e5f6020a",Hm="a02e4d17-af86-4ceb-9c97-4c2626eb3587",zm="7831feaf-c4c4-4669-ba64-ce4ea0b56d31",qm=(e,t)=>{if("platform"===t.platformType)return{appName:"platformApp",appViewCommand:{command:_u(e,t.launchOut||!1,t.isDefaultCommand||!1)}};switch(e){case Wm:return{appName:"store",appViewCommand:{command:hm()}};case _m:return{appName:"activity",appViewCommand:{command:Gr()},focusOnLeftRailItem:!0};case Pm:return{appName:"calendar",appViewCommand:{command:Zr()}};case xm:return{appName:"callsmain",appViewCommand:{command:Ns()}};case Mm:return{appName:"channel",appViewCommand:{command:Bl()},focusOnLeftRailItem:!0};case Rm:return{appName:"simpleCollab",appViewCommand:{command:yd()},focusOnLeftRailItem:!0};case Dm:return{appName:"chat",appViewCommand:{command:Vs()},focusOnLeftRailItem:!0};case Bm:return{appName:"communities",appViewCommand:{command:ts()},focusOnLeftRailItem:!0};case Um:return{appName:"virtualConsumerEvents",appViewCommand:{command:Ss()}};case Om:case jm:return{appName:"meet",appViewCommand:{command:dl()}};case $m:return{appName:"assignments",appViewCommand:{command:_u($m,t.launchOut||!1,t.isDefaultCommand||!1)}};case Vm:return{appName:"homepage",appViewCommand:{command:Sm()}};case Hm:return{appName:"queues",appViewCommand:{command:nm()}};case zm:return{appName:"peopleApp",appViewCommand:{command:Em()}};default:return}},Gm={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCoreLayoutDefaultAppQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365DefaultApp"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultAppId"}},{kind:"Field",name:{kind:"Name",value:"platformType"}}]}}]}}]},Ym="DefaultCommand",Qm=async(e,t,n)=>{const{data:{m365DefaultApp:{defaultAppId:i,platformType:a}}}=await e.query({query:Gm}),{appViewCommand:o,appName:r}=qm(i,{platformType:a,isDefaultCommand:!0})||{};return t.log(`${Ym} - Default app found: ${r}`),o&&n?tp({appViewCommand:o,clientLaunchId:n}):o},Jm=(e,t,n)=>t?e.getActiveWindow(t):e.getMainWindowWithLayoutMode(n||Yt.Rm.standard),Km=e=>!!e?.activeEntities,Zm=({forceTransition:e=!1,shouldShowWithoutFocus:t=!1})=>({entity:{type:ke.ck.default,action:e?ke.SY.view:ke.SY.default},command:{visibilityState:t?g.Rp.showWithoutFocusing:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.CoreLayoutApp}}}),Xm=e=>({entity:e,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.CoreLayoutApp}},entityOptions:e.options&&JSON.parse(e.options)}),ep=e=>"entity"in e,tp=({appViewCommand:e,clientLaunchId:t})=>({...e,command:{...e.command,data:{...e.command?.data||{},clientLaunchId:t}}}),np=({action:e,id:t,entityOptions:n,showOption:i,source:a,linkedEntity:o,type:r,correlationId:s,startTimestamp:l,shouldPersistState:d,targetWindow:u},m,p,h,v,y)=>{if(d){const e=p.getApp({entityType:r});if(e?.sidePaneCallbacks){const n=ip(i,t,r,e.sidePaneCallbacks,h,v);e.sidePaneCallbacks.setSidePaneState(n,{id:t,type:r},{clientPreferences:h,coreSettings:v})}}const S={action:e,id:t,type:r,linkedEntity:o},{enableReflow:f}=v.get(c.w.Core,["enableReflow"]),k={entity:S,command:{stateTransition:g.Ar.none,visibilityState:i,targetWindow:u,correlation:{source:a,...s&&{id:s},...l&&{startTimestamp:l}}},entityOptions:n};if(!f)return k;const C=y&&m.getSlotLayoutConfigProperty(y,Yt.sk.END,Yt.EJ.FOLD_STATE),b=y&&m.isNewEntitySameAsCurrentEntity(y,S,"endEntity");if("hide"!==i||b||o?.type===ke.ck.byodattendeewindow){if(!["hide","toggle"].includes(i)||C!==Yt.Vt.UNFOLDED||!b)return["show","toggle"].includes(i)&&C===Yt.Vt.FOLDED&&m.updateLayoutConfig({end:{foldState:Yt.Vt.UNFOLDED}},y),b&&C!==Yt.Vt.DEFAULT?void 0:k;m.updateLayoutConfig({end:{foldState:Yt.Vt.FOLDED,useForce:!0}},y)}},ip=(e,t,n,i,a,o)=>{if("toggle"===e){const e=i.getSidePaneState({id:t,type:n},{clientPreferences:a,coreSettings:o})??"closed";return["open","hidden"].includes(e)?"closed":"open"}return"show"===e?"open":"closed"},ap={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCoreLayoutServicesUnavailableQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"servicesUnavailable"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"servicesUnavailable"}}]}}]}}]};function op(e,t,n){const{capabilities:i}=n,a=function(e){const t=[];return e.includes("chats")||t.push("chats"),e.includes("channels")||t.push("channels"),t}(i||[]);t.infoToTelemetry?.(`Received capabilities from CDL: ${i}`,"webclient_framework_foundation_core_apps_layout_publish_cdl_capabilities"),function(e,t,n){try{e.writeQuery({query:ap,data:{servicesUnavailable:{id:(0,E.v4)(),__typename:"ServicesUnavailable",servicesUnavailable:n}}})}catch(e){t.error(`servicesUnavailableQueryDocument::failure to query services unavailable to cache: ${e?.message}`)}}(e,t,a)}const rp={eventHandlers:{onEventReceived:async e=>{const{eventInput:t,requestContext:{client:n,loggerFactory:i,stateManagementServices:{userWindowStore:a}},windowId:o}=e,r=i.newLogger("apps-core-layout","apps-core-layout"),s=t.event;if(!function(e){if(e.originator!==Br.Nv)return!1;for(const t in Br.mu)if(t===e.type)return!0;return!1}(s))return r.error(`Unhandled event ${t} is not a core layout event`),Promise.reject(new Error(`Unhandled event ${t.event.type} is not a core layout event`));switch(s.type){case Br.mu.criticalAppPhaseReached:return a?.set("completePhaseReached",!1),void a?.set("postCriticalPhaseReached",!1);case Br.mu.postCriticalAppPhaseReached:return void a?.set("postCriticalPhaseReached",!0);case Br.mu.completeAppPhaseReached:return void a?.set("completePhaseReached",!0);case Br.mu.resizeSlot:return void n.mutate({mutation:Ur,variables:{slotName:s.data?.().slotName,width:s.data?.().width,windowId:o}});case Br.mu.updateAmsV2Domain:const{amsV2Domain:e}=s.data();return void(void 0!==e&&a?.set("amsV2Domain",e));case Br.mu.updateMeControlAvatarSrc:const{meControlAvatarSrc:i}=s.data();return void(void 0!==i&&a?.set("meControlAvatarSrc",i));case Br.mu.updateBaseImageUrl:const{baseImageUrl:l}=s.data();return r.log(`Received baseImageUrl core-layout event with data ${l}`),void(void 0!==l&&a?.set("baseImageUrl",l));case Br.mu.updateIsImageAuthCookieValid:const{isImageAuthCookieValid:c}=s.data();return void(c&&a?.set("isImageAuthCookieValid",c));case Br.mu.showMonitor:return Promise.resolve({command:ee.showMonitor(s.data())});case Br.mu.updateDialogState:return Promise.resolve({command:ee.updateDialogState(s.data())});case Br.mu.closeMonitor:return Promise.resolve({command:ee.closeMonitor()});case Br.mu.hideMonitor:return Promise.resolve({command:ee.hideMonitor()});case Br.mu.unhideMonitor:return Promise.resolve({command:ee.unhideMonitor()});default:return r.error(`Unhandled event ${t}`),Promise.reject(new Error(`Unhandled event ${t.event.type}`))}}},onCommandReceived:async e=>{const{activeWindowsService:t,appsRegistryService:n,commandInput:i,requestContext:{client:a,clientPreferencesService:o,loggerFactory:r,coreSettings:s,scenarioFactory:l},slotDimensionsOptions:d,windowId:u}=e,{action:m,actor:p}=i.command,h=r.newLogger("CoreLayoutApp onCommandReceived","apps-core-layout");if(!jr.actors.includes(p))return void h.error(`Command  ${i.command} is sent to the wrong App.`);const v=function(e,t,n,i){const{header:{height:a}}=i,{collapsed:o,expanded:r}=a||{};switch(e){case R:return t.mutate({mutation:$r,variables:{height:o,windowId:n}}),!0;case L:return t.mutate({mutation:$r,variables:{height:r,windowId:n}}),!0;case U:{const e=[Yt.sk.HEADER];return t.mutate({mutation:Wr,variables:{slotNames:e,windowId:n,isHidden:!0}}),!0}case Z:{const e=[Yt.sk.HEADER];return t.mutate({mutation:Wr,variables:{slotNames:e,windowId:n,isHidden:!1}}),!0}default:return!1}}(m,a,u,d);if(!v){switch(m){case M:a.mutate({mutation:Vr,variables:{windowId:u,entityType:"floatingmonitor",entityAction:"leave"}});break;case B:((e,t)=>{if(!t)return;const n=e.getActiveWindow(t);if(!n)return;const i=n?.layoutConfig.slots,a=!!n?.activeEntities.endEntity,o=i?.end?.foldState===Yt.Vt.UNFOLDED||i?.end?.foldState===Yt.Vt.DEFAULT,r=!!n?.activeEntities.midNavEntity,s=i?.midNav?.foldState===Yt.Vt.FOLDED,l=!!n?.activeEntities.subNavEntity,c=i?.subNav?.foldState===Yt.Vt.FOLDED,d=!!n?.activeEntities.startEntity,u=i?.start?.foldState===Yt.Vt.FOLDED,m={};a&&o&&(m[Yt.sk.END]={foldState:Yt.Vt.FOLDED,useForce:!0}),l&&c?m[Yt.sk.SUBNAV]={foldState:Yt.Vt.UNFOLDED}:r&&s?m[Yt.sk.MID_NAV]={foldState:Yt.Vt.UNFOLDED}:d&&u&&(m[Yt.sk.START]={foldState:Yt.Vt.UNFOLDED}),e.updateLayoutConfig(m,t)})(t,u);break;case $:a.mutate({mutation:Wr,variables:{slotNames:[Yt.sk.MONITOR],windowId:u,isHidden:!0}});break;case W:a.mutate({mutation:Wr,variables:{slotNames:[Yt.sk.HEADER,Yt.sk.NAV,Yt.sk.NOTIFICATIONS,Yt.sk.SUBNAV,Yt.sk.TITLE_BAR],windowId:u,isHidden:!0}});break;case H:a.mutate({mutation:Wr,variables:{slotNames:[Yt.sk.HEADER,Yt.sk.NAV,Yt.sk.NOTIFICATIONS,Yt.sk.SUBNAV,Yt.sk.TITLE_BAR],windowId:u,isHidden:!1}});break;case Y:((e,t)=>{e.updateLayoutConfig({[Yt.sk.NAV]:{toggleFoldState:!0}},t)})(t,u);break;case X:a.mutate({mutation:Wr,variables:{slotNames:[Yt.sk.MONITOR],windowId:u,isHidden:!1}})}if(y=i.command,!Boolean(y.data))return void h.error(`Command action ${m} is missing data at CoreLayoutApp.`);switch(m){case x:return(async(e,t,n,i,a,{clientLaunchId:o,forceTransition:r,windowId:s,layoutMode:l,shouldShowWithoutFocus:d,userContextId:u},m)=>{const{enableHandlingDefaultCommandsInCoreLayoutApp:p}=t.get(c.w.Core,["enableHandlingDefaultCommandsInCoreLayoutApp"]),g=Zm({forceTransition:r,shouldShowWithoutFocus:d});if(!p)return g;const h=Jm(n,s,l),v=!(!u||!h?.isMainWindow)&&u!==h?.userContextId;if(!v&&!r&&Km(h))return i.log(`${Ym} - Suppressing default command for window: ${s}, isUserSwitch:${v}, forceTransition:${r}`),g;let y;try{const t=m.findScenario(be.Cu.ApplicationLaunchTime);t?.mark(be.BQ.BeforeDefaultCommandQuery),y=await Qm(e,i,o),t?.mark(be.BQ.AfterDefaultCommandQuery)}catch(e){return i.error(`${Ym} - Error getting default app view command: ${e}`),g}return y&&i.log(`${Ym} - Default command found: ${y.command.action}`),y?a.getAppByActor(y.command.actor)?y:(i.error(`${Ym} - No app found for default command: ${y.command.actor}, falling back to default/default to be handled by entityCommandResolvers`),g):(i.error(`${Ym} - No default command found, falling back to default/default to be handled by entityCommandResolvers`),g)})(a,s,t,h,n,i.command.data,l);case O:{const{excludeHeader:e}=i.command.data,t=e?[Yt.sk.NOTIFICATIONS,Yt.sk.SUBNAV]:[Yt.sk.HEADER,Yt.sk.NOTIFICATIONS,Yt.sk.SUBNAV];a.mutate({mutation:Wr,variables:{slotNames:t,windowId:u,isHidden:!0}});break}case G:const{isDisplayed:r}=i.command.data;return void t.updateLayoutConfig({[Yt.sk.TITLE_BAR]:{foldState:r?Yt.Vt.UNFOLDED:Yt.Vt.FOLDED,useForce:!0}},u);case V:return async function(e,t,n){const{activeWindowsService:i,requestContext:{coreSettings:a},windowId:o}=t,{entity:r,correlation:s,targetWindow:l}=e,d=await(async(e,t,n,i,a)=>{const{activeWindowsService:o,appsRegistryService:r,requestContext:{client:s,coreSettings:l}}=t,{enableHandlingDefaultCommandsInCoreLayoutApp:d}=l.get(c.w.Core,["enableHandlingDefaultCommandsInCoreLayoutApp"]);if(!d)return Xm(e);if(Jm(o,n,i))return Xm(e);const u=await Qm(s,a);if(!u)return Xm(e);a.log(`${Ym} - Getting default command behind modal for: ${u.command.actor}`);const m=r.getAppByActor(u.command.actor);if(!m||!m.onCommandReceived)return Xm(e);const p=await m.onCommandReceived({...t,commandInput:u});return p&&ep(p)?(a.log(`${Ym} - Got a default command command behind modal with entity type: ${p.entity.type}`),{...Xm(e),defaultEntityBehindExtension:p.entity}):Xm(e)})(r,t,l?.id,l?.layoutMode,n),{enableDecoupleCommandingFromResolversExtend:u}=a.get(c.w.Core,["enableDecoupleCommandingFromResolversExtend"]);if(d&&(!u||!i.getStandardMainWindow()))return d;return void i.executeCommand("handleExtendCommand")({entity:r,correlation:{id:s?.id||(0,E.v4)(),startTimestamp:s?.startTimestamp||Date.now(),source:s?.source||A.p.Core},openOnMainWindow:!!l?.name||!o,mainWindowLayoutMode:l?.layoutMode,windowId:o,userContextId:o&&i.getActiveWindow(o)?.userContextId||null})}(i.command.data,e,h);case z:a.mutate({mutation:Vr,variables:{windowId:u,entityType:"floatingmonitor",entityAction:"view",entityOptions:JSON.stringify(i.command.data)}});break;case q:return function(e,t,n,i){const{error:a}=e,o=i?n.getActiveWindow(i):n.getStandardMainWindow(),r=o?.correlation.id;r||t.warn("Unable to get active target window for use in correlating oops page.");let s;try{s=a.serialize()}catch{t.warn("Could not serialize error in showing oops page.")}return{entity:{type:ke.ck.error,action:ke.SY.view},command:{stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.show,correlation:{source:A.p.LayoutError,id:r}},entityOptions:{errorReason:a.code,serializedError:s}}}(i.command.data,h,t,u);case K:return op(a,h,i.command.data);case Q:return np(i.command.data,t,n,o,s,u);case J:(({showOption:e},t,n)=>{let i={};switch(e){case"show":i={[Yt.sk.START]:{foldState:Yt.Vt.UNFOLDED}};break;case"hide":i={[Yt.sk.START]:{foldState:Yt.Vt.FOLDED,useForce:!0}};break;case"toggle":i={[Yt.sk.START]:{toggleFoldState:!0}}}t.updateLayoutConfig(i,n)})(i.command.data,t,u);break;case j:const{containerState:d}=i.command.data;t.getWindowLayoutService(u).modalManager.setContainerState(d,!0);break;default:h.error(`Command action ${m} is not supported at CoreLayoutApp.`)}}var y},onViewUpdateCommandResolved:async()=>{},viewStateRegistration:{gqlTypeName:"CoreLayoutAppViewState",queryFieldName:"coreLayoutAppViewState",navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{amsV2Domain:"",baseImageUrl:"",completePhaseReached:!1,isImageAuthCookieValid:!1,meControlAvatarSrc:"",postCriticalPhaseReached:!1},computedValues:void 0}};var sp,lp=n(436694);!function(e){e.DIAGNOSTICSSERVICE="DiagnosticsService"}(sp||(sp={}));const cp=e=>{let t;const n=[];return{newScenario:i=>{if(t)return t.newScenario(i);if(e&&n.length<20){const e=mp(i,n);return n.push(e),e}},setScenarioFactory:e=>{t=e,dp(n,t)}}},dp=(e,t)=>{if(e.length>0)for(let n=e.length-1;n>=0;n--)up(e[n],t)&&e.splice(n,1)},up=(e,t,n)=>{if(e.status){const i=t.newScenario(e.name,{startTime:e.time});if("failed"===e.status&&i.fail({cached:!0,overrideTimestamp:e.endtime,...e.result}),"stopped"===e.status&&i.stop({cached:!0,overrideTimestamp:e.endtime,...e.result}),"cancelled"===e.status&&i.cancel({cached:!0,overrideTimestamp:e.endtime,...e.result}),n){const t=n.indexOf(e);t>=0&&n.splice(t,1)}return!0}return e.setFactory?.(t),!1},mp=(e,t)=>{let n,i,a,o;const r={name:e,time:Date.now(),fail:e=>{i="failed",a=Date.now(),n=e,o&&up(r,o,t)},stop:e=>{i="stopped",a=Date.now(),n=e,o&&up(r,o,t)},cancel:e=>{i="cancelled",a=Date.now(),n=e,o&&up(r,o,t)},get result(){return n},get status(){return i},get endtime(){return a},setFactory:e=>o=e};return r};var pp,gp=n(446372);class hp{constructor(){this.eventsBufferArray=[],this.isForErrorLogs=!1,this.ALTCompleted=!1}addEvents(e){e&&e.length>0&&e.forEach((e=>{this.addEvent(e)}))}getBufferedEvents(e){const t=this.eventsBufferArray.sort(((e,t)=>{const n="function"==typeof e.timeStamp.getTime?e.timeStamp:new Date(e.timeStamp),i="function"==typeof t.timeStamp.getTime?t.timeStamp:new Date(t.timeStamp);return n.getTime()-i.getTime()}));return e&&e>0&&e<t.length?t.slice(t.length-e):t}setALTDone(){this.ALTCompleted=!0}fetchPersistedLogsFromLastSession(){if(this.host?.localStorage){const e=(0,gp.NJ)(this.userId,this.isForErrorLogs);try{(0,gp.j8)(this,this.host.localStorage,e,!0)}catch(t){this.host.localStorage.removeItem(e);const n=`DiagnosticsService: Failed to load persisted logs from store with error: ${t}`;this.addEvent({message:n,isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date})}}}shiftBufferArray(){return this.eventsBufferArray.shift()}addIntoBufferArray(e){this.eventsBufferArray.push(e)}get bufferArraySize(){return this.eventsBufferArray.length}}class vp extends hp{constructor(e=!1,t,n,i){super(),this.isForErrorLogs=e,this.sessionId=t,this.host=n,this.maxCapacity=i,this.queueCapacity=this.maxCapacity||vp.DEFAULT_QUEUE_CAPACITY}setCapacity(e){const t=e.bufferSize||0;t<1||this.queueCapacity===t||(this.queueCapacity=t,this.bufferArraySize>t&&(this.eventsBufferArray=this.eventsBufferArray.slice(this.bufferArraySize-t)))}addEvent(e){this.bufferArraySize<this.queueCapacity||this.shiftBufferArray(),this.addIntoBufferArray(e)}getAllEvents(e){return 0===e?Promise.resolve([]):e&&e<=this.bufferArraySize?Promise.resolve(this.getBufferedEvents().slice(this.bufferArraySize-e)):Promise.resolve(this.getBufferedEvents())}setScenarioFactory(e){}handleUserLogout(){this.eventsBufferArray=[];const e=(0,gp.NJ)(this.userId);return this.host?.localStorage.removeItem(e),Promise.resolve()}setDBInfo(e,t,n){this.tId||(this.tId=e),this.oId||(this.oId=t),this.userId||(this.userId=n,this.fetchPersistedLogsFromLastSession())}persistLogs(){if(this.eventsBufferArray.length>0&&this.host?.localStorage){const e=(0,gp.NJ)(this.userId,this.isForErrorLogs);(0,gp.oG)(this,this.host.localStorage,e,this.sessionId)}}}vp.DEFAULT_QUEUE_CAPACITY=1e3,function(e){e[e.ecsSetting=0]="ecsSetting",e[e.clientPreference=1]="clientPreference",e[e.error=2]="error",e[e.beforeDeletingDB=3]="beforeDeletingDB"}(pp||(pp={}));class yp{constructor(e,t){this.sessionId=e,this.allowedBufferLength=2e3,this.minBufferLength=500,this.maxBufferLength=5e3,this.timeThrottlingIntervalMs=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.disableExtendedPersistingThrottling=!1,this.fetchFromIDBTimeLimit=18e3,this.minFetchFromIDBTimeLimit=5e3,this.eventsBufferArray=[],this.updateBufferLength(t),this.scenarioFactory=cp(!0)}setExtendedStorage(e){this._extendedStorage=e}setCapacity(e){void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingIntervalMs=1e3*e.throttleTime),void 0!==e.clientEnableExtendedLogs&&(this.disableExtendedPersistingThrottling=e.clientEnableExtendedLogs),this.updateBufferLength(e.bufferSize),e.IDBFetchingTimeoutMs&&e.IDBFetchingTimeoutMs>this.minFetchFromIDBTimeLimit&&(this.fetchFromIDBTimeLimit=e.IDBFetchingTimeoutMs)}addEvent(e){if(this.eventsBufferArray.push(e),!(this.eventsBufferArray.length<this.allowedBufferLength)){if(!this._extendedStorage?.isStorageEnabled)return this.skippedEventsCount++,void this.eventsBufferArray.shift();if(this.shouldBeThrottled()){this.skippedEventsCount++;const e=this.eventsBufferArray.shift();void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=e?.timeStamp),this.lastSkippedEventTime=e?.timeStamp}else this.flushBufferIntoExtendedStorage()}}async getAllEvents(e){if(this._extendedStorage?.isStorageEnabled&&(!e||e&&e>this.eventsBufferArray.length)){const t=e?e-this.eventsBufferArray.length:void 0,n=this._extendedStorage.getLatestLogs(t);try{const e=await(0,yi.a)(n,this.fetchFromIDBTimeLimit);return Promise.resolve(e.concat(this.eventsBufferArray))}catch{const e=this.eventsBufferArray;return e.push({message:`DiagnosticsService - fetching logs form IDB timedout with limit of ${this.fetchFromIDBTimeLimit} ms`,isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),Promise.resolve(e)}}return e&&this.eventsBufferArray.length>e?Promise.resolve(this.eventsBufferArray.slice(this.eventsBufferArray.length-e)):Promise.resolve(this.eventsBufferArray)}handleUserLogout(){return this.eventsBufferArray.length=0,this._extendedStorage?this._extendedStorage.clearLogs():Promise.resolve(!0)}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}getBufferedEvents(e){return e&&e>0&&e<this.eventsBufferArray.length?this.eventsBufferArray.slice(this.eventsBufferArray.length-e):this.eventsBufferArray}flushBufferIntoExtendedStorage(){if(this.eventsBufferArray.length>0&&this._extendedStorage?.isStorageEnabled){const e=this.eventsBufferArray;this.eventsBufferArray=[];const t=this.skippedEventsCount;this.updateThrottleInfo(e),this.lastPersistTimestamp=Date.now();const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsSaveToExtendedStorageMain),i=this.timeThrottleEnabled();this._extendedStorage.storeLogs(e,this.sessionId,Date.now(),i?"buffer-full":"buffer-full-without-throttle"),n?.stop({skippedCount:t,reason:"regular",message:i?"throttle_enabled":"throttle_not_enabled"})}}updateThrottleInfo(e){if(this.skippedEventsCount>0){let t=`DiagnosticsService - skipped ${this.skippedEventsCount} event logs before extended logs storage enabled`,n=new Date;this.lastSkippedEventTime&&(t=`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${this.firstSkippedEventTime?.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,n=this.lastSkippedEventTime),e.unshift({message:t,level:gi.$.Info,levelName:"Info",isPiiFree:!0,timeStamp:n}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0}}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingIntervalMs}timeThrottleEnabled(){return!this.disableExtendedPersistingThrottling&&this.timeThrottlingIntervalMs>0&&this.lastPersistTimestamp>0}updateBufferLength(e){e&&e!==this.allowedBufferLength&&e>=this.minBufferLength&&e<=this.maxBufferLength&&(this.allowedBufferLength=e)}}class Sp{constructor(){this.minAllowedStorageObjectCount=3,this.allowedCountOfStorageObject=10,this.sessionId="",this.allowCacheStoredItemIDs=!1,this.scenarioFactory=cp(!0)}setCapacity(e){this.allowedCountOfStorageObject!==e&&e>=this.minAllowedStorageObjectCount&&(this.allowedCountOfStorageObject=e,this.checkStorageItemCount())}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}parseAndSortLogs(e,t){const n=new Map;e.forEach((e=>{if(e.logsArray&&e.logsArray.length>0){const t=n.get(e.sessionId)||[];n.set(e.sessionId,t.concat(e.logsArray))}}));const i=n.get(this.sessionId)||[];if(i&&n.delete(this.sessionId),n.forEach(((e,t)=>{e.sort(gp.e),this.addAnSeperateLogItem(e,t)})),i.sort(gp.e),t&&i.length>=t)return i.slice(i.length-t);let a=Array.from(n.values()).sort(((e,t)=>{const n="function"==typeof e[e.length-1].timeStamp.getTime?e[e.length-1].timeStamp:new Date(e[e.length-1].timeStamp),i="function"==typeof t[t.length-1].timeStamp?t[t.length-1].timeStamp:new Date(t[t.length-1].timeStamp);return n.getTime()-i.getTime()})).flat().concat(i);return t&&a.length>t&&(a=a.slice(a.length-t)),a}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${gp.Oh} The following logs are for previous session [${t}] ${gp.Oh}`,isPiiFree:!0,level:gi.$.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}}class fp extends Sp{constructor(e,t,n,i=!1){super(),this.idbFactory=e,this.databaseName=t,this.sessionId=n,this.allowCacheStoredItemIDs=i,this.indexedDBVersion=1,this.storeName="LogsStore",this.timeIndexName="timeIdx",this.IDBErrorCount=0,this.allowedIDBErrorCount=10,this.disableIDBLogs=!1,this.ongoingSavingRequestCount=0,this.allowedSavingRequestCount=3,this.currentIDBItemIndex=-1,this.indexedDBManagedDiagnosticItems=[]}initialize(){if(this.db)return Promise.resolve(!0);if(this.disableIDBLogs)return Promise.resolve(!1);const e=this.scenarioFactory.newScenario(be.Cu.DiagnosticsOpenIDB);return new Promise((t=>{const n=this.idbFactory.open(this.databaseName,this.indexedDBVersion);n.onerror=()=>{e?.fail({reason:"openDB error"}),this.increaseIDBErrorCount(),t(!1)},n.onblocked=()=>{e?.fail({reason:"openDB blocked",context:this.databaseName}),this.increaseIDBErrorCount(),t(!1)},n.onupgradeneeded=()=>{this.createDataStores(n.result)},n.onsuccess=()=>{e?.stop({context:this.databaseName}),this.allowCacheStoredItemIDs?this.initializeManagementArray(n.result):this.db=n.result,t(!0)}}))}async getLatestLogs(e){const t=this.getIDBStore(this.db,this.storeName,"readonly");if(t){return new Promise((n=>{const i=t.index(this.timeIndexName);if(!i)return n([]);{const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllLogsFromIDB),a=i.getAll();a.onsuccess=()=>{t?.stop({context:this.databaseName});const i=this.parseAndSortLogs(a.result,e);n(i)},a.onerror=()=>{t?.fail({reason:a.error,context:this.databaseName}),this.increaseIDBErrorCount(),n([])}}}))}return Promise.resolve([])}clearLogs(){return this.db?(this.disablePersistIntoIDB("Before clearing IDB"),this.db.close(),new Promise((e=>{const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsDeleteIDB),n=this.idbFactory.deleteDatabase(this.databaseName);n.onblocked=()=>{t?.fail({reason:`Deleting DB blocked for ${n.error}`,context:this.databaseName}),this.increaseIDBErrorCount(),e(!1)},n.onsuccess=()=>{t?.stop({context:this.databaseName}),this.indexedDBManagedDiagnosticItems=[],this.currentIDBItemIndex=-1,e(!0)},n.onerror=()=>{t?.fail({reason:`Deleting DB failed for ${n.error}`,context:this.databaseName}),this.increaseIDBErrorCount(),e(!1)}}))):Promise.resolve(!0)}storeLogs(e,t,n,i="force"){if(e.length>0){const a=this.scenarioFactory.newScenario(be.Cu.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(this.getNextManagedItem(),e,!1,t||this.sessionId,n||Date.now(),i),a?.stop({context:this.databaseName})}}get isStorageEnabled(){return!this.disableIDBLogs&&!!this.db}checkStorageItemCount(){if(this.allowCacheStoredItemIDs){this.getToBeDeletedIDs().forEach((e=>this.deleteIDBItem(e)))}else{const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=e.index(this.timeIndexName);if(t){const e=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllKeysFromIDB),n=t.getAllKeys();n.onsuccess=()=>{if(e?.stop({context:this.databaseName}),n.result.length>this.allowedCountOfStorageObject){const e=n.result.length-this.allowedCountOfStorageObject;for(let t=0;t<e;t++)this.deleteIDBItem(n.result[t])}},n.onerror=()=>{e?.fail({reason:n.error,context:this.databaseName}),this.increaseIDBErrorCount()}}}}}createDataStores(e){const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsCreateIDBStore);try{e.createObjectStore(this.storeName,{autoIncrement:!0}).createIndex(this.timeIndexName,"timeStamp",{unique:!1}),t?.stop({context:this.databaseName})}catch(e){t?.fail({reason:e,context:this.databaseName})}}getIDBStore(e,t,n){if(e)try{const i=e.transaction(t,n);return i?.objectStore(t)}catch{this.disablePersistIntoIDB("getIDBStore failed")}}persistBufferIntoDB(e,t,n=!1,i,a,o="buffer-full"){if(0===t.length)return;if(this.ongoingSavingRequestCount>this.allowedSavingRequestCount)return void this.disablePersistIntoIDB(`${this.ongoingSavingRequestCount} saving logs request are pending`);if(e.isUpdating&&!n)return void this.disablePersistIntoIDB("All diagnostics log indexedDB items are pending update");const r=this.getIDBStore(this.db,this.storeName,"readwrite");if(!r)return;n||(e.isUpdating=!0,e.timeStamp=a||Date.now());const s={logsArray:t,sessionId:i||this.sessionId,timeStamp:e.timeStamp};let l,c;this.ongoingSavingRequestCount++,e.IDBId>0?(c=this.scenarioFactory.newScenario(be.Cu.DiagnosticsUpdateIDBItem),l=r.put(s,e.IDBId)):(c=this.scenarioFactory.newScenario(be.Cu.DiagnosticsAddLogsIntoIDB),l=r.add(s)),l.onsuccess=()=>{this.ongoingSavingRequestCount--,c?.stop({reason:"buffer-full"===o||"buffer-full-without-throttle"===o?"regular":"forced",message:"buffer-full"===o?"throttle_enabled":"throttle_not_enabled",context:this.databaseName}),t.length=0,this.allowCacheStoredItemIDs&&(e.isUpdating=!1,e.IDBId=l.result),this.checkStorageItemCount()},l.onerror=()=>{this.ongoingSavingRequestCount--,c?.fail({reason:`${"buffer-full"===o||"buffer-full-without-throttle"===o?"regular":"forced"} - error: ${l.error}`,retryCount:n?1:0,context:this.databaseName,message:"buffer-full"===o?"throttle_enabled":"throttle_not_enabled"}),n?(t.length=0,e.isUpdating=!1,this.increaseIDBErrorCount()):this.persistBufferIntoDB(e,t,!0,i,a,o)}}getToBeDeletedIDs(){const e=[];if(this.allowCacheStoredItemIDs&&this.allowedCountOfStorageObject<this.indexedDBManagedDiagnosticItems.length){const t=this.indexedDBManagedDiagnosticItems.length-this.allowedCountOfStorageObject;for(let n=0;n<t;n++){let t=0;this.currentIDBItemIndex<this.indexedDBManagedDiagnosticItems.length-1&&(t=this.currentIDBItemIndex+1);const n=this.indexedDBManagedDiagnosticItems[t];e.push(n.IDBId),this.indexedDBManagedDiagnosticItems.splice(t,1),0===t&&this.currentIDBItemIndex--}}return e}deleteIDBItem(e){const t=this.getIDBStore(this.db,this.storeName,"readwrite");if(t){const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsDeleteLogsInIDB),i=t.delete(e);i.onsuccess=()=>{n?.stop({context:this.databaseName})},i.onerror=()=>{n?.fail({reason:i.error,context:this.databaseName}),this.increaseIDBErrorCount()}}}getNextManagedItem(){return this.allowCacheStoredItemIDs?(this.currentIDBItemIndex===this.indexedDBManagedDiagnosticItems.length-1?this.indexedDBManagedDiagnosticItems.length<this.allowedCountOfStorageObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.indexedDBManagedDiagnosticItems[this.currentIDBItemIndex]):{IDBId:0,timeStamp:0,isUpdating:!1}}initializeManagementArray(e){if(this.allowCacheStoredItemIDs&&e&&!this.db){const t=this.getIDBStore(e,this.storeName,"readwrite");if(t){const n=t.index(this.timeIndexName);if(n){const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllKeysFromIDB),i=n.getAllKeys();i.onsuccess=()=>{t?.stop(),this.db=e,this.indexedDBManagedDiagnosticItems=[],i.result.forEach((e=>this.addNewManagementItem(e))),this.currentIDBItemIndex=this.indexedDBManagedDiagnosticItems.length-1,Promise.resolve(!0)},i.onerror=()=>{t?.fail({reason:i.error}),this.increaseIDBErrorCount(),Promise.resolve(!1)}}}}}addNewManagementItem(e=0){this.indexedDBManagedDiagnosticItems.push({timeStamp:0,isUpdating:!1,IDBId:e})}increaseIDBErrorCount(){this.IDBErrorCount<this.allowedIDBErrorCount&&(this.IDBErrorCount++,this.IDBErrorCount===this.allowedIDBErrorCount&&this.disablePersistIntoIDB("Allowed IDB error count reached"))}disablePersistIntoIDB(e){this.disableIDBLogs||(this.disableIDBLogs=!0,this.scenarioFactory.newScenario(be.Cu.DiagnosticsDisableIDB)?.stop({errorReason:e,context:this.databaseName}))}}class kp extends Sp{constructor(e,t,n,i=!1){super(),this.host=e,this.folderName=t,this.sessionId=n,this.allowCacheStoredItemIDs=i,this.OPFSErrorCount=0,this.allowedOPFSErrorCount=10,this.disableOPFSLogs=!1,this.ongoingSavingRequestCount=0,this.allowedSavingRequestCount=3,this.rootFolderName="DiagnosticsLogs",this.folderName=this.folderName.split(":").join("_")}async initialize(){if(this.folderHandle)return Promise.resolve(!0);if(this.folderName){const e=this.scenarioFactory.newScenario(be.Cu.DiagnosticsInitOPFS);try{const t=await this.host.navigator.storage.getDirectory();return this.logsRootFolderHandle=await t.getDirectoryHandle(this.rootFolderName,{create:!0}),await this.isFileHandleWritable(this.logsRootFolderHandle)||this.disablePersistIntoOPFS("Creating writable is not available"),this.folderHandle=await this.logsRootFolderHandle.getDirectoryHandle(this.folderName,{create:!0}),e?.stop({context:this.folderName}),!0}catch(t){e?.fail({reason:t.errorCode||t.code})}}return!1}async getLatestLogs(e){return this.folderHandle?new Promise((async t=>{const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllLogsFromOPFS);try{const i=[],a=await(this.folderHandle?.values()),o=await this.getAllFiles(a),r=[];for(const e of o){const t=await e.value.getFile(),n=await t.text();let a=!1;if(n&&n.length>0)try{const e=JSON.parse(n);i.push(e)}catch{a=!0}else a=!0;a&&r.push(e.value.name)}const s=this.parseAndSortLogs(i,e);n?.stop({context:this.folderName}),r.length>0&&await this.deleteOPFSItems(r),t(s)}catch(e){n?.fail({reason:e.errorCode||e.code}),this.increaseOPFSErrorCount(),t([])}})):Promise.resolve([])}clearLogs(){return this.ongoingClearLogs||(this.disablePersistIntoOPFS("Deleting user OPFS folder"),this.ongoingClearLogs=new Promise((async e=>{let t=!0;if(this.logsRootFolderHandle&&this.folderHandle?.name){const e=this.folderHandle.name,n=this.logsRootFolderHandle,i=this.scenarioFactory.newScenario(be.Cu.DiagnosticsClearOPFSFolder);try{await n.removeEntry(e,{recursive:!0}),this.storedItemIds=void 0,i?.stop({context:this.folderName})}catch(e){i?.fail({reason:`Deleting OPFS folder failed for ${e.errorCode||e.code}`}),this.increaseOPFSErrorCount(),t=!1}}this.ongoingClearLogs=void 0,e(t)}))),this.ongoingClearLogs}storeLogs(e,t,n,i="force"){if(0===e.length)return;const a=this.scenarioFactory.newScenario(be.Cu.DiagnosticsSaveOPFSItemMain),o=this.createLogsFile(e,t||this.sessionId,n);this.persistBufferIntoOPFS(o,!1,i),a?.stop({context:this.folderName})}get isStorageEnabled(){return!this.disableOPFSLogs&&!!this.folderHandle}async checkStorageItemCount(){try{const e=await this.getStoredItemIds();e&&e.length>this.allowedCountOfStorageObject&&this.deleteOPFSItems(e.slice(0,e.length-this.allowedCountOfStorageObject))}catch(e){this.increaseOPFSErrorCount()}}async getStoredItemIds(){if(this.allowCacheStoredItemIDs&&void 0!==this.storedItemIds)return this.storedItemIds;if(!this.folderHandle)return this.storedItemIds||[];const e=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllKeysFromOPFS);try{if(void 0===this.storedItemIds&&this.allowCacheStoredItemIDs||!this.allowCacheStoredItemIDs){this.storedItemIds=[];const t=await this.folderHandle.keys();let n=await t.next();for(;void 0!==n&&!n.done&&n.value;)n.value.indexOf("crswap")<0&&this.storedItemIds.push(n.value),n=await t.next();e?.stop({context:this.folderName}),this.storedItemIds.sort(((e,t)=>Number(e)-Number(t)))}}catch{e?.fail({reason:"Get stored item Ids fail",context:this.folderName}),this.increaseOPFSErrorCount()}return this.storedItemIds||[]}async getAllFiles(e){const t=[];if(e){let n=await e.next();for(;n&&!n.done&&n.value;)"file"===n.value.kind&&t.push(n),n=await e.next()}return t}async persistBufferIntoOPFS(e,t=!1,n="buffer-full"){if(0===e.logsArray.length)return Promise.resolve();if(this.ongoingSavingRequestCount>this.allowedSavingRequestCount)return this.disablePersistIntoOPFS(`${this.ongoingSavingRequestCount} saving logs request are pending`),Promise.resolve();if(this.folderHandle){const i=e.timeStamp.toString(),a=await this.folderHandle.getFileHandle(i,{create:!0});if(a){this.ongoingSavingRequestCount++;const o=this.scenarioFactory.newScenario(be.Cu.DiagnosticsAddLogsIntoOPFS);try{const t=await a.createWritable();await t.write(JSON.stringify(e)),await t.close(),this.ongoingSavingRequestCount--,o?.stop({reason:"buffer-full"===n||"buffer-full-without-throttle"===n?"regular":"forced",message:"buffer-full"===n?"throttle_enabled":"throttle_not_enabled",context:this.folderName}),this.allowCacheStoredItemIDs&&void 0!==this.storedItemIds&&this.storedItemIds.push(i),"force"!==n&&this.checkStorageItemCount()}catch(i){this.ongoingSavingRequestCount--,o?.fail({reason:`${"buffer-full"===n||"buffer-full-without-throttle"===n?"regular":"forced"} - error: ${i.errorCode||i.code}`,message:"buffer-full"===n?"throttle_enabled":"throttle_not_enabled",retryCount:t?1:0}),t?this.increaseOPFSErrorCount():await this.persistBufferIntoOPFS(e,!0,n)}}}}async deleteOPFSItems(e){e.length>0&&this.folderHandle&&await Promise.all(e.map((async e=>{await this.deleteOneOPFSItem(e,!1)&&this.storedItemIds&&(this.storedItemIds=this.storedItemIds.filter((t=>t!==e)))})))}async deleteOneOPFSItem(e,t,n){const i=n||this.scenarioFactory.newScenario(be.Cu.DiagnosticsDeleteLogsInOPFS);try{await(this.folderHandle?.removeEntry(e)),i?.stop({context:e})}catch(n){if(!this.isAnAcceptableOPFSDeleteError(n?.message))return t?(i?.fail({reason:n.message,context:e}),this.increaseOPFSErrorCount(),!1):this.deleteOneOPFSItem(e,!0,i);i?.cancel({reason:n.message,context:e})}return!0}isAnAcceptableOPFSDeleteError(e){return!(!e||!this.allowCacheStoredItemIDs)&&(e.indexOf("could not be found")>=0||e.indexOf("not allowed")>=0)}increaseOPFSErrorCount(){this.OPFSErrorCount<this.allowedOPFSErrorCount&&(this.OPFSErrorCount++,this.OPFSErrorCount===this.allowedOPFSErrorCount&&this.disablePersistIntoOPFS("Allowed OPFS error count reached"))}disablePersistIntoOPFS(e){this.disableOPFSLogs||(this.disableOPFSLogs=!0,this.scenarioFactory.newScenario(be.Cu.DiagnosticsDisableOPFS)?.stop({reason:e}))}createLogsFile(e,t,n){return{logsArray:e,sessionId:t,timeStamp:n||Date.now()}}async isFileHandleWritable(e){try{const t=await e.getFileHandle("writableTest",{create:!0});(await t.createWritable()).close()}catch{return!1}return!0}}class Cp{constructor(e,t,n,i,a){this.sessionId=e,this.experienceName=t,this.extendedStoreName=n,this.defaultPreECSConsoleLogLevel=i,this.userECSConsoleLogLevel=a,this.userDiagnosticsMap=new Map,this._userID="",this.memoryBufferArraySize=0,this._minDurationForCountingLogLines=20,this._minThrottleWindowSize=1e4,this._minThrottleWindowCapacity=5,this._minLoggerReportTimeInterval=1e4,this._minLoggerReportCountInterval=30,this._maxCorePreviousSessionLogsLength=0,this._maxUserPreviousSessionLogsLength=0,this._cleanPreviousSessionLogsDelay=18e4,this._clearPreviousSessionLogsTimer=0,this._minLogsInLogFile=500,this._ALTCompleted=!1,this.rwcExperienceName="react-web-client",this.logsStoredAsPreviousSession=!1,this._disableGzipPreviousSessionLogs=!1,this._defaultMainBufferLength=2e3,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.extendedStorageType="None",this._loggerSettings={durationForCountingLogLines:0,loggerReportTimeInterval:0,loggerReportCountInterval:0,diagnosticsLogsThrottling:"DryRunQuiet",isUserEnableIDBLogs:!1,throttleWindowSize:0,throttleCapacity:0,consoleLogLevel:gi.$.Error,throttleLoggers:new Set},this._defaultLatestErrorCount=5,this.tId="",this.oId="",this._firstUserID="",this.logsProviderName=sp.DIAGNOSTICSSERVICE,this.updatedSettingsForMainThread=e=>{this.diagnosticsSettings=e,(0,we.isUndefined)(e.clientExtendedDiagnosticsData)||(this.isUserEnableIDBLogs=!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle),this.updateSettingsForLogger({durationForCountingLogLines:e.logsMarkInterval||0,loggerReportTimeInterval:e.loggerReportTimeInterval||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:e.loggerReportCountInterval||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:e.throttleWindowSizeMs||0,throttleCapacity:e.throttleCapacity||0,isUserEnableIDBLogs:this.isUserEnableIDBLogs,diagnosticsLogsThrottling:e.diagnosticsLogsThrottling||"DryRunQuiet",throttleLoggers:new Set(e.loggerThrottleList||[]),consoleLogLevel:this.validateConsoleLogLevel(e.consoleLogLevel||"")});const t=(0,we.isNumber)(e.savingLogsIntoIDBThrottleTime)?e.savingLogsIntoIDBThrottleTime:void 0,n=(0,we.isNumber)(e.diagnosticsEventQueueMaxSize)?e.diagnosticsEventQueueMaxSize:0;if(void 0===e.enableStoreDiagnosticsLogsInIDB&&void 0===e.clientExtendedDiagnosticsData)this.diagnosticsEvents.setCapacity({bufferSize:n,throttleTime:t});else{(0,we.isUndefined)(e.enableStoreDiagnosticsLogsInIDB)||(this.ecsEnableIDBLogs=!!e.enableStoreDiagnosticsLogsInIDB),this.enableExtendedStorage()&&!this.extendedStorage?.isStorageEnabled&&this.addAndInitExtendedStorage();const i=this.enableExtendedStorage()?(0,we.isNumber)(e.diagnosticsLogBufferArraySize)?e.diagnosticsLogBufferArraySize:0:n;this.diagnosticsEvents.setCapacity({bufferSize:i,clientEnableExtendedLogs:this.isUserEnableIDBLogs,IDBFetchingTimeoutMs:(0,we.isNumber)(e.IDBFetchingTimeoutMs)?e.IDBFetchingTimeoutMs:0,throttleTime:t}),this.extendedStorage?.setCapacity?.((0,we.isNumber)(e.diagnosticsLogsIDBObjectCount)?e.diagnosticsLogsIDBObjectCount:0)}this._disableGzipPreviousSessionLogs=!!e.disableGzipPreviousSessionLogs,this._maxCorePreviousSessionLogsLength=this.validateSettingNumberValue(e.corePreviousSessionLogsLength,-1,this._maxCorePreviousSessionLogsLength),this._maxUserPreviousSessionLogsLength=this.validateSettingNumberValue(e.userPreviousSessionLogsLength,-1,this._maxUserPreviousSessionLogsLength),this.isErrorDiagnosticsEnabled=!!e.errorDiagnosticsEventQueueMaxSize,e.extendedStorageType&&(this.extendedStorageType=e.extendedStorageType),this.isErrorDiagnosticsEnabled?(0,we.isNumber)(e.errorDiagnosticsEventQueueMaxSize)&&this.errorDiagnosticsEvents.setCapacity({bufferSize:e.errorDiagnosticsEventQueueMaxSize}):this.errorDiagnosticsEvents.handleUserLogout(),this._cleanPreviousSessionLogsDelay=this.validateSettingNumberValue(e.clearPreviousSessionLogsDelayMs,0,this._cleanPreviousSessionLogsDelay)},this.updatedSettingsForWorkerThread=e=>{this.diagnosticsSettings=e;const{workerDiagnosticsEventQueueMaxSize:t,enableWorkerStoreDiagnosticsLogsInIDB:n,workerDiagnosticsLogBufferArraySize:i,workerDiagnosticsLogsIDBObjectCount:a,logsMarkInterval:o,savingLogsIntoIDBThrottleTime:r,throttleCapacity:s,throttleWindowSizeMs:l,clientExtendedDiagnosticsData:c,disableExtendedDiagnosticsDataToggle:d,diagnosticsLogsThrottling:u,consoleLogLevel:m,loggerReportTimeInterval:p,loggerReportCountInterval:g,loggerThrottleList:h}=e;this.updateSettingsForLogger({durationForCountingLogLines:o||0,loggerReportTimeInterval:p||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:g||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:l||0,throttleCapacity:s||0,isUserEnableIDBLogs:!!c&&!d,diagnosticsLogsThrottling:u||"DryRunQuiet",throttleLoggers:new Set(h||[]),consoleLogLevel:this.validateConsoleLogLevel(m||"")});const v=(0,we.isNumber)(r)?r:void 0,y=(0,we.isNumber)(t)?t:0;this.memoryBufferArraySize=n&&(0,we.isNumber)(i)?i:y,this.diagnosticsEvents.setCapacity({bufferSize:this.memoryBufferArraySize,enableIndexedDB:(0,we.isUndefined)(n)?void 0:!!n,IDBObjectCount:(0,we.isNumber)(a)?a:0,throttleTime:v,clientEnableExtendedLogs:(0,we.isUndefined)(c)?void 0:!!c&&!d}),this.extendedStorage?.setCapacity?.((0,we.isNumber)(e.workerDiagnosticsLogsIDBObjectCount)?e.workerDiagnosticsLogsIDBObjectCount:0)},this.attemptToSetHost(),this.scenarioFactory=cp(!1),void 0!==this.userECSConsoleLogLevel?this.loggerSettings.consoleLogLevel=this.userECSConsoleLogLevel:void 0!==i&&(this.loggerSettings.consoleLogLevel=i),this.diagnosticsEvents=new yp(this.sessionId,this._defaultMainBufferLength),this.isErrorDiagnosticsEnabled=!1,this.errorDiagnosticsEvents=new vp(!0,this.sessionId,this.host),this.host?.addEventListener&&this.host.addEventListener("unload",(()=>{this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer),this.persistDiagnosticsAsPreviousSessionLogs()}))}setWorkerLogsDataManager(e){}setScenarioFactory(e){this.coreScenarioFactory=e,this.scenarioFactory.setScenarioFactory(e),this.diagnosticsEvents.setScenarioFactory(e),this.extendedStorage?.setScenarioFactory(e),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScenarioFactory(e)}))}setLogsCountReporter(e){this._logsCountReporter||(this._logsCountReporter=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setLogsCountReporter(e)})))}setALTDone(){this._ALTCompleted||(this._ALTCompleted=!0,this.addAndInitExtendedStorage(),this._userID===gp.uY&&this.host?.localStorage&&this.cleanAllPreviousSessionLogsWithDelay(this.host),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>e.setALTDone())))}subscribeToCoreSettings(e){e.getObservable(c.w.Diagnostics).subscribe((e=>{this.extendedStoreName===ma.DiagnosticsLogsWorker?this.updatedSettingsForWorkerThread(e):(this.updatedSettingsForMainThread(e),this.userDiagnosticsMap.size>0&&this.userDiagnosticsMap.forEach(((t,n)=>{this._firstUserID===n?t.updatedSettingsForMainThread({...e,userPreviousSessionLogsLength:e.firstUserPreviousSessionLogsLength}):t.updatedSettingsForMainThread(e)})))}));e.getObservable(c.w.Platform).subscribe((e=>{if(this.extendedStoreName===ma.DiagnosticsLogsWorker){const{sessionId:t}=e;t&&this.updateSessionId(t)}})),this.logCountReporter&&this.logCountReporter.subscribeToCoreSettings(e)}updateDiagnosticInfo(e,t,n){e&&(this.tId=e),t&&(this.oId=t),n&&(this._userID=n),this.addAndInitExtendedStorage(),this.errorDiagnosticsEvents.setDBInfo(e,t,n)}handleUserLogout(e){if(e){const t=this.userDiagnosticsMap.get(e);if(t){this.userDiagnosticsMap.delete(e);let n=Promise.resolve();return 0===this.userDiagnosticsMap.size&&(n=this.cleanLogsStorage()),Promise.all([t.handleUserLogout(e),n]).then()}this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer)}return this.cleanLogsStorage()}createUserDiagnosticsService(e,t,n){if(this.extendedStoreName===ma.DiagnosticsLogsWorker||this._userID&&this._userID!==gp.uY)this.pushDiagnosticsEvent(gi.$.Error,"DiagnosticsService: createUserDiagnosticsService function should only be called from the coreDiagnosticsService in the main thread",!0);else if(e&&t&&n){this._userID||this.updateDiagnosticInfo(gp.ny,gp.AE,gp.uY),this._firstUserID||(this._firstUserID=n);let i=this.userDiagnosticsMap.get(n);return void 0===i&&(i=new Cp(this.sessionId,this.experienceName,this.extendedStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel),i.updateDiagnosticInfo(e,t,n),this.diagnosticsSettings&&(this._firstUserID===n?i.updatedSettingsForMainThread({...this.diagnosticsSettings,userPreviousSessionLogsLength:this.diagnosticsSettings.firstUserPreviousSessionLogsLength}):i.updatedSettingsForMainThread(this.diagnosticsSettings)),this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this._logsCountReporter&&i.setLogsCountReporter(this._logsCountReporter),this._ALTCompleted&&i.setALTDone(),this.userDiagnosticsMap.set(n,i)),i}}pushDiagnosticsEvent(e,t,n,i){const a=(0,gp.Ck)(this.diagnosticsEvents,e,t,n,i);e===gi.$.Error&&this.isErrorDiagnosticsEnabled&&this.errorDiagnosticsEvents.addEvent(a)}async getDiagnosticsEvents(e){let t=[];const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetLogs);try{t=await this.diagnosticsEvents.getAllEvents(e)||[]}catch(e){const t=`DiagnosticsService: Failed to fetch diagnostic logs: ${e}`;this.pushDiagnosticsEvent(gi.$.Error,t,!0),n?.fail({reason:t})}try{t=t.reverse(),n?.stop()}catch(e){n?.fail({reason:"Logs events array failed on reverting and sorting"})}return t}persistDiagnostics(){}async getLogsFiles(e,t=0){t>0&&t<this._minLogsInLogFile&&(t=this._minLogsInLogFile);const n="No logs found",i="Logging of this type is not enabled";let a="",o="",r=this.isErrorDiagnosticsEnabled&&await this.errorDiagnosticsEvents.getAllEvents()||[];r=(e?(0,gp.tf)(r):r).reverse();let s=(0,gp.nS)(r.slice(0,this._defaultLatestErrorCount));s&&(s=`Latest errors for ${this._userID}\r\n${s}`),this.isErrorDiagnosticsEnabled?(o=this.getPreviousSessionDiagnosticsLogsString(!0,e),a=(0,gp.nS)(r)):(o=i,a=i);const l=this.getPreviousSessionDiagnosticsLogsString(!1,e),c=await this.getDiagnosticsLogs(!!e,t),d=gp.uY===this._userID?void 0:this._userID;return Promise.resolve([{isPiiFree:!!e,fileName:"diagnostics-error-logs-previous-session.txt",content:o||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-logs-previous-session.txt",content:l||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-error-logs.txt",content:a||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-logs.txt",content:c||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"latestErrors",content:s,...d?{userId:d}:{}}])}getSystemInfo(){return Promise.resolve(new Map)}get loggerSettings(){return this._loggerSettings}get userId(){return this._userID!==gp.uY?this._userID:""}get logCountReporter(){return this._logsCountReporter}persistDiagnosticsAsPreviousSessionLogs(){if(!this.logsStoredAsPreviousSession&&(this.logsStoredAsPreviousSession=!0,this.host?.localStorage)){const e=this.experienceName===this.rwcExperienceName?this._userID||gp.uY:void 0,t=this.experienceName===this.rwcExperienceName?this.sessionId:void 0,n=e===gp.uY?this._maxCorePreviousSessionLogsLength:this._maxUserPreviousSessionLogsLength;if(n<0)return;const i=this.diagnosticsEvents.getBufferedEvents(n);i.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,i,(0,gp.Ww)(e),t);const a=this.errorDiagnosticsEvents?.getBufferedEvents(n)||[];a.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,a,(0,gp.Ww)(e,!0),t),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnosticsAsPreviousSessionLogs()}))}}persistLogsWithErrorHandle(e,t,n,i){try{(0,gp.Wj)(e,t,n,i,!this._disableGzipPreviousSessionLogs)}catch(e){this.pushDiagnosticsEvent(gi.$.Error,`DiagnosticsService: window_localstorage save logs failure, ${e?.name}`,!0)}}enableExtendedStorage(){return this.ecsEnableIDBLogs||this.isUserEnableIDBLogs}updateSessionId(e){e&&(this.sessionId=e,this.enableExtendedStorage()&&!this.extendedStorage?.isStorageEnabled&&this.addAndInitExtendedStorage())}async getDiagnosticsLogs(e,t=0){const n=await this.getDiagnosticsEvents(t),i=(0,gp.nS)(e?(0,gp.tf)(n):n),a=`Note: only ${this.memoryBufferArraySize||2e3} most recent logs are guaranteed to be shown due to the way logs are stored. Previous logs may have been removed\n`;return i?a+i:i}attemptToSetHost(){try{this.host=(0,Un.z)()}catch{}}cleanLogsStorage(){return this.host?.localStorage&&((0,gp.Ec)(this.host.localStorage,this._userID),this._userID===gp.uY&&((0,gp.Ec)(this.host.localStorage,""),(0,gp.uZ)(this.host.localStorage))),Promise.all([this.diagnosticsEvents.handleUserLogout(),this.errorDiagnosticsEvents.handleUserLogout()]).then()}updateSettingsForLogger(e){this._loggerSettings.durationForCountingLogLines=this.validateSettingNumberValue(e.durationForCountingLogLines,this._minDurationForCountingLogLines,this._loggerSettings.durationForCountingLogLines),this._loggerSettings.throttleCapacity=this.validateSettingNumberValue(e.throttleCapacity,this._minThrottleWindowCapacity,this._loggerSettings.throttleCapacity),this._loggerSettings.throttleWindowSize=this.validateSettingNumberValue(e.throttleWindowSize,this._minThrottleWindowSize,this._loggerSettings.throttleWindowSize),this._loggerSettings.isUserEnableIDBLogs=e.isUserEnableIDBLogs,this._loggerSettings.diagnosticsLogsThrottling=e.diagnosticsLogsThrottling,void 0===this.userECSConsoleLogLevel&&void 0!==e.consoleLogLevel&&null!==e.consoleLogLevel&&(this._loggerSettings.consoleLogLevel=e.consoleLogLevel),this._loggerSettings.loggerReportTimeInterval=this.validateSettingNumberValue(e.loggerReportTimeInterval,this._minLoggerReportTimeInterval,this._loggerSettings.loggerReportTimeInterval),this._loggerSettings.loggerReportCountInterval=this.validateSettingNumberValue(e.loggerReportCountInterval,this._minLoggerReportCountInterval,this._loggerSettings.loggerReportCountInterval),this._loggerSettings.throttleLoggers=e.throttleLoggers}validateSettingNumberValue(e,t,n,i=!0){return(0,we.isNumber)(e)&&(i&&e===t||e>t)?e:n}validateConsoleLogLevel(e){if(this.isValidLoglevel(e))return gi.$[e]}isValidLoglevel(e){return Object.keys(gi.$).includes(e)}getPreviousSessionDiagnosticsLogsString(e,t){let n="";if(this.host?.localStorage){const i=this.experienceName===this.rwcExperienceName?this._userID||gp.uY:void 0,a=(0,gp.Ww)(i,e);n=(0,gp.mY)(this.host.localStorage,a,!!t)}return n||"No logs found"}async addAndInitExtendedStorageForWorker(){try{const{enableWorkerStoreDiagnosticsLogsInIDB:e,workerDiagnosticsLogsIDBObjectCount:t,allowCacheStoredItemIDsInWorker:n}=this.diagnosticsSettings||{};if(e&&this._ALTCompleted&&self){const e=this.getDBName();if(!this.extendedStorage&&e&&(this.extendedStorage=new kp(self,e,this.sessionId,n??!1),t&&this.extendedStorage.setCapacity(t),this.diagnosticsEvents.setExtendedStorage(this.extendedStorage)),this.extendedStorage&&!this.extendedStorage.isStorageEnabled){await this.extendedStorage.initialize()?this.pushDiagnosticsEvent(gi.$.Info,"Created OPFS as extend storage for worker thread successful.",!0):(this.pushDiagnosticsEvent(gi.$.Info,"Created OPFS as extend storage for worker thread failed, reset extendedStorage to undefined.",!0),this.extendedStorage=void 0)}}}catch(e){return this.pushDiagnosticsEvent(gi.$.Error,"New OPFS object creation failed for worker thread",!0),void(this.extendedStorage=void 0)}}async addAndInitExtendedStorage(){if(this.extendedStoreName!==ma.DiagnosticsLogsWorker){if((this.isUserEnableIDBLogs||this.ecsEnableIDBLogs)&&this._ALTCompleted&&this.host&&"None"!==this.extendedStorageType){const e=this.getDBName();if(!this.extendedStorage&&e){const t=!!this.host?.loader?.getProperties?.().isMaglev,n=this.host.indexedDB;let i;if("OriginPrivateFileSystem"===this.extendedStorageType&&"navigator"in this.host?i=new kp(this.host,e,this.sessionId,t):"IndexedDB"===this.extendedStorageType&&"indexedDB"in this.host&&(i=new fp(n,e,this.sessionId,t)),void 0===i)return;if(this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this.diagnosticsSettings){const{diagnosticsLogsIDBObjectCount:e}=this.diagnosticsSettings;i.setCapacity((0,we.isNumber)(e)?e:0)}this.extendedStorage=i,this.diagnosticsEvents.setExtendedStorage(i)}if(this.extendedStorage&&!this.extendedStorage.isStorageEnabled){await this.extendedStorage.initialize()&&this.fetchAndPersistPreviuosSessionLogs()}}}else await this.addAndInitExtendedStorageForWorker()}fetchAndPersistPreviuosSessionLogs(){if(this.extendedStorage?.isStorageEnabled&&this._userID&&this.host?.localStorage){const e=(0,gp.Ww)(this._userID),t=(0,gp.ad)(this.host.localStorage,e,!1);t&&t.sessionId&&t.logsArray?.length>0&&(this.extendedStorage.storeLogs(t.logsArray,t.sessionId,t.logsArray[t.logsArray.length-1].timeStamp.getTime(),"force"),(0,gp.Ec)(this.host.localStorage,this._userID))}}getDBName(){return this.tId&&this.oId&&this.experienceName&&this.sessionId?`Teams:${this.extendedStoreName}:${this.experienceName}:${this.tId}:${this.oId}`:""}cleanAllPreviousSessionLogsWithDelay(e){this._clearPreviousSessionLogsTimer=e.setTimeout((()=>{(0,gp.Tu)(e)}),this._cleanPreviousSessionLogsDelay)}}class bp{constructor(e,t,n,i){this.opener=e,this.setTimeout=t,this.clearTimeout=n,this.diagnosticsEventsBuffer=[],this.flush=()=>{if(this.diagnosticsEventsBuffer.length>0)try{this.opener.postMessage(pi.pI.ActivityEvent,{action:"er:rendererDiagnosticsEvents",data:[...this.diagnosticsEventsBuffer]})}catch(e){console.error("DiagnosticsBackupService failed to send a message")}this.reset()},this.backupTimeoutMs=i&&i>0?i:bp.DefaultBackupTimeoutMs,this.reset()}pushDiagnosticsEvent(e){e&&(this.diagnosticsEventsBuffer.push(this.stringifyEvent(e)),this.diagnosticsEventsBuffer.length===bp.BufferCapacity&&this.flush(),!this.backupTimer&&this.diagnosticsEventsBuffer.length>0&&this.startTimer())}dispose(){this.flush()}reset(){this.diagnosticsEventsBuffer.length=0,this.stopTimer()}stopTimer(){this.backupTimer&&(this.clearTimeout(this.backupTimer),this.backupTimer=void 0)}startTimer(){this.backupTimer=this.setTimeout(this.flush,this.backupTimeoutMs)}stringifyEvent(e){return(0,ge.JT)("{0} {1}\t{2}\r\n",[e.timeStamp,e.levelName.slice(0,3),e.message])}}bp.BufferCapacity=50,bp.DefaultBackupTimeoutMs=100;class wp extends hp{constructor(e,t,n,i){super(),this.host=e,this.experienceName=t,this.databaseName=n,this.sessionId=i,this.indexedDBVersion=1,this.storeName="LogsStore",this.timeIndexName="timeIdx",this.currentIDBItemIndex=-1,this.IDBManagementArray=[],this.IDBErrorCount=0,this.allowedIDBErrorCount=10,this.defaultAllowedBufferLength=2e3,this.defaultCountOfIDBObjects=10,this.defaultWorkerAllowedBufferLength=1e3,this.defaultWorkerMaxCountOfIndexDBObject=10,this.minBufferLength=1e3,this.maxBufferLength=5e3,this.minWorkerBufferLength=500,this.maxWorkerBufferLength=3e3,this.minCountOfIDBObjects=10,this.maxCountofIDBObjects=1e3,this.minWorkerCountOfIDBObjects=10,this.maxWorkerCountofIDBObjects=1e3,this.timeThrottlingInterval=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.disableIDBLogs=!1,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.fetchFromIDBTimeLimit=18e3,this.minFetchFromIDBTimeLimit=5e3,this.databaseName===ma.DiagnosticsLogsWorker?(this.allowedCountOfIndexDBObject=this.defaultWorkerMaxCountOfIndexDBObject,this.allowedBufferLength=this.defaultWorkerAllowedBufferLength):(this.allowedCountOfIndexDBObject=this.defaultCountOfIDBObjects,this.allowedBufferLength=this.defaultAllowedBufferLength),this.scenarioFactory=cp(!0)}setDBInfo(e,t,n){this.getDBName()||(this.tId=e,this.oId=t,this.userId=n,this.openIndexedDB(),this.fetchPersistedLogsFromLastSession())}setCapacity(e){if(void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingInterval=1e3*e.throttleTime),e.bufferSize){const t=this.databaseName===ma.DiagnosticsLogsMain?this.minBufferLength:this.minWorkerBufferLength,n=this.databaseName===ma.DiagnosticsLogsMain?this.maxBufferLength:this.maxWorkerBufferLength;e.bufferSize>=t&&e.bufferSize<=n&&(this.allowedBufferLength=e.bufferSize)}const t=this.allowPersistIntoIDB;if(e.enableIndexedDB?this.ecsEnableIDBLogs=!0:!1===e.enableIndexedDB&&this.disablePersistIntoIDB(pp.ecsSetting),e.clientEnableExtendedLogs?this.isUserEnableIDBLogs=!0:!1===e.clientEnableExtendedLogs&&this.disablePersistIntoIDB(pp.clientPreference),e.IDBFetchingTimeoutMs&&e.IDBFetchingTimeoutMs>this.minFetchFromIDBTimeLimit&&(this.fetchFromIDBTimeLimit=e.IDBFetchingTimeoutMs),e.IDBObjectCount){const n=this.databaseName===ma.DiagnosticsLogsMain?this.minCountOfIDBObjects:this.minWorkerCountOfIDBObjects,i=this.databaseName===ma.DiagnosticsLogsMain?this.maxCountofIDBObjects:this.maxWorkerCountofIDBObjects;if(e.IDBObjectCount>=n&&e.IDBObjectCount<=i){if(t&&this.allowPersistIntoIDB&&this.IDBManagementArray.length>e.IDBObjectCount){const t=this.getToBeDeletedIDs(e.IDBObjectCount);this.deleteIDBItems(t)}this.allowedCountOfIndexDBObject=e.IDBObjectCount}}!t&&this.allowPersistIntoIDB&&this.openIndexedDB()}addEvent(e){if(this.addIntoBufferArray(e),this.bufferArraySize>=this.allowedBufferLength)if(this.allowPersistIntoIDB&&this.db)if(this.shouldBeThrottled()){const e=this.shiftBufferArray();this.skippedEventsCount++,void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=e?.timeStamp),this.lastSkippedEventTime=e?.timeStamp}else this.flushBufferIntoIndexedDB(!0);else this.allowPersistIntoIDB&&!this.ALTCompleted&&this.skippedEventsCount++,this.shiftBufferArray()}async getAllEvents(e){if(!this.db||e&&this.bufferArraySize>=e)return e&&this.bufferArraySize>e?Promise.resolve(this.getBufferedEvents().slice(this.bufferArraySize-e)):Promise.resolve(this.getBufferedEvents());{const t=this.getIDBStore(this.db,this.storeName,"readonly");if(t)try{const n=await(0,yi.a)(this.getAllEventsFromIDB(t,e),this.fetchFromIDBTimeLimit);return Promise.resolve(n)}catch{const e=this.getBufferedEvents();return e.push({message:`DiagnosticsService - fetching logs form IDB timedout with limit of ${this.timeIndexName} ms`,isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),Promise.resolve(e)}}return Promise.resolve(this.getBufferedEvents())}handleUserLogout(){this.eventsBufferArray=[];const e=(0,gp.NJ)(this.userId);return this.host.localStorage.removeItem(e),this.allowPersistIntoIDB&&this.db?this.createDeleteUserDBPromise():Promise.resolve()}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}setALTDone(){this.ALTCompleted||(this.skippedEventsCount>0&&this.addEvent({message:`DiagnosticsService - ${this.skippedEventsCount} logs skipped before client_start complete`,isPiiFree:!0,level:gi.$.Info,levelName:"info",timeStamp:new Date}),this.ALTCompleted=!0,this.openIndexedDB())}persistLogs(){if(this.bufferArraySize>0)if(this.allowPersistIntoIDB&&this.db)this.flushBufferIntoIndexedDB(!1);else if(this.host?.localStorage){const e=(0,gp.NJ)(this.userId);(0,gp.oG)(this,this.host.localStorage,e,this.sessionId)}}parseMaglevEventsFromIDB(e,t){let n="",i=[];return e.forEach((e=>{e.sessionId!==n&&""!==n&&this.addAnSeperateLogItem(i,n),n=e.sessionId,i=i.concat(e.logsArray)})),""!==n&&n!==this.sessionId&&this.addAnSeperateLogItem(i,n),i=i.concat(this.getBufferedEvents()),i.sort(gp.e),t&&i.length>t&&(i=i.slice(i.length-t)),i}parseNonMaglevEventsFromIDB(e,t){const n=new Map;e.forEach((e=>{if(e.logsArray&&e.logsArray.length>0){const t=n.get(e.sessionId)||[];n.set(e.sessionId,t.concat(e.logsArray))}}));let i=n.get(this.sessionId);if(i?(i=i.concat(this.getBufferedEvents()),n.delete(this.sessionId)):i=this.getBufferedEvents(),n.forEach(((e,t)=>{e.sort(gp.e),this.addAnSeperateLogItem(e,t)})),i.sort(gp.e),t&&i.length>=t)return i.slice(i.length-t);let a=Array.from(n.values()).sort(((e,t)=>{const n="function"==typeof e[e.length-1].timeStamp.getTime?e[e.length-1].timeStamp:new Date(e[e.length-1].timeStamp),i="function"==typeof t[t.length-1].timeStamp?t[t.length-1].timeStamp:new Date(t[t.length-1].timeStamp);return n.getTime()-i.getTime()})).flat().concat(i);return t&&a.length>t&&(a=a.slice(a.length-t)),a}createDeleteUserDBPromise(){const e=this.host?.indexedDB||globalThis.indexedDB;if(e&&this.db){const t=this.getDBName();if(t)return this.disablePersistIntoIDB(pp.beforeDeletingDB,"Deleting user IDB"),this.db.close(),new Promise((n=>{const i=this.scenarioFactory.newScenario(be.Cu.DiagnosticsDeleteIDB),a=e.deleteDatabase(t);a.onblocked=()=>{this.addEvent({message:"DiagnosticsService - Deleting user diagnostics logs IDB blocked",isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),i?.fail({reason:`Deleting DB blocked for ${a.error}`}),n()},a.onsuccess=()=>{i?.stop(),n()},a.onerror=()=>{this.addEvent({message:"DiagnosticsService - Deleting user diagnostics logs IDB error",isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),i?.fail({reason:`Deleting DB failed for ${a.error}`}),this.increaseIDBErrorCount(),n()}}))}return Promise.resolve()}flushBufferIntoIndexedDB(e){if(this.bufferArraySize>0){const t=this.getBufferedEvents();this.eventsBufferArray=[];const n=this.skippedEventsCount;this.updateThrottleInfo(t);const i=this.scenarioFactory.newScenario(be.Cu.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(this.getNextManagementItem(),t,!1,void 0,void 0,e),i?.stop({skippedCount:n})}}updateThrottleInfo(e){this.skippedEventsCount>0&&this.lastSkippedEventTime&&(e.unshift({message:`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${this.firstSkippedEventTime?.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,level:gi.$.Info,levelName:"Info",isPiiFree:!0,timeStamp:this.lastSkippedEventTime}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0),this.lastPersistTimestamp=Date.now()}openIndexedDB(){if(this.allowPersistIntoIDB&&!this.db&&this.ALTCompleted){const e=this.host?.indexedDB||globalThis.indexedDB;if(!e)return;const t=this.getDBName();if(t){const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsOpenIDB),i=e.open(t,this.indexedDBVersion);i.onerror=()=>{this.addEvent({message:"DiagnosticsService - Open IndexedDB failed",isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),n?.fail({reason:i.error}),this.increaseIDBErrorCount()},i.onupgradeneeded=()=>{this.createDataStores(i.result)},i.onsuccess=()=>{this.initializeManagementArray(i.result),n?.stop()}}}}createDataStores(e){const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsCreateIDBStore);try{e.createObjectStore(this.storeName,{autoIncrement:!0}).createIndex(this.timeIndexName,"timeStamp",{unique:!0}),t?.stop()}catch(e){t?.fail({reason:e}),this.addEvent({message:"DiagnosticService - Create objectStore failed",isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date})}}getDBName(){return this.tId&&this.oId&&this.experienceName&&this.sessionId?`Teams:${this.databaseName}:${this.experienceName}:${this.tId}:${this.oId}`:""}getIDBStore(e,t,n){if(e)try{const i=e.transaction(t,n);return i?.objectStore(t)}catch{this.disablePersistIntoIDB(pp.error,"getIDBStore failed")}}persistBufferIntoDB(e,t,n=!1,i,a,o=!1){if(0===t.length)return;if(e.isUpdating&&!n)return void this.disablePersistIntoIDB(pp.error,"All diagnostics log indexedDB items are pending update");const r=this.getIDBStore(this.db,this.storeName,"readwrite");if(r){n||(e.isUpdating=!0,e.timeStamp=a||Date.now());const s={logsArray:t,sessionId:i||this.sessionId||"",timeStamp:e.timeStamp};let l,c;e.IDBId>0?(c=this.scenarioFactory.newScenario(be.Cu.DiagnosticsUpdateIDBItem),l=r.put(s,e.IDBId)):(c=this.scenarioFactory.newScenario(be.Cu.DiagnosticsAddLogsIntoIDB),l=r.add(s)),l.onsuccess=()=>{c?.stop({context:this.userId,message:this.timeThrottleEnabled()?"throttle_enabled":"throttle_not_enabled",reason:o?"regular":"forced"}),t.length=0,this.isMaglev?(e.isUpdating=!1,e.IDBId=l.result):this.checkIDBItemCount()},l.onerror=()=>{c?.fail({reason:`${o?"regular":"forced"} - error: ${l.error}`,retryCount:n?1:0,context:this.userId,message:this.timeThrottleEnabled()?"throttle_enabled":"throttle_not_enabled"}),n?(this.addEvent({message:`DiagnosticService - Failed adding event buffer into IDB after retry, lost ${t.length} events`,isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),t.length=0,e.isUpdating=!1,this.increaseIDBErrorCount()):(this.addEvent({message:"DiagnosticService - Failed adding event buffer into IDB, start retry",isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),this.persistBufferIntoDB(e,t,!0,i,a,o))}}}deleteIDBItems(e){if(e.length>0){const t=this.getIDBStore(this.db,this.storeName,"readwrite");t&&e.forEach((e=>{const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsDeleteLogsInIDB),i=t.delete(e);i.onsuccess=()=>{n?.stop()},i.onerror=()=>{n?.fail({reason:i.error}),this.increaseIDBErrorCount()}}))}}clearDBStore(){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsClearIDBStore),n=e.clear();n.onsuccess=()=>{this.IDBManagementArray=[],this.currentIDBItemIndex=-1,t?.stop()},n.onerror=()=>{t?.fail({reason:n.error}),this.addEvent({message:"DiagnosticsService - Clear IDB store failed",isPiiFree:!0,level:gi.$.Error,levelName:"error",timeStamp:new Date}),this.increaseIDBErrorCount()}}}getToBeDeletedIDs(e){const t=[];if(this.db&&e<this.IDBManagementArray.length){const n=this.IDBManagementArray.length-e;for(let e=0;e<n;e++){let e=0;this.currentIDBItemIndex<this.IDBManagementArray.length-1&&(e=this.currentIDBItemIndex+1);const n=this.IDBManagementArray[e];t.push(n.IDBId),this.IDBManagementArray.splice(e,1),0===e&&this.currentIDBItemIndex--}}return t}getNextManagementItem(){return this.isMaglev?(this.currentIDBItemIndex===this.IDBManagementArray.length-1?this.IDBManagementArray.length<this.allowedCountOfIndexDBObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.IDBManagementArray[this.currentIDBItemIndex]):{IDBId:0,timeStamp:0,isUpdating:!1}}initializeManagementArray(e){if(this.allowPersistIntoIDB&&e&&!this.db)if(this.isMaglev){const t=this.getIDBStore(e,this.storeName,"readwrite");if(t){const n=t.index(this.timeIndexName);if(n){const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllKeysFromIDB),i=n.getAllKeys();i.onsuccess=()=>{t?.stop(),this.db=e,this.IDBManagementArray=[],i.result.forEach((e=>this.addNewManagementItem(e))),this.currentIDBItemIndex=this.IDBManagementArray.length-1,this.fetchAndPersistPreviuosSessionLogs()},i.onerror=()=>{t?.fail({reason:i.error}),this.increaseIDBErrorCount()}}}}else this.db=e,this.fetchAndPersistPreviuosSessionLogs()}addNewManagementItem(e=0){this.IDBManagementArray.push({timeStamp:0,isUpdating:!1,IDBId:e})}disablePersistIntoIDB(e,t){const n=this.allowPersistIntoIDB;switch(e){case pp.ecsSetting:if(!this.ecsEnableIDBLogs)return;this.ecsEnableIDBLogs=!1;break;case pp.clientPreference:if(!this.isUserEnableIDBLogs)return;this.isUserEnableIDBLogs=!1;break;case pp.error:case pp.beforeDeletingDB:if(this.disableIDBLogs)return;this.disableIDBLogs=!0}const i=`DiagnosticService - writing logs into IDB settings changed for ${pp[e]}`;this.addEvent({message:i,isPiiFree:!0,level:e===pp.error?gi.$.Error:gi.$.Info,levelName:e===pp.error?"error":"info",timeStamp:new Date}),n&&!this.allowPersistIntoIDB&&(e===pp.error?this.scenarioFactory.newScenario(be.Cu.DiagnosticsDisableIDB)?.stop({errorReason:t}):e!==pp.beforeDeletingDB&&this.clearDBStore())}increaseIDBErrorCount(){this.IDBErrorCount<this.allowedIDBErrorCount&&(this.IDBErrorCount++,this.IDBErrorCount===this.allowedIDBErrorCount&&this.disablePersistIntoIDB(pp.error,"Allowed IDB error count reached"))}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingInterval}timeThrottleEnabled(){return!this.isUserEnableIDBLogs&&this.timeThrottlingInterval>0&&this.lastPersistTimestamp>0}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${gp.Oh} The following logs are for previous session [${t}] ${gp.Oh}`,isPiiFree:!0,level:gi.$.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}get allowPersistIntoIDB(){return(this.ecsEnableIDBLogs||this.isUserEnableIDBLogs)&&!this.disableIDBLogs}fetchAndPersistPreviuosSessionLogs(){let e=this.fetchPreviuosSessionLogsFromLocalStorage(this.userId);(0,gp.Ec)(this.host.localStorage,this.userId||""),void 0===e&&this.userId===gp.uY&&(e=this.fetchPreviuosSessionLogsFromLocalStorage(),e&&(0,gp.Ec)(this.host.localStorage,"")),e&&e.sessionId&&e.logsArray?.length>0&&this.persistBufferIntoDB(this.getNextManagementItem(),e.logsArray,!1,e.sessionId,e.logsArray[e.logsArray.length-1].timeStamp.getTime(),!1)}fetchPreviuosSessionLogsFromLocalStorage(e){const t=(0,gp.Ww)(e);return(0,gp.ad)(this.host.localStorage,t,!0)}checkIDBItemCount(){if(!this.isMaglev&&this.allowPersistIntoIDB&&this.db){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=e.index(this.timeIndexName);if(t){const e=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllKeysFromIDB),n=t.getAllKeys();n.onsuccess=()=>{e?.stop(),n.result.length>this.allowedCountOfIndexDBObject&&this.deleteIDBItems([n.result[0]])},n.onerror=()=>{e?.fail({reason:n.error}),this.increaseIDBErrorCount()}}}}}get isMaglev(){return void 0===this._isMaglev&&(this._isMaglev=(0,Un.z)()?.loader?.getProperties()?.isMaglev),this._isMaglev}getAllEventsFromIDB(e,t){return new Promise((n=>{const i=e.index(this.timeIndexName);if(!i)return n(this.getBufferedEvents());{const e=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetAllLogsFromIDB),a=i.getAll();a.onsuccess=()=>{e?.stop();const i=this.isMaglev?this.parseMaglevEventsFromIDB(a.result,t):this.parseNonMaglevEventsFromIDB(a.result,t);n(i)},a.onerror=()=>{e?.fail({reason:a.error}),this.increaseIDBErrorCount(),n(this.getBufferedEvents())}}}))}}var Tp=n(473107);class Ip extends hp{constructor(e){super(),this.sessionId=e,this.currentIDBItemIndex=-1,this.IDBManagementArray=[],this.defaultWorkerAllowedBufferLength=1e3,this.defaultWorkerMaxCountOfIndexDBObject=10,this.minWorkerBufferLength=500,this.maxWorkerBufferLength=5e3,this.minWorkerCountOfIDBObjects=5,this.maxWorkerCountOfIDBObjects=100,this.timeThrottlingInterval=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.pushLogsOutOfOrdersFound=!1,this.disableIDBLogs=!1,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.allowedCountOfIndexDBObject=this.defaultWorkerMaxCountOfIndexDBObject,this.allowedBufferLength=this.defaultWorkerAllowedBufferLength,this.scenarioFactory=cp(!0)}setDBInfo(e,t,n){this.addEvent({message:`DiagnosticsService - setDBInfo called for: tid ${e}, oid ${t}, userid ${n}`,isPiiFree:!0,level:gi.$.Info,levelName:"info",timeStamp:new Date})}async setCapacity(e){void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingInterval=e.throttleTime*Tp.om),e.bufferSize&&e.bufferSize>=this.minWorkerBufferLength&&e.bufferSize<=this.maxWorkerBufferLength&&(this.allowedBufferLength=e.bufferSize);const t=this.allowPersistIntoIDB;if(e.enableIndexedDB?this.ecsEnableIDBLogs=!0:!1===e.enableIndexedDB&&this.disablePersistIntoIDB(pp.ecsSetting),e.clientEnableExtendedLogs?this.isUserEnableIDBLogs=!0:!1===e.clientEnableExtendedLogs&&this.disablePersistIntoIDB(pp.clientPreference),e.IDBObjectCount&&e.IDBObjectCount>=this.minWorkerCountOfIDBObjects&&e.IDBObjectCount<=this.maxWorkerCountOfIDBObjects){if(t&&this.allowPersistIntoIDB&&this.IDBManagementArray.length>e.IDBObjectCount){const t=this.getToBeDeletedIDs(e.IDBObjectCount);await this.deleteIDBItems(t)}this.allowedCountOfIndexDBObject=e.IDBObjectCount}}addEvent(e){if(!this.pushLogsOutOfOrdersFound&&this.eventsBufferArray.length>0&&e.timeStamp<this.eventsBufferArray[this.eventsBufferArray.length-1].timeStamp){this.pushLogsOutOfOrdersFound=!0;const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsLogsAddOutOfOrder);t?.fail({reason:`Add one log out of order: Current - ${e.timeStamp.toString()}, Last - ${this.eventsBufferArray[this.eventsBufferArray.length-1].timeStamp.toString()}`})}if(this.eventsBufferArray.push(e),this.eventsBufferArray.length>=this.allowedBufferLength)if(this.allowPersistIntoIDB&&this.dataManager)if(this.shouldBeThrottled()){const e=this.eventsBufferArray.shift();this.skippedEventsCount++,void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=e?.timeStamp),this.lastSkippedEventTime=e?.timeStamp}else this.flushBufferIntoIndexedDB(!0);else this.eventsBufferArray.shift()}getAllEvents(e){return!this.dataManager||!this.allowPersistIntoIDB||e&&this.eventsBufferArray.length>=e?e&&this.eventsBufferArray.length>e?Promise.resolve(this.eventsBufferArray.slice(this.eventsBufferArray.length-e)):Promise.resolve(this.eventsBufferArray):new Promise((t=>{this.dataManager?.getAllLogs().then((n=>{let i=[],a="",o="";n?.sort(((e,t)=>e.timeStamp-t.timeStamp)),n?.forEach((e=>{""!==a&&e.logsArray.length>1&&e.logsArray[0].timeStamp>e.logsArray[e.logsArray.length-1].timeStamp&&(a=`Fetch from IDB out of order: First - ${e.logsArray[0].timeStamp.toString()}, Last - ${e.logsArray[e.logsArray.length-1].timeStamp.toString()}`),e.sessionId!==o&&""!==o&&this.addAnSeperateLogItem(i,o),o=e.sessionId,i=i.concat(e.logsArray)})),""!==o&&o!==this.sessionId&&this.addAnSeperateLogItem(i,o),i=i.concat(this.eventsBufferArray),e&&i.length>e&&(i=i.slice(i.length-e)),t(i)}))}))}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}setWorkerLogsDataManager(e){this.dataManager=e}persistLogs(){this.allowPersistIntoIDB&&this.flushBufferIntoIndexedDB(!1)}handleUserLogout(e){return Promise.resolve()}async flushBufferIntoIndexedDB(e){if(this.eventsBufferArray.length>0){const t=this.eventsBufferArray;this.eventsBufferArray=[];const n=this.skippedEventsCount;this.updateThrottleInfo(t);const i=await this.getNextManagementItem(),a=this.scenarioFactory.newScenario(be.Cu.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(i,t,e),a?.stop({skippedCount:n})}}updateThrottleInfo(e){this.skippedEventsCount>0&&this.lastSkippedEventTime&&(e.unshift({message:`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${this.firstSkippedEventTime?.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,level:gi.$.Info,levelName:"Info",isPiiFree:!0,timeStamp:this.lastSkippedEventTime}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0),this.lastPersistTimestamp=Date.now()}persistBufferIntoDB(e,t,n){if(0===t.length||!this.allowPersistIntoIDB)return;const i={id:e.IDBId,logsArray:t,sessionId:this.sessionId||"",timeStamp:Date.now(),throttleEnabled:this.timeThrottleEnabled(),isRegularPersist:n};this.dataManager?.persistLogs(i),e.timeStamp=i.timeStamp}async deleteIDBItems(e){e.length>0&&this.dataManager&&e.forEach((async e=>{if(await(this.dataManager?.removeOneLogItem(e))){const t=this.IDBManagementArray.findIndex((t=>t.IDBId===e));t>=0&&this.IDBManagementArray.splice(t,1)}}))}async clearDBStore(){return this.dataManager&&await(this.dataManager?.clearAllLogs())&&(this.IDBManagementArray=[],this.currentIDBItemIndex=-1),!0}getToBeDeletedIDs(e){const t=[];if(this.dataManager&&e<this.IDBManagementArray.length){const n=this.IDBManagementArray.length-e;for(let e=0;e<n;e++){let e=0;this.currentIDBItemIndex<this.IDBManagementArray.length-1&&(e=this.currentIDBItemIndex+1);const n=this.IDBManagementArray[e];t.push(n.IDBId),this.IDBManagementArray.splice(e,1),0===e&&this.currentIDBItemIndex--}}return t}async getNextManagementItem(){return 0===this.IDBManagementArray.length&&this.allowedCountOfIndexDBObject>0&&await this.initializeManagementArray(),this.currentIDBItemIndex===this.IDBManagementArray.length-1?this.IDBManagementArray.length<this.allowedCountOfIndexDBObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.IDBManagementArray[this.currentIDBItemIndex]}addNewManagementItem(){let e=0;for(this.IDBManagementArray.length>0&&(e=this.IDBManagementArray[this.IDBManagementArray.length-1].IDBId),e++;e>this.allowedCountOfIndexDBObject||this.idExists(e);)e>this.allowedCountOfIndexDBObject?e=1:e++;this.IDBManagementArray.push({IDBId:e,timeStamp:0,isUpdating:!1})}idExists(e){return this.IDBManagementArray.filter((t=>t.IDBId===e)).length>0}async initializeManagementArray(){if(this.allowPersistIntoIDB&&this.dataManager&&0===this.IDBManagementArray.length&&this.allowedCountOfIndexDBObject>0){const e=await(this.dataManager?.getAllKeys());e?.sort(((e,t)=>e.timeStamp-t.timeStamp)),e?.forEach((e=>this.IDBManagementArray.push({IDBId:e.id,timeStamp:e.timeStamp,isUpdating:!1}))),this.currentIDBItemIndex=this.IDBManagementArray.length-1}}disablePersistIntoIDB(e,t){const n=this.allowPersistIntoIDB;switch(e){case pp.ecsSetting:if(!this.ecsEnableIDBLogs)return;this.ecsEnableIDBLogs=!1;break;case pp.clientPreference:if(!this.isUserEnableIDBLogs)return;this.isUserEnableIDBLogs=!1;break;case pp.error:case pp.beforeDeletingDB:if(this.disableIDBLogs)return;this.disableIDBLogs=!0}const i=`DiagnosticService - writing logs into IDB settings changed for ${pp[e]}`;this.addEvent({message:i,isPiiFree:!0,level:e===pp.error?gi.$.Error:gi.$.Info,levelName:e===pp.error?"error":"info",timeStamp:new Date}),n&&!this.allowPersistIntoIDB&&(e===pp.error?this.scenarioFactory.newScenario(be.Cu.DiagnosticsDisableIDB)?.stop({errorReason:t}):e!==pp.beforeDeletingDB&&this.clearDBStore())}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingInterval}timeThrottleEnabled(){return!this.isUserEnableIDBLogs&&this.timeThrottlingInterval>0&&this.lastPersistTimestamp>0}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${gp.Oh} The following logs are for previous session [${t}] ${gp.Oh}`,isPiiFree:!0,level:gi.$.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}get allowPersistIntoIDB(){return(this.ecsEnableIDBLogs||this.isUserEnableIDBLogs)&&!this.disableIDBLogs}}class Np{constructor(e,t,n,i,a){this.sessionId=e,this.experienceName=t,this.dbStoreName=n,this.defaultPreECSConsoleLogLevel=i,this.userECSConsoleLogLevel=a,this.diagnosticsBackupEnabled=!1,this.allowPersistUncaughtErrorLogs=!1,this.userDiagnosticsMap=new Map,this._userID="",this.memoryBufferArraySize=0,this._minDurationForCountingLogLines=20,this._minThrottleWindowSize=1e4,this._minThrottleWindowCapacity=5,this._minLoggerReportTimeInterval=1e4,this._minLoggerReportCountInterval=30,this._minLogsInLogFile=500,this._ALTCompleted=!1,this.rwcExperienceName="react-web-client",this.logsStoredAsPreviousSession=!1,this._disableGzipPreviousSessionLogs=!1,this._forceUsingV1Service=!1,this._cleanPreviousSessionLogsDelay=18e4,this._clearPreviousSessionLogsTimer=0,this._firstUserID="",this._loggerSettings={durationForCountingLogLines:0,loggerReportTimeInterval:0,loggerReportCountInterval:0,diagnosticsLogsThrottling:"DryRunQuiet",isUserEnableIDBLogs:!1,throttleWindowSize:0,throttleCapacity:0,consoleLogLevel:gi.$.Error,throttleLoggers:new Set},this._defaultLatestErrorCount=5,this._maxCorePreviousSessionLogsLength=0,this._maxUserPreviousSessionLogsLength=0,this.logsProviderName=sp.DIAGNOSTICSSERVICE,this.updatedSettingsForMainThread=e=>{this.diagnosticsSettings=e,this.updateSettingsForLogger({durationForCountingLogLines:e.logsMarkInterval||0,loggerReportTimeInterval:e.loggerReportTimeInterval||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:e.loggerReportCountInterval||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:e.throttleWindowSizeMs||0,throttleCapacity:e.throttleCapacity||0,isUserEnableIDBLogs:!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle,diagnosticsLogsThrottling:e.diagnosticsLogsThrottling||"DryRunQuiet",throttleLoggers:new Set(e.loggerThrottleList||[]),consoleLogLevel:this.validateConsoleLogLevel(e.consoleLogLevel||"")}),this.setDiagnosticsBackupEnabled(!!e.enableDiagnosticsBackup,e.diagnosticsBackupSyncCycleMs||void 0);const t=(0,we.isNumber)(e.savingLogsIntoIDBThrottleTime)?e.savingLogsIntoIDBThrottleTime:void 0,n=(0,we.isNumber)(e.diagnosticsEventQueueMaxSize)?e.diagnosticsEventQueueMaxSize:0;if(void 0===e.enableStoreDiagnosticsLogsInIDB&&void 0===e.clientExtendedDiagnosticsData)n&&this.diagnosticsEvents.setCapacity({bufferSize:n,throttleTime:t});else{const i=e.enableStoreDiagnosticsLogsInIDB?(0,we.isNumber)(e.diagnosticsLogBufferArraySize)?e.diagnosticsLogBufferArraySize:0:n;this.diagnosticsEvents.setCapacity({enableIndexedDB:(0,we.isUndefined)(e.enableStoreDiagnosticsLogsInIDB)?void 0:!!e.enableStoreDiagnosticsLogsInIDB,bufferSize:i,IDBObjectCount:(0,we.isNumber)(e.diagnosticsLogsIDBObjectCount)?e.diagnosticsLogsIDBObjectCount:0,throttleTime:t,clientEnableExtendedLogs:(0,we.isUndefined)(e.clientExtendedDiagnosticsData)?void 0:!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle,IDBFetchingTimeoutMs:(0,we.isNumber)(e.IDBFetchingTimeoutMs)?e.IDBFetchingTimeoutMs:0})}this._disableGzipPreviousSessionLogs=!!e.disableGzipPreviousSessionLogs,this.isErrorDiagnosticsEnabled=!!e.errorDiagnosticsEventQueueMaxSize,this.allowPersistUncaughtErrorLogs=!!e.allowPersistUncaughtErrorLogs,this._forceUsingV1Service=!!e.forceUsingV1Service,this._maxCorePreviousSessionLogsLength=this.validateSettingNumberValue(e.corePreviousSessionLogsLength,-1,this._maxCorePreviousSessionLogsLength),this._maxUserPreviousSessionLogsLength=this.validateSettingNumberValue(e.userPreviousSessionLogsLength,-1,this._maxUserPreviousSessionLogsLength),this._cleanPreviousSessionLogsDelay=this.validateSettingNumberValue(e.clearPreviousSessionLogsDelayMs,0,this._cleanPreviousSessionLogsDelay),this.isErrorDiagnosticsEnabled?(0,we.isNumber)(e.errorDiagnosticsEventQueueMaxSize)&&this.errorDiagnosticsEvents.setCapacity({bufferSize:e.errorDiagnosticsEventQueueMaxSize,throttleTime:t}):this.errorDiagnosticsEvents=new vp(!0,this.sessionId,this.host,this._defaultLatestErrorCount)},this.updatedSettingsForWorkerThread=e=>{const{workerDiagnosticsEventQueueMaxSize:t,enableWorkerStoreDiagnosticsLogsInIDB:n,workerDiagnosticsLogBufferArraySize:i,workerDiagnosticsLogsIDBObjectCount:a,logsMarkInterval:o,savingLogsIntoIDBThrottleTime:r,throttleCapacity:s,throttleWindowSizeMs:l,clientExtendedDiagnosticsData:c,disableExtendedDiagnosticsDataToggle:d,diagnosticsLogsThrottling:u,consoleLogLevel:m,loggerReportTimeInterval:p,loggerReportCountInterval:g,loggerThrottleList:h}=e;this.updateSettingsForLogger({durationForCountingLogLines:o||0,loggerReportTimeInterval:p||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:g||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:l||0,throttleCapacity:s||0,isUserEnableIDBLogs:!!c&&!d,diagnosticsLogsThrottling:u||"DryRunQuiet",throttleLoggers:new Set(h||[]),consoleLogLevel:this.validateConsoleLogLevel(m||"")});const v=(0,we.isNumber)(r)?r:void 0,y=(0,we.isNumber)(t)?t:0;this.memoryBufferArraySize=n&&(0,we.isNumber)(i)?i:y,this.diagnosticsEvents.setCapacity({bufferSize:this.memoryBufferArraySize,enableIndexedDB:(0,we.isUndefined)(n)?void 0:!!n,IDBObjectCount:(0,we.isNumber)(a)?a:0,throttleTime:v,clientEnableExtendedLogs:(0,we.isUndefined)(c)?void 0:!!c&&!d})},this.attemptToSetHost(),this.scenarioFactory=cp(!1),void 0!==this.userECSConsoleLogLevel?this.loggerSettings.consoleLogLevel=this.userECSConsoleLogLevel:void 0!==i&&(this.loggerSettings.consoleLogLevel=i),this.sessionId&&t&&n===ma.DiagnosticsLogsMain?this.diagnosticsEvents=new wp(this.host,t,n,this.sessionId):t&&n===ma.DiagnosticsLogsWorker&&this.sessionId?this.diagnosticsEvents=new Ip(this.sessionId):this.diagnosticsEvents=new vp(!1,this.sessionId,this.host),this.isErrorDiagnosticsEnabled=!1,this.errorDiagnosticsEvents=new vp(!0,this.sessionId,this.host),this.diagnosticsBackupService=void 0,this.host?.addEventListener&&this.host.addEventListener("unload",(()=>{this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer),this.persistDiagnosticsAsPreviousSessionLogs()})),t!==this.rwcExperienceName&&this.loadDiagnosticsFromLocalStorage(!0)}setScenarioFactory(e){this.coreScenarioFactory=e,this.scenarioFactory.setScenarioFactory(e),this.diagnosticsEvents.setScenarioFactory(e),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScenarioFactory(e)}))}setLogsCountReporter(e){this._logsCountReporter||(this._logsCountReporter=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setLogsCountReporter(e)})))}setALTDone(){if(!this._ALTCompleted){if(this._ALTCompleted=!0,this.diagnosticsEvents.setALTDone(),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>e.setALTDone())),this._userID===gp.uY&&this.host?.localStorage){if(!this.diagnosticsSettings?.skipCleanInvalidPreSessionLogs){const e=Array.from(this.userDiagnosticsMap.keys());(0,gp.m)(this.host.localStorage,[...e,gp.uY])}this.cleanAllPreviousSessionLogsWithDelay(this.host)}this._userID===gp.uY&&this.experienceName===this.rwcExperienceName&&this.host?.localStorage&&(0,gp.uZ)(this.host.localStorage)}}subscribeToCoreSettings(e){if(!e)return void this.pushDiagnosticsEvent(gi.$.Error,"DiagnosticsService: Failed to subscribe to core settings",!0);e.getObservable(c.w.Diagnostics).subscribe((e=>{this.dbStoreName===ma.DiagnosticsLogsWorker?this.updatedSettingsForWorkerThread(e):(this.updatedSettingsForMainThread(e),this.userDiagnosticsMap.size>0&&this.userDiagnosticsMap.forEach(((t,n)=>{this._firstUserID===n?t.updatedSettingsForMainThread({...e,userPreviousSessionLogsLength:e.firstUserPreviousSessionLogsLength}):t.updatedSettingsForMainThread(e)})))})),this.logCountReporter&&this.logCountReporter.subscribeToCoreSettings(e)}updateDiagnosticInfo(e,t,n){n&&(this._userID=n),this.diagnosticsEvents.setDBInfo(e,t,n),this.errorDiagnosticsEvents.setDBInfo(e,t,n)}handleUserLogout(e){if(e){const t=this.userDiagnosticsMap.get(e);if(t){this.userDiagnosticsMap.delete(e);let n=Promise.resolve();return 0===this.userDiagnosticsMap.size&&(n=this.cleanLogsStorage()),Promise.all([t.handleUserLogout(e),n]).then()}this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer)}return this.cleanLogsStorage()}createUserDiagnosticsService(e,t,n){if(this.dbStoreName===ma.DiagnosticsLogsWorker||this._userID&&this._userID!==gp.uY)this.pushDiagnosticsEvent(gi.$.Error,"DiagnosticsService: createUserDiagnosticsService function should only be called from the coreDiagnosticsService in the main thread",!0);else if(e&&t&&n){this._userID||this.updateDiagnosticInfo(gp.ny,gp.AE,gp.uY),this._firstUserID||(this._firstUserID=n);let i=this.userDiagnosticsMap.get(n);return i||(i=this.experienceName!==this.rwcExperienceName||this._forceUsingV1Service?new Np(this.sessionId||"",this.experienceName,this.dbStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel):new Cp(this.sessionId||"",this.experienceName,this.dbStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel),i.updateDiagnosticInfo(e,t,n),this.diagnosticsSettings&&(this._firstUserID===n?i.updatedSettingsForMainThread({...this.diagnosticsSettings,userPreviousSessionLogsLength:this.diagnosticsSettings.firstUserPreviousSessionLogsLength}):i.updatedSettingsForMainThread(this.diagnosticsSettings)),this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this._logsCountReporter&&i.setLogsCountReporter(this._logsCountReporter),this._ALTCompleted&&i.setALTDone(),this.userDiagnosticsMap.set(n,i),i)}}pushDiagnosticsEvent(e,t,n,i){const a=(0,gp.Ck)(this.diagnosticsEvents,e,t,n,i);e===gi.$.Error&&this.errorDiagnosticsEvents.addEvent(a),this.diagnosticsBackupEnabled&&this.diagnosticsBackupService&&this.diagnosticsBackupService.pushDiagnosticsEvent(a)}async getDiagnosticsEvents(e){let t=[];const n=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetLogs);try{t=await this.diagnosticsEvents.getAllEvents(e)||[]}catch(e){const t=`DiagnosticsService: Failed to fetch diagnostic logs: ${e}`;this.pushDiagnosticsEvent(gi.$.Error,t,!0),n?.fail({reason:t})}try{t=t.reverse(),n?.stop()}catch(e){n?.fail({reason:"Logs events array failed on reverting and sorting"})}return t}persistDiagnostics(){this.experienceName!==this.rwcExperienceName&&this.allowPersistUncaughtErrorLogs&&(this.diagnosticsEvents.persistLogs(),this.errorDiagnosticsEvents.persistLogs(),this.diagnosticsBackupEnabled&&this.diagnosticsBackupService&&this.diagnosticsBackupService.flush(),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnostics()})))}async getLogsFiles(e,t=0){t>0&&t<this._minLogsInLogFile&&(t=this._minLogsInLogFile);const n="No logs found",i="Logging of this type is not enabled";let a="",o="",r=await this.errorDiagnosticsEvents.getAllEvents()||[];r=(e?(0,gp.tf)(r):r).reverse();let s=(0,gp.nS)(r.slice(0,this._defaultLatestErrorCount));s&&(s=`Latest errors for ${this._userID}\r\n${s}`),this.isErrorDiagnosticsEnabled?(o=this.getPreviousSessionDiagnosticsLogsString(!0,e),a=(0,gp.nS)(r)):(o=i,a=i);const l=this.getPreviousSessionDiagnosticsLogsString(!1,e),c=await this.getDiagnosticsLogs(!!e,t),d=gp.uY===this._userID?void 0:this._userID;return Promise.resolve([{isPiiFree:!!e,fileName:"diagnostics-error-logs-previous-session.txt",content:o||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-logs-previous-session.txt",content:l||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-error-logs.txt",content:a||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-logs.txt",content:c||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"latestErrors",content:s,...d?{userId:d}:{}}])}getSystemInfo(){return Promise.resolve(new Map)}get loggerSettings(){return this._loggerSettings}get userId(){return this._userID!==gp.uY?this._userID:""}get logCountReporter(){return this._logsCountReporter}setWorkerLogsDataManager(e){"setWorkerLogsDataManager"in this.diagnosticsEvents&&this.diagnosticsEvents.setWorkerLogsDataManager(e)}persistDiagnosticsAsPreviousSessionLogs(){if(!this.logsStoredAsPreviousSession&&(this.logsStoredAsPreviousSession=!0,this.host?.localStorage)){const e=this.experienceName===this.rwcExperienceName?this._userID||gp.uY:void 0,t=this.experienceName===this.rwcExperienceName?this.sessionId:void 0,n=e===gp.uY?this._maxCorePreviousSessionLogsLength:this._maxUserPreviousSessionLogsLength;if(n<0)return;const i=this.diagnosticsEvents.getBufferedEvents(n);i.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,i,(0,gp.Ww)(e),t);const a=this.errorDiagnosticsEvents.getBufferedEvents(n);a.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,a,(0,gp.Ww)(e,!0),t),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnosticsAsPreviousSessionLogs()}))}}persistLogsWithErrorHandle(e,t,n,i){try{(0,gp.Wj)(e,t,n,i,!this._disableGzipPreviousSessionLogs)}catch(e){this.pushDiagnosticsEvent(gi.$.Error,`DiagnosticsService: window_localstorage save logs failure, ${e?.name}`,!0)}}setDiagnosticsBackupEnabled(e,t){this.diagnosticsBackupEnabled=e,e?!this.diagnosticsBackupService&&this.host?.opener&&this.host?.setTimeout&&this.host?.clearTimeout&&(this.diagnosticsBackupService=new bp(this.host.opener,this.host.setTimeout,this.host.clearTimeout,t)):this.diagnosticsBackupService&&(this.diagnosticsBackupService.dispose(),this.diagnosticsBackupService=void 0)}async getDiagnosticsLogs(e,t=0){const n=await this.getDiagnosticsEvents(t),i=(0,gp.nS)(e?(0,gp.tf)(n):n),a=`Note: only ${this.memoryBufferArraySize||2e3} most recent logs are guaranteed to be shown due to the way logs are stored. Previous logs may have been removed\n`;return i?a+i:i}attemptToSetHost(){try{this.host=(0,Un.z)()}catch{}}loadDiagnosticsFromLocalStorage(e=!0){if(this.host?.localStorage&&this.experienceName!==this.rwcExperienceName){const t=this.scenarioFactory.newScenario(be.Cu.DiagnosticsGetLogsFromLocalStorage);try{(0,gp.j8)(this.diagnosticsEvents,this.host.localStorage,(0,gp.NJ)(),e),(0,gp.j8)(this.errorDiagnosticsEvents,this.host.localStorage,(0,gp.NJ)(void 0,!0),e),t?.stop()}catch(e){const n=`DiagnosticsService: Failed to load persisted logs from store with error: ${e}`;this.pushDiagnosticsEvent(gi.$.Error,n,!0),t?.fail({reason:n})}}}cleanLogsStorage(){return this.host?.localStorage&&((0,gp.Ec)(this.host?.localStorage,this.userId),this.userId===gp.uY&&(0,gp.Ec)(this.host?.localStorage,"")),Promise.all([this.diagnosticsEvents.handleUserLogout(),this.errorDiagnosticsEvents.handleUserLogout()]).then()}updateSettingsForLogger(e){this._loggerSettings.durationForCountingLogLines=this.validateSettingNumberValue(e.durationForCountingLogLines,this._minDurationForCountingLogLines,this._loggerSettings.durationForCountingLogLines),this._loggerSettings.throttleCapacity=this.validateSettingNumberValue(e.throttleCapacity,this._minThrottleWindowCapacity,this._loggerSettings.throttleCapacity),this._loggerSettings.throttleWindowSize=this.validateSettingNumberValue(e.throttleWindowSize,this._minThrottleWindowSize,this._loggerSettings.throttleWindowSize),this._loggerSettings.isUserEnableIDBLogs=e.isUserEnableIDBLogs,this._loggerSettings.diagnosticsLogsThrottling=e.diagnosticsLogsThrottling,void 0===this.userECSConsoleLogLevel&&void 0!==e.consoleLogLevel&&null!==e.consoleLogLevel&&(this._loggerSettings.consoleLogLevel=e.consoleLogLevel),this._loggerSettings.loggerReportTimeInterval=this.validateSettingNumberValue(e.loggerReportTimeInterval,this._minLoggerReportTimeInterval,this._loggerSettings.loggerReportTimeInterval),this._loggerSettings.loggerReportCountInterval=this.validateSettingNumberValue(e.loggerReportCountInterval,this._minLoggerReportCountInterval,this._loggerSettings.loggerReportCountInterval),this._loggerSettings.throttleLoggers=e.throttleLoggers}validateSettingNumberValue(e,t,n,i=!0){return(0,we.isNumber)(e)&&(i&&e===t||e>t)?e:n}validateConsoleLogLevel(e){if(Object.keys(gi.$).includes(e))return gi.$[e]}getPreviousSessionDiagnosticsLogsString(e,t){let n="";if(this.host?.localStorage){const i=this.experienceName===this.rwcExperienceName?this._userID||gp.uY:void 0,a=(0,gp.Ww)(i,e);n=(0,gp.mY)(this.host.localStorage,a,!!t)}return n||"No logs found"}cleanAllPreviousSessionLogsWithDelay(e){this._clearPreviousSessionLogsTimer=e.setTimeout((()=>{(0,gp.Tu)(e)}),this._cleanPreviousSessionLogsDelay)}}class Ap{constructor(e){this.globalContext=e,this.reportIntervalHandler=0,this.minReportTimeInterval=6e4,this.minReportCountInterval=200,this.minReportErrorCountInterval=10,this.reportTimeInterval=0,this.reportCountInterval=0,this.reportErrorCountInterval=0,this.lastReportTime=Date.now(),this.totalLogsCountFromLastReport=0,this.errorLogsCountFromLastReport=0,this.logsCountMap=new Map}updateLogsCounts(e){for(const[t,n]of e)this.updateLogsCountForOneLogger(t,n)}updateLogsCountForOneLogger(e,t){this.startTimer();const n=this.logsCountMap.get(e);n?(n.total+=t.total,n.error+=t.error,n.diagnostics+=t.diagnostics,n.throttled+=t.throttled):this.logsCountMap.set(e,{...t}),this.totalLogsCountFromLastReport+=t.total,this.errorLogsCountFromLastReport+=t.error}subscribeToCoreSettings(e){if(this.coreSettingsSubscription)return;const t=e.getObservable(c.w.Diagnostics,["logReporterSendCountInterval","logReporterSendTimeInterval","logReporterSendErrorCountInterval"]);this.coreSettingsSubscription=t.subscribe((e=>{if((0===e.logReporterSendCountInterval||(e.logReporterSendCountInterval||0)>=this.minReportCountInterval)&&(this.reportCountInterval=e.logReporterSendCountInterval||0),(0===e.logReporterSendErrorCountInterval||(e.logReporterSendErrorCountInterval||0)>=this.minReportErrorCountInterval)&&(this.reportErrorCountInterval=e.logReporterSendErrorCountInterval||0),0===e.logReporterSendTimeInterval||(e.logReporterSendTimeInterval||0)>=this.minReportTimeInterval){const t=e.logReporterSendTimeInterval||0;this.reportTimeInterval!==t&&(this.reportTimeInterval=t,this.reportIntervalHandler&&(this.globalContext.clearTimeout(this.reportIntervalHandler),this.reportIntervalHandler=0,this.startTimer()))}}))}reportLogsCount(){if(this.reportIntervalHandler=0,this.shouldReport()){const e=Date.now(),t=e-this.lastReportTime;this.lastReportTime=e,this.totalLogsCountFromLastReport=0,this.errorLogsCountFromLastReport=0;const n=this.logsCountMap;this.logsCountMap=new Map;const i=this.packLogsCountInfo(n);n.clear(),i&&(0,hi.Oq)("logsCountInfo",{logsCountInfo:i,delta:t},"webclient_framework_logs_count_event")}}packLogsCountInfo(e){if(e.size>0){const t=[];for(const[n,i]of e)t.push({loggerName:n,total:i.total,error:i.error,diagnostics:i.diagnostics,throttled:i.throttled});return JSON.stringify(t)}return""}shouldReport(){return this.reportCountInterval>0&&this.reportTimeInterval>0&&this.reportErrorCountInterval>0&&(this.logsCountMap.size>0&&(this.totalLogsCountFromLastReport>=this.reportCountInterval||this.errorLogsCountFromLastReport>=this.reportErrorCountInterval))}startTimer(){0===this.reportIntervalHandler&&this.reportTimeInterval>0&&(this.reportIntervalHandler=this.globalContext.setTimeout((()=>this.reportLogsCount()),this.reportTimeInterval))}}var Ep=n(700699);function Fp(e){const t=Object.keys(e).reduce(((t,n)=>(t[n]=function(e){const t=(0,Ep.UT)(e);return{update:e=>t(e),read:()=>t(),ref:t}}(e[n]),t)),{});return t}const _p=new Set([g.x9,g.T3]);class Dp{constructor(e,t,n){this._logger=e.newLogger("ReactiveValuesService","core-services-activator"),this._appViewStateForWindowMap=new Map,this._servicesAppsRegistry=t,this._config=n}getAppViewStateForWindow(e,t){this._config.enableEmbedDataClient&&(e=d.N2);const n=this._appViewStateForWindowMap.get(e)?.get(t);if(!n){const n=this._servicesAppsRegistry.getAppByID(t);n&&"viewStateRegistration"in n&&n.viewStateRegistration&&this._logger.errorToTelemetry?.(`Unable to find appViewState for window ${e} app ${t}, registeredApps: ${this._appViewStateForWindowMap.get(e)}`,"webclient_framework_foundation_core_services_activator")}return n}resetAllViewState(e){const t=this._appViewStateForWindowMap.get(e);t&&t.forEach(((e,t)=>{_p.has(t)||this.resetViewStateForApp(t,e)}))}setReactiveValuesForApp(e,t,n){const i=this._appViewStateForWindowMap.get(e)?.get(t);if(this._logger.log(`Setting view state to apollo cache value for windowId ${e}, app ${t}`),i){const{navigationalReactiveValues:e,nonNavigationalReactiveValues:t}=i;Object.keys(n).forEach((i=>{let a=e[i];a||(a=t[i]),a.update(n[i])}))}}getRegisteredAppsTypePolicies(e){const t={typePolicies:{},defaultTypeName:[]};return this._appViewStateForWindowMap.set(e,new Map),this._servicesAppsRegistry.registeredApps.forEach((n=>{const i=n.manifest.id,a=n;if(a.viewStateRegistration){const{computedValues:n,navigationalFieldDefaultValues:o,nonNavigationalFieldDefaultValues:r,gqlTypeName:s,queryFieldName:l}=a.viewStateRegistration,c=Fp(o),d=Fp(r),u=this._appViewStateForWindowMap.get(e);u?.set(i,{navigationalReactiveValues:c,nonNavigationalReactiveValues:d});const m=function(...e){const[t,n,i]=e,a={};for(const e of Object.keys(n)){const t=e,i=()=>n[t].read();a[t]={read:i}}if(i)for(const e of Object.keys(i)){const t=e,o=(e,a)=>{const{args:o}=a||{};return i[t](n,o)},r=o;a[t]={read:r}}return{[t]:{fields:a}}}(s,{...c,...d},n);t.typePolicies={...t.typePolicies,...m},t.defaultTypeName.push({gqlTypeName:s,queryFieldName:l})}})),t}removeWindowViewState(e){this._appViewStateForWindowMap.delete(e)}resetViewStateForApp(e,t,n){const i=this._servicesAppsRegistry.getAppByID(e);if(i&&t&&"viewStateRegistration"in i&&i.viewStateRegistration){this._logger.log(`Resetting view state for app ${e}`);const{navigationalFieldDefaultValues:a,nonNavigationalFieldDefaultValues:o}=i.viewStateRegistration;Object.keys(a||{}).forEach((e=>{n?.includes(e)||t.navigationalReactiveValues[e].update(a[e])})),Object.keys(o).forEach((e=>{n?.includes(e)||t.nonNavigationalReactiveValues[e].update(o[e])}))}}}const Pp={[ke.ck.meetings]:["com.microsoft.teams.calling","com.microsoft.teams.meeting-options"]};class Mp{constructor(e,t,n,i){this._loadedTasksMap=new Map,this._appIdToAppMap=void 0,this._logger=e.newLogger("AppsRegistryService","core-services-activator"),this._loadedApps=[],this._entityTypeToAppMap=new Map,this._appsWithAppHistoryStored=[],this.initialize(n,i),this._reactiveValuesService=new Dp(e,this,t)}get registeredApps(){return this._loadedApps}get registeredAppManifests(){return this._loadedApps.map((e=>e.manifest))}get registeredTasks(){return Array.from(this._loadedTasksMap.values())}get appsWithAppHistoryStored(){return this._appsWithAppHistoryStored}getApp({entityType:e,renderMode:t}){if(e||t)return this.registeredApps.find((n=>(!e||function({supportedEntities:e},t){return!(!e||-1===e.indexOf(t))}(n.manifest,e))&&(!t||function({supportedRenderModes:e},t){return!(!e||-1===e.indexOf(t))}(n.manifest,t))))}getAppViewStateForWindow(e,t){return this._reactiveValuesService.getAppViewStateForWindow(e,t)}getAppByID(e){return this._appIdToAppMap?.get(e)}getPlatformAppIdForEntity(e){const t=this._entityTypeToAppMap.get(e.type);if(void 0===t)return void this._logger.error("getPlatformAppIdForEntity: Platform id requested for entity which has no registered app in this experience.",{entityType:e.type});if(void 0===t.getPlatformAppIdForEntity)return void this._logger.debug("getPlatformAppIdForEntity: An app is registered for this entity but has no function for getPlatformAppIdForEntity.",{appName:t.manifest.name,entityType:e.type});let n;try{n=t.getPlatformAppIdForEntity(e)}catch(n){this._logger.error("getPlatformAppIdForEntity: Error caught from app handler while mapping the id for this entity.",{appName:t.manifest.name,entityType:e.type})}if(void 0!==n)return n;this._logger.debug("getPlatformAppIdForEntity: App mapped the id for this entity to undefined.",{appName:t.manifest.name,entityType:e.type})}getAppByActor(e){if(e)return this.registeredApps.find((t=>function({actors:e},t){return!(!e||-1===e.indexOf(t))}(t.manifest,e)))}getDefaultCommand(e,t){const{coldBootAppId:n}=e.get(c.w.Edu),{coreColdBootAppId:i,coreColdBootFlyoutWindowAppId:a,enableEDUColdBootApp:o}=e.get(c.w.Core),r=o?n:t===Yt.Rm.minimode||t===Yt.Rm.minimal?a:i;if(r){this._logger.debug(`Using cold boot appId of ${r} with enableEDUColdBootApp ${o}`);const t=this.getAppByID(r),n=t?.manifest.getDefaultCommand?.(e);if(n)return n;this._logger.debug(`No default command found ${r}`)}for(const t of this.registeredAppManifests)if(t.getDefaultCommand){const n=t.getDefaultCommand(e);if(n)return this._logger.debug(`Found a default command in ${t.name}`),n}}resetAllViewState(e){this._reactiveValuesService.resetAllViewState(e)}setReactiveValuesForApp(e,t,n){this._reactiveValuesService.setReactiveValuesForApp(e,t,n)}getRegisteredAppsTypePolicies(e){return this._reactiveValuesService.getRegisteredAppsTypePolicies(e)}removeWindowViewState(e){this._reactiveValuesService.removeWindowViewState(e)}registerTask(e){this._loadedTasksMap.set(e.id,e)}initialize(e,t){const n=new Map;if(!(t&&t.length>0))throw new Error(`initialize::${d.O4.Empty} - No apps registered`);-1===t.findIndex((t=>t.manifest.id===e.manifest.id))&&t.length>0&&t.push(e),t.forEach((e=>{if(n.has(e.manifest.id))throw new Error(`Multiple apps found for appId ${e.manifest.id}`);n.set(e.manifest.id,e),e.manifest.supportedEntities?.forEach((t=>{const n=Pp[t];if(!n||!n.includes(e.manifest.id)){if(this._entityTypeToAppMap.has(t))throw new Error(`Multiple apps found for entity ${t}`);this._entityTypeToAppMap.set(t,e)}})),e.onRegister&&e.onRegister({registerTask:this.registerTask.bind(this)}),e.onBeforeAddToNavigation?.shouldStoreLastVisitedInAppHistory&&this._appsWithAppHistoryStored.push(e.manifest.id)})),this._loadedApps=Array.from(n.values()),this._appIdToAppMap=n}}class Rp{constructor(e){this.logsProviderTimeoutMs=2e4,this.coreProviders=[],this.userProviders={},this.primaryUserID="",this.allowZipLogFiles=!1,this.environmentName="",this.isDownloadLogStarted=new ya.t(!1),this.observeDownloadLogStatus=()=>this.isDownloadLogStarted.asObservable(),this.setDownloadLogStatus=e=>{this.isDownloadLogStarted.next(e)},this.logger=e.newLogger("LogsCollectorService","core-services-logs-collector")}subscribeToCoreSettings(e){if(!e)return void this.logger.error("Failed to subscribe to core settings");e.getObservable(c.w.Diagnostics,["logsProviderTimeoutMs","shouldZipLogFiles"]).subscribe((({logsProviderTimeoutMs:e,shouldZipLogFiles:t})=>{e&&(this.logsProviderTimeoutMs=e),this.allowZipLogFiles=!!t}));e.getObservable(c.w.Metadata,["environment"]).subscribe((({environment:e})=>{e&&(this.environmentName=e)}))}registerCoreLogsProvider(e){e.logsProviderName===sp.DIAGNOSTICSSERVICE?this.diagnosticsLogProvider=e:this.coreProviders.some((t=>t.logsProviderName===e.logsProviderName))?this.logger.warnNoPii?.(`Registering redundant core logger with name ${e.logsProviderName}`):this.coreProviders.push(e)}registerUserLogsProvider(e,t){this.primaryUserID&&!e&&(e=this.primaryUserID),this.userProviders[e]?this.userProviders[e].some((e=>e.logsProviderName===t.logsProviderName))?this.logger.warnNoPii?.(`Registering redundant user logger with name ${t.logsProviderName}`):this.userProviders[e].push(t):this.userProviders[e]=[t]}unregisterUserLogsProvider(e,t){this.primaryUserID&&!e&&(e=this.primaryUserID),this.userProviders[e]?(this.userProviders[e]=this.userProviders[e].filter((e=>e.logsProviderName!==t)),0===this.userProviders[e].length&&delete this.userProviders[e]):this.logger.warnNoPii?.(`Unregistering user logger with name ${t} failed, user ${e} not found`)}getCoreLogsProvider(e){return this.coreProviders.find((t=>t.logsProviderName===e))}getUserLogsProvider(e,t){return this.userProviders[e]?.find((e=>e.logsProviderName===t))}handleUserLogout(e){delete this.userProviders[e]}async callOnLogsFiles(e,t=!1,n=!1,i=0,a){return this.callOnUserLogsFiles(Object.keys(this.userProviders),e,t,n,i,a)}async callOnUserLogsFiles(e,t,i=!1,a=!1,o=0,r){let s;if(i&&this.allowZipLogFiles)try{const e=(await n.e(980211).then(n.t.bind(n,549866,23)))?.default;e&&(s=new e)}catch(e){this.logger.errorToTelemetry?.(`Load jszip failed - ${e}`,"logs_loading_jszip")}const l={fileName:"summary.txt",content:"",isPiiFree:!1},c=e=>s?.file?(s.file(e.fileName,e.content),Promise.resolve(!0)):(e.fileName=`WebLogs/${e.fileName}`,t(e)),d=await this.callOnOnlyCoreLogsFiles(c,l,a,o,r),u=await this.callOnOnlyUserLogsFiles(e,c,l,a,o,r),m=!!a||await this.createSummaryFile(c,l);if(s){const e=await s.generateAsync({type:"blob",compression:"DEFLATE"}),n=this.environmentName?`${this.environmentName.toUpperCase()}-`:"";return t({fileName:`${n}WebLogs-${(new Date).toISOString()}.zip`,content:e,isPiiFree:a})}return d&&u&&m}async getSystemInfo(){let e=new Map;try{const t=async e=>{try{return await(0,yi.a)(e.getSystemInfo(),this.logsProviderTimeoutMs)}catch(t){if((0,yi.W)(t))return this.logger.error(`Timed out fetching system info from logs provider - ${e.logsProviderName}`),new Map;throw t}},n=this.coreProviders.map(t);this.diagnosticsLogProvider&&n.push(t(this.diagnosticsLogProvider));const i=await Promise.all(n);i&&i.length>0&&(e=i.reduce(((e,t)=>new Map([...Array.from(e.entries()),...Array.from(t.entries())]))))}catch(e){this.logger.error("Fetching system info from logs providers failed with error:",e)}return e}setPrimaryUserID(e){if(e&&!this.primaryUserID){this.primaryUserID=e;const t=this.userProviders[""];t&&(this.userProviders[this.primaryUserID]=t,delete this.userProviders[""])}}setGetSummaryFunction(e){this.generateSummary=e}getUserLogFileName(e,t){return`User (${e===this.primaryUserID?"Primary; ":""}${e})/${t}`}getCoreLogFileName(e){return`Core/${e}`}async callOnOnlyCoreLogsFiles(e,t,n=!1,i=0,a){try{const o=t=>(t.fileName=t.userId?this.getUserLogFileName(t.userId,t.fileName):this.getCoreLogFileName(t.fileName),e(t));this.logger.log(`Fetching files from providers: ${this.coreProviders.reduce(((e,t)=>e+`${t?.logsProviderName}, `),"")}`);const r=await this.callOnLogsFilesOfLogsProviders(this.coreProviders,o,t,n,i,a),s=!this.diagnosticsLogProvider||await this.callOnLogsFilesOfLogsProviders([this.diagnosticsLogProvider],o,t,n,i,a);return r&&s}catch(e){return this.logger.error("Error calling callback on logs files from all logs providers - error:",e),!1}}async callOnOnlyUserLogsFiles(e,t,n,i=!1,a=0,o){const r=[];return e.length>0&&e.forEach((e=>{if(this.userProviders[e]&&this.userProviders[e].length>0){const s=n=>(n.fileName=this.getUserLogFileName(e,n.fileName),t(n));r.push(this.callOnLogsFilesOfLogsProviders(this.userProviders[e],s,n,i,a,o))}})),(await Promise.all(r)).every(Boolean)}async timeoutSafeGetLogsFiles(e,t=!1,n=0,i){try{let a=[];return i?0!==i.length&&i.includes(e.logsProviderName)&&(a=await(0,yi.a)(e.getLogsFiles(t,n),this.logsProviderTimeoutMs)):a=await(0,yi.a)(e.getLogsFiles(t,n),this.logsProviderTimeoutMs),t&&a.length>0?a.filter((e=>e.isPiiFree)):a}catch(t){if((0,yi.W)(t))return this.logger.errorToTelemetry?.(`Timed out fetching logs files from logs provider - ${e.logsProviderName}`,"logs_fetching_error"),[];throw t}}async callOnLogsFilesOfLogsProviders(e,t,n,i=!1,a=0,o){const r=e.map((e=>this.timeoutSafeGetLogsFiles(e,i,a,o))),s=await Promise.all(r),l=[];s.forEach((e=>{e&&e.length>0&&l.push(...e)}));const c=l.map((e=>{try{return"latestErrors"===e.fileName?(n.content=`${n.content}${e.content}\r\n`,Promise.resolve(!0)):t(e)}catch(t){return this.logger.error(`Error calling callback on logs file, ${e?.fileName} - error:`,t),!1}}));return(await Promise.all(c)).every((e=>e))}async createSummaryFile(e,t){const n=await(this.generateSummary?.());return n&&(t.content=`${n}\r\n${t.content}`),e(t)}}class xp{constructor(e,t){this.id=e,this.name=d.c1[e],this.dependencies=t}async executeSafe(e,t){const n=[];for(const t of this.dependencies)null==e[t]&&n.push(t);if(n.length>0)throw br.fromMissingDependencies(this.name,n.map(String));try{return await this.execute(e,t)}catch(e){throw br.fromExecutionError(this.name,e)}}}class Lp extends xp{constructor(){super(d.c1.CaptureChunkLoadFailuresTask,["coreSettings","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,windowProvider:i}=e,a=n.newLogger("CaptureChunkLoadFailuresTask","core-services-tasks"),{disableCapturingChunkLoadFailures:o}=t.get(c.w.Core);o?a.logNoPii?.("Capturing chunk load failures is disabled."):(i.parent||i).chunkLoadFailureCallback=e=>{a.errorToTelemetry?.(`Chunk load failure - name: ${e.name}, type: ${e.type}, request: ${e.request}`,"capture_chunk_load_failures",{errorMessage:e.message,errorName:e.name,errorType:e.type,request:e.request})}}}var Op=n(868670),jp=n(302151),Bp=n(767435);const Up=["#/_","#/alerts","#/analytics/myteams","#/apps","#/bizChatCopilotApp","#/broadcast-intermediate-screen","#/broadcastPlaybackScreen","#/calendar","#/calendarv2","#/calendarv2owa","#/calling-intermediate-screen","#/calling","#/callingProtocol","#/calls","#/channel-hub","#/channelDashboard","#/channels","#/chatProtocol","#/chats","#/communities","#/conversations","#/debug","#/l/meeting-share","#/l/meeting","#/l/meetingrecap","#/l/meetnow-join","#/l/meetup-join","#/modern-calling","#/scheduling-form","#deepLink=core","#deepLink=default","#deepLink=flyout"],$p=["ctx=channel","ctx=chat","MyLearning"],Wp=["/_","//path-to-file","/alerts","/analytics/myteams","/apps","/bizChatCopilotApp","/broadcast-intermediate-screen","/broadcastPlaybackScreen","/calendar","/calendarv2","/calendarv2owa","/calling-intermediate-screen","/calling","/callingProtocol","/calls","/channel-hub","/channelDashboard","/channels","/chatProtocol","/chats","/communities","/communitiesDashboard","/communitiesOnboarding","/debug","/deepLinkAutoInstallNotification","/deepLinkDiscoverAppsNotifications","/deepLinkFreemiumUpgrade","/deepLinkLobNotifications","/deepLinkOnboardingNotifications","/deviceLicenseError","/discover","/discoverSurface","/download","/error","/files/oneupviewer","/force_resync_data","/freemium-upsell","/getUserMedia","/guestLicense","/help","/l/app","/l/auth-callback","/l/auth/google","/l/broadcast","/l/broadcast/create","/l/call","/l/claim","/l/community","/l/file","/l/fileDownload","/l/help","/l/home","/l/invite","/l/manage-teams","/l/meeting-share","/l/meeting","/l/meetingrecap","/l/meetnow-join","/l/meetup-join","/l/present","/l/search","/l/settings/recognition","/l/stage","/l/task","/l/virtualevent","/l/virtualevent/duplicate","/l/virtualevent/new","/l/voiceassistant","/licenseError","/manageteams/myinvites","/manageteams/myteams","/manageTenant","/meet","/meeting/meet/list","/message","/modern-calling","/my","/non-members-placeholder","/oops","/people","/post-calling","/post-echo-bot-call","/pre-join-calling","/rigel-console-broadcast","/rigel-console-cortana","/rigel-console-home-page","/rigel-console-join-by-code","/rigel-console-post-call","/rigel-console-pre-call","/rigel-console","/scheduling-form","/school","/search","/sections","/sfbfrequickstartvideo","/smart-devices-guest-screen","/smart-devices-home-screen","/smart-devices-login-screen","/smbWelcome","/start-meeting","/subscriptionManagement","/surface-hub-home-screen","/team-overview","/teamCreate","/teamDashboard","/teamsGallery","/tenantSwitch","/toolkit","/unsupportedBrowser","/unsupportedIE","/v2/","\\path-to-file"],Vp=["callto:","ftp:","ftps:","http:","https:","im:","mailto:","msteams:","onenote:","sip:","sips:","tel:","vscode-insiders:","vscode:","vsls:"],Hp=["","a","allowXTenantAccess","anon","appId","appTenantId","attachmentCount","attachmentSize","attendees","authId","btype","calendarType","card","ccRecipients","channelId","chatId","cloudAttachments","cloudAttachmentsRaw","completionBotId","content","contentType","context","contextType","correlationId","ctx","deeplinkId","defaultFocusArea","defaultRightTab","displayName","displayProperties","emailHtmlLink","endTime","environment","eventId","eventType","fileType","fileTypes","fqdn","from","groupId","height","iCalUid","id","installAppPackage","isBroadcast","isBroadcastMeeting","IsBroadcastMeeting","isPublic","isWatchParty","loginHint","meetingjoin","meetingType","messageId","messageId","MessageId","name","objectUrl","Oid","openInMeeting","organizerId","organizerId","outlookSmtpAddress","outlookTid","outlookUid","p","parentMessageId","pp","pptContext","prid","recordingId","replyChainId","result","ring","role","roleHint","schema","scope","serviceName","shareUrl","source","sourceVersion","startTime","subject","subType","tagId","templateId","templateInstanceId","tenantId","threadId","tid","Tid","timestamp","title","toRecipients","uid","url","user","userEmail","users","ver","viewState","width"],zp=e=>{const{pathname:t,protocol:n,hash:i,search:a}=e,o={hashstart:void 0,hashend:void 0,pathname:void 0,protocol:void 0};let r;o.protocol=Qp(n),o.pathname=Yp(t),o.hashstart=qp(i),o.hashend=Gp(i);try{r=Jp(a)}catch(e){r=`SEARCH_METADATA_ERR:${e.name}`}if(void 0===o.pathname&&void 0===o.protocol&&void 0===o.hashstart&&void 0===o.hashend&&void 0===r)return"unsupported";const s=(0,ge.hR)(o);return r?`${s}::search::${r}`:s},qp=e=>Up.find((t=>e.startsWith(t))),Gp=e=>$p.find((t=>e.endsWith(t))),Yp=e=>{const t=Op.AR.find((t=>e.startsWith(t)));return t||Wp.find((t=>e.startsWith(t)))},Qp=e=>Vp.find((t=>e===t)),Jp=e=>{if(!e||0===e.length)return;const t=new URLSearchParams(e),n=Array.from(t.keys()).sort(),i=n.filter((e=>Hp.includes(e)));if(0===i.length)return`unsupported_searchparams_keys_${n.length}`;const a=Kp(t,i);return(0,ge.hR)(a)},Kp=(e,t)=>{const n={};return t.forEach((t=>{const i=e.get(t);if(i){const e=Zp(i);n[t]=e}else n[t]="undefined"})),n},Zp=e=>{const t=(e=>{try{return JSON.parse(e),!0}catch{return!1}})(e);let n;t&&(n=(e=>{const t=Object.keys(e).sort();if(0===t.length)return t;const n=t.filter((e=>Hp.includes(e)));return 0===n.length?["unsupported_json_parsed_keys"]:n})(JSON.parse(e)));return{canJsonParse:t,jsonParsedKeys:n}};function Xp(e,t){return new URL(e,t.get(c.w.Host).deepLinkDomain||void 0)}function eg(e){const{hash:t,search:n}=e;let i=n;if(t&&!(0,we.isEmpty)(t)){const e=t.indexOf("?");e>=0&&(i=t.substr(e+1,t.length-1))}const a=function(e){return(0,Bp.parse)(e||"")}(i);let o;return a.correlationId&&a.startTimestamp&&a.source&&(o={id:a.correlationId,startTimestamp:a.startTimestamp,source:a.source}),o}function tg({clientLaunchId:e,location:t}){return e??(t&&ag(t,"clientId"))??(0,E.v4)()}function ng(e,t,n){return{...eg(e)||F({deeplinkId:ag(e,"deeplinkId"),scenarioName:be.Cu.NavigationCommand,source:t,externalId:ig(e,"correlationId")}),sourceHint:n}}function ig(e,t){const{hash:n}=e;if(n){const e=lg(n);if(e)try{const n=new URL(e.deepLink,void 0);return(0,Bp.parse)(n.search)[t]}catch(e){return}}}function ag(e,t){const{hash:n}=e;if(n){const e=lg(n);return e&&e[t]}}function og(e){const{action:t,id:n,type:i}=e;if(t===ke.SY.default)switch(e.type){case ke.ck.default:return Op.f5.default;case ke.ck.flyout:return Op.f5.flyout}return n?`/${i}/${n}/${t}`:`/${i}/${t}`}function rg(e){const{experienceBasePath:t,location:n,loggerFactory:i}=e,{hash:a,href:o,pathname:r}=n,s=i.newLogger(ve,"core-services-deeplink");if(!a&&!o&&!r)return;if(o){const e=zp(new URL(o));s.infoToTelemetry&&s.infoToTelemetry(`locationMetadata::${e}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}const l=function(e,t){if(!e.pathname||"/"===e.pathname)return!0;return!!t&&sg(e.pathname)===sg(t)}(n,t);if(a||!l){if(a){s.log("generateDeepLinkFromLocation::hash");const{deepLink:e,crash:t,relaunch:n,source:i,userContextId:o,windowType:r,homeCloud:c,recall:d}=lg(a);if(e)return{deepLink:e,homeCloud:c,crash:t,relaunch:n,relaunchSource:i,isDesktopDeeplink:!0,userContextId:o,windowType:r,recall:d};if(l)return{deepLink:a.startsWith("#")?a.substring(1):a,isDesktopDeeplink:!1}}return o?(s.log("generateDeepLinkFromLocation::href"),{deepLink:o,crash:!1,relaunch:!1,relaunchSource:void 0}):void 0}}function sg(e){return e.replace(/^\/|\/$/g,"")}function lg(e){const{deepLink:t,crash:n,relaunch:i,source:a,clientId:o,deeplinkId:r,userContextId:s,window:l,homeCloud:c,recall:d}=(0,Bp.parse)(e);return{deepLink:"string"==typeof t?t:"",crash:"true"===n,relaunch:"true"===i,source:"string"==typeof a?jp.Z[a]:void 0,clientId:"string"==typeof o?o:void 0,deeplinkId:"string"==typeof r?r:void 0,userContextId:"string"==typeof s?s:void 0,windowType:"string"==typeof l?l:void 0,homeCloud:"string"==typeof c?c:void 0,recall:"true"===d||void 0}}const cg=new Set(["chats","channels"]),dg="active_windows_history",ug="ActiveWindowsHistoryService:: ";class mg{constructor(e,t,n,i,a,o,r,s){this._experienceChangeReportingService=t,this._localStorage=n,this._rebootService=i,this._scenarioFactory=a,this._userContextId=o,this._windowProvider=r,this._activeWindowsService=s,this.cleanup=e=>{switch(e){case"quit":case"restart":this.unsubscribe();break;default:this.unsubscribe(),this.clearCache()}},this.unsubscribe=()=>{this._activeWindowsSubscription?.unsubscribe(),this._windowOptionsSubscription?.unsubscribe()},this._logger=e.newLogger("ActiveWindowsHistoryService","core-services-active-windows-history"),this._logger.log(`${ug}constructed`)}initialize(){const e=this.cleanup;this._rebootService.registerCleanupCallback(e);const{crash:t,relaunch:n}=lg(this._windowProvider.location.hash);this._logger.log(`${ug}crash: ${t} or relaunch: ${n}`),this.restoreWindows(t||n)&&this.subscribeWindows()}restoreWindows(e){if(!e)return this.clearCache(),!0;const t=this._scenarioFactory.newScenario(be.Cu.ActiveWindowsHistoryRestore),n=e=>{this.cleanup();const n={reason:e};t.fail(n)},i=this._activeWindowsService.getActiveWindows(),a=this.filterWindows(i),o=this.readCache();if(!o)return n("Failed to read from localStorage."),!1;const r=o.filter((e=>!a.find((t=>t.activeEntities.mainEntity.id===e.activeEntities.mainEntity.id))));return r.length&&(r.forEach((e=>{e.activeEntities.entityExtension=null})),this._activeWindowsService.setActiveWindows(i.concat(r))),a.length&&!this.persistCache(a.concat(r))?(n("Failed to write to localStorage."),!1):(t.stop(),!0)}persistActiveWindowsInCache(e){const t=this.filterWindows(e);this.persistCache(t)||(this.cleanup(),this._logger.errorToTelemetry?.(`Failed to write ${t.length} windows to localStorage.`,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0))}subscribeWindows(){this._activeWindowsSubscription=this._activeWindowsService.getActiveWindowsObservable().subscribe((e=>{this.persistActiveWindowsInCache(e)})),this._windowOptionsSubscription=this._experienceChangeReportingService.observeChanges().subscribe((async e=>{if(e.type!==Ua.TZ.WindowOptionsChange||!e.windowId||this._userContextId&&e.userContextId!==this._userContextId)return;const t=e=>{this.cleanup(),this._logger.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0)},n=this.readCache();if(!n)return void t("subscribeWindows::windowOptions::Failed to read from localStorage.");const i=n.find((t=>t.id===e.windowId));if(!i)return;const{height:a,left:o,top:r,width:s}=e.context;i.windowOptions={height:a,left:o,top:r,width:s},this.persistCache(n)||t(`subscribeWindows::windowOptions::Failed to write ${n.length} windows to localStorage.`)}))}filterWindows(e){return e.filter((e=>((e,t)=>"focus"===e.layoutConfig.layoutMode&&!e.isMainWindow&&(!t||t===e.userContextId)&&cg.has(e.activeEntities.mainEntity.type))(e,this._userContextId)))}clearCache(){this._logger.log("ClearCache::ACTIVE_WINDOWS_HISTORY_STORAGE_KEY"),this._localStorage.remove(dg,"UserAndExperience")}persistCache(e){return this._logger.debug(`Persist ${e.length} windows to cache.`),this._localStorage.trySet(dg,JSON.stringify(e),"Framework","UserAndExperience")}readCache(){try{const e=JSON.parse(this._localStorage.get(dg,"UserAndExperience")||"[]");return this._logger.debug(`Read ${e.length} windows from cache.`),e}catch{return}}}var pg=n(99425);class gg extends xp{constructor(){super(d.c1.CreateActiveWindowsHistoryTask,["activeWindowsService","authenticationUser","coreSettings","experienceChangeReportingService","localStorage","loggerFactory","rebootService","scenarioFactory","windowProvider"]),this.isAuthenticatedUser=e=>e?.role===pg.a7.Member||e?.role===pg.a7.Guest}async execute(e){const{authenticationUser:t,coreSettings:n}=e,i=n?.get(c.w.Core);if(!i?.enableActiveWindowsHistoryRecovery||!this.isAuthenticatedUser(t))return;const{activeWindowsService:a,experienceChangeReportingService:o,localStorage:r,loggerFactory:s,rebootService:l,scenarioFactory:d,windowProvider:u}=e,m=(0,kt.Lw)(t);e.activeWindowsHistoryService=new mg(s,o,r,l,d,m,u,a)}}var hg=n(380654);const vg={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationIsInUse"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365Application"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isInUse"}}]}}]},yg={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365Apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationsWithInUseStatus"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationsWithInUseStatus"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationConnection"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationIsInUse"}}]}}]}}]}},...vg.definitions]}.definitions]};function Sg(e,t,n,i){e.writeFragment({id:`${n}:${t}`,fragment:vg,data:{__typename:n,id:t,isInUse:i}})}class fg{constructor(e,t,n,i){this._experienceChangeReportingService=e,this._userContextId=t,this._client=n,this._logger=i,this._appBarObservable=this._experienceChangeReportingService.observeChanges().pipe((0,di.p)((e=>e.userContextId===this._userContextId&&e.type===Ua.Mk.AppSelectionChanged&&e.context.appId!==this._currentValue)),(0,o.T)((e=>{this._previousValue=this._currentValue;const t=e;return this._currentValue=t.context.appId,this._client.viewSchemaClient?function(e,t,n){try{const t=e.readQuery({query:yg});if(t){let i,a;for(const[,e]of(0,we.entries)(t))if(i||(i=e.edges.find((e=>e.node.isInUse))),a||(a=e.edges.find((e=>e.node.id===n))),i&&a)break;if(i?.node.id===a?.node.id)return;i&&Sg(e,i.node.id,i.node.__typename,!1),a&&Sg(e,a.node.id,a.node.__typename,!0)}}catch(e){t.error("Error thrown updating Nova AppBar selection.")}}(this._client.viewSchemaClient,this._logger,this._currentValue):this._logger.error("Viewclient store isn't available for updating  AppBar selection."),{previousApplicationSelection:this._previousValue,newApplicationSelection:this._currentValue}}))).pipe((0,hg.u)()),this._appBarSubscription=this._appBarObservable.subscribe()}cleanup(){this._appBarSubscription?.unsubscribe()}observe(){return this._appBarObservable}current(){return this._currentValue}}class kg extends xp{constructor(){super(d.c1.CreateAppBarServiceTask,["client","authenticationUser","experienceChangeReportingService","loggerFactory"])}async execute(e){const{authenticationUser:t,experienceChangeReportingService:n,client:i,loggerFactory:a}=e,o=a.newLogger("AppBarService","core-services-tasks"),r=new fg(n,(0,kt.Lw)(t),i,o);return e.appBarService=r,()=>{r.cleanup()}}}var Cg=n(741706);var bg,wg,Tg=n(188468);class Ig{constructor(e,t,n,i,a){this._host=t,this.timesToSendUntilIdle=2,this._logger=n.newLogger("ClientStateSender","core-services-client-state");const{appIdleTimeoutInMs:o}=i.get(c.w.Core);this.msUntilResend=o?Math.round(o/this.timesToSendUntilIdle):a,this._subscriptionToStateChange=e.pipe((0,Tg.F)()).subscribe((e=>this.handleStateChange(e))),this._logger.log("Initialized")}dispose(){this.stopRecurringSending(),this._subscriptionToStateChange.unsubscribe()}handleStateChange(e){try{e===Ba.Lg.Active||e===Ba.Lg.VeryActive?this.sendStateRecurringly(e):(this.stopRecurringSending(),this.sendState(e))}catch(t){this._logger.error(`Failed to send client state update: ClientState=${e}, Error: ${t}`)}}sendStateRecurringly(e){this._logger.log(`Starting recurring sending of client state: ${e}`);try{this.sendStateAndStartTimer(e)}catch(t){this._logger.error(`Failed to start recurring sending of client state: ClientState=${e}, Error: ${t}`)}}stopRecurringSending(){this.stopTimer(),this._logger.log("Stopped recurring client state sending")}stopTimer(){if(void 0!==this._recurringSendCountdownTimer)try{this._host.clearInterval(this._recurringSendCountdownTimer),this._recurringSendCountdownTimer=void 0}catch(e){this._logger.error(`Failed to stop sending of client state: ${e}`)}}sendStateAndStartTimer(e){this.sendState(e),this.stopTimer(),this._recurringSendCountdownTimer=this._host.setInterval((()=>this.sendState(e)),this.msUntilResend)}sendState(e){const t=function(e){switch(e){case Ba.Lg.Unrecoverable:return d.TL.Disabled;case Ba.Lg.Inactive:return d.TL.Inactive;case Ba.Lg.LongInactive:return d.TL.LongInactive;case Ba.Lg.VeryActive:return d.TL.InCall;default:return d.TL.Interactive}}(e);this._logger.log(`Sending state to main window: ${t} (ClientState=${e})`),this._host.opener.postMessage(pi.pI.UpdateWindowState,{childSettings:{appState:t}})}}class Ng{constructor(e,t,n,i){this._coreClientStateObservable=e,this._idleTracker=n,this._initialClientState=i,this._coreClientStateSubscription=null,this._logger=t.newLogger("ChildClientStateProvider","core-services-client-state"),this._logger.log(`Initializing clientState with state=${this._initialClientState}`),this._childClientStateBehaviorSubject=new ya.t(this._initialClientState),this._coreClientStateSubscription=this._coreClientStateObservable.subscribe((e=>{e!==this.getState()&&(this._logger.log(`Client state is ${e}.`),this._childClientStateBehaviorSubject.next(e))})),this._logger.log("Initialized")}observe(){return this._childClientStateBehaviorSubject.asObservable()}getState(){return this._childClientStateBehaviorSubject.value}getChildWindowStateProvider(e,t,n){const i=this._idleTracker.createChildWindowIdleTracker(e,t,n);return new Ng(this._coreClientStateObservable,t,i,this.getState())}dispose(){this._idleTracker.dispose(),this._coreClientStateSubscription?.unsubscribe(),this._childClientStateBehaviorSubject.complete()}}class Ag{constructor(e,t,n,i,a){this._host=e,this._idleTracker=n,this._defaultClientState=Ba.Lg.Active,this._initializing=!0,this._clientStateSubscription=null,this._idleTrackerStateSubscription=null,this.handleAppStateSyncMessage=e=>{const t=e?.payload?.appState;void 0!==t&&(this._logger.log(`Handling pushed host appState update change to ${t}.`),this.handleMainWindowStateChange(t))},this._logger=t.newLogger("ClientStateProvider","core-services-client-state");const o=this._defaultClientState;this._logger.log(`Initializing clientState with state=${o}`),this._clientStateBehaviorSubject=new ya.t(o),this._setupEventHandlers(t,i,a),this.restartIdleTimerWhenActiveState(),this._initializing=!1,this._logger.log("Initialized")}observe(){return this._clientStateBehaviorSubject.asObservable()}getState(){return this._clientStateBehaviorSubject.value}getChildWindowStateProvider(e,t,n){const i=this._idleTracker.createChildWindowIdleTracker(e,t,n);return new Ng(this.observe(),t,i,this.getState())}dispose(){this._host.opener.removeEventListener(pi.pI.AppStateSyncMessage,this.handleAppStateSyncMessage),this._idleTracker.dispose(),this._stateSender&&this._stateSender.dispose(),this._clientStateBehaviorSubject.complete(),this._clientStateSubscription?.unsubscribe(),this._idleTrackerStateSubscription?.unsubscribe()}startVeryActive(e){this._logger.log(`startVeryActive(): Client state is set to very active by ${e}.`),this.setClientState(Ba.Lg.VeryActive)}stopVeryActive(e){this._logger.log(`stopVeryActive(): Client state is set to active by ${e}.`),this.setClientState(Ba.Lg.Active)}_setupEventHandlers(e,t,n){this._clientStateSubscription=this.observe().subscribe((e=>{this._logger.log(`Client state is ${e}.`)})),this._host.opener.addEventListener(pi.pI.AppStateSyncMessage,this.handleAppStateSyncMessage),this._idleTrackerStateSubscription=this._idleTracker.observe().subscribe((e=>this.handleIdleChange(e))),n&&t&&t.get(c.w.Core)?.enableUpdateAngularOnClientStateChange&&(this._stateSender=new Ig(this.observe(),this._host,e,t,Cg.R.MsUntilIdleDefault))}handleIdleChange(e){this._logger.log(`Handling idleness change to ${e}.`),this._clientStateBehaviorSubject.value!==Ba.Lg.VeryActive&&(this._initializing||this.setClientState(function(e){switch(e){case Cg.e.Inactive:return Ba.Lg.Inactive;case Cg.e.LongInactive:return Ba.Lg.LongInactive;default:return Ba.Lg.Active}}(e),!1))}setClientState(e,t=!0){e!==Ba.Lg.Active&&e!==Ba.Lg.VeryActive||!t||this._idleTracker.restartIdleTimer(),e===Ba.Lg.Inactive&&this._clientStateBehaviorSubject.value===Ba.Lg.LongInactive||this._clientStateBehaviorSubject.value!==e&&(this._logger.log(`Updating client state from=${this._clientStateBehaviorSubject.value} to=${e}.`),this._clientStateBehaviorSubject.next(e))}handleMainWindowStateChange(e){const t=function(e){switch(e){case d.TL.InCall:case d.TL.InBroadcast:case d.TL.Presenting:return Ba.Lg.VeryActive;case d.TL.Interactive:return Ba.Lg.Active;case d.TL.Inactive:return Ba.Lg.Inactive;case d.TL.LongInactive:return Ba.Lg.LongInactive;case d.TL.Disabled:return Ba.Lg.Unrecoverable;default:return}}(e);t!==Ba.Lg.Active&&t!==Ba.Lg.VeryActive||this.setClientState(t)}restartIdleTimerWhenActiveState(){this.getState()!==Ba.Lg.Active&&this.getState()!==Ba.Lg.VeryActive||this._idleTracker.restartIdleTimer()}}!function(e){e.Initializing="Initializing",e.Unrecoverable="Unrecoverable",e.LongInactive="LongInactive",e.Inactive="Inactive",e.Active="Active",e.VeryActive="VeryActive"}(bg||(bg={})),function(e){e.joiningMeeting="joiningMeeting",e.joinedMeeting="joinedMeeting",e.screenSharing="screenSharing"}(wg||(wg={}));class Eg{constructor(e=d.TL.Interactive){this._appState$=new ya.t(e);(0,Un.z)().opener.addEventListener(pi.pI.AppStateSyncMessage,(e=>{const t=e?.payload?.appState;this.setAppState(t)}))}observe(){return this._appState$.asObservable().pipe((0,Tg.F)())}getState(){return this._appState$.value}setAppState(e){void 0!==e&&e!==this.getState()&&this._appState$.next(e)}}var Fg=n(466193);class _g{constructor(e,t,n,i,a,o){this._host=e,this._logger=t,this._hostCommunicationService=n,this._clientStateProvider=a,this._getMachineLockState=o,this._machineIdleThresholdMs=3e5,this._machineIdlePollingIntervalMs=2e4,this._disableSystemIdlePolling=void 0,this._machineIdleStateSubject=new ya.t(Ba.B6.Active),this.subscribeToSettingsChanges(i),this.subscribeMachineIdleToClientState()}observe(){return this._machineIdleStateSubject.asObservable()}getState(){return this._machineIdleStateSubject.getValue()}handleMachineLockStateChange(e){this.evaluateCurrentState()}dispose(){this.stopPollingSystemIdleTime(),this._clientStateSubscription?.unsubscribe(),this._clientStateSubscription=void 0,this._settingsSubscription?.unsubscribe(),this._settingsSubscription=void 0}evaluateCurrentState(){return this._getMachineLockState()===Ba.iP.Locked?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(Ba.B6.Idle)):this._clientStateProvider.getState()===Ba.Lg.VeryActive||this._clientStateProvider.getState()===Ba.Lg.Active?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(Ba.B6.Active)):this._disableSystemIdlePolling?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(Ba.B6.Idle)):void this.pollSystemIdleTime()}subscribeToSettingsChanges(e){this._settingsSubscription=e.getObservable(c.w.Core,["machineIdleThresholdMs","disableSystemIdlePolling","machineIdlePollingIntervalMs"]).subscribe((({machineIdleThresholdMs:e,disableSystemIdlePolling:t,machineIdlePollingIntervalMs:n})=>{null!=e&&(this._machineIdleThresholdMs=e),null!==t&&(this._disableSystemIdlePolling=t,this._disableSystemIdlePolling&&this.stopPollingSystemIdleTime()),null!=n&&(this._machineIdlePollingIntervalMs=n)}))}checkSystemIdleTime(){if(this._checkSystemIdleTimePromise)return this._checkSystemIdleTimePromise;const{promise:e,cancel:t}=this.getSystemIdleTime(),n=e.then((e=>this.handleSystemIdleTime(e)),(()=>{})).finally((()=>{this._checkSystemIdleTimePromise=void 0}));return this._checkSystemIdleTimePromise={promise:n,cancel:()=>t?.()},this._checkSystemIdleTimePromise}getSystemIdleTime(){let e;this._logger.debug("getting system idle time");return{promise:new Promise(((t,n)=>{e=n,this._hostCommunicationService.loadModule("osutils").then((e=>{void 0===e?.getSystemIdleTime?t(void 0):e?.getSystemIdleTime().then((e=>{this._logger.debug(`system idle time=${e}sec`),t(e)}))})).catch((()=>{this._logger.errorToTelemetry?.('Error happened while loading "osutils"',"webclient_framework_host_comms",void 0,!0),t(void 0)}))})),cancel:()=>e?.()}}subscribeMachineIdleToClientState(){this._clientStateSubscription=this._clientStateProvider.observe().subscribe((()=>this.evaluateCurrentState()))}handleSystemIdleTime(e){if(this._getMachineLockState()===Ba.iP.Locked)return void this.updateMachineIdleState(Ba.B6.Idle);if(this._clientStateProvider.getState()===Ba.Lg.VeryActive||this._clientStateProvider.getState()===Ba.Lg.Active)return void this.updateMachineIdleState(Ba.B6.Active);if(!e&&0!==e)return void this.updateMachineIdleState(Ba.B6.Idle);1e3*e>=this._machineIdleThresholdMs?this.updateMachineIdleState(Ba.B6.Idle):this.updateMachineIdleState(Ba.B6.Active)}updateMachineIdleState(e){const t=this._machineIdleStateSubject.getValue();e!==t&&(this._logger.log(`Updating machine idle state from=${t} to=${e}.`),this._machineIdleStateSubject.next(e))}pollSystemIdleTime(){this._disableSystemIdlePolling?this.handleSystemIdleTime(void 0):void 0===this._pollSystemIdleTimeInterval&&(this._pollSystemIdleTimeInterval=this._host.setInterval((async()=>this.checkSystemIdleTime()),this._machineIdlePollingIntervalMs),this.checkSystemIdleTime())}stopPollingSystemIdleTime(){void 0!==this._pollSystemIdleTimeInterval&&(this._host.clearInterval(this._pollSystemIdleTimeInterval),this._pollSystemIdleTimeInterval=void 0),this._checkSystemIdleTimePromise&&(this._checkSystemIdleTimePromise.cancel?.(),this._checkSystemIdleTimePromise=void 0)}}class Dg{constructor(e,t,n,i,a){this.handleMachineLockUpdate=e=>{const t=e?.payload?.isMachineLocked;void 0!==t&&(this._logger.log(`Handling pushed machineLock update change: isMachineLocked = ${t}.`),this.updateMachineLockState(t))},this._logger=t.newLogger("HostStateProvider","core-sercices-host-state"),this._hostStateSubject=new ya.t({windowState:Ba.y7.InFocus,machineLockState:Ba.iP.Active,machineIdleState:Ba.B6.Active,suspendedState:Ba.tJ.Initialized}),this.registerForStateChanges(e,n),this._machineIdleTracker=new _g(e,this._logger,n,i,a,(()=>this.getState().machineLockState)),this._machineIdleSubscription=this._machineIdleTracker.observe().subscribe((e=>{this.updateMachineIdleState(e)}))}observe(){return this._hostStateSubject.asObservable()}getState(){return{...this._hostStateSubject.value}}dispose(){this._machineStateChangedSubscription?.(),this._machineIdleSubscription.unsubscribe(),this._machineIdleTracker.dispose()}registerForStateChanges(e,t){e.opener.addEventListener(pi.pI.AppStateSyncMessage,this.handleMachineLockUpdate),t.loadModule("osutils").then((e=>{this._machineStateChangedSubscription=e?.registerForSessionStateChanged?.((e=>{this._logger.log(`Handling pushed machineLock update change: machine SessionStatus= ${e.status}.`),e.status===Fg.Ph.Suspending||e.status===Fg.Ph.Resumed?this.updateSuspendedState(e.status===Fg.Ph.Suspending):this.updateMachineLockState(e.status===Fg.Ph.Locked)}))})).catch((()=>{this._logger.errorToTelemetry?.('Error happened while loading "osutils"',"webclient_framework_host_comms",void 0,!0)}))}updateMachineLockState(e){const t=e?Ba.iP.Locked:Ba.iP.Active,n=this.getState().machineLockState;if(t!==n){this._logger.log(`Updating machine lock state from=${n} to=${t}.`);const e=this.getState();e.machineLockState=t,this._hostStateSubject.next(e),this._machineIdleTracker.handleMachineLockStateChange(t)}}updateSuspendedState(e){const t=e?Ba.tJ.Suspending:Ba.tJ.Resumed,n=this.getState().suspendedState;if(t!==n){this._logger.log(`Updating machine suspended state from=${n} to=${t}.`);const e=this.getState();e.suspendedState=t,this._hostStateSubject.next(e)}}updateMachineIdleState(e){const t=this.getState().machineIdleState;if(e!==t){this._logger.log(`Updating machine idle state from=${t} to=${e}.`);const n=this.getState();n.machineIdleState=e,this._hostStateSubject.next(n)}}}var Pg=n(681256);class Mg{constructor(e,t,n){this.scenarioFactory=n,this.observe=()=>this.networkStateBehaviorSubject.asObservable(),this.getState=()=>this.networkStateBehaviorSubject.getValue(),this.observeIsOnline=()=>this.isOnlineObservable,this.isOnline=()=>this.convertToIsOnline(this.getState()),this.observeDetailedNetworkState=()=>this.detailedNetworkStateBehaviorSubject.asObservable(),this.convertToIsOnline=e=>e===Pg.Q.Online,this.getDetailedState=()=>this.detailedNetworkStateBehaviorSubject.getValue(),this.logger=e.newLogger(t,"core-services-network-state");const i=Pg.Q.Online,a=Pg._.Unknown;this.networkStateBehaviorSubject=new ya.t(i),this.isOnlineObservable=this.networkStateBehaviorSubject.asObservable().pipe((0,o.T)((e=>this.convertToIsOnline(e))),(0,Tg.F)()),this.logger.log(`Network state is initialized as ${Pg.Q[i]}`),this.sendStateChangeTelemetry(i),this.detailedNetworkStateBehaviorSubject=new ya.t(a)}dispose(){this.networkStateBehaviorSubject.complete(),this.detailedNetworkStateBehaviorSubject.complete(),this.previousNetworkStateChangeTime=void 0}setNetworkState(e,t){this.logger.log(`Set network state to ${Pg.Q[e]}${t?` due to ${t}`:""}`),this.setDetailedNetworkState(this.convertToIsOnline(e)?Pg._.Online:Pg._.Offline),this.getState()!==e&&(this.networkStateBehaviorSubject.next(e),this.logger.log(`Network is ${Pg.Q[e]}`),this.sendStateChangeTelemetry(e,t))}setDetailedNetworkState(e){this.getDetailedState()!==e&&this.detailedNetworkStateBehaviorSubject.next(e)}sendStateChangeTelemetry(e,t){if(!this.scenarioFactory)return;let n=-1;const i=(new Date).getTime();if(this.previousNetworkStateChangeTime&&(n=i-this.previousNetworkStateChangeTime),this.previousNetworkStateChangeTime=i,-1===n)return;const a=e===Pg.Q.Online?be.Cu.NetworkOnline:be.Cu.NetworkOffline;this.scenarioFactory.newScenario(a).stop({offsetCurrentTimeInMs:n,reason:t})}}class Rg{constructor(e){this.logger=e,this.subscriptions=[],this.currentState=void 0}getLastState(){return this.currentState}subscribeToStateChange(e){const t=this;t.subscriptions.push(e);return()=>{const n=t.subscriptions.indexOf(e);n>=0&&t.subscriptions.splice(n,1)}}cleanUpSubscriptions(){this.subscriptions=[],this.currentState=void 0}notifyAboutStateChange(e){this.currentState=e,this.subscriptions.forEach((t=>t(e)))}doOverrideOfLastState(e){this.currentState=e}}class xg extends Rg{constructor(e,t,n){super(e),this.label=t,this.onOverrideLastState=n,this.handleNetworkStateNotification=e=>{this.logger.debug(`${this.label} received ${Pg.Q[e]}`),this.getLastState()!==e&&(this.logger.log(`${this.label} network state is ${Pg.Q[e]}`),this.notifyAboutStateChange(e))}}overrideLastState(e){const t=this.getLastState();this.logger.debug(`NetworkStateTracker state is overriden from ${void 0===t?"undefined":Pg.Q[t]} to ${Pg.Q[e]}`),this.doOverrideOfLastState(e),this.onOverrideLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions()}}class Lg extends Rg{constructor(e,t){super(e),this.handleNetworkStateNotification=e=>{const t=e?Pg.Q.Online:Pg.Q.Offline;this.logger.debug("Endpoints network state is "+(e?"online":"offline")),this.getLastState()!==t&&(this.logger.log("Endpoints network state is "+(e?"online":"offline")),this.notifyAboutStateChange(t))};const n={next:this.handleNetworkStateNotification,complete:()=>this.subscription?.unsubscribe()};this.subscription=t.observeIsOnline().subscribe(n)}overrideLastState(e){const t=this.getLastState();this.logger.debug(`EndpointsNetworkStateListener state is overriden from ${void 0===t?"undefined":Pg.Q[t]} to ${Pg.Q[e]}`),this.doOverrideOfLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.subscription&&!this.subscription.closed&&this.subscription?.unsubscribe(),this.subscription=void 0}}var Og=n(953730),jg=n(489294);function Bg(e){const t="cache-control";if(e.headers.hasOwnProperty(t)){const n=e.headers[t];if(!n.includes("no-store")&&!n.includes("no-cache"))return!0}else if(e.headers.hasOwnProperty("expires"))return!0;return!1}class Ug extends Rg{constructor(e){super(e),this.failed_to_fetch_subContext="rejectHttpError",this.processResponse=e=>{if(e.status)switch(e.status){case Og.nW.NETWORK_AUTHENTICATION_REQUIRED:case Og.nW.PROXY_AUTHENTICATION_REQUIRED:case Og.nW.BAD_GATEWAY:this.handleNetworkStateNotification(Pg.Q.Offline);break;case Og.nW.NOT_MODIFIED:case Og.nW.GATEWAY_TIMEOUT:break;case Og.nW.OK:if(Bg(e))break;this.handleNetworkStateNotification(Pg.Q.Online);break;default:this.handleNetworkStateNotification(Pg.Q.Online)}else this.handleNetworkStateNotification(Pg.Q.Offline)},this.processResponseError=e=>{e&&(e.serverResponse?this.handleNetworkStateNotification(Pg.Q.Online):e.context===d.Ir.RejectHttpError&&e.code===d.O4.RemoteOperationFailed&&e.subContext===this.failed_to_fetch_subContext?this.handleNetworkStateNotification(Pg.Q.Offline):this.logger.log(`Not network related error: ${e.message||e}`))},this.handleNetworkStateNotification=e=>{this.logger.debug(`Send network state is ${Pg.Q[e]}`),this.getLastState()!==e&&(this.logger.log(`Send network state listener is ${Pg.Q[e]}`),this.notifyAboutStateChange(e))},this.unsubscribeFromSendTracking=(0,jg.r)(this.processResponse,this.processResponseError)}overrideLastState(e){const t=this.getLastState();this.logger.debug(`Send state listener's state is overriden from ${void 0===t?"undefined":Pg.Q[t]} to ${Pg.Q[e]}`),this.doOverrideOfLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.unsubscribeFromSendTracking&&this.unsubscribeFromSendTracking(),this.unsubscribeFromSendTracking=void 0}}var $g=n(854190);const Wg=(e,t)=>Promise.resolve({apiName:t,constructRequest:(n,i)=>{const a=e();return a.searchParams.set("cb",Date.now().toString()),{apiName:t,url:a.href,method:"HEAD",timeout:1e4,headers:{"cache-control":"no-store"},cancellationToken:n.token,correlationId:i}},transformResponse:e=>e.status===Og.nW.GATEWAY_TIMEOUT?Promise.reject("GATEWAY_TIMEOUT"):e.status===Og.nW.NETWORK_AUTHENTICATION_REQUIRED?Promise.reject("NETWORK_AUTHENTICATION_REQUIRED"):Promise.resolve()}),Vg=e=>{const{coreSettings:t,platformService:n}=e;return{serviceName:$g.p.NetworkPing,models:{getNetworkStatus:Wg((()=>new URL(t.get(c.w.Core).networkPingUrl||"/diagnostics/network",n.config.currentUrl)),"networkPing"),getNetworkStatusFallback:Wg((()=>new URL(t.get(c.w.Core).networkPingFallbackPingUrl||"/evergreen-assets/icons/1x1-000000ff.png",n.config.staticsPath)),"networkFallbackPing")}}};var Hg=n(762322),zg=n(910857);function qg(e,t,n,i=Hg.B.TimedOut){let a;const o=new Promise((e=>{a=t.setTimeout(e,n)}));return Promise.race([e,o.then((()=>{throw(0,zg.$)(i)}))]).then((e=>(t.clearTimeout(a),e)))}function Gg(e,t){return new Promise(((n,i)=>{if(e<0)i((0,zg.$)(Hg.B.InvalidParameters));else{let i=0;i=t.setTimeout((()=>{t.clearTimeout(i),n()}),e)}}))}const Yg=[5e3,1e4,3e4],Qg="cancelled_ping";class Jg{constructor(e,t,n,i){this.coreSettings=e,this.endpointsManager=t,this.host=n,this.ping=e=>{const t=this.coreSettings.get(c.w.Core).networkPingDisableFallback||!1;let n=this.endpointsManager.createCancelToken(),i=!1;const a=()=>i;return{promise:this.pingEndpoint("initial ping",(()=>this.endpoints.getNetworkStatus(n,e)),!t,a).then((i=>i||t?Promise.resolve(i):(n=this.endpointsManager.createCancelToken(),this.pingEndpoint("fallback ping",(()=>this.endpoints.getNetworkStatusFallback(n,e)),!1,a)))),cancel:()=>(n.cancel(),void(i=!0))}},this.pingEndpoint=async(e,t,n,i)=>{try{return await t(),i()?this.processPingCancelled(e):this.processPingSuccess(e)}catch(t){return i()?this.processPingCancelled(e):t?.serverResponse?this.processPingSuccess(e):(t?.reason===Hg.B.TimedOut?this.logger.log(`${e} timed out`):this.logger.log(`${e} failed`),!n&&this.processPingFailed(e,t))}},this.getRetryIntervals=()=>{const e=this.coreSettings.get(c.w.Core).networkPingRetryIntervals||Yg;return Object.assign([],e)},this.updatePingResult=e=>{this.latestPingResult={isOnline:e,timestamp:Date.now()}},this.logger=i.newLogger("NetworkPingService","core-services-network-state"),this.endpoints=t.createApi(Vg),this.logger.log("Initialized")}detectCurrentNetworkStatus(e){const t=this.coreSettings.get(c.w.Core).networkPingDebounceDelay||3e4;return!(this.coreSettings.get(c.w.Core).networkPingDisableDebounce||!1)&&this.latestPingResult&&this.latestPingResult.isOnline&&this.latestPingResult.timestamp&&Date.now()-this.latestPingResult.timestamp<t?(this.logger.log(`Skipping network detection as last online check succeeded less than ${t}ms ago.`),{promise:Promise.resolve(!0),cancel:()=>{}}):(this.logger.log("doing network ping"),this.ping(e))}whenNetworkOnline(e){if(this.whenNetworkOnlinePromise)return this.whenNetworkOnlinePromise;const t=this.getRetryIntervals();let n=!1;const i=()=>{this.whenNetworkOnlinePromise=void 0,n=!0};let a;const o=new Promise((async(o,r)=>{let s;a=()=>{s?.(),i(),r(Qg)};let l=t[0];for(let i=0;!n;i++){const{promise:a,cancel:o}=this.ping(e);s=()=>{o?.(),s=()=>{}};try{const e=await a;if(s=()=>{},e||n)break;i<t.length&&(l=t[i]),await Gg(l,this.host)}catch(e){this.logger.log("whenNetworkOnline ping rejected")}}i(),o()}));return this.whenNetworkOnlinePromise={promise:o,cancel:()=>a?.()},this.whenNetworkOnlinePromise}processPingSuccess(e){return this.logger.log(`${e} successful!`),this.updatePingResult(!0),!0}processPingFailed(e,t){const n=t?.reason?t.reason:"undefined",i=t?.serverResponse?.status;return this.logger.log(`${e} failed. error reason: ${n}. Response status: ${i}`),this.updatePingResult(!1),!1}processPingCancelled(e){return this.logger.log(`${e} cancelled`),this.updatePingResult(!0),Promise.reject(Qg)}}class Kg extends Mg{constructor(e,t,n,i,a,o,r,s){super(e,"NetworkStateProvider",n),this.loggerFactory=e,this.coreSettings=t,this.host=i,this.clientStateProvider=a,this._defaultNetworkOnlineDetectionTimeoutInMs=15e3,this.coreContextID="",this._contextListeners=new Map,this._skipNetworkDetectionDelay=!0,this.authStateSubscriptions=[],this.createNetworkStateTracker=(e,t,n)=>{const i=new xg(this.logger,t,n),a={next:i.handleNetworkStateNotification,dispose:i.cleanUpSubscriptions};return this._addToContextListeners(e,i),i.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`${t} network state is ${Pg.Q[e]}`))),a},this._handleNetworkStateUpdate=(e,t)=>{if(this.logger.debug(`Update network to ${Pg.Q[e]} due to ${t}`),e===Pg.Q.Offline){if(this.getState()===Pg.Q.Offline)return;this._suspectOffline()}else this._cancelNetworkOnlineDetection(t),this.getState()!==e?this.setNetworkState(e,t):(this.setDetailedNetworkState(Pg._.Online),this._updateAllListenersTo(Pg.Q.Online));this._skipNetworkDetectionDelay&&(this._skipNetworkDetectionDelay=!1)},this._handleWindowOnline=()=>{this.logger.log("browser network online"),this.isOnline()||(this._updateAllListenersTo(Pg.Q.Offline),this._kickOffNetworkOnlineDetection(Pg.Q.Online))},this._handleWindowOffline=()=>{if(this.logger.log("browser network offline"),this.coreSettings.get(c.w.Core).disableWindowEventsNetworkDetectionV2){if(this.getState()===Pg.Q.Offline)return;this.setNetworkState(Pg.Q.Offline,"browser offline"),this._updateAllListenersTo(Pg.Q.Offline),this._kickOffNetworkOnlineDetection(Pg.Q.Offline)}else this._suspectOffline()};try{this._networkPingService=new Jg(this.coreSettings,o,this.host,this.loggerFactory)}catch(e){this.logger.errorNoPii?.("NetworkPingService initialization has failed")}this._subscribeToSendNetworkState(),this.subscribeToEndpointsNetworkStateTracking(this.coreContextID,o.networkState),this._subscribeToWindowNetworkEvents(),this._subscribeToSuspendedStateResumeEvent(r),this.subscribeAuthStateEvent(s)}dispose(){super.dispose(),this._cancelNetworkOnlineDetection("dispose"),this.disposeAllContexts(),this._unsubscribeFromWindowNetworkEvents(),this.suspendedStateSubscription?.unsubscribe(),this.suspendedStateSubscription=void 0,this.authStateSubscriptions.forEach((e=>e.unsubscribe())),this.authStateSubscriptions=[]}disposeContext(e){const t=this._contextListeners.get(e);t&&(t.forEach((e=>{e.cleanUpSubscriptions()})),this._contextListeners.delete(e))}subscribeToEndpointsNetworkStateTracking(e,t){const n=new Lg(this.logger,t);return this._addToContextListeners(e,n),n.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`Endpoints network state is ${Pg.Q[e]}`)))}subscribeAuthStateEvent(e){if(this.coreSettings.get(c.w.Core).disableNetworkDetectionOnResume)return;const t=e?.observe();t&&this.authStateSubscriptions.push(t.subscribe((e=>{switch(e.customError?.errorCode){case"NoNetwork":case"NetworkOffline":case"NetworkTemporarilyUnavailable":this._skipNetworkDetectionDelay=!0,this._handleNetworkStateUpdate(Pg.Q.Offline,"auth state network related error")}})))}setNetworkState(e,t){super.setNetworkState(e,t),this._updateAllListenersTo(e)}_subscribeToSendNetworkState(){const e=new Ug(this.logger);this._addToContextListeners(this.coreContextID,e),e.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`Send network state is ${Pg.Q[e]}`)))}_subscribeToWindowNetworkEvents(){this.host.addEventListener("online",this._handleWindowOnline),this.host.addEventListener("offline",this._handleWindowOffline),this.host.navigator&&(this.host.navigator.onLine?this._handleWindowOnline():this._handleWindowOffline())}_unsubscribeFromWindowNetworkEvents(){this.host.removeEventListener("online",this._handleWindowOnline),this.host.removeEventListener("offline",this._handleWindowOffline)}_subscribeToSuspendedStateResumeEvent(e){if(!e||this.coreSettings.get(c.w.Core).disableNetworkDetectionOnResume)return;const t=e?.observe().pipe((0,o.T)((e=>e.suspendedState)),(0,Tg.F)());this.suspendedStateSubscription=t?.subscribe((e=>{e===Ba.tJ.Resumed&&(this._skipNetworkDetectionDelay=!0,this._handleNetworkStateUpdate(Pg.Q.Offline,"resumed from suspended"))}))}_updateAllListenersTo(e){this._contextListeners.forEach((t=>t.forEach((t=>t.overrideLastState?.(e)))))}_addToContextListeners(e,t){this._contextListeners.has(e)?this._contextListeners.get(e)?.push(t):this._contextListeners.set(e,[t])}_suspectOffline(){const{enableSkipNetworkDetectionTimeoutOnOfflineStart:e,useVeryActiveForNetworkOnlineDetection:t,enableNetworkOnlineDetectionTimeout:n,networkOnlineDetectionTimeoutInMs:i}=this.coreSettings.get(c.w.Core);if(t&&this.clientStateProvider.getState()===Ba.Lg.VeryActive)return this.logger.log("Network detection cancelled due to VeryActive client state."),this._updateAllListenersTo(Pg.Q.Online),void this.setDetailedNetworkState(Pg._.Online);const a=this._skipNetworkDetectionDelay&&!!e;if(!(this._networkDetectionTimeout&&!a||this._detectCurrentNetworkStatusPromise||this._networkPing))if(this._updateAllListenersTo(Pg.Q.Offline),this.setDetailedNetworkState(Pg._.SuspectedOffline),n&&!a){const e=i||this._defaultNetworkOnlineDetectionTimeoutInMs;void 0!==this._networkDetectionTimeout||this._detectCurrentNetworkStatusPromise||(this.logger.log(`Starting ${e}ms timeout before kicking off network online detection.`),this._networkDetectionTimeout=this.host.setTimeout((()=>{this._networkDetectionTimeout=void 0,this.logger.log("Timeout expired."),this._kickOffNetworkOnlineDetection(Pg.Q.Offline)}),e))}else this._kickOffNetworkOnlineDetection(Pg.Q.Offline)}_kickOffNetworkOnlineDetection(e){if(!this._networkPingService||!this._canPerformPing())return void(this.getState()!==e&&this.setNetworkState(e));if(this._detectCurrentNetworkStatusPromise||this._networkPing)return;this.logger.log("Kicking off network status detection.");const t=(0,E.v4)(),n=this._networkPingService;this._detectCurrentNetworkStatusPromise=n.detectCurrentNetworkStatus(t),this._detectCurrentNetworkStatusPromise.promise.then((e=>{void 0!==this._detectCurrentNetworkStatusPromise?(this._detectCurrentNetworkStatusPromise=void 0,e?(this.logger.log("Network status verified as online."),this.setNetworkState(Pg.Q.Online,"http online")):(this.setNetworkState(Pg.Q.Offline,"http offline"),this._startNetworkPing(n,t))):this.logger.log("Network detection cancelled, ignoring result.")})).catch((e=>{e===Qg?this.logger.log("Network detection is cancelled"):this.logger.warn(`Network status verification error: ${e}`),this._detectCurrentNetworkStatusPromise=void 0}))}_canPerformPing(){const{enablePingService:e}=this.coreSettings.get(c.w.Core);return!!e||(this.logger.warn("Network detection is disabled."),!1)}_startNetworkPing(e,t){this.logger.log("Started recurring network ping."),this._networkPing=e.whenNetworkOnline(t),this._networkPing.promise.then((()=>{this._networkPing?(this._networkPing=void 0,this.getState()!==Pg.Q.Online&&this.setNetworkState(Pg.Q.Online,"Network ping succeded")):this.logger.log("Network ping cancelled, ignoring result.")})).catch((e=>{this.logger.log(`network detection by ping terminated due to ${e?.message?e.message:e}`)}))}_cancelNetworkPing(e){this._networkPing&&(this.logger.log(`Cancelling network ping due to ${e}`),this._networkPing.cancel?.(),this._networkPing=void 0)}_cancelNetworkOnlineDetection(e){void 0!==this._networkDetectionTimeout&&(this.logger.log(`Cancelling network detection timeout due to ${e}`),this.host.clearTimeout(this._networkDetectionTimeout),this._networkDetectionTimeout=void 0),this._detectCurrentNetworkStatusPromise&&(this.logger.log(`Cancelling network detection due to ${e}`),this._detectCurrentNetworkStatusPromise.cancel?.(),this._detectCurrentNetworkStatusPromise=void 0),this._cancelNetworkPing(e)}disposeAllContexts(){this._contextListeners.forEach((e=>{e.forEach((e=>{e.cleanUpSubscriptions()}))})),this._contextListeners.clear()}}class Zg extends Rg{constructor(e,t){super(e),this.handleLegacyApplicationStateChange=e=>{const t=this.isOnlineAndConnectedInternal(e);this.logger.log(`LegacyApplicationState changed to ${d.TL[e]}`),this.notifyAboutStateChange(t)},this.isOnlineAndConnectedInternal=e=>{switch(e){case d.TL.Disabled:case d.TL.Offline:return Pg.Q.Offline;default:return Pg.Q.Online}},this.legacyApplicationStateSubscription=t.observe().pipe((0,Tg.F)()).subscribe(this.handleLegacyApplicationStateChange)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.legacyApplicationStateSubscription&&(this.legacyApplicationStateSubscription.unsubscribe(),this.legacyApplicationStateSubscription=void 0)}}class Xg extends Mg{constructor(e,t,n,i,a,o){super(t,"LegacyNetworkStateProvider",n),this.hostCommunicationService=o,this._legacyAppStateListener=void 0,this._suspectedStateListeners=[],this._handleNetworkListenerUpdate=async(e,t)=>{e!==this.getState()?(this.logger.debug(`Network suspected ${Pg.Q[e]}${t?" due to ":""}${t}`),await this._sendSuspectedNetworkStateThrottled(this._convertToIsOnline(e))):void 0!==this._suspectedIsOnline&&this.convertToIsOnline(e)!==this._suspectedIsOnline&&this._resetSuspectedState()},this._sendSuspectedNetworkState=async e=>{this.logger.log(`Sending network state to main window: ${e}`);const t=await this.hostCommunicationService.loadModule("core");t?.notifyCoreStateChanged?t.notifyCoreStateChanged({isNetworkOnline:e}):this.logger.warn("notifyCoreStateChanged is missing in HostComms")},this._initSuspectedThrottleFunc=()=>{this._throttledSuspectedIsOnline=(0,we.throttle)(this._sendSuspectedNetworkState,2e3)},this._convertToIsOnline=e=>e!==Pg.Q.Offline,this._updateSuspectedStateListenersTo=e=>this._suspectedStateListeners.forEach((t=>t.overrideLastState?.(e))),this._subscribeToLegacyAppStateTracking(e),this._subscribeToSuspectedNetworkState(a,i)}dispose(){super.dispose(),this._legacyAppStateListener?.cleanUpSubscriptions(),this._legacyAppStateListener=void 0,this._suspectedStateListeners.forEach((e=>e.cleanUpSubscriptions())),this._suspectedStateListeners=[],this._clearSuspectedState(),this._throttledSuspectedIsOnline=void 0}_subscribeToLegacyAppStateTracking(e){this._legacyAppStateListener=new Zg(this.logger,e);const t=this;this._legacyAppStateListener.subscribeToStateChange((e=>t._updateNetworkState(e,`LegacyApplicationState changed to ${Pg.Q[e]}`)));const n=this._legacyAppStateListener.getLastState();void 0!==n&&this._updateNetworkState(n,"initial LegacyApplicationState")}_subscribeToSuspectedNetworkState(e,t){const{enableNetworkTrackingForLegacyNetworkState:n}=t.get(c.w.Core);n&&(this._initSuspectedThrottleFunc(),this._subscribeToSendNetworkState(),this._subscribeToEndpointsNetworkStateTracking(e.networkState))}_subscribeToSendNetworkState(){const e=new Ug(this.logger);this._suspectedStateListeners.push(e),e.subscribeToStateChange((e=>this._handleNetworkListenerUpdate(e,`Send network state is ${Pg.Q[e]}`)))}_subscribeToEndpointsNetworkStateTracking(e){const t=new Lg(this.logger,e);this._suspectedStateListeners.push(t),t.subscribeToStateChange((e=>this._handleNetworkListenerUpdate(e,`Endpoints network state is ${Pg.Q[e]}`)))}_updateNetworkState(e,t){this.logger.log(`Update network to ${Pg.Q[e]}${t?" due to ":""}${t}`),this.getState()!==e&&(this.setNetworkState(e),this._resetSuspectedState())}async _sendSuspectedNetworkStateThrottled(e){e!==this._suspectedIsOnline?(this._resetSuspectedState(),this._suspectedIsOnline=e):this._updateSuspectedStateListenersTo(this.getState()),this._throttledSuspectedIsOnline&&await this._throttledSuspectedIsOnline(e)}_clearSuspectedState(){void 0!==this._suspectedIsOnline&&(this._suspectedIsOnline=void 0),this._throttledSuspectedIsOnline?.cancel(),this._updateSuspectedStateListenersTo(this.getState())}_resetSuspectedState(){this._clearSuspectedState(),this._initSuspectedThrottleFunc()}}const eh=512,th="tmp.";function nh(e,t){return(e.length+t.length)/eh}class ih extends xp{constructor(){super(d.c1.CreateAppState,[]),this.clientStateStorageKey="tmp.clientState",this._updateTelemetryOnClientStateChange=(e,t)=>{e.observe().subscribe((e=>{t.setCoreContext("AppInfo.ClientState",e)}))},this._updateTelemetryOnNetworkStateChange=(e,t)=>{e.observeIsOnline().subscribe((e=>{const n=e?"Online":"Offline";t.setCoreContext("AppInfo.NetworkState",n)}));e.observeDetailedNetworkState().subscribe((e=>{t.setCoreContext("AppInfo.DetailedNetworkState",e)}))},this._updateTelemetryOnHostStateChange=(e,t)=>{e.observe().pipe((0,o.T)((e=>e.suspendedState)),(0,Tg.F)()).subscribe((e=>{t.setCoreContext("AppInfo.Suspended",e)}));e.observe().pipe((0,o.T)((e=>e.machineLockState)),(0,Tg.F)()).subscribe((e=>{t.setCoreContext("AppInfo.MachineLock",e)}))},this._updateHostOnClientStateChange=(e,t,n)=>{const i=n.newLogger("updateHostOnClientStateChange","core-services-tasks");e.observe().subscribe((e=>t.loadModule("webclientstates").then((t=>{if(t&&t.notifyWebClientStateChange){const n=bg[e];t.notifyWebClientStateChange(n),i.log(`messaged host new ClientState (${e}). WebClientState sent: ${n}`)}else i.warn(`${kr.LoadModuleWebClientStatesFailed} or webclientstates.notifyWebClientStateChange is not loaded`)})).catch((e=>{i.errorToTelemetry&&i.errorToTelemetry(`Error happened: ${e.message||e}`,"webclient_framework_host_comms",void 0,!0)}))))},this._trackClientStateForGlassjar=(e,t)=>{e.observe().subscribe((e=>t.localStorage.setItem(this.clientStateStorageKey,e)))},this._calculateLocalStorageUseOnIdle=(e,t,n)=>{const i=t.newLogger("calculatelocalstorageuseonidle","core-services-tasks");e.observe().subscribe((e=>{if(e===Ba.Lg.LongInactive){const e=function(e){return Object.keys(e.localStorage).reduce(((t,n)=>t+nh(n,e.localStorage[n])),0)}(n);i.infoToTelemetry?.(`Used local storage: ${e} KB`,"localstorage_size",{size:e},!0)}}))}}async execute(e){const{coreSettings:t,hostCommunicationService:n,loggerFactory:i,platformService:a,scenarioFactory:o,telemetryService:r,windowProvider:s}=e,l=d.TL.Inactive;e.appStateService=new Eg(l);const u=new Cg.R(s,i,t);e.clientState=new Ag(s,i,u,t,!0),this._updateTelemetryOnClientStateChange(e.clientState,r);const m=new Dg(s,i,n,t,e.clientState);e.hostState=m,this._updateTelemetryOnHostStateChange(m,r);const p=this._createNetworkStateProvider(e,e.clientState,e.appStateService);e.networkState=p,this._updateTelemetryOnNetworkStateChange(p,r),e.errorState=new wi(s,o,a,p,e.diagnosticsService,t,i),function(e,t,n){const{idleUpdateOnMachineLock:i}=n.get(c.w.Core,["idleUpdateOnMachineLock"]);if(i){const a=t.observe();let o=i;n.getObservable(c.w.Core,["idleUpdateOnMachineLock"]).subscribe((e=>{o=!!e.idleUpdateOnMachineLock})),a.subscribe((t=>{o&&e.handleHostStateChange(t)}))}}(u,m,t);const{enableUpdateHostOnClientStateChange:g,disableLocalStorageUsageTelemetry:h}=t.get(c.w.Core,["enableUpdateHostOnClientStateChange","disableLocalStorageUsageTelemetry"]);g&&this._updateHostOnClientStateChange(e.clientState,n,i),h||this._calculateLocalStorageUseOnIdle(e.clientState,i,s);const{isRunningGlassjar:v}=t.get(c.w.Test);v&&this._trackClientStateForGlassjar(e.clientState,s)}_createNetworkStateProvider(e,t,n){const{coreSettings:i,loggerFactory:a,scenarioFactory:o,windowProvider:r,endpointsManager:s,hostCommunicationService:l,hostState:d,authStateProvider:u}=e,{enableNetworkOnlineDetection:m}=i.get(c.w.Core);return m?new Kg(a,i,o,r,t,s,d,u):new Xg(n,a,o,i,s,l)}}var ah=n(291678),oh=n(443400);class rh extends xp{constructor(){super(d.c1.CreateAsyncMediaAuth,["gtmRegistry","discover","loggerFactory","coreSettings","scenarioFactory","windowProvider","platformService","endpointsManager","localStorage","authenticationService","config","authenticationUser","clientState","networkState","hostState"]),this.lifeCycleSubscriptions=[d.dy.OnUserAuthenticated,d.dy.OnUserAuthenticated_MTMA]}async execute(e){e.mediaAuthService||(e.mediaAuthService=new oh.k(ah.t,e.gtmRegistry,e.discover,e.loggerFactory,e.coreSettings,e.scenarioFactory,e.windowProvider,e.platformService,e.endpointsManager,e.localStorage,e.authenticationService,e.config,e.authenticationUser,e.clientState,e.networkState,e.hostState))}}var sh=n(176737),lh=n(50737),ch=n(235133),dh=n(913895),uh=n(899855),mh=n(736626),ph=n(270560);class gh{constructor(e,t,n){this._coreSettings=t,this._accountId=n,this._criticalResources=[],this.cleanup=new Ye.B7,this.currentAuthState=new ya.t({state:dh.k.Up}),this.resourceTokenStates=new Map,this.logSubscriptions=[],this.stateChangeLogs=[],this.skypeState=dh.n.Success,this.skypeTokenState=new ya.t(dh.n.Unknown),this._logger=e.newLogger("AuthStateProvider","core-services-auth"),this._logger.log("[AuthState] Initializing auth state to Up.");const{criticalResources:i,authStateChangeTimeout:a}=this._coreSettings?.get(c.w.Auth)||{};this._criticalResources=i||[],this._authStateChangeTimeout=a??3e4,this.badTokenStates=new Map,this.skypeLogSubscription=this.skypeTokenState.pipe((0,Ge.Q)(this.cleanup)).pipe((0,Tg.F)()).subscribe((e=>{this._logger.log(`[AuthState] Skype token state changed to: ${e}`),this.recordStateChange("SkypeToken",e)})),this.telemetryInterval=globalThis.window.setInterval((()=>{this.publishAuthStateTelemetry()}),Qt.zB.ONE_HOUR),n&&(0,ph.Yc)(this.currentAuthState.value.state,n)}observe(){return this.currentAuthState}getState(){return this.currentAuthState.value}getInteractionRequiredResource(){const e=this.badTokenStates.entries();let t=e.next();for(;!t.done;){if(t.value[1]===dh.n.InteractionRequired)return t.value[0];t=e.next()}}reportResourceTokenState(e,t,n){(this._criticalResources.includes(e)||e===Qt.oF.SIGNIN_RESTRICTIONS_KEY)&&(this.updateTokenStateMap(e,t),t===dh.n.Success?this.badTokenStates.has(e)&&(this.badTokenStates.clear(),this.skypeState=t):this.badTokenStates.set(e,t),this.evaluateCurrentState(n))}observeResourceTokenState(e){if(!this._criticalResources.includes(e)&&e!==Qt.oF.SIGNIN_RESTRICTIONS_KEY)throw new Error("Unsupported resource, contact Auth team if you need your resource added.");let t=this.resourceTokenStates.get(e);return t||(t=this.updateTokenStateMap(e,dh.n.Unknown)),t.pipe((0,Ge.Q)(this.cleanup)).pipe((0,Tg.F)())}reportSkypeTokenState(e,t){this.skypeTokenState.next(e),e!==this.skypeState&&(this.skypeState=e,this.evaluateCurrentState(t))}observeSkypeTokenState(){return this.skypeTokenState.pipe((0,Ge.Q)(this.cleanup)).pipe((0,Tg.F)())}getSkypeTokenState(){return this.skypeTokenState.value}cleanupObservables(){this._logger.log("[AuthState] Cleanup function called."),this.publishAuthStateTelemetry(),globalThis?.window?.clearInterval(this.telemetryInterval),this.cleanup.next(!0),this.cleanup.complete(),this.skypeTokenState.complete(),this.resourceTokenStates.forEach((e=>e.complete())),this.resourceTokenStates.clear(),this.skypeLogSubscription.unsubscribe(),this.logSubscriptions.forEach((e=>e.unsubscribe())),this.logSubscriptions=[]}recordStateChange(e,t){t!==dh.n.Unknown&&this.stateChangeLogs.push(`${Date.now()}|${e}->${t}`)}publishAuthStateTelemetry(){if(this.stateChangeLogs.length<1)return;const e=uh.$C.create({subContext:"AuthState",correlation:{id:(0,mh.DA)(),source:"auth-state-provider",scenarioName:be.Cu.AuthPublishState}});e.addEventData(this.stateChangeLogs),e.closeScenario(),this.stateChangeLogs=[]}updateTokenStateMap(e,t){let n=this.resourceTokenStates.get(e);return n?n.next(t):(n=new ya.t(t),this.resourceTokenStates.set(e,n),this.logSubscriptions.push(n.pipe((0,Ge.Q)(this.cleanup)).pipe((0,Tg.F)()).subscribe((t=>{this._logger.log(`[AuthState] ${e} token state changed to: ${t}`),this.recordStateChange(e,t)})))),n}evaluateCurrentState(e){let t;if(0===this.badTokenStates.size)t=this.skypeState===dh.n.LicenseError?dh.k.LicenseError:this.skypeState!==dh.n.Success?dh.k.SkypeReconnecting:dh.k.Up;else{const e=this.badTokenStates.values();let n=e.next();for(;!n.done;){if(n.value===dh.n.InteractionRequired){t=dh.k.InteractionRequired;break}t=n.value===dh.n.SignInRestriction?dh.k.SignInRestriction:dh.k.AADReconnecting,n=e.next()}}t&&this.changeAuthState(t,e)}changeAuthState(e,t){if(this.shouldChangeStateToImmediately(e))this.pendingStateClearTimeout&&(globalThis.window.clearTimeout(this.pendingStateClearTimeout),this.pendingState=void 0,this.pendingStateClearTimeout=void 0),this.changeTo({state:e,customError:hh(t)});else if(this.pendingState)this.pendingState={state:e,customError:hh(t)};else{if(e===this.currentAuthState.value.state)return;this.pendingState={state:e,customError:hh(t)},this.pendingStateClearTimeout=globalThis.window.setTimeout((()=>{this.pendingState&&this.changeTo(this.pendingState),this.pendingState=void 0,this.pendingStateClearTimeout=void 0}),this._authStateChangeTimeout)}}shouldChangeStateToImmediately(e){switch(e){case dh.k.Up:case dh.k.InteractionRequired:case dh.k.LicenseError:case dh.k.SignInRestriction:return!0;default:return!1}}changeTo(e){e.state!==this.currentAuthState.value.state&&(this._logger.warn(`[AuthState] Transition from ${this.currentAuthState.value.state} to ${e.state}`),this.recordStateChange("AuthState",e.state),this.currentAuthState.next(e),this._accountId&&(0,ph.Yc)(e.state,this._accountId,e.customError))}}const hh=e=>e&&{errorCode:e.errorCode||e.code,message:e.message,context:e.context,isExpected:e.isExpected,correlationId:e.correlationId,subContext:e.subContext};var vh=n(340506),yh=n(458648),Sh=n(127671),fh=n(588111),kh=n(446320),Ch=n(139496),bh=n(82346);const wh="Login Rate limit exceeded",Th={AdminUserLicenseNotPresentForbidden:"AdminUserLicenseNotPresentForbidden",AdminTeamsDisabledForTenantForbidden:"AdminTeamsDisabledForTenantForbidden",UserLicenseNotPresentForbidde:"UserLicenseNotPresentForbidde",TeamsDisabledForTenantForbidden:"TeamsDisabledForTenantForbidden",UserLicenseNotPresentTrialEligible:"UserLicenseNotPresentTrialEligible",TrialLicenseTenantNotReady:"TrialLicenseTenantNotReady",NewFederatedUsersNotAllowed:"NewFederatedUsersNotAllowed"},Ih=(e,t)=>(t<0||Date.now()-t>=yh.YM.MILLISECONDS_PER_HOUR)&&((0,Je.GQ)(e)||[Og.nW.THROTTLED,Og.nW.NOT_AUTHORIZED,-1].indexOf(e)>-1),Nh=async(e,t,n,i,a)=>{const o=(0,fh.Sl)(i),{serverResponse:{status:r,body:s}={}}=e;o?.appendEventData({statusCode:r}),(0,Je.GQ)(r??0)?o?.fail({message:(0,mh.Nw)(e),errorCode:d.O4.ServiceUnavailable,statusCode:r}):-1!==r?(s.message?.indexOf(wh)>-1&&(o?.incomplete({message:(0,mh.Nw)(e),errorCode:wh,statusCode:r}),a.error(`DiscoverRetryPolicy: Delaying skype token fetch for ${bh.zw.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD}' .`),(0,kh.y)(bh.zw.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD)),await Ah(e,t,n,i,a)):o?.incomplete({message:(0,mh.Nw)(e),errorCode:d.O4.TimedOut,statusCode:r})},Ah=async(e,t,n,i,a)=>{const o=(0,fh.Sl)(i),{serverResponse:{status:r,body:s,headers:l}={}}=e;let c;try{const e=await s.json();c=e?.error?.code}catch(e){a.error(`Body jsonify failed: ${e}`)}switch(a.error(`Getting errorCode: [${c}] from response`),r){case Og.nW.NOT_AUTHORIZED:await Fh(l,n,a,t.options?.userIdentifier),o?.incomplete({message:(0,mh.Nw)(e),errorCode:c??d.O4.Unauthorized,statusCode:r});break;case Og.nW.FORBIDDEN:((e,t)=>e===Og.nW.FORBIDDEN&&!!t&&t in Th)(r,c)&&Eh(c,t,i),o?.cancel({message:(0,mh.Nw)(e),errorCode:c??d.O4.Forbidden,statusCode:r});break;case Og.nW.THROTTLED:default:o?.incomplete({message:(0,mh.Nw)(e),errorCode:c??d.O4.Throttled,statusCode:r})}},Eh=(e,t,n)=>{const i=(0,fh.Sl)(n);if(e===Th.NewFederatedUsersNotAllowed)return t.headerUpdate||(t.headerUpdate={strongConsistencyValue:(a=bh.Jl.strongConsistencyMsInternalUserSignup,bh.Jl.strongConsistencyDefaultValue.replace("{id}",a))}),void i?.mark(Th.NewFederatedUsersNotAllowed);var a;e===Th.UserLicenseNotPresentTrialEligible?(i?.mark(Th.UserLicenseNotPresentTrialEligible),t.lastLicenseErrorTime=-1):t.lastLicenseErrorTime=Date.now()},Fh=async(e,t,n,i)=>{e&&0!==Object.keys(e)?.length?await t(e,i):n.error("DiscoverUnauthorizeError: header is empty")};const _h=async(e,t,n,i)=>Dh(e,t,Ph)({policy:n,delay:n.createDelay(),retryCount:0,retriesTable:{},startTime:Date.now().valueOf(),forever:n.foreverCheck,headerUpdate:void 0,lastLicenseErrorTime:-1,options:{userIdentifier:i??void 0}}),Dh=(e,t,n)=>async i=>{for(;;){const a=t;i.headerUpdate?.strongConsistencyValue&&(a.headers||(a.headers={}),a.headers.ConsistencyLevel=i.headerUpdate.strongConsistencyValue);try{return await e(a)}catch(e){await n(e,i)}}},Ph=async(e,t)=>{if(!e.serverResponse)throw e;const n=!await t.forever(),{serverResponse:{status:i}}=e;if(-1!==t.startTime&&Date.now().valueOf()-t.startTime>=t.policy.retryMaxTimeMs&&(t.startTime=-1,t.policy.retryMaxTimeCallback(n)),i&&t.policy.isOnline()&&(t.retryCount++<t.policy.maxRetryCount&&!n||n)&&t.policy.shouldRetry(i,t.lastLicenseErrorTime))return t.retriesTable[i]=(t.retriesTable[i]||0)+1,t.policy.errorHandler(e,t);throw e};var Mh=n(44522),Rh=n(252251),xh=n(408605),Lh=n(686180);class Oh{constructor(e,t,n,i,a,o,r,s,l,u,m,p,g,h,v=(0,Un.z)()){this._authenticationService=e,this._coreSettings=i,this._scenarioFactory=a,this._networkStateProvider=o,this._hostCommunicationService=r,this._i18n=s,this._authStateProvider=l,this.onDiscoverSuccess=u,this.onDiscoverFail=m,this.isCDLWorker=p,this.cdlAuthClient=g,this._clientConfiguration=h,this.globalScope=v,this._skypeToken=new ya.t(null),this._localStorageKeys=[],this._firstMTTokenEstablished=!1,this.cleanup=()=>{this._onlineSubscription?.unsubscribe(),this._onlineSubscription=void 0,this._awakeSubscription?.unsubscribe(),this._awakeSubscription=void 0},this.clearDiscoveryCacheForLogout=async e=>{const t=(0,ch.X_)(e);this.clearDiscoveryCache(t,["^fn:clearDiscoveryCacheForLogout"])},this.clearDiscoveryCache=(e,t,n)=>{this._skypeToken.next(null),sh.Vh.del((0,lh.Xr)(e).skypeToken),t?.push("skypeCacheClear"),n||(sh.Vh.del((0,lh.Xr)(e).userDetail),t?.push("userDetailsCacheClear"),sh.Vh.del((0,lh.Xr)(e).regionGtm),t?.push("regionGtmsCacheClear")),this._clearFromLocalStorage(n),t?.push("localstorageCacheClear"),this._logger.log(`[clearDiscoveryCache] Discover cache cleared, tokenOnly: ${!!n}.`)},this._getDiscoverResponse=async e=>{const{correlationId:t=e?.correlation?.id??(0,mh.DA)(),eventData:n=[]}=e;n?.push("_getDiscoverResponse|startScenario");const{scenario:i,closeTelemetry:a,authTelemetry:o}=(0,fh.M7)(e.correlation,this._coreSettings,"discoverV2",this._scenarioFactory);let r;i&&n?.push("using scenario factory");try{if(!this._isAppOnline())throw(0,Jt.$5)({...fh._P,correlationId:t});if(!this._coreSettings.get(c.w.Auth).ignoreInteractionRequiredCache&&this._authStateProvider?.getState()?.state===dh.k.InteractionRequired)throw(0,Jt.$5)({...fh._Q,correlationId:t});r=await this._discoverProvider({...e,correlationId:t,eventData:n}),(0,fh.QK)(r,this._coreSettings,this._telemetryProvider,this._logger,this._authenticationService)}catch(e){const t=e.errorCode||e.code,{serverResponse:{status:o}={}}=e;throw o===Og.nW.FORBIDDEN?(this._authStateProvider?.reportSkypeTokenState(dh.n.LicenseError,e),n?.push("authState:license-error")):t===Qt.tG.InteractionRequired?(this._authStateProvider?.reportSkypeTokenState(dh.n.InteractionRequired,e),n?.push("authState:interactionRequired")):(this._authStateProvider?.reportSkypeTokenState(dh.n.Failure,e),n?.push("authState:failure")),this.onDiscoverFail&&this.onDiscoverFail(!!this._bootstrapData),(0,fh.ZH)(e,n,this._isAppOnline(),i,this._logger,this._coreSettings,a)}this._authStateProvider?.reportSkypeTokenState(dh.n.Success);const s=(0,fh.WB)(r,this._logger);await(0,fh.vL)(e.userIdentifier,s,n,t,this._logger,this._scenarioFactory,this.globalScope,this._hostCommunicationService,this._coreSettings);const l=await(0,fh.RU)(this._authenticationService,this._logger,n);return(0,ch.gn)(e?.userIdentifier,l)||!e?.userIdentifier?this._skypeToken.next(r.skypeToken):this._logger.error(`[_getDiscoverResponse][${t}] option uid:${e?.userIdentifier}`),a&&(o?.addEventData(n),a()),i?.stop({reason:n.join(";")}),this.onDiscoverSuccess&&this.onDiscoverSuccess(),r},this._isSkypeTokenValidInMemory=async e=>{const t=e??await(0,fh.RU)(this._authenticationService,this._logger,[]);return!!sh.Vh.getValue((0,lh.Xr)(t).skypeToken)},this._retryMaxTimeCallback=e=>e?(this._authStateProvider?.reportSkypeTokenState(dh.n.Failure),this._logger.error("[_retryMaxTimeCallback]Reporting skype token failure to authState"),!1):(this._logger.warn("[_retryMaxTimeCallback] Reached retry max time."),!1),this._getResponseFromLocalStorage=(e,t)=>{if(!t||!e)return;const n=this._getFromLocalStorage(e,t,"auth.gtm.table"),i=this._getFromLocalStorage(e,t,"auth.skype.token");return n&&i?{...i.userDetails,skypeToken:i.skypeToken,expires:new Date(i.expiration),regionGtms:n}:void 0},this._getCachedResponseWrapper=async e=>this._getResponseFromLocalStorage(e?.profile?.oid,e?.profile?.tid),this._acquireSkypeTokenWeb=async e=>{e.eventData?.push("fn:_acquireSkypeTokenWeb");let t=await this._authenticationService.getUser({accountId:e.userIdentifier.id,userIdentifier:e.userIdentifier,correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:be.Cu.AuthWebUser}});if(e.eventData?.push("user:"+ +!!t,"uid:"+ +!!e.userIdentifier,"currentToken:"+ +!!e.currentSkypeToken),!t){if(t=await this._authenticationService.getUser({correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:be.Cu.AuthWebUser}}),!t)throw(0,Jt.$5)({context:bh.JN,subContext:"_acquireSkypeTokenWeb",errorCode:Qt.tG.UserNotFoundError,message:"User not found for provided userIdentifier nor globally.",correlationId:e.correlationId,isExpected:!1});(0,fh.xT)(e,t,this._logger)}const n=await this._getCachedResponseWrapper(t);if(n)return e.eventData?.push("cache:1"),n;const i=sh.Vh.getValue((0,lh.Xr)((0,ch.X_)(t)).userDetail),a=(0,fh.Ln)(t,e.correlationId,this._coreSettings,this._logger,this._i18n,!!i,this._clientConfiguration),o=this._scenarioFactory.findScenario(be.Cu.GetSkypeToken);o?.appendEventData({message:`url: ${a.url}`});let r=await this._sendRequest(e,a,o);return this._coreSettings.get(c.w.Auth).disableRetryOnSameTokenFromAuthZ||r.skypeToken!==e.currentSkypeToken||(e.eventData.push("same-token"),o?.mark(bh.aF.SKYPE_RECEIVED_SAME_TOKEN,(0,fh.Lc)(e.eventData,this._isAppOnline(),this._coreSettings)),a.authOptions={...a.authOptions,forceRenew:!0},r=await this._sendRequest(e,a,o)),r},this._sendRequest=async(e,t,n)=>{n?.mark(bh.aF.SKYPE_SEND_REQUEST,(0,fh.Lc)(e.eventData,this._isAppOnline(),this._coreSettings));const i=await this.send({userIdentifier:e.userIdentifier,correlationId:e.correlationId})(t);return e.eventData?.push("response:1"),n?.mark(bh.aF.SKYPE_RECEIVED_RESPONSE,(0,fh.Lc)(e.eventData,this._isAppOnline(),this._coreSettings)),n&&(n.eventData.authzCorrelationId=i.headers["correlation-id"]??e.correlationId,n.eventData.correlationTags=i.headers["correlation-tags"],n.eventData.correlationId=e?.correlationId),(0,fh.pG)(i,e,this._logger,this._coreSettings.get(c.w.Auth).disableAuthzErrorResponseLogging)},this._acquireSkypeTokenDesktop=async e=>{e.eventData?.push("fn:_acquireSkypeTokenDesktop");const t=await this._authenticationService.getUser({accountId:e.userIdentifier.id,userIdentifier:e.userIdentifier,correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:be.Cu.AuthWebUser}}),n=await this._getCachedResponseWrapper(t);if(n)return n;e.eventData?.push("cache:0");const i=this._scenarioFactory.findScenario(be.Cu.GetSkypeToken);i?.mark(bh.aF.SKYPE_SEND_REQUEST_DESKTOP);const a=await this.globalScope.opener.requestMessage(pi.pI.GetStateData,{requestType:"skypeToken",timeout:yh.uM.ACQUIRE_TOKEN_TIMEOUT});i?.mark(bh.aF.SKYPE_RECEIVED_RESPONSE);const o=a?.skypeTokenData;i&&(i.eventData.correlationId=a?.correlationId);return{userId:(0,fh.Op)(o?.token?.skypeToken,this._logger),userDetails:o?.userDetails,skypeToken:o?.token?.skypeToken,regionGtms:o?.regionGtms,expires:new Date(o?.token.expiration)}},this._acquireSkypeTokenWorker=async e=>{const{eventData:t}=e;if(t.push("fn:_acquireSkypeTokenWorker"),!this.cdlAuthClient)throw(0,Jt.$5)({context:bh.JN,subContext:"_acquireSkypeTokenWorker",errorCode:d.O4.NotPresent,message:"CDL worker auth client unavailable",correlationId:e.correlationId,isExpected:!1});const n=!1!==e.forceRenew,i=this._scenarioFactory.findScenario(be.Cu.GetSkypeToken);i?.mark(bh.aF.SKYPE_SEND_REQUEST_WORKER);const a=await this.cdlAuthClient.getSkypeToken(n);return i?.mark(bh.aF.SKYPE_TOKEN_RECEIVED_WORKER),{userId:(0,fh.Op)(a.skypeToken,this._logger),...a.userDetails,skypeToken:a.skypeToken,regionGtms:a.regionGtms,expires:new Date(a.expiration)}},this._getRetryForSend=e=>{const{authzResource:t,disableRetryInDiscoverV2:n}=this._coreSettings.get(c.w.Auth);return i=>{const a=i.correlationId??(0,mh.DA)();if(!this._authenticationService.authorizeV2)throw(0,Jt.$5)({context:bh.JN,subContext:"_getRetryForSend",errorCode:"AuthorizeV2NotFound",message:"AuthorizeV2 endpoint not accessible",correlationId:a,isExpected:!1});const o=this._authenticationService.authorizeV2.bind(this._authenticationService),r=()=>(0,Sh.c)(o(e,t||yh.oF.MT_AAD_KEY,{userIdentifier:i.userIdentifier}),Og.nW.OK);return n?r():function(e,t,n){return i=>_h(e,i,t,n)}(r(),((e,t,n,i,a,o)=>({shouldRetry:Ih,errorHandler:async(i,a)=>{const o=(0,fh.Sl)(t),{serverResponse:{status:r,headers:s}={}}=i;if(!r||!a.retriesTable[r])throw i.reason={...i.reason,scenarioStep:"fail"},i.message=`dicoverRetryPolicy: retry count for ${r} is empty`,i;const l=s?.["correlation-id"],c=s?.["correlation-tags"];o?.appendEventData({authzCorrelationId:l,correlationTags:c}),a.headerUpdate=void 0,await Nh(i,a,n,t,e),e.error(`[DiscoverRetryPolicy]: retrying '[${a.retryCount}]' times due to response status - '[${r}], wait for '[${a.delay.next()}] for next retry..'`);const d=await a.forever();if(a.retryCount>=a.policy.maxRetryCount&&d)throw e.log(`[DiscoverRetryPolicy]: maxTimeReached count: ${a.retryCount} and tokenValid, cancel forever`),i.reason=["LoggedAlready"],i;return(0,kh.y)(a.delay.next())},retryMaxTimeMs:yh.uM.DEFAULT_SKYPE_MAX_RETRY_DURATION_MS,maxRetryCount:yh.uM.DEFAULT_SKYPE_MAX_RETRY_COUNT,createDelay:()=>new Ch.nC(yh.uM.DEFAULT_SKYPE_MIN_RETRY_INTERVAL_MS,yh.uM.DEFAULT_SKYPE_EXP_DELAY_FACTOR,yh.uM.DEFAULT_SKYPE_MAX_DELAY_TIME_MS),isOnline:i,retryMaxTimeCallback:a,foreverCheck:o}))(this._logger,this._scenarioFactory,this.unauthorizedErrorHandler,this._isAppOnline,this._retryMaxTimeCallback,this._isSkypeTokenValidInMemory),i.userIdentifier)}},this._isRefreshInBackgroundRequired=(e,t,n,i)=>{e?.shouldRefresh&&(n?.push("shouldrefreshbg"),this._debouncedGetDiscoverResponse((0,ge.hR)(t),{userIdentifier:t,correlationId:i,eventData:n}).catch((e=>{(0,fh.vV)(e,e?.message,n,this._logger)})))},this._populateDiscoverResponseFromBootstrapdata=()=>{this._bootstrapData=this._coreSettings.get(c.w.Host).authBootstrapData,this._bootstrapData},this._isAppOnline=()=>this._networkStateProvider.getState()===Pg.Q.Online,this.unauthorizedErrorHandler=async(e,t)=>{(0,fh.d2)(e,t,this._authenticationService,this._coreSettings,this._logger)},this._logger=t.newLogger(bh.JN,"core-services-discover"),(0,Rh.x)(this,"DiscoverV2",this._getConfig("mockApi"),this._getConfig("enableMockApi")),this.send=this._getRetryForSend(n),this._debouncedGetDiscoverResponse=(0,xh.A)(this._getDiscoverResponse);(0,sh.Fq)(v,(e=>i?.get(c.w.Auth,[e])?.[e])),this._populateDiscoverResponseFromBootstrapdata(),this._discoverProvider=this.resolveProvider(),this._authenticationService?.registerCleanUpOnLogoutCallback?.(A.p.Discover,this.clearDiscoveryCacheForLogout),this._tokenObserver=this._authenticationService.observeMiddleTierToken?.()?.subscribe((e=>{if(void 0===e)this._logger.log("MT token appears as undefined, deleting skype token for relevant user."),(0,fh.RU)(this._authenticationService,this._logger,[]).then((e=>{e&&sh.Vh.del((0,lh.Xr)(e).skypeToken)}));else if(""!==e){const e=this._firstMTTokenEstablished;this._firstMTTokenEstablished=!0,this._logger.log(`Get Skype token on new MT token forceRenew: ${e}.`),this.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:e,correlation:{id:(0,mh.DA)(),source:"discoverV2:constructor",scenarioName:be.Cu.GetSkypeToken}})}}));const{enableTokenRefreshOnOnline:y,enableTokenRefreshOnWakeUp:S}=this._coreSettings?.get(c.w.Auth);y&&(this._logger.log("Subscribing to Online state for Skype token."),this._onlineSubscription=Lh.tM.observeMachineOnline().subscribe((()=>{this._logger.log("Getting skype token on Online."),this.getSkypeTokenInfoFromDiscoveryResponse({correlation:{id:(0,mh.DA)(),source:"discoverV2:constructor",scenarioName:be.Cu.GetSkypeToken}})}))),S&&(this._logger.log("Subscribing to Suspended state for Skype token."),this._awakeSubscription=Lh.tM.observeMachineAwake().subscribe((()=>{this._logger.log("Getting skype token on Suspended."),this.getSkypeTokenInfoFromDiscoveryResponse({correlation:{id:(0,mh.DA)(),source:"discoverV2:constructor",scenarioName:be.Cu.GetSkypeToken}})}))),this._telemetryProvider=(0,Pt.AR)(),this._logger.log("[ctor]Service initialized.")}observeSkypeToken(){return this._skypeToken.pipe((0,di.p)((e=>null!==e)),(0,Tg.F)())}shouldThrowErrorIfSkypeTokenIsEmpty(){return!this._coreSettings.get(c.w.Auth).disableThrowingErrorIfSkypeTokenIsEmpty}getSettingToDisableSkypeTokenValidation(e,t){return(0,fh.uq)(e,t,this._coreSettings,this._logger,this._scenarioFactory)}shouldSkipTokenRefreshForAnon(){return!this._coreSettings.get(c.w.Auth).disableSkipTokenRefreshForAnon}async regionGtm(e,t){const n=(0,mh.DA)(),i=["^fn:regionGtm:uid:"+ +!!t];try{const a=await this.regionGtmTable(t,n,i),o=a?.[e];if(o)return o===bh.sb?o:(0,Bo.M4)(o);throw(0,Jt.$5)({correlationId:n,message:`${bh.JN}[regionGtm][${n}] ${e} not found in regionGtms table`,isExpected:!0,context:bh.JN,subContext:"regionGtm",errorCode:"RegionGtmNotFoundInRespone"})}catch(e){throw(0,fh.tl)(e,"regionGtm",n),(0,fh.vV)(e,e?.message,i,this._logger)}}async regionGtmTable(e,t=(0,mh.DA)(),n=[]){const i=e??await(0,fh.RU)(this._authenticationService,this._logger,n);let a=sh.Vh.getValue((0,lh.Xr)(i).regionGtm);if(!a){this._logger.log(`[regionGtm][${t}] No cached regionGtm, start network call..`),n.push("cache:0");const e=await this._debouncedGetDiscoverResponse((0,ge.hR)(i),{userIdentifier:i,correlationId:t,eventData:n});a=e?.regionGtms,n.push(`InResponse:${!!a}`)}return a}async skypeid(e,t){const n=["^fn:skypeid:uid:"+ +!!t];try{const n=await this.getUser(e,t);if(!n){const t=`[skypeid][${e.id}] No userDetail for getting skypeId`;throw this._logger.error(t),new Error(`${bh.JN} No user for getting skypeId`)}return n.id}catch(t){throw(0,fh.tl)(t,"skypeid",e.id),(0,fh.vV)(t,t?.message,n,this._logger)}}async validateSkypeToken(e){return(await this.validateSkypeTokenV2(e)).skypeToken}async validateSkypeTokenV2(e){const t=["^fn:validateSkypeToken:uid:"+ +!!e?.userIdentifier];try{const n=e?.userIdentifier??await(0,fh.RU)(this._authenticationService,this._logger,t),i=sh.Vh.get((0,lh.Xr)(n).skypeToken),a=i?.item;if(t.push(`cache:${!!a}`),a&&await(0,Mh.V)(a,this.globalScope,this._scenarioFactory,this._hostCommunicationService,this._coreSettings),n?.accountType===pg.aS.Anonymous&&a?.skypeToken&&!this._coreSettings.get(c.w.Auth).disableIgnoringForceRenewForAnon)return this._authStateProvider?.reportSkypeTokenState(dh.n.Success),{skypeToken:a.skypeToken,fromCache:!0};const o=e?.forceRenew,r=e?.invalidSkypeToken;if(!o&&a&&a.skypeToken&&a.skypeToken!==r&&a.expiration&&a.expiration>Date.now())return this._isRefreshInBackgroundRequired(i,n,t,e.correlation.id),this._skypeToken.value||this._skypeToken.next(a.skypeToken),this._authStateProvider?.reportSkypeTokenState(dh.n.Success),{skypeToken:a.skypeToken,fromCache:!0};this.clearDiscoveryCache(n,t,!0),this._logger.log(`[validateSkypeToken][${e.correlation.id}] Skype token not valid during ping of forceRenew:${o}, clear old cache and start wire request.`);const s=await this._debouncedGetDiscoverResponse((0,ge.hR)(n),{userIdentifier:n,correlationId:e.correlation.id,eventData:t,currentSkypeToken:a?.skypeToken});return this._logger.log(`[validateSkypeToken][${e.correlation.id}] SkypeToken fetched from network.`),t.push(`InResponse:${!!s.skypeToken}`),{skypeToken:s.skypeToken,fromCache:!1}}catch(n){throw(0,fh.tl)(n,"validateSkypeToken",e.correlation.id),(0,fh.vV)(n,n?.message,t,this._logger)}}async getRegion(e){const t=(0,mh.DA)(),n=["^fn:getRegion:uid:"+ +!!e];try{const i=e??await(0,fh.RU)(this._authenticationService,this._logger,n),a=sh.Vh.getValue((0,lh.Xr)(i).userDetail);if(a)return a.region;n.push("cache:0"),this._logger.log(`[getRegion][${t}] No user details found in cache. Getting it from request.`);const o=await this._debouncedGetDiscoverResponse((0,ge.hR)(i),{userIdentifier:i,correlationId:t,eventData:n});return n.push(`InResponse:${!!o.region}`),o.region}catch(e){throw(0,fh.tl)(e,"getRegion",t),(0,fh.vV)(e,e?.message,n,this._logger)}}async getUserRegionAndPartitionForMultiGeo(e,t){const n=["^fn:getUserRegionAndPartitionForMultiGeo:uid:"+ +!!e];try{const i=e??await(0,fh.RU)(this._authenticationService,this._logger,n),a=sh.Vh.getValue((0,lh.Xr)(i).userDetail);if(a)return{userRegion:a?.userRegion,partition:a?.partition,userPartition:a?.userPartition};n.push("cache:0"),this._logger.log(`[getUserRegionAndPartitionForMultiGeo][${t.id}] No user details found in cache. Getting it from request.`);const o=await this._debouncedGetDiscoverResponse((0,ge.hR)(i),{userIdentifier:i,eventData:n,correlation:{...t,scenarioName:be.Cu.GetSkypeToken}});return n.push(`InResponse|userRegion:${!!o.userRegion}|partition:${!!o.partition}|userPartition:${!!o.userPartition}`),{userRegion:o?.userRegion,partition:o?.partition,userPartition:o?.userPartition}}catch(e){throw(0,fh.tl)(e,"userRegionAndPartition",t.id),(0,fh.vV)(e,e?.message,n,this._logger)}}async getUser(e,t){const n=["^fn:getUser:uid:"+ +!!t];try{const i=t??await(0,fh.RU)(this._authenticationService,this._logger,n);let a=sh.Vh.getValue((0,lh.Xr)(i).userDetail);if(a||(this._logger.log(`[getUser][${e.id}]No cache, start network call...`),n.push("cache:0"),n.push(`IsCDL:${this.isCDLWorker&&this.cdlAuthClient}`),a=this.isCDLWorker&&this.cdlAuthClient?(await this.cdlAuthClient.getUserDetails())?.userDetails:(0,fh.BB)(n,this._bootstrapData,this._logger)||(await this.getSkypeTokenInfoFromDiscoveryResponse({silent:!1,correlationId:e.id,userIdentifier:t,eventData:n,correlation:{...e,scenarioName:be.Cu.GetSkypeToken}}))?.userDetails),!a)throw new Error(`${bh.JN}[getUser][${e.id}] UserDetails fetched failure from network request`);return(0,fh.JV)(a,this._logger)}catch(t){(0,fh.tl)(t,"getUser",e.id);const i=(0,fh.vV)(t,t?.message,n,this._logger);throw new wr.l(i)}}async getSkypeTokenInfoFromDiscoveryResponse(e){const{userIdentifier:t}=e||{},n=e?.eventData??[];n?.push("fn:getSkypeTokenInfoFromDiscoveryResponse");try{const i=t??await(0,fh.RU)(this._authenticationService,this._logger,n),a=e?.forceRenew,o=sh.Vh.get((0,lh.Xr)(i).skypeToken);if(i?.accountType===pg.aS.Anonymous&&o?.item?.skypeToken&&!this._coreSettings.get(c.w.Auth).disableIgnoringForceRenewForAnon)return this._authStateProvider?.reportSkypeTokenState(dh.n.Success),o.item;let r;if(o&&o.item&&!a)this._isRefreshInBackgroundRequired(o,i,n,e.correlation.id),r=o.item;else{n?.push("cache:"+ +!!o?.item,`forceRenew:${a}`),this._logger.log(`[getSkypeTokenInfoFromDiscoveryResponse][${e.correlation.id}] No response retrieved from cache.`),this.clearDiscoveryCache(i,n,!0);const t=await this._debouncedGetDiscoverResponse((0,ge.hR)(i),{...e,userIdentifier:i,eventData:n,currentSkypeToken:o?.item.skypeToken,correlation:{...e.correlation,scenarioName:be.Cu.GetSkypeToken}});r=(0,fh.WB)(t,this._logger)}return this._authStateProvider?.reportSkypeTokenState(dh.n.Success),r}catch(t){throw(0,fh.tl)(t,"getSkypeTokenInfoFromDiscoveryResponse",e.correlation.id),(0,fh.vV)(t,t?.message,n,this._logger)}}unsubscribeMtToken(){this._tokenObserver?.unsubscribe()}async getConsumerLicenseDetails(e,t){const n=["^fn:getConsumerLicenseDetails:uid:"+ +!!e];try{const i=e??await(0,fh.RU)(this._authenticationService,this._logger,n);if(!(i.accountType===pg.aS.MsaLife))return this._logger.log(`[getConsumerLicenseDetails][${t.id}] User account type is not MsaLife.`),Promise.resolve(void 0);const a=sh.Vh.getValue((0,lh.Xr)(i).userDetail),o=a?.licenseDetails?.consumerLicenseDetails;if(o)return o;n.push("cache:0"),this._logger.log(`[getConsumerLicenseDetails][${t.id}] No user license details found in cache. Getting it from request.`);const r=await this._debouncedGetDiscoverResponse((0,ge.hR)(i),{userIdentifier:i,correlationId:t.id,eventData:n,correlation:{...t,scenarioName:be.Cu.GetSkypeToken}});return n.push(`InResponse:${!!r?.consumerLicenseDetails}`),r?.consumerLicenseDetails}catch(e){throw(0,fh.tl)(e,"getConsumerLicenseDetails",t.id),(0,fh.vV)(e,e?.message,n,this._logger)}}_clearFromLocalStorage(e){this.globalScope?.localStorage&&(e?this._localStorageKeys.forEach((e=>{e.indexOf("auth.skype.token")>-1&&this.globalScope.localStorage.removeItem(e)})):this._localStorageKeys.forEach((e=>{this.globalScope.localStorage.removeItem(e)})),this._localStorageKeys=[])}resolveProvider(){return this._bootstrapData?this._acquireSkypeTokenDesktop:this.isCDLWorker?this._acquireSkypeTokenWorker:this._acquireSkypeTokenWeb}_getFromLocalStorage(e,t,n){if(!this.globalScope?.localStorage)return;let i=`ts.${t}-${e}.${n}`,a=this.globalScope.localStorage.getItem(i);if(a||(i=`ts.${e}.${n}`,a=this.globalScope.localStorage.getItem(i)),a){this._localStorageKeys.push(i);try{return JSON.parse(a)}catch(e){this._logger.error(`[_getFromLocalStorage] ${e}`)}}}_getConfig(e){return this._coreSettings.get(c.w.Auth,[e])[e]}}const jh=(e,t,n,i,a,o,r,s,l,d,u,m,p,g,h,v,y)=>{const{enableRequireDiscoverV2:S}=i.get(c.w.Auth);return S?new Oh(e,t,n,i,a,r,s,l,d,m,p,g,h,y,v):new vh.w2(e,t,n,i,a,o,u,m,p,g,h,v)};var Bh=n(24959),Uh=n(858108);const $h=new Set;var Wh=n(195695);class Vh extends xp{constructor(){super(d.c1.CreateAuthMTMA,["appStateService","loggerFactory","scenarioFactory","networkState","coreSettings","authenticationService","authenticationUser","telemetryService","i18n","deeplinkService","userBiService","hostCommunicationService","platformService","entityCommanding"])}async execute(e){const{appStateService:t,loggerFactory:n,scenarioFactory:i,networkState:a,coreSettings:o,authenticationService:r,authenticationUser:s,telemetryService:l,i18n:d,deeplinkService:u,userBiService:m,hostCommunicationService:p,platformService:h,entityCommanding:v}=e,{enableUserAuthT2:y}=o.get(c.w.Auth)||{};if(!y)return;(0,uh.d9)(s?.id,m);const S=Hh(s);try{if(!s)throw new Error("No AuthenticationUserContext found during User Auth init.");if(!r.createUserAuth)throw new Error("No User Auth Creation API exposed.");const m=new gh(n,o,s.id);e.authStateProvider=m,S.addEventData(["authState:created"]);const y=r.createUserAuth?.(s,"create-auth-mtma-task",m,u,((e,t)=>(n,i)=>{if(!n?.errorCode||$h.has(n.errorCode))return;$h.add(n.errorCode);const{autoBrbErrors:a,disableAutoBrbErrors:o}=t.get(c.w.Auth),{ring:r}=t.get(c.w.Metadata);if(o||!r||"ring0"!==r.id&&"ring1"!==r.id)return;const s=a?.find((e=>e&&n.message?.includes(e)));if(s){const t={feedbackSelectedCategory:Uh.J.AuthenticationOrSignIn,feedbackText:`${i}: ${s}`,includeHeapSnapshot:!0},n={visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:A.p.AutoBrb}};e.brbFeedback.autoBrbFlowDialog(n,t)}})(v,o));e.authenticationService=y,S.addEventData(["userAuth:created"]);const f=(0,Bh.sc)(t);let k;if(o.get(c.w.Telemetry).useTelemetryServicesCache){k=l.getTelemetryServicesCache().get(s.id);const e=sh.Vh.getValue((0,lh.Xr)({id:s.id}).telemetryInfo);S.setUserToTelemetryContext({id:s.id,oid:s.profile.objectId,tid:s.profile.tenantId,type:s.type,role:s.role,subType:s.subType,isCrossCloudUser:!!e?.isCrossCloudUser,isExternal:(0,ch.ge)(s.id,s.homeAccountId)})}const C=jh(y,n,ah.t,o,k?.coreScenarioFactory||i,f,a,p,d,m,void 0,void 0,void 0,void 0,void 0,void 0,{clientVersion:h.config.clientVersion,clientType:h.config.clientType});return e.discover=C,S.addEventData(["discover:created"]),C.validateSkypeToken({correlation:(0,Wh.$q)("create-auth-mtma-task:execute")}),o.get(c.w.Telemetry).useTelemetryServicesCache&&C.getRegion().then((e=>S.setUserDetailsToTelemetryContext({region:e||""}))),S.closeScenario(),zh(m,l,s.id),e=>{switch(e){case"quit":case"restart":break;default:C.cleanup?.(),m?.cleanupObservables()}}}catch(e){const t=e instanceof wr.l?e:new wr.l(e);throw S.closeScenario({error:t.prevError??e}),t}}}const Hh=e=>{const t={id:(0,mh.DA)(),scenarioName:be.Cu.AuthUserInit,source:"create-auth-mtma-task::execute"};return uh.$C.create({correlation:t,subContext:"createAuthMTMATask",timeoutMs:Qt.zB.ONE_HOUR,scenarioEventData:{context:`id:${!!e?.id}`,accountId:e?.id}})},zh=(e,t,n)=>{e.observe().subscribe((e=>{t.setContext("UserInfo.AuthState",e.state,void 0,n)}))},qh="auth-cache",Gh="key",Yh=async(e,t,n)=>new Promise((async(i,a)=>{try{const o=await Jh(e),r=Qh(o,"readwrite",i,a),s=((e,t)=>({[Gh]:t,value:e}))(t,n),l=r.put(s);l.onerror=e=>{o.close(),a(`[putToIDB] error: ${e}`)},l.onsuccess=()=>{o.close(),i()}}catch(e){a(`[putToIDB][catch] error: ${e}`)}})),Qh=(e,t,n,i)=>{Kh(e,i)||i("Transaction not valid");const a=e.transaction(qh,t);return a.onerror=t=>{e.close(),i(t)},a.oncomplete=()=>{e.close(),n()},a.onabort=t=>{e.close(),i(t)},a.objectStore(qh)},Jh=e=>new Promise(((t,n)=>{const i=e.open("Teams:auth",1);i.onsuccess=()=>{const e=i.result;t(e)},i.onerror=()=>{n(`IndexedDB error: ${i.error}`)},i.onblocked=()=>{n("IndexedDB error: BLOCKED")},i.onupgradeneeded=e=>{const t=i.result;if(!t.objectStoreNames.contains(qh)||e.oldVersion<1){const e=t.createObjectStore(qh,{keyPath:Gh});e&&!e.indexNames.contains("key")&&e.createIndex("key",Gh)}t.close()}})),Kh=(e,t)=>e?!!e.objectStoreNames.contains(qh)||(t(`objectStore does not exists: ${qh}`),!1):(t("You need to use the openDatabase function to create a database before you query it!"),!1);class Zh{constructor(e){this._indexedDbStorage=e.indexedDB}async put(e,t){await Yh(this._indexedDbStorage,t,e)}async getValue(e){return(async(e,t)=>new Promise((async(n,i)=>{try{const a=await Jh(e),o=Qh(a,"readonly",n,i).get(t);o.onerror=e=>{a.close(),i(`[IndexDB][getFromIDB] error: ${e}`)},o.onsuccess=e=>{a.close(),n(e?.target?.result?.value)}}catch(e){i(`[getFromIDB][catch] error: ${e}`)}})))(this._indexedDbStorage,e)}async del(e){await(async(e,t)=>new Promise((async(n,i)=>{try{const a=await Jh(e),o=Qh(a,"readwrite",n,i).delete(t);o.onsuccess=e=>{a.close(),n(e?.target)},o.onerror=e=>{a.close(),i(`Error in deleteRequest: ${e}`)}}catch(e){i(`[deleteFromIDB][catch] error: ${e}`)}})))(this._indexedDbStorage,e)}}var Xh=n(116618),ev=n(933678),tv=n(512445);const nv=(e,t,n)=>{const{environment:i}=n.get(c.w.Metadata,["environment"])??{},{clientType:a,currentUrl:o,hostingParent:r,isInIframe:s,isInCypressFrame:l,browser:d,browserVersion:u,osPlatform:m,osVersion:p,clientVersion:g}=t.config;return{...e,clientType:a,currentUrl:o,hostingParent:r,isInIframe:s,isInCypressFrame:l,browser:d,browserVersion:u,osPlatform:m,osVersion:p,environment:i,clientVersion:g}},iv=async e=>{e.initializeAuthenticationService&&await e.initializeAuthenticationService()},av=(e,t,n,i)=>{const a={id:(0,mh.DA)(),scenarioName:be.Cu.AuthStart,source:"core-auth-tasks::init"};return sh.Vh.put(lh.O4.authSessionId,a.id),uh.$C.create({correlation:a,subContext:"createAuthenticationServiceInstance",timeoutMs:Qt.zB.ONE_HOUR,scenarioEventData:{context:`env:${e}||host:${t}||v2:${+!!n}||global:${+!!i}`}})},ov=async(e,t,n)=>{e.registerCleanUpOnLogoutCallback?.("BatchAuthTelemetry",(e=>(0,Wh.xz)(t,n,(0,ch.X_)(e))))};class rv extends xp{constructor(){super(d.c1.CreateAuth,[])}async execute(e){e.authenticationService=await(async e=>{const{loggerFactory:t,scenarioFactory:i,config:a,appStateService:o,coreSettings:r,windowProvider:s,platformService:l,authStateProvider:d,hostCommunicationService:u,telemetryService:m,i18n:p,rebootService:g,userBiService:h,endpointsManager:v,crossTabsService:y,networkState:S,hostState:f}=e,k=(0,sh.Fq)(s,(e=>r?.get(c.w.Auth,[e])?.[e])),C=new Zh(s),b=(0,Xh.$)(C);(0,uh.FS)(i,b,m),S&&(0,Lh.T4)(f,S),(0,uh.d9)(void 0,h);const w=(0,tv.ll)(t,y),T=nv(a,l,r),I=(0,Bh.sc)(o),{enableAuthV2:N,enableUserAuthT2:A,deleteBatchScenarioFromStorage:E,enableAsyncBatchScenario:F}=r?.get(c.w.Auth,["enableAuthV2","enableUserAuthT2","deleteBatchScenarioFromStorage","enableAsyncBatchScenario"])||{},_=av(T.environment??"",s?.location?.hostname,!!N,!!A);let D;try{D=N?A?new((await(0,ev.wg)((()=>Promise.all([n.e(395394),n.e(468862),n.e(838201)]).then(n.bind(n,537238))),"global-auth",i)).GlobalAuthService)(t,i,T,s,u,w,p,r,g,v):new((await(0,ev.wg)((()=>Promise.all([n.e(395394),n.e(468862),n.e(44368)]).then(n.bind(n,513883))),"auth_v2",i)).AuthenticationService)(t,i,T,s,u,w,p,d,r):new((await(0,ev.wg)((()=>Promise.all([n.e(787336),n.e(157933)]).then(n.bind(n,349234))),"auth",i)).AuthenticationService)(t,i,I,T,s,m,r),await iv(D),F&&await ov(D,i,b),E&&(0,Wh.SM)(k),_.closeScenario()}catch(e){const t=e instanceof wr.l?e:new wr.l(e);throw _.closeScenario({error:t.prevError??e}),t}return D})(e)}}var sv=n(662365),lv=n(994915);const cv=(e,t,n,i)=>{if(i?.get(c.w.Auth)?.enableMtoCoachMark){const i=t?.some((e=>"DefaultHidden"===e?.userTenantState&&"MTO"===e?.tenantRelationship));i&&e?.recordAuthUserBiTelemetry(n,{scenario:sv.Yq.authMtoUser})}const a=t?.some((e=>"MTO"===e?.tenantRelationship));a&&e?.recordAuthUserBiTelemetry(n,{scenario:sv.Yq.authHasMtoTenant})},dv=(e,t)=>uh.$C.create({correlation:e,subContext:"createAuthTenantsTask",timeoutMs:Qt.zB.ONE_HOUR,scenarioEventData:{accountId:t?.id}});class uv extends xp{constructor(){super(d.c1.CreateAuthTenants,[])}async execute(e){const t=e;await(async e=>{const{coreSettings:t,authenticationUser:n,endpointsManager:i,authenticationService:a}=e,{enableUserAuthT2:o,enableMultiTenants:r}=t.get(c.w.Auth)||{};if(!n)throw new Error("No AuthenticationUserContext found during OnUserAuthenticated_MTMA hook");const{testAutomation:s}=t.get(c.w.Test)||{};if(!o||!r||!(0,lv.O8)(n))return;const l={id:(0,mh.DA)(),scenarioName:be.Cu.AuthWebSetUpTenants,source:"create-auth-tenants-task::setupTenantService"},d=dv(l,n);try{if(!a.setUpTenantsService||!a.getTenants)throw new Error("No TenantsService Set Up found duringGetTenants Task");const e={accountId:n.id,correlation:d.correlation,forceRefresh:!s};try{await a.setUpTenantsService(i,e)}catch(e){return void d.closeScenario({error:e})}d.addEventData(["tenantService:created"]),a.getTenants(e).then((e=>{d.appendScenarioEventData({tenantCount:e?.length}),cv(d,e,n.id,t),d.closeScenario()})).catch((e=>{d.closeScenario({error:e})}))}catch(e){const t=e instanceof wr.l?e:new wr.l(e);throw d.closeScenario({error:t.prevError??e}),t}})(t);const{enableTenantPolling:n}=t.coreSettings.get(c.w.Auth);if(!n)return;const i=await(async e=>{const{coreSettings:t,authenticationService:n,windowProvider:i,authenticationUser:a,correlation:o}=e;if(!a)throw new Error("No AuthenticationUserContext found during OnUserAuthenticated_MTMA hook");if(a.homeAccountId!==a.id||!(0,lv.O8)(a))return;const r=t.get(c.w.Auth)?.tenantPollingMiliseconds||Qt.zB.ONE_DAY,s=i.setInterval((async()=>{const e={id:o.id,scenarioName:be.Cu.AuthWebGetTenantsInterval,source:"create-auth-tenants-task::tenantPollingInterval"},r=dv(e,a);try{const i={accountId:a.id,forceRefresh:!0,correlation:e};if(!n.getTenants)throw new Error("No valid getTenants function inside tenant polling interval");const o=await n.getTenants(i);cv(r,o,a.id,t),r.addEventData(["tenantService:AuthWebTenantPolling"]),r.appendScenarioEventData({tenantCount:o?.length}),r.closeScenario()}catch(e){r.closeScenario({error:e}),i.clearInterval(s)}}),r);return Promise.resolve(s)})(t);return e=>{i&&"signout"===e&&t.windowProvider.clearInterval(i)}}}var mv=n(957234),pv=n(455051);function gv(e){const t=e.get(c.w.Host),n=t?.userType??"";return"user"===n||""===n?"False":"True"}var hv=n(728887);class vv{constructor(e,t,n){this.aad=e,this.discover=t,this.coreSettings=n,this.cmdMTAuthResource=e=>this._cmdMtAuthorize(e),this.mtAuthResource=e=>{const{requireSkypetokenForMT:t}=this.coreSettings.get(c.w.Auth);return this._mtAuthorize(e,t||!1)},this.skypeAuthResource=async e=>this._authorizeWithSkypeTokenMigration(e),this.skypeAuthorizeAuthResource=e=>this._authorizeWithSkypeTokenMigration(e,"Authorization"),this.skypeXTokenAuthResource=e=>this._authorizeWithSkypeTokenMigration(e,"x-skypetoken"),this.mtAuthWithSkypeXTokenResource=e=>this._mtAuthorize(e,!0),this.authorizeByUrl=(e,t)=>{const n=new URL(e.url),i=t?"/":"",a=`${n.protocol}//${n.host}${i}`;return this.aad.authorizeRequest(e,a)},this._migrateSkypeToken=(e,t,n)=>{e.headers&&(e.headers[Qt.OF]="True",e.headers[Qt.wk]=gv(this.coreSettings));const{ic3NonCaeResource:i,ic3CaeResource:a}=this.coreSettings.get(c.w.Auth),o=t===pv.Wx.CAE?a??Qt.oF.IC3_GATEWAY_CAE_KEY:i??Qt.oF.IC3_GATEWAY_AAD_KEY,r=this._composeAuthResourcesForStm((e=>this.aad.authorizeRequest(e,o)),n);return r(e)},this._cmdMtAuthorize=e=>this.aad.getUser().then((()=>{const{cmdMeetingArtifactsServiceResource:t}=this.coreSettings.get(c.w.CMDMeetingArtifactsService);return(e=>this.aad.authorizeRequest(e,t??""))(e)})),this._mtAuthorize=(e,t)=>this.aad.getUser().then((n=>{const{enableSkypeTokenMigrationForMT:i}=this.coreSettings.get(c.w.Auth);if(i&&t){const{stmHeader:i,overwrittenRequireSkypetokenForMT:a}=this._getStmInfoForSources(e,n?.type);t=a,e.headers={...e.headers,...i}}const a=(0,fh.Se)(this.coreSettings,this._useAadV2Token),o=e=>this.aad.authorizeRequest(e,a);return(t?this.composeAuthResources(o,this.skypeXTokenAuthResource):o)(e)})),this._getStmInfoForSources=(e,t)=>{const{stmSourceList:n=[],disableSTMForAnonymousUser:i}=this.coreSettings.get(c.w.Auth),a=e.authOptions||{},o={stmHeader:{},overwrittenRequireSkypetokenForMT:!0};if(i&&t===pg.aS.Anonymous)return o;const r=n?.find((e=>e?.source===a?.source));return r?(o.stmHeader={[Qt.OF]:"True",[Qt.wk]:gv(this.coreSettings)},r?.disableSkypeTokenInHeader&&(o.overwrittenRequireSkypetokenForMT=!1),o):o},this.skype=new mv.j(this.discover);const{enableAadV2TokenForMiddleTier:i}=n.get(c.w.Auth);this._useAadV2Token=!!i}composeAuthResources(e,t){return async n=>e(n).then((e=>t(e.request).then((t=>({request:t.request,resolver:async(n,i)=>{const a=await t.resolver(n,i);return await e.resolver(n,a||i)}})))))}_authorizeWithSkypeTokenMigration(e,t){const{skypeTokenMigrationEnabled:n}=this.coreSettings.get(c.w.Auth);return n?this.aad.getUser().then((n=>{const i=e.authOptions||{};let a=i?.source?(0,hv.xy)(i?.source,this.coreSettings,void 0,n):pv.Wx.Skype;const{disableSTMFallback:o,enableSTMSkypeCAECheck:r}=this.coreSettings.get(c.w.Auth),{skypeTokenFallbackMap:s}=this.aad;if(!o&&i?.source&&s){const e=(0,hv.iq)(s,i?.source,this.coreSettings);void 0!==e&&(a=(0,hv.qi)([e],a,void 0,!!r))}return i?.source&&a!==pv.Wx.Skype?this._migrateSkypeToken(e,a,t):this.skype.authorizeRequest(e,t)})).catch((()=>{const{disableSTMFallback:n}=this.coreSettings.get(c.w.Auth);if(n)throw(0,Jt.$5)({context:"authentication-resources",subContext:"disableSTMFallback",errorCode:Qt.tG.InvalidToken,message:"disableSTMFallback: true, STM fallback logic blocked",correlationId:"",isExpected:!0});return this.skype.authorizeRequest(e,t)})):this.skype.authorizeRequest(e,t)}_composeAuthResourcesForStm(e,t){return async n=>e(n).then((e=>({request:e.request,resolver:async(n,i)=>{try{return await e.resolver(n,i)}catch(e){if(e?.errorCode===Qt.tG.FallbackWithSkypeToken){i?.headers&&delete i.headers.Authorization;return(await this.skype.authorizeRequest(i,t)).request}throw e}}})))}}class yv extends xp{constructor(){super(d.c1.CreateAuthenticationResources,["authenticationService","discover","coreSettings"])}async execute(e){e.authenticationResources=new vv(e.authenticationService,e.discover,e.coreSettings)}}class Sv extends xp{constructor(){super(d.c1.CreateAuthStateTask,["loggerFactory","coreSettings","telemetryService"]),this._updateTelemetryOnClientStateChange=(e,t)=>{e.observe().subscribe((e=>{t.setCoreContext("AppInfo.AuthState",e)}))}}async execute(e){const{loggerFactory:t,coreSettings:n,telemetryService:i}=e,{enableAuthState:a,enableUserAuthT2:o}=n.get(c.w.Auth);if(!a||o)return;const r=new gh(t,n);e.authStateProvider=r,this._updateTelemetryOnClientStateChange(r,i)}}class fv extends xp{constructor(){super(d.c1.CreateCacheClearing,["clientState","windowProvider"]),this._clearCacheOnClientStateChangeToInactive=(e,t)=>{e.observe().subscribe((async e=>{e===Ba.Lg.Inactive&&(await(this.dataEvictionService?.evict()),t.clearCache())}))}}async execute(e){const{clientState:t,windowProvider:n,dataEvictionService:i}=e;this.dataEvictionService=i,this._clearCacheOnClientStateChangeToInactive(t,n)}}class kv{constructor(e,t,n,i){this._caches=e,this._tenantId=t,this._userId=n,this._experienceName=i}setUserAndTenantIds(e,t){this._tenantId=e,this._userId=t}createRequest(e,t,n,i,a=!1,o=this._experienceName){const r=this._getFormatKey(t,o,n,a);return{cacheName:e,request:new Request(r,i)}}async add({cacheName:e,request:t}){return(await this._caches.open(e)).add(t)}async addAll(e){const{cacheName:t}=e[0],n=e.map((({request:e})=>e));return(await this._caches.open(t)).addAll(n)}async delete({request:e,cacheName:t},n){return(await this._caches.open(t)).delete(e,n)}async keys(e,t,n){return(await this._caches.open(e)).keys(t,n)}async match({request:e,cacheName:t},n){return(await this._caches.open(t)).match(e,n)}async matchAll({request:e,cacheName:t},n){return(await this._caches.open(t)).matchAll(e,n)}async put({request:e,cacheName:t},n){return(await this._caches.open(t)).put(e,n)}async clear(e){return this._caches.delete(e)}_getFormatKey(e,t,n,i){try{return new URL(e),e}catch{let a="";switch(n){case"Experience":a=`${t}/${e}`;break;case"User":if(!this._tenantId||!this._userId)throw new Error("tenantId and userId must be defined for storage scope User.");a=`${this._tenantId}/${this._userId}/${e}`;break;case"Global":a=e;break;case"UserAndExperience":if(!this._tenantId||!this._userId)throw new Error("tenantId and userId must be defined for storage scope UserAndExperience.");a=`${this._tenantId}/${this._userId}/${this._experienceName}/${e}`;break;default:return`/${e}`}return i?`//${a}`:a}}}class Cv{constructor(e,t){this._cacheStorage=e,this._cacheName="offline-cache-manager",this._logger=t.newLogger("OfflineCacheManager","services-io-browser-cache-storage")}setUserAndTenantIds(e,t){this._cacheStorage.setUserAndTenantIds(e,t)}async save(e,t,n,i=!0){if(!e)throw this._error("get","Invalid key");try{this._logger.log(`saving item to offline cache: ${e}`);const a=this._getScopedRequest(e,n,i);return await this._cacheStorage.put(a,t),a.request.url}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name}, message${e.message}`),this._error("save","Failed to save object to cache")}}async saveDynamic(e,t,n=!0){const i=(0,E.v4)();return[i,await this.save(i,e,t,n)]}async get(e,t,n,i=!0){if(!e)throw this._error("get","Invalid key");try{const n=this._getScopedRequest(e,t,i),a=await this._cacheStorage.match(n);if(!a)throw this._error("get","Object not found");return a}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name}, message${e.message}`),this._error("get","Failed to get item from cache")}}async getAll(e,t,n){try{return await this._cacheStorage.keys(this._cacheName,e?this._getScopedRequest(e,t).request:void 0,n)}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name} code:${e.code}`),this._error("getAll","Failed to get keys from cache")}}async delete(e,t){if(!e)throw this._error("get","Invalid key");this._logger.log(`deleting item from offline cache: ${e}`);const n=this._getScopedRequest(e,t);return this._cacheStorage.delete(n)}async clear(){return this._logger.log("clearing offline cache"),this._cacheStorage.clear(this._cacheName)}getCachedUrlByKey(e,t){return this._getScopedRequest(e,t).request.url}_error(e,t){const n=(0,Je.$5)("OfflineCacheManager",d.O4.Undefined,e,void 0,t);return this._logger.error(n.message),n}_getScopedRequest(e,t,n=!0){return this._cacheStorage.createRequest(this._cacheName,`${this._cacheName}/${e}`,"UserAndExperience",t,n)}}class bv extends xp{constructor(){super(d.c1.CreateCacheStorageAndCacheManagers,[])}async execute(e){const{authenticationUser:t,windowProvider:n,config:i,loggerFactory:a}=e;t&&(e.cacheStorage=new kv(n.caches,t.profile.tenantId,t.profile.objectId,i.experienceName)),e.cacheStorage&&(e.offlineCacheManager=new Cv(e.cacheStorage,a))}}var wv=n(338856),Tv=n(164657);class Iv{constructor(e){this.context=e,this._appServiceStateMap=this._newAppServiceStateMap(),this._logger=e.loggerFactory.newLogger("CDLApplicationStateService","core-services-app-state")}notifyServiceUp(e,t,n){this.notifyAppServiceStateChange(e,t,Tv.U.ONLINE,n)}notifyServiceDown(e,t,n,i){this.notifyAppServiceStateChange(e,t,Tv.U.OFFLINE,n,i)}observeAppServiceState(){const e=Array.from(Object.values(this._appServiceStateMap)).map((e=>e.asObservable().pipe((0,s.w)("currentState"))));return(0,wv.h)(...e)}_newAppServiceStateMap(){return Object.values(Tv.z).reduce(((e,t)=>{var n;return e[t]=(n=t,new ya.t({appService:n,currentState:Tv.U.UNKNOWN})),e}),{})}notifyAppServiceStateChange(e,t,n,i,a){if(!!this.context.coreSettings.get(c.w.CdlWorker).enableUserContextWorkerRegistration&&this.context.cdlWorkerRegistrarService?.mainWindowWorkerId!==e.workerId)return void this._logger.infoToTelemetry?.(`Filtered out appService state changed from worker (originating worker = ${e.workerId}, main window worker id = ${this.context.cdlWorkerRegistrarService.mainWindowWorkerId})`,"cdl_app_state_notification_filtered_out",{origin:e.workerId,target:this.context.cdlWorkerRegistrarService.mainWindowWorkerId,context:t},!0);const o=this._appServiceStateMap[t],r={appService:t,previousState:o.getValue().currentState,currentState:n,currentStateChangeTimestamp:new Date,currentStateChangeReason:i,currentStateChangeCode:a};this._logger.infoToTelemetry?.(`Received appService state change for ${t} (current state = ${r.currentState}, previous state = ${r.previousState}) from worker '${e.workerId}'`,"cdl_app_state_change_notification",{origin:e.workerId,target:this.context.cdlWorkerRegistrarService.mainWindowWorkerId,context:t},!0),o.next(r)}}class Nv{constructor(e){this.logger=e}log(e,t){return e?this.safeWrapILoggerCall(((e,t)=>this.logger.log(e,t)),e,t):Bi.Y.None}warn(e,t){return e?this.safeWrapILoggerCall(((e,t)=>this.logger.warn(e,t)),e,t):Bi.Y.None}debug(e,t){return this.safeWrapILoggerCall(((e,t)=>this.logger.debug(e,t)),e,t)}error(e,t,n){return e&&n?this.safeWrapILoggerCall(((e,t)=>this.logger.error(e,t)),e,t,n):Bi.Y.None}errorToTelemetry(e,t,n,i){return this.logger.errorToTelemetry?this.logger.errorToTelemetry(e,t,n,i):this.logger.error(e)}warnToTelemetry(e,t,n,i){return this.logger.warnToTelemetry?this.logger.warnToTelemetry(e,t,n,i):this.logger.warn(e)}debugToTelemetry(e,t,n,i){return this.logger.debugToTelemetry?this.logger.debugToTelemetry(e,t,n,i):this.logger.debug(e)}infoToTelemetry(e,t,n,i){return this.logger.infoToTelemetry?this.logger.infoToTelemetry(e,t,n,i):this.logger.log(e)}safeWrapILoggerCall(e,t,n,i){return function(e){return(0,we.isObject)(e)&&"hostRendererId"in e&&"component"in e}(n)?e(this.serializeMessageFromParams(t,n,i),{loggerName:n.component}):e(t,{loggerName:"CDLNoLoggingContext"})}serializeMessageFromParams(e,t,n){const i={...n?{errorCode:n}:{},...t?{requestId:t.requestId,component:t.component,requestRendererId:t.requestRendererId,requestWindowId:t.requestWindowId,operationType:t.operationType,operationName:t.operationName,requestType:t.requestType,timeOfRequest:t.timeOfRequest,correlationId:t.correlationId,callerInfo:t.callerInfo,callerScenarioId:t.callerScenarioId}:{},message:e,...t};return JSON.stringify(i,void 0,"").replace(/\\|"/g,"")}}var Av=n(781108),Ev=n.n(Av);class Fv{constructor(e,t){this.logger=e,this.loggingContext=t,this.isCompleted=!1,this.subscriptions=new Set,this.observable$=new(Ev())((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.isCompleted&&this.logger.error("Subject - tried to subscribe to a complete observable",this.loggingContext,d.O4.NotPresent),this.observable$.subscribe(e)}onNext(e){this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.isCompleted=!0,this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.isCompleted=!0,this.subscriptions.forEach((t=>{t.error(e)}))}}const _v=(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h=!1,v,y)=>{let S={};if(e&&(S={experienceName:e}),t&&(S={...S,ring:t}),n&&(S={...S,environment:n}),i&&(S={...S,sessionId:i}),a&&(S={...S,platformId:a}),o&&(S={...S,buildVersion:o}),r&&(S={...S,localeCode:r}),s&&(S={...S,workerId:s}),l&&(S={...S,preAuthUserId:l}),u&&(S={...S,publicPath:u}),p&&(S={...S,isOcdi:p}),g&&(S={...S,isPwa:g}),void 0!==d?S={...S,userConsoleLogLevel:d}:void 0!==c&&(S={...S,preECSConsoleLogLevel:c}),m&&(S={...S,deviceId:m}),h){const e=new Date(Date.now());S={...S,date:`${e.getMonth()}-${e.getDate()}`}}return v&&(S={...S,telemetryWorkerBroadcast:v}),y&&(S={...S,useDiagnosticsServiceV2:y}),JSON.stringify(S)};let Dv;const Pv=(e,t,n,i,a,o,r)=>class{constructor(s){const l=i?`${s}#${i}`:s,c=typeof e==typeof Worker?"cdlWorker":"cdlsharedWorker";Mv(t,l,!1,c,n),a?.(l);const d=((e,t,n)=>{if(Dv)return Dv;try{const e=n||"@msteams/core-cdl-worker-common#create-cdl-worker";return Dv=window.trustedTypes?.createPolicy(e,{createScriptURL:e=>Rv(e,t)}),Dv}catch(n){t.errorToTelemetry?.(`Create CDL worker URL trustedType policy failed. This is not a critical error, falling back to function validation. Error ${n}`,"cdl_worker_startup_error_trusted_policy",{endpointUrl:e},!0)}})(l,t,o);if(d){const t=d.createScriptURL(l);return r?.(Date.now()),new e(t)}const u=Rv(l,t);return r?.(Date.now()),new e(u)}},Mv=(e,t,n,i,a)=>{e.log(`{"hostRendererId":${i},"component":${a} Creating CDL Worker with ${n?"passed":"determined"} url ${t} }`)};function Rv(e,t){try{const t=new URL(e,xv().location.origin);let n=!0,i="CDL Web worker URL is invalid.";if(t.origin!==xv().location.origin&&(i=i.concat("OriginValidationFailed"),n=!1),n)return e;throw new Error(i)}catch(n){t.errorToTelemetry?.("CDL web worker url is not valid","cdl_worker_startup_error_invalid_url",{endpointUrl:e},!0);const i=new Error(n.message);throw i.name="InvalidUrl",i}}function xv(){return window}class Lv{constructor(e){this._state=null,this._checkpoints=new Set,this._context={bootstrapServices:e.bootstrapServices,loggingContext:{hostRendererId:e.loggingContext.hostRendererId,component:"CDLGlobalState"}},this.subject=new Fv(e.bootstrapServices.logger,this._context.loggingContext)}get current(){return this._state}setState(e,t){if(!e)throw new TypeError("state should have name specified");this.hasReachedCheckpoint(e)||(this._context.bootstrapServices.logger.log(`Global state has reached checkpoint ${e}`,this._context.loggingContext),this._checkpoints.add(e),this._state=e,this.subject.onNext({newState:e,args:t}))}subscribe(e){return this.subject.subscribe(e)}hasReachedCheckpoint(e){if(!e)throw new TypeError("state should have name specified");return this._checkpoints.has(e)}}var Ov=n(309906),jv=n(651519);class Bv{constructor(e,t,n,i){this._context=i,this._clients=new Map,t.forEach(((t,a)=>{const o=new t((t=>e(t)),n,i,a);this._clients.set(a,o)})),i.bootstrapServices.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Success",stepName:"ClientResponseRouterCreated"})}get cdlControlClient(){return this._clients.get(Ov.X.control)}get cdlDiagnosticsClient(){return this._clients.get(Ov.X.diagnostics)}get cdlAuthClient(){return this._clients.get(Ov.X.auth)}get cdlAppServiceClient(){return this._clients.get(Ov.X.appService)}get cdlAppStateClient(){return this._clients.get(Ov.X.appState)}get cdlDatabaseClient(){return this._clients.get(Ov.X.database)}get cdlSyncEngineClient(){return this._clients.get(Ov.X.syncEngine)}get cdlGraphQLClient(){return this._clients.get(Ov.X.graphql)}get cdlNetworkStateClient(){return this._clients.get(Ov.X.networkState)}get cdlEndpointsHealthClient(){return this._clients.get(Ov.X.endpointHealth)}get telemetryClient(){return this._clients.get(Ov.X.telemetry)}handleResponse(e){const t=this._clients.get(e.type);if(!t)throw this._context.bootstrapServices.logger.errorToTelemetry?.(`no client is configured for response type ${e.type}`,"cdl_client_no_client_configured_error",{...(0,jv.w)(this._context.loggingContext),queryId:e.requestId,windowId:e.windowId,origin:"CDLClientResponseRouter",errorCode:d.O4.Unknown},!0),new TypeError(`no client is configured for response type ${e.type}`);return t.handleResponse(e)}cleanup(){this._clients.forEach((e=>{Object.keys(e).forEach((t=>e[t]=void 0))})),Object.keys(this).forEach((e=>this[e]=void 0))}}class Uv{constructor(e,t,n,i){this._bootstrapServices=e,this._stateAndRequestHandlers=i,this._globalState=n,this._context={component:"CDLServer",hostRendererId:t},this._bootstrapServices.logger.log("Booted up server",this._context),this._bootstrapServices.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Success",stepName:"CDLServerCreated"})}handleRequest(e,t,n){const i=performance.now(),a=this._stateAndRequestHandlers.get(e.type);return a?a.stateMachine.isCompleted().then((o=>{const r=performance.now(),s={requestStartTime:i,stateMachineTime:r-i};return this._handleMessage(e,t,a.requestHandler,s,n,o).catch((t=>{!!(0,Je.WZ)(t)||this._bootstrapServices.logger.errorToTelemetry?.(`Failed to process request due to error ${(0,Je.Nw)(t)}`,"cdl_server",{...(0,jv.w)(this._context),origin:e.requestId,correlationId:e.rendererId,conversationId:e.windowId,type:e.type},!0)}))})).catch((n=>this._returnCriticalError(e,t,`State machine init failed for request of type ${e.type} with error ${(0,Je.Nw)(n)}`,n))):this._returnCriticalError(e,t,`StateMachine and requestHandler not defined for request of type ${e.type}`)}start(){this._globalState.setState("Server_Start")}cleanup(){this._stateAndRequestHandlers.forEach((e=>{Object.keys(e).forEach((t=>e[t]=void 0))})),Object.keys(this).forEach((e=>this[e]=void 0))}_handleMessage(e,t,n,i,a,o){const r=this._decorateResponseCallback(e,t,i);return n.handle(e,r,{bootstrapServices:this._bootstrapServices,loggingContext:{hostRendererId:this._context.hostRendererId,requestId:e.requestId,requestRendererId:e.rendererId,requestWindowId:e.windowId,requestType:e.type},portId:a},o)}_decorateResponseCallback(e,t,n){return i=>{const a=performance.now()-n.requestStartTime,o=a-n.stateMachineTime;if(n={...n,handlerResponseTime:o},"graphql"===e.type){const n=i.response;n.extensions={...n.extensions},n.extensions.perfStats={...n.extensions.perfStats,workerResponseTime:a,dataStorePerfStats:[]},t({requestId:e.requestId,rendererId:e.rendererId,windowId:e.windowId,type:e.type,extensions:n.extensions,...i})}else t({requestId:e.requestId,rendererId:e.rendererId,windowId:e.windowId,type:e.type,...i,...n,extensions:{},workerResponseTime:a})}}_returnCriticalError(e,t,n,i){return Promise.reject(t({windowId:e.windowId,requestId:e.requestId,type:e.type,response:{errors:n,errorCode:i?.errorCode||i?.code,error:i},status:"failure",rendererId:e.rendererId,extensions:{},workerResponseTime:-1}))}}function $v(e,t,n,i){e.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"InProgress",stepName:"CDLPeerCreated"});const a=new Bv((e=>t.postMessageCallback(JSON.stringify(e))),t.clients,{rendererId:i},{bootstrapServices:e,loggingContext:{hostRendererId:i}}),o=new Uv(e,i,n.globalState,n.requestAndStateHandlers);return e.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Success",stepName:"CDLPeerCreated"}),{workerServer:o,workerClientResponseRouter:a,onMessageCallback:(t,n,r,s)=>{const l=Date.now();let c;var d;if(t.data&&"string"==typeof t.data?c=JSON.parse(t.data):(d=t).ports&&d.ports.length>0&&d.ports[0]instanceof MessagePort&&(c=t.data,c.response={requestMessageChannelPort:t.ports[0]}),c&&s&&(c.applicationId=s.applicationId,c.connectionId=s.connectionId),c&&c.rendererId===i){const e=c.response?.extensions?.perfStats;e&&(e.payloadLength=t.data.length),a.handleResponse(c)}else c&&c.status?e.logger.errorToTelemetry?.(`Received response with rendererId mismatch ${JSON.stringify(t)}`,"cdl_peer_creation",{origin:"CDLPeer",correlationId:i},!0):c?o.handleRequest(c,(e=>(e=>{const t=Date.now();if("graphql"===e.type){const n=e.response;n.extensions?.perfStats&&(n.extensions.perfStats.requestReceivedTime=l,n.extensions.perfStats.responseSendTime=t),e.extensions.perfStats&&(e.extensions.perfStats.requestReceivedTime=l,e.extensions.perfStats.responseSendTime=t)}else e.requestReceivedTime=l,e.responseSendTime=t;"control"===e.type&&e.response&&e.response instanceof MessagePort?n(e):n(JSON.stringify(e))})(e)),r):e.logger.errorToTelemetry?.(`Unknown message received that doesn't conform to CDL format ${JSON.stringify(t)}`,"cdl_peer_creation",{origin:"CDLPeer",correlationId:i},!0)}}}var Wv=n(875991);class Vv{constructor(){this.isSubscriptionRequest=e=>e instanceof Fv,this._rendererRequestMap=new Map}addRequest(e,t){if(!e.rendererId)throw new TypeError("No rendererId in request");if(!e.requestId)throw new TypeError("No requestId in request");const n=this.getRequestRegistrationKey(e);let i=this._rendererRequestMap.get(n);if(i||(i=new Map,this._rendererRequestMap.set(n,i)),i.has(e.requestId))throw new Error(`Request ${e.requestId} for renderer ${n} already exists, something is off here`);if(t&&this.isSubscriptionRequest(t))return i.set(e.requestId,{resolution:t,request:e}),Promise.resolve(void 0);const a=(0,Wv.v)();return i.set(e.requestId,{resolution:a,request:e}),a.promise}reconcileResponse(e){if(!e.rendererId)throw new TypeError("No rendererId in response");if(!e.requestId)throw new TypeError("No requestId in response");const t=this.getRequestRegistrationKey(e);if(!this._rendererRequestMap.has(t))throw new Error(`Response ${t} is not found in map`);const n=this._rendererRequestMap.get(t);if(!n)throw new Error(`Request map for renderer/window ${t} does not exist`);const i=n.get(e.requestId);if(!i)throw new Error(`Request ${e.requestId} for renderer/window ${t} does not exist`);"success"===e.status?this.handleSuccessResponse(e,i):this.handleErrorResponse(e,i),this.isSubscriptionRequest(i.resolution)&&"failure"!==e.status||n.delete(e.requestId),0===n.size&&this._rendererRequestMap.delete(t)}handleSuccessResponse(e,t){this.isSubscriptionRequest(t.resolution)?t.resolution.onNext(e):t.resolution.resolve(e)}handleErrorResponse(e,t){this.isSubscriptionRequest(t.resolution)?t.resolution.onError(e):t.resolution.reject(e)}getRequestRegistrationKey(e){return`${e.rendererId}${e.windowId?`_${e.windowId}`:""}`}}class Hv{constructor(e){this.requestType=e,this.counter=0}toString(){return`${this.getOperationPrefix(this.currentCounterRequestType)||this.requestType}-${this.counter}`}next(e){return this.safeIncrementCounter(),this.currentCounterRequestType=e,this.toString()}getOperationPrefix(e){switch(e){case"mutation":return"m";case"subscription":return"s";case"query":return"q";default:return e}}safeIncrementCounter(){return this.counter===Hv.MAX_COUNTER_VALUE&&(this.counter=0),this.counter++}}Hv.MAX_COUNTER_VALUE=Number.MAX_SAFE_INTEGER;class zv{constructor(e,{rendererId:t,windowId:n},i,a){this._context=i,this._loggingContext={component:"CDLClient",hostRendererId:t,requestWindowId:n},this._rendererId=t,this._windowId=n,this._clientRequestType=a,this._postMessage=t=>e(t),this._requestRegistrar=new Vv,this.requestId=new Hv(a)}sendRequest(e,t){const n={rendererId:this._rendererId,windowId:this._windowId,requestId:this.requestId.next(),type:this._clientRequestType,payload:e},i=this._requestRegistrar.addRequest(n,t);return this._postMessage(n),i}handleResponse(e){return new Promise(((t,n)=>{try{this._requestRegistrar.reconcileResponse(e),t()}catch(t){this._context.bootstrapServices.logger.errorToTelemetry?.(`Error occurred on reconciling response ${t}`,"cdl_client_response_error",{...(0,jv.w)(this._loggingContext),correlationId:e.requestId,windowId:e.windowId,errorCode:d.O4.Unknown},!0),n(t)}}))}}const qv="MainRenderer",Gv="GQL_STOP";class Yv extends zv{constructor(e,{rendererId:t,windowId:n},i,a){super(e,{rendererId:t,windowId:n},i,a)}sendFilteredAppStateRequest(e){const t=e.context.appState;return this._rendererId===qv&&(e.context.appState=this.filterWorkerAppState(t)),super.sendRequest(e)}filterWorkerAppState(e){return e}}class Qv{constructor(){this.onResponseReceived=e=>{if(this.onMessage){const t=this.transformLegacyClientFields(e.payload.dataLayer);this.onMessage(t)}}}transformLegacyClientFields(e){return e.error&&(e.errors=e.error),e.extensions||(e.extensions={}),e.perfStats&&(e.extensions.perfStats=e.perfStats),e}}class Jv extends Qv{constructor(e,{rendererId:t,windowId:n},i,a){super(),this._context=i,this._loggingContext={hostRendererId:t,component:"CDLClient",requestWindowId:n},this.sendMessage=t=>e({requestId:t.requestId,rendererId:t.rendererId,windowId:t.windowId,payload:t.request,operationName:t.operationName,type:a,cdlOperationCustomContext:t.cdlOperationCustomContext})}handleResponse(e){return this._context.bootstrapServices.logger.debug("Received message",{...this._loggingContext,requestId:e.requestId,requestRendererId:e.rendererId,requestWindowId:e.windowId}),Promise.resolve(this.onResponseReceived({payload:{dataLayer:{rendererId:e.rendererId,requestId:e.requestId,windowId:e.windowId,data:e.response.data,errors:e.response.errors?e.response.errors:void 0,errorCode:e.response?.errorCode,extensions:e.response.extensions}}}))}}class Kv{constructor(e,t,n,i,a){this.stateMachineName=a,this.completionAwaiter=(0,Wv.v)(),this.completedStates=[],this.bootstrapContext={...i,loggingContext:{...i.loggingContext,component:"CDLStateMachine"}},this.actionStateMap=t,this.globalState=e,this._currentState=e.current,this.workerStartupTelemetryService?.onStart(this.stateMachineName),this.completedStates.push(n),this.globalState.hasReachedCheckpoint(n)?this.transitionToNextState(n):this.subscribeToGlobalState()}isCompleted(){return this.completionAwaiter.promise}hasCompletedState(e){return-1!==this.completedStates.indexOf(e)}get currentState(){return this._currentState}errorStateMachine(e){this.unsubscribeStateTransition&&this.unsubscribeStateTransition.unsubscribe(),this.completionAwaiter.reject(e),"coreGraphql"===this.stateMachineName&&this.bootstrapContext.bootstrapServices.workerCacheManager?.saveWorkerStatusToCacheStorage({error:JSON.stringify(e),state:"Failure",stepName:`${this.currentState}::Fail`}),e&&e.code===d.O4.Disabled?this.bootstrapContext.bootstrapServices.logger.log(e.message,this.bootstrapContext.loggingContext):this.bootstrapContext.bootstrapServices.logger.errorToTelemetry?.(`State machine is erroring out: ${(0,Je.Nw)(e)}`,"cdl_state_managers",{...(0,jv.w)(this.bootstrapContext.loggingContext)},!0),this.workerStartupTelemetryService?.onFail(this.stateMachineName,e)}completeStateMachine(e){this.unsubscribeStateTransition&&this.unsubscribeStateTransition.unsubscribe(),this.completionAwaiter.resolve(e),this.bootstrapContext.bootstrapServices.logger.log("State machine is reaching completion",this.bootstrapContext.loggingContext),this.workerStartupTelemetryService?.onComplete(this.stateMachineName)}execute(e,t,n){this.workerStartupTelemetryService?.onStepStart(this.stateMachineName,e);const i=e,a=this.actionStateMap.get(i);if(!a)return this.bootstrapContext.bootstrapServices.logger.log(`State machine is transitioning from ${this.currentState} to ${e}, skipping action invoke as none is defined`,this.bootstrapContext.loggingContext),this.emitState(e,n);this.bootstrapContext.bootstrapServices.logger.log(`State machine is invoking action for transition state ${this.currentState} to ${e}`,this.bootstrapContext.loggingContext),a.action(t,n).then((t=>{this.bootstrapContext.bootstrapServices.logger.log(`State machine is transitioning from ${this.currentState} to ${e}`,this.bootstrapContext.loggingContext),a.eventData&&this.workerStartupTelemetryService?.appendEventData(this.stateMachineName,a.eventData),this.emitState(e,t)})).catch((e=>{this.errorStateMachine(e)}))}transitionToNextState(e,t){this._currentState=e,this.completedStates.push(e),this.transitionState(e,t)}subscribeToGlobalState(){this.unsubscribeStateTransition=this.globalState.subscribe({next:e=>{const{newState:t,args:n}=e;this.transitionToNextState(t,n)}})}emitState(e,t){this.globalState.hasReachedCheckpoint(e)?this.transitionToNextState(e,t):(this.unsubscribeStateTransition||this.subscribeToGlobalState(),this.globalState.setState(e,t))}get workerStartupTelemetryService(){return this.bootstrapContext.bootstrapServices.workerStartupTelemetryService}}class Zv extends Kv{transitionState(e,t){switch(e){case"authLoaded":this.execute("authServiceInjected",t,void 0);break;case"authServiceInjected":this.completeStateMachine(!0)}}}class Xv extends Kv{transitionState(e,t){switch(e){case"appService:Loaded":this.execute("appService:Injected",t,void 0);break;case"appService:Injected":this.completeStateMachine(!0)}}}class ey{constructor(e){this._componentName=e,this._handlerMap=new Map}addHandlers(e){e.forEach((e=>{this._handlerMap.set(e.requestType,e.handlerFunc)}))}handle(e,t,n,...i){const a=e.payload;return new Promise(((e,o)=>{const r=this._handlerMap.get(a.requestOperationtype);if(!r){n.bootstrapServices.logger.errorToTelemetry?.(`No handler found for request type ${a.requestOperationtype}`,"cdl_request_handler_no_handler_error",{origin:this._componentName,errorCode:d.O4.NotImplemented,...(0,jv.w)(n.loggingContext)},!0);const e={response:{statusMsg:`Unknown request type: ${a.requestOperationtype}`,data:void 0},status:"failure"};return t(e),o(e)}r(a,n,...i,t).then((n=>e(ey.callResponseCallback(t,n,"success")))).catch((e=>{const n={response:e,status:"failure"};return t(n),o(n)}))}))}static callResponseCallback(e,t,n){e({response:t,status:n})}static onHandlerError(e,t,n,i,a,o=!1){o?e.bootstrapServices.logger.errorToTelemetry?.(n,"cdl_request_handler_on_error",{origin:a,errorCode:t,...(0,jv.w)(e.loggingContext)},!0):e.bootstrapServices.logger.error(n,{component:a,...e.loggingContext},t);const r={statusMsg:i,data:void 0};return Promise.reject(r)}}var ty,ny,iy,ay;!function(e){e.AadGetToken="aadGetToken",e.AadGetCurrentUser="aadCurrentUser",e.AadClearCache="aadClearCache",e.StartupApiToken="startupApiToken",e.GetSkypeTokens="getSkypeTokens",e.GetUserDetails="getUserDetails",e.SubscribeToAuthState="subscribeToAuthState"}(ty||(ty={}));class oy{constructor(e){this._requestUtility=new ey("CDLAuthHandler");let t=[];t=e===qv?[{requestType:ty.AadGetToken,handlerFunc:oy.getAadTokensAngular},{requestType:ty.AadGetCurrentUser,handlerFunc:oy.getUserInformationAngular},{requestType:ty.GetSkypeTokens,handlerFunc:oy.getSkypeTokensAngular},{requestType:ty.GetUserDetails,handlerFunc:oy.getUserDetailsAngular},{requestType:ty.SubscribeToAuthState,handlerFunc:oy.subscribeToAuthState}]:[{requestType:ty.AadGetToken,handlerFunc:oy.getAadTokens},{requestType:ty.AadGetCurrentUser,handlerFunc:oy.getUserInformation},{requestType:ty.GetSkypeTokens,handlerFunc:oy.getSkypeTokens},{requestType:ty.GetUserDetails,handlerFunc:oy.getUserDetails},{requestType:ty.SubscribeToAuthState,handlerFunc:oy.subscribeToAuthState}],this._requestUtility.addHandlers(t)}injectDependentServices(e){return new Promise((t=>{if(!e)throw new TypeError("Cannot injectDependentServices of undefined");if("function"==typeof e.getAuthTokens&&(e={authenticationService:e,discover:void 0}),!e.authenticationService)throw new TypeError("Cannot inject authentication service that is not defined");if(this._authenticationService)throw new TypeError("injectDependentServices has been called again, even though it's already initialized");return this._authenticationService=e.authenticationService,this._discover||(this._discover=e.discover),this._authStateProvider||(this._authStateProvider=e.authStateProvider),t()}))}handle(e,t,n){return this._requestUtility.handle(e,t,n,this._authenticationService,this._discover,this._authStateProvider)}static convertAngularPromise(e){return new Promise(((t,n)=>{e.then((e=>t(e))).catch((e=>n(e)))}))}static handleAuthResult(e,t,n){const i=t.bootstrapServices.newScenario(be.Cu.AuthHandlerRequest);return i.appendEventData({operation:n}),e.then((e=>{if(null==e){const e="response payload is empty";throw i.fail({message:e}),new Error(e)}const t={statusMsg:`${n} request in main renderer has been processed`,data:e};return i.stop(),t})).catch((e=>{const a=oy.getErrorMessage(n,e),o=!!(0,Je.WZ)(e);ey.onHandlerError(t,d.O4.UnhandledPromiseRejection,"the auth handler has exception",a,"CDLAuthHandler",!o&&"response payload is empty"!==e?.message),e.isExpected?i.incomplete({message:a}):i.fail({message:a});try{"string"==typeof e&&(e=new Error(e)),e.reason||(e.reason={}),e.reason.cdlClient="auth"}catch(n){t.bootstrapServices.logger.warn(`Failed to handle auth error. Original error: ${(0,Je.Nw)(e)}. Handling error: ${(0,Je.Nw)(n)}`,{component:"CDLAuthHandler",...t.loggingContext})}throw e}))}static getAadTokensAngular(e,t,n){const i=e.context.resource,a=e.context.options;return oy.logStartHandle(e,t,i),oy.handleAuthResult(oy.convertAngularPromise(n.getAuthToken(i,a?.claim,a?.silent,e.context?.forceRenew)).then((e=>{if(!e)return;return{token:e.token,expires:e.expiration,tokenType:e.tokenType,fromCache:!1}})),t,ty.AadGetToken)}static getAadTokens(e,t,n){const{resource:i,options:a}=e.context;let o;return oy.logStartHandle(e,t,i),o=n.acquireTokenV2?n.acquireTokenV2(i,a):n.acquireToken(i,a).then((e=>({token:e}))),oy.handleAuthResult(o,t,ty.AadGetToken)}static getUserInformationAngular(e,t,n){return oy.logStartHandle(e,t),oy.handleAuthResult(oy.convertAngularPromise(n.getUserInformation()),t,ty.AadGetCurrentUser)}static getUserDetailsAngular(e,t,n){return oy.logStartHandle(e,t),oy.handleAuthResult(oy.convertAngularPromise(n.getUserDetails()),t,ty.GetUserDetails)}static async getUserDetails(e,t,n,i){oy.logStartHandle(e,t);const a=await i.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:!!e.context?.forceRenew,correlation:(0,Wh.$q)("[cdl]auth-handler:getUserDetails")}),o=a?{userDetails:a.userDetails,id:a.userDetails.id}:void 0;return oy.handleAuthResult(Promise.resolve(o),t,ty.GetUserDetails)}static async subscribeToAuthState(e,t,n,i,a,o){if(!a){t.bootstrapServices.logger.log("Auth-Handler - auth state provider not provided. Not subscribing.",{component:"CDLAuthHandler",...t.loggingContext});const e=(0,Je.$5)("AuthStateProvider not provided - This will should be an error in the RWC experience",d.O4.MissingParameter,"Auth-Handler");return Promise.reject(e)}const r=a.observe().subscribe((async e=>{const n=await oy.handleAuthResult(Promise.resolve(e?.state),t,ty.SubscribeToAuthState);ey.callResponseCallback(o,n,"success")}),(async e=>{ey.callResponseCallback(o,{statusMsg:oy.getErrorMessage(ty.SubscribeToAuthState,e),data:e},"failure")}),(async()=>{r.unsubscribe(),ey.callResponseCallback(o,{statusMsg:"AuthStateProvider Completed",data:void 0},"failure")}));return oy.handleAuthResult(Promise.resolve(a.getState()?.state),t,ty.SubscribeToAuthState)}static getSkypeTokensAngular(e,t,n){oy.logStartHandle(e,t);const i=n.getSkypeTokens(!!e.context?.forceRenew).then((e=>{if(!e)return;return{expiration:e.tokenExpiration||0,skypeToken:e.skypeToken,userDetails:e.userDetails,regionGtms:e.regionGtms}}));return oy.handleAuthResult(i,t,ty.GetSkypeTokens)}static getSkypeTokens(e,t,n,i){return oy.logStartHandle(e,t),oy.handleAuthResult(i.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:!!e.context?.forceRenew,correlation:(0,Wh.$q)("[cdl]auth-handler:getSkypeTokens")}),t,ty.GetSkypeTokens)}static getUserInformation(e,t,n){return oy.logStartHandle(e,t),oy.handleAuthResult(n.getUser({correlation:{source:"AuthHandlerRequest",id:"na",scenarioName:"CentralDataLayerBootstrapAuthGetUser"}}),t,ty.AadGetCurrentUser)}static logStartHandle(e,t,n){const i=n?` for resource ${n}`:"";t.bootstrapServices.logger.log(`Auth handler started serving request ${e.requestOperationtype}${i}`,{component:"CDLAuthHandler",...t.loggingContext})}}oy.getErrorMessage=(e,t)=>`the request type for ${e} failed due to ${(0,Je.Nw)(t)}`,function(e){e.MachineActive="MachineActive",e.MachineInactive="MachineInactive",e.MachineLongInactive="MachineLongInactive",e.MachineLocked="MachineLocked"}(ny||(ny={})),function(e){e.NotifyAppState="NotifyAppState",e.NotifyTokenRefresh="NotifyTokenRefresh",e.NotifyCoreClientState="NotifyCoreClientState",e.NotifyCoreMachineState="NotifyCoreMachineState",e.NotifyCoreSuspendedState="NotifyCoreSuspendedState",e.NotifyCoreMachineIdleState="NotifyCoreMachineIdleState",e.NotifyServiceUp="NotifyServiceUp",e.NotifyServiceDown="NotifyServiceDown"}(iy||(iy={})),function(e){e[e.ChatSync=0]="ChatSync",e[e.Presence=1]="Presence",e[e.Files=2]="Files",e[e.OneNote=3]="OneNote",e[e.Groups=4]="Groups",e[e.Video=5]="Video",e[e.MasterTab=6]="MasterTab",e[e.IndexDb=7]="IndexDb",e[e.AdalTokens=8]="AdalTokens",e[e.AdalLogin=9]="AdalLogin",e[e.AdalReauth=10]="AdalReauth",e[e.SkypeTokens=11]="SkypeTokens",e[e.SkypeLicense=12]="SkypeLicense",e[e.SupportedBrowser=13]="SupportedBrowser",e[e.MSAGuestLicense=14]="MSAGuestLicense",e[e.AppSession=15]="AppSession",e[e.CSAStartup=16]="CSAStartup"}(ay||(ay={}));class ry{constructor(e,t){this.workerId=t,this._requestUtility=new ey("CDLAppServiceHandler");let n=[];n=e===qv?[{requestType:iy.NotifyServiceUp,handlerFunc:ry.notifyServiceUpAngular},{requestType:iy.NotifyServiceDown,handlerFunc:ry.notifyServiceDownAngular}]:[{requestType:iy.NotifyServiceUp,handlerFunc:ry.notifyServiceUp},{requestType:iy.NotifyServiceDown,handlerFunc:ry.notifyServiceDown}],this._requestUtility.addHandlers(n)}injectAppState(e){return new Promise((t=>{if(this.appService)throw new TypeError("injectAppStateService has been called again, even though it's already initialized");return this.appService=e,t()}))}handle(e,t,n){return this._requestUtility.handle(e,t,n,this.appService,this.workerId)}static notifyServiceUp(e,t,n,i){return new Promise((a=>{t.bootstrapServices.logger.log(`App service change is received (worker ${i}), ${e.context.appService} is up and running`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:o,reason:r}=e.context,s={workerId:i};return n.notifyServiceUp(s,o,r),a()}))}static notifyServiceUpAngular(e,t,n){return new Promise((i=>{t.bootstrapServices.logger.log(`App service change is received, ${e.context.appService} is up and running. Notifying Angular.`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:a,reason:o}=e.context,r=ay[a];return n.notifyServiceUp(r,o),i()}))}static notifyServiceDown(e,t,n,i){return new Promise((a=>{t.bootstrapServices.logger.log(`App service change is received (worker ${i}), ${e.context.appService} is down`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:o,reason:r,code:s}=e.context,l={workerId:i};return n.notifyServiceDown(l,o,r,s),a()}))}static notifyServiceDownAngular(e,t,n){return new Promise((i=>{t.bootstrapServices.logger.log(`Angular app service change is received, ${e.context.appService} is down. Notifying Angular.`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:a,reason:o,code:r}=e.context,s=ay[a];return n.notifyServiceDown(s,o,r),i()}))}}class sy{constructor(e){this.workerId=e}handle(e,t,n){return new Promise((i=>{n.bootstrapServices.logger.log(`Network state received from CDL worker ${this.workerId}. Network state: ${e.payload.networkState}`,{component:"NetworkStateHandler",...n.loggingContext}),this.networkStateChangeHandler?.next(e.payload.networkState);i(t({response:{statusMsg:"Network state received success.",data:void 0},status:"success"}))}))}injectNetworkStateTracker(e){return new Promise((t=>{if(this.networkStateChangeHandler)throw new TypeError("injectNetworkStateTracker has been called again, even though it's already initialized");return this.networkStateChangeHandler=e,t()}))}}class ly extends Kv{transitionState(e,t){switch(e){case"networkState:Loaded":this.execute("networkState:Injected",t,void 0);break;case"networkState:Injected":this.completeStateMachine(!0)}}}class cy{constructor(){this._componentName="EndpointsHealthMessageHandler"}handle(e,t,n){return new Promise((i=>{(!e.payload||void 0===e.payload.healthState&&void 0===e.payload.endpointHealth)&&(this.log("Endpoints health message received from CDL. Payload is empty.",n),i(t(this.getSuccessMessage()))),e.payload.endpointHealth&&(this.log(`Endpoints health message received from CDL. Update: ${JSON.stringify(e.payload.endpointHealth)}.`,n),this.endpointsHealthUpdateHandler?.handleEndpointHealthUpdate(e.payload.endpointHealth),i(t(this.getSuccessMessage()))),e.payload.healthState&&(this.log("Endpoints state dump message received from CDL.",n),this.endpointsHealthUpdateHandler?.handleStateDump(e.payload.healthState),i(t(this.getSuccessMessage())))}))}injectEndpointsHealthUpdateHandler(e){return new Promise((t=>{if(this.endpointsHealthUpdateHandler)throw new TypeError("injectEndpointsHealthUpdateHandler has been called again, even though endpointsHealthUpdateHandler is already initialized");return this.endpointsHealthUpdateHandler=e,t()}))}log(e,t){t.bootstrapServices.logger.log(e,{component:this._componentName,...t.loggingContext})}getSuccessMessage(){return{response:{statusMsg:"Endpoints health received success.",data:void 0},status:"success"}}}class dy extends Kv{transitionState(e,t){switch(e){case"endpointsHealthUpdateHandler:Loaded":this.execute("endpointsHealthUpdateHandler:Injected",t,void 0);break;case"endpointsHealthUpdateHandler:Injected":this.completeStateMachine(!0)}}}function uy(e,t,n,i){const{authStateMachine:a,authHandler:o}=my(e,t,i),{appServiceStateMachine:r,appServiceMessageHandler:s}=py(e,t,i,n),{networkStateHandlerStateMachine:l,networkStateHandler:c}=gy(e,t,i,n),{endpointsHealthHandlerStateMachine:d,endpointsHealthHandler:u}=hy(e,t,i);return new Map([[Ov.X.auth,{stateMachine:a,requestHandler:o}],[Ov.X.appService,{stateMachine:r,requestHandler:s}],[Ov.X.networkState,{stateMachine:l,requestHandler:c}],[Ov.X.endpointHealth,{stateMachine:d,requestHandler:u}]])}const my=(e,t,n)=>{const i=new oy(t),a={action:i.injectDependentServices.bind(i)},o=new Map;o.set("authServiceInjected",a);return{authHandler:i,authStateMachine:new Zv(n,o,"authLoaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:"auth",component:"CreateWorkerStateAndRequestHandlers"}},"auth")}},py=(e,t,n,i)=>{const a=new ry(t,i),o={action:a.injectAppState.bind(a)},r=new Map;r.set("appService:Injected",o);return{appServiceMessageHandler:a,appServiceStateMachine:new Xv(n,r,"appService:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:"appService",component:"CreateWorkerStateAndRequestHandlers"}},"appService")}},gy=(e,t,n,i)=>{const a=new sy(i),o={action:a.injectNetworkStateTracker.bind(a)},r=new Map;r.set("networkState:Injected",o);return{networkStateHandler:a,networkStateHandlerStateMachine:new ly(n,r,"networkState:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:Ov.X.networkState,component:"CreateWorkerStateAndRequestHandlers"}},"networkState")}},hy=(e,t,n)=>{const i=new cy,a={action:i.injectEndpointsHealthUpdateHandler.bind(i)},o=new Map;o.set("endpointsHealthUpdateHandler:Injected",a);return{endpointsHealthHandler:i,endpointsHealthHandlerStateMachine:new dy(n,o,"endpointsHealthUpdateHandler:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:Ov.X.endpointHealth,component:"CreateWorkerStateAndRequestHandlers"}},"endpointsHealth")}};function vy(){return new SharedWorker("/v2/worker/precompiled-shared-worker-cdd3ed0ac4637f47.js")}function yy(){return new Worker("/v2/worker/precompiled-web-worker-5bfab685f13410cf.js")}function Sy(){return new Worker("/v2/worker/precompiled-web-worker-eadae02e9b730388.js")}const fy=-1,ky=e=>({loaded:e.hasReachedCheckpoint("loaded")?1:0,healthCheck:e.hasReachedCheckpoint("health_checked")?1:0,syncEngine:e.hasReachedCheckpoint("syncEngine:Initialized")?1:e.hasReachedCheckpoint("syncEngine:FailedToInitialize")?2:0,authLoaded:e.hasReachedCheckpoint("authLoaded")?1:0}),Cy=e=>{const t=ky(e);return`LD${t.loaded}:HC${t.healthCheck}:SE${t.syncEngine}:AL${t.authLoaded}`},by=e=>{const t=ky(e);return{"WorkerStartupState.Loaded":1===t.loaded,"WorkerStartupState.HealthCheck":1===t.healthCheck,"WorkerStartupState.SyncEngine":t.syncEngine,"WorkerStartupState.AuthLoaded":1===t.authLoaded}},wy=(e,t)=>{if(e.hasOwnProperty("code")){const t=e;if(t.code!==d.O4.Unknown)return t.code}return t.hasReachedCheckpoint("loaded")?t.hasReachedCheckpoint("syncEngine:FailedToInitialize")?d.O4.NotInitialized:t.hasReachedCheckpoint("health_checked")&&t.hasReachedCheckpoint("syncEngine:Initialized")?d.O4.UnhandledRuntimeException:d.O4.TimedOut:d.O4.ScriptLoadError},Ty=e=>e&&e.message&&e.message.includes("AsyncIterableObserver buffer is full")?"AsyncIterableBufferOverflow":"Unknown",Iy=120*yh.YM.MILLI_PER_SECOND,Ny="CDLWorkerManager",Ay="default";function Ey(e,t,n,i,a,o,r,s,l,c,d,u,m,p){const g={hostRendererId:t,component:"CDLWorker"};let h;const v=function(){const e=new Map;return e.set(Ov.X.appState,Yv),e.set(Ov.X.control,zv),e.set(Ov.X.database,zv),e.set(Ov.X.diagnostics,zv),e.set(Ov.X.endpointHealth,zv),e.set(Ov.X.graphql,Jv),e.set(Ov.X.networkState,zv),e.set(Ov.X.syncEngine,zv),e.set(Ov.X.supportedResolvers,zv),e.set(Ov.X.telemetry,zv),e}();return e.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"InProgress",stepName:"CreateCDLWorker"}),void 0!==c?.telemetryWorkerBroadcast&&u?.localStorage?.setItem("tmp.telemetryBroadcastEnabledCache",c.telemetryWorkerBroadcast.toString()),h=n?function(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g){let h=!1;if(c){let d,v;Mv(e.logger,c,!0,e.hostRendererId,Ny);const y=p?.loader?.getSharedWorker?.();return y?(d=y,v=p?.loader?.getWorkerInitializationTime?.(),h=!0,p?.loader?.clearWorker(),e.logger.log("Cleared Precore Init shared worker",s)):(v=Date.now(),d=new SharedWorker(c)),Fy(e,i,a,l,t,n,(e=>d.port.postMessage(e)),(e=>{d.port.onmessage=t=>e(t,(e=>d.port.postMessage(e)))}),(e=>{d.onerror=t=>e(t)}),"shared-worker",o,r,s,m,g,u?.workerId,v,h)}const v=_v(u?.experienceName,u?.ring,u?.environment,u?.sessionId,u?.platformId,u?.buildVersion,u?.localeCode,u?.workerId,void 0,u?.preECSConsoleLogLevel,u?.userConsoleLogLevel,u?.publicPath,void 0,u?.isOcdi,u?.isPwa,!1,u?.telemetryWorkerBroadcast);let y;const S=SharedWorker;SharedWorker=Pv(S,e.logger,Ny,v,d,void 0,(e=>{y=e}));const f=new vy;return SharedWorker=S,Fy(e,i,a,l,t,n,(e=>f.port.postMessage(e)),(e=>{f.port.onmessage=t=>e(t,(e=>f.port.postMessage(e)))}),(e=>{f.onerror=t=>e(t)}),"shared-worker",o,r,s,m,g,u?.workerId,y,h)}(e,t,v,i,a,o,r,g,s,l&&l.cdlSharedWorkerUrl,(e=>{l&&(l.cdlSharedWorkerUrl=e)}),c,d,u,m):function(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h){let v=!1;if(c){let d,h;Mv(e.logger,c,!0,e.hostRendererId,Ny);const y=p?.loader?.getWorker?.();return y?(d=y,h=p?.loader?.getWorkerInitializationTime?.(),v=!0,p?.loader?.clearWorker(),e.logger.log("Cleared Precore Init web worker",s)):(h=Date.now(),d=new Worker(c)),Fy(e,i,a,l,t,n,(e=>d.postMessage(e)),(e=>{d.onmessage=t=>e(t,(e=>d.postMessage(e)))}),(e=>{d.onerror=t=>e(t)}),"web-worker",o,r,s,m,g,u?.workerId,h,v)}const y=_v(u?.experienceName,u?.ring,u?.environment,u?.sessionId,u?.platformId,u?.buildVersion,u?.localeCode,u?.workerId,u?.preAuthUserId,u?.preECSConsoleLogLevel,u?.userConsoleLogLevel,u?.publicPath,u?.deviceId,u?.isOcdi,u?.isPwa,!1,u?.telemetryWorkerBroadcast,u?.useDiagnosticsServiceV2);let S;const f=Worker;let k;Worker=Pv(f,e.logger,Ny,y,d,void 0,(e=>{S=e})),k=h?new Sy:new yy;return Worker=f,Fy(e,i,a,l,t,n,(e=>k.postMessage(e)),(e=>{k.onmessage=t=>e(t,(e=>k.postMessage(e)))}),(e=>{k.onerror=t=>e(t)}),"web-worker",o,r,s,m,g,u?.workerId,S,v)}(e,t,v,i,a,o,r,g,s,l&&l.cdlWebWorkerUrl,(e=>{l&&(l.cdlWebWorkerUrl=e)}),c,d,u,m,p),h}function Fy(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h=Ay,v,y){return new Promise((async(S,f)=>{const k=new Lv({bootstrapServices:e,loggingContext:m});k.setState("bootstrapped"),p?.mark(be.BQ.CdlWorkerBootstrapped);const C=$v(e,{postMessageCallback:e=>r(e),clients:o},{globalState:k,requestAndStateHandlers:uy(e,a,h,k)},a);C.workerServer.start(),s(((e,t)=>C.onMessageCallback(e,t,fy))),l((t=>{f(_y(t,e,m,"workerOnError",u,b.state))}));const b={workerServer:C.workerServer,workerClientResponseRouter:C.workerClientResponseRouter,state:k,workerType:c,syncEngineInitializationPromise:d,workerInitInfo:{workerInitializationTime:v,isWorkerInitializedInExperienceLoader:y}};b.state.setState("loaded");try{await async function(e,t,n,i,a){const o=Date.now(),r=t.workerClientResponseRouter.cdlControlClient.sendRequest({type:"health_check",bootstrapData:i,initiatorExperience:n});let s;s=a?await r:await(0,yi.a)(r,e);const l=s.response;t.cdlWorkerSessionId=l.cdlWorkerSessionId,t.cdlWorkerSupportedResolvers=l.cdlWorkerSupportedResolvers,t.workerInitInfo&&(t.workerInitInfo.workerStartTime=l.cdlWorkerStartTime,t.workerInitInfo.healthCheckRequestStartTime=o,t.workerInitInfo.healthCheckRequestReceivedTime=s.requestReceivedTime,t.workerInitInfo.healthCheckResponseSendTime=s.responseSendTime,t.workerInitInfo.healthCheckRequestCompleteTime=Date.now());t.state.setState("health_checked")}(t||Iy,b,n,i,g)}catch(t){f(_y(t,e,m,"healthCheckException",u,b.state))}S(b)}))}function _y(e,{logger:t,workerCacheManager:n},i,a,o,r){const s=wy(e,r),l=Cy(r),c=`err: ${(0,Je.Nw)(e.error)};message: ${(0,Je.Nw)(e.message)}`,u=(0,Je.$5)(d.Ir.DataLayerClient,s,c,void 0,`Uncaught ${a} in Worker: ${(0,Je.Nw)(e.message)} Auth: ${o} WorkerState: ${l}`),m=`CDL Worker OnError for ${a}::Auth${o}::workerState:${l}::${Ty(e)}`;return t.errorToTelemetry?.(m,"cdl_worker_startup_error",by(r),!1),t.error(`CDL Worker OnError for ${(0,Je.Nw)(e)}`,i,s),n?.saveWorkerStatusToCacheStorage({state:"Failure",stepName:"CDLWorkerOnError",error:c}),u}const Dy=e=>{switch(e){case"clean":return"Clean";case"upgrade:blocking":return"UpgradeBlocking";case"upgrade:non-blocking":return"UpgradeNonBlocking";case"warm":return"Warm"}};var Py=n(668625),My=n(720639),Ry=n(378193),xy=n(774478);const Ly=(0,My.g)(Ry.b),Oy=()=>{let e;return async(t,n,i)=>{if(void 0===e){const a=await jy(t,n,i);return e=a,a}return e}},jy=async(e,t,n)=>{if(!e)return t.log("WebWorkerURL is undefined",n),!0;let i;t.infoToTelemetry?.("Pinging PDS / ServiceWorker to verify if worker script is up","cdl_worker_startup_error_verify_worker_script",{endpointUrl:e},!0);const a=new Date,o=performance.now();try{i=await Ly({url:e,method:"HEAD"})}catch(e){return t.errorToTelemetry?.(e.toString(),"cdl_worker_startup_error_verify_worker_script",{statusCode:-1},!0),!1}const r={totalRequestTime:performance.now()-o,statusCode:i.status,size:Number(i.headers["content-length"]??-1),correlationId:i.headers["x-msedge-ref"],callId:i.headers["x-ms-request-id"],contentType:i.headers["x-cache"]};return t.infoToTelemetry?.("Finished pinging PDS / ServiceWorker","cdl_worker_startup_error_verify_worker_script",r,!0),t.log(`precompiled-web-worker header x-msedge-ref: ${i.headers["x-msedge-ref"]}`,n),function(e,t){const n="Ref C: ";if(!e)return!0;let i;if(!(i=e.indexOf(n)))return!0;const a=e.slice(i+n.length),o=new Date(a);if(!(0,xy.v)(o))return!0;return t.getTime()<o.getTime()}(i.headers["x-msedge-ref"],a)||t.log("Request is likely served from service worker, since PDS response time is before the request time",n),i.status!==Og.nW.OK?(t.errorToTelemetry?.(`PDS returned ${i.status} for worker script`,"cdl_worker_startup_error_verify_worker_script",r,!0),!1):(t.log("Worker script fetched successfully.",n),!0)};const By=(e,t,n,i,a,o,r,s,l,c,u,m,p,g,h,v,y,S,f)=>new Promise((async(k,C)=>{const b=performance.now();"sharedworker"===t&&y?.setContext("cdlSharedWorkerSessionId",l?.sessionId);let w=p?.workerStartupScenario,T=p?.workerStartupScenarioTimeout;const I=Uy(t);if(!w){const e=$y(n.newScenario,o,I,n.workerCacheManager,u,m,h,n.logger);w=e.workerStartupScenario,T=e.workerStartupScenarioTimeout}if(w.appendEventData({origin:r}),S&&h?.getUser&&!w.isPaused){await(h?.getUser())||w.pause({reason:d.O4.Authentication,pauseReason:"AuthNoUser_InteractionRequired"})}y?.setCoreContext("AppInfo.CDLState","Initializing");const N=Vy(e);m?.getState()?.state===dh.k.InteractionRequired&&(n.logger.warn("Worker startup - User is in InteractionRequired state. pausing worker startup scenario",N),w?.pause({reason:d.O4.Authentication,pauseReason:"InteractionRequired"}));const A=m?.observe()?.subscribe({next:e=>{e.state!==dh.k.InteractionRequired||w?.isPaused?e.state===dh.k.Up&&w?.isPaused&&(n.logger.log("Worker startup - User came out of InteractionRequired state. Resuming worker startup scenario",N),w?.resume({reason:"ValidToken"})):(n.logger.warn("Worker startup - User is in InteractionRequired state. Pausing worker startup scenario",N),w?.pause({reason:d.O4.Authentication,pauseReason:"InteractionRequired"}))}}),E=w;u&&n.logger.log(`Initializing worker manager from renderer with host: ${u.location.host} protocol: ${u.location.protocol} port: ${u.location.port}`,N);const F=Oy();let _;g||(_=u?.setTimeout((async()=>{const t=Vy(e);E.mark("ScriptLoadTimedOut"),await F(I?i?.cdlSharedWorkerUrl:i?.cdlWebWorkerUrl,n.logger,t)||E.mark("ScriptPingFailed")}),4e4)),async function(e,t,n,i,a,o,r,s,l,c,u,m,p,g,h,v,y,S,f,k){let C=!1;h&&t.logger.log(`Initializing worker manager from renderer with host: ${h.location.host} protocol: ${h.location.protocol} port: ${h.location.port}`,{hostRendererId:e,component:"CDLWorkerManager"});try{const u=(0,Wv.v)();c.appendEventData({newState:"beforeCreateCDLWorker"});const y=await Ey(t,e,o,i,a,u.promise,v?v.getState()?.state:dh.k.Up,m,n,p,c,h,S,k).finally((()=>{h?.clearTimeout?.(l),h?.clearTimeout(s)}));return C=!0,c.appendEventData({newState:be.BQ.CdlWorkerManagerHealthChecked,searchSessionId:y.cdlWorkerSessionId}),y.state.setState("initialized"),f?.setCoreContext("AppInfo.CDLState","Running"),Hy(c),c.mark("CDLWorkerManagerInitialized",{workerInitializationTime:y.workerInitInfo?.workerInitializationTime,workerStartTime:y.workerInitInfo?.workerStartTime,isWorkerInitializedInExperienceLoader:y.workerInitInfo?.isWorkerInitializedInExperienceLoader,healthCheckStartTime:y.workerInitInfo?.healthCheckRequestStartTime,healthCheckRequestReceivedTime:y.workerInitInfo?.healthCheckRequestReceivedTime,healthCheckResponseSendTime:y.workerInitInfo?.healthCheckResponseSendTime,healthCheckCompletionTime:y.workerInitInfo?.healthCheckRequestCompleteTime}),async function(e,t,n,i,a,o,r,s,l){const c=Vy(n);try{const{response:t}=await e.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"startup_info",subType:"Messaging",params:void 0}),n=t;if(n&&"string"!=typeof n&&"error"===n.type){throw"string"==typeof n.details?(0,Py.j)(n.details,n.details):n.details}const o="clean"===n?"cold":"warm";s?.appendEventData({messagingSyncEngineStartupMode:n,appLaunchMode:o,workerResponseTime:performance.now()-r}),a.resolve({isSyncEngineInitialized:!0,bootType:Dy(n)}),l?.setCoreContext("AppInfo.LaunchMode",o),e.state.setState("syncEngine:Initialized"),Hy(i),i.stop({dataSource:n})}catch(n){const r=await Wy(o,t.workerCacheManager),s="Init SyncEngine failed",l=`err: ${(0,Je.Nw)(n)}`,u=n.code||n.response?.code||n.response?.error?.code||d.O4.Unknown;t.logger.errorToTelemetry?.(`${s}:: ${l}`,"cdl_worker_manager_get_messaging_sync_engine_startup_info_error",{...(0,jv.w)(c),errorCode:u},!0),t.logger.errorToTelemetry?.(`${s}:: WSM: ${r}`,"cdl_worker_manager_get_messaging_sync_engine_startup_info_error",{...(0,jv.w)(c),errorCode:u},!0),Hy(i);const m=`${s}:: WSM: ${r}:: ${l}`,p=(0,Je.WZ)(n)||n.response?.error?.isExpected||!1,g=n.response||n,h={errors:m,isAccepted:p,errorCode:u,dataSource:g?.startupMode||g?.error?.startupMode,reason:g?.message||g?.error?.message||g?.context,statusCode:g?.statusCode||g?.error?.statusCode};p?i.cancel(h):i.fail(h),e.state.setState("syncEngine:FailedToInitialize"),a.resolve({isSyncEngineInitialized:!1,isExpected:p,isReliableSyncEngine:!!g?.isReliableSyncEngine})}}(y,t,e,c,u,o,r,g,f),y}catch(i){const a=await async function(e,t,n,i,a,o,r,s,l,c,u){const m=await Wy(a,t.workerCacheManager),p=`Failed to initialize CDL Worker :: err: ${(0,Je.Nw)(e)}`,g=`${p}, workerResponseTime: ${performance.now()-c}ms, ${m}`;u?.setCoreContext("AppInfo.CDLState","Failed");const h=Vy(n);let v={errors:g,errorCode:t.workerCacheManager?e.code:d.O4.NotInitialized};if(s&&!l)try{if(!await r(a?o?.cdlSharedWorkerUrl:o?.cdlWebWorkerUrl,t.logger,h)){e.code=d.O4.ScriptLoadError;v={errors:"CDL Worker Script load error",errorCode:d.O4.ScriptLoadError}}}catch(t){e.code=d.O4.ScriptLoadError;v={errors:`CDL Worker Script load error :: ${t.message}`,errorCode:d.O4.ScriptLoadError}}const y=(0,Je.$5)("CDLWorkerManager",e.code,JSON.stringify(h),void 0,g);t.logger.errorToTelemetry?.(p,"cdl_worker_manager_handle_initialize_worker_manager_failure_error",{...(0,jv.w)(h),errorCode:y.code},!0),t.logger.errorToTelemetry?.(m,"cdl_worker_manager_handle_initialize_worker_manager_failure_error",{...(0,jv.w)(h),errorCode:y.code},!0),Hy(i),e&&e.code===d.O4.TimedOut?i.stop(v,"timeout"):i.fail(v);return t.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Failure",stepName:"CreateCDLWorker",error:g}),y}(i,t,e,c,o,n,u,!C,!!y,r,f);throw a}}(e,n,i,a,r,I,b,_,T,w,F,s,l,c,u,m,g,v,y,f).then((e=>k(e))).catch((e=>{A?.unsubscribe(),C(e)})).finally((()=>A?.unsubscribe()))})),Uy=e=>"electron"===e||"sharedworker"===e;function $y(e,t,n,i,a,o,r,s){const l=300*Tp.om,c=t||l,d=e(be.Cu.CentralDataLayerWorkerManagerStartup,c);let u=!0;r?.getUser&&(u=!1,r?.getUser().then((()=>u=!0)));const m=a?.setTimeout?.((()=>{u||(s?.warn("Worker startup - getUser is still not available. Cancelling Worker Scenario"),d.cancel({reason:"GetUser"}));(o?o.getState()?.state:dh.k.Up)===dh.k.InteractionRequired&&(s?.warn("Worker startup - User is in InteractionRequired state. Cancelling Worker Scenario"),d.cancel({reason:"InteractionRequired"})),Wy(n,i).then((e=>{d.appendEventData({errors:e})}))}),c-500);return{workerStartupScenario:d,workerStartupScenarioTimeout:m}}async function Wy(e,t){const n=e?"shared-worker":"web-worker";let i="";if(t)try{const e=await t.getWorkerStartupStatus(n);return"WorkerStartupStatus: "+(e?`lastError: ${JSON.stringify(e.lastError)}:: lastState: ${JSON.stringify(e.lastState)}`:"Unable to get CDL worker startup status")}catch(e){i=`Unable to get CDL worker startup status. Reason: ${(0,Je.Nw)(e)}`}else i="Unable to get CDL worker startup status. Reason: workerCacheManager is undefined";return i}function Vy(e){return{hostRendererId:e,component:"CDLWorkerManager"}}function Hy(e){e.appendEventData({"Thread.Id":"",threadId:""})}var zy=n(879647);class qy{constructor(e,t,n){this._cacheStorage=e,this._cacheName="cdl-worker-cache-manager",this.lastSavePromise=Promise.resolve(null),this.lastStartupStatusSequenceId=0,this.lastStartupStatus={createdTime:(new Date).getTime(),statusLogs:[]},this._logger=t,this._scenarioFactory=n}async save(e,t,n,i,a){let o="";try{if(!e)throw this._error("get","Invalid key");a?.appendEventData({context:i}),o=JSON.stringify(t),this._logger.log(`[CDLWorkerCacheManager]: Saving item to ${this._cacheName} key: ${e}`);const r=new Response(o),s=this._getScopedRequest(e,n,i);return await this._cacheStorage.put(s,r),a?.stop(),s.request.url}catch(t){const n=this._error("save",`[CDLWorkerCacheManager]: Failed to save object to cache, err: ${t?.message}, key: ${e}, experienceName: ${i}`);return this._logger.warnToTelemetry?.(n.message,"cdl_worker_cache_manager_save_error",{origin:e,context:i},!0),a?.fail({message:n.message,errorCode:n.name,errors:n.message}),null}}async get(e,t,n,i){try{if(!e)throw this._error("get","Invalid key");i?.appendEventData({context:n});const a=this._getScopedRequest(e,t,n),o=await this._cacheStorage.match(a);return o&&o.body?(i?.stop({cached:!0}),await o.json()):(this._logger.log(`[CDLWorkerCacheManager]: Get from cache for key ${e} could not find a result, returning null.`),i?.stop({cached:!1}),null)}catch(t){const a=this._error("get",`[CDLWorkerCacheManager]: Failed to get item from cache for key ${e}, err: ${t?.message}`);throw this._logger.errorToTelemetry?.(a.message,"cdl_worker_cache_manager_get_error",{origin:e,context:n},!0),i?.fail({errors:a.message,errorCode:a.code,message:a.message}),a}}async delete(e,t,n){try{if(!e)throw this._error("get","Invalid key");this._logger.log(`[CDLWorkerCacheManager]: Deleting item from cdl worker cache key: ${e}, experienceName: ${n}`);const i=this._getScopedRequest(e,t,n),a=await this._cacheStorage.delete(i);return Promise.resolve(a)}catch(t){const i=this._error("delete",`[CDLWorkerCacheManager]: Failed to delete item from cache key: ${e}, experienceName: ${n}, err: ${t?.message}`);return this._logger.errorToTelemetry?.(i.message,"cdl_worker_cache_manager_delete_error",{origin:e,context:n},!0),!1}}async clear(){try{return this._logger.log("[CDLWorkerCacheManager]: Clearing cdl-worker cache"),this._cacheStorage.clear(this._cacheName)}catch(e){const t=this._error("clear",`[CDLWorkerCacheManager]: Failed to clear the cache: ${this._cacheName}, err: ${e?.message}`);return this._logger.errorToTelemetry?.(t.message,"cdl_worker_cache_manager_clear_error",{origin:this._cacheName},!0),!1}}getCachedUrlByKey(e,t){return this._getScopedRequest(e,t).request.url}async saveWorkerStatusToCacheStorage(e){const t=this.lastStartupStatusSequenceId;return this.lastStartupStatusSequenceId++,"Failure"===e.state?this.lastStartupStatus.lastError=e:this.lastStartupStatus.lastState=e,this.lastStartupStatus.statusLogs.push({status:e,timestamp:(new Date).getTime(),sequenceId:t}),await this.lastSavePromise,this.lastSavePromise=this.save(zy.CB,this.lastStartupStatus,void 0),this.lastSavePromise}async getWorkerStartupStatus(e){return this.get(zy.CB,void 0,e)}saveWorkerVerboseLog(e){return this.save(zy.f5,e,void 0)}async getWorkerVerboseLog(e){try{const t=await this.get(zy.f5,void 0,e);return t||""}catch(e){return""}}async getAggregatedUserData(e){try{const t=this._scenarioFactory?.newScenario(be.Cu.MTMAAggregatorUserDataRead);return await this.get(`${zy.yb}/${e}`,void 0,"cdl-worker",t)}catch(e){return null}}async getGlobalUserData(){try{return await this.get(zy.V9,void 0,"cdl-worker")}catch(e){const t=this._error("getGlobalUserData",`[CDLWorkerCacheManager]: Failed to get global user data from cache, err: ${e?.message},`);return this._logger.errorToTelemetry?.(t.message,"cdl_worker_cache_manager_get_global_user_data_error",void 0,!0),null}}async getSecureGlobalUserData(){try{return await this.get(zy.hF,void 0,"cdl-worker")}catch(e){const t=this._error("getSecureGlobalUserData",`[CDLWorkerCacheManager]: Failed to get secure global user data from cache, err: ${e?.message},`);return this._logger.errorToTelemetry?.(t.message,"cdl_worker_cache_manager_get_secure_global_user_data_error",void 0,!0),null}}async getAllKeys(e){try{const t=await this._cacheStorage.keys(this._cacheName);if(e?.stop(),!t)return[];return t.map((e=>e.url))}catch(t){const n=this._error("getAllKeys",`[CDLWorkerCacheManager]: Failed to get all keys from cache, err: ${t?.message},`);return this._logger.warnToTelemetry?.(n.message,"cdl_worker_cache_manager_get_all_keys_error",{origin:this._cacheName},!0),e?.fail({message:n.message,errorCode:n.code,errors:n.message}),[]}}_error(e,t){return(0,Je.$5)("CDLWorkerCacheManager",d.O4.Undefined,e,void 0,t)}_getScopedRequest(e,t,n){return this._cacheStorage.createRequest(this._cacheName,`${this._cacheName}/${e}`,"Experience",t,!0,n)}}const Gy=(e,t,n)=>{try{const i=new qy(new kv(caches,"","",e),t,n);return i.delete(zy.CB,void 0,e),i}catch(e){return void t.error(`[createCDLWorkerCacheManager]: Error occurred while creating CDLWorkerCacheManager: ${(0,Je.Nw)(e)}`)}};async function Yy(e,t,n,i,a,o,r,s,l,d,u,m,p,g,h,v,y,S){const{workerStartScenarioTimeoutInMs:f}=o.get(c.w.CdlWorker),k=(e,t,n)=>a.newScenario(e,{callback:n,timeoutMs:t}),C=Gy(t.experienceName,i.newLogger("CDL:DataClientCoreWorkerManager","core-services-cdl-worker"),a),b=Ky(l,o),w=$y(k,f,Uy(b),C,e,m,r,d),T=S&&e.loader?.getCdlSharedWorkerUrl?e.loader?.getCdlSharedWorkerUrl():Zy(o,e,a,d),I=S&&e.loader?.getCdlWorkerUrl?e.loader?.getCdlWorkerUrl():void 0,N=Qy(l,o,a,e,d);w.workerStartupScenario.appendEventData({contentType:N.toString(),newState:"beforeBootstrapData"}),function(e,t,n,i){i.log(`Initializing workerType ${e} ${t?"as Worker host":`as non-Worker host with sharedWorkerUrl ${n}`}`)}(b,N,T,d);try{let a;if(N){const e=k(be.Cu.CentralDataLayerBootstrapData);try{a=await async function(e,t,n,i,a,o,r){o.mark("getBootstrapDataStart");const s=await async function(e,t,n,i,a,o){let r;a.appendEventData({newState:"beforeAuthUserData"});const s=1e4,l=o.get(c.w.CdlWorker).timeToGetUserFromAuthMs||s;try{r=await(0,yi.a)(e.getUser(),l)}catch(e){n.error(`Worker bootstrap authentication error - cannot authenticationService.getUser: ${e?.code}`)}if(!r)return{};const d=o.get(c.w.CdlWorker).disableReturningUnautheticatedUserFromBootstrapData;if(d&&!1===r.isAuthenticated)return n.infoToTelemetry?.("getAuthBootstrapData returned unauthenticated user","cdl_auth_get_bootstrap_data_returned_unauthenticated_user"),{};let u;a.appendEventData({newState:"beforeDiscoverUserData"});try{u=await(0,yi.a)(t.getUser((0,Wh.$q)("data-client-core-cdl-worker-utils:getAuthBootstrapData")),l)}catch(e){n.error(`Worker bootstrap authentication error - cannot discover.getUser: ${e?.code}`)}if(!u)return{userInformation:r};const m=u?.id;return{userInformation:r,userDetails:{userDetails:{licenseDetails:{...u,exploratoryTrialLicenseEndDate:Jy(u?.exploratoryTrialLicenseEndDate)},region:u?.region,userRegion:u?.userRegion,partition:u?.partition,userPartition:u?.userPartition,id:m},id:m},authState:i?.getState()?.state||dh.k.Up}}(e,t,n,i,o,r),l=r.get(c.w.CdlWorker).enableGtmTableInWorkerBootstrapData;l&&(o.mark("getGtmTable"),s.gtm=await async function(e,t,n,i){const a=3e3,o=t.get(c.w.CdlWorker).timeToGetGtmTableMs||a;try{return await(0,yi.a)(e.regionGtmTable?.()||Promise.resolve(void 0),o)}catch(e){i.mark("getGtmTableError",{errors:e?.code||"no error code"}),n.error(`Worker bootstrap authentication error - cannot get GTM table from Discover: ${e?.code}`)}return}(t,r,n,o),o.mark("getBootstrapDataComplete"));return{hostSettings:a.hostSettings,auth:s}}(r,s,d,m,n,e,o),e.stop()}catch(t){throw e.fail({error:"Unexpected error getting worker bootstrap data"}),t}}w.workerStartupScenario.appendEventData({newState:"beforeInitializeWorkerManagerFromDataClientCore"});const S=await async function(e,t,n,i,a,o,r,s,l,d,u,m,p,g,h,v,y,S,f,k){const{ring:C,environment:b}=u.get(c.w.Metadata),{enableWorkerBroadcast:w}=u.get(c.w.Telemetry),{sessionId:T}=u.get(c.w.Platform),{enablePassingPlatformIdInWorkerUrlHash:I}=u.get(c.w.Core),{enableChunkedWorker:N}=u.get(c.w.ExperienceLoader),{workerStartTimeoutInMs:A,workerStartScenarioTimeoutInMs:E,disablePingingPDSIfWorkerStartupFails:F,shouldDisableHealthCheckTimeout:_,enablePausingWorkerScenarioWhenAuthDoesNotHaveUser:D}=u.get(c.w.CdlWorker),{enableWorkerStoreDiagnosticsLogsInIDB:P}=u.get(c.w.Diagnostics),M=b?(0,we.get)($a.B,b):void 0;return v.workerStartupScenario.appendEventData({newState:"beforeInitializeWorkerManager",isChunked:!!N}),By(e,t,{logger:new Nv(s.newLogger("CDL:DataClientCoreWorkerManager","core-services-cdl-worker")),newScenario:h,offlineCacheManager:r,workerCacheManager:d,hostRendererId:e},{cdlSharedWorkerUrl:n||"",cdlWebWorkerUrl:i||""},A||void 0,E||void 0,a,o,{experienceName:a,ring:C?.id||void 0,environment:M,platformId:I?l.config.platformId:void 0,sessionId:T||void 0,buildVersion:l.config.buildVersion,localeCode:y,workerId:g,publicPath:m.__webpack_public_path__,preECSConsoleLogLevel:m.defaultConsoleLogLevel?.preECSConsoleLogLevel,userConsoleLogLevel:m.defaultConsoleLogLevel?.userConsoleLogLevel,deviceId:l.host.deviceId,telemetryWorkerBroadcast:!!w,useDiagnosticsServiceV2:!!P},S,m,p,v,!!F,f,!!_,k,!!D,!!N)}(t.clientId,b,T,I,t.experienceName,a,u,i,l,C,o,e,m,g,k,w,h,v,r,y);return!!o?.get(c.w.CdlWorker)?.enableUserContextWorkerRegistration&&(g&&a?.auth.userDetails?.id?p.mapUserIdToRegisteredWorker(g,a.auth.userDetails.id):d.errorToTelemetry?.(`Unable to register worker '${g}' to user through worker registrar for userId '${a?.auth.userDetails?.id}'`,"cdl_worker_init_register_user_context",{origin:g,userId:a?.auth.userDetails?.id},!0)),S}catch(e){return void d.errorToTelemetry?.(`Failed to start CDL Worker from DataClientCore: ${(0,Je.Nw)(e)}`,"cdl_services_worker_worker_service_start_client_core_cdl_worker_error",void 0,!0)}}const Qy=(e,t,n,i,a)=>{const o=Ky(e,t),r=Zy(t,i,n,a);return"webworker"===o||"web"===o||!r};function Jy(e){try{return e?.toISOString()}catch{return}}function Ky(e,t){let n=e.config.clientType===nt.sK.Web?"webworker":"sharedworker";const i=t.get(c.w.Host).cdlWorkerType,a=t.get(c.w.CdlWorker).cdlWorkerType;return i?n=i:a&&(n=a),n}function Zy(e,t,n,i){let{cdlSharedWorkerUrl:a}=e.get(c.w.Host);const o=t.localStorage.getItem("ts.cdlSharedWorkerJsUrl");if(a&&o&&a!==o){i.errorToTelemetry?.(`Worker URL saved in TSW:${a} is different from worker url in TMP:${o}`,"cdl_services_worker_worker_service_get_cdl_shared_worker_url_error",void 0,!0);n.newScenario(be.Cu.HostSettingsSync).fail({reason:JSON.stringify({cdlSharedWorkerUrl:a,storedWorkerUrl:o})}),a=o}return a}var Xy=n(478237);class eS extends xp{constructor(){super(d.c1.CreateCDLWorkerAppServiceTask,["windowProvider","scenarioFactory","coreSettings","platformService","loggerFactory"])}async execute(e){const t=(0,Xy.ZG)(e.coreSettings),n=!!e.coreSettings.get(c.w.CdlWorker).enableCdlAppStateService;if(!t||!n)return Promise.resolve();const i=new Iv(e);return e.cdlAppStateService=i,function(e,t,n,i,a,o,r){Qy(i,n,t,e,a)&&o.getCDLWorkerManager().then((e=>{e?.state.setState("appService:Loaded",r)}))}(e.windowProvider,e.scenarioFactory,e.coreSettings,e.platformService,e.loggerFactory.newLogger("CDLWorkerManager","core-services-tasks"),e.cdlWorkerService,i)}}class tS extends xp{constructor(){super(d.c1.CreateCDLWorkerAuthTask,["cdlWorkerRegistrarService","cdlWorkerService","scenarioFactory"])}async execute(e){const t=(0,Xy.ZG)(e.coreSettings),{cdlWorkerService:n,cdlWorkerRegistrarService:i,scenarioFactory:a}=e;if(t&&n){const{enableCleanUpOnLogout:t,enablePausingWorkerScenarioWhenAuthDoesNotHaveUser:o}=e.coreSettings.get(c.w.CdlWorker);if(o){const e=a.findScenario(be.Cu.CentralDataLayerWorkerManagerStartup);e?.isPaused&&e.resume({reason:"UserAuthenticated"})}if(function(e,t,n,i,a,o,r,s,l,c){Qy(o,n,t,e,r)&&s.getCDLWorkerManager().then((e=>{e?.state.setState("authLoaded",{authenticationService:i,discover:a,authStateProvider:c,cdlWorkerRegistrarService:l})}))}(e.windowProvider,e.scenarioFactory,e.coreSettings,e.authenticationService,e.discover,e.platformService,e.loggerFactory.newLogger("CDLWorkerManager","core-services-tasks"),n,i,e.authStateProvider),!t)return;return async t=>{"signout"===t&&await n.logoutCurrentUser(e.coreSettings)}}}}class nS{constructor(e,t,n,i){this.cdlWorkerService=i,this._logger=n.newLogger("CDLWorkerStateSender","core-services-cdl-worker"),this._clientStateSubscription=e.observe().subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:iy.NotifyCoreClientState,context:{appState:e}}))),this._machineLockStateSubscription=t.observe().pipe((0,Tg.F)(((e,t)=>e.machineLockState===t.machineLockState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:iy.NotifyCoreMachineState,context:{appState:e.machineLockState}}))),this._suspendedStateSubscription=t.observe().pipe((0,Tg.F)(((e,t)=>e.suspendedState===t.suspendedState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:iy.NotifyCoreSuspendedState,context:{appState:e.suspendedState}}))),this._machineIdleStateSubscription=t.observe().pipe((0,Tg.F)(((e,t)=>e.machineIdleState===t.machineIdleState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:iy.NotifyCoreMachineIdleState,context:{appState:e.machineIdleState}})))}dispose(){this._clientStateSubscription&&(this._clientStateSubscription.unsubscribe(),this._clientStateSubscription=void 0),this._machineLockStateSubscription&&(this._machineLockStateSubscription.unsubscribe(),this._machineLockStateSubscription=void 0),this._suspendedStateSubscription&&(this._suspendedStateSubscription.unsubscribe(),this._suspendedStateSubscription=void 0),this._machineIdleStateSubscription&&(this._machineIdleStateSubscription.unsubscribe(),this._machineIdleStateSubscription=void 0)}async sendAppStateChangeToWorker(e){const t=(0,ge.hR)(e);let n;try{n=await this.getCdlAppStateClient()}catch{return void this._logger.errorToTelemetry?.(`Failed to send app state change ${t} to CDL. Reason: failed to obtain a CDLAppStateClient. See initialization failures earlier in the logs.`,"cdl_services_worker_worker_state_sender_send_app_state_get_client_error",void 0,!0)}if(n){this._logger.log(`Alerting CDL Worker of host state change: ${t}`);try{await n.sendFilteredAppStateRequest(e)}catch(e){this._logger.errorToTelemetry?.(`Failed to send app state change ${t} to CDL. Reason: ${(0,ge.hR)(e)}`,"cdl_services_worker_worker_state_sender_send_app_state_send_request_error",void 0,!0)}}else this._logger.errorToTelemetry?.(`Failed to send app state change ${t} to CDL. Reason: CDLAppStateClient does not exist. See initialization failures earlier in the logs.`,"cdl_services_worker_worker_state_sender_send_app_state_get_client_undefined_error",void 0,!0)}async getCdlAppStateClient(){const e=await this.cdlWorkerService.getCDLWorkerManager();return e?.workerClientResponseRouter.cdlAppStateClient}}class iS extends Qv{constructor(e,t){super(),this.workerClientResponseRouter=e,this.logger=t.loggerFactory.newLogger("CDLControlPlaneCommunicator","cdl-control-plane-communicator")}sendMessage(e){this.getRequestForOperationName(e).then((t=>this.handleResponse(e.rendererId,e.requestId,t.response,this.extractPerfStats(t)))).catch((t=>this.handleResponse(e.rendererId,e.requestId,!1,void 0,(0,ge.hR)(t)||"Unknown Error")))}getRequestForOperationName(e){const t=e.operationName;if(!t)return Promise.reject(`Request could not be sent: operationName unavailable. RequestId: ${e.requestId}.`);switch(this.logger.log(`Converting GQL operation ${t} to CDL Worker control plane message.`),t){case"notifyWorkerSyncCanStart":return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"sync_can_start"});case"AppsChatNotifyActiveContextChangedMutation":const t=e.request.variables;return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"active_context_changed",activeContextChangedData:t});case"ComponentsHostedWebContentRequestMessageChannelPortMutation":const n=e.request.variables;return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"request_message_channel_port",messageChannelPortRequestData:n});case"ComponentsHostedWebContentCloseMessageChannelPortMutation":const i=e.request.variables;return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"close_message_channel_port",messageChannelPortRequestData:i})}}handleResponse(e,t,n,i,a){return Promise.resolve(this.onResponseReceived({payload:{dataLayer:{rendererId:e,requestId:t,data:n,errors:a,extensions:{perfStats:i}}}}))}extractPerfStats(e){return{workerResponseTime:e.workerResponseTime||0,dataStorePerfStats:[]}}}var aS=n(449505),oS=n(163166),rS=n(251361);class sS{constructor(e,t,n,i,a,o,r,s,l){this.configLoader=e,this.coreSettingsContext=n,this.platformService=a,this.primaryUser=o,this.locale=r,this.osLocale=s,this.osLocaleInfo=l,this._settings={},this.logger=i.newLogger("CDLWorkerHostSettingsAggregator","core-services-cdl-worker"),this.coreSettings=t,this.cdlWorkerSettingsAllowlist=this.getCdlWorkerSettingsAllowlist()}get hostSettings(){return 0===Object.keys(this._settings).length&&(this._settings=this.getAllWorkerSettings()),this._settings}startNotifyingCDLWorkerForHostSettingsChanges(e){const t=this.coreSettings.getObservableForAnySettingsChangeForCdlWorker();this.settingsChangedSubscription=t.subscribe((()=>{this.notifyCDLWorkerForSettingsChanges(e)})),this.startNotifyingCDLWorkerForHostSettingsChangesCallback=()=>this.startNotifyingCDLWorkerForHostSettingsChanges(e)}cleanup(){this.settingsChangedSubscription?.unsubscribe(),this.settingsChangedSubscription=void 0}updateCoreSettingsContextIfNeeded(e){this.coreSettingsContext.id!==e.id&&(this.cleanup(),this.coreSettingsContext=e,this.coreSettings=e.getCoreSettings(),this.startNotifyingCDLWorkerForHostSettingsChangesCallback?.())}notifyCDLWorkerForSettingsChanges(e){const t=this.getAllWorkerSettings();(0,we.isEqual)(this._settings,t)||(this._settings=t,this.logger.log("Notifying CDL Worker of host settings changes: ",t),e.sendRequest({type:"host_settings_updated",hostSettings:t}))}getCdlWorkerSettingsAllowlist(){const{cdlWorkerOnly:e={},forwardToCdlWorker:t={}}=this.coreSettings.getCdlWorkerSettingsAllowlist()??{},n=[...new Set([...Object.keys(e),...Object.keys(t)])];return Object.fromEntries(n.map((n=>[n,[...new Set([...e[n]||[],...t[n]||[]])]])))}getAllWorkerSettings(){const e=this.getCdlWorkerSettings();return{...e,[c.w.Host]:(0,we.mergeWith)(e.host||{},this.aggregateHostSettings(),oS.L)}}aggregateHostSettings(){this.logger.debug("aggregateHostSettings called...");const{enableNetworkStateCommsBetweenCoreAndWorker:e,enableMTMA:t}=this.coreSettings.get(c.w.Core),{electronVersion:n,enableHybridChannelList:i=!1,msgEnableChannelsV2:a=!1,msgEnableChannelsV2Header:o=!1,msgEnableSelfChat:r=!1,userType:s="",windowsInsiderChannel:l}=this.coreSettings.get(c.w.Host),u=this.coreSettingsContext,{enableTPSSyncStrategy:m,enableTPSUpdatesOverTrouter:p,tpsSyncStrategyPollingIntervalMs:g,enablePinnedChannelUpdatesOverTPS:h}=this.coreSettings.get(c.w.CdlWorker);let v={enableNetworkStateCommsBetweenCoreAndWorker:!!e,enableMTMA:!!t,policiesNamespaces:(0,rS.Dq)(this.configLoader,this.coreSettings),enableSyncEngine:(0,Xy.ZG)(this.coreSettings),enableProfileManagerStore:(0,Xy.Pq)(this.coreSettings),enableMessagingNotificationsOverTrouter:this.isMessagingNotificationsOverTrouterEnabled(),imageCookieAuthEnabled:!this.coreSettings.get(c.w.Auth).skipAmsAuthRequest,msgEnableChannelsV2:a,msgEnableChannelsV2Header:o,msgEnableSelfChat:r,enableHybridChannelList:i,enableEspInWorker:!!this.coreSettings.get(c.w.Esp).enableEsp,espIrisExperimentFlightIds:this.coreSettings.get(c.w.Esp).espIrisExperimentFlightIds,espIrisPlacementId:this.coreSettings.get(c.w.Esp).espIrisPlacementId,ecsHostUrl:this.platformService.ecsOverrides.hostUrl,desktopVersion:this.platformService.host.hostAppVersion,initialWorkerHostLocationUrl:this.platformService.config.currentUrl,serviceSwitcherSelectedServiceId:u.getServiceSwitcherApiKey(),electronVersion:n,locale:this.locale||d.Xn,osLocale:this.osLocale,osLocaleInfo:this.osLocaleInfo,userType:s,windowsInsiderChannel:l,enableTPSSyncStrategy:!!m,enableTPSUpdatesOverTrouter:!!p,enablePinnedChannelUpdatesOverTPS:!!h,tpsSyncStrategyPollingIntervalMs:g,...this.getCdlWorkerHostSettings(this.coreSettings),...this.getActivityHostSettings(this.coreSettings),...this.getActivityNotificationHostSettings(this.coreSettings),...this.getEndpointsHealthHostSettings(this.coreSettings),...this.getPeopleHostSettings(this.coreSettings),...this.getMessagingHostSettings(this.coreSettings),...this.getTeamsAndChannelsHostSettings(this.coreSettings),...this.getCalendarHostSettings(this.coreSettings),...this.getExternalAccountHostSettings(this.coreSettings),...this.getPresenceHostSettings(this.coreSettings),...this.getDataStoreHostSettings(this.coreSettings),...this.getFilesHostSettings(this.coreSettings),...this.getAuthHostSettings(this.coreSettings),...this.getDiscoverSurfaceHostSettings(this.coreSettings),...this.getMtmaSpecificHostSettings(),...this.getGuardiansHostSettings(this.coreSettings)},y=this.getCoreSettingsTestOverrides(this.coreSettingsContext);const{isRunningGlassjar:S}=this.coreSettings.get(c.w.Test);if(this.platformService.config.isInCypressFrame||S){const e={authOverrides:{authzEndpointUrl:this.coreSettings.get(c.w.Auth).authzEndpointUrl},csaOverrides:{csaHostUrl:this.coreSettings.get(c.w.CsaService).apiConstants?.host}};v={...v,...e},y={localStorageTestOverrides:{...y.localStorageTestOverrides,test:{}},qspTestOverrides:y.qspTestOverrides}}return{...v,...y}}getCdlWorkerSettings(){const e=this.getAllowlistedCdlWorkerSettings(),t=this.getAllowlistedCdlWorkerSettingsByOverrides(),n={[c.w.Messaging]:{allowUserChat:this.getAllowUserChat(this.coreSettings)},[c.w.Calling]:{callGroupMembershipSettings:this.coreSettings.get(c.w.Calling).voiceAdminSettings?.callGroupMembershipSettings}};return this.mergeSettings(e,t,n)}getAllowlistedCdlWorkerSettings(){return this.getCdlWorkerSettingsForAllowlist(this.cdlWorkerSettingsAllowlist)}getAllowlistedCdlWorkerSettingsByOverrides(){const e=this.coreSettings.get(c.w.Core).forwardCdlWorkerSettingsOverrides||[],t={};return e.forEach((e=>{const n=e.category,i=e.featureFlag,a=t[n]||[];void 0===t[n]&&(t[n]=a),a.push(i)})),this.getCdlWorkerSettingsForAllowlist(t)}getCdlWorkerSettingsForAllowlist(e){const t=this.coreSettings.getAllCachedSettings(),n={};return Object.keys(e).forEach((i=>{const a=t[i]??{},o={};e[i]?.forEach((e=>{const t=(0,we.get)(a,e);(0,we.isNil)(t)||(0,we.set)(o,e,t)})),Object.keys(o).length>0&&(n[i]=o)})),n}mergeSettings(...e){const t=Object.values(c.w);return Object.fromEntries(t.map((t=>[t,(0,we.merge)({},...e.map((e=>e[t])))])).filter((e=>Object.keys(e[1]).length>0)))}getAllowUserChat(e){const{allowUserChat:t,messagingPolicy:n}=e.get(c.w.Messaging);return"boolean"==typeof t||!!n?!!t:void 0}getPresenceHostSettings(e){const{enablePresenceInWorker:t,enablePresenceNotificationsOverTrouter:n,enableReportingUserActivityThroughTrouterByPresence:i,enablePriorityContactsSettings:a,enableSendPresenceTokenToUPS:o,upsTrouterConnectEndpointRecreateDelayInMs:r,priorityContactsRefreshIntervalInMs:s}=e.get(c.w.Presence);return{enablePresenceInWorker:Boolean(t),enablePresenceNotificationsOverTrouter:Boolean(n),enableReportingUserActivityThroughTrouterByPresence:Boolean(i),enablePriorityContactsSettings:Boolean(a),enableSendPresenceTokenToUPS:Boolean(o),upsTrouterConnectEndpointRecreateDelayInMs:r??0,priorityContactsRefreshIntervalInMs:s??0}}getAuthHostSettings(e){const{skypeTokenValidationDisabled:t}=e.get(c.w.Auth);return{skypeTokenValidationDisabled:!!t}}getCdlWorkerHostSettings(e){const t=e.get(c.w.CdlWorker);return{enableClassBasedErrors:!!t.enableClassBasedErrors,enablePoliciesSyncEngine:!!t.enablePoliciesSyncEngine,enableCrossTenantPoliciesSyncEngine:!!t.enableCrossTenantPoliciesSyncEngine,enableOpenWindowsSettingsMaglev:!!t.enableOpenWindowsSettingsMaglev,enableSendNudgeAfterInactivityPeriod:!!t.enableSendNudgeAfterInactivityPeriod,enableMeetNowLinksReminder:!!t.enableMeetNowLinksReminder,enableNotificationsEngine:!!t.enableNotificationsEngine,enableAppsUsageSyncEngine:!!t.enableAppsUsageSyncEngine,enableUserPreferencesWorkerFetch:!!t.enableUserPreferencesWorkerFetch,enableAppsPlatformSyncEngine:!!t.enableAppsPlatformSyncEngine,enableAppsPlatformTrouterUpdates:this.isMessagingNotificationsOverTrouterEnabled()&&!!t.enableAppsPlatformTrouterUpdates,enableChatWithUserNetworkFetch:!!t.enableChatWithUserNetworkFetch,enableOfflineActionsSyncEngine:!!t.enableOfflineActionsSyncEngine,enableStartupDeferral:!!t.enableStartupDeferral,enableTenantSyncStrategy:!!t.enableTenantSyncStrategy,enableSearchTopNPopulateStrategy:!!t.enableSearchTopNPopulateStrategy,enableSensitivityLabelSync:!!t.enableSensitivityLabelSync,enableWaitOnAuthUp:!!t.enableWaitOnAuthUp,enableStartupUsingPartialData:!!t.enableStartupUsingPartialData,chatsStartupJobPageSize:t.chatsStartupJobPageSize,chatListCacheDaysThreshold:t.chatListCacheDaysThreshold,partialDataStartupChatsLimit:t.partialDataStartupChatsLimit,partialDataStartupSkipNonRecentMeeting:t.partialDataStartupSkipNonRecentMeeting,skipMeetingChatsInGroupChatSync:!!t.skipMeetingChatsInGroupChatSync,enableChatTitleCache:!!t.enableChatTitleCache,enableMruChannelsMemoryPruning:!!t.enableMruChannelsMemoryPruning,disableUnknownTitleFallback:!!t.disableUnknownTitleFallback,disableTitleCacheRefreshOnDisplayNameChange:!!t.disableTitleCacheRefreshOnDisplayNameChange,disablePartialLoadConversationNetworkFetch:!!t.disablePartialLoadConversationNetworkFetch,enableMultipleReplyChainsUpdatesFromWorker:!!t.enableMultipleReplyChainsUpdatesFromWorker,enableMTMAAggregator:!!t.enableMTMAAggregator,disablePingingPDSIfWorkerStartupFails:t.disablePingingPDSIfWorkerStartupFails,currentConversationTableVersion:t.currentConversationTableVersion,disableMessageContentWrapperDiv:t.disableMessageContentWrapperDiv,enablePriorityJobRunner:!!t.enablePriorityJobRunner,scheduleChannelsConversationSyncAtBackgroundPriority:!!t.scheduleChannelsConversationSyncAtBackgroundPriority,trouterNotifyServiceDownTimerMs:t.trouterNotifyServiceDownTimerMs,chatServiceMaxPageSize:t.chatServiceMaxPageSize,chatReplyChainsToFetch:t.chatReplyChainsToFetch,preloadNamespaces:t.preloadNamespaces}}getActivityHostSettings(e){const t=e.get(c.w.Activity);return{enableActivityManagerStore:!!t.enableActivityManagerStore,enableActivityBellCount:!!t.enableActivityBellCount,feedItemsCountOnAppLoad:t.paginationFirstLoad||0,enableOrderFeedsReplyChainsByMaxVersion:!!t.enableOrderFeedsReplyChainsByMaxVersion,enableChannelFeedItems:!!t.enableChannelFeedItems,enableActivityTranslationInCDL:!!t.enableActivityTranslationInCDL,enableMarkAllAsReadLogic:!!t.enableMarkAllAsReadLogic,enableSharedChannelFeedItems:!!t.enableSharedChannelFeedItems,enableUrgentFeedItems:!!t.enableUrgentFeedItems,enableSyntheticNotificationProcessor:!!t.enableSyntheticNotificationProcessor,enableGraphFeedItems:!!t.enableGraphFeedItems,disableIncomingPstnActivityFeed:!!t.disableIncomingPstnActivityFeed,enableMTMAMissedNotifications:!!t.enableMTMAMissedNotifications,mtmaNotificationsPollingInterval:t.mtmaNotificationsPollingInterval||sS.mtmaNotificationsPollingIntervalDefault}}getActivityNotificationHostSettings(e){const{enableNewSettingsApiUse:t,enableMissedActivityEmails:n}=e.get(c.w.ActivityNotification);return{enableNewSettingsApiUse:!!t,enableMissedActivityEmails:!!n}}getPeopleHostSettings(e){const t=e.get(c.w.People);return{enableBuddyListService:!!t.enableBuddyListService,buddyListRefreshTimeoutInMilliSeconds:t.buddyListRefreshTimeoutInMilliSeconds||0,blockedListRefreshIntervalInMs:t.blockedListRefreshIntervalInMs||0,blockedListPendingActionQueueChunkSize:t.blockedListPendingActionQueueChunkSize||0,enableContactsSync:!!t.enableContactsSync,enableMultipleAliasesForContactsSync:!!t.enableMultipleAliasesForContactsSync,maxNumberOfRoamingDevices:t.maxNumberOfRoamingDevices||0,enableInstantSyncForRoamingDevices:!!t.enableInstantSyncForRoamingDevices,fetchTFLContactsRefreshInterval:t.fetchTFLContactsRefreshInterval||[],enableEndpointsManagerOnAcceptListService:!!t.enableEndpointsManagerOnAcceptListService,enableEndpointsManagerOnBuddyService:!!t.enableEndpointsManagerOnBuddyService,enableEndpointsManagerOnBlockService:!!t.enableEndpointsManagerOnBlockService,contactsSyncDeltaRefreshIntervalInMs:t.contactsSyncDeltaRefreshIntervalInMs||0,contactsSyncFullRefreshIntervalInMs:t.contactsSyncFullRefreshIntervalInMs||0,contactsSyncKeepAliveIntervalInMs:t.contactsSyncKeepAliveIntervalInMs||0,maxBatchSizeforSCDDeletion:t.maxBatchSizeforSCDDeletion||0,lokiTokenResourceUrl:t.lokiTokenResourceUrl||"",buddyServiceEndpointManagerMaxRetries:t.buddyServiceEndpointManagerMaxRetries||0,enableTflTfwFederation:!!t.enableTflTfwFederation,enableProfilePicturesWithObjectId:!!t.enableProfilePicturesWithObjectId,enableMeProfileSyncStrategy:!!t.enableMeProfileSyncStrategy,checkProfileExpiryAndRefreshIntervalInMs:t.checkProfileExpiryAndRefreshIntervalInMs||0,enableTfwToTfwFederatedInviteFree:!!t.enableTfwToTfwFederatedInviteFree,enableBlockedContactsDataStore:!!t.enableBlockedContactsDataStore,enableM365Endpoint:!!t.enableM365Endpoint,enableExtendedDirectory:!!t.enableExtendedDirectory,enableCapiv3ContactsSync:!!t.enableCapiv3ContactsSync,enableSharedChannelPeoplePickerErrorMessages:!!t.enableSharedChannelPeoplePickerErrorMessages,enableProfileFetchFromWorkingSet:!!t.enableProfileFetchFromWorkingSet,enableAtMentionEveryoneInGroupChat:!!t.enableAtMentionEveryoneInGroupChat,enableAtMentionEveryoneInMeetingChat:!!t.enableAtMentionEveryoneInMeetingChat,enableAddAnonDisplayNameTagsInProfile:!!t.enableAddAnonDisplayNameTagsInProfile}}getMessagingHostSettings(e){const t=e.get(c.w.Messaging);return{enableChatWithNonTflUsers:!!t.enableChatWithNonTflUsers,enableCSAChatSummarization:!!t.enableCSAChatSummarization,enableCSAChatSummarizationV2:!!t.enableCSAChatSummarizationV2,chatSummarizationTimeoutOverride:t.chatSummarizationTimeoutOverride,enableTflSmsCreate:!!t.enableTflSmsCreate,enableTfwTflFederation:!!t.enableTfwTflFederation,enableTfwFederationOnTfl:!!t.enableTfwFederationOnTfl,enableTFLSmsFriendlyNameSearch:!!t.enableTFLSmsFriendlyNameSearch,tflSmsAllowedPhoneNumberRegionCodes:t.tflSmsAllowedPhoneNumberRegionCodes||[],disableMessagingSyncEngine:!!t.disableMessagingSyncEngine,enableAutoSendV2:!!t.enableAutoSendV2,disableRendererSideSanitization:!!t.disableRendererSideSanitization,enableTranslationSettings:!!t.enableTranslationSettings,enableSingleInbox:!!t.enableSingleInbox,enableTagsMention:!!t.enableTagsMention}}getTeamsAndChannelsHostSettings(e){const t=e.get(c.w.Channels),n=e.get(c.w.TeamsAndChannels);return{enablePinnedChannelsSyncEngine:!!n.enablePinnedChannelsSyncEngine,maximumPinnedChannelLimit:n.maximumPinnedChannelLimit,pinnedChannelsSyncIntervalInMs:n.pinnedChannelsSyncIntervalInMs,enableFixingPinnedChannelsConflict:!!n.enableFixingPinnedChannelsConflict,enableUserResolutionForChannelModeratorList:!!n.enableUserResolutionForChannelModeratorList,enableRecommendedTeamsSync:!!n.enableRecommendedTeamsSync,allowChannelSharingToExternalUser:!!n.allowChannelSharingToExternalUser,enableChannelInfoPane:!!t.enableChannelInfoPane,enableUseT1LocaleInTranslation:!!t.enableUseT1LocaleInTranslation,enableChannelsUserResolutionInT21:!!t.enableChannelsUserResolutionInT21,allowGuestUser:!!n.allowGuestUser}}getCalendarHostSettings(e){const t=e.get(c.w.Calendar);return{autodiscoverSettings:t.autodiscoverSettings,calendarRESTEnabledAPIs:t.calendarRESTEnabledAPIs,connectedCalendarSettingsRefreshIntervalInMs:t.connectedCalendarSettingsRefreshIntervalInMs||0,enableCalendarSyncEngine:!!t.enableCalendarSyncEngine,enableCalendarV2ApiService:!!t.enableCalendarV2ApiService,enableCalendarV2ApiServiceEnterprise:!!t.enableCalendarV2ApiServiceEnterprise,enableCalendarManagerPrefetchInMemoryData:!!t.enableCalendarManagerPrefetchInMemoryData,enableClientStateCheckForCalendarPolling:!!t.enableClientStateCheckForCalendarPolling,enableMultipleCalendarSyncEngine:!!t.enableMultipleCalendarSyncEngine,enableUnifiedCalendarSyncEngine:!!t.enableUnifiedCalendarSyncEngine,enableConnectedCalendar:!!t.enableConnectedCalendar,enableConnectedCalendarSettingsSync:!!t.enableConnectedCalendarSettingsSync,enableCourseCalendarSyncEngine:t.enableCourseCalendarSyncEngine,enableEventFetchOptimizationUsingLastSync:t.enableEventFetchOptimizationUsingLastSync,enableMeetingArtifactsCollaborationData:t.enableMeetingArtifactsCollaborationData,enablePrefetchCourseCalendarEventsOnStartUp:t.enablePrefetchCourseCalendarEventsOnStartUp,isOnCloud:t.isOnCloud,maxRoomListsToFetch:t.maxRoomListsToFetch,maxRoomsInRoomListToFetch:t.maxRoomsInRoomListToFetch,maxRoomsToFetch:t.maxRoomsToFetch,enableThirdPartyCalendar:!!t.enableThirdPartyCalendar,calendarEventsPollIntervalInMs:t.calendarEventsPollIntervalInMs,calendarEventsPollIntervalWithPushInMs:t.calendarEventsPollIntervalWithPushInMs,isLmsCourseCalendar:!!t.isLmsCourseCalendar,enablePrefetchCalendarEventsOnStartUp:!!t.enablePrefetchCalendarEventsOnStartUp,enableSensitivityLabelInCalendar:!!t.enableSensitivityLabelInCalendar,enableCalendarPushNotifications:!!t.enableCalendarPushNotifications,enableCalendarPollingWithPushNotifications:!!t.enableCalendarPollingWithPushNotifications,enableCalendarGCVOptimizations:!!t.enableCalendarGCVOptimizations,enableCalendarMailBoxDiscoveryHandler:!!t.enableCalendarMailBoxDiscoveryHandler,enablePushCalendarEventsOnSubscription:!!t.enablePushCalendarEventsOnSubscription}}getExternalAccountHostSettings(e){const{enableExternalAccounts:t,requestSource:n,enableUnifiedHardDelete:i}=e.get(c.w.ExternalAccounts);return{enableExternalAccounts:!!t,requestSource:n,enableUnifiedHardDelete:!!i}}getEndpointsHealthHostSettings(e){const{enableWorkerEndpointsHealthMonitor:t,enableWorkerEndpointsHealthService:n}=e.get(c.w.Core);return{enableWorkerEndpointsHealthMonitor:!!t,enableWorkerEndpointsHealthService:!!n}}getDataStoreHostSettings(e){const t=e.get(c.w.CdlWorker);return{enableDbOpenTimeout:!!t.enableDbOpenTimeout,dbOpenTimeoutLengthSeconds:t.dbOpenTimeoutLengthSeconds||60,dataStoreMapType:t.dataStoreMapType||"",disableDataStoreInMemoryProvider:!!t.disableDataStoreInMemoryProvider,disableDataStoreDbProvider:!!t.disableDataStoreDbProvider,rollbackSupportInDataStoreInMemoryProvider:!!t.rollbackSupportInDataStoreInMemoryProvider,disableReplyChainManagerPrefetch:!!t.disableReplyChainManagerPrefetch,dataStoreCreationResiliencyConfig:t.dataStoreCreationResiliencyConfig||{enable:!1},disableRetryOnStoreMissing:!!t.disableRetryOnStoreMissing,dataStoreDbOperationResiliencyConfig:t.dataStoreDbOperationResiliencyConfig,enableConversationTypeIndex:!!t.enableConversationTypeIndex}}getCoreSettingsTestOverrides(e){const t=e;return{localStorageTestOverrides:t.getLocalStorageTestOverrides()||{},qspTestOverrides:t.getQspTestOverrides()||{}}}getFilesHostSettings(e){const{preferGraphOverVroom:t,vroomEndpointBaseUrl:n,graphEndpointBaseUrl:i,graphAuthScope:a,vroomAuthScope:o}=e.get(c.w.Files);return{filesOverrides:{preferGraphOverVroom:!!t,vroomEndpointBaseUrl:n||"",graphEndpointBaseUrl:i||"",graphAuthScope:a||"",vroomAuthScope:o||""}}}getDiscoverSurfaceHostSettings(e){const t=e.get(c.w.DiscoverSurface);return{enableHybridDiscoverSurface:!!t.enableHybridDiscoverSurface,discoverSurfaceTopItemsCount:t.discoverSurfaceTopItemsCount||aS.N_.defaultItemsToFetch,enableNewPollingChanges:!!t.enableNewPollingChanges,disableDiscoverNetworkCall:!!t.disableDiscoverNetworkCall,discoverSurfaceDefaultSection:t.discoverSurfaceDefaultSection||aS.N_.defaultSection,enableDiscoverSurfaceDebugMenu:!!t.enableDiscoverSurfaceDebugMenu,serverCacheRetentionTimeInHrsSinceFirstCall:t.serverCacheRetentionTimeInHrsSinceFirstCall||aS.N_.defaultServerCacheRetentionTimeInHrsSinceFirstCall,enableDiscoverBadging:!!t.enableDiscoverBadging,dataSyncIntervalTime:t.dataSyncIntervalTime||aS.N_.defaultDataSyncIntervalTime,enableDiscoverSurfaceSyncEngine:!!t.enableDiscoverSurfaceSyncEngine}}getMtmaSpecificHostSettings(){const{enableMTMA:e}=this.coreSettings.get(c.w.Core);return e&&this.primaryUser&&this.primaryUser.profile?{primaryUserProfile:{oid:this.primaryUser.profile.objectId,tid:this.primaryUser.profile.tenantId}}:{}}isMessagingNotificationsOverTrouterEnabled(){const e=this.coreSettings.get(c.w.Host).enableMessagingNotificationsOverTrouter;return(0,we.isNil)(e)?!!this.coreSettings.get(c.w.CdlWorker).enableMessagingNotificationsOverTrouter:e}getGuardiansHostSettings(e){const{enableGuardiansPreferredMethodAndSmsInvite:t}=e.get(c.w.Guardians);return{enableGuardiansPreferredMethodAndSmsInvite:t}}}sS.mtmaNotificationsPollingIntervalDefault=3e5;class lS{constructor(){this.perfDataByOperationName=new Map,this.cdlSubscriptionAggregatorAllowList=["chatServiceEvent","DataResolversBrowserChatServiceEventsChatServiceBatchEventSubscription","DataResolversBrowserChatServiceEventsChatServiceEventSubscription"]}static getInstance(){return this.subscriptionEventAggregatorSingleton||(this.subscriptionEventAggregatorSingleton=new lS),this.subscriptionEventAggregatorSingleton}init(e,t,n,i){this.logger=e.newLogger("SubscriptionEventAggregator","core-cdl-data-layer-client"),n&&(this.cdlSubscriptionAggregatorAllowList=n),this.logger?.log(`Initialized CDLSubscriptionEventAggregator Allow List: ${this.cdlSubscriptionAggregatorAllowList.join(",")}`),this.intervalCancellationToken=setInterval((()=>{this.logStats(t)}),i||Tp.Kv)}addToTimeline(e,t,n,i,a,o,r){if(this.intervalCancellationToken||this.init(n,i,a,r),!t)return void(this.logger&&this.logger.log("Received subscription perf stat without responseSendTime. Ignoring."));const s=Date.now()-t;if(!(s<0)&&(e&&!this.perfDataByOperationName.has(e)&&this.perfDataByOperationName.set(e,{ipcTimes:[],customIdentifierCount:{}}),e)){const t=this.perfDataByOperationName.get(e);if(!t)return void(this.logger&&this.logger.warn(`SubscriptionEventAggregator: No perf data found for operationName ${e}`));if(t.ipcTimes.push(s),o){let e={};e="string"==typeof o?{[o]:1}:o,Object.keys(e).forEach((n=>{const i=e[n];t.customIdentifierCount[n]||(t.customIdentifierCount[n]=0),t.customIdentifierCount[n]+=i}))}}}logStats(e){const t=Array.from(this.perfDataByOperationName.entries());this.perfDataByOperationName.clear();for(const[n,i]of t){if(!this.cdlSubscriptionAggregatorAllowList.includes(n))continue;const t={operationName:n,numberOfRequests:i.ipcTimes.length,averageIPCTimeOneWay:i.ipcTimes.reduce(((e,t)=>e+t),0)/i.ipcTimes.length},a=e.newScenario(be.Cu.CentralDataLayerSubscription);(0,we.keys)(i.customIdentifierCount).forEach((e=>{a.mark(e,{size:i.customIdentifierCount[e],type:e})})),a.stop(t)}}}function cS(e,t,n,i){e.measure(t,n,i),e.clearMeasures(t),e.clearMarks(n),i&&e.clearMarks(i)}class dS{constructor(e,t,n){this.isResponse=t,this.internalPerfStat={operationName:n,requestStartTime:{perf:performance.now(),date:Date.now()},responseReceivedTime:{perf:performance.now(),date:Date.now()},workerResponseTime:0,dataStorePerfStats:[]},this.operationName=n||"",this.operationType=e,performance.mark(`${this.getPerformanceName()}-start`)}stopMeasurement(e,t,n){this.internalPerfStat={...this.internalPerfStat,...e,responseReceivedTime:{perf:performance.now(),date:Date.now()}};const i=this.getPerformanceName(),a=`${i}-start`,o=`${i}-end`;!function(e,t){void 0===function(e,t){const n=t.getEntriesByName(e);if(n&&n.length>0)return n[0]}(e,t)&&t.mark(e)}(a,performance),performance.mark(o),cS(performance,i,a,o);const{requestStartTime:r,requestReceivedTime:s,responseSendTime:l,responseReceivedTime:c,workerResponseTime:d}=this.internalPerfStat,u={totalRequestTime:Math.round(c.perf-r.perf),workerResponseTime:Math.round(d),requestTime:Math.round(r.perf),responseTime:Math.round(c.perf)};return t?.length&&(u.otherResponsesReceivedWhileInTransit=t),n&&(u.responseReceiveLatency=n),s&&(u.requestIPCTime=s-r.date),l&&(u.responseIPCTime=c.date-l),u}static markSubscriptionRequest(e){const t=`subscription_request_start_${e}`,n=`subscription_request_${e}`;performance.mark(t),cS(performance,n,t)}static addSubscriptionResponse(e,t,n,i,a,o,r){lS.getInstance().addToTimeline(e,t,n,i,o,a,r)}getPerformanceName(){return`cdl-${this.isResponse?"response":"request"}-${this.operationName||this.operationType}`}}const uS=["callParticipantsVoiceLevelsChangedEvent","callParticipantsChangedEvent"],mS=["callingIntent","chat","messageList"],pS=["putConversations"],gS="debug";class hS{constructor(e,t,n,i,a,o,r,s,l,c,d,u=[],m,p,g,h,v,y,S){if(this.variables=n,this._logger=o,this.loggerFactory=r,this.scenarioFactory=s,this.syncEngineInitializationPromise=l,this.rendererId=c,this.requestHealthMonitor=m,this.enableClassBasedErrors=p,this.cdlOperationCustomContext=h,this.splitFetchWaitMarkerInWLT=v,this.dataLayerClientSettings=y,this.enableAllowErrorsInSubscriptions=S,this._perfStats=null,this._perfStatsForResponseProcessing=null,this._scenario=void 0,this._startTime=Date.now(),this._lastUpdateTime=null,this._requestId=e,this._windowId=d,this._requestType=t,"subscription"!==t?this._perfStats=new dS(t,!1,a):dS.markSubscriptionRequest(a),this._requestComplete=!1,this._operationName=a,this._loggingContext={requestId:e,component:"RequestHandler",requestRendererId:this.rendererId,requestWindowId:this.windowId,hostRendererId:i,operationType:t,operationName:a},u=u&&u.length?u:pS,this.subject=new Fv(this._logger,this._loggingContext),this.logRequest(),a&&!u.includes(a)&&"subscription"!==t){this._scenario=this.scenarioFactory.newScenario(be.Cu.CentralDataLayerRequest),this._scenario.clientName=a;const e=this.getActiveCPM();if(this._scenario.appendEventData({operationName:a,operationType:t,context:this.rendererId,"Panel.WindowID":this.windowId,target:g,correlationId:h?.callerScenarioId,origin:h?.callerInfo,activeCPM:e}),this.isRequestFromWindowLaunch(a,s)){s.startStep(be.Cu.WindowLaunchTime,be.BQ.FetchWait);const e=this.scenarioFactory.findScenario(be.Cu.WindowLaunchTime);this._wltTimestampsAtInit=e?.timestamps.length}}this.requestHealthMonitor?.requestCreated(this),this.syncEngineInitializationPromise.then((e=>{if(!e.isSyncEngineInitialized)throw Error();this._scenario?.appendEventData({messagingSyncEngineStartupMode:e.bootType})})).catch((()=>{this._scenario?.appendEventData({messagingSyncEngineStartupMode:"Error"})}))}get requestId(){return this._requestId}get windowId(){return this._windowId}get response(){return this.subject.observable}get requestType(){return this._requestType}get operationName(){return this._operationName}isComplete(){return this._requestComplete}setResponseAndEndScenario(e,t,n){const i=!e.errors&&e.data;this._otherResponsesReceivedWhileInTransit=t,this._responseReceiveLatency=n,i?(this._perfStatsForResponseProcessing=new dS(this.requestType,!0,this.operationName),this.onSuccess(e)):this.onError(e),this.onComplete(i?"success":"error"),i&&e.extensions?.perfStats&&this._perfStatsForResponseProcessing?.stopMeasurement(e.extensions?.perfStats,t,n)}cancel(){this._requestComplete||(this._requestComplete=!0,this._scenario&&this._scenario.incomplete(),this.onComplete("cancelled"))}toLog(){return{requestId:this.requestId,requestType:this.requestType,operationName:this.operationName,isComplete:this.isComplete(),variables:(0,we.mapValues)(this.variables,((e,t)=>this.variableToLog(t,e))),customContext:this.cdlOperationCustomContext,startTime:this._startTime,lastUpdateTime:this._lastUpdateTime}}onComplete(e){this._requestComplete&&(this.subject.onComplete(),this.requestHealthMonitor?.requestCompleted(this,e))}onSuccess(e){this.mergeAndEndStatsSnapshot(e.extensions),this.logResponse(),this.subject.onNext(e)}onError(e){const t=e?.errors||"Unexpected: data layer query response missing both data and error",n=Array.isArray(t)?t.map((e=>(0,Je.Nw)(e))).join():(0,Je.Nw)(t);if(this.mergeAndEndStatsSnapshot(e.extensions,n),this.enableClassBasedErrors)this.subject.onNext(e);else{let t=e.errorCode;!t&&e.errors?.length&&(t=e.errors[0].name||d.O4.RemoteOperationFailed),t||(t=d.O4.InvalidResponse);const i=(0,Je.$5)(d.Ir.DataLayerClient,t,"onError",void 0,n);this._logger.error(`error while processing ${this._requestId}: ${i.message} (reason: ${i.reason})`,this._loggingContext,t),this.subject.onError(i)}}mergeAndEndStatsSnapshot(e,t){let n;e&&e.perfStats&&(this._perfStats&&(n=this._perfStats.stopMeasurement(e.perfStats,this._otherResponsesReceivedWhileInTransit,this._responseReceiveLatency)),"subscription"===this.requestType&&(this._lastUpdateTime=Date.now(),dS.addSubscriptionResponse(this.operationName,e.perfStats.responseSendTime,this.loggerFactory,this.scenarioFactory,e.subscriptionCustomIdentifier,this.dataLayerClientSettings?.cdlSubscriptionAggregatorAllowList,this.dataLayerClientSettings?.cdlSubscriptionAggregatorLogIntervalMS))),e&&this._scenario?.appendEventData({dataSource:e.dataSource,size:e.perfStats?.payloadLength}),this._scenario&&(t?this.syncEngineInitializationPromise.then((e=>{this._scenario?.appendEventData({...n,errors:(0,et.y)(t)}),e.isSyncEngineInitialized?this._scenario?.fail():this._scenario?.incomplete()})):(this._scenario.stop(n),this.isRequestFromWindowLaunch(this.operationName,this.scenarioFactory)&&this.createWltSteps(n)))}logResponse(){this._logger[this.getLogLevel()]("Received response data for request",this._loggingContext)}createWltSteps(e){const t=this.scenarioFactory.findScenario(be.Cu.WindowLaunchTime);if(t&&t.currentStep!==be.BQ.FetchProcessResponse){if(e){const{requestIPCTime:n,responseIPCTime:i,workerResponseTime:a}=e;if(n&&i&&this.splitFetchWaitMarkerInWLT){if(this._wltTimestampsAtInit&&t.timestamps.length>this._wltTimestampsAtInit)return;t.mark(be.BQ.FetchWaitRequestIPC,{offsetCurrentTimeInMs:Math.round(a)+i}),t.mark(be.BQ.FetchWaitWorker,{offsetCurrentTimeInMs:i}),t.mark(be.BQ.FetchWaitResponseIPC)}else t.mark(be.BQ.FetchWaitIPC,{offsetCurrentTimeInMs:Math.round(a)}),t.mark(be.BQ.FetchWaitWorker)}t.startStep(be.BQ.FetchProcessResponse)}}isRequestFromWindowLaunch(e,t){return!!t.findScenario(be.Cu.WindowLaunchTime)&&mS.indexOf(e)>-1}logRequest(){this._logger[gS]("Created new request",this._loggingContext)}getLogLevel(){return uS.indexOf(this._loggingContext.operationName??"")>=0?gS:"log"}getActiveCPM(){const e=[be.Cu.ChatSwitch,be.Cu.SimpleCollabSwitch,be.Cu.ChannelSwitchL1,be.Cu.ChannelSwitchL2,be.Cu.ChannelL1Deeplink,be.Cu.ChannelL2Deeplink,be.Cu.ActivitySwitch,be.Cu.ApplicationLaunchTime,be.Cu.WindowLaunchTime,be.Cu.SliceSwitch];if(this.scenarioFactory.doesScenariosExist){const t=this.scenarioFactory.doesScenariosExist(e);if(t.length)return t.join(",")}}variableToLog(e,t){return this.dataLayerClientSettings?.loggableOperationVariablesAllowList?.includes(e)||(0,we.isBoolean)(t)||(0,we.isNumber)(t)||(0,we.isNil)(t)?t:"N/A"}}class vS extends hS{onSuccess(e){super.onSuccess(e),this._requestComplete=!0}onError(e){this._requestComplete=!0,super.onError(e)}}class yS extends hS{onSuccess(e){super.onSuccess(e),this._requestComplete=!0}onError(e){this._requestComplete=!0,super.onError(e)}}class SS extends hS{onSuccess(e){super.onSuccess(e)}onError(e){this.enableClassBasedErrors&&this.enableAllowErrorsInSubscriptions&&"data"in e||(this._logger.warn(`Stopping subscription with request-id '${this._requestId}' due to an error while processing.`,this._loggingContext),this._requestComplete=!0),super.onError(e)}}class fS{static createDataLayerRequest(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,v,y){const S=[e,t,n,i,a,o,r,s,l,c,d,void 0,u,m,p,g,h,v,y];switch(t){case"mutation":return new vS(...S);case"query":return new yS(...S);case"subscription":return new SS(...S)}}}class kS{constructor(e,t,n,i,a){this.config=t,this.timeoutProvider=n,this.syncEngineInitializationPromise=i,this.dataLayerTarget=a,this.isRequestInProcess=!1,this.requestTimer=null,this.openRequests=new Map,this.timedOutDistinctRequestCount=0,this.failedDistinctRequestCount=0,this.timedOutOperationNames=new Set,this.failedOperationNames=new Set,this.lastSucceededRequest=this.firstTimedOutRequest=kS.DefaultRequestLoggingData,this.logger=e.newLogger("RequestHealthMonitor","core-cdl-data-layer-client")}requestCreated(e){if(!this.shouldMonitor(e))return;let t;null!==this.requestTimer||this.isRequestInProcess?t=!1:(this.startTimer(),t=!0),this.openRequests.set(e.requestId,{operationName:e.operationName,shouldTimeout:t,timeAdded:Date.now()})}requestCompleted(e,t){if(!this.shouldMonitor(e))return;this.openRequests.delete(e.requestId)||this.logger.warn(`Unknown request completed. Possibly timed out. RequestId ${e.requestId}, OperationName ${e.operationName}, Target ${this.dataLayerTarget}.`),0===this.openRequests.size&&null!==this.requestTimer&&this.clearTimer(),"success"===t&&this.onSuccess(e),"error"===t&&this.onError(e)}onSuccess(e){this.lastSucceededRequest={requestId:e.requestId,operationName:e.operationName},this.timedOutDistinctRequestCount=0,this.failedDistinctRequestCount=0,this.timedOutOperationNames.clear(),this.failedOperationNames.clear(),this.firstTimedOutRequest=kS.DefaultRequestLoggingData}onError(e){this.failedOperationNames.has(e.operationName)||(this.failedDistinctRequestCount++,this.failedOperationNames.add(e.operationName),this.failedDistinctRequestCount===this.failureCountThreshold&&this.indicateTargetUnhealthy("error"))}onTimeout(){let e=kS.DefaultRequestLoggingData,t=Number.MAX_SAFE_INTEGER;this.openRequests.forEach(((n,i)=>{if(n.shouldTimeout){const a=n.operationName;n.timeAdded<t&&(t=n.timeAdded,e={operationName:a,requestId:i}),this.logger.warn(`Request reached time out in health monitor. RequestId ${i}, OperationName ${a}, Target ${this.dataLayerTarget}.`),this.openRequests.delete(i),this.timedOutOperationNames.has(a)||(this.timedOutDistinctRequestCount++,this.timedOutOperationNames.add(a),this.timedOutDistinctRequestCount===this.timedOutCountThreshold&&this.indicateTargetUnhealthy("timedOut"))}else n.shouldTimeout=!0})),this.firstTimedOutRequest===kS.DefaultRequestLoggingData&&(this.firstTimedOutRequest=e),this.requestTimer=null,this.isRequestInProcess=!1,this.openRequests.size>0&&this.startTimer()}startTimer(){null!==this.requestTimer&&(this.logger.warn(`Health monitor timer already running when attempting to start new. Clearing old timer. Target ${this.dataLayerTarget}.`),this.timeoutProvider.clearTimeout(this.requestTimer)),this.isRequestInProcess=!0,this.syncEngineInitializationPromise.then((e=>{e.isSyncEngineInitialized&&(this.requestTimer=this.timeoutProvider.setTimeout((()=>this.onTimeout()),this.timeOutLengthMs))}))}clearTimer(){null!==this.requestTimer?(this.timeoutProvider.clearTimeout(this.requestTimer),this.requestTimer=null,this.isRequestInProcess=!1):this.logger.warn(`Health monitor timer tried to cancel non-existent timer. Ignoring. Target ${this.dataLayerTarget}.`)}indicateTargetUnhealthy(e){let t="error"===e?`ErrorCount: ${this.failureCountThreshold}.`:`TimedOutCount: ${this.timedOutCountThreshold}. TimeOutMs: ${this.timeOutLengthMs}.`;this.config.memoryMapType&&(t=`${t} MemoryMapType: ${this.config.memoryMapType}.`);const n=`Last succeeded operation: ${this.lastSucceededRequest.operationName}, ${this.lastSucceededRequest.requestId}.`,i=`First timeout operation: ${this.firstTimedOutRequest.operationName}, ${this.firstTimedOutRequest.requestId}`,a=`RequestHealthMonitor: DataLayer is unhealthy due to successive requests failing with ${e}. Target: ${this.dataLayerTarget}. ${t} ${n} ${i}`;this.logger.errorToTelemetry?.(a,"cdl_data_layer_client_request_health_monitor_unhealthy_target",void 0,!0),this.config.unhealthyDataLayerCallback?.(a)}shouldMonitor(e){return"subscription"!==e.requestType}get failureCountThreshold(){return this.config.failureCountThreshold||kS.DefaultFailureCountThreshold}get timeOutLengthMs(){return(this.config.timeoutLengthSeconds||kS.DefaultTimeoutLengthSeconds)*Tp.KF}get timedOutCountThreshold(){return this.config.timeoutCountThreshold||kS.DefaultTimeoutCountThreshold}}kS.DefaultFailureCountThreshold=5,kS.DefaultTimeoutCountThreshold=5,kS.DefaultTimeoutLengthSeconds=60,kS.DefaultRequestLoggingData={operationName:"na",requestId:"na"};class CS{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p){this.logger=e,this.scenarioFactory=n,this.syncEngineInitializationPromise=a,this.leakDetectorService=o,this.dataLayerCommunicatorTarget=r,this.timeoutProvider=s,this.enableClassBasedErrors=c,this.trackingOperationsDuringWaitConfig=d,this.dataClientTrackingService=u,this.dataLayerClientSettings=m,this.enableAllowErrorsInSubscriptions=p,this.requestMap=new Map,this.recentlyCancelledRequests=new Map,this.loggingContext={hostRendererId:t,component:"RequestRegistrar"},this.leakDetector=this.leakDetectorService?.create(),l&&l.enableRequestHealthMonitor&&s&&(this.requestHealthMonitor=new kS(i,l,s,this.syncEngineInitializationPromise,r))}createRequest(e,t,n,i,a,o,r,s,l){const c=fS.createDataLayerRequest(e,t,i,this.loggingContext.hostRendererId,n,this.logger,a,this.scenarioFactory,this.syncEngineInitializationPromise,o,r,this.requestHealthMonitor,this.enableClassBasedErrors,this.dataLayerCommunicatorTarget,s,l,this.dataLayerClientSettings,this.enableAllowErrorsInSubscriptions);return this.leakDetector?.track(`Request-${c.requestType}-${n}`,c),this.requestMap.set(e,c),c}reconcileResponse(e,t){const n=this.requestMap.get(e),i=t.data?t.data&&Object.keys(t.data).toString():"";if(this.recentlyCancelledRequests.has(e))return void this.logger.log(`Received response to a requestId that was recently cancelled. RequestId: ${e}. OperationNameHints: ${i}.`,this.loggingContext);if(!n)return void this.logger.errorToTelemetry?.(`Received response to a requestId that cannot be found in the map. operationName ${i}`,"cdl_request",{operationName:i,windowId:t.windowId,callId:t.requestId,target:this.dataLayerCommunicatorTarget},!0);const a=t.extensions&&t.extensions.perfStats;let o,r;if(a||this.logger.warn(`Received response without perfStats for request. RequestId: ${e} RendererId: ${t.rendererId}, WindowId: ${t.windowId}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext),this.trackingOperationsDuringWaitConfig?.enableTrackingCdlOperationsDuringWait&&a&&a.responseSendTime){this.markResponse(n);const e=a.responseSendTime,t=Date.now();if(r=t-e,r>(this.trackingOperationsDuringWaitConfig?.trackingCdlOperationsDuringWaitThresholdInMs||100)){o=this.getResponsesBetweenStartAndLast(e);const i=o?.reduce(((e,t)=>{const n=e.find((e=>e?.name===t));return n?n.count++:e.push({name:t,count:1}),e}),[]);this.trackingOperationsDuringWaitConfig?.enableLoggingCdlOperationsDuringWait&&this.logger.log(`${n?.operationName}, sendtime: ${e}, receivetime: ${t}, latency: ${t-e}, responses received between send and receive: ${JSON.stringify(i)}`,this.loggingContext)}}n.setResponseAndEndScenario(t,o,r),n.isComplete()&&this.requestMap.delete(e)}cancelRequest({requestId:e,rendererId:t,windowId:n}){const i=this.requestMap.get(e);i?(i.cancel(),this.requestMap.delete(e),this.recentlyCancelledRequests.set(e,(new Date).getTime()),this.scheduleCancelledRequestsMapCleanup()):this.logger.debug(`Nothing to cancel, request no longer in map. RequestId: ${e} RendererId: ${t}, WindowId: ${n}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext)}getLogs(){return JSON.stringify((0,we.map)(Array.from(this.requestMap.values()),(e=>e.toLog())),null,2)}scheduleCancelledRequestsMapCleanup(){if(!this.recentlyCancelledRequestsTimer){const e=2,t=(new Date).getTime();this.recentlyCancelledRequestsTimer=this.timeoutProvider?.setTimeout((()=>this.cleanRecentlyCancelledRequestsMap(t)),e*Tp.Kv)}}cleanRecentlyCancelledRequestsMap(e){this.recentlyCancelledRequests.forEach(((t,n)=>{t<e&&this.recentlyCancelledRequests.delete(n)})),this.recentlyCancelledRequestsTimer=void 0}markResponse(e){this.dataClientTrackingService?.markResponse(e.operationName)}getResponsesBetweenStartAndLast(e){const t=this.dataClientTrackingService?.getResponsesBetweenStartAndLast(e);return t||[]}}var bS,wS=n(833219),TS=n(132786);class IS{constructor(e,t,n,i,a,o,r,s,l=!1,c=Promise.resolve({isSyncEngineInitialized:!0}),d,u,m,p,g,h,v){this.hostRendererId=e,this.loggerFactory=t,this.scenarioFactory=n,this.dataLayerCommunicator=i,this.leakDetectorService=a,this.splitFetchWaitMarkerInWLT=m,this.enableSimpleCollabSubscriptionDebug=h,this.loggingContext={component:"DataLayerClient",hostRendererId:e},this.logger=new Nv(t.newLogger("CDL","core-cdl-data-layer-client")),this.logger.log("logger created for renderer",this.loggingContext),this.dataLayerCommunicator.onMessage=this.onMessageReceived.bind(this),this.onMessageReceivedCallback=v,this.requestRegistrar=new CS(this.logger,e,this.scenarioFactory,this.loggerFactory,c,this.leakDetectorService,o,r,s,l,d,u,p,g),this.requestId=new Hv("graphql")}execute(e,t,n,i,a,o){const r=(0,wS.A)(e,n),s=r&&r.operation||"query";return this.executeWithQueryText(s,(0,TS.y)(e),t,n,i,a,o)}executeWithQueryText(e,t,n,i,a,o,r){const s=this.requestId.next(e),l=this.requestRegistrar.createRequest(s,e,i||e,n,this.loggerFactory,a,o,r,this.splitFetchWaitMarkerInWLT);this.logger.log("executing graphql request to data layer",{requestId:l.requestId,...this.loggingContext,operationType:e,operationName:i,hostRendererId:this.hostRendererId,requestRendererId:a,requestWindowId:o}),this.dataLayerCommunicator.sendMessage({requestId:s,windowId:o,rendererId:this.hostRendererId,request:{graphqlQuery:t,variables:n},cdlOperationCustomContext:r,operationName:i});return function(e,t){const n=e.subscribe;return e.subscribe=i=>{const a=n.call(e,i),o=a.unsubscribe;return a.unsubscribe=()=>(t(),o.call(a)),a},e}(l.response,this.onUnsubscribe(l,i))}getRequestLogs(){return this.requestRegistrar.getLogs()}onUnsubscribe(e,t){return()=>{e.isComplete()||(this.enableSimpleCollabSubscriptionDebug?.()&&"useUnifiedRailSubscription"===t&&this.logger.infoToTelemetry?.("GQL_STOP::DL::useUnifiedRailSubscription","cdl_request",{callId:e.requestId}),this.logger.log("Notifying server of unsubscription",{...this.loggingContext,requestId:e.requestId,requestType:Gv,operationName:t}),this.dataLayerCommunicator.sendMessage({requestId:e.requestId,rendererId:this.hostRendererId,windowId:e.windowId,request:{graphqlQuery:Gv,variables:void 0},operationName:t}),this.requestRegistrar.cancelRequest({requestId:e.requestId,rendererId:this.hostRendererId,windowId:e.windowId}))}}onMessageReceived(e){this.onMessageReceivedCallback?this.onMessageReceivedCallback((()=>{this.requestRegistrar.reconcileResponse(e.requestId,e)})):this.requestRegistrar.reconcileResponse(e.requestId,e)}}class NS{constructor(e,t,n,i,a,o,r,s,l,d,u,m,p,g,h,v,y,S,f,k,C,b,w,T){this.host=e,this.config=t,this.loggerFactory=i,this.scenarioFactory=a,this.coreSettings=o,this.cdlWorkerRegistrarService=f,this.workerId=k,this.dataClientTrackingService=C,this.telemetryService=b,this.shouldUsePreInitCoreWorker=T,this.isDisposed=!1,this.hasWorkerFailedStartup=!1,this.logger=i.newLogger("DataClientCoreCDLWorkerService","core-services-cdl-worker"),this.loggingContext={hostRendererId:t.clientId,component:"DataLayerClient"},this.cdlWorkerHostSettingsAggregator=new sS(n,o,r,i,d,p,g,h,v),this.cdlWorkerManagerInitializationPromise=Yy(e,t,this.cdlWorkerHostSettingsAggregator,i,a,o,s,l,d,this.logger,y,S,f,k,g,w,b,this.shouldUsePreInitCoreWorker);if(Qy(d,o,a,e,this.logger)){this.cdlWorkerStateSender=new nS(u,m,i,this);const{disableCDLWorkerHostSettingsUpdates:e}=o.get(c.w.Core);e||this.startNotifyingCDLWorkerForHostSettingsChanges()}}updateCoreSettingsContextIfNeeded(e){this.cdlWorkerHostSettingsAggregator.updateCoreSettingsContextIfNeeded(e)}async triggerWorkerStartupFailure(e,t,n){if(this.cdlWorkerRegistrarService.mainWindowWorkerId!==this.workerId)return void this.logger.log("Not triggering failure - this worker is not the main window worker.");if(this.hasWorkerFailedStartup)return void this.logger.warn("Not triggering failure - CDL Worker has already failed startup.");if(!this.coreSettings.get(c.w.Core).isCDLWorkerCriticalToStartup)return void this.logger.log("Not triggering failure - CDL Worker is not critical to startup.");const{enableRetryingStartupStrategies:i,enableRetryingStartupStrategiesSubscription:a,oopsPageOnWorkerStartupFailures:o}=this.coreSettings.get(c.w.CdlWorker),r="sync-engine-failure"===e||"sync-engine-expected-failure"===e;if(i&&a&&function(e,t,n,i){const a=new Fv(t,n),o=a.subscribe({next:()=>{i(),o.unsubscribe()}});e.then((e=>{e?(t.log("Subscribing to CDL Worker retry status."),e.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"startup_retry_subscription",subType:"",params:void 0},a)):t.errorToTelemetry?.("CDL Worker Manager is not initialized. Cannot subscribe to CDL Worker retry status.","cdl_services_worker_startup_strategy_retry",void 0,!0)}))}(this.cdlWorkerManagerInitializationPromise,this.logger,this.loggingContext,(()=>{this.logger.infoToTelemetry?.(`CDL Worker has recovered from ${e}`,"cdl_worker_startup_error",void 0,!0),this.telemetryService?.setCoreContext("AppInfo.CDLState","Running"),"reduced-capabilities"===e&&n.execute({command:ee.publishCdlCapabilities({capabilities:["channels","chats"]})})})),!r||o?.syncEngine)if("reduced-capabilities"!==e||t){switch(this.logger.errorToTelemetry?.(`Triggering CDL Worker startup failure due to ${e}`,"cdl_worker_startup_error",void 0,!0),e){case"sync-engine-failure":n.execute({command:ee.showOopsPage({error:new Ha.a(Ha.D.CDL_WORKER_FAILURE)})}),this.telemetryService?.setCoreContext("AppInfo.CDLState",t?"Reduced":"Failed");break;case"sync-engine-expected-failure":n.execute({command:ee.showOopsPage({error:new Ha.a(Ha.D.CDL_WORKER_FAILURE)})}),this.telemetryService?.setCoreContext("AppInfo.CDLState",t?"Reduced":"ExpectedFailure");break;case"reduced-capabilities":n.execute({command:ee.publishCdlCapabilities({capabilities:[]})}),this.telemetryService?.setCoreContext("AppInfo.CDLState","Reduced")}this.hasWorkerFailedStartup=!0}else this.logger.warnToTelemetry?.("Not triggering failure - reduced capabilities triggered but sync engine is not in reduced state.","cdl_worker_startup_error",void 0,!0);else this.logger.log(`Not triggering failure - oops page on worker startup failure not enabled for ${e}.`)}getCDLWorkerManager(){return this.cdlWorkerManagerInitializationPromise}async getDataLayerClient(e){if(!this.dataLayerClient){const t=await this.getCDLWorkerManagerOrThrow("getDataLayerClient"),n=this.coreSettings.get(c.w.CdlWorker),{logCdlOperationsDuringWaitSettings:i}=this.coreSettings.get(c.w.Core);this.dataLayerClient=new IS(this.config.clientId,this.loggerFactory,this.scenarioFactory,t.workerClientResponseRouter.cdlGraphQLClient,void 0,"Worker",this.host,{enableRequestHealthMonitor:!!n.enableRequestHealthMonitor,failureCountThreshold:n.requestHealthMonitorFailureCountThreshold,timeoutCountThreshold:n.requestHealthMonitorTimeoutCountThreshold,timeoutLengthSeconds:n.requestHealthMonitorTimeoutLengthSeconds,memoryMapType:(0,Xy.CC)(this.coreSettings)},!!n.enableClassBasedErrors,t.syncEngineInitializationPromise,{enableLoggingCdlOperationsDuringWait:i?.enableLoggingCdlOperationsDuringWait,enableTrackingCdlOperationsDuringWait:i?.enableTrackingCdlOperationsDuringWait,trackingCdlOperationsDuringWaitThresholdInMs:i?.trackingCdlOperationsDuringWaitThresholdInMs},this.dataClientTrackingService,!!n.splitFetchWaitMarkerInWLT,{cdlSubscriptionAggregatorAllowList:n.cdlSubscriptionAggregatorAllowList||void 0,loggableOperationVariablesAllowList:n.loggableOperationVariablesAllowList||void 0,cdlSubscriptionAggregatorLogIntervalMS:n.cdlSubscriptionAggregatorLogIntervalMS||void 0},!!n.enableAllowErrorsInSubscriptions,(()=>{const{enableSimpleCollabSubscriptionDebug:e}=this.coreSettings.get(c.w.SimpleCollab);return!!e}),e)}return this.dataLayerClient}async getControlPlaneCommunicator(){if(!this.controlPlaneCommunicator){const e=await this.getCDLWorkerManagerOrThrow("getControlPlaneCommunicator");this.controlPlaneCommunicator=new iS(e.workerClientResponseRouter,{loggerFactory:this.loggerFactory})}return this.controlPlaneCommunicator}dispose(){this.cdlWorkerStateSender&&this.cdlWorkerStateSender.dispose(),this.cdlWorkerHostSettingsAggregator.cleanup(),this.isDisposed=!0}async logoutCurrentUser(e){const t=e.get(c.w.CdlWorker).maxLogoutTime||5e3;if(this.isDisposed)return void this.logger.warnToTelemetry?.("Unable to cleanup CDL Worker: Already disposed.","cdl_services_worker_worker_service_logout_current_user_error",void 0,!0);const n=await this.getCDLWorkerManager();if(n)try{await(0,yi.a)(n.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"logout",subType:"",params:void 0}),t,`logout request to CDL worker timed out after ${t} ms`)}catch(e){const t=(0,et.y)((0,Je.Nw)(e));this.logger.errorToTelemetry?.(`Failed to cleanup CDL Worker on logout. ${e&&e.code===d.O4.TimedOut?e.message:""}`,"cdl_services_worker_worker_service_logout_current_user_error",{reason:t},!0)}else this.logger.warnToTelemetry?.("Unable to cleanup CDL Worker: Worker manager not available.","cdl_services_worker_worker_service_logout_current_user_error",void 0,!0)}async getDebugService(){if(!this.debugService){const{DataClientCoreCDLWorkerDebugService:e}=await n.e(166220).then(n.bind(n,196497));this.debugService=new e(this.loggerFactory,this)}return this.debugService}getDataLayerRequestLogs(){if(!this.dataLayerClient)return"Data layer client unavailable.";if(this.coreSettings.get(c.w.CdlWorker).disableOperationsInLogFiles)return"Data layer request logs disabled by setting 'disableOperationsInLogFiles'.";try{const e=this.dataLayerClient.getRequestLogs?.();return e||"Data layer client has not implemented request logs."}catch(e){return`Data layer client failed to get logs: ${(0,Je.Nw)(e)}.`}}async startNotifyingCDLWorkerForHostSettingsChanges(){let e;try{e=await this.getCDLWorkerManager()}catch(e){return void this.logger.errorToTelemetry?.(`Unable to start notifying CDL Worker for host settings changes: getCDLWorkerManager failed: ${e.message}.`,"cdl_services_worker_worker_service_notify_worker_host_settings_changes_error",void 0,!0)}e?(this.cdlWorkerHostSettingsAggregator.startNotifyingCDLWorkerForHostSettingsChanges(e.workerClientResponseRouter.cdlControlClient),this.logger.log("Start notifying CDL Worker for host settings changes.")):this.logger.log("Unable to start notifying CDL Worker for host settings changes: Worker manager not available.")}async getCDLWorkerManagerOrThrow(e){const t=await this.getCDLWorkerManager();if(!t)throw(0,Je.$5)(NS.ComponentName,d.O4.NotInitialized,e,void 0,"Worker manager is not initialized");return t}}NS.ComponentName="DataClientCoreCDLWorkerService",function(e){e.NoLog="no_logs",e.Activities="activities_logs",e.AllConversations="all_conversations_logs",e.AppsPlatform="apps_platform_logs",e.Calendar="calendar_logs",e.ChannelInfoPane="channel-info-pane",e.ChatInfoPane="chat-info-pane",e.ConversationFolder="conversation-folder",e.Diagnostics="diagnostics_logs",e.Files="files_logs",e.Messaging="messaging_logs",e.People="people_logs",e.Policies="policies_logs",e.Presence="presence_logs",e.MTMAAggregator="mtma_aggregator",e.UserPreferences="user_preferences_logs",e.TeamsAndChannels="teams_and_channels_logs",e.MeetForWork="meet_for_work_logs",e.Discover="discover_logs",e.Queues="queues_logs"}(bS||(bS={}));class AS{constructor(e,t,n,i,a,o){this.cdlWorkerManager=e,this.logger=t,this.experienceConfig=n,this.authenticationService=i,this.getDataLayerRequestLogs=a,this.cacheStorage=o,this.workerGetLogsTimeoutMs=18e3,this.logsProviderName="CdlWorkerLogsProvider"}async getLogsFiles(e){let t;const n=this.getWorkerDiagnosticsLogsFromCdlWorkerManager(),i=this.getVerboseWorkerLogs(this.cdlWorkerManager.workerType),a=await this.authenticationService.getUser();if(a&&a.isAuthenticated)t=this.getSyncEngineLogsFromCdlWorkerManager();else{const e="Sync logs cannot be retrieved for unauthenticated users.";t=Promise.resolve([{isPiiFree:!0,fileName:"sync-failure-logs.txt",content:e}]),this.logger.warn(e)}const[o,r,s]=await Promise.all([this.timeoutSafeGetLogsFiles(n,{diagnosticsEvents:void 0,coreSettingsSnapshot:""},"workerDiagnostics"),this.timeoutSafeGetLogsFiles(i,[],"workerVerboseDiagnostics"),this.timeoutSafeGetLogsFiles(t,[],"workerSyncDiagnostics")]);return[{isPiiFree:!o.diagnosticsEvents||!!e,fileName:"cdl-worker-diagnostics-logs.txt",content:o.diagnosticsEvents?(0,gp.nS)(e?o.diagnosticsEvents.filter((e=>e.isPiiFree)):o.diagnosticsEvents):"No logs found"},{isPiiFree:!0,fileName:"cdl-worker-settings.json",content:o.coreSettingsSnapshot},{isPiiFree:!1,fileName:"cdl-worker-requests.txt",content:this.getDataLayerRequestLogs()},...s,...r]}subscribeToCoreSettings(e){if(!e)return void this.logger.error("Failed to subscribe to core settings");e.getObservable(c.w.Diagnostics,["workerGetLogsTimeoutMs"]).subscribe((({workerGetLogsTimeoutMs:e})=>{e&&(this.workerGetLogsTimeoutMs=e)}))}async getVerboseWorkerLogs(e){const t=[];if(this.cacheStorage){const n=new qy(this.cacheStorage,this.logger),[i,a,o]=await Promise.all([n.getWorkerStartupStatus(e),n.getWorkerStartupStatus(this.experienceConfig.experienceName),n.getWorkerVerboseLog(e)]);(i||a)&&t.push({isPiiFree:!1,fileName:"cdl-worker-status.txt",content:(0,ge.hR)({workerStartup:i||{},experienceStartup:a||{}})}),""!==o&&t.push({isPiiFree:!1,fileName:"verbose-worker-logs.txt",content:o})}return Promise.resolve(t)}async getWorkerDiagnosticsLogsFromCdlWorkerManager(){const e=this.cdlWorkerManager.workerClientResponseRouter.cdlDiagnosticsClient;try{const t=await e.sendRequest("get_logs");if(t?.response?.data)return t.response.data;this.logger.warn("Diagnostic event list empty or ill-formed")}catch(e){const t=await this.getSyncEngineInitResultFromCdlWorkerManager(),n=`Unable to retrieve worker diagnostics logs. ${(0,Je.Nw)(e)}.`,i=`syncEnginePromiseResult: ${t}`;return this.logger.errorToTelemetry?.(`${n}::${i}`,"cdl_worker_diagnostics_logs_error",{errorMessage:n,errors:i},!0),{diagnosticsEvents:[{message:n,level:gi.$.Error,isPiiFree:!0,levelName:"error",timeStamp:new Date},{message:i,level:gi.$.Error,isPiiFree:!0,levelName:"error",timeStamp:new Date}],coreSettingsSnapshot:""}}return{diagnosticsEvents:void 0,coreSettingsSnapshot:""}}async getSyncEngineInitResultFromCdlWorkerManager(){try{const e=await this.cdlWorkerManager.syncEngineInitializationPromise;return JSON.stringify(e)}catch(e){return(0,Je.Nw)(e)}}async getSyncEngineLogsFromCdlWorkerManager(){const e=[];for(const t of(0,we.values)(bS))t!==bS.NoLog&&t!==bS.Diagnostics&&e.push(this.getSyncEngineLogsForTypeFromCdlWorkerManager(t));return Promise.all(e)}async getSyncEngineLogsForTypeFromCdlWorkerManager(e){const t=this.cdlWorkerManager.workerClientResponseRouter.cdlSyncEngineClient;let n;try{const i=await t.sendRequest({type:"get_logs",subType:e,params:{conversationId:void 0}});i?.response?n=i.response:(this.logger.warn(`Sync engine logs empty. LogType: ${e}`),n="No logs available.")}catch(e){const t=`Unable to retrieve sync diagnostics logs. ${(0,Je.Nw)(e)}`;this.logger.error(t),n=t}return{isPiiFree:!1,fileName:`sync-${this.syncEngineLogTypeToFileName(e)}-logs.txt`,content:n}}syncEngineLogTypeToFileName(e){switch(e){case bS.Messaging:return"messaging";case bS.AllConversations:return"all_conversations";case bS.People:return"people";case bS.Policies:return"policies";case bS.Presence:return"presence";case bS.Calendar:return"calendar";case bS.AppsPlatform:return"apps-platform";case bS.Activities:return"activities";case bS.ChannelInfoPane:return"channel-info-pane";case bS.ChatInfoPane:return"chat-info-pane";case bS.ConversationFolder:return"conversation-folder";case bS.MTMAAggregator:return"mtma-aggregator";case bS.UserPreferences:return"user-preferences";case bS.TeamsAndChannels:return"teams-and-channels";case bS.Files:return"files";case bS.MeetForWork:return"meet-for-work";case bS.Discover:return"discover";case bS.Queues:return"queues"}}async timeoutSafeGetLogsFiles(e,t,n){try{return await(0,yi.a)(e,this.workerGetLogsTimeoutMs)}catch(e){let t=`Failed fetching logs files from CDL Worker Logs Provider - ${n}`;(0,yi.W)(e)&&(t=`Timed out fetching logs files from CDL Worker Logs Provider - ${n}`),this.logger.errorToTelemetry?.(t,"cdl_get_logs_error")}return t}}async function ES(e,t=!1){const n=await(e.i18NextWrapper?.osLocale),i=new NS(e.windowProvider,e.config,e.configLoader,e.loggerFactory,e.scenarioFactory,e.coreSettings,e.coreSettingsContext,e.authenticationService,e.discover,e.platformService,e.clientState,e.hostState,e.primaryUser,e.i18NextWrapper?.locale,n,e.i18NextWrapper?.osLocaleInfo,e.offlineCacheManager,e.authStateProvider,e.cdlWorkerRegistrarService,e.workerId,e.dataClientTrackingService,e.telemetryService,e.altScenarioService?.altScenario,t);return function(e,t){const n=e?.altScenario;n&&n.appendEventData({dataStoreName:(0,Xy.CC)(t)})}(e.altScenarioService,e.coreSettings),i.getCDLWorkerManager().then((t=>{if(t){const{authenticationService:n,authenticationUser:a,cacheStorage:o,cdlWorkerRegistrarService:r,loggerFactory:s,logsCollectorService:l,workerId:d,config:u}=e,m=new AS(t,s.newLogger("CdlWorkerLogsProvider","core-services-tasks"),u,n,(()=>i.getDataLayerRequestLogs()),o);m.subscribeToCoreSettings(e.coreSettings);const p=a&&(0,kt.Lw)(a);l.registerUserLogsProvider(p||"",m),r.registerWorker(d),function(e,t){const{enableNetworkStateCommsBetweenCoreAndWorker:n}=e.coreSettings.get(c.w.Core);if(n){const n=n=>{const i={networkState:e.networkState.getState(),baselineNetworkStateOverride:n};t.workerClientResponseRouter.cdlNetworkStateClient.sendRequest(i)},i=e.authenticationUser&&(0,kt.Lw)(e.authenticationUser)||"",a=e.networkState.createNetworkStateTracker?.(i,`CDL Worker [${i}]`,n);a&&t.state.setState("networkState:Loaded",a);return function(e,t){return()=>{e.unsubscribe(),t.dispose()}}(e.networkState.observe().subscribe((e=>{const n={networkState:e};t.workerClientResponseRouter.cdlNetworkStateClient.sendRequest(n)})),a)}}(e,t),function(e,t){const{enableEndpointsHealthCommsBetweenCoreAndWorker:n}=e.coreSettings.get(c.w.Core);if(n){const n=e.endpointsHealthService;if(n?.getEndpointsHealthUpdateHandler){const e=n.getEndpointsHealthUpdateHandler();t.state.setState("endpointsHealthUpdateHandler:Loaded",e),e.onStateDumpRequest((()=>{const e="get_health_state";t.workerClientResponseRouter.cdlEndpointsHealthClient.sendRequest(e)}))}}}(e,t),function(e){(0,Pt.AR)().setCdlContextCallback(((t,n,i)=>{e.workerClientResponseRouter.telemetryClient.sendRequest({requestOperationtype:"setContext",context:{[t]:n},userContextId:i})}))}(t)}})),await(0,kh.y)(1),i}async function FS(e,t){const n=await _S(e);return!!n&&!!t&&n.id===t.id}async function _S(e){const t=await(e?.getCachedUsers?.({...F({source:A.p.Core}),scenarioName:be.Cu.AuthWebCachedUser},{isPrimaryUser:!0})),n=t?.[0];if(n)return(0,kt.aj)(n)}class DS extends xp{constructor(){super(d.c1.CreateCDLWorkerOnAuthUserTask,["altScenarioService","authenticationService","clientState","config","configLoader","coreSettings","coreSettingsContext","diagnosticsService","discover","endpointsHealthService","hostState","i18NextWrapper","loggerFactory","logsCollectorService","networkState","platformService","scenarioFactory","windowProvider","telemetryService"])}async execute(e){const{altScenarioService:t,authenticationService:n,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,diagnosticsService:l,discover:d,endpointsHealthService:u,hostState:m,i18NextWrapper:p,loggerFactory:g,logsCollectorService:h,networkState:v,platformService:y,scenarioFactory:S,windowProvider:f,telemetryService:k}=e,{authenticationUser:C,authStateProvider:b,cacheStorage:w,cdlWorkerRegistrarService:T,cdlWorkerService:I,dataClientTrackingService:N,offlineCacheManager:A}=e,E=g.newLogger("CreateCDLWorkerOnAuthUserTask","core-services-tasks"),F=(0,Xy.ZG)(r),{enableMTMA:_,disableExperience:D}=r.get(c.w.Core),{crossCloudMeetingEnabled:P}=r.get(c.w.HostCapabilities),M=D&&C?.role!==pg.a7.Anonymous,R=D&&!1===P&&C?.role===pg.a7.Anonymous;if(!F||!_)return E.warn(`Not creating a worker as cdl worker or mtma is not enabled. isCdlWorkerEnabled: ${F}, isMTMAEnabled: ${_}`),Promise.resolve();if(!C||!T)return E.warn("Not creating a worker as authenticated user is not available or cdl worker registrar service is undefined."),Promise.resolve();if(M||R)return E.warn("Not creating a worker as experience is disabled for the user and it is not a CCM/CCA sign in."),Promise.resolve();const x=C.id;if(T.useInitTaskWorker){E.log(`Not creating a new worker. Using worker created in init task for the user oid: ${C.profile.objectId},\n         tid: ${C.profile.tenantId}`),T.useInitTaskWorker=!1;const{disableUpdateCoreSettingsContextIfNeeded:e}=r.get(c.w.Core,["disableUpdateCoreSettingsContextIfNeeded"]);return void(e||I?.updateCoreSettingsContextIfNeeded(s))}let L;return E.log(`createCDLWorkerOnAuthUserTask for user id ${C.id}: start`),E.log(`Creating a worker with id: ${x} for the user oid: ${C.profile.objectId},\n       tid: ${C.profile.tenantId}`),_&&(L=await _S(n)),e.cdlWorkerService=await ES({altScenarioService:t,authenticationService:n,authenticationUser:C,authStateProvider:b,cacheStorage:w,cdlWorkerRegistrarService:T,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,dataClientTrackingService:N,diagnosticsService:l,discover:d,endpointsHealthService:u,hostState:m,i18NextWrapper:p,loggerFactory:g,logsCollectorService:h,networkState:v,offlineCacheManager:A,platformService:y,primaryUser:L,scenarioFactory:S,windowProvider:f,workerId:x,telemetryService:k}),E.log(`createCDLWorkerOnAuthUserTask for user id ${C?.id}: done`),async e=>{"signout"===e&&(T.activeWorkers?.delete(x),E.log(`Deleting worker with id: ${x} from active workers on signout`))}}}class PS extends xp{constructor(){super(d.c1.CreateCDLWorkerOnInitTask,["altScenarioService","authenticationService","clientState","config","configLoader","coreSettings","coreSettingsContext","diagnosticsService","discover","endpointsHealthService","hostState","i18NextWrapper","loggerFactory","logsCollectorService","networkState","platformService","scenarioFactory","windowProvider","cdlWorkerRegistrarService","telemetryService"])}async execute(e){const{altScenarioService:t,authenticationService:n,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,diagnosticsService:l,discover:d,endpointsHealthService:u,hostState:m,i18NextWrapper:p,loggerFactory:g,logsCollectorService:h,networkState:v,platformService:y,scenarioFactory:S,windowProvider:f,cdlWorkerRegistrarService:k,telemetryService:C}=e,{authenticationUser:b,authStateProvider:w,cacheStorage:T,dataClientTrackingService:I,offlineCacheManager:N}=e,A=g.newLogger("CreateCDLWorkerOnInitTask","core-services-tasks");if(!(0,Xy.ZG)(r))return void A.warn("Not creating a worker as CDL worker is not enabled");const F=f.loader?.getWorkerId()??(0,E.v4)();let _;const{enableMTMA:D}=r.get(c.w.Core);if(D){if(!k)return void A.warn("Not creating a worker as cdlWorkerRegistrarService is undefined");A.log(`Creating a worker with id ${F} for auth user id ${b?.id}`),_=await _S(n)}e.cdlWorkerService=await ES({altScenarioService:t,authenticationService:n,authenticationUser:b,authStateProvider:w,telemetryService:C,cacheStorage:T,cdlWorkerRegistrarService:k,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,dataClientTrackingService:I,diagnosticsService:l,discover:d,endpointsHealthService:u,hostState:m,i18NextWrapper:p,loggerFactory:g,logsCollectorService:h,networkState:v,offlineCacheManager:N,platformService:y,primaryUser:_,scenarioFactory:S,windowProvider:f,workerId:F},!0),A.log(`createCDLWorkerOnInitTask for user id ${b?.id}: done`)}}var MS,RS=n(454007);class xS{constructor({loggerFactory:e}){this.initTaskWorkerId="",this.mainWindowWorkerId=void 0,this.useInitTaskWorker=!0,this.activeWorkers=new Set,this.userRegisteredActiveWorkers=new Map,this.formatUserId=e=>e.replace(RS.C.User,""),this.logger=e.newLogger("DataClientCoreCDLWorkerRegistrarService","core-services-cdl-worker")}setMainWindowWorkerByUserId(e){e=this.formatUserId(e),this.userRegisteredActiveWorkers.has(e)?this.mainWindowWorkerId=this.userRegisteredActiveWorkers.get(e):this.logger.errorToTelemetry?.(`No registered active worker for user id ${e}`,"cdl_registrar_service_no_registered_active_worker",void 0,!0)}isWorkerRegistered(e){return this.activeWorkers.has(e)}mapUserIdToRegisteredWorker(e,t){t=this.formatUserId(t),this.isWorkerRegistered(e)||(this.logger.warnToTelemetry?.(`${e} wasn't tracked yet was registered to active user. Tracking worker.`,"cdl_registrar_service_map_user_worker_not_registered",void 0,!0),this.registerWorker(e)),this.userRegisteredActiveWorkers.set(t,e)}registerWorker(e){this.isWorkerRegistered(e)?this.logger.errorToTelemetry?.(`${e} is already being tracked by cdl worker registrar service; skipping.`,"cdl_registrar_service_worker_already_registered",void 0,!0):(this.activeWorkers.add(e),this.initTaskWorkerId||(this.initTaskWorkerId=e,this.mainWindowWorkerId=e))}}class LS extends xp{constructor(){super(d.c1.CreateCDLWorkerRegistrarServiceTask,["loggerFactory"])}async execute(e){const{loggerFactory:t}=e;return e.cdlWorkerRegistrarService=new xS({loggerFactory:t}),Promise.resolve()}}!function(e){e.LifeCycleScopeChange="LifeCycleScopeChange"}(MS||(MS={}));class OS extends xp{constructor(){super(d.c1.CreateChangeReporting,[])}async execute(e){e.schedulerChangeReporting=new Ji,e.experienceChangeReportingService=new Ji,e.lifeCycleScopeChangeReportingService=new Ji,e.commandResultChangeReportingService=new Ji,e.commandChangeReportingService=new Ji}}const jS="local-user-preferences",BS={outOfTabNotifications:{allowOutOfTabNotifications:!1,setDuringBrowserToastsAllowed:!1},theme:{userTheme:"light",followOsTheme:!0,isClassicTheme:!1,isCallingWindowDarkTheme:!1},animation:{disableAnimations:void 0},infoPane:{chatContextualSearch:"closed",channelcontextualsearch:"closed",chatHighlightsDetails:"closed",chatfluidthread:"closed",chatcopilotsynthesis:"closed"},sidePane:{sidePaneOpenState:[]},flyoutCamera:{cameraState:"notSet"},promo:{badgeActionComplete:!1,labelActionComplete:!1,teamsInsiderLabelActionComplete:!1,teamsInsiderBadgeActionComplete:!1,desktopLabelActionComplete:!1,desktopBadgeActionComplete:!1},density:{chatDensity:"comfy"},performance:{mode:"normal"},optimizedPerf:{optimizedPerfPolicy:"never",isSetByUser:!1},appSwitcher:{checkboxChecked:!1,multipleTabsCheckboxChecked:!1},videoEffect:{lastUsedVideoFilter:void 0,lastUsedBackgroundImage:void 0},backgroundEffect:{lastUsedBackgroundEffect:void 0},avatar:{lastUsedAvatarFilter:void 0,hasUsedInMeeting:!1},teamLayout:{currentLayout:void 0},diagnosticsLogs:{shouldPersistLogsIntoIDB:!1},windowing:{shouldOpenContentInNewWindow:!1},statusBarItem:{shouldShowStatusBarItem:!0},lockScreenInCall:{turnOffMediaOnDeviceLock:void 0},messagePreviews:{messagePreviewsSetting:"default"},simpleCollabStickyFilter:{unifiedViewFilter:{},chatsViewFilter:{},channelsViewFilter:{}},composeSpellcheck:{disableDefaultSpellcheck:!1},peopleAppColumns:{persistentPeopleAppColumns:[]},peopleAppNavigation:{activeNavigationId:"ALL",activeNavigationLabel:"All contacts"},simpleCollab:{simpleCollabViewType:"none"},staticNowCards:{dismissedStaticNowCards:[]},superResolution:{isSuperResolutionEnabled:!0},editorSdk:{autoCorrectEnabledLanguages:[],critiqueSettings:[]}},US={get:()=>null,set:()=>{}};class $S{constructor(e,t=US){this.storage=t,this.subjectCache=new Map,this.logger=e.newLogger("ClientPreferencesService","services-io-browser-client-preferences"),this.clientPreferences=this.hydrateClientPreferences()}getPreferences(e){return this.clientPreferences[e]}getAllPreferences(){return this.clientPreferences}updatePreferences(e){const t=this.clientPreferences;this.clientPreferences=(0,we.mergeWith)({},this.clientPreferences,e,((e,t)=>void 0!==t?.sidePaneOpenState?{sidePaneOpenState:t.sidePaneOpenState}:void 0!==t?.chatsViewFilter&&void 0!==t?.channelsViewFilter&&void 0!==t?.unifiedViewFilter?this.mergeStickyFilterPreferences(e,t):void 0!==t?.autoCorrectEnabledLanguages||void 0!==t?.critiqueSettings?{autoCorrectEnabledLanguages:t.autoCorrectEnabledLanguages||e?.autoCorrectEnabledLanguages,critiqueSettings:t.critiqueSettings||e?.critiqueSettings}:void 0)),this.storage.set(jS,JSON.stringify(this.clientPreferences)),this.subjectCache.forEach(((e,n)=>{(0,we.isEqual)(t[n],this.clientPreferences[n])||(this.logger.log(`Notifying subscribers of: '${n}', settings changed to: `,this.clientPreferences[n]),e.next(this.clientPreferences[n]))}))}getPreferenceObservable(e){return this.createOrGetSubjectFromCache(e).asObservable()}mergeStickyFilterPreferences(e,t){const n=void 0!==t.channelsViewFilter?.pills||void 0!==t.channelsViewFilter?.text?t.channelsViewFilter:e?.channelsViewFilter,i=void 0!==t.chatsViewFilter?.pills||void 0!==t.chatsViewFilter?.text?t.chatsViewFilter:e?.chatsViewFilter;return{unifiedViewFilter:void 0!==t.unifiedViewFilter?.pills||void 0!==t.unifiedViewFilter?.text?t.unifiedViewFilter:e?.unifiedViewFilter,chatsViewFilter:i,channelsViewFilter:n}}createOrGetSubjectFromCache(e){const t=this.subjectCache.get(e);if(t)return t;const n=this.getPreferences(e),i=new ya.t(n);return this.subjectCache.set(e,i),this.logger.log(`Creating subject for '${e}' category, settings:`,n),i}hydrateClientPreferences(){try{const e=this.storage.get(jS);if(!e)return this.logger.log("Client preferences were not found in local storage; returning defaults."),BS;this.logger.log("Client preferences was found in local storage.");const t=JSON.parse(e);return(0,we.defaultsDeep)(t,BS)}catch(e){return this.logger.error("Unable fetch client preferences from local storage. ",e),BS}}}class WS extends xp{constructor(){super(d.c1.CreateClientPreferences,["localStorage","loggerFactory"])}async execute(e){const{localStorage:t,loggerFactory:n}=e;e.clientPreferences=new $S(n,{set:(e,n)=>t.set(e,n,"Framework","Experience"),get:e=>t.get(e,"Experience")})}}class VS extends xp{constructor(){super(d.c1.CreateCommandDelegator,["activeWindowsService","appsRegistryService","client","clientPreferences","commandChangeReportingService","commandHandler","coreSettings","loggerFactory","scenarioFactory","shortcutExecutionService","stateManagementServices","userBiService","windowProvider"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,client:i,clientPreferences:a,commandChangeReportingService:o,commandHandler:r,coreSettings:s,loggerFactory:l,scenarioFactory:c,shortcutExecutionService:d,stateManagementServices:u,userBiService:m,windowProvider:p}=e,g=(e,r)=>te({activeWindowsService:t,appsRegistryService:n,client:i,clientPreferences:a,commandChangeReportingService:o,commandHandler:r,commandInput:e,coreSettings:s,host:p,loggerFactory:l,scenarioFactory:c,shortcutExecutionService:d,stateManagementServices:u,userBiService:m});e.delegatedCommanding=new re(r,g),e.commandDelegator=g}}class HS extends xp{constructor(){super(d.c1.CreateCommandHandler,["activeWindowsService","appsRegistryService","client","clientPreferences","commandChangeReportingService","coreSettings","loggerFactory","notificationsHandler","platformService","rebootService","scenarioFactory","userBiService","userTrackingService","hostCommunicationService"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,authenticationUser:i,client:a,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,loggerFactory:l,notificationsHandler:c,platformService:d,rebootService:u,scenarioFactory:m,userBiService:p,userTrackingService:g,hostCommunicationService:h}=e;e.commandHandler=(e,v)=>Ct({activeWindowsService:t,appsRegistryService:n,authenticationUser:i,client:a,clientLaunchId:v,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,entityCommandInput:e,loggerFactory:l,notificationsHandler:c,platformService:d,rebootService:u,scenarioFactory:m,userBiService:p,userTrackingService:g,hostCommunicationService:h})}}var zS;!function(e){e[e.Canceled=0]="Canceled",e[e.Failure=1]="Failure",e[e.Incomplete=2]="Incomplete",e[e.Success=3]="Success"}(zS||(zS={}));const qS=[p.I.Abandoned,p.I.Close,p.I.IntentTransferredCrossCloud],GS=[p.I.Incomplete,p.I.WindowNotUpdated],YS=[p.I.Blanked,p.I.ContinueHandlingAtHost,p.I.CommandHandledByOnCommandReceived,p.I.CommandHandledPriorToResolution,p.I.EventHandled,p.I.Hidden,p.I.LayoutRendered,p.I.LayoutRenderUpdated,p.I.NoPendingIntent,p.I.NotHandled,p.I.Toggled,p.I.WindowUpdatedButNotRendered,p.I.ModalRendered],QS=[p.I.Failure,p.I.SlotPhasedRenderingTimedOut];function JS(e){switch(e){case p.I.ApplicationHookReceivedCommand:case p.I.CommandBeforeGetAppViewEntities:case p.I.RenderStarted:case p.I.ChunkLoadStarted:case p.I.ChunkLoadSucceeded:case p.I.Rendered:return!0;default:return!1}}const KS={[be.Cu.ClientStart]:24e4},ZS="command-result-service";class XS{constructor(e,t,n,i,a,o){this.commandChangeReportingService=t,this.commandResultChangeReportingService=n,this.experienceChangeReportingService=i,this.host=a,this.coreSettings=o,this.logger=e.newLogger(ZS,"core-services-entity-commanding"),this.pendingCommands=new Map}init(){this.commandChangeSubscription=this.setUpCommandChangeSubscriptions()}destroy(){this.pendingCommands.clear(),this.commandChangeSubscription?.unsubscribe()}registerForCommandTimeOut(e,t){const n=this.pendingCommands.get(e);n&&(n.onCommandTimeOut=t)}unRegisterForCommandTimeOut(e){const t=this.pendingCommands.get(e);t&&(t.onCommandTimeOut=void 0)}onCommandChange(e){switch(e.type){case p.I.ScenarioEventDataAppended:case p.I.ScenarioMarked:case p.I.Rendered:break;case p.I.DelegatedCommandReceived:case p.I.EventBubbled:{const{context:{correlation:t},correlationId:n}=e;let i=this.pendingCommands.get(n);i||(i=this.createPendingCommand({correlation:t}),this.pendingCommands.set(n,i));break}case p.I.CommandStart:{const{correlationId:t,context:{entityCommand:n},userContextId:i}=e;let a=this.pendingCommands.get(t);a?a.entityCommand=n:a=this.createPendingCommand({entityCommand:n,userContextId:i}),this.pendingCommands.set(t,a);break}case p.I.NavigationCommandStart:{const{correlationId:t,context:{correlation:n},userContextId:i}=e;let a=this.pendingCommands.get(t);a||(a=this.createPendingCommand({correlation:n,userContextId:i})),this.pendingCommands.set(t,a);break}case p.I.Incomplete:case p.I.Failure:{const{correlationId:t,context:{errorInfo:n,errorMessage:i,showOops:a,eventData:o,isServiceWorkerActive:r,isLoadedFromServiceWorkerCache:s},userContextId:l}=e,c=this.pendingCommands.get(t);c&&this.calculateCommandResult(c,e.type,l,{errorInfo:n,errorMessage:i,showOops:a,eventData:o,isServiceWorkerActive:r,isLoadedFromServiceWorkerCache:s});break}default:{const{type:t,correlationId:n,context:{eventData:i}}=e,a=this.pendingCommands.get(n);if(a&&a.previousEvents.has(t))break;a&&this.calculateCommandResult(a,e.type,e.userContextId,{eventData:i});break}}}createPendingCommand({correlation:e,entityCommand:t,userContextId:n}){if(!(e=e??t?.command.correlation)){const e=new Error("correlation cannot be undefined. A valid entityCommand or correlation should be passed.");throw this.logger.errorToTelemetry&&this.logger.errorToTelemetry(e.message,"webclient_framework_foundation_command_reporting_service_event",void 0,!0),e}const i=e.id,a=this.host.setTimeout(this.getCommandTimeoutHandler(i,n),this.getCommandTimeout(e));return{correlation:e,entityCommand:t,previousEvents:new Set,timeoutId:a}}getCommandTimeoutHandler(e,t){return()=>{const n=this.pendingCommands.get(e);if(n){const{previousStep:i}=n,a=function(e){return e&&JS(e)?k.Q.TimeoutRunningApp:k.Q.TimeoutRunningCore}(i);n.onCommandTimeOut?.(),this.logger.error(`Command error, correlationId: ${e}, reason ${a}, previousStep: ${i}`);const o=new Set(this.coreSettings.get(c.w.Core).commandingTimeoutOptOutScenarios??[]),r=new Set(this.coreSettings.get(c.w.Core).commandingTimeoutOptOutErrorCodes??[]);if(n.correlation.scenarioName&&o.has(n.correlation.scenarioName)&&r.has(a)){const t="TimeoutRunningCore"===a?p.I.TimeoutRunningCore:"TimeoutRunningApp"===a?p.I.TimeoutRunningApp:p.I.CommandTimeout;this.commandChangeReportingService.report({correlationId:e,type:t,context:{target:"command-result-service",eventData:{reason:a}}})}else this.onCommandResult(zS.Failure,e,a,i,t,{errorCode:a})}}}setUpCommandChangeSubscriptions(){return this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e)))}getCommandTimeout({id:e,scenarioName:t}){return t&&KS[t]?(this.logger.log(`Increasing the command timeout (${KS[t]}) during ${t}, correlationId: ${e}`),KS[t]):12e4}calculateCommandResult(e,t,n,i){const{previousStep:a,correlation:{id:o}}=e;if(e.previousEvents.add(t),e.previousStep=t,!i||void 0===i.isServiceWorkerActive&&void 0===i.isLoadedFromServiceWorkerCache&&void 0===i.showOops||(i.eventData={...i.eventData||{},showOops:i.showOops,isServiceWorkerActive:i.isServiceWorkerActive,isLoadedFromServiceWorkerCache:i.isLoadedFromServiceWorkerCache}),function(e){return YS.includes(e)}(t))this.onCommandResult(zS.Success,o,t,a,n,{eventData:i?.eventData});else if(function(e){return QS.includes(e)}(t)){const e=(r=t,s=i?.errorInfo,r===p.I.SlotPhasedRenderingTimedOut?k.Q.SlotPhasedRenderingTimedOut:s||k.Q.UnknownCommandError),l=i?.errorMessage||i?.eventData?.errors;this.logger.error(`Command error, correlationId: ${o}, reason ${e}, previousStep: ${a}`),this.onCommandResult(zS.Failure,o,e,a,n,{errorCode:e,errorMessage:l,eventData:i?.eventData})}else if(function(e){return qS.includes(e)}(t)){const e=function(e,t){return e===p.I.Close?t&&JS(t)?k.Q.WindowCloseRunningApp:k.Q.WindowCloseRunningCore:e===p.I.Abandoned?p.I.Abandoned:e===p.I.IntentTransferredCrossCloud?p.I.IntentTransferredCrossCloud:k.Q.UnknownCommandError}(t,a);this.onCommandResult(zS.Canceled,o,e,a,n,{errorCode:e,eventData:i?.eventData}),this.logger.log(`Command abandoned, correlationId: ${o}, reason ${e}, previousStep: ${a}`)}else if(function(e){return GS.includes(e)}(t)){const e=i?.errorInfo||t;this.onCommandResult(zS.Incomplete,o,e,a,n,{errorCode:e,eventData:i?.eventData}),this.logger.log(`Command incomplete, correlationId: ${o}, reason ${t}, previousStep: ${a}`)}var r,s}onCommandResult(e,t,n,i,a,o){const r=this.pendingCommands.get(t);r&&(this.reportCommandResult(t,a,e,n,i,r,o),this.cleanUpPendingCommand(t,r))}cleanUpPendingCommand(e,{timeoutId:t}){this.host.clearTimeout(t),this.pendingCommands.delete(e)}reportCommandResult(e,t,n,i,a,o,r){const{entityCommand:s,correlation:{scenarioName:l}}=o;this.commandResultChangeReportingService.report({correlationId:e,userContextId:t,context:{entityCommand:s,error:r?.errorCode||r?.errorMessage?{errorCode:r?.errorCode,errorMessage:r?.errorMessage}:void 0,previousStep:a,reason:i,target:ZS,eventData:r?.eventData},type:n}),l===be.Cu.ClientStart&&n!==zS.Failure&&this.experienceChangeReportingService.report({type:Ua.Mk.ClientStartFinished,correlationId:e,userContextId:t,context:{target:"command-result-service",mainEntityType:s?.entity.type}})}}var ef;!function(e){e.ExpLoader="ExpLoader",e.Core="Core",e.Auth="Auth",e.App="App"}(ef||(ef={}));const tf={eventId:"executeEntityCommand"};function nf(e,t,n,i){const{replyContent:a}=e,{id:o,type:r}=t;if(i)switch(r){case ke.ck.chats:return function({actionType:e,convId:t,userContextId:n,toastType:i},a,o){let r=xt.unknown;if("quickReply"===e)r=xt.quickReply;else{const e=`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown chats action Type`;o.errorToTelemetry&&o.errorToTelemetry(e,"webclient_framework_host_comms",void 0,!0)}return{actionType:r,convId:t||void 0,message:a,userContextId:n,toastType:i}}(i,a,n);case ke.ck.calls:return function({actionType:e,userContextId:t,toastType:n},i,a){return e||(a.errorToTelemetry&&a.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown calls action type`,"webclient_framework_host_comms",void 0,!0),e="Unknown"),{actionType:e,toastId:i||void 0,toastType:n,userContextId:t}}(i,o,n);case ke.ck.communities:case ke.ck.communitiesjoinrequest:case ke.ck.communitiesmembers:return function({actionType:e,userContextId:t,toastType:n,teamId:i,messageId:a},o){return n||(o.errorToTelemetry&&o.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown communities toast type`,"webclient_framework_host_comms",void 0,!0),n="Unknown"),{actionType:e,toastType:n,userContextId:t,messageId:a,teamId:i}}(i,n);case ke.ck.callingdeeplink:return function({actionType:e,userContextId:t,toastType:n},i,a){return e||(a.errorToTelemetry&&a.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown calls action type`,"webclient_framework_host_comms",void 0,!0),e=xt.unknown),{actionType:e,toastId:i||void 0,toastType:n,userContextId:t}}(i,o,n);case ke.ck.notificationsdeeplink:return function({actionType:e,userContextId:t,deeplinkUrl:n},i){return e||(i.errorToTelemetry&&i.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown notificationsdeeplink action type`,"webclient_framework_host_comms",void 0,!0),e=Lt.unknown),{actionType:e,deeplinkUrl:n,userContextId:t}}(i,n);default:return void(n.errorToTelemetry&&n.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Unkown target entity type received from host for toast activation command`,"webclient_framework_host_comms",void 0,!0))}else n.errorToTelemetry&&n.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host without target host entity options`,"webclient_framework_host_comms",void 0,!0)}function af(e,t){switch(e){case Ot.qj.mutate:return ke.SY.mutate;case Ot.qj.view:return ke.SY.view;case Ot.qj.list:return ke.SY.list;case Ot.qj.join:return ke.SY.join;default:return t.errorToTelemetry&&t.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown entity action. Defaulting to view.`,"webclient_framework_host_comms",void 0,!0),ke.SY.view}}function of(e,t){const{entity:n,entityOptions:i,command:a}=e,{visibilityState:o,correlation:r}=a,{id:s,startTimestamp:l,source:c}=r,d=i?.toastActivationEntityOptions;if(t.log(`Converting host entity command, type ${n?.type}, action ${n?.action}, id ${n?.id}`),t.log(`toastActivationEntityOptions ${d}, visibilityState ${o}`),!d)return tf;if(!n)return tf;const{optionsJson:u}=n,m=function(e,t){const{id:n,type:i,action:a,linkedEntity:o}=e;return{action:af(a,t),id:n,linkedEntity:yf(o,t),type:sf(i,t)}}(n,t),p=u?(0,Py.j)(u,void 0):void 0;return{...tf,payload:{entity:m,command:{visibilityState:lf(o,t),correlation:{id:s,startTimestamp:l?l.getTime():void 0,source:c,scenarioName:be.Cu.ToastActivation},stateTransition:Sf(n.type,t)},entityOptions:rf(p),dataOptions:n.action===Ot.qj.mutate||n.type===Ot.w$.communities||n.type===Ot.w$.reminders||n.type===Ot.w$.callingdeeplink||n.type===Ot.w$.communitiesjoinrequest||n.type===Ot.w$.communitiesmembers||n.type===Ot.w$.notificationsdeeplink?nf(d,m,t,p):{userContextId:p.userContextId}}}}function rf(e){if(e?.deepLinkId&&!e?.coordinates)return{deepLinkId:e.deepLinkId};if(e?.deepLinkId&&e?.coordinates)return{deepLinkId:e.deepLinkId,deeplinkId:e.deepLinkId,coordinates:e.coordinates};if(e?.campaignType)return{campaignType:e.campaignType};if(!e?.messageId)return;const{messageId:t,focusOnLoad:n}=e;return{messageId:t,focusOnLoad:n}}function sf(e,t){switch(e){case Ot.w$.chats:case Ot.w$.reminders:return ke.ck.chats;case Ot.w$.calls:return ke.ck.calls;case Ot.w$.extensions:return ke.ck.extensions;case Ot.w$.activity:return ke.ck.activity;case Ot.w$.notificationsdeeplink:return ke.ck.notificationsdeeplink;case Ot.w$.files:return ke.ck.files;case Ot.w$.campaignnotifications:return ke.ck.campaignnotifications;case Ot.w$.channels:return ke.ck.channels;case Ot.w$.communities:return ke.ck.communities;case Ot.w$.communitiesevents:return ke.ck.communitiesevents;case Ot.w$.callingdeeplink:return ke.ck.callingdeeplink;case Ot.w$.communitiesjoinrequest:return ke.ck.communitiesjoinrequest;case Ot.w$.communitiesmembers:return ke.ck.communitiesmembers;default:return t.errorToTelemetry&&t.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown entity type. Defaulting to chats`,"webclient_framework_host_comms",void 0,!0),ke.ck.chats}}function lf(e,t){switch(e){case Ot.t8.show:return g.Rp.show;case Ot.t8.hide:return g.Rp.hide;default:return t.errorToTelemetry&&t.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unknown visibility state. Defaulting to show`,"webclient_framework_host_comms",void 0,!0),g.Rp.show}}function cf(e,t){const{command:n}=e,{correlation:i,visibilityState:a}=n;let o;return i?.startTimestamp&&(o=new Date(+i.startTimestamp),o=Cf(o)?o:void 0),{correlation:{id:i?.id??(0,E.v4)(),startTimestamp:o,source:Ot.V6.toastFromWeb},visibilityState:vf(a,t)}}function df(e,t){try{const{entity:n}=e,{action:i,id:a,type:o}=n;return{action:uf(i,t),id:a,type:gf(o)}}catch(e){throw t.errorToTelemetry&&t.errorToTelemetry(`${fr}${(0,ge.hR)(e)}`,"webclient_framework_host_comms",void 0,!0),e}}function uf(e,t){switch(e){case ke.SY.mutate:return Ot.qj.mutate;case ke.SY.view:return Ot.qj.view;case ke.SY.list:return Ot.qj.list;case ke.SY.join:return Ot.qj.join;default:return t.errorToTelemetry&&t.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing}: EntityAction. Defaulting to HostEntityAction.view`,"webclient_framework_host_comms",void 0,!0),Ot.qj.view}}function mf(e){const{id:t,linkedEntity:n,action:i,type:a,dataOptions:o}=e;return{action:i,id:t,linkedEntity:n,type:a,optionsJson:(0,ge.hR)(o)}}function pf(e){!function(e){if(!e)throw(0,Je.$5)(d.Ir.Commanding,$t.n.RequiredFieldMissing,ke.ck.toasts,void 0,`${$t.n.RequiredFieldMissing}: entityOptions`);const t=e;if(!(t.targetEntity&&t.targetEntity.action&&t.targetEntity.type&&t.targetEntity.dataOptions&&t.time&&(t.title||""===t.title)))throw(0,Je.$5)(d.Ir.Commanding,$t.n.RequiredFieldMissing,ke.ck.toasts,void 0,`${$t.n.RequiredFieldMissing}: hostEntityOptions?.toastEntityOptions`)}(e);const{buttons:t,targetEntity:n,textInput:i,time:a,isUrgent:o,bypassOsLevelDoNotDisturb:r,timeoutEntity:s}=e;return{toastEntityOptions:{...e,isUrgent:o||r,targetEntity:mf(n),time:a,buttons:kf(t),textInput:hf(i),timeoutEntity:s?mf(s):void 0}}}function gf(e){if(e===ke.ck.toasts)return Ot.w$.toasts;throw(0,Je.$5)(d.Ir.Commanding,$t.n.RequiredFieldMissing,ke.ck.toasts,void 0,`${$t.n.RequiredFieldMissing}: EntityType`)}function hf(e){if(!e)return;const{placeholderText:t,sendButton:n}=e;return{placeholderText:t,sendButton:n?ff(n):void 0}}function vf(e,t){switch(e){case g.Rp.hide:return Ot.t8.hide;case g.Rp.show:return Ot.t8.show;default:return t.errorToTelemetry&&t.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing}: EntityVisibilityState. Defaulting to HostEntityVisibilityState.show`,"webclient_framework_host_comms",void 0,!0),Ot.t8.show}}function yf(e,t){if(!e)return;const{id:n,type:i,action:a}=e;return{action:a?af(a,t):void 0,id:n,type:sf(i,t)}}function Sf(e,t){switch(e){case Ot.w$.chats:case Ot.w$.channels:case Ot.w$.calls:case Ot.w$.campaignnotifications:return g.Ar.new;case Ot.w$.extensions:case Ot.w$.reminders:case Ot.w$.activity:case Ot.w$.communities:case Ot.w$.communitiesevents:case Ot.w$.callingdeeplink:case Ot.w$.communitiesjoinrequest:case Ot.w$.communitiesmembers:return g.Ar.flush;default:return t.errorToTelemetry&&t.errorToTelemetry(`${fr}${$t.n.RequiredFieldMissing} Toast activation command received from host with unhandled host entity type - ${e}.`,"webclient_framework_host_comms",void 0,!0),g.Ar.new}}function ff(e){const{image:t,targetEntity:n,text:i,preferImageOnly:a,style:o}=e;return{image:t,preferImageOnly:a,style:o,targetEntity:mf(n),text:i}}function kf(e){if(e)return e.map(ff)}const Cf=e=>e instanceof Date&&!isNaN(e.getTime());async function bf(e,t,n,i){if(e.entity.type!==ke.ck.toasts)return;let a,o,r;if(e.command.correlation?.id&&(a=i.findScenarioByNameAndId(be.Cu.CrossClientToastView,e.command.correlation.id),o=i.findScenarioByNameAndId(be.Cu.WebToastShow,e.command.correlation.id)),e.entityOptions){const t=e.entityOptions;t?.crossClientScenarioName&&t?.callId&&(r=i.findScenarioByNameAndId(t?.crossClientScenarioName,t?.callId))}const s=await async function(e,t){let n;try{n=await e.loadModule("core"),t.log(`${fr}${Cr.LoadModuleCoreSuccess}`)}catch(e){const n=`${fr}${kr.LoadModuleCoreFailed} ${(0,ge.hR)(e)}`;t.errorToTelemetry&&t.errorToTelemetry(n,"webclient_framework_host_comms",void 0,!0)}return n}(t,n);if(!s||!s.executeCommand)return n.errorToTelemetry&&n.errorToTelemetry(`${fr}${kr.LoadModuleCoreFailed}`,"webclient_framework_host_comms",void 0,!0),a?.fail({errorCode:kr.LoadModuleCoreFailed}),o?.fail({errorCode:kr.LoadModuleCoreFailed}),void r?.fail({errorCode:kr.LoadModuleCoreFailed});try{const t=function(e,t){return{command:cf(e,t),entity:df(e,t),entityOptions:pf(e?.entityOptions)}}(e,n);await(s?.executeCommand(t)),n.log(`${fr}${Cr.ExecuteCommandSuccess}`),a?.mark(be.BQ.CrossClientHostEventSent),r?.mark(be.BQ.CrossClientHostEventSent),o?.stop()}catch(e){n.errorToTelemetry&&n.errorToTelemetry(`${fr}${kr.ExecuteCommandFailed} ${(0,ge.hR)(e)}`,"webclient_framework_host_comms",void 0,!0),a?.fail({errorCode:kr.ExecuteCommandFailed}),o?.fail({errorCode:kr.ExecuteCommandFailed}),r?.fail({errorCode:kr.ExecuteCommandFailed})}}class wf{constructor(e,t,n,i){this.commandChangeReportingService=e,this.commandResultChangeReportingService=t,this.scenarioFactory=n,this.pendingCommands=new Map,this.logger=i.newLogger("CommandTelemetryService","core-services-entity-commanding"),this.commandSequence=0}init(){this.commandChangeSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e))),this.commandResultChangeSubscription=this.commandResultChangeReportingService.observeChanges().subscribe((e=>this.onCommandResultChange(e)))}destroy(){this.pendingCommands.clear(),this.commandChangeSubscription?.unsubscribe(),this.commandResultChangeSubscription?.unsubscribe(),this.lifeCycleScopeChangeSubscription?.unsubscribe()}onCommandChange(e){switch(e.type){case p.I.ScenarioEventDataAppended:{const{correlationId:t,context:{eventData:n}}=e;this.appendScenarioEventData(t,n);break}case p.I.ScenarioMarked:{const{correlationId:t,context:{step:n,eventData:i,status:a,monitoringData:o}}=e;this.addScenarioMark(t,n,e.type,i,a,o);break}case p.I.Rendered:break;case p.I.DelegatedCommandReceived:{const{context:{correlation:t}}=e;this.startCommandTelemetry(t.id,{correlation:t});break}case p.I.EventBubbled:{const{context:{correlation:t,eventType:n}}=e;this.startCommandTelemetry(t.id,{correlation:t,eventType:n});break}case p.I.CommandStart:{const{correlationId:t,context:{entityCommand:n}}=e,{scenarioEventData:i}=n;this.startCommandTelemetry(t,{entityCommand:n}),i&&this.appendScenarioEventData(t,i);break}case p.I.NavigationCommandStart:{const{correlationId:t,context:{clientLaunchId:n,correlation:i,eventData:a}}=e;this.startCommandTelemetry(t,{correlation:i,clientLaunchId:n}),a&&this.appendScenarioEventData(t,a);break}default:{const{type:t,correlationId:n,context:{eventData:i}}=e,a=this.pendingCommands.get(n);if(a&&a.previousEvents.has(t))break;a?.previousEvents.add(t),t===p.I.IntentHookStarted?a?.commandScenario.appendEventData({scenarioPhase:ef.Auth}):!function(e){return e===p.I.IntentHookResolved}(t)?JS(t)&&a?.commandScenario.appendEventData({scenarioPhase:ef.App}):a?.commandScenario.appendEventData({scenarioPhase:ef.Core}),i&&this.appendScenarioEventData(n,i),this.addScenarioMark(n,t,t,i);break}}}findExistingNavigationCommandScenario(e,t){const n=t.scenarioName||be.Cu.NavigationCommand;let i=this.scenarioFactory.findScenarioByNameAndId(n,e);return i?.eventData["EventInfo.CorrelationId"]!==t.id&&(i=null),i||t.scenarioName!==be.Cu.ClientStart||(i=this.scenarioFactory.findScenario(be.Cu.ClientStart)),i||void 0}findExistingActivitySwitchScenario(e){const t=e?.id,n=[be.Cu.ActivitySwitch,be.Cu.NavigationCommand,be.Cu.SliceSwitch];if(e?.source===A.p.ActivityFeedBellClick){const e=Array.from(this.pendingCommands.values());for(const i of e)if(i.correlation.scenarioName&&n.includes(i.correlation.scenarioName)){const e=i.correlation.id;this.logger.log(`Command was sent by activity app as a result of a bell click, correlationId ${t}. Combining scenario with existing ${i.correlation.scenarioName} of correlationId ${e}`);const n=i.commandScenario;return this.pendingCommands.delete(e),n}}}startCommandTelemetry(e,{entityCommand:t,correlation:n,clientLaunchId:i,eventType:a}){let o,r=this.pendingCommands.get(e);if(i&&n&&(o=this.findExistingNavigationCommandScenario(i,n)),!o&&t){const{scenarioName:e,id:n}=t.command.correlation;e&&(o=this.scenarioFactory.findScenarioByNameAndId(e,n))}if(o||(o=this.findExistingActivitySwitchScenario(n||t?.command.correlation)),r)t&&(this.logger.log(`Updating command\n\tscenarioName: ${r.commandScenario.name}\n\tcorrelationId: ${e}\n\tentityType: ${t.entity.type}\n\tentityAction: ${t.entity.action}`),r.commandScenario.appendEventData({mainEntityAction:t.entity.action,mainEntityType:t.entity.type,stateTransition:t.command.stateTransition,visibilityState:t.command.visibilityState}));else if(r=this.createPendingCommand(e,{commandScenario:o,entityCommand:t,correlation:n,clientLaunchId:i,eventType:a}),!r)return;this.pendingCommands.set(e,r)}createPendingCommand(e,{entityCommand:t,correlation:n,clientLaunchId:i,commandScenario:a,eventType:o}){if(!(n=n??t?.command.correlation)){const e=new Error("correlation cannot be undefined. A valid entityCommand or correlation should be passed.");throw this.logger.errorToTelemetry&&this.logger.errorToTelemetry(e.message,"webclient_framework_foundation_command_reporting_service_event",void 0,!0),e}if(!a){let o=n.scenarioName;if(!o)return;o===be.Cu.ClientStart&&(o=be.Cu.ClientStartCommand),this.logger.log(`Creating new scenario with scenarioName: ${o}, correlationId: ${e}`);const{startTimestamp:r}=n,s=r&&Cf(new Date(+r))?+r:void 0,l=i;(a=this.scenarioFactory.newScenario(o,{startTime:s,clientId:l,timeoutMs:15e4})).appendEventData({"EventInfo.CorrelationId":e,commandSequence:++this.commandSequence,commandSource:n.source,createdBy:"commandTelemetryService",mainEntityAction:t?.entity.action,mainEntityType:t?.entity.type,scenarioPhase:ef.Core,stateTransition:t?.command.stateTransition,visibilityState:t?.command.visibilityState})}return this.logger.log(o?`Starting to track a new event\n\teventType: ${o}\n\tscenarioName: ${n.scenarioName}\n\tcorrelationId: ${e}\n\t`:`Starting to track a new command\n\tscenarioName: ${n.scenarioName}\n\tcorrelationId: ${e}\n\tentityType: ${t?.entity.type}\n\tentityAction: ${t?.entity.action}\n\tclientId: ${i}`),{correlation:n,commandScenario:a,previousEvents:new Set}}appendScenarioEventData(e,t){const n=this.pendingCommands.get(e);n&&n.commandScenario.appendEventData((0,we.omitBy)(t,we.isUndefined))}addScenarioMark(e,t,n,i,a,o){const r=this.pendingCommands.get(e);r&&(n!==p.I.ScenarioMarked&&this.logger.log(`${r.commandScenario.name} addScenarioMark, step:${t}, correlationId: ${e}, step: ${t}, eventData: ${JSON.stringify(i)}`),r.commandScenario.mark(t,i&&(0,we.omitBy)(i,we.isUndefined),a,o))}onCommandResultChange(e){const{context:{error:t,reason:n,previousStep:i,eventData:a,entityCommand:o},correlationId:r,type:s}=e,l=this.pendingCommands.get(r);if(!l)return;const c=l?.commandScenario,d=(0,we.omitBy)(o&&wf.overrideMainEntityForExtensionCommand(a,o)||a,we.isUndefined);switch(s){case zS.Canceled:{const{errorCode:e}=t||{};this.logger.warn(`${c.name} Cancelled, correlationId: ${r}, reason: ${e}, previousStep: ${i}`),c.cancel({errorCode:e,reason:e,...d});break}case zS.Failure:{const{errorCode:e,errorMessage:n}=t||{};this.logger.error(`${c.name} Failed, correlationId: ${r}, reason: ${e}, errorMessage: ${n}, previousStep: ${i}`),c.fail({errorCode:e,reason:e,errors:n&&(0,et.y)(n),...d});break}case zS.Incomplete:{const{errorCode:e}=t||{};this.logger.warn(`${c.name} Incomplete, correlationId: ${r}, reason: ${e}, previousStep: ${i}`),c.incomplete({errorCode:e,reason:e,...d});break}case zS.Success:this.logger.log(`${c.name} Successful, correlationId: ${r}, reason: ${n}, previousStep: ${i}`),p.I[n]!==p.I.ContinueHandlingAtHost&&c.stop({reason:n,...d})}this.pendingCommands.delete(r)}static overrideMainEntityForExtensionCommand(e,t){return t.command.stateTransition!==g.Ar.extend?e:{...e,modalEntityType:t.entity.type,modalEntityAction:t.entity.action}}}class Tf{constructor(e,t,n){this.commandChangeReportingService=e,this.lifeCycleScopeChangeReportingService=t,this.logger=n.newLogger("CommandAppLifeCycleListenerService","core-services-entity-commanding"),this.lifeCycleScopeChangeSubscription=this.subscribeToLifeCycleScopeChange()}destroy(){this.lifeCycleScopeChangeSubscription?.unsubscribe()}subscribeToLifeCycleScopeChange(){return this.lifeCycleScopeChangeReportingService.observeChanges().pipe((0,o.T)((({correlationId:e,context:{apps:t}})=>{let n=!1;return t.forEach((({id:t,type:i})=>{i===Ua.no.Initialized&&(n=!0,this.logger.log(`${t} initialized, correlationId: ${e}`))})),{appInitialized:n,correlationId:e}})),(0,di.p)((({appInitialized:e})=>e))).subscribe((({correlationId:e,appInitialized:t})=>{this.commandChangeReportingService.report({correlationId:e,type:p.I.ScenarioEventDataAppended,context:{target:"commandAppLifeCycle",eventData:{appInitialized:t}}})}))}}class If{constructor(e){this.commandChangeReportingService=e}init(){this.commandsHistory&&this.destroy(),this.commandsHistory=new tt.M(30),this.initCommandChangeReportingSubscription()}destroy(){this.commandChangeReportingSubscription?.unsubscribe(),this.commandChangeReportingSubscription=void 0,this.commandsHistory=void 0}get CommandsHistory(){return this.commandsHistory}initCommandChangeReportingSubscription(){this.commandChangeReportingSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e)))}onCommandChange(e){const{correlationId:t}=e;if(this.commandsHistory)if(e.type===p.I.CommandStart){const{context:{entityCommand:n}}=e;let i=this.commandsHistory.get(t);const a={entityCommand:n,isCommandTargetedToMainWindow:!1,steps:[]};i=i?{...i,entityCommand:n}:a,this.commandsHistory.set(t,i)}else{const n=this.commandsHistory.get(t);n?.steps.push({event:e.type,timestamp:Date.now()-(parseInt(n.entityCommand.command.correlation.startTimestamp,10)||0)})}}}function Nf(e,t,...n){const{coreSettings:i}=t,a=i?.get(c.w.Core).enableCoreErrorsV2??!1,o=[];for(const i of n)if(!t[i]&&(o.push(i),!a)){const t=`${e}: ${String(i)} is missing`;throw(0,Je.$5)(d.Ir.Core,d.O4.CoreServiceMissing,e,void 0,t)}if(a&&o.length>0)throw br.fromMissingDependencies(e,o);return t}class Af extends xp{constructor(){super(d.c1.CreateCommandReportingService,[])}async execute(e){const t="CreateCommandReportingServiceTask",{commandChangeReportingService:n,coreSettings:i,lifeCycleScopeChangeReportingService:a,loggerFactory:o,scenarioFactory:r,windowProvider:s,experienceChangeReportingService:l}=Nf(t,e,"coreSettings","commandChangeReportingService","lifeCycleScopeChangeReportingService","loggerFactory","scenarioFactory","windowProvider","experienceChangeReportingService");if(i.get(c.w.Core)?.enableStandaloneCommandReportingService){const{commandResultChangeReportingService:a}=Nf(t,e,"commandResultChangeReportingService"),c=new XS(o,n,a,l,s,i);c.init(),e.commandResultService=c,new wf(n,a,r,o).init(),this.initCommandHistoryService(e,n,i)}new Tf(n,a,o),this.initCommandHistoryService(e,n,i)}initCommandHistoryService(e,t,n){e.commandHistoryService=new If(t),n?.get(c.w.Diagnostics).isDiagnosticsPanelEnabled&&e.commandHistoryService.init()}}class Ef extends xp{constructor(){super(d.c1.CreateCommandResultHooksService,[])}async execute(e){const{appsRegistryService:t,coreSettings:n,client:i,commandResultChangeReportingService:a,entityCommanding:o,loggerFactory:r,scenarioFactory:s}=Nf("CreateCommandReportingServiceTask",e,"appsRegistryService","client","commandResultChangeReportingService","coreSettings","entityCommanding","loggerFactory","scenarioFactory");return n.get(c.w.Core)?.enableStandaloneCommandReportingService&&(e.commandResultHooksService=new mi(t,i,a,n,o,r,s,e.authenticationUser&&(0,kt.Lw)(e.authenticationUser)),e.commandResultHooksService.init()),Promise.resolve()}}var Ff=n(551038);const _f=(e,t,n,i)=>{const a=`${e}::TypeError::`;try{return new URL(t,n||void 0)}catch(e){let o=`${a}base::${n}`;throw i&&(o=o.concat(`::url::${t}`)),new Ff.a("URL_PARSE_FAILED",new Error(o))}},Df=(e,t,n)=>{let i=!1,a=!1,o=!1,r=!1,s=!1,l=`${e}::`;const c="ProtocolValidationFailed::",d="OriginValidationFailed::";if(t.protocol&&n.protocol?a=!0:l=l.concat(`${c}EmptyProtocol::'${t.protocol}'::'${n.protocol}'`),t.protocol!==n.protocol?l=l.concat(`${c}'${t.protocol}' !== '${n.protocol}'`):o=!0,t.origin&&n.origin?r=!0:l=l.concat(`${d}EmptyOrigin::'${t.origin}'::'${n.origin}'`),t.origin!==n.origin?l=l.concat(`${d}'${t.origin}' !== '${n.origin}'`):s=!0,i=a&&o&&r&&s,!i)throw new Ff.a("URL_VALIDATION_FAILED",new Error(l))},Pf=[{id:"@msteams/services-io-calling-service-adapters#cmdb-calling-bundle-loader-service-adapter",getConfig:e=>({createScriptURL:(t,n)=>{const i="callingBundleLoaderPolicy",a=e.get(c.w.Security).callingBundleLoaderAllowedOrigin;if(!a)throw new Ff.a("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList callingBundleLoaderAllowedOrigin is undefined or empty`));let o;const r=_f(i,t,n,!0);try{const e=_f(i,a,void 0,!0);return Df(i,r,e),r.href}catch(e){o=e}throw o}})},{id:"@msteams/services-utilities-google-authentication#google-client-library-loader",getConfig:e=>({createScriptURL:(t,n)=>{const i="googleClientLibraryLoaderPolicy",a=e.get(c.w.Security).googleClientLibraryLoaderAllowedOrigin??[];if(!Array.isArray(a)||0===a.length)throw new Ff.a("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList googleClientLibraryLoaderAllowedOrigin is undefined or empty`));let o;const r=_f(i,t,n,!0);for(const e of a)try{const t=_f(i,e,void 0,!0);return Df(i,r,t),r.href}catch(e){o=e}throw o}})},{id:"@msteams/components-location-bing-map#location-sdk-api",getConfig:e=>({createScriptURL:(t,n)=>{const i="locationSdkApiPolicy",a=e.get(c.w.Security).bingApiAllowedOrigin;if(!a)throw new Ff.a("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList bingApiAllowedOrigin is undefined or empty`));let o;const r=_f(i,t,n,!0);try{const e=_f(i,a,void 0,!0);return Df(i,r,e),r.href}catch(e){o=e}throw o}})},{id:"@msteams/components-calling-ppt-sharing#components-calling-ppt-sharing",getConfig:e=>({createScriptURL:(t,n)=>{const i="pptLivePolicy",a=e.get(c.w.Security).pptLiveAllowedOrigin??[];if(!Array.isArray(a)||0===a.length)throw new Ff.a("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList pptLiveAllowedOrigin is undefined or empty`));let o;const r=_f(i,t,n,!0);for(const e of a)try{const t=_f(i,e,void 0,!0);return Df(i,r,t),r.href}catch(e){o=e}throw o}})}],Mf=[{id:"@msteams/no-op",getConfig:()=>({createHTML:e=>e,createScriptURL:e=>e})},{id:"@msteams/services-utilities-common#ChunkLoader",getConfig:e=>({createScriptURL:(t,n)=>{const i="chunkLoaderPolicy";let a,o,r,s=!1,l=!1;const d=_f(i,t,n,!0),u=e.get(c.w.Platform).staticsPath??"";if(!u)throw new Ff.a("URL_PARSE_FAILED",new Error(`${i}::TypeError::allowListUrl staticsPath is undefined`));try{r=_f(i,u,void 0,!0),Df(i,d,r),s=!0}catch(e){a=e}if(s)return d.href;try{r=_f(i,xf,void 0,!0),Df(i,d,r),l=!0}catch(e){o=e}if(l)return d.href;if(a)throw a;throw o}})},{id:"@msteams/services-io-browser-web-client-update#register-service-worker",getConfig:()=>({createScriptURL:(e,t)=>{const n="registerServiceWorkerPolicy";let i,a,o=!1;const r=_f(n,e,t,!0);try{a=_f(n,xf,void 0,!0),Df(n,r,a),o=!0}catch(e){i=e}if(o)return r.pathname;throw i}})},{id:"@msteams/core-services-telemetry-worker#TelemetryWorker",getConfig:e=>({createScriptURL:(e,t)=>{const n="telemetryWorkerPolicy";let i,a,o=!1;const r=_f(n,e,t,!0);try{a=_f(n,xf,void 0,!0),Df(n,r,a),o=!0}catch(e){i=e}if(o)return r.pathname+r.hash;throw i}})}];function Rf(){return window}const xf=Rf().location.origin;class Lf{constructor(e,t){this.coreSettings=e,this.logger=t.newLogger("CoreSecurityService","core-services-security"),this.configMap=new Map,this.policyMap=new Map,this.initializeTrustedTypeConfigMap(),this.setIsTrustedTypePoliciesEnabled()}getTrustedTypePolicy(e){let t;if(this.isTrustedTypePoliciesEnabled||(e="@msteams/no-op"),t=this.policyMap.get(e),t)return t;if(t=this.createTrustedTypePolicyOnDemand(e),t)return this.policyMap.set(e,t),t;const n=new Ff.a("POLICY_NOT_FOUND",new Error(`${e}`));throw this.logger.errorToTelemetry?.(`${n.code}::${n.prevError?.message}`,"webclient_framework_foundation_core_services_security",void 0,!0),n}createTrustedTypePolicyOnDemand(e){const t=this.configMap.get(e);if(!t)return;const n=Rf().trustedTypes;if(!this.isTrustedTypePoliciesEnabled||!n)return this.getOptionsAsTrustedTypePolicy(t);try{return n.createPolicy(t.id,t.getConfig(this.coreSettings))}catch(t){const n=new Ff.a("CREATE_POLICY_FAILED",new Error(`${e}${t?.message}`));throw this.logger.errorToTelemetry?.(`${n.code}::${n.prevError?.message}`,"webclient_framework_foundation_core_services_security",void 0,!0),n}}getOptionsAsTrustedTypePolicy(e){return e.getConfig(this.coreSettings)}initializeConfigs(){Pf.forEach((e=>{this.setConfig(e)}))}initializeCoreConfigs(){Mf.forEach((e=>{this.setConfig(e)}))}initializeTrustedTypeConfigMap(){this.initializeCoreConfigs(),this.initializeConfigs()}setConfig(e){if(this.configMap.has(e.id))throw new Ff.a("DUPLICATE_POLICY_FOUND",new Error(`CoreSecurityService::${e.id}`));this.configMap.set(e.id,e)}setIsTrustedTypePoliciesEnabled(){const{enableTrustedTypePolicies:e}=this.coreSettings.get(c.w.Core);this.isTrustedTypePoliciesEnabled=!!e}}class Of extends xp{constructor(){super(d.c1.CreateCoreSecurityTask,["coreSettings","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,windowProvider:i}=e,a=n.newLogger("CoreSecurityService","core-services-tasks"),o=new Lf(t,n);e.coreSecurityService=o,i.chunkLoader.configureCoreSecurityService(o),a.log("CoreSecurityService Initialized")}}var jf,Bf,Uf;!function(e){e.Merge="merge",e.Override="override"}(jf||(jf={})),function(e){e[e.Configuration=0]="Configuration",e[e.Override=1]="Override",e[e.ClientFilters=2]="ClientFilters",e[e.Policy=3]="Policy",e[e.TestOverride=4]="TestOverride"}(Bf||(Bf={}));class $f{constructor(){this.providers={[Bf.Configuration]:[],[Bf.Override]:[],[Bf.ClientFilters]:[],[Bf.Policy]:[],[Bf.TestOverride]:[]}}registerProvider(e,t){this.providers[t].push(e)}getSettings(e){const t=this.mergeProviders(Bf.Configuration,e),n=this.mergeProviders(Bf.Override,e,t),i=this.mergeProviders(Bf.ClientFilters,e),a=this.combineConfigs(n,i,this.filterAndConfigMergeRule),o=this.mergeProviders(Bf.Policy,e),r=this.combineConfigs(a,o,this.policyAndConfigMergeRule);return this.mergeProviders(Bf.TestOverride,e,r)}mergeProviders(e,t,n={}){return this.providers[e].map((e=>e.getSettings())).filter((e=>!!e)).map((e=>(0,we.pick)(e,t))).reduce(((e,t)=>((0,we.mergeWith)(e,t,oS.L),e)),n)}combineConfigs(e,t,n){return Object.keys(t).map((i=>{const a=(0,we.get)(e,i)||{},o=(0,we.get)(t,i)||{};Object.keys(o).map((t=>{const r=(0,we.get)(a,t),s=(0,we.get)(o,t),l=n(r,s);(0,we.set)(a,t,l),(0,we.set)(e,i,a)}))})),e}policyAndConfigMergeRule(e,t){return(0,we.isNil)(e)?t:(0,we.isNil)(t)?void 0:(0,we.isBoolean)(t)?e&&t:t}filterAndConfigMergeRule(e,t){return(0,we.isNil)(e)?t:(0,we.isBoolean)(t)?t&&e:t}}class Wf{constructor(e){this.value=e,this.observers=new Map}getObservable(e){return new Qe.c((t=>(e.forEach((e=>this.getOrCreateObservers(e).push(t))),t.next(this.value),{unsubscribe:()=>{e.forEach((e=>{const n=this.getOrCreateObservers(e),i=n.indexOf(t);i>=0&&n.splice(i,1)}))}})))}next(e,t){this.value=t;const n=(0,we.reduce)(e.map((e=>this.getOrCreateObservers(e))),((e,t)=>e.concat(t)));new Set(n).forEach((e=>e.next&&e.next(t)))}getOrCreateObservers(e){let t=this.observers.get(e);return void 0===t&&(t=[],this.observers.set(e,t)),t}}class Vf{constructor(e,t,n){this.cachedCategorySettings=new Map,this.allCachedCategorySettings={},this.categoryBehaviorSubjectMap=new Map,this.perCategoryFilteredSubjects={},this.behaviorSubjectForAnySettingsChangeForCdlWorker=new ya.t(void 0),this.providerSubscriptions=[],this.notifySettingsChanged=()=>{const e=[...new Set([...this.cachedCategorySettings.keys(),...Object.keys(this.allCachedCategorySettings)])];this.logger.log(`Settings have changed, checking for differences in these categories: ${e.join(", ")}`);const t=this.allCachedCategorySettings,{filteredSettings:n,allSettings:i}=this.getLatestSettingsForCategories(e);this.allCachedCategorySettings={...this.allCachedCategorySettings,...i};const a={};e.forEach((e=>{const t=this.cachedCategorySettings.get(e)||{},i=n[e]||{},o=this.getKeysForUpdatedSettingsInCategory(t,i);o.length>0&&(a[e]=o,this.cachedCategorySettings.set(e,i))})),(0,we.isEqual)(t,this.allCachedCategorySettings)||this.behaviorSubjectForAnySettingsChangeForCdlWorker.next();const o=this.scenarioFactory?.newScenario(be.Cu.SettingsChangedNotificationSync);try{this.getObservedCategories().forEach((e=>{const t=this.createOrGetBehaviorSubjectFromCache(e),i=n[e]||{},r=a[e]||[];0!==r.length&&(this.logger.log(`Notifying subscribers of: '${e}', settings are changed.`),t.next(i),o?.mark(be.BQ.SettingsChangedNotificationSyncCategoryNotified,{category:e,selectedSettings:!1}),this.getOrCreateFilteredSubject(e).next(r,i),o?.mark(be.BQ.SettingsChangedNotificationSyncCategoryNotified,{category:e,selectedSettings:!0}))}))}finally{o?.stop()}},this.logger=t.newLogger(`CoreSettings/Service(${e})`,"core-services-settings"),this.ruleEngine=new $f,this.logger.log("Created."),this.cdlWorkerSettingsAllowlist=n}cleanup(){this.logger.log("Cleaning up."),this.providerSubscriptions.forEach((e=>e.unsubscribe())),this.categoryBehaviorSubjectMap.clear(),this.perCategoryFilteredSubjects={}}get(e,t){const n=this.cachedCategorySettings.get(e);if(n)return n;const i=this.getLatestSettingsForCategory(e);return this.cachedCategorySettings.set(e,i),i}getObservable(e,t){const n=this.createOrGetBehaviorSubjectFromCache(e);return void 0!==t?this.getOrCreateFilteredSubject(e).getObservable(t):n.asObservable()}getCdlWorkerSettingsAllowlist(){return this.cdlWorkerSettingsAllowlist}getAllCachedSettings(){const e=this.getCdlWorkerAllowlistCategories(),t=Object.keys(this.allCachedCategorySettings),n=e.filter((e=>!t.includes(e)));if(n.length>0){this.logger.log(`getAllCachedSettings(): Missing needed CDL Worker categories from allCachedCategorySettings, missing categories: ${n.join(", ")}`);const{allSettings:e}=this.getLatestSettingsForCategories(n);this.allCachedCategorySettings={...this.allCachedCategorySettings,...e}}return this.allCachedCategorySettings}getObservableForAnySettingsChangeForCdlWorker(){return this.behaviorSubjectForAnySettingsChangeForCdlWorker.asObservable()}registerProvider(e,t){this.ruleEngine.registerProvider(e,t);const n=e.subscribe(this.notifySettingsChanged);this.providerSubscriptions.push(n)}setScenarioFactory(e){this.scenarioFactory=e}createOrGetBehaviorSubjectFromCache(e){let t=this.categoryBehaviorSubjectMap.get(e);if(!t){const n=this.get(e);t=new ya.t(n),this.categoryBehaviorSubjectMap.set(e,t)}return t}getOrCreateFilteredSubject(e){let t=this.perCategoryFilteredSubjects[e];return void 0===t&&(t=new Wf(this.get(e)),this.perCategoryFilteredSubjects[e]=t),t}getLatestSettingsForCategory(e){const{filteredSettings:t,allSettings:n}=this.getLatestSettingsForCategories([e]);return this.allCachedCategorySettings={...this.allCachedCategorySettings,...n},t[e]||{}}getLatestSettingsForCategories(e){e.includes(c.w.Core)||e.push(c.w.Core);const t=this.ruleEngine.getSettings(e),n=t[c.w.Core]?.forwardCdlWorkerSettingsOverrides||[],i=this.getCategoriesAndSettingsToFilterOut(n,this.cdlWorkerSettingsAllowlist);return{filteredSettings:Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(0,we.omit)(t,i[e]||[])]))),allSettings:t}}getKeysForUpdatedSettingsInCategory(e,t){const n=new Set([...Object.keys(e),...Object.keys(t)]),i=[];return n.forEach((n=>{(0,we.isEqual)(e[n],t[n])||i.push(n)})),i}getObservedCategories(){let e=Array.from(this.categoryBehaviorSubjectMap.keys());return e=e.concat(Object.keys(this.perCategoryFilteredSubjects)),e=Array.from(new Set(e)),e}getCdlWorkerAllowlistCategories(){if(void 0===this.cdlWorkerSettingsAllowlist)return[];const{cdlWorkerOnly:e={},forwardToCdlWorker:t={}}=this.cdlWorkerSettingsAllowlist,n=(this.get(c.w.Core)?.forwardCdlWorkerSettingsOverrides||[]).map((e=>e.category));return[...new Set([...Object.keys(e),...Object.keys(t),...n])]}getCategoriesAndSettingsToFilterOut(e,t){const n={},i=t?.cdlWorkerOnly||{};return Object.keys(i).forEach((e=>{n[e]=[...n[e]||[],...i[e]||[]]})),e.forEach((e=>{const t=e.category,i=e.featureFlag,a=e.hideFromMainThread??!1,o=new Set([...n[t]||[]]);a?o.add(i):o.delete(i),n[t]=[...o]})),n}}class Hf{constructor(e,t){this.coreSettingsContext=t,this.providers=[],this.logsProviderName="CoreSettingsLogsProvider",this.logger=e.newLogger("CoreSettingsLogsProvider","core-services-settings")}async getLogsFiles(){return[{isPiiFree:!1,fileName:"settings.json",content:await this.getCurrentSettingsSnapshot()||"Could not fetch settings"}]}registerProvider(e,t){this.providers.push({provider:e,type:t})}async getCurrentSettingsSnapshot(){try{const e=await this.coreSettingsContext.getDebugService(),t=e.getSettings(!0),n=new Map;this.providers.forEach((({provider:e})=>{const t=e.getDiagnosticsInfo();t&&n.set(e.providerName,t)}));const i={settings:this.getGroupedSettings(t),rawPolicies:e.getRawPolicies()||"",providersInfo:[...n.entries()]};return JSON.stringify(i)}catch(e){this.logger.error("Diagnostics: Failed to get settings snapshot: ",e)}return""}getGroupedSettings(e){if(!e||0===e.length)return{};const t=e.reduce(((e,t)=>{if(void 0===t.value&&(!t.providers||0===t.providers.length))return e;e[t.category]=e[t.category]||{},e[t.category][t.key]={};let n=!1;return t.providers?.forEach((i=>{e[t.category][t.key][i.shortName]=i.value,(0,we.isEqual)(t.value,i.value)||(n=!0)})),n&&t.providers&&(t.providers.length>1||void 0===t.value)&&(e[t.category][t.key].value=void 0===t.value?"undefined":t.value),e}),{});return t}}!function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(Uf||(Uf={}));class zf{constructor(){this.callbacks=[]}subscribe(e){if(!(0,we.isFunction)(e))throw Error("Callback is not a valid function.");const t=this;t.callbacks.push(e);return{unsubscribe:()=>{const n=t.callbacks.indexOf(e);n>=0&&t.callbacks.splice(n,1)}}}getRawSettings(){}getDiagnosticsInfo(){}cleanup(){}notifySettingsChanged(e){this.callbacks.forEach((t=>t(e)))}}function qf(e,t,n){const i={};return(0,we.forOwn)(e,((e,a)=>{const o={};(0,we.forOwn)(e,((e,i)=>{(0,we.forEach)(e,(e=>!function(e,t){let n=!0;return(0,we.forOwn)(e,((e,i)=>{const a=(0,we.get)(t,i),o=(0,we.isNil)(a)||a instanceof Array&&0===a.length;return null==e?(n=n&&o,n):(o||(a instanceof Array?a.length>0&&(n=n&&a.includes(e)):n=n&&a===e),n)})),n}(t,e)||(o[i]=e.value,!1))),!o[i]&&n&&(o[i]=!1)})),o&&!(0,we.isEmpty)(o)&&(i[a]=o)})),i}class Gf extends zf{constructor(e,t,n,i,a){super(),this.providerName=e,this.configs=t,this.platformService=n,this.logger=a.newLogger("CoreSettings/ConfigProviderDynamic","core-services-settings"),this.applyFiltersAndNotify(),i&&this.setClientPreferences(i)}cleanup(){this.clientPreferencesSubscription?.unsubscribe()}getSettings(){return this.settings||{}}setLocale(e){this.locale=e,this.applyFiltersAndNotify()}setClientPreferences(e){const t=this.settings?.core?.enableLowPerformanceModeCoreSettingsFilter;t&&(this.clientPreferencesSubscription&&this.clientPreferencesSubscription.unsubscribe(),this.clientPreferencesSubscription=e.getPreferenceObservable("performance").subscribe((({mode:e})=>{this.currentPerformanceMode=e,this.applyFiltersAndNotify()})))}applyFiltersAndNotify(){const e=this.getFilters(),t=qf(this.configs,e);this.logger.log("Filters updated to ",e),this.settings?(0,we.isEqual)(this.settings,t)||(this.settings=t,this.notifySettingsChanged()):this.settings=t}getFilters(){const{ecsOverrides:{environment:e},config:{platformId:t,vdi:n,browser:i,osPlatform:a,buildType:o,isPwa:r,isOcdi:s}}=this.platformService;return{buildType:o,environment:e,browser:i,locale:this.locale,isPwa:r,isOcdi:s,os:a,performanceMode:this.currentPerformanceMode,platform:t,virtualization:n?.configFilter}}}const Yf=e=>e!==Ba.Lg.VeryActive;function Qf(e,t,n,i){let a;const o=()=>{a?.unsubscribe(),a=void 0,s?.cancel()},r=n=>{e(n),o(),t.debug("Notified about settings change")},s=(0,we.throttle)(((e,n)=>{Yf(e)?r(n):t.log("Throttle executed with VeryActive state, waiting for next state change")}),i||0,{leading:!1,trailing:!0}),l=e=>!n||Yf(n.getState())?(r(e),!0):(a||(a=n.observe().subscribe((n=>{Yf(n)&&!i?r(e):i&&(t.log("Throttled function called"),s(n,e))}))),t.log(`Postponed settings change notification due to client state being ${Ba.Lg[n.getState()]}`),!1);return l.cancel=o,l}class Jf extends zf{constructor(e,t,n,i,a){super(),this.settings={},this.providerName="HostProvider",this.logger=t.newLogger("CoreSettings/HostProvider","core-services-settings"),n?(this.logger.log("Host settings found."),this.updateSettingsAndCheckForChanges(n)):this.logger.log("No host settings found."),this.notifySettingsChangedDeferred=Qf((()=>this.notifySettingsChanged()),this.logger,i,a),e.opener?.addEventListener(pi.pI.UpdateWindowState,(e=>{if(e?.payload){let t=e.payload;e.payload?.hostSettings?.hostSettings&&(t=e.payload.hostSettings),this.logger.log("Host settings update received, payload:",t),this.updateSettingsAndCheckForChanges(t)&&this.notifySettingsChangedDeferred()}}))}getSettings(){return this.settings}cleanup(){super.cleanup(),this.notifySettingsChangedDeferred.cancel()}updateSettingsAndCheckForChanges(e){const t={...this.settings.host},n={...this.settings.metadata};e.hostSettings&&Object.assign(t,e.hostSettings),e.desktopSettings&&Object.assign(t,e.desktopSettings),this.updateSettings(t,n,e);const i={[c.w.Host]:t,[c.w.Metadata]:n};return(0,we.isEqual)(this.settings,i)?(this.logger.log("Host settings did not change."),!1):(this.settings=i,this.logger.log("Host settings updated to:",this.settings),!0)}updateSettings(e,t,n){if(n.bootstrapData&&(e.authBootstrapData=n.bootstrapData),n.hostSettings?.hostETag&&(t.hostETag=n.hostSettings.hostETag),n.dataLayerSettings){const t=n.dataLayerSettings,i=t.query||[],a=t.mutation||[],o=t.subscription||[];e.dataLayerSettings={query:i,mutation:a,subscription:o}}}}const Kf=e=>"localMigratedSettings"===e.name,Zf=(e,t)=>{if(null==e)return{};if("string"!=typeof e)return t.errorNoPii?.(`Failed to parse localMigratedSettings. Type is not string, got ${typeof e}.`),{};let n;try{n=JSON.parse(e)}catch{return t.errorNoPii?.("Failed to parse localMigratedSettings. Value is not valid JSON."),{}}const i={chatDensity:ik(n),language:Xf(n,"language"),messagePreviewShown:ok(n),performanceMode:ak(n),callingSelectedDevices:sk(n,"calling_selected_devices"),callingSelectedCameraDevice:sk(n,"calling_selected_camera_device"),callingSelectedSpeakerDevice:sk(n,"calling_selected_speaker_device"),callingSelectedMicrophoneDevice:sk(n,"calling_selected_microphone_device"),callingSelectedSecondaryRingerDevice:sk(n,"calling_selected_secondary_ringer_device"),agcEnabled:ek(n,"agcEnabled"),autoAdjustEnabled:ek(n,"call.setAutoAdjust"),hfmmEnabled:ek(n,"hfmmEnabled"),ignoreMirrorMyVideoSettingsSelected:ek(n,"ignoreMirrorMyVideoSettingsSelected"),noiseSuppressionMode:rk(n),touchUpEnabled:ek(n,"call.setTouchUp"),touchUpStrength:tk(n,"call.setTouchUpStrength"),spatialAudioEnabled:ek(n,"spatialAudioEnabled"),ttyEnabled:ek(n,"ttyEnabled"),cachedImage:lk(n,"cachedImage"),reservedMetadata:ck(n)};return(0,we.omitBy)(i,we.isUndefined)},Xf=(e,t)=>{const n=e[t];return"string"==typeof n?n:void 0},ek=(e,t)=>{const n=e[t];return"boolean"==typeof n?n:"string"==typeof n?"true"===n:void 0},tk=(e,t)=>{const n=e[t];return"number"==typeof n&&Number.isFinite(n)?n:void 0},nk=(e,t)=>{const n=e[t];try{return"string"==typeof n?new Date(n).toISOString():void 0}catch{return}},ik=e=>{switch(e.chatDensity){case"comfy":return"Comfy";case"compact":return"Compact";default:return}},ak=e=>{switch(e.performanceMode){case"Normal":return"Normal";case"Low":return"Low";default:return}},ok=e=>{switch(e.messagePreviewsShown){case"default":return"Default";case"show-previews":return"ShowPreviews";case"hide-previews":return"HidePreviews";default:return}},rk=e=>{switch(e.noiseSuppressionMode){case"Off":return"Off";case"Auto":return"Auto";case"Low":return"Low";case"High":return"High";case"Pns":return"Pns";case"HeadsetNS":return"HeadsetNS";default:return}},sk=(e,t)=>{const n=(0,we.pickBy)(e[t],((e,t)=>["microphone","speaker","camera","audioIngestDevice"].includes(t)&&"string"==typeof e));return Object.keys(n).length>0?n:void 0},lk=(e,t)=>{const n=(0,we.pickBy)(e[t],((e,t)=>["imageId","path","imageSrc"].includes(t)&&"string"==typeof e));return Object.keys(n).length>0?n:void 0},ck=e=>{if(!e.reservedMetadata)return;const t=e.reservedMetadata,n=(0,we.omitBy)({version:tk(t,"version"),correlationId:Xf(t,"correlationId"),created:nk(t,"created"),reason:dk(t)},we.isUndefined);return Object.keys(n).length>0?n:void 0},dk=e=>{switch(Xf(e,"reason")){case"pear-app-install":return"PearAppInstall";case"direct-install":return"DirectInstall";default:return}};class uk extends zf{constructor(e,t){super(),this.host=e,this.settings={},this.providerName="LocalMigratedSettingsProvider",this.logger=t.newLogger("CoreSettings/LocalMigratedSettingsProvider","core-services-settings"),this.loadLocalMigratedSettings()}loadLocalMigratedSettings(){const e=this.getOcdiMigratedSettings();if(e)this.settings={[c.w.LocalMigrated]:{ocdiSettings:e,reservedMetadata:{reason:"OcdiMigration"}}};else{const e=this.host.localStorage.getItem("tmp.localMigratedSettings"),t=Zf(e,this.logger);this.settings={[c.w.LocalMigrated]:{...t}}}this.notifySettingsChanged()}getSettings(){return this.settings}getOcdiMigratedSettings(){const e=this.host.location?.hash?.substring(1);if(e)try{const t=new URLSearchParams(e).get("migratedSettings");if(t){const e=decodeURIComponent(t);return JSON.parse(e)}}catch{this.logger.errorNoPii&&this.logger.errorNoPii("Failed to parse OCDI localMigratedSettings. Value is not a valid JSON.")}}}class mk extends zf{constructor(e){super(),this.settings={},this.providerName="MaglevHostProvider",this.logger=e.newLogger("CoreSettings/MaglevHostProvider","core-services-settings")}async initialize(e){const{windowsInsiderChannel:t,windowsInsiderRing:n,installedThroughAppSwitcher:i}=await this.getHostSettings(e),{hostCapabilitiesSettings:a,localMigratedSettings:o}=await this.fetchHostInitialCapabilities(e);this.settings={[c.w.Host]:{windowsInsiderChannel:t,windowsInsiderRing:n,installedThroughAppSwitcher:i},[c.w.HostCapabilities]:{...a},[c.w.LocalMigrated]:{...o}},this.notifySettingsChanged()}async onPreWarm(e){try{const t=await e.loadModule("m365link"),n=await(t?.isBrowserPreferenceEnabled?.()),i=await this.getHostCapabilities(e),a=await this.getMemoryInfo(e);this.mergeSettings({[c.w.Host]:{enableM365LinksSettings:n},[c.w.HostCapabilities]:{...i},[c.w.Calling]:{totalMemoryInBytes:a}}),t?.registerForIsBrowserPreferenceEnabled?.((e=>{this.mergeSettings({[c.w.Host]:{enableM365LinksSettings:e}})}))}catch(e){this.logger.warn("Unable to get host settings post alt:",e)}}getSettings(){return this.settings}mergeSettings(e){this.settings={[c.w.Host]:{...this.settings.host,...e.host},[c.w.HostCapabilities]:{...this.settings.hostCapabilities,...e.hostCapabilities},[c.w.Calling]:{...this.settings.calling,...e.calling}},this.notifySettingsChanged()}async getHostSettings(e){let t;try{if(t=await e.loadModule("ecs"),t?.getHostSettings)return await(t?.getHostSettings())}catch(e){this.logger.warn("Unable to get host settings:",e)}return{}}async fetchHostInitialCapabilities(e){const t=[];try{const n=await e.loadModule("hostcapabilities"),i=await(n?.getInitialCapabilities?.());i&&t.push(...i)}catch(e){this.logger.warn("Unable to get host capabilities settings:",e)}let n=t.filter((e=>!Kf(e))).reduce(((e,t)=>(Object.assign(e,{[t.name]:t.value}),e)),{});const i=t.find((e=>Kf(e)))?.value;return n={...n,fullLaunchIntent:await this.getFullLaunchIntent(e)},{hostCapabilitiesSettings:n,localMigratedSettings:Zf(i,this.logger)}}async getFullLaunchIntent(e){let t="";try{const n=await e.loadModule("telemetry"),i=await(n?.getContext?.({columns:["launchIntent"]}));if(i&&0!==i.length){t=i.reduce(((e,t)=>({...e,[t.column]:t.value})),{}).launchIntent}}catch(e){this.logger.warn("Unable to get launch intent with full name:",e)}return t}async getHostCapabilities(e){try{const t=await e.loadModule("hostcapabilities"),n=["crossCloudMeetingEnabled","hardwareAccelerationAvailable","isLowSpecDevice","isThirdPartyDevicesManagerEnabled","installedThroughAppSwitcher","storagePartition","phoneLinkingBlocked","windowsInsiderChannel","windowsInsiderRing","t1AppSwitcherEffectivePolicy","t1AppSwitcherCohort"];return(await(t?.getCapabilities?.(n))??[]).reduce(((e,t)=>(Object.assign(e,{[t.name]:t.value}),e)),{})}catch(e){this.logger.warn("Unable to get host capabilities settings:",e)}return{}}async getMemoryInfo(e){try{const t=await e.loadModule("osutils"),n=await(t?.getSystemMemoryInfo?.()),i=Number(n?.totalPhysicalMemoryBytes);return isNaN(i)?void 0:i}catch(e){this.logger.warn("Unable to get memory info:",e)}}}class pk extends zf{constructor(e,t,n){super(),this.loggerFactory=e,this.configLoader=t,this.resolutionStrategy=n,this.settings={},this.providerName="ClientFiltersProvider",this.logger=this.loggerFactory.newLogger("CoreSettings/ClientFiltersProvider","core-services-settings")}initialize(e){this.settings=this.filterSettings(e),this.notifySettingsChanged()}getSettings(){return this.settings}filterSettings(e){const t=qf(this.configLoader(this.getConfigFileName()),e,this.resolutionStrategy===jf.Merge);return this.logger.debug(`Calculated client ${this.resolutionStrategy} filters for ${(0,ge.hR)(e)}:`,t),t}getConfigFileName(){switch(this.resolutionStrategy){case jf.Merge:return"clientFiltersMerge";case jf.Override:default:return"clientFiltersOverride"}}}const gk="tmp";var hk;function vk(e){return[gk,e.experienceName,e.userId,e.tenantId,e.isPwa?"pwa":null,e.environment,e.ring,e.virtualization,e.type].filter((e=>!(0,we.isNil)(e))).join(".")}!function(e){e.TestOverrides="settings",e.EcsCache="ecs-settings-cache",e.PolicyCache="policy-cache"}(hk||(hk={}));const yk="CachedProvider";class Sk extends zf{constructor(e,t,n){super(),this.storage=e,this.options=n,this.providerName=yk,this.logger=t.newLogger("CoreSettings/CachedProvider","core-services-settings")}async initialize(){this.settings=await this.loadCache()}async setProvider(e){this.cleanup(),this.provider=e,this.providerName=`${yk}:${this.provider.providerName}`,this.subscription=this.provider.subscribe((e=>this.updateCache(e))),await this.updateCache()}getProvider(){return this.provider}getSettings(){return this.settings}getDiagnosticsInfo(){return this.provider?this.provider.getDiagnosticsInfo():super.getDiagnosticsInfo()}get cacheState(){return this.getCacheState()}async cleanup(e=!1){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.providerName=yk,this.provider?.cleanup(),e&&this.storage.removeItem(this.getStorageKey())}getCacheState(){return this.settings?Uf.Valid:Uf.NoData}getStorageKey(){if(!this._storageKey){if(!this.options)throw new Error("No storage options are passed to the CachedProvider.");this._storageKey=vk(this.options)}return this._storageKey}async updateCache(e){if(!this.provider)return;const t=e?.settings??this.provider.getSettings(),n=this.getStorageKey();t&&0!==Object.keys(t).length?(this.settings=t,await this.storage.setItem(n,JSON.stringify(this.settings)),this.logger.log(`Cache '${n}' updated.`),this.notifySettingsChanged()):this.logger.log(`Got empty settings from provider. Cache State: ${Uf[this.cacheState]} (Storage key: ${n})`)}async loadCache(){let e;const t=this.getStorageKey();try{const n=await this.storage.getItem(t);n?(e=JSON.parse(n),this.logger.log(`Cache successfully loaded: ${t}`)):this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}return e}}class fk extends Sk{constructor(e,t,n){super(e,t,n)}getExpiration(){const e=this.settings?.metadata?.expires;return e&&!isNaN(Date.parse(e))?new Date(e):void 0}getCacheState(){if(!this.settings)return Uf.NoData;const e=this.getExpiration();return e&&e.valueOf()>Date.now()?Uf.Valid:Uf.Expired}}var kk=n(629838),Ck=n(817922),bk=n(843628),wk=n(363424);function Tk(e){return e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())).replace(/^[a-z]/,(e=>e.toUpperCase()))}const Ik="TeamsEcsClient-CoreSettings/EcsProvider";class Nk extends zf{constructor(e,t,n){super(),this.loggerFactory=n,this.providerName="EcsClientProvider",this.clientStarted=!1,this.onEcsClientConfigurationFetch=e=>{if(!this.fetchProps)throw new Error("Must call initializeClient() before fetching");const{incompleteBootAttemptsCounter:t,notifySettingsChangedDeferred:n,scenarioFactory:i}=this.fetchProps;this.handleEcsConfigurationData(e,this.createScenario(!1,i),t,n)},this.logger=this.loggerFactory.newLogger(`CoreSettings/${this.providerName}`,"core-services-settings"),this.cacheOptions={storage:e,partitionBy:kk.mI.ConsumerKey,consumerKey:vk(t)}}async initializeLocal(){this.ecsClient=await(0,Ck.ej)({serviceName:Ik,cacheOptions:this.cacheOptions,loggerFactory:this.loggerFactory})}async initializeClient(e,t,n,i,a,o,r,s,l){switch(this.fetchProps={ecsParameters:e,host:n,scenarioFactory:r,incompleteBootAttemptsCounter:s,notifySettingsChangedDeferred:Qf((e=>this.notifySettingsChanged(e)),this.logger,i,t.get(c.w.Core).ecsNotifySettingsChangedDelayInMs)},this.ecsClient?.clientType){case"EcsClient":return!1;case"LocalEcsClient":return this.ecsClient=this.ecsClient.createClient({ecsParameters:e,endpointsManager:o,loggerFactory:this.loggerFactory,fetchPrecheck:this.fetchPrecheck(i,a).bind(this),transformData:this.transformDataToSettings.bind(this,l,t.get(c.w.Core).TeamsBuildNamespace)}),!0;default:return this.ecsClient=await(0,Ck.hE)({serviceName:Ik,cacheOptions:this.cacheOptions,loggerFactory:this.loggerFactory,ecsParameters:e,endpointsManager:o,fetchPrecheck:this.fetchPrecheck(i,a).bind(this),transformData:this.transformDataToSettings.bind(this,l,t.get(c.w.Core).TeamsBuildNamespace)}),!0}}async startClient(e,t){if("EcsClient"!==this.ecsClient?.clientType||!this.fetchProps)throw new Error("Must call initializeClient() before startClient()");t?.updatedEcsParameters&&(this.fetchProps.ecsParameters={...t?.updatedEcsParameters},this.ecsClient.updateParameters(this.fetchProps.ecsParameters));let n=!0;const i=this.fetch(!0);return e&&(n=await i),this.ecsClient.startFetchSchedule(this.fetchProps.host,this.onEcsClientConfigurationFetch),this.clientStarted=!0,n}getClientType(){return this.ecsClient?.clientType}getCacheState(){return this.ecsClient?this.ecsClient.cacheState:Uf.NoCache}getSettings(){return this.ecsClient?.get()?.ecsConfiguration}async updateParametersAndFetch(e){if("EcsClient"!==this.ecsClient?.clientType||!this.fetchProps)throw new Error("Must call initializeClient() before updateEcsParameters()");this.fetchProps.ecsParameters={...e};this.ecsClient.updateParameters(this.fetchProps.ecsParameters)?(this.logger.log("Refresh required, manually fetching settings ..."),await this.fetch(!1)):this.logger.log("No refresh required, ECS parameters haven't changed.")}getDiagnosticsInfo(){return this.ecsClient?this.ecsClient.getDiagnosticInfo():"No ECS Client"}cleanup(){super.cleanup(),this.fetchProps?.notifySettingsChangedDeferred.cancel(),"EcsClient"===this.ecsClient?.clientType&&this.ecsClient.dispose()}async fetch(e){if("EcsClient"!==this.ecsClient?.clientType||!this.fetchProps)throw new Error("Must call initializeClient() before fetching");const{incompleteBootAttemptsCounter:t,notifySettingsChangedDeferred:n,scenarioFactory:i}=this.fetchProps,a=this.createScenario(e,i);try{this.logger.debug("Awaiting manual ECS fetch...");const e=await this.ecsClient.fetch();return this.logger.debug("Manual ECS fetch complete."),this.handleEcsConfigurationData(e,a,t,n)}catch(e){return a.fail({errors:e.message}),this.logger.warn("Manual ECS fetch failed.",e),!1}}handleEcsConfigurationData(e,t,n,i){n.markBootAttemptComplete();let a=!1,o=!1;switch(e.requestStatus){case bk.x.Success:if(!e.ecsConfiguration){t.fail({errors:"Empty ECS configuration"});break}o=i({settings:e.ecsConfiguration}),this.logger.log("Settings updated..."),t.stop({size:JSON.stringify(e.ecsConfiguration).length,message:JSON.stringify({settingsUpdated:!0,notified:o})}),a=!0;break;case bk.x.Success_NoChanges:o=i({settings:e.ecsConfiguration}),this.logger.debug("Settings are the same."),t.stop({message:JSON.stringify({settingsUpdated:!1,headersUpdated:!0,notified:o})}),a=!0;break;case bk.x.Abandoned_ClientVeryActive:this.logger.debug("Skipping override settings check due to app being in a very active state."),t.stop({message:"very active"},"abandoned");break;case bk.x.Abandoned_NoNetwork:this.logger.debug("Skipping override settings check due to app being offline."),t.stop({message:"no network"},"abandoned");break;case bk.x.Error_BrowserError:t.stop({errors:`${e.errorMessage} - BrowserError`},"abandoned");break;case bk.x.Error_TimedOut:t.stop({errors:e.errorMessage},"timeout");break;case bk.x.Error_TransformFailed:case bk.x.Error_Unknown:t.fail({errors:e.errorMessage});break;case bk.x.NotStarted:t.fail({errors:"ECS client is in a corrupt state - received a 'NotStarted' request status"});break;default:t.fail({errors:`Received unknown request status value of ${e.requestStatus}`})}return a}fetchPrecheck(e,t){return()=>t&&!1===t.isOnline()?{errorMessage:"Skipping ECS configuration fetch due to app being offline",requestStatus:bk.x.Abandoned_NoNetwork}:!e||e.getState()!==Ba.Lg.VeryActive||{errorMessage:"Skipping ECS configuration fetch due to app being very active",requestStatus:bk.x.Abandoned_ClientVeryActive}}createScenario(e,t){const n=t.newScenario(be.Cu.EcsProviderFetch);return n.appendEventData({endpointUrl:this.ecsClient?.getDiagnosticInfo().fetchUrl,operation:e?"initial":"refresh",correlationId:n.id,timeSinceCacheExpired:(0,wk.pZ)(this.ecsClient?.expiration)}),n}transformDataToSettings(e,t,n){const{ecsConfiguration:i,headers:a}=n;if(!this.fetchProps)throw new Error("Must call initializeClient() before transforming data");if(!i||!a)throw new Error("Data is missing ecsConfiguration or headers");if((0,we.isNil)(this.fetchProps.ecsParameters.agents))return{...n,ecsConfiguration:{}};let o={};const r=[],s=[],{agents:l=[],criticalAgents:c=[]}=this.fetchProps.ecsParameters;return l.forEach((n=>{const a=c?.includes(n);if(a){const e=i[n];if((0,we.isNil)(e))throw new Error(`ECS configuration is missing configurations for critical namespace '${n}'`);o={...o,...e}}if(n===t){const t=i[n],a=this.extractTeamsBuildSettings(e,t);o={...o,...a}}const l=i?.ConfigIDs?.[n];if(l){const e=l.split(",");r.push(...e.filter((e=>e.startsWith("P-E")))),s.push(...e.filter((e=>e.startsWith("P-R"))))}})),o={...o,metadata:{...o.metadata,eTag:a.ETag,expires:a.Expires.toString(),countryCode:a.CountryCode,configIds:{experiments:r,rollouts:s}}},{...n,ecsConfiguration:o}}extractTeamsBuildSettings(e,t){let n={};const i=Tk(e),a=t?.BuildSettings?.[i],o=a?.BuildVersion,r=a?.Sidecars;return n={...n,sidecars:r},o&&(n={...n,teamsBuilds:{buildUpdateVersion:o}}),n}}class Ak extends zf{constructor(e,t){super(),this.workerHostSettings=t,this.providerName="WorkerHostProvider",this.logger=e.newLogger("CoreSettings/WorkerHostSettingsProvider","core-services-settings"),this.settings={},this.testSettings={},this.logger.log("Worker host settings is initialized",this.settings),t.subscribeToHostSettingsUpdates((async()=>{const e=await t.getHostSettings();this.settings=e.settings,this.testSettings=e.testSettings,this.notifySettingsChanged()}))}async initialize(){const e=await(0,yi.a)(this.workerHostSettings.getHostSettings(),1e4).catch((e=>(this.logger.error(`retrieve worker host setting timed out, the error is ${e}`),{settings:{},testSettings:{}})));this.settings=e.settings,this.testSettings=e.testSettings,this.logger.log("Worker host setting is being initialized")}getSettings(){return{...this.settings,[c.w.Test]:this.testSettings}}}class Ek extends zf{constructor(e,t,n){super(),this.loggerFactory=e,this.configLoader=n,this.providerName="ViewportOverrideProvider",this.logger=this.loggerFactory.newLogger("CoreSettings/ViewportOverrideProvider","core-services-settings"),this.settings=this.filterSettings(t)}getSettings(){return this.settings}hasOverrides(){return!(0,we.isEmpty)(this.settings)}hasDifferences(e){const t=this.filterSettings(e);return!(0,we.isEqual)(this.settings,t)}updateSettings(e){const t=this.filterSettings(e);(0,we.isEqual)(this.settings,t)||(this.settings=t,this.notifySettingsChanged())}filterSettings(e){const t=qf(this.configLoader("viewportOverrides"),e);return this.logger.debug(`Calculated overrides for ${(0,ge.hR)(e)}:`,t),t}}class Fk extends zf{constructor(e,t,n){super(),this.host=e,this.providerName="LocalStorageProvider",this.onStorageEvent=e=>{e.key===this.storageKey&&(this.logger.log("Local storage settings updated."),this.settings=this.loadStorageSettings(),this.notifySettingsChanged())},this.logger=t.newLogger("CoreSettings/LocalStorageProvider","core-services-settings"),this.storageKey=vk(n),this.settings=this.loadStorageSettings(),this.host.addEventListener("storage",this.onStorageEvent)}getSettings(){return this.settings}cleanup(){this.host.removeEventListener("storage",this.onStorageEvent)}setSettings(e){try{this.host.localStorage.setItem(this.storageKey,(0,ge.hR)(e))}catch(e){this.logger.log("Could not write settings to local storage, error:",e)}this.settings=e,this.notifySettingsChanged()}clearSettings(){this.host.localStorage.removeItem("tmp.settings"),this.settings={}}loadStorageSettings(){const e=this.host.localStorage.getItem(this.storageKey);if(e)try{return JSON.parse(e)}catch(e){this.logger.log(`Could not parse settings stored in local storage, key: ${this.storageKey}, error: ${e}`)}return{}}}class _k extends zf{constructor(e,t){super(),this.clientPreferencesService=e,this.providerName="ClientPreferencesProvider",this.logger=t.newLogger("CoreSettings/ClientPreferencesProvider","core-services-settings"),this.settings=this.loadClientPreferences(),this.setupSubscription()}getSettings(){return this.settings}cleanup(){this.clientPreferencesSubscription?.unsubscribe()}loadClientPreferences(){const e=this.clientPreferencesService.getPreferences("diagnosticsLogs");if(void 0!==e?.shouldPersistLogsIntoIDB)try{return{diagnostics:{clientExtendedDiagnosticsData:!!e?.shouldPersistLogsIntoIDB}}}catch(t){this.logger.log(`Could not parse client preferences, ${e}, error: ${t}`)}return{}}setupSubscription(){const e=this.clientPreferencesService.getPreferenceObservable("diagnosticsLogs");this.clientPreferencesSubscription=e.subscribe((e=>this.clientPreferenceUpdateHandler(e)))}clientPreferenceUpdateHandler(e){!!e?.shouldPersistLogsIntoIDB!=!!this.settings?.diagnostics?.clientExtendedDiagnosticsData&&(this.settings={diagnostics:{clientExtendedDiagnosticsData:!!e?.shouldPersistLogsIntoIDB}},this.notifySettingsChanged())}}class Dk extends zf{constructor(e){super(),this.providerName="ApiServiceProvider",this.logger=e.newLogger(this.providerName,"core-services-settings"),this.settings=this.loadApiSwitcherSettings()}getSettings(){return this.settings}setOverrides(e){this.settings=this.loadApiSwitcherSettings(e),this.notifySettingsChanged()}clearOverrides(){this.settings={},this.notifySettingsChanged()}loadApiSwitcherSettings(e){if(e?.configs&&e?.id)try{const t=e.configs,n=e.id;return{apiService:{serviceConfig:t},auth:this.getAuthOverrides(e.configs),metadata:{serviceId:n}}}catch(e){this.logger.log(`Could not parse settings stored in local storage , error: ${e}`)}return{}}getAuthOverrides(e){return{authzEndpointUrl:e?.authzEndpointUrl,authzUrl:e?.authzEndpointUrl,authzResource:e?.authzResource,regionGtmsEnv:e?.regionGtmsEnv,ic3NonCaeResource:e?.ic3NonCaeResource,ic3CaeResource:e?.ic3CaeResource}}}class Pk{constructor(e){this.logger=e.newLogger("CoreSettings/QspSettingsParser","core-services-settings")}parse(e,t={}){return new URLSearchParams(e).forEach(((e,n)=>{const i=this.parseQspSetting(n,e);i&&(this.logger.log("QSP override: ",i.key,i.value),(0,we.set)(t,i.key,i.value))})),t}parseQspSetting(e,t){const n=this.extractQspKeyObject(e);if("config"===n.config)return{key:`${n.category}.${n.featureName}`,value:this.tryGetParsedValueOrReturnOriginalValue(t)}}extractQspKeyObject(e){const t=e.split(".");let n="";for(let e=2;e<t.length;e++)n+=t[e],e<t.length-1&&(n+=".");return{config:t[0],category:t[1],featureName:n}}tryGetParsedValueOrReturnOriginalValue(e){const t=e.toLowerCase();return"true"===t||"false"===t?"true"===t:e.startsWith("[")&&e.endsWith("]")?this.getStringArrayValue(e.substring(1,e.length-1)):encodeURIComponent(e)}getStringArrayValue(e){if(0===e.length)return[];const t=e.split(","),n=[];for(const e of t)n.push(encodeURIComponent(e));return n}}class Mk extends zf{constructor(e,t,n,i){super(),this.host=e,this.platformService=t,this.experienceName=i,this.providerName="QspProvider",this.settings={},(this.platformService.config.isInternalUser||"meeting-options"===this.experienceName)&&(this.parser=new Pk(n))}getSettings(){return this.parseQsp(),this.settings}parseQsp(){if(!this.parser)return;const e={};this.host.location.search&&this.parser.parse(this.host.location.search,e);const t=this.getQueryStringFromHash();t&&this.parser.parse(t,e),this.platformService.config.isInternalUser?this.settings=e:"meeting-options"===this.experienceName&&this.populateAllowList(e)}getQueryStringFromHash(){const e=this.host.location.hash;if(!e)return null;const t=e.indexOf("?");return t>-1?e.substr(t):null}populateAllowList(e){const t={};e&&(e.meetingOptions&&(t.meetingOptions={},e.meetingOptions.isClientSideInviteeListSupported&&(t.meetingOptions.isClientSideInviteeListSupported=e.meetingOptions.isClientSideInviteeListSupported),e.meetingOptions.isClientSideSensitivityLabelSupported&&(t.meetingOptions.isClientSideSensitivityLabelSupported=e.meetingOptions.isClientSideSensitivityLabelSupported)),e.host&&(t.host={},e.host.skin&&(t.host.skin=e.host.skin),e.host.headless&&(t.host.headless=e.host.headless),e.host.theme&&(t.host.theme=e.host.theme))),this.settings=t}}var Rk,xk,Lk=n(327402);!function(e){e.None="0",e.CitrixXenDesktop="1",e.CitrixXenApp="2",e.VMWare="3",e.WVD="5",e.AWS="7"}(Rk||(Rk={})),function(e){e.none="none",e.windows365="Windows365"}(xk||(xk={}));class Ok extends zf{constructor(e){super(),this.platformService=e,this.providerName="PlatformProvider",this.platformSettings={[c.w.Platform]:{browser:this.getBrowser(),browserVersion:this.platformService.config.browserVersion?.toString(),buildType:this.platformService.config.buildType,buildVersion:this.platformService.config.buildVersion,clientVersion:this.platformService.config.clientVersion,deviceInfo:this.platformService.host.deviceInfo,enableSlotBorderRadius:this.getEnableSlotBorderRadius(),isHtmlInputSelectApiSupported:this.getIsHtmlInputSelectApiSupported(),isOcdi:this.platformService.config.isOcdi,isPwa:this.platformService.config.isPwa,isScreenRecordingPermissionRequired:this.getIsScreenRecordingPermissionRequired(),sessionId:this.platformService.host.sessionId,staticsPath:this.platformService.config.staticsPath,thirdPartyCookieSupport:nt.at.Unknown,useMacKeyboardLayout:this.getUseMacKeyboardLayout(),vdi:this.getVdiSettings()},[c.w.Metadata]:{environment:this.platformService.ecsOverrides.environment,ring:{id:this.platformService.ecsOverrides.ring},isUserInTargetedRelease:this.getIsUserInTargetedRelease()},[c.w.Host]:{desktopVersion:this.platformService.host.hostAppVersion}}}getSettings(){return this.platformSettings}updateSettings(e){let t={...this.platformSettings.metadata};e.region&&(t={...t,region:e.region});let n={...this.platformSettings.platform};e.bootType&&(n={...n,bootType:e.bootType}),e.localeCode&&(n={...n,localeCode:e.localeCode}),e.thirdPartyCookieSupport&&(n={...n,thirdPartyCookieSupport:e.thirdPartyCookieSupport});const i=this.platformService.host.sessionId;n={...n,sessionId:i},this.platformSettings={...this.platformSettings,[c.w.Platform]:n,[c.w.Metadata]:t},this.notifySettingsChanged()}getBrowser(){const{browser:e}=this.platformService.config;switch(e){case nt.Pw.Chrome:return"Chrome";case nt.Pw.Edge:return"Edge";case nt.Pw.Safari:return"Safari";case nt.Pw.Firefox:return"Firefox";case nt.Pw.Electron:return"Electron";default:return"Unknown"}}getVdiSettings(){const{vdi:e}=this.platformService.config;if(e){const{provider:t,mode:n,isAvRemoted:i,configFilter:a,vdiOptimizationMode:o,subProvider:r,isMaglevUpdateDisabled:s}=e,l=e=>{switch(e){case Rk.CitrixXenDesktop:return"CitrixXenDesktop";case Rk.CitrixXenApp:return"CitrixXenApp";case Rk.VMWare:return"VMWare";case Rk.WVD:return"WVD";case Rk.AWS:return"AWS";default:return"None"}};return{provider:l(t),subProvider:r,mode:n,isAvRemoted:i,configFilter:a,vdiOptimizationMode:o,isMaglevUpdateDisabled:s}}}getIsHtmlInputSelectApiSupported(){return this.platformService.config.osPlatform!==nt.SA.IOS}getUseMacKeyboardLayout(){return this.platformService.config.osPlatform===nt.SA.Mac}getIsScreenRecordingPermissionRequired(){if(this.platformService.config.platformId===nt.PU.MaglevMacT21)return!0;if(this.platformService.config.clientType===nt.sK.Web||this.platformService.config.osPlatform!==nt.SA.Mac||!this.platformService.config.osVersion)return!1;const e=this.platformService.config.osVersion.toString();return(0,Lk.compare)(e,"10.15",">=")}getEnableSlotBorderRadius(){return this.platformService.config.osPlatform===nt.SA.Mac}getIsUserInTargetedRelease(){return"ring3_6"===this.platformService.ecsOverrides.ring&&this.platformService.ecsOverrides.isAssignedRing}}class jk extends zf{constructor(e,t){super(),this.workerHostSettings=t,this.providerName="WorkerHostTestOverridesProvider",this.logger=e.newLogger("CoreSettings/WorkerHostTestOverridesProvider","core-services-settings"),this.settings={},t.subscribeToHostSettingsUpdates((async()=>{const e=await t.getHostSettings();this.settings=(0,we.merge)({},e.localStorageTestOverrides,e.qspTestOverrides),this.notifySettingsChanged()}))}async initialize(){const e=await(0,yi.a)(this.workerHostSettings.getHostSettings(),1e4).catch((e=>(this.logger.error(`Retrieving worker host setting timed out, the error is ${e}`),{localStorageTestOverrides:{},qspTestOverrides:{}})));this.settings=(0,we.merge)({},e.localStorageTestOverrides,e.qspTestOverrides),this.logger.log("Worker host test overrides setting is being initialized")}getSettings(){return this.settings}}class Bk{constructor(e,t,n,i,a,o,r,s,l,c,d){this.id=e,this.experienceName=t,this.cache=n,this.loggerFactory=i,this.platformService=a,this.clientPreferences=o,this.configLoader=r,this.partitionCacheByExperience=s,this.localStorage=l,this.cdlWorkerSettingsAllowlist=c,this.coreSettingsContextFlags=d,this.initialStateHints={primaryUserHadPolicyCache:!1},this.logger=this.loggerFactory.newLogger(`CoreSettings/Context(${e})`,"core-services-settings"),this.cleanupFunctions=[],this.settingsService=new Vf(this.id,this.loggerFactory,this.cdlWorkerSettingsAllowlist),this.cleanupFunctions.push((()=>{this.settingsService.cleanup()})),this.logsProvider=new Hf(this.loggerFactory,this),this.logger.log("Created.")}cleanup(e){this.cache.release(this.id,(()=>{this.logger.log("Cleaning up."),this.cleanupFunctions.forEach((t=>t(e)))}))}getCoreSettings(){return this.settingsService}getLogsProvider(){return this.logsProvider}async getDebugService(){if(!this.debugSettingsService){const{DebugSettingsService:e}=await n.e(288577).then(n.bind(n,785787));this.debugSettingsService=new e(this,this.loggerFactory,this.id)}return this.debugSettingsService}updatePlatformProviderSettings(e){this.platformProvider&&this.platformProvider.updateSettings(e)}updateViewportOverrideProviderSettings(e){this.viewportOverrideProvider&&this.viewportOverrideProvider.updateSettings(e)}setScenarioFactory(e){this.scenarioFactory=e,this.settingsService&&this.settingsService.setScenarioFactory(e)}setLocale(e){this.enableLocaleFilterForFeatureFlags&&(this.locale=e,this.configProvider&&this.configProvider.setLocale(e))}getInitialStateHints(){return this.initialStateHints}registerAllProviders(){this.registerProvider(Bf.Configuration,this.configProvider),this.registerProvider(Bf.Configuration,this.platformProvider),this.registerProvider(Bf.Configuration,this.hostProvider),this.registerProvider(Bf.Configuration,this.localMigratedSettingsProvider),this.registerProvider(Bf.Configuration,this.maglevHostProvider),this.registerProvider(Bf.Configuration,this.workerHostProvider),this.registerProvider(Bf.Configuration,this.clientPreferencesProvider),this.registerProvider(Bf.Configuration,this.ecsClientProvider),this.registerProvider(Bf.Override,this.clientFiltersOverrideProvider),this.registerProvider(Bf.Override,this.viewportOverrideProvider),this.registerProvider(Bf.ClientFilters,this.clientFiltersMergeProvider),this.registerProvider(Bf.Policy,this.policyCachedProvider),this.registerProvider(Bf.TestOverride,this.apiServiceProvider),this.registerProvider(Bf.TestOverride,this.localStorageProvider),this.registerProvider(Bf.TestOverride,this.qspProvider),this.registerProvider(Bf.TestOverride,this.workerTestProvider),this.registerProvider(Bf.TestOverride,this.workerHostTestOverridesProvider)}registerProvider(e,t){t&&(this.settingsService.registerProvider(t,e),this.getLogsProvider().registerProvider(t,e))}async createConfigProviderForMainThread(){this.configProvider=await async function(e){const t=function(e){const{ecsOverrides:{environment:t}}=e;return`${t}`}(e.platformService),{configs:n}=await(0,ev.wg)((()=>e.configLoader(t)),"core-settings-base-configs");return new Gf("ConfigProviderAsync",n,e.platformService,e.clientPreferences,e.loggerFactory)}({clientPreferences:this.clientPreferences,configLoader:this.configLoader,loggerFactory:this.loggerFactory,platformService:this.platformService}),this.locale&&this.configProvider.setLocale(this.locale),this.cleanupFunctions.push((()=>{this.configProvider?.cleanup()}))}createConfigProviderForCDLWorker(){this.configProvider=function(e){const{configs:t}=e.configLoader("config");return new Gf("ConfigProviderSync",t,e.platformService,e.clientPreferences,e.loggerFactory)}({clientPreferences:this.clientPreferences,configLoader:this.configLoader,loggerFactory:this.loggerFactory,platformService:this.platformService}),this.locale&&this.configProvider.setLocale(this.locale),this.cleanupFunctions.push((()=>{this.configProvider?.cleanup()}))}createHostProvider(e,t){this.hostProvider=new Jf(e,this.loggerFactory,t),this.cleanupFunctions.push((()=>{this.hostProvider?.cleanup()}))}createLocalMigratedSettingsProvider(e){this.localMigratedSettingsProvider=new uk(e,this.loggerFactory),this.cleanupFunctions.push((()=>{this.localMigratedSettingsProvider?.cleanup()}))}createMaglevHostProvider(){this.maglevHostProvider=new mk(this.loggerFactory),this.cleanupFunctions.push((()=>{this.maglevHostProvider?.cleanup()}))}createClientFiltersProviders(){this.clientFiltersMergeProvider=new pk(this.loggerFactory,this.configLoader,jf.Merge),this.clientFiltersOverrideProvider=new pk(this.loggerFactory,this.configLoader,jf.Override),this.cleanupFunctions.push((()=>{this.clientFiltersMergeProvider?.cleanup(),this.clientFiltersOverrideProvider?.cleanup()}))}async createEcsCachedProvider(e,t=!0){const{ring:n,environment:i}=this.platformService.ecsOverrides,a="general"===n?void 0:n,o="prod"===i?void 0:i,r=this.partitionCacheByExperience?this.experienceName:void 0,s=this.coreSettingsContextFlags?.get(),l=s?.enableSeparatePwaEcsCache?this.platformService.config.isPwa:void 0;this.ecsCachedProvider=new fk(e,this.loggerFactory,{type:hk.EcsCache,isPwa:l,experienceName:r,ring:a,environment:o,virtualization:this.getVirtualization()}),t&&await this.ecsCachedProvider.initialize(),this.cleanupFunctions.push((()=>{this.ecsCachedProvider?.cleanup()}))}getVirtualization(){return this.platformService.config.clientType===nt.sK.Maglev?this.platformService.config.vdi?.configFilter??void 0:void 0}async createEcsClientProvider(e,t=!0){const{ring:n,environment:i}=this.platformService.ecsOverrides,a="general"===n?void 0:n,o="prod"===i?void 0:i,r=this.partitionCacheByExperience?this.experienceName:void 0,s=this.coreSettingsContextFlags?.get(),l=s?.enableSeparatePwaEcsCache?this.platformService.config.isPwa:void 0,c={type:hk.EcsCache,isPwa:l,experienceName:r,ring:a,environment:o,virtualization:this.getVirtualization()};this.ecsClientProvider=new Nk(e,c,this.loggerFactory),t&&await this.ecsClientProvider.initializeLocal(),this.cleanupFunctions.push((()=>{this.ecsClientProvider?.cleanup()}))}async createWorkerTestProvider(e){this.workerTestProvider=new Sk(e,this.loggerFactory,{type:hk.TestOverrides}),await this.workerTestProvider.initialize(),this.cleanupFunctions.push((()=>{this.workerTestProvider?.cleanup()}))}async createWorkerHostTestOverridesProvider(e){this.workerHostTestOverridesProvider=new jk(this.loggerFactory,e),await this.workerHostTestOverridesProvider.initialize(),this.cleanupFunctions.push((()=>{this.workerHostTestOverridesProvider?.cleanup()}))}async createWorkerHostProvider(e){this.workerHostProvider=new Ak(this.loggerFactory,e),await this.workerHostProvider.initialize(),this.cleanupFunctions.push((()=>{this.workerHostProvider?.cleanup()}))}createViewportOverrideProvider(e){this.viewportOverrideProvider=new Ek(this.loggerFactory,e,this.configLoader),this.cleanupFunctions.push((()=>{this.viewportOverrideProvider?.cleanup()}))}async createPolicyCachedProvider(e,t){this.policyCachedProvider=new Sk(e,this.loggerFactory,{type:hk.PolicyCache,userId:t?.id}),await this.policyCachedProvider.initialize(),this.cleanupFunctions.push((e=>{const t="signout"===e;this.policyCachedProvider?.cleanup(t)}))}createLocalStorageProvider(e){this.localStorageProvider=new Fk(e,this.loggerFactory,{type:hk.TestOverrides}),this.cleanupFunctions.push((()=>{this.localStorageProvider?.cleanup()}))}createClientPreferencesProvider(e){this.clientPreferencesProvider=new _k(e,this.loggerFactory),this.cleanupFunctions.push((()=>{this.clientPreferencesProvider?.cleanup()}))}createApiServiceProvider(){this.apiServiceProvider=new Dk(this.loggerFactory),this.cleanupFunctions.push((()=>{this.apiServiceProvider?.cleanup()}))}createQspProvider(e){this.qspProvider=new Mk(e,this.platformService,this.loggerFactory,this.experienceName),this.cleanupFunctions.push((()=>{this.qspProvider?.cleanup()}))}createPlatformProvider(e){this.platformProvider=new Ok(e),this.cleanupFunctions.push((()=>{this.platformProvider?.cleanup()}))}populateInitialStateHints(){this.policyCachedProvider?.cacheState===Uf.Valid&&(this.initialStateHints.primaryUserHadPolicyCache=!0)}get enableLocaleFilterForFeatureFlags(){const e=this.getCoreSettings(),{enableLocaleFilterForFeatureFlags:t}=e.get(c.w.Core,["enableLocaleFilterForFeatureFlags"]);return!!t}}var Uk,$k,Wk,Vk=n(105878);!function(e){e[e.AbortWhenVeryActive=0]="AbortWhenVeryActive",e[e.ContinueWhenVeryActive=1]="ContinueWhenVeryActive"}(Uk||(Uk={})),function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}($k||($k={})),function(e){e.Initializing="Initializing",e.Unrecoverable="Unrecoverable",e.LongInactive="LongInactive",e.Inactive="Inactive",e.Active="Active",e.VeryActive="VeryActive"}(Wk||(Wk={}));class Hk{constructor(e,t,n,i,a,o,r,s=Uk.AbortWhenVeryActive){this.host=i,this.applicationStateProvider=o,this.networkStateProvider=r,this.clientVeryActiveMode=s,this.ecsClient=(0,Ck.DJ)({serviceName:`TeamsEcsClient-${t}`,ecsParameters:e,loggerFactory:a,endpointsManager:n,fetchPrecheck:this.fetchPreCheck.bind(this)})}updateParameters(e){return this.ecsClient.updateParameters(e)}getDiagnosticInfo(){return{...this.ecsClient.getDiagnosticInfo(),clientVeryActiveMode:this.clientVeryActiveMode,configIds:this.ecsClient.get()?.ecsConfiguration?.ConfigIDs}}async getConfigurationAsync(){return this.ecsClient.fetch()}startWhenExpiredFetchSchedule(e){return this.ecsClient.startFetchSchedule(this.host,e)}stopFetchSchedule(){return this.ecsClient.dispose()}fetchPreCheck(){return this.networkStateProvider&&this.networkStateProvider.getState()!==$k.Online?{errorMessage:"Skipping ECS configuration fetch due to app being offline",requestStatus:bk.x.Abandoned_NoNetwork}:this.clientVeryActiveMode!==Uk.AbortWhenVeryActive||this.applicationStateProvider?.getState()!==Wk.VeryActive||{errorMessage:"Skipping ECS configuration fetch due to app being very active",requestStatus:bk.x.Abandoned_ClientVeryActive}}}class zk extends zf{constructor(e,t,n,i,a,o,r,s,l,d,u){super(),this.coreSettings=t,this.loggerFactory=n,this.scenarioFactory=i,this.host=a,this.clientStateProvider=o,this.networkStateProvider=r,this.endpointsManager=s,this.incompleteBootAttemptsCounter=l,this.experienceName=d,this.getExtraScenarioEventData=u,this._isInitialized=!1,this.providerName="EcsProvider",this.onEcsClientConfigurationFetch=e=>{this.handleEcsConfigurationData(e,this.createScenario(!1))};const m=`CoreSettings/${this.providerName}`;this.logger=n.newLogger(m,"core-services-settings"),this.ecsClientFetchMode=Vk.S.Manual,this.ecsParameters={...e},this.ecsClient=new Hk(this.ecsParameters,m,this.endpointsManager,this.host,this.loggerFactory,this.clientStateProvider,this.networkStateProvider,Uk.AbortWhenVeryActive),this.notifySettingsChangedDeferred=Qf((e=>this.notifySettingsChanged(e)),this.logger,o,this.coreSettings.get(c.w.Core).ecsNotifySettingsChangedDelayInMs)}async initialize(e){if(this.isInitialized)return!1;let t=!0;const n=this.performManualFetch(!0);e&&(t=await n);const i=this.coreSettings.get(c.w.Core).ecsProviderFetchMode;if(this.ecsClientFetchMode=(0,wk._l)(i)??Vk.S.WhenExpired,this.ecsClientFetchMode!==Vk.S.WhenExpired)throw new Error(`${Vk.S[this.ecsClientFetchMode]} fetch mode is not supported`);return this.ecsClient.startWhenExpiredFetchSchedule(this.onEcsClientConfigurationFetch),this._isInitialized=!0,t}get isInitialized(){return this._isInitialized}getSettings(){return this.settings}getParameters(){return this.ecsParameters}getDiagnosticsInfo(){return this.ecsClient.getDiagnosticInfo()}cleanup(){super.cleanup(),this.notifySettingsChangedDeferred.cancel(),this.ecsClient.stopFetchSchedule()}async updateEcsParametersAndFetchSettings(e){this.ecsParameters={...e};this.ecsClient.updateParameters(e)?this.isInitialized?(this.logger.log("Refresh required, manually fetching settings ..."),await this.performManualFetch(!1)):this.logger.log("Refresh required but provider not initialized, skipping settings fetch."):this.logger.log("No refresh required, ECS parameters haven't changed.")}async performManualFetch(e){const t=this.createScenario(e);try{this.logger.debug("Awaiting manual ECS fetch...");const e=await this.ecsClient.getConfigurationAsync();return this.logger.debug("Manual ECS fetch complete."),this.handleEcsConfigurationData(e,t)}catch(e){return this.appendExtraScenarioEventData(t),t.fail({errors:e.message}),this.logger.warn("Manual ECS fetch failed.",e),!1}}notifyEcsFetchComplete(){this.incompleteBootAttemptsCounter.markBootAttemptComplete()}appendExtraScenarioEventData(e){const t=this.getExtraScenarioEventData?.();t&&e.appendEventData(t)}handleEcsConfigurationData(e,t){this.notifyEcsFetchComplete(),this.appendExtraScenarioEventData(t);let n=!1,i=!1;switch(e.requestStatus){case bk.x.Success:if(!e.ecsConfiguration||!e.headers){t.fail({errors:"Empty headers or ECS configuration"});break}try{this.settings=this.extractSettings(e.ecsConfiguration,e.headers)}catch(e){t.fail({errors:`Extracting settings failed - ${e?.message||"unknown error"}`});break}i=this.notifySettingsChangedDeferred({settings:this.settings}),this.logger.log("Settings updated..."),t.stop({size:JSON.stringify(e.ecsConfiguration).length,message:JSON.stringify({settingsUpdated:!0,notified:i})}),n=!0;break;case bk.x.Success_NoChanges:if(!e.headers){t.fail({errors:"Empty headers"});break}this.settings={...this.settings,metadata:{...this.settings?.metadata,expires:e.headers.Expires.toString()}},i=this.notifySettingsChangedDeferred({settings:this.settings}),this.logger.debug("Settings are the same."),t.stop({message:JSON.stringify({settingsUpdated:!1,headersUpdated:!0,notified:i})}),n=!0;break;case bk.x.Abandoned_ClientVeryActive:this.logger.debug("Skipping override settings check due to app being in a very active state."),t.stop({message:"very active"},"abandoned");break;case bk.x.Abandoned_NoNetwork:this.logger.debug("Skipping override settings check due to app being offline."),t.stop({message:"no network"},"abandoned");break;case bk.x.Error_BrowserError:t.stop({errors:`${e.errorMessage} - BrowserError`},"abandoned");break;case bk.x.Error_TimedOut:t.stop({errors:e.errorMessage},"timeout");break;case bk.x.Error_TransformFailed:case bk.x.Error_Unknown:t.fail({errors:e.errorMessage});break;case bk.x.NotStarted:t.fail({errors:"ECS client is in a corrupt state - received a 'NotStarted' request status"});break;default:t.fail({errors:`Received unknown request status value of ${bk.x[e.requestStatus]}`})}return n}createScenario(e){const t=this.scenarioFactory.newScenario(be.Cu.EcsProviderFetch);return t.appendEventData({endpointUrl:this.ecsClient.getDiagnosticInfo().fetchUrl,operation:e?"initial":"refresh",correlationId:t.id}),t}extractSettings(e,t){if((0,we.isNil)(this.ecsParameters.agents))return{};let n={};const i=[],a=[],{TeamsBuildNamespace:o}=this.coreSettings.get(c.w.Core),{agents:r=[],criticalAgents:s=[]}=this.ecsParameters;return r.forEach((t=>{const r=s?.includes(t);if(r){const i=e[t];if((0,we.isNil)(i))throw new Error(`ECS payload is missing configurations for critical namespace '${t}'`);n={...n,...i}}if(t===o){const i=e[t],a=this.extractTeamsBuildSettings(i);n={...n,...a}}const l=e?.ConfigIDs?.[t];if(l){const e=l.split(",");i.push(...e.filter((e=>e.startsWith("P-E")))),a.push(...e.filter((e=>e.startsWith("P-R"))))}})),n={...n,metadata:{...n.metadata,eTag:t.ETag,expires:t.Expires.toString(),countryCode:t.CountryCode,configIds:{experiments:i,rollouts:a}}},n}extractTeamsBuildSettings(e){let t={};const n=Tk(this.experienceName),i=e?.BuildSettings?.[n],a=i?.BuildVersion,o=i?.Sidecars;return t={...t,sidecars:o},a&&(t={...t,teamsBuilds:{buildUpdateVersion:a}}),t}}class qk extends zf{constructor(e,t,n,i){super(),this.policiesDataProvider=t,this.configLoader=n,this.enablePoliciesDefaultValues=i,this.providerName="PolicyProvider",this.refreshSettings=e=>{this.rawPolicies=e;const t=this.policySettings,n=this.mapPoliciesToSettings(e);if(this.enablePoliciesDefaultValues){const e=(0,we.cloneDeep)(this.policySettingsDefaults);this.policySettings=(0,we.mergeWith)(e,n,oS.L)}else this.policySettings=n;(0,we.isEqual)(t,this.policySettings)?this.logger.log("No changes detected."):(this.logger.log("Policy settings updated..."),this.notifySettingsChanged())},this.logger=e.newLogger("CoreSettings/PolicyProvider","core-services-settings"),this.policiesDataProvider.subscribeForSettingsUpdates(this.refreshSettings),this.policySettingsDefaults={},this.rawPolicies={}}async initialize(){this.policiesJson=this.configLoader("policies").mappings,this.enablePoliciesDefaultValues&&this.policiesJson&&(this.policySettingsDefaults=this.getPolicySettingsDefaults(this.policiesJson),this.policySettings=(0,we.cloneDeep)(this.policySettingsDefaults),this.logger.log("Loaded default for policies settings...")),await this.policiesDataProvider.initialize(!0),this.logger.log("Initial fetch completed.")}getSettings(){return this.policySettings}getRawSettings(){return this.rawPolicies}cleanup(){this.policiesDataProvider.cleanup()}getPolicySettingsDefaults(e){const t={};return Object.keys(e).map((e=>{const n={},i=(0,we.get)(this.policiesJson,e);Object.keys(i).map((e=>{const t=(0,we.get)(i,e);if(t&&(0,we.has)(t,"defaultValue")){const i=(0,we.get)(t,"defaultValue");(0,we.set)(n,e,i)}})),(0,we.set)(t,e,n)})),t}mapPoliciesToSettings(e){const t={};return this.policiesJson&&Object.keys(this.policiesJson).map((n=>{const i={},a=(0,we.get)(this.policiesJson,n);Object.keys(a).map((t=>{const n=(0,we.get)(a,t);if(n&&(0,we.has)(n,"name")){const a=(0,we.get)(n,"name"),o=(0,we.get)(e,a);(0,we.set)(i,t,o)}})),(0,we.set)(t,n,i)})),t}}class Gk{constructor(e){this.host=e}setItem(e,t){return this.host.localStorage.setItem(e,t),Promise.resolve()}getItem(e){const t=this.host.localStorage.getItem(e);return Promise.resolve(t)}removeItem(e){return this.host.localStorage.removeItem(e),Promise.resolve()}}const Yk="provider-cache-storage";class Qk{constructor(e,t){this.host=e,this.logger=t.newLogger("AsyncCacheStorage","core-services-settings")}async getItem(e){const t=this.host.localStorage.getItem(e);if(t)try{await this.setItem(e,t),this.host.localStorage.removeItem(e),this.logger.infoToTelemetry?.(`Migrated provider cache storage from LocalStorage to CacheStorage: ${e}`,"ecs_settings_cache_storage")}catch(t){this.logger.errorToTelemetry?.(`Failed to migrate provider cache storage from LocalStorage to CacheStorage: ${e}`,"ecs_settings_cache_storage")}try{const t=await this.host.caches.open(Yk),n=await t.match(new Request(e));if(n)return n.text()}catch(t){this.logger.errorToTelemetry?.(`Failed to get item from CacheStorage: ${e}`,"ecs_settings_cache_storage")}return null}async setItem(e,t){try{const n=await this.host.caches.open(Yk),i=new Response(t);await n.put(new Request(e),i)}catch(t){this.logger.errorToTelemetry?.(`Failed to set item in CacheStorage: ${e}`,"ecs_settings_cache_storage")}}async removeItem(e){try{const t=await this.host.caches.open(Yk);await t.delete(e)}catch(t){this.logger.errorToTelemetry?.(`Failed to remove item from CacheStorage: ${e}`,"ecs_settings_cache_storage")}}}const Jk=["EducationStudent","EducationFaculty","Exploratory","SmbLicense"],Kk=["A1","A3","A5","Other"];function Zk(e,t,n,i){const a=function(e,t,n){let i,a;const{isTrial:o,isTeamsSmb:r,eduLicenseSkuAndCategory:s,region:l,meetingRoomLicenseCategories:c}=e,d=l?.toLowerCase();if(r&&t)a="SmbLicense";else if(s){if(s.trim().length>0&&s.includes("_")){const[e,t]=s.split("_");e&&t&&Kk.find((t=>t===e))&&Jk.find((e=>e===t))&&(i=e,a=t)}}else o&&n&&(a="Exploratory");return{userLicenseSku:i,userLicenseCategory:a,meetingRoomLicenseCategory:Xk(c),region:d}}(e,t,n);return{...a,...i}}function Xk(e){if(null==e)return;const t={Pro:1,Premium:2,Standard:3,Basic:4,None:5},n=[...e.filter((e=>null!=t[e])),"None"],i=n?.sort(((e,n)=>t[e]-t[n]))[0];return i}class eC{constructor(e){this.cacheMap=new Map,this.logger=e.newLogger("CoreSettings/ContextCache","core-services-settings")}cache(e,t){if(this.cacheMap.has(e))throw new Error(`Context '${e}' already stored.`);this.cacheMap.set(e,{context:t,refCount:1}),this.logger.debug(`Context '${e}' cached.`)}acquire(e,t){const n=this.cacheMap.get(e);if(n)return n.refCount++,this.logger.debug(`Acquiring context '${e}', ref count: '${n.refCount}'.`),n.context;if(!t)throw new Error(`Context '${e}' not found in cache.`);this.logger.debug(`Context '${e}' not found in cache, constructing...`);const i=t();return this.cache(e,i),i}release(e,t){const n=this.cacheMap.get(e);if(!n)throw new Error(`Cannot release context '${e}', not found in cache.`);n.refCount--,this.logger.debug(`Releasing context '${e}', ref count: '${n.refCount}'.`),0===n.refCount&&(t(),this.cacheMap.delete(e))}}const tC="incomplete-boot-attempts";class nC{constructor(e,t,n){if(this.coreSettings=e,this.storage=n,this.pastAttemptsCount=0,this.logger=t.newLogger("CoreSettings/IncompleteBootAttemptsCounter","core-services-settings"),!n)return void this.logger.debug("Disabled because no storage is available.");this.pastAttemptsCount=function(e){if(!e)return 0;try{return parseInt(e,10)}catch{return 0}}(n.get(tC));const i=this.pastAttemptsCount+1;n.trySet(tC,`${i}`,"Framework"),this.logger.debug(`Set past incomplete boot count to ${i}.`)}markBootAttemptComplete(){this.storage&&(this.pastAttemptsCount>0&&this.logger.debug("Boot attempt complete, incomplete boot counter reset to 0."),this.storage.trySet(tC,"0","Framework"),this.pastAttemptsCount=0)}get tooManyPastAttempts(){if(!this.storage)return this.logger.debug("No blocking fetch because storage is unavailable."),!1;const e=this.coreSettings.get(c.w.Core).maxBootAttemptsWithoutEcsFetch;if(!e)return this.logger.debug("No blocking fetch because incomplete boot count limit is unset or zero."),!1;const t=this.pastAttemptsCount>=e;return this.logger.debug(`Too many attempts: ${t}`),t}}const iC="cachedPrimaryUser";class aC{constructor(e,t){this.localStorage=e,this.logger=t.newLogger("CoreSettings/PrimaryUserCache","core-services-settings")}get(){return void 0===this.inMemoryCachedUser&&this.loadFromLocalStorage(),this.inMemoryCachedUser}update(e){const t=this.get(),n=(i={...t,...e},(0,we.pickBy)(i,(e=>!(0,we.isNil)(e))));var i;const a=!(0,we.isEqual)(t,n);return this.inMemoryCachedUser=n,this.persistToLocalStorage(),a}clear(){const e=!!this.get();return this.inMemoryCachedUser=null,this.clearLocalStorage(),e}loadFromLocalStorage(){const e=this.localStorage.get(iC,"Experience");if(e)try{return void(this.inMemoryCachedUser=JSON.parse(e))}catch(e){this.logger.warn("Cannot parse cached primary user",e)}this.inMemoryCachedUser=null}persistToLocalStorage(){try{this.localStorage.trySet(iC,(0,ge.hR)(this.inMemoryCachedUser),"Settings","Experience")}catch(e){this.logger.error("Unable to cache primary user")}}clearLocalStorage(){this.localStorage.remove(iC,"Experience")}}const oC="core-settings-context-flags",rC={enableEcsLocalStorageCacheMigration:!1,enableSeparatePwaEcsCache:!1};class sC{constructor(e,t){this.localStorage=e,this.featureFlags=rC,this.logger=t.newLogger("CoreSettingsContextFlags","core-services-settings")}get(){if(void 0!==this.valueFromStore)return this.valueFromStore;const e=this.readStore()??this.featureFlags;return this.valueFromStore=e,e}observeChanges(e){const t=e.getObservable(c.w.Core,["enableEcsLocalStorageCacheMigration","enableSeparatePwaEcsCache"]).subscribe((e=>{if((0,we.isNil)(e))return;const{enableEcsLocalStorageCacheMigration:t,enableSeparatePwaEcsCache:n}=e,i={enableEcsLocalStorageCacheMigration:!!t,enableSeparatePwaEcsCache:!!n},a=this.readStore();if(!a)return this.writeStore(i),void this.logInfo(`Stored ${oC}=${JSON.stringify(i)} for the first time`);Object.keys(i).some((e=>i[e]!==a[e]))&&(this.writeStore(i),this.logInfo(`Updated ${oC} in store from ${JSON.stringify(a)} to ${JSON.stringify(i)}`))}));return()=>t.unsubscribe()}readStore(){const e=this.localStorage.get(oC,"UserAndExperience");if(!(0,we.isNil)(e))try{return JSON.parse(e)}catch(t){return void this.logError(`Failed to parse ${oC} stored value: ${e}`)}}writeStore(e){try{this.localStorage.set(oC,JSON.stringify(e),"Settings","UserAndExperience")}catch{}}logInfo(e){this.logger.infoToTelemetry?.(e,"webclient_framework_core_settings_context_flag",void 0,!0)}logError(e){this.logger.errorToTelemetry?.(e,"webclient_framework_core_settings_context_flag",void 0,!0)}}class lC extends Bk{constructor(e,t,n,i,a,o,r,s,l,c,d,u){super(e,t,n,i,a,o,r,s,l,d,u),this.primaryUserCache=c,this.fetchEcsSettingsIfApplicable=async()=>{"EcsClient"===this.ecsClientProvider?.getClientType()&&(this.ecsClientProvider.clientStarted||await this.ecsClientProvider.startClient(!0),this.coreSettingsContextFlags&&this.cleanupFunctions.push(this.coreSettingsContextFlags.observeChanges(this.getCoreSettings())))},this.getServiceSwitcherApiKey=()=>this.localStorage?.get("serviceId","Experience"),this.getChildId=e=>`${this.id}/${e}`,this.getEcsParameters=e=>{const t=this.enableLocaleFilterForFeatureFlags?this.locale:void 0,n=(e&&e.profile?{userId:e.profile.objectId,tenantId:e.profile.tenantId}:void 0)||(()=>{const e=this.primaryUserCache?.get();return e&&e.userId&&e.tenantId?e:void 0})();return(0,wk.Ck)({coreSettings:this.getCoreSettings(),experienceName:this.experienceName,platformService:this.platformService,user:n,locale:t,logger:this.logger})}}static async createContext(e,t,n,i,a,o,r,s){const l=new eC(i),c=new aC(r,i),d=n("forwardCdlWorkerAllowlist"),u=new sC(r,i),m=new lC("g",t.experienceName,l,i,a,e,n,t.partitionCacheByExperience,r,c,d,u);await m.createConfigProviderForMainThread(),m.createHostProvider(o,s),m.createLocalMigratedSettingsProvider(o),m.createMaglevHostProvider(),m.createPlatformProvider(a),m.createViewportOverrideProvider({viewportContext:o.viewportContext,entityType:null});const p=new Gk(o),g=u.get();if(g?.enableEcsLocalStorageCacheMigration){const e=new Qk(o,i);await m.createEcsClientProvider(e)}else await m.createEcsClientProvider(p);return m.createClientFiltersProviders(),await m.createPolicyCachedProvider(p),m.createLocalStorageProvider(o),m.createQspProvider(o),m.createApiServiceProvider(),m.createClientPreferencesProvider(e),m.populateInitialStateHints(),m.registerAllProviders(),l.cache(m.id,m),m}static createContextForWorker(e,t,n,i){const a=new eC(e),o=new lC("cdl-worker","cdl-worker",a,e,t,n,i);return o.createConfigProviderForCDLWorker(),o.createPlatformProvider(t),o.createClientFiltersProviders(),o.registerAllProviders(),a.cache(o.id,o),o}async createContextForUser(e,t){if(this.primaryUserCache?.get()?.userId===e.profile.objectId)return this.cache.acquire(this.id);const n=this.getChildId(`u-${e.id}`),i=this.cache.acquire(n,(()=>this.clone(n)));i.createClientFiltersProviders();const a=new Gk(t);return await i.createPolicyCachedProvider(a,e),i.registerAllProviders(),i}createContextForViewport(e){if(this.logger.log("Acquiring context for viewport params: ",e),!this.viewportOverrideProvider||this.viewportOverrideProvider?.hasDifferences(e)){const{enableUpdateViewportOverride:t}=this.getCoreSettings().get(c.w.Core),n=`v-${e.viewportContext}-${e.entityType}${t?e.id:""}`,i=this.getChildId(n);return this.cache.acquire(i,(()=>{const t=this.clone(i);return t.createViewportOverrideProvider(e),t.registerAllProviders(),t}))}return this.cache.acquire(this.id)}async setPrimaryUser(e,t,n){this.logger.log(`Setting primary user to: ${e?.id}`);let i=!1;e?(i=this.primaryUserCache?.update({userId:e.profile?.objectId,tenantId:e.profile?.tenantId,teamsLicenseCategories:t?.experimentationTeamsLicenseCategories,teamsAddOnPlans:t?.experimentationTeamsAddOnPlans,mtmaCount:n})||!1,await this.reinitializeEcsProvider(i)):await this.clearPrimaryUser()}async clearPrimaryUser(){this.logger.log("Clearing primary user cache.");const e=this.primaryUserCache?.clear()||!1;await this.reinitializeEcsProvider(e)}setUserTrackingService(e){this.userTrackingSubscription&&(this.userTrackingSubscription.unsubscribe(),this.userTrackingSubscription=void 0),this.userTrackingSubscription=e.getAccountCountCurrentCloudObservable().subscribe((async e=>{const t=this.primaryUserCache?.update({mtmaCount:e})||!1;await this.reinitializeEcsProvider(t)}),(e=>{this.logger.error("Error occurred in user tracking subscription: ",e)}))}initializeProvidersWithCachedPrimaryUser(){const e=this.primaryUserCache?.get();if(e){this.updatePlatformProviderSettings({region:e.region});const{preReleaseFeaturesAllowed:t}=this.getCoreSettings().get(c.w.Metadata),{enableSmbLicenseClientFilter:n}=this.getCoreSettings().get(c.w.Smb),{enableExploratoryLicenseClientFilter:i}=this.getCoreSettings().get(c.w.Core),a=Zk(e,!!n,!!i,{preReleaseFeaturesAllowed:t});this.initializeClientFiltersProviders(a)}}async initializeProvidersWithDiscoveredUser(e,t){const{enableSmbLicenseClientFilter:n}=this.getCoreSettings().get(c.w.Smb),{enableExploratoryLicenseClientFilter:i}=this.getCoreSettings().get(c.w.Core),a=Zk(e,!!n,!!i,t?.clientFilterParams);if(await this.initializeClientFiltersProviders(a),this.updatePlatformProviderSettings({region:e?.region}),t?.isPrimaryUser){const{isTrial:t,isTeamsSmb:n,eduLicenseSkuAndCategory:i,region:a}=e;this.primaryUserCache?.update({isTrial:t,isTeamsSmb:n,eduLicenseSkuAndCategory:i,region:a})}}async initializeMaglevHostProvider(e){await(this.maglevHostProvider?.initialize(e))}async initializeMaglevHostProviderPostAltSettings(e){await(this.maglevHostProvider?.onPreWarm(e))}async initializeEcsProvider({authenticationUser:e,scenarioFactory:t,networkState:n,clientState:i,windowProvider:a,endpointsManager:o,alwaysFetchEcsSettings:r}){if(!this.ecsClientProvider)throw new Error("initializeEcsClientProvider() called without this.ecsClientProvider present");const s=await this.getEcsParameters(e),l=this.getCoreSettings(),c=new nC(l,this.loggerFactory,this.localStorage);this.ecsClientProvider.initializeClient(s,l,a,i,n,o,t,c,this.experienceName);const d=this.ecsClientProvider.getCacheState(),u=d===Uf.Valid||d===Uf.Expired,m=!u||c.tooManyPastAttempts;m||r?(this.logger.log(`Initializing ecsClientProvider: awaitInitialSync? ${m}, hasCacheData? ${u}, alwaysFetch? ${r}`),await this.ecsClientProvider.startClient(m)):this.logger.log("Cache is valid, delaying ECS fetch until WARM.")}async initializeEcsProviderForWorker({authenticationUser:e,scenarioFactory:t,networkState:n,clientState:i,windowProvider:a,endpointsManager:o}){const r=async()=>{const r=await this.getEcsParameters(e),s=this.getCoreSettings(),l=new nC(s,this.loggerFactory,this.localStorage),c=new zk(r,s,this.loggerFactory,t,a,i,n,o,l,this.experienceName,(()=>({timeSinceCacheExpired:(0,wk.pZ)(this.ecsCachedProvider?.getExpiration())})));await c.initialize(this.ecsCachedProvider?.cacheState===Uf.NoData),await(this.ecsCachedProvider?.setProvider(c))},s=this.getCoreSettings(),{enableUnifiedRendererWorkerSettings:l}=s.get(c.w.Core);if(l){this.logger.log("Skipping initializeEcsProvider for worker as enableUnifiedRendererWorkerSettings is true.");const e=s.getObservable(c.w.Core,["enableUnifiedRendererWorkerSettings"]).pipe((0,di.p)((({enableUnifiedRendererWorkerSettings:e})=>!1===e))).subscribe((async()=>{this.logger.log("enableUnifiedRendererWorkerSettings changed to false - Initializing cached and live ECS providers.");try{await this.dererredInitializeEcsProviders(r)}catch(e){this.logger.errorNoPii?.("dererredInitializeEcsProviders - Error occurred while initializing ECS providers in worker.",e)}e.unsubscribe()}))}else await r()}async initializePolicyProvider(e){const{enablePoliciesDefaultValues:t}=this.getCoreSettings().get(c.w.Core),n=new qk(this.loggerFactory,e,this.configLoader,!!t);if(this.policyCachedProvider){const e=n.initialize();this.policyCachedProvider.cacheState===Uf.NoData&&(this.logger.log("Policy cache is empty, waiting to fetch policies."),await e),await this.policyCachedProvider.setProvider(n)}}async initializeWorkerProviders(e,t,n){n?.skipWorkerHostProvider||await this.createWorkerHostProvider(t);const i=!1==!!(this.workerHostProvider?.getSettings()[c.w.Core]||{}).enableUnifiedRendererWorkerSettings;await this.createEcsCachedProvider(e,i),await this.createWorkerTestProvider(e),await this.createWorkerHostTestOverridesProvider(t),this.registerProvider(Bf.Configuration,this.workerHostProvider),this.registerProvider(Bf.Configuration,this.ecsCachedProvider),this.registerProvider(Bf.TestOverride,this.workerTestProvider),this.registerProvider(Bf.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.notifySettingsChanged()}async initializeHostWorkerProviders(e){await this.createWorkerHostProvider(e),this.registerProvider(Bf.Configuration,this.workerHostProvider),this.settingsService.notifySettingsChanged()}async initializeApiServiceProvider(){const e=this.getSelectedServiceConfigs();e&&this.apiServiceProvider&&(this.apiServiceProvider.setOverrides(e),this.cleanupFunctions.push((()=>this.apiServiceProvider?.clearOverrides())))}getLocalStorageTestOverrides(){return this.localStorageProvider?.getSettings()}getQspTestOverrides(){return this.qspProvider?.getSettings()}cleanup(e){this.userTrackingSubscription?.unsubscribe(),this.userTrackingSubscription=void 0,super.cleanup(e)}async dererredInitializeEcsProviders(e){await(this.ecsCachedProvider?.initialize()),await(this.ecsClientProvider?.initializeLocal()),await e()}clone(e){const t=new lC(e,this.experienceName,this.cache,this.loggerFactory,this.platformService,this.clientPreferences,this.configLoader,this.partitionCacheByExperience,this.localStorage,this.primaryUserCache,this.cdlWorkerSettingsAllowlist);return this.scenarioFactory&&t.setScenarioFactory(this.scenarioFactory),t.getInitialStateHints=this.getInitialStateHints,t.configProvider=this.configProvider,t.ecsCachedProvider=this.ecsCachedProvider,t.ecsClientProvider=this.ecsClientProvider,t.hostProvider=this.hostProvider,t.localMigratedSettingsProvider=this.localMigratedSettingsProvider,t.maglevHostProvider=this.maglevHostProvider,t.clientFiltersMergeProvider=this.clientFiltersMergeProvider,t.clientFiltersOverrideProvider=this.clientFiltersOverrideProvider,t.policyCachedProvider=this.policyCachedProvider,t.qspProvider=this.qspProvider,t.localStorageProvider=this.localStorageProvider,t.apiServiceProvider=this.apiServiceProvider,t.platformProvider=this.platformProvider,t}initializeClientFiltersProviders(e){const{enableClientFiltersProvider:t}=this.getCoreSettings().get(c.w.Core);t&&(this.clientFiltersMergeProvider?.initialize(e),this.clientFiltersOverrideProvider?.initialize(e))}getSelectedServiceConfigs(){const e=this.getServiceSwitcherApiKey()||this.getCoreSettings()?.get(c.w.Host)?.serviceSwitcherSelectedServiceId;if(!e)return;const t=this.getCoreSettings()?.get(c.w.Core)?.availableServiceSwitcherApis,n=t?.find((t=>t.id===e));if(n)this.logger.infoToTelemetry?.("Service config found","service_switch_load",{newState:e},!0);else{const t=`No service config found for ${e}`;this.logger.errorToTelemetry?.(t,"service_switch_load",{newState:e,error:t},!0)}return n}async reinitializeEcsProvider(e){if("EcsClient"!==this.ecsClientProvider?.getClientType())return;const t=this.getEcsParameters();!this.ecsClientProvider.clientStarted&&e?await this.ecsClientProvider.startClient(!0,{updatedEcsParameters:t}):await this.ecsClientProvider.updateParametersAndFetch(t)}}class cC extends xp{constructor(){super(d.c1.CreateSettings,[]),this.registerShellHandlers=(e,t)=>{e.opener?.addEventListener(pi.pI.GetSettings,(async()=>t.getCurrentSettingsSnapshot().then((t=>e.opener.postMessage(pi.pI.GetSettings,{settings:t})),(()=>e.opener.postMessage(pi.pI.GetSettings,{settings:""})))))}}async execute(e){const{clientPreferences:t,config:n,configLoader:i,diagnosticsService:a,loggerFactory:o,logsCollectorService:r,platformService:s,windowProvider:l,localStorage:d,postTaskSchedulerDiagnosticsService:u}=Nf("CreateCoreSettingsTask",e,"clientPreferences","config","configLoader","diagnosticsService","loggerFactory","logsCollectorService","platformService","windowProvider","localStorage","postTaskSchedulerDiagnosticsService"),m=await lC.createContext(t,n,i,o,s,l,d),p=m.getCoreSettings();m.initializeProvidersWithCachedPrimaryUser();const g=m.getLogsProvider();e.coreSettingsContext=m,e.coreSettings=p,d?.subscribeToCoreSettings?.(p),a.subscribeToCoreSettings(p),r.subscribeToCoreSettings(p),u.subscribeToCoreSettings(p);p.get(c.w.Core).enableMTMA||r.registerUserLogsProvider("",g),this.registerShellHandlers(l,g)}}class dC extends xp{constructor(){super(d.c1.CreateSettingsUserContext,["authenticationUser","coreSettingsContext","logsCollectorService","windowProvider"])}async execute(e){const{authenticationUser:t,coreSettingsContext:n,logsCollectorService:i,windowProvider:a}=e,o=await n.createContextForUser(t,a);e.coreSettingsContext=o,e.coreSettings=o.getCoreSettings();const r=o.getLogsProvider();return i.registerUserLogsProvider(t.id,r),e=>{switch(e){case"quit":case"signout":o.cleanup(e);break;default:return}}}}class uC{constructor(e,t,n,i,a,o,r,s){this._delegatedCommanding=e,this._experienceChangeReportingService=t,this._authenticationUser=n,this._hostCommunicationService=i,this._loggerFactory=a,this._activeWindowsService=o,this._shortcutRegistryService=r,this._config=s,this._logger=this._loggerFactory.newLogger("core-shortcut-service","core-shortcut-service"),this._registeredDesktopShortcuts=[]}addAppWideShortcut(e,t,n,i){this._shortcutRegistryService?.addAppWideShortcut(e,t,n,i)}removeAppWideShortcut(e,t){this._shortcutRegistryService?.removeAppWideShortcut(e,t)}getAppWideShortcutHandler(e,t){return this._shortcutRegistryService?.getAppWideShortcutHandler(e,t)}async addDesktopClientShortcut(e,t,n,i){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;if(!i)return void this._logger.warn(`Missing windowId for command: ${t}`);const a=await this._hostCommunicationService.loadModule("windowcontrols");try{const o=await(a?.addShortcut?.(i,e));return o&&(this._logger.log(`Added desktop shortcut for command ${t} and shortuctId ${o}`),this._registeredDesktopShortcuts.push({commandId:t,shortcutId:o,commandHandler:n,windowId:i})),o}catch(n){return this._logger.error(`Failed addShortcut for command ${t} and shortuctId ${e.mac}`),""}}async removeDesktopClientShortcut(e,t){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;this._logger.debug(`Removing desktop shortcut for commandId ${e}`);const n=this._registeredDesktopShortcuts.find((n=>n.commandId===e&&n.windowId===t));if(n){const i=await this._hostCommunicationService.loadModule("windowcontrols");await(i?.removeShortcut?.(n.windowId,n.shortcutId)),this._logger.log(`Removed desktop shortcut for command ${e} and shortuctId ${n.shortcutId}`),this._registeredDesktopShortcuts=this._registeredDesktopShortcuts.filter((n=>!(n.commandId===e&&n.windowId===t)))}}async addGlobalShortcut(e,t,n){return this._shortcutRegistryService?.addGlobalShortcut(e,t,n)}async removeGlobalShortcut(e){return this._shortcutRegistryService?.removeGlobalShortcut(e)}async addEventListener(e,t){if(!this._config.enableShortcutPropagation)return;const n=await this.getMainWindow();n?.id===e&&(this._mainShortcutServiceCallback=t)}async processEvent(e,t){if(!this._config.enableShortcutPropagation)return;await this.getMainWindow()?this._mainShortcutServiceCallback?.(e):(this._mainShortcutServiceCallbackWithPayload=()=>{this._mainShortcutServiceCallback?.(e)},this._subscribeToChangeReportingService()),await this.openMainApp()}async registerForDesktopClientKeyDownShortcuts(){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;const e=await this._hostCommunicationService.loadModule("windowcontrols");this._disposeDesktopShortcutKeyDowEventRegistration=e?.registerForKeyDown?.((e=>this._handleDesktopShortcut(e)))}async registerForGlobalShortcutActivated(){return this._shortcutRegistryService?.registerForGlobalShortcutActivated()}async destroy(e){if(this._shortcutRegistryService?.destroy(e),this._config.enableShortcutRegistrationWithDesktopClient&&this._disposeDesktopShortcutKeyDowEventRegistration?.(),this._config.enableShortcutPropagation){const e=this._activeWindowsService.getActiveWindows(),t=e.find((e=>e.isMainWindow&&e.layoutConfig.layoutMode===Yt.Rm.standard));t||(this._mainShortcutServiceCallback=void 0),0!==e.length&&this._authenticationUser&&t?.userContextId===(0,kt.Lw)(this._authenticationUser)||(this._mainShortcutServiceCallbackWithPayload=void 0,this._mainShortcutServiceCallback=void 0,this._subscription&&this._subscription.unsubscribe())}}async getMainWindow(){return this._activeWindowsService.getStandardMainWindow()}async openMainApp(){return this._delegatedCommanding.execute({command:ee.defaultCommand({})})}_handleDesktopShortcut(e){const t=this._registeredDesktopShortcuts.find((t=>t.shortcutId===e.shortcutId));t?(this._logger.debug(`Executing command handler for desktop shortcut: ${t.commandId} / ${e.shortcutId}`),t.commandHandler()):this._logger.warn(`Can't execute desktop shortcut with id ${e.shortcutId}. No record found.`)}_subscribeToChangeReportingService(){const e=this._experienceChangeReportingService.observeChanges();this._subscription=e.pipe((0,o.T)((async e=>{if(e.type!==Ua.TZ.LayoutRenderComplete)return;const t=await this.getMainWindow();e.windowId===t?.id&&this._onMainWindowLayoutRenderComplete()}))).subscribe()}_onMainWindowLayoutRenderComplete(){this._mainShortcutServiceCallbackWithPayload?.(),this._mainShortcutServiceCallbackWithPayload=void 0,this._subscription&&this._subscription.unsubscribe()}}class mC extends xp{constructor(){super(d.c1.CreateCoreShortcutService,["activeWindowsService","coreSettings","experienceChangeReportingService","hostCommunicationService","loggerFactory","shortcutRegistryService","delegatedCommanding"])}async execute(e){const{activeWindowsService:t,authenticationUser:n,coreSettings:i,experienceChangeReportingService:a,hostCommunicationService:o,loggerFactory:r,shortcutRegistryService:s,delegatedCommanding:l}=e,{enableShortcutPropagation:d,enableShortcutRegistrationWithDesktopClient:u,enableGlobalShortcuts:m,enableAppWideShortcuts:p}=i.get(c.w.Shortcuts);(d||m||u||p)&&(e.coreShortcutService=new uC(l,a,n,o,r,t,s,{enableShortcutPropagation:!!d,enableShortcutRegistrationWithDesktopClient:!!u,enableGlobalShortcuts:!!m,enableAppWideShortcuts:!!p}))}}class pC extends xp{constructor(){super(d.c1.CreateCoreUtilities,["isEntityInView"])}async execute(e){const{isEntityInView:t}=e;e.coreUtilities={isEntityInView:t}}}class gC{constructor(e,t){this.channelName=e,this.host=t,this.subscriptions=[],this.hostResumeEventHandler=()=>{this.closeChannel(),this.initializeChannel()},this.initializeChannel(),this.subcribeToHostLifecycleEvents()}canPostMessage(){return!!this.broadcastChannel}postMessage(e){return this.broadcastChannel?(this.broadcastChannel.postMessage(e),"success"):"failure"}subscribeToMessage(e){this.subscriptions.push(e),this.broadcastChannel?.addEventListener("message",(t=>e(t.data)))}dispose(){this.unsubscribeFromHostLifecycleEvents(),this.closeChannel(),this.subscriptions=[]}initializeChannel(){const e=new BroadcastChannel(this.channelName);this.broadcastChannel=e,this.subscriptions.forEach((t=>e.addEventListener("message",(e=>t(e.data)))))}closeChannel(){this.broadcastChannel?.close(),this.broadcastChannel=void 0}subcribeToHostLifecycleEvents(){this.host.addEventListener("resume",this.hostResumeEventHandler)}unsubscribeFromHostLifecycleEvents(){this.host.removeEventListener("resume",this.hostResumeEventHandler)}}class hC{constructor(e,t){this.logger=e,this.host=t,this.subscriptions=new Map,this.channel=new gC(hC.CrossTabsCommsBusKey,this.host),this.initializeSubscriptions(),this.logger.logNoPii?.("Initialized")}postMessage(e,t){if(!this.channel.canPostMessage())return"failure";const n=this.toCrossTabsMessagePayload(e,t);return this.channel.postMessage(n)}subscribeToMessage(e,t){const n=this.subscriptions.get(e)||new Set;n.add(t),this.subscriptions.set(e,n);const i=()=>{const n=this.subscriptions.get(e);n?.has(t)&&n.delete(t)};return()=>i()}dispose(){this.channel.dispose(),this.subscriptions.clear()}broadcastedMessageHandler(e){this.logger.logNoPii?.(`Message received: type=${e.messageType}, id={${e.messageId}}, correlationId={${e.correlationId}}`);const t=e.messageType;if(t){const n=this.subscriptions.get(t);n&&n.forEach((t=>t({...e})))}}initializeSubscriptions(){this.channel.subscribeToMessage((e=>this.broadcastedMessageHandler(e)))}toCrossTabsMessagePayload(e,t){return{messageType:e,timestamp:Date.now(),messageId:(0,ai.aq)(),correlationId:t?.responseRequired?(0,ai.aq)():void 0,...t}}}hC.CrossTabsCommsBusKey="CrossTabsBus";class vC{constructor(e,t,n){this.baseCrossTabsService=e,this.logger=t,this.host=n,this.subscribeToTabsSearch()}areOtherTabsDetected(){return new Promise((e=>{let t=0;const n=this.baseCrossTabsService.subscribeToMessage("SearchTabsResponse",(()=>{t&&this.host.clearTimeout(t),n(),e(!0)}));"failure"===this.baseCrossTabsService.postMessage("SearchTabs",{responseRequired:!0})&&(n(),e(!1)),t=this.host.setTimeout((()=>{e(!1)}),1e3)}))}subscribeToTabsSearch(){this.baseCrossTabsService.subscribeToMessage("SearchTabs",(e=>{this.baseCrossTabsService.postMessage("SearchTabsResponse",{correlationId:e.correlationId}),this.logger.logNoPii?.(`SearchTabs received. CorrelationId: ${e.correlationId}`)}))}}const yC=3e5;class SC{constructor(e,t,n,i){this.baseCrossTabsService=e,this.logger=t,this.host=n,this.timestampOfLastCountTabsResponse=0,this.activeTabsLimitReached=!1,this.tabsLimitCalculated=!1,this.waitForTabsCountTimeoutMs=5e3,this.waitForTabsCountResponsesTimeoutMs=3e3,this.tabsRecountIntervalMs=yC,this.tabInitializationTimestamp=Date.now(),this.tabClosingEventHandler=()=>{this.logger.logNoPii?.("Tab might to be closing. Sending TabClosed message."),this.baseCrossTabsService.postMessage("TabClosed")},this.activeTabsCountBehaviorSubject=new ya.t(1),this.activeTabsLimitReachedPromiseDeferred=(0,Wv.v)(),this.subscribeToSettings(i)}observeActiveTabsCount(){return this.activeTabsCountBehaviorSubject.asObservable()}getActiveTabsCount(){return this.activeTabsCountBehaviorSubject.getValue()}isActiveTabsLimitReached(){return this.activeTabsLimitReachedPromiseDeferred.promise}dispose(){this.stopTabsCounting(),this.coreSettingsSubscription?.unsubscribe(),this.activeTabsCountBehaviorSubject.complete()}subscribeToSettings(e){const t=e.getObservable(c.w.Core,["disableActiveTabsCounting","crossTabsRecountIntervalMs","crossTabsWaitCountTabsResponseIntervalMs","crossTabsWaitForTabsCountTimeoutMs","crossTabsActiveTabsLimit"]);this.coreSettingsSubscription=t.subscribe((e=>{const{disableActiveTabsCounting:t,crossTabsRecountIntervalMs:n,crossTabsWaitCountTabsResponseIntervalMs:i,crossTabsWaitForTabsCountTimeoutMs:a,crossTabsActiveTabsLimit:o}=e;this.tabsRecountIntervalMs=n??yC,this.waitForTabsCountResponsesTimeoutMs=i??3e3,this.waitForTabsCountTimeoutMs=a??5e3,this.activeTabsLimit=o??void 0,void 0!==this.disableActiveTabsCounting&&this.disableActiveTabsCounting===!!t||(this.disableActiveTabsCounting=!!t,this.disableActiveTabsCounting?this.stopTabsCounting():this.initializeTabsCounting())}))}initializeTabsCounting(){this.initializeTabClosingHandlers(),this.subscribeToTabsCountingEvents(),this.restartTabsCountingTimer(),this.countTabs(!0)}stopTabsCounting(){this.clearTabsCountingTimer(),this.clearWaitForTabsCountTimer(),this.countTabsPromise?.cancel?.(),this.countTabsPromise=void 0,this.unsubscribeFromHostLifecycleEvents(),this.unsubscribeFromTabsCountingEvents(),this.tabsLimitCalculated||(this.tabsLimitCalculated=!0,this.activeTabsLimitReachedPromiseDeferred.resolve(this.activeTabsLimitReached)),this.activeTabsCountBehaviorSubject.next(1)}subscribeToTabsCountingEvents(){this.unsubscribeFromTabsCountMessage=this.baseCrossTabsService.subscribeToMessage("TabsCount",(e=>{this.clearWaitForTabsCountTimer(),this.logger.logNoPii?.(`TabsCount ${e.tabsCount} received. CorrelationId: ${e.correlationId}`),this.updateActiveTabsCount(e.tabsCount,e.lastResponseTimestamp),this.restartTabsCountingTimer()})),this.unsubscribeFromCountTabsMessage=this.baseCrossTabsService.subscribeToMessage("CountTabs",(e=>{this.baseCrossTabsService.postMessage("CountTabsResponse",{correlationId:e.correlationId,tabTimestamp:this.tabInitializationTimestamp}),this.logger.logNoPii?.(`CountTabs received. CorrelationId: ${e.correlationId}`),this.startWaitForTabsCountTimer()}))}unsubscribeFromTabsCountingEvents(){this.unsubscribeFromCountTabsMessage?.(),this.unsubscribeFromTabsCountMessage?.()}countTabs(e=!1){if(this.countTabsPromise)return this.countTabsPromise.promise;let t;const n=new Promise((n=>{let i=0;const a=(0,ai.aq)();let o=1,r=Date.now();const s=[],l=this.baseCrossTabsService.subscribeToMessage("CountTabsResponse",(e=>{e.correlationId===a&&(o++,r=Date.now(),s.push(e.tabTimestamp))}));t=()=>{l(),i&&this.host.clearTimeout(i),i=0,n()};const c=this.baseCrossTabsService.postMessage("CountTabs",{correlationId:a}),d=Date.now(),u=()=>{l();let i=!1;this.tabsLimitCalculated||this.activeTabsLimitReached||(i=this.isLimitReachedForThisTab(s),i&&o--);const c=this.getActiveTabsCount().toString();this.updateActiveTabsCount(o,r),this.baseCrossTabsService.postMessage("TabsCount",{tabsCount:o,correlationId:a,lastResponseTimestamp:r});const u=r>=d?r-d:-1;this.logger.infoToTelemetry?.(`tabs counting timespan is ${u}`,"crosstabs_tabs_counting_timespan",{delta:u},!0),this.logger.infoToTelemetry?.(`tabs count is ${o}; tab disabled: ${i}`,"crosstabs_tabs_count",{currentState:e?void 0:c,newState:o.toString(),disabled:i},!0),t=void 0,this.updateTabsLimitReachedState(i),n()};"failure"===c?(this.logger.errorToTelemetry?.("countTabs can't post message","crosstabs_tabs_counting_error"),u()):i=this.host.setTimeout((()=>{u()}),this.waitForTabsCountResponsesTimeoutMs)})).then((()=>{this.countTabsPromise=void 0}));return this.countTabsPromise={promise:n,cancel:()=>t?.()},this.countTabsPromise.promise}updateActiveTabsCount(e,t){e&&e!==this.activeTabsCountBehaviorSubject.getValue()&&t>this.timestampOfLastCountTabsResponse?(this.timestampOfLastCountTabsResponse=t,this.activeTabsCountBehaviorSubject.next(e)):this.logger.logNoPii?.(`Tabs count is not updated. timestampOfLastCountTabsResponse: ${this.timestampOfLastCountTabsResponse}, lastResponseTimestamp for update: ${t}`)}restartTabsCountingTimer(){this.clearTabsCountingTimer(),this.nextTabsRecountTimerId=this.host.setInterval((()=>{void 0===this.waitForTabsCountTimerId&&this.countTabs()}),this.tabsRecountIntervalMs)}clearTabsCountingTimer(){void 0!==this.nextTabsRecountTimerId&&(this.host.clearInterval(this.nextTabsRecountTimerId),this.nextTabsRecountTimerId=void 0)}startWaitForTabsCountTimer(){this.waitForTabsCountTimerId||(this.waitForTabsCountTimerId=this.host.setTimeout((()=>{this.waitForTabsCountTimerId=void 0,this.restartTabsCountingTimer(),this.countTabs()}),this.waitForTabsCountTimeoutMs))}clearWaitForTabsCountTimer(){void 0!==this.waitForTabsCountTimerId&&(this.host.clearTimeout(this.waitForTabsCountTimerId),this.waitForTabsCountTimerId=void 0)}initializeTabClosingHandlers(){this.host.addEventListener("beforeunload",this.tabClosingEventHandler),this.unsubscribeFromTabClosedMessage=this.baseCrossTabsService.subscribeToMessage("TabClosed",(()=>{this.clearWaitForTabsCountTimer(),this.logger.logNoPii?.("TabClosed received."),this.startWaitForTabsCountTimer()}))}unsubscribeFromHostLifecycleEvents(){this.host.removeEventListener("beforeunload",this.tabClosingEventHandler),this.unsubscribeFromTabClosedMessage?.()}updateTabsLimitReachedState(e){this.tabsLimitCalculated||(this.tabsLimitCalculated=!0,e&&(this.activeTabsLimitReached||(this.activeTabsLimitReached=e),this.clearTabsCountingTimer(),this.clearWaitForTabsCountTimer(),this.unsubscribeFromTabsCountingEvents(),this.unsubscribeFromHostLifecycleEvents()),this.activeTabsLimitReachedPromiseDeferred.resolve(this.activeTabsLimitReached))}isLimitReachedForThisTab(e){let t=!1;if(this.activeTabsLimit){e.push(this.tabInitializationTimestamp),e.sort(((e,t)=>e-t));e[this.activeTabsLimit-1]<this.tabInitializationTimestamp&&(t=!0)}return t}}class fC{constructor(e,t,n){this.logger=e.newLogger("CrosstabService","services-io-browser-crosstabs"),this.basicCrossTabsService=new hC(this.logger,t),this.tabsFinderHelper=new vC(this.basicCrossTabsService,this.logger,t),this.tabsCounterHelper=new SC(this.basicCrossTabsService,this.logger,t,n),this.loggingActiveTabsCountSubsciption=this.observeActiveTabsCount().subscribe((e=>{this.logger.logNoPii?.(`Active tabs count: ${e}`)})),this.logger.logNoPii?.("Initialized")}observeActiveTabsCount(){return this.tabsCounterHelper.observeActiveTabsCount()}getActiveTabsCount(){return this.tabsCounterHelper.getActiveTabsCount()}isActiveTabsLimitReached(){return this.tabsCounterHelper.isActiveTabsLimitReached()}postMessage(e,t){return this.basicCrossTabsService.postMessage(e,t)}subscribeToMessage(e,t){return this.basicCrossTabsService.subscribeToMessage(e,t)}areOtherTabsDetected(){return this.tabsFinderHelper.areOtherTabsDetected()}dispose(){this.basicCrossTabsService.dispose(),this.tabsCounterHelper.dispose(),this.loggingActiveTabsCountSubsciption.unsubscribe()}}var kC=n(820472);class CC extends xp{constructor(){super(d.c1.CreateCrossTabsService,["coreSettings","localStorage","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,localStorage:n,loggerFactory:i,windowProvider:a}=e,{enableCrossTabsCommunication:o}=t.get(c.w.Core,["enableCrossTabsCommunication"]);if(o){const o=function(e,t,n){try{return new fC(e,t,n)}catch(t){const n=e.newLogger("CrosstabService","services-io-browser-crosstabs"),i="Can't be initialized.";return void n.errorToTelemetry?.(i,"cross_tabs_init_failed",void 0,!0)}}(i,a,t);e.crossTabsService=o,o&&o.subscribeToMessage("T2WebOptOut",(()=>this.onT2WebOptOut(i,n,o)))}}onT2WebOptOut(e,t,n){const i=e.newLogger("T2WebOutOutMessageHandler","t2-web-opt-out-message-handler");i.logNoPii?.("T2WebOptOut message received, redirecting this tab to T1");new kC.Uc(t,e,n).redirectThisTabToT1("CrossTabMessage")}}var bC=n(579981),wC=n(885211),TC=n(664542);const IC=["activeCalls","activeMeetings","activeWindow","activeWindowForEntity","activeWindows","allClientPreferences","appReadyTriggerStatus","appInstallOptions","appsInstalledByCurrentUser","appsUsage","attendeeCaptionsVisibility","bannerNotificationQueue","byodState","cachedAppList","callTranscriptState","callingScreenLayout","callingScreenStatus","clientPreferences","currentCallingState","currentEspSurfaceId","espState","fetchDynamicCommandsV2","isEntityInActiveWindow","isUbarRenderComplete","localizationSettings","meetingRoomFrontOfRoomCallPanelsState","meetingRoomLayoutToggleState","pinnedMeetings","pptSharingSession","recentMeetings","servicesUnavailable","shouldLaunchWhiteboardOnLoad","whiteboardSharingSession","whiteboardWalkUpState","liveStreamIdMetadata","liveStreamCaptionsState","closedCaptionsSettings"],NC=["addSharedPlatformCachedApps","executeEntityCommand","changeMonitorSlotContent","changeSlotsVisibility","performWindowHistoryNavigation","navigateToWindowHistoryIndex","recordAppActionUsage","recordAppSceneUsage","recordAppUsage","removeSharedPlatformCachedApps","removeUserActiveWindows","removeWindow","resizeHeaderSlot","resizeSlotDimensions","pushToWindowHistory","removeFromWindowHistory","saveReactiveVarsToHistory","setActiveCalls","setByodState","setCallingScreenLayout","setCallingScreenStatus","setDisplayMirroring","setDisplayConfigType","setUbarRenderComplete","toggleHideMyselfVideo","togglePinMyself","toggleMyselfInGrid","toggleParticipantPin","updateActiveCalls","updateAttendeeCaptionsVisibility","updateClientPreferences","updateCurrentLocale","updateEntity","updateEntityState","updateExtendedEntityContainerState","updateMeetingRoomLayoutToggleState","updateSharedPlatformCachedApps","updateShouldLaunchWhiteboardOnLoad","updateWhiteboardWalkUpState","setMeetingRoomFrontOfRoomCallPanelsState","recordEspCompletedActions","recordDisplayedSurface","recordEligibleSurface","startLiveStream","setLiveStreamCaptionsData","toggleLiveStreamCaptions","setLiveStreamSubtitleTrack","updateClosedCaptionsSettings"],AC=["appsInstalledByCurrentUserEvent","appsUsageUpdateEvent","callParticipantPinnedEventv2","callTranscriptStateEvent","dynamicCommandsUpdateEvent","callTitleChangedEvent"],EC=["activeWindow","activeWindowForEntity","activeWindows","allClientPreferences","appReadyTriggerStatus","cachedAppList","clientPreferences","currentEspSurfaceId","espGlobalState","isEntityInActiveWindow","localizationSettings","poppedOutWindowState","closedCaptionsSettings","servicesUnavailable"],FC=[...EC,"activeCalls","activeMeetings","appInstallOptions","appsInstalledByCurrentUser","appsUsage","bannerNotificationQueue","byodState","callingScreenLayout","callingScreenStatus","currentCallingState","fetchDynamicCommandsV2","meetingRoomLayoutToggleState","meetingTemplateDescriptions","pinnedMeetings","pptSharingSession","recentMeetings","whiteboardSharingSession","espState","userPreferencesForSimpleCollab","liveMeetingStatusBar"],_C=["addSharedPlatformCachedApps","executeEntityCommand","changeMonitorSlotContent","changeSlotsVisibility","removeWindow","setPoppedOutWindowState","resizeHeaderSlot","performWindowHistoryNavigation","navigateToWindowHistoryIndex","removeSharedPlatformCachedApps","removeUserActiveWindows","resizeSlotDimensions","pushToWindowHistory","removeFromWindowHistory","saveReactiveVarsToHistory","updateClientPreferences","updateCurrentLocale","updateEntity","updateEntityState","updateExtendedEntityContainerState","updateSharedPlatformCachedApps","setEspGlobalState","createNotificationsWindow","removeNotificationsWindow","updateClosedCaptionsSettings"],DC=[..._C,"setActiveCalls","setByodState","setCallingScreenLayout","setCallingScreenStatus","setDisplayMirroring","setDisplayConfigType","toggleParticipantPin","toggleHideMyselfVideo","toggleMyselfInGrid","togglePinMyself","updateActiveCalls","updateMeetingRoomLayoutToggleState","recordEspCompletedActions","recordDisplayedSurface","recordEligibleSurface","recordAppActionUsage","recordAppSceneUsage","recordAppUsage","updateUserPreferencesForSimpleCollab","updateClosedCaptionsSettings","addMeetingToLiveMeetingStatusBar","removeMeetingFromLiveMeetingStatusBar","removeAllMeetingsFromLiveMeetingStatusBar"],PC=[],MC=[...PC,"appsInstalledByCurrentUserEvent","appsUsageUpdateEvent","callParticipantPinnedEventv2","callHideMyselfVideoEvent","dynamicCommandsUpdateEvent","callMyselfVideoPinnedEvent","userPreferencesChangedEventForSimpleCollab","callTitleChangedEvent"],RC=["chat","messages","installedAppsV2"],xC=[...IC,"lpcState","pinnedChannels","joinedTeamsAndChannels","oneGql_me"],LC=(e,t,n)=>{const i=(0,wC.Vn)(e),{operation:a,selectionSet:{selections:o},variableDefinitions:r}=i,s=jC[a],l=r?.some((e=>!!e.defaultValue))?function(e,t={}){const n={};for(const i of e){const e=i.variable.name.value;t.hasOwnProperty(e)?n[e]=t[e]:i.defaultValue&&(n[e]=(0,TC.F)(i.defaultValue))}return n}(r,t):t;return o.filter((e=>"Field"===e.kind&&!xC.includes(e.name.value))).map((e=>({id:s,fieldName:e.name.value,args:OC(e,l),schemaId:n})))};function OC(e,t){if(!e?.arguments?.length)return;const n={};for(const i of e.arguments){const e=(0,TC.F)(i.value,t);void 0!==e&&(n[i.name.value]=e)}return n}const jC={query:"ROOT_QUERY",mutation:"ROOT_MUTATION",subscription:"ROOT_SUBSCRIPTION"};var BC;!function(e){e[e.DefaultSchema=0]="DefaultSchema",e[e.ViewSchema=1]="ViewSchema"}(BC||(BC={}));var UC=n(176677),$C=n(307584),WC=n.n($C);var VC=n(66925);class HC{constructor(e){this._inactiveOperations=new Map,this._forcedActiveOperations=new Map,this._windowToDataMap=new Map,this._dataToWindowMap=new Map,this._activeOperations=e?.activeOperationLimit?new VC.A({maxSize:e.activeOperationLimit,onEviction:this.markLeastRecentlyUsedOperation.bind(this)}):new Map}trackOperation(e,t,n=BC.DefaultSchema,i){const{fetchPolicy:a,variables:o}=e,r=e.query||e.mutation;if("no-cache"===a)return;if(e.mutation&&!e.keepRootFields)return;LC(r,o,n).forEach((e=>{const n=(e=>{const t=WC()(e);return(0,UC.A)(t)})(e);this._activeOperations.set(n,e),"boolean"==typeof i&&this.forceActive(n,i),this.addDataForWindow(t,n),this._inactiveOperations.has(n)&&this._inactiveOperations.delete(n)}))}markDataForWindowAsInactive(e){const t=this._windowToDataMap.get(e)||[];this._windowToDataMap.delete(e),t.forEach((t=>{const n=this._dataToWindowMap.get(t);if(n&&(n.delete(e),n.size))return;const i=this._activeOperations.get(t);i&&this._inactiveOperations.set(t,i),this._dataToWindowMap.delete(t),this._activeOperations.delete(t)}))}flush(e=this._inactiveOperations.size){const t=[],n=[];let i=0;return this._inactiveOperations.forEach(((a,o)=>{i>=e||(t.push(a),n.push(o),RC.includes(a.fieldName)&&(i=e),i++)})),n.forEach((e=>this._inactiveOperations.delete(e))),{descriptors:t,hasMore:!!this._inactiveOperations.size}}DEBUG_ONLY_getInactiveOperations(){return this._inactiveOperations}addDataForWindow(e,t){let n=this._windowToDataMap.get(e);n||(n=new Set,this._windowToDataMap.set(e,n)),n.add(t);let i=this._dataToWindowMap.get(t);i||(i=new Set,this._dataToWindowMap.set(t,i)),i.add(e)}forceActive(e,t){const n=(this._forcedActiveOperations.get(e)??0)+(t?1:-1);0!==n?this._forcedActiveOperations.set(e,n):this._forcedActiveOperations.delete(e)}markLeastRecentlyUsedOperation(e,t){(this._forcedActiveOperations.get(e)??0)>0?this._activeOperations.set(e,t):this._inactiveOperations.set(e,t)}}class zC{constructor(e,t,n,i){this.dataOpsRepository=e,this.scenarioFactory=t,this.windowProvider=i,this.clients=new Set,this.logger=n.newLogger("EvictionService","data-client-core")}register(e){this.clients.add(e)}unregister(e){this.clients.delete(e)}async evict(){this.lastEvictionResult={entriesEvicted:0,entriesNotEvicted:0,entriesGCed:0};let e=!0;do{e=await this.evictByWindowRequestIdleCallback()}while(e)}DEBUG_ONLY_getInactiveOperations(){return this.dataOpsRepository.DEBUG_ONLY_getInactiveOperations()}DEBUG_ONLY_getClients(){return this.clients}DEBUG_ONLY_lastResult(){return this.lastEvictionResult}evictByWindowRequestIdleCallback(){return new Promise((e=>{this.windowProvider.requestIdleCallback((t=>{let n=!1,i=0;do{const e=performance.now(),a=t.timeRemaining();this.logger.debug("Time remaining at start",a);const o=this.scenarioFactory.newScenario(be.Cu.CacheEviction);n=this.evictInternal(o);const r=t.timeRemaining(),s=performance.now();i=r>0?r:a-(s-e);const l={"Eviction.TimeRemaining":i};o.stop(l),this.logger.debug("Time remaining at end",i)}while(n&&i>10);e(n)}))}))}evictInternal(e){const{descriptors:t,hasMore:n}=this.dataOpsRepository.flush(10);let i=0,a=0;const o=this.groupCachesBySchema(),r=new Set;t.forEach((e=>{const t=o.get(e.schemaId)??[];let n=!1;t.forEach((t=>{t.evict(e)&&(r.add(t),n=!0)})),n?i++:a++}));const s={"Eviction.EntriesEvicted":i,"Eviction.EntriesNotEvicted":a};e.mark("eviction",s);let l=0;r.forEach((e=>{const t=e.gc();l+=t.length}));const c={"Eviction.EntriesCollected":l};return e.mark("gc",c),this.logger.debug("Eviction results",{entriesEvicted:i,entriesNotEvicted:a,entriesGCed:l}),this.lastEvictionResult&&(this.lastEvictionResult.entriesEvicted+=i,this.lastEvictionResult.entriesNotEvicted+=a,this.lastEvictionResult.entriesGCed+=l),n}groupCachesBySchema(){const e=new Map;return this.clients.forEach((t=>{let n=e.get(t.schemaId);n||(n=new Set,e.set(t.schemaId,n)),n.add(t.cache)})),e}}var qC=n(114618),GC=n(232755),YC=n(970548);const QC={possibleTypes:{ActionStatusEvent:["SendMessageActionData","ReactionsActionData","ErrorActionData"],ActivityContextualSettingsResponseType:["ActivityContextualSettingsUpdatedResponse","ActivityContextualSettingsNotUpdatedResponse"],ActivityFeedItemDeletionResult:["ActivityFeedItemDeletionErrorResult","DeletedActivityInfo"],ActivityMAARResponse:["MarkAllActivitiesAsReadSuccess","MarkAllActivitiesAsReadError"],ActivityMAARStatus:["MarkAllActivitiesAsReadError","MarkAllActivitiesAsReadSuccess"],ActivityReadStatusUpdate:["FeedActivity","ActivityReadStatusUpdateError"],AdaptiveCardTabTaskResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone","AdaptiveCardTabContinue"],AddCallingIdToInitiateMeetingJoinResult:["AddCallingIdToInitiateMeetingJoinPayload","LiveMeetingError"],AddMeetingToLiveMeetingStatusBarResult:["AddMeetingToLiveMeetingStatusBarPayload","LiveMeetingError"],AllSearchResults:["SearchMessageResult","SearchFileResult","PeopleSearchResult","SearchEmailResult","SearchTeamsChannelsResult","SearchGroupResult","SearchTopicResult"],AppInstallOptionMeeting:["AppInstallOptionChannelMeeting","AppInstallOptionChatMeeting"],BaseChannel:["Channel","DeletedChannel","NonMemberChannel"],BaseTabInterface:["BasicTab","CalendarTab","DocumentLibraryTab","ExtensionTab","FileViewTab","LegacyDocumentLibraryTab","LegacyWikiTab","OneNoteTab","PlaceholderTab","PowerBiTab","StaticExtensionTab","WebsiteTab","WikiTab"],BaseTeam:["NonMemberSharedTeam","Team"],BotConfigTaskResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone","BotConfigResult"],CalendarAppSettingsResult:["CalendarSettings","CalendarErrorResponse"],CalendarArtifact:["AttachmentGroupType","RelatedEmailType"],CalendarCreateUpdateEventResult:["CalendarEvent","CalendarErrorResponse"],CalendarInsight:["Quorum","OutOfRoutine","Conflicts"],CalendarMultiSlotEventPayload:["CalendarFormCacheSyncEvent","CalendarFormSpinnerEvent","CalendarFormShareDialogEvent","CalendarFormErrorEvent","CalendarToggleTabEvent"],CalendarSyncPayloads:["CalendarSyncPayload","ConnectedCalendarSyncPayload","MultiCalendarSyncPayload","CalendarLeftRailSettingsSyncPayload"],CalendarUpdateEventResult:["CalendarEvent","CalendarErrorResponse"],CallAudienceBotDataChannel:["CallAudienceSceneChanged","CallAudienceSelectSceneAck"],CallContentSharingEvent:["CallContentSharingJoinIncomplete"],CallCoordinates:["LegacyMeetingCoordinates","MeetingDataCoordinates","ExistingCallCoordinates","OneToOneCoordinates","GroupCallCoordinates","AgentMonitorSessionCoordinates"],CallCreatedRemovedUpdatedEvent:["CallAdded","CallRemoved","CallUpdated","CallMuteUpdated"],CallJoinOptions:["JoinOptions","MeetingJoinOptions","OneToOneJoinOptions","GroupCallJoinOptions"],CallRedirectionSettingsResult:["CallRedirectionSettings","CallRedirectionSettingsError"],CallTransfer:["CallTransferred","CallTransferredFailed","CallTransferredSucceeded"],CallingAppEventType:["CallingContentEvent","CallingAppSetupEvent"],CallingContent:["AutoBrbDialogContent","CallingBannerContent","CallingBreakoutRoomPanelContent","CallingDialogContent","CallingLocalRecordingNotificationContent","CallingNotificationContent","CallingToChatContent","CallingToChatListContent","CallingToCallListContent","CallingToSettingsPaneContent","CallingWindowingContent","CrossCloudMeetingJoinContent","MainAppContent"],CallingServiceEvent:["CallAdded","CallRemoved","CallUpdated","CallMuteUpdated","CallAlertsUpdated","CallDeviceListUpdated","ParticipantsOnCallConnected"],ChannelEmailSettings:["ChannelEmailSettingsSuccess","ChannelEmailSettingsError"],ChannelMessage:["ReplyChainMessage","MeetingReplyMessage","StandardPostMessage","AnnouncementPostMessage","EmailPostMessage","MeetingPostMessage","ConnectorPostMessage","GuardiansPostMessage"],ChannelPostMessage:["StandardPostMessage","AnnouncementPostMessage","EmailPostMessage","MeetingPostMessage","ConnectorPostMessage","GuardiansPostMessage"],ChannelReplyMessage:["ReplyChainMessage","MeetingReplyMessage"],ChannelSystemMessage:["AddDeleteMemberSystemMessage","BaseChannelSystemMessage","ChannelAddDeleteSystemMessage","ChannelUpdatesSystemMessage","ManageMembersSystemMessage","PinnedItemSystemMessage","RoleUpdateSystemMessage","SharedInSpacesSystemMessage","UpdateFavDefaultSystemMessage"],ChannelSystemMessageType:["BaseChannelSystemMessage","AddDeleteMemberSystemMessage","ChannelUpdatesSystemMessage","PinnedItemSystemMessage","ManageMembersSystemMessage","ChannelAddDeleteSystemMessage","SharedInSpacesSystemMessage","RoleUpdateSystemMessage","UpdateFavDefaultSystemMessage"],ChannelUnion:["Channel","DeletedChannel","NonMemberChannel"],ChatPinnedMessageEvent:["ChatPinnedMessageAddedEvent","ChatPinnedMessageRemovedEvent"],ChatServiceEvent:["NewMessage","MessageUpdate","ThreadUpdate","ConversationUpdate","ConversationFullUpdate","ConsumptionHorizonUpdate","ResolveConversationLie","NotificationUpdate","CommentStreamEvent"],ClassicalAttachmentContentResult:["ClassicalAttachmentContentBytesPayload","CalendarErrorResponse"],ClientPreferenceCategoryTypes:["AnimationPreferences","DensityPreferences","FlyoutCameraPreferences","InfoPanePreferences","SidePanePreferences","PerformancePreferences","OptimizedPerfPreferences","AppSwitcherPreferences","ThemePreferences","VideoEffectPreferences","BackgroundEffectPreferences","AvatarPreferences","PromoBadgePreferences","TeamLayoutPreferences","DiagnosticsLogsPreferences","SimpleCollabStickyFilterPreferences","WindowingPreferences","StatusBarItemPreferences","LockScreenInCallPreferences","MessagePreviewsPreferences","ComposeSpellcheckPreferences","PeopleAppColumnsPreferences","PeopleAppNavigationPreferences","SimpleCollabPreferences","StaticNowCardsPreferences","OutOfTabNotificationPreferences","SuperResolutionPreferences","EditorSdkPreferences"],CommunitiesEditResponse:["Communities","CommunitiesEditErrorResponse"],CommunitiesPinnedPostsResponse:["CommunitiesPinnedPostsConnection","CommunitiesPinnedPostsError"],CommunitiesResponse:["Communities","CommunitiesGenericError"],CommunitiesUpdateEvent:["CommunitiesUpdate"],CommunityCreateChannelResponse:["CommunityChannel","CommunityCreateChannelPartialSuccessResponse","CommunityCreateChannelErrorResponse"],CommunityEditNicknameResponse:["CommunityMember","CommunitiesEditNicknameErrorResponse"],CommunityInviteUsersResponse:["Communities","CommunityInviteUsersError"],CommunityThreadPropertiesResponse:["CommunityThreadPropertiesSuccess","CommunityThreadPropertiesError"],Connection:["CallQueuePersonConnection"],ConnectionEdge:["CallQueuePerson","HistoricReportingEdge","HistoricReportingResourceEdge","OneGQL_PersonContactEdge","OneGQL_PersonaOrganizationEdge","QueueRealTimeAgentEdge","QueueRealTimeAutoAttendantEdge","QueueRealTimeCallQueueEdge"],ConnectionEdgeWithCursorPagination:["HistoricReportingEdge","HistoricReportingResourceEdge","OneGQL_PersonContactEdge","OneGQL_PersonaOrganizationEdge","QueueRealTimeAgentEdge","QueueRealTimeAutoAttendantEdge","QueueRealTimeCallQueueEdge"],ConnectionWithCursorPagination:["HistoricReportingConnection","HistoricReportingResourceConnection","OneGQL_PersonContactConnection","OneGQL_PersonaOrganizationConnection","QueueRealTimeAgentConnection","QueueRealTimeAutoAttendantConnection","QueueRealTimeCallQueueConnection","SpeedDialContactsConnection"],ContentSharingSession:["PptSharingSession","WhiteboardSharingSession"],ConversationPinnedResult:["ConversationPinnedUpdate","SetChatPinnedMaxLimitReachedError"],CopilotCommandType:["BlurVideoCommand","CreateMeetingCommand","CreateWhiteboardCommand","FindFilesCommand","NudgeUserCommand","OpenNotesCommand","RenameChatCommand","SlashCommand"],CortanaEvent:["CortanaInvocationStateChanged","CortanaStateChanged"],CreateChannelResponseV2:["Channel","CreateK2ChannelResponse","CreateChannelConversationError"],CreateCommunityResponse:["Community","CreateCommunityPartialSuccessResponse","CreateCommunityErrorResponse"],CustomEmojiCreationResponse:["CustomEmoji","CustomEmojiMetadataCreationError"],Dimension:["DimensionInFloat","DimensionInString"],DiscoverSurfaceContainerEntity:["DiscoverSurfaceContainerEntityChannel"],DiscoverSurfaceUserPreferenceForEntity:["DiscoverSurfaceUserPreferenceForEntityActorKind","DiscoverSurfaceUserPreferenceForEntityContainerKind"],DismissedLiveMeetingsResult:["LiveMeetingStatusBarPayload","LiveMeetingError"],Emoji:["TeamsEmoji","CustomEmoji"],EmojiSearchResult:["EmojiCategoryConnection","EmojiConnection"],EspAction:["EspNoParamsAction","EspEntityCommandAction","EspDeeplinkNavigationAction","EspFollowUpSurfaceAction","EspFollowUpModalAction","EspUrlNavigationAction","EspFocusElementAction","EspTriggerShortcutAction","EspEntityCommandWithFollowUpModalAction"],EspResource:["EspNotLocalizedResource","EspLocalizedResource"],EspSurfaceParams:["EspModalParams","EspCoachmarkParams","EspNotificationParams","EspTfwNotificationParams","EspQuickGuideParams","EspIrisParams","EspEntityCommandParams"],EspUserInterfaceControl:["EspTextControl","EspImageControl","EspVideoControl","EspButtonControl","EspSpaceControl","EspInfoItemControl","EspThemePickerControl","EspAccountPickerControl"],EventTrigger:["AppAcquisitionLink","AppSecondaryAction"],EventUser:["VirtualEventSpeaker","VirtualEventUser"],ExplicitRecordingConsentUpdateResult:["ExplicitRecordingConsentState","ExplicitRecordingConsentTransactionEnd"],FeaturedCommunityResponse:["FeaturedCommunitySuccess","FeaturedCommunityError"],FeedLocationLocaleParams:["DefaultFeedLocaleParams","ChannelFeedLocationLocaleParams","CommunitiesFeedLocationLocaleParams"],FeedTitleLocaleParams:["DefaultFeedLocaleParams","ChannelFeedTitleLocaleParams","CommunitiesFeedTitleLocaleParams"],FollowPresenceResult:["FollowPresenceSuccess","FollowPresenceFailure"],GetCommunitiesFeaturedStateResponse:["CommunitiesFeaturedStateSuccess","FeaturedCommunityError"],GetUnifiedStorageQuotaResponse:["UnifiedStorageQuotaSuccess","UnifiedStorageQuotaError"],GroupCalendarEventsResult:["FilteredEvents","CalendarErrorResponse"],GuardiansChatIdResult:["GuardiansChatIdSuccess","GuardiansChatIdNotFoundError"],HistoricReportingNavigationResult:["HistoricReportingNavigation","QueueRealTimeError"],HistoricReportingNodeResult:["HistoricReportingNode","QueueRealTimeError"],HolographicAnnotationEvent:["HolographicAnnotationCreatedEvent","HolographicAnnotationModifiedEvent","HolographicAnnotationRemovedEvent","HolographicInteractionEnabledEvent","HolographicInteractionInitializedEvent","HolographicInteractionComponentChangedEvent","HolographicSnapshotEnabledEvent","HolographicResetEvent","HolographicFreezeFrameEvent"],IChannelConversation:["Conversation"],IChannelMessageProperties:["Message"],IConnection:["ActiveDirectoryGroupConnection","ActiveDirectoryGroupMemberConnection","ActivitiesConnection","ActivitySliceListConnection","AppDetailsDiscoverMoreAppsCategoryConnection","AppDetailsDiscoverMoreAppsDeveloperConnection","AppReviewCommentsConnection","AppReviewsConnection","CallHistoryConnection","CommentStreamMessageConnection","CommunitiesPinnedPostsConnection","ContactsSuggestionsConnection","ExtensibilityAppPickerConnection","MeetingInstanceListConnection","PinnedPostsConnection","RecentFilesConnection","ReplyChainMessageConnection","ReplyChainSummaryConnection","SearchTeamConnection","SearchUsersAndGroupsResultsConnection"],IEdge:["ActiveDirectoryGroupEdge","ActiveDirectoryGroupMemberEdge","ActivityEdge","ActivitySliceEdge","AppReviewCommentEdge","AppReviewEdge","CallHistoryItemEdge","CommentStreamMessageEdge","CommunitiesPinnedPostEdge","ContactsSuggestionsEdge","ExtensibilityAppPickerAppEdge","InstalledAppEdge","MeetingInstanceListEdge","PinnedPostSummaryEdge","RecentSharedFilesEdge","ReplyChainMessagesEdge","ReplyChainSummaryEdge","SearchTeamsEdge","SearchUsersAndGroupsResults"],IEdgeNode:["ActiveDirectoryGroup","ActiveDirectoryGroupMember","ActivitySliceItem","AppReview","AppReviewComment","CallLogItem","CommentStreamMessage","CommunitiesPinnedPost","ContactsSuggestionsItem","Conversation","DiscoverTeamDetails","FeedActivity","GroupChatSuggestionsItem","InstalledApp","MeetingInstance","PinnedPostSummary","RecentSharedFilesType","ReplyChainMessageNode","ReplyChainSummary","UsersAndGroupsSearchResult"],IMessage:["AnnouncementPostMessage","ConnectorPostMessage","EmailPostMessage","GuardiansPostMessage","LastMessage","MeetingPostMessage","MeetingReplyMessage","Message","ReplyChainMessage","StandardPostMessage"],IPostMessage:["AnnouncementPostMessage","ConnectorPostMessage","EmailPostMessage","GuardiansPostMessage","MeetingPostMessage","StandardPostMessage"],ImageBlobURI:["Image","ThumbnailImage"],InviteRedeemResponse:["InviteRedeemResponseSuccess","InviteRedeemError"],InviteUsersToCommunityResponse:["CommunityResponse","InviteUsersToCommunityError"],InvokeAdaptiveCardTabResult:["AdaptiveCardTabContinue","AdaptiveCardTabDone","AdaptiveCardTabAuth"],InvokeTaskModuleResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone"],IsUserPresentInCommunityResponse:["IsUserPresentInCommunitySuccess","IsUserPresentInCommunityError"],LastConversationUpdate:["LastMessage","Presence"],LiveMeetingStatusBarEvent:["LiveMeeting","UserCallJoinEvent","JoinLiveMeetingContext"],LiveMeetingStatusBarResult:["LiveMeetingStatusBarPayload","LiveMeetingError"],M365AppLink:["M365PlatformAppLink"],M365Application:["M365HubApplication","M365PlatformApplication"],M365ApplicationBadge:["M365ApplicationNumericBadge","M365ApplicationDotBadge","M365ApplicationStringBadge"],M365ApplicationIcon:["InternalIcon","RemoteImage"],MeetingArtifactV2Interface:["MeetingArtifactV2Default","MeetingArtifactV2MeetingContent","MeetingArtifactV2Notes","MeetingArtifactV2Recording","MeetingArtifactV2Transcript","MeetingArtifactV2TranscriptV2"],MeetingArtifactV2Union:["MeetingArtifactV2Transcript","MeetingArtifactV2TranscriptV2","MeetingArtifactV2Recording","MeetingArtifactV2Notes","MeetingArtifactV2MeetingContent","MeetingArtifactV2Default"],MeetingCoordinates:["LegacyMeetingCoordinates","MeetingDataCoordinates"],MeetingRoomAppEventContent:["MeetingRoomMainWindowNavigationEventContent","MeetingRoomFrontOfRoomWindowEventContent","MeetingRoomAppSetupEventContent"],MeetingRoomMainWindowNavigationParams:["RigelConsoleBroadcastParams","RigelConsolePreCallParams","RigelConsolePostCallParams","RigelConsoleJoinbyCodeParams","RigelConsoleParams","MeetingRoomMainWindowNavigationNoParams"],MemberRoleUpdateResult:["Communities","MemberRoleUpdateError"],Mentionable:["TagCard","User","ChannelMentionSearchResult","AppDefinition","CommandDefinition"],Mentionable3:["TagCard","User","ChannelMentionSearchResult3","AppDefinition","CommandDefinition"],MessageExtensionTaskResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone","MessageExtensionResult"],MessageSlice_MessageSliceConnection:["MessageSlice_SampleMessageSliceConnection"],MessageSlice_MessageSliceEdge:["MessageSlice_SampleMessageSliceEdge"],MessageSlice_MessageSliceItem:["MessageSlice_SampleMessageSliceItem"],MessageSlice_MessageSliceItemLocationLine:["MessageSlice_SampleMessageSliceItemLocationLine"],MessageSlice_MessageSliceItemSupportedAction:["MessageSlice_SampleMessageSliceItemSupportedAction"],MutationFailure:["FollowPresenceFailure","OneGQL_AddPersonToFavoritesError","OneGQL_AddPersonToSpeedDialMutationError","OneGQL_AddTagForPersonFailure","OneGQL_BlockPersonError","OneGQL_ContactMutationErrorGeneric","OneGQL_ContactMutationErrorNetworkOffline","OneGQL_PresenceMutationFailure","OneGQL_PresenceMutationFailureNetworkOffline","OneGQL_RemovePersonFromFavoritesError","OneGQL_RemovePersonFromSpeedDialMutationError","OneGQL_RemoveTagFromPersonFailure","OneGQL_UnblockPersonError","QueueRealTimeError","SpeedDialContactsError"],Node:["HistoricReportingNavigation","HistoricReportingNode","HistoricReportingResourceNode","OneGQL_ActivityConversation","OneGQL_BizChatMetaOSConversation","OneGQL_BotChatConversation","OneGQL_BotPersona","OneGQL_Call","OneGQL_ChannelConversation","OneGQL_ChatLastMessage","OneGQL_ConversationMessage","OneGQL_DeletedChannel","OneGQL_DiscoverConversation","OneGQL_GroupChatConversation","OneGQL_Me","OneGQL_MePresence","OneGQL_MeetingChatConversation","OneGQL_NewChatConversation","OneGQL_NonMemberChannel","OneGQL_NonMemberTeam","OneGQL_OneOnOneChatConversation","OneGQL_Person","OneGQL_PersonPresence","OneGQL_SavedConversation","OneGQL_SelfChatConversation","OneGQL_SuggestedContactConversation","OneGQL_SuggestedGroupChatConversation","OneGQL_SystemDefinedConversationFolder","OneGQL_Team","OneGQL_Tenant","OneGQL_UnifiedGroup","OneGQL_UserDefinedConversationFolder","QueueRealTime","QueueRealTimeAgent","QueueRealTimeAllAgentsSummary","QueueRealTimeAutoAttendant","QueueRealTimeCallQueue","ReplyChain"],NotificationsEngineData:["NotificationXDaysOfInactiveStatus","NotificationTflMeetingLinks","NotificationConversationsReminder"],ODSPFileInfoResponse:["ODSPFileInfoFailed","ODSPFileInfoSuccess"],OneGQL_AdaptiveRailConnection:["ReplyChainsConnection"],OneGQL_AdaptiveRailEdge:["ReplyChainsConnectionEdge"],OneGQL_AdaptiveRailListItem:["ReplyChain"],OneGQL_AddPersonToFavoritesMutationResult:["OneGQL_AddPersonToFavoritesSuccess","OneGQL_AddPersonToFavoritesError"],OneGQL_AddPersonToSpeedDialMutationResult:["OneGQL_AddPersonToSpeedDialMutationSuccess","OneGQL_AddPersonToSpeedDialMutationError"],OneGQL_AddTagForPersonMutationResult:["OneGQL_AddTagForPersonSuccess","OneGQL_AddTagForPersonFailure"],OneGQL_BaseChannel:["OneGQL_ChannelConversation","OneGQL_DeletedChannel","OneGQL_NonMemberChannel"],OneGQL_BaseChatConversation:["OneGQL_BizChatMetaOSConversation","OneGQL_BotChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_NewChatConversation","OneGQL_OneOnOneChatConversation","OneGQL_SelfChatConversation"],OneGQL_BaseConversation:["OneGQL_ActivityConversation","OneGQL_BizChatMetaOSConversation","OneGQL_BotChatConversation","OneGQL_ChannelConversation","OneGQL_DiscoverConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_NewChatConversation","OneGQL_OneOnOneChatConversation","OneGQL_SavedConversation","OneGQL_SelfChatConversation","OneGQL_Team"],OneGQL_BaseConversationActivityStatus:["OneGQL_ActivityConversationActivityStatus","OneGQL_ChannelConversationActivityStatus","OneGQL_ChatConversationActivityStatus","OneGQL_DiscoverConversationActivityStatus","OneGQL_TeamActivityStatus"],OneGQL_BaseConversationEdge:["OneGQL_ChannelConnectionEdge","OneGQL_ConversationsEdge"],OneGQL_BaseConversationFolder:["OneGQL_SystemDefinedConversationFolder","OneGQL_UserDefinedConversationFolder"],OneGQL_BaseTeam:["OneGQL_NonMemberTeam","OneGQL_Team"],OneGQL_BlockPersonMutationResult:["OneGQL_BlockPersonSuccess","OneGQL_BlockPersonError"],OneGQL_Channel:["OneGQL_ChannelConversation","OneGQL_DeletedChannel","OneGQL_NonMemberChannel"],OneGQL_ChatConversation:["OneGQL_OneOnOneChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_SelfChatConversation","OneGQL_BotChatConversation","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation"],OneGQL_ContactMutationResult:["OneGQL_ContactMutationErrorGeneric","OneGQL_ContactMutationErrorNetworkOffline","OneGQL_ContactMutationSuccess"],OneGQL_Conversation:["OneGQL_OneOnOneChatConversation","OneGQL_GroupChatConversation","OneGQL_ChannelConversation","OneGQL_Team","OneGQL_MeetingChatConversation","OneGQL_SelfChatConversation","OneGQL_BotChatConversation","OneGQL_NoOpEvent","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation","OneGQL_SuggestedGroupChatConversation","OneGQL_SuggestedContactConversation","OneGQL_DiscoverConversation","OneGQL_UnreadOnlySentinelValue","OneGQL_ActivityConversation","OneGQL_SavedConversation"],OneGQL_ConversationFolder:["OneGQL_SystemDefinedConversationFolder","OneGQL_UserDefinedConversationFolder"],OneGQL_ConversationFoldersResult:["OneGQL_ConversationFoldersConnection","OneGQL_ConversationFoldersError"],OneGQL_ConversationUpdate:["OneGQL_MePresence","OneGQL_PersonPresence","OneGQL_ConversationFolderActivityStatusUpdate","OneGQL_ConversationFolderUpdateEvent","OneGQL_ConversationFoldersOrderUpdate","OneGQL_ChannelActivityEvent","OneGQL_TeamAddEvent","OneGQL_TeamReorderEvent","OneGQL_TeamRemoveEvent","OneGQL_NoOpEvent","OneGQL_ConversationAddEvent","OneGQL_ConversationRemoveEvent","OneGQL_ChatReorderEvent","OneGQL_ChannelAddEvent","OneGQL_ChannelRemoveEvent","OneGQL_ConversationUpdateEvent","OneGQL_ConversationAddToRecentEvent","OneGQL_ConversationRemoveFromRecentEvent","OneGQL_ConversationSortAndFilterEvent","OneGQL_ChannelUpdateEvent","OneGQL_ConversationFolderAddEvent","OneGQL_ConversationFolderRemoveEvent","OneGQL_ShowHiddenChannelEvent","OneGQL_ChannelHideEvent","OneGQL_TeamHideEvent","OneGQL_ShowHiddenTeamEvent","OneGQL_ShowOnlyChannelsWithUnreadPersonalMentionEvent","OneGQL_NewChannelCreateEvent","OneGQL_RecentChannelsAddEvent","OneGQL_RecentChannelsRemoveEvent","OneGQL_RecentChannelsReorderEvent","OneGQL_ConversationFolderSortEvent","OneGQL_ConversationFolderConversationsUpdateEvent","OneGQL_FolderViewTypeUpdateEvent","OneGQL_SimpleCollabSettingsUpdateEvent","OneGQL_AppsFolderUpdateEvent","OneGQL_MetaOSBizChatShowEvent","OneGQL_MetaOSBizChatHideEvent","OneGQL_SelectedConversationEvent","OneGQL_DiscoverConversationUpdateEvent","OneGQL_ActivityConversationUpdateEvent","OneGQL_TypingParticipantsUpdateEvent","OneGQL_HoistHiddenChatConversation"],OneGQL_CreateConversationFolderResult:["OneGQL_ConversationFoldersEdge","OneGQL_CreateConversationFolderError"],OneGQL_DndItemToConversationFolderResult:["OneGQL_DndItemToConversationFolderSuccess","OneGQL_DndItemToConversationFolderError"],OneGQL_EntityWithPersonaPhoto:["MessageSlice_SampleMessageSliceItem","OneGQL_ActivityConversation","OneGQL_BizChatMetaOSConversation","OneGQL_BotChatConversation","OneGQL_BotPersona","OneGQL_ChannelConversation","OneGQL_DiscoverConversation","OneGQL_GroupChatConversation","OneGQL_Me","OneGQL_MeetingChatConversation","OneGQL_NewChatConversation","OneGQL_NonMemberTeam","OneGQL_OneOnOneChatConversation","OneGQL_Person","OneGQL_SavedConversation","OneGQL_SelfChatConversation","OneGQL_SuggestedContactConversation","OneGQL_SuggestedGroupChatConversation","OneGQL_Team","OneGQL_UnifiedGroup","ReplyChain"],OneGQL_HideAllChannelsResult:["OneGQL_HideAllChannelsSuccess","OneGQL_HideAllChannelsError"],OneGQL_Individual:["OneGQL_Me","OneGQL_Person"],OneGQL_MarkAllAsReadByAppResult:["OneGQL_ConversationFoldersConnection","OneGQL_MarkAllAsReadByAppError"],OneGQL_MoveItemToConversationFolderResult:["OneGQL_MoveItemToConversationFolderSuccess","OneGQL_MoveItemToConversationFolderError"],OneGQL_MultiPartyConversation:["OneGQL_ChannelConversation","OneGQL_Team"],OneGQL_NodeWithContacts:["OneGQL_Me"],OneGQL_PersonAnniversaryBase:["OneGQL_PersonAnniversary","OneGQL_PersonAnniversaryRaw"],OneGQL_PersonAnnotationBase:["OneGQL_PersonAnnotation","OneGQL_PersonAnnotationRaw"],OneGQL_PersonNameBase:["OneGQL_PersonName","OneGQL_PersonNameRaw"],OneGQL_PersonRelatedEntityBase:["OneGQL_PersonRelatedEntity","OneGQL_PersonRelatedEntityRaw"],OneGQL_PersonWorkPositionBase:["OneGQL_PersonWorkPosition","OneGQL_PersonWorkPositionRaw"],OneGQL_Persona:["CallQueueResourceAccount","OneGQL_BotPersona","OneGQL_Me","OneGQL_Person","OneGQL_UnifiedGroup"],OneGQL_PersonaAddressBase:["OneGQL_PersonaAddress","OneGQL_PersonaAddressRaw"],OneGQL_PersonaComplexTypeBaseDeduplicated:["OneGQL_PersonAnniversary","OneGQL_PersonAnnotation","OneGQL_PersonName","OneGQL_PersonRelatedEntity","OneGQL_PersonWorkPosition","OneGQL_PersonaAddress","OneGQL_PersonaEmailAddress","OneGQL_PersonaImAddress","OneGQL_PersonaPhone","OneGQL_PersonaWebsite"],OneGQL_PersonaComplexTypeBaseRaw:["OneGQL_PersonAnniversaryRaw","OneGQL_PersonAnnotationRaw","OneGQL_PersonCustomAttribute","OneGQL_PersonNameRaw","OneGQL_PersonRelatedEntityRaw","OneGQL_PersonTag","OneGQL_PersonWorkPositionRaw","OneGQL_PersonaAddressRaw","OneGQL_PersonaEmailAddressRaw","OneGQL_PersonaImAddressRaw","OneGQL_PersonaPhoneRaw","OneGQL_PersonaWebsiteRaw"],OneGQL_PersonaEmailAddressBase:["OneGQL_PersonaEmailAddress","OneGQL_PersonaEmailAddressRaw"],OneGQL_PersonaImAddressBase:["OneGQL_PersonaImAddress","OneGQL_PersonaImAddressRaw"],OneGQL_PersonaPhoneBase:["OneGQL_PersonaPhone","OneGQL_PersonaPhoneRaw"],OneGQL_PersonaWebsiteBase:["OneGQL_PersonaWebsite","OneGQL_PersonaWebsiteRaw"],OneGQL_Presence:["OneGQL_MePresence","OneGQL_PersonPresence"],OneGQL_PresenceMutationResult:["OneGQL_PresenceMutationFailure","OneGQL_PresenceMutationFailureNetworkOffline","OneGQL_PresenceMutationSuccess"],OneGQL_PresenceStatusNoteExpiry:["OneGQL_PresenceStatusNoteExpiryCustom","OneGQL_PresenceStatusNoteExpiryPreDefined"],OneGQL_RemoveConversationFolderResult:["OneGQL_RemoveConversationFolderSuccess","OneGQL_RemoveConversationFolderError"],OneGQL_RemoveConversationFromFolderResult:["OneGQL_RemoveConversationFromFolderSuccess","OneGQL_RemoveConversationFromFolderError"],OneGQL_RemovePersonFromFavoritesMutationResult:["OneGQL_RemovePersonFromFavoritesSuccess","OneGQL_RemovePersonFromFavoritesError"],OneGQL_RemovePersonFromSpeedDialMutationResult:["OneGQL_RemovePersonFromSpeedDialMutationSuccess","OneGQL_RemovePersonFromSpeedDialMutationError"],OneGQL_RemoveTagFromPersonMutationResult:["OneGQL_RemoveTagFromPersonSuccess","OneGQL_RemoveTagFromPersonFailure"],OneGQL_RenameConversationFolderResult:["OneGQL_UserDefinedConversationFolder","OneGQL_RenameConversationFolderError"],OneGQL_ReorderConversationFolderListResult:["OneGQL_ReorderConversationFolderListSuccess","OneGQL_ReorderConversationFolderListError"],OneGQL_ReorderConversationFoldersResult:["OneGQL_ConversationFoldersConnection","OneGQL_ReorderConversationFoldersError"],OneGQL_RestoreArchivedChannelResult:["OneGQL_ChannelConversation","OneGQL_RestoreArchivedChannelError"],OneGQL_SetBotChatConversationBlockStatusResult:["OneGQL_BotChatConversation","OneGQL_SetBotChatConversationBlockStatusError"],OneGQL_SetChannelRecommendationResult:["OneGQL_ChannelConversation","OneGQL_SetChannelRecommendationError"],OneGQL_SetChatBlockedResult:["OneGQL_SetChatBlockedSuccess","OneGQL_SetChatBlockedError"],OneGQL_SetChatConversationMuteStatusResult:["OneGQL_OneOnOneChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_BotChatConversation","OneGQL_SetChatConversationMuteStatusError"],OneGQL_SetChatHiddenResult:["OneGQL_SetChatHiddenSuccess","OneGQL_SetChatHiddenError"],OneGQL_SetConversationConsumptionHorizonBookmarkResult:["OneGQL_SetConversationConsumptionHorizonBookmarkSuccess","OneGQL_SetConversationConsumptionHorizonBookmarkError"],OneGQL_SetConversationConsumptionHorizonResult:["OneGQL_SetConversationConsumptionHorizonSuccess","OneGQL_SetConversationConsumptionHorizonError"],OneGQL_SetConversationFolderExpandedStateResult:["OneGQL_ConversationFoldersEdge","OneGQL_SetConversationFolderExpandedStateError"],OneGQL_SetConversationFoldersExpandedStateResult:["OneGQL_SetConversationFoldersExpandedStateSuccess","OneGQL_SetConversationFoldersExpandedStateError"],OneGQL_SetConversationTeamExpandedStateResult:["OneGQL_Team","OneGQL_SetConversationTeamExpandedStateError"],OneGQL_SetDiscardDraftChatResult:["OneGQL_SetDiscardDraftChatSuccess","OneGQL_SetDiscardDraftChatError"],OneGQL_SetFolderViewTypeResult:["OneGQL_SetFolderViewTypeSuccess","OneGQL_SetFolderViewTypeError"],OneGQL_SinglePartyConversation:["OneGQL_BotChatConversation","OneGQL_OneOnOneChatConversation"],OneGQL_SortConversationFolderResult:["OneGQL_SortConversationFolderSuccess","OneGQL_SortConversationFolderError"],OneGQL_SuggestedConversation:["OneGQL_SuggestedContactConversation","OneGQL_SuggestedGroupChatConversation"],OneGQL_ToggleChannelVisibilityResult:["OneGQL_ChannelConversation","OneGQL_ToggleChannelVisibilityError"],OneGQL_ToggleTeamVisibilityResult:["OneGQL_Team","OneGQL_ToggleTeamVisibilityError"],OneGQL_UnblockPersonMutationResult:["OneGQL_UnblockPersonSuccess","OneGQL_UnblockPersonError"],Overview:["OverviewEntry","DeviceDetailEntry"],ParkedCall:["RegularParkedCall","SLAParkedCall"],ParticipantsChangedEvent:["ParticipantsChanged","ParticipantCountsChanged"],PinnedConversationItemInfo:["Message"],PlatformTab:["BasicTab","ExtensionTab","WikiTab","FileViewTab","PowerBiTab","WebsiteTab","DocumentLibraryTab","OneNoteTab","StaticExtensionTab","LegacyWikiTab","LegacyDocumentLibraryTab","PlaceholderTab","CalendarTab"],PlatformTabNavigationData:["PlatformTabRecapData","PlatformTabQnaData","PlatformTabWhiteboardData","PlatformTabBotData"],PlatformTabsConnectionEvent:["PlatformTabAddedEvent","PlatformTabsConnectionUpdatedEvent"],PresenceError:["PresenceErrorGeneric","PresenceErrorNetworkOffline"],PresenceResult:["PresenceSuccess","PresenceErrorNetworkOffline","PresenceErrorGeneric"],QueueAnalyticsChartWidgetSeries:["QueueAnalyticsBarChartWidgetSeries","QueueAnalyticsColumnChartWidgetSeries","QueueAnalyticsLineChartWidgetSeries"],QueueAnalyticsChartingWidget:["QueueAnalyticsBarChartWidget","QueueAnalyticsColumnChartWidget","QueueAnalyticsDonutWidget","QueueAnalyticsLineChartWidget","QueueAnalyticsSimpleCardWidget","QueueAnalyticsStackedBarWidget","QueueAnalyticsTableWidget"],QueueRealTimeEntityDetail:["QueueRealTimeCallQueue","QueueRealTimeAgent","QueueRealTimeAutoAttendant","QueueRealTimeAllAgentsSummary","QueueRealTimeError"],QueueRealTimeResult:["QueueRealTime","QueueRealTimeError"],RemoveAllMeetingsFromLiveMeetingStatusBarResult:["RemoveAllMeetingsFromLiveMeetingStatusBarPayload","LiveMeetingError"],RemoveMeetingFromLiveMeetingStatusBarResult:["RemoveMeetingFromLiveMeetingStatusBarPayload","LiveMeetingError"],ReplyChainUpdate:["NewReplyChainEvent","UpdateReplyChainMessageEvent","DeleteReplyChainEvent","UpdateReplyChainEvent"],ResolveCaptchaChallengeResult:["ResolvedCaptchaChallenge","TflCaptchaChallengeError"],RestoreChannelResponse:["Channel","RestoreChannelError"],SBGroupLayout:["SBGroupLayoutSingleRenderer","SBGroupLayoutMultiRenderer"],SelectorResolutionResult:["SelectorResolution","EspTargetError"],SeriesMeetingEventInfoResponse:["SeriesMeetingEventInfoSuccess","SeriesMeetingEventInfoFailed"],SetExternalCalendarEmailAddressResult:["User","SetExternalCalendarEmailAddressError"],SetSpeedDialSystemTagMutationResult:["SetSpeedDialSystemTagMutationSuccess","SpeedDialContactsError"],SharedItemNode:["FileItemNode","LinkItemNode"],SmartRepliesResult:["SmartRepliesNavigatorResult","SmartRepliesSuggestionsResult"],SpeedDialContactsResult:["SpeedDialContactsError","SpeedDialContactsConnection"],SubscribeToCaptchaChallengesResult:["TflCaptchaChallenge","TflCaptchaChallengeError"],SuggestedAction:["SuggestedActionImBack","SuggestedActionCompose","SuggestedActionODSL"],TeamAndChannelListUpdateEvent:["TeamUpdate","ChannelUpdate"],TeamUnion:["Team","NonMemberSharedTeam"],TeamsAndChannelsUpdateEvent:["TeamUpdate","ChannelUpdate"],TechSpecs:["TechSpecEntry","DeviceDetailEntry"],TflCaptchaChallengeResult:["TflCaptchaChallenge","TflCaptchaChallengeError"],TflFeaturedItem:["TflMeetingLinkInfo","CalendarEvent","StaticNowCards","TflNoForYouCardInfo"],TflForYouMeetingInfo:["TflMeetingLinkInfo","TflNoForYouCardInfo"],TflForYouScheduledMeetingInfo:["CalendarEvent","TflNoForYouCardInfo"],TflForYouStaticNowCardInfo:["StaticNowCard","TflNoForYouCardInfo"],ThirdPartyDevicesEvent:["ThirdPartyDevicePairingRequest","ThirdPartyDeviceMeetingReactionRequest","ThirdPartyDeviceToggleRequest"],UnifiedCalendarEventsResult:["CalendarEvents","CalendarErrorResponse"],UpdateCommunityFeaturedStateResponse:["Communities","FeaturedCommunityError"],UpdateMuteForTeamResult:["MuteTeamResult","UpdateMuteForTeamError"],UpdateMuteForThreadMemberResult:["ThreadMember","UpdateMuteForThreadMemberError"],UpdateUserResponse:["User","UpdateUserError"],UserPreferencesCategoryValue:["PersonalFileSiteDetailsValue","UserSettingsValue","FirstLoginInformationValue","ReadReceiptsEnabledValue","IsSingleUserTenantValue","CortanaSettingsValue","ControllerConnectedServicesEnabledValue","KeyboardShortcutsSettingsValue","SuggestedRepliesSettingsValue","SuggestedScheduleMessageDeliverySettings","TranslationSettingsValue","FavoritesValue","TeamOrdersValue","AutoUnfavoriteTeamsValue","ShowInMeetingReportValue","MobileContactsSyncValue","UserPinnedAppValue","CallAccessibilitySettingsValue","TranscriptAndCaptionSettingsValue","SelfChatSettingsValue","EnableChannelsV2Value","SimpleCollabUserSettingsValue","ChannelCreationModalityTypeValue","VivaTopicsSettingsValue","EduSimplifiedUxListDefaultValue","PreferredSkinToneIndexValue","EnableCopyPasteTimestampValue","UserEnableSurveysNotificationValue","ApplicationIntegrationValue","RccViewSettingsValue","PhonelinkSmsPairingDeviceIdValue","DefaultMessageReactionsValue","AppConsumptionHorizonValue","LastStaleTeamsRunJobTimestampValue","StaleTeamsConsumptionTimestampValue","EnablePushToTalkValue","AiInterpretationSettingsValue","PlacesSettingsValue","LocaleValue","IsQueuesAppUserValue","PairedTransportCompanionDevices","EnableAutoSendingAutoBrbValue"],UserPreferencesResponse:["UserPreferences","UserPreferencesError"],UserVideoBackgroundImageResult:["UserVideoBackgroundImage","UserVideoBackgroundImageError"],VideoBackgroundImageResult:["VideoBackgroundImage","VideoBackgroundImageError"],VideoEffectConfigChanged:["TouchUpToggleChanged","TouchUpStrengthChanged","AutoAdjustToggleChanged","EyeContactToggleChanged"],VirtualConsumerEventParticipantsResult:["VirtualConsumerEventParticipants","VirtualConsumerEventsError"],VirtualConsumerEventResult:["VirtualConsumerEvent","VirtualConsumerEventsError"],VirtualConsumerEventsResult:["VirtualConsumerEvents","VirtualConsumerEventsError"],VirtualConsumerEventsUserRecommendationsResult:["VirtualConsumerEventsUserRecommendations","VirtualConsumerEventsError"]}}.possibleTypes;var JC=n(513774),KC=n(750307),ZC=n(212215),XC=n(224595),eb=n(572848),tb=n(896638),nb=n(774452),ib=n(978686),ab=n(449406),ob=n(251394);var rb=n(525946);function sb(e){const t=new Map,n=new Map;return i=>{switch(i.name){case"execute.start":t.set(i.executeId,i.params);break;case"execute.next":{const n=t.get(i.executeId);n&&e.markWrite(GC.J.relay,n.name,i.duration);break}case"execute.error":case"execute.complete":t.delete(i.executeId);break;case"store.notify.start":{const t=i.sourceOperation?.request.identifier;t&&n.set(t,e.markDiffStart(GC.J.relay,i.sourceOperation.request.node.operation.name));break}case"store.notify.complete":{const t=i.sourceOperation?.request.identifier;if(t){const i=n.get(t);i&&e.markDiffEnd(i),n.delete(t)}break}}}}var lb=n(943015);function cb(e){return function(t,{args:n,toReference:i,canRead:a}){if(a(t))return t;const o=e(n);return a(o)?i(o):void 0}}const db={merge:["callTranscriptState","activeWindow","activeWindowForEntity","messages","userPreferences"],replace:["activeWindows","callingAlerts","workWeekDays","dateRange","activeCalls","listBreakoutRoomsWithDetails"]},ub={Query:{fields:{getMeetingChatErrorCode:cb((e=>({__typename:"MeetingChatErrorCode",id:e?.conversationId}))),user:cb((e=>({__typename:"User",id:e?.userId}))),presence:cb((e=>({__typename:"Presence",id:`${e?.userId}_ups`}))),call:cb((e=>({__typename:"Call",id:e?.id}))),streamDetails:cb((e=>({__typename:"StreamDetailsInfo",id:e?.id}))),breakoutRoomsDetails:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]],read:cb((e=>({__typename:"BreakoutRoomsDetails",id:e?.coordinates.threadId})))},searchForMentionV2:{keyArgs:["teamId","searchQuery","includeBots","channelText","teamText","generalText","channelType","hostTenantId","enableScheduledTags","enableOwnersTag"]},breakoutRoomSettings:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},listBreakoutRoomsWithDetails:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},breakoutRoomsClientState:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},localizationSettings:{keyArgs:["currentLocale"]},prejoinState:{merge:(e,t,{mergeObjects:n})=>t?.timestamp&&e?.timestamp&&t.timestamp<e.timestamp?e:n(e,t)},searchConversation:{keyArgs:["searchTerm","conversationId","filters","isFromTopics"],merge:(e,t)=>t?e?{...t,Results:[...e.Results,...t.Results]}:t:e},searchConversationTopics:{keyArgs:["searchTerm","conversationId","filters","isFromTopics"],merge:(e,t)=>t?e?{...t,Results:[...e.Results,...t.Results]}:t:e},myGroupSettings:{merge:(e,t)=>{if(!t)return[...e];if(!e)return[...t];return[{...t[0],...e[0]}]}},...db.merge.reduce(((e,t)=>({[t]:{merge:!0},...e})),{}),...db.replace.reduce(((e,t)=>({[t]:{merge:!1},...e})),{})}},Subscription:{fields:{chatServiceEvent:{merge:!1},callRecordingStateChangedEvent:{merge:!1},callingServiceEvent:{merge:!1}}},CallParticipantsCounts:{keyFields:["teamsCallId"]},ParticipantCountsChanged:{keyFields:["teamsCallId"]},ParticipantsChanged:{keyFields:["teamsCallId"]},MessagesResult:{keyFields:!1},WindowHistoryItem:{keyFields:!1},SelectedDevices:{keyFields:!1},Window:{fields:{windowHistory:{merge:!1},activeEntities:{merge:!0},correlation:{merge:!0},extendedEntityContainerState:{merge:!0}}},DeviceList:{fields:{cameras:{merge:!1},camerasSupportingAutoFraming:{merge:!1},microphones:{merge:!1},selectedDevices:{merge:!0}}},Call:{fields:{extendedCallType:{merge:!0},capabilities:{merge:!0},breakoutRoomDetails:{merge:!0}}},RoomCoordinates:{keyFields:["threadId"]},BasicParticipant:{keyFields:["participantId"]},BreakoutRoomsDetails:{fields:{breakoutRooms:{merge:!1}}},BreakoutRoom:{fields:{clientActionState:{read:e=>e||null},participants:{merge:!1}}},CalendarEvent:{keyFields:["objectId"]},InDayEvents:{keyFields:["mailboxAddress","date"],fields:{events:{merge:!1}}},AllDayEvents:{keyFields:["mailboxAddress","date"],fields:{events:{merge:!1}}},Building:{keyFields:["address"]},RecurrenceEvents:{keyFields:["mailboxAddress","cleanGlobalObjectId"]},MeetingCompositeKey:{keyFields:["conversationId","messageId","eventId","modifiedStamp"]},Translation:{keyFields:!1},DiagnosticInfo:{keyFields:!1},EmailUser:{keyFields:["smtp"]},AuthenticationUserProfile:{keyFields:["objectId","tenantId"]},FluidPendingMention:{keyFields:["atMentionId"]},Participant:{keyFields:["participantId"]},Rectangle:{keyFields:!1},AudienceSceneExtent:{keyFields:!1},AudienceSceneParticipant:{keyFields:!1},ChatMessageMentionType:{keyFields:!1},Feed:{fields:{section:{keyArgs(e,{variables:t}){if(t)return t.section},merge:(e,t)=>e?t?.deltaRequestDetails?.deltaRequestId&&t.deltaRequestDetails.deltaRequestId===e?.requestId?{...t,dataReceivedOnClientTimestamp:e.dataReceivedOnClientTimestamp,items:[...e.items,...t.items]}:t?.deltaRequestDetails?.deltaRequestId===e?.deltaRequestDetails?.deltaRequestId&&t?.requestId===e?.requestId?t:t.deltaRequestDetails?.deltaRequestId?e:t:t}}},FeedItemType:{keyFields:["uri"]},FilesListResult:{keyFields:["threadId"]},PaymentDetails:{keyFields:["eventId"]},Channel:{fields:{defaultFileSettings:{merge:!0},membershipSummary:{merge:!0},spaceAdminSettings:{merge:!0}}},Team:{fields:{membershipSummary:{merge:!0},teamSettings:{merge:!0},teamGuestSettings:{merge:!0},teamSiteInformation:{merge:!0},sensitivityLabel:{merge:!0}}},TeamSettings:{fields:{funControl:{merge:!0}}},OneGQL_ActivityConversation:{merge:!0},OneGQL_ActivityConversationActivityStatus:{merge:!0},OneGQL_ActivityConversationUpdateEvent:{merge:!0},OneGQL_AddPersonToFavoritesError:{merge:!0},OneGQL_AddPersonToFavoritesSuccess:{merge:!0},OneGQL_AddPersonToSpeedDialMutationError:{merge:!0},OneGQL_AddPersonToSpeedDialMutationSuccess:{merge:!0},OneGQL_AddTagForPersonFailure:{merge:!0},OneGQL_AddTagForPersonSuccess:{merge:!0},OneGQL_AppsFolderUpdateEvent:{merge:!0},OneGQL_BizChatMetaOSConversation:{merge:!0},OneGQL_BlockPersonError:{merge:!0},OneGQL_BlockPersonSuccess:{merge:!0},OneGQL_BotChatConversation:{merge:!0},OneGQL_BotPersona:{merge:!0},OneGQL_Call:{merge:!0},OneGQL_ChannelActivityEvent:{merge:!0},OneGQL_ChannelAddEvent:{merge:!0},OneGQL_ChannelCardContentViewData:{merge:!0},OneGQL_ChannelCardHeaderViewData:{merge:!0},OneGQL_ChannelCardViewData:{merge:!0},OneGQL_ChannelConnection:{merge:!0},OneGQL_ChannelConnectionEdge:{merge:!0},OneGQL_ChannelConversation:{merge:!0},OneGQL_ChannelConversationActivityStatus:{merge:!0},OneGQL_ChannelFilteringCount:{merge:!0},OneGQL_ChannelHideEvent:{merge:!0},OneGQL_ChannelRemoveEvent:{merge:!0},OneGQL_ChannelUpdateEvent:{merge:!0},OneGQL_ChatConversationActivityStatus:{merge:!0},OneGQL_ChatLastMessage:{merge:!0},OneGQL_ChatReorderEvent:{merge:!0},OneGQL_ContactMutationErrorGeneric:{merge:!0},OneGQL_ContactMutationErrorNetworkOffline:{merge:!0},OneGQL_ContactMutationSuccess:{merge:!0},OneGQL_ContactsMutationEventResult:{merge:!0},OneGQL_ConversationAddEvent:{merge:!0},OneGQL_ConversationAddToRecentEvent:{merge:!0},OneGQL_ConversationConsumptionHorizon:{merge:!0},OneGQL_ConversationFolderActivityStatus:{merge:!0},OneGQL_ConversationFolderActivityStatusUpdate:{merge:!0},OneGQL_ConversationFolderAddEvent:{merge:!0},OneGQL_ConversationFolderConversationsUpdateEvent:{merge:!0},OneGQL_ConversationFolderRemoveEvent:{merge:!0},OneGQL_ConversationFolderSortEvent:{merge:!0},OneGQL_ConversationFolderUpdateEvent:{merge:!0},OneGQL_ConversationFoldersConnection:{merge:!0},OneGQL_ConversationFoldersEdge:{merge:!0},OneGQL_ConversationFoldersError:{merge:!0},OneGQL_ConversationFoldersOrderUpdate:{merge:!0},OneGQL_ConversationMessage:{merge:!0},OneGQL_ConversationRemoveEvent:{merge:!0},OneGQL_ConversationRemoveFromRecentEvent:{merge:!0},OneGQL_ConversationSensitivityLabel:{merge:!0},OneGQL_ConversationSortAndFilterEvent:{merge:!0},OneGQL_ConversationUpdateEvent:{merge:!0},OneGQL_ConversationsConnection:{merge:!0},OneGQL_ConversationsEdge:{merge:!0},OneGQL_CreateConversationFolderError:{merge:!0},OneGQL_DeletedChannel:{merge:!0},OneGQL_DiscoverConversation:{merge:!0},OneGQL_DiscoverConversationActivityStatus:{merge:!0},OneGQL_DiscoverConversationUpdateEvent:{merge:!0},OneGQL_DndItemToConversationFolderError:{merge:!0},OneGQL_DndItemToConversationFolderSuccess:{merge:!0},OneGQL_Duration:{merge:!0},OneGQL_FolderViewTypeUpdateEvent:{merge:!0},OneGQL_GroupChatConversation:{merge:!0},OneGQL_HideAllChannelsError:{merge:!0},OneGQL_HideAllChannelsSuccess:{merge:!0},OneGQL_HoistHiddenChatConversation:{merge:!0},OneGQL_MarkAllAsReadByAppError:{merge:!0},OneGQL_Me:{merge:!0},OneGQL_MePresence:{merge:!0},OneGQL_MeetingChatConversation:{merge:!0},OneGQL_MembershipSummary:{merge:!0},OneGQL_MessageReadEvent:{merge:!0},OneGQL_MetaOSBizChatHideEvent:{merge:!0},OneGQL_MetaOSBizChatShowEvent:{merge:!0},OneGQL_MiniConversation:{merge:!0},OneGQL_MoveItemToConversationFolderError:{merge:!0},OneGQL_MoveItemToConversationFolderSuccess:{merge:!0},OneGQL_MultiPartyConversationParticipantEdge:{merge:!0},OneGQL_MultiPartyConversationParticipantsConnection:{merge:!0},OneGQL_NewChannelCreateEvent:{merge:!0},OneGQL_NewChatConversation:{merge:!0},OneGQL_NoOpEvent:{merge:!0},OneGQL_NonMemberChannel:{merge:!0},OneGQL_NonMemberTeam:{merge:!0},OneGQL_OneOnOneChatConversation:{merge:!0},OneGQL_Person:{merge:!0},OneGQL_PersonAnniversary:{merge:!0},OneGQL_PersonAnniversaryRaw:{merge:!0},OneGQL_PersonAnnotation:{merge:!0},OneGQL_PersonAnnotationRaw:{merge:!0},OneGQL_PersonCompanyDetail:{merge:!0},OneGQL_PersonContactConnection:{merge:!0},OneGQL_PersonContactEdge:{merge:!0},OneGQL_PersonContactFilterAggregation:{merge:!0},OneGQL_PersonCustomAttribute:{merge:!0},OneGQL_PersonExtendedUserInfo:{merge:!0},OneGQL_PersonName:{merge:!0},OneGQL_PersonNameRaw:{merge:!0},OneGQL_PersonPhoneticName:{merge:!0},OneGQL_PersonPositionDetail:{merge:!0},OneGQL_PersonPresence:{merge:!0},OneGQL_PersonRawCollections:{merge:!0},OneGQL_PersonRelatedEntity:{merge:!0},OneGQL_PersonRelatedEntityRaw:{merge:!0},OneGQL_PersonSkill:{merge:!0},OneGQL_PersonTag:{merge:!0},OneGQL_PersonTopic:{merge:!0},OneGQL_PersonTopicSuggestion:{merge:!0},OneGQL_PersonWorkPosition:{merge:!0},OneGQL_PersonWorkPositionRaw:{merge:!0},OneGQL_PersonaAddress:{merge:!0},OneGQL_PersonaAddressDetail:{merge:!0},OneGQL_PersonaAddressRaw:{merge:!0},OneGQL_PersonaCoin:{merge:!0},OneGQL_PersonaEmailAddress:{merge:!0},OneGQL_PersonaEmailAddressRaw:{merge:!0},OneGQL_PersonaGeoCoordinates:{merge:!0},OneGQL_PersonaImAddress:{merge:!0},OneGQL_PersonaImAddressRaw:{merge:!0},OneGQL_PersonaOrganizationConnection:{merge:!0},OneGQL_PersonaOrganizationEdge:{merge:!0},OneGQL_PersonaPhone:{merge:!0},OneGQL_PersonaPhoneRaw:{merge:!0},OneGQL_PersonaPhoto:{merge:!0},OneGQL_PersonaTimespan:{merge:!0},OneGQL_PersonaWebsite:{merge:!0},OneGQL_PersonaWebsiteRaw:{merge:!0},OneGQL_PossibleFolderDestinationConnection:{merge:!0},OneGQL_PossibleFolderDestinationEdge:{merge:!0},OneGQL_PresenceAvailability:{merge:!0},OneGQL_PresenceAvailabilityEventResult:{merge:!0},OneGQL_PresenceForcedAvailability:{merge:!0},OneGQL_PresenceMutationFailure:{merge:!0},OneGQL_PresenceMutationFailureNetworkOffline:{merge:!0},OneGQL_PresenceMutationSuccess:{merge:!0},OneGQL_PresenceOutOfOfficeStatus:{merge:!0},OneGQL_PresenceShift:{merge:!0},OneGQL_PresenceShifts:{merge:!0},OneGQL_PresenceStatusNote:{merge:!0},OneGQL_PresenceStatusNoteExpiryCustom:{merge:!0},OneGQL_PresenceStatusNoteExpiryPreDefined:{merge:!0},OneGQL_PresenceWorkLocation:{merge:!0},OneGQL_RecentChannelsAddEvent:{merge:!0},OneGQL_RecentChannelsRemoveEvent:{merge:!0},OneGQL_RecentChannelsReorderEvent:{merge:!0},OneGQL_RemoveConversationFolderError:{merge:!0},OneGQL_RemoveConversationFolderSuccess:{merge:!0},OneGQL_RemoveConversationFromFolderError:{merge:!0},OneGQL_RemoveConversationFromFolderSuccess:{merge:!0},OneGQL_RemovePersonFromFavoritesError:{merge:!0},OneGQL_RemovePersonFromFavoritesSuccess:{merge:!0},OneGQL_RemovePersonFromSpeedDialMutationError:{merge:!0},OneGQL_RemovePersonFromSpeedDialMutationSuccess:{merge:!0},OneGQL_RemoveTagFromPersonFailure:{merge:!0},OneGQL_RemoveTagFromPersonSuccess:{merge:!0},OneGQL_RenameConversationFolderError:{merge:!0},OneGQL_ReorderConversationFolderListError:{merge:!0},OneGQL_ReorderConversationFolderListSuccess:{merge:!0},OneGQL_ReorderConversationFoldersError:{merge:!0},OneGQL_RestoreArchivedChannelError:{merge:!0},OneGQL_SavedConversation:{merge:!0},OneGQL_SelectedConversationEvent:{merge:!0},OneGQL_SelfChatConversation:{merge:!0},OneGQL_SetBotChatConversationBlockStatusError:{merge:!0},OneGQL_SetChannelRecommendationError:{merge:!0},OneGQL_SetChatBlockedError:{merge:!0},OneGQL_SetChatBlockedSuccess:{merge:!0},OneGQL_SetChatConversationMuteStatusError:{merge:!0},OneGQL_SetChatHiddenError:{merge:!0},OneGQL_SetChatHiddenSuccess:{merge:!0},OneGQL_SetConversationConsumptionHorizonBookmarkError:{merge:!0},OneGQL_SetConversationConsumptionHorizonBookmarkSuccess:{merge:!0},OneGQL_SetConversationConsumptionHorizonError:{merge:!0},OneGQL_SetConversationConsumptionHorizonSuccess:{merge:!0},OneGQL_SetConversationFolderExpandedStateError:{merge:!0},OneGQL_SetConversationFoldersExpandedStateError:{merge:!0},OneGQL_SetConversationFoldersExpandedStateSuccess:{merge:!0},OneGQL_SetConversationTeamExpandedStateError:{merge:!0},OneGQL_SetDiscardDraftChatError:{merge:!0},OneGQL_SetDiscardDraftChatSuccess:{merge:!0},OneGQL_SetFolderViewTypeError:{merge:!0},OneGQL_SetFolderViewTypeSuccess:{merge:!0},OneGQL_ShowHiddenChannelEvent:{merge:!0},OneGQL_ShowHiddenTeamEvent:{merge:!0},OneGQL_ShowOnlyChannelsWithUnreadPersonalMentionEvent:{merge:!0},OneGQL_SimpleCollabHeaderSettings:{merge:!0},OneGQL_SimpleCollabLeftRailViewData:{merge:!0},OneGQL_SimpleCollabSettingsUpdateEvent:{merge:!0},OneGQL_SimpleCollabViewData:{merge:!0},OneGQL_SortConversationFolderError:{merge:!0},OneGQL_SortConversationFolderSuccess:{merge:!0},OneGQL_SuggestedChatCount:{merge:!0},OneGQL_SuggestedContactConversation:{merge:!0},OneGQL_SuggestedGroupChatConversation:{merge:!0},OneGQL_SystemDefinedConversationFolder:{merge:!0},OneGQL_Team:{merge:!0},OneGQL_TeamActivityStatus:{merge:!0},OneGQL_TeamAddEvent:{merge:!0},OneGQL_TeamHideEvent:{merge:!0},OneGQL_TeamRemoveEvent:{merge:!0},OneGQL_TeamReorderEvent:{merge:!0},OneGQL_TeamSettings:{merge:!0},OneGQL_TeamSiteInformation:{merge:!0},OneGQL_Tenant:{merge:!0},OneGQL_TimeZone:{merge:!0},OneGQL_Timespan:{merge:!0},OneGQL_ToggleChannelVisibilityError:{merge:!0},OneGQL_ToggleTeamVisibilityError:{merge:!0},OneGQL_TypingParticipantsUpdateEvent:{merge:!0},OneGQL_UnblockPersonError:{merge:!0},OneGQL_UnblockPersonSuccess:{merge:!0},OneGQL_UnifiedGroup:{merge:!0},OneGQL_UnreadOnlySentinelValue:{merge:!0},OneGQL_UnreadOnlySentinelValueActivityStatus:{merge:!0},OneGQL_UserDefinedConversationFolder:{merge:!0},OneGQL_ViewData:{merge:!0}};function mb(e,t,n,i,a){if(n){const{config:{publicPath:n,buildType:o,buildVersion:r}}=i;if(!n)return;const s=window;if(s.__APOLLO_CLIENTS__||(s.__APOLLO_CLIENTS__=[]),s.__APOLLO_KEY_FIELDS__||(s.__APOLLO_KEY_FIELDS__=function(){const e={};for(const t of Object.keys(ub))ub[t].keyFields&&(e[t]=ub[t].keyFields);return e}()),"production"===o)"multi-window"===a?s.__REMPL_APOLLO_DEVTOOLS_URL__=`/multi-window/apollo-devtools?version=${r}`:"react-web-client"===a&&(s.__REMPL_APOLLO_DEVTOOLS_URL__="/v2/apollo-devtools");else{const e=n.endsWith("/")?n:n.concat("/");s.__REMPL_APOLLO_DEVTOOLS_URL__=`${e}apollo-devtools.html`}s.__APOLLO_GLOBAL_OPERATIONS__||(s.__APOLLO_GLOBAL_OPERATIONS__={globalMutations:NC,globalQueries:IC,globalSubscriptions:AC}),s.__APOLLO_CLIENTS__.push({client:e,clientId:t})}}class pb extends Error{constructor(e,t){super(`Accessing client ${e}/${t} after destroy`)}}const gb=new XC.C((()=>{throw new Error("This client has been destroyed!")}));class hb{constructor(e,t,n,i,a){this.name=i,this.storeType=a,this.disposed=!1,this.schemaId=BC.DefaultSchema,this.ctx=t,this.services=e,this._client=n,this.services.leakDetector?.track(bo.J.DataClient,this),this.services.dataOpsTracker&&this.setupWatchQueryTracking(this.client),this.services.dataEvictionService&&this.services.dataEvictionService?.register(this),this.registerClient(this.client)}get clientName(){return this.name}get client(){if(!this._client)throw new pb(this.constructor.name,this.name);return this._client}get cache(){return this.client.cache}get link(){return this.client.link}updateContext(e,t){this.ctx=e,this._client?.setLink(t)}async destroy(){this.services?.dataEvictionService&&this.services.dataEvictionService.unregister(this),await this.destroyClient(),this.ctx=void 0,this.services=void 0}async clearCache(){await(this._client?.clearStore())}getServices(){return this.services}getContext(){return this.ctx}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:null,selfIsMainClient:!1}}async mutate(e){const t=this.getApolloClientInstance(e.mutation);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,GC.i.mutate);const n=this.patchOptions(e),i=await t.mutate(n);return this.trackReadOperation(t,e),i}async query(e){const t=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,GC.i.query);const n=this.patchOptions(e),i=await t.query(n);return this.trackReadOperation(t,e),i}readQuery(e,t){const n=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(n)?.trackCall(this.storeType,GC.i.readQuery);const i=n.readQuery(e,t);return this.trackReadOperation(n,e),i}subscribe(e){const t=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,GC.i.subscribe);const n=this.patchSubscriptionOptions(e);return t.subscribe(n).map((n=>(this.trackReadOperation(t,e),this.maybeGetGraphQLStoreStatsReporterService(t)?.trackSubscribeEvent(this.storeType),n)))}watchQuery(e){try{const t=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,GC.i.watchQuery);const n=this.patchOptions(e);return t.watchQuery(n)}catch(e){return new lb.c((t=>t.error(e)))}}writeQuery(e){const t=this.getApolloClientInstance(e.query);return this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,GC.i.writeQuery),this.trackWriteOperation(t,e),t.writeQuery(e)}writeFragment(e){const t=this.getApolloClientInstance(e.fragment);return this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,GC.i.writeFragment),this.trackWriteOperation(t,e),t.writeFragment(e)}readFragment(e,t){const n=this.getApolloClientInstance(e.fragment);return this.maybeGetGraphQLStoreStatsReporterService(n)?.trackCall(this.storeType,GC.i.readFragment),n.readFragment(e,t)}get defaultOptions(){return this.client.defaultOptions}set defaultOptions(e){this.client.defaultOptions=e}get disableNetworkFetches(){return this.client.disableNetworkFetches}set disableNetworkFetches(e){this.client.disableNetworkFetches=e}getApolloClientInstance(e){return this.client}patchOptions(e){const{context:t,patched:n,...i}=e;return n?e:{...i,context:t?{...this.ctx,...t}:this.ctx,patched:!0}}patchSubscriptionOptions(e){return e.context||(e.context={}),e.context.windowId||(e.context.windowId=this.ctx?.windowId),e}registerClient(e){e.dataClients||(e.dataClients=[]),e.dataClients.push(this)}unregisterClient(e){return e.dataClients=e.dataClients?.filter((e=>e!==this)),0===(e.dataClients?.length??0)}async disposeClient(e,t){const n=this.unregisterClient(e);if(n&&((0,KC.m5)(e),(0,KC.m5)(e.cache),function(e){let t=window;for(t.__APOLLO_CLIENTS__&&(t.__APOLLO_CLIENTS__=t.__APOLLO_CLIENTS__.filter((t=>t.client!==e)));t;)t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__&&t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__.ApolloClient===e&&(t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__.ApolloClient=void 0),t.__APOLLO_CLIENT__&&t.__APOLLO_CLIENT__===e&&(t.__APOLLO_CLIENT__=void 0),t=t.parent===t?null:t.parent}(e)),n&&t){const{scenarioFactory:t}=this.services??{},n=t?.newScenario(be.Cu.ApolloClientDisposion);try{e.stop(),await e.clearStore(),i=this.cache,"function"==typeof i?.destroy&&this.cache.destroy(),e.setLink(gb),e.setResolvers([]),n?.stop()}catch(e){n?.fail({reason:String(e)})}}var i}async disposeClients(e){this._client&&(await this.disposeClient(this._client,e),e&&(this._client=void 0))}async destroyClient(){if(!this.disposed){this.disposed=!0;const{enableApolloClientDisposion:e}=this.services?.coreSettings.get(c.w.Core)??{};await this.disposeClients(e??!1)}}setupWatchQueryTracking(e){const t=e.cache;if(hb.patchedCaches.has(t))return;const n=t.watch;t.watch=(i,...a)=>{this.trackReadOperation(e,i,!0);const o=n.call(t,i,...a);return()=>(this.trackReadOperation(e,i,!1),o())},hb.patchedCaches.set(t,n)}trackReadOperation(e,t,n){this.ctx&&this.services&&(e instanceof hb||this.services.dataOpsTracker?.trackOperation(t,this.name,this.schemaId,n))}trackWriteOperation(e,t){this.ctx&&this.services&&(e instanceof hb||this.services.dataReleaseService?.trackWriteOperation(t))}maybeGetGraphQLStoreStatsReporterService(e){return e instanceof hb||!this.services?.graphqlStoreStatsReporterService?null:this.services?.graphqlStoreStatsReporterService}}hb.patchedCaches=new WeakMap;class vb extends hb{constructor(e,t,n,i,a,o){super(e,t,n,i,a),this.cacheStatsCallback=()=>{const e=this._relayEnvironment?.getStore(),t={nodeCount:0};if(!e)return t;const n=function(e){if(function(e){return null!=e?._recordSource}(e))return e._recordSource}(e);return n?{nodeCount:n.size()}:t},this._relayLogger=t.loggerFactory.newLogger("relay","data-client-core");const{relayRequestTimeoutMs:r}=e.coreSettings.get(c.w.Core);this._request_timeout_ms=r,this.onRelayUnhandledError=this.onRelayUnhandledError.bind(this),this._relayHandlers=new Map,o&&this.initRelayEnvironmentWithScenarioTracking(o)}get relayEnvironment(){return this._relayEnvironment}async destroy(){return this.destroyRelayEnvironment(),super.destroy()}async clearCache(){return this.clearRelayEnvironmentStore(),super.clearCache()}registerRelayHandler(e,t){t?this._relayHandlers.set(e,t):this._relayHandlers.delete(e)}destroyRelayEnvironment(){if(this._relayEnvironment){const t=this.getServices().graphqlStoreStatsReporterService;t&&t.removeCacheStatsCallback(GC.J.relay,this.cacheStatsCallback),(e=this._relayEnvironment.getStore()).relayStoreLeakInfo||(e.relayStoreLeakInfo={}),e.relayStoreLeakInfo.relayStoreLeakInfoEndTime=(new Date).toISOString(),this.clearRelayEnvironmentStore(),this._relayEnvironment=void 0}var e}clearRelayEnvironmentStore(){if(this._relayEnvironment){this._relayEnvironment.getStore().getSource().clear()}}initRelayEnvironment(e){const t=this.getServices().graphqlStoreStatsReporterService;this._relayEnvironment=(({isLiveResolverEnabled:e,gcReleaseBufferSize:t,configName:n,execute:i,log:a,onUnhandledError:o,handlerProvider:r})=>{const s=eb;s.ENABLE_CLIENT_EDGES=!0,s.ENABLE_RELAY_RESOLVERS=s.ENABLE_RELAY_RESOLVERS||e,o&&ob.onUnhandledError(o);const l={gcReleaseBufferSize:t??10},c=e?new ab(new nb,l):new ib(new nb,l);return new tb({log:a,store:c,network:{execute:i},configName:n,handlerProvider:r})})({isLiveResolverEnabled:e.isLiveResolverStoreEnabled,configName:e.configName??this.clientName,gcReleaseBufferSize:e.gcReleaseBufferSize,execute:this.getExecuteRequestHandler(),log:t?sb(t):null,onUnhandledError:this.onRelayUnhandledError,handlerProvider:e=>{const t=this._relayHandlers.get(e);return t?{update:(n,i)=>{rb(e)?.update(n,i),t.update(n,i)}}:rb(e)}}),function(e,t){const{leakDetector:n,entityType:i}=t;n&&(e.relayStoreLeakInfo={relayStoreLeakInfoStartTime:(new Date).toISOString(),relayStoreLeakInfoEntityType:i},n.track(bo.J.RelayStore,e))}(this._relayEnvironment.getStore(),{leakDetector:this.getServices().leakDetector,entityType:e.entityType}),t&&t.addCacheStatsCallback(GC.J.relay,this.cacheStatsCallback)}onRelayUnhandledError(e,t){t?(this._relayLogger.errorToTelemetry?.("Relay: Uncaught thrown error","cdl_links_data_client_core",void 0,!0),this._relayLogger.error(`Relay: Uncaught thrown error: ${e}`)):this._relayLogger.error(`Relay: Unhandled emitted error: ${e}`)}getExecuteRequestHandler(){return((e,t,n,i)=>{const a=e.text;if(!a){const t=`Relay: Request text not available for operation: ${e.name}`;return this._relayLogger.error(t),ob.create((e=>e.error(new Error(t))))}const o=this.getContext(),r=ob.from(XC.C.execute(this.link,{query:a,variables:t,operationName:e.name,context:o}));return"subscription"===e.operationKind?r:this._request_timeout_ms?function(e,t,n,i,a){return ob.create((o=>{const r=e.subscribe(o),s=n.setTimeout((()=>{const e=`Relay: Timeout reached while executing operation: ${i}`;a.errorToTelemetry?.(e,"cdl_links_data_client_core",void 0,!0),o.error(new Error(e)),r.unsubscribe()}),t);return()=>{n.clearTimeout(s),r.unsubscribe()}}))}(r,this._request_timeout_ms,o.windowProvider,e.name,this._relayLogger):r}).bind(this)}initRelayEnvironmentWithScenarioTracking(e){const t=this.getServices().scenarioFactory.findScenario(be.Cu.GraphQLCreateDataClient),n=performance.now();this.initRelayEnvironment(e),t?.appendEventData({graphQLCreateRelayEnvironmentTimeToStart:performance.now()-n})}}const yb=e=>e;class Sb extends vb{constructor(e,t,n,i,a,o,r){super(e,i,n,a||"INVALID",o,r),this.parent=t}getApolloClientInstance(e){const t=(0,wC.Vn)(e);if("OperationDefinition"===t.kind||"FragmentDefinition"===t.kind){const{selectionSet:{selections:n}}=t,i=this.getSharedGlobalOperationsList(t),a=n.filter((e=>"Field"===e.kind)).map((e=>"Field"===e.kind&&-1===i.indexOf(e.name.value)));if(a.every(yb))return this.client;if(a.some(yb)){throw(0,Je.$5)(this.className,d.O4.InvalidInput,"route",{operation:e},"Operation contains mix of shared and window private selections")}}return this.parent}getSharedGlobalOperationsList(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation?this.parentMutations:"OperationDefinition"===e.kind&&"subscription"===e.operation?this.parentSubscriptions:this.parentQueries}}class fb extends Sb{constructor(e,t,n,i,a){super(e,t,n,i,i.windowId,a)}get relayEnvironment(){return this.parent.relayEnvironment}get parentQueries(){return IC}get parentSubscriptions(){return AC}get parentMutations(){return NC}get className(){return"ChildDataClient"}clone(e){throw new Error("Trying to clone child instance")}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}}class kb extends vb{constructor(e,t,n,i,a,o){super(e,n,t,n.windowId||"INVALID",i,o),this.parent=a}get relayEnvironment(){return this.parent?.relayEnvironment}clone(e){throw new Error("Trying to clone child instance")}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:null,selfIsMainClient:!!this.ctx&&this.ctx.windowId===d.N2}}}class Cb extends kb{constructor(){super(...arguments),this.schemaId=BC.ViewSchema}subscribe(e){const t=this.getApolloClientInstance(e.query),n=this.patchOptions(e);return t.subscribe(n)}}var bb=n(845155),wb=n.n(bb);class Tb extends vb{constructor(e,t,n,i,a){super(e,n,t({windowId:n.windowId||d.N2,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"core",storeType:GC.J.core}),n.windowId||d.N2,GC.J.core,a),this.createApolloClient=t,this.overrideLink=null,this.viewSchemaClient=null,this.overrideLink=null,i&&(this.viewSchemaClient=i({windowId:n.windowId||d.N2,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"core-viewSchema",storeType:GC.J.viewSchema}),this.registerClient(this.viewSchemaClient))}get clientName(){return"core"}updateContext(e,t){super.updateContext(e,t),this.overrideLink=t}clone(e){return e.windowId===d.N2?new kb(this.getServices(),this.client,{...this.ctx,...e},this.storeType,this):new fb(this.getServices(),this,this.createApolloClient({windowId:e.windowId,entityType:e.entityType,viewportContext:e.windowProvider.viewportContext,name:`child-${e.windowId}`,overrideLink:this.overrideLink,storeType:GC.J.window}),{...this.ctx,...e},GC.J.window)}cloneForViewSchema(e){return wb()(this.viewSchemaClient,"View schema must be avaliable"),new Cb(this.getServices(),this.viewSchemaClient,{...this.ctx,...e},GC.J.viewSchema)}async disposeClients(e){await Promise.all([super.disposeClients(e),(async()=>{this.viewSchemaClient&&(await this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})()])}}class Ib extends hb{constructor(e,t,n){super(e,n,t,n.windowId||d.N2,GC.J.embed)}clone(e){return new kb(this.getServices(),this.client,{...this.ctx,...e},this.storeType)}}const Nb=(e,t,n)=>{const i=n.newLogger("appDefaults","data-client-core"),a=t.length;i.log(`Writing ${a.toString()} app default values to the Apollo cache.`),t.forEach((t=>{try{const{queryFieldName:n,gqlTypeName:i}=t,a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:`${i}DefaultQuery`},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:n},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]},o={[n]:{__typename:i}};e.writeQuery({query:a,data:o})}catch(e){const n=`Failed to write ${t.gqlTypeName} to cache as Query field ${t.queryFieldName}.`;i.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_active_application_hooks",void 0,!0)??i.error(n)}}))};function Ab(e){return new XC.C((t=>{const{query:n,variables:i,operationName:a}=t,o=t.getContext(),r={callerInfo:o?.callerInfo,callerScenarioId:o?.callerScenarioId,callerSlotId:o?.callerSlotId,viewportContext:o?.viewportContext};return e.execute(n,i,a,o?.rendererId,o?.windowId,r)}))}const Eb={mutation:new Set(["notifyWorkerSyncCanStart","notifyActiveContextChangedToCDLWorker","requestMessageChannelPort","closeMessageChannelPort"]),query:new Set,subscription:new Set};var Fb=n(654904);function _b({resolvers:e,contextValue:t}){return new XC.C(((n,i)=>{const a=function(e,t){const{query:n}=e,i=(0,wC.Vn)(n);if("OperationDefinition"!==i.kind)return;const{operation:a,selectionSet:{selections:o}}=i;if("mutation"!==a)return;const r=function(e,t){let n;return e.forEach((e=>{if("Field"===e.kind){const i=function(e,t){let n;return t.forEach((({Mutation:t})=>{t[e]&&(n=n||t[e])})),n}(e.name.value,t);if(i){if(n)throw new Error("There cannot be more than 1 matching forward resolver for a document");n={selection:e,resolver:i}}}})),n}(o,t);if(!r)return;return function(e){if(!e.arguments.every((({name:e,value:t})=>"Variable"!==t.kind||t.name.value===e.value))){const t=e.arguments.map((e=>e.name.value)).join(","),n=e.arguments.map((e=>e.value.name.value)).join(",");throw new Error(`Argument name mismatch. Mutation queries, which have forward mutation resolvers should \n                    have a 1-1 name match between the document variable names and the field resolver variable names.\n                    Allowed argument names ${t} does not match the supplied argument names ${n}`)}}(r.selection),r.resolver}(n,e);if(!a)return i(n);const o=n.getContext();return(0,Fb.S)(a(n.variables,{...t,...o})).flatMap((e=>(n.variables=e,i(n))))}))}var Db=n(248255);function Pb(e){return"subscription"===e.operationType}function Mb(e){const{operation:t,graphQLErrors:n,operationType:i}=e,a=t.getContext(),o={operationName:t.operationName,operationType:i,rendererId:a.windowId};return n&&n.length>0&&(o.errors=n.map((e=>function(e,t){let n=d.O4.UnhandledRuntimeException;const i={path:t};if(!e)return i;e.code?n=e.code:"Failed to fetch"===e.message&&(n=d.O4.FailedToFetch);if(i.code=n,e.hasOwnProperty("serverResponse")&&e.serverResponse){"number"==typeof e.serverResponse.status&&(i.status=e.serverResponse.status),i.mscv=e.serverResponse.headers["ms-cv"],i.xmsCorrelationId=e.serverResponse.headers["x-ms-correlation-id"];try{i.contextId=JSON.stringify(e.serverResponse.headers.contextid)}catch(e){}}return i}(e.originalError,e.path&&e.path.join("::"))))),o}function Rb(e,t,n){!xb(e)&&n&&function(e,t,n){const i=Mb(e);if(i.errors&&i.errors.length>0){!function(e,t){const{operation:n,operationType:i}=e;t.error(`'${n.operationName}' operation of type '${i}' failed.`)}(e,t);const a={...i,errors:"","Panel.WindowID":i.rendererId};i.errors[0].code===d.O4.FailedToFetch?n.cancel(a):n.fail(a)}else n.stop({operationName:i.operationName,operationType:i.operationType,"Panel.WindowID":i.rendererId})}(e,t,n)}function xb(e){return Pb(e)}function Lb(e,t,n,i,a){const o=e.newLogger("TrackRequestLink","data-resolvers-browser-common");return new XC.C(((e,r)=>{const{query:s}=e,{operation:l}=(0,wS.A)(s,null),c=r(e);let d;return n&&a?.addOperation(e.operationName,l,"Request"),i&&(d=function(e,t){let n;return xb(e)||(n=t.newScenario(be.Cu.QueryExecution)),n}({operationType:l,operation:e},t)),new lb.c((t=>{let r;try{r=c.subscribe({next:r=>{i&&(r.errors&&r.errors.length>0?Rb({operation:e,operationType:l,graphQLErrors:r.errors,response:r},o,d):function(e,t){if(!Pb(e)&&t){const n=Mb(e);t.mark(be.BQ.QueryResult,{operationName:n.operationName,operationType:n.operationType,"Panel.WindowID":n.rendererId})}}({operation:e,operationType:l,response:r},d)),n&&a?.addOperation(e.operationName,l,"Response"),t.next(r)},error:r=>{const s=(e=>e&&e.result?e.result.errors:e instanceof Error?[new Db.e("Unhandled exception",void 0,void 0,void 0,void 0,e)]:[new Db.e("Unknown error payload provided from forward link")])(r);i&&Rb({operation:e,operationType:l,graphQLErrors:s},o,d),n&&a?.addOperation(e.operationName,l,"Error"),t.error(r)},complete:()=>{i&&Rb({operationType:l,operation:e},o,d),d=void 0,t.complete()}})}catch(t){throw i&&Rb({operationType:l,operation:e,graphQLErrors:[new Db.e("Unhandled exception in forward link",void 0,void 0,void 0,void 0,t)]},o,d),d=void 0,t}return()=>{i&&Rb({operationType:l,operation:e},o,d),d=void 0,r&&r.unsubscribe()}}))}))}const Ob=new class{constructor(){this.map=new Map}destroy(e){const t=this.map.get(e);t&&(t.subscriptions.forEach((e=>{e.next(void 0),e.complete()})),t.subscriptions.length=0,this.map.delete(e))}register(e){if(!this.map.has(e)){const t=new lb.c((t=>{const{subscriptions:n}=this.map.get(e)||{};n&&n.push(t)}));this.map.set(e,{cancellationObservable:t,subscriptions:[]})}return this.map.get(e).cancellationObservable}};function jb(e){Ob.destroy(e)}function Bb(e,t){const n=e.newLogger("TrackSubscriptionLinks","data-resolvers-browser-common");return new XC.C(((e,i)=>{const{eventsWithoutCancellationListener:a}=t.get(c.w.Calling),{operationName:o,query:r}=e,{operation:s}=(0,wS.A)(r,null);if("subscription"!==s||a?.includes(o))return i(e);const l=(0,E.v4)(),d=Ob.register(l);return n.debug(`Forwarding request ${l} for operation ${o}`),e.setContext({cancellationListener:d}),new lb.c((t=>{let n;try{const a=i(e);n=a.subscribe({next:e=>{e?.errors?.length&&jb(l),t.next(e)},error:e=>{jb(l),t.error(e)},complete:()=>{jb(l),t.complete()}})}catch(e){throw jb(l),e}return()=>{jb(l),n&&n.unsubscribe()}}))}))}function Ub(e){Ob.destroy(e)}function $b(e,t=void 0,n=!1){const i=new Map,a=new Map;if(!e)throw new Error("Need an operation name to support");return new XC.C(((o,r)=>{if(!((e,t)=>{const{query:n}=e,i=(0,wC.Vn)(n);if(!i||"OperationDefinition"!==i.kind)return!1;const{selectionSet:{selections:a}}=i,{operation:o}=(0,wS.A)(n,null);if("subscription"!==o)return!1;if(a.length>1)throw new Error("There cannot be more than 1 selection for this link");const r=a[0];if("Field"===r.kind&&r.name.value===t){if(r.arguments.every((({name:e,value:t})=>"Variable"!==t.kind||t.name.value===e.value)))return!0;throw new Error("Argument name must match value")}return!1})(o,e))return r(o);const s=(e=>{const t=e.getContext(),n=JSON.stringify(Object.keys(e.variables).sort().map((t=>{const n=e.variables[t];if(-1!==["boolean","string"].indexOf(typeof n)||null===n||Number.isSafeInteger(n))return[t,n];throw new Error("Unsupported argument type")})));return t.windowId?`${e.operationName}.${n}.${t.windowId}`:`${e.operationName}.${n}`})(o);return new lb.c((e=>{const l=i.get(s);if(l)l.observersCollection.push(e),n&&a.has(s)&&e.next(a.get(s));else{let l="";if(t&&t.get(c.w.Calling).enableSubscriptionCancellationListener){l=(0,E.v4)();const e=Ob.register(l);o.setContext((t=>({...t,cancellationListener:e})))}try{const t=r(o).subscribe({next:e=>{n&&a.set(s,e);const t=i.get(s);if(void 0===t)return;t.observersCollection.slice().forEach((t=>{t.next(e)}))},error:e=>{const t=i.get(s);if(void 0!==t){i.delete(s);for(const n of t.observersCollection)n.error(e)}},complete:()=>{const e=i.get(s);if(void 0!==e){i.delete(s);for(const t of e.observersCollection)t.complete()}}});i.set(s,{observersCollection:[e],forwardSubscription:t,requestId:l})}catch(e){throw null!==l&&""!==l&&Ub(l),e}}return()=>{const t=i.get(s);if(!t)return;const{observersCollection:n,forwardSubscription:o,requestId:r}=t,l=n.indexOf(e);-1!==l&&(n.splice(l,1),0===n.length&&(i.delete(s),a.delete(s),null!==r&&""!==r&&Ub(r),o&&o.unsubscribe()))}}))}))}function Wb(e,t){return function(e){const t=e();return new XC.C(((e,n)=>{const i=t.then((t=>t.request(e,n)));return new lb.c((e=>{let t;return i.then((n=>{e.closed||(t=n?.subscribe(e))}),(t=>{e.closed||e.error(t)})),()=>t?.unsubscribe()}))}))}((async()=>(await(0,ev.wg)((()=>Promise.all([n.e(197373),n.e(359477),n.e(395394),n.e(675332),n.e(463638)]).then(n.bind(n,137434))),"supermassive-incremental-link",t)).supermassiveIncrementalSchemaLink(e,t)))}var Vb=n(560266),Hb=n(186410);function zb(e,t,n,i,a){let o=`Uncaught error in a GraphQL resolver for operation "${e}"`;a&&(o=`${o}, at field selection path "${a}"`),!n&&t.errorToTelemetry&&t.errorToTelemetry(o,"cdl_links_data_client_core",void 0,!0),t.error(`${o} - ${i}`)}const qb=(e,t,n)=>(0,Hb.S)((({graphQLErrors:i,operation:a})=>{const o=e.newLogger(t,"data-client-core");if(i){(({graphQLErrors:e,operationName:t,logger:n,disableTelemetryLogging:i})=>{e&&0!==e.length&&("string"!=typeof e?e.forEach((e=>zb(t,n,i,JSON.stringify(e),e.path?e.path.map((e=>"number"==typeof e?`[${e.toString()}]`:`${e}`)).join("."):void 0))):zb(t,n,i,e))})({graphQLErrors:i,operationName:a.operationName,logger:o,disableTelemetryLogging:n})}}));var Gb=n(959022);class Yb{static async createSingletonLink(e){if(Yb._singletonLink)throw new Error("Links are already created");return Yb._singletonLink=XC.C.from(await Yb.createDefaultLinks(e)),Yb._singletonLink}static async createLink(e){return XC.C.from(await Yb.createDefaultLinks(e))}static get singletonLink(){return Yb._singletonLink}static createViewSchemaLink(e){this._viewSchemaImportPromise||(this._viewSchemaImportPromise=Promise.all([n.e(197373),n.e(359477),n.e(770485),n.e(751879),n.e(610984)]).then(n.bind(n,904206)));const t=!!e.coreSettings.get(c.w.Core).disableGraphQLErrorTelemetry;return XC.C.from([qb(e.loggerFactory,"viewSchema_resolverUncaughtErrorBoundary__doNotAssignToGraphQLTeam",t),this.createLazyViewSchemaTerminatingLink(e,this._viewSchemaImportPromise)])}static createLazyViewSchemaTerminatingLink(e,t){let n;return this._viewSchemaImport&&this._viewSchemaExecutor?this._viewSchemaImport.createViewSchemaTerminatingLink(e,this._viewSchemaExecutor):new XC.C(((i,a)=>new lb.c((o=>{let r,s=!1;return t.then((t=>{if(!this._viewSchemaExecutor){const{graphQLTelemetry:n}=e.coreSettings.get(c.w.Core);this._viewSchemaExecutor=new t.ViewSchemaExecutor(n?.execution??void 0)}return this._viewSchemaImport||(this._viewSchemaImport=t),n||(n=t.createViewSchemaTerminatingLink(e,this._viewSchemaExecutor)),n})).then((e=>{s||(r=e.request(i,a)?.subscribe({next:o.next.bind(o),error:o.error.bind(o),complete:o.complete.bind(o)}))})).catch(o.error.bind(o)),()=>{s=!0,r&&r.unsubscribe()}}))))}static createPatchVariablesLink(e,t=[]){return _b({contextValue:e,resolvers:t})}static async createTerminatingLink({config:e,contextValue:t,cdlWorkerService:n,loggerFactory:i,scenarioFactory:a,coreSettings:o},r){const{enableClassBasedErrors:s,graphQLTelemetry:l}=o.get(c.w.Core),d=a.findScenario(be.Cu.GraphQLCreateDataClient),u={contextValue:t,enableClassBasedErrors:!!s,telemetryOptions:l?.execution},m=performance.now(),p=Wb(u,a);d?.appendEventData({graphQLSupermassiveIncrementalLinkTimeToStart:performance.now()-m});let g=p;if((0,Xy.ZG)(o)&&!r){const t=i.newLogger("createCDLWorkerTerminatingLink","data-client-core"),r=performance.now();g=await Yb.createCDLWorkerTerminatingLink(n,e,i,a,o,t,g),d?.appendEventData({graphQLCDLTerminatingLinkTimeToStart:performance.now()-r})}return g}static createDataLayerClientSettings(e){const{cdlSubscriptionAggregatorAllowList:t,loggableOperationVariablesAllowList:n,cdlSubscriptionAggregatorLogIntervalMS:i}=e.get(c.w.CdlWorker);return{cdlSubscriptionAggregatorAllowList:t||void 0,loggableOperationVariablesAllowList:n||void 0,cdlSubscriptionAggregatorLogIntervalMS:i||void 0}}static async createCDLWorkerTerminatingLink(e,t,n,i,a,o,r){const{failAllGraphQLIfCDLFailed:s}=a.get(c.w.Core);if(!e)return o.warnToTelemetry?.("Not creating CDL Worker terminating link. Worker is enabled, but service is unavailable.","cdl_links_data_client_core",void 0,!0),s?this.createCDLHaveFailedTerminatingLink(o):r;const l=await e.getCDLWorkerManager();if(!l)return o.warnToTelemetry?.("Not creating CDL Worker terminating link. Worker is enabled, service is available but workerManager is not defined.","cdl_links_data_client_core",void 0,!0),s?this.createCDLHaveFailedTerminatingLink(o):r;const{enableBatchedCDLUpdates:d}=a.get(c.w.Core),u=d?e=>Gb.unstable_batchedUpdates(e):void 0,m=Ab(await e.getDataLayerClient(u));if(!l.cdlWorkerSupportedResolvers&&(o.errorToTelemetry?.("CDL link is configured but will not accept any operations. Worker is enabled, service is available, but workerManager.cdlWorkerSupportedResolvers is undefined.","cdl_links_data_client_core",void 0,!0),s))return this.createCDLHaveFailedTerminatingLink(o);const{disableEnhancedLinkDebugging:p}=a.get(c.w.Core),g=(0,Vb.UB)(a,o,l.cdlWorkerSupportedResolvers,!!p),{enableDirectiveCheck:h}=a.get(c.w.Core);return r=XC.C.split((e=>function(e,t,n,i){return Qb(e,t,n,i,"CDLWorker")}(e,g,n,!!h)),m,r),a.get(c.w.CdlWorker).enableControlPlaneLink&&(r=await Yb.createCDLWorkerControlPlaneTerminatingLink(e,t,n,i,r,a)),r}static async createCDLWorkerControlPlaneTerminatingLink(e,t,n,i,a,o){const r=await e.getControlPlaneCommunicator(),s=Ab(new IS(t.clientId,n,i,r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.createDataLayerClientSettings(o),void 0)),{enableDirectiveCheck:l}=o.get(c.w.Core);return a=XC.C.split((e=>function(e,t,n){return Qb(e,Eb,t,n,"CDLWorkerControl")}(e,n,!!l)),s,a),a}static createCDLHaveFailedTerminatingLink(e){return new XC.C((t=>(e.warnToTelemetry?.(`Recieved an operation "${t}", when CDL has not booted successfully or haven't recieved a valid CDL resolver map.`,"cdl_links_data_client_core",void 0,!0),new lb.c((e=>{e.next({errors:[new Db.e("CDL has not booted successfully.")]}),e.complete()})))))}}function Qb(e,t,n,i,a){if(!t||0===Object.keys(t).length)return!1;const o=e.query,r=(0,wC.Vu)(o);if(!r)throw new Error(`Expected a parsed GraphQL document with a query, mutation, or subscription operation. Got: ${JSON.stringify(o)}`);const s=r.operation,l=function(e,t){const n=Jb(e,t.selectionSet);if(0===n.length)throw new Error(`Expected a GraphQL operation with root-field selections. Got: ${JSON.stringify(e)}`);return n}(o,r);let c=!1;return l.every((o=>!(!i||function(e,t){if(!e.directives||0===e.directives.length||!t)return!0;const n=e.directives.find((e=>"skip"===e.name.value));if(n)return!Kb(n,t);const i=e.directives.find((e=>"include"===e.name.value));if(i)return Kb(i,t);return!0}(o,e.variables))||!!function(e,t,n,i,a,o,r){const s=e[n];if(!s){const e=r.newLogger("isDataLayerClientOperationSupported","data-client-core");return e.errorToTelemetry?.(`Missing operation type '${n}' for ${a} when looking for '${t}' for operation '${o}'`,"cdl_links_data_client_core",void 0,!0),!1}return s instanceof Set?function(e,t,n,i,a,o){if(e.has(t))return!0;if(n){const e=o.newLogger("isDataLayerClientOperationSupported","data-client-core");e.errorToTelemetry?.(`Unexpected partially supported operation for '${i}' for operation '${a}' - unsupported selection = ${t}`,"cdl_links_data_client_core",void 0,!0)}return!1}(s,t,i,a,o,r):function(e,t,n,i,a,o){if(e[t]){const r=e[t];if(r.active)return!0;if(n){const e=o.newLogger("isDataLayerClientOperationSupported","data-client-core");e.errorToTelemetry?.(`Unexpected partially supported operation for '${i}' for operation '${a}' - unsupported selection= ${t}, found only in '${r.configurationDescription}'`,"cdl_links_data_client_core",void 0,!0)}}else if(n){const e=o.newLogger("isDataLayerClientOperationSupported","data-client-core");e.errorToTelemetry?.(`Unexpected partially supported operation for '${i}' for operation '${a}' - unsupported selection = ${t} not found in any source`,"cdl_links_data_client_core",void 0,!0)}return!1}(s,t,i,a,o,r)}(t,o.name.value,s,c,a,e.operationName,n)&&(c=!0,!0)))}function Jb(e,t){return t.selections.reduce(((t,n)=>{switch(n.kind){case"Field":t.push(n);break;case"FragmentSpread":const i=e.definitions.find((e=>"FragmentDefinition"===e.kind&&e.name.value===n.name.value));if(!i)throw new Error(`Fragment ${n.name.value} not found in document`);n=i;case"InlineFragment":t.push(...Jb(e,n.selectionSet))}return t}),[])}function Kb(e,t){const n=e.arguments?.find((e=>"if"===e.name.value));if(!n)return!1;if("Variable"===n.value.kind){const e=n.value.name.value;if(t.hasOwnProperty(e))return!!t[e]}return!1}Yb._singletonLink=null,Yb._viewSchemaExecutor=null,Yb.createDefaultLinks=async e=>{const{contextValue:t,loggerFactory:n,scenarioFactory:i,coreSettings:a,noCDLTerminatingLink:o,UNSAFE_resolvers:r}=e,s=await Yb.createTerminatingLink(e,o),l=Yb.createPatchVariablesLink(t,r),d=a.get(c.w.Core).enableGraphQlOpsCount,u=a.get(c.w.Core).enableTrackRequestsLink,m=d||u?[Lb(n,i,d,u,t.graphqlOpsCountService)]:[],p=a.get(c.w.Calling).enableSubscriptionCancellationListener?[Bb(n,a)]:[],g=$b("presenceUpdateEvent",a,!0),h=$b("callParticipantUpdatedEvent",a),v=$b("callParticipantsChangedEvent",a),y=$b("callParticipantsVoiceLevelsChangedEvent",a),S=$b("chatServiceEvent",a),f=$b("blockedContactChangedEvent",a,!0),k=!!a.get(c.w.Core).disableGraphQLErrorTelemetry;return[...m,...p,l,qb(n,"resolverUncaughtErrorBoundary__doNotAssignToGraphQLTeam",k),g,h,v,y,S,f,s]};var Zb=n(657886);const Xb=()=>(0,Zb.NB)(["filter","typeFilter"]),ew=()=>(0,Zb.NB)(["filter","typeFilter"]);function tw(e,t){return t("timestamp",e||{})||""}const nw=()=>{const{read:e,merge:t,...n}=(0,Zb.NB)(!1);return{...n,keyArgs:["filters"],merge:(e,n,i)=>{if("function"==typeof t){const a=t(e,n,i),{readField:o,mergeObjects:r}=i;let s=(0,we.uniqBy)(a.edges,(e=>o("id",e.node)));const l=[];s=s.filter((e=>{const t=o("deleteTime",e.node);return t&&l.push(o("id",e.node)??""),!t}));const c=o("deletedActivityInfo",a),d=r(c??{},{id:o("id",c),deletedActivityIds:(0,we.uniq)([...o("deletedActivityIds",c)??[],...l])});return{...a,edges:s,deletedActivityInfo:d,pageInfo:{...a?.pageInfo,startCursor:o("timestamp",(0,we.head)(s)?.node),endCursor:o("timestamp",(0,we.last)(s)?.node)}}}return t},read:(...t)=>{const n=t[0],{readField:i}=t[1];if(!n||!e)return;if(!n.edges)return n;const a=[...n.edges].sort(((e,t)=>function(e,t,n){const i=e?.node,a=t?.node,o=tw(i,n),r=tw(a,n);return o?r?parseInt(r,10)-parseInt(o,10):-1:1}(e,t,i)));return{...e(...t),edges:a}}}};const iw=()=>{const{merge:e,...t}=(0,Zb.NB)(!1);return{...t,merge:(t,n,i)=>{if(aw(e)){if(!t)return n;const{readField:a}=i,o=e(t,n,i),r="objectId",s=(0,we.uniqBy)(o.edges,(e=>a(r,e.node)));return{...o,edges:s,pageInfo:{...o.pageInfo}}}return e}}},aw=e=>"function"==typeof e,ow=e=>{const t=ub.Query||{fields:{}};return{...ub,...e,Query:{...t,fields:{...t.fields,chats:Xb(),recentsChats:Xb(),pinnedChats:Xb(),activities:nw(),suggestedContactsInChatList:ew(),frequentlyUsedContacts:ew(),replyChainMessages:{...(0,Zb.NB)(["channelId","replychainId"]),read:e=>e,merge:(e,t)=>t},replyChainSummaries:{...(0,Zb.NB)(["channelId"]),read:e=>e,merge:(e,t)=>t},fluidMessages:{merge:(e,t)=>[...t]},feed:{merge:!0},calendarEventsV3WithPagination:iw(),pinnedChannels:{merge:!1}}}}},rw=e=>"cache-and-network"===e||"network-only"===e?"cache-first":e;class sw extends Sb{constructor(e,t,n,i,a){super(e,t,n({windowId:i.windowId,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:`mtma-window-${i?.authenticationUser?.id||"nouser"}-${i.windowId}`,storeType:a}),i,i.windowId,a)}get relayEnvironment(){return this.parent.relayEnvironment}get parentQueries(){return FC}get parentSubscriptions(){return MC}get parentMutations(){return DC}get className(){return"MTMAWindowDataClient"}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}clone(e){throw new Error("Trying to clone child instance")}}class lw extends vb{constructor(e,t,n,i,a){super(e,n,t({windowId:n.windowId||d.N2,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"mtma-core",storeType:GC.J.mtmaCore}),n.windowId||d.N2,GC.J.mtmaCore,a),this.createApolloClient=t,this.viewSchemaClient=null,i&&(this.viewSchemaClient=i({windowId:n.windowId||d.N2,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"mtma-core-viewSchema",storeType:GC.J.viewSchema}),this.registerClient(this.viewSchemaClient))}get clientName(){return"mtma-core"}clone(e){return e.windowId===d.N2?new kb(this.getServices(),this.client,{...this.ctx,...e},this.storeType,this):new sw(this.getServices(),this,this.createApolloClient,{...this.ctx,...e},GC.J.mtmaWindow)}cloneForViewSchema(e){return wb()(this.viewSchemaClient,"View schema must be avaliable"),new Cb(this.getServices(),this.viewSchemaClient,{...this.ctx,...e},GC.J.viewSchema)}async disposeClients(e){await Promise.all([super.disposeClients(e),(async()=>{this.viewSchemaClient&&(await this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})()])}}class cw extends Sb{constructor(e,t,n,i,a,o){const r=`${i.authenticationUser?.id||"nouser"}-${i.windowId}`,s=`mtma-user-${r}`;super(e,t,n({windowId:i.windowId||d.N2,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:s,storeType:GC.J.mtmaUser}),i,i.windowId||d.N2,GC.J.mtmaUser,o),this.createApolloClient=n,this.viewSchemaClient=null,a&&(this.viewSchemaClient=a({windowId:i.windowId||d.N2,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:`mtma-user-viewSchema-${r}`,storeType:GC.J.viewSchema}),this.registerClient(this.viewSchemaClient))}get clientName(){return`mtma-user-${this.ctx?.authenticationUser?.id||"nouser"}-${this.ctx?.windowId}`}get parentQueries(){return EC}get parentSubscriptions(){return PC}get parentMutations(){return _C}get className(){return"MTMAUserDataClient"}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}clone(e){return new sw(this.getServices(),this,this.createApolloClient,{...this.ctx,...e},GC.J.mtmaWindow)}cloneForViewSchema(e){return wb()(this.viewSchemaClient,"View schema must be available"),new Cb(this.getServices(),this.viewSchemaClient,{...this.ctx,...e},GC.J.viewSchema)}async disposeClients(e){await Promise.all([super.disposeClients(e),(async()=>{this.viewSchemaClient&&(await this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})()])}}class dw{constructor(){this._cache=new Map,this.getOrCreateServiceInstance=(e,t)=>{let n;return this._cache.has(e)?n=this._cache.get(e):(n=t(),this._cache.set(e,n)),n},this.clear=()=>{this._cache.clear()}}}const uw=new dw,mw=uw.getOrCreateServiceInstance;var pw,gw;!function(e){e.AddressService="AddressService",e.AiInsightsFeedbackService="AiInsightsFeedbackService",e.AiInsightsSdsService="AiInsightsSdsService",e.AppBasedLinkService="AppBasedLinkService",e.AppsPlatformService="AppsPlatformService",e.AppsStoreService="AppsStoreService",e.AppSuggestionsService="AppSuggestionsService",e.AsyncMediaService="AsyncMediaService",e.AtpSafelinksService="AtpSafelinksService",e.AugloopService="AugloopService",e.SubstrateBotPlatformService="SubstrateBotPlatformService",e.ComposeAugloopService="ComposeAugloopService",e.AzureMapsService="AzureMapsService",e.BadgeCountService="BadgeCountService",e.BiometricEnrollmentService="BiometricEnrollmentService",e.BiometricFaceEnrollmentService="BiometricFaceEnrollmentService",e.BotsPlatformService="BotsPlatformService",e.BrbService="BrbService",e.BreakoutRoomMiddleTierService="BreakoutRoomMiddleTierService",e.BroadcastAttendeeService="BroadcastAttendeeService",e.BroadcastCaptionsService="BroadcastCaptionsService",e.BroadcastSignalRService="BroadcastSignalRService",e.BroadcastStreamingAttendeeService="BroadcastStreamingAttendeeService",e.CalendarService="CalendarService",e.CallBlockingService="CallBlockingService",e.CallingAnonymousDisplayNameService="CallingAnonymousDisplayNameService",e.CallingAppEventsService="CallingAppEventsService",e.CallingBannerServiceAdapter="CallingBannerServiceAdapter",e.CallingDialogServiceAdapter="CallingDialogServiceAdapter",e.CallingNotificationServiceAdapter="CallingNotificationServiceAdapter",e.CallingService="CallingService",e.CallingConversationService="CallingConversationService",e.CallRecordingService="CallRecordingService",e.CaptchaService="CaptchaService",e.ChatService="ChatService",e.ChatServiceEndpointProvider="ChatServiceEndpointProvider",e.CloudStorageFoldersService="CloudStorageFoldersService",e.CmdMeetingIntelligenceService="CmdMeetingIntelligenceService",e.CollabCloudService="CollabCloudService",e.CollabObjectService="CollabObjectService",e.CommonSubstrateService="CommonSubstrateService",e.CommunitySettingsService="CommunitySettingsService",e.ConnectedAccountsService="ConnectedAccountsService",e.ConnectedCalendarSettingsService="ConnectedCalendarSettingsService",e.ConsumerGroupsService="ConsumerGroupsService",e.CustomCopilotBotService="CustomCopilotBotService",e.CSAService="CSAService",e.DeveloperSwitchersService="DeveloperSwitchersService",e.DiscoverSurfaceFeedbackService="DiscoverSurfaceFeedbackService",e.DiscoverSurfaceService="DiscoverSurfaceService",e.DistributionListService="DistributionListService",e.DriveItemShareService="DriveItemShareService",e.DynamicsMarketingService="DynamicsMarketingService",e.DynamicsVirtualEventsService="DynamicsVirtualEventsService",e.EmoticonService="EmoticonService",e.EspService="EspService",e.ExampleService="ExampleService",e.ExternalAccountsResponseService="ExternalAccountsResponseService",e.ExternalAccountsService="ExternalAccountsService",e.ExternalCalendarEmailAddressService="ExternalCalendarEmailAddressService",e.FileDownloadManagerService="FileDownloadManagerService",e.FilesBackfillThreadPropertiesService="FilesBackfillThreadPropertiesService",e.FilesRedeemService="FilesRedeemService",e.FilesReferenceService="FilesReferenceService",e.FilesSharepointUrlService="FilesSharepointUrlService",e.FilesValidDomainsService="FilesValidDomainsService",e.FilesSiteResourceInfoService="FilesSiteResourceInfoService",e.FileUploadPreviewService="FileUploadPreviewService",e.FileUploadService="FileUploadService",e.FloodgateService="FloodgateService",e.FluidService="FluidService",e.GalleryService="GalleryService",e.GiphyService="GiphyService",e.GoogleCalendarAuthenticationService="GoogleCalendarAuthenticationService",e.GoogleContactsAuthenticationService="GoogleContactsAuthenticationService",e.GuardiansService="GuardiansService",e.HealthScenarioService="HealthScenarioService",e.ImageProxyService="ImageProxyService",e.ImmersiveReaderService="ImmersiveReaderService",e.ImpersonationDetectionService="ImpersonationDetectionService",e.ImplicitContactsService="ImplicitContactsService",e.ImportMsaContactsService="ImportMsaContactsService",e.InstantAnswersService="InstantAnswersService",e.InviteLinksService="InviteLinksService",e.ItemDeleteService="ItemDeleteService",e.ItemDetailsService="ItemDetailsService",e.ItemUploadService="ItemUploadService",e.LiveStateBroadcastService="LiveStateBroadcastService",e.LiveStreamRenderingService="LiveStreamRenderingService",e.LmsIntegrationService="LmsIntegrationService",e.LockedTeamsService="LockedTeamsService",e.LogsFilesService="LogsFilesService",e.LiveMeetingStatusBarEventsService="LiveMeetingStatusBarEventsService",e.LokiMetaPreviewService="LokiMetaPreviewService",e.LokiService="LokiService",e.ManageTenantService="ManageTenantService",e.MeetingArtifactsService="MeetingArtifactsService",e.MeetingBotService="MeetingBotService",e.MeetingIntelligenceService="MeetingIntelligenceService",e.MeetingOptionsClientDataService="MeetingOptionsClientDataService",e.MeetingOptionsService="MeetingOptionsService",e.MeetingQuestionsAndAnswersService="MeetingQuestionsAndAnswersService",e.MeetingRecapService="MeetingRecapService",e.MeetingRecapWorkingSetFilesService="MeetingRecapWorkingSetFilesService",e.MeetingRecapSwaService="MeetingRecapSwaService",e.MeetingRoomAppEventsService="MeetingRoomAppEventsService",e.MeetingTemplateService="MeetingTemplateService",e.MonetizationService="MonetizationService",e.MRUItemService="MRUItemService",e.MsaAuthenticationService="MsaAuthenticationService",e.MyUserPreferencesStore="MyUserPreferencesStore",e.OdcFilePreviewService="OdcFilePreviewService",e.OdsService="OdcService",e.OrganizationInfoService="OrganizationInfoService",e.OSearchService="OSearchService",e.PaymentsService="PaymentsService",e.PeoplePickerService="PeoplePickerService",e.PeopleSearchService="PeopleSearchService",e.PeopleService="PeopleService",e.PeopleTargetingService="PeopleTargetingService",e.PersonalFileDetailsService="PersonalFileDetailsService",e.PetrolService="PetrolService",e.PoliciesService="PoliciesService",e.PresenceService="PresenceService",e.QueuesHistoricReportingService="QueuesHistoricReportingService",e.ODSLProcessingEngine="ODSLProcessingEngine",e.PstnService="PstnService",e.RefreshSiteUrlService="RefreshSiteUrlService",e.ReportConcernService="ReportConcernService",e.SCISService="SCISService",e.SearchPrefetchService="SearchPrefetchService",e.SensitivityLabelPolicySettingsService="SensitivityLabelPolicySettingsService",e.SharepointRestClient="SharepointRestClient",e.SharepointShareService="SharepointShareService",e.ShareService="ShareService",e.SignalsService="SignalsService",e.SmbUserIntentService="SmbUserIntentService",e.StatefulLongPoll="StatefulLongPoll",e.StoreDevicesService="StoreDevicesService",e.StoreService="StoreService",e.StyleMyRoomService="StyleMyRoomService",e.SubstrateFilesSearchService="SubstrateFilesSearchService",e.SubstrateMeetingRecommendationsService="SubstrateMeetingRecommendationsService",e.SubstrateMeetingSearchService="SubstrateMeetingSearchService",e.SubstrateMeetingSummarySearchService="SubstrateMeetingSummarySearchService",e.SubstrateRecommendationsService="SubstrateRecommendationsService",e.SubstrateSearchService="SubstrateSearchService",e.SubstrateSearchServiceV2="SubstrateSearchServiceV2",e.SubstrateSuggestionsService="SubstrateSuggestionsService",e.TargetingHierarchyService="TargetingHierarchyService",e.TeamCalendarService="TeamCalendarService",e.TeamsCopilotAggregator="TeamsCopilotAggregator",e.TeamsCopilotService="TeamsCopilotService",e.TeamsAndChannelsService="TeamsAndChannelsService",e.TenantAnalyticsService="TenantAnalyticsService",e.TenantMembershipService="TenantMembershipService",e.TenantPrivacyProfileService="TenantPrivacyProfileService",e.TenantService="TenantService",e.TFLUserService="TFLUserService",e.ThirdPartyCalendarService="ThirdPartyCalendarService",e.ToastImageService="ToastImageService",e.TpnNoticeService="TpnNoticeService",e.TranscriptFeedbackService="TranscriptFeedbackService",e.TranscriptService="TranscriptService",e.TranscriptSettingsStoreService="TranscriptSettingsStoreService",e.TranslateService="TranslateService",e.UnifiedConsentService="UnifiedConsentService",e.UrlPreviewService="UrlPreviewService",e.UserLicenseService="UserLicenseService",e.UserProfileService="UserProfileService",e.VideoMessageCameraCommandService="VideoMessageCameraCommandService",e.VideoFileService="VideoFileService",e.VideoMessageUploadService="VideoMessageUploadService",e.VirtualEventsService="VirtualEventsService",e.MeetingSchedulingService="MeetingSchedulingService",e.VoicemailService="VoicemailService",e.WebinarService="WebinarService",e.WaffleService="WaffleService"}(pw||(pw={})),function(e){e.ExampleGlobalService="ExampleGlobalService",e.GlobalCallingService="GlobalCallingService",e.GlobalTaskbarService="GlobalTaskbarService",e.MTMAUserDataService="MTMAUserDataService",e.WebAppSwitcherService="WebAppSwitcherService"}(gw||(gw={}));const hw=(e,t)=>n=>(0,ev.wg)(e,t,n),vw=()=>Promise.all([n.e(566555),n.e(169691),n.e(234199),n.e(291363),n.e(94139),n.e(712315),n.e(725236),n.e(816373),n.e(183153),n.e(654005),n.e(381242),n.e(889503)]).then(n.bind(n,619936)),yw=hw((()=>n.e(131092).then(n.bind(n,52739))),"services-app-based-link"),Sw=hw((()=>n.e(999480).then(n.bind(n,492300))),"services-apps-platform"),fw=hw((()=>Promise.all([n.e(746112),n.e(478883),n.e(259717)]).then(n.bind(n,838223))),"services-store-apps"),kw=hw((()=>n.e(23021).then(n.bind(n,785929))),"services-app-suggestions"),Cw=hw((()=>n.e(407500).then(n.bind(n,127249))),"services-atp-safelinks"),bw=hw((()=>n.e(728415).then(n.bind(n,485619))),"services-async-media"),ww=hw((()=>Promise.all([n.e(485986),n.e(791875),n.e(826023)]).then(n.bind(n,932535))),"services-augloop"),Tw=hw((()=>n.e(447607).then(n.bind(n,458789))),"services-substrate-bot-platform"),Iw=hw((()=>Promise.all([n.e(405621),n.e(830642)]).then(n.bind(n,441296))),"services-azure-maps"),Nw=hw((()=>Promise.all([n.e(615385),n.e(577639)]).then(n.bind(n,263154))),"services-biometric-enrollment"),Aw=hw((()=>n.e(520430).then(n.bind(n,173565))),"services-bots-platform"),Ew=hw((()=>n.e(447686).then(n.bind(n,988219))),"services-brb"),Fw=hw((()=>n.e(370212).then(n.bind(n,11115))),"services-breakout-rooms"),_w=hw((()=>n.e(467374).then(n.bind(n,90238))),"services-transcript"),Dw=hw((()=>n.e(484920).then(n.bind(n,371416))),"services-transcript-setting-store"),Pw=hw((()=>n.e(467374).then(n.bind(n,90238))),"services-transcript-feedback"),Mw=hw((()=>n.e(351239).then(n.bind(n,908456))),"services-ai-insights-feedback"),Rw=hw((()=>n.e(351239).then(n.bind(n,908456))),"services-ai-insights-sds"),xw=hw((()=>n.e(754734).then(n.bind(n,315746))),"services-style-my-room"),Lw=hw((()=>n.e(221676).then(n.bind(n,24495))),"services-broadcast-attendee"),Ow=hw((()=>n.e(117133).then(n.bind(n,732731))),"services-broadcast-streaming-attendee"),jw=hw((()=>n.e(761631).then(n.bind(n,738561))),"services-broadcast-captions"),Bw=hw((()=>Promise.all([n.e(183153),n.e(713560)]).then(n.bind(n,293876))),"services-broadcast-signalr"),Uw=hw((()=>Promise.all([n.e(359344),n.e(558535),n.e(289131)]).then(n.bind(n,630141))),"services-io-calendar"),$w=hw((()=>n.e(52338).then(n.bind(n,384675))),"services-chat-endpoint-provider"),Ww=hw((()=>Promise.all([n.e(302851),n.e(451098)]).then(n.bind(n,108855))),"services-chat"),Vw=hw((()=>Promise.all([n.e(302851),n.e(451098)]).then(n.bind(n,108855))),"services-calling-conversation"),Hw=hw((()=>n.e(792561).then(n.bind(n,849489))),"services-report-concern"),zw=(hw((()=>Promise.all([n.e(566555),n.e(169691),n.e(291363),n.e(94139),n.e(712315),n.e(725236),n.e(816373),n.e(183153),n.e(361293),n.e(654005),n.e(920688)]).then(n.bind(n,568177))),"services-calling"),hw((()=>n.e(590820).then(n.bind(n,975924))),"services-cmd-meeting-intelligence")),qw=hw((()=>n.e(929073).then(n.bind(n,777291))),"services-collab-object"),Gw=hw((()=>n.e(489143).then(n.bind(n,260308))),"services-community-settings"),Yw=hw((()=>n.e(484762).then(n.bind(n,905569))),"services-connected-accounts"),Qw=hw((()=>n.e(595433).then(n.bind(n,168577))),"services-io-connected-calendar"),Jw=hw((()=>n.e(954327).then(n.bind(n,671172))),"services-io-custom-copilot-bot"),Kw=hw((()=>Promise.all([n.e(746112),n.e(248701),n.e(814253)]).then(n.bind(n,8320))),"services-store-devices"),Zw=hw((()=>n.e(627123).then(n.bind(n,80672))),"services-distribution-list"),Xw=hw((()=>n.e(495593).then(n.bind(n,856002))),"services-dynamics-marketing"),eT=hw((()=>n.e(447166).then(n.bind(n,626750))),"services-dynamics-virtual-events"),tT=hw((()=>n.e(323712).then(n.bind(n,295827))),"services-emoticon"),nT=hw((()=>n.e(57452).then(n.bind(n,432405))),"services-esp"),iT=hw((()=>n.e(826522).then(n.bind(n,29623))),"services-external-accounts"),aT=hw((()=>n.e(578102).then(n.bind(n,772182))),"services-external-accounts-response"),oT=hw((()=>n.e(215360).then(n.bind(n,147108))),"services-external-calendar-email-address"),rT=hw((()=>n.e(988453).then(n.bind(n,145222))),"services-files"),sT=hw((()=>n.e(294080).then(n.bind(n,286839))),"services-file-upload"),lT=hw((()=>n.e(317125).then(n.bind(n,437990))),"services-file-download-manager"),cT=hw((()=>n.e(624880).then(n.bind(n,862169))),"services-fluid"),dT=hw((()=>n.e(843490).then(n.bind(n,132009))),"services-gallery"),uT=hw((()=>n.e(884917).then(n.bind(n,236439))),"services-giphy"),mT=hw((()=>n.e(828028).then(n.bind(n,721584))),"services-global-taskbar"),pT=hw((()=>n.e(930465).then(n.bind(n,437277))),"services-google-calendar-authentication"),gT=hw((()=>n.e(930465).then(n.bind(n,437277))),"services-google-contacts-authentication"),hT=hw((()=>n.e(827864).then(n.bind(n,286860))),"services-image-proxy"),vT=hw((()=>n.e(290502).then(n.bind(n,826340))),"immersive-reader-service"),yT=hw((()=>n.e(959197).then(n.bind(n,302927))),"services-import-msa-contacts"),ST=hw((()=>n.e(375453).then(n.bind(n,801856))),"services-instant-answers"),fT=hw((()=>n.e(587919).then(n.bind(n,74707))),"services-invite-links"),kT=hw((()=>n.e(161421).then(n.bind(n,820017))),"services-live-meeting-status-bar-events"),CT=hw((()=>Promise.all([n.e(300466),n.e(625442),n.e(708272)]).then(n.bind(n,543587))),"services-live-state-broadcast"),bT=hw((()=>Promise.all([n.e(712315),n.e(432148),n.e(583674),n.e(830901),n.e(746253)]).then(n.bind(n,358253))),"services-live-stream-renderer"),wT=hw((()=>n.e(941525).then(n.bind(n,794959))),"services-lms-integration"),TT=hw((()=>n.e(219199).then(n.bind(n,598575))),"services-tenant-analytics"),IT=hw((()=>n.e(354919).then(n.bind(n,357419))),"services-loki"),NT=hw((()=>n.e(312087).then(n.bind(n,149160))),"services-discover-surface"),AT=hw((()=>n.e(530197).then(n.bind(n,707754))),"services-discover-surface-feedback"),ET=hw((()=>n.e(963016).then(n.bind(n,639665))),"services-guardians"),FT=hw((()=>n.e(753514).then(n.bind(n,66143))),"services-health"),_T=hw((()=>n.e(559571).then(n.bind(n,292675))),"services-locked-teams"),DT=hw((()=>n.e(12207).then(n.bind(n,770862))),"services-logs-files"),PT=hw((()=>n.e(315810).then(n.bind(n,553659))),"services-manage-tenant"),MT=hw((()=>n.e(255837).then(n.bind(n,285967))),"services-meeting-artifacts"),RT=hw((()=>n.e(486057).then(n.bind(n,960578))),"services-meeting-intelligence"),xT=hw((()=>Promise.all([n.e(829145),n.e(504233)]).then(n.bind(n,871515))),"services-meeting-recap"),LT=hw((()=>Promise.all([n.e(937922),n.e(892214)]).then(n.bind(n,609151))),"services-meeting-options"),OT=hw((()=>Promise.all([n.e(829145),n.e(393652)]).then(n.bind(n,790914))),"services-meeting-recap-swa"),jT=hw((()=>Promise.all([n.e(816373),n.e(259315),n.e(30166)]).then(n.bind(n,619431))),"services-meeting-recap-working-set-files"),BT=hw((()=>Promise.all([n.e(937922),n.e(443373)]).then(n.bind(n,838819))),"services-meeting-templates"),UT=hw((()=>n.e(113454).then(n.bind(n,148875))),"services-msa-authentication"),$T=hw((()=>n.e(136417).then(n.bind(n,762908))),"services-people"),WT=(hw((()=>n.e(427858).then(n.bind(n,962916))),"services-viva-insights"),hw((()=>n.e(915248).then(n.bind(n,709648))),"services-people-picker")),VT=hw((()=>Promise.all([n.e(302851),n.e(914543)]).then(n.bind(n,173092))),"services-people-targeting"),HT=hw((()=>n.e(488250).then(n.bind(n,316896))),"services-files-personal"),zT=hw((()=>n.e(712450).then(n.bind(n,109605))),"services-example"),qT=hw((()=>n.e(404918).then(n.bind(n,154650))),"services-petrol"),GT=hw((()=>n.e(446968).then(n.bind(n,136352))),"services-io-queues-historic-reporting"),YT=hw((()=>Promise.all([n.e(636570),n.e(235533),n.e(788921)]).then(n.bind(n,167894))),"services-floodgate"),QT=hw((()=>n.e(564464).then(n.bind(n,670738))),"services-ods"),JT=hw((()=>n.e(929782).then(n.bind(n,384550))),"services-policies"),KT=hw((()=>n.e(644047).then(n.bind(n,164820))),"services-presence"),ZT=hw((()=>n.e(708398).then(n.bind(n,701996))),"scis-service"),XT=hw((()=>Promise.all([n.e(736046),n.e(344332)]).then(n.bind(n,868709))),"services-search"),eI=(hw((()=>n.e(533250).then(n.bind(n,975592))),"services-substrate-search"),hw((()=>Promise.all([n.e(645957),n.e(469495)]).then(n.bind(n,101380))),"services-search-meeting-summary")),tI=hw((()=>n.e(980598).then(n.bind(n,437445))),"search-substrate"),nI=hw((()=>n.e(796830).then(n.bind(n,780727))),"services-substrate-meeting-recommendations"),iI=hw((()=>n.e(710586).then(n.bind(n,585849))),"services-substrate-recommendations"),aI=hw((()=>n.e(439411).then(n.bind(n,445630))),"services-sharepoint-client"),oI=hw((()=>n.e(17387).then(n.bind(n,566980))),"services-sharepoint-share"),rI=hw((()=>n.e(138521).then(n.bind(n,511241))),"services-share"),sI=hw((()=>n.e(619399).then(n.bind(n,173965))),"services-signals"),lI=hw((()=>n.e(369553).then(n.bind(n,250800))),"services-smb-user-intent"),cI=hw((()=>Promise.all([n.e(746112),n.e(478883),n.e(248701),n.e(194875)]).then(n.bind(n,412029))),"services-store"),dI=hw((()=>n.e(163463).then(n.bind(n,164198))),"services-suggestions"),uI=hw((()=>n.e(998341).then(n.bind(n,418579))),"services-implicit-contacts"),mI=hw((()=>n.e(296091).then(n.bind(n,960296))),"services-targeting-hierarchy"),pI=hw((()=>n.e(983517).then(n.bind(n,960845))),"services-tenant-membership"),gI=hw((()=>n.e(521646).then(n.bind(n,69562))),"services-tenant-service"),hI=hw((()=>n.e(172461).then(n.bind(n,817921))),"services-teams-copilot-aggregator"),vI=hw((()=>n.e(504965).then(n.bind(n,179712))),"services-teams-copilot"),yI=hw((()=>n.e(701239).then(n.bind(n,465022))),"services-third-party-calendar"),SI=hw((()=>n.e(924729).then(n.bind(n,423360))),"services-toast-image"),fI=hw((()=>n.e(930575).then(n.bind(n,944367))),"services-teams-and-channels"),kI=hw((()=>n.e(942586).then(n.bind(n,212561))),"services-translate"),CI=hw((()=>n.e(23319).then(n.bind(n,840696))),"services-tpn-notice"),bI=hw((()=>n.e(384670).then(n.bind(n,676199))),"unified-consent-state"),wI=hw((()=>n.e(505560).then(n.bind(n,960631))),"services-url-preview"),TI=hw((()=>n.e(203149).then(n.bind(n,622667))),"services-user-profile"),II=hw((()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,579148))),"services-voicemail"),NI=hw((()=>n.e(218202).then(n.bind(n,316449))),"services-item-crud"),AI=hw((()=>n.e(828802).then(n.bind(n,147197))),"services-webinar"),EI=hw((()=>n.e(11395).then(n.bind(n,830554))),"services-meeting-bot"),FI=hw((()=>n.e(519949).then(n.bind(n,92026))),"services-virtual-events"),_I=hw((()=>n.e(332756).then(n.bind(n,165607))),"services-meeting-scheduling-service"),DI=hw((()=>n.e(731297).then(n.bind(n,800786))),"services-developer-switchers"),PI=hw((()=>n.e(838292).then(n.bind(n,402205))),"services-search-prefetch"),MI=hw((()=>n.e(63966).then(n.bind(n,980763))),"services-call-recording"),RI=hw((()=>n.e(539639).then(n.bind(n,108716))),"services-user-license"),xI=hw((()=>n.e(764850).then(n.bind(n,510375))),"services-payment"),LI=hw((()=>n.e(850319).then(n.bind(n,572063))),"services-monetization"),OI=hw((()=>n.e(841789).then(n.bind(n,179202))),"services-mru"),jI=hw((()=>n.e(394323).then(n.bind(n,203893))),"services-collab-cloud"),BI=hw((()=>n.e(187235).then(n.bind(n,695499))),"tfl-user-service"),UI=hw((()=>n.e(826036).then(n.bind(n,489415))),"services-sensitivity-label-policy-settings"),$I=hw((()=>n.e(55921).then(n.bind(n,281961))),"services-meeting-questions-and-answers"),WI=hw((()=>n.e(363069).then(n.bind(n,980023))),"services-io-web-app-switcher"),VI=hw((()=>n.e(718949).then(n.bind(n,914583))),"services-io-mtma-user-data"),HI=hw((()=>n.e(492100).then(n.bind(n,592718))),"services-io-waffle"),zI=hw((()=>n.e(56421).then(n.bind(n,454470))),"services-io-organization-info"),qI=hw((()=>n.e(443239).then(n.bind(n,790471))),"services-video-message-upload"),GI=hw((()=>n.e(662637).then(n.bind(n,16692))),"services-io-browser-video-message-camera-command"),YI=e=>()=>e.userServicesCache(pw.AsyncMediaService,(()=>(async e=>{const{send:t,gtmRegistry:n,discover:i,coreSettings:a,loggerFactory:o,scenarioFactory:r,endpointsManager:s}=e,{AsyncMediaService:l}=await bw(r);return new l(t,n,i,a,o,s,r)})(e))),QI=e=>()=>e.userServicesCache(pw.SharepointRestClient,(()=>(async e=>{const{authenticationService:t,platformService:n,scenarioFactory:i,endpointsManager:a,coreSettings:o}=e,{SharepointRestClient:r}=await aI(i);return new r(t,n,a,o)})(e))),JI=(e,t)=>()=>e.userServicesCache(pw.BotsPlatformService,(()=>(async(e,t)=>{const{authenticationService:n,scenarioFactory:i,gtmRegistry:a,send:o,discover:r,platformService:s,i18n:l,coreSettings:c}=e,d=await t(),{BotsPlatformService:u}=await Aw(i);return new u(n,d,a.bind(o,"middleTier"),r,i,s,l,c)})(e,t))),KI=e=>()=>e.userServicesCache(pw.ConnectedAccountsService,(()=>(async e=>{const{discover:t,gtmRegistry:n,scenarioFactory:i,send:a,coreSettings:o,i18n:r,endpointsManager:s}=e,{ConnectedAccountsService:l}=await Yw(i);return new l(t,n,i,o,a,r,s)})(e))),ZI=e=>()=>e.userServicesCache(pw.GoogleCalendarAuthenticationService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,windowProvider:i,scenarioFactory:a,platformService:o,coreSecurityService:r}=e,{GoogleCalendarAuthenticationService:s}=await pT(a);return new s(i,t,n,a,o,r)})(e))),XI=e=>()=>e.userServicesCache(pw.GoogleContactsAuthenticationService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,windowProvider:i,scenarioFactory:a,platformService:o,coreSecurityService:r}=e,{GoogleContactsAuthenticationService:s}=await gT(a);return new s(i,t,n,a,o,r)})(e))),eN=e=>()=>e.userServicesCache(pw.MsaAuthenticationService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,windowProvider:i}=e,{MsaAuthenticationService:a}=await UT(n);return new a(t,n,i)})(e))),tN=(e,t,n,i)=>()=>e.userServicesCache(pw.ExternalAccountsService,(()=>(async(e,t,n,i)=>{const{coreSettings:a,localStorage:o,platformService:r,scenarioFactory:s}=e,l=await t(),c=await n(),d=await i(),{ExternalAccountsService:u}=await iT(s);return new u(a,l,c,d,s,r,o)})(e,t,n,i))),nN=(e,t,n)=>()=>e.userServicesCache(pw.ThirdPartyCalendarService,(()=>(async(e,t,n)=>{const{coreSettings:i,scenarioFactory:a,authenticationService:o,localStorage:r}=e,s=await t(),l=await n(),{ThirdPartyCalendarService:c}=await yI(a);return new c(i,o,s,l,a,r)})(e,t,n))),iN=e=>()=>e.userServicesCache(pw.CallingAppEventsService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,windowProvider:i,coreSettings:a}=e;let o;try{o=await vw()}catch(e){throw new Error(`Failed to load calling app events service adapter: ${e.message}`)}const{CallingAppEventsService:r,ObservableFactory:s}=o;return new r(t,new s,n,i,a)})(e))),aN=(e,t)=>()=>e.userServicesCache(pw.CallingBannerServiceAdapter,(()=>(async(e,t)=>{const{loggerFactory:n}=e,i=await t(),{CallingBannerServiceAdapter:a}=await vw();return new a(n,i)})(e,t))),oN=(e,t)=>()=>e.userServicesCache(pw.CallingDialogServiceAdapter,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i}=e,a=await t(),{CallingDialogServiceAdapter:o}=await vw();return new o(n,i,a)})(e,t))),rN=(e,t)=>()=>e.userServicesCache(pw.CallingNotificationServiceAdapter,(()=>(async(e,t)=>{const{loggerFactory:n,coreSettings:i,hostCommunicationService:a,platformService:o,scenarioFactory:r,coreShortcutService:s}=e,l=await t(),{CallingLoggingService:c,CallingNotificationServiceAdapter:d}=await vw();return new d(n,i,l,a,new c(n,r,i,e.config,o),s)})(e,t))),sN=e=>()=>e.userServicesCache(pw.DiscoverSurfaceService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i}=e,{DiscoverSurfaceService:a}=await NT(n);return new a(t,i,n)})(e))),lN=e=>()=>e.userServicesCache(pw.UserLicenseService,(()=>(async e=>{const{discover:t,endpointsManager:n,loggerFactory:i,scenarioFactory:a}=e,{UserLicenseService:o}=await RI(a);return new o(t,n,i,a)})(e))),cN=(e,t)=>()=>e.userServicesCache(pw.SmbUserIntentService,(()=>(async(e,t)=>{const{endpointsManager:n,loggerFactory:i,scenarioFactory:a,localStorage:o,windowProvider:r}=e,s=await t(),{SmbUserIntentService:l}=await lI(a);return new l(i,n,o,s,r,a)})(e,t))),dN=e=>()=>e.userServicesCache(pw.TenantPrivacyProfileService,(()=>(async e=>{const{loggerFactory:t,authenticationService:n,coreSettings:i,scenarioFactory:a,endpointsManager:o,localStorage:r,discover:s}=e,{CallingIdentityAdapterService:l,ClientDatabaseService:d,AggregatedSettingsStoreService:u,ACSCallingAuthenticationServiceAdapter:m,CallingAuthenticationServiceAdapter:p,TenantPrivacyProfileService:g}=await vw(),h=new d(t,r),v=new u(t,i),y=await n.getUser();return new g(t,n,new l(i.get(c.w.Calling).enableACSEmbed?new m(s,y,t):new p(n,s,y,t,i),v,t),i,h,a,o)})(e))),uN=e=>()=>{const{coreSettings:t}=e;if(!t?.get(c.w.CMDMeetingArtifactsService)?.enableCMDMeetingArtifactsService)throw new Error("FF enableCMDMeetingArtifactsService is disabled");return e.userServicesCache(pw.CollabObjectService,(()=>(async e=>{const{send:t,coreSettings:n,loggerFactory:i,endpointsManager:a,scenarioFactory:o,discover:r}=e,{CollabObjectService:s}=await qw(o);return new s(t,n,i,a,r)})(e)))},mN=e=>()=>e.userServicesCache(pw.StoreDevicesService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i,coreSettings:a,authenticationService:o}=e,{StoreDevicesService:r}=await Kw(n);return new r(i,t,n,a,o)})(e))),pN=e=>()=>e.userServicesCache(pw.OrganizationInfoService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{OrganizationInfoService:i}=await zI(n);return new i(t)})(e))),gN=e=>()=>e.userServicesCache(pw.MeetingRoomAppEventsService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,windowProvider:i}=e,{ObservableFactory:a,MeetingRoomAppEventsService:o}=await vw();return new o(t,new a,n,i)})(e))),hN=e=>()=>e.userServicesCache(pw.AppsStoreService,(()=>(async e=>{const{scenarioFactory:t,coreSettings:n,endpointsManager:i}=e,{AppsStoreService:a}=await fw(t);return new a(t,n,i)})(e))),vN=e=>()=>{const{coreSettings:t}=e;if(!t?.get(c.w.TeamsCopilotAggregator)?.enableTeamsCopilotAggregator)throw new Error("FF enableTeamsCopilotAggregator is disabled");return e.userServicesCache(pw.TeamsCopilotAggregator,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,endpointsManager:i,scenarioFactory:a}=e,{TeamsCopilotAggregator:o}=await hI(a);return new o(t,n,i)})(e)))},yN=e=>()=>{const{coreSettings:t}=e;if(!t?.get(c.w.TeamsCopilotService)?.enableTeamsCopilotService)throw new Error("FF enableTeamsCopilotService is disabled");return e.userServicesCache(pw.TeamsCopilotService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,endpointsManager:i,scenarioFactory:a}=e,{TeamsCopilotService:o}=await vI(a);return new o(t,n,i)})(e)))},SN=e=>()=>e.userServicesCache(pw.AppSuggestionsService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,coreSettings:i,loggerFactory:a}=e,{AppSuggestionsService:o}=await kw(t);return new o(t,i,n,a)})(e))),fN=e=>()=>e.userServicesCache(pw.AiInsightsFeedbackService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,loggerFactory:i}=e,{AiInsightsFeedbackService:a}=await Mw(t);return new a(n,i,t)})(e))),kN=e=>()=>e.userServicesCache(pw.AiInsightsSdsService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,loggerFactory:i}=e,{AiInsightsSdsService:a}=await Rw(t);return new a(n,i,t)})(e))),CN=(e,t)=>()=>e.userServicesCache(pw.AppBasedLinkService,(()=>(async(e,t)=>{const{coreSettings:n,scenarioFactory:i,loggerFactory:a}=e,{AppBasedLinkService:o}=await yw(i);return new o(n,await t(),i,a,e.userBiService)})(e,t))),bN=e=>()=>e.userServicesCache(pw.AppsPlatformService,(()=>(async e=>{const{scenarioFactory:t,coreSettings:n,endpointsManager:i,localStorage:a,authenticationService:o}=e,{enableMetaOsSdkIntegration:r}=n.get(c.w.Extensibility),{AppsPlatformService:s,AppsPlatformServiceMetaOS:l}=await Sw(t);return r?new l(n,i,t,o):new s(n,i,a)})(e))),wN=async(e,t)=>{const{authenticationService:n,i18n:i,loggerFactory:a,scenarioFactory:o,windowProvider:r,coreSettings:s,pubsub:l}=e,{enableAugLoopService:d,runtimeFlights:u,resource:m,serviceUrl:p,enableTimeIntentDetectionABTesting:g,enableLinksSupportABTesting:h,enableTimeIntentMultiturnABTesting:v,enableDefaultInput14daysABTesting:y,enableMessageTimeABTesting:S,enableGPT4TurboABTesting:f,enableUseSyndeyAvalonABTesting:k,experimentationRuntimeFlights:C}=s.get(c.w.Augloop),{enableChatHighlightsPromptInMeetingCopilot:b}=s.get(c.w.MeetingCollaboration),{AugloopService:w}=await ww(o),T=new w(n,r,l,a,o,i,s),I=t?{appName:"Word",appPlatform:"Web"}:void 0;let N=u?[...u]:[];const A=TN(!!g,!!h,!!v,!!y,!!S,!!f,!!k);if(A.length>0){const e=new Set(A),t=u?.map((t=>({...t,value:e.has(t.name)?"true":t.value})))||[],n=A.filter((e=>"string"==typeof e&&!u?.some((t=>t.name===e)))).map((e=>({name:e,value:"true"})));N=[...t,...n]}const E=C?[...C]:[];E.length>0&&(N=[...N.filter((e=>!E.some((t=>e.name===t.name)))),...E]);const F=["Microsoft.Teams.Augloop.EnableSydneyMCPChat"];return N=N.map((e=>F.includes(e.name)?{...e,value:`${!!b}`}:e))||[],b&&F.forEach((e=>{"string"!=typeof e||N.some((t=>t.name===e))||N.push({name:e,value:"true"})})),d&&p&&m&&await T.initialize(p,m,N||[],I),T},TN=(e,t,n,i,a,o,r)=>{const s=[];return e&&s.push("Microsoft.Teams.Augloop.enableTimeIntentDetection"),t&&s.push("Microsoft.Teams.Augloop.enableLinksSupport"),n&&s.push("Microsoft.Teams.Augloop.enableTimeIntentMultiturn"),i&&s.push("Microsoft.Teams.Augloop.enableDefaultInput14days"),a&&s.push("Microsoft.Teams.Augloop.enableMessageTime"),o&&s.push("Microsoft.Teams.Augloop.enableGPT4Turbo"),r&&s.push("Microsoft.Teams.Augloop.UseSydneyAvalon"),s},IN=(e,t)=>()=>t?e.userServicesCache(pw.ComposeAugloopService,(()=>wN(e,!0))):e.userServicesCache(pw.AugloopService,(()=>wN(e))),NN=e=>()=>e.userServicesCache(pw.SubstrateBotPlatformService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{SubstrateBotPlatformService:i}=await Tw(n);return new i(t)})(e))),AN=e=>()=>e.userServicesCache(pw.AzureMapsService,(()=>(async e=>{const{loggerFactory:t,i18NextWrapper:n,scenarioFactory:i,coreSettings:a}=e,{AzureMapsService:o}=await Iw(i);return new o(t,a,n)})(e))),EN=e=>()=>e.userServicesCache(pw.BadgeCountService,(()=>(async e=>{const{coreSettings:t,config:n,discover:i,platformService:a,scenarioFactory:o}=e,{BadgeCountService:r}=await Ww(o);return new r(a,t,i,n)})(e))),FN=e=>()=>e.userServicesCache(pw.BrbService,(()=>(async e=>{const{activeWindowsService:t,scenarioFactory:n,loggerFactory:i,coreSettings:a,logsCollectorService:o,authenticationService:r,platformService:s,discover:l,windowProvider:c,hostCommunicationService:d,endpointsManager:u,authenticationUser:m,i18n:p}=e,{BrbService:g}=await Ew(n);return new g(i,a,o,r,s,l,c,d,u,n,p,t,m)})(e))),_N=e=>()=>e.userServicesCache(pw.BreakoutRoomMiddleTierService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{BreakoutRoomMiddleTierService:i}=await Fw(t);return new i(n)})(e))),DN=e=>()=>e.userServicesCache(pw.AtpSafelinksService,(()=>(async e=>{const{coreSettings:t,endpointsManager:n,gtmRegistry:i,localStorage:a,loggerFactory:o,scenarioFactory:r,send:s}=e,{AtpSafelinksService:l}=await Cw(r);return new l(i.bind(s,"middleTier"),r,o,a,t,n)})(e))),PN=e=>()=>e.userServicesCache(pw.BroadcastAttendeeService,(()=>(async e=>{const{endpointsManager:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,windowProvider:o}=e,{BroadcastAttendeeService:r}=await Lw(a);return new r(t,i,a,o,n)})(e))),MN=e=>()=>e.userServicesCache(pw.BroadcastStreamingAttendeeService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{BroadcastStreamingAttendeeService:i}=await Ow(n);return new i(t)})(e))),RN=e=>()=>e.userServicesCache(pw.BroadcastCaptionsService,(()=>(async e=>{const{coreSettings:t,send:n,endpointsManager:i,scenarioFactory:a,windowProvider:o,loggerFactory:r}=e,{BroadcastCaptionsService:s}=await jw(a);return new s(o,r,a,t,n,i)})(e))),xN=e=>()=>e.userServicesCache(pw.BroadcastSignalRService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,endpointsManager:i,windowProvider:a}=e,{BroadcastSignalRService:o}=await Bw(t);return new o(n,i,t,a)})(e)));var LN=n(305641);const ON=(e,t)=>n=>{t({payload:n,pubsub:e})},jN=async e=>{const{authenticationService:t,coreSettings:i,gtmRegistry:a,loggerFactory:o,pubsub:r,send:s,windowProvider:l}=e,{CallBlockingService:c}=await n.e(774843).then(n.bind(n,124670));return new c(t,i,a.bind(s,"middleTier"),o.newLogger("CallBlockingService","data-services-common"),l,ON(r,BN))},BN=({payload:e,pubsub:t})=>{t.publish(LN.zg,e.newBlockedMris)};class UN{constructor(){this._displayName=null,this.getDisplayName=()=>this._displayName,this.setDisplayName=e=>{this._displayName=e}}}const $N=e=>()=>e.userServicesCache(pw.CallingAnonymousDisplayNameService,(()=>(async()=>new UN)())),WN=e=>()=>e.userServicesCache(pw.CmdMeetingIntelligenceService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{CmdMeetingIntelligenceService:i}=await zw(t);return new i(n)})(e))),VN=e=>()=>e.userServicesCache(pw.CommunitySettingsService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{CommunitySettingsService:i}=await Gw(t);return new i(n)})(e))),HN=e=>()=>e.userServicesCache(pw.ConnectedCalendarSettingsService,(()=>(async e=>{const{coreSettings:t,scenarioFactory:n,endpointsManager:i}=e,{ConnectedCalendarSettingsService:a}=await Qw(n);return new a(n,t,i)})(e))),zN=e=>()=>e.userServicesCache(pw.BiometricEnrollmentService,(()=>(async e=>{const{send:t,authenticationService:n,coreSettings:i,loggerFactory:a,platformService:o,scenarioFactory:r,i18n:s,endpointsManager:l,cmdApolloClient:c}=e,{VoiceBiometricEnrollmentService:d}=await Nw(r);return new d(t,n,i,a,o,s,l,c)})(e))),qN=e=>()=>e.userServicesCache(pw.BiometricFaceEnrollmentService,(()=>(async e=>{const{send:t,authenticationService:n,coreSettings:i,loggerFactory:a,platformService:o,scenarioFactory:r,endpointsManager:s}=e,{BiometricFaceEnrollmentService:l}=await Nw(r);return new l(t,n,i,a,o,s)})(e))),GN=e=>()=>e.userServicesCache(pw.DeveloperSwitchersService,(()=>(async e=>{const{authenticationService:t,config:n,localStorage:i,loggerFactory:a,rebootService:o,scenarioFactory:r,windowProvider:s}=e,{DeveloperSwitchersService:l}=await DI(r);return new l(o,s,a.newLogger("DeveloperSwitchersService","data-services-common"),t,i,n)})(e))),YN=e=>()=>e.userServicesCache(pw.DistributionListService,(()=>(async e=>{const{gtmRegistry:t,send:n,loggerFactory:i,coreSettings:a,scenarioFactory:o}=e,{DistributionListService:r}=await Zw(o);return new r(i,t.bind(n,"middleTier"),a)})(e))),QN=e=>()=>e.userServicesCache(pw.DynamicsMarketingService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,send:i,scenarioFactory:a}=e,{DynamicsMarketingService:o}=await Xw(a);return new o(t,n,i)})(e))),JN=e=>()=>e.userServicesCache(pw.DynamicsVirtualEventsService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,send:i,i18NextWrapper:a,scenarioFactory:o,loggerFactory:r,discover:s}=e,{DynamicsVirtualEventsService:l}=await eT(o);return new l(t,n,i,a,r,s)})(e))),KN=e=>()=>e.userServicesCache(pw.EmoticonService,(()=>(async e=>{const{loggerFactory:t,localStorage:n,scenarioFactory:i,coreSettings:a,i18n:o,windowProvider:r,config:s}=e,{EmoticonService:l}=await tT(i),c=new l(o.locale,n,a,t.newLogger("EmoticonService","data-services-common"),i,o,r,s?.experienceName);return await c.isInitialized,c})(e))),ZN=e=>()=>e.userServicesCache(pw.EspService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{EspService:i}=await nT(n);return new i(t)})(e))),XN=e=>()=>e.userServicesCache(pw.ExampleService,(()=>(async e=>{const{scenarioFactory:t}=e,{ExampleService:n}=await zT(t);return new n})(e))),eA=(e,t)=>()=>e.userServicesCache(pw.ExternalAccountsResponseService,(()=>(async(e,t)=>{const{coreSettings:n,scenarioFactory:i}=e,a=await t(),{ExternalAccountsResponseService:o}=await aT(i);return new o(n,a,i)})(e,t))),tA=e=>()=>e.userServicesCache(pw.FluidService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,endpointsManager:i,send:a,scenarioFactory:o}=e,{FluidService:r}=await cT(o);return new r(t,n,i,a)})(e))),nA=e=>()=>e.userServicesCache(pw.GalleryService,(()=>(async e=>{const{coreSettings:t,discover:n,send:i,scenarioFactory:a}=e,{GalleryService:o}=await dT(a);return new o(i,t,n,a)})(e))),iA=e=>()=>e.userServicesCache(pw.GiphyService,(()=>(async e=>{const{coreSettings:t,gtmRegistry:n,endpointsManager:i,send:a,scenarioFactory:o,i18n:r}=e,{GiphyService:s}=await uT(o);return new s(n.bind(a,"middleTier"),t,r.locale,i)})(e))),aA=e=>()=>e.userServicesCache(pw.GuardiansService,(()=>(async e=>{const{gtmRegistry:t,discover:n,send:i,scenarioFactory:a,loggerFactory:o,i18n:r}=e,{GuardiansService:s}=await ET(a);return new s(t,o,n,i,r)})(e))),oA=e=>()=>e.userServicesCache(pw.ImageProxyService,(()=>(async e=>{const{coreSettings:t,gtmRegistry:n,send:i,scenarioFactory:a,endpointsManager:o,loggerFactory:r}=e,{ImageProxyService:s}=await hT(a);return new s(n,i,t,o,r)})(e))),rA=e=>()=>e.userServicesCache(pw.ImmersiveReaderService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{ImmersiveReaderService:i}=await vT(n);return new i(t)})(e))),sA=(e,t)=>()=>t.userServicesCache(pw.ImportMsaContactsService,(()=>(async(e,t)=>{const{coreSettings:n,endpointsManager:i,scenarioFactory:a}=t,{ImportMsaContactsService:o}=await yT(a);return new o(await e(),n,i,a)})(e,t))),lA=e=>()=>e.userServicesCache(pw.ImplicitContactsService,(()=>(async({coreSettings:e,discover:t,endpointsManager:n,gtmRegistry:i,send:a,scenarioFactory:o})=>{const{ImplicitContactsService:r}=await uI(o);return new r(a,t,i,o,e,n)})(e))),cA=e=>()=>e.userServicesCache(pw.InstantAnswersService,(()=>(async e=>{const{coreSettings:t,send:n,scenarioFactory:i,loggerFactory:a,i18n:o}=e,{InstantAnswersService:r}=await ST(i);return new r(a,i,t,n,o)})(e))),dA=e=>()=>e.userServicesCache(pw.InviteLinksService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{InviteLinksService:i}=await fT(t);return new i(n)})(e))),uA=e=>()=>e.userServicesCache(pw.LiveStateBroadcastService,(()=>(async e=>{const{pubsub:t,scenarioFactory:n,loggerFactory:i,coreSettings:a,authenticationService:o,platformService:r,discover:s}=e,{LiveStateBroadcastService:l}=await CT(n);return new l(t,i,a,o,r,n,s)})(e))),mA=e=>()=>e.userServicesCache(pw.LiveStreamRenderingService,(()=>(async e=>{const{authenticationService:t,authStateProvider:n,discover:i,send:a,scenarioFactory:o,loggerFactory:r,pubsub:s,platformService:l,clientState:d,coreSettings:u,endpointsManager:m,networkState:p}=e,{LiveStreamRenderingService:g}=await bT(o),{ACSCallingAuthenticationServiceAdapter:h,CallingAuthenticationServiceAdapter:v}=await vw(),y=await t.getUser();return new g(r,u.get(c.w.Calling).enableACSEmbed?new h(i,y,r):new v(t,i,y,r,u,n),l,d,s,a,u,o,m,p)})(e))),pA=e=>()=>e.userServicesCache(pw.LmsIntegrationService,(()=>(async e=>{const{gtmRegistry:t,discover:n,send:i,scenarioFactory:a,coreSettings:o,endpointsManager:r}=e,{LmsIntegrationService:s}=await wT(a);return new s(t,n,i,o,r)})(e))),gA=e=>()=>e.userServicesCache(pw.LockedTeamsService,(()=>(async e=>{const{gtmRegistry:t,discover:n,send:i,scenarioFactory:a}=e,{LockedTeamsService:o}=await _T(a);return new o(t,n,i)})(e))),hA=async e=>{const{scenarioFactory:t,loggerFactory:n,logsCollectorService:i,coreSettings:a}=e,{LogsFilesService:o}=await DT(t);return new o(n,i,a,void 0)},vA=e=>()=>e.userServicesCache(pw.LogsFilesService,(()=>hA(e))),yA=e=>()=>e.userServicesCache(pw.LokiService,(()=>(async e=>{const{authenticationService:t,platformService:n,scenarioFactory:i,coreSettings:a,endpointsManager:o}=e,{LokiService:r}=await IT(i);return new r(n,t,a,o)})(e))),SA=e=>()=>e.userServicesCache(pw.ManageTenantService,(()=>(async e=>{const{endpointsManager:t,loggerFactory:n,scenarioFactory:i}=e,{ManageTenantService:a}=await PT(i);return new a(n,i,t)})(e))),fA=e=>()=>e.userServicesCache(pw.MeetingArtifactsService,(()=>(async e=>{const{authenticationService:t,send:n,coreSettings:i,scenarioFactory:a,i18n:o,loggerFactory:r}=e,{MeetingArtifactsService:s}=await MT(a);return new s(n,t,i,o,r,a)})(e))),kA=(e,t,n)=>()=>{const{coreSettings:i}=e;if(!i?.get(c.w.MeetingBot)?.enableMeetingBot)throw new Error("enableMeetingBot flag is disabled");return e.userServicesCache(pw.MeetingBotService,(()=>(async(e,t,n)=>{const{scenarioFactory:i,cmdApolloClient:a,authenticationService:o,coreSettings:r,loggerFactory:s,localStorage:l,platformService:c,windowProvider:d,entityCommanding:u,i18n:m,authenticationUser:p}=e,{MeetingBotService:g}=await EI(i);return new g(o,await t(),r,await n(),s,i,d,l,c,a,u,m,p)})(e,t,n)))},CA=e=>()=>e.userServicesCache(pw.MeetingIntelligenceService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,loggerFactory:i}=e,{MeetingIntelligenceService:a}=await RT(t);return new a(n,i)})(e))),bA=e=>()=>e.userServicesCache(pw.PeopleService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{PeopleService:i}=await $T(t);return new i(n)})(e))),wA=async e=>{const{windowProvider:t,coreSettings:i,scenarioFactory:a,loggerFactory:o}=e,{MeetingOptionsClientDataService:r}=await Promise.all([n.e(937922),n.e(892214)]).then(n.bind(n,695813)),s=bA(e);return new r(t,await s(),i,a,o)},TA=e=>()=>e.userServicesCache(pw.MeetingOptionsClientDataService,(()=>wA(e))),IA=e=>()=>e.userServicesCache(pw.MeetingOptionsService,(()=>(async e=>{const{authenticationService:t,send:n,scenarioFactory:i,coreSettings:a,gtmRegistry:o,discover:r,endpointsManager:s}=e,{MeetingOptionsService:l}=await LT(i);return new l(t,n,i,a,o,r,s)})(e))),NA=e=>()=>e.userServicesCache(pw.MeetingQuestionsAndAnswersService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i}=e,{MeetingQuestionsAndAnswersService:a}=await $I(n);return new a(i,t,n)})(e))),AA=e=>()=>e.userServicesCache(pw.MeetingRecapService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{MeetingRecapService:i}=await xT(t);return new i(n)})(e))),EA=e=>()=>e.userServicesCache(pw.MeetingRecapSwaService,(()=>(async e=>{const{send:t,scenarioFactory:n,authenticationService:i,loggerFactory:a,endpointsManager:o,coreSettings:r}=e,{MeetingRecapSwaService:s}=await OT(n);return new s(o,i,t,r,a)})(e))),FA=e=>()=>e.userServicesCache(pw.MeetingRecapWorkingSetFilesService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{MeetingRecapWorkingSetFilesService:i}=await jT(t);return new i(n)})(e))),_A=e=>()=>e.userServicesCache(pw.MeetingTemplateService,(()=>(async({scenarioFactory:e,send:t,authenticationService:n,coreSettings:i,discover:a,loggerFactory:o,endpointsManager:r})=>{const{MeetingTemplateService:s}=await BT(e);return new s(t,n,i,e,a,r,o)})(e))),DA=e=>()=>e.userServicesCache(pw.PaymentsService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,i18n:o,loggerFactory:r}=e,{PaymentService:s}=await xI(t);return new s(n,i,a,r,t,o)})(e))),PA=e=>()=>e.userServicesCache(pw.PeoplePickerService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{PeoplePickerService:i}=await WT(t);return new i(n)})(e))),MA=e=>()=>e.userServicesCache(pw.PeopleTargetingService,(()=>(async e=>{const{authenticationService:t,loggerFactory:n,send:i,coreSettings:a,scenarioFactory:o,discover:r,endpointsManager:s}=e,{createPeopleTargetingService:l}=await VT(o);return l(t,n,i,a,r,s)})(e))),RA=e=>()=>e.userServicesCache(pw.PoliciesService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,endpointsManager:i,loggerFactory:a,networkState:o,scenarioFactory:r}=e,{PoliciesService:s}=await JT(r);return new s(i,t,n,a,o,r)})(e))),xA=e=>()=>e.userServicesCache(pw.PresenceService,(()=>(async e=>{const{gtmRegistry:t,pubsub:n,send:i,scenarioFactory:a,platformService:o,config:r}=e,{PresenceService:s}=await KT(a);return new s(t.bind(i,"unifiedPresence"),n,o,r)})(e))),LA=e=>()=>e.userServicesCache(pw.QueuesHistoricReportingService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{QueuesHistoricReportingService:i}=await GT(t);return new i(n)})(e)));class OA extends Error{constructor(e,t){super(`${t} - ${e}`)}}class jA{async process(e,t){return this.validateInput(t),this.validateConfig(e),this.executeStatements(e,t)}async executeStatements(e,t){const n=[];for(const i of t.odsl?.statements||[]){const t=e[i.name];if(!t)throw new OA(`No matching manifest found for statement '${i.name}'`,"ODSLProcessor-01");const a=t(this.processStatement(i));n.push(a)}return n}processStatement(e){const t={};Array.isArray(e.arguments)?e.arguments.forEach((e=>{t[e.name]=e.value})):Object.keys(e.arguments).forEach((n=>{const i=e.arguments[n];switch(i.type){case"number":i.number&&(t[n]=i.number);break;case"boolean":i.boolean&&(t[n]=i.boolean);break;case"string":i.string&&(t[n]=i.string)}}));return t}validateConfig(e){if(!e)throw new OA("No manifest found","ODSLProcessor-04")}validateInput(e){if(!e)throw new OA("No input found","ODSLProcessor-05");if(!e.odsl)throw new OA("No ODSL found in input","ODSLProcessor-06");if(!e.entities)throw new OA("No entities found in input","ODSLProcessor-07")}}const BA=e=>()=>e.userServicesCache(pw.ODSLProcessingEngine,(()=>(async e=>new jA)())),UA=async e=>{const{gtmRegistry:t,send:i,loggerFactory:a}=e,{AddressService:o}=await n.e(486936).then(n.bind(n,918194));return new o(t.bind(i,"middleTier"),a)},$A=e=>()=>e.userServicesCache(pw.AddressService,(()=>UA(e))),WA=async e=>{const{gtmRegistry:t,send:i}=e,{PstnService:a}=await n.e(832217).then(n.bind(n,34783));return new a(t.bind(i,"middleTier"))},VA=e=>()=>e.userServicesCache(pw.PstnService,(()=>WA(e))),HA=e=>()=>e.userServicesCache(pw.SCISService,(()=>(async e=>{const{send:t,authenticationService:n,platformService:i,scenarioFactory:a,loggerFactory:o}=e,{SCISService:r}=await ZT(a);return new r(t,n,i,a,o)})(e))),zA=e=>()=>e.userServicesCache(pw.SearchPrefetchService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,authenticationService:i}=e,{SearchPrefetchService:a}=await PI(t);return new a(i,n)})(e))),qA=e=>()=>e.userServicesCache(pw.ShareService,(()=>(async e=>{const{coreSettings:t,discover:n,gtmRegistry:i,scenarioFactory:a,send:o,i18n:r}=e,{ShareService:s}=await rI(a);return new s(t,n,i,o,r)})(e))),GA=(e,t,n,i)=>()=>e.userServicesCache(pw.StoreService,(()=>(async(e,t,n,i)=>{const{scenarioFactory:a,loggerFactory:o,gtmRegistry:r,localStorage:s,coreSettings:l,authenticationService:c,platformService:d,endpointsManager:u,windowProvider:m,i18n:p}=e,{StoreService:g}=await cI(a);return new g(a,o,r,s,l,c,d,u,m,p,await t(),await n(),await i())})(e,t,n,i))),YA=e=>()=>e.userServicesCache(pw.StyleMyRoomService,(()=>(async e=>{const{coreSettings:t,i18n:n,scenarioFactory:i,endpointsManager:a}=e,{StyleMyRoomService:o}=await xw(i);return new o(t,a,n)})(e))),QA=e=>()=>e.userServicesCache(pw.TenantMembershipService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{TenantMembershipService:i}=await pI(t);return new i(t,n)})(e))),JA=e=>()=>e.userServicesCache(pw.TenantService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{TenantService:i}=await gI(t);return new i(t,n)})(e))),KA=e=>()=>e.userServicesCache(pw.TenantAnalyticsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i}=e,{TenantAnalyticsService:a}=await TT(n);return new a(i,t)})(e))),ZA=e=>()=>e.userServicesCache(pw.TranscriptService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,coreSettings:i,loggerFactory:a}=e,{TranscriptService:o}=await _w(t);return new o(n,a,t,i)})(e))),XA=e=>()=>e.userServicesCache(pw.TranscriptFeedbackService,(()=>(async e=>{const{scenarioFactory:t}=e,{TranscriptFeedbackService:n}=await Pw(t);return new n})(e))),eE=e=>()=>e.userServicesCache(pw.TranscriptSettingsStoreService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i,authenticationUser:a}=e,{SettingsStoreService:o}=await Dw(n);return new o(t,n,i,a)})(e))),tE=e=>()=>e.userServicesCache(pw.TranslateService,(()=>(async e=>{const{gtmRegistry:t,endpointsManager:n,coreSettings:i,scenarioFactory:a,send:o}=e,{TranslateService:r}=await kI(a);return new r(t.bind(o,"middleTier"),a,i,n)})(e))),nE=e=>()=>e.userServicesCache(pw.TargetingHierarchyService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,discover:i,loggerFactory:a,scenarioFactory:o,send:r}=e,{TargetingHierarchyService:s}=await mI(o);return new s(t,a,r,n,i)})(e))),iE=e=>()=>e.userServicesCache(pw.ToastImageService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{ToastImageService:i}=await SI(t);return new i(n)})(e))),aE=e=>()=>e.userServicesCache(pw.TeamsAndChannelsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{TeamsAndChannelsService:i}=await fI(n);return new i(t)})(e))),oE=e=>()=>e.userServicesCache(pw.TpnNoticeService,(()=>(async e=>{const{send:t,platformService:n,scenarioFactory:i}=e,{TpnNoticeService:a}=await CI(i);return new a(t,n)})(e))),rE=(e,t)=>()=>e.userServicesCache(pw.UrlPreviewService,(()=>(async(e,t)=>{const{gtmRegistry:n,endpointsManager:i,send:a,coreSettings:o,scenarioFactory:r}=e,{UrlPreviewService:s}=await wI(r);return new s(n,a,o,await t(),i,r)})(e,t))),sE=e=>()=>e.userServicesCache(pw.MyUserPreferencesStore,(()=>(async e=>{const{loggerFactory:t,cmdApolloClient:n}=e,{MyUserPreferencesStore:i}=await vw();return new i(n,t)})(e))),lE=e=>()=>e.userServicesCache(pw.UserProfileService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{UserProfileService:i}=await TI(t);return new i(n)})(e))),cE=e=>()=>e.userServicesCache(pw.VirtualEventsService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,loggerFactory:r,endpointsManager:s}=e,{VirtualEventsService:l,MockVirtualEventsService:d}=await FI(t),{forceUseMockAPIs:u}=a.get(c.w.VirtualEvents);return u?new d:new l(n,i,a,o,r,s)})(e))),dE=e=>()=>e.userServicesCache(pw.MeetingSchedulingService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{MeetingSchedulingService:i}=await _I(t);return new i(n)})(e)));var uE=n(713352);const mE=({payload:e,pubsub:t})=>{t.publish(uE.HB,e)},pE=e=>()=>e.userServicesCache(pw.VoicemailService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,pubsub:o,send:r,windowProvider:s}=e,{VoicemailService:l}=await II(a);return new l(t,n,r,i,s,ON(o,mE))})(e))),gE=e=>()=>e.userServicesCache(pw.WebinarService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,i18n:r,loggerFactory:s}=e,{WebinarService:l}=await AI(t);return new l(n,i,a,s,t,r,o)})(e))),hE=e=>()=>e.userServicesCache(pw.CallRecordingService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,endpointsManager:i}=e,{CallRecordingService:a}=await MI(t);return new a(n,i)})(e))),vE=e=>()=>e.userServicesCache(pw.MonetizationService,(()=>(async e=>{const{authenticationService:t,send:n,scenarioFactory:i,loggerFactory:a,discover:o,coreSettings:r,localStorage:s}=e,{MonetizationService:l}=await LI(i);return new l(t,n,a,o,r,s)})(e))),yE=e=>()=>e.userServicesCache(pw.MRUItemService,(()=>(async e=>{const{authenticationService:t,send:n,scenarioFactory:i,coreSettings:a}=e,{MRUService:o}=await OI(i);return new o(t,n,a)})(e))),SE=(e,t)=>()=>e.userServicesCache(pw.DiscoverSurfaceFeedbackService,(()=>(async(e,t)=>{const{scenarioFactory:n,windowProvider:i,loggerFactory:a}=e,{DiscoverSurfaceFeedbackService:o}=await AT(n);return new o(await t(),i,a)})(e,t))),fE=e=>()=>{const{coreSettings:t}=e;if(!t?.get(c.w.Extensibility)?.enableCollabCloudApis)throw new Error("enableCollabCloudApis flag is disabled");return e.userServicesCache(pw.CollabCloudService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{CollabCloudService:i}=await jI(t);return new i(n)})(e)))},kE=e=>()=>e.userServicesCache(pw.TFLUserService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,localStorage:i,loggerFactory:a}=e,{TFLUserService:o}=await BI(t);return new o(a,i,n)})(e))),CE=e=>()=>e.userServicesCache(pw.SensitivityLabelPolicySettingsService,(()=>(async e=>{const{coreSettings:t,discover:n,gtmRegistry:i,authenticationUser:a,scenarioFactory:o,send:r,endpointsManager:s}=e,{SensitivityLabelPolicySettingsService:l}=await UI(o);return new l(o,t,i,r,n,s,a)})(e))),bE=e=>()=>e.userServicesCache(pw.WaffleService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{WaffleService:i}=await HI(n);return new i(t)})(e))),wE=e=>()=>e.userServicesCache(pw.VideoMessageCameraCommandService,(()=>(async e=>{const{scenarioFactory:t}=e,{VideoMessageCameraCommandService:n}=await GI(t);return new n})(e))),TE=(e,t,n)=>()=>e.userServicesCache(pw.PetrolService,(()=>(async(e,t,n)=>{const{platformService:i,authenticationService:a,coreSettings:o,discover:r,send:s,scenarioFactory:l,loggerFactory:c,hostCommunicationService:d,i18n:u}=e,{PetrolService:m}=await qT(l);return new m(a,r,l,c,i,o,s,await t(),await n(),d,u)})(e,t,n))),IE=(e,t)=>()=>e.userServicesCache(pw.FloodgateService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i,coreSettings:a,clientState:o,i18NextWrapper:r,windowProvider:s,platformService:l,authenticationUser:d,floodgateService:u,i18n:m,user:p}=e,{enableFloodgateInCore:g}=a.get(c.w.Feedback),h=await t();if(g)return u.setContextServices(m,h,d,p),u;{const{FloodGateService:e}=await YT(i);return new e(n,i,o,a,h,r,l,s,d)}})(e,t))),NE=(e,t,n)=>()=>e.userServicesCache(pw.OdsService,(()=>(async(e,t,n)=>{const{authenticationService:i,discover:a,scenarioFactory:o,loggerFactory:r,endpointsManager:s,logsCollectorService:l,coreSettings:c,platformService:d,hostCommunicationService:u,i18n:m}=e,{OdsService:p}=await QT(o);return new p(i,a,r,s,l,c,d,await t(),u,await n(),m)})(e,t,n))),AE=e=>()=>e.userServicesCache(pw.LokiMetaPreviewService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,scenarioFactory:a}=e,{LokiMetaPreviewService:o}=await XT(a);return new o(n,t,i)})(e))),EE=e=>()=>e.userServicesCache(pw.OdcFilePreviewService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,scenarioFactory:a}=e,{OdcFilePreviewService:o}=await XT(a);return new o(n,t,i)})(e))),FE=e=>()=>e.userServicesCache(pw.OSearchService,(()=>(async e=>{const{send:t,discover:n,loggerFactory:i,scenarioFactory:a,coreSettings:o,endpointsManager:r}=e,{OSearchService:s}=await XT(a);return new s(t,r,n,i,o)})(e))),_E=e=>()=>e.userServicesCache(pw.PeopleSearchService,(()=>(async e=>{const{send:t,endpointsManager:n,gtmRegistry:i,loggerFactory:a,scenarioFactory:o,discover:r,coreSettings:s}=e,{PeopleSearchService:l}=await XT(o);return new l(i.bind(t,"middleTier"),n,a,r,s)})(e))),DE=e=>()=>e.userServicesCache(pw.SubstrateFilesSearchService,(()=>(async e=>{const{authenticationService:t,send:n,platformService:i,loggerFactory:a,scenarioFactory:o,i18n:r}=e,{SubstrateFilesSearchService:s}=await XT(o);return new s(n,t,i,o,a,r)})(e))),PE=e=>()=>e.userServicesCache(pw.SubstrateRecommendationsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{SubstrateRecommendationsService:i}=await iI(n);return new i(t)})(e))),ME=e=>()=>e.userServicesCache(pw.SubstrateSearchService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,platformService:a,scenarioFactory:o,windowProvider:r,coreSettings:s,endpointsManager:l,i18n:c}=e,{SubstrateSearchService:d}=await XT(o),{subType:u}=await t.getUser();return new d(n,t,a,o,i,r,s,l,c,u||pg.as.Default)})(e))),RE=e=>()=>e.userServicesCache(pw.SubstrateSuggestionsService,(()=>(async({authenticationService:e,endpointsManager:t,coreSettings:n,discover:i,gtmRegistry:a,send:o,scenarioFactory:r,platformService:s})=>{const{SubstrateSuggestionsService:l}=await dI(r);return new l(o,t,e,n,i,a,s)})(e))),xE=e=>()=>e.userServicesCache(pw.SubstrateMeetingSearchService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,platformService:a,scenarioFactory:o}=e,{SubstrateMeetingSearchService:r}=await XT(o);return new r(n,t,a,o,i)})(e))),LE=e=>()=>e.userServicesCache(pw.SubstrateMeetingSummarySearchService,(()=>(async e=>{const{authenticationService:t,loggerFactory:n,platformService:i,scenarioFactory:a,coreSettings:o,endpointsManager:r,i18n:s}=e,{SubstrateMeetingSummarySearchService:l}=await eI(a);return new l(t,i,a,n,o,r,s)})(e))),OE=e=>()=>e.userServicesCache(pw.ChatService,(()=>(async e=>{const{endpointsManager:t,coreSettings:n,scenarioFactory:i}=e,{ChatService:a}=await Ww(i);return new a(n,t)})(e))),jE=(e,t)=>()=>e.userServicesCache(pw.ChatServiceEndpointProvider,(()=>(async(e,t)=>{const{scenarioFactory:n}=e,i=await t(),{ChatServiceEndpointProvider:a}=await $w(n);return new a(i,n)})(e,t))),BE=e=>()=>e.userServicesCache(pw.ConsumerGroupsService,(()=>(async e=>{const{coreSettings:t,scenarioFactory:n,endpointsManager:i,loggerFactory:a}=e,{ConsumerGroupsService:o}=await Ww(n);return new o(i,a,n,t)})(e))),UE=e=>()=>e.userServicesCache(pw.CSAService,(()=>(async e=>{const{authenticationService:t,platformService:n,coreSettings:i,scenarioFactory:a,endpointsManager:o,i18n:r,discover:s}=e,{createCSAService:l}=await Ww(a);return l(t,n,i,r,o,s)})(e))),$E=e=>()=>e.userServicesCache(pw.StatefulLongPoll,(()=>(async e=>{const{scenarioFactory:t}=e,{StatefulLongPoll:n}=await Ww(t);return new n})(e))),WE=e=>()=>e.userServicesCache(pw.ReportConcernService,(()=>(async e=>{const{scenarioFactory:t,send:n,gtmRegistry:i,platformService:a}=e,{ReportConcernService:o}=await Hw(t);return new o(i.bind(n,"middleTier"),a)})(e))),VE=e=>()=>e.userServicesCache(pw.CallingConversationService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i}=e,{CallingConversationService:a}=await Vw(n);return new a(t,i)})(e))),HE=(e,t)=>()=>e.userServicesCache(pw.SharepointShareService,(()=>(async(e,t)=>{const{endpointsManager:n,coreSettings:i,loggerFactory:a,send:o,scenarioFactory:r}=e,{SharepointShareService:s}=await oI(r);return new s(o,n,a,i,await t())})(e,t))),zE=(e,t)=>()=>e.userServicesCache(pw.FilesRedeemService,(()=>(async(e,t)=>{const{endpointsManager:n,coreSettings:i,loggerFactory:a,send:o,scenarioFactory:r}=e,{FilesRedeemService:s}=await oI(r);return new s(o,n,a,i,await t())})(e,t))),qE=(e,t,n)=>()=>n.userServicesCache(pw.FilesSharepointUrlService,(()=>(async(e,t,n)=>{const{scenarioFactory:i,coreSettings:a}=n,{FilesSharepointUrlService:o}=await oI(i);return new o(await e(),await t(),a)})(e,t,n))),GE=(e,t)=>()=>e.userServicesCache(pw.PersonalFileDetailsService,(()=>(async(e,t)=>{const{discover:n,gtmRegistry:i,loggerFactory:a,scenarioFactory:o,send:r,endpointsManager:s,coreSettings:l}=e,c=await t(),{PersonalFileDetailsService:d}=await HT(o),u=new mv.j(n);return new d(c,o,a,i.bind(u.authorize(r,"x-skypetoken"),"middleTier"),s,l)})(e,t))),YE=async e=>{const{gtmRegistry:t,send:i,discover:a,endpointsManager:o,coreSettings:r}=e,{RefreshSiteUrlService:s}=await n.e(882735).then(n.bind(n,878688));return new s(t,a,i,o,r)},QE=(e,t)=>()=>t.userServicesCache(pw.FilesReferenceService,(()=>(async(e,t)=>{const{scenarioFactory:n,coreSettings:i}=t,{FilesReferenceService:a}=await rT(n);return new a(await e(),i)})(e,t))),JE=(e,t)=>()=>e.userServicesCache(pw.FileUploadPreviewService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i,coreSettings:a}=e,{FileUploadPreviewService:o}=await sT(i),{enableAmsImageResizing:r}=a.get(c.w.Messaging);return new o(await t(),n,!!r)})(e,t))),KE=(e,t,n,i)=>()=>e.userServicesCache(pw.FileUploadService,(()=>(async(e,t,n,i)=>{const{loggerFactory:a,scenarioFactory:o,coreSettings:r,authenticationService:s}=e,{FileUploadService:l}=await sT(o);return new l(await t(),await n(),s,await i(),r,a,o)})(e,t,n,i))),ZE=e=>()=>e.userServicesCache(pw.FileDownloadManagerService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,coreSettings:i}=e,{FileDownloadManagerService:a}=await lT(t);return new a(n.newLogger("fileDownloadManagerService","data-services-common"),i)})(e))),XE=async e=>{const{gtmRegistry:t,discover:i,loggerFactory:a,send:o,endpointsManager:r,coreSettings:s,scenarioFactory:l}=e,{CloudStorageFoldersService:c}=await n.e(357623).then(n.bind(n,727033));return new c(t,i,a,o,r,s,l)},eF=e=>()=>e.userServicesCache(pw.CloudStorageFoldersService,(()=>XE(e))),tF=e=>()=>e.userServicesCache(pw.FilesBackfillThreadPropertiesService,(()=>(async e=>{const{discover:t,gtmRegistry:n,scenarioFactory:i,loggerFactory:a,send:o,endpointsManager:r,coreSettings:s}=e,{FilesBackfillThreadPropertiesService:l}=await rT(i),c=new mv.j(t);return new l(a,n.bind(c.authorize(o,"x-skypetoken"),"middleTier"),r,s)})(e)));var nF=n(486616);const iF=(e,t=ah.t)=>(n,i=nF.IO.BEARER)=>n?e.authorizeV2?.(t,n,{scheme:i})??e.authorize(t,n):t,aF=async(e,t)=>{const{scenarioFactory:n,authenticationService:i,loggerFactory:a,coreSettings:o}=t,r=oF(o),s=rF(o,r)||"",l=sF(o,r)||"",c=iF(i),{ItemUploadService:d,ItemDeleteService:u,ItemDetailsService:m}=await NI(n),p=a.newLogger(e,"data-services-common");switch(e){case pw.ItemUploadService:return new d(c,r,s,l,p);case pw.ItemDeleteService:return new u(c,r,p);case pw.ItemDetailsService:return new m(c,r,p,o);default:return}},oF=e=>!!e.get(c.w.Files).preferGraphOverVroom,rF=(e,t)=>t?e.get(c.w.Files).graphEndpointBaseUrl:e.get(c.w.Files).vroomEndpointBaseUrl,sF=(e,t)=>t?e.get(c.w.Files).graphAuthScope:e.get(c.w.Files).vroomAuthScope,lF=e=>()=>e.userServicesCache(pw.ItemUploadService,(()=>(async e=>await aF(pw.ItemUploadService,e))(e))),cF=e=>()=>e.userServicesCache(pw.ItemDeleteService,(()=>(async e=>await aF(pw.ItemDeleteService,e))(e))),dF=e=>()=>e.userServicesCache(pw.ItemDetailsService,(()=>(async e=>await aF(pw.ItemDetailsService,e))(e))),uF=e=>()=>e.userServicesCache(pw.DriveItemShareService,(()=>(async e=>{const{scenarioFactory:t}=e,{DriveItemShareService:n}=await oI(t),{authenticationService:i,coreSettings:a}=e,o=oF(a);return new n(iF(i),o)})(e))),mF=(e,t)=>()=>e.userServicesCache(pw.VideoFileService,(()=>(async(e,t)=>{const{coreSettings:n,loggerFactory:i,send:a,scenarioFactory:o}=e,{VideoFileService:r}=await oI(o);return new r(a,i,n,await t())})(e,t))),pF=e=>()=>e.userServicesCache(pw.FilesValidDomainsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i,localStorage:a,coreSettings:o}=e,{FilesValidDomainsService:r}=await rT(n);return new r(t,i,a,o)})(e))),gF=e=>()=>e.userServicesCache(pw.FilesSiteResourceInfoService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i}=e,{FilesSiteResourceInfoService:a}=await rT(n);return new a(t,i)})(e))),hF=(e,t)=>()=>e.userServicesCache(pw.CustomCopilotBotService,(()=>(async(e,t)=>{const{coreSettings:n,loggerFactory:i,scenarioFactory:a,endpointsManager:o}=e,{CustomCopilotBotService:r}=await Jw(a);return new r(i,n,await t(),o)})(e,t))),vF=(e,t)=>()=>e.userServicesCache(pw.VideoMessageUploadService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i,offlineCacheManager:a,discover:o,coreSettings:r,i18n:s}=e,{VideoMessageUploadService:l}=await qI(i);return new l(await t(),a,i,n,o,r,(0,Un.z)(),s)})(e,t))),yF=e=>()=>e.userServicesCache(pw.CalendarService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,loggerFactory:r,platformService:s,i18n:l}=e,{CalendarService:c}=await Uw(t);return new c(n,i,o,a,r,s,l)})(e))),SF=e=>()=>e.userServicesCache(pw.ExternalCalendarEmailAddressService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{ExternalCalendarEmailAddressService:i}=await oT(t);return new i(n)})(e))),fF=e=>()=>e.userServicesCache(pw.TeamCalendarService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,loggerFactory:r,platformService:s,i18n:l}=e,{TeamCalendarService:c}=await Uw(t);return new c(n,i,o,a,r,s,l)})(e))),kF=e=>()=>e.userServicesCache(pw.SubstrateMeetingRecommendationsService,(()=>(async e=>{const{scenarioFactory:t,authenticationService:n,endpointsManager:i,loggerFactory:a}=e,{SubstrateMeetingRecommendationsService:o}=await nI(t);return new o(n,i,a)})(e))),CF=e=>()=>e.userServicesCache(pw.LiveMeetingStatusBarEventsService,(()=>(async e=>{const{scenarioFactory:t}=e,{LiveMeetingStatusBarEventsService:n}=await kT(t);return new n})(e))),bF=e=>()=>e.userServicesCache(pw.CommonSubstrateService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,platformService:i,authenticationService:a,endpointsManager:o,windowProvider:r,coreSettings:s}=e,{CommonSubstrateService:l}=await tI(t);return new l(r,n,a,i,s,o)})(e))),wF=e=>()=>e.userServicesCache(pw.SignalsService,(()=>(async e=>{const{authenticationService:t,config:n,coreSettings:i,scenarioFactory:a,send:o}=e;if(!n)throw new Error("config not set on IUserServicesFactoryContext");const{SignalsService:r}=await sI(a);return new r(t,i,o,n)})(e))),TF=e=>()=>e.globalServicesCache(gw.ExampleGlobalService,(()=>(async e=>{const{scenarioFactory:t}=e,{ExampleService:n}=await zT(t);return new n})(e))),IF=e=>()=>e.globalServicesCache(gw.GlobalCallingService,(()=>(async e=>{const{GlobalCallingService:t}=await Promise.all([n.e(566555),n.e(169691),n.e(291363),n.e(94139),n.e(712315),n.e(725236),n.e(816373),n.e(183153),n.e(361293),n.e(654005),n.e(920688)]).then(n.bind(n,568177));return new t(e)})(e))),NF=e=>()=>e.globalServicesCache(gw.MTMAUserDataService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,hostCommunicationService:i,loggerFactory:a,scenarioFactory:o,workerCacheManager:r}=e,{MTMAUserDataService:s}=await VI(o),l=new s({authenticationService:t,hostCommunicationService:i,loggerFactory:a,workerCacheManager:r,coreSettings:n});return n.get(c.w.CdlWorker).enableMTMAUserDataInMaglevStorage&&await l.startup(),l})(e))),AF=e=>()=>e.globalServicesCache(gw.WebAppSwitcherService,(()=>(async e=>{const{crossTabsService:t,localStorage:n,loggerFactory:i,scenarioFactory:a}=e,{WebAppSwitcherService:o}=await WI(a);return new o(n,i,t)})(e))),EF=e=>()=>e.globalServicesCache(gw.GlobalTaskbarService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,hostCommunicationService:i,i18n:a,scenarioFactory:o}=e,{GlobalTaskbarService:r}=await mT(o);return new r(n,t,i,a)})(e))),FF=e=>()=>e.userServicesCache(pw.HealthScenarioService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,localStorage:i}=e,{HealthScenarioService:a}=await FT(n);return new a(t,i)})(e))),_F=e=>()=>e.userServicesCache(pw.UnifiedConsentService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,authenticationService:i,cacheStorage:a,loggerFactory:o}=e,{UnifiedConsentService:r}=await bI(n);return new r(t,i,a,o)})(e))),DF=(e,t)=>{const{calendarServices:n,chatServices:i,fileServices:a,getAppsStoreService:o,getAsyncMediaService:r,getBotsPlatformService:s,getCallingAppEventsService:l,getCallingBannerService:c,getCallingDialogService:d,getCallingNotificationService:u,getCollabObjectService:m,getConnectedAccountsService:p,getDiscoverSurfaceService:g,getExternalAccountsService:h,getGoogleCalendarAuthenticationService:v,getMeetingRoomAppEventsService:y,getMsaAuthenticationService:S,getSharepointRestClient:f,getSmbUserIntentService:k,getTeamsCopilotAggregator:C,getTenantPrivacyProfileService:b,getThirdPartyCalendarService:w,getUserLicenseService:T,getStoreDevicesService:I,getOrganizationInfoService:N,videoMessageServices:A}=(e=>{const t=YI(e),n=RF(e),i=QI(e),a=JI(e,n.getChatService),o=xF(e,t,n.getChatService,i),r=LF(e,t),s=KI(e),l=ZI(e),c=XI(e),d=eN(e),u=tN(e,l,c,s),m=nN(e,l,s),p=OF(e),g=iN(e),h=aN(e,g),v=oN(e,g),y=rN(e,g),S=sN(e),f=lN(e),k=cN(e,f),C=dN(e),b=uN(e),w=mN(e),T=pN(e),I=gN(e);return{calendarServices:p,chatServices:n,fileServices:o,getAppsStoreService:hN(e),getAsyncMediaService:t,getBotsPlatformService:a,getCallingAppEventsService:g,getCallingBannerService:h,getCallingDialogService:v,getCallingNotificationService:y,getCollabObjectService:b,getConnectedAccountsService:s,getDiscoverSurfaceService:S,getExternalAccountsService:u,getGoogleCalendarAuthenticationService:l,getMeetingRoomAppEventsService:I,getMsaAuthenticationService:d,getSharepointRestClient:i,getSmbUserIntentService:k,getTeamsCopilotAggregator:vN(e),getTeamsCopilotService:yN(e),getTenantPrivacyProfileService:C,getThirdPartyCalendarService:m,getUserLicenseService:f,getStoreDevicesService:w,getOrganizationInfoService:T,videoMessageServices:r}})(e),E=((e,t,n)=>async(i,a)=>{const o=a?.scenario;o?.mark(be.BQ.GetGlobalCallingService);const r=await n.getGlobalCallingService();return o?.mark(be.BQ.GlobalCallingServiceInitAccount),{...await r.initAccount({entryPoint:i,accountCtx:e,deps:t,telemetryContext:a}),dispose:(t,n)=>r.disposeAccount(t,n,e.authenticationUser)}})(e,{getCallingAppEventsService:l,getCallingBannerService:c,getCallingDialogService:d,getCallingNotificationService:u,getTenantPrivacyProfileService:b,getCalendarService:n.getCalendarService,getMeetingRoomAppEventsService:y,getLiveMeetingStatusBarEventsService:n.getLiveMeetingStatusBarEventsService},t),F=SN(e);return{...i,getAiInsightsFeedbackService:fN(e),getAiInsightsSdsService:kN(e),getAppBasedLinkService:CN(e,s),getAppsPlatformService:bN(e),getAppsStoreService:o,getAppSuggestionsService:F,getAsyncMediaService:r,getAugloopService:IN(e),getSubstrateBotPlatformService:NN(e),getComposeAugloopService:IN(e,!0),getAzureMapsService:AN(e),getBadgeCountService:EN(e),getBotsPlatformService:s,getBrbService:FN(e),getBreakoutRoomMiddleTierService:_N(e),getAtpSafelinksService:DN(e),getBroadcastAttendeeService:PN(e),getBroadcastStreamingAttendeeService:MN(e),getBroadcastCaptionsService:RN(e),getBroadcastSignalRService:xN(e),...n,getCallBlockingService:(_=e,()=>_.userServicesCache(pw.CallBlockingService,(()=>jN(_)))),getCallingAnonymousDisplayNameService:$N(e),getCallingAppEventsService:l,getCallingBannerService:c,getCallingDialogService:d,getCallingNotificationService:u,getCallingService:E,getCmdMeetingIntelligenceService:WN(e),getCollabObjectService:m,getCommunitySettingsService:VN(e),getConnectedAccountsService:p,getConnectedCalendarSettingsService:HN(e),getBiometricEnrollmentService:zN(e),getBiometricFaceEnrollmentService:qN(e),getDeveloperSwitchersService:GN(e),getDistributionListService:YN(e),getDynamicsMarketingService:QN(e),getDynamicsVirtualEventsService:JN(e),getEmoticonService:KN(e),getEspService:ZN(e),getExampleService:XN(e),getExternalAccountsService:h,getExternalAccountsResponseService:eA(e,p),...a,...A,getFluidService:tA(e),getGalleryService:nA(e),getGiphyService:iA(e),getGoogleCalendarAuthenticationService:v,getGoogleContactsAuthenticationService:XI(e),getGuardiansService:aA(e),getHealthScenarioService:FF(e),getImageProxyService:oA(e),getImmersiveReaderService:rA(e),getImportMsaContactsService:sA(S,e),getImplicitContactsService:lA(e),getInstantAnswersService:cA(e),getInviteLinksService:dA(e),getLiveStateBroadcastService:uA(e),getLiveStreamRenderingService:mA(e),getLmsIntegrationService:pA(e),getLockedTeamsService:gA(e),getLogsFilesService:vA(e),getLokiService:yA(e),getManageTenantService:SA(e),getMeetingArtifactsService:fA(e),getMeetingBotService:kA(e,n.getCalendarService,i.getChatService),getMeetingIntelligenceService:CA(e),getMeetingOptionsClientDataService:TA(e),getMeetingOptionsService:IA(e),getMeetingQuestionsAndAnswersService:NA(e),getMeetingRecapService:AA(e),getMeetingRecapSwaService:EA(e),getMeetingRecapWorkingSetFilesService:FA(e),getMeetingRoomAppEventsService:y,getMeetingTemplateService:_A(e),getMsaAuthenticationService:S,getPaymentService:DA(e),getPeoplePickerService:PA(e),getPeopleService:bA(e),getPeopleTargetingService:MA(e),...PF(e,k,T),getPoliciesService:RA(e),getPresenceService:xA(e),getQueuesHistoricReportingService:LA(e),...MF(e),getODSLProcessingEngine:BA(e),getAddressService:$A(e),getPstnService:VA(e),getSCISService:HA(e),getSearchPrefetchService:zA(e),...jF(e),getSharepointRestClient:f,getShareService:qA(e),getSmbUserIntentService:k,getStoreService:GA(e,I,o,F),getStoreDevicesService:I,getStyleMyRoomService:YA(e),getTenantMembershipService:QA(e),getTenantService:JA(e),getTenantAnalyticsService:KA(e),getTenantPrivacyProfileService:b,getTranscriptService:ZA(e),getTranscriptFeedbackService:XA(e),getTranscriptSettingsStoreService:eE(e),getTranslateService:tE(e),getTargetingHierarchyService:nE(e),getThirdPartyCalendarService:w,getToastImageService:iE(e),getTeamsAndChannelsService:aE(e),getTeamsCopilotAggregator:C,getTeamsCopilotService:yN(e),getTpnNoticeService:oE(e),getUrlPreviewService:rE(e,a.getFilesReferenceService),getUserPreferencesStore:sE(e),getUserProfileService:lE(e),getVirtualEventsService:cE(e),getMeetingSchedulingService:dE(e),getVoicemailService:pE(e),getWebinarService:gE(e),getCallRecordingService:hE(e),getUserLicenseService:T,getDiscoverSurfaceService:g,getMonetizationService:vE(e),getMRUItemService:yE(e),getDiscoverSurfaceFeedbackService:SE(e,g),getCollabCloudService:fE(e),getTFLUserService:kE(e),getSensitivityLabelPolicySettingsService:CE(e),getWaffleService:bE(e),getOrganizationInfoService:N,getVideoMessageCameraCommandService:wE(e)};var _},PF=(e,t,n)=>{const i=TE(e,t,n);return{getPetrolService:i,getFloodgateService:IE(e,i),getOdsService:NE(e,t,n)}},MF=e=>({getLokiMetaPreviewService:AE(e),getOdcFilePreviewService:EE(e),getOSearchService:FE(e),getPeopleSearchService:_E(e),getSubstrateFilesSearchService:DE(e),getSubstrateRecommendationsService:PE(e),getSubstrateSearchService:ME(e),getSubstrateSuggestionsService:RE(e),getSubstrateMeetingSearchService:xE(e),getSubstrateMeetingSummarySearchService:LE(e)}),RF=e=>{const t=OE(e),n=jE(e,t),i=BE(e),a=UE(e),o=$E(e);return{getChatService:t,getChatServiceEndpointProvider:n,getConsumerGroupsService:i,getCSAService:a,getReportConcernService:WE(e),getStatefulLongPoll:o,getUnifiedConsentService:_F(e),getCallingConversationService:VE(e)}},xF=(e,t,n,i)=>{const a=HE(e,i),o=zE(e,i),r=qE(a,o,e),s=GE(e,n),l=(c=e,()=>c.userServicesCache(pw.RefreshSiteUrlService,(()=>YE(c))));var c;return{getFilesRedeemService:o,getFilesReferenceService:QE(r,e),getFilesSharepointUrlService:r,getFileUploadPreviewService:JE(e,t),getFileUploadService:KE(e,i,s,l),getFileDownloadManagerService:ZE(e),getPersonalFileDetailsService:s,getRefreshSiteUrlService:l,getCloudStorageFoldersService:eF(e),getFilesBackfillThreadPropertiesService:tF(e),getSharepointShareService:a,getItemUploadService:lF(e),getItemDeleteService:cF(e),getItemDetailsService:dF(e),getDriveItemShareService:uF(e),getVideoFileService:mF(e,i),getFilesValidDomainsService:pF(e),getFilesSiteResourceInfoService:gF(e),getCustomCopilotBotService:hF(e,i)}},LF=(e,t)=>({getVideoMessageUploadService:vF(e,t)}),OF=e=>({getCalendarService:yF(e),getExternalCalendarEmailAddressService:SF(e),getTeamCalendarService:fF(e),getMeetingRecommendationsService:kF(e),getLiveMeetingStatusBarEventsService:CF(e)}),jF=e=>({getCommonSubstrateService:bF(e),getSignalsService:wF(e)});function BF(e){const t=(n={globalServicesCache:mw,...e},{getExampleGlobalService:TF(n),getGlobalCallingService:IF(n),getLogsFilesService:(i=n,()=>i.globalServicesCache(pw.LogsFilesService,(()=>hA(i)))),getGlobalMTMAUserDataService:NF(n),getGlobalWebAppSwitcherService:AF(n),getGlobalTaskbarService:EF(n)});var n,i;return{entityType:"unknown",windowId:"",...e,...t}}class UF{static createGlobalDataRequestContext(e){if(UF._globalRequestContext)throw new Error("GlobalDataRequestContext is already created!");return UF._globalRequestContext=BF(e),UF._globalRequestContext}static createUserDataRequestContext(e,t){if(!UF._globalRequestContext)throw new Error("GlobalDataRequestContext has not been created!");return function(e,t,n){const i={...e,userServicesCache:(new dw).getOrCreateServiceInstance},{appsRegistryService:a,appStateService:o,authenticationService:r,authenticationUser:s,authStateProvider:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:p,discover:g,experienceChangeReportingService:h,hostCommunicationService:v,localStorage:y,loggerFactory:S,offlineCacheManager:f,platformService:k,pubsub:C,rebootService:b,scenarioFactory:w,userBiService:T,windowProvider:I,i18n:N,brbServiceManager:A,entityCommanding:E,userTrackingService:F,mediaAuthService:_,telemetryContextService:D,cdlWorkerRegistrarService:P}=e;return{...t,appsRegistryService:a,appStateService:o,authenticationUser:s,authenticationService:r,authStateProvider:l,cacheStorage:c,cdlWorkerRegistrarService:P,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:p,discover:g,entityType:"unknown",experienceChangeReportingService:h,hostCommunicationService:v,localStorage:y,loggerFactory:S,mediaAuthService:_,offlineCacheManager:f,platformService:k,pubsub:C,rebootService:b,scenarioFactory:w,telemetryContextService:D,userBiService:T,windowId:"",windowProvider:I,i18n:N,brbServiceManager:A,entityCommanding:E,userTrackingService:F,...DF({...i,cmdApolloClient:n},t)}}(e,UF._globalRequestContext,t)}static get globalRequestContext(){return UF._globalRequestContext}}var $F=n(641361);async function WF(e,t,n,i,a){const o=e.scenarioFactory.findScenario(be.Cu.GraphQLCreateDataClient),r=performance.now(),s=await async function(e,t,n,i,a){const o=e.scenarioFactory.findScenario(be.Cu.GraphQLCreateDataClient);if(e.config.enableEmbedDataClient)return o?.appendEventData({graphQLClientType:"embedDataClient"}),async function(e,t,n,i,a,{resolvers:o}={}){const{dataEvictionService:r,platformService:s,coreSettings:l,config:u}=e,{enableApolloDevtools:m}=l.get(c.w.Diagnostics),p=new qC.Gd,{defaultContext:g,link:h}=await JF(e,a,p,{UNSAFE_resolvers:o}),v=g.leakDetectorService?.create(),y=HF(e,t,n,p,v,h,g.loggerFactory,g.scenarioFactory),S=y({windowId:d.N2,entityType:a,viewportContext:e.windowProvider.viewportContext,name:"embed",storeType:GC.J.embed});return mb(S,"embed",Boolean(m),s,u.experienceName),new Ib({clientResolversFactory:t,writeClientDefaultsFn:n,pubsub:p,leakDetector:v,scenarioFactory:g.scenarioFactory,coreSettings:g.coreSettings,dataOpsTracker:i,dataEvictionService:KF(r)?r:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},S,g)}(e,t,n,i,a,{resolvers:[$F.K]});const{enableMTMA:r}=e.coreSettings.get(c.w.Core);if(r)return o?.appendEventData({graphQLClientType:"MTMACoreDataClient"}),async function(e,t,n,i,a,{resolvers:o}={}){const{coreSettings:r,dataEvictionService:s}=e,l=new qC.Gd,{defaultContext:d,link:u}=await JF(e,a,l,{noCDLTerminatingLink:!0,UNSAFE_resolvers:o}),m=d.leakDetectorService?.create(),p=HF(e,t,n,l,m,u,d.loggerFactory,d.scenarioFactory),{enableApolloDataEviction:g,enableViewSchema:h,enableRelay:v,enableRelayLiveResolverStore:y,relayGCReleaseBufferSize:S}=r.get(c.w.Core);let f,k;h&&(f=qF(e,l,m,Yb.createViewSchemaLink(e),d.loggerFactory,d.scenarioFactory));v&&(k={isLiveResolverStoreEnabled:!0===y,gcReleaseBufferSize:S,entityType:a});return new lw({clientResolversFactory:t,writeClientDefaultsFn:n,pubsub:l,leakDetector:m,scenarioFactory:d.scenarioFactory,coreSettings:d.coreSettings,dataOpsTracker:g?i:void 0,dataEvictionService:g&&KF(s)?s:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},p,d,f,k)}(e,t,n,i,a,{resolvers:[$F.K]});return o?.appendEventData({graphQLClientType:"CoreDataClient"}),VF(e,t,n,i,a,{resolvers:[$F.K]})}(e,t,n,i,a);return o?.appendEventData({graphQLCreateDataClientTimeToStart:performance.now()-r}),s}async function VF(e,t,n,i,a,{resolvers:o}={}){const{coreSettings:r,dataEvictionService:s}=e,l=new qC.Gd,{defaultContext:d,link:u}=await JF(e,a,l,{UNSAFE_resolvers:o}),m=d.leakDetectorService?.create(),p=HF(e,t,n,l,m,u,d.loggerFactory,d.scenarioFactory),{enableApolloDataEviction:g,enableViewSchema:h,enableRelay:v,enableRelayLiveResolverStore:y,relayGCReleaseBufferSize:S}=r.get(c.w.Core);let f,k;return h&&(f=qF(e,l,m,Yb.createViewSchemaLink(e),d.loggerFactory,d.scenarioFactory)),v&&(k={isLiveResolverStoreEnabled:!0===y,gcReleaseBufferSize:S,entityType:a}),new Tb({clientResolversFactory:t,writeClientDefaultsFn:n,pubsub:l,leakDetector:m,scenarioFactory:d.scenarioFactory,coreSettings:d.coreSettings,dataOpsTracker:g?i:void 0,dataEvictionService:g&&KF(s)?s:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},p,d,f,k)}function HF(e,t,n,i,a,o,r,s,l,d){const{appsRegistryService:u,coreSettings:m,platformService:p,config:g,graphqlStoreStatsReporterService:h}=e;let v;v=l||t.create(i);const{maxApolloResultCacheSize:y,enableApolloDoubleWriteFix:S}=m.get(c.w.Core),{enableApolloDevtools:f}=m.get(c.w.Diagnostics),k=y??void 0;return({windowId:e,entityType:t,viewportContext:i,name:l,overrideLink:c,storeType:m})=>{const y=u.getRegisteredAppsTypePolicies(e),C=zF({leakDetector:a,windowId:e,entityType:t,viewportContext:i,userContextId:d},c||o,v,k,r,s,n,y,f,m,h,S);return mb(C,l,Boolean(f),p,g.experienceName),C}}const zF=(e,t,n,i,a,o,r,s,l,c,d,u)=>{const m=(0,KC.es)({typePolicies:ow(s?.typePolicies),possibleTypes:QC,dataIdFromObject:YC.R,resultCacheMaxSize:i,apolloLeakOptions:e,loggerFactory:a,scenarioFactory:o,storeType:c,graphqlStoreStatsReporterService:d,enableApolloDoubleWriteFix:u,enableGlobalObjectIdStoreKeys:!0}),p=(0,KC.PF)({cache:m,link:t,resolvers:n,defaultOptions:{watchQuery:{nextFetchPolicy:rw}},apolloLeakOptions:e,loggerFactory:a,enableApolloDevtools:l,storeType:c,graphqlStoreStatsReporterService:d,notifyOnTeardown:!1,enableApolloDoubleWriteFix:u});return((e,t,n,i)=>{e(t,n),i&&Nb(t,i,n)})(r,m,a,s?.defaultTypeName),p};function qF(e,t,n,i,a,o){const{coreSettings:r,platformService:s,config:l,graphqlStoreStatsReporterService:d}=e,{maxApolloResultCacheSize:u,enableApolloDoubleWriteFix:m}=r.get(c.w.Core),{enableApolloDevtools:p}=r.get(c.w.Diagnostics),g=u??void 0;return({windowId:e,entityType:t,viewportContext:r,name:c,overrideLink:u,storeType:h})=>{const v=GF({leakDetector:n,windowId:e,entityType:t,viewportContext:r},u||i,{},g,a,o,h,d,m);return mb(v,c,Boolean(p),s,l.experienceName),v}}const GF=(e,t,n,i,a,o,r,s,l)=>{const c=(0,KC.es)({typePolicies:{PresenceAvailability:{merge:!0},PresenceOutOfOfficeStatus:{merge:!0},PresenceStatusNote:{merge:!0},ViewData:{merge:!0}},possibleTypes:JC.v,dataIdFromObject:YC.R,resultCacheMaxSize:i,apolloLeakOptions:e,loggerFactory:a,scenarioFactory:o,storeType:r,graphqlStoreStatsReporterService:s,enableGlobalObjectIdStoreKeys:!1});return(0,KC.PF)({cache:c,link:t,resolvers:n,defaultOptions:{watchQuery:{nextFetchPolicy:rw}},apolloLeakOptions:e,loggerFactory:a,storeType:r,graphqlStoreStatsReporterService:s,enableApolloDoubleWriteFix:l})},YF=(e,t,n)=>{const{activeWindowsService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,cdlAppStateService:s,cdlWorkerRegistrarService:l,authenticationService:c,authenticationUser:u,cacheStorage:m,clientPreferences:p,clientState:g,commandChangeReportingService:h,coreSettings:v,discover:y,dataEvictionService:S,experienceChangeReportingService:f,hostCommunicationService:k,leakDetectorService:C,localStorage:b,loggerFactory:w,notificationsHandler:T,offlineCacheManager:I,platformService:N,rebootService:A,scenarioFactory:E,telemetryContextService:F,userBiService:_,windowProvider:D,i18n:P,brbServiceManager:M,entityCommanding:R,userTrackingService:x}=e;return{activeWindowsService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,cdlAppStateService:s,cdlWorkerRegistrarService:l,authenticationService:c,authenticationUser:u,cacheStorage:m,clientPreferences:p,clientState:g,commandChangeReportingService:h,coreSettings:v,discover:y,dataEvictionService:S,entityType:n,experienceChangeReportingService:f,hostCommunicationService:k,leakDetectorService:C,localStorage:b,loggerFactory:w,notificationsHandler:T,offlineCacheManager:I,platformService:N,pubsub:t,rebootService:A,scenarioFactory:E,telemetryContextService:F,userBiService:_,windowId:d.N2,windowProvider:D,i18n:P,brbServiceManager:M,entityCommanding:R,userTrackingService:x}},QF=(e,t)=>{const n=(0,ZC.o)(((t,n)=>({...e,...n})));return XC.C.from([n,t])};async function JF(e,t,n,{noCDLTerminatingLink:i,UNSAFE_resolvers:a}={}){const{networkState:o}=e,r=(0,Bh.nC)(ah.t,o.observeIsOnline()),s={...e,pubsub:n,send:r},l=UF.createGlobalDataRequestContext(s),c=e.scenarioFactory.findScenario(be.Cu.GraphQLCreateDataClient),d=performance.now(),u=await Yb.createSingletonLink({contextValue:l,noCDLTerminatingLink:i,UNSAFE_resolvers:a,...s});return c?.appendEventData({graphQLCreateDefaultLinkStartedTimeToStart:performance.now()-d}),{defaultContext:YF(e,n,t),link:u}}function KF(e){if(!e)return!1;const t=e;return"function"==typeof t.register&&"function"==typeof t.unregister}var ZF=n(418633);const XF={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"quotedReply"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"replyChainId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"quotedReply"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}},{kind:"Argument",name:{kind:"Name",value:"replyChainId"},value:{kind:"Variable",name:{kind:"Name",value:"replyChainId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"preview"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"parentMessageId"}}]}}]}}]},e_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatCopilotAtMentionQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"copilotAtMention"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attachments"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contentUrl"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}}]}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}}]}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},t_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatForwardCardQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"forwardCard"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardCardMessageFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardCardMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ForwardMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardCardMessageCardFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardMessageFileFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"isImportant"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"translatedSubject"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"channelPostSubject"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardCardMessageCardFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ClientCard"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"cardClientId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}},{kind:"Field",name:{kind:"Name",value:"userSpecificContent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"authBlockLastUsedOn"}}]}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardMessageFileFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"File"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"itemId"}},{kind:"Field",name:{kind:"Name",value:"chicletBreadcrumbs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sourceTeamName"}},{kind:"Field",name:{kind:"Name",value:"sourceChannelName"}}]}},{kind:"Field",name:{kind:"Name",value:"baseUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"shareId"}},{kind:"Field",name:{kind:"Name",value:"shareUrl"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"previewUrl"}},{kind:"Field",name:{kind:"Name",value:"previewHeight"}},{kind:"Field",name:{kind:"Name",value:"previewWidth"}},{kind:"Field",name:{kind:"Name",value:"progressComplete"}},{kind:"Field",name:{kind:"Name",value:"hasUploadFailed"}},{kind:"Field",name:{kind:"Name",value:"serviceName"}},{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"providerDataV2"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]}.definitions]}.definitions]};var n_=n(806658),i_=n(737915),a_=n(269483);var o_=n(410703),r_=n(983168),s_=n(969037),l_=n(757010);const c_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chat"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"chatSubType"}},{kind:"Field",name:{kind:"Name",value:"chatType"}},{kind:"Field",name:{kind:"Name",value:"isSfB"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isMeeting"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isMuted"}},{kind:"Field",name:{kind:"Name",value:"isFederated"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isChannel"}},{kind:"Field",name:{kind:"Name",value:"isRetentionHorizonSet"}},{kind:"Field",name:{kind:"Name",value:"isModerator"}},{kind:"Field",name:{kind:"Name",value:"hasBotMember"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonFields"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizonBookmark"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"userConsumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"replyChainListConsumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonFields"}}]}},{kind:"Field",name:{kind:"Name",value:"lastL2MessageIdNotFromSelf"}},{kind:"Field",name:{kind:"Name",value:"showRedDot"}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"botMembers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFields"}}]}},{kind:"Field",name:{kind:"Name",value:"creator"}},{kind:"Field",name:{kind:"Name",value:"meetingInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"meetingInformationFields"}}]}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}},...o_.U.definitions,...r_.q.definitions,...s_.x.definitions,...l_.F.definitions]},d_=e=>({__typename:"ChatDisabledContext",isUIDisabled:e.isUIDisabled,disabledReason:e.disabledReason,extendedData:e.extendedData,lastUpdatedTime:e.lastUpdatedTime}),u_=()=>({__typename:"ChatDisabledContext",isUIDisabled:!1,disabledReason:"UnknownReason",extendedData:null,lastUpdatedTime:null}),m_=()=>({__typename:"ChatDisabledContext",isUIDisabled:!1,disabledReason:"ChatDisabledDueToBotStatus",extendedData:null,lastUpdatedTime:null}),p_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidMessages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}}]}}]}}]},g_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidManifestEntries"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locale"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidManifestEntries"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locale"},value:{kind:"Variable",name:{kind:"Name",value:"locale"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locale"}},{kind:"Field",name:{kind:"Name",value:"entries"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}}]}}]}}]},h_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidPendingMentions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"componentHash"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidPendingMentions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"componentHash"},value:{kind:"Variable",name:{kind:"Name",value:"componentHash"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"atMentionId"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"contentId"}},{kind:"Field",name:{kind:"Name",value:"navigationPath"}}]}}]}}]};const v_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"composeState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"composeState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isExpanded"}}]}}]}}]},y_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"imageAltText"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"imageAltText"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};var S_=n(737024),f_=n(668746);const k_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messagePaneScrolledToStartState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messagePaneScrolledToStartState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isScrolledToStart"}}]}}]}}]},C_={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageFieldsForTranslation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"fromLanguage"}},{kind:"Field",name:{kind:"Name",value:"isChat"}}]}}]}}]},b_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"twoWaySmsFriendlyName"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"twoWaySmsFriendlyName"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};var w_=n(332684);const T_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatInsertTvcComposeQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insertTVCComposeQuery"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cacheId"}}]}}]}}]},I_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatInsertTriggerStreamCameraQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insertTriggerStreamCamera"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cameraTriggerSource"}}]}}]}}]},N_={Query:{fluidManifestEntries:(e,{locale:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{try{const n=e.readQuery({query:g_,variables:{locale:t}});return n?.fluidManifestEntries}catch(e){return void n.newLogger("fluid-manifest-entries","data-client-chat").error("Failed to retrieve the cached fluid manifest json")}})(n,t,i)||null},Conversation:{isFederated:e=>e.isFederated??(0,n_.oZ)(e.id),isMeeting:e=>e.isMeeting??(0,n_.Qi)(e.id),isSfB:e=>e.isSfB??(0,i_.t0)(e.id),chatDisabledContext:e=>(e=>{if(!e)return null;if(!e.chatDisabledContext){const t=e;return t&&t.isDisabled&&t.isOneOnOne&&t.hasBotMember?m_():u_()}return e.chatDisabledContext})(e),isHighImportance:()=>null,isUrgentImportance:()=>null,activeCallsCount:()=>null,datatid:()=>null,displayName:()=>null,hasActiveCalls:()=>null,hasFailedMessages:()=>null,otherMemberMris:()=>null,isNewChat:()=>null,isBotBlocked:()=>null,isBotUser:()=>null,isHidden:()=>null,isContactTagged:()=>null,pictureUpn:()=>null,pinnedIndex:()=>null,showAtMention:()=>null,showMarkers:()=>null,tooltipTitle:()=>null,longTitle:()=>null,pictureGroup:()=>null,lastMessageTime:()=>null,messagePreview:()=>null,messagePreviewAria:()=>null,isLastMessageText:()=>null,plGroupKey:()=>null,presenceSource:()=>null,hasActions:()=>null,canBeDiscarded:()=>null,canBotBeBlocked:()=>null,canBePinned:()=>null,canBeMuted:()=>null,canBeLeft:()=>null,canBeHidden:()=>null,canBeFavorited:()=>null,canTagContact:()=>null,canPopOut:()=>null,canManageApps:()=>null},Mutation:{untranslateMessage:(e,{messageId:t},{cache:n,loggerFactory:i})=>function(e,t,n){if(!t)return null;const i=a_.J1`
    fragment originalMessageFields on Message {
      id
      content
    }
  `;try{const n=e.readFragment({id:`Message:${t}`,fragment:i});return n?n.content:null}catch(e){return n.error(`Failed to get message from cache: ${e}`),null}}(n,t,i.newLogger("untranslateMessage","data-client-chat")),updateChatDisabledContext:(e,{convId:t,isUIDisabled:n,disabledReason:i,extendedData:a},{cache:o})=>((e,t,n,i,a)=>{const o={convId:t},r={__typename:"ChatDisabledContextResponse",message:"",success:!1,chatDisabledContext:u_()};try{const t=e.readQuery({query:c_,variables:o});if(!t||!t.chat)return r.message="Could not update chatDisabledContext for a null chat conversation",r;const s=Date.now().toString();t.chat.chatDisabledContext&&(r.chatDisabledContext={...t.chat.chatDisabledContext});const l={__typename:"ChatDisabledContext",isUIDisabled:n,disabledReason:i,extendedData:a,lastUpdatedTime:s},c={chat:{...t.chat,chatDisabledContext:l}};e.writeQuery({query:c_,variables:o,data:c}),r.success=!0,c&&c.chat&&c.chat.chatDisabledContext&&(r.chatDisabledContext=d_(c.chat.chatDisabledContext))}catch(e){r.message=`Exception: Failed to update chatDisabledContext for conversation ${t}. Exception Details: ${e.message}`}return r})(o,t,n,i,a),resetQuotedReply:(e,{convId:t,replyChainId:n},{cache:i})=>((e,t,n)=>(n.writeQuery({query:XF,variables:{convId:e,replyChainId:t},data:{quotedReply:null}}),!0))(t,n,i),setQuotedReply:(e,{convId:t,quotedReply:n,replyChainId:i},{cache:a})=>((e,{displayName:t,from:n,messageId:i,preview:a,timestamp:o,parentMessageId:r},s,l)=>{const c={quotedReply:{__typename:"QuotedReply",displayName:t,from:n,messageId:i,preview:a,timestamp:o,parentMessageId:r||""}};return l.writeQuery({query:XF,variables:{convId:e,replyChainId:s},data:c}),!0})(t,n,i,a),resetCopilotAtMention:(e,{convId:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{const i={copilotAtMention:null};try{t.writeQuery({query:e_,variables:{convId:e},data:i})}catch{return n.error("Failed to reset copilot at mention in cache"),!1}return!0})(t,n,i.newLogger("resetCopilotAtMention","data-client-chat")),setCopilotAtMention:(e,{convId:t,copilotAtMention:n},{cache:i,loggerFactory:a})=>((e,{attachments:t,content:n,mentions:i,id:a},o,r)=>{const s={copilotAtMention:{__typename:"CopilotAtMention",attachments:t?.map((e=>({__typename:"CopilotAtMentionAttachment",contentUrl:e.contentUrl,id:e.id,name:e.name||null})))||null,content:n,mentions:i?.map((e=>({__typename:"CopilotAtMentionMention",id:e.id,mri:e.mri})))||null,id:a}};try{o.writeQuery({query:e_,variables:{convId:e},data:s})}catch{return r.error("Failed to set copilot at mention in cache"),!1}return!0})(t,n,i,a.newLogger("setCopilotAtMention","data-client-chat")),setInsertTVCCompose(e,{convId:t,cacheId:n},{cache:i}){try{return i.writeQuery({query:T_,variables:{convId:t},data:{insertTVCComposeQuery:{__typename:"InsertedTVC",cacheId:n}}}),!0}catch(e){return!1}},setTriggerStreamCamera(e,{convId:t,cameraTriggerSource:n},{cache:i}){try{const e={insertTriggerStreamCamera:{__typename:"CameraTriggerSource",cameraTriggerSource:n}};return i.writeQuery({query:I_,variables:{convId:t},data:e}),!0}catch(e){return!1}},resetTriggerStreamCamera(e,{convId:t},{cache:n}){try{const e={insertTriggerStreamCamera:null};return n.writeQuery({query:I_,variables:{convId:t},data:e}),!0}catch(e){return!1}},deleteForwardCard:(e,{convId:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{const i={forwardCard:null};try{t.writeQuery({query:t_,variables:{convId:e},data:i})}catch(e){return n.error("Failed to delete forward card from cache"),!1}return!0})(t,n,i.newLogger("deleteForwardCard","data-client-chat")),saveForwardCard:(e,{convId:t,message:n},{cache:i,loggerFactory:a})=>((e,t,n,i)=>{const a={forwardCard:{...t,__typename:"ForwardMessage"}};try{n.writeQuery({query:t_,variables:{convId:e},data:a})}catch(e){return i.error("Failed to save forward card to cache"),!1}return!0})(t,n,i,a.newLogger("saveForwardCard","data-client-chat")),async updateComposeState(e,{id:t,isExpanded:n},{cache:i,loggerFactory:a}){const o={__typename:"ComposeMessageState",id:t,isExpanded:n};try{i.writeQuery({query:v_,variables:{id:t},data:{composeState:{...o,__typename:"ComposeMessageState"}}})}catch(e){a.newLogger("update-compose-state","data-client-chat").error(`Failed to write to client cache the compose state query. Error: ${e.message}`)}return o},async setImageAltText(e,{altText:t},{cache:n,loggerFactory:i}){const a={imageAltText:t};try{n.writeQuery({query:y_,data:a})}catch(e){i.newLogger("update-image-alt-text","data-client-chat").error(`Failed to write to client cache the image alt text query. Error: ${e.message}`)}return!0},async insertHyperlink(e,{displayText:t,address:n},{cache:i,loggerFactory:a}){const o={__typename:"FluidInsertedHyperlink",displayText:t,address:n};try{i.writeQuery({query:S_.i,data:{insertedHyperlink:{...o,__typename:"FluidInsertedHyperlink"}}})}catch(e){a.newLogger("insert-hyperlink-dialog-data","data-client-chat").error(`Failed to write to client cache the insert hyperlink dialog data query. Error: ${e.message}`)}return!0},async setTwoWaySmsFriendlyName(e,{twoWaySmsFriendlyName:t},{cache:n,loggerFactory:i}){const a={twoWaySmsFriendlyName:t};try{n.writeQuery({query:b_,data:a})}catch(e){i.newLogger("update-tfl-two-way-sms-friendly-name","data-client-chat").error(`Failed to write to client cache the tfl two way sms friendly name query. Error: ${e.message}`)}return!0},async updateMessagePaneScrolledToStartState(e,{id:t,isScrolledToStart:n},{cache:i,loggerFactory:a}){const o={__typename:"MessagePaneScrolledToStartState",id:t,isScrolledToStart:n};try{i.writeQuery({query:k_,variables:{id:t},data:{messagePaneScrolledToStartState:{...o,__typename:"MessagePaneScrolledToStartState"}}})}catch(e){a.newLogger("update-chat-bottom-state","data-client-chat").error(`Failed to write to client cache the chat bottom state query. Error: ${e.message}`)}return o},async setDlpDialogData(e,{isReport:t,isOverride:n,justification:i},{cache:a,loggerFactory:o}){const r={__typename:"DlpDialogData",isReport:t,isOverride:n,justification:i};try{a.writeQuery({query:f_.I,data:{dlpDialogData:{...r,__typename:"DlpDialogData"}}})}catch(e){o.newLogger("set-dlp-dialog-data","data-client-chat").error(`Failed to write to client cache the set dlp dialog data query. Error: ${e.message}`)}return r},setFluidMessage:(e,{fluidMessage:t,remove:n},{cache:i,loggerFactory:a})=>(({messageId:e,originalArrivalTime:t},n,i,a)=>{try{const a=i.readQuery({query:p_}),o=n?function(e,t){return{fluidMessages:e?.fluidMessages?.filter((e=>e.messageId!==t))||[]}}(a,e):function(e,t,n){const i=[],a={__typename:"FluidMessage",id:t,messageId:t,originalArrivalTime:n};let o=!1;if(e?.fluidMessages)for(const t of e.fluidMessages)t.originalArrivalTime<a.originalArrivalTime&&!o&&(i.push(a),o=!0),i.push(t);return o||i.push(a),{fluidMessages:i}}(a,e,t);return i.writeQuery({query:p_,data:o}),!0}catch(e){return a.newLogger("set-fluid-messages-pending-load","data-client-chat").error(`Failed to write to client cache the set fluid message pending load query. Error: ${e.message}`),!1}})(t,!!n,i,a),setFluidManifestEntries:(e,{locale:t,entries:n},{cache:i,loggerFactory:a})=>((e,t,n,i)=>{try{const i={fluidManifestEntries:{__typename:"FluidManifestEntries",locale:e,entries:t,timestamp:Date.now()}};return n.writeQuery({query:g_,variables:{locale:e},data:i}),!0}catch(e){return i.newLogger("fluid-manifest-entries","data-client-chat").error(`Failed to write to client cache that set fluid manifest json query. Error: ${e.message}`),!1}})(t,n,i,a),updateFluidPendingMentions:(e,{componentHash:t,pendingMention:n,remove:i},{cache:a,loggerFactory:o})=>((e,t,n,i,a)=>{try{const a={__typename:"FluidPendingMention",...t},o={componentHash:e},r=i.readQuery({query:h_,variables:o}),s=(r?.fluidPendingMentions||[]).filter((e=>a.userPrincipalName!==e.userPrincipalName)),l=n?s:[...s,a];return i.writeQuery({query:h_,variables:o,data:{fluidPendingMentions:l}}),!0}catch(e){return a.newLogger("fluid-resolvers-update-pending-fluid-mentions","data-client-chat").error(`Failed to write pending mentions to the cache, error="${e.message}"`),!1}})(t,n,!!i,a,o),clearFluidPendingMentions:(e,{componentHash:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{try{const n={componentHash:e};return t.writeQuery({query:h_,variables:n,data:{fluidPendingMentions:[]}}),!0}catch(e){return n.newLogger("fluid-resolvers-clear-fluid-pending-mentions","data-client-chat").error(`Failed to clear pending mentions from the cache, error="${e.message}"`),!1}})(t,n,i),resetSmartReplyFileSuggestion:(e,{convId:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{const i={smartReplyFileSuggestion:null};try{return t.writeQuery({query:w_.l,variables:{convId:e},data:i}),!0}catch(e){return n.newLogger("ResetSmartReplyFileSuggestion","data-client-chat").error(`Failed to reset smart reply file suggestion in cache: ${e}`),!1}})(t,n,i),setSmartReplyFileSuggestion:(e,{convId:t,fileSuggestion:n},{cache:i,loggerFactory:a})=>((e,{fileName:t,url:n},i,a)=>{try{const a={smartReplyFileSuggestion:{__typename:"SmartReplyFileSuggestion",fileName:t,url:n}};return i.writeQuery({query:w_.l,variables:{convId:e},data:a}),!0}catch(e){return a.newLogger("SetSmartReplyFileSuggestion","data-client-chat").error(`Failed to set smart reply file suggestion in cache: ${e}`),!1}})(t,n,i,a)},Message:{deletionInfo:(e,t,{cache:n})=>(0,ZF.Rm)(n,e),translation:(e,t,{cache:n})=>{try{const t=`Message:${e.id}`,i=n.readFragment({id:t,fragment:C_})?.translation;return i?{...i,__typename:"Translation"}:null}catch{return null}},diagnosticInfo:()=>({__typename:"DiagnosticInfo",diagnosticErrorCode:-1,diagnosticMessage:null})}},A_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormBlockingTasksQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormBlockingTasks"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}}]}}]},E_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormTerminatingActionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormTerminatingAction"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},F_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormActiveTabQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormActiveTab"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]},__={Query:{schedulingFormActiveTab(e,t,{cache:n,loggerFactory:i}){try{const e=n.readQuery({query:F_});return e?.schedulingFormActiveTab??null}catch{const e=i.newLogger("scheduling-form-active-tab","data-client-calendar");return e.errorToTelemetry?.("schedulingFormActiveTab: Failed to fetch scheduling form active tab from cache.","calendar_form_active_tab"),null}},schedulingFormBlockingTasks(e,t,{cache:n,loggerFactory:i}){try{const e=n.readQuery({query:A_});return e?.schedulingFormBlockingTasks??[]}catch(e){const t=i.newLogger("scheduling-form-blocking-task","data-client-calendar");return t.errorToTelemetry?.("schedulingFormBlockingTasks: Failed to fetch scheduling form blocking task from cache.","calendar_form_blocking_tasks"),[]}},schedulingFormTerminatingAction(e,t,{cache:n,loggerFactory:i}){try{return n.readQuery({query:E_})?.schedulingFormTerminatingAction??null}catch{const e=i.newLogger("scheduling-form-terminating-action","data-client-calendar");return e.errorToTelemetry?.("schedulingFormTerminatingAction: Failed to fetch scheduling form terminating action from cache.","calendar_form_terminating_action"),null}}},Mutation:{addSchedulingFormBlockingTask(e,{input:{task:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("add-scheduling-form-blocking-task","data-client-calendar"),o=(0,E.v4)();try{const e=n.readQuery({query:A_})?.schedulingFormBlockingTasks??[],i=e.find((e=>e.type===t.type));if(i&&"Active"===i.state)return a.errorToTelemetry?.("addSchedulingFormBlockingTask: Failed to write scheduling form blocking task in cache. Existing active task of same type already exists.","calendar_form_blocking_tasks"),null;const r=(i?e.filter((e=>e.type!==t.type)):e).concat([{__typename:"SchedulingFormTask",...t,id:o}]);n.writeQuery({query:A_,data:{schedulingFormBlockingTasks:r}})}catch{return a.errorToTelemetry?.("addSchedulingFormBlockingTask: Failed to write scheduling form blocking task in cache.","calendar_form_blocking_tasks"),null}return{...t,id:o,__typename:"SchedulingFormTask"}},updateSchedulingFormBlockingTask(e,{input:{type:t,state:n}},{cache:i,loggerFactory:a}){const o=a.newLogger("update-scheduling-form-blocking-task","data-client-calendar");try{let e=-1;const a=(i.readQuery({query:A_})?.schedulingFormBlockingTasks??[]).map(((i,a)=>i?.type===t?(e=a,{...i,state:n}):i));return-1===e?(o.errorToTelemetry?.("updateSchedulingFormBlockingTask: Failed to update scheduling form blocking task in cache. Task does not exist.","calendar_form_blocking_tasks"),null):a[e]}catch(e){return o.errorToTelemetry?.("updateSchedulingFormBlockingTask: Failed to update scheduling form blocking task in cache.","calendar_form_blocking_tasks"),null}},removeSchedulingFormBlockingTask(e,{input:{type:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("remove-scheduling-form-blocking-task","data-client-calendar");try{const e=n.readQuery({query:A_})?.schedulingFormBlockingTasks??[],i=e.find((e=>e.type===t));if(!i)return null;const a=e.filter((e=>e?.type!==t));return n.writeQuery({query:A_,data:{schedulingFormBlockingTasks:a}}),i}catch(e){return a.errorToTelemetry?.("removeSchedulingFormBlockingTask: Failed to remove scheduling form blocking task from cache.","calendar_form_blocking_tasks"),null}},setSchedulingFormActiveTab(e,{input:t},{cache:n,loggerFactory:i}){const a=null===t?null:{...t,__typename:"SchedulingFormTab"};try{return n.writeQuery({query:F_,data:{schedulingFormActiveTab:a}}),a}catch{const e=i.newLogger("scheduling-form-active-tab","data-client-calendar");return e.errorToTelemetry?.("setSchedulingFormActiveTab: Failed to set scheduling form active tab in cache.","calendar_form_active_tab"),null}},setSchedulingFormTerminatingAction(e,{input:{type:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("set-scheduling-form-terminating-action","data-client-calendar");try{n.writeQuery({query:E_,data:{schedulingFormTerminatingAction:t}})}catch{return a.errorToTelemetry?.("setSchedulingFormTerminatingAction: Failed to update scheduling form terminating task in cache.","calendar_form_terminating_action"),!1}return!0}}};var D_=n(609113);var P_=n(46751);const M_={Mutation:{addFileUpload(e,{fileToAdd:t},{cache:n}){const{fileContainerId:i}=t,a=(({uploadId:e,fileName:t,serviceName:n,context:i})=>({title:t,status:"PROGRESS",id:e,itemId:null,type:(0,D_.QC)(t),objectUrl:"",baseUrl:"",progress:1,fileId:"",isReferencedFile:!1,shareUrl:"",shareId:"",previewUrl:"",chicletBreadcrumbs:null,context:i??null,permissionScope:null,previewHeight:null,previewWidth:null,progressComplete:null,state:"active",hasUploadFailed:!1,serviceName:n,externalFileShareInfo:"",sharepointIds:null,publication:null,site:null,__typename:"FileUpload"}))(t);return(0,P_.OI)([a],n,i),!0},removeFileUpload(e,{input:t},{cache:n}){const{uploadId:i,fileContainerId:a}=t;return(0,P_.J9)(i,a,n),!0}}};var R_=n(606855);const x_=e=>{if(e){const{appIcon:t,appId:n,appName:i,contentType:a,content:o,locale:r}=e;return{__typename:"PlatformCard",appIcon:t||null,appId:n||null,appName:i||null,content:o,contentType:a,locale:r||null}}return null};var L_=n(501223);var O_=n(785279);var j_=n(828822);var B_=n(800520);const U_={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"platformAppsFetchPolicyFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PlatformAppsFetchPolicy"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"forceNetworkFetch"}},{kind:"Field",name:{kind:"Name",value:"scope"}},{kind:"Field",name:{kind:"Name",value:"convId"}}]}}]},$_="PlatformAppsFetchPolicy",W_="PlatformAppsFetchPolicyMetadata",V_=a_.J1`
  fragment PlatformAppsFetchPolicyMetadata_FetchPolicyIds on PlatformAppsFetchPolicyMetadata {
    fetchPolicyIds
  }
`,H_=a_.J1`
  fragment PlatformAppsFetchPolicy_ForceNetwork on PlatformAppsFetchPolicy {
    forceNetworkFetch
  }
`,z_=(e,t)=>{let n=`${$_}:${e}`;return t&&(n=`${n}:${t}`),n},q_=(e,t,n,i)=>{let a=!0;try{const a=z_(t.scope,t.convId);e.writeFragment({id:a,fragment:U_,data:t});const{enableContextlessFetchPolicyUpdates:o}=n.get(c.w.Extensibility);o&&Q_(e,a,i)}catch(e){a=!1}return a},G_=(e,t,n)=>{let i=`${e}`;return t&&(i=`${i}:${t}`),{__typename:$_,id:i,scope:e,forceNetworkFetch:n,convId:t??null}},Y_=e=>{try{const t=e.readFragment({id:W_,fragment:V_});return t?.fetchPolicyIds??[]}catch(e){throw e}},Q_=(e,t,n)=>{const i=n.newLogger("updateFetchPolicyIds","data-client-platform");try{let n=Y_(e);if(n.includes(t))return;n=n.concat(t),e.writeFragment({id:W_,fragment:V_,data:{__typename:W_,fetchPolicyIds:n}})}catch(e){i.errorToTelemetry?.(`updateFetchPolicyIds: failed to update fetch policy ids when adding ${t}`,"platform_apps_fetch_policy_update_ids_resolver")}};var J_=n(609904);var K_=n(189261);var Z_=n(182747);const X_={__typename:"MessageExtensionsAppsState",toggleRefetch:!1},eD=(e,t)=>{try{const n=e.readQuery({query:Z_.a,variables:{convId:t}});if(!n)throw new Error("Unable to read ME apps state from cache");return n}catch(e){throw e}};var tD=n(763499);var nD=n(513199);var iD=n(249649);var aD=n(530811);var oD=n(335483),rD=n(950362);var sD=n(541381);var lD=n(759528);var cD=n(186070);var dD=n(756160);var uD=n(603912);const mD="AppCaching resolver: ",pD={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformCachedAppListQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cachedAppList"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedSourceWindow"}},{kind:"Field",name:{kind:"Name",value:"apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"globalAppId"}},{kind:"Field",name:{kind:"Name",value:"isCachedAndHidden"}},{kind:"Field",name:{kind:"Name",value:"lastLoaded"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"isPreloadedApp"}}]}}]}}]}}]},gD=(e,t,n,i,a)=>{if(!e)return!1;const{lastUpdatedSourceWindow:o}=e;try{const r=t.readQuery({query:pD}),s=n({input:e,cacheData:r,coreSettings:a,logger:i});if((0,we.isEqual)(s,r?.cachedAppList.apps))i?.warn("cache write skipped, data unchanged");else{i?.log("cached app list updated, writing query");const e={cachedAppList:{__typename:"CachedAppList",id:"appcaching",apps:s,lastUpdatedSourceWindow:o}};t.writeQuery({query:pD,data:e})}return!0}catch{return!1}},hD=e=>{const t={};return e.forEach((e=>t[e.globalAppId]=e)),t},vD=e=>e.length&&e[0].appId?{"App.Id":e[0].appId}:void 0,yD=e=>{const{cacheData:t,input:n,logger:i}=e;return(({apps:e},t,n)=>{const i=hD(t),a=e.filter((e=>!i[e.globalAppId]));return a.length!==e.length&&n?.warnToTelemetry?.("duplicate apps found in mutation input","platform_app_caching_duplciate_apps_in_mutation_input",vD(e),!0),t.concat(a.map((e=>({...e,__typename:"CachedApp",lastLoaded:e.lastLoaded??null,appId:e.appId??null,appName:e.appName??null,isPreloadedApp:e.isPreloadedApp??!1}))))})(n,t?.cachedAppList.apps??[],i)},SD=e=>{const{cacheData:t,input:{apps:n},logger:i}=e,a=hD(n);let o=[];return t?.cachedAppList.apps&&(o=t?.cachedAppList.apps.filter((e=>!a[e.globalAppId])),o.length===t?.cachedAppList.apps.length&&i?.errorToTelemetry?.("app to remove is not in the cached app list","platform_app_caching_missing_cached_app_on_update",vD(n),!0)),o},fD=(e,t,n)=>{let i,a=-1;for(const n of e)(!i||n.lastLoaded&&n.lastLoaded<i)&&(a=t.indexOf(n),i=n.lastLoaded);const o=[...t];return-1!==a&&(o.splice(a,1),n?.log("app removed from global cache due to exceeding shared cache size")),o},kD=e=>{const{cacheData:t,input:{apps:n},coreSettings:i,logger:a}=e,o=i?.get(c.w.Extensibility),r=o?.appCachingMaxSizeNS;let s=[];if(t?.cachedAppList.apps){const e=hD(t?.cachedAppList.apps);s=n.map((t=>{let n;const i=e[t.globalAppId];i?n=i:(n=t,a?.log(`adding app ${t.appId} to cache that was not found during update.`));const o=t.lastLoaded??null,r=t.isCachedAndHidden,s=n.appId??null,l=n.appName??null,c=n.isPreloadedApp??!1;return{...n,__typename:"CachedApp",lastLoaded:o,appId:s,isCachedAndHidden:r,appName:l,isPreloadedApp:c}}));const i=hD(s);s=s.concat(t.cachedAppList.apps.filter((e=>!i[e.globalAppId])))}return r?((e,t,n)=>{const i=e.filter((e=>e.isCachedAndHidden));return!i.length||i.length<=t?e:fD(i,e,n)})(s,r,a):s};var CD=n(793236);var bD=n(958956);var wD=n(883038);const TD={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformMetaosApplicationSearchHandlerStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"metaosApplicationSearchHandlerState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"registered"}}]}}]}}]},ID={Query:{platformAppsBatchFetchPolicy:(e,{options:t},{cache:n})=>{const i=t.map((({scope:e,convId:t})=>((e,{scope:t,convId:n})=>{let i;try{const a=z_(t,n),o=e.readFragment({id:a,fragment:U_});i=o?.forceNetworkFetch}catch(e){i=!1}return G_(t,n,i??!1)})(n,{scope:e,convId:t})));return i},messageExtensionsAppsState:()=>X_},Mutation:{toggleAppsRefetch:(e,{convId:t},{cache:n})=>{try{const e=eD(n,t),{messageExtensionsAppsState:i}=e,a=!i.toggleRefetch,o={messageExtensionsAppsState:{...i,toggleRefetch:a}};n.writeQuery({query:Z_.a,variables:{convId:t},data:o});return eD(n,t).messageExtensionsAppsState.toggleRefetch}catch(e){throw e}},updateTaskModuleResult:(e,{text:t,taskModuleId:n,draftId:i,card:a,conversationId:o,adaptiveCardTabResult:r,reason:s,entryPoint:l},{cache:c})=>{try{const e={taskModuleResult:{__typename:"TaskModuleResult",text:t??null,card:x_(a),adaptiveCardTabResult:(r&&r.map((e=>x_(e))))??null,taskModuleId:n,draftId:i??null,conversationId:o??null,reason:s,entryPoint:l}};return c.writeQuery({query:R_.m,data:e}),!0}catch{return!1}},resetTaskModuleResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:R_.m,data:{taskModuleResult:null}}),!0}catch{return!1}},updateAppDetailsResult:(e,{input:t},{cache:n})=>{try{if(!t)throw new Error("No appInstallDetails input received");const{appId:e,appInstallId:i,isAppInstalled:a,errorCode:o}=t,r={appDetailsResult:{__typename:"AppDetailsResult",appInstallId:i,appId:e,isAppInstalled:a,errorCode:o||null}};return n.writeQuery({query:L_.W,data:r}),!0}catch{return!1}},updateInContextStoreLaunchInstalledAppResult:(e,{input:t},{cache:n})=>{try{let e;if(t){const{id:n,appId:i,capability:a,appDisplayName:o=null,draftId:r=null,botId:s=null,appCommand:l=null}=t;e={inContextStoreLaunchInstalledAppResult:{__typename:"InContextStoreLaunchInstalledAppResult",id:n,appId:i,capability:a,appDisplayName:o,draftId:r,botId:s,appCommand:l}}}else e={inContextStoreLaunchInstalledAppResult:null};return n.writeQuery({query:O_.O,data:e}),!0}catch{return!1}},setPlatformAppsFetchPolicy:(e,{input:t},{cache:n,loggerFactory:i,coreSettings:a})=>((e,t,n,i)=>{let a=!0;for(const o of t){let t=!0;const r={__typename:$_,forceNetworkFetch:"Network"===o.fetchSource,scope:o.scope,convId:o.convId??null};t=q_(e,r,n,i),a=a&&t}return a})(n,t,a,i),updateAllPlatformAppsFetchPolicies:(e,{fetchSource:t},{cache:n,loggerFactory:i,scenarioFactory:a})=>{let o=!0;const r=i.newLogger("updateAllPlatformAppsFetchPolicies","data-client-platform"),s=a.newScenario(be.Cu.UpdateAllPlatformAppsFetchPolicies),l=Y_(n),c=l.length;s.appendEventData({appCount:c});for(const e of l)try{n.writeFragment({id:e,fragment:H_,data:{__typename:$_,forceNetworkFetch:"Network"===t}})}catch(n){o=!1,r.errorToTelemetry?.(`updateAllPlatformAppsFetchPolicies: failed to update fetch policy for ${e} to ${t}`,"platform_apps_fetch_policy_update_all_resolver")}return o?(s.stop(),!0):(s.fail(),!1)},updateTabConfigurationResult:(e,{id:t,tabId:n},{cache:i})=>{try{const e={tabConfigurationResult:{__typename:"tabConfigurationResult",id:t,tabId:n}};return i.writeQuery({query:tD.w,variables:{threadId:t},data:e}),!0}catch{return!1}},updateTabDeletionResult:(e,{threadId:t,channelMeetingMessageId:n,tabId:i},{client:a})=>{try{const e={tabDeletionResult:{__typename:"TabDeletionResult",threadId:t,channelMeetingMessageId:n,tabId:i}};return a.writeQuery({query:nD.C,variables:{threadId:t,channelMeetingMessageId:n},data:e}),!0}catch{return!1}},updateMessageToParentResult:(e,{appId:t,message:n},{cache:i})=>{try{const e={messageToParentResult:{__typename:"messageToParentResult",appId:t,message:n}};return i.writeQuery({query:iD.r,variables:{appId:t},data:e}),!0}catch{return!1}},updateMessageToChildResult:(e,{appId:t,message:n},{cache:i})=>{try{const e={messageToChildResult:{__typename:"messageToChildResult",appId:t,message:n}};return i.writeQuery({query:aD.B,variables:{appId:t},data:e}),!0}catch{return!1}},updateAppButtonSettings:(e,{appId:t,action:n},{cache:i})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={appButtonResult:{__typename:"AppButtonResult",appId:t,action:n}};return i.writeQuery({query:sD.D,variables:{appId:t},data:e}),!0}catch{return!1}},updateChangeSettings:(e,{id:t,status:n,appId:i,tabId:a},{cache:o})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={changeSettingsResult:{__typename:"ChangeSettingsResult",id:t,status:n,appId:i??null,tabId:a??null}};return o.writeQuery({query:oD.Z,variables:{id:t},data:e}),!0}catch{return!1}},triggerChangeSettings:(e,{id:t,message:n,appId:i,tabId:a},{cache:o})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={changeSettingsTriggerResult:{__typename:"ChangeSettingsTriggerResult",id:t,message:n,appId:i??null,tabId:a??null}};return o.writeQuery({query:rD.Z,variables:{id:t},data:e}),!0}catch{return!1}},updateSelectMediaResult:(e,{input:t},{cache:n})=>{try{const{selectMediaError:e,mediaUrls:i}=t,a={selectMediaResult:{__typename:"SelectMediaResult",selectMediaError:e??null,mediaUrls:i??null}};return n.writeQuery({query:J_.Z,data:a}),!0}catch{return!1}},resetSelectMediaResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:J_.Z,data:{selectMediaResult:null}}),!0}catch{return!1}},updateViewImagesResult:(e,{input:t},{cache:n})=>{try{const{viewImagesError:e,errorCode:i}=t,a={viewImagesResult:{__typename:"ViewImagesResult",viewImagesError:e??null,errorCode:i??null}};return n.writeQuery({query:K_.g,data:a}),!0}catch{return!1}},resetViewImagesResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:K_.g,data:{viewImagesResult:null}}),!0}catch{return!1}},updateMapCoordinateResult:(e,{locationApiResult:t},{cache:n})=>{try{const{latitude:e,longitude:i,locationApiError:a}=t,o={mapCoordinateResult:{__typename:"MapCoordinateResult",latitude:e??null,longitude:i??null,locationApiError:a??null}};return n.writeQuery({query:j_.V,data:o}),!0}catch{return!1}},resetMapCoordinateResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:j_.V,data:{mapCoordinateResult:null}}),!0}catch{return!1}},resetSelectPeoplePickerResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:B_.m,data:{selectPeoplePickerResult:[]}}),!0}catch{return!1}},updateSelectPeoplePickerResult:(e,{selectPeoplePickerResult:t},{cache:n})=>{try{const e={selectPeoplePickerResult:t.map((e=>({__typename:"SelectPeoplePickerResult",objectId:e.objectId,displayName:e.displayName||"",email:e.email||""})))};return n.writeQuery({query:B_.m,data:e}),!0}catch{return!1}},updateCustomAppUploadResult:(e,{input:t},{cache:n})=>{try{if(!t)throw new Error("No customAppUpload input received");const{customAppType:e}=t,i={customAppUploadResult:{__typename:"CustomAppUploadResult",customAppType:e}};return n.writeQuery({query:lD.m,data:i}),!0}catch{return!1}},updateShowLocationResult:(e,{response:t},{cache:n})=>{try{const e={showLocationResponse:t??null};return n.writeQuery({query:cD.z,data:e}),!0}catch{return!1}},resetShowLocationResponse:(e,t,{cache:n})=>{try{return n.writeQuery({query:cD.z,data:{showLocationResponse:null}}),!0}catch{return!1}},updateWebhookConfirmationResult:(e,{input:t},{cache:n})=>{try{if(!t)throw new Error("No webhookConfirmation input received");const e={webhookConfirmationResult:t};return n.writeQuery({query:dD.Z,data:e}),!0}catch{return!1}},setAppDevicePermissionsUpdated:(e,{input:t},{cache:n})=>{if(!t||!t.id||!t.status)throw new Error("Incorrect input received; id and status are required");try{const{id:e,status:i}=t,a={appDevicePermissionsUpdated:{__typename:"AppDevicePermissionsUpdated",id:e,status:i}};return n.writeQuery({query:uD.u,data:a,variables:{input:e}}),a.appDevicePermissionsUpdated}catch{return null}},addSharedPlatformCachedApps:(e,{input:t},{cache:n,loggerFactory:i})=>gD(t,n,yD,i?.newLogger(`${mD}addSharedPlatformCachedApps`,"data-client-platform")),removeSharedPlatformCachedApps:(e,{input:t},{cache:n,loggerFactory:i})=>gD(t,n,SD,i?.newLogger(`${mD}removeSharedPlatformCachedApps`,"data-client-platform")),updateSharedPlatformCachedApps:(e,{input:t},{cache:n,loggerFactory:i,coreSettings:a})=>gD(t,n,kD,i?.newLogger(`${mD}updateSharedPlatformCachedApps`,"data-client-platform"),a),setLocalFrameContext:(e,{localFrameContext:t},{cache:n})=>{try{const e={localFrameContext:{__typename:"LocalFrameContext",id:t.id,threadId:t.threadId??null,messageId:t.messageId??null,tabId:t.tabId??null,websiteUrl:t.websiteUrl??null,contentUrl:t.contentUrl??null}};return n.writeQuery({query:CD.R,data:e}),e.localFrameContext}catch{return null}},resetLocalFrameContext:(e,t,{cache:n})=>{try{return n.writeQuery({query:CD.R,data:{localFrameContext:null}}),null}catch(e){throw e}},setAppsBadgeRead:(e,{isRead:t},{cache:n})=>{try{return n.writeQuery({query:bD.L,data:{appsBadgeRead:!!t}}),!0}catch{return!1}},setBackButtonHandlerState:(e,{backButtonHandlerState:t},{cache:n})=>{try{const e={backButtonHandlerState:{__typename:"BackButtonHandlerState",id:t.id,registered:t.registered??!1}};return n.writeQuery({query:wD.E,data:e}),e.backButtonHandlerState}catch{return null}},resetBackButtonHandlerState:(e,t,{cache:n})=>{try{return n.writeQuery({query:wD.E,data:{backButtonHandlerState:null}}),null}catch(e){throw e}},setMetaosApplicationSearchHandlerState:(e,{metaosApplicationSearchHandlerState:t},{cache:n})=>{try{const e={metaosApplicationSearchHandlerState:{__typename:"MetaosApplicationSearchHandlerState",id:t.id,registered:t.registered??!1}};return n.writeQuery({query:TD,data:e}),e.metaosApplicationSearchHandlerState}catch{return null}},resetMetaosApplicationSearchHandlerState:(e,t,{cache:n})=>{try{return n.writeQuery({query:TD,data:{metaosApplicationSearchHandlerState:null}}),null}catch(e){throw e}}}};var ND=n(665467),AD=n(942096),ED=n(653171);const FD={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"lpcState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lpcState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isLivePersonaCardInitialized"}},{kind:"Field",name:{kind:"Name",value:"lastLoggedInUserMri"}}]}}]}}]},_D={Query:{lpcState:(e,t,{cache:n})=>n.readQuery({query:FD})},Mutation:{setLpcState(e,{newLpcState:t},{cache:n}){const i={lpcState:{...t,__typename:"LpcState"}};return n.writeQuery({query:FD,data:i}),i.lpcState}}};var DD=n(18995),PD=n(728856);const MD=10,RD="emptyLinkedEntityId",xD=()=>({__typename:"Entity",action:ke.SY.view,entityState:{__typename:"EntityState",flushableByLinkedEntity:!0},id:d.N2,linkedEntity:null,type:ke.ck.blank,options:null,windowOptions:null});function LD(){return{__typename:"ActiveEntities",midNavEntity:null,subNavEntity:null,startEntity:null,headerEntity:null,mainEntity:xD(),endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}}function OD(e,t){return!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action)}function jD(e,t){return OD(e,t.midNavEntity)||OD(e,t.subNavEntity)||OD(e,t.headerEntity)||OD(e,t.mainEntity)}function BD(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action&&e?.entityState.flushableByLinkedEntity===t?.entityState.flushableByLinkedEntity&&e?.options===t?.options&&function(e,t){if(!e&&!t)return!0;if(e&&t)return e.action===t.action&&e.id===t.id&&e.type===t.type;return!1}(e?.linkedEntity,t?.linkedEntity))}function UD(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action&&e?.options===t?.options)}function $D(e,t,n){const i=new Map,a=new Map;for(const o of e){if(n&&!n(o))continue;const{mainEntity:e,endEntity:r}=o.activeEntities,s=o.userContextId;i.set(t(e,s),[o,e]);const{linkedEntity:l}=e;if(l&&a.set(t(l,s),[o,l]),r){i.set(t(r,s),[o,r]);const{linkedEntity:e}=r;e&&a.set(t(e,s),[o,e])}}return[i,a]}function WD(e,t){return`${e.type}-${e.id}-${t}`}function VD(e){return!!e.activeEntities}function HD(e,t){if(!t)return{midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null};const{__typename:n,...i}=t,a={...i};if(!e)return a;const{midNavEntity:o,subNavEntity:r,headerEntity:s,startEntity:l,mainEntity:c,endEntity:d,entityExtension:u,monitorEntity:m,inAppNotificationsEntity:p}=e,{midNavEntity:g,subNavEntity:h,headerEntity:v,startEntity:y,mainEntity:S,endEntity:f,entityExtension:k,monitorEntity:C,inAppNotificationsEntity:b}=t;return a.subNavEntity=OD(r,h)?null:h,a.midNavEntity=OD(o,g)?null:g,a.headerEntity=OD(s,v)?null:v,a.startEntity=OD(l,y)?null:y,a.mainEntity=OD(c,S)?null:S,a.endEntity=OD(d,f)?null:f,a.entityExtension=OD(u,k)?null:k,a.monitorEntity=OD(m,C)?null:C,a.inAppNotificationsEntity=OD(p,b)?null:b,a}function zD(e,t,n=!0){const i=VD(e)?e.activeEntities:null,a=VD(t)?t.activeEntities:null;if(!i||!a)return!0;const{midNavEntity:o,subNavEntity:r,headerEntity:s,startEntity:l,mainEntity:c,endEntity:d,entityExtension:u,monitorEntity:m,inAppNotificationsEntity:p}=i,{midNavEntity:g,subNavEntity:h,headerEntity:v,startEntity:y,mainEntity:S,endEntity:f,entityExtension:k,monitorEntity:C,inAppNotificationsEntity:b}=a,w=n?BD:UD;return!(e.userContextId===t.userContextId&&function(e,t){if(e&&t)return e.blockedCommand?.stateTransition===t.blockedCommand?.stateTransition&&e.blockedCommand?.visibilityState===t.blockedCommand?.visibilityState&&BD(e.blockedEntity,t.blockedEntity)&&e.blockedEntityOptions===t.blockedEntityOptions;if(!e&&!t)return!0;return!1}(e.blockingEntityExtension,t.blockingEntityExtension)&&w(o,g)&&w(r,h)&&w(s,v)&&w(l,y)&&w(c,S)&&w(d,f)&&w(u,k)&&w(m,C)&&w(p,b))}function qD(e){return!(e.midNavEntity||e.subNavEntity||e.headerEntity||e.startEntity||e.mainEntity||e.endEntity||e.entityExtension)}const GD=e=>({midNavEntity:e?.midNavEntity||null,subNavEntity:e?.subNavEntity||null,headerEntity:e?.headerEntity||null,startEntity:e?.startEntity||null,mainEntity:e?.mainEntity||null,endEntity:e?.endEntity||null,entityExtension:e?.entityExtension||null,monitorEntity:e?.monitorEntity||null,inAppNotificationsEntity:e?.inAppNotificationsEntity||null});function YD(e,t,n=!1){if(!t)return GD(e);const i={...t};if(!e)return i;const{midNavEntity:a,subNavEntity:o,headerEntity:r,startEntity:s,mainEntity:l,endEntity:c,entityExtension:d,monitorEntity:u,inAppNotificationsEntity:m}=e,{midNavEntity:p,subNavEntity:g,headerEntity:h,startEntity:v,mainEntity:y,endEntity:S,entityExtension:f,monitorEntity:k,inAppNotificationsEntity:C}=t,b=n?(e,t)=>BD(e,t):(e,t)=>OD(e,t);return i.subNavEntity=b(o,g)?null:g??o,i.headerEntity=b(r,h)?null:h??r,i.startEntity=b(s,v)?null:v??s,i.mainEntity=b(l,y)?null:y??l,i.midNavEntity=b(a,p)?null:p??a,i.endEntity=b(c,S)?null:S??c,i.entityExtension=b(d,f)?null:f??d,i.monitorEntity=b(u,k)?null:k??u,i.inAppNotificationsEntity=b(m,C)?null:C??m,i}function QD(e){return!!(e.mainEntity||e.endEntity||e.entityExtension||e.monitorEntity)}function JD(){return{__typename:"ExtendedEntityContainerState",containerState:g.iW.Closed,isExternal:!1}}const KD=()=>({id:(0,E.v4)(),startTimestamp:Date.now().toString(),source:A.p.Unknown});function ZD(e){if(!e)return null;const{action:t=null,entityState:n={flushableByLinkedEntity:!0},id:i,linkedEntity:a=null,options:o=null,type:r,windowOptions:s=null}={...e};return{action:t??ke.SY.view,entityState:{flushableByLinkedEntity:n.flushableByLinkedEntity,__typename:"EntityState"},id:i||null,linkedEntity:a&&eP(a)||null,options:o,type:r,windowOptions:s?{...s,__typename:"WindowOptions"}:null,__typename:"Entity"}}function XD(e,t,n){return{id:e.id||null,type:e.type,action:e.action,options:t||null,windowOptions:n?{...n,__typename:"WindowOptions"}:null,linkedEntity:e.linkedEntity&&eP(e.linkedEntity)||null,entityState:{flushableByLinkedEntity:!0,__typename:"EntityState"},__typename:"Entity"}}function eP(e){return{action:e.action||null,id:e.id?e.id:RD,type:e.type,__typename:"LinkedEntity"}}const tP=e=>e?{...e,options:null}:null,nP=e=>({...e,midNavEntity:tP(e.midNavEntity),subNavEntity:tP(e.subNavEntity),headerEntity:tP(e.headerEntity),startEntity:tP(e.startEntity),mainEntity:tP(e.mainEntity),endEntity:tP(e.endEntity)}),iP=e=>e?(0,kt.Lw)(e):null,aP=(e,t,n)=>{const i=t&&e.getApp({entityType:t.type})?.manifest.id;i&&n.add(i)},oP=(e,t)=>{const{midNavEntity:n,subNavEntity:i,headerEntity:a,startEntity:o,mainEntity:r,endEntity:s}=t,l=new Set;return aP(e,n,l),aP(e,i,l),aP(e,a,l),aP(e,o,l),aP(e,r,l),aP(e,s,l),l};function rP({appsRegistryService:e,currentWindowId:t,newReactiveValues:n}){n&&(e.resetAllViewState(t),Object.keys(n).forEach((i=>{e.setReactiveValuesForApp(t,i,n[i])})))}const sP=e=>{if(!e)return;let t={};return t=Object.keys(e).reduce(((t,n)=>({...t,[n]:e[n].read()})),{}),t},lP={__typename:"SlotLayoutConfig",displayMode:Yt.UU.INLINE,foldState:Yt.Vt.DEFAULT,height:null,isHidden:!1,width:null},cP=(e,t={resetMonitor:!0,resetTitleBar:!0})=>(e.layoutConfig.slots={...e.layoutConfig.slots,...uP(),...!t.resetMonitor&&{monitor:e.layoutConfig.slots?.monitor},...!t.resetTitleBar&&{titleBar:e.layoutConfig.slots?.titleBar},end:e.layoutConfig.slots?.end||lP,midNav:e.layoutConfig.slots?.midNav||lP,nav:e.layoutConfig.slots?.nav||lP,navControls:e.layoutConfig.slots?.navControls||lP,start:e.layoutConfig.slots?.start||lP,subNav:e.layoutConfig.slots?.subNav||lP},e),dP=()=>({__typename:"SlotsLayoutConfig",contextualNotifications:lP,end:lP,header:lP,inAppNotifications:lP,main:lP,monitor:lP,notifications:lP,titleBar:lP,toasts:lP,midNav:lP,nav:lP,navControls:lP,start:lP,subNav:lP}),uP=()=>({__typename:"SlotsLayoutConfig",contextualNotifications:lP,header:lP,inAppNotifications:lP,main:lP,monitor:lP,notifications:lP,titleBar:lP,toasts:lP});function mP(e,t){return e.replace(/\n/g,`\n${"  ".repeat(t)}`)}function pP(e,t){if(!e)return"{}";if(t)return mP(pP(e),t);const{id:n,type:i,action:a,linkedEntity:o,entityState:r}={...e};return`{\n  id: ${n},\n  type: ${i},\n  action: ${a},${o?`\n  linkedEntity: {\n    id: ${o.id},\n    type: ${o.type}\n  },`:""}${r?`\n  entityState: {\n    flushableByLinkedEntity: ${r.flushableByLinkedEntity}\n  }`:""}\n}`}function gP(e,t){return e?t?mP(gP(e),t):`{\n  id: ${e.id},\n  startTimestamp: ${e.startTimestamp},\n  source: ${e.source}\n}`:"{}"}function hP(e,t){const{midNavEntity:n,subNavEntity:i,headerEntity:a,startEntity:o,mainEntity:r,endEntity:s,monitorEntity:l,inAppNotificationsEntity:c,entityExtension:d}=e;n&&t.log(`midNavEntity: ${pP(n)}`),i&&t.log(`subNavEntity: ${pP(i)}`),a&&t.log(`headerEntity: ${pP(a)}`),o&&t.log(`startEntity: ${pP(o)}`),t.log(`mainEntity: ${pP(r)}`),s&&t.log(`endEntity: ${pP(s)}`),l&&t.log(`monitorEntity: ${pP(l)}`),c&&t.log(`inAppNotificationsEntity: ${pP(c)}`),d&&t.log(`entityExtension: ${pP(d)}`)}function vP(e,t){const{id:n,correlation:i,isMainWindow:a,layoutConfig:o}=e,r=yP(o);t.log(`{\n  id: ${n},\n  correlation: ${gP(i,1)},\n  isMainWindow: ${a},\n  layoutMode: ${o.layoutMode},\n  layoutOverrides: ${r?.toString()}\n}`),VD(e)?(t.log("activeEntities for window:"),hP(e.activeEntities,t)):t.log("activeEntities: undefined")}const yP=e=>e.slots&&Object.keys(e.slots).reduce(((t,n)=>("__typename"===n||(e.slots?.[n]?.height||e.slots?.[n]?.width||e.slots?.[n]?.isHidden)&&t.push(`${n}:height(${e.slots?.[n]?.height}),width(${e.slots?.[n]?.width}),isHidden(${e.slots?.[n]?.isHidden})`),t)),[]);function SP(e,t){if(void 0===e)return t.log("undefined - app not ported to multi slot");if(null===e)return t.log("null - no app supports this entity");const{midNavEntity:n,subNavEntity:i,headerEntity:a,startEntity:o,mainEntity:r,endEntity:s}=e;n&&t.log(`midNavEntity: ${pP(n)}`),i&&t.log(`subNavEntity: ${pP(i)}`),a&&t.log(`headerEntity: ${pP(a)}`),o&&t.log(`startEntity: ${pP(o)}`),r&&t.log(`mainEntity: ${pP(r)}`),s&&t.log(`endEntity: ${pP(s)}`)}const fP=e=>e.midNavEntity??e.subNavEntity??e.headerEntity??e.startEntity??e.mainEntity,kP=({entity:e,currentEntities:t,shouldUseNewEntity:n})=>n?{appEntity:e.linkedEntity??e,contextEntity:e.linkedEntity?e:null}:t?{appEntity:fP(t),contextEntity:e}:{appEntity:e,contextEntity:null},CP=e=>({infoPane:e.getPreferences("infoPane"),teamLayout:e.getPreferences("teamLayout"),sidePane:e.getPreferences("sidePane"),simpleCollab:e.getPreferences("simpleCollab")}),bP=({appsRegistryService:e,clientPreferences:t,contextEntity:n,coreSettings:i,entity:a,layoutMode:o})=>{if(!a)throw new Error("entity used to match app is null");const r=e.getApp({entityType:a.type});if(!r)return;if(!r.getAppViewEntities)return;const s=r.getAppViewEntities({contextEntity:n,coreSettings:i,entity:a,layoutMode:o,userPreferences:CP(t)}),l=s&&{midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,...s};if([ke.ck.activity,ke.ck.simplecollab,ke.ck.activityslicecontent].toString().includes(a.type)&&n&&l){const a=e.getApp({entityType:n.type});if(!a||!a.getAppViewEntities)return l;const r=a.getAppViewEntities({entity:n,contextEntity:n,coreSettings:i,layoutMode:o,userPreferences:CP(t)});r&&Object.assign(l,{endEntity:r.endEntity})}return l},wP={midNavEntity:{children:["subNavEntity","headerEntity","startEntity","mainEntity","endEntity"]},subNavEntity:{children:["headerEntity","startEntity","mainEntity","endEntity"]},headerEntity:{children:["startEntity","mainEntity","endEntity"]},startEntity:{children:["mainEntity","endEntity"]},mainEntity:{children:["endEntity"]},endEntity:{children:null}},TP=e=>!(!e||"monitorEntity"===e||"inAppNotificationsEntity"===e);function IP(e){return e&&e.viewEntityName&&TP(e?.viewEntityName)?e.viewEntityName:"subNavEntity"}function NP({executionContext:e,viewEntityName:t}){return IP(e)===t}function AP({executionContext:e,viewEntityName:t}){const n=IP(e),{children:i}=wP[n];return!(!i||!i.includes(t))}var EP=n(287572);const FP=(e,t)=>({endEntity:ZD(e.endEntity),headerEntity:ZD(e.headerEntity),mainEntity:ZD(e.mainEntity)||t,midNavEntity:ZD(e.midNavEntity),startEntity:ZD(e.startEntity),subNavEntity:ZD(e.subNavEntity),monitorEntity:null,inAppNotificationsEntity:null,entityExtension:null,__typename:"ActiveEntities"}),_P=(e,t,n,i,a)=>{const{appsRegistryService:o,coreSettings:r,clientPreferences:s}=e,l=fP(t),c=o.getApp({entityType:l?.type}),d=fP(a),u=o.getApp({entityType:d?.type}),m=c?.onBeforeNavigationFromHistory?.(t,{coreSettings:r,layoutMode:n,userPreferences:CP(s)},u?.manifest.id===c?.manifest.id?a:void 0);return m?(i.log(`${c?.manifest.name} app declared history invalid. New set of entities:`),SP(m,i),FP(m,LD().mainEntity)):t},DP=(e,t,n,i)=>{const a=e.get((0,EP.up)(EP.xP,n),"Experience");if(a)try{const e=JSON.parse(a);return i&&n!==e.userContextId?null:xP(e.activeEntities,t)}catch{t.errorToTelemetry?.(`Could not restore active entities from local storage. Stored string was in an invalid JSON format. String: ${a}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}return null},PP=({localStorage:e,logger:t,appsRegistryService:n,userContextId:i,entityType:a,appId:o})=>{const r=o||n.getApp({entityType:a})?.manifest.id,s=e.get((0,EP.up)(`${EP.Hr}-${r}`,i),"Experience");if(s)try{return xP(JSON.parse(s),t)}catch(e){t.errorToTelemetry?.(`Could not restore active entities from local storage. Stored string was in an invalid JSON format error ${e}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),t.log("String in local storage: ",s)}return null},MP=(e,t,n,i)=>{const a=e.windowHistory.map((e=>({...e,activeEntities:nP(e.activeEntities),reactiveVars:{}})));if(t.trySet((0,EP.up)(EP.jE,e.userContextId),JSON.stringify(a),"Framework",i?"SessionGlobal":"Experience")){!t.trySet((0,EP.up)(EP.eW,e.userContextId),JSON.stringify({windowHistoryIndex:e.currentWindowHistoryIndex,userContextId:e.userContextId}),"Framework",i?"SessionGlobal":"Experience")&&n.errorToTelemetry?.(`Failed to save history index ${e.currentWindowHistoryIndex}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}else n.errorToTelemetry?.(`Failed to save main window history to local storage with history length ${a.length}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)},RP=({action:e,type:t,id:n,entityState:i,linkedEntity:a,options:o,windowOptions:r})=>e&&t?{action:e,entityState:{flushableByLinkedEntity:i&&i.flushableByLinkedEntity||!1,__typename:"EntityState"},id:n||null,linkedEntity:a&&a.type?{id:a.id||RD,action:a.action||ke.SY.view,type:a.type,__typename:"LinkedEntity"}:null,options:o||null,type:t,windowOptions:r?{left:r.left||0,top:r.top||0,width:r.width||0,height:r.height||0,__typename:"WindowOptions"}:null,__typename:"Entity"}:null,xP=(e,t)=>e.mainEntity?{__typename:"ActiveEntities",midNavEntity:e.midNavEntity&&RP(e.midNavEntity)||null,subNavEntity:e.subNavEntity&&RP(e.subNavEntity)||null,headerEntity:e.headerEntity&&RP(e.headerEntity)||null,startEntity:e.startEntity&&RP(e.startEntity)||null,mainEntity:e.mainEntity&&RP(e.mainEntity)||xD(),endEntity:e.endEntity&&RP(e.endEntity)||null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}:(t.log("No main entity in entities stored in local storage"),null),LP=(e,t)=>e.reduce(((e,n)=>{const i=((e,t)=>{if(!e.activeEntities)return t.log("No activeEntities in window history item in local storage"),null;const n=xP(e.activeEntities,t);return n?{activeEntities:n,reactiveVars:{},__typename:"WindowHistoryItem"}:null})(n,t);return i&&e.push(i),e}),[]);function OP(e,t,n=e.windowHistory.length-1,i){const{maxWindowHistoryLength:a}=i.get(c.w.Core);if(!VD(e))return;const o=e.windowHistoryNavigationState,r=e.windowHistory;n<0&&(n=-1),e.currentWindowHistoryIndex=n;const s=r.length>0&&r[r.length-1].activeEntities.mainEntity,l=e.activeEntities.mainEntity,d=!!s&&OD(s,l);o.canNavigateBack=!(0===r.length||1===r.length&&d)&&n>0,o.canNavigateForward=n<e.windowHistory.length-1;let u=n;n!==e.windowHistory.length-1&&(u=n-1),o.backHistory=jP(0,u,e.windowHistory);const m=o.backHistory,p=e.activeEntities.mainEntity;m.length>0&&OD(p,m[m.length-1].entity)&&(m.pop(),t.log("windowHistoryNavigationState back history entry was popped.")),o.backHistory=m.reverse().slice(0,a||MD),o.forwardHistory=jP(n+1,e.windowHistory.length-1,e.windowHistory).slice(0,a||MD),t.log(`Reset windowHistoryNavigationState. size: ${e.windowHistory.length}, windowHistoryIndex: ${n}`),t.log(`Reset windowHistoryNavigationState. canNavigateBack: ${o.canNavigateBack}, canNavigateForward: ${e.windowHistoryNavigationState.canNavigateForward}, backHistory size: ${e.windowHistoryNavigationState.backHistory.length}, forwardHistory size: ${o.forwardHistory.length}`)}function jP(e,t,n){if(!n)return[];const i=[];for(let a=e;a<=t;a++)i.push({__typename:"WindowHistoryNavigationItem",windowHistoryIndex:a,entity:n[a].activeEntities.mainEntity});return i}const BP=(e,t,n)=>{const i=i=>!i||n(t.getApp({entityType:i.type}),{mainEntity:e.mainEntity,subNavEntity:e.subNavEntity});return i(e.mainEntity)&&i(e.subNavEntity)},UP=(e,t,n)=>BP(e,t,((e,t)=>{try{return!e?.onBeforeAddToNavigation?.shouldAddEntitiesToWindowHistory||e.onBeforeAddToNavigation.shouldAddEntitiesToWindowHistory(t)}catch(t){return n.errorToTelemetry?.(`App ${e.manifest.name} failed to execute entity command hook 'ShouldAddEntitiesToWindowHistory' with ""${t.name}"" error`,"entity_command_hook",{errors:`${t.name}`},!0),!0}}));function $P({appIdsForReactiveVarChange:e,context:t,isUserContextSwitch:n,logger:i,newActiveEntities:a,windowContentState:o,skipMoveToTop:r,forcePush:s}){const{appsRegistryService:l,windowProvider:d,clientPreferences:u,coreSettings:m}=t,{currentWindowHistoryIndex:p,windowId:g}=o;let{windowHistory:h}=o;const{enableHostHistoryNavigation:v,maxWindowHistoryLength:y}=m.get(c.w.Core);n&&(i.log("User context switch, clearing out history"),h=[]),i.log(`handleWindowHistoryPush called: current length: ${h.length} current index ${p}`);const S=WP(a,l,u,m,o.layoutMode),f=oP(l,S);if(e&&!e.some((e=>f.has(e))))return i.log(`Not storing rv change to history b/c rv changes made for app not being stored in history ${e} `),[h,!1];if(!UP(S,l,i))return i.log("Not saving to history b/c app shouldAddEntitiesToWindowHistory hook has returned false"),[h,!1];const k={};f.forEach((e=>{const{navigationalReactiveValues:t,nonNavigationalReactiveValues:n}=l.getAppViewStateForWindow(g,e)||{};(t||n)&&(k[e]=sP({...t,...n}))}));let C=h;const b=h[p];if(!b||e||QD(HD(a,b.activeEntities))||s){if(!r&&p<h.length-1){i.log("Current index not at top stack");const e=h.splice(p,1);h.push(e[0]),i.log("Moving to top of stack: "),hP(e[0].activeEntities,i),i.log(`Pushed windowHistory navigation item at index ${p} to the top of the history stack.`)}const e={__typename:"WindowHistoryItem",activeEntities:{...S,monitorEntity:null,inAppNotificationsEntity:null},reactiveVars:k};return C=[...h,e],v?(d.history.pushState({windowHistoryIndex:C.length-1},""),i.log(`Added browser history entry with windowHistoryIndex: ${C.length}.`)):y?C=C.slice(-y):0===y&&(C=[]),i.log(`windowHistory length after push ${C.length}`),[C,!0]}return i.log("Did not push to window history"),[C,!1]}const WP=(e,t,n,i,a)=>{const o=t.getApp({entityType:fP(e).type});return o&&o.manifest.shouldDeferNavigationToMainSlotApp?VP(e,t,n,i,a):e},VP=(e,t,n,i,a)=>{const{appEntity:o,contextEntity:r}=kP({currentEntities:e,entity:e.mainEntity,shouldUseNewEntity:!0}),s=bP({appsRegistryService:t,clientPreferences:n,contextEntity:r,coreSettings:i,entity:o,layoutMode:a});return s&&s.mainEntity?FP(s,e.mainEntity):e};function HP(e,t,n=!0){try{const{activeWindows:e=[]}={activeWindows:t.getActiveWindows()};return n?(0,we.cloneDeep)(e):e}catch(t){return e.errorToTelemetry?.(`activeWindowsQuery cache read failed - ${t.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e.log("activeWindowsQuery entry not found in cache"),[]}}function zP(e,t,n,i,a,o,r,s){const{activeWindowsService:l,commandChangeReportingService:u,coreSettings:m}=e,{enableDecoupleCommandingFromResolversExtend:g}=m.get(c.w.Core),h=a||n?.correlation.id||(0,E.v4)(),v=n?function(e,t,n,i){let a;const o=t.slice(0);if(VD(e)){const t=o.findIndex((t=>t.id===e.id));a=e,-1===t?o.push(a):o[t]=a}else{const t=e.windowHistory.length;if(t>0&&!e.windowHistory[t-1].activeEntities)throw n.errorToTelemetry?.("Unable to resolve active entities, trying to pop back to empty window","webclient_framework_foundation_core_services_entity_commanding"),(0,Je.$5)(d.Ir.Commanding,d.O4.Undefined,"executeEntityCommand",e.correlation,"Unable to resolve to active entities");a=o.splice(o.findIndex((t=>t.id===e.id)),1)[0],n.log(`Window has no active entities so destroying for correlation ${i}`)}return o}(n,t,i,h):t;try{l.setActiveWindows(v,o,s),g&&!n?.activeEntities.entityExtension||n&&n?.activeEntities&&l.getWindowLayoutService(n.id)?.modalManager.updateModalState(n),n&&n?.activeEntities&&l.getWindowLayoutService(n.id)?.modalManager.setBlockingEntityExtension(n.blockingEntityExtension?.entity)}catch(e){return i.errorToTelemetry?.(`activeWindowsQuery cache write failed - ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),u.report({correlationId:h,type:p.I.Failure,context:{target:"executeEntityCommand",errorInfo:k.Q.WindowCacheFailedToUpdate,errorMessage:e.message}}),!1}return!n||n.isNotificationsWindow||r||(GP(v,n,i,e),qP(e,v,n,h)),i.log(`After updating window cache, there are ${v.length} active windows`),!0}const qP=({appsRegistryService:e,experienceChangeReportingService:t},n,i,a)=>{if(VD(i)&&QP(n,i.id)){const n=fP(i.activeEntities),o=e.getPlatformAppIdForEntity(n);t.report({correlationId:a,type:Ua.Mk.AppSelectionChanged,context:{target:"entity-command-resolver",appId:o}})}},GP=(e,t,n,{appsRegistryService:i,clientPreferences:a,coreSettings:o,localStorage:r})=>{const{enableUsingSessionStorageForWindowHistory:s,enableWriteActiveEntitiesToLocalStorage:l,enableWriteAppHistoryToLocalStorage:d,enableWindowHistoryRestorationOnStandardMain:u}=o.get(c.w.Core);if(VD(t)&&QP(e,t.id)){const e={...t.activeEntities,monitorEntity:null,inAppNotificationsEntity:null};if(((e,t,n)=>BP(e,t,((e,t)=>{try{return!e?.onBeforeAddToNavigation?.shouldRestoreClientToEntities||e.onBeforeAddToNavigation.shouldRestoreClientToEntities(t)}catch(t){return n.errorToTelemetry?.(`App ${e.manifest.name} failed to execute entity command hook 'ShouldRestoreClientToEntities' with ""${t.name}"" error`,"entity_command_hook",{errors:`${t.name}`},!0),!0}})))(e,i,n)&&l&&r.set((0,EP.up)(EP.xP,t.userContextId),JSON.stringify({activeEntities:e,userContextId:t.userContextId}),"Framework","Experience"),d){const{activeEntities:n}=t,s=fP(n),l=i.getApp({entityType:s.type});if(l?.onBeforeAddToNavigation?.shouldStoreLastVisitedInAppHistory?.(n.mainEntity)){const n=l?.manifest.id;r.set((0,EP.up)(`${EP.Hr}-${n}`,t.userContextId),JSON.stringify(nP(e)),"Framework","Experience")}else if(l?.manifest.shouldDeferNavigationToMainSlotApp){const s=i.getApp({entityType:n.mainEntity.type}),l=s?.manifest;if(s?.onBeforeAddToNavigation?.shouldStoreLastVisitedInAppHistory?.(n.mainEntity)){const n=VP(e,i,a,o,t.layoutConfig.layoutMode);r.set((0,EP.up)(`${EP.Hr}-${l?.id}`,t.userContextId),JSON.stringify(nP(n)),"Framework","Experience")}}}u&&MP(t,r,n,s)}},YP=(e,t)=>e.find((e=>e.layoutConfig.layoutMode===t&&e.isMainWindow)),QP=(e,t)=>{const n=YP(e,Yt.Rm.standard);return t===d.N2||t===n?.id},JP=e=>e===d.N2;function KP(e,t){const n=e.get(t);return n&&n[0]}function ZP(e,t){return e.find((e=>e.id===t))}function XP(e,t,n,i,a){let o=KP(t,WD(e,i));const{linkedEntity:r}=e;let s=!1;!o&&r&&(o=KP(t,WD(r,i)),s=!!o),!o&&e.id&&(o=KP(n,WD({id:e.id,type:e.type},i)),s=!!o);const{enableLinkedEntityMatching:l}=a.get(c.w.Core);return l&&!o&&r&&(o=KP(n,WD(r,i)),s=!!o),[o,s]}const eM="windowStateEvent";function tM({pubsub:e,fromWindowId:t,isFromWindowMain:n,sourceWindowId:i,diff:a,targetWindow:o,targetVisibilityState:r,stateTransition:s,correlation:l,logger:c}){!function(e,t,n,i,a,o,r){VD(o)&&o.id!==d.N2&&nM(t,a)&&(n.log(`Focusing window ${r} for correlation ${e.id}`),i.publish(`${eM}-${r}`,{windowStateEvent:{isFocused:!0,correlation:e}}))}(l,a,c,e,r,o,i),function(e,t,n,i,a,o,r,s,l){!nM(t,s)||i||l.isMainWindow||l.id===n||r!==g.Ar.flush&&r!==g.Ar.forceFlush||(a.log(`Closing ${n} for correlation ${e.id}`),o.publish(`${eM}-${n}`,{windowStateEvent:{correlation:e,shouldClose:!0}}))}(l,a,t,n,c,e,s,r,o)}function nM(e,t){return t===g.Rp.show||t===g.Rp.toggle&&QD(e)}const iM=(e,t,n,i,a)=>{const o=e.activeEntities.monitorEntity,r=e.activeEntities;e.activeEntities=_P(a,e.windowHistory[t].activeEntities,e.layoutConfig.layoutMode,n,r),(e=cP(e,{resetMonitor:null===o})).activeEntities={...e.activeEntities,monitorEntity:o};const s=e.windowHistory[t].reactiveVars;return rP({appsRegistryService:a.appsRegistryService,currentWindowId:e.id,newReactiveValues:s}),OP(e,n,t,a.coreSettings),n.log("Window after navigating in history: "),vP(e,n),zP(a,i,e,n)},aM={Query:{},Mutation:{changeMonitorSlotContent:(e,{windowId:t,entityType:n,entityAction:i,entityOptions:a},o)=>{const{loggerFactory:r,activeWindowsService:s}=o,l=r.newLogger("changeSlotsVisibility-mutation","data-client-entity-command"),c=t||s.getMainWindowWithLayoutMode(Yt.Rm.standard)?.id||d.N2,u=HP(l,s),m=ZP(u,c);if(!m)return l.error("mutation fails as targetWindow is not found."),null;let p=!1,g=!1;return i===ke.SY.view?(m.activeEntities={...m.activeEntities,monitorEntity:{id:null,action:i,type:n,entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"},linkedEntity:null,options:a||null,windowOptions:null,__typename:"Entity"}},g=!0):i===ke.SY.leave&&m.activeEntities.monitorEntity?.type===n&&(m.activeEntities={...m.activeEntities,monitorEntity:null},g=!0),p=g&&zP(o,u,m,l),p&&VD(m)?m:null},changeSlotsVisibility:(e,{slotNames:t,windowId:n,isHidden:i},a)=>{const{loggerFactory:o,activeWindowsService:r}=a,s=o.newLogger("changeSlotsVisibility-mutation","data-client-entity-command"),l=HP(s,r),c=ZP(l,n);if(!c)return s.error("mutation fails as targetWindow is not found."),null;let d=!1,u=!1;const m=t.reduce(((e,t)=>{const n=(e=>e.replace(/-./g,(e=>e[1].toUpperCase())))(t),a=c.layoutConfig.slots?.[n];return u||a?.isHidden===i||(u=!0),e[n]={...a,isHidden:i},e}),{});return u&&(c.layoutConfig.slots={__typename:"SlotsLayoutConfig",...c.layoutConfig.slots,...m},d=zP(a,l,c,s)),d&&VD(c)?c:null},resizeHeaderSlot:(e,{height:t,windowId:n},i)=>{const{loggerFactory:a,activeWindowsService:o}=i,r=a.newLogger("resizeHeaderSlot-mutation","data-client-entity-command"),s=HP(r,o),l=ZP(s,n);if(!l)return null;let c=!1;return l.layoutConfig.slots?.header?.height!==t&&(l.layoutConfig.slots={...l.layoutConfig.slots,__typename:"SlotsLayoutConfig",header:{...l.layoutConfig.slots?.header,__typename:"SlotLayoutConfig",height:t,width:l.layoutConfig.slots?.header?.width||null}},c=zP(i,s,l,r)),c&&VD(l)?l:null},resizeSlotDimensions:(e,{windowId:t,slotName:n,width:i},a)=>{const{loggerFactory:o,activeWindowsService:r}=a,s=o.newLogger("resizeSlotDimensions-mutation","data-client-entity-command"),l=HP(s,r),c=ZP(l,t);if(!c)return null;let d=!1;return"SUBNAV"===n?c.layoutConfig.slots={...c.layoutConfig.slots,__typename:"SlotsLayoutConfig",subNav:{...c.layoutConfig.slots?.subNav,__typename:"SlotLayoutConfig",height:c.layoutConfig.slots?.subNav?.height||null,width:i}}:"END"===n&&(c.layoutConfig.slots={...c.layoutConfig.slots,__typename:"SlotsLayoutConfig",end:{...c.layoutConfig.slots?.end,__typename:"SlotLayoutConfig",height:c.layoutConfig.slots?.end?.height||null,width:i}}),d=zP(a,l,c,s),d&&VD(c)?c:null}}};function oM(e,t,{entity:n,stateTransition:i,logger:a,window:o,correlation:r,entityOptions:s}){if(!o.blockingEntityExtension)throw(0,Je.$5)(d.Ir.Commanding,d.O4.Undefined,"executeEntityCommand",o.correlation,"Unable to resolve blockingEntityExtension");const l={activeEntities:t,windowHistory:[...o.windowHistory],currentWindowHistoryIndex:o.windowHistory.length-1,layoutMode:o.layoutConfig.layoutMode,userContextId:o.userContextId,windowId:o.id};a.log("Blocking command transition due to blockingEntityExtension");const c=JD();l.activeEntities={...t,entityExtension:o.blockingEntityExtension.entity};const u={...o.blockingEntityExtension,blockedEntity:n,blockedEntityOptions:s||null,blockedCommand:{stateTransition:i,visibilityState:e,correlation:r,__typename:"EntityCommand"}},m=o.windowHistoryNavigationState,p={...m,backHistory:[...m.backHistory??[]],forwardHistory:[...m.forwardHistory??[]]};return{...o,...l,correlation:r,extendedEntityContainerState:c,blockingEntityExtension:u,windowHistoryNavigationState:p}}const rM=(e,t,n)=>{const i=e.activeEntities.entityExtension;if(!i)return t.error(`Unable to create hide command for extension in the given window. The window does not have an active extension. Window ID: ${e.id}`),null;const a=KD();a.source=A.p.CoreResolvers;const o={correlation:a,stateTransition:g.Ar.extend,visibilityState:g.Rp.hide};return n.report({type:p.I.CommandStart,correlationId:a.id,context:{target:"createAndRegisterHideExtensionCommand",entityCommand:{entity:i,command:{...o,correlation:{...a,startTimestamp:parseInt(a.startTimestamp,10)}}}}}),{entity:i,command:o}},sM=(e,t,n,i,a)=>{let o=e;return e.extendedEntityContainerState.isExternal?n.log(`Internal routing - closing external dialog for correlation ${a.id}`):(n.log(`Internal routing - closing internal dialog for correlation ${a.id}`),VD(e)&&(o=lM(e,a))),e.id===d.N2&&(n.log(`Internal routing - send close extension to angular for correlation ${a.id}`),((e,t,n)=>{if(VD(e)){const i=rM(e,t,n),a=i?.command.correlation?.id;a&&(t.log(`Closing external dialog, sending hide command with new correlation ${a}`),n.report({type:p.I.NotHandled,correlationId:a,context:{target:"sendHideExternalExtensionCommand"}}))}})(t,n,i)),o};function lM(e,t){const{activeEntities:n}=e;return{...e,correlation:t,extendedEntityContainerState:{...e.extendedEntityContainerState,containerState:g.iW.Closed},activeEntities:{...n,entityExtension:null}}}const cM="CN:",dM={Query:{},Mutation:{createNotificationsWindow:(e,t,n)=>mM(e,t,n),removeNotificationsWindow:(e,t,n)=>uM(e,t,n)}},uM=(e,t,n)=>{const{loggerFactory:i,activeWindowsService:a}=n,o=i.newLogger("NotificationsResolver","data-client-entity-command");try{const e=HP(o,a),t=e.filter((e=>!0!==e.isNotificationsWindow));if(t.length===e.length)return o.log(`${cM}Cannot remove notifications window as it does not exist.`),!0;const i=zP(n,t,void 0,o);return!1===i&&o.errorToTelemetry?.(`${cM}Error updating windows cache after deleting notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),i}catch(e){return o.errorToTelemetry?.(`${cM}Error occured trying to delete notifications window: ${e.message}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),!1}},mM=(e,t,n)=>{const{loggerFactory:i,activeWindowsService:a}=n,o=i.newLogger("NotificationsResolver","data-client-entity-command");try{const e=HP(o,a),t=e.find((e=>!0===e.isNotificationsWindow));if(t)return o.log(`${cM}Notifications window has already been created. windowId: ${t.id}`),!0;const i=YP(e,Yt.Rm.standard),r={...KD(),__typename:"Correlation",clientLaunchId:i?i.correlation.clientLaunchId:(0,E.v4)()},s=zP(n,e,gM(r,null),o,r.id);return!1===s&&o.errorToTelemetry?.(`${cM}Error updating windows cache with newly created notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),s}catch(e){return o.errorToTelemetry?.(`${cM}Error occured trying to create notifications window: ${e.message}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),!1}},pM=({activeWindows:e,context:t,command:n,correlation:i,entity:a,entityOptions:o,logger:r,notificationsHandler:s,newEntity:l})=>{const u=((e,t)=>{let n;try{e&&(n=JSON.parse(e))}catch(e){t.errorToTelemetry?.(`${cM}Ignoring error while parsing entity options for toasts.`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)}return n})(o,r),m=u?.targetEntity.id||n.correlation.id;r.log(`${cM}${m}Received entity command to render notification. correlationId:${n.correlation.id} tartetEntityType:${u?.targetEntity.type} actionType:${u?.targetEntity.dataOptions.actionType} visibility:${n.visibilityState} isIncomingCall:${u?.isIncomingCall} callId: ${u?.callId} userContextId: ${u?.targetEntity?.dataOptions?.userContextId}`);const{callId:p,crossClientScenarioName:g}=u||{};if(s.sendTelemetry({callId:p,toastScenarioClientId:i.id,callingScenarioName:g,stepName:be.BQ.CommandResolutionStarted}),s.isInAppNotificationsEnabled(u))return((e,t,n,i,a,o,r)=>{const s=ZP(e,d.N2);if(!s)return r.errorToTelemetry?.(`${cM}Error occured trying to execute notifications command, targetWindow is not found`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),null;let l=!1,c=!1;return a.action===ke.SY.view&&("hide"===t.visibilityState&&s.activeEntities.inAppNotificationsEntity?.type===a.type?(s.activeEntities={...s.activeEntities,inAppNotificationsEntity:null},r.log(`${cM} Not resetting notification window on toast dismissal/hide`)):"show"===t.visibilityState&&(s.activeEntities={...s.activeEntities,inAppNotificationsEntity:{id:a.id||i.id,action:a.action,type:a.type,entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"},linkedEntity:null,options:o||null,windowOptions:null,__typename:"Entity"}},c=!0)),l=c&&zP(n,e,s,r),l&&VD(s)?s:null})(e,n,t,i,a,o,r);{const{enableInAppNotifications:e,enableBrowserToasts:n}=t.coreSettings.get(c.w.Notifications);if(e||n)return s.sendTelemetry({toastScenarioClientId:i.id,stepName:be.BQ.ToastRenderCancelled,reason:`in app notifications disabled for: ${a.type}`}),null}if(!s.isCustomNotificationsEnabled(u))return function(e,t,n,i,a,o){const r=!!i.coreSettings.get(c.w.Core).enableCommandToHostCommService;return r&&a.sendCommandToHost(e,t,n,o),null}(n,i.id,a,t,s,u);let h;const v=e.findIndex((e=>!0===e.isNotificationsWindow));-1===v?(r.warnToTelemetry?.(`${cM}${m}Notifications window does not exist to display this notification. Creating a new one now...`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),s.sendTelemetry({callId:p,toastScenarioClientId:i.id,callingScenarioName:g,stepName:be.BQ.RecreatingNotificationsWindow}),h=gM(i,null)):(h=e[v],s.sendTelemetry({callId:p,toastScenarioClientId:i.id,callingScenarioName:g,stepName:be.BQ.NotificationsWindowFound})),l.id=(0,E.v4)(),((e,t)=>{t.activeEntities.mainEntity=e})(l,h);return!1===zP(t,e,h,r,i.id)?(r.errorToTelemetry?.(`${cM}${m}Error updating the active windows cache with notifications window. correlationId:${i.id}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),s.sendTelemetry({callId:p,toastScenarioClientId:i.id,callingScenarioName:g,stepName:be.BQ.FailedToUpdateWindowsCache}),null):(s.sendTelemetry({callId:p,toastScenarioClientId:i.id,callingScenarioName:g,stepName:be.BQ.CommandResolved}),h)};function gM(e,t){const n={__typename:"Entity",id:null,type:ke.ck.toasts,action:ke.SY.view,options:null,windowOptions:null,linkedEntity:null,entityState:{__typename:"EntityState",flushableByLinkedEntity:!0}};return{__typename:"Window",id:(0,E.v4)(),windowOptions:null,windowHistory:[],currentWindowHistoryIndex:0,windowHistoryNavigationState:{__typename:"WindowHistoryNavigationState",canNavigateBack:!1,canNavigateForward:!1,backHistory:[],forwardHistory:[]},correlation:{...e,__typename:"Correlation"},extendedEntityContainerState:JD(),blockingEntityExtension:null,isMainWindow:!1,isNotificationsWindow:!0,isInitialWindowStateHidden:!1,userContextId:t,layoutConfig:{__typename:"LayoutConfig",layoutMode:Yt.Rm.minimal,isFullscreen:!1,slots:{__typename:"SlotsLayoutConfig",contextualNotifications:null,end:null,header:null,main:{__typename:"SlotLayoutConfig",displayMode:Yt.UU.INLINE,foldState:Yt.Vt.DEFAULT,height:null,isHidden:!1,width:null},nav:null,navControls:null,notifications:null,inAppNotifications:null,start:null,midNav:null,subNav:null,titleBar:null,toasts:null,monitor:null}},activeEntities:{__typename:"ActiveEntities",mainEntity:n,midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}}}const hM=async(e,t,n,i)=>{const[a,o]=await Promise.all([t.getUser({correlation:n}),vM(t,n,i)]);if(o)for(const t of o)e.setContext("UserInfo.IsMRU",void 0,void 0,t.id);e.setContext("UserInfo.IsMRU",!0,void 0,a.id)},vM=(e,t,n)=>{if(n)return Promise.resolve(n);const i=e.getCachedUsers;return i?i(t):void 0},yM=async(e,t,n,i,a)=>{const o={id:i.id,source:i.source,scenarioName:be.Cu.AuthWebUser};try{const[i,a]=await Promise.all([n.getCachedUsers?.(o,{isAllCachedUsers:!0,isAuthenticated:!0}),n.getCachedUsers?.(o,{isPrimaryUser:!0})]);if(hM(t,n,o,i),Array.isArray(i)){for(const e of i)t.setContext("UserInfo.IsPrimary",void 0,void 0,e.id);const e=i.filter((e=>e.profile.isHomeAccount)).length;t.setCoreContext("uniqueCredentialCount",e),t.setCoreContext("mtmaAccounts",i.length)}if(Array.isArray(a)){const[n,i]=a;e?t.setContext("UserInfo.IsPrimary",!0,void 0,n.id):(t.setCoreContext("primaryUserInfoId",n.profile.oid),t.setCoreContext("primaryUserInfoTenantId",n.profile.tid))}}catch(e){a.errorToTelemetry?.("Failed to update MRU or sync mtma context","telemetry_instrumentation_update_user_context")}},SM="webclient_framework_foundation_core_services_entity_commanding";function fM(e,t,n,i,a){let o;const{windowHistory:r,activeEntities:s}=e;let l=r;const{appsRegistryService:c}=n,u=r.slice().reverse().find((e=>{return t=s,n=e.activeEntities,i=fP(t),a=fP(n),!(i.type===a.type&&i.action===a.action);var t,n,i,a}));if(u){o=u.activeEntities,a.log(`Found app switch in window history ${t.id}. Switching to: `),hP(o,a),rP({appsRegistryService:c,currentWindowId:e.id,newReactiveValues:u.reactiveVars});const i={activeEntities:s,windowHistory:r,currentWindowHistoryIndex:e.currentWindowHistoryIndex,layoutMode:e.layoutConfig.layoutMode,userContextId:e.userContextId,windowId:e.id};[l]=$P({context:n,isUserContextSwitch:!1,logger:a,newActiveEntities:o,windowContentState:i})}else if(a.log(`No app switch found in history ${t.id}`),e.id===d.N2){const r=c.getDefaultCommand(n.coreSettings);if(r){a.log(`Using default command for main window ${t.id}`);const o=KD();return o.source=A.p.CoreResolvers,a.log(`Sending new command with correlation ${o.id}`),VM({entity:r,command:{stateTransition:"forceFlush",visibilityState:"show",correlation:o},windowId:e.id,clientLaunchId:e.correlation.clientLaunchId},n,i)||{...e,correlation:t,activeEntities:void 0}}o=LD()}else a.log(`No app switch found in child window ${e.id}, so should close ${t.id}`);return{...e,correlation:t,activeEntities:o,windowHistory:l}}function kM({correlation:e,entitiesMap:t,entity:n,logger:i,userContextId:a,window:o},r){const{id:s}=e;return i.log(`Hiding main entity and popping history - ${pP(n)} and correlation ${s}`),function({window:e,entitiesMap:t,correlation:n,logger:i,userContextId:a,context:o}){let r;const{windowHistory:s,activeEntities:l}=e,{appsRegistryService:c,coreSettings:u}=o;let m=s[s.length-1];if(qD(YD(l,m?.activeEntities||null))&&(s.pop(),m=s[s.length-1]),m&&i.log("Using most recent item in history: "),m&&hP(m.activeEntities,i),m){if(KP(t,WD(m.activeEntities.mainEntity,a))||m.activeEntities.endEntity&&KP(t,WD(m.activeEntities.endEntity,a)))return i.log(`Active entities from history already exists in another window so emptying out current window ${e.id}`),r=void 0,c.resetAllViewState(e.id),{...e,correlation:n,activeEntities:r};r=_P(o,m.activeEntities,e.layoutConfig.layoutMode,i,l),rP({appsRegistryService:c,currentWindowId:e.id,newReactiveValues:m.reactiveVars}),OP(e,i,void 0,u)}else e.id===d.N2&&(i.log("No window history in main to pop so setting window to blank"),r=LD(),c.resetAllViewState(e.id));return i.log(`Popping window history, window history length: ${s.length}`),{...e,correlation:n,activeEntities:r}}({window:o,entitiesMap:t,correlation:e,logger:i,userContextId:a,context:r})}function CM({activeEntities:e,correlation:t,entity:n,logger:i,window:a}){const o=a;return OD(e.startEntity,n)?(i.log(`Hiding start entity - ${pP(n)} and correlation ${t.id}`),{...o,activeEntities:{...e,startEntity:null},correlation:t}):OD(e.endEntity,n)?(i.log(`Hiding end entity - ${pP(n)} and correlation ${t.id}`),{...o,activeEntities:{...e,endEntity:null},correlation:t}):void 0}function bM({commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l},c,d){if(VD(s)){const{activeEntities:u}=s;if(s.blockingEntityExtension&&"extend"!==r)return oM("hide",u,{commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l});if("forceFlush"===r&&jD(a,u))return function({correlation:e,logger:t,window:n},i,a){const{id:o}=e;return VD(n)?(t.log(`Closing app with correlation correlation ${o}`),fM(n,e,i,a,t)):n}({commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l},c,d);if((!n||"flush"===r)&&OD(u.mainEntity,a))return e.report({correlationId:t.id,type:p.I.Hidden,context:{target:"handleHideCommandAction"}}),kM({commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l},c);if(!n||"none"===r){const n=CM({entity:a,logger:o,window:s,correlation:t,activeEntities:u});if(n)return e.report({correlationId:t.id,type:p.I.Hidden,context:{target:"handleHideCommandAction"}}),n}if(OD(u.entityExtension,a))return o.log(`Closing extended entity container with correlation ${t.id}`),lM(s,t);e.report({correlationId:t.id,type:p.I.Incomplete,context:{target:"handleHideCommandAction"}}),o.warn(`Hide command issued for an entity but that entity is not present - ${pP(a)}`)}else o.warn(`Hide command issued for an entity but are no active entities - ${pP(a)}`);return s}function wM({appViewEntities:e,commandChangeReportingService:t,coreSettings:n,correlation:i,enableMultiSlotNone:a,entity:o,executionContext:r,logger:s,userContextId:l,window:d}){let u;const m={activeEntities:EM(d),windowHistory:[...d.windowHistory],currentWindowHistoryIndex:d.currentWindowHistoryIndex,layoutMode:d.layoutConfig.layoutMode,userContextId:d.userContextId,windowId:d.id},{enableMTMACommanding:g}=n.get(c.w.Core);if(g&&l!==d.userContextId)throw s.errorToTelemetry?.("Different user context sent for toggle command",SM),new Error("Different user context sent for toggle command");if(VD(d)){const{activeEntities:n}=d,l=CM({activeEntities:n,correlation:i,entity:o,logger:s,window:d});if(l)return function({commandChangeReportingService:e,correlation:t,logger:n,newEntity:i}){e.report({correlationId:t.id,type:p.I.Toggled,context:{target:"logHideToggle"}}),n.log(`Toggling entity (hide) - ${pP(i)} and correlation ${t.id}`)}({commandChangeReportingService:t,logger:s,newEntity:o,correlation:i}),l;OD(n.mainEntity,o)||(t.report({correlationId:i.id,type:p.I.Incomplete,context:{target:"handleToggleCommandAction"}}),s.log(`Toggling end entity (show) - ${pP(o)} and correlation ${i.id}`),u=FM({activeEntities:n,appViewEntities:e,correlation:i,enableMultiSlotNone:a,executionContext:r,logger:s,newEntity:o,windowContentState:m}).activeEntities)}else t.report({correlationId:i.id,type:p.I.Incomplete,context:{target:"handleToggleCommandAction"}}),s.warn(`Toggle command only supported when active entities set - ${o}`);return{...d,correlation:i,activeEntities:u}}function TM({activeEntities:e,stateTransition:t,executionContext:n}){const i=e.mainEntity.entityState.flushableByLinkedEntity,a=!e.endEntity||e.endEntity.entityState.flushableByLinkedEntity,o=AP({executionContext:n,viewEntityName:"mainEntity"});return"forceFlow"===t||o&&i&&"flow"===t||!o&&a&&"flow"===t}function IM({mainEntity:e,entity:t,stateTransition:n,matchedLinkedEntity:i}){const a=e.entityState.flushableByLinkedEntity;return"forceFlush"===n||a&&("flush"===n||"new"===n)||i&&t.type!==ke.ck.byodchat&&t.type!==ke.ck.chats&&t.type!==ke.ck.devicesettings&&t.type!==ke.ck.contentcamerasetup&&t.type!==ke.ck.transcript&&t.type!==ke.ck.meetingdetails&&t.type!==ke.ck.roster&&t.type!==ke.ck.byodroster&&t.type!==ke.ck.breakoutroomspanel&&t.type!==ke.ck.yammerqna&&t.type!==ke.ck.accessibilitypanel&&t.type!==ke.ck.extensions&&t.type!==ke.ck.videobackgrounds&&t.type!==ke.ck.roomremote&&t.type!==ke.ck.videoeffectsandsettings&&t.type!==ke.ck.audiosettings}function NM(e,t){const n={__typename:"Entity",action:"view",entityState:{__typename:"EntityState",flushableByLinkedEntity:!0},id:null,linkedEntity:null,type:ke.ck.hybridplaceholder,options:null,windowOptions:null};return"Activity"===t||"NonHybridLeftRail"===t?n:ZD(e)}function AM({currentEntity:e,entityFromAppViewEntities:t,isExecutionContextUpstreamOfEntity:n}){const i=!e||e.entityState.flushableByLinkedEntity;return n&&i&&!!t}function EM(e){return VD(e)?e.activeEntities:void 0}function FM({activeEntities:e,appViewEntities:t,correlation:n,enableMultiSlotNone:i,executionContext:a,logger:o,newEntity:r,windowContentState:s}){return i&&t?(o.log("Using multi slot none behavior"),function({activeEntities:e,appViewEntities:t,executionContext:n,logger:i,windowContentState:a}){return t.endEntity||t.startEntity||i.warn("Attempting to show side rail slots (start or end) but appViewEntities has returned null for startEntity and endEntity"),{...a,activeEntities:{...e,startEntity:AM({currentEntity:e.startEntity,entityFromAppViewEntities:t.startEntity,isExecutionContextUpstreamOfEntity:AP({executionContext:n,viewEntityName:"startEntity"})||NP({executionContext:n,viewEntityName:"startEntity"})})?ZD(t.startEntity):e.startEntity,endEntity:AM({currentEntity:e.endEntity,entityFromAppViewEntities:t.endEntity,isExecutionContextUpstreamOfEntity:AP({executionContext:n,viewEntityName:"endEntity"})||NP({executionContext:n,viewEntityName:"endEntity"})})?ZD(t.endEntity):e.endEntity}}}({activeEntities:e,appViewEntities:t,logger:o,executionContext:a,windowContentState:s})):(o.log("Falling back to default none behavior"),function(e,t,n,i,a){return i.log(`Adding as end entity - ${pP(n)} and correlation ${a}`),{...e,activeEntities:{...t,endEntity:n}}}(s,e,r,o,n.id))}function _M({appViewEntities:e,correlation:t,enableMultiSlotNone:n,entity:i,executionContext:a,isCurrentEntitiesInvalid:o,isInputDefaultEntity:r,logger:s,matchedLinkedEntity:l,sourceHint:d,stateTransition:u,window:m,userContextId:p,...h},v){const{coreSettings:y}=v,S=EM(m);let f=m.extendedEntityContainerState,k={activeEntities:S,windowHistory:[...m.windowHistory],currentWindowHistoryIndex:m.currentWindowHistoryIndex,layoutMode:m.layoutConfig.layoutMode,userContextId:m.userContextId,windowId:m.id};if(m.blockingEntityExtension&&S&&"extend"!==u)return oM("show",S,{appViewEntities:e,correlation:t,enableMultiSlotNone:n,entity:i,executionContext:a,isCurrentEntitiesInvalid:o,isInputDefaultEntity:r,logger:s,matchedLinkedEntity:l,sourceHint:d,stateTransition:u,window:m,userContextId:p,...h});if(!S||IM({mainEntity:S.mainEntity,entity:i,stateTransition:u,matchedLinkedEntity:l}))k=function({appViewEntities:e,context:t,correlation:n,isInputDefaultEntity:i,isCurrentEntitiesInvalid:a,logger:o,newEntity:r,sourceHint:s,userContextId:l,window:d,windowContentState:u}){const{midNavEntity:m=null,subNavEntity:p=null,headerEntity:g=null,startEntity:h=null,mainEntity:v=null,endEntity:y=null,monitorEntity:S=null,inAppNotificationsEntity:f=null}={...e},{coreSettings:k}=t,{activeEntities:C}=u,{action:b,type:w}=r,{enableMTMACommanding:T}=k.get(c.w.Core),I=!!T&&l!==d.userContextId;if(!I&&!a&&(("default"===b||"default"===w&&"view"===b)&&C&&w===fP(C).type||u.activeEntities&&i))return u;const N={__typename:"ActiveEntities",midNavEntity:ZD(m),subNavEntity:NM(p,s),headerEntity:ZD(g),startEntity:ZD(h),mainEntity:ZD(v)??r,endEntity:ZD(y),entityExtension:null,monitorEntity:S,inAppNotificationsEntity:f},[A,E]=$P({context:t,logger:o,windowContentState:u,newActiveEntities:N,isUserContextSwitch:I});return o.log(`Flushing window - ${pP(r)} and correlation ${n.id}`),{activeEntities:N,windowHistory:A,currentWindowHistoryIndex:E?A.length-1:u.currentWindowHistoryIndex,layoutMode:d.layoutConfig.layoutMode,userContextId:l,windowId:d.id}}({appViewEntities:e,context:v,correlation:t,isCurrentEntitiesInvalid:o,isInputDefaultEntity:r,logger:s,newEntity:i,sourceHint:d,userContextId:p,window:m,windowContentState:k});else if(TM({activeEntities:S,stateTransition:u,executionContext:a}))k=function({activeEntities:e,appViewEntities:t,context:n,executionContext:i,logger:a,window:o,windowContentState:r}){const s=AP({executionContext:i,viewEntityName:"subNavEntity"}),l=s||AP({executionContext:i,viewEntityName:"headerEntity"}),c=l||AP({executionContext:i,viewEntityName:"startEntity"}),d=c||AP({executionContext:i,viewEntityName:"mainEntity"}),u=d||AP({executionContext:i,viewEntityName:"endEntity"});a.log(`Issuing flow command on window - headerEntity ${l}, startEntity ${c}, \n        mainEntity ${d}, endEntity ${u}, midNavEntity ${s}`);const m={...e,subNavEntity:s?ZD(t?.subNavEntity):e.subNavEntity,headerEntity:l?ZD(t?.headerEntity):e.headerEntity,startEntity:c?ZD(t?.startEntity):e.startEntity,mainEntity:d?ZD(t?.mainEntity)??e.mainEntity:e.mainEntity,endEntity:u?ZD(t?.endEntity):e.endEntity},[p]=$P({context:n,isUserContextSwitch:!1,logger:a,newActiveEntities:m,windowContentState:r});return{activeEntities:m,windowHistory:p,currentWindowHistoryIndex:p.length-1,layoutMode:o.layoutConfig.layoutMode,userContextId:o.userContextId,windowId:o.id}}({activeEntities:S,appViewEntities:e,context:v,executionContext:a,logger:s,window:m,windowContentState:k});else if(function(e,t,n){return!!e&&(OD(e.mainEntity,t)||OD(e.endEntity,t))&&"extend"!==n}(S,i,u))!function(e,t,n,i){e!==g.Ar.new&&t.log(`Entity already exists in the active entities no state transition made - ${pP(n)} and correlation ${i}`)}(u,s,i,t.id),k=function(e,t,n,i,a){const{activeEntities:o}=n;if(!o)return n;const{mainEntity:r,endEntity:s}=o,l={...o},{entityState:c,...d}=i;OD(r,i)?l.mainEntity={...r,...d}:s&&OD(s,i)&&(l.endEntity={...s,...d});const[u]=$P({context:e,isUserContextSwitch:!1,logger:t,newActiveEntities:o,windowContentState:n});return{activeEntities:l,windowHistory:u,currentWindowHistoryIndex:u.length-1,layoutMode:a.layoutConfig.layoutMode,userContextId:a.userContextId,windowId:a.id}}(v,s,k,i,m);else if("extend"===u){const e=function({activeEntities:e,extendedEntityContainerState:t,logger:n,newEntity:i,windowContentState:a}){const o=t.containerState===g.iW.Confirmed,r=t.containerState===g.iW.Error,s=e.entityExtension&&t.isExternal;if("platformapp"===i.type&&"create"===i.action||"devicedetails"===i.type&&"view"===i.action||"storecartcheckout"===i.type&&"view"===i.action||"storecart"===i.type&&"view"===i.action||!e.entityExtension||o||r||s)return t=JD(),a.activeEntities={...e,entityExtension:i},[t,a];n.log(`Not showing extension: exists ${!!e.entityExtension}, isConfirmed ${o}, \n  hasError ${r}, hasExternalDialog ${s}`)}({activeEntities:S,extendedEntityContainerState:f,logger:s,newEntity:i,windowContentState:k});if(!e)throw new Error(`Extension already rendered, only one extension command request can be processed at a time. \n        Extension shown: ${S.entityExtension?.type}; Extension requested: ${i.type}.`);f=e[0],k=e[1]}else k=FM({activeEntities:S,appViewEntities:e,correlation:t,enableMultiSlotNone:n,newEntity:i,executionContext:a,logger:s,windowContentState:k});if(function(e,t,n,i){const{enableMTMACommanding:a}=e.get(c.w.Core);return!(!a||t||!n||!i.userContextId||n===i.userContextId)}(y,"flush"===u||"forceFlush"===u||"extend"===u,p,m))throw new Error("Different user context sent for non-flush and non-extend command");const C=m.windowHistoryNavigationState,b={...C,backHistory:[...C.backHistory??[]],forwardHistory:[...C.forwardHistory??[]]};return{...m,...k,correlation:t,extendedEntityContainerState:f,windowHistoryNavigationState:b}}function DM(e,t,n,i){switch(e){case"hide":return bM(t,n,i);case"toggle":return wM(t);case"show":case"showWithoutFocusing":return _M(t,n)}}function PM(e,t){if(void 0!==t){const n=t?eP(t):null;e.linkedEntity=n}}function MM(e,t,n,i,a){const{visibilityState:o,stateTransition:r,layoutMode:s,targetWindow:l}=e;if("hide"!==o){if(i&&"new"===r)return(0,E.v4)();if(a&&n===d.N2||"main"===l){if(!YP(t,s??Yt.Rm.standard))return(0,E.v4)()}else if(function(e,t){return t===d.N2&&!ZP(e,d.N2)}(t,n))return d.N2}}function RM({activeWindows:e,command:t,coreSettings:n,correlation:i,entitiesMap:a,entity:o,isNewContextSupportEnabled:r,layoutMode:s,linkedEntitiesMap:l,logger:c,userContextId:u,windowId:m,webNrcEnabled:p}){const{stateTransition:h,targetWindow:v}=t,y="forceFlush"===h||"main"===v,S="flow"===h,f="extend"===h,[k,C]=!r||y||S||f?[void 0,!1]:XP(o,a,l,u,n);k&&(c.log(`Entity matched matched via linked entity ${C} for correlation ${i.id} to window`),vP(k,c));const b=k||function({command:e,activeWindows:t,windowId:n,correlation:i,logger:a,isNewContextSupportEnabled:o,layoutMode:r,userContextId:s,webNrcEnabled:l}){const c=MM(e,t,n,o,l);return void 0!==c?(a.log(`Creating new window with id ${c} for correlation ${i.id}`),function(e,t,n,i,a,o,r){const{visibilityState:s,stateTransition:l,targetWindow:c}=a;return{__typename:"Window",id:t,windowOptions:null,windowHistory:[],currentWindowHistoryIndex:0,windowHistoryNavigationState:{__typename:"WindowHistoryNavigationState",canNavigateBack:!1,canNavigateForward:!1,backHistory:[],forwardHistory:[]},correlation:{...e,__typename:"Correlation"},extendedEntityContainerState:JD(),blockingEntityExtension:null,isMainWindow:!r||l!==g.Ar.new&&i===d.N2||"main"===c,isNotificationsWindow:!1,isInitialWindowStateHidden:s===g.Rp.showWithoutFocusing,userContextId:o,layoutConfig:{__typename:"LayoutConfig",layoutMode:n??(t===d.N2||l!==g.Ar.new||"main"===c?Yt.Rm.standard:Yt.Rm.focus),isFullscreen:!1,slots:dP()}}}(i,c,r,n,e,s,o)):JP(n)||"main"===e.targetWindow?(a.log(`Retrieving mainWindow with layoutMode ${r} for correlation ${i.id}`),YP(t,r??Yt.Rm.standard)):(a.log(`Retrieving window with id ${n} for correlation ${i.id}`),ZP(t,n))}({activeWindows:e,command:t,correlation:i,isNewContextSupportEnabled:r,layoutMode:s,logger:c,userContextId:u,windowId:m,webNrcEnabled:p});if(!b)throw function(e,t){return t.errorToTelemetry?.("Unable to get source window",SM,void 0,!0),(0,Je.$5)(d.Ir.Commanding,d.O4.UndefinedWindowError,"CommandResolvers",e,"Unable to find applicable target window")}(i,c);return[b,C]}function xM(e,t,n,i,a){const o=XD(e),{webNrcEnabled:r}=a.get(c.w.Host),s=r?e=>e.id!==d.N2:void 0,[l,u]=$D(t,WD,s),[m]=XP(o,l,u,i,a);return m&&(n.log(`Found window for entity ${pP(o)}`),vP(m,n)),m||null}const LM=(e,t,n,i,a,o)=>{const{appsRegistryService:r,commandChangeReportingService:s,localStorage:l,coreSettings:c,windowId:d,...u}=n,m={...e,extendedEntityContainerState:{...e.extendedEntityContainerState,...t}},g=e.blockingEntityExtension;m.blockingEntityExtension=null;const h=zP(n,a,m,i),v=((e,t,n)=>{const i=e?.blockedEntity,a=e?.blockedCommand,o=e?.blockedEntityOptions;if(!i||!a)return t.warn("Unable to re-create the command which was blocked and saved."),null;const r=KD();r.source=A.p.CoreResolvers;const s={entity:i,command:{...a,correlation:r},entityOptions:o};return n.report({type:p.I.CommandStart,correlationId:s.command.correlation.id,context:{target:"createAndRegisterBlockedCommandOnConfirm",entityCommand:{...s,entityOptions:o?JSON.parse(o):void 0}}}),s})(g,i,s);if(v){const{entity:e,command:t,entityOptions:n}=v;return!!VM({entity:e,command:t,entityOptions:n,windowId:d,clientLaunchId:m.correlation.clientLaunchId},{appsRegistryService:r,commandChangeReportingService:s,coreSettings:c,localStorage:l,windowId:d,...u},o)}return h},OM=({entity:e,windowId:t},n)=>{const{loggerFactory:i,activeWindowsService:a}=n,o=i.newLogger("removeFromWindowHistory-mutation","data-client-entity-command"),r=XD(e);o.log(`Removing entity from history: ${pP(r)}`);const s=HP(o,a),l=ZP(s,t);return l?((({window:e,entity:t,logger:n,context:i,activeWindows:a})=>{const{localStorage:o,coreSettings:r,appsRegistryService:s}=i;let l=0,d=!1;const u=[];e.windowHistory.forEach(((n,i)=>{jD(t,n.activeEntities)?i<e.currentWindowHistoryIndex?l++:i===e.currentWindowHistoryIndex&&(d=!0):u.push(n)}));const m=e.currentWindowHistoryIndex===e.windowHistory.length-1||d?void 0:e.currentWindowHistoryIndex-l;if(e.windowHistory=u,OP(e,n,m,r),QP(a,e.id)){const{enableWindowHistoryRestorationOnStandardMain:i,enableWriteAppHistoryToLocalStorage:a,enableWriteActiveEntitiesToLocalStorage:l,enableMTMACommanding:d,enableUsingSessionStorageForWindowHistory:u}=r.get(c.w.Core);if(i&&MP(e,o,n,u),a&&s.appsWithAppHistoryStored.forEach((i=>{const a=PP({localStorage:o,logger:n,appsRegistryService:s,userContextId:e.userContextId,entityType:void 0,appId:i});a&&jD(t,a)&&o.remove((0,EP.up)(`${EP.Hr}-${i}`,e.userContextId),"Experience")})),l){const i=DP(o,n,e.userContextId,d);i&&jD(t,i)&&o.remove((0,EP.up)(EP.xP,e.userContextId),"Experience")}}})({window:l,entity:r,logger:o,context:n,activeWindows:s}),zP(n,s,l,o,void 0,void 0,!0)):(o.warn(`Could not retrieve window with id ${t}`),!1)},jM=({logger:e,appsRegistryService:t,coreSettings:n,layoutMode:i})=>{const a=t.getDefaultCommand(n,i);return a?(e.log("Default command found"),a):(e.error("No default command defined"),null)},BM=({context:e,correlation:t,logger:n,newEntity:i,shouldUseNewEntity:a,sourceWindow:o,stateTransition:r})=>{const{commandChangeReportingService:s,clientPreferences:l,appsRegistryService:c,coreSettings:d}=e,{appEntity:u,contextEntity:m}=kP({currentEntities:VD(o)?o.activeEntities:void 0,entity:i,shouldUseNewEntity:a});t&&s.report({type:p.I.CommandBeforeGetAppViewEntities,context:{target:"executeEntityCommand"},correlationId:t.id});let h=null;try{h=bP({appsRegistryService:c,clientPreferences:l,contextEntity:m,coreSettings:d,entity:u,layoutMode:o.layoutConfig.layoutMode}),(({appViewEntities:e,stateTransition:t,appEntity:n,linkedEntity:i})=>t!==g.Ar.none&&null===e&&n===i)({appEntity:u,appViewEntities:h,linkedEntity:i.linkedEntity,stateTransition:r})&&(n.log(`Initial getAppViewEntities for ${u} returned null`),h=bP({entity:i,clientPreferences:l,contextEntity:null,coreSettings:d,layoutMode:o.layoutConfig.layoutMode,appsRegistryService:c}))}catch(e){t&&s.report({type:p.I.Failure,context:{errorInfo:k.Q.CommandGetAppViewEntitiesFailure,errorMessage:e.message,target:"executeEntityCommand"},correlationId:t.id})}return h},UM=({isInputDefaultEntity:e,sourceWindow:t,context:n,userContextId:i,newEntity:a,matchedLinkedEntity:o,stateTransition:r,executionContext:s,correlation:l,logger:d})=>{const{localStorage:u,coreSettings:m,appsRegistryService:p,clientPreferences:g}=n,{enableWriteActiveEntitiesToLocalStorage:h,enableMTMACommanding:v,enableWriteAppHistoryToLocalStorage:y}=m.get(c.w.Core);let S=null,f=!1;e&&t.isMainWindow&&h?S=DP(u,d,i,v):"default"===a.action&&t.isMainWindow&&y&&(S=PP({localStorage:u,logger:d,appsRegistryService:p,userContextId:i,entityType:a.type}));const k=VD(t)?t.activeEntities:void 0;if(S){d.log("Got appViewEntities from local storage history: "),SP(S,d);const e=qM(S,p),n=qM(k,p),i=e?.onBeforeNavigationFromHistory?.(S,{coreSettings:m,layoutMode:t.layoutConfig.layoutMode,userPreferences:CP(g)},n?.manifest.id===e?.manifest.id?k:void 0),a=i&&{midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,...i};f=!!i,f&&(d.log("App declared history invalid. New set of entities:"),SP(a,d)),S=a||S}else{const e=(({currentEntities:e,newEntity:t,matchedLinkedEntity:n,stateTransition:i,executionContext:a})=>!e||IM({entity:t,mainEntity:e.mainEntity,matchedLinkedEntity:n,stateTransition:i})||TM({activeEntities:e,stateTransition:i,executionContext:a}))({currentEntities:k,newEntity:a,matchedLinkedEntity:o,stateTransition:r,executionContext:s});d.log(`Should use entity from command input for getAppViewEntities ${e} `),S=BM({context:n,correlation:l,logger:d,newEntity:a,shouldUseNewEntity:e,sourceWindow:t,stateTransition:r})}return{appViewEntities:S,isCurrentEntitiesInvalid:f}},$M=({context:e,correlation:t,logger:n,newEntity:i,pubsub:a,sourceWindow:o,stateTransition:r,userContextId:s})=>{n.log(`Targeting main window, but userContextId of command ${s} does not match main window user ${o.userContextId}`);const{coreSettings:l,appsRegistryService:c}=e,d=(({appsRegistryService:e,coreSettings:t,newEntity:n,stateTransition:i})=>{let a=!1;return"flush"===i&&(a=e.getApp({entityType:n.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:t,entity:n})||!1),a})({appsRegistryService:c,coreSettings:l,newEntity:i,stateTransition:r});return n.log(`allowUserWindowingPreference: ${d}`),d?(n.log("Popping out"),VM({entity:i,command:{stateTransition:"new",visibilityState:"show",correlation:t},windowId:o.id,clientLaunchId:o.correlation.clientLaunchId,executionContext:{userContextId:s},entityOptions:i.options},e,a),null):(({correlation:e,sourceWindow:t,logger:n,context:i,pubsub:a,userContextId:o,newEntity:r})=>{n.log("Launching switch account dialog");const{authenticationService:s}=i;return o?(s.getUser({accountId:o,correlation:e}).then((s=>(n.log(`Got user from auth service ${s.id}`),VM({entity:{type:"switchaccountdialog",action:"view"},command:{stateTransition:"extend",visibilityState:"show",correlation:e},entityOptions:JSON.stringify({originalCorrelation:e,originalEntity:r,userContextId:o,userName:s.userName}),windowId:t.id,clientLaunchId:t.correlation.clientLaunchId},i,a)))).catch((e=>{n.errorToTelemetry?.("Unable to getUser from auth",SM,void 0,!0)})),null):(n.log("UserContextId is undefined so unable to launch switch account dialog"),null)})({correlation:t,sourceWindow:o,logger:n,context:e,pubsub:a,userContextId:s,newEntity:i})},WM=({command:e,context:t,correlation:n,entitiesMap:i,entityOptions:a,executionContext:o,logger:r,matchedLinkedEntity:s,pubsub:l,sourceHint:d,sourceWindow:u,userContextId:m,windowOptions:g,newEntity:h,defaultEntityBehindExtension:v})=>{const{coreSettings:y,commandChangeReportingService:S}=t,{enableEmptyWindowDialogForDeeplink:f}=y.get(c.w.Core),{stateTransition:C,targetWindow:b}=e;if("extend"===C){if("extend"===C&&f&&(!VD(u)||null===u.userContextId&&null!=m)&&u.isMainWindow){const e=(({context:e,correlation:t,entitiesMap:n,entityOptions:i,executionContext:a,logger:o,matchedLinkedEntity:r,pubsub:s,sourceHint:l,sourceWindow:d,userContextId:u,windowOptions:m,defaultEntityBehindExtension:g})=>{const{authenticationUser:h,coreSettings:v,appsRegistryService:y,commandChangeReportingService:S,clientPreferences:f,windowProvider:C}=e,{enableMultiSlotHide:b,enableMultiSlotNone:w}=v.get(c.w.Core);if(h?.role===pg.a7.Anonymous){const e=k.Q.EmptyWindowError;return o.log(`Anonymous user - extension command error ${e}`),S.report({correlationId:t.id,type:p.I.Incomplete,context:{errorInfo:e,target:"executeEntityCommand"}}),null}o.log("Extension command - creating main window");const T=g||jM({logger:o,appsRegistryService:y,coreSettings:v,layoutMode:d.layoutConfig.layoutMode});if(!T)throw new Error("No default entity. Unable to show extension");const I=XD(T,i,m),{appViewEntities:N,isCurrentEntitiesInvalid:A}=UM({isInputDefaultEntity:!0,sourceWindow:d,context:e,userContextId:u,newEntity:I,matchedLinkedEntity:!1,stateTransition:"flush",executionContext:a,correlation:t,logger:o});return o.log(`Extension command - flushing with entity ${pP(I)}`),SP(N,o),d=DM("show",{appsRegistryService:y,appViewEntities:N||void 0,clientPreferences:f,commandChangeReportingService:S,correlation:t,coreSettings:v,enableMultiSlotHide:b,enableMultiSlotNone:w,entitiesMap:n,entity:I,entityOptions:i,executionContext:a,host:C,isCurrentEntitiesInvalid:A,isInputDefaultEntity:!0,logger:o,matchedLinkedEntity:r,sourceHint:l,stateTransition:"flush",userContextId:u,window:d},e,s),o.log("Extension command - created source window"),vP(d,o),d})({context:t,correlation:n,entitiesMap:i,entityOptions:a,executionContext:o,logger:r,matchedLinkedEntity:s,pubsub:l,sourceHint:d,sourceWindow:u,userContextId:m,windowOptions:g,defaultEntityBehindExtension:v});if(!e)return null;if(!VD(u=e))return r.log("Tried creating main window for dialog but window is empty"),S.report({correlationId:n.id,type:p.I.Incomplete,context:{errorInfo:k.Q.EmptyWindowError,target:"executeEntityCommand"}}),null}if(!(w=h,"switchaccountdialog"===w.type&&"view"===w.action||u.userContextId===m||null===u.userContextId))return r.log("User context of source window does not match user context of command. Rejecting command"),S.report({correlationId:n.id,type:p.I.Incomplete,context:{errorInfo:k.Q.UserContextMismatch,target:"executeEntityCommand"}}),null}else if((({sourceWindow:e,stateTransition:t,targetWindowType:n,userContextId:i})=>"main"===n&&("forceFlush"===t||"flush"===t)&&e.userContextId!==i)({sourceWindow:u,stateTransition:C,targetWindowType:b,userContextId:m}))return $M({context:t,correlation:n,logger:r,newEntity:h,pubsub:l,sourceWindow:u,stateTransition:C,userContextId:m});var w;return u},VM=({clientLaunchId:e,command:t,entity:n,entityOptions:i,executionContext:a,windowId:o,windowOptions:r,defaultEntityBehindExtension:s},l,u)=>{const{appsRegistryService:m,authenticationUser:h,authenticationService:v,cdlWorkerRegistrarService:y,clientPreferences:S,commandChangeReportingService:f,coreSettings:k,experienceChangeReportingService:C,loggerFactory:b,notificationsHandler:w,windowProvider:T,scenarioFactory:I,activeWindowsService:N,telemetryContextService:A}=l,E=b.newLogger("executeEntityCommand-mutation","data-client-entity-command"),{visibilityState:F,stateTransition:_,correlation:D,layoutMode:P}=t;try{const b=o||d.N2,M=((e,t)=>t?{...t,clientLaunchId:e??null,__typename:"Correlation"}:{...KD(),clientLaunchId:e??null,__typename:"Correlation"})(e??null,D);f.report({correlationId:M.id,type:p.I.CommandResolutionStarted,context:{target:"executeEntityCommand"}});const R=HP(E,N),[x,L]=$D(R,WD,(e=>!QP(R,e.id)&&!((e,t)=>{const n=YP(e,Yt.Rm.minimal);return t===n?.id})(R,e.id)&&!((e,t)=>{const n=YP(e,Yt.Rm.minimode);return t===n?.id})(R,e.id))),O=(e=>e.action===ke.SY.default&&e.type===ke.ck.default)(n),j=(e=>e.action===ke.SY.view&&e.type===ke.ck.default)(n),B=D?.sourceHint,U=(({entity:e,isInputDefaultEntity:t,isInputDefaultViewEntity:n,logger:i,appsRegistryService:a,coreSettings:o,layoutMode:r})=>t||n?jM({logger:i,appsRegistryService:a,coreSettings:o,layoutMode:r}):e)({entity:n,isInputDefaultEntity:O,isInputDefaultViewEntity:j,logger:E,appsRegistryService:m,coreSettings:k,layoutMode:P});if(!U)return E.errorToTelemetry?.("Unable to use entity from command input",SM,void 0,!0),null;const $=XD(U,i,r);if(function(e){return e.type===ke.ck.toasts}($))return pM({activeWindows:R,context:l,command:t,correlation:M,entity:n,entityOptions:i,logger:E,notificationsHandler:w,newEntity:$});E.log(`Command received for entity ${pP($)}`),E.log(`Command received :${function(e){return`{\n  visibilityState: ${e.visibilityState},\n  stateTransition: ${e.stateTransition},\n  correlation: ${gP(e.correlation,1)},\n  layoutMode: ${e.layoutMode},\n  targetWindow: ${e.targetWindow}\n}`}(t)}`),E.log(`Command with id ${M.id} received on window context ${b}`),E.log(`Command received with execution context: ${a?.viewEntityName}`),((e,t,n,i)=>{const{stateTransition:a,targetWindow:o}=e,{enableCommandingMainWindowTargeting:r}=i.get(c.w.Core);if(o&&!r||"main"===o&&"extend"!==a&&"forceFlush"!==a&&"none"!==a&&"flush"!==a)throw t.errorToTelemetry?.(`Invalid command targetWindow ${o} stateTransition ${a}`,SM,void 0,!0),(0,Je.$5)(d.Ir.Commanding,d.O4.InvalidInput,"CommandResolvers",n,`Invalid command ${o} stateTransition ${a}`)})(t,E,M,k);const{isNewContextSupportEnabled:W,webNrcEnabled:V}=k.get(c.w.Host),{enableMTMACommanding:H,enableMultiSlotHide:z,enableMultiSlotNone:q,enableTrimmingWindowHistoryBeforeRestoration:G,enableUsingSessionStorageForWindowHistory:Y,enableWindowHistoryRestorationOnStandardMain:Q,enableWindowNotUpdatedEvent:J,forceFocusLayoutMode:K}=k.get(c.w.Core),Z=YP(R,"standard"),X=H&&(a?.userContextId||iP(h)||"extend"===_&&Z&&Z.userContextId)||null;E.log(`isNewContextSupportEnabled ${W}, enableMultiSlotHide ${z}, enableMultiSlotNone ${q}`);const ee=((e,t)=>t?Yt.Rm.focus:e&&(e.layoutMode||Yt.Rm.focus))(T.Cypress,!!K),te=RM({activeWindows:R,command:t,coreSettings:k,correlation:M,entitiesMap:x,entity:$,isNewContextSupportEnabled:W??!0,layoutMode:ee??P,linkedEntitiesMap:L,logger:E,userContextId:X,windowId:b,webNrcEnabled:V??!1});let[ne]=te;const[,ie]=te;let ae=!1;Q&&ne&&!VD(ne)&&ne.isMainWindow&&"standard"===ne.layoutConfig.layoutMode&&(ne=((e,t,n,i,a,o,r,s)=>{s&&(n.remove((0,EP.up)(EP.jE,a),"Experience"),n.remove((0,EP.up)(EP.eW,a),"Experience"));const l=n.get((0,EP.up)(EP.eW,a),s?"SessionGlobal":"Experience");if(l)try{const c=JSON.parse(l);if(o&&a!==c.userContextId)return i.warnToTelemetry?.("User context of window doesn't match user context of stored history","webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e;let d=parseInt(c.windowHistoryIndex,10);if(isNaN(d))return i.warnToTelemetry?.(`Store window history has invalid history index. CurrentWindowHistoryIndex ${c.windowHistoryIndex}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e;const u=n.get((0,EP.up)(EP.jE,a),s?"SessionGlobal":"Experience");if(u){let n=LP(JSON.parse(u),i);const a=n.length,o=t.history.length;return r&&a>o&&(i.log(`Trimming window history to match host history size. windowHistorySize: ${a}, hostHistorySize: ${o}`),n=n.slice(0-o),d=Math.max(0,d-(a-o)),i.log(`New windowHistory size: ${n.length}, new currentWindowHistoryIndex: ${d}`)),{...e,windowHistory:n,currentWindowHistoryIndex:d}}i.warn("Could not restore history from storage")}catch(e){i.errorToTelemetry&&i.errorToTelemetry(`Could not restore main window nav history from local storage ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}else i.warn("Could not restore main window nav history index from local storage. IndexAndUserFromStorage is null");return e})(ne,l.windowProvider,l.localStorage,E,X,H,G,Y),ne.windowHistory.length>0&&(E.log("Restored main window navigation history from local storage"),ae=!0));const oe=WM({command:t,context:l,correlation:M,entitiesMap:x,entityOptions:i,executionContext:a,logger:E,matchedLinkedEntity:ie,pubsub:u,sourceHint:B,sourceWindow:ne,userContextId:X,windowOptions:r,newEntity:$,defaultEntityBehindExtension:s});if(null===oe)return null;ne=oe;const{appViewEntities:re,isCurrentEntitiesInvalid:se}=UM({isInputDefaultEntity:O,sourceWindow:ne,context:l,userContextId:X,newEntity:$,matchedLinkedEntity:ie,stateTransition:_,executionContext:a,correlation:M,logger:E});if(f.report({type:p.I.CommandAfterGetAppViewEntitiesSucceeded,context:{target:"executeEntityCommand"},correlationId:M.id}),E.log("Final appViewEntities: "),SP(re,E),E.log(`Before updating cache, There are ${R.length} active windows`),E.log("Source window: "),vP(ne,E),null===re)throw E.errorToTelemetry?.("No app supports entity command",SM,void 0,!0),new Error("no app view entities for entity input");const le=Boolean(H)&&X!==ne.userContextId;let ce=DM(F,{appsRegistryService:m,appViewEntities:re,clientPreferences:S,commandChangeReportingService:f,correlation:M,coreSettings:k,enableMultiSlotHide:z,enableMultiSlotNone:q,entitiesMap:x,entity:$,entityOptions:i,executionContext:a,host:T,isCurrentEntitiesInvalid:se,isInputDefaultEntity:O,logger:E,matchedLinkedEntity:ie,sourceHint:B,stateTransition:_,userContextId:X,window:ne},l,u);E.log("Target window: "),vP(ce,E),VD(ne)&&VD(ce)&&ne.activeEntities?.monitorEntity&&(ce.activeEntities.monitorEntity=ne.activeEntities?.monitorEntity),VD(ne)&&VD(ce)&&ne.activeEntities?.inAppNotificationsEntity&&t.visibilityState!==g.Rp.hide&&(ce.activeEntities.inAppNotificationsEntity=ne.activeEntities?.inAppNotificationsEntity);const de=function(e,t){return HD(VD(e)?e.activeEntities:null,VD(t)?t.activeEntities:null)}(ne,ce);let ue;if(function(e,t,n,i,a,o,r){const s=(0,ko.Q7)(e,n);r.log(`ViewportContext: ${s}`);const l={"Panel.WindowID":t,"Window.ViewportContext":s};a.report({correlationId:i,type:p.I.ScenarioEventDataAppended,context:{target:"setViewportContextOnLaunchScenarios",eventData:l}});const c=o.findScenario(be.Cu.WindowLaunchTime);c?.appendEventData(l)}(ce.isMainWindow,ce.id,ce.layoutConfig.layoutMode,M.id,f,I,E),((e,t,n)=>{const i=VD(e)?e.activeEntities.entityExtension:null,a=VD(t)?t.activeEntities.entityExtension:null;return!(t.extendedEntityContainerState.containerState===g.iW.Closed||!(i&&QD(n)||!a))})(ne,ce,de)&&(ce=sM(ce,ne,E,f,M)),E.log(`Handling the requested entity command internally for correlation ${M.id}`),ce.isMainWindow&&ce.userContextId&&(le||"ExternalDesktopNavigation"===D.sourceHint)&&(({authenticationService:e,cdlWorkerRegistrarService:t,coreSettings:n,correlation:i,telemetryContextService:a,userContextId:o})=>{const{enableMTMA:r}=n.get(c.w.Core,["enableMTMA"]);o&&r&&e.updateMostRecentUser?.({accountId:o,correlation:{...i,scenarioName:i.scenarioName||be.Cu.AuthSwitchAccount}}).then((()=>{hM(a,e,{...i,scenarioName:be.Cu.AuthWebUser})})).then((()=>{const{enableUserContextWorkerRegistration:e}=n.get(c.w.CdlWorker,["enableUserContextWorkerRegistration"]);e&&t.setMainWindowWorkerByUserId(o)}))})({authenticationService:v,cdlWorkerRegistrarService:y,coreSettings:k,correlation:M,telemetryContextService:A,userContextId:ce.userContextId}),tM({pubsub:u,fromWindowId:b,isFromWindowMain:QP(R,b),sourceWindowId:ne.id,diff:de,targetWindow:ce,targetVisibilityState:F,stateTransition:_,correlation:M,logger:E}),OP(ce,E,ae?ce.currentWindowHistoryIndex:void 0,k),VD(ne)&&(ue=((e,t)=>{if(!e.activeEntities?.mainEntity)return;const n="startEntity"===t;let i;return"subNavEntity"===t?i=Yt.sk.SUBNAV:n&&(i=Yt.sk.START),i})(ne,a?.viewEntityName)),J&&!zD(ne,ce,!0))return f.report({correlationId:M.id,type:p.I.WindowNotUpdated,context:{target:"executeEntityCommand"}}),ue&&N.updateLayoutConfig({[ue]:{foldState:Yt.Vt.FOLDED,prevFoldState:Yt.Vt.UNFOLDED,useForce:!0}},b),null;if(ne.correlation.id!==M.id&&"extend"!==_){const e=VD(ne)?ne.activeEntities:void 0;e&&f.report({correlationId:M.id,type:p.I.ScenarioEventDataAppended,context:{target:"executeEntityCommand",eventData:{fromMainEntityType:e.mainEntity.type,fromMainEntityAction:e.mainEntity.action}}}),f.report({correlationId:ne.correlation.id,type:p.I.Abandoned,context:{target:"executeEntityCommand"}}),C.report({correlationId:M.id,type:Ua.Mk.ActiveEntitiesDestroyed,context:{target:"entity-command-resolver"},windowId:ne.id}),zD(ne,ce,!1)||f.report({correlationId:ne.correlation.id,type:p.I.WindowUpdatedButNotRendered,context:{target:"executeEntityCommand"}})}const me=!OD(VD(ce)?ce.activeEntities.mainEntity:null,VD(ne)?ne.activeEntities.mainEntity:null),{enableSimpleShell:pe}=k.get(c.w.MercuryDesign,["enableSimpleShell"]);me&&VD(ne)&&(ce=cP(ce,{resetMonitor:null===ne.activeEntities.monitorEntity,resetTitleBar:!pe}));const ge=()=>{f.report({correlationId:M.id,type:p.I.WindowUpdateStart,context:{target:"executeEntityCommand"}})},he=()=>{const e=function(e){const t=[];return Object.keys(e).map((n=>{const i=e[n];i&&t.push(i)})),t}(de);e.length>0&&C.report({correlationId:M.id,type:Ua.Mk.ActiveEntitiesResolved,context:{target:"entity-command-resolver",entities:e},windowId:ce.id});const t=VD(ce)?ce.activeEntities:null;t&&f.report({correlationId:M.id,type:p.I.ScenarioEventDataAppended,context:{target:"executeEntityCommand",eventData:{subNavEntityType:t.subNavEntity?.type,subNavEntityAction:t.subNavEntity?.action}}}),f.report({correlationId:M.id,type:p.I.WindowUpdated,context:{target:"executeEntityCommand"}})},ve=zP(l,R,ce,E,M.id,he,void 0,ge);return ve&&!N.enableDecoupleCommandingFromApollo&&he(),ue&&N.updateLayoutConfig({[ue]:{foldState:Yt.Vt.FOLDED,prevFoldState:Yt.Vt.UNFOLDED,useForce:!0}},b),ve&&VD(ce)?ce:null}catch(e){throw E.errorToTelemetry?.(`Unable to execute entity command ${F} ${_} -  ${e.message}`,SM,{mainEntityType:n.type,mainEntityAction:n.action,correlationId:D.id},!0),e}},HM=(e,t,{windowId:n,commandChangeReportingService:i,...a},o)=>{if(!e.activeEntities.entityExtension)return!1;const r=rM(e,t,i);if(r){const{entity:t,command:s}=r;return VM({entity:t,command:s,windowId:n,clientLaunchId:e.correlation.clientLaunchId},{windowId:n,commandChangeReportingService:i,...a},o)}return!1},zM=e=>({Query:{activeWindow(e,{windowId:t},{coreSettings:n,loggerFactory:i,activeWindowsService:a}){const o=i.newLogger("activeWindow","data-client-entity-command"),{webNrcEnabled:r}=n.get(c.w.Host),s=t||d.N2;let l;const u=HP(o,a,!1);if(l=s===d.N2&&r?YP(u,"standard"):u.find((e=>e.id===s)),!l)throw new Error(`Requesting activeWindow for unknown windowId ${s}`);return l},activeWindowForEntity(e,{entity:t},{loggerFactory:n,authenticationUser:i,coreSettings:a,activeWindowsService:o}){const r=n.newLogger("activeWindowForEntity-query","data-client-entity-command"),s=HP(r,o),{enableMTMACommanding:l}=a.get(c.w.Core);return xM(t,s,r,l?iP(i):null,a)},isEntityInActiveWindow(e,{entity:t,windowId:n},{loggerFactory:i,activeWindowsService:a}){const o=i.newLogger("isEntityInActiveWindow-query","data-client-entity-command"),r=ZP(HP(o,a),n),s=XD(t);if(o.log(`Querying window ${n} for entity: ${pP(s)}`),!r)return o.errorToTelemetry?.(`No window found for windowId ${n}`,SM,void 0,!0),!1;const l=function(e,t){return OD(e,t.midNavEntity)||OD(e,t.subNavEntity)||OD(e,t.headerEntity)||OD(e,t.startEntity)||OD(e,t.mainEntity)||OD(e,t.endEntity)}(s,r.activeEntities);return o.log(`entityExist: ${l}`),l}},Mutation:{navigateToWindowHistoryIndex:(e,t,n)=>(({windowId:e,windowHistoryIndex:t},n)=>{const{loggerFactory:i,activeWindowsService:a}=n,o=i.newLogger("navigateToWindowHistoryIndex-mutation","data-client-entity-command");o.log(`Navigating to windowHistoryIndex ${t} on window ${e}.`);const r=HP(o,a),s=ZP(r,e);if(!s)throw new Error("Could not find window.");return!(0===s.windowHistory?.length||t<0||t>s.windowHistory.length-1)&&iM(s,t,o,r,n)})(t,n),performWindowHistoryNavigation:(e,t,n)=>(({windowId:e,navigationDirection:t},n)=>{const{loggerFactory:i,activeWindowsService:a}=n,o=i.newLogger("performWindowHistoryNavigation-mutation","data-client-entity-command");o.log(`Navigating ${e} with direction ${t}.`);const r=HP(o,a),s=ZP(r,e);if(!s)throw new Error("Could not find window.");if(0===s.windowHistory?.length)return!1;let l=s.currentWindowHistoryIndex;const c=e=>o.warn(`Could not navigate ${t}. Index ${e} is out of the bounds of the window history.`);if("back"===t){if(l--,l<0)return c(l),!1}else if(++l,l>s.windowHistory.length-1)return c(l),!1;return iM(s,l,o,r,n)})(t,n),pushToWindowHistory:(e,t,n)=>(({entity:e,entityOptions:t,windowId:n},i)=>{const{loggerFactory:a,activeWindowsService:o,coreSettings:r}=i,s=a.newLogger("pushToWindowHistory-mutation","data-client-entity-command"),l=XD(e,t);s.log(`Saving entity to history: ${pP(l)}`);const c=HP(s,o),d=ZP(c,n);if(!d)return s.warn(`Could not retrieve window with id ${n}`),!1;const u=BM({context:i,logger:s,newEntity:l,shouldUseNewEntity:!0,sourceWindow:d,stateTransition:"flush"}),{midNavEntity:m=null,subNavEntity:p=null,headerEntity:g=null,startEntity:h=null,mainEntity:v=null,endEntity:y=null,monitorEntity:S=null,inAppNotificationsEntity:f=null}={...u},k={__typename:"ActiveEntities",midNavEntity:ZD(m),subNavEntity:NM(p,void 0),headerEntity:ZD(g),startEntity:ZD(h),mainEntity:ZD(v)??l,endEntity:ZD(y),entityExtension:null,monitorEntity:S,inAppNotificationsEntity:f},C={activeEntities:d.activeEntities,windowHistory:d.windowHistory,currentWindowHistoryIndex:d.currentWindowHistoryIndex,layoutMode:d.layoutConfig.layoutMode,userContextId:d.userContextId,windowId:d.id},[b]=$P({context:i,isUserContextSwitch:!1,logger:s,newActiveEntities:k,windowContentState:C,skipMoveToTop:!0,forcePush:!0});return d.windowHistory=b,OP(d,s,void 0,r),zP(i,c,d,s)})(t,n),removeFromWindowHistory:(e,t,n)=>OM(t,n),updateEntity(e,{entity:t,entityOptions:n,viewEntityName:i,windowId:a},o){const{loggerFactory:r,activeWindowsService:s}=o,l=a||d.N2,c=r.newLogger("updateEntity-mutation","data-client-entity-command"),u=HP(c,s),m=ZP(u,l);if(!m)return c.warn("Trying to update entity in window that does not exist"),!1;if(m.userContextId&&o.authenticationUser&&m.userContextId!==iP(o.authenticationUser))return c.warn("Trying to update entity in for a different user context than currently present on the window"),!1;const p=XD(t,n);return c.log(`Updating entity with input: ${pP(p)}`),function({entity:e,window:t,viewEntityName:n,context:i,logger:a}){const{coreSettings:o}=i,r=qD(YD(t.activeEntities,t.windowHistory[t.windowHistory.length-1]?.activeEntities||null,!0));if(t.activeEntities[n]={...t.activeEntities[n],...e},r){t.windowHistory.pop(),OP(t,a,void 0,o);const e={activeEntities:t.activeEntities,windowHistory:t.windowHistory,currentWindowHistoryIndex:t.currentWindowHistoryIndex,layoutMode:t.layoutConfig.layoutMode,userContextId:t.userContextId,windowId:t.id},[n]=$P({context:i,isUserContextSwitch:!1,logger:a,newActiveEntities:t.activeEntities,windowContentState:e});t.windowHistory=n,OP(t,a,void 0,o)}}({window:m,entity:p,viewEntityName:i,context:o,logger:c}),zP(o,u,m,c)},updateEntityState(e,{entity:t,entityState:n},i){const{authenticationUser:a,coreSettings:o,loggerFactory:r,activeWindowsService:s}=i,{enableMTMACommanding:l}=o.get(c.w.Core),d=r.newLogger("updateEntityState-mutation","data-client-entity-command"),u=HP(d,s),m=xM(t,u,d,l?iP(a):null,o);if(!m)return d.warn("Trying to update flushable entity that does not exist"),!1;return function(e,t,n,i){const{mainEntity:a,endEntity:o}=e.activeEntities,{flushableByLinkedEntity:r,linkedEntityUpdate:s}=n;OD(a,t)?(null!=r&&(a.entityState.flushableByLinkedEntity=r),PM(a,s)):o&&OD(o,t)?(i.log("Updating entity state for end entity"),PM(o,s)):i.warn(`Updating entity state for entity the does not exist ${t}`)}(m,XD(t),n,d),zP(i,u,m,d),!0},async updateExtendedEntityContainerState(t,n,i){const{loggerFactory:a,windowProvider:o,windowId:r,activeWindowsService:s}=i,{windowId:l,containerState:c}=n,u=l||r||d.N2,m=a.newLogger("updateExtendedEntityContainerState-mutation","data-client-entity-command");m.log(`Container state update received from ${l}`);const p=HP(m,s),h=ZP(p,u);if(h)if(((e,t)=>e===g.iW.Confirmed&&t.blockingEntityExtension?.entity&&OD(t.activeEntities.entityExtension,t.blockingEntityExtension.entity))(c,h))h.id===d.N2&&o.opener.postMessage(Ta.z.MainWindowBlockedState,{isBlocked:"Confirmed",entity:null}),LM(h,n,i,m,p,e);else{if(c!==g.iW.Closed)return m.log(`Updating container state to ${n.containerState}`),h.extendedEntityContainerState={...h.extendedEntityContainerState,containerState:n.containerState},zP(i,p,h,m);HM(h,m,i,e)}else m.log("Could not find window");return!1},updateWindowHistoryWithEntity:(e,t,n)=>(({entity:e,entityOptions:t,appId:n,viewEntityName:i,windowId:a},o)=>{const{loggerFactory:r,activeWindowsService:s,appsRegistryService:l,coreSettings:c}=o,u=r.newLogger("updateWindowHistoryWithEntity-mutation","data-client-entity-command");if("monitorEntity"===i||"inAppNotificationsEntity"===i)return u.warn("Invalid view entity name to update"),!1;const m=a||d.N2,p=XD(e,t),g=HP(u,s),h=ZP(g,m);if(!h)return u.warn(`Could not retrieve window with id ${m}`),!1;const v=[...h.windowHistory];return l.getAppByID(n)?(h.windowHistory.forEach(((e,t)=>{const a=qM(e.activeEntities,l);if(a?.manifest.id===n)if(a?.onBeforeUpdateHistoryItem){const n=a?.onBeforeUpdateHistoryItem?.(e.activeEntities,p,i,{coreSettings:c});if(!n)return;const{midNavEntity:o,subNavEntity:r,headerEntity:s,startEntity:l,mainEntity:d,endEntity:u}=n;v[t]={...e,activeEntities:{...e.activeEntities,midNavEntity:ZD(o),subNavEntity:ZD(r),headerEntity:ZD(s),startEntity:ZD(l),mainEntity:ZD(d)??p,endEntity:ZD(u)}}}else v[t]={...e,activeEntities:{...e.activeEntities,[i]:p}}})),zP(o,g,{...h,windowHistory:v},u,void 0,void 0,!1)):(u.error("Invalid appId"),!1)})(t,n),executeEntityCommand:(t,n,i)=>VM(n,i,e),addBlockingExtension:(t,{entity:n,entityOptions:i,windowId:a,removeBlock:o},{loggerFactory:r,windowProvider:s,activeWindowsService:l,coreSettings:c,...u})=>{const m=r.newLogger("addBlockingExtension-mutation","data-client-entity-command");m.log(`${o?"Removing":"Adding"} an entity extension blocker of type ${n.type}`);const p=HP(m,l),g=ZP(p,a);if(g){const t={...n,id:n.id||null,linkedEntity:null,options:i||null,windowOptions:null,__typename:"Entity",entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"}};if(o&&g.blockingEntityExtension)return((e,t,n,i,a,o)=>{const{windowProvider:r}=o;if(!t.blockingEntityExtension||!OD(t.blockingEntityExtension.entity,e))return!1;const s={...t,blockingEntityExtension:null},l=zP(o,n,s,i);return s.id===d.N2&&r.opener.postMessage(Ta.z.MainWindowBlockedState,{isBlocked:"Unblocked",entity:null}),HM(t,i,o,a),l})(t,g,p,m,e,{loggerFactory:r,windowProvider:s,activeWindowsService:l,coreSettings:c,...u});if(!o)return((e,t,n,i,a)=>{const{windowProvider:o}=a,r={entity:e,__typename:"BlockingEntityExtension",blockedEntity:null,blockedCommand:null,blockedEntityOptions:null},s={...t,blockingEntityExtension:r};if(s.id===d.N2)try{o.opener.postMessage(Ta.z.MainWindowBlockedState,{isBlocked:"Blocked",entity:r.entity,entityOptions:e.options&&JSON.parse(e.options)})}catch(e){i.errorToTelemetry?.("Unable to parse and post addBlockingExtension to main window",SM)}return zP(a,n,s,i)})(t,g,p,m,{windowProvider:s,loggerFactory:r,activeWindowsService:l,coreSettings:c,...u})}return!1},setWindowFullscreen:(e,{isFullscreen:t,windowId:n},i)=>{const{loggerFactory:a,activeWindowsService:o}=i,r=a.newLogger("setWindowFullscreen-mutation","data-client-entity-command"),s=HP(r,o),l=ZP(s,n);if(!l)return null;let c=!1;return l.layoutConfig.isFullscreen!==t&&(l.layoutConfig.isFullscreen=t,c=zP(i,s,l,r)),c&&VD(l)?l:null},removeUserActiveWindows:(e,{userContextId:t},n)=>{const{loggerFactory:i,activeWindowsService:a}=n,o=i.newLogger("removeUserActiveWindowsMutation-mutation","data-client-entity-command"),r=((e,t)=>e.filter((e=>e.isMainWindow||e.userContextId!==t)))(HP(o,a),t);return zP(n,r,void 0,o)},saveReactiveVarsToHistory(e,{windowId:t,appIds:n},i){const{loggerFactory:a,activeWindowsService:o}=i,r=a.newLogger("saveReactiveVarsToHistory-mutation","data-client-entity-command"),s=t||d.N2,l=HP(r,o),c=ZP(l,s);if(!c)return r.warn("Trying to save reactive var history for window that does not exist"),!1;if(0===c.windowHistory.length)return!1;const u={activeEntities:c.activeEntities,windowHistory:c.windowHistory,currentWindowHistoryIndex:c.currentWindowHistoryIndex,layoutMode:c.layoutConfig.layoutMode,userContextId:c.userContextId||null,windowId:c.id},[m,p]=$P({appIdsForReactiveVarChange:n,context:i,isUserContextSwitch:!1,logger:r,newActiveEntities:c.activeEntities,windowContentState:u});if(!p)return r.log("Did not update history"),!1;const g={...c,windowHistory:m};return OP(g,r,void 0,i.coreSettings),zP(i,l,g,r),!0}}}),qM=(e,t)=>{if(e){const n=fP(e);return t.getApp({entityType:n.type})}};var GM=n(722428),YM=n(413555),QM=n(164796),JM=n(505038),KM=n(735544);const ZM={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventActionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"virtualEventAction"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},XM={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventAutoAdmittedUsersDataQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"autoAdmittedUsersData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventId"},value:{kind:"Variable",name:{kind:"Name",value:"eventId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},eR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventSchedulingFormDataQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"virtualEventSchedulingFormData"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasUnsavedChanges"}}]}}]}}]},tR={Query:{virtualEventAction(e,t,{cache:n,loggerFactory:i}){try{return n.readQuery({query:ZM})?.virtualEventAction??null}catch{const e=i.newLogger("virtual-event-action","data-client-virtual-events");return e.errorToTelemetry?.("virtualEventAction: Failed to fetch virtual event action from cache.","virtual_event_form_action"),null}},virtualEventSchedulingFormData(e,t,{cache:n,loggerFactory:i}){try{return n.readQuery({query:eR})?.virtualEventSchedulingFormData??null}catch{const e=i.newLogger("virtual-event-scheduling-form-data","data-client-virtual-events");return e.errorToTelemetry?.("virtualEventSchedulingFormData: Failed to fetch virtual event scheduling form data from cache.","virtual_event_scheduling_form_data"),null}},autoAdmittedUsersData(e,{eventId:t},{cache:n,loggerFactory:i}){try{return n.readQuery({query:XM,variables:{eventId:t}})?.autoAdmittedUsersData??null}catch{const e=i.newLogger("virtual-event-auto-admitted-users-data","data-client-virtual-events");return e.errorToTelemetry?.("virtualEventAutoAdmittedUsersData: Failed to fetch virtual event autoAdmittedUsers data from cache.","cmd_meetings_virtual_event_auto_admitted_users_data"),null}}},Mutation:{setVirtualEventAction(e,{input:{type:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("set-virtual-event-action","data-client-virtual-events");try{n.writeQuery({query:ZM,data:{virtualEventAction:t}})}catch{return a.errorToTelemetry?.("setVirtualEventStateAction: Failed to update virtual event action task in cache.","virtual_event_form_action"),null}return t},updateVirtualEventSchedulingFormData(e,{virtualEventSchedulingFormDataInput:t},{cache:n,loggerFactory:i}){const a=i.newLogger("update-virtual-event-scheduling-form-data","data-client-virtual-events"),o={virtualEventSchedulingFormData:{__typename:"VirtualEventSchedulingFormData",hasUnsavedChanges:t.hasUnsavedChanges??!1}};try{n.writeQuery({query:eR,data:o})}catch{return a.errorToTelemetry?.("updateVirtualEventSchedulingFormData: Failed to update virtual event scheduling form data in cache.","virtual_event_scheduling_form_data"),null}return o.virtualEventSchedulingFormData}}},nR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientSensitivityLabelAppliedSensitivityLabelQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appliedSensitivityLabelState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"labelId"}},{kind:"Field",name:{kind:"Name",value:"priority"}}]}}]}}]},iR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientSensitivityLabelDowngradeInfoQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"labelDowngradeInfo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"downgradeJustification"}},{kind:"Field",name:{kind:"Name",value:"downgradeJustificationCancelled"}}]}}]}}]},aR={Query:{appliedSensitivityLabelState(e,{id:t},{cache:n,loggerFactory:i}){try{const e=n.readQuery({query:nR,variables:{id:t}});return e?.appliedSensitivityLabelState??null}catch(e){const t=i.newLogger("applied-sensitivity-label-state","data-client-sensitivity-label");return t.errorToTelemetry?.("appliedSensitivityLabelState: Failed to fetch applied sensitivity label state from cache.","applied_sensitivity_label_state"),null}},labelDowngradeInfo(e,{id:t},{cache:n,loggerFactory:i}){try{const e=n.readQuery({query:iR,variables:{id:t}});return e?.labelDowngradeInfo??null}catch(e){const t=i.newLogger("label-downgrade-info","data-client-sensitivity-label");return t.errorToTelemetry?.("labelDowngradeInfo: Failed to fetch label downgrade info from cache.","label_downgrade_info"),null}}},Mutation:{setLabelDowngradeInfo(e,{id:t,downgradeJustification:n,downgradeJustificationCancelled:i},{cache:a,loggerFactory:o}){try{const e={labelDowngradeInfo:{__typename:"SensitivityLabelDowngradeInfo",id:t,downgradeJustification:n??null,downgradeJustificationCancelled:i??!1}};a.writeQuery({query:iR,data:e,variables:{id:t}})}catch(e){const t=o.newLogger("set-label-downgrade-info","data-client-sensitivity-label");return t.errorToTelemetry?.("labelDowngradeInfo: Failed to fetch label downgrade info from cache.","set_label_downgrade_info"),!1}return!0}}};var oR=n(786498),rR=n(435010);const sR={Mutation:{updateArchiveTeamInfo:(e,{info:t},{cache:n})=>{if(!t)throw new Error("No archiveTeamInfo received");try{const{archiveSharepointSite:e}=t,i={archiveTeamResult:{__typename:"ArchiveTeamResult",archiveSharepointSite:!!e}};return n.writeQuery({query:rR.C,data:i}),!0}catch{return!1}}}};var lR=n(922114),cR=n(163358);const dR={Mutation:{updateCommunitiesHeaderState:(e,{isExpanded:t},{cache:n,loggerFactory:i})=>{try{const e={communitiesHeaderState:{__typename:"CommunitiesHeaderState",isExpanded:t}};return n.writeQuery({query:cR.d,data:e}),e.communitiesHeaderState}catch{const e=i.newLogger("updateCommunitiesHeaderState","data-client-communities");return e.errorToTelemetry?.("Failed to update communities header state","community_cover_image_header_state_update_failed"),{__typename:"CommunitiesHeaderStateError",errorCode:d.O4.FailedToUpdate}}}}};class uR{static create(e){if(uR._clientResolvers)throw new Error("ClientResolvers are already created");return uR._clientResolvers=function(e){return(0,we.merge)((0,GM.D)(),AD.D,__,N_,dR,(0,ND.Dd)(),function(){let e;const t=t=>i=>async(a,o,r)=>{if(!e){const{broadcastClientResolvers:t}=await Promise.all([n.e(564316),n.e(178501),n.e(121849),n.e(769925)]).then(n.bind(n,594953));e=t()}return e[t][i](a,o,r)};return{Query:{broadcastLayout:t("Query")("broadcastLayout"),attendeeCaptionsVisibility:t("Query")("attendeeCaptionsVisibility")},Mutation:{setBroadcastActiveSectionSource:t("Mutation")("setBroadcastActiveSectionSource"),updateBroadcastLayout:t("Mutation")("updateBroadcastLayout"),selectBroadcastSection:t("Mutation")("selectBroadcastSection"),clearBroadcastSource:t("Mutation")("clearBroadcastSource"),createDebugBroadcast:t("Mutation")("createDebugBroadcast"),updateAttendeeCaptionsVisibility:t("Mutation")("updateAttendeeCaptionsVisibility")}}}(),function(e){let t;const i=i=>a=>async(o,r,s)=>{if(!t){const{clientResolvers:i}=await Promise.all([n.e(564316),n.e(178501),n.e(121849),n.e(769925)]).then(n.bind(n,594953));t=i(e)}return t[i][a](o,r,s)};return{CallingIntent:{isFake:i("CallingIntent")("isFake")},CallLogParticipant:{hasDisplayName:i("CallLogParticipant")("hasDisplayName"),displayName:i("CallLogParticipant")("displayName")},Query:{whiteboardSharingSession:i("Query")("whiteboardSharingSession"),pptSharingSession:i("Query")("pptSharingSession"),bulkMoveStatus:i("Query")("bulkMoveStatus"),anonymousDisplayName:i("Query")("anonymousDisplayName"),prejoinState:i("Query")("prejoinState"),byodState:i("Query")("byodState"),callingScreenStatus:i("Query")("callingScreenStatus"),callingScreenLayout:i("Query")("callingScreenLayout"),poppedOutWindowState:i("Query")("poppedOutWindowState"),pinnedParticipantIds:i("Query")("pinnedParticipantIds"),videoScanType:i("Query")("videoScanType"),captionFontSize:i("Query")("captionFontSize"),debugVideoEffectState:i("Query")("debugVideoEffectState"),selectedBackgroundsInfo:i("Query")("selectedBackgroundsInfo"),appliedBackgroundsInfo:i("Query")("appliedBackgroundsInfo"),getHardwareOutDevices:i("Query")("getHardwareOutDevices"),avatarInfo:i("Query")("avatarInfo"),selectedAvatarInfo:i("Query")("selectedAvatarInfo"),activeVideoEffects:i("Query")("activeVideoEffects"),videoEffectsCurrentInfo:i("Query")("videoEffectsCurrentInfo"),currentCallingState:i("Query")("currentCallingState"),compositorRegions:i("Query")("compositorRegions"),avatarAppAvailabilityInfo:i("Query")("avatarAppAvailabilityInfo"),myselfSettings:i("Query")("myselfSettings"),immersiveViewModeAppAvailabilityInfo:i("Query")("immersiveViewModeAppAvailabilityInfo"),debugClosedCaptionsEvent:i("Query")("debugClosedCaptionsEvent"),isCallingScreenReady:i("Query")("isCallingScreenReady"),isUbarRenderComplete:i("Query")("isUbarRenderComplete"),audioVideoFrameworkInfo:i("Query")("audioVideoFrameworkInfo")},Mutation:{acceptStreamPermissionsDebug:i("Mutation")("acceptStreamPermissionsDebug"),sendToDebugHardwareOutDevice:i("Mutation")("sendToDebugHardwareOutDevice"),stopDebugHardwareOutDevice:i("Mutation")("stopDebugHardwareOutDevice"),setDebugSpeakerVolume:i("Mutation")("setDebugSpeakerVolume"),setDebugToolVisible:i("Mutation")("setDebugToolVisible"),updateMeetingRoomLayoutToggleState:i("Mutation")("updateMeetingRoomLayoutToggleState"),updateShouldLaunchWhiteboardOnLoad:i("Mutation")("updateShouldLaunchWhiteboardOnLoad"),setDebugToolHiddenParticipantsCount:i("Mutation")("setDebugToolHiddenParticipantsCount"),setBulkMoveStatus:i("Mutation")("setBulkMoveStatus"),createDebugBreakoutRooms:i("Mutation")("createDebugBreakoutRooms"),createDebugCall:i("Mutation")("createDebugCall"),addDebugSuggestedUser:i("Mutation")("addDebugSuggestedUser"),joinDebugCallFromIntent:i("Mutation")("joinDebugCallFromIntent"),createDebugCallingIntent:i("Mutation")("createDebugCallingIntent"),createDebugConversation:i("Mutation")("createDebugConversation"),updateDebugCall:i("Mutation")("updateDebugCall"),stopDebugCall:i("Mutation")("stopDebugCall"),stopSpotlightSelfDebugCall:i("Mutation")("stopSpotlightSelfDebugCall"),updateDebugMeetingRoomRemoteSelectedLayoutChanged:i("Mutation")("updateDebugMeetingRoomRemoteSelectedLayoutChanged"),updateDebugSwapScreensButtonState:i("Mutation")("updateDebugSwapScreensButtonState"),toggleHoldDebugCall:i("Mutation")("toggleHoldDebugCall"),addDebugParticipant:i("Mutation")("addDebugParticipant"),createDebugParticipants:i("Mutation")("createDebugParticipants"),toggleDebugLocalMute:i("Mutation")("toggleDebugLocalMute"),startDebugRecording:i("Mutation")("startDebugRecording"),stopDebugRecording:i("Mutation")("stopDebugRecording"),setCallTranscriptStateDebug:i("Mutation")("setCallTranscriptStateDebug"),sendCallTranscriptEntryEventDebug:i("Mutation")("sendCallTranscriptEntryEventDebug"),sendClosedCaptionsEntryEventDebug:i("Mutation")("sendClosedCaptionsEntryEventDebug"),sendClosedCaptionsStatusEventDebug:i("Mutation")("sendClosedCaptionsStatusEventDebug"),setDebugClosedCaptionsEvent:i("Mutation")("setDebugClosedCaptionsEvent"),removeDebugParticipant:i("Mutation")("removeDebugParticipant"),toggleDebugVideo:i("Mutation")("toggleDebugVideo"),toggleDebugScreenShare:i("Mutation")("toggleDebugScreenShare"),updateDebugParticipant:i("Mutation")("updateDebugParticipant"),updateDebugPinParticipantFromOutside:i("Mutation")("updateDebugPinParticipantFromOutside"),updateDebugCortanaToggleButton:i("Mutation")("updateDebugCortanaToggleButton"),updateDebugContentCameraSharing:i("Mutation")("updateDebugContentCameraSharing"),toggleDebugMuteSpeaker:i("Mutation")("toggleDebugMuteSpeaker"),updateDebugContentCameraState:i("Mutation")("updateDebugContentCameraState"),triggerDebugCallingScreenGalleryTypeChange:i("Mutation")("triggerDebugCallingScreenGalleryTypeChange"),toggleVoiceLevel:i("Mutation")("toggleVoiceLevel"),setDebugDevicesList:i("Mutation")("setDebugDevicesList"),setDebugCallingQualityFeedback:i("Mutation")("setDebugCallingQualityFeedback"),setAnonymousDisplayName:i("Mutation")("setAnonymousDisplayName"),setPrejoinState:i("Mutation")("setPrejoinState"),triggerSubscribedCallChangedDebugEvent:i("Mutation")("triggerSubscribedCallChangedDebugEvent"),updateMeetingBrandingInfoCache:i("Mutation")("updateMeetingBrandingInfoCache"),setAcceptStreamPermissionsDebugResponse:i("Mutation")("setAcceptStreamPermissionsDebugResponse"),setStreamPermissionsDebugAcknowledged:i("Mutation")("setStreamPermissionsDebugAcknowledged"),setStreamPermissionsDebugAcknowledgedRequired:i("Mutation")("setStreamPermissionsDebugAcknowledgedRequired"),setByodState:i("Mutation")("setByodState"),setCallingScreenStatus:i("Mutation")("setCallingScreenStatus"),setCallingScreenLayout:i("Mutation")("setCallingScreenLayout"),setIsCallingScreenReady:i("Mutation")("setIsCallingScreenReady"),setPoppedOutWindowState:i("Mutation")("setPoppedOutWindowState"),setUbarRenderComplete:i("Mutation")("setUbarRenderComplete"),setPinnedParticipantIds:i("Mutation")("setPinnedParticipantIds"),updateMyselfSettings:i("Mutation")("updateMyselfSettings"),setVideoScanType:i("Mutation")("setVideoScanType"),updateCaptionFontSize:i("Mutation")("updateCaptionFontSize"),setDebugDeviceBlurringCapability:i("Mutation")("setDebugDeviceBlurringCapability"),setDebugVideoBackgroundImages:i("Mutation")("setDebugVideoBackgroundImages"),triggerBluetoothStateChangedDebugEvent:i("Mutation")("triggerBluetoothStateChangedDebugEvent"),triggerRaiseHandStateChangedEvent:i("Mutation")("triggerRaiseHandStateChangedEvent"),toggleDebugVideoEffect:i("Mutation")("toggleDebugVideoEffect"),updateMeetingLockDebug:i("Mutation")("updateMeetingLockDebug"),updateSelectedBackgroundsInfo:i("Mutation")("updateSelectedBackgroundsInfo"),updateAppliedBackgroundsInfo:i("Mutation")("updateAppliedBackgroundsInfo"),setShouldReloadVideoApp:i("Mutation")("setShouldReloadVideoApp"),setShouldShowVideoApp:i("Mutation")("setShouldShowVideoApp"),setShouldShowVideoEffectsPreview:i("Mutation")("setShouldShowVideoEffectsPreview"),setShouldKeepPreviewWindowInSidePanelOpen:i("Mutation")("setShouldKeepPreviewWindowInSidePanelOpen"),setVideoAppPostMessageEvent:i("Mutation")("setVideoAppPostMessageEvent"),setAvatarAppPostMessageEvent:i("Mutation")("setAvatarAppPostMessageEvent"),setVideoNotification:i("Mutation")("setVideoNotification"),setAvatarErrorNotification:i("Mutation")("setAvatarErrorNotification"),setAvatarQuickPickerErrorNotification:i("Mutation")("setAvatarQuickPickerErrorNotification"),setShouldSetAvatarRendererTimeout:i("Mutation")("setShouldSetAvatarRendererTimeout"),setIsTurningOnVideoFromPreview:i("Mutation")("setIsTurningOnVideoFromPreview"),setShouldRefreshVideoFilters:i("Mutation")("setShouldRefreshVideoFilters"),toggleParticipantPin:i("Mutation")("toggleParticipantPin"),setScaling:i("Mutation")("setScaling"),scalingModeUpdated:i("Mutation")("scalingModeUpdated"),updateAvatarInfo:i("Mutation")("updateAvatarInfo"),updateSelectedAvatarInfo:i("Mutation")("updateSelectedAvatarInfo"),setLastSelectedCameraId:i("Mutation")("setLastSelectedCameraId"),setIsAvatarAppLoaded:i("Mutation")("setIsAvatarAppLoaded"),updateActiveVideoEffects:i("Mutation")("updateActiveVideoEffects"),updateVideoEffectsCurrentInfo:i("Mutation")("updateVideoEffectsCurrentInfo"),meetingDebugGoLive:i("Mutation")("meetingDebugGoLive"),meetingDebugShowEndCurtain:i("Mutation")("meetingDebugShowEndCurtain"),setDebugStageRoomOutcome:i("Mutation")("setDebugStageRoomOutcome"),setShouldShowPopupPreview:i("Mutation")("setShouldShowPopupPreview"),setShouldAvatarMenuItemSelected:i("Mutation")("setShouldAvatarMenuItemSelected"),updateCallingState:i("Mutation")("updateCallingState"),setCompositorRegion:i("Mutation")("setCompositorRegion"),removeCompositorRegion:i("Mutation")("removeCompositorRegion"),setAvatarAppAvailabilityInfo:i("Mutation")("setAvatarAppAvailabilityInfo"),setIsAvatarMRULoaded:i("Mutation")("setIsAvatarMRULoaded"),setMeetingCollab:i("Mutation")("setMeetingCollab"),setMeetingCollabData:i("Mutation")("setMeetingCollabData"),toggleMeetingCollab:i("Mutation")("toggleMeetingCollab"),stopSharingTriggeredOnStage:i("Mutation")("stopSharingTriggeredOnStage"),setImmersiveViewModeAppAvailabilityInfo:i("Mutation")("setImmersiveViewModeAppAvailabilityInfo"),updateAudioVideoFrameworkInfo:i("Mutation")("updateAudioVideoFrameworkInfo")}}}(e),YM.K,aM,zM(e),dM,_D,ED.e,DD.D,ID,M_,PD.K,QM.K6,KM.K,tR,JM.D,oR.K,sR,lR.D,aR)}(e),uR._clientResolvers}static get(){return uR._clientResolvers}}uR._clientResolvers=null;const mR=()=>uR;var pR=n(3711),gR=n(503127),hR=n(484302);const vR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"WriteCallingDefaults"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingDebugTool"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visible"}},{kind:"Field",name:{kind:"Name",value:"passiveBarHiddenParticipantsCount"}}]}},{kind:"Field",name:{kind:"Name",value:"streamPermissionsDebug"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"acknowledged"}},{kind:"Field",name:{kind:"Name",value:"acknowledgementRequired"}},{kind:"Field",name:{kind:"Name",value:"url"}}]}},{kind:"Field",name:{kind:"Name",value:"pptSharingSession"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"_"}}]}},{kind:"Field",name:{kind:"Name",value:"isFake"}},{kind:"Field",name:{kind:"Name",value:"calls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};const yR={callingDebugTool:{__typename:"CallingDebugTool",visible:!0,passiveBarHiddenParticipantsCount:0},streamPermissionsDebug:{__typename:"StreamPermissionsDebug",acknowledged:!1,acknowledgementRequired:!1,url:"https://www.microsoft.com/"},pptSharingSession:{__typename:"ActivePptSession",id:0,_:!1},isFake:!1,calls:[]},SR=(e,t)=>{!function(e,t){const n=t.newLogger("writeCallingDefaults","data-client-calling");(0,pR.M)(e),(0,pR.rY)(e);try{e.writeQuery({query:vR,data:yR})}catch(e){n.error(`Fail to write calling defaults - ${e}`)}try{e.writeQuery({query:gR.F,data:{shouldShowVideoEffectsPreview:!1}})}catch(e){n.error(`Fail to write default value of shouldShowVideoEffectsPreview - ${e}`)}try{e.writeQuery({query:hR.F,data:{shouldKeepPreviewWindowInSidePanelOpen:!1}})}catch(e){n.error(`Fail to write default value of shouldKeepPreviewWindowInSidePanelOpen - ${e}`)}}(e,t),function(e){e.writeQuery({query:FD,data:{lpcState:{__typename:"LpcState",isLivePersonaCardInitialized:!1,lastLoggedInUserMri:null}}})}(e)};class fR extends xp{constructor(){super(d.c1.CreateDataClient,["scenarioFactory","loggerFactory","windowProvider","coreSettings","platformService"])}async execute(e){const{scenarioFactory:t,loggerFactory:n,windowProvider:i,coreSettings:a,platformService:o}=e,r=e.scenarioFactory.newScenario(be.Cu.GraphQLCreateDataClient),{enableApolloDataEviction:s,disableApolloMissingChatMessageFix:l,maxApolloCacheOperationCount:d}=e.coreSettings.get(c.w.Core);(0,bC.L)({disableApolloMissingChatMessageFix:l??!1});const u=new HC({activeOperationLimit:d});e.dataCleanupService=u,s&&(e.dataEvictionService=new zC(u,t,n,i));const m=mR(),p=await WF({...e,pulsar:this.createDataClientPulsarInstance(a,n,o)},m,SR,u,"default");r.stop({reason:"ApolloClientCreated"}),e.client=p}createDataClientPulsarInstance(e,t,n){const{enablePulsarTelemetry:i,logToOTLCollector:a}=e.get(c.w.Pulsar),o=new aa(Xi.TEAMS_RESOLVER,{sessionId:n.host.sessionId,spanExporter:new oa,loggerFactory:t,logToOTLCollector:!!a});return i&&o.initialize(),o}}var kR=n(463331),CR=n(103155);const bR="IntentPersistenceService";class wR{constructor(e){this._localStorage=e}getAllStoredDeeplinks(){const e=this._localStorage.get(bR,"Experience");return this.jsonParseSafe(e)||{}}storeDeeplink(e,t){const n=this.getAllStoredDeeplinks();n[e]=t.toString(),this.persist(n)}deleteDeeplink(e){const t=this.getAllStoredDeeplinks();delete t[e],this.persist(t)}clear(){this._localStorage.remove(bR,"Experience")}persist(e){this._localStorage.trySet(bR,JSON.stringify(e),"Framework","Experience")}jsonParseSafe(e){if(e)try{return JSON.parse(e)}catch(e){return}}}const TR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeWindow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},IR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isMainWindow"}}]}}]}}]};var NR,AR,ER,FR;function _R(e,t){return(0,ze.JT)(e.host,t)}function DR(e,t){return!!e&&(0,ze.JT)(e,t)!==(0,ze.nv)(t)}async function PR({coreSettings:e,logger:t,userContextId:n,waitForRenderingContextReady:i}){const a=!!e?.get(c.w.Auth)?.enableIntegratedAuthApp;return t.log(`getUserContext(${n})`),i(a,n,e)}async function MR(e){const{coreSettings:t,correlation:n,logger:i,waitForRenderingContextReady:a}=e,o=await PR({coreSettings:t,logger:i,waitForRenderingContextReady:a}),r=await async function(e,t,n){try{return await e.getUser({correlation:{id:t.id,scenarioName:t.scenarioName,source:t.source},accountId:n})}catch{return}}(o.authenticationService,n),s=r?.id;return i.log(`getMainWindowUserId returns ${s}`),s}async function RR(e){const{commandChangeReportingService:t,correlation:n,userContextId:i,userContextAccountType:a}=e,o=e=>t.report({type:e,correlationId:n.id,context:{target:"get-deeplink-user-context",eventData:{commandSource:n.source,deeplinkGetUserContextAccountType:FR[a],deeplinkGetUserContextId:i,scenarioPhase:"Core"}}});try{o(p.I.WaitForUserContextStarted);const t=await PR(e);return o(p.I.WaitForUserContextCompleted),{context:{client:t.client},userContextId:i,userContextAccountType:a}}catch(e){return void t.report({type:p.I.WaitForUserContextFailed,correlationId:n.id,context:{target:"get-deeplink-user-context",errorInfo:k.Q.CreateUserContextError,eventData:{commandSource:n.source,deeplinkGetUserContextAccountType:FR[a],deeplinkGetUserContextId:i,scenarioPhase:"Core",errors:e instanceof Va.C&&Va.C.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():`${e}`}}})}}!function(e){e[e.Other=1]="Other",e[e.Main=2]="Main",e[e.Flyout=3]="Flyout",e[e.Minimode=4]="Minimode"}(NR||(NR={})),function(e){e.MatchingPendingIntentFound="MatchingPendingIntentFound",e.IntentOverriddenByOnBeforeAuth="IntentOverriddenByOnBeforeAuth",e.IntentOverriddenByOnAfterAuth="IntentOverriddenByOnAfterAuth"}(AR||(AR={})),function(e){e[e.NoOverride=0]="NoOverride",e[e.OverrideCloud=1]="OverrideCloud",e[e.OverrideIntent=2]="OverrideIntent",e[e.OverrideUserContext=3]="OverrideUserContext",e[e.TerminateNavigation=4]="TerminateNavigation"}(ER||(ER={})),function(e){e[e.MainWindow=0]="MainWindow",e[e.SourceWindow=1]="SourceWindow",e[e.Other=2]="Other"}(FR||(FR={}));async function xR(e,t,n,i,a,o){const{id:r,source:s}=a;t.report({type:p.I.IntentTransferringCrossCloud,correlationId:r,context:{target:"launch-cloud",eventData:{commandSource:s,scenarioPhase:"Core"}}});try{const a=await i.loadModule("core");if(!a?.launchCloud)throw Error("launchCloud not implemented in auth module");await a.launchCloud({cloudType:e,deepLink:n,userContextId:o,correlation:{id:r,source:s}}),t.report({type:p.I.IntentTransferredCrossCloud,correlationId:r,context:{target:"launch-cloud",eventData:{commandSource:s,scenarioPhase:"Core"}}})}catch(e){const n=new Ha.a(Ha.D.LAUNCH_CLOUD_DEEPLINK_ERROR,e);throw t.report({type:p.I.Failure,correlationId:r,context:{target:"launch-cloud",errorInfo:k.Q.DeeplinkLaunchCrossCloudError,eventData:{commandSource:s,scenarioPhase:"Core",errorCode:n.toTelemetryEntry()}}}),n}}const LR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeAuthenticatedUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}}]}]}}]},OR="intent-service";async function jR(e,t,n,i,a,o,r,s,l=!1){a.report({correlationId:n.scenarioCorrelation.correlation.id,type:p.I.IntentExecuted,context:{eventData:{errorCode:s,mainEntityType:n.entityCommand.entity.type,mainEntityAction:n.entityCommand.entity.action},target:OR}});const{enableHandlingDeeplinkExtensionCommandsInCoreLayoutApp:d}=o.get(c.w.Core,["enableHandlingDeeplinkExtensionCommandsInCoreLayoutApp"]);i.log(`Executing Intent in windowId: ${r}`);const u=function(e,t){if(t){const n=(0,we.cloneDeep)(e.entityCommand);return n.command.stateTransition=n.command.stateTransition===g.Ar.extend?g.Ar.extend:g.Ar.flush,n.command.__UNSAFE_windowId=t,n}return e.entityCommand}(n,r);if(u.entity.type===ke.ck.default){const e=u.entity.action===ke.SY.view||l,i=u.command?.correlation.id?u.command?.correlation:void 0;return void await t.execute({command:ee.defaultCommand({forceTransition:e,windowId:u.command?.__UNSAFE_windowId,clientLaunchId:n.scenarioCorrelation.clientLaunchId,layoutMode:u.command?.layoutMode,shouldShowWithoutFocus:u.command?.visibilityState===g.Rp.showWithoutFocusing,userContextId:n.metadata.userContextId}),correlation:i})}if(d&&u.command?.stateTransition===g.Ar.extend){const e=u.command?.correlation.id?u.command?.correlation:void 0;return void await t.execute({command:ee.openCoreDialog({correlation:e,entity:{...u.entity,options:JSON.stringify(u.entityOptions)||null,id:u.entity.id||void 0},targetWindow:u.command?.targetWindow?{name:"main",id:u.command?.__UNSAFE_windowId,layoutMode:u.command?.layoutMode}:void 0}),correlation:e})}const m=await e(u,n.scenarioCorrelation.clientLaunchId);return i.log(`Command execution happened in windowId: ${m}`),m}function BR(e,t,n,i,a){return{shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:yt({entity:n,entityOptions:a,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,layoutMode:i,correlation:t.correlation}}),metadata:{allowAnonymous:!1,deepLink:e},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}}}function UR(e){const t=e.entityCommand.entity.type,n=e.entityCommand.command.layoutMode;return n===Yt.Rm.minimode?NR.Minimode:t===ke.ck.flyout||n===Yt.Rm.minimal?NR.Flyout:n===Yt.Rm.focus?NR.Other:NR.Main}async function $R({commandChangeReportingService:e,commandHandler:t,coreSettings:n,delegatedCommanding:i,error:a,errorInfo:o,errorMessage:r,fallbackError:s,intent:l,logger:c,newCommandType:d,windowId:u}){if(c.errorToTelemetry?.(r,"webclient_framework_foundation_core_services_intent"),e.report({type:d,correlationId:l.scenarioCorrelation.correlation.id,context:{target:OR,errorInfo:o,eventData:{errors:a instanceof Va.C&&Va.C.isFunction(a.toTelemetryEntry)?a.toTelemetryEntry():`${a}`}}}),l.shouldRenderContent)return async function(e,t,n,i,a,o,r,s,l){let c;try{if(!(a instanceof Va.C))throw a;c=a.serialize()}catch(e){t.errorToTelemetry?.(`Failed to serialize error: ${e}`,"webclient_framework_foundation_core_services_intent"),c=l?.serialize()}return jR(e,s,{...o,entityCommand:{entity:{type:ke.ck.error,action:ke.SY.view},entityOptions:{serializedError:c},command:o.entityCommand.command}},t,n,i,r)}(t,c,e,n,a,l,u,i,s)}var WR;function VR(e,t){const n=ke.ck.identity;let i=e.entityCommand.command;return t===g.Rp.show?i={visibilityState:g.Rp.show,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus,correlation:e.scenarioCorrelation.correlation}:t===g.Rp.hide&&(i={visibilityState:g.Rp.hide,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.focus,correlation:e.scenarioCorrelation.correlation}),{shouldRenderContent:!0,scenarioCorrelation:e.scenarioCorrelation,entityCommand:{command:i,entity:{type:n,action:ke.SY.loading},entityOptions:{tenantId:e.metadata.tenantId}},metadata:e.metadata}}!function(e){e[e.pending=0]="pending",e[e.fulfilled=1]="fulfilled",e[e.rejected=2]="rejected"}(WR||(WR={}));const HR=(e,t)=>{const n=t?.get(c.w.Auth)?.enableLoadingScreenInMeetings??!1,i=t?.get(c.w.Auth)?.enableMTO??!1;return!e.shouldRenderContent||!(n&&i)||e.scenarioCorrelation.correlation.source===A.p.ExternalCommand||!(e.entityCommand.entity.type===ke.ck.meetings||e.entityCommand.entity.type===ke.ck.callingdeeplink||e.entityCommand.entity.type===ke.ck.channels)};function zR(e){const t=(0,we.cloneDeep)((0,we.omit)(e,["options"]));return e.shouldRenderContent?{...t,metadata:(0,we.omit)(t.metadata,["shouldTargetSourceWindow"])}:t}async function qR(e,t,n,i,a){let o,r,s;switch(i){case"onBeforeIntentAuthenticated":o=await(n.onBeforeIntentAuthenticated?.execute(a));break;case"onAfterIntentAuthenticated":o=await(n.onAfterIntentAuthenticated?.execute(a));break;default:{const e=`evaluateHook(${i}): Unknown hook and options.`;throw t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}}if(!o){const e=`evaluateHook(${i}): Undefined app hook response.`;throw t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}switch(o.overrideType){case ER.NoOverride:s=!1,r=a.intent;break;case ER.OverrideCloud:s=!0,r={...a.intent,metadata:{...a.intent.metadata,cloud:o.cloud}};break;case ER.OverrideIntent:s=!0,r=o.intent;break;case ER.OverrideUserContext:s=!1,r={...a.intent,metadata:{...a.intent.metadata,userContextId:o.userContextId}};break;case ER.TerminateNavigation:s=!0,r=void 0;break;default:const e=`evaluateHook(${i}): Invalid app hook override type.`;throw t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}if(e.report({correlationId:a.intent.scenarioCorrelation.correlation.id,type:p.I.IntentHookResolved,context:{target:OR}}),r&&a.intent.shouldRenderContent!==r.shouldRenderContent)throw new Ha.a(Ha.D.INVALID_INTENT_OVERRIDE);return{intentOverridenByHook:s,intent:r}}var GR=n(726723);const YR=async(e,t,n,i,a,o,r)=>{const s={};s["Foundation.deeplinkWindowTarget"]=(e=>{const t=e.entityCommand.command,{stateTransition:n,layoutMode:i,targetWindow:a}=t;switch(i){case Yt.Rm.minimal:return"flyout";case Yt.Rm.minimode:return"minimode";default:return n===g.Ar.new?"child":n===g.Ar.flush||n===g.Ar.forceFlush||a===g.BA.main?"main":void 0}})(e),s["Foundation.accountType"]=await(async(e,t,n,i,a)=>{const o=await MR({coreSettings:n,logger:i,waitForRenderingContextReady:a,correlation:e.scenarioCorrelation.correlation});return o?t&&e.metadata.userContextId?e.metadata.userContextId===o?"main":"background":"unknown":"preauth"})(e,t,n,i,a);const l=o.getApp({entityType:e.entityCommand.entity.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:n,entity:e.entityCommand.entity})||!1;s["Foundation.isUserPreferenceOverriddenByApp"]=!l;const c=e?.entityCommand.entityOptions?.deepLinkId;r.recordPanelAction({actionGesture:GR.Od.auto,actionOutcome:GR.nd.open,actionScenario:GR.vB.deeplink,actionScenarioType:GR.DB.deeplink,moduleType:GR.nR.intent,moduleName:GR.Sn.intentService,deeplinkId:c,dataBag:{id:"",data:{...s},dispose:()=>{}},mainEntityType:e.entityCommand.entity.type,mainEntityAction:e.entityCommand.entity.action},i)},QR="intent-service",JR="none";class KR{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p){this.appsRegistryService=t,this.coreSettings=n,this.commandHandler=i,this.client=a,this.waitForRenderingContextReady=o,this.commandChangeReportingService=r,this.experienceChangeReportingService=s,this.scenarioFactory=l,this.hostComms=c,this.host=d,this.activeWindowsService=u,this.userBiService=m,this.delegatedCommanding=p,this.pendingIntentMap=new Map,this.logger=e.newLogger("IntentService","core-services-deeplink"),u.enableDecoupleCommandingFromApollo?this.observeActiveWindows():this.observeActiveWindowsDeprecated(),this.hasCreatedNonMainWindow=!1}async execute(e,t){this.logInternal("execute: Original intent:",e);let n,i,a=e.shouldRenderContent&&e.metadata.shouldTargetSourceWindow?e.options?.sourceWindowId:void 0;if(e.shouldRenderContent){i=UR(e),await this.cleanupActiveWindowsIfNeeded(i);const t=this.pendingIntentMap.get(i);t&&(a=t.windowId,n=AR.MatchingPendingIntentFound,this.logInternal(`execute: Replacing intent for window id: ${a} with layout type ${i}:`,e)),this.pendingIntentMap.set(i,{intent:(0,we.cloneDeep)(e),windowId:a})}this.logInternal("execute: Intent for evaluation:",e),this.commandChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:p.I.IntentReceived,context:{target:QR,eventData:{mainEntityType:e.shouldRenderContent?e.entityCommand.entity.type:JR,mainEntityAction:e.shouldRenderContent?e.entityCommand.entity.action:JR,message:n}}}),e=function(e,t){const{coreSettings:n,appsRegistryService:i}=t,{enableMinimodeWindow:a}=n.get(c.w.Core);a&&e.shouldRenderContent&&!e.options?.shouldSkipMinimodeOverride&&e.entityCommand.command.stateTransition!==g.Ar.extend&&e.entityCommand.command.stateTransition!==g.Ar.none&&"com.microsoft.teams.chat"===i.getApp({entityType:e.entityCommand.entity.type})?.manifest.id&&(e.entityCommand.command.layoutMode=Yt.Rm.minimode);return e}(e,{coreSettings:this.coreSettings,appsRegistryService:this.appsRegistryService});const{intentExecuted:o,targetWindowId:r,errorEncountered:s}=await this.executeInternal(e,a);if(s||await(t?.()),e.shouldRenderContent&&i)o?(this.logger.log("execute: Intent was not overriden and executed. Removing from state."),this.pendingIntentMap.delete(i)):(this.pendingIntentMap.set(i,{intent:(0,we.cloneDeep)(e),windowId:r}),this.logInternal(`execute: updated window ID: ${r}: For pending intent:`,e)),e.options?.isFromDeeplink&&await this.sendDeeplinkUserBi(e,o);else if(!e.shouldRenderContent){const t=this.scenarioFactory.findScenario(be.Cu.ApplicationLaunchTime);t?.stop({mainEntityType:JR,reason:"nrc_background_launch"}),this.commandChangeReportingService.report({type:p.I.Blanked,correlationId:e.scenarioCorrelation.correlation.id,context:{target:"intent-service",eventData:{systemInitiated:!0,mainEntityType:JR}}})}this.experienceChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:Ua.Mk.NavigationIntentExecuted,context:{target:"intent-service",shouldRenderContent:e.shouldRenderContent}})}async checkForPendingIntent(e,t){if(this.pendingIntentMap.size)for(const[n,{intent:i,windowId:a}]of Array.from(this.pendingIntentMap)){const o=(0,we.cloneDeep)(i);if(o){this.commandChangeReportingService.report({correlationId:e.id,type:p.I.IntentReceived,context:{target:QR,eventData:{mainEntityType:o.entityCommand.entity.type,mainEntityAction:o.entityCommand.entity.action}}}),o.entityCommand.command.visibilityState=g.Rp.showWithoutFocusing,o.metadata.userContextId=t,o.entityCommand.command.correlation=e,o.scenarioCorrelation.correlation=e,this.logInternal("checkForPendingIntent: Executing pending intent:",o);const{intentExecuted:i}=await this.executeInternal(o,a,!0);i&&(this.logger.log("checkForPendingIntent: Intent was not overriden and executed. Removing from state."),this.pendingIntentMap.delete(n))}}else this.commandChangeReportingService.report({correlationId:e.id,type:p.I.NoPendingIntent,context:{target:QR}})}async switchAccount(e,t,n,i,a){return this.logger.log("switchAccount"),this.execute({shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:yt({entity:n,entityOptions:a,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,layoutMode:Yt.Rm.standard,correlation:t.correlation}}),metadata:{allowAnonymous:!1,deepLink:e,userContextId:i},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}})}async launchMainApp(e,t,n,i){this.logger.log("launchMainApp"),await this.execute(BR(e,t,n,Yt.Rm.standard,i))}async launchMinimode(e,t,n){this.logger.log("launchMinimode"),await this.execute(BR(e,t,n,Yt.Rm.minimode))}async prewarmFlyout(e,t=!1){this.logger.log("prewarmFlyout"),await this.execute({shouldRenderContent:!0,scenarioCorrelation:e,entityCommand:yt({entity:{type:ke.ck.default,action:ke.SY.default},command:{visibilityState:g.Rp.showWithoutFocusing,stateTransition:g.Ar.flush,layoutMode:t?Yt.Rm.minimode:Yt.Rm.minimal,correlation:e.correlation}}),metadata:{allowAnonymous:!1,deepLink:Op.f5.flyout},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}})}async cleanupActiveWindowsIfNeeded(e){try{switch(e){case NR.Other:const e=this.pendingIntentMap.get(NR.Main);e&&(this.logger.log(`Closing main window with id=${e.windowId}.`),await this.client.mutate({mutation:TR,variables:{windowId:e.windowId}}));case NR.Main:const t=this.pendingIntentMap.get(NR.Other);t&&(this.logger.log(`Closing other window with id=${t.windowId}.`),await this.client.mutate({mutation:TR,variables:{windowId:t.windowId}}))}}catch(t){this.logger.warn(`cleanupActiveWindowsIfNeeded: Failed to remove window of type ${e}: ${t.message}`)}}async observeActiveWindows(){this.activeWindowsService.getActiveWindowsObservable().subscribe(this.handleNewActiveWindows.bind(this))}async observeActiveWindowsDeprecated(){this.client.watchQuery({query:IR}).subscribe((async e=>{if(!e.loading&&!e.errors){const{data:{activeWindows:t}}=e;this.handleNewActiveWindows(t)}}))}async handleNewActiveWindows(e){if(this.coreSettings?.get(c.w.Core)?.enableAnonymousCallerSignout){const n=(e=>e.some((e=>!e.isMainWindow)))(e);if(this.hasCreatedNonMainWindow){const e=await PR({coreSettings:this.coreSettings,logger:this.logger,waitForRenderingContextReady:this.waitForRenderingContextReady});await(async(e,t,n)=>{if(!e&&n){const e={id:(0,mh.DA)(),source:"intent-service",scenarioName:be.Cu.AuthWebLogout};await t.mutate({mutation:LR,variables:{reason:"AnonymousSessionEnd"},context:{correlation:e}})}})(n,this.client,(t=e,t?.authenticationUser?.type===pg.aS.Anonymous))}else this.hasCreatedNonMainWindow=n}var t;this.checkAndCleanupIfWindowRemoved(e.map((e=>e.id)))}checkAndCleanupIfWindowRemoved(e){for(const[t,{intent:n,windowId:i}]of Array.from(this.pendingIntentMap))i&&!e.find((e=>e===i))&&(this.logInternal(`checkAndCleanupIfWindowRemoved: window id: ${i} no longer exists, removing intent:`,n),this.pendingIntentMap.delete(t))}async handleIntentOverriddenByHook(e,t,n){return this.logger.log("executeInternal: Intent overriden by onBeforeIntentAuthenticated."),t?(this.logger.log("executeInternal: overridden to target cloud. LaunchCloud and return early."),await xR(t,this.commandChangeReportingService,e.metadata.deepLink,this.hostComms,e.scenarioCorrelation.correlation,e.metadata.userContextId),{intentExecuted:!0,targetWindowId:n}):{intentExecuted:!1,targetWindowId:n}}async executeInternal(e,t,n){const i=await this.executeOnCrossCloudMeeting(e,t);if(i)return i;let a=this.commandHandler,o=this.delegatedCommanding;this.logInternal(`executeInternal: windowId: ${t}: Original intent:`,e);const{intentOverridenByHook:r,newTargetWindowId:s,errorCode:l,targetCloud:d,targetUserContextId:u}=await this.evaluateOnBeforeIntentAuthHook(e,a,o,t);let m,h=l;if(r)return this.handleIntentOverriddenByHook(e,d,s);if(e.metadata.userContextId!==u&&(this.logger.log("executeInternal: userContextId overriden by onBeforeIntentAuthenticated."),e.metadata.userContextId=u),!e.shouldRenderContent&&!e.metadata.userContextId)return this.logger.log("executeInternal: userContextId is still undefined. Returning early."),{intentExecuted:!1,targetWindowId:s};this.commandChangeReportingService.report({type:p.I.WaitForUserContextStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:QR}});try{m=await PR({coreSettings:this.coreSettings,logger:this.logger,userContextId:e.metadata.userContextId,waitForRenderingContextReady:this.waitForRenderingContextReady})}catch(n){return{intentExecuted:!0,targetWindowId:await $R({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:new Ha.a(Ha.D.CREATE_USER_CONTEXT_FAILED_GENERIC,n,e.metadata.userContextId),errorInfo:k.Q.CreateUserContextError,errorMessage:`getUserContext(${e.metadata.userContextId}) failed, executing original intent ${n}.`,fallbackError:new Ha.a(Ha.D.CREATE_USER_CONTEXT_FAILED_GENERIC,void 0,e.metadata.userContextId),intent:e,logger:this.logger,newCommandType:p.I.WaitForUserContextFailed,windowId:t,delegatedCommanding:this.delegatedCommanding,coreSettings:this.coreSettings}),errorEncountered:!0}}if(this.commandChangeReportingService.report({type:p.I.WaitForUserContextCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:QR}}),m?.authenticationUser){const n=m;a=(e,t)=>Ct({...n,entityCommandInput:e,clientLaunchId:t,executionContext:{userContextId:m?.authenticationUser?.id?(0,kt.Lw)(m.authenticationUser):void 0}}),o=new re(a,n.commandDelegator);const{intentOverridenByHook:i,targetWindowId:r,errorCode:s}=await this.evaluateOnAfterIntentAuthenticatedHook(e,a,o,m,t);if(s&&(h=s),i)return this.logger.log("executeInternal: Intent overriden by onAfterIntentAuthenticated."),{intentExecuted:!1,targetWindowId:r}}else this.logger.log(`executeInternal: user context / authentication user is not defined for userContextId: ${e.metadata.userContextId}  - skip execution of onAfterIntentAuthenticated`);if(this.logInternal(`executeInternal: windowId: ${t}: Executing original intent:`,e),!e.shouldRenderContent)return{intentExecuted:!0,targetWindowId:void 0};const v=await MR({coreSettings:this.coreSettings,logger:this.logger,waitForRenderingContextReady:this.waitForRenderingContextReady,correlation:e.scenarioCorrelation.correlation});if(this.logInternal(`executeInternal: The intent is targeting userContextId ${e.metadata.userContextId}, and the mainWindowUserId is ${v}:`,e),this.shouldGoToAccountListWindow(e,v))return await async function(e,t,n,i,a,o){o.metadata.accountsToUse=void 0,o.entityCommand.command.stateTransition=g.Ar.new,o.entityCommand.command.layoutMode=Yt.Rm.focus;const r=(0,we.cloneDeep)(o);return r.entityCommand.entity={id:`${o.entityCommand.command.layoutMode}`,type:ke.ck.identity,action:ke.SY.list,linkedEntity:{type:o.entityCommand.entity.type,action:o.entityCommand.entity.action,id:o.entityCommand.entity.id??o.entityCommand.command.correlation.id}},r.entityCommand.command={...o.entityCommand.command,layoutMode:Yt.Rm.focus,stateTransition:g.Ar.new,visibilityState:g.Rp.show},t.log(`goToAccountListWindow: Executing account list intent: {${r.entityCommand.entity.type}, ${r.entityCommand.entity.action}, ${r.entityCommand.command.layoutMode}, ${r.entityCommand.command.visibilityState}}`),jR(i,a,r,t,e,n)}(this.commandChangeReportingService,this.logger,this.coreSettings,a,o,e),{intentExecuted:!1,targetWindowId:void 0};const y=function(e,t,n,i,a,o){if(n.options?.shouldSkipOverridingWindowing)return!1;if(!e.get(c.w.Core)?.enableDeeplinkOptionAllowUserWindowingPreference)return!1;if(!o)return a.log("Main window user context id is undefined"),!1;if(DR(n.metadata.homeCloud,e))return!1;const r=UR(n);if(a.log(`PendingIntentType: ${r}`),r===NR.Flyout||r===NR.Minimode)return!1;const s=n.entityCommand.command;switch(a.log(`StateTransition: ${s.stateTransition}`),s.stateTransition){case g.Ar.none:case g.Ar.extend:case g.Ar.flow:return!1}if(a.log(`EntityType: ${n.entityCommand.entity.type}`),n.entityCommand.entity.type===ke.ck.default||n.entityCommand.entity.type===ke.ck.identity)return!1;const l=i.getApp({entityType:n.entityCommand.entity.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:e,entity:n.entityCommand.entity})||!1;if(a.log(`AllowUserWindowingPreference: ${l}`),!n.metadata.userContextId)return a.errorToTelemetry?.("Unexpected undefined userContextId for intent in override","webclient_framework_foundation_core_services_intent",void 0,!0),!1;if(n.metadata.userContextId!==o)return a.log("User context of intent does not match main window user"),l||s.stateTransition===g.Ar.new?(s.layoutMode=Yt.Rm.focus,s.stateTransition=g.Ar.new):(s.layoutMode=Yt.Rm.standard,s.stateTransition=g.Ar.forceFlush,s.targetWindow=g.BA.main),!0;if(a.log("User context of intent matches main window user"),l){const e=t.getPreferences("windowing").shouldOpenContentInNewWindow;return a.log(`ShouldOpenContentInNewWindow ${e}`),e?(s.layoutMode=Yt.Rm.focus,s.stateTransition=g.Ar.new):(s.layoutMode=Yt.Rm.standard,s.stateTransition=g.Ar.flush),!0}return!1}(this.coreSettings,m.clientPreferences,e,this.appsRegistryService,this.logger,v);this.logInternal(`executeInternal: windowId: ${t}: Executed intent:`,e);return{intentExecuted:!0,targetWindowId:await jR(a,o,e,this.logger,this.commandChangeReportingService,this.coreSettings,y?void 0:t,h,n)}}async executeOnCrossCloudMeeting(e,t){const n=(0,ze.nv)(this.coreSettings);if(e.shouldRenderContent&&e.entityCommand.entity.type===ke.ck.callingdeeplink&&n&&e.metadata.homeCloud&&(0,ze.JT)(e.metadata.homeCloud,this.coreSettings)!==n&&!1===this.coreSettings.get(c.w.HostCapabilities,["crossCloudMeetingEnabled"]).crossCloudMeetingEnabled){return{intentExecuted:!0,targetWindowId:await $R({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:new Ha.a(Ha.D.EXPERIENCE_DISABLED,void 0,e.metadata.userContextId),errorInfo:k.Q.DeeplinkExecutionTerminated,errorMessage:"Deeplink callingdeeplink execution was terminated, because crossCloudMeetingEnabled is disabled.",intent:e,logger:this.logger,newCommandType:p.I.Failure,windowId:t,delegatedCommanding:this.delegatedCommanding,coreSettings:this.coreSettings})}}}async evaluateOnBeforeIntentAuthHook(e,t,n,i){this.commandChangeReportingService.report({type:p.I.OnBeforeIntentAuthenticatedStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:QR}});const{intentOverridenByHook:a,targetWindowId:o,errorCode:r,targetCloud:s,targetUserContextId:l}=await async function(e,t,n,i,a,o,r,s,l,d){let u=WR.pending,m={};if(HR(t,r))return m=await e(),m;a.log("Proceed with loading screen display if threshold exceeds.");const h=r?.get(c.w.Auth)?.thresholdToShowLoadingScreenInMs??2e3;let v;const y=o.setTimeout((()=>{u!==WR.pending||v||(s.report({type:p.I.OnLoadingScreenDisplayStarted,correlationId:t.scenarioCorrelation.correlation.id,context:{target:l}}),jR(n,i,VR(t,g.Rp.show),a,s,r,d,m.errorCode).then((e=>{v=e})).catch((e=>a.warn(`Error while launching loading screen: ${e}`))))}),h);try{m=await e(),u=WR.fulfilled}catch(e){throw u=WR.rejected,e}finally{o.clearTimeout(y),v&&(jR(n,i,VR(t,g.Rp.hide),a,s,r,v,m.errorCode).catch((e=>a.warn(`Error while closing loading screen: ${e}`))),s.report({type:p.I.OnLoadingScreenDisplayCompleted,correlationId:t.scenarioCorrelation.correlation.id,context:{target:l}}))}return m}((async()=>this.evaluateHook("onBeforeIntentAuthenticated",{intent:zR(e),context:{client:this.client,coreSettings:this.coreSettings,scenarioFactory:this.scenarioFactory}},t,n,i)),e,t,n,this.logger,this.host,this.coreSettings,this.commandChangeReportingService,QR,i);return this.commandChangeReportingService.report({type:p.I.OnBeforeIntentAuthenticatedCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:QR,eventData:{errorCode:r}}}),{intentOverridenByHook:a,newTargetWindowId:o,errorCode:r,targetCloud:s,targetUserContextId:l}}async evaluateHook(e,t,n,i,a){let o,r;this.logger.log(`evaluateHook(${e}): windowId: ${a}: Begin evaluation`);let s=!1;for(const l of function(e,t,n){const i=[];for(const a of e.registeredApps){const e=a[t];if(e)for(const t of Array.from(e.filter))"*"!==t&&t!==n||i.push(a)}return i}(this.appsRegistryService,e,t.intent.shouldRenderContent?t.intent.entityCommand.entity.type:void 0)){this.logger.log(`evaluateHook(${e}) - Matching app found: ${l.manifest.id}`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:p.I.IntentHookStarted,context:{target:QR,eventData:{matchingApp:l.manifest.id}}});try{const n=await qR(this.commandChangeReportingService,this.logger,l,e,t);s=n.intentOverridenByHook,o=n.intent,r=s?"onBeforeIntentAuthenticated"===e?AR.IntentOverriddenByOnBeforeAuth:AR.IntentOverriddenByOnAfterAuth:void 0}catch(n){this.logger.warn(`evaluateHook(${e}) windowId: ${a}: - Evaluating hook threw an error: ${n}. Executing error intent.`),r="onBeforeIntentAuthenticated"===e?k.Q.OnBeforeIntentAuthenticatedRejected:k.Q.OnAfterIntentAuthenticatedRejected;return{intentOverridenByHook:!0,targetWindowId:await $R({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:n,errorInfo:r,errorMessage:`evaluateHook(${e}) windowId: ${a}: - Evaluating hook threw an error: ${n}. Falling back to original intent.`,fallbackError:new Ha.a(Ha.D.UNKNOWN),logger:this.logger,intent:t.intent,newCommandType:p.I.IntentHookRejected,windowId:a,delegatedCommanding:this.delegatedCommanding,coreSettings:this.coreSettings}),errorCode:r}}if(s){if(!o)return this.logger.warn(`evaluateHook(${e}) windowId: ${a}: - Hook overriden to undefined. Stopping further processing`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:p.I.Failure,context:{target:QR,errorInfo:"onBeforeIntentAuthenticated"===e?k.Q.OnBeforeIntentAuthenticatedReturnedUndefined:k.Q.OnAfterIntentAuthenticatedReturnedUndefined}}),{intentOverridenByHook:!0,targetWindowId:a};if(o.metadata.cloud)return{intentOverridenByHook:s,targetWindowId:void 0,targetCloud:o.metadata.cloud,errorCode:r};if(t.intent.shouldRenderContent&&o.shouldRenderContent){this.logInternal(`evaluateHook(${e}), windowId: ${a}: - Executing overriden intent:`,o);return{intentOverridenByHook:s,targetWindowId:await jR(n,i,o,this.logger,this.commandChangeReportingService,this.coreSettings,a,r),errorCode:r}}}}return this.logger.log(`evaluateHook(${e}): windowId: ${a}: Completing evaluation. Intent was not overriden.`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:p.I.IntentHookCompleted,context:{target:QR}}),{intentOverridenByHook:!1,targetWindowId:a,errorCode:r,targetUserContextId:o?.metadata.userContextId}}logInternal(e,t){this.logger.log(`${e} {${t.shouldRenderContent?`${t.entityCommand.entity.type}, ${t.entityCommand.entity.action}, ${t.entityCommand.command.layoutMode}, ${t.entityCommand.command.visibilityState}}`:"nrc"}`)}async evaluateOnAfterIntentAuthenticatedHook(e,t,n,i,a){this.commandChangeReportingService.report({type:p.I.OnAfterIntentAuthenticatedStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:QR}});const{intentOverridenByHook:o,targetWindowId:r,errorCode:s}=await this.evaluateHook("onAfterIntentAuthenticated",{intent:zR(e),context:{authenticatedUser:i.authenticationUser,client:i.client,localStorage:i.localStorage,coreSettings:this.coreSettings,experienceChangeReportingService:i.experienceChangeReportingService,loggerFactory:i.loggerFactory,scenarioFactory:i.scenarioFactory}},t,n,a);return this.commandChangeReportingService.report({type:p.I.OnAfterIntentAuthenticatedCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:QR,eventData:{errorCode:s}}}),{intentOverridenByHook:o,targetWindowId:r,errorCode:s}}shouldGoToAccountListWindow(e,t){const n=this.appsRegistryService.getApp({entityType:e.entityCommand.entity.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:this.coreSettings,entity:e.entityCommand.entity})||!1;return!!this.coreSettings.get(c.w.Core)?.enableDeeplinkOptionAccountToUse&&0===e.metadata.accountsToUse?.length&&!!t&&e.metadata.userContextId===t&&(n||e.entityCommand.command.stateTransition===g.Ar.new)}async sendDeeplinkUserBi(e,t){YR(e,t,this.coreSettings,this.logger,this.waitForRenderingContextReady,this.appsRegistryService,this.userBiService)}}const ZR=new Map,XR=1e3,ex=/^\/|\/$/g,tx=0,nx=1,ix=2,ax=3;function ox(e){return e.toLowerCase()}function rx(e){if(!e||0===e.length)return;const t=ZR.get(e);if(t)return t;const n=e.replace(ex,"");if(0===n.length)return;const i=n.split("/");try{let t;if(i){let e=i.length-1;for(;e>=0;){const t=i[e].toLowerCase();if(ke.ck[t]&&(!ke.SY[t]||e!==i.length-1))break;e--}e>=0&&(t=function(e){let t;switch(e.length){case ax:t={type:ox(e[tx]),id:e[nx],action:ox(e[ix])};break;case ix:{const n=e[nx].toLowerCase();t=ke.SY[n]?{type:ox(e[tx]),action:ox(e[nx])}:{type:ox(e[tx]),id:e[nx],action:ke.SY.view};break}case nx:t={type:ox(e[tx]),action:ke.SY.default};break;default:throw new Error("Invalid entity fragment format found. Valid type, id or action is required.")}return t}(i.splice(e)))}return ZR.size<=XR&&t&&ZR.set(e,t),t}catch(e){throw new Error(`Unable to parse path into proper command. ${e.message}`)}}async function sx(e){const{commandChangeReportingService:t,coreSettings:n,experienceBasePath:i,location:a,scenarioCorrelation:o,loggerFactory:r,userContextId:s}=e,l=r.newLogger("DeeplinkUtilities","core-services-deeplink"),d=rg({coreSettings:n,experienceBasePath:i,location:a,loggerFactory:r});t.report({type:p.I.ScenarioEventDataAppended,correlationId:o.correlation.id,context:{target:"deeplink-parsing",eventData:{homeCloud:d?.homeCloud,recall:d?.recall,externalId:o.correlation.externalId,deeplinkId:o.correlation.deeplinkId}}});let u,m,h=!1;if(d&&d.isDesktopDeeplink){const t=await async function(e){const{commandChangeReportingService:t,deepLink:n,homeCloud:i,logger:a,scenarioCorrelation:o,userContextId:r,windowType:s}=e,l=Op.f5[n];if(l){let e;switch(a.log(`Static deeplink: ${l}`),n){case Op.f5.flyout:const t=Yt.Rm.minimal;e=cx({scenarioCorrelation:o,userContextId:r,deepLink:n,homeCloud:i,entity:px(t),layoutMode:t});break;case Op.f5.default:{let t=Yt.Rm.standard;s!==Op.dr.mini&&s!==Op.dr.main||(t=Yt.Rm.minimode),e=cx({scenarioCorrelation:o,userContextId:r,deepLink:n,homeCloud:i,entity:px(t),layoutMode:t});break}case Op.f5.core:e=cx({scenarioCorrelation:o,userContextId:r,deepLink:n,homeCloud:i})}return hx({commandChangeReportingService:t,correlationId:o.correlation.id,externalId:o.correlation.externalId,deeplinkId:o.correlation.deeplinkId,deeplinkType:l,mainEntityType:e?.shouldRenderContent?e?.entityCommand.entity.type:void 0,mainEntityAction:e?.shouldRenderContent?e?.entityCommand.entity.action:void 0,loadingWindowType:s}),{terminateDeeplink:!1,intent:e}}const c=await gx({...e,deepLink:n});if(c.intent||c.terminateDeeplink||c.errorCode===ye.InvalidOrigin)return c;const d=lx(n,o,r,i);return{terminateDeeplink:!1,intent:d}}({...e,userContextId:s||d.userContextId,deepLink:d.deepLink,homeCloud:d.homeCloud,logger:l,windowType:d.windowType});h=t.terminateDeeplink,u=t.intent,m=t.errorCode}else if(d){const t=await gx({...e,deepLink:d.deepLink,userContextId:s||d.userContextId,logger:l});h=t.terminateDeeplink,u=t.intent,m=t.errorCode}if(h)return{terminateDeeplink:h,intent:u};if(u||m===ye.InvalidOrigin||(u=function(e,t,n){const{hash:i,pathname:a}=e;let o;if(i&&!(0,we.isEmpty)(i)){const e=i.indexOf("?");o=e>=0?i.substr(0,e):i}else o=a;return lx(o,t,n)}(a,o,s)),!u&&d){const t=Xp(d.deepLink,e.coreSettings),n=zp(t);l.errorToTelemetry&&l.errorToTelemetry(n,"webclient_framework_foundation_core_services_deeplink",void 0,!0),u=await async function({commandChangeReportingService:e,originalDeeplink:t,coreSettings:n,hostCommunicationService:i,logger:a,scenarioCorrelation:o,userContextId:r}){const{enableUnsupportedDeeplinkDialog:s,enableUnsupportedDeeplinkDialogForTflToTfw:l,clientPreviewOptOutStrategy:d}=n.get(c.w.Core);a.log(`enableUnsupportedDeeplinkDialog: ${s}, enableUnsupportedDeeplinkDialogForTflToTfw: ${l}`);const u=l&&_R((0,CR.q)(t,n),n)===pg.el.life;if(u||s){let n="Web"===d;if("Desktop"===d){const e=await i.loadModule("appswitcher"),t=await(e?.getPearInstallState?.(_t.sS.Teams1));a.infoToTelemetry?.(`t1InstallState: ${t}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0),n=t===_t.Ll.InstalledNotActive||t===_t.Ll.InstalledActive}if(n){a.infoToTelemetry?.("Returning unsupported deeplink command","webclient_framework_foundation_core_services_deeplink",void 0,!0);const n=cx({scenarioCorrelation:o,userContextId:r,deepLink:t.toString(),entity:{type:ke.ck.unsupporteddeeplinkdialog,action:ke.SY.view},layoutMode:Yt.Rm.standard,stateTransition:g.Ar.extend,entityOptions:{originalDeeplink:t}}),{pathname:i}=t,s=Op.AR.find((e=>i.startsWith(e)))??"unsupported";return hx({commandChangeReportingService:e,correlationId:o.correlation.id,externalId:o.correlation.externalId,deeplinkId:o.correlation.deeplinkId,deeplinkType:s,mainEntityType:n?.entityCommand.entity.type,mainEntityAction:n?.entityCommand.entity.action}),n}}return}({commandChangeReportingService:e.commandChangeReportingService,originalDeeplink:t,coreSettings:e.coreSettings,hostCommunicationService:e.hostCommunicationService,logger:l,scenarioCorrelation:o,userContextId:s})}return{terminateDeeplink:!1,intent:u}}function lx(e,t,n,i){const a=rx(e);if(a)return cx({scenarioCorrelation:t,userContextId:n,deepLink:vx(e||Op.f5.default),entity:a,homeCloud:i})}function cx(e){const{scenarioCorrelation:t,userContextId:n,deepLink:i,homeCloud:a,entity:o,layoutMode:r,stateTransition:s=g.Ar.flush,entityOptions:l}=e;return o?{shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:yt({entity:o,command:{visibilityState:g.Rp.show,stateTransition:s,layoutMode:r,correlation:t.correlation},entityOptions:l,metadata:{deepLink:i}}),metadata:{allowAnonymous:!1,deepLink:i,homeCloud:a,userContextId:n}}:{shouldRenderContent:!1,scenarioCorrelation:t,metadata:{allowAnonymous:!1,deepLink:Op.f5.core,homeCloud:a,userContextId:n}}}async function dx(e){let t,n,i,a,o=!1;const{authenticationService:r,appsRegistryService:s,commandChangeReportingService:l,coreSettings:d,homeCloud:u,normalizedDeeplink:m,rawDeeplink:g,scenarioCorrelation:h,loggerFactory:v,logger:y,client:S,scenarioFactory:f,preferredCommandInput:k,userContextId:C,sourceViewEntity:b,forceInCloudExecution:w,getExperienceAccountMode:T,waitForRenderingContextReady:I,userBiService:N}=e,{enableOriginValidationForIncomingIntents:A,disableNormalizedDeeplinkToApps:E}=d.get(c.w.Core),F=d.get(c.w.Auth).enableAccountSelectionOnPreMeetingJoin;if(!w&&(A&&!F)&&!(0,CR.u)(m.toString(),d,!0))return{terminateDeeplink:!1,matchType:"originValidationForIncomingIntents",intent:void 0,reason:"Not a valid deeplink",errorCode:ye.InvalidOrigin};try{let a;const{pathname:w}=m,A="/"===w[0]?w.substr(1):w,F=function(e){if(e.hash){const t=new URL(e.hash.substring(1),e.origin),n={pathname:t.pathname};return t.search&&(n.search=(0,Bp.parse)(t.search)),n}}(m);for(const e of s.registeredApps){const{match:n,matchType:i,matchingCondition:o}=ux(e,A,m,F);if(n){a=o,t=i;break}}if(a){const t=e=>{l.report({correlationId:h.correlation.id,type:e,context:{target:"delegate-deeplink-to-app"}})};t(p.I.DeeplinkParseByAppStarted);const s=await a.execute({context:{__doNotUse_globalDataClient:S,coreSettings:d,getExperienceAccountMode:T,getUserContexts:async e=>async function(e){const{getExperienceAccountMode:t,userContextId:n,authenticationService:i,tenantId:a,logger:o,correlation:r}=e;o.log(`getUserContexts call with tenantId ${a}`);const s=await(i.getCachedUsers?.({id:r.id,source:r.source},{isAuthenticated:!0}))||[];o.log(`Auth service returned ${s.length} users`);const l=[],c=await MR(e);if(n&&n!==c&&t()!==kR.J.SingleAccount){o.log(`Adding source window to user context ${n}`);const t=await RR({...e,userContextId:n,userContextAccountType:FR.SourceWindow});t&&l.push(t)}if(c){o.log(`Adding main window to user context ${c}`);const t=await RR({...e,userContextId:c,userContextAccountType:FR.MainWindow});t&&l.push(t)}for(const t of s)if(t.id&&t.id!==n&&t.id!==c&&(!a||a===t.profile.tid)){o.log(`Adding ${t.id} user context`);const n=await RR({...e,userContextId:t.id,userContextAccountType:FR.Other});n&&l.push(n)}return l}({authenticationService:r,commandChangeReportingService:l,coreSettings:d,correlation:h.correlation,getExperienceAccountMode:T,logger:y,tenantId:e,userContextId:C,waitForRenderingContextReady:I}),loggerFactory:v,scenarioFactory:f,userBiService:N},deeplinkUrl:E?g:m,homeCloud:u,preferredCommandInput:k,sourceViewEntity:b,parsedDeeplinkHash:F});if(t(p.I.DeeplinkParseByAppSucceeded),s){const t=await async function(e){const{coreSettings:t,userContextId:n}=e;if(!t.get(c.w.Core)?.enableDeeplinkOptionAccountToUse)return{accountsToUse:n?[n]:void 0,userContextId:n};if(DR(e.homeCloud,t))return{accountsToUse:n?[n]:void 0,userContextId:n};const i=await MR(e);if(!i)return{accountsToUse:void 0,userContextId:n};const{accountsToUse:a,getExperienceAccountMode:o}=e;if(o()===kR.J.SingleAccount)return{accountsToUse:[i],userContextId:i};let r=n;a&&0===a.length&&(r=void 0);a&&a.length>=1&&(r=a[0]);return{accountsToUse:a,userContextId:r}}({...e,correlation:h.correlation,userContextId:C,waitForRenderingContextReady:I,accountsToUse:s.metadata.accountsToUse});n={...s,shouldRenderContent:!0,entityCommand:{...s.entityCommand,command:{...s.entityCommand.command,correlation:h.correlation},...g&&{metadata:{deepLink:g.toString()}}},scenarioCorrelation:h,metadata:{...s.metadata,deepLink:g.toString(),homeCloud:u,...t}}}else o=!0,i=ye.DeeplinkTerminatedByApp}else i=ye.DeeplinkNotHandledByRegisteredApps}catch(e){i=ye.OnBeforeDeeplinkParsedFailed,a=e.message;const t=e.reason,n=`${ve}/${i}/${(0,et.y)(a)}/${t}`;y.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}return{matchType:t,terminateDeeplink:o,intent:n,errorCode:i,reason:a}}function ux(e,t,n,i){if(!e.onBeforeDeeplinkParsed)return{match:!1};for(const a of e.onBeforeDeeplinkParsed){const{filter:o}=a;if(mx(o)){if(o(n,i))return{match:!0,matchType:`${e.manifest.name}#filterFn`,matchingCondition:a}}else{const e="/"===o[0]?o.substr(1):o;if(t.startsWith(e))return{match:!0,matchType:e,matchingCondition:a}}}return{match:!1}}function mx(e){return(0,we.isFunction)(e)}function px(e){return e===Yt.Rm.minimode||e===Yt.Rm.minimal?{type:ke.ck.flyout,action:ke.SY.default}:{action:ke.SY.default,type:ke.ck.default}}async function gx(e){const{commandChangeReportingService:t,coreSettings:n,deepLink:i,isInternalDeeplink:a,logger:o,scenarioCorrelation:r,userBiService:s}=e,l=Xp(i,n),c=(0,CR.q)(l,n),{matchType:d,terminateDeeplink:u,intent:m,errorCode:p,reason:g}=await dx({...e,normalizedDeeplink:c,rawDeeplink:l,logger:o});return function(e,t,n,i,a){const{pathname:o,search:r}=i,s="/"===o[0]?o.substr(1):o,l=Op.AR.find((e=>{const t="/"===e[0]?e.substr(1):e;return s.startsWith(t)}));if(!l)return;const c={};c["DataBag.joinLinkType"]=l.toString();const d=new URLSearchParams(r);c["DataBag.deeplinkId"]=d.get("deeplinkId"),c["DataBag.externalId"]=a?.entityCommand.command?.correlation?.externalId;const u=d.get("deeplinkId")??a?.entityCommand.entityOptions?.deepLinkId;c["DataBag.joinLinkVariant"]=d.get("v"),c["DataBag.launchType"]=d.get("launchType"),c["DataBag.launchAgent"]=d.get("launchAgent"),c["DataBag.laEntry"]=d.get("laEntry"),e.recordPanelAction({actionGesture:GR.Od.open,actionOutcome:GR.nd.open,actionScenario:GR.vB.deeplink,actionScenarioType:GR.DB.deeplink,moduleType:GR.nR.deeplink,moduleName:GR.Sn.deeplinkService,panelType:n?GR.HP.Internal:GR.HP.External,deeplinkId:u,dataBag:{id:"",data:{...c},dispose:()=>{}},mainEntityType:a?.entityCommand.entity.type,mainEntityAction:a?.entityCommand.entity.action},t)}(s,o,a,c,m),m?.shouldRenderContent?o.log(`Deeplink parsed to intent: { type: ${m.entityCommand.entity.type}, action: ${m.entityCommand.entity.action} }`):o.log("Returning default entity to be executed as fallback"),hx({commandChangeReportingService:t,correlationId:r.correlation.id,externalId:r.correlation.externalId,deeplinkId:r.correlation.deeplinkId,deeplinkType:d,mainEntityType:m?.entityCommand.entity.type,mainEntityAction:m?.entityCommand.entity.action,errorCode:p,reason:g}),{terminateDeeplink:u,intent:m,errorCode:p}}function hx(e){const{commandChangeReportingService:t,correlationId:n,externalId:i,deeplinkId:a,deeplinkType:o,mainEntityType:r,mainEntityAction:s,errorCode:l,reason:c,loadingWindowType:d}=e,u="deeplink-parsing";t.report({correlationId:n,type:p.I.DeeplinkParsed,context:{target:u,eventData:{externalId:i,deeplinkId:a,deeplinkType:o,loadingWindowType:d,mainEntityType:r,mainEntityAction:s,errorCode:l,reason:c}}}),t.report({type:p.I.ScenarioEventDataAppended,correlationId:n,context:{target:u,eventData:{externalId:i,deeplinkId:a,deeplinkType:o,loadingWindowType:d,mainEntityType:r,mainEntityAction:s,errorCode:l,reason:c}}})}const vx=e=>decodeURIComponent(e).replace(/[^A-Za-z0-9/.?&=#\+\-,_:@{}"]/g,"");class yx{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,v,y,S){this._client=i,this._waitForRenderingContextReady=a,this._host=o,this._appsRegistryService=r,this._config=s,this._correlation=l,this._scenarioFactory=c,this._userBiService=d,this._commandChangeReportingService=u,this._hostComms=m,this._localStorage=p,this._experienceChangeReportingService=g,this._acountModeTrackingService=h,this._activeWindowsService=v,this._authenticationService=y,this._delegatedCommanding=S,this._logger=e.newLogger("DeepLinkService","core-services-deeplink"),this._intentService=new KR(e,this._appsRegistryService,t,n,this._client,this._waitForRenderingContextReady,this._commandChangeReportingService,this._experienceChangeReportingService,this._scenarioFactory,this._hostComms,this._host,this._activeWindowsService,this._userBiService,this._delegatedCommanding),this._loggerFactory=e,this._coreSettings=t}async init(e){return this._hasEncounteredCriticalError=e,this._host.addEventListener("hashchange",(()=>{const e=function(e,t,n,i){return{clientLaunchId:tg({location:e,clientLaunchId:n}),correlation:ng(e,t,i),deeplinkId:ag(e,"deeplinkId")}}(this._host.location,A.p.ExternalCommand,void 0,"ExternalDesktopNavigation");return this._handleUrl(!1,e)})),this._handleUrl(!0,{clientLaunchId:tg({location:this._host.location}),correlation:{scenarioName:be.Cu.ClientStart,...this._correlation,sourceHint:"ExternalDesktopNavigation"},deeplinkId:ag(this._host.location,"deeplinkId")})}async executeFromUrlAsync(e,t,n,i,a,o,r){let s;this._logger.log(`executeFromUrlAsync::deepLinkUrl::'${e}'`);try{const l=new URL(e);s={correlation:t?.correlation?F(t.correlation):ng(l,A.p.InternalDeeplink),clientLaunchId:i},i&&this.sendDeeplinkReceivedSignal(s,n);const d=(0,ze.nv)(this._coreSettings),u=(0,CR.q)(l,this._coreSettings),m=_R(u,this._coreSettings),{enableOpenCrossCloudDeeplink:g,enableCrossCloudLaunch:h}=this._coreSettings.get(c.w.Core,["enableOpenCrossCloudDeeplink","enableCrossCloudLaunch"]);if(!r&&!this._isValidDeepLinkUrlForInCloudOrCrossCloudExecution(u.href,m))return this.stopNavigationScenarios(s,p.I.Incomplete,k.Q.DeeplinkIntentParseFailure,`Current cloud: ${d}, deeplinkCloud: ${m}, enableCrossCloudLaunch: ${h}`),!1;if(!r&&h&&m&&m!==d)return g?(this.stopNavigationScenarios(s,p.I.Incomplete,k.Q.DeeplinkLaunchCrossCloud,`Current cloud: ${d}, deeplinkCloud: ${m}, enableOpenCrossCloudDeeplink: ${g}`),!1):(await xR(m,this._commandChangeReportingService,e,this._hostComms,s.correlation,a?.userContextId),!0);const{terminateDeeplink:v,intent:y}=await this._getNavigationIntentAsync(l,!0,s,t,a?.userContextId,o,r);return v?(this.stopNavigationScenarios(s,p.I.Incomplete,k.Q.DeeplinkExecutionTerminated),!0):y?(y.options={isFromDeeplink:!0,sourceWindowId:a?.windowId},await this._intentService.execute(y),!0):(this.stopNavigationScenarios(s,p.I.Incomplete,k.Q.DeeplinkIntentParseFailure),!1)}catch(e){const t=`${ve}${ye.ToNavigationIntentFailed} ${(0,ge.hR)(e)}`;throw s&&this.stopNavigationScenarios(s,p.I.Failure,k.Q.DeeplinkIntentParseFailure,t),new Error(t)}}checkForPendingIntent(e,t,n){const i=F({scenarioName:be.Cu.NavigationCommand,...e});return t&&this.sendDeeplinkReceivedSignal({clientLaunchId:t,correlation:i},{type:"pendingIntent"}),this._intentService.checkForPendingIntent(i,n)}launchMainApp(e,t,n,i){const a={correlation:F({scenarioName:be.Cu.NavigationCommand,...e}),clientLaunchId:tg({clientLaunchId:t})};a.clientLaunchId&&this.sendDeeplinkReceivedSignal(a,{type:"default"});const o=n??{type:ke.ck.default,action:ke.SY.default};return this._intentService.launchMainApp(og(o),a,o,i)}launchMinimode(e,t,n){const i={correlation:F({scenarioName:be.Cu.NavigationCommand,...e}),clientLaunchId:tg({clientLaunchId:t})};i.clientLaunchId&&this.sendDeeplinkReceivedSignal(i,{type:"default"});const a=n??{type:ke.ck.default,action:ke.SY.default};return this._intentService.launchMinimode(og(a),i,a)}async switchAccount(e,t,n,i,a,o,r){const s={correlation:F({scenarioName:be.Cu.NavigationCommand,...e}),clientLaunchId:tg({clientLaunchId:n})};s.clientLaunchId&&this.sendDeeplinkReceivedSignal(s,{type:"switchAccount"});const l=i??{type:ke.ck.default,action:ke.SY.default};return a&&a!==(0,ze.nv)(this._coreSettings)?xR(a,this._commandChangeReportingService,r||og(l),this._hostComms,s.correlation,t):this._intentService.switchAccount(og(l),s,l,t,o)}prewarmFlyout(e,t=!1){const n={correlation:F({source:e,scenarioName:be.Cu.NavigationCommand}),clientLaunchId:tg({})},i=t?"minimode":"flyout";return this.sendDeeplinkReceivedSignal(n,{type:i}),this._intentService.prewarmFlyout(n,t)}async executeIntent(e,t){const n={correlation:F({...e.entityCommand.command.correlation,scenarioName:be.Cu.NavigationCommand}),clientLaunchId:tg({})};this.sendDeeplinkReceivedSignal(n,{type:`${e.entityCommand.entity.type}/${e.entityCommand.entity.action}`});const i=e.metadata.deepLink,{enableOpenCrossCloudDeeplink:a,enableCrossCloudLaunch:o}=this._coreSettings.get(c.w.Core,["enableOpenCrossCloudDeeplink","enableCrossCloudLaunch"]);if(!t&&i&&o){this._logger.log(`executeIntent::deepLinkUrl::'${i}'`);try{const t=_R(new URL(i),this._coreSettings),o=(0,ze.nv)(this._coreSettings);if(t&&t!==o&&this._isValidDeepLinkUrlForInCloudOrCrossCloudExecution(i,t))return a?(this.stopNavigationScenarios(n,p.I.Incomplete,k.Q.DeeplinkLaunchCrossCloud,`Current cloud: ${o}, deeplinkCloud: ${t}, enableOpenCrossCloudDeeplink: ${a}`),!1):(await xR(t,this._commandChangeReportingService,i,this._hostComms,n.correlation,e.metadata.userContextId),!0)}catch(e){const t=`${ve}${ye.InvalidDeepLinkUrl}::${e?.name}`;this._logger.warnToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}}return await this._intentService.execute({...e,entityCommand:{...e.entityCommand,command:{...e.entityCommand.command,correlation:n.correlation}},metadata:{...e.metadata,deepLink:i||og(e.entityCommand.entity)},scenarioCorrelation:n,shouldRenderContent:!0}),!0}async _handleUrl(e,t){if(this._lastDesktopClientId&&this._lastDesktopClientId===t.clientLaunchId)return void this._logger.errorToTelemetry?.("Navigation received with duplicate clientId. Terminating flow.","webclient_framework_foundation_core_services_deeplink",void 0,!0);this._lastDesktopClientId=t.clientLaunchId;const n=this._host.location;this._logger.log(`_handleUrl::location::'${n.href}'`),t.correlation.scenarioName&&t.clientLaunchId&&this.sendDeeplinkReceivedSignal(t);const{terminateDeeplink:i,intent:a}=await this._getNavigationIntentAsync(n,!1,t);let o=a;return i?(await this._notifyIntentHandled(),this.stopNavigationScenarios(t,p.I.Incomplete,k.Q.DeeplinkExecutionTerminated),void await this._clearHashFromLocation()):(!o&&this._config.shouldExecuteDefaultCommand&&(o=cx({scenarioCorrelation:t,userContextId:void 0,deepLink:Op.f5.default,entity:px(),layoutMode:Yt.Rm.standard})),o?(await this._notifyIntentHandled(),e&&this._experienceChangeReportingService.report({correlationId:t.correlation.id,type:Ua.Mk.InitialDeeplinkResolved,context:{target:"deeplink-service-handle-url",shouldRenderContent:o.shouldRenderContent}}),o.options={shouldSkipMinimodeOverride:e,isFromDeeplink:!0},this._intentService.execute(o,this._clearHashFromLocation.bind(this))):(this.stopNavigationScenarios(t,p.I.Failure,k.Q.DeeplinkIntentParseFailure),void await this._clearHashFromLocation()))}_isValidDeepLinkUrlForInCloudOrCrossCloudExecution(e,t){try{const n=this._coreSettings.get(c.w.Core).validCloudsForInternalDeeplinks||[];return(!t||n.includes(t))&&(0,CR.u)(e,this._coreSettings)}catch(e){const t=`${ve}${ye.InvalidDeepLinkUrl}::${e?.name}`;return this._logger.errorToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0),!1}}async _notifyIntentHandled(){try{const e=await this._hostComms.loadModule("core");await(e?.intentHandled?.())}catch(e){this._logger.warn("Failed to notify host that intent was handled")}}async _clearHashFromLocation(){const{clientPreviewOptOutStrategy:e}=this._coreSettings.get(c.w.Core);if("Web"!==e||this._hasEncounteredCriticalError)return;const t=this._host.location;if(t.search.includes("meetingjoin=true")){if((await this._authenticationService.getUser()).role===pg.a7.Anonymous)return}if(t.hash){this._logger.log("Clearing hash from location");const e=new URL(t.href);e.hash="",this._host.history.pushState("",this._host.document.title,e)}}async _getNavigationIntentAsync(e,t,n,i,a,o,r){try{return await sx({authenticationService:this._authenticationService,appsRegistryService:this._appsRegistryService,experienceBasePath:this._config.basePath,coreSettings:this._coreSettings,hostCommunicationService:this._hostComms,location:e,scenarioCorrelation:n,loggerFactory:this._loggerFactory,userBiService:this._userBiService,isInternalDeeplink:t,commandChangeReportingService:this._commandChangeReportingService,intentPersistenceService:new wR(this._localStorage),userContextId:a,client:this._client,preferredCommandInput:i,sourceViewEntity:o,scenarioFactory:this._scenarioFactory,forceInCloudExecution:r,getExperienceAccountMode:()=>this._acountModeTrackingService?this._acountModeTrackingService.getAccountMode():kR.J.SingleAccount,waitForRenderingContextReady:this._waitForRenderingContextReady})}catch(e){this._logger.errorToTelemetry?.(`${ve}${ye.ToNavigationIntentFailed}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}return{terminateDeeplink:!1}}sendDeeplinkReceivedSignal({clientLaunchId:e,correlation:t,deeplinkId:n},i){this._scenarioFactory.findScenarioByNameAndId(be.Cu.NavigationCommand,e)&&(t.scenarioName=be.Cu.NavigationCommand),this._commandChangeReportingService.report({type:p.I.NavigationCommandStart,correlationId:t.id,context:{target:"deeplink-service",clientLaunchId:e,correlation:t,eventData:{deeplinkId:n,scenarioPhase:"Core",...i}}})}stopNavigationScenarios(e,t,n,i){this._logger.warn("Navigation intent not found");const a=this._scenarioFactory.findScenario(be.Cu.ApplicationLaunchTime);a?.fail({errorCode:n}),this._commandChangeReportingService.report({type:t,correlationId:e.correlation.id,context:{target:"deeplink-service-handle-url",errorInfo:n,errorMessage:i}})}}class Sx extends xp{constructor(){super(d.c1.CreateDeeplinkService,["activeWindowsService","appsRegistryService","authenticationService","client","commandChangeReportingService","commandHandler","config","coreSettings","correlation","delegatedCommanding","experienceChangeReportingService","hostCommunicationService","localStorage","loggerFactory","scenarioFactory","userBiService","waitForRenderingContextReady","windowProvider"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,authenticationService:i,client:a,commandChangeReportingService:o,commandHandler:r,config:s,coreSettings:l,correlation:c,delegatedCommanding:d,experienceChangeReportingService:u,hostCommunicationService:m,localStorage:p,loggerFactory:g,scenarioFactory:h,userBiService:v,userTrackingService:y,waitForRenderingContextReady:S,windowProvider:f}=e;e.deeplinkService=new yx(g,l,r,a,S,f,n,s,c,h,v,o,m,p,u,y,t,i,d)}}const fx="default";class kx extends xp{constructor(){super(d.c1.CreateDefaultCacheStorageAndCacheManagers,["config","loggerFactory","windowProvider","coreSettings","scenarioFactory"])}async execute(e){const{windowProvider:t,config:n,loggerFactory:i,coreSettings:a,scenarioFactory:o}=e,r=new kv(t.caches,fx,fx,n.experienceName);e.cacheStorage=r,e.offlineCacheManager=new Cv(r,i);(0,Xy.ZG)(a)&&(e.workerCacheManager=Gy(n.experienceName,i.newLogger("CreateDefaultCacheStorageAndCacheManagersTask","core-services-tasks"),o))}}const Cx="total";class bx{constructor(e,t,n,i,a){this.tid=e,this.oid=t,this.experienceName=n,this.windowProvider=i,this.keysUsageMetadata={},this.enableLocalStorageMetadata=false,this.getMetadataKey=e=>function(e){return e.substring(4)}(e.replace(/[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{8}/gi,"guid")),this.getTimestampForMetadata=()=>{const e=new Date;return`${`0${e.getMonth()+1}`.slice(-2)}${e.getDate()}${e.getFullYear()}`},this.logger=a.newLogger("LocalStorageService","services-io-browser-local-storage")}set(e,t,n,i="UserAndExperience"){try{this.rawSet(e,t,n,i)}catch(a){throw this.recordSetFailure(e,i,n,t,a?.name),a}}trySet(e,t,n,i="UserAndExperience"){try{return this.set(e,t,n,i),!0}catch(e){return!1}}get(e,t="UserAndExperience"){const n=this.getFormatKey(e,t),i=this.getStorageForScope(t).getItem(n);return i&&null!==i?this.updateKeyUsageMetadata(n,i,"get",void 0):this.removeKeyUsageMetadata(n),i}remove(e,t="UserAndExperience"){const n=this.getFormatKey(e,t);this.getStorageForScope(t).removeItem(n),this.removeKeyUsageMetadata(n)}clear(e){if(e){const t=e.map((e=>this.getFormatKey("",e)));Object.keys(this.windowProvider.localStorage).filter((e=>e.startsWith(th)&&t.some((t=>e.startsWith(t))))).forEach((e=>{this.windowProvider.localStorage.removeItem(e),this.removeKeyUsageMetadata(e)}))}else this.windowProvider.localStorage.clear(),this.clearMetadata()}calculateUsageStats(){const e={Global:{},SessionGlobal:{},User:{},Experience:{},UserAndExperience:{},Unmanaged:{}};return Object.keys(this.windowProvider.localStorage).forEach((t=>{const n=this.getScopeFromKey(t);n&&(e[n][t]=nh(t,this.windowProvider.localStorage[t]))})),e}getUsageMetadataStats(){return{...this.keysUsageMetadata}}subscribeToCoreSettings(e){this.settingsObservable=e.getObservable(c.w.Core,["enableLocalStorageMetadata"]).subscribe((e=>{const{enableLocalStorageMetadata:t}=e;this.enableLocalStorageMetadata&&!t&&(this.keysUsageMetadata={}),this.enableLocalStorageMetadata=t||false}))}dispose(){this.settingsObservable?.unsubscribe(),this.keysUsageMetadata={}}rawSet(e,t,n,i="UserAndExperience"){const a=this.getFormatKey(e,i);this.getStorageForScope(i).setItem(a,t),this.updateKeyUsageMetadata(a,t,"set",n)}getFormatKey(e,t){switch(t){case"Experience":return`${th}${this.experienceName}.${e}`;case"User":return`${th}${this.tid}.${this.oid}.${e}`;case"Global":return`${th}${e}`;case"SessionGlobal":return`${th}session.${e}`;default:return`${th}${this.tid}.${this.oid}.${this.experienceName}.${e}`}}getStorageForScope(e){return"SessionGlobal"===e?this.windowProvider.sessionStorage:this.windowProvider.localStorage}getScopeFromKey(e){let t=this.getFormatKey("","UserAndExperience");return e.startsWith(t)?"UserAndExperience":(t=this.getFormatKey("","User"),e.startsWith(t)?"User":(t=this.getFormatKey("","Experience"),e.startsWith(t)?"Experience":(t=this.getFormatKey("","SessionGlobal"),e.startsWith(t)?"SessionGlobal":(t=this.getFormatKey("","Global"),e.startsWith(t)?"Global":"Unmanaged"))))}convertToKeyForTelemetry(e){return function(e){const t="draft.",n="draftindex.";let i=e.indexOf(t);return i>=0?i+=6:(i=e.indexOf(n),i>=0&&(i+=11)),i<0?e:`${e.substring(0,i)}threadId`}(e.replace(/[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}/gi,"guid"))}recordKeySizeChange(e,t,n,i,a,o){const r=this.keysUsageMetadata[t][Cx];r.size+=i,r.accessCount++,r.lastAccessTime=a;const s=this.convertToKeyForTelemetry(e);this.logger.infoToTelemetry?.(`Key '${s}' update. Category: ${t}, new size: ${n}, size change: ${i}`,"localstorage_key_update",{name:this.convertToKeyForTelemetry(e),size:n,sizeChange:i,operationName:o,itemType:t},!0),0!==i&&this.logger.infoToTelemetry?.(`Category update: ${t}. New size: ${r.size}, size change: ${i}`,"localstorage_category_update",{name:t,size:r.size,sizeChange:i,operationName:o},!0)}recordSetFailure(e,t,n,i,a){const o=this.getFormatKey(e,t),r=nh(o,i);let s=0;if(this.enableLocalStorageMetadata){const e=this.getMetadataKey(o),t=this.keysUsageMetadata[n]&&this.keysUsageMetadata[n][e];s=t?.size||0}const l=r-s,c=this.convertToKeyForTelemetry(o);this.logger.errorToTelemetry?.(`Failed to save ${c}, category ${n}. Size: ${r}, size change: ${l}`,"localstorage_key_update",{name:this.convertToKeyForTelemetry(o),size:r,sizeChange:l,operationName:"set",errorCode:a,itemType:n},!0)}updateKeyUsageMetadata(e,t,n,i){if(!this.enableLocalStorageMetadata)return;const a=this.getMetadataKey(e);let o;if(i)o=this.keysUsageMetadata[i]&&this.keysUsageMetadata[i][a];else for(const e in this.keysUsageMetadata)if(this.keysUsageMetadata.hasOwnProperty(e)&&(o=this.keysUsageMetadata[e][a],o)){i=e;break}if(!i)return;const r=o?.size||0;let s=0;const l=this.getTimestampForMetadata();o?(s=nh(e,t),o.size=s,o.accessCount++,o.lastAccessTime=l):i&&(this.ensureCategoryExists(i),s=nh(e,t),this.keysUsageMetadata[i][a]={size:s,accessCount:1,lastAccessTime:l});const c=s-r;this.recordKeySizeChange(e,i,s,c,l,n)}removeKeyUsageMetadata(e){if(!this.enableLocalStorageMetadata)return;const t=this.getMetadataKey(e);let n;for(const i in this.keysUsageMetadata)if(this.keysUsageMetadata.hasOwnProperty(i)&&(n=this.keysUsageMetadata[i][t],n)){this.recordKeySizeChange(e,i,0,-n.size,this.getTimestampForMetadata(),"remove"),delete this.keysUsageMetadata[i][t];break}}ensureCategoryExists(e){this.keysUsageMetadata[e]||(this.keysUsageMetadata[e]={},this.keysUsageMetadata[e][Cx]={size:0,accessCount:0,lastAccessTime:""})}clearMetadata(){for(const e in this.keysUsageMetadata){if(!this.keysUsageMetadata.hasOwnProperty(e))continue;const t=this.keysUsageMetadata[e];this.logger.infoToTelemetry?.(`Category update: ${e}. New size: ${t.size}, size change: ${-t.size}`,"localstorage_category_update",{name:e,size:0,sizeChange:-t.size,operationName:"remove"})}this.keysUsageMetadata={}}}const wx="default";class Tx extends xp{constructor(){super(d.c1.CreateDefaultLocalStorage,["config","loggerFactory","windowProvider"])}async execute(e){const{windowProvider:t,loggerFactory:n,config:i}=e,a=new bx(wx,wx,i.experienceName,t,n);return e.localStorage=a,e=>{switch(e){case"quit":case"restart":case"signout":a.dispose()}}}}class Ix extends xp{constructor(){super(d.c1.DisableExperience,["platformService","coreSettings","loggerFactory"])}async execute(e){const{platformService:t,coreSettings:n,loggerFactory:i}=e,a=t.config?.browser,{supportedBrowsers:o}=n.get(c.w.Core);if(a&&o){if(!!!o?.find((e=>e===a)))throw(0,Je.$5)(d.Ir.Core,d.O4.Disabled,"DisableUnsupportedBrowsersTask",void 0,`Browser "${a}" is not supported.`)}else a||i.newLogger("DisableUnsupportedBrowsersTask","core-services-tasks").warn("Unable to detect Browser.")}}class Nx extends xp{constructor(){super(d.c1.CreateDiscovery,["authenticationService","loggerFactory","coreSettings","scenarioFactory","appStateService","networkState","hostCommunicationService","platformService"])}async execute(e){const{onDiscoverSuccess:t,onDiscoverFail:n}=this.getDiscoverCallback(e),{authenticationService:i,loggerFactory:a,coreSettings:o,scenarioFactory:r,appStateService:s,networkState:l,authStateProvider:c,i18n:d,hostCommunicationService:u,platformService:m}=e,p=(0,Bh.sc)(s);e.discover=jh(i,a,ah.t,o,r,p,l,u,d,c,void 0,t,n,void 0,void 0,void 0,{clientVersion:m.config.clientVersion,clientType:m.config.clientType})}getDiscoverCallback(e){let t,n;return e.platformService?.config.hostingParent===nt.NM.Outlook&&(t=()=>{e.windowProvider.sessionStorage.removeItem(nF.nz),e.windowProvider.sessionStorage.removeItem(nF.Gr)},n=t=>{t||"true"!==e.windowProvider.sessionStorage.getItem(nF.Gr)||(e.windowProvider.sessionStorage.setItem(nF.nz,"true"),e.windowProvider.location.reload())}),{onDiscoverSuccess:t,onDiscoverFail:n}}}var Ax;!function(e){e[e.Success=0]="Success",e[e.InvalidArguments=1]="InvalidArguments",e[e.GroupNameExists=2]="GroupNameExists"}(Ax||(Ax={}));class Ex{constructor(e){this.isCompleted=!1,this.subscriptions=new Set,this.observedValue=e,this.observable$=new(Ev())((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e,t){return this.isCompleted&&t.error("Subject: tried to subscribe to a complete observable"),this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next({...e})}))}onComplete(){this.isCompleted=!0,this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.isCompleted=!0,this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}class Fx{constructor(){this._endpointsHealthCache={},this._groupsHealthCache={},this.getEndpointHealth=(e,t)=>{if(e&&t){const n=this._endpointsHealthCache[this._getCacheKey(e,t)];return n?{...n.value}:void 0}},this.observeEndpointHealth=(e,t)=>e&&t?this._getHealthRecord(e,t).observable:void 0,this.observeAggregatedHealth=e=>e?this._getHealthRecord(e,void 0).observable:void 0,this.dumpState=()=>JSON.stringify({...this._endpointsHealthCache,...this._groupsHealthCache},((e,t)=>t instanceof Ex?t.value:t)),this.updateRemoteEndpointHealth=e=>{if(!e.serviceName)return;const t=this._getHealthRecord(e.serviceName,e.endpointName);t.value.isHealthy!==e.isHealthy&&(t.value.isHealthy=e.isHealthy,t.onNext(t.value))},this._getCacheKey=(e,t)=>`${e}_${t||""}`,this._getHealthRecord=(e,t)=>(t?this._endpointsHealthCache[this._getCacheKey(e,t)]:this._groupsHealthCache[this._getCacheKey(e,t)])||this._startTrackingHealth(e,t),this._startTrackingHealth=(e,t)=>{if(t){const n=new Ex({serviceName:e,endpointName:t,isHealthy:void 0});return this._endpointsHealthCache[this._getCacheKey(e,t)]=n,n}{const n=new Ex({groupName:e,isHealthy:void 0});return this._groupsHealthCache[this._getCacheKey(e,t)]=n,n}}}getAggregatedHealth(e){if(e){const t=this._groupsHealthCache[this._getCacheKey(e,void 0)];return t?{...t.value}:void 0}}dispose(){this._endpointsHealthCache={},this._groupsHealthCache={}}}class _x{constructor(e,t){this._endpointsManager=e,this._logger=t,this._subscriptions=[],this._aggregatedHealthMap=new Map,this._remoteEndpointsHealthCache=new Fx,this.observeEndpointHealth=(e,t)=>this._getLocalEndpointHealth(e,t)?this._getLocalEndpointObservable(e,t):this._getRemoteEndpointHealth(e,t)?this._getRemoteEndpointObservable(e,t):this._getLocalEndpointObservable(e,t),this.getEndpointHealth=(e,t)=>this._getLocalEndpointHealth(e,t)||this._getRemoteEndpointHealth(e,t),this.observeAggregatedHealth=e=>this._aggregatedHealthMap.get(e)?.healthSubject.observable,this.getAggregatedHealth=e=>this._getLocalAggregatedHealth(e)||this._getRemoteAggregatedHealth(e),this.dumpState=()=>(0,ge.Gu)(`{ "aggregated endpoints health": [\n      ${this._printAggregatedHealth(this._aggregatedHealthMap)}\n    ],\n    "endpoints health": [\n      ${this._endpointsManager.health.dumpState()}\n    ]},\n    "remote endpoints health": ${this._remoteEndpointsHealthCache.dumpState()}`),this.getWorkerDumpState=()=>this._requestWorkerStateDumpCallback?(this._deferredWorkerStateDump=(0,Wv.v)(),this._requestWorkerStateDumpCallback(),this._deferredWorkerStateDump.promise):Promise.reject("Worker endpoints health snapshot can't be requested"),this.getEndpointsHealthUpdateHandler=()=>({handleEndpointHealthUpdate:this._remoteEndpointsHealthCache.updateRemoteEndpointHealth,handleStateDump:this._handleWorkerStateDumpResponse,onStateDumpRequest:this._setWorkerStateDumpRequestCallback}),this._getLocalEndpointHealth=(e,t)=>this._endpointsManager.health.getEndpointHealth(e,t),this._getLocalEndpointObservable=(e,t)=>this._endpointsManager.health.observeEndpointHealth(e,t),this._getRemoteEndpointHealth=(e,t)=>this._remoteEndpointsHealthCache.getEndpointHealth(e,t),this._getRemoteEndpointObservable=(e,t)=>this._remoteEndpointsHealthCache.observeEndpointHealth(e,t),this._updateAggregatedHealth=(e,t,n)=>{const i=e.healthSubject.value,a=[];if(i.endpoints)for(const e of i.endpoints)if(e.endpointName===t.endpointName&&e.serviceName===t.serviceName)a.push(t);else{const t=this._endpointsManager.health.getEndpointHealth(e.serviceName,e.endpointName);t&&a.push(t)}try{const t=n(a);t!==i.isHealthy&&(i.isHealthy=t,e.healthSubject.onNext(i))}catch(e){this._logger.error(`Error happened in aggregated group health policy. Group: ${i.groupName}. Error: ${JSON.stringify(e.reason||e)}`)}},this._printAggregatedHealth=e=>{let t="";return e.forEach((e=>{t=`${t},${JSON.stringify(e.healthSubject.value)}`})),t?(0,ge.Gu)(t):""},this._handleWorkerStateDumpResponse=e=>{this._logger.log("Received worker endpoints health state dump."),this._deferredWorkerStateDump&&(this._deferredWorkerStateDump.resolve(e),this._deferredWorkerStateDump=void 0)},this._setWorkerStateDumpRequestCallback=e=>{this._requestWorkerStateDumpCallback=e}}createAggregatedHealthGroup(e,t,n){if(!e||0===e.length||!t||0===t.length)return this._logger.error(`createAggregatedHealthGroup: Group name is empty or no endpoints are provided. groupName: ${e}; endpoints: ${t&&JSON.stringify(t)}`),Ax.InvalidArguments;if(this.getAggregatedHealth(e))return this._logger.error(`createAggregatedHealthGroup: Group name already exists. groupName: ${e}`),Ax.GroupNameExists;const i={healthSubject:new Ex({groupName:e,endpoints:t,isHealthy:void 0})};return this._aggregatedHealthMap.set(e,i),t.forEach((t=>{const i=this.observeEndpointHealth(t.serviceName,t.endpointName)?.subscribe((t=>{const i=this._aggregatedHealthMap.get(e);i||this._logger.error(`Can't update group health. Group '${e}' is not registered`),i&&this._updateAggregatedHealth(i,t,n)}));i&&this._subscriptions.push(i)})),Ax.Success}dispose(){this._subscriptions.map((e=>e.unsubscribe())),this._subscriptions=[],this._aggregatedHealthMap.clear(),this._remoteEndpointsHealthCache.dispose(),this._requestWorkerStateDumpCallback=void 0,this._deferredWorkerStateDump?.reject("CombinedEndpointsHealthService is disposed"),this._deferredWorkerStateDump=void 0}_getLocalAggregatedHealth(e){return this._aggregatedHealthMap.get(e)?.healthSubject.value}_getRemoteAggregatedHealth(e){return this._remoteEndpointsHealthCache.getAggregatedHealth(e)}}class Dx{constructor(e,t){this._endpointsManager=e,this._logger=t,this._subscriptions=[],this._aggregatedHealthMap=new Map,this.observeEndpointHealth=(e,t)=>this._endpointsManager.health.observeEndpointHealth(e,t),this.getEndpointHealth=(e,t)=>this._endpointsManager.health.getEndpointHealth(e,t),this.observeAggregatedHealth=e=>this._aggregatedHealthMap.get(e)?.healthSubject.observable,this.getAggregatedHealth=e=>this._aggregatedHealthMap.get(e)?.healthSubject.value,this.dumpState=()=>`{ "aggregated endpoints health": [\n      ${this._printAggregatedHealth(this._aggregatedHealthMap)}\n    ],\n    "endpoints health": [\n      ${this._endpointsManager.health.dumpState()}\n    ]}`,this._updateAggregatedHealth=(e,t,n)=>{const i=e.healthSubject.value,a=[];if(i.endpoints)for(const e of i.endpoints)if(e.endpointName===t.endpointName&&e.serviceName===t.serviceName)a.push(t);else{const t=this._endpointsManager.health.getEndpointHealth(e.serviceName,e.endpointName);t&&a.push(t)}try{const t=n(a);t!==i.isHealthy&&(i.isHealthy=t,e.healthSubject.onNext(i))}catch(e){this._logger.error(`Error happened in aggregated group health policy. Group: ${i.groupName}. Error: ${JSON.stringify(e.reason||e)}`)}},this._printAggregatedHealth=e=>{let t="";return e.forEach((e=>{t=`${t},${JSON.stringify(e.healthSubject.value)}`})),t?(0,ge.Gu)(t):""}}createAggregatedHealthGroup(e,t,n){if(!e||0===e.length||!t||0===t.length)return this._logger.error(`createAggregatedHealthGroup: Group name is empty or no endpoints are provided. groupName: ${e}; endpoints: ${t&&JSON.stringify(t)}`),Ax.InvalidArguments;if(this.getAggregatedHealth(e))return this._logger.error(`createAggregatedHealthGroup: Group name already exists. groupName: ${e}`),Ax.GroupNameExists;const i={healthSubject:new Ex({groupName:e,endpoints:t,isHealthy:void 0})};return this._aggregatedHealthMap.set(e,i),t.forEach((t=>{const i=this.observeEndpointHealth(t.serviceName,t.endpointName)?.subscribe((t=>{const i=this._aggregatedHealthMap.get(e);i||this._logger.error(`Can't update group health. Group '${e}' is not registered`),i&&this._updateAggregatedHealth(i,t,n)}));i&&this._subscriptions.push(i)})),Ax.Success}dispose(){this._subscriptions.map((e=>e.unsubscribe())),this._subscriptions=[],this._aggregatedHealthMap.clear()}}var Px=n(21534),Mx=n(34412),Rx=n.n(Mx);const xx=({url:e,method:t,body:n,headers:i,credentials:a,timeout:o,signal:r},s,l)=>{if(r?.aborted)throw(0,zg.$)(Hg.B.RequestCancelled);return qg(Rx()(e,{method:t,headers:i&&new Headers(i),body:n,signal:r,credentials:a}),s,o??l.defaultRequestTimeoutInMs).then((e=>{const t={};return e.headers?.forEach(((e,n)=>t[n]=e)),{status:e.status,headers:t,body:e,url:e.url}}))},Lx="failed to fetch";const Ox=async(e,t)=>{const n=e.operationLogger.logStep(Og.ew.AuthDecorate);try{const i=await t(e);return n(Og.nW[Og.nW.OK]),i}catch(e){throw n(Hg.B.AuthFailed),(0,zg.$)(Hg.B.AuthFailed,void 0,e)}},jx=async(e,t,n)=>{const i=t.operationLogger.beginStep(Og.ew.AuthResolve,t);try{const a=n(e,t);return a.then((t=>(t&&i(Og.nW[e.status],e),t))),await a}catch(t){throw i(Og.nW[e.status],e),(0,zg.$)(Hg.B.AuthResolveFailed,e,t)}};function Bx(e,t=Og.nW.NOT_FOUND){return Array.isArray(t)?t.some((t=>Ux(e,t))):Ux(e,t)}function Ux(e,t){return"string"==typeof t?new RegExp(t.replace(/x/gi,"\\d")).test(e.toString()):e===t}const $x=(e,t)=>t.indexOf(e)>-1||t.filter(Wx).map((e=>new RegExp(e.replace(/x/gi,"\\d")))).some((t=>t.test(e.toString())));function Wx(e){return"string"==typeof e}const Vx=(e,t,n,{globalContext:i})=>async a=>{let o=await Hx(e)(a);for(let r=0;;r++){const{response:s,error:l}=o,c=s?.status,d=c||l?.reason||Hg.B.FailedToFetch,u=s?.headers,m=n.get(d)||0;if(n.set(d,m+1),!t.shouldRetry(r,d,n,u)){if(l)throw l;return o.response}{const n=t.nextDelay(r,u,d),m=c&&Og.nW[c]||void 0;a.operationLogger.nextStep(Og.ew.RetryDelay,l||m,void 0,s),await Gg(n,i),a.operationLogger.nextStep(Og.ew.Retry,Og.nW[Og.nW.OK],a),o=await Hx(e)(a)}}},Hx=e=>async t=>{try{return{response:await e(t)}}catch(e){return{response:e.serverResponse,error:e}}};const zx=(e,t)=>{if(e){const n=t.get(e);if(!n)throw(0,zg.$)(Hg.B.InvalidCancellationToken);return n}},qx=(e,t,n,i)=>{const{cancellationMap:a}=i;let o=e;return o=function(e,t,n){return async i=>{const{cancellationToken:a}=i,o=zx(a,t)??new AbortController;i.signal=o.signal;try{return await e(i)}catch(e){throw e?.reason!==Hg.B.TimedOut||void 0!==n&&!n||o.abort(),e}}}(o,i.cancellationMap,t.abortOnTimeout),n.authResource&&(o=((e,t)=>async n=>{const i=await Ox(n,t),a=i.request,o=await e(a),r=await jx(o,a,i.resolver);return r?(r.operationLogger.nextStep(Og.ew.Auth,Og.nW[o.status],r,o),e(r)):o})(o,n.authResource)),o=((e,t,n)=>async i=>{const{baseUrl:a,baseUrlPromise:o}=t,r=i.operationLogger.logStep(Og.ew.BaseUrlResolve),s=a||o&&await qg(o().catch((e=>{throw r(e.reason),(0,zg.$)(Hg.B.BaseUrlFailedToResolve,void 0,e)})),n.globalContext,n.configuration.baseUrlResolutionTimeoutInMs,Hg.B.BaseUrlTimeout);try{if(s){const e=!s.endsWith("/")&&i.url.length>0?`${s}/`:s,t=i.url.startsWith("/")?i.url.substring(1):i.url;i.url=new URL(t,e).href}}catch(e){throw r(Hg.B.InvalidUrl),(0,zg.$)(Hg.B.InvalidUrl)}return r(Og.nW[Og.nW.OK]),e(i)})(o,n,i),o=((e,t,n)=>{if(!t.redirectPolicy)return e;const{maxRedirects:i,useAbsoluteRedirect:a,headers:o,redirectOn:r,onRedirect:s}=t.redirectPolicy;return async t=>{const l={...t,headers:{...t.headers,...o}};let c=await e(l);for(let o=0;;o++){const{status:d,headers:{location:u}}=c;if(!(o<i&&Bx(d,r)))return c;try{let e;if(s?e=s(u,d):u&&(e=new URL(u)),!e)return c;a?(n.baseUrl=e.origin,l.url=e.pathname):(l.url=t.url,n.baseUrl=e.href)}catch(e){throw(0,zg.$)(Hg.B.InvalidUrl,void 0,e)}l.operationLogger.nextStep(Og.ew.Redirect,Og.nW[c.status],l,c),c=await e(l)}}})(o,t,n),t.rejectHttpError&&(o=function(e){return async t=>{const n=await e(t);if(n.status>=Og.nW.BAD_REQUEST)throw(0,zg.$)(Hg.B.RequireStatusFailed,n,[Og.nW[n.status]]);return n}}(o)),t.allowedResponses&&(o=function(e,...t){return n=>e(n).then((e=>{if($x(e.status,t))return e;const n=[Og.nW[e.status]];throw(0,zg.$)(Hg.B.RequireStatusFailed,e,n)}))}(o,...t.allowedResponses)),t.retryPolicy&&(o=function(e,t,n){const i=new Map;return a=>Vx(e,t,i,n)(a)}(o,t.retryPolicy,i)),o=((e,t)=>async n=>{const{cancellationToken:i}=n;i&&t.set(i,new AbortController);try{return await e(n)}finally{i&&t.delete(i)}})(o,a),o},Gx=(e,t)=>{const n=[];let i;const a=(t,i,a)=>{const o=new Date;return(r,s,l)=>{n.push({type:t,duration:r-i,result:s,request:Yx(e,o,a,l)})}},o=(e,t)=>{const n=performance.now();return(o,r)=>{i(n,o,r),i=a(e,n,t)}};return i=a(Og.ew.Initial,performance.now(),t),{nextStep:(e,t,n,i)=>{o(e,n)(t,i)},beginStep:o,logStep:(e,t,n)=>{const i=a(e,performance.now(),t);return e=>i(performance.now(),e,n)},complete:(e,t)=>(i(performance.now(),e,t),n)}};function Yx(e,t,n,i){if(!n)return;const a=i?new URL(i.url).hostname:"";return{name:n.apiName||"",dateTime:t,method:n.method,hostname:a,requestHeaders:n.headers||{},responseHeaders:i?.headers||{},status:i?.status,performance:Kx(e,i?.url),authPerformanceLogs:Qx(n)}}function Qx(e){return e.authPerformanceLogs||{}}const Jx=3e4;async function Kx(e,t){return t?new Promise((n=>{const i={},a=()=>{i.observer?.disconnect(),i.observer=void 0,i.timeoutHandle&&e.clearTimeout(i.timeoutHandle),i.timeoutHandle=void 0};i.observer=new PerformanceObserver((e=>{const i=e.getEntries().find((e=>t===e.name));i&&(a(),n(i))})),i.timeoutHandle=e.setTimeout((()=>{a(),n(void 0)}),Jx),i.observer.observe({entryTypes:["resource"]})})):Promise.reject()}class Zx{constructor(e){this.subscriptions=new Set,this.observedValue=e,this.observable$=new(Ev())((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}const Xx=!0,eL=!1,tL=new Zx(Xx);const nL=()=>{const e=new Map,t=(t,n)=>e.get(oL(t,n))||((t,n)=>{const i={responseHistory:[],healthSubject:new Zx({serviceName:t,endpointName:n,isHealthy:void 0})};return e.set(oL(t,n),i),i})(t,n),n=(e,n,i,a)=>{const o=t(n,e);((e,t,n)=>{e.responseHistory.push(t),e.responseHistory.length>n&&e.responseHistory.shift()})(o,i,a.historyLength);const r=a.isHealthy([...o.responseHistory]);if(o.healthSubject.value.isHealthy!==r){const t={serviceName:n,endpointName:e,isHealthy:r};o.healthSubject.onNext(t)}};return{trackHealth:(e,t,i)=>rL(e,n,t,iL(i)),observeEndpointHealth:(e,n)=>{if(!e||!n)return;return t(e,n).healthSubject.observable},getEndpointHealth:(t,n)=>aL(t,n,e),dumpState:()=>lL(e)}},iL=e=>({...sL,...e}),aL=(e,t,n)=>{const i=n.get(oL(e,t))?.healthSubject.value;return i&&{...i}},oL=(e,t)=>`${e}_${t}`,rL=(e,t,n,i)=>async a=>e(a).then((e=>(t(a.apiName||"",n,e.status,i),e))).catch((e=>{throw t(a.apiName||"",n,e.reason,i),e})),sL={isHealthy:e=>{if(e&&e.length>0){const t=e[e.length-1];if("number"!=typeof t&&t!==Hg.B.RequestCancelled)return!1}return!0},historyLength:5};const lL=e=>{let t="";return e.forEach((e=>{t=`${t}${JSON.stringify(e.healthSubject.value)}`})),t?null==(n=t)||0===n.length?n:` ${n}`.substr(1):"";var n},cL=e=>async t=>{try{if(e.transformResponse)return await e.transformResponse(t);if(t.status===Og.nW.NO_CONTENT)return;const n=e.responseType||function(e){if(e.headers){const t=e.headers["content-type"];if(t){if(-1!==t.indexOf("application/json"))return"json";if(-1!==t.indexOf("text/"))return"text"}if("0"===e.headers["content-length"])return"text"}return}(t)||"json";return await(t.body&&t.body[n]?.())}catch(e){throw"AbortError"===e.name?(0,zg.$)(Hg.B.RequestCancelled):(0,zg.$)(Hg.B.TransformFailed,t,e)}};const dL=(e,t,n)=>{let i,a;return t.then((e=>{if(e.throttlePolicy){a=e.throttlePolicy;const t=a?.throttleKey;t?(i=n.get(t)||[],n.has(t)||n.set(t,i)):i=[]}})),t=>a?n=>async function n(o){const r=function(e,t){const{maxPerThrottleInterval:n,throttleInterval:i}=t,a=Date.now()-i;let o=e.length-1;for(;o>=0&&a<e[o];)o--;e.splice(0,o);const r=e.length-n;return r>=0?e[r]-a:0}(i,a);if(!r)return function(e){return i.push(Date.now()),t(e)}(o);const s=o.operationLogger.logStep(Og.ew.Throttle);return await Gg(r,e),s&&s(Og.nW[Og.nW.OK]),n(o)}(n):t};function uL(e,t){const{globalContext:n}=t,i=new Map,a=new Map,{networkMonitor:o,networkState:r}=(()=>{const e=e=>tL.onNext(e);return{networkMonitor:{processResponse:t=>{if(t.status)switch(t.status){case Og.nW.NETWORK_AUTHENTICATION_REQUIRED:case Og.nW.PROXY_AUTHENTICATION_REQUIRED:case Og.nW.BAD_GATEWAY:e(eL);break;case Og.nW.NOT_MODIFIED:case Og.nW.GATEWAY_TIMEOUT:break;case Og.nW.OK:if(Bg(t))break;e(Xx);break;default:e(Xx)}else e(eL)},processResponseError:t=>{t&&(t.reason===Hg.B.RejectHttpError?e(eL):t.serverResponse&&e(Xx))}},networkState:{observeIsOnline:()=>tL.observable,isOnline:()=>tL.value}}})(),s=((e,t)=>async n=>{const i=t(n).then((t=>(e.processResponse(t),t))).catch((t=>{throw e.processResponseError(t),t}));return i})(o,function(e){return async t=>{try{return await e(t)}catch(e){if(e instanceof TypeError&&e.message?.toLowerCase()===Lx){const n=t.headers&&t.headers.cache;if(n&&-1!==n.indexOf("only-if-cached"))return{status:Og.nW.GATEWAY_TIMEOUT};e=(0,zg.$)(Hg.B.RejectHttpError,void 0,e)}throw"AbortError"===e.name&&(e=(0,zg.$)(Hg.B.RequestCancelled)),e}}}(((e,t)=>async n=>xx(n,e,t))(n,t.configuration))),{trackHealth:l,...c}=nL();return{createApi:n=>mL(n,e,{...t,cancellationMap:i,trackHealth:l,throttleMap:a},s),createCancelToken:()=>{const e=(0,E.v4)();return{token:e,cancel:()=>{const t=i.get(e);return t&&t.abort(),!t}}},networkState:r,health:c}}const mL=(e,t,n,i)=>{const a={},o=e(t),{baseUrlPromise:r,models:s}=o;r&&r();for(const e in s){const t=s[e];a[e]=pL(e,t,o,n,i)}return a},pL=(e,t,n,i,a)=>{const{trackHealth:o,throttleMap:r,globalContext:s}=i,l=dL(s,t,r),{telemetryProvider:c}=i,{serviceName:d}=n;return async(...r)=>{let u,m,p,g;const h=(new Date).toISOString(),v=performance.now();try{const e=await qg(t.catch((e=>{throw(0,zg.$)(Hg.B.ModelFailedToInitialize,void 0,e)})),s,i.configuration.modelInitializationTimeoutInMs,Hg.B.ModelTimeOut);let c=qx(a,e,n,i);const d=e.constructRequest(...r);u={...d,operationLogger:Gx(s,d)},c=o(c,n.serviceName,e.healthPolicy),c=l(c);try{g=e.customTelemetry?.(...r)}catch(e){throw(0,zg.$)(Hg.B.CustomTelemetryFailed,void 0,e)}return m=await c(u),cL(e)(m)}catch(e){throw e.serverResponse&&(m=e.serverResponse),p=e,e}finally{const t=performance.now()-v,n=u?.correlationId,i=m?.status,a=i&&Og.nW[i]||void 0,o=u?.operationLogger.complete(p||a,m)||[];c({apiName:e,serviceName:d,createdTime:h,parameters:g,duration:t,result:p?.reason||a||"",statusCode:i,innerError:p?.innerException,operationLogs:o,correlationId:n})}}};class gL extends xp{constructor(){super(d.c1.CreateEndpointsManager,["coreSettings"])}async execute(e){const{loggerFactory:t,windowProvider:n,coreSettings:i}=e,{disableEndpointsHealthService:a,enableCombinedEndpointsHealthService:o}=i.get(c.w.Core);var r;e.endpointsManager=uL(e,{globalContext:n,telemetryProvider:(0,Px.tg)(n,i,t.newLogger("EPM","core-services-tasks"),e.authenticationUser?.id),configuration:(r=i.get(c.w.Core),{modelInitializationTimeoutInMs:r.endpointsManagerModelInitializationTimeoutInMs||3e4,baseUrlResolutionTimeoutInMs:r.endpointsManagerBaseUrlResolutionTimeoutInMs||12e4,defaultRequestTimeoutInMs:r.endpointsManagerDefaultRequestTimeoutInMs||3e4})}),a?t.newLogger("EndpointsHealthService","core-services-tasks").log("Disabled by disableEndpointsHealthService feature flag"):(e.endpointsHealthService=o?new _x(e.endpointsManager,t.newLogger("CombinedEndpointsHealthService","core-services-tasks")):new Dx(e.endpointsManager,t.newLogger("EndpointsHealthService","core-services-tasks")),(0,Pt.AR)().setEndpointHealth(e.endpointsHealthService.getEndpointHealth))}}const hL={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesTasksRemoveUserActiveWindowsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeUserActiveWindows"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};class vL extends xp{constructor(){super(d.c1.CreateEntityCommanding,[])}async execute(e){const{activeWindowsService:t,client:n,commandHandler:i,commandDelegator:a,eventHandler:o,windowProvider:r,hostCommunicationService:s,scenarioFactory:l,loggerFactory:c,deeplinkService:d,coreSettings:u}=Nf("CreateEntityCommandingTask",e,"activeWindowsService","client","commandHandler","commandDelegator","eventHandler","windowProvider","hostCommunicationService","scenarioFactory","loggerFactory","deeplinkService","coreSettings"),m=e.authenticationUser?(0,kt.Lw)(e.authenticationUser):void 0,{entityCommanding:p,eventing:g}=ci(i,a,o,n,u,r,l,c,d,s,m,void 0,t.getWindowLayoutService());return e.entityCommanding=p,e.eventing=g,async e=>{if("signout"===e)await n.mutate({mutation:hL,variables:{userContextId:m}})}}}class yL extends xp{constructor(){super(d.c1.CreateEventHandler,["appsRegistryService","client","clientPreferences","commandChangeReportingService","coreSettings","hostCommunicationService","i18n","loggerFactory","notificationsHandler","scenarioFactory","shortcutExecutionService","stateManagementServices","userBiService"])}async execute(e){const{appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,coreSettings:o,hostCommunicationService:r,i18n:s,loggerFactory:l,notificationsHandler:c,scenarioFactory:d,shortcutExecutionService:u,userBiService:m,stateManagementServices:p}=e;e.eventHandler=(e,g,h)=>me({appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,commandDelegator:h,commandHandler:g,coreSettings:o,eventInput:e,hostCommunicationService:r,i18n:s,loggerFactory:l,notificationsHandler:c,scenarioFactory:d,shortcutExecutionService:u,stateManagementServices:p,userBiService:m})}}var SL=n(247681);const fL={RejectIncomingCall:GR.DB.toastCallingRejectIncomingCall,IgnoreIncomingCall:GR.DB.toastCallingIgnoreIncomingCall,AcceptIncomingCallContentOnly:GR.DB.toastCallingAcceptIncomingCallContentOnly,AcceptIncomingCallThroughPrejoin:GR.DB.toastCallingAcceptIncomingCallThroughPrejoin,AcceptIncomingCallWithAudio:GR.DB.toastCallingAcceptIncomingCallWithAudio,AcceptIncomingCallWithVideo:GR.DB.toastCallingAcceptIncomingCallWithVideo,AcceptIncomingScreenshareOnlyCall:GR.DB.toastCallingAcceptIncomingScreenshareOnlyCall,Error:GR.DB.toastCallingError,NavigateToCallTab:GR.DB.toastCallingNavigateToCallTab,ReplyIncomingCall:GR.DB.toastCallingReplyIncomingCall,ResumeCallTransfer:GR.DB.toastCallingResumeCallTransfer,TimeOut:GR.DB.toastCallingTimeOut,Unknown:GR.DB.toastCallingUnknown,onAcceptTelemetryCleanup:GR.DB.toastAcceptTelemetryCleanup,onDismissTelemetryCleanup:GR.DB.toastDismissTelemetryCleanup,canNotifyForCallingNotification:GR.DB.toastCallingNotDroppedByDND,JoinMeetingFromToast:GR.DB.joinMeeting,JoinAudioDropInFromToast:GR.DB.toastJoinAudioDropIn,OpenChatList:GR.DB.openChatConversationFromToast},kL={RejectIncomingCall:GR.Sn.toastRejectIncomingCall,AcceptIncomingCallContentOnly:GR.Sn.toastAcceptIncomingCall,AcceptIncomingCallThroughPrejoin:GR.Sn.toastAcceptIncomingCall,AcceptIncomingCallWithAudio:GR.Sn.toastAcceptIncomingCall,AcceptIncomingCallWithVideo:GR.Sn.toastAcceptIncomingCall,AcceptIncomingScreenshareOnlyCall:GR.Sn.toastAcceptIncomingCall,ReplyIncomingCall:GR.Sn.toastReplyIncomingCall,ResumeCallTransfer:GR.Sn.toastResumeCallTransfer},CL=(e,t,n,i)=>{if(!e)return void t.error("coreServicesEntityCommanding: UserBiService is not available.");const a={[ke.ck.chats]:bL,[ke.ck.channels]:wL,[ke.ck.calls]:EL,[ke.ck.communities]:IL,[ke.ck.communitiesevents]:AL,[ke.ck.communitiesjoinrequest]:IL,[ke.ck.communitiesmembers]:IL,[ke.ck.settingsstore]:NL,[ke.ck.notificationsdeeplink]:TL}[n.entity.type]||FL;if(a){let t;e.createDatabag&&(t=e.createDatabag(),t.isCustomNotification=Boolean(i)),a(e,n,t),t?.dispose()}},bL=(e,t,n)=>{const{dataOptions:i,entity:a,entityOptions:o}=t;if(n&&i){const{toastType:e}=i;n.chatToastType=e}if(i?.actionType===xt.quickReply)e.recordPanelAction({actionGesture:GR.Od.click,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.quickReplyFromToast,moduleName:GR.Sn.chatToastQuickreply,dataBag:n});else if(a.action===ke.SY.view&&(e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.chatToast,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.openChatConversationFromToast,dataBag:n}),o)){const{campaignType:t}=o;if(t){n&&(n.identifier=t);const i={panelType:GR.HP.SyntheticNotification,panelRegion:GR.rP.toast,dataBag:n};e.recordPanelView(i)}}},wL=(e,t,n)=>{const{entity:i}=t;i.action===ke.SY.view&&e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.channelsToast,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.openChannelsConversationFromToast,dataBag:n})},TL=(e,t,n)=>{const{dataOptions:i,entity:a}=t;if(a.action===ke.SY.view){if(n&&i){const{toastType:e}=i;n.notificationsDeepLinkToastType=e}e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.notificationsDeepLinkToast,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.openDeepLinkFromToast,dataBag:n})}},IL=(e,t,n)=>{const{dataOptions:i,entity:a}=t;if(n){const{toastType:e}=i;n.communitiesToastType=e}a.action===ke.SY.view&&e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.communitiesToast,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.openCommunitiesConversationFromToast,teamId:i?.teamId,dataBag:n})},NL=(e,t,n)=>{const{dataOptions:i}=t;if(n&&i){const{subType:e,type:t}=i;n.subType=e,n.type=t}e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.toastMoreMenu,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.openSettingsFromToast,dataBag:n})},AL=(e,t,n)=>{const{dataOptions:i,entity:a}=t;if(n){const{toastType:e}=i;n.communitiesToastType=e}a.action===ke.SY.view&&e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.communitiesEventsToast,actionScenario:GR.vB.toastActivation,actionScenarioType:GR.DB.openCommunitiesEventsFromToast,dataBag:n})},EL=(e,t,n)=>{const{dataOptions:i}=t;if(!i)return;const{actionType:a,toastType:o}=i,r=fL[a],s=kL[a];n&&(n.correlationId=t.command?.correlation.id,n.callingToastType=o),r&&e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.callingToast,actionScenario:GR.vB.toastActivation,actionScenarioType:r,moduleName:s,dataBag:n})},FL=(e,t,n)=>{const{dataOptions:i,entity:a}=t;"interactionRequired"===i?.toastType&&a.action===ke.SY.default&&e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,panelType:GR.HP.alertsToast,actionScenario:GR.vB.toastActivation,dataBag:n})};async function _L({activeWindowsService:e,coreSettings:t,renderingContext:n,isHostCommandNotification:i,handlerCommand:a,logger:o,notificationUserContextId:r,appsRegistryService:s,logPrefix:l}){const d=l||"";if(i&&a.command){const{enableMinimodeWindow:i,enableMTMANotificationsMainWindow:l,enableWindowModeLayout:u}=t.get(c.w.Core),m=e.getActiveWindows(),p=m.find((e=>e.layoutConfig.layoutMode===Yt.Rm.minimode)),h=m.find((e=>e.layoutConfig.layoutMode===Yt.Rm.standard));if(o.log(`${d}State transition before override: ${a.command.stateTransition}`),!i||!PL(a.entity)||!p&&h||r&&p&&p.userContextId!==r){const e=DL({appsRegistryService:s,coreSettings:t,entity:a.entity});if(o.log(`${d}allowUserWindowingPreference: ${e}`),h&&h.userContextId!==r)l&&(o.log(`${d}User context of notification does not match main window user`),e||a.command.stateTransition===g.Ar.new?a.command.stateTransition=g.Ar.new:(o.log(`${d}Entity must be opened in main window`),a.command.stateTransition=g.Ar.forceFlush,a.command.targetWindow=g.BA.main));else if(o.log(`${d}User context of notification matches main window user`),u&&e){const e=n.clientPreferences.getPreferences("windowing")?.shouldOpenContentInNewWindow;a.command.stateTransition=e?g.Ar.new:g.Ar.flush,o.log(`${d}Respecting user preference for toast shouldOpenContentInNewWindow ${e}`)}}else a.command.layoutMode=Yt.Rm.minimode,a.command.stateTransition=g.Ar.flush,o.log(`${d}Redirecting chat toasts to minimode window if no popout chat is open`);o.log(`${d}Final stateTransition after override ${a.command?.stateTransition}`)}return a}const DL=({appsRegistryService:e,coreSettings:t,entity:n})=>e.getApp({entityType:n.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:t,entity:n})||!1,PL=e=>e.type===ke.ck.chats&&"welcomePage"!==e.id;const ML=(e,t,n,i,a)=>async({payload:o},r=!1)=>{const s=t=>e.errorToTelemetry?.(t,"webclient_framework_foundation_external_command_listener",void 0,!0);try{if(o&&o.entity&&o.command&&o.entity.type in ke.ck&&o.entity.action in ke.SY&&o.command.visibilityState in g.Rp&&o.command.stateTransition in g.Ar){const{entity:l,entityOptions:c,dataOptions:d,command:u,windowOptions:m}=o,{linkedEntity:p}=l;if(p){if(!p.id||!(p.type in ke.ck)){const e=`Missing id ${!p.id} or linked entity type ${p.type}`;return s(e),Promise.reject(new Error(e))}}else l.linkedEntity=null;u.correlation=u.correlation||{},u.correlation.source=u.correlation.source||A.p.ExternalCommand;const g=d?.userContextId;e.log(`Got userContextId: ${g} from dataOptions`);const h=t(!1,g,n),v=1e4;(0,yi.a)(h,v).catch((()=>{s(`waitForRenderingContextReady timed out after ${v}ms`)}));const y=await h;e.log(`got renderingContext for userContextId: ${g}`);const S={dataOptions:d,entity:l,entityOptions:c,command:St(u),windowOptions:m};return e.log(`External command isHostComm ${r}, type ${l.type}, action ${l.action}`),await _L({activeWindowsService:i,coreSettings:n,renderingContext:y,isHostCommandNotification:r,handlerCommand:S,logger:e,notificationUserContextId:g,appsRegistryService:a}),CL(y.userBiService,e,S),y.commandHandler(S)}const l=function(e){let t=`payload(${!!e})`;if(e){const{entity:n,command:i}=e;if(t+=` entity(${!!n}) command(${!!i})`,n&&i){const{type:e,action:a}=n,{visibilityState:o,stateTransition:r}=i;t+=` type(${e}) action(${a})`,t+=` visibilityState(${o}) stateTransition(${r})`}}return t}(o),c=`Invalid payload for executeEntityCommand handler: ${l}`;return s(c),Promise.reject(new Error(c))}catch(e){s(`Error thrown from external command listener: ${(0,ge.hR)(e)}`)}};class RL extends xp{constructor(){super(d.c1.CreateExternalCommandListener,["activeWindowsService","appsRegistryService","windowProvider","loggerFactory","hostCommunicationService","coreSettings","waitForRenderingContextReady"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,windowProvider:i,loggerFactory:a,hostCommunicationService:o,coreSettings:r,waitForRenderingContextReady:s}=e;return function(e,t,n,i,a,o,r){const s=e.newLogger("External Command Listener","core-services-entity-commanding"),l=ML(s,a,i,o,r);if(t.opener.addEventListener("executeEntityCommand",l),i.get(c.w.Core).enableHostCommandListener){const e=e=>{const{entity:t}=e,{type:n}=t;switch(n){case Ot.w$.calls:case Ot.w$.chats:case Ot.w$.toasts:case Ot.w$.extensions:case Ot.w$.channels:case Ot.w$.reminders:case Ot.w$.activity:case Ot.w$.campaignnotifications:case Ot.w$.communities:case Ot.w$.communitiesevents:case Ot.w$.callingdeeplink:case Ot.w$.communitiesjoinrequest:case Ot.w$.communitiesmembers:case Ot.w$.notificationsdeeplink:case Ot.w$.files:return l(of(e,s),!0);default:return l(tf)}};n.loadModule("core").then((t=>{t&&t.registerForOnExecuteCommand?.(e)})).catch((e=>{s.errorToTelemetry?.(`Loading core host comms module failed with: ${(0,ge.hR)(e)}`,"webclient_framework_host_comms",void 0,!0)}))}return Promise.resolve()}(a,i,o,r,s,t,n)}}const xL=()=>Promise.all([n.e(905965),n.e(636570),n.e(235533),n.e(835108),n.e(27128)]).then(n.bind(n,960558));class LL extends xp{constructor(){super(d.c1.CreateFloodgateTask,["loggerFactory","scenarioFactory","clientState","coreSettings","platformService","config","clientPreferences","windowProvider"])}async execute(e){const{loggerFactory:t,scenarioFactory:n,clientState:i,coreSettings:a,platformService:o,config:r,clientPreferences:s,windowProvider:l}=e,{enableFloodgateInCore:d}=a.get(c.w.Feedback);if(d){const{FloodGateService:c}=await(0,ev.wg)(xL,"floodgate-core",n);e.floodgateService=new c(t,n,i,a,o,eo(s,a,l),r.experienceName)}}}class OL{constructor(){this.countBasedLogs=this.initializeLogs(),this.countBasedTotalLogs=[],this.currentBuffer=0}addOperation(e,t,n){if(t&&e)if(this.countBasedLogs[t][e]){const i=this.countBasedLogs[t][e];"Request"===n?i.requestCount++:i.responseCount++}else this.countBasedLogs[t][e]={requestCount:"Request"===n?1:0,responseCount:"Response"===n?1:0,errorCount:"Error"===n?1:0}}getLatestDataAndClear(){const e=(0,we.clone)(this.countBasedLogs);return this.currentBuffer>=40&&(this.currentBuffer=0),this.countBasedTotalLogs[this.currentBuffer++]=e,this.countBasedLogs=this.initializeLogs(),e}getCompleteDataLogs(){return this.countBasedTotalLogs.length<40?this.countBasedTotalLogs:this.countBasedTotalLogs.slice(this.currentBuffer).concat(this.countBasedTotalLogs.slice(0,this.currentBuffer))}initializeLogs(){return{subscription:{},mutation:{},query:{}}}}class jL extends xp{constructor(){super(d.c1.CreateGraphQlOpsService,["coreSettings"])}async execute(e){const{enableGraphQlOpsCount:t,enableGraphQlOpsCountInConsole:n}=e.coreSettings.get(c.w.Core);let i;if(t&&(i=new OL,e.graphqlOpsCountService=i),n){const e=window;e.hooks||(e.hooks={}),e.hooks.graphQlOpsCountServiceHook=i}}}var BL=n(32587);const UL=0;class $L{constructor(){this.stats={},this.counter=UL,this.tracked={},this.cacheSizeCallbacks={}}getTelemetry(){this.collectCacheMetrics();const e=this.stats;return this.stats={},e}addCacheStatsCallback(e,t){this.cacheSizeCallbacks[e]||(this.cacheSizeCallbacks[e]=new Set),this.cacheSizeCallbacks[e]?.add(t)}removeCacheStatsCallback(e,t){this.cacheSizeCallbacks[e]?.delete(t)}trackCall(e,t){this.getOrCreateStore(e).methodCalls[t]++}trackSubscribeEvent(e){this.getOrCreateStore(e).subscribeEvents++}markReadStart(e,t){return this.mark(WL("read",e,t))}markReadEnd(e){this.markEnd(e)}markReadError(e){this.markError(e)}markRead(e,t,n){this.update("success",WL("read",e,t),n)}markDiffStart(e,t){return this.mark(WL("diff",e,t))}markDiffEnd(e){this.markEnd(e)}markDiffError(e){this.markError(e)}markDiff(e,t,n){this.update("success",WL("diff",e,t),n)}markWriteStart(e,t){return this.mark(WL("write",e,t))}markWriteEnd(e){return this.markEnd(e)}markWriteError(e){this.markError(e)}markWrite(e,t,n){this.update("success",WL("write",e,t),n)}markDuplicateWrite(e,t,n){const i=WL("writeDuplicate",e,t);this.update("success",i,n)}mark(e){const t=""+this.counter++;return this.tracked[t]=e,t}markEnd(e){const t=this.tracked[e];if(delete this.tracked[e],t){const e=performance.now()-t.start;return this.update("success",t,e),e}return 0}markError(e){const t=this.tracked[e];if(delete this.tracked[e],t){const e=performance.now()-t.start;this.update("error",t,e)}}update(e,t,n){const i=this.getOrCreateStore(t.storeType)[t.kind];i.count++,"error"===e&&i.errors++,i.min=Math.min(null!==i.min?i.min:Number.MAX_VALUE,n),(null==i.max||i.max<n)&&(i.max=n,i.slowestOperation=t.operationName),i.mean=null!==i.mean?(i.mean+n)/2:n}getOrCreateStore(e){let t=this.stats[e];return t||(t={type:e,read:VL(),write:VL(),diff:VL(),writeDuplicate:VL(),cache:[],subscribeEvents:UL,methodCalls:{[GC.i.query]:UL,[GC.i.watchQuery]:UL,[GC.i.mutate]:UL,[GC.i.subscribe]:UL,[GC.i.readQuery]:UL,[GC.i.writeQuery]:UL,[GC.i.readFragment]:UL,[GC.i.writeFragment]:UL}},this.stats[e]=t),t}collectCacheMetrics(){for(const[e,t]of Object.entries(this.cacheSizeCallbacks)){const n=Array.from(t).map((e=>e())).sort(((e,t)=>t.nodeCount-e.nodeCount));this.getOrCreateStore(e).cache=n}}}function WL(e,t,n){return{storeType:t,kind:e,operationName:"string"==typeof n?n:(0,BL.yP)(n)||"unknown",start:performance.now()}}function VL(){return{min:null,max:null,mean:null,count:UL,errors:UL,slowestOperation:null}}class HL extends xp{constructor(){super(d.c1.CreateGraphQLStoreStatsReporterService,["coreSettings","loggerFactory"])}async execute(e){const t=e.loggerFactory.newLogger("CreateGraphQLStoreStatsReporterServiceTask","core-services-tasks"),{enableGraphQLStoreStatsReporterService:n}=e.coreSettings.get(c.w.Core);n&&(e.graphqlStoreStatsReporterService=new $L,t.log("GraphQLStoreStatsReporterService initialized"))}}var zL=n(561884);class qL extends xp{constructor(){super(d.c1.CreateGtmRegistry,["authenticationService","discover","coreSettings","loggerFactory","platformService","config"])}async execute(e){e.gtmRegistry=new zL.u(e.authenticationService,e.discover,e.coreSettings,e.loggerFactory,e.platformService,e.config)}}class GL{constructor(e,t,n,i,a){this.commandChangeReportingService=e,this.coreSettings=t,this.hostCommunicationService=n,this.scenarioFactory=i,this.logger=a.newLogger("HostCommandingListener","core-services-entity-commanding")}init(){this.initCommandChangeReportingSubscription()}destroy(){this.commandChangeReportingSubscription?.unsubscribe(),this.commandChangeReportingSubscription=void 0}initCommandChangeReportingSubscription(){this.commandChangeReportingSubscription&&this.destroy(),this.commandChangeReportingSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>{e.type!==p.I.NotHandled&&e.type!==p.I.ContinueHandlingAtHost||!e.context.entityCommand||this.sendHostEvent(e.context.entityCommand)}))}async sendHostEvent(e){!!this.coreSettings.get(c.w.Core).enableCommandToHostCommService&&await bf(e,this.hostCommunicationService,this.logger,this.scenarioFactory)}}class YL{constructor(){this.id=d.c1.CreateHostCommandingListener}async execute(e){const{commandChangeReportingService:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,hostCommunicationService:o}=Nf("CreateHostCommandingListenerTask",e,"commandChangeReportingService","coreSettings","loggerFactory","scenarioFactory","hostCommunicationService");new GL(t,n,o,a,i).init()}}var QL;!function(e){e.airgap08="airgap08",e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap09="airgap09"}(QL||(QL={}));const JL={web:{loadModule:async(e,t)=>"auth"===e?(e=>({signInOnElectron:function(t){const n={options:t};return Promise.resolve(e.opener.postMessage("login",n))},acquireTokenFromHost:function(t,n,i){const a={resource:t,claim:n,userIdentifier:i};return e.opener.requestMessage("aadGetToken",a)},getUserFromHost:function(){return e.opener.requestMessage("aadCurrentUser",{})}}))(t):"calling"===e?(e=>({signalCallConnectionComplete:function(){return Promise.resolve(e.opener.postMessage("signalCallConnectionComplete",{}))}}))(t):"callingperf"===e?(e=>({callingPerfStatsAvailable:function(t){const n={callingPerfStats:t};return Promise.resolve(e.opener.postMessage("callingPerfStats",n))}}))(t):"core"===e?(e=>({registerForOnSubNavHoverChanged:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("showOrHideSubNav",n),()=>{e.opener.removeEventListener("showOrHideSubNav",n)}},setCoreInitialized:function(){return Promise.resolve(e.opener.postMessage("coreInitialized",{}))},signalPreAuthComplete:function(){return Promise.resolve(e.opener.postMessage("teamsPreAuthComplete",{}))},registerForOnContinueWithTeamsCoreTasks:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("continueWithTeamsCoreTasks",n),()=>{e.opener.removeEventListener("continueWithTeamsCoreTasks",n)}}}))(t):"embedcalendar"===e?(e=>({sendHeightOnResize:function(t){const n={embedCalendarHeight:t};return Promise.resolve(e.opener.postMessage("sendHeightOnResize",n))},sendCalendarScenarioStatus:function(t,n){const i={ScenarioStatus:t,AgendaViewEndState:n};return Promise.resolve(e.opener.postMessage("sendCalendarScenarioStatus",i))}}))(t):"embedclient"===e?(e=>({HideCoreIFrame:function(){return Promise.resolve(e.opener.postMessage("HideCoreIFrame",{}))},ShowCoreIFrame:function(){return Promise.resolve(e.opener.postMessage("ShowCoreIFrame",{}))}}))(t):"search"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}}}))(t):"surveyform"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}}}))(t):void 0,definedModules:["auth","calling","callingperf","core","embedcalendar","embedclient","search","surveyform"]},edge:{loadModule:async e=>"airpods"===e?(async()=>globalThis.nativeModules?.Airpods)():"appdevicepermission"===e?(async()=>globalThis.nativeModules?.Appdevicepermission)():"appswitcher"===e?(async()=>globalThis.nativeModules?.Appswitcher)():"auth"===e?(async()=>globalThis.nativeModules?.Auth)():"bluetoothproximity"===e?(async()=>globalThis.nativeModules?.Bluetoothproximity)():"brb"===e?(async()=>globalThis.nativeModules?.Brb)():"calling"===e?(async()=>globalThis.nativeModules?.Calling)():"callingcrosscloud"===e?(async()=>globalThis.nativeModules?.Callingcrosscloud)():"callingcrosscloudpersistent"===e?(async()=>globalThis.nativeModules?.Callingcrosscloudpersistent)():"callingcrosscloudtransient"===e?(async()=>globalThis.nativeModules?.Callingcrosscloudtransient)():"core"===e?(async()=>globalThis.nativeModules?.Core)():"customvideobackground"===e?(async()=>globalThis.nativeModules?.Customvideobackground)():"ecs"===e?(async()=>globalThis.nativeModules?.Ecs)():"embedcalendar"===e?(async()=>globalThis.nativeModules?.Embedcalendar)():"etw"===e?(async()=>globalThis.nativeModules?.Etw)():"fileopenpreference"===e?(async()=>globalThis.nativeModules?.Fileopenpreference)():"files"===e?(async()=>globalThis.nativeModules?.Files)():"filestrusted"===e?(async()=>globalThis.nativeModules?.Filestrusted)():"gatt"===e?(async()=>globalThis.nativeModules?.Gatt)():"globalshortcuts"===e?(async()=>globalThis.nativeModules?.Globalshortcuts)():"heartbeat"===e?(async()=>globalThis.nativeModules?.Heartbeat)():"hfp"===e?(async()=>globalThis.nativeModules?.Hfp)():"hid"===e?(async()=>globalThis.nativeModules?.Hid)():"hostcapabilities"===e?(async()=>globalThis.nativeModules?.Hostcapabilities)():"hostcapabilitiestrusted"===e?(async()=>globalThis.nativeModules?.Hostcapabilitiestrusted)():"humanpresence"===e?(async()=>globalThis.nativeModules?.Humanpresence)():"loggingtrusted"===e?(async()=>globalThis.nativeModules?.Loggingtrusted)():"logscollection"===e?(async()=>globalThis.nativeModules?.Logscollection)():"m365link"===e?(async()=>globalThis.nativeModules?.M365link)():"meshpackagemanager"===e?(async()=>globalThis.nativeModules?.Meshpackagemanager)():"moduleloader"===e?(async()=>globalThis.nativeModules?.Moduleloader)():"noisesuppression"===e?(async()=>globalThis.nativeModules?.Noisesuppression)():"officeintegration"===e?(async()=>globalThis.nativeModules?.Officeintegration)():"osutils"===e?(async()=>globalThis.nativeModules?.Osutils)():"platformapp"===e?(async()=>globalThis.nativeModules?.Platformapp)():"profiler"===e?(async()=>globalThis.nativeModules?.Profiler)():"publicpreview"===e?(async()=>globalThis.nativeModules?.Publicpreview)():"roomservice"===e?(async()=>globalThis.nativeModules?.Roomservice)():"scenario"===e?(async()=>globalThis.nativeModules?.Scenario)():"settings"===e?(async()=>globalThis.nativeModules?.Settings)():"sharetarget"===e?(async()=>globalThis.nativeModules?.Sharetarget)():"taskbar"===e?(async()=>globalThis.nativeModules?.Taskbar)():"teamsuseractivityrecall"===e?(async()=>globalThis.nativeModules?.Teamsuseractivityrecall)():"telemetry"===e?(async()=>globalThis.nativeModules?.Telemetry)():"telemetrytrusted"===e?(async()=>globalThis.nativeModules?.Telemetrytrusted)():"testtrusted"===e?(async()=>globalThis.nativeModules?.Testtrusted)():"thirdpartydevices"===e?(async()=>globalThis.nativeModules?.Thirdpartydevices)():"tmapolicy"===e?(async()=>globalThis.nativeModules?.Tmapolicy)():"toasts"===e?(async()=>globalThis.nativeModules?.Toasts)():"updates"===e?(async()=>globalThis.nativeModules?.Updates)():"userdataxcloud"===e?(async()=>globalThis.nativeModules?.Userdataxcloud)():"userdataxcloudtrusted"===e?(async()=>globalThis.nativeModules?.Userdataxcloudtrusted)():"userpreferences"===e?(async()=>globalThis.nativeModules?.Userpreferences)():"vdi"===e?(async()=>globalThis.nativeModules?.Vdi)():"webclientstates"===e?(async()=>globalThis.nativeModules?.Webclientstates)():"windowcontrols"===e?(async()=>globalThis.nativeModules?.Windowcontrols)():void 0,definedModules:["airpods","appdevicepermission","appswitcher","auth","bluetoothproximity","brb","calling","callingcrosscloud","callingcrosscloudpersistent","callingcrosscloudtransient","core","customvideobackground","ecs","embedcalendar","etw","fileopenpreference","files","filestrusted","gatt","globalshortcuts","heartbeat","hfp","hid","hostcapabilities","hostcapabilitiestrusted","humanpresence","loggingtrusted","logscollection","m365link","meshpackagemanager","moduleloader","noisesuppression","officeintegration","osutils","platformapp","profiler","publicpreview","roomservice","scenario","settings","sharetarget","taskbar","teamsuseractivityrecall","telemetry","telemetrytrusted","testtrusted","thirdpartydevices","tmapolicy","toasts","updates","userdataxcloud","userdataxcloudtrusted","userpreferences","vdi","webclientstates","windowcontrols"]},electron:{loadModule:async(e,t)=>"appdevicepermission"===e?(e=>({registerForHasDevicePermissions:function(t){const n=(e={})=>{t(e.eventId,e.webContentsId,e.permissionType,e.guid)};return e.opener.addEventListener("hasDevicePermissions",n),()=>{e.opener.removeEventListener("hasDevicePermissions",n)}},resolveDevicePermission:function(t,n,i){const a={message:t,permission:n,guid:i};return Promise.resolve(e.opener.postMessage("hasDevicePermissionsCallback",a))}}))(t):"auth"===e?(e=>({signInOnElectron:function(t){const n={options:t};return Promise.resolve(e.opener.postMessage("login",n))}}))(t):"callingperf"===e?(e=>({callingPerfStatsAvailable:function(t){const n={callingPerfStats:t};return Promise.resolve(e.opener.postMessage("callingPerfStats",n))}}))(t):"core"===e?(e=>({registerForOnSubNavHoverChanged:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("showOrHideSubNav",n),()=>{e.opener.removeEventListener("showOrHideSubNav",n)}},setCoreInitialized:function(){return Promise.resolve(e.opener.postMessage("coreInitialized",{}))},relaunch:function(t){const n={relaunchArgs:t};return Promise.resolve(e.opener.postMessage("windowRelaunch",n))},notifyCoreStateChanged:function(t){const n={childSettings:t};return Promise.resolve(e.opener.postMessage("updateWindowState",n))}}))(t):"embedcalendar"===e?(e=>({sendHeightOnResize:function(t){const n={embedCalendarHeight:t};return Promise.resolve(e.opener.postMessage("sendHeightOnResize",n))},sendCalendarScenarioStatus:function(t,n){const i={ScenarioStatus:t,AgendaViewEndState:n};return Promise.resolve(e.opener.postMessage("sendCalendarScenarioStatus",i))}}))(t):"hostedwebcontentlog"===e?(e=>({registerForReportAProblemLogUploadEvent:function(t){const n=(e={})=>{t(e.eventId)};return e.opener.addEventListener("reportAProblemLogUpload",n),()=>{e.opener.removeEventListener("reportAProblemLogUpload",n)}}}))(t):"m365link"===e?(e=>({getM365Link:function(t,n){const i={url:t,context:n};return e.opener.requestMessage("getM365Link",i)}}))(t):"search"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}}}))(t):"surveyform"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}},uploadDesktopLogsToOds:function(t,n){const i={logFilePath:t,sasToken:n};return Promise.resolve(e.opener.postMessage("uploadDesktopLogsToOds",i))},collectDesktopLogs:function(){return e.opener.requestMessage("collectDesktopLogs",{})}}))(t):"windowcontrols"===e?(e=>({swapMeetingRoomFrontOfRoomWindows:function(){return Promise.resolve(e.opener.postMessage("swapMeetingRoomFrontOfRoomWindows",{}))},getScreenshots:function(t,n){const i={width:t,height:n};return e.opener.requestMessage("getScreenshots",i)}}))(t):void 0,definedModules:["appdevicepermission","auth","callingperf","core","embedcalendar","hostedwebcontentlog","m365link","search","surveyform","windowcontrols"]}},KL=(e,t,n=!1)=>new ZL(JL.edge,e,void 0,t,n,!0);class ZL{constructor(e,t,n,i,a=!1,o=!1){this._internalLoadDefinition=e,this._logger=t,this._host=n,this._coreSettings=i,this._enableScenarioCache=a,this._enablePIEMonitors=o,this._hostCommsScenarioFactory=XL(this._enableScenarioCache)}async loadModule(e){const t=this._hostCommsScenarioFactory.newScenario("host_comms_load_module");let n;try{this._logger.debug(`Loading module: ${e}`),n=await this._internalLoadDefinition.loadModule(e,this._host??void 0)}catch(n){throw this._logger.errorToTelemetry?.("Error while loading module","webclient_framework_host_comms",void 0,!0),t?.fail({reason:"Error while loading module",message:e}),n}return!n&&this._internalLoadDefinition.definedModules?.includes(e)?(this._logger.error(`Failed to load module. Module, undefined ${e}`),t?.fail({reason:"Failed to load module",message:e})):(this._logger.debug(`Module "${e}" loaded`),t?.stop({message:e,reason:e})),n}setScenarioFactory(e){this._hostCommsScenarioFactory.setScenarioFactory(e),this.lazyLoadPieMonitors(e)}getPIEMonitorStates(){return{dataCaptureEnabled:this._enablePIEMonitors&&!!this._dataCapturePIEMonitor?.isEnabled(),trafficCopEnabled:this._enablePIEMonitors&&!!this._trafficCopPIEMonitor?.isEnabled()}}async lazyLoadPieMonitors(e){if(!this._enablePIEMonitors)return;let t=0;for(;t<3;)try{const[{PIEStatsProvider:t},{TrafficCopPIEMonitor:i},{DataCapturePIEMonitor:a}]=await Promise.all([Promise.all([n.e(16110),n.e(310925)]).then(n.bind(n,131985)),n.e(976775).then(n.bind(n,672825)),n.e(531370).then(n.bind(n,788404))]),{syncRoundTripTimeThresholdMs:o,asyncRoundTripTimeThresholdMs:r}=this._coreSettings?.get(c.w.Core)?.pieMonitorSettings||{},s=new t(this,o,r);this._trafficCopPIEMonitor=new i(s),this._trafficCopPIEMonitor.setScenarioFactory(e),this._dataCapturePIEMonitor=new a(s),this.subscribeForMonitorObservable();break}catch(e){if(t++,3===t)throw e}}subscribeForMonitorObservable(){const e=this._coreSettings?.getObservable?.(c.w.Core,["pieMonitorSettings"]);e?.subscribe((e=>{if(!e.pieMonitorSettings)return;const{enabled:t,mode:n}=e.pieMonitorSettings;if(!t)return this._trafficCopPIEMonitor?.disable(),void this._dataCapturePIEMonitor?.disable();"DataCapture"===n?this._dataCapturePIEMonitor?.enable():"TrafficCop"===n&&this._trafficCopPIEMonitor?.enable()}))}}const XL=e=>{let t;const n=[];return{newScenario:i=>{if(t)return t.newScenario(i);if(e){const e=tO(i);return n.push(e),e}},setScenarioFactory:e=>{t=e,eO(n,t)}}},eO=(e,t)=>{let n=e.pop();for(;n;){const i=t.newScenario(n.name,{startTime:n.time});"failed"===n.status&&i.fail({cached:!0,...n.result}),"stopped"===n.status&&i.stop({cached:!0,...n.result}),n=e.pop()}},tO=e=>{let t,n;return{name:e,time:Date.now(),fail:e=>{n="failed",t=e},stop:e=>{n="stopped",t=e},get result(){return t},get status(){return n}}};class nO extends xp{constructor(){super(d.c1.CreateHostCommunication,["coreSettings","loggerFactory","platformService","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,platformService:i,windowProvider:a}=e;e.hostCommunicationService=((e,t,n,i)=>{const{clientType:a}=e.config,o=i.newLogger("HostComms","core-services-host-communication");return o.log(`Create HostComms for ${a}`),a===nt.sK.Maglev&&t.get(c.w.Core).enablePieCommunication?KL(o,t,!0):a===nt.sK.Desktop?new ZL(JL.electron,o,n,t,!0):new ZL(JL.web,o,n,t,!0)})(i,t,a,n)}}var iO=n(921128);class aO extends xp{constructor(){super(d.c1.CreateI18n,["i18NextWrapper"])}async execute(e){const t=new iO.F(e.i18NextWrapper);e.i18n=t;const n=e.localMigratedSettings;if(n){const i=oO(e.i18NextWrapper.logger,e.i18NextWrapper.migratedLocaleCode,t.locale);n.registerConsumer("i18n",i)}}}const oO=(e,t,n)=>async({language:i})=>{if(i!==t)throw e.error(`Migrated locale (${i}) was not available for the i18NextWrapper (${t})`),new Error("Language mismatch during locale migration");i!==n&&e.log(`Migrated locale (${i}) was not applied to the i18n instance. Detected language: (${n})`)};var rO=n(949402),sO=n(518849);class lO{constructor(e,t){this.options={},this.setOptions(t),this.logger=e.newLogger("i18n:selective-icu","services-io-browser-i18n"),this.name="selective-icu",this.type="postProcessor",this.icu=new sO.A}setOptions(e){this.options={...this.options,...e}}process(e,t,n,i){const a=Array.isArray(t)?t[t.length-1]:t;if(!this.options.filterRegex||!this.options.filterRegex.test(a))return e;try{return this.icu.parse(e,n,i.language,n.ns,a,!1)}catch(a){return this.logger.error(`ICU parse failed for namespace: "${n.ns||""}" key: "${t.toString()}" locale: "${i.language||""}"`),e}}}class cO{constructor(){this.name="simple-pseudo",this.type="postProcessor"}process(e){return`([{${e}}])`}}var dO=n(714678);class uO{constructor(e,t,n){this.i18nextWrapper=e,this.coreSettings=n,this.entries={},this.logger=t.newLogger("NamespaceLoader","services-io-browser-i18n");const i=n?.getObservable(c.w.Localization);i?.subscribe((e=>{e.enableExpStrings&&this.getOverriddenNamespaces().forEach((e=>this.patchBundleOverrides(e)))}))}getState(e){const t=this.entries[e];return t?t.state:dO.Q.Missing}async waitForNamespace(e){const t=this.getState(e);if(t===dO.Q.Loaded)return;if(t===dO.Q.Failed)throw new Error(`Loading of namespace ${e} has previously failed`);const n=t===dO.Q.Missing?this.load(e):this.entries[e];return n&&n.promise?n.promise:void 0}loadStatic(e){this.addResourceBundle(e.namespace,e.translations),this.entries[e.namespace]={state:dO.Q.Loaded,error:void 0,promise:void 0}}load(e,t){const n="en-us",i=t?n:this.i18nextWrapper.locale,a=`${i}/${(0,we.kebabCase)(e)}`,o=`./generated/resources/${a}`,r={state:dO.Q.Loading,error:void 0,promise:void 0};this.entries[e]=r,this.i18nextWrapper.logger.log("importing",o);const s=this.getNamespaceEntry(i,e).then((t=>{this.addResourceBundle(e,t.default.translations),this.i18nextWrapper.logger.log("imported",o),r.state=dO.Q.Loaded,r.promise=void 0})).catch((s=>t||i===n?(this.failI18nLoad({error:s.message,origin:a}),this.i18nextWrapper.logger.error("failed to import",o,s),r.state=dO.Q.Failed,r.error=s.message,r.promise=void 0,Promise.reject(s)):(this.i18nextWrapper.logger.log("trying fallback to the default locale as failed to import",o,s),this.failI18nLoad({fallbackLocale:n,error:s.message,origin:a}),this.load(e,!0).promise)));return r.promise=s,r}addResourceBundle(e,t){return this.i18nextWrapper.i18next.addResourceBundle(this.i18nextWrapper.locale,e,{...t,...this.getOverrides(e)})}patchBundleOverrides(e){if(this.entries[e]){const t=this.getOverrides(e);(this.entries[e].promise||Promise.resolve()).then((()=>{this.i18nextWrapper.i18next.addResourceBundle(this.i18nextWrapper.locale,e,t,!0,!0)}))}}getOverriddenNamespaces(){const e=this.coreSettings?.get(c.w.Localization);let t=[];return Object.keys(e).forEach((n=>{e[n]?.expStrOverrides&&(t=[...t,...Object.keys(e[n]?.expStrOverrides||{})])})),[...new Set(t)]}getOverrides(e){const{enableExpStrings:t}=this.coreSettings?.get(c.w.Localization)??{};if(!t)return{};const n=this.i18nextWrapper.locale.toLowerCase(),i=this.coreSettings?.get(c.w.Localization);return Object.keys(i).map((t=>i[t]?.expStrOverrides?.[e])).filter((e=>!!e)).map((e=>e.reduce(((e,t)=>{const i=Object.keys(t.locales).find((e=>e.toLowerCase()===n)),a=t.key,o=i&&t.locales[i];return a&&o&&(e[a]=o),e}),{}))).reduce(((e,t)=>({...e,...t})),{})}getNamespaceEntry(e,t){return(0,ev.wg)((()=>n(755309)(`./${e}/${(0,we.kebabCase)(t)}.js`)),`${(0,we.kebabCase)(t)}-locale-${e}`)}failI18nLoad(e){this.logger.errorToTelemetry?.("Failed to import locale","namespace_loader",e)}}var mO=n(967112),pO=n(770620);const gO=()=>{};class hO{get locale(){return this._locale}get osLocaleInfo(){return this._osLocaleInfo}constructor(e,t,n,i,a,o,r,s,l,d,u,m,p){this.preloadNamespaces=e,this.originLocale=a,this.staticNamespaces=o,this.userLanguage=s,this.osLocale=l,this.migratedLocaleCode=d,this.coreSettings=p,this.notLoadedNamespacesWithErrors=[];const g=t.newLogger("i18n","services-io-browser-i18n"),h="pseudo"===a||"pseudo_rtl"===a;let v=(0,mO.Co)(a,i,r);const y=(c.w.Core&&this.coreSettings?.get(c.w.Core))??{};y&&y.useEnglishOnlyUI&&(v="en-us");const S=this.initPlugins(t,h,v,g);this.namespaceLoader=((e,t,n)=>new uO(e,t,n))(this,t,p),this.i18next=S,this.latestTranslation={},this.originLocale=a,this.logger=g,this.scenarioFactory=i,this.osPlatform=n.config.osPlatform,this.localizationSettings=this.coreSettings?.get(c.w.Localization),this.initOsDateTimeLocalization(i,g,p,m,u),this.initI18next(v,i,g),this._locale=v,this.loadLocales()}setOSLocaleInfo(e){this._osLocaleInfo=e}async setLocale(e){const t=(c.w.Core&&this.coreSettings?.get(c.w.Core))??{};t&&t.useEnglishOnlyUI&&(e="en-us");const n=(0,mO.fj)(this.scenarioFactory,e);this.i18next.changeLanguage(n),this._locale=n,await this.loadLocales()}setPreloadedNamespaces(e){this.preloadNamespaces&&this.preloadNamespaces.length>0||(this.preloadNamespaces=e,this.logger.log("Setting preloaded namespaces ",this.preloadNamespaces),this.loadLocales())}initPlugins(e,t,n,i){const a=[new lO(e,{filterRegex:/.*\_mf$/})];if(t){const e=new cO;a.push(e),n="en-us"}mO.lw.locale=n;let o=rO.A.createInstance();for(const e of a)o=o.use(e);const r=this.getInitOptions(n,a);return o.init(r).catch((e=>i.error("The i18next initialization failed",e))),o}removeDefaultI18nNamespaces(e){("string"==typeof this.i18next.options.ns?[this.i18next.options.ns]:this.i18next.options.ns??[]).forEach((t=>this.i18next.removeResourceBundle(e,t))),this.i18next.setDefaultNamespace("")}setMissingHandlers(e,t){this.i18next.options.saveMissing=!0,this.i18next.options.missingKeyHandler=(n,i,a)=>{this.missingKeyHandler(e,t,this.i18next,n,i,a)},this.i18next.options.missingInterpolationHandler=n=>this.missingInterpolationHandler(e,t,this.latestTranslation)}initI18next(e,t,n){this.removeDefaultI18nNamespaces(e),this.setMissingHandlers(t,n)}normalizeOSRegionalFormat(e){return e.split("_").join("-").toLowerCase()}initOsDateTimeLocalization(e,t,n,i,a){if(a)return void this.setOSLocaleInfo(a);const o=(c.w.Host&&n?.get(c.w.Host))??{};o&&o.enableOsDateTimeFormatting&&async function(e){const t=await(e?.loadModule("osutils"));return await(t?.getLocaleInfo?.())}(i).then((e=>{if(!e||!e?.regionalFormat)return void this.setOSLocaleInfo(e);const n=this.normalizeOSRegionalFormat(e.regionalFormat);if((0,pO.El)(n))e.regionalFormat=n,this.setOSLocaleInfo(e);else{const n=`getLocaleInfoFromHostCommunication returned unsupported regional format: ${e.regionalFormat}`;t.errorToTelemetry?.(n,"telemetry_i18next_wrapper")}})).catch((n=>{const i=`getLocaleInfoFromHostCommunication failed: ${n}`;t.errorToTelemetry?.(i,"telemetry_i18next_wrapper");e.newScenario(be.Cu.I18nGetLocaleInfo).fail({errors:JSON.stringify(["getLocaleInfoAsync failed"])})}))}loadLocales(){const e=[];this.staticNamespaces&&this.namespaceLoader.loadStatic(this.staticNamespaces);for(const t of this.preloadNamespaces){const n=this.namespaceLoader.load(t);n.promise&&e.push(n.promise.catch(gO))}return Promise.all(e)}missingKeyHandler(e,t,n,i,a,o){const r="string"==typeof n.options.ns?[n.options.ns]:n.options.ns||[""],s=r.indexOf(a)<0;let l="",c="";if(s&&(e=>this.notLoadedNamespacesWithErrors.indexOf(e)>=0)(a))return;s?(l=`The namespace "${a}" has not been loaded. The only loaded namespaces: "${r.join(", ")}"`,c=o,this.notLoadedNamespacesWithErrors.push(a)):l=`The key "${o}" doesn't exist in namespace "${a}" for locale "${i[0]}"`;e.newScenario(be.Cu.I18nMissingKeyHandler).stop({message:l,origin:c}),t.error(l)}missingInterpolationHandler(e,t,n){const i=`Undefined interpolation for namespace "${n.namespace}" and key "${n.key}"`;e.newScenario(be.Cu.I18nMissingInterpolationHandler).stop({message:i}),t.errorToTelemetry?.(i,"telemetry_i18next_wrapper")}getInitOptions(e,t){return{initImmediate:!1,interpolation:{escapeValue:!1},react:{bindI18n:"languageChanged",bindI18nStore:"",nsMode:"default",transKeepBasicHtmlNodesFor:["br","strong","i","b","u","p"]},lng:e,fallbackLng:e,load:"currentOnly",lowerCaseLng:!0,postProcess:t.filter((e=>"postProcessor"===e.type)).map((e=>e.name))}}}class vO extends xp{constructor(){super(d.c1.CreateI18NextWrapper,["config","coreSettings","coreSettingsContext","hostCommunicationService","loggerFactory","platformService","routingServices","scenarioFactory","windowProvider"])}async execute(e){const{preloadedI18nNamespaces:t}=e.coreSettings.get(c.w.Core),n=function(e,t,n,i,a,o,r,s){const{windowProvider:l,routingServices:d,hostCommunicationService:u}=o,m=rt(l),{language:p}=i.get(c.w.LocalMigrated)||{},g=p||void 0,h=c.w.Core&&i.get(c.w.Core),v=h&&h.includeBrowserInLocaleDetermination,y=(0,pO.o8)(l,d,t,m.localeCode,!!v,g),S=(0,pO.xd)(l),f=u?(0,pO.dj)(u):Promise.resolve(void 0);return new hO(e,t,n,a,y,r,s,S,f,g,void 0,u,i)}(t||e.config.preloadedI18nNamespaces||[],e.loggerFactory,e.platformService,e.coreSettings,e.scenarioFactory,{windowProvider:e.windowProvider,routingServices:e.routingServices,hostCommunicationService:e.hostCommunicationService},e.config.staticNamespaces,e.config.locale);e.coreSettingsContext.setLocale(n.locale),e.coreSettingsContext.updatePlatformProviderSettings({localeCode:n.locale}),e.i18NextWrapper=n}}class yO{constructor(e){this.cache=new Map,this.lastId=0,this.maxCacheSize=e.maxCacheSize,this.cachePruningPercent=e.cachePruningPercent}add(e,t){if(this.maxCacheSize<=0)return;let n=this.cache.get(e);if(n)return void(n.time=this.lastId++);const i=new Image;i.src=t,n={image:i,time:this.lastId++},this.cache.set(e,n),this.cache.size>this.maxCacheSize&&this.prune()}setCapacity(e){this.maxCacheSize=e.maxCacheSize,this.cachePruningPercent=e.cachePruningPercent,this.cache.size>this.maxCacheSize&&this.prune()}clear(){this.cache.clear(),this.lastId=0}has(e){return this.cache.has(e)}getUrl(e){if(this.has(e)){const t=this.cache.get(e);return t?.image.src}}get size(){return this.cache.size}prune(){const e=[];this.cache.forEach(((t,n)=>{e.push({time:t.time,url:n})})),e.sort(((e,t)=>e.time-t.time));let t=Math.ceil(this.maxCacheSize*this.cachePruningPercent);t=Math.max(this.cache.size-this.maxCacheSize,t);for(let n=0;n<t;n++){const t=e[n];this.cache.delete(t.url)}}}class SO extends xp{constructor(){super(d.c1.CreateImageCaches,["coreSettings"])}async execute(e){const{coreSettings:t}=e,n=new yO({maxCacheSize:0,cachePruningPercent:.15});e.avatarImageCache=n;const i=t?.getObservable(c.w.ImageCache),a=i?.subscribe((e=>{let t=0;"number"==typeof e?.avatarImageCacheMaxCapacity&&(t=e.avatarImageCacheMaxCapacity),n.setCapacity({maxCacheSize:t,cachePruningPercent:.15})}));return()=>a.unsubscribe()}}class fO extends xp{constructor(){super(d.c1.CreateInactiveGC,["clientState","coreSettings","profilerService"])}async execute(e){const{clientState:t,coreSettings:n,profilerService:i}=e;t.observe().subscribe((async e=>{if(e===Ba.Lg.Inactive||e===Ba.Lg.LongInactive){const{clearConsoleInInactive:e,enableGCInInactive:t}=n.get(c.w.Core);e&&(console.clear(),console.log('Console cleared on going to Inactive/LongInactive. When debugging, you can override this with disabling "clearConsoleInInactive" FF')),t&&i.requestTriggerGC()}}))}}class kO extends xp{constructor(){super(d.c1.LeakDetector,["loggerFactory","coreSettings","windowProvider"])}async execute(e){const{loggerFactory:t,windowProvider:n,coreSettings:i}=e,a=t.newLogger("CreateLeakDetectorTask","core-services-tasks"),{enableObjectLeakDetection:o}=i.get(c.w.Core);if(a.log(`enableObjectLeakDetection ${o}`),!o)return;if(!n.WeakRef)return void a.log("windowProvider?.WeakRef is undefined");const r=new bo.N(i,n);e.leakDetectorService=r,a.log("leakDetectorService instantiated"),n.opener.addEventListener(pi.pI.GetLeaks,(()=>this.sendLeaksStats(n,r,a)));const{testAutomation:s}=i.get(c.w.Test);this.initTestingMode(n,r,i.get(c.w.Host),!!s)}sendLeaksStats(e,t,n){let i=0;const a=e.parent;a.getAndClearAriTelemetry=void 0,a.getLeakDetectorService=void 0,a.gc?(n.log("executing gc() on experience renderer"),a.gc(),i=1e4):n.warn("gc() not defined on experience renderer");let o=0;o=e.setTimeout((()=>{e.clearTimeout(o);const n={leaks:t.getReachableObjectCountsByKey(),leaksTrackingInfo:t.getReachableObjectsTrackingInfo()};e.opener.postMessage(pi.pI.GetLeaks,n)}),i)}initTestingMode(e,t,n,i){const{userType:a}=n;(a&&a.indexOf("test")>-1&&!("getLeakDetectorService"in e.parent)||i)&&(e.parent.getLeakDetectorService=()=>t)}}var CO,bO,wO,TO;!function(e){e.incomplete="incomplete",e.success="success",e.failure="failure"}(CO||(CO={})),function(e){e.LifeCycleReport="life_cycle_report"}(bO||(bO={})),function(e){e.ExperienceLifeCycleManager="experience_life_cycle_manager",e.UserLifeCycleManager="user_life_cycle_manager"}(wO||(wO={})),function(e){e.start="start",e.onPreInit="onPreInit",e.onExperienceWarm="onExperienceWarm",e.onPreWarm="onPreWarm",e.onExperienceLongIdle="onExperienceLongIdle",e.onUserWindowPreWarm="onUserWindowPreWarm",e.onIdle="onIdle"}(TO||(TO={}));const IO=["identity","tflfre","pearnotdefaultapp","error"];function NO(e){if(e.has(Ua.no.ExperienceWarm))return;const t=EO(e,Ua.Mk.NavigationIntentExecuted);let n=!1;t&&(n=!t.shouldRenderContent||function(e){const t=EO(e,Ua.TZ.LayoutRenderComplete),n=["pearnotdefaultapp","error"];return(t?.mainEntityType&&!n.includes(t.mainEntityType))??!1}(e));const i=Array.from(e.values()).pop();return n&&i?.context}function AO(e,t){if(e.has(Ua.no.UserWarm))return;let n=!1;if(FO(e))if(t)if(function(e){const t=EO(e,Ua.Mk.ClientStartFinished);if(t){const{mainEntityType:e}=t;if(!e||-1===IO.indexOf(e))return!0}return!1}(e)&&function(e){const t=EO(e,Ua.TZ.FirstRenderStarted);return!!t}(e)||_O(e))n=!0;else{const t=EO(e,Ua.Mk.NavigationIntentExecuted);t&&!t.shouldRenderContent&&(n=!0)}else n=!0;const i=Array.from(e.values()).pop();return n&&i?.context}function EO(e,t){const n=e.get(t);return n&&n.context}function FO(e){return e.has(Ua.Mk.UserAuthenticated)&&e.has(Ua.Mk.UserConsentedToConsumeResources)}function _O(e){const t=EO(e,Ua.TZ.LayoutRenderComplete);if(t){const{mainEntityType:e}=t;if(!e||-1===IO.indexOf(e))return!0}return!1}function DO(e,t){let n=[];const i=e[t.state];return i&&(n=n.concat(i({context:t.context}))),n}function PO(e,t,n){let i;if(e){const{app:a,state:o,callback:r}=e;let s=r();if(s){const e=s.length;if(e>0){t.log(`App:${a.manifest.id} supports the state: ${o}, job count returned from the app: ${e}.`),s=s.filter((e=>function(e,t,n){if(n===TO.start)return!1;const i=t&&t[n];if(Array.isArray(i))return i.indexOf(e)>-1;return!1}(e.id,n,o)));const i=s.length;i!==e&&t.log(`Jobs filtering by permissions took place. Job count is now: ${i}`)}i={state:o,jobs:s}}}return i}function MO({app:e,currentChanges:t,change:n,getCachedSupportSet:i,sessionContext:a}){const o=function(e,t){if(t.has(Ua.no.Initialized)||e.type===Ua.Mk.ExperienceIdleStateChanged)return;const n=EO(t,Ua.Mk.ActiveEntitiesResolved);return FO(t)&&n?n:void 0}(n,t);if(o)return{app:e,state:TO.onPreInit,callback:()=>function(e,t,n){let i;const a=n(),{entities:o,target:r,...s}=t;for(const t of o)if(t&&a&&a.has(t.type)){i=i||[];const n=DO(e,{context:{...s,entity:t},state:TO.onPreInit});i=i.concat(n)}return i}(e,{...a,...o},i)}}function RO({app:e,currentChanges:t,sessionContext:n}){const i=NO(t);if(i){const t=TO.onExperienceWarm;return{app:e,state:t,callback:()=>DO(e,{context:{...n,...i},state:t})}}}function xO({app:e,currentChanges:t,sessionContext:n,change:i}){if(i.context.isIdle&&FO(t)){const t=TO.onExperienceLongIdle;return{app:e,state:t,callback:()=>DO(e,{context:{...n},state:t})}}}function LO({app:e,currentChanges:t,sessionContext:n}){const i=function(e){if(e.has(Ua.no.WindowWarm))return;let t=!1;_O(e)&&(t=!0);const n=Array.from(e.values()).pop();return t&&n?.context}(t);if(i){const t=TO.onUserWindowPreWarm;return{app:e,state:t,callback:()=>DO(e,{context:{...n,...i},state:t})}}}function OO({appId:e,jobState:t,change:n,currentChanges:i,logger:a}){let o;if(t){const{jobs:r,state:s}=t,l=function(e,t){let n;switch(e){case TO.start:n=Ua.no.Started;break;case TO.onPreInit:n=Ua.no.Initialized;break;case TO.onExperienceWarm:n=Ua.no.ExperienceWarm;break;case TO.onPreWarm:n=Ua.no.UserWarm;break;case TO.onExperienceLongIdle:n=Ua.no.ExperienceLongIdle;break;case TO.onUserWindowPreWarm:n=Ua.no.WindowWarm;break;case TO.onIdle:n=Ua.no.Idle}return function(e,{correlationId:t,windowId:n,context:{target:i}}){return{type:e,context:{target:i},correlationId:t,windowId:n}}(n,t)}(s,n);i.set(l.type,l),a.debug(`Life Cycle - Change type: ${n.type}, initiated by: ${n.context.target}. Resulted in app:${e} transition to state: ${s} and job count: ${r.length}`),o={change:l,jobs:r}}return o}function jO({application:e,appLifeCyclePermissions:t,change:n,currentChanges:i,getNextState:a,getCachedSupportSet:o,logger:r,sessionContext:s}){const l=PO(a({currentChanges:i,app:e,change:n,getCachedSupportSet:o,sessionContext:s}),r,t);return OO({appId:e.manifest.id,jobState:l,change:n,currentChanges:i,logger:r})}var BO,UO,$O,WO,VO,HO;!function(e){e.Experience="Experience"}(BO||(BO={})),function(e){e.Window="Window"}(UO||(UO={})),function(e){e.FirstUserAtBoot="FirstUserAtBoot",e.Other="Other"}($O||($O={}));class zO{constructor(e,t,n){this._scope=e,this._appLifeCyclePermissions=t,this._sessionContext=n,this._currentChanges=new Map,this._logger=n.loggerFactory.newLogger("ApplicationLifeCycleManager","core-services-life-cycle")}get managedId(){return this._application?.manifest.id}manageApplication(e){this._application=e}onChange(e){const t=[];if(!this._application)return t;this._currentChanges.set(e.type,e);const n=function(e){switch(e){case BO.Experience:return[RO];case UO.Window:return[LO];default:return[MO,(t=e===$O.FirstUserAtBoot,({app:e,currentChanges:n,sessionContext:i})=>{const a=AO(n,t);if(a){const t=TO.onPreWarm;return{app:e,state:t,callback:()=>DO(e,{context:{...i,...a},state:t})}}}),xO]}var t}(this._scope);for(const i of n){const n=jO({application:this._application,appLifeCyclePermissions:this._appLifeCyclePermissions,change:e,currentChanges:this._currentChanges,getNextState:i,getCachedSupportSet:()=>this.supportedSets,logger:this._logger,sessionContext:this._sessionContext});n&&t.push(n)}return t}get supportedSets(){return this._supportedEntitySet=this._supportedEntitySet||this._application&&function(e){const t=e.manifest.supportedEntities,n=new Set;return t&&t.reduce(((e,t)=>e.add(t)),n),n}(this._application),this._supportedEntitySet}}!function(e){e.Experience="Experience"}(WO||(WO={})),function(e){e.Window="Window"}(VO||(VO={})),function(e){e.FirstUserAtBoot="FirstUserAtBoot",e.Other="Other"}(HO||(HO={}));const qO=["identity","tflfre","pearnotdefaultapp","error"];function GO(e,t){const n=e.get(t);return n&&n.context}function YO({changeset:e}){return e.has(Ua.Mk.UserAuthenticated)&&e.has(Ua.Mk.UserConsentedToConsumeResources)}function QO({changeset:e}){const t=GO(e,Ua.TZ.LayoutRenderComplete);if(t){const{mainEntityType:e}=t;if(!e||-1===qO.indexOf(e))return!0}return!1}const JO=[{name:TO.onExperienceWarm,fn:({application:e,ctx:t})=>{const n=function({changeset:e}){if(e.has(Ua.no.ExperienceWarm))return;const t=GO(e,Ua.Mk.NavigationIntentExecuted);let n=!1;t&&(n=!t.shouldRenderContent||function({changeset:e}){const t=GO(e,Ua.TZ.LayoutRenderComplete);return(t?.mainEntityType&&!["pearnotdefaultapp","error"].includes(t.mainEntityType))??!1}({changeset:e}));const i=Array.from(e.values()).pop();return n&&i?.context}({changeset:t.changeset});if(n){const i=TO.onExperienceWarm;return{app:e,change:t.change,scope:t.scope,state:i,jobs:DO(e,{state:i,context:{...t.context,...n}})}}},scope:"experience"},{name:TO.onPreInit,fn:({application:e,ctx:t,supportedEntitySet:n})=>{const i=function({change:e,changeset:t}){if(t.has(Ua.no.Initialized)||e.type===Ua.Mk.ExperienceIdleStateChanged)return;const n=GO(t,Ua.Mk.ActiveEntitiesResolved);if(YO({changeset:t})&&n)return n;return}({change:t.change,changeset:t.changeset});if(i){let a;const{entities:o,target:r,...s}=i;for(const i of o)if(i&&n&&n.has(i.type)){a=a||[];const n=DO(e,{context:{...t.context,...s,entity:i},state:TO.onPreInit});a=a.concat(n)}if(Array.isArray(a))return{app:e,change:t.change,scope:t.scope,state:TO.onPreInit,jobs:a}}},scope:"user"},{name:TO.onPreWarm,fn:({application:e,ctx:t})=>{const n=function({changeset:e,isFirstInitializedUser:t}){if(e.has(Ua.no.UserWarm))return;let n=!1;if(YO({changeset:e}))if(t)if(function({changeset:e}){return!!GO(e,Ua.TZ.FirstRenderStarted)}({changeset:e})&&function({changeset:e}){const t=GO(e,Ua.Mk.ClientStartFinished);if(t){const{mainEntityType:e}=t;if(!e||-1===qO.indexOf(e))return!0}return!1}({changeset:e})||QO({changeset:e}))n=!0;else{const t=GO(e,Ua.Mk.NavigationIntentExecuted);t&&!t.shouldRenderContent&&(n=!0)}else n=!0;const i=Array.from(e.values()).pop();return n&&i?.context}({changeset:t.changeset,isFirstInitializedUser:t.scope===HO.FirstUserAtBoot});if(n){const i=TO.onPreWarm;return{app:e,change:t.change,scope:t.scope,state:i,jobs:DO(e,{state:i,context:{...t.context,...n}})}}},scope:"user"},{name:TO.onUserWindowPreWarm,fn:({application:e,ctx:t})=>{const n=function({changeset:e}){if(e.has(Ua.no.WindowWarm))return;let t=!1;QO({changeset:e})&&(t=!0);const n=Array.from(e.values()).pop();return t&&n?.context}({changeset:t.changeset});if(n){const i=TO.onUserWindowPreWarm;return{app:e,change:t.change,scope:t.scope,state:i,jobs:DO(e,{state:i,context:{...t.context,...n}})}}},scope:"window"},{name:TO.onExperienceLongIdle,fn:({application:e,ctx:t})=>{if(t.change.context.isIdle&&YO({changeset:t.changeset})){const n=TO.onExperienceLongIdle;return{app:e,change:t.change,scope:t.scope,state:n,jobs:DO(e,{state:n,context:{...t.context}})}}},scope:"user"},{name:TO.onIdle,fn:({application:e,ctx:t})=>{const n=function({changeset:e}){if(e.has(Ua.no.Idle))return;let t=!1;(function({changeset:e}){return e.has(Ua.TZ.IdleCallback)})({changeset:e})&&function({changeset:e}){return e.has(Ua.Mk.PreWarmJobsCompleted)&&e.has(Ua.Mk.WindowWarmJobsCompleted)&&e.has(Ua.Mk.ExperienceWarmJobsCompleted)}({changeset:e})&&(t=!0);const n=Array.from(e.values()).pop();return t&&n?.context}({changeset:t.changeset});if(n){const i=TO.onIdle;return{app:e,change:t.change,scope:t.scope,state:i,jobs:DO(e,{state:i,context:{...t.context,...n}})}}},scope:"user"}];const KO={experience:[WO.Experience],user:[HO.FirstUserAtBoot,HO.Other],window:[VO.Window]};class ZO{constructor(e,t){this.application=e,this.permissions=t,this.changesets={experience:new Map,users:{},windows:{}},this.supportedEntitySet=this.getSupportedEntitySet()}performTransition(e){const t=XO[e.state],n=this.getChangeset(e);if(!n)return;const i={type:t,context:{target:e.change.context.target},correlationId:e.change.correlationId,windowId:e.change.windowId};return n.set(i.type,i),{change:i,jobs:e.jobs}}getTransitions(e){return function(e){return JO.map((({fn:t,scope:n})=>{if(KO[n].includes(e.ctx.scope))return t(e)})).filter(Boolean)}({...e,application:this.application,supportedEntitySet:this.supportedEntitySet}).map((t=>{const{jobs:n}=t;return n&&(t.jobs=n.filter((n=>{const i=this.computeJobEligibility(n,t,this.permissions);return i||e.logger.warn(`${t.state} denied job ${n.id} due to missing permissions`),i}))),t}))}getChangeset(e){return e.scope===WO.Experience?this.changesets.experience:e.scope===VO.Window?this.extractChangesetFromGroup({changesetGroup:this.changesets.windows,contextId:e.change.windowId}):this.extractChangesetFromGroup({changesetGroup:this.changesets.users,contextId:e.change.userContextId})}extractChangesetFromGroup({changesetGroup:e,contextId:t}){if(t)return e[t]||(e[t]=new Map),e[t]}computeJobEligibility(e,t,n){if(t.state===TO.start)return!1;const i=n&&n[t.state];return!!Array.isArray(i)&&i.indexOf(e.id)>-1}getSupportedEntitySet(){const e=this.application.manifest.supportedEntities,t=new Set;return e&&e.reduce(((e,t)=>e.add(t)),t),t}}const XO={[TO.start]:Ua.no.Started,[TO.onPreInit]:Ua.no.Initialized,[TO.onExperienceWarm]:Ua.no.ExperienceWarm,[TO.onPreWarm]:Ua.no.UserWarm,[TO.onExperienceLongIdle]:Ua.no.ExperienceLongIdle,[TO.onUserWindowPreWarm]:Ua.no.WindowWarm,[TO.onIdle]:Ua.no.Idle};class ej extends ZO{constructor(e,t){super(e,t),this._loggerCache=new WeakMap}get managedId(){return this.application.manifest.id}onChange(e,t,n){const i=this.getLogger(e,t,n),a=[],o=this.getChangeset({scope:t,change:e});if(!o)return i.warn(`missing ${t===VO.Window?"window":"user context"} id.`),a;o.set(e.type,e);const r=this.getTransitions({logger:i,ctx:{change:e,changeset:o,context:n,scope:t}});for(const e of r){const t=this.performTransition(e);t&&a.push(t)}return a}removeUser(e,t){this.changesets.users[e]&&(t.debug(`removing user ${e} from change set`),delete this.changesets.users[e])}removeWindow(e,t){this.changesets.windows[e]&&(t.debug(`removing window ${e} from change set`),delete this.changesets.windows[e])}getLogger(e,t,n){let i=this._loggerCache.get(n.loggerFactory);i||(i=n.loggerFactory.newLogger("ApplicationLifeCycleManagerV2","core-services-life-cycle"),this._loggerCache.set(n.loggerFactory,i));const a=`[${this.managedId}::${t}::${e.type}]`;return new Proxy(i,{get(e,t,n){const i=Reflect.get(e,t,n).bind(e);return"function"==typeof i?(...e)=>{i(`${a} ${e[0]}`,...e.slice(1))}:i}})}}const tj=new Set(["standup-calling","setup-calling-app-events"]);const nj=(e,t,n,i)=>{const a=function(e,t,n){if(!n){const{context:{execution:n}}=e;t.error(`Received a scheduler change in state: ${Ti.si[n]} with no active scenario: ${JSON.stringify(e)}`)}return n}(e,t,i);if(a){const{context:{execution:t,handle:i,error:o}}=e;a.appendEventData({errorCode:o?.code,message:o?.message,context:o?.context});const r=a.name===be.Cu.ScheduledJobComplete?be.BQ.ScheduledJobStateChange:be.BQ.ScheduledCallingJobStateChange;a.mark(`${r}_${Ti.si[t].toLocaleLowerCase()}_${i}`),n(a)}};class ij{constructor(e,t,n){this._schedulerChangeReporting=e,this._scenarioFactory=t,this._activeExpScenariosMap=new Map,this._activeAppScenariosMap=new Map,this._activeSchedulerScenariosMap=new Map,this._logger=n.newLogger("LifeCycleTelemetry","core-services-life-cycle-telemetry")}init(){const e=e=>({change:e,scenarioFactory:this._scenarioFactory,activeAppScenariosMap:this._activeAppScenariosMap,activeExpScenariosMap:this._activeExpScenariosMap,activeSchedulerScenariosMap:this._activeSchedulerScenariosMap,logger:this._logger});this._schedulingChangeSubscription=this._schedulerChangeReporting.observeChanges().pipe((0,o.T)((t=>function({change:e,activeSchedulerScenariosMap:t,scenarioFactory:n,logger:i}){const{context:{execution:a}}=e,o=(({windowId:e,context:{handle:t}})=>`${t}:${e}`)(e);let r=t.get(o);switch(a){case Ti.si.Started:if(r)i.error(`Received a scheduler change in state: ${Ti.si[a]} with an active scenario already running. Change: ${JSON.stringify(e)}`);else{const{correlationId:i,context:{meta:{id:a,priority:s,scheduledById:l,runOncePerId:c},target:d},type:u}=e;r=n.newScenario(tj.has(a)?be.Cu.ScheduledCallingJobComplete:be.Cu.ScheduledJobComplete,{clientId:e.context.meta.uuid}),t.set(o,r),r.appendEventData({"Job.Id":a,"Job.Priority":Ti.Ad[s],"Job.ScheduledBy":l,"Job.RunOncePerId":c,target:d,correlationId:i,type:u})}break;case Ti.si.Canceled:nj(e,i,(e=>e?.cancel()),r);break;case Ti.si.Complete:nj(e,i,(e=>e?.stop()),r),t.delete(o);break;case Ti.si.Received:i.log(`Received a scheduler change in state: ${Ti.si[a]}: Change:${JSON.stringify(e)}`)}}(e(t))))).subscribe()}destroy(){this._schedulingChangeSubscription&&this._schedulingChangeSubscription.unsubscribe(),this._schedulingChangeSubscription=void 0}}class aj{constructor(e,t){this._scheduler=e,this._logger=t.newLogger("SchedulerWithValidator","core-services-scheduling"),this._uniqueJobIds=new Set}validateAndSchedule(e,t,n){const{id:i,runOncePerId:a}=t;if(this._uniqueJobIds.has(i)){if(a)return this._logger.debug(`Job by ID ${i} has already run once.`),Ti.dp}else this._uniqueJobIds.add(i);return this._scheduler.schedule(e,t,n)}}const oj=new Set([Ua.Mk.ClientStartFinished,Ua.Mk.UserAuthenticated,Ua.Mk.UserConsentedToConsumeResources,Ua.Mk.NavigationIntentExecuted,Ua.TZ.LayoutRenderComplete,Ua.TZ.FirstRenderStarted]);function rj(e,t,{id:n,type:i,stateJobStatus:a,jobCount:o,jobIds:r}){const s=`${t} {app: ${n},transtionedToState: ${i},jobsStatusForState: ${a},jobsCompleted(${o}): [${r.length?r.join(", "):"none"}]}`;"failure"===a?e.errorToTelemetry?.(s,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0):e.log(s)}const sj=12e4;class lj{constructor({context:e,scheduler:t,experienceChangeReportingService:n,loggerFactory:i,lifeCycleChangeReportingService:a,lifeCycleJobPermissions:o}){this.managers=new Map,this.applications=[],this.contexts={experience:{cleanupJobs:[],schedulerWithValidator:new aj(t,i),scope:BO.Experience,session:e},users:new Map,windows:new Map},this.coreSettings=e.coreSettings,this.experienceChangeReportingService=n,this.lifeCycleChangeReportingService=a,this.lifeCycleJobPermissions=o||{},this.logger=i.newLogger("ExperienceLifeCycleManagerV2","core-services-life-cycle-manager"),this.scheduler=t}init(){const e=this.experienceChangeReportingService.observeChanges();this.subscription=e.pipe((0,wa.M)((e=>this.publish(e)))).subscribe(),this.logger.log("initialized")}async destroy(e){const t=this.contexts.users.size+this.contexts.windows.size;t>0&&this.logger.warn(`destroying with ${t} other contexts`),await this.processCleanupJobs(this.contexts.experience,e),this.subscription?.unsubscribe(),this.scheduler.destroy(),this.logger.log("destroyed")}registerApplication(e){if(!this.isInitialized)throw new Error("Unable to register application before ExperienceLifeCycleManager initialization");const t=e.manifest.id;if(this.managers.has(t))return void this.logger.warn(`skipping application, already registered ${e.manifest.id}`);const n=new ej(e,this.lifeCycleJobPermissions?.Application);this.managers.set(t,n),this.applications.push(e),this.logger.log(`registered application ${e.manifest.id}`)}registerUser(e,t){if(this.contexts.users.has(e))return void this.logger.errorToTelemetry?.(`user already exists for contextId ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0);const n={cleanupJobs:[],userContextId:e,schedulerWithValidator:new aj(this.scheduler,t.loggerFactory),session:t,scope:this.contexts.users.size>0?$O.Other:$O.FirstUserAtBoot};this.contexts.users.set(e,n),this.logger.log(`registered user ${e}`)}async removeUser(e,t){const n=this.contexts.users.get(e);if(n){const i=[];this.contexts.windows.forEach((n=>{n.userContextId===e&&i.push(this.removeWindow(n.windowId,e,t))})),await Promise.all(i),await this.processCleanupJobs(n,t),this.managers.forEach((t=>t.removeUser(e,this.logger))),this.contexts.users.delete(e),this.logger.log(`removed user ${e}, reason ${t}`)}else this.logger.errorToTelemetry?.(`user not found ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}async registerWindow(e,t,n){let i=this.contexts.windows.get(e);i&&i.userContextId===t?this.logger.errorToTelemetry?.(`window ${e} already exists for user ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0):(i&&await this.removeWindow(e,void 0,"switch_user"),this.contexts.users.has(t)?(i={cleanupJobs:[],schedulerWithValidator:new aj(this.scheduler,n.loggerFactory),windowId:e,userContextId:t,session:{...this.contexts.experience.session,...n},scope:UO.Window},this.contexts.windows.set(e,i),this.logger.log(`registered window ${e} to user ${t}`)):this.logger.errorToTelemetry?.(`failed to register window, could not find user ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}async removeWindow(e,t,n){const i="removeWindow::",a=this.contexts.windows.get(e);a?(await this.processCleanupJobs(a,n),this.managers.forEach((t=>t.removeWindow(e,this.logger))),this.contexts.windows.delete(e),this.logger.log(`${i} removed window ${e} for user ${t} with reason ${n}`)):this.logger.errorToTelemetry?.(`${i} window not found for ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}publish(e){const t=!!this.coreSettings.get(c.w.Core)?.enableExperienceLifeCycleUserSignalsLogging;if(function(e,t,n){e.log(`Received change ${t.type}, to be processed at scopes: experience, user: ${t.userContextId||"all users"}, window: ${t.windowId||"none"}`),n&&oj.has(t.type)&&e.infoToTelemetry?.("user-scoped-signal-received","webclient_framework_foundation_core_services_life_cycle_signals",{signalType:t.type},!0)}(this.logger,e,t),e.userContextId)this.publishChangeWithUserContext(e,e.userContextId);else{const t=Array.from(this.contexts.users.values());for(const{userContextId:n}of t)this.publishChangeWithUserContext(e,n)}if(e.windowId){const t=this.contexts.windows.get(e.windowId);t?this.processChange({change:e,context:t}):this.logger.warn(`windowId ${e.windowId} is not registered with the life cycle manager, only processing change at the experience scope`)}this.processChange({change:e,context:this.contexts.experience})}publishChangeWithUserContext(e,t){const n=this.contexts.users.get(t);if(!n)return void this.logger.errorToTelemetry?.(`user not found for userContextId ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0);const i=!e.userContextId&&t?{...e,userContextId:t}:e;this.processChange({change:i,context:n})}async processChange({change:e,context:t}){const n=`${t.scope}::${e.type}`,i=[];performance.now();let a;this.managers.forEach((n=>{const o=n.managedId,r=n.onChange(e,t.scope,t.session);o&&r.length>0&&r.forEach((e=>{i.push(this.scheduleJobs({changeWithJobs:e,managedApplicationId:o,context:t}))}));const[s]=r||[];s&&(a=s.change.type)}));const o=lj.getJobsCompleteChangeType(a);let r,s;const l="WarmJobsCompleteTimer";i.length>0&&o&&(r=new Promise((e=>{s=this.contexts.experience.session.windowProvider.setTimeout((()=>{this.logger.warn(`${l}: Jobs did not complete within 120000ms for ${a}, firing ${o} change anyway`),e()}),sj)}))),await Promise.race([Promise.all(i),...r?[r]:[]]),this.contexts.experience.session.windowProvider.clearTimeout(s),o&&this.fireJobsCompletedChange(e,o);const c=await Promise.all(i);t.scope!==UO.Window&&this.markPostALTScenarioIfNeeded(c,t);let d=0;for(const e of c)e.jobCount>0&&(rj(this.logger,n,e),t.cleanupJobs.push(...e.cleanupJobs),d+=e.cleanupJobs.length);d>0&&this.logger.log(`${n} saved ${d} cleanup jobs`);const u=this.generateChangeReport({change:e,results:c,scope:t.scope});return this.lifeCycleChangeReportingService.report(u),{change:e}}fireJobsCompletedChange(e,t){this.experienceChangeReportingService.report({type:t,correlationId:e.correlationId,context:{target:"experience-life-cycle-manager"},userContextId:e.userContextId,windowId:e.windowId})}async scheduleJobs({changeWithJobs:e,managedApplicationId:t,context:n}){const{change:i,jobs:a}=e,o=[Ua.no.ExperienceLongIdle,Ua.no.Idle].includes(i.type)?Ti.Ad.Background:Ti.Ad.Macro,r=new Map;a.forEach((({job:e,maxRetries:t,id:a,...s})=>{const l=this.logger,c=(0,E.v4)();r.set(a,new Promise(((r,d)=>{const u={...s,id:a,uuid:c,priority:o,scheduledById:"services-life-cycle-manager"},m=n.schedulerWithValidator.validateAndSchedule((async()=>{let i=0,o=t?Math.min(t,3)+1:1;const s=tj.has(a)?n.session.scenarioFactory.findScenarioByNameAndId(be.Cu.ScheduledCallingJobComplete,c):null;for(;o;){i++,o--;try{s?.mark(`start-${a}`);const t=await e();return s?.mark(`end-${a}`),r(t),t}catch(e){if(!o)throw s?.mark(`error-${a}`),d(e),e;l.errorToTelemetry?.(`retrying failed job ${a}, after attempts ${i}, retries remaining ${o}, error: ${e.message?e.message:e}`,"webclient_framework_foundation_core_services_life_cycle_manager")}}}),u,i.correlationId);m===Ti.dp&&r(void 0),this.logger.log(`job ${a} scheduled with handle ${m}`)})))}));const s=[];let l=CO.success;for(const[e,n]of r)try{const t=await n;t&&s.push(t),this.logger.log(`job ${e} completed`)}catch(n){const i=`job ${e} scheduled by ${t} did not complete successfully. Continuing execution of remaining jobs. Error: ${n.message?n.message:n}`;this.logger.errorToTelemetry?.(i,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0),l=CO.failure}return Promise.resolve({id:t,type:i.type,stateJobStatus:l,jobCount:a.length,jobIds:a.map((e=>e.id)),cleanupJobs:s})}markPostALTScenarioIfNeeded(e,t){const n=t.scope===BO.Experience?Ua.no.ExperienceWarm:Ua.no.UserWarm,i=t.scope===BO.Experience?be.BQ.ExperienceWarmJobCompleted:be.BQ.PreWarmJobCompleted;if(e?.length>0&&e[0]?.type===n){const e=t.session.scenarioFactory?.findScenario(be.Cu.PostALT);e&&(e.mark(i),this.logger.log("marked postALT scenario as completed"))}}generateChangeReport({change:e,results:t,scope:n}){const i=n===BO.Experience?wO.ExperienceLifeCycleManager:wO.UserLifeCycleManager;return{...e,type:bO.LifeCycleReport,context:{apps:t,target:i,reportedChange:e}}}async processCleanupJobs(e,t){let n="experience";"windowId"in e?n=e.windowId:"userContextId"in e&&(n=e.userContextId);const i=`${e.scope}::${n}`,a=e.cleanupJobs;let o;for(let e=a.length-1;e>=0;e--){const n=a[e];try{await n(t)}catch(e){o=o?o.concat(`${n.toString()}::${(0,ge.hR)(e)}`):`${n.toString()}::${(0,ge.hR)(e)}::`}}if(this.logger.log(`${i} ran ${a.length} cleanup jobs`),o){const e=new Ha.a(Ha.D.CLEANUP,new Error(o));this.logger.errorToTelemetry?.(`${i} ${e.toTelemetryEntry()}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}}get isInitialized(){return Boolean(this.subscription)}static getJobsCompleteChangeType(e){switch(e){case Ua.no.ExperienceWarm:return Ua.Mk.ExperienceWarmJobsCompleted;case Ua.no.UserWarm:return Ua.Mk.PreWarmJobsCompleted;case Ua.no.WindowWarm:return Ua.Mk.WindowWarmJobsCompleted;default:return}}}class cj{constructor(e,t,n,i,a,o){this._elcm=new lj({scheduler:e,experienceChangeReportingService:t,context:n,lifeCycleChangeReportingService:i,loggerFactory:a,lifeCycleJobPermissions:o})}init(){this._elcm.init()}async destroy(e){this._elcm.destroy(e)}manageApplication(e){this._elcm.registerApplication(e)}manageUser(e,t){this._elcm.registerUser(e,t)}async removeUser(e,t){return this._elcm.removeUser(t,e)}manageWindow(e,t,n){this._elcm.registerWindow(e,t,n)}async removeWindow(e,t,n){return this._elcm.removeWindow(t,e,n)}}function dj({applicationManagers:e,change:t,logger:n,schedulerWithValidator:i,scenarioFactory:a}){const o=[];return n.debug(`Change received: ${t.type}`),e.forEach((e=>{const r=e.managedId,s=e.onChange(t);r&&s.length>0&&s.forEach((e=>o.push(async function(e,t,n,i,a){const{jobs:o,change:r}=e,s=[],l=[Ua.no.ExperienceLongIdle,Ua.no.Idle].includes(r.type),c=l?Ti.Ad.Background:Ti.Ad.Macro;o.forEach((e=>{s.push(function({job:e,id:t,...n},i,a,o,r){const s=(0,E.v4)();return new Promise(((l,c)=>{i.validateAndSchedule((async()=>{const n=tj.has(t)?o.findScenarioByNameAndId(be.Cu.ScheduledCallingJobComplete,s):null;try{n?.mark(`start-${t}`);const i=await e();return n?.mark(`end-${t}`),l(i),i}catch(e){throw n?.mark(`error-${t}`),c(e),e}}),{priority:r,...n,id:t,uuid:s,scheduledById:"services-life-cycle-manager"},a)===Ti.dp&&l(void 0)}))}(e,i,r.correlationId,a,c))}));const d=[];let u=CO.success;for(const e of s)try{const t=await e;t&&d.push(t)}catch(e){const i=`Not all jobs scheduled by ${n} completely successfully. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`;t.errorToTelemetry&&t.errorToTelemetry(i,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0),u=CO.failure}return Promise.resolve({id:n,type:r.type,stateJobStatus:u,jobCount:o.length,jobIds:o.map((e=>e.id)),cleanupJobs:d})}(e,n,r,i,a))))})),{change:t,lcChanges:o}}async function uj({change:e,lcChanges:t}){return{change:e,lcChanges:await Promise.all(t)}}function mj({change:e,lcChanges:t},n,i){const{type:a}=e;0===t.length&&n.debug(`Experience change type: ${a} produced no application life cycle changes`);const o=i===BO.Experience?wO.ExperienceLifeCycleManager:wO.UserLifeCycleManager;return{...e,type:bO.LifeCycleReport,context:{apps:t,target:o,reportedChange:e}}}class pj{constructor(e,t,n,i,a,o,r){this._scope=t,this._sessionContext=i,this._lifeCycleChangeReportingService=a,this._loggerFactory=o,this._lifeCycleJobPermissions=r,this._cleanupJobs=[],this._applicationManagers=[],this._activelyManagedApplications=new Set,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger(`WindowLifeCycleManager[${e}]`,"core-services-life-cycle-manager"),this._schedulerWithValidator=new aj(n,o)}async notify(e){const t=dj({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory}),n=await uj(t);for(const{cleanupJobs:e}of n.lcChanges)this._cleanupJobs.push(...e);const i=mj(n,this._logger,this._scope);this._lifeCycleChangeReportingService.report(i)}manageApplication(e){if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const t=new zO(this._scope,this._lifeCycleJobPermissions?.Application,this._sessionContext);t.manageApplication(e),this._applicationManagers.push(t)}async destroy(e){let t,n,i;for(;t=this._cleanupJobs.pop();)try{await t(e)}catch(e){i=i?i.concat(`${t.toString()}::${(0,ge.hR)(e)}`):`${t.toString()}::${(0,ge.hR)(e)}::`}i&&(n=new Ha.a(Ha.D.CLEANUP,new Error(i)),this._logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}}class gj{constructor(e,t,n,i,a,o,r){this._scope=t,this._scheduler=n,this._sessionContext=i,this._lifeCycleChangeReportingService=a,this._loggerFactory=o,this._lifeCycleJobPermissions=r,this._cleanupJobs=[],this._windowLifecycleManagers=new Map,this._applicationManagers=[],this._activelyManagedApplications=new Set,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger(`UserLifeCycleManager[${e}]`,"core-services-life-cycle-manager"),this._schedulerWithValidator=new aj(n,o)}manageApplication(e){if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const t=new zO(this._scope,this._lifeCycleJobPermissions?.Application,this._sessionContext);t.manageApplication(e),this._applicationManagers.push(t)}async notify(e){this.handleWindowChange(e);const t=dj({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory}),n=await uj(t);if(n.lcChanges?.length>0&&n.lcChanges[0]?.type===Ua.no.UserWarm){const e=this._sessionContext.scenarioFactory?.findScenario(be.Cu.PostALT);e?.mark(be.BQ.PreWarmJobCompleted)}for(const{cleanupJobs:e}of n.lcChanges)this._cleanupJobs.push(...e);const i=mj(n,this._logger,this._scope);this._lifeCycleChangeReportingService.report(i)}manageWindow(e,t){if(this._windowLifecycleManagers.has(e))return void this._logger.errorToTelemetry?.(`WINDOW_LIFECYCLE_MANAGER_ALREADY_EXISTS[${e}]`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0);const n=new pj(e,UO.Window,this._scheduler,t,this._lifeCycleChangeReportingService,this._loggerFactory,this._lifeCycleJobPermissions);this._activelyManagedApplications.forEach((e=>n.manageApplication(e))),this._windowLifecycleManagers.set(e,n)}async removeWindow(e,t){const n=this._windowLifecycleManagers.get(e);n&&(await n.destroy(t),this._windowLifecycleManagers.delete(e))}async destroy(e){let t,n,i;for(this._windowLifecycleManagers.forEach((t=>{t.destroy(e)}));t=this._cleanupJobs.pop();)try{await t(e)}catch(e){i=i?i.concat(`${t.toString()}::${(0,ge.hR)(e)}`):`${t.toString()}::${(0,ge.hR)(e)}::`}i&&(n=new Ha.a(Ha.D.CLEANUP,new Error(i)),this._logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}handleWindowChange(e){e.windowId&&this._windowLifecycleManagers.get(e.windowId)?.notify(e)}}class hj{constructor(e,t,n,i,a,o){this._scheduler=e,this._experienceChangeReportingService=t,this._sessionContext=n,this._lifeCycleChangeReportingService=i,this._loggerFactory=a,this._lifeCycleJobPermissions=o,this._cleanupJobs=[],this._userLifecycleManagers=new Map,this._userScopedChangeTypes=new Set([Ua.Mk.ClientStartFinished,Ua.Mk.UserAuthenticated,Ua.Mk.UserConsentedToConsumeResources,Ua.Mk.NavigationIntentExecuted,Ua.TZ.LayoutRenderComplete,Ua.TZ.FirstRenderStarted]),this.handleUserScopeChange=e=>{if(this._coreSettings.get(c.w.Core)?.enableExperienceLifeCycleUserSignalsLogging&&this._userScopedChangeTypes.has(e.type)&&this._logger.infoToTelemetry?.("user-scoped-signal-received","webclient_framework_foundation_core_services_life_cycle_signals",{signalType:e.type},!0),e.userContextId){const t=this._userLifecycleManagers.get(e.userContextId);t?t.notify(e):this._logger.error(`EXPECTED_USER_LIFECYCLE_MANAGER_NOT_FOUND[${e.userContextId}]`)}else this._userLifecycleManagers.forEach((t=>t.notify(e)))},this._applicationManagers=[],this._activelyManagedApplications=new Set,this._coreSettings=this._sessionContext.coreSettings,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger("ExperienceLifeCycleManager","core-services-life-cycle-manager"),this._schedulerWithValidator=new aj(this._scheduler,a)}init(){const e=this._experienceChangeReportingService.observeChanges();this._subscription=e.pipe((0,wa.M)(this.handleUserScopeChange),(0,o.T)((e=>dj({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory}))),(0,Da.H)(uj),(0,wa.M)((e=>{if(e.lcChanges?.length>0&&e.lcChanges[0]?.type===Ua.no.ExperienceWarm){const e=this._sessionContext.scenarioFactory?.findScenario(be.Cu.PostALT);e?.mark(be.BQ.ExperienceWarmJobCompleted)}for(const{cleanupJobs:t}of e.lcChanges)this._cleanupJobs.push(...t)})),(0,o.T)((e=>mj(e,this._logger,BO.Experience))),(0,o.T)((e=>this._lifeCycleChangeReportingService.report(e)))).subscribe()}async destroy(e){let t,n,i;for(;t=this._cleanupJobs.pop();)try{await t(e)}catch(e){i=i?i.concat(`${t.toString()}::${(0,ge.hR)(e)}`):`${t.toString()}::${(0,ge.hR)(e)}::`}this._subscription&&this._subscription.unsubscribe(),this._scheduler.destroy(),i&&(n=new Ha.a(Ha.D.CLEANUP,new Error(i)),this._logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}manageApplication(e){if(!this._subscription)throw new Error("Unable to manage provided application prior to LifeCycleManager init.");if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const t=new zO(BO.Experience,this._lifeCycleJobPermissions?.Application,this._sessionContext);t.manageApplication(e),this._applicationManagers.push(t)}manageUser(e,t){if(this._userLifecycleManagers.has(e))return void this._logger.error(`USER_LIFECYCLE_MANAGER_ALREADY_EXISTS[${e}]`);const n=new gj(e,this._userLifecycleManagers.size>0?$O.Other:$O.FirstUserAtBoot,this._scheduler,t,this._lifeCycleChangeReportingService,this._loggerFactory,this._lifeCycleJobPermissions);this._activelyManagedApplications.forEach((e=>n.manageApplication(e))),this._userLifecycleManagers.set(e,n)}manageWindow(e,t,n){this.removeWindow(void 0,e,"switch_user");const i=this._userLifecycleManagers.get(t);i?i.manageWindow(e,{...this._sessionContext,...n}):this._logger.errorToTelemetry?.(`EXPECTED_USER_LIFECYCLE_MANAGER_NOT_FOUND[${t}]`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}async removeUser(e,t){const n=this._userLifecycleManagers.get(t);n?(await n.destroy(e),this._userLifecycleManagers.delete(t)):this._logger.warn(`USER_LIFECYCLE_MANAGER_NOT_FOUND_TO_DESTROY[${t}]`)}async removeWindow(e,t,n){e?this._userLifecycleManagers.get(e)?.removeWindow(t,n):this._userLifecycleManagers.forEach((e=>e.removeWindow(t,n)))}}const vj="react-web-client",yj="client-start-failure-count";function Sj(e,t){return t||(t=e.loader?.getProperties?.().experienceName||vj),`${t}_${yj}`}var fj=n(586207);const kj=1024;async function Cj(e,t,n,i){const a=await(fj.f.getInstance()?.getMemoryData(i));if(!a)return{baseRendererWS:0,baseJSUsedHeapSize:0};const o=await async function(e,t){let n=0;n=t.getActiveWindows().length;const i=e.get(c.w.Diagnostics).memorySharedSettings.popoutSizeInMB;if(n<=1||!i)return{jsUsedHeapSize:0,rendererWorkingSet:0};return{jsUsedHeapSize:(n-1)*(i.jsUsedHeapSize||0)*kj,rendererWorkingSet:(n-1)*(i.rendererWorkingSet||0)*kj}}(e,t),r=await async function(e,t){const n={id:"dummy",source:"memoryUtilities"},i=(await(t?.getCachedUsers?.(n,{isAllCachedUsers:!0,isAuthenticated:!0})))?.length??1,a=e.get(c.w.Diagnostics).memorySharedSettings.accountSizeInMB;if(i<=1||!a)return{jsUsedHeapSize:0,rendererWorkingSet:0};return{jsUsedHeapSize:(i-1)*(a.jsUsedHeapSize||0)*kj,rendererWorkingSet:(i-1)*(a.rendererWorkingSet||0)*kj}}(e,n);let s=0;const l=a.Perf_MainRenderer_WorkingSet;l&&(s=l-o.rendererWorkingSet-r.rendererWorkingSet);let d=0;const u=a.Perf_JSHeap_UsedSize;return u&&(d=u-o.jsUsedHeapSize-r.jsUsedHeapSize),{baseRendererWS:s,baseJSUsedHeapSize:d,heartbeatData:a}}class bj{constructor(e,t,n,i,a,o,r,s){this.clientStateProvider=t,this.coreSettings=n,this.rebootService=i,this.scenarioFactory=a,this.activeWindowsService=o,this.loggerFactory=r,this.authService=s,this.clientStateSubscription=null,this.configSubscription=null,this.highMemoryRestartSettings=this.coreSettings.get(c.w.Diagnostics).highMemoryRestartSettings,this.currentClientState=this.clientStateProvider.getState(),this.startTimeMS=e.startTimeMS,this.startDate=new Date(this.startTimeMS).toUTCString(),this.logger=this.loggerFactory.newLogger("highMemoryRestartService","high-memory-restart"),this.start()}start(){this.newScenario(be.Cu.HighMemoryRestartServiceStart),this.subscribeToClientStateChange(),this.subscribeToConfigSettingsChange()}stop(){this.clientStateSubscription?.unsubscribe(),this.configSubscription?.unsubscribe()}static createInstance(e,t,n,i,a,o,r,s){return bj.instance||(bj.instance=new bj(e,t,n,i,a,o,r,s)),bj.instance}destroyInstance(){bj.instance=void 0}subscribeToClientStateChange(){this.clientStateSubscription=this.clientStateProvider.observe().subscribe((e=>this.handleClientStateChange(e)))}subscribeToConfigSettingsChange(){this.configSubscription=this.coreSettings.getObservable(c.w.Diagnostics).subscribe((e=>{e.enableHighMemoryRestartService||this.stop()}))}handleClientStateChange(e){this.currentClientState=e,this.handleStateChange()}async handleStateChange(){await this.shouldRebootApp()&&(this.newScenario(be.Cu.HighMemoryRestartApp),this.rebootService.rebootApp(jp.g.HighMemory,jp.Z.ReloadAppTask))}async shouldRebootApp(){return this.currentClientState===Ba.Lg.LongInactive&&(this.isLongRunningSession()?!!await this.hasHighMemory()||(this.infoToTelemetry("App didn't reboot because memory wasn't high"),!1):(this.infoToTelemetry(`App didn't reboot because it is not a long running session yet. Start time: ${this.startDate}`),!1))}isLongRunningSession(){return(new Date).getTime()-this.startTimeMS>36e5*(this.highMemoryRestartSettings?.longRunningThresholdInHours||0)}async hasHighMemory(){return(await Cj(this.coreSettings,this.activeWindowsService,this.authService,!0)).baseRendererWS>1024*(this.highMemoryRestartSettings?.thresholdsInMB.rendererWorkingSet||0)}newScenario(e){this.scenarioFactory.newScenario(e).stop()}infoToTelemetry(e){this.coreSettings.get(c.w.Diagnostics).enableHighMemoryRestartLogger&&this.logger?.infoToTelemetry?.(e,"high_memory_restart_request")}}var wj=n(736820);const Tj=1024,Ij=1e3,Nj=6e4,Aj=36e5,Ej=864e5,Fj="memoryFeedbackService.lastDialogDate",_j="memoryFeedbackService.countOfDialogWithinDay",Dj="memoryFeedbackService.countOfDialogWithinWeek";var Pj=n(665360),Mj=n(5975);function Rj(e){return e?"#":""}function xj(e){return(e/Tj).toFixed(2)}class Lj{constructor(e,t,n,i,a,o,r,s,l,d,u){this.localStorage=e,this.entityCommanding=t,this.clientState=n,this.client=i,this.coreSettings=a,this.scenarioFactory=o,this.activeWindowsService=r,this.hostCommunicationService=s,this.profilerService=l,this.userTrackingService=d,this.authService=u,this.timeWhenLastCallEnded=-1,this.memoryFeedbackSettings={},this.enableMemoryAutoBRBDialog=!1,this.enableWatsonMemoryDumps=!1,this.triedToWriteHighMemoryEvent=!1,this.running=!1,this.shouldKeepStopped=!1,this.lastDialogDate=new Date(this.localStorage.get(Fj)||0),this.countOfDialogWithinDay=parseInt(this.localStorage.get(_j)||"0",10),this.countOfDialogWithinWeek=parseInt(this.localStorage.get(Dj)||"0",10);this.coreSettings.getObservable(c.w.Diagnostics,["memoryFeedbackSettings","enableMemoryAutoBRBDialog","enableWatsonMemoryDumps"]).subscribe((e=>{const{memoryFeedbackSettings:t,enableMemoryAutoBRBDialog:n,enableWatsonMemoryDumps:i}=e;this.enableMemoryAutoBRBDialog=n||!1,this.enableWatsonMemoryDumps=i||!1;let a=this.enableMemoryAutoBRBDialog||this.enableWatsonMemoryDumps;t&&Object.keys(t).length>0?this.memoryFeedbackSettings=t:(this.memoryFeedbackSettings={},a=!1),a?this.start():this.stop(!1)}))}start(){this.running||this.shouldKeepStopped||(this.running=!0,this.dateOfBeginingHighMemory=void 0,this.timeWhenLastCallEnded=-1,this.clientStateSubscription||this.startClientStateSubscription(),this.intervalId||(this.intervalId=(0,Un.z)().setInterval((()=>this.beat(!0)),this.memoryFeedbackSettings.verySlowSampleTime??2147483647)))}stop(e){this.shouldKeepStopped||(this.shouldKeepStopped=e),this.running&&(this.running=!1,this.intervalId&&(0,Un.z)().clearInterval(this.intervalId),this.clientStateSubscription&&this.clientStateSubscription.unsubscribe(),this.intervalId=void 0,this.clientStateSubscription=void 0)}startClientStateSubscription(){let e=this.clientState.getState();this.clientStateSubscription=this.clientState.observe().subscribe({next:t=>{e===Ba.Lg.VeryActive&&t!==Ba.Lg.VeryActive&&(this.timeWhenLastCallEnded=Date.now()),e=t}})}shouldKeepRunningForMTMA(){return!!this.coreSettings.get(c.w.Diagnostics).memorySharedSettings?.accountSizeInMB||this.userTrackingService?.getAccountMode()!==kR.J.MultipleAccounts}async beat(e){if(!this.shouldKeepRunningForMTMA())return void this.stop(!0);const t=new Date,n=await this.isMemoryHigh(t,e);if(!n.isMemoryHeavy)return;if(e)return await this.triggerGCAndWait(),this.beat(!1);const i=this.clientState.getState();if(!this.enableWatsonMemoryDumps||i!==Ba.Lg.Inactive&&i!==Ba.Lg.LongInactive){if(this.enableWatsonMemoryDumps&&!this.triedToWriteHighMemoryEvent||!this.enableMemoryAutoBRBDialog||this.hasReachedDialogLimit(t)||i!==Ba.Lg.Active)return;this.openBrbDialog(n.memoryDetailMessage),this.newScenario(be.Cu.MemoryFeedbackDialogOpen)}else{this.triedToWriteHighMemoryEvent=!0;const e=await this.hostCommunicationService.loadModule("etw"),t=await(e?.writeHighMemoryEvent?.());if(this.newScenario(be.Cu.MemoryFeedbackHighMemoryMark,t),t?.result!==wj.Q.ok)return}this.stop(!0),this.dateOfBeginingHighMemory=void 0,this.localStorage.set(_j,(this.countOfDialogWithinDay+1).toString(),"Fundamentals"),this.localStorage.set(Dj,(this.countOfDialogWithinWeek+1).toString(),"Fundamentals"),this.localStorage.set(Fj,t.toISOString(),"Fundamentals")}openBrbDialog(e){this.entityCommanding.brbFeedback.autoBrbConfirmationDialog({visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:A.p.AutoBrb}},{feedbackText:`Detected high memory usage. ${e}`,feedbackSelectedCategory:"79",includeHeapSnapshot:!0,brbContext:Uh.d.HighMemoryUsage})}async isMemoryHigh(e,t){const{isMemoryHeavy:n,memoryDetailMessage:i,hasExtraRenderer:a}=await this.getMemoryUsageData(t),o=this.activeWindowsService.getStandardMainWindow();if(!o?.isMainWindow)return{hasExtraRenderer:a,isMemoryHeavy:!1};const r=this.clientState.getState();if(!n||r===Ba.Lg.VeryActive||this.wasInCallRecently(e))return this.dateOfBeginingHighMemory=void 0,{hasExtraRenderer:a,isMemoryHeavy:!1};this.dateOfBeginingHighMemory=this.dateOfBeginingHighMemory||e;return e.getTime()-this.dateOfBeginingHighMemory.getTime()<(this.memoryFeedbackSettings.durationInMinuteOfConsecutiveHighMemoryState??Number.MAX_SAFE_INTEGER)*Nj?{hasExtraRenderer:a,isMemoryHeavy:!1}:{hasExtraRenderer:a,isMemoryHeavy:n,memoryDetailMessage:i}}async getMemoryUsageData(e){const t=await this.getThresholds(),n=[];let i=!1;const a=await Cj(this.coreSettings,this.activeWindowsService,this.authService,e),o=a.heartbeatData?.Perf_MainRenderer_WorkingSet||0,r=a.baseRendererWS>(t.rendererWorkingSet??Number.MAX_SAFE_INTEGER)*Tj;i=i||r,n.push(`${Rj(r)}RWS: ${xj(o)} MB`);const s=a.heartbeatData?.Perf_JSHeap_UsedSize||0,l=a.baseJSUsedHeapSize>(t.jsUsedHeapSize??Number.MAX_SAFE_INTEGER)*Tj;i=i||l,n.push(`${Rj(l)}JSH: ${xj(s)} MB`),n.push(`base RWS: ${xj(a.baseRendererWS)} MB`);return{isMemoryHeavy:i,memoryDetailMessage:n.join(", "),hasExtraRenderer:!0===a.heartbeatData?.hasExtraRenderer}}hasReachedDialogLimit(e){const t=e.getTime()-this.lastDialogDate.getTime();return t<(this.memoryFeedbackSettings.gapInHourBetweenFeedbackDialogs??Number.MAX_SAFE_INTEGER)*Aj||(t>Ej&&this.resetDialogDayCount(),this.countOfDialogWithinDay>=(this.memoryFeedbackSettings.limitOfFeedbackDialogsWithinDay??0)||(t>7*Ej&&this.resetDialogWeekCount(),this.countOfDialogWithinWeek>=(this.memoryFeedbackSettings.limitOfFeedbackDialogsWithinWeek??0)))}wasInCallRecently(e){const t=(this.memoryFeedbackSettings.minimumSecondsPassedSinceLastCall??Number.MAX_SAFE_INTEGER)*Ij;return e.getTime()-this.timeWhenLastCallEnded<t}async triggerGCAndWait(){await(this.profilerService?.requestTriggerGC()),await(0,kh.y)(this.memoryFeedbackSettings.delayInMsAfterGC??0)}newScenario(e,t){this.scenarioFactory.newScenario(e).stop(t)}async getThresholds(){const e=await this.fetchSimpleCollabViewType();return(e&&e!==Pj.LS.none?this.memoryFeedbackSettings.thresholdsInMBForSimpleCollab:void 0)??this.memoryFeedbackSettings.thresholdsInMB??{}}async fetchSimpleCollabViewType(){const{enableSimpleCollabApp:e,enableSimpleCollabAppToggle:t,enableSimpleCollabAppSplitView:n}=this.coreSettings.get(c.w.SimpleCollab);let i;if(e&&t){let a={};try{const{data:e}=await this.client.query({query:Mj.W,fetchPolicy:"cache-only"}),t=e?.userPreferencesForSimpleCollab;t&&"simpleCollabUserSettings"in t&&t.simpleCollabUserSettings&&(a=t.simpleCollabUserSettings)}catch{a={}}finally{i=(0,Pj.Dt)(!!e,!!t,!!n,a)}}return i}resetDialogDayCount(){this.localStorage.set(_j,"0","Fundamentals")}resetDialogWeekCount(){this.localStorage.set(Dj,"0","Fundamentals")}}var Oj,jj=n(584729);!function(e){e.Supported="Supported",e.Unsupported="Unsupported",e.Unknown="Unknown"}(Oj||(Oj={}));function Bj(e){return e.split(".").slice(-2).join(".")}class Uj{constructor(e,t,n,i){this.scenarioFactory=n,this.windowProvider=i,this.detectionAttempts=0,this.scenario=n.newScenario(be.Cu.DetectThirdPartyCookieSupport);const{enableThirdPartyCookiesDetection:a,enableThirdPartyCookiesDetectionAsEmbed:o,thirdPartyCookiesDetectionOriginOverride:r}=t.get(c.w.Core,["enableThirdPartyCookiesDetection","enableThirdPartyCookiesDetectionAsEmbed","thirdPartyCookiesDetectionOriginOverride"]);this.enabled=Boolean(a),this.detectionAsEmbedEnabled=Boolean(o),this.detectionMode=this.detectionAsEmbedEnabled?"Embed":"TopLevelDomain";const{staticsPath:s,buildType:l,buildVersion:d}=t.get(c.w.Platform,["staticsPath","buildType","buildVersion"]);this.cdnConfig={experienceName:e,staticsOrigin:s||void 0,overrideOrigin:r||void 0,buildType:l||void 0,version:d||void 0}}async detect(e){if(!this.enabled)return this.returnError("enableThirdPartyCookiesDetection is disabled");this.scenario.mark("attempting_detection");const t=this.detectionAsEmbedEnabled?await this.attemptDetectionAsEmbed():await this.attemptDetectionAsTopLevelDomain();if(this.cleanup(),"result"in t)return this.returnSuccess(t.result);const{error:n,retriable:i,url:a}=t;return!e&&i&&this.detectionAttempts<3?this.detect(e):this.returnError(n,a)}async attemptDetectionAsTopLevelDomain(){this.detectionAttempts+=1;const e=5e3*this.detectionAttempts;try{const t=function(e,t){const{experienceName:n,staticsOrigin:i,buildType:a,version:o,overrideOrigin:r}=t;let s;const l=r||i;switch(a){case"production":if(!l||!o)break;s=`${l}/teams-modular-packages/${n}/${o}/`;break;case"container":s=e.__webpack_public_path__;break;case"local":s="https://local.third-party-cookie-service.office.net/v2/";break;default:throw new Error("Unsupported build type")}if(!s)throw new Error("CDN path not found");if(Bj(new URL(s).host)===Bj(e.location.host))throw new Error("CDN domain and client domain are the same");return`${s}report-third-party-cookies.html`}(this.windowProvider,this.cdnConfig),n=this.windowProvider.document.createElement("iframe");n.setAttribute("style","display: none;"),n.setAttribute("src",t),this.iframe=n,this.scenario.mark("iframe_created");const i=new Promise((n=>{this.detectionTimeoutRef=this.windowProvider.setTimeout((()=>{n({error:`Timeout of ${e} exceeded`,url:t,retriable:!0})}),e)})),a=new Promise((e=>{this.messageHandler=t=>{const n=this.handlePostMessage(t);n&&e({result:n})},this.windowProvider.addEventListener("message",this.messageHandler)})),o=new Promise((e=>{n.addEventListener("error",(n=>{e({error:n.message,url:t})}))}));return this.windowProvider.document.body.appendChild(this.iframe),Promise.race([i,a,o])}catch(e){return Promise.resolve({error:e.message})}}async attemptDetectionAsEmbed(){try{const e="teams_3p_test_cookie",t=`${e}=true`;this.windowProvider.document.cookie=`${t}; Max-Age=3600; SameSite=None; Secure`;return new RegExp(t,"g").test(this.windowProvider.document.cookie)?(this.windowProvider.document.cookie=`${e}=; Expires=Thu, 01 Jan 1970 00:00:01 GMT; SameSite=None; Secure`,Promise.resolve({result:Oj.Supported})):Promise.resolve({result:Oj.Unsupported})}catch(e){return Promise.resolve({error:e.message})}}handlePostMessage({data:e}){const{third_party_cookies_allowed:t}=e;if(void 0===t)return;this.scenario.mark("iframe_message_received");return Boolean(t)?Oj.Supported:Oj.Unsupported}async returnSuccess(e){return this.scenarioFactory.setContext?.({"Browser.ThirdPartyCookieSupport":e}),this.scenario.stop({third_party_cookie_support:e,detectionMode:this.detectionMode}),Promise.resolve(e)}async returnError(e,t){return this.scenario.fail({error:`${e}. Attempts made: ${this.detectionAttempts}`,url:t,third_party_cookie_support:Oj.Unknown,detectionMode:this.detectionMode}),Promise.resolve(Oj.Unknown)}cleanup(){this.iframe&&(this.windowProvider.document.body.removeChild(this.iframe),this.iframe=void 0),this.messageHandler&&(this.windowProvider.removeEventListener("message",this.messageHandler),this.messageHandler=void 0),this.detectionTimeoutRef&&(this.windowProvider.clearTimeout(this.detectionTimeoutRef),this.detectionTimeoutRef=void 0)}}var $j=n(929024);const Wj=async e=>{const t=await e.loadModule("core");t?.reportExperienceWarm&&t.reportExperienceWarm()},Vj=e=>`tmp.${e}.experience-loader-ecs-flags`,Hj=()=>{const e=Vj(globalThis.loaderConfig.experienceName),t=globalThis.localStorage.getItem(e);return t?JSON.parse(t):void 0},zj=e=>{const t=Vj(globalThis.loaderConfig.experienceName);globalThis.localStorage.setItem(t,JSON.stringify(e))},qj=(e,t)=>{try{const t=Hj()||{};return!!Gj(t,e)&&(zj(e),!0)}catch(n){return t.error(`SetExperienceLoaderSettings - Failed to get experience loader settings in local storage: ${n}`),zj(e),!1}},Gj=(e,t)=>{for(const n of Object.keys(e)){const i=e[n],a=t[n];if(i!==a&&(!1!==i||void 0!==a))return!0}for(const n of Object.keys(t)){const i=e[n],a=t[n];if(void 0===i&&void 0!==a&&!1!==a)return!0}return!1};var Yj;!function(e){e.LifeCycleScopeChange="LifeCycleScopeChange"}(Yj||(Yj={}));class Qj extends xp{constructor(){super(d.c1.CreateLifeCycleTask,["activeWindowsService","appsRegistryService","authenticationService","client","clientState","config","coreSecurityService","coreSettings","coreSettingsContext","coreUtilities","entityCommanding","experienceChangeReportingService","hostCommunicationService","i18n","i18NextWrapper","lifeCycleScopeChangeReportingService","localStorage","loggerFactory","networkState","platformService","rebootService","scenarioFactory","schedulerChangeReporting","userBiService","windowProvider","scheduler","notificationsHandler","logsCollectorService","eventing"]),this.createCoreApplication=(e,t,n,i,a,o)=>({manifest:{name:"CoreTasks",id:"com.microsoft.teams.corescheduling"},onExperienceWarm:i=>[{id:"settings-ecs-fetch",job:()=>t.fetchEcsSettingsIfApplicable()},{id:"memory-feedback-service-start",job:()=>{const{context:{authenticationService:e,client:t,clientState:n,coreSettings:o,entityCommanding:r,localStorage:s,profilerService:l,scenarioFactory:c,userTrackingService:d,hostCommunicationService:u}}=i;s&&new Lj(s,r,n,t,o,c,a,u,l,d,e)}},{id:"init-diagnostics-idb-job",job:()=>{const{context:{loggerFactory:e}}=i;"notifyDiagnosticsALTDone"in e&&e.notifyDiagnosticsALTDone()}},{id:"clear-t2-web-boot-attempts-counter",job:()=>{const{context:{coreSettings:e,loggerFactory:t,localStorage:n}}=i;if(!e.get(c.w.Core).enableClearT2WebBootAttempts)return;const a="clear_t2_web_boot_attempts_failure",o=t.newLogger("ClearWebBootAttemptsLogger","clear-t2-web-boot-attempts-counter");if(!n)return void o.errorToTelemetry?.("Local storage unavailable",a,void 0,!0);const r="numT2WebBootAttempts",s="t2WebOptInSessionId";n.remove(r,"Global"),n.remove(s,"Global"),n.remove("lastT2WebBootAttemptRecordTime","Global"),n.get(r,"Global")||n.get(s,"Global")?o.errorToTelemetry?.("Failed to remove web boot/opt-in keys from local storage",a,void 0,!0):o.warnToTelemetry?.("Successfully removed web boot/opt-in keys from local storage","clear_t2_web_boot_attempts_success",void 0,!0)}},{id:"detect-third-party-cookie-support-job",runOncePerId:!0,job:async()=>{const{scenarioFactory:e,windowProvider:n,coreSettings:a,config:o,platformService:r}=i.context,s=await function(e,t,n,i,a,o=!1){return t!==nt.PU.Web&&t!==nt.PU.SttOutlookWeb?Promise.resolve(Oj.Unknown):new Uj(e,n,i,a).detect(o)}(o.experienceName,r.config.platformId,a,e,n);t.updatePlatformProviderSettings({thirdPartyCookieSupport:s})}},{id:"notify-desktop-experience-warm-job",job:()=>(async(e,t)=>{const{context:{coreSettings:n,hostCommunicationService:i,scenarioFactory:a,loggerFactory:o}}=e,r=o.newLogger("NotifyDesktopExperienceWarmJob","notify-desktop-experience-warm-job");r.log("Start");const s=a.newScenario(be.Cu.NotifyDesktopOnExperienceWarm),{enableUserDataFetchForSilentLaunch:l}=n.get(c.w.Core),{launchIntent:d}=n.get(c.w.HostCapabilities);if(!l||"LaunchCoreNoSystemTray"!==d){const e=`ReportingDesktopExperienceWarm: enableUserDataFetchForSilentLaunch: ${l}, launchIntent: ${d}`;return r.log(e),s.stop({reason:e}),void await Wj(i)}if(await _S(t)){const e="SkippingReportingDesktopExperienceWarm: PrimaryUserFound";r.log(e),s.stop({reason:e},"abandoned")}else{const e="ReportingDesktopExperienceWarm: PrimaryUserUndefined";r.log(e),s.stop({reason:e}),await Wj(i)}})(i,e)},Kj(i,n),Zj(i,a),{id:"initialize-user-activity-recall-service",job:()=>{o&&o.initialize()}},{id:"reset-client-start-failure-count",job:()=>{const{windowProvider:e}=i.context;!function(e,t){const n=Sj(e,t);e.localStorage.removeItem(n)}(e)}}],onPreWarm:n=>[{id:"maglev-provider-host-settings",job:()=>{const{context:{coreSettings:e}}=n;e.get(c.w.Core).enableMaglevHostPostAltSettings&&t.initializeMaglevHostProviderPostAltSettings(i)}},{id:"active-windows-history-job",job:()=>{const{context:{activeWindowsHistoryService:e}}=n;if(e)return e.initialize(),t=>{e.cleanup(t)}}},Xj(n),{id:"start-local-migrated-settings-timer-job",job:()=>{const{context:{localMigratedSettings:e}}=n;e&&e.startTimer()}},{id:"notify-desktop-experience-warm-for-user-job",job:()=>(async(e,t)=>{const{context:{authenticationUser:n,coreSettings:i,client:a,hostCommunicationService:o,scenarioFactory:r,loggerFactory:s}}=e,l=s.newLogger("NotifyDesktopExperienceWarmForUserJob","notify-desktop-experience-warm-for-user-job"),d=r.newScenario(be.Cu.NotifyDesktopOnPrimaryUserWarm);l.log("Start");const{enableUserDataFetchForSilentLaunch:u}=i.get(c.w.Core),{launchIntent:m}=i.get(c.w.HostCapabilities);if(!u||"LaunchCoreNoSystemTray"!==m){const e=`SkippingReportingDesktopExperienceWarm: enableUserDataFetchForSilentLaunch: ${u}, launchIntent: ${m}`;return l.log(e),void d.stop({reason:e},"abandoned")}if(!await FS(t,n)){const e="SkippingReportingDesktopExperienceWarm: CurrentUserNotPrimary";return l.log(e),void d.stop({reason:e},"abandoned")}try{l.log("ChatListQueryStart"),d.mark(be.BQ.ChatListQueryStart);const{data:e}=await a.query({query:$j.K,variables:{includePinnedChats:!0,includeSuggestedContacts:!1}}),t=`ChatListQueryEnd[${e?.recentsChats?.edges?.length}]`;l.log(t),d.mark(be.BQ.ChatListQueryEnd,{reason:t})}catch(e){l.error("ChatListQueryFail",e),d.mark(be.BQ.ChatListQueryEnd,{error:e})}l.log("Stop"),d.stop(),await Wj(o)})(n,e)}],onIdle:e=>[Jj(e)]})}async execute(e){const t=e.config,n=e.coreSettings,i=e.coreSettingsContext,a=e.clientAccessAdminPolicyCheckService,o=e.entityCommanding,r=e.experienceChangeReportingService,s=e.floodgateService,l=e.hostCommunicationService,d=e.i18n,u=e.lifeCycleScopeChangeReportingService,m=e.loggerFactory,p=e.networkState,g=e.platformService,h=e.scenarioFactory,v=e.schedulerChangeReporting,y=e.userBiService,S=e.clientState,f=e.localStorage,k=e.i18NextWrapper,C=e.windowProvider,b=e.rebootService,w=e.coreSecurityService,T=e.scheduler,I=e.notificationsHandler,N=e.authenticationService,A=e.activeWindowsService,E=e.logsCollectorService,F=e.eventing,_=e.delegatedCommanding,D=e.userActivityRecallService,P=e.activeWindowsService?.getWindowLayoutService().preCacheManager;new ij(v,h,m).init();const{isEntityInView:M}=e.coreUtilities,{enableExperienceLifeCycleManagerV2:R}=n.get(c.w.Core),x=new(R?cj:hj)(T,r,{authenticationService:N,client:e.client,clientAccessAdminPolicyCheckService:a,clientState:S,config:t,coreSecurityService:w,coreSettings:n,delegatedCommanding:_,entityCommanding:o,eventing:F,hostCommunicationService:l,i18n:d,i18NextWrapper:k,isEntityInView:M,localStorage:f,loggerFactory:m,logsCollectorService:E,networkState:p,notificationsHandler:I,platformService:g,preCacheManager:P,rebootService:b,scenarioFactory:h,windowProvider:C,floodgateService:s},u,m,t.lifeCycleJobPermissions);return x.init(),e.appsRegistryService.registeredApps.forEach((e=>x.manageApplication(e))),x.manageApplication(this.createCoreApplication(N,i,y,l,A,D)),e.scheduler=T,e.experienceLifecycleManager=x,async e=>{switch(e){case"quit":case"signout":await x.destroy(e);break;default:return}}}}function Jj(e){return{id:"subscribe-to-experience-loader-settings-job",job:()=>{const{context:{coreSettings:t,rebootService:n,windowProvider:i,loggerFactory:a}}=e;if(!i.loaderConfig)return;const o=a.newLogger("SubscribeToExperienceLoaderSettingsJob","subscribe-to-experience-loader-settings-job"),r=t.getObservable(c.w.ExperienceLoader,["enableChunkedWorker","disableRebootOnExperienceLoaderSettingsChanged"]).subscribe({next:e=>{const t={enableChunkedWorker:!!e.enableChunkedWorker},i=qj(t,o),a=e.disableRebootOnExperienceLoaderSettingsChanged;i&&!a&&n.rebootWhenLongInactive(jp.g.ExperienceLoaderSettingsUpdate,jp.Z.ExperienceLoaderSettingsUpdate)}});return e=>{switch(e){case"quit":case"signout":case"restart":r.unsubscribe()}}}}}const Kj=(e,t)=>({id:"cleanup-t1-desktop-job",runOncePerId:!0,job:()=>{const{context:{clientAccessAdminPolicyCheckService:n,hostCommunicationService:i,loggerFactory:a}}=e,o=a.newLogger("CleanupT1DesktopJob","cleanup-t1-desktop-job");if(n){const e=n.shouldUserAttemptT1Cleanup().subscribe((async e=>{if(e){const e=await i.loadModule("appswitcher");if(e?.uninstallT1App){o.log("PIE: uninstallT1App");try{await e.uninstallT1App(),t.recordPanelAction({panelType:"OpenApplication",actionScenario:"UninstallT1App",actionOutcomeNew:"T1AppUninstalled",actionGesture:"auto"})}catch(e){t.recordPanelAction({panelType:"OpenApplication",actionScenario:"UninstallT1App",actionOutcomeNew:"T1AppUninstallFailed",actionGesture:"auto"})}}}}));return()=>{e.unsubscribe()}}return()=>{}}}),Zj=(e,t)=>({id:"high-memory-restart-service",runOncePerId:!0,job:()=>{const{context:{authenticationService:n,clientState:i,config:a,coreSettings:o,loggerFactory:r,rebootService:s,scenarioFactory:l}}=e;o.get(c.w.Diagnostics).enableHighMemoryRestartService&&o.get(c.w.Diagnostics).highMemoryRestartSettings&&bj.createInstance(a,i,o,s,l,t,r,n)}}),Xj=e=>({id:"initialize-office-integration-service",job:()=>{const{coreSettings:t,client:n,hostCommunicationService:i,loggerFactory:a,entityCommanding:o,authenticationUser:r,localStorage:s,windowProvider:l}=e.context,{launchIntent:d}=t.get(c.w.HostCapabilities);t.get(c.w.People).enableOfficeIntegration&&r?.role!==pg.a7.Anonymous&&"LaunchCoreNoSystemTray"!==d&&jj.Q.Instance(i,t,n,a,o,l,s,r).initialize()}});class eB{constructor(e){this.localStorage=e,this.logsProviderName="LocalStorageLogsProvider"}getLogsFiles(){const e=this.localStorage,t=e.calculateUsageStats?.(),n=e.getUsageMetadataStats?.(),i=t?JSON.stringify({userData:{...t.User,...t.UserAndExperience,otherTMP:Object.values({...t.Global,...t.Experience}).reduce(((e,t)=>e+t),0),nonTMP:Object.values(t.Unmanaged??{}).reduce(((e,t)=>e+t),0)},usageMetadata:n}):n?JSON.stringify({usageMetadata:n}):"";return Promise.resolve([{fileName:"local-storage-usage.json",content:i,isPiiFree:!1}])}}const tB=["TflFreProfileCardDisplayed","newTeamsOnlyEffectivePolicyStartTime",n(288952).s6],nB=["isOptedIntoT2Web","policy-cache","previousSessionErrorLogs-Core","previousSessionLogs-Core","desktopTheme"],iB=["loaderDiagnostics","local-user-preferences","previousLoaderDiagnostics"];class aB extends xp{constructor(){super(d.c1.CreateLocalStorage,["authenticationUser","config","coreSettings","loggerFactory","logsCollectorService","windowProvider"])}async execute(e){const{authenticationUser:t,config:n,coreSettings:i,windowProvider:a,loggerFactory:o}=e,r=new bx(t.profile.tenantId,t.profile.objectId,n.experienceName,a,o);r.subscribeToCoreSettings(i);let s;!!i.get(c.w.Core).disableLocalStorageLogsProvider||(s=new eB(r),e.logsCollectorService.registerUserLogsProvider(t.profile.objectId,s));const l=o.newLogger("CreateLocalStorage","core-services-tasks"),d=(0,kt.Lw)(t);return e.localStorage=r,async n=>{if("signout"===n){const e=await function(e,t,n){const i={},a=[...iB,...(0,EP.E)(n)];try{tB.forEach((t=>{const n=e.get(t,"UserAndExperience");n&&(i[t]=n)})),e.clear(["UserAndExperience","User"]),a.map((t=>e.remove(t,"Experience"))),nB.map((t=>e.remove(t,"Global")))}catch(e){t.warn(`Failed to clear local storage! ${e}`)}return i}(r,l,d);e&&function(e,t,n){const i=Object.keys(t);try{i.forEach((n=>{e.set(n,t[n],"Framework","UserAndExperience")}))}catch(e){n.warn(`Failed to restore local storage values for ${i}: ${e}!`)}}(r,e,l)}switch(n){case"quit":case"signout":s&&e.logsCollectorService.unregisterUserLogsProvider(t.profile.objectId,s.logsProviderName);new wR(r).clear(),r.dispose();break;default:return}}}}const oB={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataCustomNotificationsRemoveWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},rB={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataCustomNotificationsCreateWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};function sB(e,t){return new Notification(e,t)}function lB(){return Notification.permission}var cB=n(334644);const dB="CN:",uB="BrowserNotifications:",mB=[be.BQ.CallingNotificationRenderComplete,be.BQ.MsnMeetingNotificationRenderComplete,be.BQ.MeetingNudgeNotificationRenderComplete,be.BQ.NormalNotificationRenderComplete,be.BQ.ToastRenderCancelled,be.BQ.NotificationRenderUpdate];class pB{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p){this.activeWindowsService=e,this.waitForRenderingContextReady=t,this.hostCommunicationService=n,this.authenticationService=i,this.coreSettings=a,this.commandChangeReportingService=o,this.mainWindow=r,this.scenarioFactory=s,this.appsRegistryService=l,this.userBiService=c,this.platformService=d,this.clientPreferences=u,this.activateBrowserToast=async e=>{this.mainWindow.focus();const t=e,n={entity:{type:ke.ck.toasts,action:ke.SY.confirm},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:A.p.NotificationsActivation,startTimestamp:Date.now(),scenarioName:be.Cu.ToastActivation,id:(0,E.v4)()}},entityOptions:t},i=e.targetEntity.dataOptions?.userContextId;if(!i)return void this.logger.errorToTelemetry?.(`${uB} Error activating browser toast. UserContextId is missing from notifications entity command dataOptions.\n      Therefore, the user rendering context to use to activate this notification cannot be determined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0);this.startToastActivationScenario(n,{isBrowserNotification:!0});const a=await this.waitForRenderingContextReady(!1,i,this.coreSettings);await a.commandHandler(n)},this.logger=m.newLogger("NotificationsHandler","core-services-notifications"),this.i18n=p,this.notificationsWindowId=void 0,this.notificationsWindow=void 0,this.isWindowInInitState=!1,this.isResettingWindow=!1}async activateNotification(e){try{this.sendUserBiActivation(e);const{command:t,dataOptions:n}=e;if(this.startToastActivationScenario(e),!n||!n.userContextId)return void this.logger.errorToTelemetry?.(`${dB}Error activating notification. UserContextId is missing from notifications entity command dataOptions.\n      Therefore, the user rendering context to use to activate this notification cannot be determined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0);const{actionType:i,callId:a,callingScenarioName:o}=n,r=await this.overrideUserToHomeAccountIfRequired(e);this.sendTelemetry({callId:a,callingScenarioName:o,toastScenarioClientId:t.correlation.id,stepName:gB(i)});const s=this.waitForRenderingContextReady(!1,r,this.coreSettings),l=await s;return await _L({activeWindowsService:this.activeWindowsService,coreSettings:this.coreSettings,renderingContext:l,isHostCommandNotification:!0,handlerCommand:e,logger:this.logger,notificationUserContextId:r,appsRegistryService:this.appsRegistryService,logPrefix:dB}),this.addStepToToastActivationScenario(e),l.commandHandler(e)}catch(e){return void this.logger.errorToTelemetry?.(`${dB}Errored while activating notification:${e.message}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}}async resizeNotificationsWindow({windowFeatures:e}){if(this.notificationsWindowId&&this.notificationsWindow&&e){const{width:t,height:n}=e;this.logger.log(`${dB}Attempting to resize the notifications window to width= ${t} height= ${n}. windowId= ${this.notificationsWindowId}`);const{enableCustomNotificationsWindowReset:i}=this.coreSettings.get(c.w.Core);0!==t&&0!==n?this.isWindowInInitState=!1:0!==t||0!==n||this.isWindowInInitState||this.isResettingWindow||!i||(this.isResettingWindow=!0,await this.removeNotificationsWindow(),await this.createNotificationsWindow(),this.isResettingWindow=!1);const a=await(this.hostCommunicationService?.loadModule("toasts"));a?.resizeNotificationsPanel?.(t,n)}else this.logger.errorToTelemetry?.(`${dB}Error resizing the notifications window. notificationsWindowId = ${this.notificationsWindowId} windowFeatures width=${e?.width}; height=${e?.height}. window=${void 0!==this.notificationsWindow?"defined":"undefined"}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}async focusNotificationsWindow(){try{const e=await(this.hostCommunicationService?.loadModule("windowcontrols"));this.notificationsWindowId?e?.focus?.(this.notificationsWindowId):this.logger.errorToTelemetry?.(`${dB}Error focusing the notifications window. notificationsWindowId is undefined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}catch(e){this.logger.errorToTelemetry?.(`${dB}Error focusing the notifications window. Loading windowcontrols module failed with: ${e.message}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}}isInAppNotificationsEnabled(e){const{enableInAppNotifications:t,enableInAppNotificationsForCalls:n,enableInAppNotificationsForChatsAndChannels:i}=this.coreSettings.get(c.w.Notifications);return!!t&&this.isToastEntitySupported(!!n,!!i,e)}isCustomNotificationsEnabled(e){const{enableCustomNotificationsOnDesktop:t,enableCustomNotificationsForCalls:n,enableCustomNotificationsForChats:i}=this.coreSettings.get(c.w.Core);return!!t&&this.isToastEntitySupported(!!n,!!i,e)}initializeWithWindow(e,t,n){this.logger.log(`${dB}Initializing notifications handler with notifications windowId=${e}`),this.notificationsWindowId=e,this.notificationsWindow=t,this.client=n,this.isWindowInInitState=!0}sendCommandToHost(e,t,n,i){let a="";a=(0,ge.hR)(i?.targetEntity?.dataOptions),this.logger.log(`${dB}Sending toast command to host for display. TargetEntity type: [${i?.targetEntity?.type}] action [${i?.targetEntity?.action}] dataOptions [${a}]`),this.commandChangeReportingService.report({correlationId:t,type:p.I.ContinueHandlingAtHost,context:{target:"notificationsHandler",entityCommand:{entity:n,command:{...e,correlation:e.correlation,layoutMode:e.layoutMode||void 0},entityOptions:i}}})}showPermissionConfirmationBrowserNotification(){sB(this.i18n.stringTranslate("toastNotifications","browser_toast_permission_confirmation_title"),{body:this.i18n.stringTranslate("toastNotifications","browser_toast_permission_confirmation_body")})}async tryShowBrowserNotification(e){if(!("granted"===lB())||!this.isOutOfTabLocalSettingEnabled())return"skippedNoPermissions";const{suppressBrowserToastWhenAppIsFocused:t}=this.coreSettings.get(c.w.Notifications,["suppressBrowserToastWhenAppIsFocused"]);if(t&&hB(this.mainWindow))return"skippedAppInFocus";const n=e.getWebToastOptions(),{notificationTitle:i,notificationOptions:a}=e.getNotificationOptionsPayload();try{const t=sB(i,a),o=()=>t;return e.registerGetNotificationCallback(o),t?.addEventListener("click",(async()=>{this.addBrowserNotificationScenarioStep(n,be.BQ.BrowserToastActivated),await this.activateBrowserToast(n)})),this.addBrowserNotificationScenarioStep(n,be.BQ.BrowserToastRequested),Promise.resolve("queued")}catch(e){return this.logger.errorToTelemetry?.(`${uB} Show browser notification toast failed.`,"webclient_framework_foundation_core_services_notifications",void 0,!0),Promise.resolve("skippedReasonUnknown")}}sendTelemetry(e){const{callId:t,callingScenarioName:n,reason:i,stepName:a,toastScenarioClientId:o}=e,r=t||"",s=this.scenarioFactory.findScenarioByNameAndId(n,r),l=this.scenarioFactory.findScenarioByNameAndId(be.Cu.WebToastShow,o),c=this.scenarioFactory.findScenarioByNameAndId(be.Cu.CrossClientToastView,o);s?.mark(a),l?.mark(a),c?.mark(a),mB.includes(a)&&(l?.stop({reason:i}),c?.stop({reason:i}),s&&[be.Cu.MeetingStartedNotification,be.Cu.MeetingStartedNotificationFromChatSvc].includes(s.name)&&s.stop())}sendDismissToastTelemetry({correlationId:e,toastType:t,reason:n}){const i=this.scenarioFactory.newScenario(be.Cu.ToastActivation,{clientId:e});i.appendEventData({isCustomNotification:!0,mainEntityType:t}),i.stop({reason:n}),((e,t,n,i)=>{if(!e)return void t.error("coreServicesEntityCommanding: UserBiService is not available.");const a=e.createDatabag?.();a&&(a.isCustomNotification=Boolean(i));const o=[SL.Ck.MeetingNudge,SL.Ck.Calling].includes(n)?GR.HP.callingToast:GR.HP.chatToast;e.recordPanelAction({actionGesture:GR.Od.click,panelRegion:GR.rP.toast,actionScenario:GR.vB.dismissToast,panelType:o,dataBag:a}),a?.dispose()})(this.userBiService,this.logger,t)}offsetNotificationsWindow(e){this.hostCommunicationService?.loadModule("toasts").then((t=>{if(t){if(t.offsetNotificationsPanel)return t.offsetNotificationsPanel(e);this.logger.errorToTelemetry?.(`${dB}toasts.offsetNotificationsPanel method not available`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}else this.logger.errorToTelemetry?.(`${dB}Cannot load toasts module to offset the notifications window. updating windows cache with newly created notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)}))}isOutOfTabFeatureEnabled(){const{enableOutOfTabNotificationSetting:e}=this.coreSettings.get(c.w.Notifications),t=(0,cB.O$)(this.platformService,this.logger);return!(!e||!t)||(e&&this.logger.warn("Out of tab setting is not supported for this browser version."),!1)}isOutOfTabLocalSettingEnabled(){if(!this.isOutOfTabFeatureEnabled())return this.logger.log("'Out of tab setting' feature is not enabled for the user, so the local value is ignored. The display will be based on the browser setting"),!0;const e=this.clientPreferences?.getPreferences("outOfTabNotifications")?.allowOutOfTabNotifications;return void 0===e?(this.logger.errorToTelemetry?.("Out of tab notification setting is missing in client preferences, returning setting as enabled","app_notifications_out_of_tab_setting_error",void 0,!0),!0):(this.logger.log(`Out of tab notification setting is ${e}, browser setting is ${lB()}`),e)}sendUserBiActivation(e){CL(this.userBiService,this.logger,e,!0)}addStepToToastActivationScenario(e){const t=this.scenarioFactory.findScenarioByNameAndId(be.Cu.ToastActivation,e.command.correlation.id);if(t){const n=e.command.stateTransition===g.Ar.new?be.BQ.StateTransitionNotOverriden:be.BQ.StateTransitionOverriden;t.mark(n)}}startToastActivationScenario(e,t={}){const{command:n}=e,{isBrowserNotification:i}=t,a=n.correlation.startTimestamp?+n.correlation.startTimestamp:void 0;(this.scenarioFactory.findScenarioByNameAndId(be.Cu.ToastActivation,n.correlation?.id)||this.scenarioFactory.newScenario(be.Cu.ToastActivation,{startTime:a,clientId:n.correlation.id})).appendEventData({isCustomNotification:!0,mainEntityType:e.entity.type,isBrowserNotification:i})}addBrowserNotificationScenarioStep(e,t){const{crossClientScenarioName:n}=e,i=e.callId||"",a=this.scenarioFactory.findScenarioByNameAndId(n,i);a?.mark(t)}async overrideUserToHomeAccountIfRequired(e){const{command:t,dataOptions:n,entity:i}=e,{userContextId:a,actionType:o,callId:r,callingScenarioName:s}=n,{enableExternalUserForMeetingByDefault:l}=this.coreSettings.get(c.w.Auth);if(!l||"JoinMeetingFromToast"!==o||"calls"!==i.type)return a;const{id:d,source:u}=e.command.correlation,m={id:d,source:u},p=await(this.authenticationService.getCachedUsers?.(m))??[],g=p.find((e=>e.id===a));if(!g||g.profile.isHomeAccount)return a;const h=p.find((e=>e.id===g?.homeAccountId));return h?(this.sendTelemetry({callId:r,callingScenarioName:s,toastScenarioClientId:t.correlation.id,stepName:"UserOverriddenByHomeAccount"}),h.id):a}async removeNotificationsWindow(){this.notificationsWindow&&this.client&&(this.notificationsWindow?.close(),await this.client.mutate({mutation:oB,fetchPolicy:"no-cache"}),this.notificationsWindowId=void 0,this.notificationsWindow=void 0,this.isWindowInInitState=!1)}async createNotificationsWindow(){!this.notificationsWindow&&this.client&&await this.client.mutate({mutation:rB,fetchPolicy:"no-cache"})}isToastEntitySupported(e,t,n){return n?.targetEntity?.type===Ot.w$.calls?e:t}}const gB=e=>{switch(e){case"AcceptIncomingCallContentOnly":return be.BQ.AcceptIncomingCallContentOnly;case"AcceptIncomingCallWithAudio":return be.BQ.AcceptIncomingCallWithAudio;case"AcceptIncomingCallWithVideo":return be.BQ.AcceptIncomingCallWithVideo;case"AcceptIncomingCallThroughPrejoin":return be.BQ.AcceptIncomingCallThroughPrejoin;case"AcceptIncomingScreenshareOnlyCall":return be.BQ.AcceptIncomingScreenshareOnlyCall;case"IgnoreIncomingCall":return be.BQ.IgnoreIncomingCall;case"RejectIncomingCall":return be.BQ.RejectIncomingCall;case"ReplyIncomingCall":return be.BQ.ReplyIncomingCall;case"NavigateToCallTab":return be.BQ.NavigateToCallTab;case"ResumeCallTransfer":return be.BQ.ResumeCallTransfer;default:return`${e}Clicked`}},hB=e=>e.document.hasFocus();class vB extends xp{constructor(){super(d.c1.CreateNotificationsHandlerTask,["activeWindowsService","appsRegistryService","commandChangeReportingService","coreSettings","hostCommunicationService","loggerFactory","scenarioFactory","waitForRenderingContextReady","windowProvider","userBiService","authenticationService","i18n","clientPreferences"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,commandChangeReportingService:i,coreSettings:a,hostCommunicationService:o,loggerFactory:r,scenarioFactory:s,waitForRenderingContextReady:l,windowProvider:c,userBiService:d,authenticationService:u,i18n:m,clientPreferences:p,platformService:g}=e;e.notificationsHandler=new pB(t,l,o,u,a,i,c,s,n,d,g,p,r,m)}}var yB=n(364836);class SB{constructor(e){this.userAgent=e,this.metaOsPlatformRecord={office:nt.PU.MetaOsOffice,outlook:nt.PU.MetaOsOutlook,bing:nt.PU.MetaOsBing,copilot:nt.PU.MetaOsCopilot,edgesidebar:nt.PU.MetaOsEdgeSidebar,excel:nt.PU.MetaOsExcel,loop:nt.PU.MetaOsLoop,powerpoint:nt.PU.MetaOsPowerpoint,windows:nt.PU.MetaOsWindows,word:nt.PU.MetaOsWord},this.UAParser=yB.getParser(e)}getBrowser(){switch(this.UAParser.getBrowserName()){case"Microsoft Edge":return nt.Pw.Edge;case"Safari":return nt.Pw.Safari;case"Chrome":return nt.Pw.Chrome;case"Firefox":return nt.Pw.Firefox;case"Electron":return nt.Pw.Electron;default:return nt.Pw.Unknown}}getVendor(){const e=this.UAParser.getPlatform()?.vendor?.toString();return e||""}getOSDetails(){const e=this.UAParser.getOS();return{name:e?.name,version:e?.version,versionName:e?.versionName}}getBrowserVersion(){return this.UAParser.getBrowserVersion()}getRingConfig(e=$a.B.prod,t){switch(t){case"ring0_gcc":t="ring0",e=$a.B.gcc;break;case"general_gcc":t="general",e=$a.B.gcc}return{ring:t,environment:e}}getOsPlatform(){const e=this.getOsOverride();if(null!=e)return e;switch(this.UAParser.getOSName()){case"Windows":return nt.SA.Windows;case"macOS":return nt.SA.Mac;case"Linux":return nt.SA.Linux;case"Chrome OS":return nt.SA.ChromeOS;case"Android":return nt.SA.Android;case"iOS":return nt.SA.IOS;case"Windows Phone":return nt.SA.WindowsPhone;default:return nt.SA.Unknown}}getOSPlatformVersion(){const e=this.host?.deviceInfo?.osVersion;return e||this.UAParser.getOSVersion()}getOsOverride(){return null}getPlatformId(e,t){let n=this.getClientType(e,t);const i=this.getMetaOsPlatformId(e);return i||(n===nt.sK.Desktop&&this.getOsPlatform()===nt.SA.Mac&&(n="Mac"),n=`${n[0].toUpperCase()}${n.substr(1)}`,nt.PU[n])}getMetaOsPlatformId(e){const t=e?.metaoshost?.toLowerCase()??"";return this.metaOsPlatformRecord[t]}getClientType(e,t){let n=e&&e.host;if(!n&&t){const e="host";n=t.localStorage.getItem(e)||""}return"outlookDesktop"===n?nt.sK.Desktop:"outlookWeb"===n?nt.sK.Web:this.getBrowser()===nt.Pw.Electron?nt.sK.Desktop:nt.sK.Web}getCpuArchitecture(){let e;const t=/x\d{2}_\d{2}|(i[3-6]86|x\d{2}|amd\d{2}|wow\d{2}|arm\d{2}|arm|ARM|aarch\d{2}|ppc\d{2}|ppc\d{2}le)|Intel|Android\s+\d+\.\d+\.\d+;\s*(\S+)/;try{e=this.userAgent.match(t)}catch{return""}return e?.[0]||""}}const fB=["general","ring3_6","ring3_9","ring3","ring2","ring1_6","ring1_5","ring1","ring0_s","ring0"];class kB extends SB{constructor(e,t,n,i,a){super(n.navigator.userAgent),this.loggerFactory=e,this.routingServices=t,this.windowHost=n,this.hostSettings=i,this.getPlatformConfigurationOverrides=a,this.fullBrowserVersionUpdated=!1,this.backupDeviceId=(0,E.v4)(),this.logger=this.loggerFactory.newLogger("PlatformService","core-services-platform"),this.queryStringParameters=this.routingServices.state.getSearchState()||{},this.headConfig=rt(this.windowHost,this.logger),this.cachedConfig=this.computeConfig(),this.cachedEcsOverrides=this.computeEcsOverrides()}get config(){return this.cachedConfig}get ecsOverrides(){return this.cachedEcsOverrides}get host(){const e=this.windowHost.loader?.getProperties?.();return{bootType:e?.bootType||pa.Unknown,deviceId:e?.deviceId||oo.get("deviceId")||this.backupDeviceId,deviceInfo:this.getDeviceInfo(e),hostAppVersion:dt(this.windowHost),sessionId:e?.sessionId||oo.get("sessionId"),preAuthUserId:e?.preAuthUserId,isServiceWorkerActive:mt(this.windowHost),...this.windowHost.getHostedWindowContext()}}get connection(){if(this.windowHost.navigator.connection?.effectiveType)return{effectiveType:this.windowHost.navigator.connection.effectiveType}}async updateAsyncPlatformInfo(){if(!(this.fullBrowserVersionUpdated||void 0===this.cachedConfig.browserVersion||this.cachedConfig.browserVersion.indexOf(".0.0.0")<0)){this.fullBrowserVersionUpdated=!0;try{let e;if(!this.windowHost.navigator||!("userAgentData"in this.windowHost.navigator))return;e=this.windowHost.navigator.userAgentData;const t=await e.getHighEntropyValues(["fullVersionList"]);if(t&&t.fullVersionList&&t.fullVersionList.length>0)for(const e of t.fullVersionList)if(e.brand.toUpperCase().indexOf(this.cachedConfig.browser.toUpperCase())>=0){this.cachedConfig.browserVersion=e.version||this.cachedConfig.browserVersion;break}}catch(e){this.logger.errorNoPii?.(`Fetching full browser version failed: ${this.cachedConfig.browser} - ${this.cachedConfig.browserVersion||""}`)}}}getOsOverride(){return this.windowHost.localStorage.getItem("platformOverride")}getDeviceInfo(e){if(e&&e.deviceInfo)return e.deviceInfo;const t=this.getOSDetails(),n=this.getCpuArchitecture();return{osName:t.name,osVersion:t.version,cpuArchitecture:n}}computeConfig(){let e={};this.getPlatformConfigurationOverrides&&(e=this.getPlatformConfigurationOverrides(this.windowHost,this.queryStringParameters)),this.logger.log(`IPlatformConfiguration overrides: ${JSON.stringify(e)}`);const t=this.getBrowser(),n=e.clientType??this.getClientType(this.queryStringParameters,this.windowHost),i=this.determinePlatformId(e);this.logger.log(`Determined PlatformID to be '${i}'`);const a=this.getHostingParent(),o=this.windowHost.__VERSION__,r=`${i}/${o}`,s=this.windowHost.__webpack_public_path__,l=this.getVendor(),c=this.getOSDetails(),d=this.getCpuArchitecture();let u="https://statics.teams.cdn.office.net";try{s&&(u=new URL(s).origin)}catch{this.logger.warn(`Failed to parse dynamic staticsPath origin from '${s}'`)}const m=this.windowHost.navigator.language||"en-us",p=this.windowHost.loaderConfig?.pullRequestId,g=this.windowHost.loaderConfig?.buildId;this.logger.log(`PlatformService: configuring with clientVersion: ${r}`);const h=this.windowHost.loader?.getProperties?.()?.deviceInfo?.browserVersion;return h&&(this.fullBrowserVersionUpdated=!0),{browser:t,browserVersion:h||this.getBrowserVersion(),buildType:ot(r),buildVersion:o,clientContext:this.getClientContext(a),clientType:n,clientVersion:r,cpuArchitecture:d,currentUrl:this.windowHost?.location?.href,hostingParent:a,isInCypressFrame:this.getIsInCypressFrame(),isInIframe:this.getIsInIframe(),isInternalUser:this.headConfig.isInternalUser,isOcdi:this.headConfig.isOcdi,isPwa:this.getIsPwa(),osDetails:c,osPlatform:this.getOsPlatform(),osVersion:this.getOSPlatformVersion(),platformId:i,publicPath:s,staticsPath:u,userAgent:this.userAgent,userLanguage:m,vdi:e.vdi,vendor:l,getLocaleInfoAsync:this.windowHost.getLocaleInfoAsync,pullRequestId:p,buildId:g}}determinePlatformId(e){const t=e.platformId,n=this.hostSettings?.hostSettings?.platformId;if(this.logger.logNoPii?.(`Potential PlatformID sources: experienceOverrides='${t}', hostSettings='${n}', qsp='${JSON.stringify(this.queryStringParameters)}', windowHostHost='${this.windowHost?.localStorage.getItem("host")}'`),t)return this.logger.logNoPii?.("Using PlatformID value from experience overrides"),t;if(n){const e=parseInt(n,10);if(e)return this.logger.logNoPii?.("Using PlatformID value from host settings"),e}return this.logger.logNoPii?.("Using PlatformID value from QSP/WindowHost/Browser"),this.getPlatformId(this.queryStringParameters,this.windowHost)}getHostUrl(){const e=this.windowHost.localStorage.getItem("ecsHostUrl")||this.headConfig.ecsHostUrl;if(e)return new URL(e,this.windowHost.location.origin).href}computeEcsOverrides(){const e=this.getHostUrl(),t=this.getEnvironmentOverride()||function(e,t){let n=t?.environment||"prod";return"infer"===n&&(n=function(e){return e.location.origin.includes("gov")?"gcchigh":e.location.origin.includes("dod")?"dod":e.location.origin.includes("live")?"life":"prod"}(e)),n}(this.windowHost,this.headConfig),n=(0,we.get)($a.B,t),i=this.getRingOverride(),{originalRing:a,unauthenticated:o}=this.headConfig,r=void 0===a||a===i;return{hostUrl:e,...this.getRingConfig(n,i),originalRing:a,unauthenticated:o,isAssignedRing:r}}getEnvironmentOverride(){if(this.queryStringParameters.webinarRing)return this.queryStringParameters.webinarRing}getRingOverride(){if(this.headConfig.isInternalUser&&this.queryStringParameters.ring&&fB.indexOf(this.queryStringParameters.ring)>=0)return this.queryStringParameters.ring;const e=this.windowHost.getHostedWindowContext();if(e?.ring)return e.ring;const{ring:t}=this.headConfig;return t?"string"==typeof t?t:t.id:void 0}getHostingParent(){const e=st(this.windowHost);return e&&e.dataset&&"outlook"===e.dataset.host?nt.NM.Outlook:nt.NM.Unknown}getClientContext(e){return e===nt.NM.Outlook?nt.pc.Embed:void 0}getIsInIframe(){return!!this.windowHost.getHostedWindowContext().isInIframe}getIsInCypressFrame(){return!!this.windowHost.getHostedWindowContext().isInCypressFrame}getIsPwa(){if(void 0!==this.cachedIsPwa)return this.cachedIsPwa;this.cachedIsPwa=!!this.windowHost.loader?.getProperties?.()?.isPwa;const e=this.queryStringParameters?.clientType===nt.sK.PWA,t=this.windowHost?.matchMedia("(display-mode: standalone)"),n=t?.matches;return e===n&&this.cachedIsPwa===e&&this.cachedIsPwa===n||this.logger?.warnToTelemetry?.(`PWA client type detection methods disagree: From loader: ${this.cachedIsPwa}, QueryArg: ${e}, DisplayModeStandalone: ${n}`,"client_type_pwa"),t?.addEventListener("change",(t=>{t.matches?this.logger?.infoToTelemetry?.(`DisplayModeStandalone changed to true, qspClientType: ${e}`,"client_type_pwa"):this.logger?.infoToTelemetry?.(`DisplayModeStandalone changed to false, qspClientType: ${e}`,"client_type_pwa")})),this.cachedIsPwa}}class CB extends xp{constructor(){super(d.c1.CreatePlatform,["windowProvider","loggerFactory","routingServices"])}async execute(e){const{windowProvider:t,loggerFactory:n,routingServices:i,getPlatformConfigurationOverrides:a}=e,o=new kB(n,i,t,void 0,a);await o.updateAsyncPlatformInfo(),e.platformService=o}}const bB="Profiler:: ";var wB,TB;!function(e){e.LoadModuleProfilerFailed="LoadModuleProflierFailed",e.ExecuteCommandFailed="ExecuteCommandFailed"}(wB||(wB={})),function(e){e.LoadModuleProfilerSuccess="LoadModuleProfilerSuccess",e.ExecuteCommandSuccess="ExecuteCommandSuccess"}(TB||(TB={}));class IB{constructor(e,t){this.hostCommunicationService=t,this.logger=e.newLogger("ProfilerService","services-io-profiler"),this.exposeToCoreWindow()}async getMemoryData(){return fj.f.getInstance()?.getMemoryData(!1)??{}}async getHeapSnapshot(e=!0){const t=await this.getProfilerModuleAsync();if(!t)return;e&&await this.requestTriggerGC();const n=await(t.getHeapSnapshot?.());return n?.snapshot?n.snapshot:void 0}async requestTriggerGC(){const e=await this.getProfilerModuleAsync();if(!e)return!1;const t=await(e.triggerGC?.());return!!t?.status}async getProfilerModuleAsync(){let e;try{e=await this.hostCommunicationService.loadModule("profiler"),this.logger.log(`${bB}${TB.LoadModuleProfilerSuccess}`)}catch(e){this.logger.error(`${bB}${wB.LoadModuleProfilerFailed} ${(0,ge.hR)(e)}`)}return e}async exposeToCoreWindow(){const e=await this.hostCommunicationService.loadModule("profiler"),t=await this.hostCommunicationService.loadModule("heartbeat");e&&t?globalThis.window.profiler={...e,getMemoryData:()=>this.getMemoryData(),getHeapSnapshot:(e=!1)=>this.getHeapSnapshot(e),getTotalWorkingSetSizeBytes:()=>this.getWorkingSetSizeFromProcesses(t?.getPerfMetrics),getTotalCommitSizeBytes:()=>this.getCommitSizeFromProcesses(t?.getPerfMetrics)}:this.logger.log("HostComms is unable to load profiler and/or heartbeat module. We are running on Web or Teams 1.0. Bailing out.")}async getWorkingSetSizeFromProcesses(e){if(e){const t=await e();return t?.reduce(((e,t)=>(e.workingSetSizeBytes+=t.workingSetSizeBytes,e)),{workingSetSizeBytes:0}).workingSetSizeBytes}return this.logger.warn("Unable to get perf metrics."),-1}async getCommitSizeFromProcesses(e){if(e){const t=await e();return t?.reduce(((e,t)=>(e.pageFileUsageBytes+=t.pageFileUsageBytes,e)),{pageFileUsageBytes:0}).pageFileUsageBytes}return this.logger.warn("Unable to get perf metrics."),-1}}class NB extends xp{constructor(){super(d.c1.CreateProfiler,["loggerFactory","hostCommunicationService"])}async execute(e){e.profilerService=new IB(e.loggerFactory,e.hostCommunicationService)}}class AB{constructor(e,t,n,i,a,r,s,l,c,d,u){this.loggerFactory=e,this.host=t,this.clientStateProvider=n,this.networkStateProvider=i,this.platformService=a,this.hostCommunicationService=l,this.localStorage=c,this.scenarioFactory=d,this.diagnosticsService=u,this.cleanupOnRebootArray=[],this.expChangeSubscription=null,this.lcChangeSubscription=null,this.clientStateSubscription=null,this.isRunningJobsInLongInactive=!1,this.rebootPending=void 0,this.registerCleanupCallback=e=>{this.cleanupOnRebootArray.push(e)},this.didUrlChange=e=>(0,Bo.OL)(e)!==(0,Bo.OL)(this.host.location.href),this.areMaxRetriesExhausted=(e,t)=>{if(t?.maxRetries){const n=this.getRetryStorageKey(e),i=this.localStorage.get(n,"Experience"),a=i&&parseInt(i,10)||0;this.logger.debug(`Reboot retry count for '${e}': ${a}`);const o=a>=t.maxRetries;return this.localStorage.set(n,`${a+1}`,"Framework","Experience"),o&&this.logger.warn(`Max retries exhausted for '${e}', retryCount: ${a}, maxRetries: ${t.maxRetries}`),o}return!1},this.getRetryStorageKey=e=>`rebootRetries.${e}`,this.logger=this.loggerFactory.newLogger("rebootService","core-services-reboot"),this.expChangeSubscription=r.observeChanges().pipe((0,o.T)((e=>{this.isExperienceIdleStateChangedEvent(e)&&(this.isRunningJobsInLongInactive=!0)}))).subscribe(),this.lcChangeSubscription=s.observeChanges().pipe((0,o.T)((({context:e})=>{const{target:t,reportedChange:n}=e;if(this.isRunningJobsInLongInactive&&t===wO.UserLifeCycleManager&&this.isExperienceIdleStateChangedEvent(n)&&(this.isRunningJobsInLongInactive=!1,this.rebootPending)){this.host.clearTimeout(this.timeoutId),this.logger.log("Core finished running App jobs in LongInactive client state. Issuing pending reboot now...");const{reason:e,commandSource:t,options:n}=this.rebootPending;this.rebootApp(e,t,n)}}))).subscribe()}async rebootApp(e,t,n){let i=!1;if(await this.cleanupBeforeReboot(),this.logger.log(`Reboot app triggered for ${e} from ${t} with options: ${(0,ge.hR)(n)}`),this.areMaxRetriesExhausted(t,n))return i;const a="reboot_request",o=`${e}; source: ${jp.Z[t]}${n?.extraTelemetry?`; message: ${n.extraTelemetry}`:""}`;try{this.logger.infoToTelemetry?.(o,a,{context:n?.extraTelemetry,type:e},!0),this.diagnosticsService.persistDiagnosticsAsPreviousSessionLogs(),this.dispose();const r=this.scenarioFactory.findScenario(be.Cu.ClientStart);r?.incomplete({commandSource:t,reason:e});const s=await(0,Pt.AR)();await(s?.flush?.());const l=this.getReloadUrl(n,t,e);this.platformService.config.clientType===nt.sK.Maglev||this.platformService.config.clientType===nt.sK.Desktop&&e===jp.g.AuthTokenForceRefresh?await this.rebootThroughDesktopApi(l,o,a):this.didUrlChange(l)?this.host.location.replace(l):this.host.location.reload(),i=!0}catch{this.logger.error("Reboot app failed")}return this.sendOutTelemetryIfRebootFails(o,a,e,n),i}rebootWhenLongInactive(e,t,n){return this.clientStateSubscription?(this.logger.log(`Reboot subscription already exist, skip the subscription from ${t} with reason ${e}`),!1):(this.logger.log(`Reboot when longInactive is subscribed from ${t} with reason ${e}`),this.clientStateSubscription=this.clientStateProvider.observe().subscribe((i=>this.handleClientStateChange(i,e,t,n))),!0)}clearRetryCount(e){this.localStorage.remove(this.getRetryStorageKey(e),"Experience")}dispose(){this.isRunningJobsInLongInactive=!1,this.rebootPending=void 0,this.timeoutId&&(this.host.clearTimeout(this.timeoutId),this.timeoutId=void 0),this.clientStateSubscription?.unsubscribe(),this.clientStateSubscription=null,this.expChangeSubscription?.unsubscribe(),this.expChangeSubscription=null,this.lcChangeSubscription?.unsubscribe(),this.lcChangeSubscription=null}async cleanupBeforeReboot(){let e,t,n;for(;e=this.cleanupOnRebootArray.pop();)try{await e("restart")}catch(n){t=t?t.concat(`${e.toString()}::${(0,ge.hR)(n)}`):`${e.toString()}::${(0,ge.hR)(n)}::`}t&&(n=new Ha.a(Ha.D.CLEANUP,new Error(t)),this.logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services",void 0,!0))}async rebootThroughDesktopApi(e,t,n){const i=await this.hostCommunicationService.loadModule("core");if(i)try{await(i.relaunch?.({url:e,reason:t}))}catch{this.logger.errorToTelemetry?.(`${t} PIE API call failed`,n,void 0,!0)}else this.logger.errorToTelemetry?.("HostComms is unable to load core module.",n,void 0,!0)}handleClientStateChange(e,t,n,i){this.networkStateProvider.getState()===Pg.Q.Online?(this.logger.log(`Handling clientState change to ${e}.`),e===Ba.Lg.LongInactive&&(this.rebootPending={reason:t,commandSource:n,options:i},this.isRunningJobsInLongInactive?this.waitForRunningJobsAndReboot():this.rebootApp(t,n,i))):this.logger.log(`Reboot skipped, network state is offline when client state change to ${e}.`)}getReloadUrl(e,t,n){const i=new URL(e?.customUrl||this.host.location.href),a=i.searchParams;e?.qsps?.hasOwnProperty("clearcontainer")&&a.delete("container"),a.delete("tenantId"),i.hash=this.getReloadHash(t,n,i.hash);const o=e?.qsps||{};return Object.keys(o).forEach((e=>{a.set(e,o[e])})),i.toString()}getReloadHash(e,t,n){if(this.platformService.config.clientType===nt.sK.Maglev){const i=lg(n);let a;if(i.deepLink===Op.f5.core)a=Op.f5.core;else switch(e){case jp.Z.WebClientUpdateService:a=Op.f5.core;break;case jp.Z.ReloadAppTask:a=!i.deepLink||i.deepLink===Op.f5.flyout||t!==jp.g.RingSwitch&&t!==jp.g.HighMemory?Op.f5.default:encodeURIComponent(i.deepLink);break;default:a=Op.f5.default}return`deepLink=${a}&source=${jp.Z[e]}`}return n}waitForRunningJobsAndReboot(){this.logger.log("Pending a reboot while waiting for Core to finish running App jobs in LongInactive client state. timeout=2000 ms"),this.timeoutId=this.host.setTimeout((()=>{if(this.host.clearTimeout(this.timeoutId),this.rebootPending){this.logger.log("Timeout waiting for Core to finish running App jobs in LongInactive client state. Rebooting now...");const{reason:e,commandSource:t,options:n}=this.rebootPending;this.rebootApp(e,t,n)}}),2e3)}isExperienceIdleStateChangedEvent(e){return e.type===Ua.Mk.ExperienceIdleStateChanged&&e.context.isIdle}sendOutTelemetryIfRebootFails(e,t,n,i){this.host.setTimeout((()=>this.logger.errorToTelemetry?.(e,t,{context:i?.extraTelemetry,type:n},!0)),1e4)}}class EB extends xp{constructor(){super(d.c1.CreateReboot,["clientState","diagnosticsService","experienceChangeReportingService","hostCommunicationService","lifeCycleScopeChangeReportingService","localStorage","loggerFactory","networkState","platformService","scenarioFactory","windowProvider"])}async execute(e){const{clientState:t,diagnosticsService:n,experienceChangeReportingService:i,hostCommunicationService:a,lifeCycleScopeChangeReportingService:o,localStorage:r,loggerFactory:s,networkState:l,platformService:c,scenarioFactory:d,windowProvider:u}=e;e.rebootService=new AB(s,u,t,l,c,i,o,a,r,d,n)}}var FB=n(304584);class _B extends xp{constructor(){super(d.c1.CreateSidecarMonitor,["rebootService","coreSettings","loggerFactory"])}async execute(e){const{coreSettings:t,rebootService:n,loggerFactory:i}=e,a=i.newLogger("CreateSidecarMonitorTask","core-services-tasks");t.getObservable(c.w.Sidecars).subscribe((e=>{e=e||{};const{getUpdate:t}=(0,FB.o)(e);if(e.disableChangeDetectedReboot)return;const i=t();i&&(a.log(`sidecar queued reboot for '${i}'`),n.rebootWhenLongInactive(jp.g.SidecarUpdate,jp.Z.Sidecar))}))}}var DB=n(583493),PB=n(134005);class MB extends xp{constructor(){super(d.c1.CreateRouting,[])}async execute(e){const t=e.config.forceUseBrowserHistory||!e.windowProvider||""===e.windowProvider.location.hash?(0,DB.zR)({basename:e.config.basePath}):(0,DB.TM)({basename:e.config.basePath});e.routingServices=(0,PB.h)(e.loggerFactory,t,e.windowProvider&&e.windowProvider.location)}}class RB{constructor(e,t){this.statsPerIdMap=new Map,this.startTimeMap=new Map,this.telemetryReportInterval=0,this.globalStats={maxInQueueTaskCount:0,totalLatencyTime:0,executedTaskCount:0,maxLatency:0,reportSequence:0,queueSize:0},this.logger=e.newLogger("PostTaskSchedulerDiagnosticsService","core-services-scheduling"),this.host=t}subscribeToCoreSettings(e){e.getObservable(c.w.Core,["schedulerTelemetryIntervalMS"]).subscribe((e=>{if(e.schedulerTelemetryIntervalMS){const t=e.schedulerTelemetryIntervalMS;this.telemetryReportInterval!==t&&(this.telemetryReportInterval=t,this.initializeTelemetryReporter(t))}}))}markTaskEnqueued(e,t){this.startTimeMap.set(e,performance.now());let n=this.statsPerIdMap.get(t);n||(n={executedTaskCount:0,maxLatency:-1,totalLatencyTime:0,totalLatencyTimeThisReport:0}),this.statsPerIdMap.set(t,n),this.globalStats.queueSize++,this.globalStats.queueSize>this.globalStats.maxInQueueTaskCount&&(this.globalStats.maxInQueueTaskCount=this.globalStats.queueSize)}markTaskDequeued(e,t){const n=this.statsPerIdMap.get(t),i=this.startTimeMap.get(e);if(!i)return;this.startTimeMap.delete(e),this.globalStats.executedTaskCount++,this.globalStats.queueSize--;const a=Math.round(performance.now()-i);this.globalStats.totalLatencyTime+=a,a>this.globalStats.maxLatency&&(this.globalStats.maxLatency=a),n&&(n.totalLatencyTime+=a,n.totalLatencyTimeThisReport+=a,n.executedTaskCount++,a>n.maxLatency&&(n.maxLatency=a))}initializeTelemetryReporter(e){this.clearTelemetryInterval(),e>=6e4&&(this.telemetryIntervalId=this.host.setInterval((()=>this.reportTelemetry()),e))}clearTelemetryInterval(){this.telemetryIntervalId&&(this.host.clearInterval(this.telemetryIntervalId),this.telemetryIntervalId=0)}reportTelemetry(){0!==this.globalStats.maxInQueueTaskCount&&(this.logger.infoToTelemetry?.("send-log-to-console-and-diagnostics","webclient_framework_foundation_post_task_scheduler_diagnostics",{maxSchedulerWaitLatency:this.globalStats.maxLatency,maxSchedulerQueueSize:this.globalStats.maxInQueueTaskCount,totalTaskWaitLatency:this.globalStats.totalLatencyTime,totalExecutedTaskCount:this.globalStats.executedTaskCount,sequence:this.globalStats.reportSequence}),this.statsPerIdMap.forEach(((e,t)=>{this.logger.infoToTelemetry?.(`send-log-to-console-and-diagnostics-${t}`,"webclient_framework_foundation_post_task_scheduler_diagnostics",{maxSchedulerWaitLatency:e.maxLatency,totalTaskWaitLatency:e.totalLatencyTime,totalExecutedTaskCount:e.executedTaskCount,sequence:this.globalStats.reportSequence}),e.totalLatencyTimeThisReport=0})),this.globalStats.reportSequence++)}}class xB extends xp{constructor(){super(d.c1.CreateSchedulerTask,["schedulerChangeReporting","loggerFactory","windowProvider"])}async execute(e){const{loggerFactory:t,schedulerChangeReporting:n,windowProvider:i}=e,a=new RB(t,i),o=new ji(n,window,t,d.Vx,a);e.postTaskSchedulerDiagnosticsService=a,e.scheduler=o}}class LB{constructor(e,t,n,i,a,o,r,s){this.experienceChangeReportingService=e,this.commandChangeReportingService=t,this.appsRegistryService=n,this.scheduler=i,this.hostComms=a,this.userKey=o,this.context=r,this.activeWindowsService=s,this.mainWindowDisplayedChange={windowId:null,eventFired:!1},this.processExperienceChangeChange=async e=>{e.type===Ua.Mk.UserConsentedToConsumeResources&&(this.layoutRenderedChange&&(this.layoutRenderedChange=void 0),this.userConsentedChange=e),e.type===Ua.TZ.LayoutRenderComplete&&!0===e.isMainWindow&&(this.layoutRenderedChange=e),this.tryToSendSignal()},this.onWindowVisibilityChanged=async e=>{const t=await this.isMainWindowForActiveUserContext(e.windowId);if(!e.visible||this.mainWindowDisplayedChange&&this.mainWindowDisplayedChange?.eventFired)e.visible||(t&&(this.mainWindowDisplayedChange.windowState=await this.getWindowState(e.windowId)),this.mainWindowDisplayedChange.eventFired=!1,this.mainWindowDisplayedChange.windowId=null);else{if(!t)return;this.mainWindowDisplayedChange.windowId=e.windowId,this.tryToSendSignal()}}}async init(){this.experienceChangeReportingServiceSubscription=this.experienceChangeReportingService.observeChanges().pipe((0,di.p)((e=>e.userContextId===this.userKey))).subscribe(this.processExperienceChangeChange),this.commandChangeReportingServiceSubscription=this.commandChangeReportingService.observeChanges().pipe((0,di.p)((e=>e.userContextId===this.userKey&&!!e.isMainWindow&&e.type===p.I.WindowCreated&&e.context.layoutMode===Yt.Rm.standard))).subscribe((e=>{this.mainWindowRenderedChange=e,this.tryToSendSignal()}));const e=await this.hostComms.loadModule("windowcontrols");this.windowVisibilityChangeSubscription=e?.registerForWindowVisibilityChanged?.(this.onWindowVisibilityChanged)}dispose(){this.experienceChangeReportingServiceSubscription&&this.experienceChangeReportingServiceSubscription.unsubscribe(),this.commandChangeReportingServiceSubscription&&this.commandChangeReportingServiceSubscription.unsubscribe(),this.windowVisibilityChangeSubscription&&this.windowVisibilityChangeSubscription()}tryToSendSignal(){if(!this.shouldSendSignal())return;const e=this.appsRegistryService.registeredApps;this.scheduler.schedule((()=>{e.forEach((e=>{e.UNSAFE_onSignal&&e.UNSAFE_onSignal({type:"main_window_rendered",userContextId:this.userKey},this.context)}))}),{id:"on-signal-job",priority:Ti.Ad.Macro,scheduledById:"signal-processor"},(0,E.v4)()),this.reset()}async isMainWindowForActiveUserContext(e){const t=this.activeWindowsService.getStandardMainWindow();return e===t?.id&&t.userContextId===this.userKey}async getWindowState(e){const t=await this.hostComms.loadModule("windowcontrols");return t?.getWindowState?.(e)}shouldSendSignal(){return this.windowHasBeenCreatedAndSignalsHaveFired()||this.windowHasToggledVisibilityAndWasNotMinimizedOrRestored()}windowHasBeenCreatedAndSignalsHaveFired(){return!!this.userConsentedChange&&!!this.mainWindowRenderedChange&&!!this.layoutRenderedChange}windowHasToggledVisibilityAndWasNotMinimizedOrRestored(){return!(!this.userConsentedChange||!this.mainWindowDisplayedChange.windowId||this.mainWindowDisplayedChange.eventFired||this.windowWasMinimized())}windowWasMinimized(){return!0===this.mainWindowDisplayedChange.windowState?.minimized}reset(){this.mainWindowRenderedChange=void 0,this.layoutRenderedChange=void 0,this.mainWindowDisplayedChange.eventFired=!0}}class OB extends xp{constructor(){super(d.c1.CreateSignalProcessor,["activeWindowsService","appsRegistryService","experienceChangeReportingService","client","coreSettings","entityCommanding","loggerFactory","platformService","scenarioFactory","scheduler","hostCommunicationService","commandChangeReportingService","authenticationUser","userBiService"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,experienceChangeReportingService:i,client:a,coreSettings:o,entityCommanding:r,loggerFactory:s,platformService:l,scenarioFactory:c,scheduler:d,hostCommunicationService:u,commandChangeReportingService:m,authenticationUser:p,userBiService:g}=e,h=new LB(i,m,n,d,u,(0,kt.Lw)(p),{client:a,coreSettings:o,entityCommanding:r,loggerFactory:s,platformService:l,scenarioFactory:c,userBiService:g},t);return h.init(),()=>{h.dispose()}}}var jB=n(31388);class BB extends xp{constructor(){super(d.c1.CreateShortcutExecutionServiceTask,[])}async execute(e){e.shortcutExecutionService=new jB.y}}class UB{constructor(e){this._loggerFactory=e,this._logger=this._loggerFactory.newLogger("app-wide-shortcut-registry","core-shortcut-service"),this._registeredShortcuts=new Map}addAppWideShortcut(e,t,n,i){this._logger.log(`Adding application wide shortcut for command ${t} and hotkey ${e}. ${this._registeredShortcuts.size} shortcuts active`);const a=this._getKey(e,i),o=this._registeredShortcuts.get(a);o?(o.count++,o.commandHandler=n,this._logger.warn(`Overriding existing shortcut for windowId ${i} and hotkey ${e} count ${o.count}`)):(this._registeredShortcuts.set(a,{commandId:t,commandHandler:n,hotkey:e,windowId:i,count:1}),this._logger.log(`Added app wide shortcutfor hotkey ${e} and windowId ${i}. ${this._registeredShortcuts.size} shortcuts active`))}removeAppWideShortcut(e,t){this._logger.log(`Removing app wide shortcutfor hotkey ${e}. ${this._registeredShortcuts.size} shortcuts active`);const n=this._getKey(e,t),i=this._registeredShortcuts.get(n);i?--i.count>0||(this._registeredShortcuts.delete(n),this._logger.log(`Removed app wide shortcut for hotkey ${e} and windowId ${t}. ${this._registeredShortcuts.size} shortcuts active`)):this._logger.warn(`No app wide shortcut found for hotkey ${e} and windowId ${t}`)}getAppWideShortcutHandler(e,t){const n=this._getKey(e,t);return this._registeredShortcuts.get(n)?.commandHandler}destroy(e){for(const[t,n]of this._registeredShortcuts)e===n?.windowId&&this._registeredShortcuts.delete(t)}_getKey(e,t){return`${t}-${e}`}}class $B{constructor(e,t){this._loggerFactory=e,this._hostCommunicationService=t,this._logger=this._loggerFactory.newLogger("global-shortcut-registry","core-shortcut-service"),this._registeredGlobalShortcuts=[]}async addGlobalShortcut(e,t,n){const i=(e=>e.windows)(e),a=0===this._registeredGlobalShortcuts.length;this._logger.log(`Adding global shortcut for command ${t} and shortuct ${i}. ${this._registeredGlobalShortcuts.length} shortcuts active`);const o=await this._hostCommunicationService.loadModule("globalshortcuts");if(!o)return;const r=this._registeredGlobalShortcuts.filter((e=>e.keys===i));if(r.length>0){this._logger.log("Global shortcut already registered, removing");for(const e of r)await(o?.removeGlobalShortcut?.(e.shortcutId)),this._logger.log(`Removed global shortcut for command ${t} and shortuct ${i}`),this._registeredGlobalShortcuts=this._registeredGlobalShortcuts.filter((t=>t.shortcutId!==e.shortcutId))}const s=await(o?.addGlobalShortcut?.(e));return s&&(this._registeredGlobalShortcuts.push({commandId:t,shortcutId:s,commandHandler:n,keys:i}),this._logger.log(`Added global shortcut for command ${t} and shortuctId ${s}. ${this._registeredGlobalShortcuts.length} shortcuts active`),a&&(this._logger.log("First global shortcut added, registering callback"),await this.registerForGlobalShortcutActivated())),s}async removeGlobalShortcut(e){this._logger.log(`Removing global shortcut for commandId ${e}. ${this._registeredGlobalShortcuts.length} shortcuts active`);const t=this._registeredGlobalShortcuts.filter((t=>t.commandId===e));t.length>0&&(this._removeGlobalShortcuts(t),this._logger.log(`Removed ${t.length} global shortcut for command ${e}. ${this._registeredGlobalShortcuts.length} shortcuts active`)),0===this._registeredGlobalShortcuts.length&&(this._logger.log("Last global shortcut removed, disposing registration"),this._disposeGlobalShortcutActivatedEventRegistration?.(),this._disposeGlobalShortcutActivatedEventRegistration=void 0)}async registerForGlobalShortcutActivated(){if(this._disposeGlobalShortcutActivatedEventRegistration)return;const e=await this._hostCommunicationService.loadModule("globalshortcuts");e&&(this._disposeGlobalShortcutActivatedEventRegistration=e?.registerForGlobalShortcutActivated?.((e=>this._handleGlobalShortcut(e))))}async cleanup(){this._disposeGlobalShortcutActivatedEventRegistration&&(this._disposeGlobalShortcutActivatedEventRegistration(),this._disposeGlobalShortcutActivatedEventRegistration=void 0),await this._removeGlobalShortcuts(this._registeredGlobalShortcuts),this._registeredGlobalShortcuts=[]}async _removeGlobalShortcuts(e){const t=await this._hostCommunicationService.loadModule("globalshortcuts");if(t)for(const n of e)this._logger.log(`Removing global shortcut for commandId ${n.commandId} with keys ${n.keys}`),await(t?.removeGlobalShortcut?.(n.shortcutId)),this._logger.log(`Removed global shortcut for command ${n.commandId}`),this._registeredGlobalShortcuts=this._registeredGlobalShortcuts.filter((e=>e.shortcutId!==n.shortcutId))}_handleGlobalShortcut(e){const t=this._registeredGlobalShortcuts.find((t=>t.shortcutId===e));t?(this._logger.debug(`Executing command handler for global shortcut: ${t.commandId} / ${t.shortcutId}`),t.commandHandler()):this._logger.warn(`Can't execute global shortcut with id ${e}. No record found.`)}}class WB{constructor(e,t,n,i){this._hostCommunicationService=e,this._loggerFactory=t,n&&(this._appWideShortcutRegistry=new UB(t)),i&&(this._globalShortcutRegistry=new $B(this._loggerFactory,this._hostCommunicationService))}addAppWideShortcut(e,t,n,i){this._appWideShortcutRegistry?.addAppWideShortcut(e,t,n,i)}removeAppWideShortcut(e,t){this._appWideShortcutRegistry?.removeAppWideShortcut(e,t)}getAppWideShortcutHandler(e,t){return this._appWideShortcutRegistry?.getAppWideShortcutHandler(e,t)}async addGlobalShortcut(e,t,n){return this._globalShortcutRegistry?.addGlobalShortcut(e,t,n)}async removeGlobalShortcut(e){return this._globalShortcutRegistry?.removeGlobalShortcut(e)}async registerForGlobalShortcutActivated(){return this._globalShortcutRegistry?.registerForGlobalShortcutActivated()}async destroy(e){this._appWideShortcutRegistry?.destroy(e),"global"===e&&await(this._globalShortcutRegistry?.cleanup())}}class VB extends xp{constructor(){super(d.c1.CreateShortcutRegistryServiceTask,["coreSettings","hostCommunicationService","loggerFactory"])}async execute(e){const{coreSettings:t,hostCommunicationService:n,loggerFactory:i}=e,a=t?.get(c.w.Shortcuts),{enableAppWideShortcuts:o,enableGlobalShortcuts:r}=a||{enableAppWideShortcuts:!1,enableGlobalShortcuts:!1},s=new WB(n,i,!!o,!!r);return e.shortcutRegistryService=s,e=>{switch(e){case"quit":case"signout":return s.destroy("global");default:return}}}}class HB{constructor(e,t="",n){this.userId=t,this._telemetryProvider=n??(0,Pt.AR)(),e.debug("Initialized telemetry context service for "+(t?"user":"default context"))}setContext(e,t,n,i=""){this._telemetryProvider.setContext(e,t,n,i||this.userId)}setCoreContext(e,t,n){this._telemetryProvider.setContext(e,t,n)}setDeviceAuthToken(e){this._telemetryProvider.setDeviceAuthToken(e)}setUserId(e){this.userId=e}setPrimaryUser(e,t){this._telemetryProvider.setPrimaryUser(e,t)}}class zB extends xp{constructor(){super(d.c1.TelemetryContext,["loggerFactory"])}async execute(e){const t=e.loggerFactory.newLogger("CreateTelemetryContextTask","core-services-tasks");e.telemetryContextService=new HB(t)}}var qB=n(710225);class GB{constructor(e,t){this.authenticationService=e,this._users=new Map,this._accountModeObservable=new ya.t(kR.J.SingleAccount),this._accountCountCurrentCloudObservable=new ya.t(0),this._cloudModeObservable=new ya.t(kR.B.SingleCloud),this.currentCloud=(0,ze.nv)(t)}init(){this._syncWithAuthServicePromise||(this._syncWithAuthServicePromise=this.syncWithAuthenticationService())}getAuthenticatedUsers(){return new Set(this._users.keys())}has(e){return this._users.has(e)}getAccountMode(){return this._accountModeObservable.value}getAccountModeObservable(){return this._accountModeObservable.pipe((0,Tg.F)())}getAccountCountCurrentCloud(){return this._accountCountCurrentCloudObservable.value}getAccountCountCurrentCloudObservable(){return this._accountCountCurrentCloudObservable.pipe((0,Tg.F)())}getCloudMode(){return this._cloudModeObservable.value}getCloudModeObservable(){return this._cloudModeObservable.pipe((0,Tg.F)())}async syncWithAuthenticationService(){if((await(this.authenticationService.getCachedUsers?.({id:(0,E.v4)(),scenarioName:be.Cu.AuthWebCachedUser,source:"UserTrackingService::syncWithAuthenticationService"},{isAllCachedUsers:!0}))||[]).forEach((e=>{this._users.set((0,kt.Lw)((0,kt.aj)(e)),e.cloud??this.currentCloud)})),this.updateAccountMode(),this.updateAccountCountCurrentCloud(),this.updateCloudMode(),this.authenticationService.getUsersIterator)for await(const e of this.authenticationService.getUsersIterator({isAllCachedUsers:!0}))this._users.clear(),e.forEach((e=>{this._users.set((0,kt.Lw)((0,kt.aj)(e)),e.cloud??this.currentCloud)})),this.updateAccountMode(),this.updateAccountCountCurrentCloud(),this.updateCloudMode()}updateAccountMode(){const e=this._users.size>1?kR.J.MultipleAccounts:kR.J.SingleAccount;qB.D.log(`[updateAccountMode] to: ${kR.J[e]}`),this._accountModeObservable.next(e)}updateAccountCountCurrentCloud(){let e=0;this._users.forEach((t=>t===this.currentCloud&&e++)),qB.D.log(`[updateAccountCountCurrentCloud] to: ${e}}`),this._accountCountCurrentCloudObservable.next(e)}updateCloudMode(){const e=new Set(this._users.values()).size>1?kR.B.MultiCloud:kR.B.SingleCloud;qB.D.log(`[updateCloudMode] to: ${kR.B[e]}`),this._cloudModeObservable.next(e)}}class YB extends xp{constructor(){super(d.c1.CreateTrackUserServiceTask,["authenticationService","coreSettings"])}async execute(e){const{authenticationService:t,coreSettings:n}=e,i=new GB(t,n);n.get(c.w.Core)?.initializeMTMAModeOnStartup&&i.init(),e.userTrackingService=i}}class QB extends xp{constructor(){super(d.c1.CreateUserDataClient,["scenarioFactory","loggerFactory","windowProvider","coreSettings","client"])}async execute(e){if(!e.client)throw new Error("CreateUserDataClientTask: core data client doesn't exist, cannot initialize user client");const t=mR(),n=await async function(e,t,n,i,a){const{networkState:o,coreSettings:r,leakDetectorService:s,platformService:l,config:u,graphqlStoreStatsReporterService:m}=e,p=new qC.Gd,g=(0,Bh.nC)(ah.t,o.observeIsOnline()),h={...e,clientResolversFactory:n,writeClientDefaultsFn:i,pubsub:p,send:g},v=n.get();if(!v)throw new Error("Client resolvers should be created at this point");const{maxApolloResultCacheSize:y,enableViewSchema:S,enableApolloDoubleWriteFix:f,enableRelay:k,enableRelayLiveResolverStore:C,relayGCReleaseBufferSize:b}=r.get(c.w.Core),{enableApolloDevtools:w}=r.get(c.w.Diagnostics),T=y??void 0,I=s?.create(),N=e?.authenticationUser&&(0,kt.Lw)(e.authenticationUser),A=zF({leakDetector:I,userContextId:N,windowId:d.N2,entityType:a,viewportContext:"cmd"},void 0,v,T,e.loggerFactory,e.scenarioFactory,i,void 0,w,GC.J.cmd,m,f);mb(A,`mtma-cmd-${e?.authenticationUser?.loginUserName||"nouser"}`,Boolean(w),l,u.experienceName);const E=UF.createUserDataRequestContext(h,A),F=await Yb.createLink({contextValue:E,UNSAFE_resolvers:[$F.K],...h});A.setLink(F);const _=HF(e,n,i,p,I,F,e.loggerFactory,e.scenarioFactory,v,N);let D,P;S&&(D=qF(e,0,I,Yb.createViewSchemaLink(e),e.loggerFactory,e.scenarioFactory)),k&&(P={isLiveResolverStoreEnabled:!0===C,gcReleaseBufferSize:b,entityType:a});const{dataOpsTracker:M,dataEvictionService:R}=t.getServices();return new cw({clientResolversFactory:n,writeClientDefaultsFn:i,pubsub:p,leakDetector:I,scenarioFactory:E.scenarioFactory,coreSettings:E.coreSettings,dataOpsTracker:M,dataEvictionService:R,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},t,_,E,D,P)}(e,e.client,t,SR,"default");return e.client=n,e=>{switch(e){case"signout":case"quit":n.destroy()}}}}var JB=n(403097);const KB=12e4,ZB={"cdl-request":!0};var XB=n(319095);class eU{constructor(){this._isPaused=!1,this._startTime=0,this._reason=d.O4.Unknown,this._totalPauseTime=0,this._lastPauseLength=0}get paused(){return this._isPaused}get totalPauseDuration(){return this._totalPauseTime}pause(e,t={},n=void 0){this._isPaused||(this._reason=e,this._startTime=this.getTime(t),this._data=n,this._isPaused=!0)}resume(e={}){if(this._isPaused){const t=this.getTime(e)-this._startTime;this._lastPauseLength=t,this._totalPauseTime+=this._lastPauseLength}return this._isPaused=!1,{startTime:this._startTime,totalTime:this._lastPauseLength,eventData:this._data,reason:this._reason,monitoringData:void 0}}getTime(e={}){const{overrideTimestamp:t,offsetCurrentTimeInMs:n}=e;return(t??Date.now())+(n??0)}}class tU{constructor(e,t,n={}){this.name=e,this.id=t,this.excludedTimings=n,this.previousMark=""}markPerformanceApi(e,t=""){if(performance&&performance.mark&&performance.measure&&this.shouldMark(this.name)){const n=`${e} ${this.name}-${this.id}`;if(performance.mark(n),e===be.BQ.Stop){let e=`start ${this.name}-${this.id}`;0===(performance.getEntriesByName(e,"mark")||[]).length&&(e="navigationStart");const i=[this.name,t&&`(${t})`].join(" ");performance.measure(i,e,n)}this.previousMark&&performance.measure(`${this.name} [${this.previousMark} <=> ${e}]`,`${this.previousMark} ${this.name}-${this.id}`,n),this.previousMark=e}}shouldMark(e){return!(e in this.excludedTimings)||this.excludedTimings[e]}}class nU{constructor(e,t,n,i,a,o,r=(0,E.v4)(),s=be.SQ.Expanded,l="",c={}){this.name=e,this.clientId=t,this._eventData=n,this._timingData=i,this.startTime=a,this.timeoutMs=o,this.id=r,this.scenarioMode=s,this.userContextId=l,this.crossAccountScenarioOptions=c,this.previousStep=be.BQ.Unknown,this.sequence=1,this.active=!0,this.onStopCallbacks=[],this.__stepsPerfInfo__=[],this._testingMode=!1,this._steps=[],this._stepsEx=[],this.userIds=new Set,this.pauseTracker=new eU,this.currentStep=be.BQ.Unknown,this.timestamps=[],this.intervalTimestamp=a,this.performanceMarker=new tU(this.name,this.id,ZB)}addPackedData(e,t){this._steps=this._steps.concat(e.map((e=>JSON.parse(e)))),this._stepsEx=this._stepsEx.concat(t.map((e=>JSON.parse(e))))}updateTimestamp(e,t){this.timingData[e]=t}addOnStopCallback(e){this.onStopCallbacks.push(e)}get timingData(){return this._timingData}get testingMode(){return this._testingMode}set testingMode(e){this._testingMode=e}get isPaused(){return this.pauseTracker.paused}get eventData(){return this._eventData}get steps(){return this._steps}get stepsEx(){return this._stepsEx}get elapsed(){return this.calculateElapsed(Date.now())}get stepDelta(){return this.calculateStepDelta(Date.now())}get delta(){return this.calculateDelta(Date.now())}get isHoisted(){return!1}syncToState(e){this.previousStep=e.previousStep,this.intervalTimestamp=e.lastTimestamp,this.sequence=e.lastSequence}setCrossClientObservables(e){const t=e.mark.subscribe((e=>{this.mark(e.step,e.eventData,e.status)})),n=e.stop.subscribe((e=>{this.stop(e.eventData,e.status)})),i=e.appendEventData.subscribe((e=>{this.appendEventData(e.eventData)}));this.subscriptions={mark:t,stop:n,appendEventData:i}}appendEventData(e){this._eventData={...this._eventData,...e}}pause(e){this.timer?.pause();const{reason:t,overrideTimestamp:n,offsetCurrentTimeInMs:i,...a}=e;this.pauseTracker.pause(t,{overrideTimestamp:n,offsetCurrentTimeInMs:i},a),this.currentStep!==be.BQ.Unknown&&this.mark(this.currentStep)}resume(e={}){this.timer?.resume();const t=this.pauseTracker.resume({overrideTimestamp:e.overrideTimestamp,offsetCurrentTimeInMs:e.offsetCurrentTimeInMs});this.mark(be.BQ.Pause,{pauseReason:t.reason,...t.eventData,...e})}cancel(e={}){this.stop(e,"abandoned")}mark(e,t={},n="success"){if(!this.canMark())return;this.currentStep=be.BQ.Unknown;const{overrideTimestamp:i,offsetCurrentTimeInMs:a,...o}=t,r=this.getBaseTimestamp(i,a),{delta:s,stepDelta:l,elapsed:c}=this.getBaseScenarioTimingData(r,t),d=e,u={"Scenario.Mode":this.scenarioMode,"Scenario.Name":this.name,"Scenario.Status":n,"Scenario.Step":d,InstanceId:this.id,sequence:this.sequence,delta:s,elapsed:c,stepDelta:l};let m;if(t={...this.eventData,...o},this.scenarioMode===be.SQ.Packed&&(this.prepareAndStorePackedSteps(u),this.createStepsExEntry(o),d===be.BQ.Stop&&(u["Scenario.Steps"]=JSON.stringify(this._steps),m={columnName:"Scenario.StepsEx",packedData:this._stepsEx})),this.scenarioMode===be.SQ.Expanded||d===be.BQ.Stop)if(this.isCrossAccountScenario)for(const e of this.userIds)(0,hi.DC)(this.name,t,this.finalizeScenarioData(r,u),void 0,m,e);else(0,hi.DC)(this.name,t,this.finalizeScenarioData(r,u),void 0,m,this.userContextId);this.performanceMarker.markPerformanceApi(d,this.clientName),this._testingMode&&this.__stepsPerfInfo__.push({name:d,delta:s,stepDelta:l,status:n}),this.updateScenarioStatePostMark(d,r)}stop(e={},t="success"){this.timer?.stop(),this.currentStep!==be.BQ.Unknown&&this.mark(this.currentStep,void 0,t),this.mark("stop",{previousStep:this.previousStep,...e},t),this.active=!1,this.subscriptions&&(this.subscriptions.appendEventData.unsubscribe(),this.subscriptions.mark.unsubscribe(),this.subscriptions.stop.unsubscribe()),this.onStopCallbacks.forEach((e=>e()))}fail(e={}){this.stop(e,"failure")}incomplete(e={}){this.stop(e,"incomplete")}startStep(e){const t=e;this.currentStep!==be.BQ.Unknown&&t!==this.currentStep&&this.mark(this.currentStep),this.currentStep=t}markAggregateStart(e){}markAggregateStop(e){}getTotalPauseDuration(){return 0}getPackedSteps(){return this._steps}addUser(e){this.userIds.add(e)}removeUser(e){this.userIds.delete(e)}canMark(){return this.active&&!this.pauseTracker.paused}get isCrossAccountScenario(){return!!this.crossAccountScenarioOptions.enabled&&!!this.userIds.size}finalizeScenarioData(e,t){const n=t;return n.elapsedSinceCoreInit=this.calculateElapsedSinceCoreInit(e),n}getBaseScenarioTimingData(e,t){return{delta:"number"==typeof t.delta?t.delta:this.calculateDelta(e),elapsed:"number"==typeof t.elapsed?t.elapsed:this.calculateElapsed(e),stepDelta:"number"==typeof t.stepDelta?t.stepDelta:this.calculateStepDelta(e)}}getBaseTimestamp(e,t){return(e??Date.now())+(t??0)}calculateElapsedSinceCoreInit(e){return this.timingData.coreInitTime?e-this.timingData.coreInitTime:void 0}calculateDelta(e){return e-this.startTime-this.pauseTracker.totalPauseDuration}calculateElapsed(e){return e-this.timingData.scenarioFactoryStartTime}calculateStepDelta(e){return e-this.intervalTimestamp}prepareAndStorePackedSteps(e){const t={"Scenario.Status":e["Scenario.Status"],"Scenario.Step":e["Scenario.Step"],delta:e.delta,elapsed:e.elapsed,sequence:e.sequence,stepDelta:e.stepDelta,previousStep:e.previousStep};this._steps.push(t)}updateScenarioStatePostMark(e,t){this.intervalTimestamp=t,this.previousStep=e,this.sequence++}createStepsExEntry(e){this.stepsEx.push((0,we.cloneDeep)({...this.eventData,...e})||{})}}const iU=e=>e.reduce(((e,t)=>({...e,[t.name]:t.value})),{});class aU{constructor(e,t,n,i,a={},o="",r=[],s=!1){this.timingData=e,this.logger=t,this.factoryFunctions=n,this.finalizeLegacyCrossClient=i,this.telemetryModeLookUp=a,this.userContextId=o,this.noPureScenarioCreationList=r,this.restrictByClientId=s,this.scenarioCreated$=new Ye.B7,this.scenarioStopped$=new Qe.c,this.scenarioMarked$=new Qe.c,this.appendEventData$=new Qe.c}loadCallbacks(e){if(e.marks){const{registerForScenarioStop:t,registerForScenarioMark:n,registerForScenarioStart:i}=e.marks;this.scenarioMarked$=new Qe.c((e=>{n(((t,n,i)=>{const a={step:n,status:i,scenarioName:t.scenarioName,eventData:iU(t.eventData),clientId:t.clientId};e.next(a)}))})),this.scenarioStopped$=new Qe.c((e=>{t(((t,n)=>{const i={step:"stop",status:n,scenarioName:t.scenarioName,eventData:iU(t.eventData),clientId:t.clientId};e.next(i)}))})),i(((e,t)=>this.onReceivedScenarioStart(e,t)))}if(e.appendEventData){const{appendEventData:t}=e;this.appendEventData$=new Qe.c((e=>{t((t=>e.next({scenarioName:t.scenarioName,clientId:t.clientId,eventData:iU(t.eventData)})))}))}}loadExistingScenarios(e){e.forEach((e=>this.OnExistingScenario(e)))}onReceivedScenarioStart(e,t){let n=null;this.restrictByClientId?n=e.clientId?this.factoryFunctions.findScenarioByNameAndId(e.scenarioName,e.clientId):this.factoryFunctions.findScenario(e.scenarioName,(e=>!e.clientId&&!e.isCrossClientConnected)):(n=this.factoryFunctions.findScenarioByNameAndId(e.scenarioName,e.clientId),n||(n=this.factoryFunctions.findScenario(e.scenarioName))),n?(this.logger.debug(`Creating mark observable for existing scenario: name=${e.scenarioName}, clientid=${e.clientId}`),n.appendEventData({"Scenario.CrossClientMode":"existing"}),n.setCrossClientObservables?.(this.createObservablesForScenario(e.scenarioName,e.clientId))):this.onStartScenario(e,t)}onStartScenario(e,t){const n=e.scenarioName,i=t.time.getTime(),a=iU(e.eventData);if(this.noPureScenarioCreationList.includes(n))return void this.logger.warnToTelemetry?.(`Existing scenario not found for scenario which is found in the noPureScenarioCreationList: name=${n}`,"telemetry_instrumentation_pure_cross_client_scenario_blocked",{reason:n});const o=this.createNewCrossClient(n,e.clientId,a,i,e.timeout,(0,E.v4)(),this.telemetryModeLookUp[n]??be.SQ.Expanded);o.appendEventData({"Scenario.CrossClientMode":"pure"}),o.addOnStopCallback((()=>{this.factoryFunctions.clearScenario(o)})),o.setCrossClientObservables(this.createObservablesForScenario(o.name,o.clientId)),this.scenarioCreated$.next(o)}OnExistingScenario(e){const t=e.clientId??"",n=iU(e.eventData??[]),i=this.createNewCrossClient(e.name,t,n,e.creationTime.time.getTime(),e.timeout??KB,e.id,e.scenarioMode??be.SQ.Expanded);i.addPackedData(e.steps??[],e.stepsEx??[]),i.appendEventData({"Scenario.CrossClientMode":"transferred"}),i.addOnStopCallback((()=>{this.factoryFunctions.clearScenario(i)}));const a=this.finalizeLegacyCrossClient;if(a&&i.addOnStopCallback((()=>{a({scenarioName:i.name})})),i.setCrossClientObservables(this.createObservablesForScenario(i.name,i.clientId)),e.lastMarkStep){const t={previousStep:e.lastMarkStep,lastTimestamp:e.lastMarkTime.time.getTime(),lastSequence:e.sequence};i.syncToState(t)}this.scenarioCreated$.next(i),this.logger.debug(`Created scenario from previous client: name=${e.name}, clientid=${t}`)}createObservablesForScenario(e,t){const n=this.scenarioStopped$.pipe((0,di.p)((n=>n.scenarioName===e&&n.clientId===t)),(0,XB.s)(1));return{mark:this.scenarioMarked$.pipe((0,di.p)((n=>n.scenarioName===e&&n.clientId===t)),(0,di.p)((e=>-1===["stop","start"].indexOf(e.step))),(0,Ge.Q)(n)),stop:n,appendEventData:this.appendEventData$.pipe((0,di.p)((n=>n.scenarioName===e&&n.clientId===t)),(0,Ge.Q)(n))}}createNewCrossClient(e,t,n,i,a,o,r){return new nU(e,t,n,this.timingData,i,a,o,r,this.userContextId)}}class oU{constructor(e){this._name=e}get id(){return"noop"}get name(){return this._name}get delta(){return 0}get timeoutMs(){return 0}get eventData(){return{}}set eventData(e){}get timestamps(){return[]}get isPaused(){return!1}set isHoisted(e){}get isHoisted(){return!1}get stepDelta(){return 0}appendEventData(e){}pause(e){}resume(e){}cancel(e){}mark(e,t,n){}startStep(e){}stop(e,t){}fail(e){}incomplete(e){}markAggregateStart(e){}markAggregateStop(e){}getTotalPauseDuration(){return 0}setCrossClientMarkObservables(e){}setCoreInitTime(e){}addUser(e){}removeUser(e){}}const rU="Scenario.Step";class sU{constructor(e,t,n,i,a,o,r,s,l,c=!1,d=!1,u=be.SQ.Expanded,m=0,p,g,h,v,y="",S={},f=-1,k){this._id=e,this._name=t,this.scenarioFactory=a,this.logger=o,this.timeout=r,this.callback=s,this.memoryAnalyzer=l,this.markStepsInTrace=c,this.showAllConsoleLogs=d,this.scenarioMode=u,this._sequence=m,this.reportActivity=p,this.hostCommunicationService=g,this.crossClientOptions=h,this.clientId=v,this.userContextId=y,this.crossAccountScenarioOptions=S,this.scenarioPackedDataLimit=f,this.sender=k,this.steps=[],this.stepsEx=[],this.__stepsPerfInfo__=[],this.performanceMarksToCleanup=[],this.userIds=new Set,this.getTotalPauseDuration=()=>this.pauseInfo.totalTime,this._currentStep=be.BQ.Unknown,this._previousStep=be.BQ.Unknown,this._timestamps=[],this._isHoisted=!1,this.active=!0,this.pauseInfo={reason:"",startTime:0,totalTime:0,eventData:void 0,monitoringData:void 0};let C=0;const{overrideTimestamp:b,offsetCurrentTimeInMs:w}=i;b?C=b-Date.now():w&&(C=-w),this._eventData=n,this._absoluteStartTime=Date.now()+C,this.intervalTimestamp=this.relativeTimestamp=this.scenarioFactory.timestamp({isCrossClient:this.crossClientOptions?.enabled})+C,this.memoryDataInitial=this.memoryAnalyzer?.snapshotMemoryUsage(),this.crossClientOptions?.enabled&&this.syncStateToCrossClientStart(this.crossClientOptions)}get id(){return this._id}get name(){return this._name}get absoluteStartTime(){return this._absoluteStartTime}get delta(){return this.scenarioFactory.timestamp()-this.relativeTimestamp}get stepDelta(){return this.calculateTimestamp(this.eventData,this._currentStep)-this.intervalTimestamp}get timeoutMs(){return this.timeout}set timeoutMs(e){this.timeout=e}get eventData(){return this._eventData}set eventData(e){this._eventData=e}get timestamps(){return this._timestamps}get currentStep(){return this._currentStep}get isPaused(){return!!this.pauseInfo.startTime}set isHoisted(e){this._isHoisted=e}get isHoisted(){return this._isHoisted}get isCrossClientConnected(){return Boolean(this.stopSubscription)&&Boolean(this.markSubscription)}appendEventData(e){this.eventData={...this.eventData,...e}}markAggregateStart(e){this.active?this.isPaused?this.logger.debug(`[Scenario]${this.name} - ignoring aggregated start step [${e}] due to paused state`):(this.aggregateStepStartTime||(this.aggregateStepStartTime={}),this.aggregateStepStartTime[e]||(this.aggregateStepStartTime[e]=performance.now())):this.logger.debug(`[Scenario]${this.name} - ignoring aggregated start step [${e}] due to inactive`)}markAggregateStop(e){this.active&&this.aggregateStepStartTime[e]&&(this.aggregateStepTotalTime||(this.aggregateStepTotalTime={}),this.aggregateStepTotalTime[e]||(this.aggregateStepTotalTime[e]=0),this.aggregateStepTotalTime[e]+=performance.now()-this.aggregateStepStartTime[e],this.aggregateStepStartTime[e]=void 0)}pause(e,t){if(!this.active||this.isPaused)return;this.timer?.pause(),this._currentStep!==be.BQ.Unknown&&this.mark(this._currentStep);const{reason:n,overrideTimestamp:i,...a}=e,o=i??Date.now();this.startStep(be.BQ.Pause),this.pauseInfo={...this.pauseInfo,reason:n,startTime:o,eventData:a,monitoringData:t}}resume(e,t){if(!this.active||!this.isPaused)return;this.timer?.resume();const{overrideTimestamp:n}=e??{},i=(0,we.isNumber)(n)?n:Date.now(),a=this.pauseInfo.startTime?i-this.pauseInfo.startTime:0;this.pauseInfo.totalTime=(this.pauseInfo.totalTime||0)+a,this.mark(be.BQ.Pause,{pauseReason:this.pauseInfo.reason,...this.pauseInfo.eventData,...e},void 0,t||this.pauseInfo.monitoringData),this._currentStep=be.BQ.Unknown,this.pauseInfo.reason="",this.pauseInfo.startTime=0}stop(e,t="success",n){this._currentStep!==be.BQ.Unknown&&this.mark(this._currentStep,void 0,t,n),this.aggregateStepTotalTime&&((0,we.each)(Object.keys(this.aggregateStepTotalTime),(e=>{const t=parseInt(this.aggregateStepTotalTime[e].toString(),10);this.mark(e,{stepDelta:t},void 0,n)})),this.aggregateStepTotalTime=null,this.aggregateStepStartTime=null),this.timer?.stop(),this.createMark(be.BQ.Stop,t,!0,e,n).then((()=>{if(this.active&&(this.active=!1),this.markSubscription&&!this.markSubscription.closed&&this.markSubscription.unsubscribe(),this.stopSubscription&&!this.stopSubscription.closed&&this.stopSubscription.unsubscribe(),this.callback&&(this.callback(t),this.callback=void 0),this.hostCommunicationService&&this.crossClientOptions?.enabled){const e={scenarioName:this.name};this.hostCommunicationService.loadModule("scenario").then((t=>{t&&t.setScenarioCompletion&&t.setScenarioCompletion(e)}))}this.scenarioFactory.clearScenario(this)}))}updateTimestamp(e,t){"coreInitTime"===e&&(this.coreInitTimestamp=t)}fail(e,t){this.stop(e,"failure",t)}cancel(e,t){this.stop(e,"abandoned",t)}incomplete(e,t){this.stop(e,"incomplete",t)}mark(e,t,n="success",i){this.isPaused&&e!==be.BQ.Pause?this.logger.debug(`[Scenario]${this.name} - ignoring mark step [${e}] due to paused state`):(this.createMark(e,n,!1,t,i),this._currentStep=be.BQ.Unknown,this.crossClientOptions?.enabled&&this.crossClientOptions.previousStep&&e===be.BQ.Start&&(this._previousStep=this.crossClientOptions.previousStep))}startStep(e){this.isPaused?this.logger.debug(`[Scenario]${this.name} - ignoring start step [${e}] due to paused state`):(this._currentStep!==be.BQ.Unknown&&e!==this._currentStep&&this.mark(this._currentStep),this._currentStep=e)}setCrossClientObservables(e){this.markSubscription=e.mark.subscribe((e=>this.mark(e.step,e.eventData,e.status))),this.stopSubscription=e.stop.subscribe((e=>{this.stop(e.eventData,e.status)}))}addUser(e){this.userIds.add(e)}removeUser(e){this.userIds.delete(e)}prepareAndSendTelemetry(e,t,n,i){const{overrideTimestamp:a}=e;let o;o=this.eventData&&this.eventData!==e?{...this.eventData,...e}:{...e},o.InstanceId=this.id,o.overrideTimestamp=a;const r=this.createScenarioData(o,t,n),s=!!this.scenarioFactory.findScenario(be.Cu.WindowLaunchTime);o.isInEst=s;const l=r[rU];if(l!==be.BQ.Start){let t;this.scenarioMode!==be.SQ.Expanded&&(this.prepareAndStorePackedSteps(r,e),l===be.BQ.Stop&&(r["Scenario.Steps"]=JSON.stringify(this.steps),t={columnName:"Scenario.StepsEx",packedData:this.stepsEx})),this.sendScenario(o,r,l,t,i)}return this.logScenarioPerf(r),r}syncStateToCrossClientStart(e){if(e.existingEventData){const t=e.existingEventData.reduce(((e,t)=>({[t.name]:t.value,...e})),{});this.appendEventData(t)}e.previousStep&&(this._previousStep=e.previousStep),this.intervalTimestamp=this.relativeTimestamp+e.previousStepTimestamp-this._absoluteStartTime,this.active=!0}sendScenario(e,t,n,i,a){if(this.scenarioMode!==be.SQ.Packed||n===be.BQ.Stop){const o=()=>{if(this.isCrossAccountScenario)for(const n of this.userIds)this.sender?this.sender.sendScenarioEvent(this.name,e,t,a,i,n):(0,hi.DC)(this.name,e,t,a,i,n);else this.sender?this.sender.sendScenarioEvent(this.name,e,t,a,i,this.userContextId):(0,hi.DC)(this.name,e,t,a,i,this.userContextId)};n!==be.BQ.Stop?o():Promise.all([this.updateEventDataMemory(e)]).then((()=>{o()})).catch((()=>{o()}))}}get isCrossAccountScenario(){return!!this.crossAccountScenarioOptions.enabled&&!!this.userIds.size}prepareAndStorePackedSteps(e,t){if(this.scenarioPackedDataLimit<0||this._sequence<=this.scenarioPackedDataLimit||e["Scenario.Step"]===be.BQ.Stop){const n={"Scenario.Status":e["Scenario.Status"],"Scenario.Step":e["Scenario.Step"],delta:e.delta,elapsed:e.elapsed,sequence:e.sequence,stepDelta:e.stepDelta,previousStep:e.previousStep};this.scenarioPackedDataLimit>-1&&this._sequence>this.scenarioPackedDataLimit&&e["Scenario.Step"]===be.BQ.Stop&&(n.exceededStepsLimit=!0),this.steps.push(n),this.stepsEx.push((0,we.cloneDeep)({...this.eventData,...t})||{})}}logScenarioPerf(e){if(this.showAllConsoleLogs){const t=e[rU],n=e["Scenario.Status"],i=t===be.BQ.Start?`[step](${this._sequence})${t}`:t===be.BQ.Stop?`[step](${this._sequence})${t} (${e.stepDelta}ms/${e.delta}ms) [status]${n}`:`[step](${this._sequence})${t} (${e.stepDelta}ms)`;this.logger&&this.logger.log(`[Scenario]${this.name} ${i}`),this.__stepsPerfInfo__.push({name:t,stepDelta:e.stepDelta,delta:e.delta,status:n})}}updateEventDataMemory(e){return this.memoryAnalyzer?this.memoryAnalyzer.snapshotMemoryUsageAsync().then((t=>{t&&(t.jsHeapStatistics&&(e.jsUsedHeapSize=t.jsHeapStatistics.used_heap_size,e.jsUsedHeapSizeDelta=this.memoryDataInitial?.jsHeapStatistics?this.memoryDataInitial.jsHeapStatistics.used_heap_size-t.jsHeapStatistics.used_heap_size:void 0),t.processMemoryInfo&&(e.workingSet=t.processMemoryInfo.workingSetSize,e.workingSetDelta=this.memoryDataInitial?.processMemoryInfo?t.processMemoryInfo.workingSetSize-this.memoryDataInitial.processMemoryInfo.workingSetSize:void 0,e.privateBytes=t.processMemoryInfo.privateBytes,e.privateBytesDelta=this.memoryDataInitial?.processMemoryInfo?t.processMemoryInfo.privateBytes-this.memoryDataInitial.processMemoryInfo.privateBytes:void 0))})):Promise.resolve()}calculateTimestamp(e,t){const{overrideTimestamp:n,offsetCurrentTimeInMs:i}=e;return(0,we.isNumber)(n)?this.relativeTimestamp+n-this._absoluteStartTime:i?this.scenarioFactory.timestamp({isCrossClient:this.crossClientOptions?.enabled})-i:t===be.BQ.Start?this.relativeTimestamp:this.scenarioFactory.timestamp({isCrossClient:this.crossClientOptions?.enabled})}createScenarioData(e,t,n){const{overrideTimestamp:i,offsetCurrentTimeInMs:a}=e,o=this.intervalTimestamp,r=this.calculateTimestamp(e,n);i?e.overrideTimestamp=void 0:a&&(e.offsetCurrentTimeInMs=void 0),this._timestamps.push(r),this.intervalTimestamp=r;const s=(0,we.isNumber)(e.stepDelta)?e.stepDelta:r-o,l=(0,we.isNumber)(e.delta)?e.delta:r-this.relativeTimestamp-this.getTotalPauseDuration(),c=(0,we.isNumber)(e.elapsed)?e.elapsed:r,d=this._sequence,u="number"==typeof this.coreInitTimestamp?Date.now()-this.coreInitTimestamp:void 0,m=n===be.BQ.Stop?this._previousStep:void 0;return{"Scenario.Status":t,"Scenario.Mode":this.scenarioMode,"Scenario.Name":this.name,[rU]:n,InstanceId:this.id,elapsedSinceCoreInit:u,delta:l,elapsed:c,sequence:d,stepDelta:s,previousStep:m}}getMonitoringDataOverride(e){let t=e;return this.name!==be.Cu.WindowLaunchTime&&this.name!==be.Cu.ExperienceReady||(t=e?(0,we.cloneDeep)(e):{scenarioPriority:"P0",data:[]},t.data.push({key:"App",value:this.eventData.contentSlotApp})),t}async createMark(e,t,n,i={},a){if(!e||!this.active)return;let o;"reason"in i&&(o=i.reason);const r=this.getMonitoringDataOverride(a);this.markPerformanceApi(this.name,e,o);const s=this.prepareAndSendTelemetry(i??{},t,e,r);this.active=this.active&&!n,this.reportActivity&&this.reportActivity(s),this._previousStep=e,this._sequence+=1}markPerformanceApi(e,t,n){if(performance&&performance.mark&&performance.measure&&!ZB.hasOwnProperty(this.name)){const i=`${t} ${e}-${this.id}`;if(performance.mark(i),this.performanceMarksToCleanup.push(i),this.markStepsInTrace){if(this.previousMark){const n=`${e} [${this.previousMark} <=> ${t}]`,i=`${this.previousMark} ${e}-${this.id}`,a=`${t} ${e}-${this.id}`;performance.measure(n,i,a),performance.clearMeasures(n)}this.previousMark=t}if(t===be.BQ.Stop){let t=`start ${e}-${this.id}`;0===(performance.getEntriesByName(t,"mark")||[]).length&&(t="navigationStart");const a=this.clientName?` (${this.clientName})`:"",o=n??this.eventData.reason,r=`${e}${a}${o?`-(${o})`:""}`;performance.measure(r,t,i),performance.clearMeasures(r);for(const e of this.performanceMarksToCleanup)performance.clearMarks(e);this.performanceMarksToCleanup=[]}}}}class lU{constructor(e,t){this.scenario=e,this.windowProvider=t,this.TIMEOUT_THRESHOLD=1e4,this.timeRemaining=this.scenario.timeoutMs,this.lastUnpausedTimestamp=0,this.timerReset=!1}start(){this.timerIsRunning()||(this.timeRemaining=this.scenario.timeoutMs),this.resume()}pause(){this.timerIsRunning()&&(this.windowProvider.clearTimeout(this.timeoutId),this.timeoutId=void 0,this.timeRemaining-=Date.now()-this.lastUnpausedTimestamp)}resume(){this.timerIsRunning()||(this.lastUnpausedTimestamp=Date.now(),this.timeoutId=this.windowProvider.setTimeout(this.timeoutFunction.bind(this),this.timeRemaining))}stop(){this.windowProvider.clearTimeout(this.timeoutId),this.timeoutId=void 0}reset(){this.stop(),this.start()}timerIsRunning(){return!!this.timeoutId}timeoutFunction(){!this.timerReset&&this.scenario.delta&&(this.scenario.delta>this.TIMEOUT_THRESHOLD+this.scenario.timeoutMs||this.scenario.delta<0)?(this.timerReset=!0,this.scenario.appendEventData({timerReset:this.timerReset}),this.reset()):this.scenario.stop(void 0,"timeout")}}class cU{constructor(e){this.windowProvider=e}addTimerToScenario(e){if(!e.timer){const t=new lU(e,this.windowProvider);e.timer=t,t.start()}}}const dU=36e5,uU=e=>{const{disableRingNamePrefixing:t,enableTestOnlyTelemetry:n,testOnlyUserbiTelemetry:i}=e.get(c.w.Telemetry),{environment:a}=e.get(c.w.Metadata),{enableSmbUserIntentUserBiTelemetry:o,smbUserIntentUserBiTelemetryPollInterval:r}=e.get(c.w.Growth),{enableCallingPerfCollectorService:s,enableCallingLongTasksTracking:l,enableCallingLongTasksTriggerFinder:d}=e.get(c.w.Calling);return{telemetry:{observable:e.getObservable(c.w.Telemetry),disableRingNamePrefixing:Boolean(t),enableTestOnlyTelemetry:Boolean(n),testOnlyUserbiTelemetry:i??""},metadata:{observable:e.getObservable(c.w.Metadata),environment:a??""},growth:{enableSmbUserIntentUserBiTelemetry:Boolean(o),smbUserIntentUserBiTelemetryPollInterval:r??dU},calling:{enableCallingPerfCollectorService:Boolean(l),enableCallingLongTasksTracking:Boolean(d),enableCallingLongTasksTriggerFinder:Boolean(s)}}},mU=e=>{const t=e.get(c.w.Telemetry),n=e.get(c.w.Host);return{telemetry:{observable:e.getObservable(c.w.Telemetry),coreAllowListEnabled:t.coreAllowListEnabled??!1,coreAllowList:new Set(t.coreAllowList??[]),scenarioIncompleteOnShutdown:t.scenarioIncompleteOnShutdown??!1,scenarioIncompleteOnShutdownBlockList:t.scenarioIncompleteOnShutdownBlockList??[],enableNewScenarioTimeout:t.enableNewScenarioTimeout??!1,scenarioPackedDataLimit:gU(t.scenarioPackedDataLimit),showAllConsoleLogs:t.showAllConsoleLogs??!1,noPureScenarioCreationList:t.noPureScenarioCreationList??[],enableCrossAccountScenario:t.enableCrossAccountScenario??!1,scenariosNotToTimeoutIfPaused:t.scenariosNotToTimeoutIfPaused??[],restrictByClientId:t.restrictByClientId??!1},host:{environment:e.get(c.w.Metadata).environment,userType:n.userType??"",enableSyncEngine:(0,Xy.ZG)(e),showScenarioStepsInPerfTrace:pU(e)},test:{scenarioBufferList:e.get(c.w.Test).scenarioBufferList??[]}}},pU=e=>(e.get(c.w.Host).showScenarioStepsInPerfTrace||e.get(c.w.Core).showScenarioStepsInPerfTrace)??!1,gU=e=>null!=e?e:-1,hU="scenarioBuffer";class vU{constructor(e,t,n,i,a,o,r=!1,s,l,c,d={},u=""){this.context=e,this.memoryAnalyzer=n,this.windowId=i,this.clientId=a,this.payload=s,this.finalizeLegacyCrossClient=c,this.eventContextData=d,this.userContextId=u,this.coreAllowListEnabled=!1,this.allowedScenarios=new Set,this.scenarioPackedDataLimit=-1,this.crossClientScenarioList=new Set,this.scenarioTimeoutMs=KB,this.telemetryModeLookUp={},this.__isTestingMode__=!1,this.__testingBuffer__=[],this.newScenario=(e,t)=>{if(this.isCrossClientScenarioEnabled(e)){let n;if(n=t?.clientId?this.findScenarioByNameAndId(e,t.clientId):this.findScenario(e),n)return n.appendEventData({"Scenario.CrossClientMode":"transferred"}),n}const n=this.createScenarioWithoutStarting(e,t);return n.mark(be.BQ.Start,t&&{overrideTimestamp:t.overrideTimestamp},void 0,t&&t.monitoringData),n},this.createScenarioWithoutStarting=(e,t={})=>{if(0===this.factoryTimestamps.scenarioFactoryStartTime||!this.isAllowedScenario(e))return new oU(e);const n=void 0===t.captureMemoryUsage||t.captureMemoryUsage,{userObjectId:i,correlationId:a,commandSource:o,tenantId:r}=this.getContextData(),s=(0,we.cloneDeep)(this.eventContextData);s["Panel.WindowID"]=this.windowId,s["UserInfo.Id"]=i,s["UserInfo.TenantId"]=r,s["EventInfo.CorrelationId"]=a,s.commandSource=o;const l=t.scenarioId||(0,E.v4)(),{telemetry:{showAllConsoleLogs:c},host:{showScenarioStepsInPerfTrace:d}}=this.context.settings,u=this.telemetryModeLookUp?this.telemetryModeLookUp[e]||(this.telemetryModeLookUp["*"]?this.telemetryModeLookUp["*"]:be.SQ.Expanded):be.SQ.Expanded,m=new sU(l,e,s,{overrideTimestamp:t.startTime},this,this.logger,t.timeoutMs||this.scenarioTimeoutMs,t.callback,n?this.memoryAnalyzer:void 0,!!d,!!c,u,t.sequence||0,this.reportActivity,this.context.hostCommunicationService,t.crossClientOptions,void 0,this.userContextId,this.crossAccountScenarioOptions,this.scenarioPackedDataLimit,this.context.telemetrySender);e===be.Cu.NavigationCommand?m.clientId=t.clientId??this.clientId:m.clientId=t.clientId,this.factoryTimestamps.coreInitTime&&m.updateTimestamp("coreInitTime",this.factoryTimestamps.coreInitTime);const p=this.setupScenarioTimeout(m);return this.getActiveScenarios(m.name).push({scenario:m,timeoutId:p}),m},this.cancelExistingAndCreateScenario=(e,t,n,i,a,o)=>{let r=this.findScenario(e);if(r){const e=[{reason:t}];r.cancel({errors:JSON.stringify(e)})}return r=this.newScenario(e,{...o,timeoutMs:n,callback:i,monitoringData:a}),r},this.stopScenarioIfActive=(e,t,n,i)=>{const a=this.findScenario(e);a&&a.stop(t,n,i)},this.markStep=(e,t,n)=>{const i=this.findScenario(e);i&&i.mark(t,n&&n.eventData,n&&n.status,n&&n.monitoringData)},this.startStep=(e,t)=>{const n=this.findScenario(e);n&&n.startStep(t)},this.findScenario=(e,t)=>{if(!e)return null;const n=this.activeScenariosMap.get(e);let i=null;n&&(i=(0,we.find)(n,(n=>n&&n.scenario.name===e&&(!t||t(n.scenario))))?.scenario||null);const{parentScenarioFactory:a}=this.context;return null==i&&a&&a!==this&&(i=a.findScenario(e,t)),i},this.findScenarioByNameAndId=(e,t)=>{const n=this.activeScenariosMap.get(e);let i=null,a=null;n&&(i=(0,we.find)(n,(n=>n.scenario.name===e&&n.scenario.clientId===t))||null);const{parentScenarioFactory:o}=this.context;return null==i&&o&&o!==this&&(a=o.findScenarioByNameAndId(e,t)),i&&i.scenario||a},this.clearScenario=e=>{const t=this.activeScenariosMap.get(e.name);if(t){const n=(0,we.findIndex)(t,(t=>t.scenario===e));if(n>-1){this.__saveForTestingMode__(e);const i=t.splice(n,1)[0];0===t.length&&this.activeScenariosMap.delete(i.scenario.name),this.context.settings.telemetry.enableNewScenarioTimeout||this.context.windowProvider.clearTimeout(i.timeoutId)}}const{parentScenarioFactory:n}=this.context;e.isHoisted&&n&&this!==n&&(n.clearScenario(e),e.isHoisted=!1)},this.setContext=e=>{this.eventContextData={...this.eventContextData,...e},this.activeScenariosMap.forEach((t=>{t.forEach((t=>t.scenario.appendEventData(e)))}))},this.hoistScenarioToCore=e=>{const{parentScenarioFactory:t}=this.context;if(t&&t!==this)t.hoistScenarioToCore&&t.hoistScenarioToCore(e);else if(!e.isHoisted){this.getActiveScenarios(e.name).push({scenario:e,timeoutId:0}),e.isHoisted=!0}},this.findAllScenariosByName=e=>this.getActiveScenarios(e).map((e=>e.scenario)),this.changeTimeout=(e,t)=>{const n=this.activeScenariosMap.get(e.name)?.find((t=>t.scenario.name===e.name&&t.scenario.id===e.id));n&&(n.scenario.timeoutMs=t,this.context.settings.telemetry.enableNewScenarioTimeout?n.scenario.timer?.reset():(this.context.windowProvider.clearTimeout(n.timeoutId),n.timeoutId=this.setupScenarioTimeout(n.scenario)))},this.processOnRunningScenarios=e=>{this.activeScenariosMap.forEach((t=>t.forEach((t=>e(t.scenario,t.timeoutId)))))},this.setupScenarioTimeout=(e,t)=>{if(this.context.settings.telemetry.enableNewScenarioTimeout)return this.timerFactory.addTimerToScenario(e),0;{const n=e.timeoutMs;return this.context.windowProvider.setTimeout((()=>{const{scenariosNotToTimeoutIfPaused:n}=this.context.settings.telemetry;e.isPaused&&n?.includes(e.name)||e.stop(void 0,"timeout",t)}),n)}},this.getContextData=()=>({userObjectId:this.context.settings.host.environment===$a.B.life?this.context.authenticationUser?.profile.paddedMsaId:this.context.authenticationUser?.profile.objectId,tenantId:this.context.authenticationUser?.profile?.tenantId,correlationId:this.context.correlation.id,commandSource:this.context.correlation.source}),this.getActiveScenarios=e=>{let t=this.activeScenariosMap.get(e);return t||(t=[],this.activeScenariosMap.set(e,t)),t},this.reportActivity=e=>{const t=e["Scenario.Name"];t&&this.isWhitelistedActivity(t)&&this.context.windowProvider.opener?.postMessage(pi.pI.ActivityEvent,{action:"er:rendererActivityEvents",data:{activityEvents:[{sourceId:this.windowId,events:[`${t}:${e["Scenario.Step"]}`]}]}})},this.isWhitelistedActivity=e=>{switch(e){case be.Cu.WindowLaunchTime:case be.Cu.ChatSendMessage:case be.Cu.CentralDataLayerRequest:case be.Cu.UnhandledRejection:case be.Cu.FatalError:case be.Cu.GlobalWindowError:return!0;default:return!1}},this.isAllowedScenario=e=>!this.coreAllowListEnabled||this.allowedScenarios.has(e),this.isCrossClientScenarioEnabled=e=>this.clientType===nt.sK.Maglev&&this.crossClientScenarioList.has(e)&&void 0!==this.context.hostCommunicationService,this.initializeCrossClientScenarios=(e,t=[],n=!1,i)=>{const a=e.scenarios??[],o=e.crossClientScenarioList??[],r=this.context.loggerFactory.newLogger("CrossClientCoordinator","core-services-telemetry");o.forEach((e=>{this.crossClientScenarioList.add(e)}));const s={scenarioFactoryStartTime:e.scenarioFactoryStartTime.time.getTime(),coreInitTime:this.factoryTimestamps.coreInitTime};this.crossClientCoordinator=new aU(s,r,this,this.finalizeLegacyCrossClient,this.telemetryModeLookUp,this.userContextId,t,n),this.crossClientCoordinator.scenarioCreated$.subscribe((e=>{this.onScenarioFromCoordinator(e)})),i&&(this.crossClientCoordinator.loadCallbacks(i),this.logger.debug("Cross client initializing with callbacks")),this.crossClientCoordinator.loadExistingScenarios(a),this.logger.debug("Cross client coordinator initialized")},this.getTimestamp=e=>{const t=Date.now();return e?.isCrossClient&&this.factoryTimestamps.desktopFactoryStartTime?t-this.factoryTimestamps.desktopFactoryStartTime:e?.isFromCoreInit&&this.factoryTimestamps.coreInitTime?t-this.factoryTimestamps.coreInitTime:t-this.factoryTimestamps.scenarioFactoryStartTime};const{telemetry:{coreAllowListEnabled:m,coreAllowList:p,scenarioPackedDataLimit:g}}=this.context.settings;this.coreAllowListEnabled=m,this.allowedScenarios=p,this.scenarioPackedDataLimit=g,this.factoryTimestamps={scenarioFactoryStartTime:t,desktopFactoryStartTime:this.payload?.scenarioFactoryStartTime.time.getTime(),coreInitTime:o},this.activeScenariosMap=new Map,this.clientType=e.platformService?.config?.clientType,this.telemetryModeSubscription=this.context.settings.telemetry.observable.subscribe((e=>this.onReceiveTelemetrySettings(e))),this.crossAccountScenarioOptions={enabled:this.context.settings.telemetry.enableCrossAccountScenario};const h=i?`ScenarioFactory-${i}`:"ScenarioFactory";this.logger=this.context.loggerFactory.newLogger(h,"core-services-telemetry"),this.__initTestingMode__(this.context.settings.host.userType),this.timestamp=this.getTimestamp,this.timerFactory=new cU(this.context.windowProvider),this.payload&&this.initializeCrossClientScenarios(this.payload,this.context.settings.telemetry.noPureScenarioCreationList,this.context.settings.telemetry.restrictByClientId,l),this.startWindowLaunchTimeScenario(r,t),this.logger.debug("Initialized ScenarioFactory")}destroy(){this.telemetryModeSubscription.unsubscribe(),this.incompleteRunningScenarios()}setCoreInitTime(e){this.factoryTimestamps.coreInitTime=e,this.activeScenariosMap.forEach((t=>{t.forEach((t=>t.scenario.updateTimestamp?.("coreInitTime",e)))}))}doesScenariosExist(e){const t=[];for(const n of e){const e=this.activeScenariosMap.get(n);e?.length&&t.push(n)}return t}incompleteRunningScenarios(){this.context.settings.telemetry.scenarioIncompleteOnShutdown&&this.processOnRunningScenarios(((e,t)=>{this.context.settings.telemetry.scenarioIncompleteOnShutdownBlockList.includes(e.name)||(e.incomplete({reason:"shutdown"}),this.context.settings.telemetry.enableNewScenarioTimeout||clearTimeout(t))}))}startWindowLaunchTimeScenario(e,t){if(e){const e=this.newScenario(be.Cu.WindowLaunchTime,{startTime:t,timeoutMs:6e4});e.appendEventData({workerEnabled:this.context.settings.host.enableSyncEngine}),this.hoistScenarioToCore?.(e)}}__initTestingMode__(e){e&&e.indexOf("test")>-1&&(this.__isTestingMode__=!0,this.logger.infoToTelemetry?.("Testing mode initialized","scenario_buffer_testing_mode",void 0,!0),hU in window?(this.__testingBuffer__=window[hU],this.logger.infoToTelemetry?.("Testing buffer initialized when test buffer found in window object","scenario_buffer_testing_mode",void 0,!0)):(this.__testingBuffer__=window[hU]=[],this.logger.infoToTelemetry?.("Testing buffer initialized when test buffer not found in window object","scenario_buffer_testing_mode",void 0,!0)))}__saveForTestingMode__(e){if(this.__isTestingMode__&&this.__testingBuffer__){const{scenarioBufferList:t}=this.context.settings.test;this.logger.infoToTelemetry?.(`Testing mode enabled, saving scenario to buffer list: ${t.length}`,"scenario_buffer_testing_mode",void 0,!0),t.length>0?t.indexOf(e.name)>-1&&this.__pushScenarioBuffer__(e):this.__pushScenarioBuffer__(e)}}__pushScenarioBuffer__(e){e.isHoisted&&this.__testingBuffer__.length>0&&this.__testingBuffer__[this.__testingBuffer__.length-1].id===e.id||(this.__testingBuffer__.push(e),this.__testingBuffer__.length>100&&this.__testingBuffer__.shift())}onReceiveTelemetrySettings(e){this.telemetryModeLookUp=e.scenarioModes,this.coreAllowListEnabled=Boolean(e.coreAllowListEnabled),this.allowedScenarios=new Set(e.coreAllowList??[]),this.scenarioPackedDataLimit=gU(e.scenarioPackedDataLimit)}onScenarioFromCoordinator(e){this.crossClientScenarioList.add(e.name);const{showAllConsoleLogs:t}=this.context.settings.telemetry;e.testingMode=Boolean(t);const{userObjectId:n,correlationId:i,commandSource:a,tenantId:o}=this.getContextData(),r=(0,we.cloneDeep)(this.eventContextData);r["Panel.WindowID"]=this.windowId,r["UserInfo.Id"]=n,r["UserInfo.TenantId"]=o,r["EventInfo.CorrelationId"]=i,r.commandSource=a,e.appendEventData(r),this.factoryTimestamps.coreInitTime&&e.updateTimestamp("coreInitTime",this.factoryTimestamps.coreInitTime);const s=this.setupScenarioTimeout(e);this.getActiveScenarios(e.name).push({scenario:e,timeoutId:s})}}var yU=n(700188),SU=n(712839),fU=n(380322);const kU="reactWebClient",CU="maglev",bU="prod",wU="general";function TU(e,t,n){let i,a,o,r;if(n){const e=n.expConfigMetadata.find((e=>e.client===kU)),t=n.expConfigMetadata.find((e=>e.client===CU));i=e?.config.eTag,a=t?.config.eTag,o=n.expConfigMetadata.map((e=>e.config.expIds)).filter((e=>e.length>0)).join(","),r=IU(n.expConfigMetadata).join(",")}else i=e.eTag||void 0,a=e.hostETag||void 0,e.configIds&&e.configIds.experiments&&(o=e.configIds.experiments.join(",")),e.expRolloutIdAllowList?.length&&(r=NU(e).join(","));const s=function(e,t){const n=e.ring&&e.ring.id||wU;if(t)return n;const i=e.region?.toLowerCase(),a="gcc"===i?i:e.environment||bU;switch(a){case bU:return n;case"gcc":return`${n}_gcc`;default:return`${a}-${n}`}}(e,t);return{ring:s,eTag:i,hostETag:a,expIds:o,rolloutIds:r,environment:e.environment||void 0}}const IU=e=>{const t=new RegExp(/P-R-[a-zA-Z0-9]+/),n=[];return e.forEach((e=>{e.config.expRolloutIdAllowList?.split(",")?.forEach((i=>{if(t.test(i)){const t=e.config.rolloutIds?.split(",")?.filter((e=>e.startsWith(i)));n.push(...t??[])}}))})),n},NU=e=>{const t=new RegExp(/P-R-[a-zA-Z0-9]+/),n=[];return e.expRolloutIdAllowList?.forEach((i=>{if(t.test(i)){const t=e.configIds?.rollouts?.filter((e=>e.startsWith(i)))??[];n.push(...t)}})),n};class AU{constructor(e){this._top=-1,this._isFilled=!1,this._buffer=new Array(e),this.capacity=e}add(e){this._top=(this._top+1)%this.capacity,this._buffer[this._top]=e,this._top===this.capacity-1&&(this._isFilled=!0)}getItemFromLast(e){if(-1===this._top||e>=this.capacity||!this._isFilled&&this._top-e<0)return;const t=this._top-e>=0?this._top-e:this.capacity- -1*(this._top-e);return this._buffer[t]}}class EU{constructor(e){this.eventMarks=new AU(e&&e>0?e:100)}markEvent(e){this.markEventOverrideTimestamp(e,Date.now())}markEventOverrideTimestamp(e,t){this.eventMarks?.add({ts:t,name:e})}getEventsBetweenStartAndLast(e){if(!this.eventMarks)return[];const t=[];let n;for(let i=1;n=this.eventMarks.getItemFromLast(i),n&&!(n.ts<e);i++)t.push(n.name);return t}getEventsBetween(e,t){if(!this.eventMarks)return[];const n=[];let i;for(let a=0;i=this.eventMarks.getItemFromLast(a),i&&!(i.ts<e);a++)i.ts<t&&n.push(i.name);return n}}function FU(e){return new EU(e)}var _U=n(799366);class DU{constructor(e,t){if(this.context=e,this.windowId=t,this.biEventObserver=new Ye.B7,this.experimentationEventData={},this.telemetrySettings={},this.panelContextData={},this.dataBagContextData={},this.windowSlotContext={},this.userContextId="",this._dataBags=[],this.recordPanelView=(e,t,n)=>{const i=this.getCombinedContextData(n),a=this.getCombinedDataBagData(n),o={"Panel.Type":e.panelType,"Panel.Region":e.panelRegion};this.recordBiEvent({eventName:"panelview",data:{...this.windowSlotContext,...a,...RU({...i,...e}),...o}},t)},this.recordPanelAction=(e,t,n)=>{e.actionGesture||Object.assign(e,{actionGesture:"auto"});const i=this.getCombinedContextData(n),a=this.getCombinedDataBagData(n);this.recordBiEvent({eventName:"panelaction",data:{...this.windowSlotContext,...a,...PU({...i,...e})}},t),this.eventTimeTracker?.markEvent(`${e.actionOutcome}-${e.actionScenario}-${e.panelType}-${e.threadType}`)},this.setBISlotContext=e=>{this.windowSlotContext={...this.windowSlotContext,...e}},this.createDatabag=()=>{const e=new _U.I;return this._dataBags.push(e),e.setDispose((async()=>{await(0,kh.y)(0);const t=this._dataBags.findIndex((t=>t.id===e.id));this._dataBags.splice(t,1)})),e},this.appendBiData=(e,t)=>{const{dataBag:n,...i}=t,a=xU(GR.E0,e);this.dataBagContextData[a]={...this.dataBagContextData[a],...n?.data},this.panelContextData[a]={...this.panelContextData[a],...i}},this.removeBiData=(e,t)=>{const n=xU(GR.E0,e);if(t)for(const e of t)this.dataBagContextData&&delete this.dataBagContextData[n]?.[e],this.panelContextData&&delete this.panelContextData[n]?.[e];else delete this.dataBagContextData[n],delete this.panelContextData[n]},this.recordTestOnlyTelemetry=()=>{const e=this.context?.settings.telemetry.testOnlyUserbiTelemetry;if(e)try{this.recordPanelAction(JSON.parse(e))}catch(e){}},this.context?.authenticationUser&&(this.userContextId=this.context.authenticationUser.id),this.context?.settings){const{telemetry:{disableRingNamePrefixing:e,observable:t,enableTestOnlyTelemetry:n},calling:{enableCallingPerfCollectorService:i,enableCallingLongTasksTracking:a,enableCallingLongTasksTriggerFinder:o}}=this.context.settings;this.metadataSubscription=this.context.settings.metadata.observable.subscribe((t=>{this.experimentationEventData=function(e,t,n){const i={},a=TU(e,t,n);return i["UserInfo.Ring"]=a.ring,i["UserInfo.ETag"]=a.eTag,i["UserInfo.HostETag"]=a.hostETag,i["AppInfo.ExpIds"]=a.expIds,i["AppInfo.ExpRolloutIds"]=a.rolloutIds,i["AppInfo.Environment"]=a.environment,i}(t,!!e,this.context?.experimentationService)})),this.telemetrySettingsSubscription=t.subscribe((e=>this.onReceiveTelemetrySettings(e))),this.clientType=this.context.platformService?.config.clientType,this.clientType===nt.sK.Maglev&&this.windowId!==d.N2&&this.subscribeToMaglevWindowState(),i&&a&&o&&(this.eventTimeTracker=FU()),n&&this.recordTestOnlyTelemetry()}}getEventsWithinTimeframe(e,t){return this.eventTimeTracker?.getEventsBetween(e,t)||[]}getWindowId(){return this.windowId}destroy(){this.metadataSubscription&&this.metadataSubscription.unsubscribe(),this.telemetrySettingsSubscription&&this.telemetrySettingsSubscription.unsubscribe(),this.windowStateSubcription$&&this.windowStateSubcription$.unsubscribe(),this.unregisterForWindowStateChanged&&this.unregisterForWindowStateChanged(),this._dataBags.length&&(this._dataBags=[])}bubbleUpObservable(e){this.biEventObserver.next(e),this.context?.parentUserBiService?.bubbleUpObservable?.(e)}observe(){return this.biEventObserver.asObservable()}onReceiveTelemetrySettings(e){this.telemetrySettings=e}get environment(){return this.context?.settings.metadata.environment}recordBiEvent(e,t){this._applyContextData(e);const n=function(e){const t={};return Object.keys(e).forEach((n=>{(0,we.isNil)(e[n])||(t[n]=e[n])})),t}(e.data),i="EventInfo.Identifier"in e.data?e.data["EventInfo.Identifier"]:void 0;this.sendTelemetry(e.eventName,n,this.telemetrySettings.enableUserBiEventIdentifiers?i:void 0),t&&(t.debug(`Analytics: EventType: ${e.eventName}`),t.debug(`Analytics: Type: ${n["Panel.Type"]}`),t.debug("Analytics: Payload:",n)),this.bubbleUpObservable({eventName:e.eventName,data:n})}sendTelemetry(e,t,n){this.context?.telemetrySender?this.context.telemetrySender.sendTelemetry(yU.Q.UserBI,e,t,void 0,void 0,n,this.userContextId):(0,hi.wW)(yU.Q.UserBI,e,t,void 0,void 0,n,this.userContextId)}_applyContextData(e){e.data["Panel.WindowID"]=this.windowId,e.data["EventInfo.CorrelationId"]=this.context?.correlation?.id;const t=this.windowIsVisible??this.context?.windowProvider.isFocused();e.data["Window.Focus"]=t?JB.To.foreground:JB.To.background;const n=t?JB.PY.maximized:JB.PY.minimized;if(e.data["Window.Status"]=n,e.data["Window.Height"]=this.context?.windowProvider.innerHeight,e.data["Window.Width"]=this.context?.windowProvider.innerWidth,e.data["Window.ViewportContext"]=this.context?.windowProvider.viewportContext,this.context?.authenticationUser){const t=this.environment===$a.B.life?this.context?.authenticationUser.profile.paddedMsaId:this.context?.authenticationUser.profile.objectId;e.data["UserInfo.Id"]=t,e.data["UserInfo.TenantId"]=this.context?.authenticationUser.profile.tenantId}e.data={...e.data,...this.experimentationEventData}}getCombinedContextData(e){let t={};if(e)for(const n of e){const e=xU(GR.E0,n);t={...t,...this.panelContextData[e]}}return t}getCombinedDataBagData(e){let t={};if(e)for(const n of e){const e=xU(GR.E0,n);t={...t,...this.dataBagContextData[e]}}return t}async subscribeToMaglevWindowState(){if(!this.windowControlsModule&&this.context&&this.context.hostCommunicationService){this.windowControlsModule=await this.context.hostCommunicationService.loadModule("windowcontrols"),this.windowState$=new Qe.c((e=>{this.windowControlsModule&&this.windowControlsModule.registerForWindowStateChanged&&(this.unregisterForWindowStateChanged=this.windowControlsModule?.registerForWindowStateChanged((t=>{if(!t.windowId||this.windowId&&t.windowId===this.windowId){const n=!t.placement.minimized;e.next(n)}})))}));const e=e=>{this.windowIsVisible=e};this.windowStateSubcription$=this.windowState$.subscribe(e)}}}function PU(e){const{appName:t,actionGesture:n,actionOutcome:i,actionOutcomeNew:a,actionScenario:o,actionScenarioType:r,actionWorkload:s,actionSubworkload:l,actionInputDelay:c,moduleName:d,moduleType:u,extensibilityData:m,tabId:p,tabIdNew:g,tabOrdinal:h,tabType:v,eventIdentifier:y,appId:S,appIsTenantApp:f,appCapabilityId:k,appScenarioCapability:C,appScope:b}=e,w=xU(GR.Sn,d),T=xU(GR.nR,u),I=xU(GR.Od,n),N=xU(GR.vB,o),A=(0,we.isNil)(y)?[w,T,I,N].filter(Boolean).join("_"):xU(GR.AJ,y),E={"Action.Gesture":n,"Action.InputDelay":c,"Action.Outcome":i,"Action.OutcomeNew":a,"Action.Scenario":o,"Action.ScenarioType":r,"Action.WorkLoad":s,"Action.SubWorkLoad":l,"Module.Name":d,"Module.Type":u,"Tab.Id":p,"Tab.Type":v,"Tab.IdNew":g,"Tab.Ordinal":h,"App.Name":t,"App.Id":S,"App.IsTenantApp":f,"App.CapabilityId":k,"App.ScenarioCapability":C,"App.Scope":b,...RU(e),...MU(m)};return A&&(E["EventInfo.Identifier"]=A),E}function MU(e){if(e&&!(0,we.isEmpty)(e))return{"App.Id":e.id,"App.Name":e.name,"App.Scope":xU(SU.bY,e.scope),"App.ScenarioCapability":xU(SU.n3,e.scenarioCapability),"App.EntryPoint":xU(SU.f4,e.entryPoint),"App.ExternalId":e.externalId,"App.IsTenantApp":e.isTenantApp,"App.CapabilityId":e.capabilityId,"App.SceneId":e.sceneId,"Bot.Id":e.botId,"App.MsftPartnerAppID":e.mpnId,"App.Source":xU(fU.NS,e.appDetailsEntryPoint),"App.FromSectionName":e.fromSectionName,"App.Capabilities":e.capabilities,"App.BotScopes":e.botScopes,"App.GalleryTabScopes":e.galleryTabScopes,"App.StaticTabScopes":e.staticTabScopes,"App.StaticTabName":e.staticTabName,"App.ConnectorScopes":e.connectorScopes,"App.ConnectorId":e.connectorId,"App.Version":e.version,"App.ManifestVersion":e.manifestVersion,"App.Categories":e.categories,"App.IsHostedApp":e.isHostedApp,"App.AppSource":e.appSource,"App.EventType":e.eventType,"App.DraftId":e.draftId,"App.LinkUnfurlingType":e.linkUnfurlingType,"App.AppSharingProtocol":e.sharingProtocol,"App.platformTimeInApp":e.platformTimeInApp,"App.IsNewAdminPreInstalledApp":e.isNewAdminPreInstalledApp,"App.IsCopilotPlugin":e.isCopilotPlugin,"App.SuggestedActionTitle":e.suggestedActionTitle}}function RU(e){const{panelRegion:t,panelType:n,threadId:i,teamId:a,deeplinkId:o,threadMembers:r,threadType:s,panelLaunchMethod:l,panelUri:c,dataBag:d,extensibilityData:u,eventIdentifier:m,entityType:p,mainSlotApp:g,mainEntityType:h,mainEntityAction:v,officeGroupId:y,moduleName:S,moduleType:f,meetingId:k,callId:C,participantId:b}=e,w=xU(GR.rP,t),T=xU(GR.HP,n);return{"Panel.LaunchMethod":l,"Panel.Region":t,"Panel.Type":n,"Panel.Uri":c,"Module.Name":S,"Module.Type":f,"Thread.Id":i,"Team.Id":a,"Deeplink.Id":o,"Team.OfficeGroupId":y,"Meeting.Id":k,"Call.Id":C,"Participant.Id":b,"Thread.Type":s,"Thread.Members":r,"TargetThread.Id":i,"TargetThread.Type":s,"EventInfo.Identifier":(0,we.isNil)(m)?[w,T].filter(Boolean).join("_"):xU(GR.AJ,m),"Entity.Type":p,...d&&d.data,...MU(u),"UserInfo.ChannelResourceTenant.Id":e["UserInfo.ChannelResourceTenant.Id"],"SlotConfig.MainSlotApp":g,"SlotConfig.MainEntityType":h,"SlotConfig.MainEntityAction":v}}function xU(e,t){return(0,we.isNil)(t)?void 0:e[t]}class LU{create(e,t,n,i,a,o,r){const s=new Vi(i),l=new vU({...e,loggerFactory:s},n,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o),d=new DU(t),u=new HB(s.newLogger("SetUserOnTelemetryContextTask","core-services-telemetry"),o),m={coreScenarioFactory:l,userBiService:d,loggerFactory:s,telemetryContext:u,telemetryService:new OU(l,u,a,{isolateUserContext:r.get(c.w.Telemetry).isolateUserContext??!1})};return LU._cache.set(o,m),m}destroy(e){if(e){const t=LU._cache.get(e);t&&(t.coreScenarioFactory.destroy?.(),t.userBiService.destroy?.(),LU._cache.delete(e))}}get(e){let t;return e&&(t=LU._cache.get(e)),t}clear(){LU._cache.clear()}forEach(e){LU._cache.forEach(e)}}LU._cache=new Map;class OU{constructor(e,t,n,i){this.coreScenarioFactory=e,this.coreTelemetryContext=t,this.memoryAnalyzer=n,this.isolateUserContext=!1,this.scenarioCancelOnNetworkStateChangeBlockList=new Set,this.scenarioCancelOnSuspendStateChangeBlockList=new Set,this.newCoreScenario=(e,t)=>this.coreScenarioFactory.newScenario(e,t),this.stopCoreScenarioIfActive=(e,t,n)=>this.coreScenarioFactory.stopScenarioIfActive(e,t,n),this.createScenarioFactory=(e,t,n,i,a,o="")=>{const{coreSettings:r}=e,{enableCreateWindowLaunchScenarioOnMainWindow:s}=r.get(c.w.Core);return new vU({settings:mU(r),parentScenarioFactory:e.scenarioFactory,platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:n},parseInt(n.startTimestamp,10)||Date.now(),this.memoryAnalyzer,t,i,this.coreInitTimestamp,!!s||t!==d.N2,void 0,void 0,void 0,{"Window.ViewportContext":a},o||this.coreTelemetryContext.userId)},this.createUserBiService=(e,t,n)=>new DU({authenticationUser:e.authenticationUser,settings:uU(e.coreSettings),windowProvider:e.windowProvider,platformService:e.platformService,experimentationService:e.experimentationService,hostCommunicationService:e.hostCommunicationService,client:e.client,localStorage:e.localStorage,parentUserBiService:e.userBiService,correlation:n},t),this.setCoreContext=(e,t,n)=>{this.coreTelemetryContext.setContext(e,t,n)},this.setContext=(e,t,n,i="")=>{this.coreTelemetryContext.setContext(e,t,n,i)},this.setDeviceAuthToken=e=>{this.coreTelemetryContext.setDeviceAuthToken(e)},this.setUserId=e=>{this.coreTelemetryContext.setUserId(e)},this.getTelemetryContextService=()=>this.coreTelemetryContext,this.setTelemetryContextService=e=>{this.coreTelemetryContext=e},this.logOutUser=e=>{(0,Pt.AR)().logOutUser(e)},this.onHostStateChange=e=>{if(e.suspendedState===Ba.tJ.Suspending&&e.suspendedState!==this.previousHostSuspendState){const e=e=>{this.scenarioCancelOnSuspendStateChangeBlockList.has(e.name)||e.cancel({reason:"suspending"})};this.getTelemetryServicesCache().forEach((t=>{t.coreScenarioFactory.processOnRunningScenarios(e)})),this.coreScenarioFactory.processOnRunningScenarios(e)}this.previousHostSuspendState=e.suspendedState},this.onNetworkStateChange=e=>{if((0,Pt.AR)().setOnlineState(e!==Pg.Q.Offline),e===Pg.Q.Offline){const e=e=>{this.scenarioCancelOnNetworkStateChangeBlockList.has(e.name)||e.cancel({reason:"network offline"})};this.getTelemetryServicesCache().forEach((t=>{t.coreScenarioFactory.processOnRunningScenarios(e)})),this.coreScenarioFactory.processOnRunningScenarios(e)}},OU._telemetryServicesCache||(OU._telemetryServicesCache=new LU);const{isolateUserContext:a}=i;this.isolateUserContext=a}destroy(){this.telemetrySuspendStateSubscription?.unsubscribe(),this.telemetryNetworkStateSubscription?.unsubscribe()}getMemoryAnaylzer(){return this.memoryAnalyzer}setCoreInitTime(e){this.coreInitTimestamp=e,this.coreScenarioFactory.setCoreInitTime?.(e)}setAuthContext(e){const{id:t,oid:n,tid:i,type:a,role:o,subType:r,isCrossCloudUser:s,isExternal:l,homeAccountId:c,homeTenantId:d,userCloud:u}=e,m=(e,n)=>{this.isolateUserContext?this.setContext(e,n,void 0,t):this.setCoreContext(e,n)};void 0!==t&&m("userId",t===n?"":t),void 0!==n&&m("UserInfo.Id",n),void 0!==i&&m("UserInfo.TenantId",i),void 0!==a&&m("UserInfo.Type",a),void 0!==o&&m("UserInfo.Role",o),void 0!==c&&this.setContext("UserInfo.HomeAccountId",c,void 0,t),void 0!==d&&this.setContext("UserInfo.HomeTenantId",d,void 0,t),void 0!==r&&m("UserInfo.SubType",r),void 0!==u&&this.setContext("UserInfo.HomeCloud",u,void 0,t),void 0!==s&&this.setContext("UserInfo.IsCrossCloudUser",s,void 0,t),void 0!==l&&m("UserInfo.IsExternal",l)}getTelemetryServicesCache(){return OU._telemetryServicesCache}initTelemetrySuspendStateSubscription(e,t){this.telemetrySuspendStateSubscription||(this.scenarioCancelOnSuspendStateChangeBlockList=new Set(t),this.telemetrySuspendStateSubscription=e.observe().subscribe(this.onHostStateChange))}initTelemetryNetworkStateSubscription(e,t){this.telemetryNetworkStateSubscription||(this.scenarioCancelOnNetworkStateChangeBlockList=new Set(t),this.telemetryNetworkStateSubscription=e.observe().subscribe(this.onNetworkStateChange))}}class jU extends xp{constructor(){super(d.c1.SetUserOnTelemetryContext,["authenticationService","authenticationUser","config","coreSettings","correlation","diagnosticsService","discover","hostCommunicationService","loggerFactory","platformService","scenarioFactory","telemetryContextService","telemetryService","windowProvider"])}async execute(e){const{authenticationUser:t,coreSettings:n,loggerFactory:i,authenticationService:a,correlation:o,telemetryContextService:r,telemetryService:s,discover:l}=e;let d=!1;const u=i.newLogger("SetUserOnTelemetryContextTask","core-services-tasks");let m;if(n.get(c.w.Telemetry).useTelemetryServicesCache&&(m=s.getTelemetryServicesCache().get(t.id)),m)e.loggerFactory=m.loggerFactory,e.scenarioFactory=m.coreScenarioFactory,e.telemetryService=m.telemetryService,e.userBiService=m.userBiService,e.telemetryContextService=m.telemetryContext;else{const i=t.type===pg.aS.MsaLife||n.get(c.w.Metadata).environment===$a.B.life,a=new HB(u,t.id);e.loggerFactory=new Vi(e.diagnosticsService,e.correlation.id,t.id);const o=new vU({parentScenarioFactory:e.scenarioFactory,settings:mU(e.coreSettings),platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:e.correlation},e.config.startTimeMS,e.telemetryService?.getMemoryAnaylzer(),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.id);if(e.scenarioFactory=o,e.telemetryService=new OU(o,a,e.telemetryService?.getMemoryAnaylzer(),{isolateUserContext:n.get(c.w.Telemetry).isolateUserContext??!1}),i){t.profile.paddedMsaId=this.getPaddedMsaId(t.profile.objectId,u);const e=await l.getConsumerLicenseDetails(void 0,(0,Wh.$q)("create-user-telemetry-context-task:execute")),{copilotSkuIdForTFL:i}=n.get(c.w.Messaging),a=i||"CFQ7TTC0MNTQ";d=!!e?.consumerLicenseDetails?.licensedProducts?.find((e=>e?.skuId===a))}this.setAuthUserOnTelemetryContext(e.telemetryService,t,i),this.markServiceWorkerState(e.telemetryService,e.windowProvider,e.config.basePath)}const p=n.get(c.w.Telemetry),g=p?.ocpsSendTelemetry?.replace(/\s/g,""),{registerForUserContext:h,notifyPrivacyDataControlsEnabled:v,registerOcpsTelemetryCategory:y}=await this.initializeUserHostComms(e.authenticationUser.id,e.hostCommunicationService,u);if(v&&l.getUser((0,Wh.$q)("create-user-telemetry-context-task:execute")).then((e=>{v(e.isPrivacyDataControlEnabled??!1)})),y)try{y(t.id,t.profile.tenantId,g)}catch(e){u.errorToTelemetry&&u.errorToTelemetry("Failed to initiate setOcpsTelemetryCategory call","telemetry_instrumentation_update_user_context")}const S=h?.(((t,n,i)=>{e.telemetryService.setContext(t,i,void 0,n)})),f=this.subscribeAndSetUserInfoTelemetryContext(e.telemetryService,t,n,d),k=this.subscribeAndSetSmbTenantSegmentTelemetryContext(e.telemetryService,n),C=n.get(c.w.Telemetry).disableMTMAPrimaryId??!1;yM(C,r,a,o,u),e.authenticationService.registerEndTelemetryTask?.((async e=>{S&&S(),s.setContext("UserInfo.IsMRU",void 0,void 0,e),f.unsubscribe(),k.unsubscribe();try{await yM(C,r,a,o,u)}catch(e){u.errorToTelemetry?.("Failed to update MRU or sync mtma context","telemetry_instrumentation_update_user_context")}await(0,Pt.AR)().flush(),(0,Pt.AR)().logOutUser(e),n.get(c.w.Telemetry).useTelemetryServicesCache&&s.getTelemetryServicesCache().destroy(e)}))}async initializeUserHostComms(e,t,n){const i={};try{const n=await t.loadModule("telemetry"),{registerForOnNewContext:a,setPdcEeaStatus:o,setOcpsTelemetryCategory:r}=n??{};a&&(i.registerForUserContext=t=>a((n=>{n.filter((t=>t.userContextId===e)).forEach((n=>t(n.column,e,n.value)))}))),o&&(i.notifyPrivacyDataControlsEnabled=o),r&&(i.registerOcpsTelemetryCategory=r)}catch(e){n.errorToTelemetry&&n.errorToTelemetry(kr.LoadModuleTelemetryFailed,"webclient_framework_host_comms",void 0,!0)}return i}subscribeAndSetUserInfoTelemetryContext(e,t,n,i){return n.getObservable(c.w.UserResources).subscribe((n=>{const a=n.licenseType||void 0;switch(a?e.setContext("UserInfo.LicenseType",a):i&&e.setContext("UserInfo.LicenseType","Copilot"),t.role){case pg.a7.Member:n.isTenantAdmin||void 0?e.setContext("UserInfo.TenantRole",JB.VA.Admin):e.setContext("UserInfo.TenantRole",JB.VA.Regular);break;case pg.a7.Guest:e.setContext("UserInfo.TenantRole",JB.VA.Guest);break;case pg.a7.Anonymous:e.setContext("UserInfo.TenantRole",JB.VA.Anonymous)}}))}subscribeAndSetSmbTenantSegmentTelemetryContext(e,t){return t.getObservable(c.w.Smb).subscribe((t=>{const n=t.tenantSizeSegment||void 0;n&&e.setContext("Tenant.SmbTenantSizeSegment",n)}))}async markServiceWorkerState(e,t,n){const i=await async function(e,t){let n;if("serviceWorker"in e.navigator)try{const i=await e.navigator.serviceWorker.getRegistration(t);i&&(i.active?n=i.active:i.waiting?n=i.waiting:i.installing&&(n=i.installing))}catch{}return n?.state||"NotFound"}(t,n?`/${n}/serviceworker.js`:"/serviceworker.js");e?.setCoreContext("AppInfo.ServiceWorkerState",i)}setAuthUserOnTelemetryContext(e,t,n){n&&t.profile.paddedMsaId&&this.setUserContext(e,t.profile.paddedMsaId);const i=n&&t.profile.paddedMsaId?t.profile.paddedMsaId:t.profile.objectId;e.setContext("UserInfo.Id",i),e.setContext("UserInfo.TenantId",t.profile.tenantId),e.setContext("UserInfo.Type",t.type),e.setContext("UserInfo.Role",t.role)}setUserContext(e,t){const n=t.slice(19).replace("-","");e.setUserId(t),e.setContext("UserInfo.Id",t),e.setContext("userId",n)}getPaddedMsaId(e,t){try{if(/(\w{8})-(\w{4})-(\w{4})-(\w{4})-(\w{12})/.exec(e)&&e.startsWith("00000000-0000-0000-"))return e;{const t=(0,we.padStart)(e,32,"0"),n=/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/;return t.replace(n,"$1-$2-$3-$4-$5")}}catch(e){return void t.error("failed_user_padding")}}}class BU extends xp{constructor(){super(d.c1.CreateUserTelemetryServicesTask,["telemetryService","authenticationUser","diagnosticsService","coreSettings","loggerFactory","windowProvider","correlation","platformService","experimentationService","hostCommunicationService","client","scenarioFactory"])}async execute(e){const{authenticationUser:t,diagnosticsService:n,telemetryService:i,coreSettings:a,loggerFactory:o,windowProvider:r,correlation:s,platformService:l,experimentationService:d,hostCommunicationService:u,client:m,scenarioFactory:p}=e;a.get(c.w.Telemetry).useTelemetryServicesCache&&!i.getTelemetryServicesCache().get(t.id)&&i.getTelemetryServicesCache().create({settings:mU(a),loggerFactory:o,windowProvider:r,correlation:s,parentScenarioFactory:p},{authenticationUser:t,settings:uU(a),windowProvider:r,platformService:l,experimentationService:d,hostCommunicationService:u,client:m},Date.now(),n,i.getMemoryAnaylzer(),t.id,a)}}const UU="serviceWorkerDeferInstallDurationInMs",$U="enableServiceWorkerIntegrityCheck",WU="enableServiceWorkerDynamicManifest",VU="localeSettingValue",HU="environment",zU="clientType",qU="swHandleCdlHashRoute",GU="platformId",YU="enableServiceWorkerIndexMismatchCheck",QU="enableServiceWorkerBatchInstall",JU="disableServiceWorkerFetchWithVersion",KU="teams-service-worker-telemetry-v2",ZU="1",XU="LogEvents",e$="timestamp",t$="teams-service-worker-v2",n$="2",i$="SwState",a$="key";var o$,r$,s$,l$;!function(e){e.Install="install",e.Activate="activate",e.Fetch="fetch"}(o$||(o$={})),function(e){e.Intermediate="intermediate",e.Old="old"}(r$||(r$={})),function(e){e.Info="sw_info",e.InstallSuccess="sw_install_success",e.InstallFailure="sw_install_failure",e.ActivateSuccess="sw_activate_success",e.ActivateFailure="sw_activate_failure",e.FetchCacheMiss="sw_fetch_cache_miss",e.CleanupCacheSuccess="sw_cleanup_cache_success",e.CleanupCacheFailure="sw_cleanup_cache_failure",e.CleanupCacheRetry="sw_cleanup_cache_retry",e.CleanupNotRun="sw_cleanup_cache_not_run",e.CleanupNotRequired="sw_cleanup_cache_not_required",e.CorruptCache="sw_corrupt_cache",e.CorruptCacheDeleteSuccess="sw_corrupt_cache_delete_success",e.CorruptCacheDeleteFailure="sw_corrupt_cache_delete_failure",e.DeferInstallStarted="sw_install_defer_started",e.DeferInstallCancelled="sw_install_defer_cancelled",e.DeferInstallCancelledOnMaxIncomplete="sw_install_defer_cancelled_max_incomplete",e.DeferInstallOldCacheCleanupInProgress="sw_install_defer_old_cache_cleanup_inprogress",e.DeferInstallTimerCompleted="sw_install_defer_timer_completed",e.DeferInstallRetryAttempted="sw_install_defer_retry",e.ResetInstallIncompleteCounterFailure="sw_install_reset_counter_failure",e.ResetCacheCleanupStateFailure="sw_reset_cache_cleanup_state_failure",e.InstallIntegrityCheckPerformed="sw_install_integrity_check_performed",e.ReadIndexedDbFailure="sw_read_indexeddb_failure",e.AssetSetGenerationFailure="sw_asset_set_generation_failure",e.WriteIndexedDbFailure="sw_write_indexeddb_failure",e.FetchSWAssetsUsingSendMessage="sw_fetch_assets_using_send_message",e.VersionMismatch="sw_build_version_mismatch"}(s$||(s$={})),function(e){e.Start="start",e.Success="success",e.Failure="failure",e.CacheMiss="cache_miss",e.HighLatency="high_latency",e.CDNAssetNotInManifest="cdn_asset_not_in_manifest",e.OfflineAssetStart="offline_asset_start",e.OfflineAssetSuccess="offline_asset_success",e.OfflineAssetFailure="offline_asset_failure",e.OfflineAssetCacheMiss="offline_asset_cache_miss"}(l$||(l$={}));const c$=3e5,d$=18e4,u$=72e5,m$=18e5,p$="serviceWorkerCheckingForUpdates",g$="serviceWorkerMaxUpdateFailureCountReached",h$="previousSuccessfulInstalledBuild",v$="serviceWorkerRegistrationNotFound",y$="lastUpdateCheckTimestamp",S$=5,f$=1e4,k$=3,C$=5,b$=72e5,w$="fundamentals_performance_sw_fetch",T$="fundamentals_performance_sw_offline_fetch";var I$=n(269996);class N${constructor(e){this.context=e,this.fetchTelemetryStore=new Map,this.webClientUpdateSkipped=!1,this.swEnableIntegrityCheck=!1,this.enableServiceWorkerBatchInstall=!1,this.isSwInstalling=!1,this.isSwWaiting=!1,this.sWRegistrationAttempt=0,this.sWRegistrationTrialCounter=0,this.serviceWorkerUpdateFailureCount=0,this.basePath=this.context.config.basePath,this.loggerFactory=this.context.loggerFactory,this.logger=this.loggerFactory.newLogger("WebClientUpdateService","services-io-browser-web-client-update"),this.rebootService=this.context.rebootService,this.host=this.context.windowProvider,this.scenarioFactory=this.context.scenarioFactory,this.coreSecurityService=this.context.coreSecurityService,this.localStorage=this.context.localStorage,this.clientStateProvider=this.context.clientState,this.checkServiceWorkerVersion();try{this.swRegisterUrlPolicy=this.coreSecurityService.getTrustedTypePolicy("@msteams/services-io-browser-web-client-update#register-service-worker"),this.trustedScriptUrl=this.swRegisterUrlPolicy?.createScriptURL(`/${this.basePath}/serviceworker.js`,this.host.location.origin)}catch(e){e instanceof Ff.a&&Va.C.isFunction(e.toTelemetryEntry)?this.logger.errorToTelemetry?.(`trusted sw scripturl error: ${e.toTelemetryEntry()}`,"fundamental_performance_trusted_sw_scripturl",void 0,!0):this.logger.errorToTelemetry?.(`create register service worker url trustedtype policy failed - ${e}`,"fundamental_performance_trusted_sw_scripturl",void 0,!0)}this.enableSWSubscription=this.context.coreSettings.getObservable(c.w.Core,["enableServiceWorker"]).subscribe((({enableServiceWorker:e})=>{this.registerOrUnregisterServiceWorker(!!e)})),this.addUpdateServiceWorkerSettings(this.context.coreSettings.get(c.w.Core),!1),this.swSettingsSubscription=this.context.coreSettings.getObservable(c.w.Core).subscribe((e=>{this.addUpdateServiceWorkerSettings(e,!0)})),this.clientStateSubscription=this.clientStateProvider.observe().subscribe((e=>this.handleClientStateChange(e)))}cleanup(){this.enableSWSubscription.unsubscribe(),this.swSettingsSubscription.unsubscribe(),this.clientStateSubscription.unsubscribe(),this.clearTimer()}checkForUpdateAndRestartWebClient(){this.addHandlerForOnUpdateFound(),this.registerAndCheckForServiceWorkerUpdates()}SendIncompleteEvent(e,t){this.fetchTelemetryStore.set(e.url,e),this.sendServiceWorkerFetchEventTelemetryInCompleteEvent(t)}setServiceWorkerContextForScenarios(e=!1){e?this.setScenarioContext(e):this.getServiceWorkerRegistration().then((e=>{this.setScenarioContext(!!e)})).catch((e=>{this.logger.error(`Error getting Service Worker registration object: ${e}`)}))}async unregisterServiceWorker(e,t=!0){const n=t?"fundamentals_performance_sw_unregister":"fundamentals_performance_t1_sw_unregister_from_t2";"serviceWorker"in this.host.navigator&&(this.getServiceWorkerRegistration(t).then((t=>{t&&t.unregister().then((t=>{this.logger.infoToTelemetry?.(e,n,void 0,!0)}))})).catch((e=>{this.logger.errorToTelemetry?.(`${n} - ${e}`,n,void 0,!0)})),this.deleteCacheStorage(e,t?d.Xk:d.qj),this.clearTimer())}handleOnStateChange(e,t,n,i,a){switch(this.sendServiceWorkerLifeCycleEventTelemetry(),t){case"installed":this.handleInstalledSWState(i,a);break;case"activated":this.logger.infoToTelemetry?.(`Service worker is activated version - ${a}`,"service_worker_activated",{context:a},!0);const t=this.context.platformService.config.buildVersion;this.context.platformService.config.buildVersion!==a&&this.logger.errorToTelemetry?.(`Service worker activated version ${a} is different from current build version ${t}`,"service_worker_version_mismatch",{context:a},!0),this.isSwWaiting=!1;const o=this.scenarioFactory.findScenario(be.Cu.SwStateChange);o&&(this.scenarioFactory.markStep(be.Cu.SwStateChange,be.BQ.SwActivated),o.stop()),this.setServiceWorkerContextForScenarios(!0);break;case"redundant":this.handleRedundantSWState(e,n,a)}e={state:t}}handleRedundantSWState(e,t,n){this.logger.infoToTelemetry?.(`Service worker is redundant version - ${n}`,"service_worker_redundant",{context:n},!0),"installing"===e.state?(this.isSwInstalling=!1,this.scenarioFactory.markStep(be.Cu.SwStateChange,be.BQ.SwInstallFailure),t.cancel({reason:"New service worker found before installing complete"}),this.serviceWorkerUpdateFailureCount++,this.triggerForceUpdate()):"installed"===e.state&&(this.isSwWaiting=!1),this.setServiceWorkerContextForScenarios(!0)}triggerForceUpdate(){this.serviceWorkerUpdateFailureCount>=S$&&(this.logger.error("Will force an update when the app is idle as SW update failed repeatedly with",g$),this.handleUpdateReady("Forced"))}handleInstalledSWState(e,t){this.logger.infoToTelemetry?.(`Service worker is installed version - ${t}`,"service_worker_installed",{context:t},!0),t&&this.localStorage.trySet(h$,t,"Fundamental_Performance"),this.isSwInstalling=!1,this.isSwWaiting=!0,this.setServiceWorkerContextForScenarios(!0),this.scenarioFactory.markStep(be.Cu.SwStateChange,be.BQ.SwInstalled),"storage"in this.host.navigator&&"estimate"in this.host.navigator.storage&&this.host.navigator.storage.estimate().then((e=>{const t=e.usageDetails,n={storageUsage:e.usage,storageQuota:e.quota,cacheStorageSize:t?.caches,indexedDBSize:t?.indexedDB,swRegSize:t?.serviceWorkerRegistrations};this.logger.infoToTelemetry?.("Teams disk footprint","fundamentals_performance_user_storage_info",n),this.logger.log(`Teams disk footprint: ${JSON.stringify(n)}`)})),mt(this.host)&&this.scenarioFactory.stopScenarioIfActive(be.Cu.SwStateChange),e||this.handleUpdateReady(t),this.serviceWorkerUpdateFailureCount=0}logServiceWorkerTelemetry(){this.sendServiceWorkerFetchEventTelemetry(),this.recurringSendSWFetchEventTelemetryInterval=this.host.setInterval(this.sendServiceWorkerFetchEventTelemetry.bind(this),c$),this.sendServiceWorkerLifeCycleEventTelemetry()}sendServiceWorkerLifeCycleEventTelemetry(){const e=parseInt(ZU,10);(0,I$.sD)(KU,e,XU,e$,this.scenarioFactory,!0).then((e=>{if(void 0!==e){let t=0;const n=this.recentProcessedLifeCycleEventTimestamp??-1;e.map((e=>{const i=e.timestamp??0;i>n&&(this.sendServiceWorkerLifeInfoAndInstallTelemetry(e),t=Math.max(t,i))})),this.recentProcessedLifeCycleEventTimestamp=t}})).catch((e=>{this.logger.error("Error fetching service worker state telemetry. Error:",e)})).then((()=>(0,I$.l0)(KU,e,XU,e$,this.scenarioFactory).catch((e=>{this.logger.error("Error deleting service worker state telemetry. Error:",e)}))))}sendServiceWorkerLifeInfoAndInstallTelemetry(e){const t={version:e.version,type:e.type,context:e.buildVersion},n=e.message||"";switch(e.type){case s$.DeferInstallStarted:this.logger.infoToTelemetry?.(`SW install start, ${n}`,"fundamentals_performance_sw_install",t,!0);break;case s$.InstallSuccess:this.logger.infoToTelemetry?.(`SW install success, ${n}`,"fundamentals_performance_sw_install",t,!0);break;case s$.InstallFailure:this.logger.errorToTelemetry?.(`SW install failure, ${n}`,"fundamentals_performance_sw_install",t,!0);break;case s$.VersionMismatch:this.logger.warnToTelemetry?.(`SW install version mismatch, ${n}`,"fundamentals_performance_sw_install",t,!0);break;case s$.ActivateSuccess:this.logger.infoToTelemetry?.(`SW activate success, ${n}`,"fundamentals_performance_sw_activate",t,!0);break;case s$.ActivateFailure:this.logger.errorToTelemetry?.(`SW activate failure, ${n}`,"fundamentals_performance_sw_activate",t,!0);break;case s$.ReadIndexedDbFailure:this.logger.errorToTelemetry?.(`SW read indexedDB failure, ${n}`,"fundamentals_performance_sw_read_indexed_db",t,!0);break;default:this.logger.infoToTelemetry?.(`SW state change info, ${e.type}, ${n}`,"fundamentals_performance_sw_state_info",t,!0)}}async registerServiceWorker(){if(this.shouldSkipUpdateWhenVeryActive())return this.webClientUpdateSkipped=!0,void this.logger.infoToTelemetry?.("SW registration skipped for very active user","service_worker_update_skipped");this.webClientUpdateSkipped=!1;const{serviceWorkerRegistrationScenarioTimeoutInMs:e,maxSWRegistrationTrialAllowed:t}=this.context.coreSettings.get(c.w.Core),n=this.scenarioFactory.findScenario(be.Cu.SwRegistration)??this.scenarioFactory.newScenario(be.Cu.SwRegistration,{timeoutMs:e??b$});n.isPaused&&n.resume(),this.attemptSWRegistration().then((async e=>{this.sWRegistrationTrialCounter=0;try{let t="";const i=e.installing;i&&(t=await pt(this.host,i,this.logger),n?.appendEventData({context:t}))}catch{this.logger.error("Get registerred SW version failed.")}n.stop(),this.attachEventsToInstallingServiceWorker(e,!0)})).catch((e=>{n?.appendEventData({retryCount:this.sWRegistrationTrialCounter,message:`SW registration attempt ${this.sWRegistrationAttempt} failed with ${e}`}),this.sWRegistrationAttempt<k$?this.sWRegistrationRetryTimer=this.host.setTimeout((()=>this.registerServiceWorker()),f$):this.sWRegistrationTrialCounter<(t??C$)?(n.pause({reason:d.O4.Paused,pauseReason:`SW Registration trial ${this.sWRegistrationTrialCounter} attempt ${this.sWRegistrationAttempt} Failed. Retry  after 2 hours`,message:e}),this.sWRegistrationAttempt=0):(this.sWRegistrationTrialCounter=0,this.sWRegistrationAttempt=0,this.context.networkState?.isOnline()?(n.mark(be.BQ.checkNetworkConnection),this.checkNetworkConnection().then((t=>{t.ok?n.fail({message:`SW reg is failing due to ${e} & response status: ${t.status}, content-length: ${t.headers.get("Content-Length")}, Content-Encoding:${t.headers.get("Content-Encoding")}`}):n.cancel({message:`SW reg is failing due to ${e} & response status: ${t.status}, content-length: ${t.headers.get("Content-Length")}, Content-Encoding:${t.headers.get("Content-Encoding")}`})})).catch((t=>{n.cancel({message:`SW reg is failing on check network connection error: ${t} in explict request with top Error: ${e}`})}))):n.cancel({message:`user is not online and SW reg is failing due to error: ${e}`}))}))}async attemptSWRegistration(){const{enableTrustedSWScriptUrl:e,serviceWorkerUpdateViaCache:t}=this.context.coreSettings.get(c.w.Core);this.sWRegistrationAttempt++;const n=e&&this.trustedScriptUrl?this.trustedScriptUrl:`/${this.basePath}/serviceworker.js`,i=t&&["none","imports","all"].includes(t)?t:"all";return this.host.navigator.serviceWorker.register(n,{updateViaCache:i})}checkNetworkConnection(){const e=this.trustedScriptUrl?this.trustedScriptUrl.toString():`/${this.basePath}/serviceworker.js`;return this.host.fetch(e)}handleUpdateReady(e){const{disableSkipWaiting:t}=this.context.coreSettings.get(c.w.Core);t||this.skipWaitingServiceWorkerIfNeeded(),this.logger.infoToTelemetry?.(`Request for updating reboot to version ${e}`,"service_worker_request_reboot",{context:e},!0),this.rebootService.rebootWhenLongInactive(jp.g.AppUpdatedUsingServiceWorker,jp.Z.WebClientUpdateService,{extraTelemetry:e})}deleteCacheStorage(e,t=d.Xk){if(void 0!==this.host.caches){const n=this.scenarioFactory.newScenario(be.Cu.SwCleanupSwCache);this.host.caches.delete(t).then((i=>{i?n.stop({reason:e,message:`cache ${t}$ got deleted`}):n.fail({reason:`cache ${t}$ not found`})}))}}registerAndCheckForServiceWorkerUpdates(){this.sWRegistrationTrialCounter++;const{enableT1ServiceWorkerUnregistrationOnWeb:e,enableUpdateCheckUsingTeamsBuildUpdateVersion:t}=this.context.coreSettings.get(c.w.Core);this.getServiceWorkerRegistration().then((n=>{if(n)if(e&&this.context.platformService.config.clientType===nt.sK.Web&&n.scope.startsWith(this.host.location.origin)&&!1===n.scope.includes(`/${this.basePath}/`))this.unregisterServiceWorker("Found T1 service worker so unregistering it",!1),this.registerServiceWorker();else{if(this.shouldSkipUpdateWhenVeryActive())return this.logger.infoToTelemetry?.("SW update skipped for very active user","service_worker_update_skipped"),void(this.webClientUpdateSkipped=!0);t?this.checkForUpdate(n):(this.logger.infoToTelemetry?.(p$,"fundamentals_performance_sw_update_check",void 0,!0),this.updateApp(n))}else this.logger.log(v$),this.registerServiceWorker()})).catch((e=>{this.logger.error(`Error getting Service Worker registration object: ${e}`)}))}addHandlerForOnUpdateFound(){"serviceWorker"in this.host.navigator&&this.getServiceWorkerRegistration().then((e=>{e?(this.attachEventsToInstallingServiceWorker(e),e.onupdatefound=()=>{const t=this.context.platformService.config.buildVersion,n=this.localStorage.get(h$);this.logger.infoToTelemetry?.(`update found based on build version ${n||t}`,"service_worker_update_found",{context:n||t},!0),this.attachEventsToInstallingServiceWorker(e)}):this.logger.log(v$)}))}registerServiceWorkerAndLogTelemetry(){const{enableUpdateServiceWorkerRegistrationPerSession:e}=this.context.coreSettings.get(c.w.Core);e?this.registerAndCheckForServiceWorkerUpdates():this.registerServiceWorker(),this.logServiceWorkerTelemetry()}addUpdateServiceWorkerSettings(e,t=!1){if(!1===e.enableServiceWorker)return;const n=[];e.serviceWorkerDeferInstallDurationInMs&&Number.isInteger(e.serviceWorkerDeferInstallDurationInMs)&&this.swDeferInstallDurationInMs!==e.serviceWorkerDeferInstallDurationInMs&&(this.swDeferInstallDurationInMs=e.serviceWorkerDeferInstallDurationInMs,n.push({key:UU,value:this.swDeferInstallDurationInMs})),this.swEnableDynamicManifest!==e.enableServiceWorkerDynamicManifest&&(this.swEnableDynamicManifest=e.enableServiceWorkerDynamicManifest??!1,n.push({key:WU,value:this.swEnableDynamicManifest})),this.swEnableIndexMismatchCheck!==e.enableServiceWorkerIndexMismatchCheck&&(this.swEnableIndexMismatchCheck=e.enableServiceWorkerIndexMismatchCheck??!1,n.push({key:YU,value:this.swEnableIndexMismatchCheck})),this.swDisableFetchWithVersion!==e.disableServiceWorkerFetchWithVersion&&(this.swDisableFetchWithVersion=e.disableServiceWorkerFetchWithVersion??!1,n.push({key:JU,value:this.swDisableFetchWithVersion})),this.swEnableIntegrityCheck!==e.enableServiceWorkerIntegrityCheck&&(this.swEnableIntegrityCheck=e.enableServiceWorkerIntegrityCheck??!1,n.push({key:$U,value:this.swEnableIntegrityCheck})),this.enableServiceWorkerBatchInstall!==e.enableServiceWorkerBatchInstall&&(this.enableServiceWorkerBatchInstall=e.enableServiceWorkerBatchInstall??!1,n.push({key:QU,value:this.enableServiceWorkerBatchInstall})),this.swhandleCdlHashRoute!==e.handleCdlHashRouteInServiceWorkerInstall&&(this.swhandleCdlHashRoute=e.handleCdlHashRouteInServiceWorkerInstall??!1,n.push({key:qU,value:this.swhandleCdlHashRoute}));const i=this.context.i18NextWrapper?.locale??"en-us";if(this.localeSetting!==i&&(this.localeSetting=i,n.push({key:VU,value:this.localeSetting})),!t){n.push({key:HU,value:this.context.platformService.ecsOverrides.environment.toString()});const e=this.context.platformService.config.clientType===nt.sK.Maglev?"desktop":this.context.platformService.config.clientType.toString();n.push({key:zU,value:e}),n.push({key:GU,value:this.context.platformService.config.platformId.toString()})}n.length&&this.writeSettingsInServiceWorkerDb(n)}async writeSettingsInServiceWorkerDb(e){const t=parseInt(n$,10);await(0,I$.hL)(t$,t,i$,a$,e,this.scenarioFactory).then((()=>{this.host.navigator.serviceWorker.controller&&gt(this.host.navigator.serviceWorker.controller,"updateServiceWorkerSettings")})).catch((e=>{this.logger.error("Error updating service worker settings in Indexed DB. Error:",e)}))}sendServiceWorkerFetchEventTelemetry(){this.host.navigator.serviceWorker.controller&&gt(this.host.navigator.serviceWorker.controller,"getFetchTelemetryEvents").then((e=>{e.forEach((e=>{this.sendServiceWorkerFetchEventTelemetryCompletedEvent(e)}))})).catch((e=>{this.logger.error("Error getting service worker fetch telemetry. Error:",e)})),this.sendServiceWorkerFetchEventTelemetryInCompleteEvent(c$)}sendServiceWorkerFetchEventTelemetryInCompleteEvent(e){const t=Date.now();this.fetchTelemetryStore.forEach(((n,i)=>{if(void 0===e||t-n.timestamp>e){const e={endpointUrl:n.url,fetchTelemetryEventDelta:t-n.timestamp,operationType:n.type,version:n.version,message:n.message},a=n.type===l$.OfflineAssetStart?be.Cu.SwOfflineAssetFetchEvent:be.Cu.SwFetchEvent;this.scenarioFactory.newScenario(a).cancel(e),this.fetchTelemetryStore.delete(i)}}))}sendServiceWorkerFetchEventTelemetryCompletedEvent(e){const t={endpointUrl:e.url,operationType:e.type,message:e.message,version:e.version,context:e.buildVersion,type:e.isInPrefetchList?"Asset in prefetch list":"Not in prefetch list"};if(this.captureFetchEvent(e,t)){const n=this.isOfflineFetchOperation(e.type)?T$:w$;this.sendFetchEvent(n,e.type,t)}}isOfflineFetchOperation(e){let t;switch(e){case l$.OfflineAssetSuccess:case l$.OfflineAssetFailure:case l$.OfflineAssetCacheMiss:t=!0;break;default:t=!1}return t}sendFetchEvent(e,t,n){const i=n.message||"";switch(t){case l$.Success:case l$.OfflineAssetSuccess:this.logger.infoToTelemetry?.(i,e,n);break;case l$.CacheMiss:case l$.OfflineAssetCacheMiss:const t="Asset in prefetch list"===n.type;this.logger.warnToTelemetry?.(`Cache miss - ${i} - ${n.type}, endpointUrl: ${n.endpointUrl}`,e,n,t);break;case l$.Failure:case l$.OfflineAssetFailure:this.logger.errorToTelemetry?.(`Cache serving failed - ${i}`,e,n,!0);break;default:this.logger.debugToTelemetry?.(i,e,n)}}captureFetchEvent(e,t){switch(e.type){case l$.Start:case l$.OfflineAssetStart:return this.fetchTelemetryStore.set(e.url,e),!1;case l$.Failure:case l$.Success:case l$.OfflineAssetFailure:case l$.OfflineAssetSuccess:case l$.CDNAssetNotInManifest:case l$.CacheMiss:case l$.OfflineAssetCacheMiss:const n=this.fetchTelemetryStore.get(e.url);return n?(t.fetchTelemetryEventDelta=e.timestamp-n.timestamp,this.fetchTelemetryStore.delete(e.url)):t.reason="orphan",!0;case void 0:return this.logger.error("unexpected fetch event type:",e.type),!1}return!1}clearTimer(){this.host.clearInterval(this.recurringCheckForUpdateInterval),this.host.clearTimeout(this.registerSWAndLogTelemetryTimer),this.host.clearInterval(this.recurringSendSWFetchEventTelemetryInterval),this.host.clearTimeout(this.sWRegistrationRetryTimer)}registerOrUnregisterServiceWorker(e){if(e){if(!this.recurringCheckForUpdateInterval){this.addHandlerForOnUpdateFound(),this.recurringCheckForUpdateInterval=this.host.setInterval((()=>this.checkForUpdateAndRestartWebClient()),u$+Math.ceil(Math.random()*m$));const{serviceWorkerRegistrationDelayInMs:e}=this.context.coreSettings.get(c.w.Core),t=e&&Number.isInteger(e)?e:d$;this.registerSWAndLogTelemetryTimer=this.host.setTimeout((()=>this.registerServiceWorkerAndLogTelemetry()),t)}}else this.unregisterServiceWorker("Service Worker is not enabled");this.setServiceWorkerContextForScenarios()}setScenarioContext(e){this.scenarioFactory.setContext?.({isServiceWorkerRegistered:e,isServiceWorkerActive:mt(this.host),isServiceWorkerInstalling:this.isSwInstalling,isServiceWorkerWaiting:this.isSwWaiting})}async attachEventsToInstallingServiceWorker(e,t=!1){if(!e||!e.installing)return;const n=e.installing,i=await pt(this.host,n,this.logger),a=this.scenarioFactory.newScenario(be.Cu.SwStateChange);a?.appendEventData({context:i,message:t?"isNewRegistration":"isNotNewRegistration"}),this.scenarioFactory.markStep(be.Cu.SwStateChange,be.BQ.SwInstalling);const o={state:n.state};this.isSwInstalling=!0,this.setServiceWorkerContextForScenarios(!0),n.onstatechange=()=>this.handleOnStateChange(o,n.state,a,t,i)}skipWaitingServiceWorkerIfNeeded(){"serviceWorker"in this.host.navigator&&this.getServiceWorkerRegistration().then((e=>{e&&e.waiting&&e.waiting.postMessage("skipWaiting")}))}getServiceWorkerRegistration(e=!0){return e?this.host.navigator.serviceWorker.getRegistration(`/${this.basePath}/serviceworker.js`):this.host.navigator.serviceWorker.getRegistration("/serviceworker.js")}checkForUpdate(e){this.webClientUpdateSkipped=!1;const{buildUpdateVersion:t}=this.context.coreSettings.get(c.w.TeamsBuilds),n=this.context.platformService.config.buildVersion,{forcedupdatecheckTimeIntervalinMs:i}=this.context.coreSettings.get(c.w.Core);let a=!1,o=!1;const r=this.localStorage.get(y$),s=this.localStorage.get(h$);a=(null===s||s!==t)&&t!==n,null==r&&t===n?o=!0:r&&i&&(o=Date.now()-new Date(r).getTime()>i),(a||o)&&(this.logger.infoToTelemetry?.(`sw update check based on version ${s||n}`,"fundamentals_performance_sw_update_check",{previousSuccessfulInstalledBuild:s,currentBuildVersion:n,buildUpdateVersion:t,lastUpdateCheckTimestamp:r,updateCheckRequired:a,forcedUpdateCheck:o},!0),this.updateApp(e))}async updateApp(e){this.webClientUpdateSkipped=!1,this.logger.log("Check for update");const t=Date.now();this.localStorage.trySet(y$,t.toString(),"Fundamental_Performance");const n=this.scenarioFactory.newScenario(be.Cu.ServiceWorkerUpdate);e.update().then((()=>{const t=e.installing;if(t)pt(this.host,t,this.logger).then((e=>{this.logger.log(`Service worker updated to version ${e}, waiting for installing`),n.stop({context:e})}));else{const{buildUpdateVersion:e}=this.context.coreSettings.get(c.w.TeamsBuilds);n.cancel({message:"No serviceworker update is found",context:e||""})}})).catch((e=>{n.fail({reason:e})}))}async checkServiceWorkerVersion(){const e=await this.getServiceWorkerRegistration(!0);if(e&&e.active){const t=e.active,n=await pt(this.host,t,this.logger),i=this.context.platformService.config.buildVersion;n!==i&&this.logger.errorToTelemetry?.(`Service worker version ${n} is different from current build version ${i}`,"service_worker_version_mismatch",{context:n},!0)}}shouldSkipUpdateWhenVeryActive(){return this.clientStateProvider.getState()===Ba.Lg.VeryActive&&!this.context.coreSettings.get(c.w.Core).disableSkipWebClientUpdateWhenVeryActive}handleClientStateChange(e){e!==Ba.Lg.VeryActive&&this.webClientUpdateSkipped&&this.registerAndCheckForServiceWorkerUpdates()}}class A$ extends xp{constructor(){super(d.c1.CreateWebClientUpdate,["coreSettings","clientState"])}async execute(e,t){t.webClientUpdateService=new N$(e);const{isUnRegisterSWOnLogoutEnabled:n}=e.coreSettings.get(c.w.Core);if(n)return async e=>{"signout"===e&&await t.webClientUpdateService.unregisterServiceWorker(e)}}}var E$=n(849213);class F$ extends xp{constructor(){super(d.c1.CreateWindow,["config","diagnosticsService","logsCollectorService"]),this.registerShellHandlers=(e,t,n)=>{e.opener.addEventListener(pi.pI.GetLogs,(async()=>{const i=await t.getDiagnosticsEvents(),a=await n.getSystemInfo();let o="System Info: ";a&&a.size>0?a.forEach(((e,t)=>{o+=`${t}: ${e}\n`})):o+="No system info collected",i.unshift({message:`${o}`,level:gi.$.Debug,levelName:gi.$[gi.$.Debug],timeStamp:new Date,isPiiFree:!0}),e.opener.postMessage(pi.pI.GetLogs,{logs:i})}))}}async execute(e){const t=E$.y.getInstance(),n=t.window;t.opt={postMessageConfig:e.config.postMessageConfig},n.onAppStart();const{diagnosticsService:i,logsCollectorService:a}=e;this.registerShellHandlers(n,i,a),e.windowProvider=n}}class _$ extends xp{constructor(){super(d.c1.DiscoverUser,["discover"])}async execute(e){e.user=await e.discover.getUser((0,Wh.$q)("discover-user-task:execute"))}}class D$ extends xp{constructor(){super(d.c1.FetchCriticalDynamicImportsTask,["criticalDynamicImports","loggerFactory","scenarioFactory","coreSettings"])}async execute(e){const{criticalDynamicImports:t,loggerFactory:n,scenarioFactory:i,coreSettings:a}=e;if(!t||0===t.length)return;const o=a?.get(c.w.Core).enableSerializeChunkImport;o?await Promise.all(t.map((e=>(0,ev.wg)(e.importFunc,e.chunkName,i)))).catch((e=>{n.newLogger("FetchCriticalDynamicImportsTask","core-services-tasks").errorToTelemetry?.(`Failed to preload chunk this will regress performance of first load: ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)})):t.forEach((({importFunc:e,chunkName:t})=>{(0,ev.wg)(e,t,i).catch((e=>n.newLogger("FetchCriticalDynamicImportsTask","core-services-tasks").errorToTelemetry?.(`Failed to preload chunk ${t} this will regress performance of first load: ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)))}))}}class P$ extends xp{constructor(){super(d.c1.InitApiServiceProvider,["coreSettingsContext"])}async execute(e){await e.coreSettingsContext.initializeApiServiceProvider()}}class M$ extends xp{constructor(){super(d.c1.InitAsyncMediaAuthService,["mediaAuthService"])}async execute(e){const{mediaAuthService:t}=e;return t?.initAsyncMediaAuthService(),async e=>{"signout"===e&&await(t?.logout())}}}var R$=n(726131);class x$ extends xp{constructor(){super(d.c1.InitATPPolicyTask,["coreSettings","endpointsManager","gtmRegistry","localStorage","loggerFactory","scenarioFactory"])}async execute(e){const{coreSettings:t,endpointsManager:n,gtmRegistry:i,localStorage:a,loggerFactory:o,scenarioFactory:r}=e,{enableFastSharepointSafelinks:s}=t.get(c.w.Messaging),l=o.newLogger("InitATPPolicyTask","core-services-tasks");if(!s?.enabled)return void l.log("InitATPPolicyTask - Do nothing, FF is disabled");const d=new R$.Z(i.bind(ah.t,"middleTier"),r,o,a,t,n);l.log("Getting ATP Safelinks policy"),d.initPolicy()}}const L$={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeAuthenticatedUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}}]}]}}]};let O$;class j${constructor(e,t,n,i,a,o,r,s){this._auth=e,this._client=t,this._discover=n,this._networkStateProvider=i,this._windowProvider=o,this._keepTokenActive=!1,this._keepCheckingSignInRestrictions=!1,this._isLoginRequired=void 0,this._tokenIntervalId=void 0,this._logger=r.newLogger("AuthTokenStoreService","core-services-auth-token-store"),this._mtResourceKey=s?.get(c.w.Auth)?.mtResource||Qt.oF.MT_AAD_KEY,this._tokenWarmingIntervalInMs=s?.get(c.w.Auth)?.tokenWarmingIntervalInMs||yh.uM.MT_TOKEN_INTERVAL,this._disableTokenWarmingForSigninRestriction=s?.get(c.w.Auth)?.disableTokenWarmingForSigninRestriction||!1,this._subscriptions=new Map,this.observeIsLoginRequired(),this.observeAppOnlineState()}observe(e){let t=this._subscriptions.get(e);return t||(t=this.createSubscription(e),this._subscriptions.set(e,t)),t}createSubscription(e){let t;switch(e){case Qt.oF.MT_KEY:this._keepTokenActive=!0,t=this._auth.observeMiddleTierToken(),this.keepTokenActive();break;case Qt.oF.SIGNIN_RESTRICTIONS_KEY:this._keepCheckingSignInRestrictions=!0,this.keepTokenActive();break;default:this._logger.error("Unable to create subscription, token key %s is not supported",e)}return t}keepTokenActive(){this._tokenIntervalId||(this._keepTokenActive||this._keepCheckingSignInRestrictions)&&(this._tokenIntervalId=this._windowProvider.setInterval((()=>{if(this._keepCheckingSignInRestrictions&&this._disableTokenWarmingForSigninRestriction){let e=(0,mh.DA)();e=`sign${e.substr(Qt.FQ.FOUR)}`,this._auth.acquireToken(Qt.oF.SIGNIN_RESTRICTIONS_KEY,{correlationId:e}).catch((e=>{this.handleSignInRestrictionsError(e)}))}this._keepTokenActive&&this._auth.acquireToken(this._mtResourceKey).then((()=>this._discover.validateSkypeToken({correlation:(0,Wh.$q)("auth-token-store:keepTokenActive")}))).catch((e=>{this._logger.error("Error occurred in keeping MT token active.",e)}))}),this._tokenWarmingIntervalInMs))}handleSignInRestrictionsError(e){if(this._logger.error(`Error occurred in keeping SignInRestrictions token active. ErrorCode: ${e?.errorCode}`,e),e?.errorCode===Qt.tG.SignInRestrictions){this._logger.error("Sign in restrictions was enabled and caught by the periodic check. Forcibly signing out the user");const e={id:(0,mh.DA)(),source:"auth-token-store",scenarioName:be.Cu.AuthWebLogout},[t,n]=(0,uh.we)({options:{correlation:e},scenarioName:e.scenarioName,source:e.source,subContext:"auth-token-store::handleSignInRestrictionsError"});t.appendScenarioEventData({operationType:Qt.tG.SignInRestrictions}),this._client.mutate({mutation:L$,variables:{reason:Qt.tG.SignInRestrictions},context:{correlation:e}}),n()}else this._logger.error("Sign in restrictions token acquisition threw an unexpected error",e)}observeIsLoginRequired(){this._auth.isLoginRequired.subscribe((e=>{if(this._isLoginRequired===e)return;const t=void 0===this._isLoginRequired;this._isLoginRequired=e,t||(this._isLoginRequired?this._tokenIntervalId&&(this._windowProvider.clearInterval(this._tokenIntervalId),this._tokenIntervalId=void 0):this.replayKeepTokenActiveState())}))}observeAppOnlineState(){this._networkStateProvider.observeIsOnline().subscribe((e=>{e?this.replayKeepTokenActiveState():this._tokenIntervalId&&(this._windowProvider.clearInterval(this._tokenIntervalId),this._tokenIntervalId=void 0)}))}replayKeepTokenActiveState(){if(0===this._subscriptions.size)return;const e=this._subscriptions.keys();let t=e.next();for(;!t.done;)this.keepTokenActive(),t=e.next()}}class B$ extends xp{constructor(){super(d.c1.InitAuthenticationService,[])}async execute(e){const{client:t,discover:n,authenticationUser:i,authenticationService:a,networkState:o,loggerFactory:r,coreSettings:s,scenarioFactory:l}=e,{enableSignInRestrictions:d,prefetchTokens:u,disableTokenWarming:m,enableTokenWarming:p,tokenWarmingResources:g}=s.get(c.w.Auth);if(!i)return;const h=((e,t,n,i,a,o,r)=>(O$||(O$=new j$(n,e,t,i,a,(0,Un.z)(),o,r)),O$))(t,n,a,o,l,r,s);d&&h.observe(Qt.oF.SIGNIN_RESTRICTIONS_KEY),!m&&h.observe(Qt.oF.MT_KEY);const v=[];u?.forEach((e=>e&&v.push(e))),p&&g&&g.forEach((e=>{e&&v.indexOf(e)<0&&v.push(e)})),v.forEach((e=>a.acquireToken(e).catch((()=>{}))))}}class U${constructor(e,t,n){this.coreSettings=e,this.host=n,this.defaultScreenshotsTimeoutMs=5e3,this.brbServiceMap=new Map,this.brbExtendedServiceMap=new Map,this.rootToolsManagerMap=new Map,this.logger=t.newLogger("BrbServiceManager","core-services-brb")}registerRootToolsManager(e,t){t.setBRBCallback(this.onBrbRequested(e)),this.rootToolsManagerMap.set(e,t)}registerUserBrbExtendedFeedbackProvider(e,t){this.logger.logNoPii?.("Registering a new BRB extended feedback provider for account");const n=this.getOrCreateUserBrbExtendedFeedbackProviderSet(e);n.add(t),this.brbExtendedServiceMap.set(e,n)}unregisterUserBrbExtendedFeedbackProvider(e){return this.logger.logNoPii?.("Unregistering an existing BRB service for account"),this.brbExtendedServiceMap.delete(e)}registerUserBrbService(e,t){this.logger.logNoPii?.("Registering a new BRB service for account"),this.brbServiceMap.set(e,t)}unregisterUserBrbService(e){return this.logger.logNoPii?.("Unregistering an existing BRB service for account"),this.rootToolsManagerMap.delete(e),this.brbServiceMap.delete(e)}async getBrbFormData(e){const{categories:t,categoriesInCallingScreen:n,disclaimer:i}=this.coreSettings.get(c.w.Brb),a="callingScreen"===e?n:t,o=[];return a?.forEach((e=>{e&&o.push({id:e.id,name:e.name})})),this.logger.logNoPii?.("Returning data for BRB form",o),{disclaimer:i||d.ak,categories:o}}async getBrbScreenshots(e,t){const n=this.getOrCreateUserBrbService(e);if(n){const{screenshotsTimeoutMs:e}=this.coreSettings.get(c.w.Brb,["screenshotsTimeoutMs"]);let i=0;const a=new Promise((t=>{i=this.host.setTimeout((()=>{this.logger.logNoPii?.("Screenshots timeout. Returning undefined for BRB screenshots."),i=0,t(void 0)}),e??this.defaultScreenshotsTimeoutMs)})),o=n.getBrbScreenshots(t).then((e=>(this.logger.logNoPii?.(`Screenshots received: ${e?.length}`),e)));return Promise.race([o,a]).then((e=>(i&&this.host.clearTimeout(i),e)))}return Promise.resolve(void 0)}async createBrbItem(e,t,n){const i=this.getOrCreateUserBrbService(e),a=await(i?.createBrbItem(t,n)||void 0);if(!a)return a;const{enableMTMA:o}=this.coreSettings.get(c.w.Core);if(o){Array.from(this.brbServiceMap.keys()).filter((t=>t!==e)).forEach((e=>{const i=this.getOrCreateUserBrbService(e);i?.extendBrbReports(t,a,n)}))}const r=this.getOrCreateUserBrbExtendedFeedbackProviderSet(e);if(i&&r){const e=await i.getSystemInfo();r.forEach((n=>n.extendedBrbFeedback(t,a,e)))}return a}async createAutoBrbItem(e,t){return await this.createBrbItem(e,t,!0)}onBrbRequested(e){return t=>{this.logger.log(`onBrbRequested called >>> event ${t.uploadId}`);const n={categoryId:"11",text:"Extend report",includeHeapSnapshot:!1,diagnosticsUploadId:void 0,includeLogs:!0,isRemoteBrb:!0};if(e){const i=this.getOrCreateUserBrbService(e);i?(i?.extendBrbReports(n,{containerId:t.uploadId},void 0,!0),this.logger.log("setBRBCallback >>> called extendBrbReports")):this.logger.warn("setBRBCallback >>> could not call extendBrbReports brbService undefined")}else this.logger.warn(`setBRBCallback >>> userKey is null uploadId: ${t.uploadId}`)}}getOrCreateUserBrbExtendedFeedbackProviderSet(e){return this.brbExtendedServiceMap.get(e)??new Set}getOrCreateUserBrbService(e){const t=this.brbServiceMap.get(e);if(!(t&&t instanceof Function))return this.logger.logNoPii?.(`Found existing BRB service for account ${e}`),t;this.logger.logNoPii?.(`Creating BRB service for account ${e}`);try{const n=t(),i=this.rootToolsManagerMap.get(e);return i&&n.registerRootToolsManager(i),this.brbServiceMap.set(e,n),n}catch(t){return void this.logger.logNoPii?.(`Failed to create BRB service for account ${e}`)}}}class $$ extends xp{constructor(){super(d.c1.InitBrbServiceManagerTask,["coreSettings","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,windowProvider:i}=e;e.brbServiceManager=new U$(t,n,i)}}var W$=n(426387),V$=n(932222),H$=n(970840);class z${constructor(e,t,n,i,a,o,r,s,l,c){this.coreSettings=e,this.useAccessCheckV2=n,this.hostComm=i,this.scenarioFactory=a,this.appSwitcherPolicyCheckService=o,this.authenticationService=r,this.rebootService=s,this.windowProvider=l,this.webAppSwitcherService=c,this.logger=t.newLogger("ClientAccessAdminPolicyCheckService","services-utilities-core"),this.useAccessCheckV2=n}async isUserAllowed(e=!0){this.logger.log("isUserAllowed::start");let t=!1;const{useNewTeamsClient:n}=this.coreSettings.get(c.w.Core,["useNewTeamsClient"]),{appswitcherStartTACPolicyExpiration:i}=this.coreSettings.get(c.w.Core,["appswitcherStartTACPolicyExpiration"]);if(i){const e=await this.appSwitcherPolicyCheckService.getAppSwitcherEffectivePolicy().pipe((0,XB.s)(1)).toPromise();if(e!==W$.uF.ADMIN_DISABLED)return this.logger.log(`isUserAllowed: returned true due to appSwitcherEffectivePolicy=${e}\n          policyExpiration=${this.appSwitcherPolicyCheckService.policyExpirationType}`),!0}switch(this.logger.log(`isUserAllowed: useNewTeamsClient: ${n}`),n){case"AdminDisabled":t=!1;break;case"MicrosoftChoice":this.useAccessCheckV2&&(t=await this.isUserAllowedV2()),t||(t=this.isUserAllowedViaAppSwitcher());break;case"UserChoice":t=e;break;default:t=!0}return this.logger.log(`isUserAllowed: returned ${t}`),t}async makeT1Default(){const{disableT1Trampoline:e}=this.coreSettings.get(c.w.Core,["disableT1Trampoline"]);if(e)return void this.logger.log("makeT1Default: skipped, disableT1Trampoline is true");if(!this.hostComm)return void this.logger.log("makeT1Default: skipped, invalid hostcomm");const t=await this.hostComm.loadModule("appswitcher");if(!t||!t.getPearInstallState||!t.switchDefaultAppTo)return void this.logger.log("makeT1Default: skipped, invalid appSwitcherModule");const n=await t.getPearInstallState();n===_t.Ll.InstalledNotActive?(await t.switchDefaultAppTo(_t.sS.Teams1),this.logger.log("makeT1Default: successfully switched default app to T1")):this.logger.log(`makeT1Default: skipped, pearInstallState = ${n}`)}rebootOnPolicyChangeToAdminDisabled(){this.subscribeToInitialUseNewTeamsPolicyChange((async e=>{"AdminDisabled"!==e||await this.isUserAllowed()||(this.logger.log("useNewTeamsClient policy changed to AdminDisabled, user is no longer allowed, rebooting"),this.rebootService.rebootApp(jp.g.ClientAccessPolicyAdminDisabled,jp.Z.ClientAccessAdminPolicyCheckService))}))}redirectToT1OnWebPolicyChange(){this.subscribeToInitialUseNewTeamsPolicyChange((async e=>{const t="true"===this.windowProvider.sessionStorage.getItem("skipT1WebRedirectionForAnonMeetingJoin"),n=null!==this.windowProvider.localStorage.getItem("tmp.t2WebOptInSessionId");"AdminDisabled"!==e&&"UserChoice"!==e||await this.isUserAllowed(n)||t||(this.logger.log(`useNewTeamsClient policy changed to ${e} and user is not joining a meeting via deep-link. User is not allowed, redirecting to T1`),this.webAppSwitcherService?.optOutOfT2Web("ClientAccessPolicyCheck",void 0,e))}))}async rebootIfUserBecomesAllowedLater(){if(await this.isUserAllowed())return void this.logger.error("rebootIfUserBecomesAllowedLater: user is already allowed. Skipped.");const{useNewTeamsClient:e}=this.coreSettings.get(c.w.Core,["useNewTeamsClient"]);if("AdminDisabled"!==e)return;const t=this.coreSettings.getObservable(c.w.Core,["useNewTeamsClient","appswitcherStartTACPolicyExpiration","cohortBasedPolicyExpirySetting"]).subscribe((async({useNewTeamsClient:e,appswitcherStartTACPolicyExpiration:n,cohortBasedPolicyExpirySetting:i})=>{this.logger.log(`Checking if user is now allowed. Observed\n              useNewTeamsClient:${e};\n              appswitcherStartTACPolicyExpiration=${n};\n              cohortBasedPolicyExpirySetting=${i}`);await this.isUserAllowed()&&(this.logger.log("User is now allowed to use T2.1, rebooting to enable T2.1"),t.unsubscribe(),this.rebootService.rebootApp(jp.g.ClientAccessPolicyUserAllowed,jp.Z.ClientAccessAdminPolicyCheckService))}))}shouldUserAttemptT1Cleanup(){return(0,V$.zV)([this.appSwitcherPolicyCheckService?.getAppSwitcherEffectivePolicy(),this.coreSettings.getObservable(c.w.Core,["forceEnableT1Cleanup","forceDisableT1Cleanup","disableAppSwitcherWin10TFLCheck","forceAppSwitcherWin10MSACheck","t1UninstallDelayTimeInDays","enableT1UninstallDelay","disableCheckForMSAWin10PostConvergence"]),this.coreSettings.getObservable(c.w.Platform,["deviceInfo"]),this.coreSettings.getObservable(c.w.HostCapabilities,["t1InstallPresent"])]).pipe((0,l.n)((async([e,t,n,i])=>{const{forceEnableT1Cleanup:a,forceDisableT1Cleanup:o,disableAppSwitcherWin10TFLCheck:r,forceAppSwitcherWin10MSACheck:s,t1UninstallDelayTimeInDays:l,enableT1UninstallDelay:c,disableCheckForMSAWin10PostConvergence:d}=t,{deviceInfo:u}=n,{t1InstallPresent:m}=i;return!(!e&&void 0===a)&&this.shouldUserAttemptT1CleanupInternal(e,!!m,!!a,!!o,!!s,!!r,l??void 0,!!c,u??void 0,this.appSwitcherPolicyCheckService,!!d)})))}async shouldUserAttemptT1CleanupInternal(e,t,n,i,a,o,r,s,l,c,d){this.logger.log("shouldUserAttemptT1Cleanup::start");const u=this.scenarioFactory.newScenario(be.Cu.AppSwitcherCheckT1CleanupPolicy);if(n)return u.stop({reason:"force_enable"}),!0;if(i)return u.stop({reason:"force_disable"}),this.logger.log(`T1UninstallDelayTime is ${r}`),!1;if(this.logger.log(`shouldUserAttemptT1Cleanup: got appSwitcherEffectivePolicy=${e}`),e?.toLocaleUpperCase()===W$.uF.T21_ONLY){if(!t)return this.logger.log("shouldUserAttemptT1Cleanup: T1 install not present, skipping uninstall"),u.cancel({reason:"t1_not_present"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: T1 is not present."),!1;if(!this.isT1UninstallDelayTimeReached(r,s,c,u))return u.cancel({reason:"t1_uninstall_delay_time_not_reached"}),this.logger.log("shouldUserAttemptT1Cleanup: T1 uninstall delay time not reached, skipping"),!1;const e=!l||!(0,H$.X)(l)||a;return o?e&&!d?(this.logger.log("shouldUserAttemptT1Cleanup: OS version < Win11, skipping uninstall"),u.cancel({reason:"win10_cleanup_disabled"}),!1):(u.stop(),!0):await this.isMSAHostedOnMachine()&&e&&!d?(this.logger.log("shouldUserAttemptT1Cleanup: T1 hosting MSA, skipping uninstall"),u.cancel({reason:"win10_msa_acct_detected"}),!1):(this.logger.log("shouldUserAttemptT1Cleanup: Starting T1 uninstall"),u.stop(),!0)}return u.cancel({reason:"invalid_policy"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Effective policy is not T21_ONLY."),!1}isUserAllowedViaAppSwitcher(){const{installedThroughAppSwitcher:e}=this.coreSettings.get(c.w.Host,["installedThroughAppSwitcher"]);return this.logger.log(`isUserAllowedViaAppSwitcher: installedThroughAppSwitcher: ${e}`),!!e}async isUserAllowedV2(){const{allowUserOnMicrosoftChoice:e}=this.coreSettings.get(c.w.Core,["allowUserOnMicrosoftChoice"]);if(!e)return this.logger.log("isUserAllowedV2: returned false due to allowUserOnMicrosoftChoice=false"),!1;const{disableEduCheckOnMicrosoftChoice:t}=this.coreSettings.get(c.w.Core,["disableEduCheckOnMicrosoftChoice"]);if(!t&&this.isEdu())return this.logger.log(`isUserAllowedV2: returned false due to EDU, disableEduCheckOnMicrosoftChoice=${t}`),!1;const{disableVdiCheckOnMicrosoftChoice:n}=this.coreSettings.get(c.w.Core,["disableVdiCheckOnMicrosoftChoice"]);return!n&&await this.isVdi()?(this.logger.log(`isUserAllowedV2: returned false due to VDI, disableVdiCheckOnMicrosoftChoice=${n}`),!1):(this.logger.log("isUserAllowedV2: returned true due to allowUserOnMicrosoftChoice=true"),!0)}async isVdi(){if(!this.hostComm)return this.logger.warn("isVdi: returned false - invalid hostComm"),!1;const e=await this.hostComm.loadModule("vdi");if(!e||!e.isVDI)return this.logger.warn(`isVdi: returned false - invalid VDI function, vdiModule=${!!e}`),!1;const t=await e.isVDI();return this.logger.log(`isVdi: returned ${t}`),t}isEdu(){const{licenseType:e}=this.coreSettings.get(c.w.UserResources);return this.logger.log(`isEdu: licenseType=${e}`),!(!e||"Student"!==e&&"Teacher"!==e)}async isMSAHostedOnMachine(){return(await(this.authenticationService.getHostMachineUsers?.(""))??[]).filter((e=>"MsaLife"===e.accountType)).length>0}isT1UninstallDelayTimeReached(e,t,n,i){if(t){const t=new Date,a=n.getNewTeamsOnlyEffectivePolicyStartTime();if(!a){const a=n.setNewTeamsOnlyEffectivePolicyStartTime(t.toISOString());this.logger.log(`shouldUserAttemptT1Cleanup: starting T1 uninstall delay timer was successful: ${a}`);const o={startTime:t.toISOString(),t1UninstallDelayTimeInDays:e};return i.mark(be.BQ.NewTeamsOnlyEffectivePolicyStartTimeSet,o),!1}const o=new Date(a),r=(t.getTime()-o.getTime())/864e5;this.logger.log(`shouldUserAttemptT1Cleanup: timer start: ${a}, T1 uninstall delay time in days: ${r}`);const s={startTime:a,currentTime:t.toISOString(),daysDifference:r,t1UninstallDelayTimeInDays:e};return e&&r>=e?(this.logger.log("shouldUserAttemptT1Cleanup: T1 uninstall delay time reached, uninstalling T1"),i.mark(be.BQ.T1UninstallDelayTimeReached,s),!0):(i.mark(be.BQ.T1UninstallDelayTimeNotReached,s),!1)}return i.mark(be.BQ.T1UninstallDelayDisabled),!0}subscribeToInitialUseNewTeamsPolicyChange(e){this.logger.log("Will observe changes to useNewTeamsClient policy");const t=this.scenarioFactory.newScenario(be.Cu.AppSwitcherObserveUseNewTeamsPolicy),n=this.coreSettings.getObservable(c.w.Core,["useNewTeamsClient"]).pipe((0,di.p)((({useNewTeamsClient:e})=>void 0!==e))).subscribe((async({useNewTeamsClient:i})=>{t.stop({reason:`initial_value_${i}`}),n.unsubscribe(),this.logger.log("Stopped observing changes to useNewTeamsClient policy"),await e(i)}))}}class q$ extends xp{constructor(){super(d.c1.InitClientAccessAdminPolicyCheck,["appSwitcherPolicyCheckService","coreSettings","coreSettingsContext","hostCommunicationService","loggerFactory","rebootService","scenarioFactory","authenticationService","windowProvider","localStorage"])}async execute(e){const{appSwitcherPolicyCheckService:t,coreSettings:n,coreSettingsContext:i,hostCommunicationService:a,loggerFactory:o,rebootService:r,scenarioFactory:s,authenticationService:l,windowProvider:d,localStorage:u,crossTabsService:m}=e,p=o.newLogger("InitClientAccessAdminPolicyCheckTask","core-services-tasks"),{disableAppSwitcherTACSettingsSyncForNonHomeAccount:g,enableAppSwitcherTACSettingsSync:h,enableAppSwitcherTACSettingsSyncV2:v,redirectToT1WebIfAdminDisabledOrUserChoice:y}=n.get(c.w.Core,["disableAppSwitcherTACSettingsSyncForNonHomeAccount","enableAppSwitcherTACSettingsSync","enableAppSwitcherTACSettingsSyncV2","redirectToT1WebIfAdminDisabledOrUserChoice"]);if(!h&&!v)return void p.log("Both enableAppSwitcherTACSettingsSync and enableAppSwitcherTACSettingsSyncV2 are false, skipping ClientAccessAdminPolicyCheckService initialization.");if(g){const e=await l.getUser();if(e?.id&&e.id!==e.homeAccountId)return void p.log("The primary account is not home account, skipping ClientAccessAdminPolicyCheckService initialization.")}let S;y&&(S=new kC.Uc(u,o,m));const f=new z$(n,o,!!v,a,s,t,l,r,d,S);e.clientAccessAdminPolicyCheckService=f;try{await async function(e,t,n,i,a){const{enableLeakedPolicyCleanup:o}=e.get(c.w.Core,["enableLeakedPolicyCleanup"]);if(!o)return;const r=await t.getUser();if(r?.id&&r.id.length>0)return;a.log("Clearing leaked policy cache"),G$(n,i,a,jp.g.ClientAccessLeakedPolicyCleanup)}(n,l,u,r,p)}catch{p.error("Failed to clean leaked teams update policy from local storage in a signed-out session.")}try{!function(e,t,n,i){const{cleanPolicyCacheOnOptIntoT2Web:a}=e.get(c.w.Core,["cleanPolicyCacheOnOptIntoT2Web"]);if(!a)return void i.debug("Not deleting policy cache - cleanPolicyCacheOnOptIntoT2Web flag is disabled");const o=t.get("t2WebOptInSessionId","Global");if(!o)return;i.log("Deleting policy cache for web opt-in user"),G$(t,n,i,jp.g.ClientAccessWebOptInPolicyCleanup)}(n,u,r,p)}catch{p.error("Failed to delete policy cache from local storage on T2 web opt-in")}const{shouldRebootOnPolicyChangeToAdminDisabled:k}=n.get(c.w.Core,["shouldRebootOnPolicyChangeToAdminDisabled"]);if(k&&!i.getInitialStateHints().primaryUserHadPolicyCache&&f.rebootOnPolicyChangeToAdminDisabled(),y&&!i.getInitialStateHints().primaryUserHadPolicyCache&&f.redirectToT1OnWebPolicyChange(),!await f.isUserAllowed())throw await f.makeT1Default(),f.rebootIfUserBecomesAllowedLater(),await i.fetchEcsSettingsIfApplicable(),new Ha.a(Ha.D.DISABLED_BY_ADMIN)}}function G$(e,t,n,i){const a="policy-cache",o=e.get(a,"Global");o&&""!==o?(n.warn("Deleting policy cache and rebooting the app"),e.remove(a,"Global"),t.rebootApp(i,jp.Z.ClientAccessAdminPolicyCheckService)):n.debug("Not deleting policy cache - policy cache not found")}class Y${constructor(e,t,n,i,a){this.coreSettings=e,this.scenarioFactory=n,this.localStorage=i,this.userBiService=a,this.policyExpirationType=W$.IW.NONE,this.policyExpirationStage=void 0,this.logger=t.newLogger("AppSwitcherPolicyCheckService","services-utilities-core")}getAppSwitcherEffectivePolicy(){return(0,V$.zV)([this.coreSettings.getObservable(c.w.Core,["useNewTeamsClient","enableT1AppSwitcherEffectivePolicyFetch","appSwitcherCohortSettings","appSwitcherDebugEffectivePolicy","appswitcherExpireTACPolicy","appswitcherExpiredPolicyNoCohortStage","cohortBasedPolicyExpirySetting","appswitcherStartTACPolicyExpiration"]),this.coreSettings.getObservable(c.w.HostCapabilities,["t1AppSwitcherEffectivePolicy"]),this.getAppSwitcherCohort()]).pipe((0,o.T)((([e,t,n])=>{const i=this.scenarioFactory.newScenario(be.Cu.AppSwitcherIdentifyPolicy),{useNewTeamsClient:a,enableT1AppSwitcherEffectivePolicyFetch:o,appSwitcherCohortSettings:r,appSwitcherDebugEffectivePolicy:s,appswitcherExpireTACPolicy:l,appswitcherExpiredPolicyNoCohortStage:c,cohortBasedPolicyExpirySetting:d,appswitcherStartTACPolicyExpiration:u}=e,{t1AppSwitcherEffectivePolicy:m}=t;if(s)return i.stop({policy:s,reason:"DebugForced"}),s;if(u){i.mark("appswitcher_tac_policy_expiration_started");const e=this.scenarioFactory.newScenario(be.Cu.AppSwitcherPolicyExpiration),t=this.getStageForExpiredPolicy(l??void 0,d??void 0,n,a??"microsoftchoice",c??void 0,e);if(e.mark(be.BQ.AppSwitcherPolicyExpirationType,{cohort:n,policyExpirationType:this.policyExpirationType,rolloutStage:t}),this.logger.log(`appswitcher_policy_expiration: cohort=${n}\n            policyExpirationType=${this.policyExpirationType} \n            rolloutStage=${t}`),t){e.stop({cohort:n,policyExpirationType:this.policyExpirationType,rolloutStage:t});const i=this.userBiService.createDatabag?.();return i&&(i.policyExpiredStageSetByMSFT=this.policyExpirationStage,i.policyExpirationStategy=this.policyExpirationType),this.userBiService.recordPanelAction({actionScenario:GR.vB.AppSwitcherPolicyExpiration,moduleName:GR.Sn.AppSwitcherPolicyExpiration,dataBag:i}),i?.dispose(),t}}let p;if(a)switch(a){case"UserChoice":p=W$.uF.USER_CHOICE;break;case"AdminDisabled":p=W$.uF.ADMIN_DISABLED;break;case"NewTeamsAsDefault":p=W$.uF.T21_DEFAULT;break;case"NewTeamsOnly":p=W$.uF.T21_ONLY;break;case"MicrosoftChoice":p=this.getMicrosoftChoicePolicyForUser(n,r??void 0,!!o,m??"",i);break;default:p=W$.uF.T1_DEFAULT}return i.stop({policy:p,cohort:n,t1Cohort:m??"",adminPolicy:a??void 0}),this.logger.log(`getAppSwitcherEffectivePolicy: useNewTeamsClient=${a} cohort=${n} policy=${p}`),p})))}getAppSwitcherCohort(){return(0,V$.zV)([this.coreSettings.getObservable(c.w.HostCapabilities,["officeUpdateRegKey"]),this.coreSettings.getObservable(c.w.Metadata,["ring"]),this.coreSettings.getObservable(c.w.UserResources,["licenseType"]),this.coreSettings.getObservable(c.w.Platform,["deviceInfo"]),this.coreSettings.getObservable(c.w.Host,["authBootstrapData"])]).pipe((0,o.T)((([e,t,n,i,a])=>{const o=this.scenarioFactory.newScenario(be.Cu.AppSwitcherIdentifyCohort),r=this.getAppSwitcherCohortFromSettings(o,n.licenseType,a.authBootstrapData?.licenseDetails,e,i,t.ring);return o.stop({reason:"FromSettings",cohort:r}),r})))}setNewTeamsOnlyEffectivePolicyStartTime(e){return this.userBiService.recordPanelAction({panelType:GR.HP.OpenApplication,actionScenario:GR.vB.UninstallT1AppTimerStarted,actionGesture:"auto"}),this.localStorage.trySet("newTeamsOnlyEffectivePolicyStartTime",e,"Framework","UserAndExperience")}getNewTeamsOnlyEffectivePolicyStartTime(){const e=this.localStorage.get("newTeamsOnlyEffectivePolicyStartTime","UserAndExperience");return e||void 0}removeNewTeamsOnlyEffectivePolicyStartTime(){this.userBiService.recordPanelAction({panelType:GR.HP.OpenApplication,actionScenario:GR.vB.UninstallT1AppTimerRemoved,actionGesture:"auto"}),this.localStorage.remove("newTeamsOnlyEffectivePolicyStartTime","UserAndExperience")}getMicrosoftChoicePolicyForUser(e,t,n,i,a){let o;return this.logger.log(`getMicrosoftChoicePolicyForUser: cohort=${e} enableT1AppswitcherEffectivePolicyFetch=${n} t1AppSwitcherEffectivePolicyHint=${i}`),t&&(o=this.getCohortPolicyFromECS(e,t),o)?(a.appendEventData({reason:"FromSettings"}),o.toLocaleUpperCase()):!o&&i&&n?(a.appendEventData({reason:"T1Hint"}),i.toLocaleUpperCase()):void 0}getCohortPolicyFromECS(e,t){let n;switch(e){case W$.sc.M365BusinessLicenseCohort:n=t?.M365BusinessLicenseCohort;break;case W$.sc.EarlyEnterpriseCohort:n=t?.EarlyEnterpriseCohort;break;case W$.sc.MidEnterpriseCohort:n=t?.MidEnterpriseCohort;break;case W$.sc.AdminsOfLateEnterpriseCohort:n=t?.AdminsOfLateEnterpriseCohort;break;case W$.sc.GovCloudCohort:n=t?.GovCloudCohort;break;case W$.sc.LateEnterpriseCohort:n=t?.LateEnterpriseCohort;break;case W$.sc.MacR36Cohort:n=t?.MacR36Cohort;break;case W$.sc.MacR4Cohort:n=t?.MacR4Cohort;break;case W$.sc.EduCohort:n=t?.EduCohort;break;case W$.sc.InternalRingCohort:n=t?.InternalRingCohort;break;case W$.sc.ExternalTapCohort:n=t?.ExternalTapCohort;break;case W$.sc.NoPPChannelCohort:n=t?.NoPPChannelCohort;break;case W$.sc.WebCohort:n=t?.WebCohort}return n??void 0}getStageForExpiredPolicy(e,t,n,i,a,o){let r;if(e)return this.policyExpirationType=W$.IW.ALL_UP_POLICY_EXPIRATION,this.policyExpirationStage=e,o.mark(be.BQ.AppSwitcherPolicyExpirationType,{policyExpirationType:W$.IW.ALL_UP_POLICY_EXPIRATION,rolloutStage:r}),r=e,r;if(n){if(t){const e=t[n.toLocaleLowerCase()];if(e){if(r=e.setentirecohortto,r)return this.policyExpirationType=W$.IW.COHORT_BASED_EXPIRATION,this.policyExpirationStage=r,o.mark(be.BQ.AppSwitcherPolicyExpirationType,{policyExpirationType:W$.IW.COHORT_BASED_EXPIRATION,rolloutStage:r}),r;if(r=e[i.toLocaleLowerCase()],r)return this.policyExpirationType=W$.IW.COHORT_AND_TAC_BASED_EXPIRATION,this.policyExpirationStage=r,o.mark(be.BQ.AppSwitcherPolicyExpirationType,{policyExpirationType:W$.IW.COHORT_AND_TAC_BASED_EXPIRATION,rolloutStage:r}),r}}}else if(a)return this.policyExpirationType=W$.IW.NO_COHORT_BASED_EXPIRATION,r=a,this.policyExpirationStage=r,o.mark(be.BQ.AppSwitcherPolicyExpirationType,{policyExpirationType:W$.IW.NO_COHORT_BASED_EXPIRATION,rolloutStage:r}),r;return r}getAppSwitcherCohortFromSettings(e,t,n,i,a,o){const r=o?.id?.toLocaleLowerCase()||"",s=i?.officeUpdateRegKey||"";if("Student"===t||"Teacher"===t)return e.appendEventData({licenseType:t}),W$.sc.EduCohort;const{clientPreviewOptOutStrategy:l}=this.coreSettings.get(c.w.Core,["clientPreviewOptOutStrategy"]);if("Web"===l)return W$.sc.WebCohort;const{environment:d}=this.coreSettings.get(c.w.Metadata)||$a.B.prod;if(d&&["gcchigh","dod","ag08","ag09","gallatin"].includes(d))return W$.sc.GovCloudCohort;if("macOS"===a?.deviceInfo?.osName){if("ring3_6"===r)return W$.sc.MacR36Cohort;if("general"===r)return W$.sc.MacR4Cohort}return Y$.internalRings.includes(r)?W$.sc.InternalRingCohort:"ring3_6"===r?W$.sc.ExternalTapCohort:(e.appendEventData({officeUpdateRegkey:s}),"production::mec"===s?W$.sc.MidEnterpriseCohort:"insiders::frdc"===s?W$.sc.AdminsOfLateEnterpriseCohort:"production::cc"!==s||n?.appSwitcherBusinessLicenseCategory?Object.values(W$.AY).includes(n?.appSwitcherBusinessLicenseCategory)?(e.appendEventData({businessLicenseCategory:n?.appSwitcherBusinessLicenseCategory||""}),W$.sc.M365BusinessLicenseCohort):s?W$.sc.LateEnterpriseCohort:W$.sc.NoPPChannelCohort:W$.sc.EarlyEnterpriseCohort)}}Y$.internalRings=["ring0","ring1","ring1_5","ring1_6","ring2","ring3","ring3_9"];class Q$ extends xp{constructor(){super(d.c1.InitAppSwitcherPolicyCheck,["coreSettings","loggerFactory","telemetryService","scenarioFactory","localStorage","userBiService"]),this._updateTelemetryOnPolicyStateChange=(e,t)=>{e.getAppSwitcherEffectivePolicy().subscribe((e=>{t.setCoreContext("appswitcherEffectivePolicy",e)}))},this._updateTelemetryOnCohortStateChange=(e,t)=>{e.getAppSwitcherCohort().subscribe((e=>{t.setCoreContext("appswitcherCohort",e)}))}}async execute(e){const{coreSettings:t,loggerFactory:n,telemetryService:i,scenarioFactory:a,localStorage:o,userBiService:r}=e,s=n.newLogger("InitAppSwitcherPolicyCheckTask","core-services-tasks"),l=new Y$(t,n,a,o,r);s.log("AppSwitcherPolicyCheckService initialization done."),e.appSwitcherPolicyCheckService=l,this._updateTelemetryOnPolicyStateChange(l,i),this._updateTelemetryOnCohortStateChange(l,i)}}class J$ extends xp{constructor(){super(d.c1.InitDesktopEcsContext,["coreSettings","discover","hostCommunicationService","i18NextWrapper","loggerFactory","platformService","authenticationUser"])}async execute(e){const{coreSettings:t,discover:n,hostCommunicationService:i,i18NextWrapper:a,loggerFactory:o,platformService:r,authenticationUser:s}=e,l=await i.loadModule("ecs");if(l?.setEcsContext){const e=await this.getDesktopEcsFilters(t,n,a,o,r,s);l.setEcsContext(e)}}async getDesktopEcsFilters(e,t,n,i,a,o){const{ring:r,environment:s,countryCode:l}=e.get(c.w.Metadata),{enableLocaleFilterForFeatureFlags:d,disableRegionParamForMaglev:u,enableCountryFilterForFeatureFlags:m,enableExperimentationLicenseFilters:p}=e.get(c.w.Core,["enableLocaleFilterForFeatureFlags","disableRegionParamForMaglev","enableCountryFilterForFeatureFlags","enableExperimentationLicenseFilters"]);let g,h,v;if(!u||p)try{const e=(0,tv.mI)(o),n=await t.getUser((0,Wh.$q)("init-desktop-ecs-context-task"),e);u||(g=n.region),p&&(h=n.experimentationTeamsLicenseCategories,v=n.experimentationTeamsAddOnPlans)}catch(e){this.logErrorToTelemetry(i,"Failed to get cached user from discover service.")}const{isInternalUser:y}=a.config,{originalRing:S}=a.ecsOverrides,f=d?n.locale:void 0,k=m?l:void 0;return s||this.logErrorToTelemetry(i,"Environment is undefined"),{cloud:s||"",isInternalUser:y,locale:f,originalRing:S,region:g,countryCode:k||void 0,ring:r?.id||"general",tenantId:o.profile.tenantId,userId:o.profile.objectId,teamsLicenseCategories:h,teamsAddOnPlans:v}}logErrorToTelemetry(e,t){this.logger||(this.logger=e.newLogger("InitDesktopEcsContextTask","core-services-tasks")),this.logger.errorToTelemetry?.(t,"webclient_framework_foundation_core_services_tasks",void 0,!0)}}var K$=n(497653);function Z$(e,t){return(n,i,a)=>{if(i>=Og.nW.OK&&i<=Og.nW.NOT_MODIFIED)return!1;const o=n<e&&i!==Og.nW.BAD_REQUEST&&i!==Og.nW.NOT_AUTHORIZED;return t.warn(`imageCookieRetryPolicy retry count ${n} responseCode ${i} canRetry ${o}`),o}}var X$=n(141873);function eW(e,t){return()=>({url:"v1/imageauth/cookie",method:"POST",headers:{"x-ms-client-caller":"imageAuthCookieSetupEM","x-ms-client-type":(0,X$.Y)(e,t)},credentials:"include",apiName:"consumerGroupsImageAuthCookie"})}function tW(e,t){const n=(0,E.v4)();return()=>({url:"v1/imageauth/deletecookie",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",RequestId:n,CorrelationId:n,TransactionId:n,"x-ms-client-type":(0,X$.Y)(e,t)},credentials:"include",apiName:"consumerGroupsImageAuthCookie"})}const nW="tfl_media_auth_cookie_service";class iW{constructor(e,t,n,i,a,o,r,s,l){this._endpointsManager=t,this._platformService=n,this._authenticationService=i,this._networkState=a,this._coreSettings=o,this._authStateProvider=r,this._config=s,this._localStorage=l,this._imageAuthCookieExpiryTsKey="ConsumerGroupsImageAuthCookieExpiryTs",this._imageCookieRetryInterval=2e4,this._imageCookieRetryMaxCount=5,this._authStateSubscription=void 0,this._networkStateSubscription=void 0,this._isInitialized=!1,this._consumerGroupsImageAuthCookieExpiryTs=void 0,this.setupConsumerGroupsImageAuthCookieEndpoints=({discover:e,authenticationResources:t,authenticationService:n})=>({baseUrlPromise:()=>e.regionGtm("groupsServiceV2"),serviceName:$g.p.GroupsServiceV2,authResource:(0,K$.nD)(n,t,K$.re),models:{setupConsumerGroupsImageAuthCookie:this.setupConsumerGroupsImageAuthCookie(),deleteConsumerGroupsImageAuthCookie:this.deleteConsumerGroupsImageAuthCookie()}}),this._logger=e.newLogger("Consumer Groups media auth service","services-io-browser-consumer-groups-media-auth-service"),this._imageCookieRetryInterval=this._coreSettings.get(c.w.ConsumerGroups)?.imageCookieRetryInterval||2e4,this._imageCookieRetryMaxCount=this._coreSettings.get(c.w.ConsumerGroups)?.imageCookieRetryMaxCount||5,this._window=(0,Un.z)(),this._consumerGroupsImageAuthCookieApi=this._endpointsManager.createApi(this.setupConsumerGroupsImageAuthCookieEndpoints)}async initConsumerGroupsMediaAuthService(){if(this._isInitialized)this.logToTelemetry("ConsumerGroupsMediaAuthService already initiated, skipping initialization");else{this.logToTelemetry("initiating ConsumerGroupsMediaAuthService");try{await this.fetchCookie("serviceInit"),this.subscribeToAuthStateChange(),this.subscribeToNetworkStateChange(),this.logToTelemetry("ConsumerGroupsMediaAuthService initiated"),this._isInitialized=!0}catch(e){this.logToTelemetry("failed to initiate ConsumerGroupsMediaAuthService",!0)}}}async logout(){this.cleanupCookieExpireInfo();try{await this._consumerGroupsImageAuthCookieApi.deleteConsumerGroupsImageAuthCookie(),this._authStateSubscription&&this._authStateSubscription.unsubscribe(),this._networkStateSubscription&&this._networkStateSubscription.unsubscribe(),this._cookieRefetchInterval&&this._window.clearTimeout(this._cookieRefetchInterval),this.logToTelemetry("deleted cookie on logout")}catch(e){this.logToTelemetry("failed to delete cookie on logout",!0)}}checkIsCookieExpired(e){const{enableStoringExpireInfoOnConsumerGroupsMediaAuthServiceClass:t,enableRefetchCookies:n}=this._coreSettings.get(c.w.ConsumerGroups),i=t?this._consumerGroupsImageAuthCookieExpiryTs:this._localStorage?.get(this._imageAuthCookieExpiryTsKey,"Global");if(!i)return this.logToTelemetry("cookie not found"),!0;if(i){const t=1e3*Number(i),a=Date.now();if(this.logToTelemetry(`checking cookie expiry for the current time: ${a} and the expiry time ${t} for ${e}`),a>=t)return this.logToTelemetry("cookie expired"),!0;if(n&&a<t&&"cookieRefetchInterval"===e)return this.handleCookieRefetchInterval(Number(i)),!1}return!1}async fetchCookie(e){if(!this.checkIsCookieExpired(e))return void this.logToTelemetry(`cookie not expired, skipping fetchCookie for ${e}`);const{enableRefetchCookies:t}=this._coreSettings.get(c.w.ConsumerGroups),n=await this.getAuthToken(),i=t?await this.getSkypeToken():void 0,a=!(!n||!n?.expires||t&&(!i||!i?.expires));try{if(a){const a=t?Math.min(Number(n.expires),Number(i?.expires)):Number(n.expires);await this._consumerGroupsImageAuthCookieApi.setupConsumerGroupsImageAuthCookie(),await this.storeCookieExpireInfo(a),this._consumerGroupsImageAuthCookieExpiryTs=a,this.handleCookieRefetchInterval(a),this.logToTelemetry(`setupConsumerGroupsImageAuthCookie successful for ${e} with expiry time ${a}`)}else this.logToTelemetry(`setupConsumerGroupsImageAuthCookie failed due to invalid tokens for ${e}`)}catch(t){this.logToTelemetry(`setupConsumerGroupsImageAuthCookie error for ${e}`,!0)}}getImageCookieRetryPolicy(){return{shouldRetry:Z$(this._imageCookieRetryMaxCount,this._logger),nextDelay:(e=this._imageCookieRetryInterval,t=>e*Math.pow(2,t))};var e}storeCookieExpireInfo(e){this._localStorage?.set(this._imageAuthCookieExpiryTsKey,`${e}`,"Auth","Global"),this.logToTelemetry("consumer groups cookie expire info stored in local storage succesfully")}handleCookieRefetchInterval(e){this._cookieRefetchInterval&&(this.logToTelemetry(`clearing previous cookie refetch interval: ${this._cookieRefetchInterval}`),this._window.clearTimeout(this._cookieRefetchInterval)),this.logToTelemetry(`setting cookie refetch interval at: ${e}`),this._cookieRefetchInterval=this._window.setTimeout((()=>this.fetchCookie("cookieRefetchInterval")),function(e){const t=1e3*e-Date.now();return Math.max(t,6e4)}(e))}async getAuthToken(){const{enableStoringErrorInfoForAuthToken:e}=this._coreSettings.get(c.w.ConsumerGroups);try{if("function"==typeof this._authenticationService?.acquireTokenV2){const e=await this._authenticationService.acquireTokenV2(K$.re);return this.logToTelemetry("getAuthToken successful"),e}return void this.logToTelemetry("getAuthToken failed due to missing acquireTokenV2 method")}catch(t){return void(e?this.logToTelemetry(`failed to get auth Token with error ${t?.message}`,!0,t?.message):this.logToTelemetry("failed to get auth Token",!0))}}async getSkypeToken(){const{authzResource:e}=this._coreSettings.get(c.w.Auth);if("function"==typeof this._authenticationService?.acquireTokenV2)if(e)try{const t=await this._authenticationService.acquireTokenV2(e);return this.logToTelemetry("getSkypeToken successful"),t}catch(e){return void this.logToTelemetry(`failed to get skype Token with error ${e?.message}`,!0,e?.message)}else this.logToTelemetry("getSkypeToken failed due to missing authzResource");else this.logToTelemetry("getSkypeToken failed due to missing acquireTokenV2 method")}cleanupCookieExpireInfo(){this._localStorage?.remove(this._imageAuthCookieExpiryTsKey,"Global")}logToTelemetry(e,t,n){t?this._logger.errorToTelemetry?.(e,nW,n?{errors:n}:void 0,!0):this._logger.infoToTelemetry?.(e,nW,void 0,!0)}subscribeToNetworkStateChange(){this._networkStateSubscription=this._networkState.observeIsOnline().pipe((0,Tg.F)(),(0,di.p)((e=>!!e))).subscribe((async()=>{this.logToTelemetry("network state changed to online, checking cookie"),await this.fetchCookie("networkStateChange")}))}subscribeToAuthStateChange(){this._authStateProvider?this._authStateSubscription=this._authStateProvider?.observe().pipe((0,Tg.F)(),(0,di.p)((e=>e.state===dh.k.Up))).subscribe((()=>{this.logToTelemetry("Auth state back Up, checking cookie"),this.fetchCookie("authStateChange")})):this.logToTelemetry("authStateProvider is not available",!0)}deleteConsumerGroupsImageAuthCookie(){return Promise.resolve({constructRequest:tW(this._platformService,this._config),allowedResponses:[Og.bw.HTTP_2XX]})}setupConsumerGroupsImageAuthCookie(){return Promise.resolve({constructRequest:eW(this._platformService,this._config),allowedResponses:[Og.bw.HTTP_2XX],retryPolicy:this.getImageCookieRetryPolicy()})}}class aW extends xp{constructor(){super(d.c1.InitConsumerGroupsMediaAuthTask,["authStateProvider","authenticationService","config","coreSettings","endpointsManager","localStorage","loggerFactory","networkState","platformService"])}async execute(e){const t=e.coreSettings?.get(c.w.ConsumerGroups);if(!t?.useGroupsProfilePicCookieService)return;const n=function(e,t,n,i,a,o,r,s,l){return new iW(e,t,n,i,a,o,r,s,l)}(e.loggerFactory,e.endpointsManager,e.platformService,e.authenticationService,e.networkState,e.coreSettings,e.authStateProvider,e.config,e.localStorage);return e.consumerGroupsMediaAuthService=n,n.initConsumerGroupsMediaAuthService(),async e=>{"signout"===e&&await n.logout()}}}class oW{constructor(e){this.context=e,this.enabled=!1,this.sessionCounter=0,this.globalWindow=window}async writeToEtw(e){if(this.enabled){const t={message:`${e},SessionCount:${this.sessionCounter}`,channel:"JS_ETW",severity:wj.S.debug};this.etwModule?.writeEtwEvent?.(t)}}async start(){this.etwModule=await(this.context.hostCommunicationService?.loadModule("etw")),await this.registerEtwUpdates()}isPromiseRejectionEvent(e){return"reason"in e}isErrorEvent(e){return"message"in e}handleError(e){if(this.isPromiseRejectionEvent(e)){if(!e.reason.message)return void this.writeToEtw(JSON.stringify(e.reason));this.writeToEtw(`${e.reason.message}\n${e.reason.stack}`)}else if(this.isErrorEvent(e)){const t=[e.message,e.filename,e.lineno,e.colno,e.context,e.code,e.subContext,e.error?.graphQLErrors?.[0]?.path||"",e.error?.graphQLErrors?.[0]?.nodes?.[0]?.arguments?.[0]?.kind||"",e.error?.graphQLErrors?.[0]?.nodes?.[0]?.arguments?.[0]?.name?.kind||"",e.error?.graphQLErrors?.[0]?.nodes?.[0]?.arguments?.[0]?.name?.value||""].filter(Boolean).join(",");this.writeToEtw(t)}}registerErrorHandlers(){this.globalWindow.addEventListener("unhandledrejection",this.handleError.bind(this)),this.globalWindow.addEventListener("error",this.handleError.bind(this))}unregisterErrorHandlers(){this.globalWindow.removeEventListener("unhandledrejection",this.handleError),this.globalWindow.removeEventListener("error",this.handleError.bind(this))}async registerEtwUpdates(){try{this.etwModule?.registerForTracingChanged&&this.etwModule?.registerForTracingChanged((e=>{e.enabled?(0===this.sessionCounter&&(this.enabled=e.enabled,this.registerErrorHandlers()),this.sessionCounter++):(this.sessionCounter=0,this.enabled=e.enabled,this.unregisterErrorHandlers())}))}catch{}}}class rW extends xp{constructor(){super(d.c1.InitEtwTask,[])}async execute(e){const t=new oW(e);await t.start()}}class sW{constructor(e,t){this.coreSettings=e,this.hostCommunicationService=t;const n=this.coreSettings.get(c.w.Metadata);this.expConfigMetadata=[{client:kU,config:{expIds:n.configIds?.experiments?.join(",")??"",rolloutIds:n.configIds?.rollouts?.join(",")??"",eTag:n.eTag??"",expRolloutIdAllowList:n.expRolloutIdAllowList?.join("")??""}},{client:CU,config:{expIds:"",rolloutIds:"",eTag:n.hostETag??"",expRolloutIdAllowList:n.expRolloutIdAllowList?.join("")??""}}],this.subject=new ya.t(this.expConfigMetadata),this.ecmObservable=this.subject.asObservable(),this.registerSyncHostEcm()}updateHostExperimentConfigMetadata(e){const t=e.find((e=>e.client===CU)),n=this.expConfigMetadata.findIndex((e=>e.client===CU));t&&n>-1&&(this.expConfigMetadata[n]=t,this.subject.next(this.expConfigMetadata))}updateWebExperimentConfigMetadata(e){const t=this.expConfigMetadata.find((e=>e.client===kU))?.config;t&&e.eTag&&e.configIds&&e.configIds.experiments&&(t.eTag=e.eTag,t.expIds=e.configIds.experiments.join(","),t.expRolloutIdAllowList=e.expRolloutIdAllowList?.join(",")??"",e.expRolloutIdAllowList?.length&&(t.rolloutIds=NU(e).join(",")))}async communicateWithHost(){const e=this.expConfigMetadata.find((e=>e.client===kU))?.config;if(!e)return;const t=await(this.hostCommunicationService?.loadModule("ecs"));if(!t)return;const n=await(t.syncEcm?.([{client:kU,config:e}]));if(n&&n.client===CU){const e=[{client:CU,config:{eTag:n.config.eTag,expIds:n.config.expIds,rolloutIds:n.config.rolloutIds,expRolloutIdAllowList:n.config.expRolloutIdAllowList}}];this.updateHostExperimentConfigMetadata(e)}}registerSyncHostEcm(){this.hostCommunicationService?.loadModule("ecs").then((e=>{e?.registerForOnSyncEcm?.((e=>{this.updateHostExperimentConfigMetadata(e)}))}))}}class lW extends xp{constructor(){super(d.c1.InitExperimentation,["coreSettings","hostCommunicationService"])}async execute(e){const{coreSettings:t,hostCommunicationService:n}=e;e.experimentationService=new sW(t,n)}}class cW extends xp{constructor(){super(d.c1.InitPreAuthSettingsEcsProvider,[])}async execute(e){const{coreSettings:t,coreSettingsContext:n,loggerFactory:i,...a}=Nf("InitPreAuthSettingsEcsProvider",e,"coreSettings","coreSettingsContext","loggerFactory","scenarioFactory","networkState","clientState","windowProvider","endpointsManager"),{enablePreAuthEcsFetch:o}=t.get(c.w.Core);if(!o)return;const r=n;await r.initializeEcsProvider({...a})}}class dW extends xp{constructor(){super(d.c1.InitSettingsEcsProvider,["coreSettings","coreSettingsContext","authenticationService","loggerFactory","scenarioFactory","networkState","clientState","windowProvider","endpointsManager"])}async execute(e){const{coreSettings:t,coreSettingsContext:n,authenticationService:i,loggerFactory:a,scenarioFactory:o,networkState:r,clientState:s,windowProvider:l,endpointsManager:d}=e,{enablePreAuthEcsFetch:u}=t.get(c.w.Core);if(u)return;const m=await this.getPrimaryUser(i,a),p=n;await p.setPrimaryUser(m),await p.initializeEcsProvider({scenarioFactory:o,networkState:r,clientState:s,windowProvider:l,endpointsManager:d,authenticationUser:m})}async getPrimaryUser(e,t){let n;try{const t=await(e.getCachedUsers?.({id:(0,mh.DA)(),scenarioName:be.Cu.AuthWebCachedUser,source:"init-settings-ecs-provider-task"},{isPrimaryUser:!0}));t&&t.length>0&&(n=(0,kt.aj)(t[0]))}catch(e){t.newLogger("InitSettingsEcsProviderTask","core-services-tasks").warn("No primary user returned from authentication: ",e)}return n}}class uW extends xp{constructor(){super(d.c1.InitSettingsMaglevHostProvider,["coreSettingsContext","hostCommunicationService"])}async execute(e){const{coreSettingsContext:t,hostCommunicationService:n}=e,{enableMaglevHostProvider:i}=t.getCoreSettings().get(c.w.Core);i&&await t.initializeMaglevHostProvider(n)}}const mW={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataPoliciesPoliciesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespaces"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"policies"},arguments:[{kind:"Argument",name:{kind:"Name",value:"correlationId"},value:{kind:"Variable",name:{kind:"Name",value:"correlationId"}}},{kind:"Argument",name:{kind:"Name",value:"namespaces"},value:{kind:"Variable",name:{kind:"Name",value:"namespaces"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"jsonData"}}]}}]}}]},pW={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ServicesIoDataPoliciesPoliciesSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"policiesUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"jsonData"}}]}}]}}]};class gW{constructor(e,t,n,i,a,o,r){this.scenarioFactory=a,this.host=o,this.clientStateProvider=r,this.namespacesToFetch=[],this.settings={},this.refreshIntervalInMs=36e5,this.fetch=()=>{if(0===this.namespacesToFetch.length)return this.logger.debug("Skipping fetch() as no namespacesToFetch registered."),Promise.resolve();const e=this.scenarioFactory.newScenario(this.getScenarioName());return this.validateEnvironment().then((()=>this.fetchPolicies(e))).catch((t=>{e.stop({errors:t},"abandoned"),this.logger.warn(`Error fetching policies: ${t}`)}))},this.validateEnvironment=()=>new Promise(((e,t)=>{this.clientStateProvider.getState()===Ba.Lg.VeryActive&&(this.logger.log("Cancel policy fetching, due to app being in a very active state."),t("very active")),e()})),this.cleanupClientStateSubscription=()=>{this.clientStateSubscription?.unsubscribe(),this.clientStateSubscription=void 0},this.logger=e.newLogger(`CoreSettings/${t}`,"services-io-data-policies"),this.namespacesToFetch=(0,rS.Dq)(n,i),this.namespacesToFetch.forEach((e=>{this.settings[e]={}})),this.updateConfigs(i)}async initialize(e=!0){this.isInitialized=!0,await this.fetchAndSetRefreshCadence()}subscribeForSettingsUpdates(e){this.settingsChangedCallbackFunction=e}cleanup(){this.cleanupClientStateSubscription(),this.settingsChangedCallbackFunction=void 0,this.coreSubscription?.unsubscribe(),this.coreSubscription=void 0}notifySettingsChanged(){const e=()=>{this.cleanupClientStateSubscription(),this.settingsChangedCallbackFunction?.(this.settings),this.logger.debug("Notified about policy change")};return this.clientStateProvider.getState()!==Ba.Lg.VeryActive?(e(),!0):(this.clientStateSubscription||(this.clientStateSubscription=this.clientStateProvider.observe().subscribe((t=>{t!==Ba.Lg.VeryActive&&e()}))),!1)}handleError(e){this.logger.error(`Failed to fetch tenant settings with error: ${e}`)}updateConfigs(e){const t=e.getObservable(c.w.Core);this.coreSubscription=t.subscribe((e=>{e.policyRefreshIntervalInMs&&this.updateRefreshCadence(e.policyRefreshIntervalInMs)}))}updateRefreshCadence(e){this.refreshIntervalInMs=e,this.isInitialized&&this.queueNextPolicyFetch()}fetchAndSetRefreshCadence(){return this.fetch().then((()=>{this.queueNextPolicyFetch()})).catch((e=>{this.logger.error(`Error fetching policies: ${e}`)}))}queueNextPolicyFetch(){if(!this.isInitialized)throw new Error("Service not initialized to queue the fetch.");this.setIntervalHandle&&(this.host.clearInterval(this.setIntervalHandle),this.setIntervalHandle=void 0,this.logger.debug("clearInterval() called.")),this.refreshIntervalInMs>0?(this.setIntervalHandle=this.host.setInterval(this.fetch,this.refreshIntervalInMs),this.logger.debug("setInterval() called.")):this.logger.error(`Refresh interval not valid: ${this.refreshIntervalInMs}`)}}class hW extends gW{constructor(e,t,n,i,a,o,r){super(e,"PoliciesResolversDataProvider",t,n,i,a,r),this.apolloClient=o,this.handlePoliciesUpdatedEvent=e=>{this.logger.log("handlePoliciesUpdatedEvent() called.");try{void 0!==e&&this.parsePolicies(e)?this.notifySettingsChanged():this.logger.log(`handlePoliciesUpdatedEvent(): policiesString is ${void 0===e?"undefined":"empty"}.`)}catch(e){this.logger.error(`handlePoliciesUpdatedEvent(): ${e.message}`)}}}async initialize(e=!0){const t=this;return this.policiesApolloSubscription=this.apolloClient.subscribe({query:pW}).subscribe({next(e){t.handlePoliciesUpdatedEvent(e?.data?.policiesUpdatedEvent?.jsonData??void 0)}}),super.initialize()}cleanup(){super.cleanup(),this.policiesApolloSubscription?.unsubscribe(),this.policiesApolloSubscription=void 0}getScenarioName(){return be.Cu.PoliciesFetchDataResolvers}fetchPolicies(e){return this.apolloClient.query({query:mW,variables:{correlationId:e.id,namespaces:this.namespacesToFetch},fetchPolicy:"no-cache"}).then((t=>{t?.error&&this.logger.errorToTelemetry?.(`fetchPolicies:then: Message: ${t.error.message}.`,"webclient_framework_policies_resolvers_fetch_failed_event",void 0,!0),t?.errors&&t.errors.forEach((e=>{this.logger.errorToTelemetry?.(`fetchPolicies:then: Errors:Message: ${e.message}.`,"webclient_framework_policies_resolvers_fetch_failed_event",void 0,!0)}));const n=t?.data?.policies?.jsonData??void 0;let i=!1,a="success";void 0!==n&&this.parsePolicies(n)?i=this.notifySettingsChanged():(this.logger.log(`fetchPolicies(): Got ${void 0===n?"undefined":"empty"} response.`),a="incomplete"),e.stop({message:(0,ge.hR)({notified:i})},a)})).catch((t=>{this.handleError(t),e.fail({errors:t.message??"Failed to fetch policies via resolvers."})}))}parsePolicies(e){let t={};try{t=JSON.parse(e)}catch{throw new Error("parsePolicies(): Unable to parse policies string.")}return 0!==Object.keys(t).length&&(this.namespacesToFetch.forEach((e=>{t[e]&&(this.settings[e]=t[e])})),!0)}}class vW extends xp{constructor(){super(d.c1.InitSettingsPolicyProvider,["authenticationUser","client","clientState","configLoader","coreSettings","coreSettingsContext","loggerFactory","scenarioFactory","windowProvider"])}async execute(e){const{authenticationUser:t,client:n,clientState:i,configLoader:a,coreSettings:o,coreSettingsContext:r,loggerFactory:s,scenarioFactory:l,windowProvider:d}=e,{disableNonBlockingPolicyProviderInit:u,disablePolicyProvider:m}=o.get(c.w.Core);if(m)return;if(!t||t.role===pg.a7.Anonymous)return;const p=new hW(s,a,o,l,d,n,i);if(u)await r.initializePolicyProvider(p);else{const e=s.newLogger("InitPolicyProviderTask","core-services-tasks");r.initializePolicyProvider(p).then((()=>{e.log("Initialized policy provider successfully.")})).catch((t=>{e.errorToTelemetry&&e.errorToTelemetry(`Initialization of policy provider failed. ${t}`,"webclient_framework_foundation_core_services",void 0,!0)}))}return e=>{if("signout"===e)p.cleanup()}}}const yW="preReleaseFeaturesAllowed";class SW extends xp{constructor(){super(d.c1.InitSettingsWithDiscoveredUser,["authenticationService","authenticationUser","config","coreSettings","coreSettingsContext","endpointsManager","localStorage","loggerFactory","platformService","user"])}async execute(e){const{authenticationService:t,authenticationUser:n,config:i,coreSettings:a,coreSettingsContext:o,endpointsManager:r,localStorage:s,loggerFactory:l,platformService:d,user:u}=e;let m={};const{enablePreReleaseClientFilter:p}=a.get(c.w.Core);if(p){const e=await this.getPreReleaseUserInfo({authenticationService:t,authenticationUser:n,config:i,coreSettings:a,endpointsManager:r,localStorage:s,loggerFactory:l,platformService:d});m={...m,preReleaseFeaturesAllowed:e}}const g=o,{enableMTMA:h}=a.get(c.w.Core),v=!h||await FS(t,n);await g.initializeProvidersWithDiscoveredUser(u,{isPrimaryUser:v,clientFilterParams:m})}async getPreReleaseUserInfo({authenticationService:e,authenticationUser:t,config:{experienceName:n},coreSettings:i,endpointsManager:a,localStorage:o,loggerFactory:r,platformService:s}){const l=r.newLogger("InitSettingsWithDiscoveredUserTask","core-services-tasks"),{preReleaseFeaturesAllowed:d}=i.get(c.w.Metadata);if(!d)return l.log("No pre release features are allowed."),!1;if(await FS(e,t))return l.log(`Returning preReleaseAllowed filter for primary user: ${d}`),!!d;try{const e=o.get(yW);if(null!=e)return l.log(`Cached preReleaseAllowed filter loaded: ${e}`),JSON.parse(e);const c={userId:t?.profile.objectId,tenantId:t?.profile.tenantId},d=(0,wk.Ck)({coreSettings:i,experienceName:n,platformService:s,user:c,logger:l}),u=(0,Ck.DJ)({serviceName:"ClientFilters",ecsParameters:d,loggerFactory:r,endpointsManager:a}),m=await u.fetch(),p=this.getValueFromPayload(m,d);return void 0!==p?(l.log(`Storing preReleaseAllowed filter in cache: ${p}`),o.set(yW,p.toString(),"Framework")):l.log("Could not get preReleaseAllowed filter from ECS."),!!p}catch(e){l.errorToTelemetry?.((0,mh.hR)(e),"web_infra_determine_pre_release_filter_failed")}return!1}getValueFromPayload(e,t){if(e.requestStatus===bk.x.Success)return t.agents?.some((t=>{const n=e.ecsConfiguration?.[t];return!!n?.metadata?.preReleaseFeaturesAllowed}))}}class fW extends xp{constructor(){super(d.c1.InitSettingsWithPrimaryUser,["authenticationUser","coreSettings","coreSettingsContext","discover"])}async execute(e){const{authenticationUser:t,coreSettings:n,coreSettingsContext:i,discover:a}=e,{userTrackingService:o}=e,{enableExperimentationLicenseFilters:r}=n.get(c.w.Core),s=i;if(r){const e=(0,tv.mI)(t),n=await a.getUser((0,Wh.$q)("init-settings-with-primary-user-task"),e),i=o?.getAccountCountCurrentCloud()||0;await s.setPrimaryUser(t,n,i),o&&s.setUserTrackingService(o)}else await s.setPrimaryUser(t);return async e=>{if("signout"===e)await i.clearPrimaryUser()}}}var kW;!function(e){e[e.ComposeMessageTyping=0]="ComposeMessageTyping",e[e.MessageListScroll=1]="MessageListScroll",e[e.PowerbarTyping=2]="PowerbarTyping",e[e.VirtualTreeListScroll=3]="VirtualTreeListScroll",e[e.FeedsFilterTyping=4]="FeedsFilterTyping",e[e.PeoplePickerTyping=5]="PeoplePickerTyping",e[e.SearchBoxTyping=6]="SearchBoxTyping",e[e.FloodgatePopup=7]="FloodgatePopup",e[e.ChatListSearchFilterTyping=8]="ChatListSearchFilterTyping",e[e.ChannelListSearchFilterTyping=9]="ChannelListSearchFilterTyping",e[e.CallingPerfSample=10]="CallingPerfSample",e[e.AllChannelSystemMessagesScroll=11]="AllChannelSystemMessagesScroll",e[e.AllPinnedPostsScroll=12]="AllPinnedPostsScroll",e[e.DiscoverSurfaceFeedListScroll=13]="DiscoverSurfaceFeedListScroll",e[e.TeamsAndChannelsTableScroll=14]="TeamsAndChannelsTableScroll",e[e.PostComposeTyping=15]="PostComposeTyping",e[e.UnifiedFunPickerTyping=16]="UnifiedFunPickerTyping",e[e.CreateTeamGalleryScroll=17]="CreateTeamGalleryScroll",e[e.AddMemberScroll=18]="AddMemberScroll",e[e.MeetForWorkListScroll=19]="MeetForWorkListScroll",e[e.MeetForWorkSearchFilterTyping=20]="MeetForWorkSearchFilterTyping",e[e.PeopleAppContactListScroll=21]="PeopleAppContactListScroll",e[e.SimpleCollabLeftRailScroll=22]="SimpleCollabLeftRailScroll",e[e.SliceViewSurfaceListScroll=23]="SliceViewSurfaceListScroll",e[e.ThreadListScroll=24]="ThreadListScroll"}(kW||(kW={}));var CW=n(932873);class bW{constructor(e){this.histogram=new Map,this.bucketSize=e.bucketSize,this.maxBucketValue=e.maxBucketValue,this.fixedDecimals=function(e){let t=0;const n=10;for(;Math.floor(e)!==e;)e*=n,t++;return t}(this.bucketSize)}record(e,t){t=(t=t||1)<1?1:t;const n=Math.min(Math.floor(e/this.bucketSize)*this.bucketSize,this.maxBucketValue).toFixed(this.fixedDecimals),i=this.histogram.get(n)||0;this.histogram.set(n,i+t)}toObject(){const e={};return Array.from(this.histogram.keys()).forEach((t=>e[t]=this.histogram.get(t))),e}clear(){this.histogram.clear()}}const wW="getAndClearAriTelemetry";class TW{constructor(e,t){this.host=e,this.context=t,this.startSlot=0,this.blinkInterval=100,this.trailingTimespan=d.f2.second,this.rafRecords=new Map,this.activeUserActionType=void 0,this.wheelEventTriggeredUserActionType=void 0,this.userActions=new Map,this.validActions=new Map,this.lastEventTimeSlot=this.startSlot,this.isDebugging=!1,this.minAriDuration=200,this.minEtwTriggeringDelay=1e3,this.minEtwTriggeringFrameDelay=1e3,this.lastRafTime=0,this.strategies=[{name:"TwoRafAndLimitedStopTimeStrategy",lowestAllowedRafs:2,allowStopTimeOverwrite:!0}],this.onVisibilityChange=()=>{"hidden"===this.host.document.visibilityState&&this.stopMeasurement()},this.logger=t.loggerFactory.newLogger("ARI","core-services-telemetry"),this.hostCommunicationService=t.hostCommunicationService,this.initializeOnAppLaunchAndReinit(),this.__initTestingMode__(this.context.coreSettings.get(c.w.Host)),this.defaultHost=e}trackEvent(e,t,n,i,a,o){const r=this.getUserActionType(e,t),{isDebugging:s,logger:l}=this;if(void 0===r||!(r in kW))return void(s&&l.debug(`[${this.formatActionKey(e,t)}] TrackEvent | No action found`));if(o)return void(this.wheelEventTriggeredUserActionType=r);const c=this.getMeasurementName(r),d=i.performance.now();if(s&&l.debug(`[${c} TrackEvent | [${Math.round(n)}...${Math.round(d)}] ${Math.round(d-n)}ms`),void 0===this.activeUserActionType)s&&l.debug(`[${c}] track-start`),this.startMeasurement(r,n,i,a);else if(this.activeUserActionType!==r||this.host!==i||this.actionLocation!==a)s&&l.debug(`[${c}] track-stop`),this.stopMeasurement(i),s&&l.debug(`[${c}] track-start`),this.startMeasurement(r,n,i,a);else{if(s){const e=`[${c}] track-continue`;l.debug(e),function(e,t,n){e.mark(t,n),e.clearMarks(t)}(this.host.performance,e,{startTime:n})}this.continueMeasurement(n)}}handleUnmount(e){this.stopMeasurement(e)}getTelemetry(e=CW.Mv.HeartbeatMonitor){return this.getTelemetryFilteredByType(e)}getTelemetryTypeForAction(e){return e===kW.CallingPerfSample?CW.Mv.CallingPerfMonitor:CW.Mv.HeartbeatMonitor}isActionOfTelemetryType(e,t){return this.getTelemetryTypeForAction(e)===t}getTelemetryFilteredByType(e){void 0!==this.activeUserActionType&&this.isActionOfTelemetryType(this.activeUserActionType,e)&&this.stopMeasurement();const t={};let n=!1;const i={totalIntervalCount:0,passIntervalCount:0,measurements:0,wheelMeasurements:0,max:{totalIntervalCount:0,passIntervalCount:0}};this.userActions.forEach(((a,o)=>{if(void 0!==kW[a.type]&&this.isActionOfTelemetryType(a.type,e)){const e={};a.scores.forEach(((t,n)=>{(e=>{e&&(i.passIntervalCount+=e.passIntervalCount,i.totalIntervalCount+=e.totalIntervalCount,i.measurements+=e.measurements,i.wheelMeasurements+=e.wheelMeasurements,i.max.passIntervalCount=Math.max(i.max.passIntervalCount,e.passIntervalCount),i.max.totalIntervalCount=Math.max(i.max.totalIntervalCount,e.totalIntervalCount))})(t),e[n]=this.getAri(t),e[`${n}-score`]=t})),a.scoreHistograms.forEach(((t,n)=>{e[`${n}-scoreHistogram`]=t.toObject()})),e.frameDelayHistogram=a.frameDelayHistogram.toObject(),t[o]=e,n=!0,this.userActions.delete(o),this.isDebugging&&this.logger.debug(`[AppResponsivenessService]: clear action for type ${kW[a.type]}`)}})),t.Total=this.getAri(i),t.score=i;let a="";if(n)try{a=JSON.stringify(t)}catch(e){this.logger.error("[AppResponsivenessService]: unexpected error parsing log object. Likely because of circular reference.")}return a}clearTelemetry(){this.userActions.clear(),this.clearTelemetryTimeoutId&&this.context.windowProvider.clearTimeout(this.clearTelemetryTimeoutId),this.clearTelemetryTimeoutId=this.context.windowProvider.setTimeout((()=>{this.clearTelemetry()}),d.f2.tenMinutes,!1)}initializeOnAppLaunchAndReinit(){this.initSettings(),this.registerValidActions(),this.clearTelemetry()}__initTestingMode__(e){if(e){const t=e.userType;t&&t.indexOf("test")>-1&&(this.isDebugging=!0,wW in window||(window[wW]=()=>{const e=this.getTelemetry();return this.clearTelemetry(),e}))}}registerValidActions(){this.validActions.set(this.formatActionKey(CW.pG.Floodgate,d.Kw.System),kW.FloodgatePopup),this.validActions.set(this.formatActionKey(CW.pG.ComposeMessage,d.Kw.Keyup),kW.ComposeMessageTyping),this.validActions.set(this.formatActionKey(CW.pG.MessageList,d.Kw.Scroll),kW.MessageListScroll),this.validActions.set(this.formatActionKey(CW.pG.ThreadList,d.Kw.Scroll),kW.ThreadListScroll),this.validActions.set(this.formatActionKey(CW.pG.Powerbar,d.Kw.Keyup),kW.PowerbarTyping),this.validActions.set(this.formatActionKey(CW.pG.VirtualTreeList,d.Kw.Scroll),kW.VirtualTreeListScroll),this.validActions.set(this.formatActionKey(CW.pG.SimpleCollabLeftRail,d.Kw.Scroll),kW.SimpleCollabLeftRailScroll),this.validActions.set(this.formatActionKey(CW.pG.FeedsFilter,d.Kw.Keyup),kW.FeedsFilterTyping),this.validActions.set(this.formatActionKey(CW.pG.PeoplePicker,d.Kw.Keyup),kW.PeoplePickerTyping),this.validActions.set(this.formatActionKey(CW.pG.PostCompose,d.Kw.Keyup),kW.PostComposeTyping),this.validActions.set(this.formatActionKey(CW.pG.SearchBox,d.Kw.Keyup),kW.SearchBoxTyping),this.validActions.set(this.formatActionKey(CW.pG.ChatListSearchFilter,d.Kw.Keyup),kW.ChatListSearchFilterTyping),this.validActions.set(this.formatActionKey(CW.pG.ChannelListSearchFilter,d.Kw.Keyup),kW.ChannelListSearchFilterTyping),this.validActions.set(this.formatActionKey(CW.pG.CallingPerf,d.Kw.Sample),kW.CallingPerfSample),this.validActions.set(this.formatActionKey(CW.pG.DiscoverSurfaceFeedList,d.Kw.Scroll),kW.DiscoverSurfaceFeedListScroll),this.validActions.set(this.formatActionKey(CW.pG.AllPinnedPosts,d.Kw.Scroll),kW.AllPinnedPostsScroll),this.validActions.set(this.formatActionKey(CW.pG.AllChannelSystemMessages,d.Kw.Scroll),kW.AllChannelSystemMessagesScroll),this.validActions.set(this.formatActionKey(CW.pG.TeamsAndChannelsTable,d.Kw.Scroll),kW.TeamsAndChannelsTableScroll),this.validActions.set(this.formatActionKey(CW.pG.UnifiedFunPicker,d.Kw.Keyup),kW.UnifiedFunPickerTyping),this.validActions.set(this.formatActionKey(CW.pG.CreateTeamGallery,d.Kw.Scroll),kW.CreateTeamGalleryScroll),this.validActions.set(this.formatActionKey(CW.pG.AddMember,d.Kw.Scroll),kW.AddMemberScroll),this.validActions.set(this.formatActionKey(CW.pG.MeetForWorkList,d.Kw.Scroll),kW.MeetForWorkListScroll),this.validActions.set(this.formatActionKey(CW.pG.MeetForWorkSearchFilter,d.Kw.Keyup),kW.MeetForWorkSearchFilterTyping),this.validActions.set(this.formatActionKey(CW.pG.PeopleAppContactList,d.Kw.Scroll),kW.PeopleAppContactListScroll),this.validActions.set(this.formatActionKey(CW.pG.SimpleCollabLeftRail,d.Kw.Scroll),kW.SimpleCollabLeftRailScroll),this.validActions.set(this.formatActionKey(CW.pG.SliceViewMessgeList,d.Kw.Scroll),kW.SliceViewSurfaceListScroll)}getUserActionType(e,t){const n=this.formatActionKey(t,e);return this.validActions.get(n)}formatActionKey(e,t){return`${e}_${t}`}registerRafCallback(){this.rafCallbackId||(this.lastRafTime=this.host.performance.now(),this.rafCallbackId=this.host.requestAnimationFrame((()=>this.measureRaf())))}unregisterRafCallback(){this.rafCallbackId&&(this.host.cancelAnimationFrame(this.rafCallbackId),this.clearRaf())}clearRaf(){this.rafCallbackId=void 0,this.rafRecords.clear()}getAri(e){return e&&0!==e.totalIntervalCount?Math.round(e.passIntervalCount/e.totalIntervalCount*d.f2.second)/d.f2.second:0}initSettings(){const{enableAriDebugging:e,appResponsivenessConstants:t}=this.context.coreSettings.get(c.w.Telemetry),n=this.context.coreSettings.get(c.w.Host).showScenarioStepsInPerfTrace||this.context.coreSettings.get(c.w.Core).showScenarioStepsInPerfTrace;this.isDebugging=e||n||!1,this.blinkInterval=t&&t.blinkInterval||100,this.trailingTimespan=t&&t.trailingTimespan||d.f2.second,this.minEtwTriggeringDelay=t?.minEtwTriggeringDelay||1e3,this.minEtwTriggeringFrameDelay=t?.minEtwTriggeringFrameDelay||1e3}startMeasurement(e,t,n,i){this.assignHost(n),this.actionLocation=i,this.activeUserActionType=e,this.eventStartTime=t||this.host.performance.now(),this.lastEventTimeSlot=this.getTimeSlot(this.eventStartTime);const a=this.getMeasurementName(e);if(this.isDebugging){const e=`[${a}] START`,t=`${e} | ${this.host.performance.now()} | Event: ${this.eventStartTime}`;this.host.performance.mark(e,{startTime:this.eventStartTime}),this.logger.debug(t)}this.registerRafCallback();let o=this.userActions.get(a);void 0===o&&(o={scores:new Map,scoreHistograms:new Map,startTime:this.startSlot,type:e,frameDelayHistogram:new bW({bucketSize:500,maxBucketValue:15e3})},this.userActions.set(a,o)),o.startTime=this.eventStartTime}stopMeasurement(e=this.host){if(void 0===this.activeUserActionType)return void(e===this.host&&this.assignHost(this.defaultHost));const t=this.getMeasurementName(this.activeUserActionType),n=this.userActions.get(t);if(void 0!==n){if(this.isDebugging){const e=`[${t}] END`;this.host.performance.mark(e),this.logger.debug(`${e} | ${this.host.performance.now()}`)}this.finalizeMeasurement(n)}this.unregisterRafCallback(),this.wheelEventTriggeredUserActionType===this.activeUserActionType&&(this.wheelEventTriggeredUserActionType=void 0),this.activeUserActionType=void 0,this.actionLocation=void 0,e===this.host&&this.assignHost(this.defaultHost)}continueMeasurement(e){this.lastEventTimeSlot=this.getTimeSlot(e)}finalizeMeasurement(e,t){this.strategies.forEach((n=>{const i=t&&n.allowStopTimeOverwrite?t:this.getCurrentTimeSlot(),a=Math.round(this.host.performance.now()-e.startTime);if(a<this.minAriDuration)return;const o=this.getResponsivenessScore(this.startSlot,i,n);this.recordPerInteractionAri(e,a,o,n);const r=e.scores.get(n.name);r?(r.passIntervalCount+=o.passIntervalCount,r.totalIntervalCount+=o.totalIntervalCount,r.measurements+=o.measurements,r.wheelMeasurements+=o.wheelMeasurements,r.max.passIntervalCount=Math.max(r.max.passIntervalCount,o.passIntervalCount),r.max.totalIntervalCount=Math.max(r.max.totalIntervalCount,o.totalIntervalCount)):e.scores.set(n.name,{totalIntervalCount:o.totalIntervalCount,passIntervalCount:o.passIntervalCount,measurements:o.measurements,wheelMeasurements:o.wheelMeasurements,max:o.max});const s=(o.passIntervalCount/o.totalIntervalCount).toFixed(2);if(this.logger.log(`[${this.getMeasurementName(e.type)}] duration: ${a}ms measurement: ${o.passIntervalCount}/${o.totalIntervalCount} (${s})`),this.isDebugging){const t=this.getMeasurementName(e.type),n={name:t,pass:o.passIntervalCount,total:o.totalIntervalCount,result:s},i=`ari-measurement => ${JSON.stringify(n)}`,a=`[${t}] START`,r=`[${t}] END`;cS(this.host.performance,i,a,r)}}))}recordFrameDelay(){if(void 0===this.activeUserActionType)return;const e=this.getMeasurementName(this.activeUserActionType),t=this.userActions.get(e);if(void 0===t)return;const n=this.host.performance.now(),i=n-this.lastRafTime;this.lastRafTime=n,t.frameDelayHistogram.record(i),i>=this.minEtwTriggeringFrameDelay&&this.hostCommunicationService?.loadModule("etw").then((e=>{e?.writeAppResponsivenessFrameDelayEvent?.({type:kW[t.type],delayMs:i})}))}recordPerInteractionAri(e,t,n,i){const a=n.passIntervalCount/n.totalIntervalCount;e.scoreHistograms.has(i.name)||e.scoreHistograms.set(i.name,new bW({bucketSize:.1,maxBucketValue:1}));e.scoreHistograms.get(i.name).record(a);const o=(1-a)*t;o>=this.minEtwTriggeringDelay&&this.hostCommunicationService?.loadModule("etw").then((n=>{n?.writeAppResponsivenessDelayEvent?.({type:kW[e.type],delayMs:o,durationMs:t})}))}measureRaf(){const e=this.getCurrentTimeSlot();this.recordFrameDelay();let t=this.rafRecords.get(e);void 0===t?t=1:t++,e-this.lastEventTimeSlot>=this.trailingTimespan?this.stopMeasurement():(this.rafRecords.size>1e3&&(this.stopMeasurement(),this.rafRecords.clear()),this.rafRecords.set(e,t),this.rafCallbackId=this.host.requestAnimationFrame((()=>this.measureRaf())))}getCurrentTimeSlot(){const e=this.host.performance.now();return this.getTimeSlot(e)}getTimeSlot(e){const t=void 0!==this.eventStartTime?e-this.eventStartTime:-1;return t<0?-1:Math.floor(t/this.blinkInterval)*this.blinkInterval}getResponsivenessScore(e,t,n){let i=0,a=0;for(;e<t;){const t=this.rafRecords.get(e);this.isDebugging&&this.logger.debug(`${e}: ${void 0===t?0:t}`),a+=void 0!==t&&t>=n.lowestAllowedRafs?1:0,i++,e+=this.blinkInterval}return{passIntervalCount:a,totalIntervalCount:i,measurements:1,wheelMeasurements:void 0!==this.wheelEventTriggeredUserActionType&&this.wheelEventTriggeredUserActionType===this.activeUserActionType?1:0,max:{passIntervalCount:a,totalIntervalCount:i}}}assignHost(e){this.host.removeEventListener("visibilitychange",this.onVisibilityChange),this.host=e,this.host.addEventListener("visibilitychange",this.onVisibilityChange)}getMeasurementName(e){let t=kW[e];return this.actionLocation&&(t+=`-${this.actionLocation}`),t}}const IW={"14d6962d-6eeb-4f48-8890-de55454bb136":"ActivityAppSwitch","86fcd49b-61a2-4701-b771-54728cd291fb":"ChatAppSwitch","ef56c0de-36fc-4ef8-b417-3d82ba9d073c":"CalendarAppSwitch","2a84919f-59d8-4441-a975-2a8c2643b741":"ChannelAppSwitch","3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40":"SimpleCollabAppSwitch","20c3440d-c67e-4420-9f80-0e50c39693df":"CallsMainAppSwitch","5af6a76b-40fc-4ba1-af29-8f49b08e44fd":"FilesAppSwitch","957ed0e3-e5ca-4c82-9676-fd037185c4d8":"MeetAppSwitch","a63f7012-8cc9-42d5-99c3-e35f526fab17":"MeetForWorkAppSwitch","3b95919f-59d8-4441-a975-2a8c2643c852":"CommunitiesAppSwitch","40472f6e-248f-4599-842c-ff3ed8f0ae34":"VirtualConsumerEventsAppSwitch","66aeee93-507d-479a-a3ef-8f494af43945":"AssignmentsAppSwitch","ac40aa4a-fef1-4896-aea2-46d1c14dbfd5":"StoreAppSwitch","7133fca9-0853-4e7a-bb5d-32d4e5f6020a":"HomepageAppSwitch","a02e4d17-af86-4ceb-9c97-4c2626eb3587":"QueuesAppSwitch","7831feaf-c4c4-4669-ba64-ce4ea0b56d31":"PeopleAppSwitch"},NW={"chat-list-item":"ChatSwitch","sendMessageCommands-send":"MessageSend","activity-feed-list-item":"ActivitySwitch"},AW={good:"#0CCE6A","needs-improvement":"#FFA400",poor:"#FF4E42"},EW=new Set(["slot-measurer"]),FW="not-able-to-find-a-data-tid",_W=/^[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,DW=/[^\x00-\x7F]/,PW=["app-detail-","attendeesInMeeting","autocomplete-picker-item","AUTOSUGGEST_SUGGESTION_APPS","AUTOSUGGEST_SUGGESTION_DIALOG","AUTOSUGGEST_SUGGESTION_FILES","AUTOSUGGEST_SUGGESTION_HISTORY","AUTOSUGGEST_SUGGESTION_PEOPLE","AUTOSUGGEST_SUGGESTION_SEARCHES","AUTOSUGGEST_SUGGESTION_SUGGESTEDSEARCH","AUTOSUGGEST_SUGGESTION_TOPHITS","AUTOSUGGEST_SUGGESTION_MESSAGES","AUTOSUGGEST_SUGGESTION_HELP","background-effect","cal-category","call-as-","call-forward-to-","callQueueTab-","calls-header-delegator-","channel-list-item-text","custom-emoji","deep-link-chiclet","delegate-team-row-user-name-","delegatorTab-","details-user-id-","dropdown-phone-call-btn-","emoji-categories-tab","emoticon-button","file-chiclet","give-control","InsertTable-","lazy-image-","manage-signers-","me-control-menu-account-item","me-control-multi-account-item","me-control-set-availability-menu-item","me-control-tenant-item","message-heart","message-laugh","message-surprised","message-yes","mute-checkbox-","newMessageCommands","opt-out-item-value-","overflow-item","participant-8:orgid","participant","participants-in-lobby","participantsFromMeeting","participantsFromTeamSuggestions","participantsFromThread","participantsInCall","participantsInLobby","people-picker-entry-","recipient-line-entry","remove-member","role-dropdown","seatAssignmentList-","store-item","tab-item-","tab-item-tab","tag-chiclet-","team-context-menu-more-button","tid-calendar-event","tid-upcoming","TM-name-label","TM-user-box-","username-in-call-row",["data-tid-","tabs-data-id"]],MW=["-empty",["-count","reactions-count-button"]],RW="getInpTelemetry";class xW{constructor(e){this.context=e,this.performanceObserverDurationThreshold=16,this.minEtwTriggeringDelay=500,this.minEtwTriggeringDelayForEvents={},this.track=(e,t)=>{if(!e.PerformanceObserver)return null;const n=new e.PerformanceObserver(this.performanceObserverCallback(t));return n.observe({type:"event",durationThreshold:this.performanceObserverDurationThreshold,buffered:!0}),()=>{n.disconnect()}},this.saveMousedownEntry=e=>{const t=e.filter((e=>"mousedown"===e.name)),n=t.length>=1?t.reduce(((e,t)=>e.duration>=t.duration?e:t)):null;n?.target&&(this.previousMousedownAssociatedScenario=this.attemptToFindMatch(n?.target))},this.performanceObserverCallback=e=>t=>{if(this.inpRecordCount>1e3)return;const n={},i=t.getEntries();for(const e of i){const t=e.interactionId||0;n[t]=n[t]||[],n[t].push(e)}for(const t of Object.values(n)){this.saveMousedownEntry(t);const n=t.filter((e=>"click"===e.name));if(0===n.length)continue;const i=n.reduce(((e,t)=>e.duration>=t.duration?e:t)),o=i.target,r={inp:this.getInp(i),inputDelay:this.getInputDelay(i),processingTime:this.getProcessingTime(i),presentationDelay:this.getPresentationDelay(i)},{match:s,notYetInstrumentedMatch:l,iterations:c}=this.attemptToFindMatchForClickOrPreviousMousedown(o);s?this.updateAssociatedInstrumentedScenario(s,r,e):this.updateAssociatedNotYetInstrumentedScenario(l,r,e),this.inpRecordCount++;const d=this.minEtwTriggeringDelayForEvents[s??""]??this.minEtwTriggeringDelay;if(i.duration>=d&&this.hostCommunicationService?.loadModule("etw").then((e=>{e?.writeInteractionToNextPaintEvent?.({scenario:s??l,version:"3",inputDelayMs:r.inputDelay,processingTimeMs:r.processingTime,presentationDelayMs:r.presentationDelay,inpMs:r.inp,inpEndTimestamp:i.startTime+i.duration})})),this.isDebugging){const e=i.duration,t=(a=e)<=200?"good":a<=500?"needs-improvement":"poor",n=`${e.toFixed(0)} ms`;this.logger.log(`%cInteraction tracking snippet %c${n} (${t})`,"font-weight: bold;",`font-weight: bold; color: ${AW[t]||"inherit"}`),s?this.logger.log(`Interaction associated scenario: %c${s}`,"font-family: monospace"):this.logger.log(`Interaction associated not yet implemented scenario: %c${l}`,"font-family: monospace"),this.logger.log(`Interaction event type: %c${i.name}`,"font-family: monospace"),this.logger.log("DOM Depth search iterations needed to find a match",c+1),this.logger.log(`Input delay (ms): ${r.inputDelay}\n`,`Processing time (ms): ${r.processingTime}\n`,`Presentation delay (ms): ${r.presentationDelay}`)}}var a},this.isDebugging=!1,this.__initTestingMode__(this.context.coreSettings.get(c.w.Host)),this.logger=this.context.loggerFactory.newLogger("INP","core-services-telemetry"),this.hostCommunicationService=e.hostCommunicationService,this.initSettings(),this.inpData={version:"3",events:{}},this.inpRecordCount=0,this.previousMousedownAssociatedScenario=null}getTelemetry(){let e="",t=!1;if(this.inpRecordCount>0&&(t=!0),t)try{e=JSON.stringify(this.inpData)}catch(e){this.logger.error("[InteractionToNextPaintService]: unexpected error parsing log object. Likely because of circular reference.")}return this.inpData.events={},this.inpRecordCount=0,e}initSettings(){const{interactionToNextPaintConstants:e}=this.context.coreSettings.get(c.w.Telemetry);this.performanceObserverDurationThreshold=e?.performanceObserverDurationThreshold??16,this.minEtwTriggeringDelay=e?.minEtwTriggeringDelayFallback??500,e?.minEtwTriggeringDelayForEvents?.forEach((e=>{const t=e?.eventName,n=e?.duration;t&&n&&(this.minEtwTriggeringDelayForEvents[t]=e.duration)}))}attemptToFindMatchForClickOrPreviousMousedown(e){return e?this.attemptToFindMatch(e):this.previousMousedownAssociatedScenario?this.previousMousedownAssociatedScenario:{match:null,notYetInstrumentedMatch:FW,iterations:0}}attemptToFindMatch(e){let t=0,n=null,i="",a=0;for(;t<10&&(e&&(n=this.attemptToFindInstrumentedMatch(e)),i||(i=this.maybeGetDataTid(e,!0)??"",a=t),!n);)e=e?.parentElement,t++;return i||(i=FW),{match:n,notYetInstrumentedMatch:i,iterations:Math.min(t,a)}}attemptToFindInstrumentedMatch(e){const t=this.maybeGetDataTid(e)??"",n=e.getAttribute("id"),i=e.getAttribute("class"),a=IW[t];if(a)return a;const o=NW[t];return o?"ChatSwitch"===o?n?.includes("meeting")?"ChatMeetingSwitch":"ChatSwitch":o:n?.includes("channel")&&i?.includes("ui-tree__item")?"ChannelSwitch":null}__initTestingMode__(e){if(e){const t=e.userType;t&&t.indexOf("test")>-1&&(this.isDebugging=!0,RW in window||(window[RW]=()=>this.getTelemetry()))}}maybeGetDataTid(e,t){if(!e)return null;let n=e.getAttribute("data-inp")??e.getAttribute("data-tid")??e.getAttribute("data-testid")??e.getAttribute("data-track-module-name")??null;if(!n)return null;if(n.length>100)return null;if(EW.has(n))return null;if(n?.includes("@")||n?.includes(" ")||n?.startsWith("+")||n?.startsWith("8:orgid:"))return null;if(DW.test(n))return null;for(const e of PW)if(Array.isArray(e)){if(n.startsWith(e[0])){n=e[1];break}}else if(n.startsWith(e)){n=e;break}for(const e of MW)if(Array.isArray(e)){if(n.endsWith(e[0])){n=e[1];break}}else if(n.endsWith(e)){n=e;break}return _W.test(n)&&t?null:(n=(0,et.y)(n,[vi.f0.PhoneNumber]),n)}getInp(e){return Math.max(Math.round(e.duration),0)}getInputDelay(e){return Math.max(Math.round(e.processingStart-e.startTime),0)}getProcessingTime(e){return Math.max(Math.round(e.processingEnd-e.processingStart),0)}getPresentationDelay(e){const t=Math.max(e.processingEnd+4,e.startTime+e.duration);return Math.max(Math.round(t-e.processingEnd),0)}updateMetricsForScenario(e,t,n){new Map([["inp",t.inp],["inputDelay",t.inputDelay],["processingTime",t.processingTime],["presentationDelay",t.presentationDelay]]).forEach(((t,n)=>{(e[n]??(e[n]=[])).push(t)})),e.mainEntityType=e.mainEntityType??(e.mainEntityType=[]),e.mainEntityType.push(n)}updateAndGetEventType(){return this.inpData.events.click??(this.inpData.events.click={instrumented:{},notYetInstrumented:{}})}updateAssociatedInstrumentedScenario(e,t,n){const i=this.updateAndGetEventType(),a=i.instrumented[e]??(i.instrumented[e]={});this.updateMetricsForScenario(a,t,n)}updateAssociatedNotYetInstrumentedScenario(e,t,n){const i=this.updateAndGetEventType(),a=i.notYetInstrumented[e]??(i.notYetInstrumented[e]={});this.updateMetricsForScenario(a,t,n)}}class LW{constructor(e,t,n=!1,i,a){this.key="resourceEntriesOverflowCache_TEST_ONLY",this.keyOwnership="Fundamental_Performance",this.fetchResourceBuffer=()=>this.buffer,this.fetchAllResources=()=>this.buffer.concat(this.perfHost.performance.getEntriesByType("resource")),this.fetchAllScripts=()=>{const e=this.buffer.filter((e=>e.name.endsWith(".js"))),t=this.perfHost.performance.getEntriesByType("resource").filter((e=>e.name.endsWith(".js")));return e.concat(t)},this.fetchAllNamedScripts=()=>{const e=this.fetchAllScripts();return e.filter((e=>{const t=e.name.match(/[^\/]*-[^-]*$/g),n=t?t[0].replace(/-[^-]*$/,""):"1234";return/\D/.test(n)}))},this.dumpEntriesBuffer=()=>{this.enabled&&(this.bufferCapacity>this.buffer.length?(this.buffer.push(...this.perfHost.performance.getEntriesByType("resource")),this.persistIntoLocalStorage&&this.dumpEntriesLocalStorage(),this.perfHost.performance.clearResourceTimings()):(this.enabled=!1,this.stopListening()))},this.dumpEntriesLocalStorage=()=>{const e=this.localStorageService?.get(this.key);let t=JSON.parse(e??"[]");t=t.concat(this.perfHost.performance.getEntriesByType("resource")),this.localStorageService?.set(this.key,JSON.stringify(t),this.keyOwnership)},this.enabled=e,this.buffer=[],this.bufferCapacity=t,this.persistIntoLocalStorage=n,this.perfHost=i,this.localStorageService=a,this.persistIntoLocalStorage&&this.localStorageService?.set(this.key,"[]",this.keyOwnership),this.startListening()}shutDownManager(){this.stopListening(),this.enabled=!1,this.persistIntoLocalStorage&&this.localStorageService?.remove(this.key)}startListening(){this.perfHost.performance.addEventListener("resourcetimingbufferfull",this.dumpEntriesBuffer)}stopListening(){this.perfHost.performance.removeEventListener("resourcetimingbufferfull",this.dumpEntriesBuffer)}}class OW{constructor(e){if(this.context=e,this.context.host?.performance){this.deprecatedNavigationTiming=this.context.host.performance.timing,this.navigationStart=this.deprecatedNavigationTiming?.navigationStart;const e=this.context.host.performance.getEntriesByType("navigation");e&&e[0]&&(this.navigationTiming=e[0]),this.init()}}get altScenario(){return this._altScenario}get clientStartScenario(){return this._clientStartScenario}stopALT(e){this.appendResourcesToALT(),this._altScenario?.stop(e)}fetchResources(){return this.resourceManagerService?this.resourceManagerService.fetchAllResources():[]}fetchScriptResources(){return this.resourceManagerService?this.resourceManagerService.fetchAllScripts():[]}fetchNamedScriptResources(){return this.resourceManagerService?this.resourceManagerService.fetchAllNamedScripts():[]}shutDownResourceManager(){this.resourceManagerService&&this.resourceManagerService.shutDownManager()}appendResourcesToALT(){const{persistResourceEntries:e}=this.context.coreSettings.get(c.w.Core);if(e&&this.resourceManagerService&&this._altScenario){const e=this.fetchScriptResources();this._altScenario.appendEventData({resourceEntries:e})}}markCoreInitSteps(){const e=this.context.host.performance.getEntriesByType("mark");e&&this.navigationStart&&(this._altScenario&&this.processCoreInitPerfMarks(this._altScenario,this.navigationStart,e),this._clientStartScenario&&(this._clientStartScenario.appendEventData({scenarioPhase:ef.Core}),this.processCoreInitPerfMarks(this._clientStartScenario,this.navigationStart,e)))}processCoreInitPerfMarks(e,t,n){const i=n;for(const n of i)n.name!==`${Ia}${d.dy.Initialization}`?n.name.startsWith(Na)&&e.mark(n.name.replace("_end_","_"),{overrideTimestamp:Math.round(n.startTime)+t}):e.mark(be.BQ.PreCoreInitializationTasks,{overrideTimestamp:Math.round(n.startTime)+t})}markAltExpLoaderSteps(e,t){this.markNavigationSteps(e,t);let n=this.context.host.performance.getEntriesByName("read-index-html","mark");n&&0===n.length&&(n=this.context.host.performance.getEntriesByName("slow-read-index-html","mark")),n&&n[0]&&e.mark(be.BQ.ReadIndexHtml,{overrideTimestamp:Math.round(n[0].startTime)+t});const i=this.context.host.performance.getEntriesByName("start-execute-main-bundle","mark");i&&i[0]&&e.mark(be.BQ.MainBundleDownloadParse,{overrideTimestamp:Math.round(i[0].startTime)+t})}markClientStartExpLoaderSteps(e,t){e.appendEventData({scenarioPhase:ef.ExpLoader}),this.markNavigationSteps(e,t);const n=[ha.IndexPageReadStart,ha.IndexPageSlowReadStart,ha.IndexPageStart,ha.CoreModuleLoaded,ha.NotifyDesktop,ha.ConfigLoaded,ha.MainChunksLoadingStart,ha.MainChunksLoadingStop,ha.IndexPageStop,ha.AsyncEntryDownloadStart,ha.AsyncEntryModuleFederationUrlsInited,ha.AsyncEntryDownloadStop,be.BQ.MainBundleDownloadParse,"start-execute-main-bundle"],i=this.context.host.performance.getEntriesByType("mark");i&&i.filter((e=>n.includes(e.name)||e.name.startsWith("exp_loader_err_"))).forEach((n=>{e.mark(n.name,{overrideTimestamp:Math.round(n.startTime)+t})}))}markNavigationSteps(e,t){this.navigationTiming?.workerStart&&e.mark(be.BQ.PreIndexServiceWorkerStartup,{overrideTimestamp:t+Math.round(this.navigationTiming.workerStart)}),this.deprecatedNavigationTiming?.fetchStart&&this.navigationTiming?.workerStart&&e.mark(be.BQ.IndexServiceWorkerStartup,{overrideTimestamp:this.deprecatedNavigationTiming.fetchStart}),this.deprecatedNavigationTiming?.domainLookupStart&&e.mark(be.BQ.IndexFetchIPC,{overrideTimestamp:this.deprecatedNavigationTiming.domainLookupStart}),this.deprecatedNavigationTiming?.domainLookupEnd&&e.mark(be.BQ.IndexDNS,{overrideTimestamp:this.deprecatedNavigationTiming.domainLookupEnd}),this.deprecatedNavigationTiming?.connectEnd&&e.mark(be.BQ.IndexConnect,{overrideTimestamp:this.deprecatedNavigationTiming.connectEnd}),this.deprecatedNavigationTiming?.responseStart&&e.mark(be.BQ.IndexRequest,{overrideTimestamp:this.deprecatedNavigationTiming.responseStart}),this.deprecatedNavigationTiming?.responseEnd&&e.mark(be.BQ.IndexResponse,{overrideTimestamp:this.deprecatedNavigationTiming.responseEnd})}init(){this.navigationStart&&(this._altScenario=this.context.scenarioFactory?.newScenario(be.Cu.ApplicationLaunchTime,{startTime:this.navigationStart,timeoutMs:36e4}),this._clientStartScenario=this.context.scenarioFactory?.newScenario(be.Cu.ClientStart,{startTime:this.navigationStart,timeoutMs:36e4}),this._altScenario&&this.markAltExpLoaderSteps(this._altScenario,this.navigationStart),this._clientStartScenario&&(this._clientStartScenario.appendEventData({createdBy:"altScenarioService"}),this.markClientStartExpLoaderSteps(this._clientStartScenario,this.navigationStart)),this.markCoreInitSteps());const{persistResourcesIntoLocalStorage:e}=this.context.coreSettings.get(c.w.Test),{persistResourceEntries:t,persistResourceEntriesMaxCap:n}=this.context.coreSettings.get(c.w.Core),{userType:i}=this.context.coreSettings.get(c.w.Host);t&&n&&(!e||i&&i.indexOf("test")>-1)&&(this.resourceManagerService=new LW(!0,n,e??!1,this.context.host,this.context.localStorage))}}class jW{constructor(e,t){this.isScenarioMemorySnapshotEnabled=e,this.globalWindow=t,this.cachedMemoryData={},this.cacheToExpireTime=0}snapshotMemoryUsage(){return this.isScenarioMemorySnapshotEnabled?(this.cacheToExpireTime<Date.now()&&this.snapshot(),this.cachedMemoryData):{}}snapshotMemoryUsageAsync(){if(!this.isScenarioMemorySnapshotEnabled)return Promise.resolve({});if(this.ongoingPromise)return this.ongoingPromise;const e=this.cacheToExpireTime-Date.now();return e>0?(this.ongoingPromise=new Promise((t=>{this.globalWindow.setTimeout((()=>{this.snapshot(),t(this.cachedMemoryData),this.ongoingPromise=void 0}),e)})),this.ongoingPromise):(this.snapshot(),Promise.resolve(this.cachedMemoryData))}snapshot(){this.cachedMemoryData={jsHeapStatistics:this.globalWindow.envPerformance.getJSHeapStatistics()||this.cachedMemoryData.jsHeapStatistics,processMemoryInfo:this.globalWindow.envPerformance.getProcessMemoryInfo()||this.cachedMemoryData.processMemoryInfo},this.cacheToExpireTime=Date.now()+3e4}}var BW=n(445494),UW=n(802716);class $W{constructor(e){this.eventTimeTracker=FU(e&&e>0?e:100)}markResponse(e){return this.eventTimeTracker.markEvent(e)}getResponsesBetweenStartAndLast(e){return this.eventTimeTracker.getEventsBetweenStartAndLast(e)}getResponsesBetween(e,t){return this.eventTimeTracker.getEventsBetween(e,t)}}const WW=e=>{const{apolloLeakInfoViewportContext:t,apolloLeakInfoEntityType:n=""}=e.apolloLeakInfo??{};return t===go.k.primary?`main:${n}`:n},VW=e=>e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});class HW{constructor(e,t,n,i){this.coreSettings=e,this.leakDetectorService=t,this.userTrackingService=n,this.shouldCollectStats=i,this.measurementTimeOverflow=!1,this.resultMeasurementTimeOverflow=!1,this.isLeakingUser=e=>e&&this.userTrackingService&&!this.userTrackingService.has(e);const{apolloCacheStatsThrottleTime:a,logCdlOperationsDuringWaitSettings:o}=e.get(c.w.Core);var r;this.getTelemetry=a?(0,we.throttle)((()=>this.getTelemetryInternal()),a,{leading:!0,trailing:!1}):this.getTelemetryInternal,o&&(o.enableTrackingCdlOperationsDuringWait||o.enableLoggingCdlOperationsDuringWait)&&(this.cdlResponseTracker=(r=o.trackingCdlOperationsDuringWaitBufferSize,new $W(r)))}getTelemetryInternal(){const{enableApolloCacheStats:e,enableApolloCacheSizeStats:t,enableApolloResultCacheSizeStats:n,enableApolloDataEviction:i}=this.coreSettings.get(c.w.Core);if(!e)return;const a=this.leakDetectorService?.getReachableObjects(bo.J.DataClient).size??0,o=Array.from(this.leakDetectorService?.getReachableObjects(bo.J.ApolloCache)??[]),r=[...Array.from(this.leakDetectorService?.getReachableObjects(bo.J.UnwrappedWindow)??[]).map((e=>e.windowLeakInfo?.windowLeakInfoWindowId)).filter((e=>!!e)),d.N2],s=e=>!e||!r.includes(e),l=o.filter((e=>{const{apolloLeakInfo:{apolloLeakInfoWindowId:t}={}}=e;return s(t)})),u=this.getLeakedUserCaches(o),m=o.map(WW),p=l.map(WW),g=t&&!this.measurementTimeOverflow&&this.shouldCollectStats(),h=n&&!this.resultMeasurementTimeOverflow&&this.shouldCollectStats(),v={clientsCount:a,cacheCount:o.length,allEntityTypes:Array.from(new Set(m)),entityTypeStats:VW(m),leakedCacheCount:p.length,leakedEntityTypes:Array.from(new Set(p)),leakedEntityTypeStats:VW(p),leakedUserCachesCount:u.length,caches:o.map((e=>{const{apolloLeakInfo:{apolloLeakInfoWindowId:t,apolloLeakInfoEntityType:n,apolloLeakInfoViewportContext:i,apolloLeakInfoStartTime:a,apolloLeakInfoEndTime:o}={}}=e,r={windowId:t,isLeaking:s(t),apolloLeakInfoStartTime:a,apolloLeakInfoEndTime:o,entityType:n,viewportContext:i};if(g){const{cacheSize:t,measuringTime:n}=(0,BW.q)(e);r.cacheSize=t,r.measuringTime=n}if(h){const{cacheSize:t,measuringTime:n}=(0,UW.X9)(e);r.resultCacheSize=t,r.resultMeasuringTime=n}return r})),enableApolloDataEviction:i??void 0},y=v.caches.reduce(((e,t)=>({cacheSize:void 0===t.cacheSize||void 0===e.cacheSize?void 0:e.cacheSize+t.cacheSize,measuringTime:void 0===t.measuringTime||void 0===e.measuringTime?void 0:e.measuringTime+t.measuringTime,resultCacheSize:void 0===t.resultCacheSize||void 0===e.resultCacheSize?void 0:e.resultCacheSize+t.resultCacheSize,resultMeasuringTime:void 0===t.resultMeasuringTime||void 0===e.resultMeasuringTime?void 0:e.resultMeasuringTime+t.resultMeasuringTime})),{cacheSize:0,measuringTime:0,resultCacheSize:0,resultMeasuringTime:0});return y.measuringTime&&y.measuringTime>500&&(this.measurementTimeOverflow=!0),y.resultMeasuringTime&&y.resultMeasuringTime>500&&(this.resultMeasurementTimeOverflow=!0),{...v,...y}}unthrottle(){"function"==typeof this.getTelemetry.cancel&&this.getTelemetry.cancel()}markResponse(e){this.cdlResponseTracker?.markResponse(e)}getResponsesBetweenStartAndLast(e){return this.cdlResponseTracker?.getResponsesBetweenStartAndLast(e)||[]}getResponsesBetween(e,t){return this.cdlResponseTracker?.getResponsesBetween(e,t)||[]}getLeakedUserCaches(e){return e.filter((e=>{const{apolloLeakInfo:{apolloLeakInfoUserContextId:t}={}}=e;return this.isLeakingUser(t)}))}}var zW=n(420688);const qW={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isMainWindow"}},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"}}]}}]}}]}}]},GW=(e,t,n)=>{const i=void 0!==e[t]||Object.keys(e).length<n?t:"other";return e[i]=(e[i]||0)+1,i},YW=new Set([ke.ck.breakoutroomspanel,ke.ck.calendar,ke.ck.callablechannels,ke.ck.callsmain,ke.ck.chats,ke.ck.channels,ke.ck.schedulingform,ke.ck.search,ke.ck.store,ke.ck.transcriptcontent]);var QW;!function(e){e.mainActive="mainActive",e.mainContentRecord="mainContentRecord"}(QW||(QW={}));class JW{constructor(e){this.entityTypeLimit=e,this.active={},this.record={},this.allEntityTypes=new Set,this.usedEntityTypes=new Set,this.allLayoutModes=new Set,this.activeWindowIds=new Set}update(e,t){Object.keys(this.active).forEach((e=>{this.active[e]=0})),this.activeWindowIds.clear(),e.forEach((e=>{const n=e.activeEntities.mainEntity.type;this.allEntityTypes.add(n),this.allLayoutModes.add(e.layoutConfig.layoutMode),this.activeWindowIds.add(e.id),GW(this.active,n,this.entityTypeLimit),YW.has(n)&&this.usedEntityTypes.add(n),!this.isFirstUse(n)&&this.wasInPreviousUpdate(e,t)||GW(this.record,n,this.entityTypeLimit)}))}getStats(){return{mainActive:this.active,mainContentRecord:this.record,allEntityTypes:Array.from(this.allEntityTypes),usedEntityTypes:Array.from(this.usedEntityTypes),allLayoutModes:Array.from(this.allLayoutModes),activeWindowIds:Array.from(this.activeWindowIds)}}isFirstUse(e){return!this.record[e]}wasInPreviousUpdate(e,t){const n=t.find((t=>t.id===e.id));return!!n&&n.activeEntities.mainEntity.type===e.activeEntities.mainEntity.type&&n.activeEntities.mainEntity.id===e.activeEntities.mainEntity.id&&n.correlation.id===e.correlation.id}}const KW=new Set([ke.ck.calls,ke.ck.chats,ke.ck.channels,ke.ck.extensions,ke.ck.schedulingform]);var ZW;!function(e){e.popOutActive="popOutActive",e.popOutRecord="popOutRecord"}(ZW||(ZW={}));class XW{constructor(e){this.entityTypeLimit=e,this.active={},this.record={},this.allEntityTypes=new Set,this.usedEntityTypes=new Set,this.activeWindowIds=new Set}update(e,t){Object.keys(this.active).forEach((e=>{this.active[e]=0})),this.activeWindowIds.clear(),e.forEach((e=>{const n=e.activeEntities.mainEntity.type;this.allEntityTypes.add(n),this.activeWindowIds.add(e.id),GW(this.active,n,this.entityTypeLimit),KW.has(n)&&this.usedEntityTypes.add(n),!this.isFirstUse(n)&&this.wasInPreviousUpdate(e,t)||GW(this.record,n,this.entityTypeLimit)}))}getStats(){return{popOutActive:this.active,popOutRecord:this.record,allEntityTypes:Array.from(this.allEntityTypes),usedEntityTypes:Array.from(this.usedEntityTypes),activeWindowIds:Array.from(this.activeWindowIds)}}isFirstUse(e){return!this.record[e]}wasInPreviousUpdate(e,t){const n=t.find((t=>t.id===e.id));return!!n&&n.activeEntities.mainEntity.type===e.activeEntities.mainEntity.type}}const eV=e=>e.isMainWindow||e.isNotificationsWindow,tV=e=>!eV(e),nV=e=>Object.keys(e).reduce(((t,n)=>t+e[n]),0),iV=e=>{const t=Object.keys(e).reduce(((t,n)=>{const i=e[n];return i&&i>0&&(t[n]=i),t}),{}),n=Object.keys(t);return 1===n.length?n[0]:void 0},aV=(e,t)=>{const n=Array.from(e).filter((e=>!e.windowLeakInfo?.windowLeakInfoWindowId||!t.includes(e.windowLeakInfo.windowLeakInfoWindowId))).map((e=>{const{windowLeakInfoEntityType:t=""}=e.windowLeakInfo??{};return e.viewportContext===go.k.primary?`main:${t}`:t}));return{allEntityTypes:Array.from(new Set(n)),memActive:n.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{})}};class oV{constructor({client:e,leakDetectorService:t,entityTypeStatsLimit:n,activeWindowsService:i}){let a;this.isBackInMain=!1,this.main=new JW(n??20),this.popOut=new XW(n??20),a=i?.enableDecoupleCommandingFromApollo?i.getActiveWindowsObservable():(0,La.K)(e.watchQuery({query:qW})).pipe((0,di.p)((({errors:e,loading:t})=>void 0===e&&!t)),(0,o.T)((({data:{activeWindows:e}})=>(this.isBackInMain=e.some((e=>e.id===d.N2)),e)))),this._activeWindowsSubscription=a.pipe((0,zW.J)()).subscribe((([e,t])=>{this.update(e,t)})),this.leakDetectorService=t}destroy(){this._activeWindowsSubscription.unsubscribe()}getStats(){const e=this.leakDetectorService?.getReachableObjects(bo.J.UnwrappedWindow),t=this.leakDetectorService?.getReachableObjects(bo.J.WindowWrapper),{activeWindowIds:n,...i}=this.main.getStats(),{activeWindowIds:a,...o}=this.popOut.getStats(),r=nV(o.popOutActive),s={backInMain:this.isBackInMain?{allEntityTypes:i.allEntityTypes,usedEntityTypes:i.usedEntityTypes,backInMainActive:i.mainActive,backInMainActiveCount:nV(i.mainActive),backInMainContentRecord:i.mainContentRecord}:void 0,t2main:this.isBackInMain?void 0:{allEntityTypes:i.allEntityTypes,allLayoutModes:i.allLayoutModes,usedEntityTypes:i.usedEntityTypes,t2MainActive:i.mainActive,t2MainActiveCount:nV(i.mainActive),t2MainContentRecord:i.mainContentRecord},popOut:{...o,popOutActiveCount:r,hasActivePopout:r>0},mainActiveEntity:iV(i.mainActive),windowCount:e?.size,windowWrapperCount:t?.size,inMem:e?aV(e,[...n,...a]):void 0,windows:e?Array.from(e).map((e=>{const{windowLeakInfoEntityType:t,windowLeakInfoWindowId:n,windowLeakInfoStartTime:i,windowLeakInfoEndTime:a}=e.windowLeakInfo??{};return{windowLeakInfoWindowId:n,windowLeakInfoEntityType:t,viewportContext:e.viewportContext,windowLeakInfoStartTime:i,windowLeakInfoEndTime:a}})):void 0},l=(s.t2main?.t2MainActiveCount??0)+s.popOut.popOutActiveCount;return{...s,windowLeaks:void 0===s.windowCount?void 0:s.windowCount-l,windowWrapperLeaks:void 0===s.windowWrapperCount?void 0:s.windowWrapperCount-l}}update(e,t){this.main.update(t.filter(eV),e.filter(eV)),this.popOut.update(t.filter(tV),e.filter(tV))}}class rV{constructor(e){this.context=e,this.inited=!1,this.logger=e.loggerFactory.newLogger("WindowTrackerService","core-services-telemetry")}init(){if(!this.inited){const{client:e,leakDetectorService:t,coreSettings:n,activeWindowsService:i}=this.context,a=(this.logger.errorToTelemetry??this.logger.error).bind(this.logger);if(e){this.inited=!0;try{this.windowEntityTypeStats=new oV({client:e,leakDetectorService:t,entityTypeStatsLimit:n?.get(c.w.Core).entityTypeStatsLimit,coreSettings:n,activeWindowsService:i})}catch(e){a("Failed to initialize WindowEntityTypeStats","webclient_framework_window_tracker_service")}}else a("Failed to initialize WindowEntityTypeStats - missing client","webclient_framework_window_tracker_service")}}getTelemetry(){return this.inited||this.init(),this.windowEntityTypeStats?.getStats()}}function sV(e,t){const n=e.location.hostname;return t&&t!==n}var lV=n(507086);function cV(e,t,n,i,a,o){const r=o&&o.delta||0,s=function(e,t,n){let i;if("share-to-teams"===e)i=function(e,t){let n;if(t.performance&&t.performance.navigation&&0===t.performance.navigation.type){const{s:i}=e.getSearchState();if(i)n=parseInt(i,10);else{const e="outlook"===t.document.head.dataset.host,i=t.localStorage.getItem(lV.j3.STT_START_TIME);e&&i&&(n=parseInt(i,10),t.localStorage.removeItem(lV.j3.STT_START_TIME))}}return n}(t,n);return i}(e,i,a),l=s?{name:be.BQ.ClickTimeAction,timestamp:n-r}:void 0,c=l?[l]:[];o&&c.push({name:o.name,timestamp:n});const d=s||n-r,u=t.newScenario(be.Cu.ExperienceReady,{startTime:d});c.forEach((e=>{u.mark(e.name,{overrideTimestamp:e.timestamp})}))}function dV(e,t,n,i,a,o={cached:!1}){const r={name:e,delta:0},s=function(e,t,n,i){let a;if(function(e,t){return!e.some((e=>t.getEntriesByName(e).length<=0))}([t,n],i))try{i.measure(e,t,n);const o=i.getEntriesByName(e)[0];a=o?.duration,a&&(a=Math.round(a)),i.clearMeasures(e)}catch(e){a=void 0}return a}(e,t,n,i.performance);return void 0!==s&&(r.delta=s,a.createScenarioWithoutStarting(e).stop({delta:s,cached:o.cached})),r}var uV=n(245445);class mV{constructor(e){this.telemetrySettings=null,this.disableColumnBlocker=!1,this.fixedColumnRules={},this.blockedColumnRules={},this.columnBlockingRules={},this.wildCardMergedTables={},this.wildCardTableEmpty=!0,this.updateColumnBlockingSettings=e=>{if(e){if(this.telemetrySettings=e,this.disableColumnBlocker=e.disableColumnBlocker||!1,this.disableColumnBlocker)return this.columnBlockingRules={},this.wildCardMergedTables={},void(this.wildCardTableEmpty=!0);let t={};e.blockedColumnRules&&(t=e.blockedColumnRules),this.blockedColumnRules=t;let n={};e.fixedColumnRules&&(n=e.fixedColumnRules),this.fixedColumnRules=n,this.generateRuleSet()}};e.getObservable(c.w.Telemetry).subscribe(this.updateColumnBlockingSettings),this.telemetrySettings=e.get(c.w.Telemetry),this.updateColumnBlockingSettings(this.telemetrySettings)}isContextColumnOk(e){return(0,we.isEmpty)(this.columnBlockingRules)||(0,we.isEmpty)(this.columnBlockingRules["*"])||(0,we.isEmpty)(this.columnBlockingRules["*"]["*"])||!this.columnBlockingRules["*"]["*"][e]}applyColumnBlockingRules(e,t,n,i){try{if(this.wildCardTableEmpty||this.wildCardMergedTables[e]||(this.columnBlockingRules[e]=(0,we.merge)(this.columnBlockingRules[e],this.columnBlockingRules["*"]),this.wildCardMergedTables[e]=!0),(0,we.isEmpty)(this.columnBlockingRules[e]))return;(0,we.isEmpty)(this.columnBlockingRules[e][t])?(0,we.isEmpty)(this.columnBlockingRules[e]["*"])||this.blockEventPropertyColumn(this.columnBlockingRules[e]["*"],n,i):this.blockEventPropertyColumn(this.columnBlockingRules[e][t],n,i)}catch{return void n.setProperty("diagBlockedColumns",(0,ge.oJ)({parseFailed:!0}))}}blockEventPropertyColumn(e,t,n){const i=t.properties,a={},o=n?.packedData;(0,we.forEach)(e,((e,t)=>{(0,we.isEmpty)(i[t])||(i[t].value="",a[t]=e),o&&o.forEach((n=>{n[t]&&(n[t]=void 0,a[t]=e)}))})),(0,we.isEmpty)(a)||t.setProperty("diagBlockedColumns",(0,ge.oJ)(a))}generateRuleSet(){try{this.columnBlockingRules={},this.wildCardMergedTables={};const e=this.blockedColumnRules["*"],t=this.fixedColumnRules["*"];(0,we.forEach)(this.blockedColumnRules,((n,i)=>{if((0,we.isEmpty)(n))return;(0,we.isEmpty)(e)||"*"===i||(n=(0,we.merge)(n,e));!(0,we.isEmpty)(this.fixedColumnRules)&&!(0,we.isEmpty)(this.fixedColumnRules[i])&&!(0,we.isEmpty)(t)&&"*"!==i&&(this.fixedColumnRules[i]=(0,we.merge)(this.fixedColumnRules[i],t)),this.columnBlockingRules[i]={};const a={};(0,we.isEmpty)(n["*"])||this.mergeBlockedColumnsRulesForAllEventType(n,i,a),(0,we.isEmpty)(a)||(this.columnBlockingRules[i]["*"]=a),this.mergeBlockedColumnsRulesForEveryEventType(n,i,a),(0,we.isEmpty)(this.columnBlockingRules[i])?delete this.columnBlockingRules[i]:this.wildCardMergedTables[i]=!0})),this.wildCardTableEmpty=(0,we.isEmpty)(this.columnBlockingRules["*"])}catch{return}}mergeBlockedColumnsRulesForAllEventType(e,t,n){(0,we.forEach)(e["*"],((e,i)=>{e>(this.fixedColumnRules[t]&&this.fixedColumnRules[t]["*"]&&this.fixedColumnRules[t]["*"][i]||0)&&(n[i]=e)}))}mergeBlockedColumnsRulesForEveryEventType(e,t,n){(0,we.forEach)(e,((e,i)=>{"*"!==i&&((0,we.isEmpty)(this.fixedColumnRules[t])||(0,we.isEmpty)(this.fixedColumnRules[t][i])?this.columnBlockingRules[t][i]=(0,we.merge)(e,n):(this.columnBlockingRules[t][i]={},(0,we.forEach)(e,((e,n)=>{e>(this.fixedColumnRules[t][i][n]||0)&&(this.columnBlockingRules[t][i][n]=e)})),this.columnBlockingRules[t][i]=(0,we.merge)(this.columnBlockingRules[t][i],n),(0,we.isEmpty)(this.columnBlockingRules[t][i])&&delete this.columnBlockingRules[t][i]))}))}}var pV=n(378768),gV=n(705382),hV=n(202042),vV=n(308951),yV=n(780289);class SV extends yV.k{constructor(e,t){super(),this.logger=e,this.port=t,this.contextFilter=gV.C9,this.port.onmessage=e=>{if(!e||!e.data||!e.data.name)return;const t=this.messageHandlers[e.data.name];t&&t(e.data.params)}}postMessage(e,t){["initialize","batch","newLogger"].includes(e)?this.port.postMessage({operation:e,params:t,source:"lite-worker-proxy",channel:this.logger}):"setContext"===e?this.setContextHandler(t):"logEvent"===e&&this.logEventHandler(t)}setContextHandler(e){e&&e.key&&e.value&&this.contextFilter.has(e.key)&&this.port.postMessage({operation:"setContext",params:e,source:"lite-worker-proxy",channel:this.logger})}logEventHandler(e){e&&e.key&&e.value&&(e.key=this.logger,this.port.postMessage({operation:"logEvent",params:e,source:"lite-worker-proxy",channel:this.logger}))}}class fV extends yV.k{constructor(e){super(),this.messager=e,e.onmessage=e=>{e.data&&this.messageHandlers[e.data.name]?.(e.data.params)}}postMessage(e,t,n){this.messager.postMessage({name:e,params:t},{transfer:n})}}class kV extends yV.k{constructor(e,t){super(),this.sharedWorkerUrl=t,this.worker=this.createSharedWorker(e,this.sharedWorkerUrl)}initialize(){}postMessage(e,t){try{this.worker.port.postMessage({name:e,params:t})}catch(e){console.warn(e)}}createSharedWorker(e,t){const n=t?new SharedWorker(t):e;return n.port.onmessage=e=>{if(!e||!e.data||!e.data.name)return;const t=this.messageHandlers[e.data.name];t&&t(e.data.params)},n}}const CV=(e,t,i)=>{let{url:a}=i;const{hashParams:o,qspParams:r}=i,s=r?.version;if(s&&a){const e=new URL(a);e.searchParams.set("version",s),a=e.toString()}if(e){const e=SharedWorker;SharedWorker=bV(e,t,o,r);const i=a?new kV(void 0,a):new kV(new SharedWorker(n.tu(new URL("/v2/worker/"+n.u(619104),n.b))));return SharedWorker=e,i}{const e=Worker;Worker=bV(e,t,o,r);const i=new fV(new Worker(n.tu(new URL("/v2/worker/"+n.u(951379),n.b))));return Worker=e,i}},bV=(e,t,n,i)=>class{constructor(a){const o=new URL(a);i?.version&&o.searchParams.set("version",i.version);const r=n?`${o}#${(0,ge.hR)(n)}`:o.toString();try{return new e(t(r))}catch(n){return new e(t(a))}}};var wV=n(460085),TV=n(49416);const IV="Teams",NV=/(windows|win32)/i,AV=/ arm;/i,EV=/windows\sphone\s\d+\.\d+/i,FV=/(macintosh|mac os x|mac)/i,_V=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,DV=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,PV=/android/i,MV=(d.Xn,d.Xn,(e,t,n,i)=>{const a=n.telemetryLiteExperiencePort?n.telemetryLiteExperiencePort:void 0;if(i){if(a)return()=>new SV(n.experienceName,a);{const n=e.get(c.w.Telemetry).workerEnabled??!1,a=e.get(c.w.Telemetry).enableSharedWorker??!1,o=e=>{const t=e.get(c.w.Platform);if(t&&"production"===t.buildType)return t.buildVersion??void 0},r=o(e);if(n){const{coreSecurityService:n,windowBaseUrl:o}=i,s=n.getTrustedTypePolicy("@msteams/core-services-telemetry-worker#TelemetryWorker"),l=e=>s.createScriptURL(e,o);return()=>{const n=CV(a,l,{hashParams:{publicPath:t.__webpack_public_path__},qspParams:{version:r}});return new TV.c(n,e).init(),n}}return()=>new vV.K(new wV.M)}}return()=>new vV.K(new wV.M)}),RV=(e,t,n=gV.MP.default)=>{uV.Z.getInstance().initialize(t);const i=new mV(t);return hi.Tn.getInstance().initialize(e,n),{eventSuppression:uV.Z.getInstance(),columnSuppression:i,telemetrySender:hi.Tn.getInstance()}},xV=(e,t,n,i,a,o=gV.MP.default)=>{const{userAgent:r}=n.config,{deviceId:s,sessionId:l,sessionStartTime:u}=n.host,m=a?nt.sK.CDLWorker:ut(n),p=i.get(c.w.Telemetry),{defaultToken:g,enableSharedWorker:h,isSilent:v,telemetryServer:y,eventsLimitInMem:S,normalPrioritySendTimeInSecs:f,highPrioritySendTimeInSecs:k,autoFlushPercent:C,enableOneDsSdkNs:b,oneDsCollectorUrl:w,enableCompression:T,enablePrivacyGuard:I,enableLoggingGlobalDeviceId:N,privacyGuardIngestionToken:A,disableMTMAPrimaryId:E,debugMenuCaptureContext:F,debugMenuCaptureEvents:_,enableSDKContextOverrides:D,enableOfflineTelemetry:P,eventPersistence:M,applicationInsightsOfflineSettings:R,enableDistributedTracing:x}=p,{sharedWorkerUrl:L}=i.get(c.w.Host),O=i?.get(c.w.Core)?.enableMTMA;if(!y||!g)throw t.error("Telemetry server url or app token not supplied. This is required by Aria"),(0,Je.$5)("telemetry-initialization",d.O4.Undefined,"init");const j=e.windowType!==hV.Z.Anglr?"NS":"",B={userAgent:r,firstLaunchTime:e.appStartTime,tablePostfix:j,deviceId:s},U={debugMenuCaptureContext:!!F,debugMenuCaptureEvents:!!_},$=new pV.go;return $.collectorUrl=y,null!=S&&($.eventsLimitInMem=S),e.telemetryLiteExperiencePort&&(o=e.experienceName),{config:$,appTokens:{default:g},documentInfo:B,debugMenuSettings:U,isSilent:!!v,sessionId:l||void 0,sessionStartTime:u,clientType:m,sharedWorkerUrl:L||void 0,enableSharedWorker:!!h,eventsLimitInMem:S||3e3,normalPrioritySendTimeInSecs:f||15,highPrioritySendTimeInSecs:k||15,autoFlushPercent:C||.33,enableOneDsSdkNs:!!b,oneDsCollectorUrl:w||void 0,enableCompression:!!T,enablePrivacyGuard:!!I,enableLoggingGlobalDeviceId:!!N,privacyGuardIngestionToken:A||void 0,enableMTMA:O||void 0,disableMTMAPrimaryId:!!E,defaultLoggerName:o,enableSDKContextOverrides:!!D,enableOfflineTelemetry:!!P,enableDistributedTracing:!!x,eventPersistence:M??{},applicationInsightsOfflineSettings:R??{}}},LV=(e,t,n,i,a)=>{const{platformService:o,logger:r,coreSettings:s,scenarioFactory:l,columnSuppression:u,telemetryContext:m,experimentationService:p,i18nInfo:g,host:h}=n,{browser:v,browserVersion:y,clientContext:S,clientVersion:f,cpuArchitecture:k,osPlatform:C,osVersion:b,platformId:w,pullRequestId:T,buildId:I}=o.config,N=a?nt.sK.CDLWorker:ut(o),{bootType:A,panelContext:E,sessionId:F,startReason:_,isServiceWorkerActive:D}=o.host,P=s.get(c.w.Telemetry),{defaultToken:M,telemetryServer:R,disableRingNamePrefixing:x,disablePlatformServiceOsVersion:L}=P,O=s.get(c.w.Metadata),j=!!s.get(c.w.Auth).enableTFLOnT21,{hostAppWebVersion:B}=s.get(c.w.Host),U=(0,Pt.AR)();if(U.initialize({...t,services:{coreSettings:s,scenarioFactory:l,logger:r,columnSuppressionService:u},workerOptions:i},r),!R||!M)throw r.error("Telemetry server url or app token not supplied. This is required by Aria"),(0,Je.$5)("telemetry-initialization",d.O4.Undefined,"init");const $=O.environment===$a.B.life?JB.qv.Life:JB.qv.Work,W=TU(O,OV(!!x,e,a),p),V=t.documentInfo,H=W.ring,z=zV(V.userAgent),q=GV(V.userAgent),G=QV(C),Y=JV(C);let Q=k;"Mac OS X"===Y&&(Q="x64");const J=ZV();m.setContext("AppInfo.ClientType",e.clientTypeTelemetry??N),m.setContext("AppInfo.ClientContext",S),m.setContext("AppInfo.HostAppVersion",z),m.setContext("AppInfo.ProcessArchitecture",q),m.setContext("AppInfo.WebVersion",B),B&&m.setContext("AppInfo.HostAppWebVersion",HV(B)),m.setContext("AppInfo.Language",g.localeCode),m.setContext("AppInfo.Locale",g.localeCode),m.setContext("AppInfo.PlatformId",w);const K=qV(f,B);P.enableEnhancedTelemetry?m.setContext("AppInfo.Version",K):m.setContext("AppInfo.Version",f),m.setContext("AppInfo.IsConvergedApp",j),m.setContext("AppInfo.VersionNew",K),m.setContext("AppInfo.PullRequestId",T),m.setContext("AppInfo.BuildId",I),m.setContext("AppInfo.ReactAppVersion",f),m.setContext("AppInfo.ExperienceName",e.experienceName),m.setContext("DeviceInfo.OsName",Y),L||m.setContext("DeviceInfo.OsVersion",b),m.setContext("DeviceInfo.OsFamily",G),m.setContext("DeviceInfo.CpuArchitecture",Q),m.setContext("EventInfo.isNS",!0),m.setContext("Panel.Context",E),m.setContext("Session.Id",F),m.setContext("startReason",_),m.setContext("UserInfo.Language",g.userLanguage),m.setContext("UserInfo.Ring",H),m.setContext("UserInfo.TimeZone",J),m.setContext("userAgent",V.userAgent),m.setContext("Window.Type",e.windowType),m.setContext("DeviceInfo.BrowserName",v),m.setContext("DeviceInfo.BrowserVersion",y),m.setContext("DeviceInfo.Id",V.deviceId),m.setContext("Tenant.Model",$),m.setContext("Session.TelemetryContext","web"),m.setContext("AppInfo.BootType",A),m.setContext("UserInfo.UserLocale",g.originLocaleCode),m.setContext("UserInfo.OSorBrowserLocale",nt.sK.Desktop===N||nt.sK.Maglev===N?g.osLocale:g.userLanguage),m.setContext("telemetryRegionFetchComplete",P.telemetryRegionFetchComplete),m.setContext("UserInfo.TelemetryRegion",P.telemetryRegion),m.setContext("AppInfo.ServiceWorkerState",D?"active":"noActiveFound");const Z=h?.loader?.getProperties?.()?.activeServiceWorkerVersion;return D&&Z&&m.setContext("AppInfo.ServiceWorkerVersion",Z),jV(s,m,e,a,p),BV(s,m),WV(K,s,m),$V(s,m),UV(s,m),{provider:U}},OV=(e,t,n)=>!(!n||"react-web-client"!==t.experienceName)||e,jV=(e,t,n,i,a)=>{const o=e.getObservable(c.w.Metadata),{disableRingNamePrefixing:r}=e.get(c.w.Telemetry);if(o.subscribe((e=>{a?.updateWebExperimentConfigMetadata(e),a?.communicateWithHost();const o=TU(e,OV(!!r,n,i),a);t.setContext("UserInfo.Ring",o.ring),t.setContext("UserInfo.ETag",o.eTag),t.setContext("UserInfo.HostETag",o.hostETag),t.setContext("AppInfo.ExpIds",o.expIds),t.setContext("AppInfo.ExpRolloutIds",o.rolloutIds),t.setContext("AppInfo.Environment",o.environment)})),a){a.ecmObservable.subscribe((e=>{const n=e.find((e=>e.client===CU)),i=e.map((e=>e.config.expIds)).filter((e=>e.length>0)).join(","),a=IU(e).join(",");t.setContext("UserInfo.HostETag",n?.config.eTag),t.setContext("AppInfo.ExpIds",i),t.setContext("AppInfo.ExpRolloutIds",a)}))}},BV=(e,t)=>{e.getObservable(c.w.UserResources).subscribe((e=>{const n=e.licenseType||void 0;t.setContext("UserInfo.LicenseType",n)}))},UV=(e,t)=>{e.getObservable(c.w.Auth).subscribe((e=>{const n=!!e.enableTFLOnT21;t.setContext("AppInfo.IsConvergedApp",n)}))},$V=(e,t)=>{e.getObservable(c.w.Smb).subscribe((e=>{const n=e.tenantSizeSegment||void 0;t.setContext("Tenant.SmbTenantSizeSegment",n)}))},WV=(e,t,n)=>{t.getObservable(c.w.Host).subscribe((i=>{i&&VV(e,t,n,i)}))},VV=(e,t,n,i)=>{const{enableEnhancedTelemetry:a,enableGetUserTypeFromHost:o}=t.get(c.w.Telemetry),r=i.desktopVersion||void 0,s=r?e.concat(",",r):e;r&&n.setContext("AppInfo.DesktopVersion",r),n.setContext("AppInfo.VersionNew",s),i.systemManufacturer&&n.setContext("DeviceInfo.Make",i.systemManufacturer),i.systemProductName&&n.setContext("DeviceInfo.Model",i.systemProductName),n.setContext("rendererCount",i.rendererCount),a&&n.setContext("AppInfo.Version",s),n.setContext("AppInfo.WebVersion",i.hostAppWebVersion),i.hostAppWebVersion&&n.setContext("AppInfo.HostAppWebVersion",HV(i.hostAppWebVersion)),o&&i.userType&&n.setContext("userType",i.userType)},HV=e=>{let t="";const n=e.indexOf("/");return n>-1&&(t=e.substring(n+1,e.length)),t},zV=e=>{let t;const n=e.indexOf(IV);if(n>-1){t=e.substring(n+5+1);const i=t.indexOf(" ");t=t.substring(0,i)}return t},qV=(e,t)=>t?e.concat(",",t):e,GV=e=>{let t=JB.lM.unknown;return KV(e,JB.lM.x64)?t=JB.lM.x64:KV(e,JB.lM.x86)?t=JB.lM.x86:KV(e,JB.lM.ia32)&&(t=JB.lM.ia32),t},YV=(e,t)=>{if(t.telemetryLiteExperiencePort)return"lite";const n=e.get(c.w.Telemetry),i=n.workerEnabled,a=n.enableSharedWorker;return i?a?"shared":"dedicated":"embed"},QV=e=>{let t=JB.Pr.UNKNOWN;const n=e?.match(NV)||e?.match(AV)||e?.match(EV),i=e?.match(DV)||e?.match(PV),a=e?.match(FV)||e?.match(_V);return n?t=JB.Pr.WINDOWS:i?t=JB.Pr.UNIX:a&&(t=JB.Pr.MACOSX),t},JV=e=>{switch(e){case nt.SA.Windows:return"Windows";case nt.SA.Mac:return"Mac OS X";case nt.SA.Linux:return"Linux";case nt.SA.ChromeOS:return"Chrome OS";case nt.SA.Android:return"Android";case nt.SA.IOS:return"iOS";case nt.SA.WindowsPhone:return"Windows Phone";case nt.SA.Unknown:return"Unknown";default:return e}},KV=(e,t)=>!!(e.indexOf(t)>-1),ZV=()=>{const e=(new Date).getTimezoneOffset();let t=e%60,n=(e-t)/60;const i=n>0?"-":"+";t=Math.abs(t),n=Math.abs(n);const a=t<10?`0${t}`:t.toString();return`${i}${n<10?`0${n}`:n.toString()}:${a}`};var XV=n(759218);class eH extends xp{constructor(){super(d.c1.InitTelemetry,["coreSettings","coreSettingsContext","diagnosticsService","hostCommunicationService","localStorage","loggerFactory","telemetryContextService","windowProvider"])}async execute(e){const t=e.loggerFactory.newLogger("init-telemetry-task","core-services-tasks"),n=e.coreSettings.get(c.w.Telemetry),i=this.createMemoryAnalyzer(e.windowProvider,n);n.disableAriService||(e.appResponsivenessService=new TW(e.windowProvider,{loggerFactory:e.loggerFactory,windowProvider:e.windowProvider,coreSettings:e.coreSettings,hostCommunicationService:e.hostCommunicationService})),n.enableInpService&&n.heartbeatConfiguration?.inpMetricsCollection?.enabled&&(e.interactionToNextPaintService=new xW(e)),e.dataClientTrackingService=this.createDataClientTrackerService(e),this.createWindowTrackerService(e),await this.createHeartbeatMonitor(e);const{crossClientRegistrationMethods:a,desktopActiveScenarios:o,desktopContext:r,deviceInfo:s,finalizeLegacyCrossClient:l,notifyDesktopScenarioFactoryReady:d,registerForCoreContext:u,systemCpuInfo:m,systemMemoryInfo:p}=await this.initializeCrossClientTelemetry(t,e.hostCommunicationService),g={deviceInfo:s,systemCpuInfo:m,systemMemoryInfo:p},h=this.createCoreScenarioFactory(e,i,l,o,a);u?.(((t,n)=>{e.telemetryContextService.setCoreContext(t,n)})),d?.(),e.hostCommunicationService?.setScenarioFactory(h),e.diagnosticsService.setScenarioFactory(h),e.coreSettingsContext.setScenarioFactory(h);const v=await this.createCoreTelemetryService(e,i,h,g,e.telemetryContextService,r);return e.windowProvider?.loader?.stopPieTimer?.(),this.createCoreUserBiService(e),this.startAppStartScenarios(e,h),e.altScenarioService=new OW({host:e.windowProvider,loggerFactory:e.loggerFactory,coreSettings:e.coreSettings,localStorage:e.localStorage,scenarioFactory:h}),e.hostCommunicationService&&await this.handOffContextCommsCallback(e.hostCommunicationService,e.coreSettings,v),tH(v)}async initializeCrossClientTelemetry(e,t){const n={};if(t){try{const e=await t.loadModule("scenario");e&&(e.getActiveScenarios&&(n.desktopActiveScenarios=await e.getActiveScenarios({})),e.setScenarioCompletion&&(n.finalizeLegacyCrossClient=e.setScenarioCompletion),n.crossClientRegistrationMethods={},e.registerForScenarioMark&&e.registerForScenarioStart&&e.registerForScenarioStop&&(n.crossClientRegistrationMethods.marks={registerForScenarioStart:e.registerForScenarioStart,registerForScenarioMark:e.registerForScenarioMark,registerForScenarioStop:e.registerForScenarioStop}),e.registerForScenarioAppendEventData&&(n.crossClientRegistrationMethods.appendEventData=e.registerForScenarioAppendEventData),n.notifyDesktopScenarioFactoryReady=()=>{e.setWebAvailability?.(!0)})}catch(t){e.errorToTelemetry&&e.errorToTelemetry(kr.LoadModuleScenarioFailed,"webclient_framework_host_comms",void 0,!0)}try{const e=await t.loadModule("osutils");e&&(n.deviceInfo=await(e.getDeviceInfo?.()),n.systemCpuInfo=await(e.getSystemCpuInfo?.()),n.systemMemoryInfo=await(e.getSystemMemoryInfo?.()))}catch(t){e.errorToTelemetry&&e.errorToTelemetry(kr.LoadModuleOsUtilsFailed,"webclient_framework_host_comms",void 0,!0)}try{const e=await t.loadModule("telemetry"),i=e?.registerForOnNewContext;i&&(n.registerForCoreContext=e=>{i((t=>{t.filter((e=>void 0===e.userContextId)).forEach((t=>e(t.column,t.value)))}))}),n.desktopContext=await(e?.getContext?.({columns:["launchIntent","desktopVersion","deviceAuthToken","windowsChannel","windowsSku","storageInfo","outOfProcState","installationSource"]}))}catch(t){e.errorToTelemetry&&e.errorToTelemetry(kr.LoadModuleTelemetryFailed,"webclient_framework_host_comms",void 0,!0)}}return n}async handOffContextCommsCallback(e,t,n){const i=await e.loadModule("telemetry"),a=await(i?.getPreAuthUserSamplingId?.());if(a&&this.setPreAuthUserId?.(t,n,a),i&&i.setContext){const e=i.setContext;(0,Pt.AR)().setMultiContextCallback(((t,n,i)=>e([{column:t,value:n,userContextId:i}])))}if(i&&i.setCollectorContext){const e=i.setCollectorContext;(0,Pt.AR)().setCollectorContextCallback(((t,n,i)=>e({enableTelemetryRegionReinit:t,telemetryRegion:n,telemetryRegionFetchComplete:i})))}}createMemoryAnalyzer(e,t){const{enableDesktopMemoryAnalyzer:n,isScenarioMemorySnapshotEnabled:i}=t;return n?new jW(!!i,e):void 0}createCoreScenarioFactory(e,t,n,i,a){const o=new vU({parentScenarioFactory:e.scenarioFactory,settings:mU(e.coreSettings),platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:e.correlation},e.config.startTimeMS,t,void 0,void 0,void 0,void 0,i,a,n);return e.scenarioFactory=o,o}async createHeartbeatMonitor(e){const t=new fj.f(e);await t.start(),e.heartbeatMonitor=t}createDataClientTrackerService(e){const t=[Ba.Lg.Inactive,Ba.Lg.LongInactive],n=[d.TL.Inactive,d.TL.LongInactive],i=e.platformService.config.clientType===nt.sK.Maglev?()=>!!e.clientState&&t.includes(e.clientState.getState()):()=>!!e.appStateService&&n.includes(e.appStateService.getState());return new HW(e.coreSettings,e.leakDetectorService,e.userTrackingService,i)}createWindowTrackerService(e){e.windowTrackerService=new rV(e)}async createCoreTelemetryService(e,t,n,i,a,o){const{config:r,coreSettings:s,coreSecurityService:l,experimentationService:d,hostCommunicationService:u,loggerFactory:m,platformService:p,routingServices:g,windowProvider:h}=e,v=await(0,pO.dj)(u),y=rt(h),S={osLocale:v,userLanguage:(0,pO.xd)(h),localeCode:(0,pO.JK)(h,g,m,y.localeCode),originLocaleCode:(0,pO.o8)(h,g,m,y.localeCode)},{telemetryContext:f,provider:k}=((e,t,n,i,a,o)=>{const{loggerFactory:r,coreSettings:s,platformService:l,scenarioFactory:c,host:d}=n,u=r.newLogger("Telemetry","core-services-telemetry"),m=xV(e,u,l,s,!1),p=a||new HB(u),{columnSuppression:g}=RV(u,s,m.defaultLoggerName),h=MV(s,d,e,i),v=YV(s,e),{provider:y}=LV(e,m,{logger:u,platformService:l,coreSettings:s,telemetryContext:p,i18nInfo:t,experimentationService:o,columnSuppression:g,loggerFactory:r,scenarioFactory:c,host:d},{workerType:v,workerSetup:h},!1);return{provider:y,telemetryContext:p}})({appStartTime:r.startTimeMS,experienceName:r.experienceName,windowType:r.windowType,clientTypeTelemetry:r.clientTypeTelemetry,telemetryLiteExperiencePort:r.telemetryLiteExperiencePort},S,{loggerFactory:m,platformService:p,coreSettings:s,scenarioFactory:n,host:h},{coreSecurityService:l,windowBaseUrl:h.document.location.origin},a,d);k.eventCapture=new XV.V(h,s,k.eventCapture);const C=new OU(n,f,t,{isolateUserContext:s.get(c.w.Telemetry).isolateUserContext??!1});if(h.localStorage){const e=h.localStorage.getItem("ts.latestOid");C?.setContext("UserInfo.Id",e)}return r.externalCorrelationId&&C.setCoreContext("EventInfo.ExternalCorrelationId",r.externalCorrelationId),r.embedContext&&(C.setCoreContext("Window.EmbedContext",r.embedContext),C.setCoreContext("AppInfo.EmbedReferrer",function(e,t){try{const{referrer:n}=t.getSearchState(),i=e.document.referrer,a=e.parent.opener;let o=n;return sV(e,o)||(o=i&&(0,Bo.yz)(i),sV(e,o)||(o=a&&a.location&&a.location.hostname||void 0,!sV(e,o)&&e.location.ancestorOrigins&&e.location.ancestorOrigins.length>0&&(o=e.location.ancestorOrigins[0]))),o||""}catch(e){return""}}(h,g.state))),this.setTelemetryContext(e,C,i,o),C.setCoreContext("AppInfo.ArchVersion","V2"),e.telemetryService=C,C}setPreAuthUserId(e,t,n){const i=e.get(c.w.Telemetry);n&&i.enablePreAuthIdSampling&&(t.setCoreContext("AppInfo.PreAuthUserSamplingId",n),uV.Z.getInstance().setSamplingByPreAuthId(n))}createCoreUserBiService(e){const{config:t}=e,n=e.telemetryService?.createUserBiService(e,d.N2,{id:(0,E.v4)(),source:A.p.StandAlone,startTimestamp:t.startTimeMS});e.userBiService=n}setTelemetryContext(e,t,n,i){const{deviceInfo:a,systemCpuInfo:o,systemMemoryInfo:r}=n;if(a&&(t.setCoreContext("DeviceInfo.Make",a.make),t.setCoreContext("DeviceInfo.Model",a.model),t.setCoreContext("DeviceInfo.CpuArchitecture",a.cpuArchitecture),t.setCoreContext("DeviceInfo.OsVersion",a.osVersion)),o&&(t.setCoreContext("CpuInfo.Cores",o.cpuCores.length.toString()),t.setCoreContext("CpuInfo.Model",o.cpuCores[0].model),t.setCoreContext("CpuInfo.Speed",o.cpuCores[0].speed)),r&&t.setCoreContext("DeviceInfo.TotalMemory",r.totalPhysicalMemoryBytes),i&&0!==i.length){const e=i.reduce(((e,t)=>({...e,[t.column]:t.value})),{}),n=e.launchIntent,a=e.desktopVersion,o=e.deviceAuthToken,r=e.windowsChannel,s=e.windowsSku,l=e.storageInfo,c=e.outOfProcState,d=e.installationSource;n&&t.setCoreContext("AppInfo.LaunchIntent",n),a&&t.setCoreContext("AppInfo.DesktopVersion",a),c&&t.setCoreContext("AppInfo.OutOfProcState",c),o&&t.setDeviceAuthToken(o),r&&t.setCoreContext("DeviceInfo.WindowsChannel",r),s&&t.setCoreContext("DeviceInfo.WindowsSku",s),l&&t.setCoreContext("DeviceInfo.StorageInfo",l),d&&t.setCoreContext("installationSource",d)}const s=e.platformService.config.vdi?.mode??"";s&&(t.setCoreContext("vdiMode",s),t.setCoreContext("vdiModeDynamic",s))}startAppStartScenarios(e,t){const{config:n,routingServices:i,telemetryService:a,windowProvider:o}=e,r=this.getDownloadAndParseStepData(t,o);a?.newCoreScenario(be.Cu.AppStart,{startTime:n.startTimeMS}),cV(n.experienceName,t,n.startTimeMS,i.state,o,r)}getDownloadAndParseStepData(e,t){let n;if(t.performance){t.performance.timing&&e.createScenarioWithoutStarting(be.Cu.DomLoadingStart,{startTime:t.performance.timing.domLoading}).stop();const i=t.performance.getEntriesByType("resource").find((e=>"script"===e.initiatorType&&e.name.indexOf("main")>=0)),a=void 0!==i&&0===i.transferSize;n=dV(be.Cu.DownloadAndParse,"execute-index-html-script","start-execute-main-bundle",t,e,{cached:a}),dV(be.Cu.ResolveMainImports,"start-execute-main-bundle","resolve-main-imports-end",t,e)}return n}}const tH=async e=>async t=>{if("quit"===t)e?.getTelemetryServicesCache().forEach((e=>e.coreScenarioFactory.incompleteRunningScenarios?.())),await(0,Pt.AR)().flush()};var nH=n(874090);class iH extends xp{constructor(){super(d.c1.InitUserBrbServiceTask,["activeWindowsService","authenticationService","authenticationUser","brbServiceManager","coreSettings","discover","endpointsManager","entityCommanding","hostCommunicationService","i18n","loggerFactory","logsCollectorService","platformService","scenarioFactory","windowProvider"])}async execute(e){const{activeWindowsService:t,authenticationService:n,authenticationUser:i,brbServiceManager:a,coreSettings:o,discover:r,endpointsManager:s,entityCommanding:l,hostCommunicationService:c,i18n:d,loggerFactory:u,logsCollectorService:m,platformService:p,scenarioFactory:g,windowProvider:h}=e;if(!i)throw new Error("authenticationUser is invalid, cannot register user brb service.");const v=(0,kt.Lw)(i);return a.registerUserBrbService(v,(()=>new nH.G(u,o,m,n,p,r,h,c,s,g,d,t,i,l))),e=>{"signout"===e&&a.unregisterUserBrbService(v)}}}class aH extends xp{constructor(){super(d.c1.InitializePulsarTask,["coreSettings","loggerFactory","platformService"])}async execute(e){const{coreSettings:t,loggerFactory:n,platformService:i}=e,a=new aa(Xi.TEAMS_CORE,{sessionId:i.host.sessionId,spanExporter:new oa,loggerFactory:n,logToOTLCollector:!!t.get(c.w.Pulsar).logToOTLCollector});t.get(c.w.Pulsar).enablePulsarTelemetry&&await a.initialize(),e.pulsar=a}}class oH extends xp{constructor(){super(d.c1.LimitWebTabs,["coreSettings"])}async execute(e){const{coreSettings:t,crossTabsService:n}=e;if(!n)return;const{enableCrossTabsCommunication:i,crossTabsActiveTabsLimit:a}=t.get(c.w.Core,["enableCrossTabsCommunication","crossTabsActiveTabsLimit"]);i&&a&&a>0&&await n.isActiveTabsLimitReached().then((e=>{if(e)throw new Ha.a(Ha.D.TAB_DISABLED)}))}}class rH extends xp{constructor(){super(d.c1.RegisterCustomFrameThemes,["coreSettings","hostCommunicationService"])}async execute(e){const{coreSettings:t,hostCommunicationService:n}=e,{primaryWindowTitleBarHeightPx:i,secondaryWindowTitleBarHeightPx:a}=t.get(c.w.Core),o=await n.loadModule("windowcontrols");i&&a&&(o?.defineCustomFrameTheme?.("main",{buttonHeight:i,buttonWidth:44}),o?.defineCustomFrameTheme?.("default",{buttonHeight:a,buttonWidth:44}),o?.defineCustomFrameTheme?.("mainClassic",{buttonHeight:i,buttonWidth:44,light:{closeColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#c4314bff",mouseDown:"#a72037ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}},minMaxColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#4f52b2ff",mouseDown:"#3d3e78ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}}}}),o?.defineCustomFrameTheme?.("defaultClassic",{buttonHeight:a,buttonWidth:44,light:{closeColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#c4314bff",mouseDown:"#a72037ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}},minMaxColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#4f52b2ff",mouseDown:"#3d3e78ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}}}}))}}class sH extends xp{constructor(){super(d.c1.ReloadExperience,["coreSettings","platformService","rebootService","loggerFactory","scenarioFactory"]),this.isReloadRequired=(e,t)=>e&&t&&e!==t}async execute(e){const{coreSettings:t,platformService:n,rebootService:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("ReloadExperienceTask","core-services-tasks"),{buildRing:s,assignedRing:l}=this.getRings(n,t);if(this.isReloadRequired(s,l)&&l){r.log(`Reload required: Assigned: ${l}, Build: ${s}`);return await i.rebootApp(jp.g.RingSwitch,jp.Z.ReloadAppTask,{qsps:{ring:l},maxRetries:1})||this.reportReloadNotTriggered(s,l,r,o),e=>{"signout"===e&&i.clearRetryCount(jp.Z.ReloadAppTask)}}r.debug(`No reload required: Assigned: ${l}, Build: ${s}`),i.clearRetryCount(jp.Z.ReloadAppTask)}getRings(e,t){const{ring:n}=t.get(c.w.Metadata);return{assignedRing:n?.id||void 0,buildRing:e.ecsOverrides.ring||void 0}}reportReloadNotTriggered(e,t,n,i){n.warn(`Ring Discrepancy: Assigned: ${t}, Build: ${e} `),i.createScenarioWithoutStarting(be.Cu.BuildRingDiscrepancy).fail({message:e})}}class lH extends xp{constructor(){super(d.c1.SetAppStateToTelemetryTask,["telemetryService","hostState","networkState","coreSettings"])}async execute(e){const{telemetryService:t,hostState:n,networkState:i,coreSettings:a}=e;a.get(c.w.Telemetry).enableTelemetryCancelOnSuspendAndNetworkOffline&&(n&&t.initTelemetrySuspendStateSubscription(n,a.get(c.w.Telemetry).scenarioCancelOnSuspendStateChangeBlockList??[]),i&&t.initTelemetryNetworkStateSubscription(i,a.get(c.w.Telemetry).scenarioCancelOnNetworkStateChangeBlockList??[]))}}const cH=";path=/;secure;samesite=none;partitioned";class dH extends xp{constructor(){super(d.c1.SetRingFinderCookieTask,["authenticationUser","coreSettings","loggerFactory","windowProvider","discover","i18NextWrapper"]),this.setAuthCookie=(e,t,n,i)=>{if(void 0===e.document?.cookie)return void t.warn(`Cannot set cookie: '${n}'.`);t.log(`Setting '${n}' cookie.`);const a=new Date,o=a.setMonth(a.getMonth()+5);e.document.cookie=`${n}=${i};expires=${new Date(o).toUTCString()}${cH}`},this.subscribeToCountryCode=(e,t,n,i,a)=>{const o=t?.getObservable(c.w.Metadata,["countryCode"]);this.metadataSettingsSubscription=o?.subscribe((({countryCode:o})=>{const{enableCountryInRingFinder:r}=t.get(c.w.Core);r&&o&&o!==a.country&&(a.country=o,this.setAuthCookie(e,n,i,encodeURIComponent((0,ge.hR)(a))))}))},this.cleanUpCookie=(e,t,n)=>{void 0!==e.document?.cookie&&(t.log(`Expiring '${n}' cookie.`),e.document.cookie=`${n}=;max-age=0${cH}`)}}async execute(e){const{authenticationUser:t,coreSettings:n,discover:i,loggerFactory:a,windowProvider:o,i18NextWrapper:r}=e,s=a.newLogger("SetRingFinderCookieTask","core-services-tasks");try{const{windowsInsiderChannel:e,windowsInsiderRing:a}=n.get(c.w.Host),{enableRegionParamForPDS:l,enableLocaleInRingFinder:d,enableCountryInRingFinder:u}=n.get(c.w.Core);let m;l&&(m=await i.getRegion({id:t.id,tenantId:t.profile.tenantId,oid:t.profile.objectId,accountType:t.type,userName:t.loginUserName||""}));const p=d?r.locale:void 0,{countryCode:g}=n.get(c.w.Metadata),h=u?g:void 0,v={oid:t.profile.objectId,tid:t.profile.tenantId,wipChannel:e,wipRing:a,region:m,locale:p,country:h},y="ringFinder";return this.setAuthCookie(o,s,y,encodeURIComponent((0,ge.hR)(v))),this.subscribeToCountryCode(o,n,s,y,v),e=>{switch(this.metadataSettingsSubscription?.unsubscribe(),this.metadataSettingsSubscription=void 0,e){case"signout":{const{cleanupRingFinderCookie:e}=n.get(c.w.Core);e&&this.cleanUpCookie(o,s,y);break}default:return}}}catch(e){s.error(`Failed to set ring finder cookie: ${(0,Je.Nw)(e)}`)}}}class uH extends xp{constructor(){super(d.c1.SetPrimaryUserOnTelemetry,["primaryUser","loggerFactory","telemetryContextService","hostCommunicationService"])}async execute(e){const{primaryUser:t,loggerFactory:n,telemetryContextService:i,hostCommunicationService:a}=e;try{const e=(0,kt.Lw)(t),n=t.profile.tenantId;i.setPrimaryUser(e,n);const o=await a.loadModule("telemetry");o?.setPrimaryUser?.(e,n)}catch(e){const i=new Ha.a(Ha.D.TELEMETRY_PRIMARY_USER_SET_FAILURE,e,(0,kt.Lw)(t));n.newLogger("SetUserOnTelemetryContext","core-services-tasks").error?.(i.toTelemetryEntry())}}}class mH{constructor(){this.id=d.c1.SetUserOnDiagnosticsService}async execute(e){const{authenticationUser:t,coreSettings:n,diagnosticsService:i,logsCollectorService:a}=Nf("SetUserOnDiagnosticsServiceTask",e,"authenticationUser","coreSettings","diagnosticsService","logsCollectorService");a.setPrimaryUserID(t.id);const{enableMTMA:o}=n.get(c.w.Core);if(o){const n=i.createUserDiagnosticsService(t.profile.tenantId,t.profile.objectId,t.id);n&&(e.diagnosticsService=n,a.registerUserLogsProvider(t.id,n),e.loggerFactory=new Vi(n,e.loggerFactory.cID))}else i.updateDiagnosticInfo(t.profile.tenantId,t.profile.objectId);return e=>{switch(e){case"quit":i.persistDiagnosticsAsPreviousSessionLogs();break;case"signout":t.id&&a.handleUserLogout(t.id),i.handleUserLogout(t.id)}}}}var pH=n(422476);class gH extends xp{constructor(){super(d.c1.SignalCoreLifecycleChangesTask,["activeWindowsService","authenticationUser","authenticationService","client","clientState","config","coreSecurityService","coreSettings","coreUtilities","correlation","entityCommanding","experienceChangeReportingService","experienceLifecycleManager","hostCommunicationService","i18n","i18NextWrapper","localStorage","loggerFactory","networkState","platformService","rebootService","scenarioFactory","userBiService","windowProvider","notificationsHandler","logsCollectorService"])}async execute(e){const{activeWindowsHistoryService:t,authenticationUser:n,authenticationService:i,client:a,clientState:o,clientAccessAdminPolicyCheckService:r,config:s,coreSecurityService:l,coreSettings:d,coreUtilities:{isEntityInView:u},correlation:m,delegatedCommanding:p,entityCommanding:g,experienceChangeReportingService:h,experienceLifecycleManager:v,hostCommunicationService:y,i18n:S,i18NextWrapper:f,localStorage:k,loggerFactory:C,networkState:b,platformService:w,rebootService:T,scenarioFactory:I,userBiService:N,userTrackingService:A,windowProvider:E,notificationsHandler:F,logsCollectorService:_}=e,D=e.localMigratedSettings,P=C.newLogger("SignalCoreLifecycleChangesTask","core-services-tasks");if(!n||!(0,pH.xA)(n))return void P.warn("Not creating user lifecycle manager as authenticated user is not available.");const{disableExperience:M,enableExperienceLifeCycleSignalsLogging:R}=d.get(c.w.Core),{crossCloudMeetingEnabled:x}=d.get(c.w.HostCapabilities),L=M&&n.role!==pg.a7.Anonymous,O=M&&!1===x&&n.role===pg.a7.Anonymous,j=e.activeWindowsService?.getWindowLayoutService().preCacheManager;if(L||O)return void P.warn(`Not creating user lifecycle manager as experience is disabled. UserRole ${n.role}, \n          disableExperience: ${M}, crossCloudMeetingEnabled: ${x}`);if(r){let e;try{e=await r.isUserAllowed()}catch(t){P.warn(`isUserAllowed encountered exception: ${t}`),e=!0}if(!e)return void P.warn("Not creating user lifecycle manager as experience is disabled by admin policy.")}const B=m.id,U=(0,kt.Lw)(n);return v.manageUser(U,{activeWindowsHistoryService:t,authenticationUser:n,authenticationService:i,client:a,clientState:o,config:s,coreSecurityService:l,coreSettings:d,delegatedCommanding:p,entityCommanding:g,i18n:S,i18NextWrapper:f,isEntityInView:u,localMigratedSettings:D,loggerFactory:C,networkState:b,platformService:w,preCacheManager:j,rebootService:T,scenarioFactory:I,hostCommunicationService:y,userTrackingService:A,windowProvider:E,localStorage:k,userBiService:N,notificationsHandler:F,logsCollectorService:_}),R&&P.infoToTelemetry?.("Sending UserAuthenticated signal to exp life cycle manager","webclient_framework_foundation_core_services_life_cycle_signals",{userId:U}),h.report({correlationId:B,userContextId:U,type:Ua.Mk.UserAuthenticated,context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),(0,pH.VQ)(d,k)||h.report({correlationId:B,type:Ua.Mk.UserConsentedToConsumeResources,userContextId:U,context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),async e=>{switch(e){case"quit":case"signout":await v.removeUser(e,U);break;default:return}}}}class hH extends xp{constructor(){super(d.c1.StoreBuildInfoTask,["localStorage","platformService"])}async execute(e){const{localStorage:t,platformService:n}=e,i=n.config.buildVersion;i&&!i.toLocaleLowerCase().startsWith("local")&&t.set("buildNumber",i,"Framework","Experience")}}class vH extends xp{constructor(){super(d.c1.TrackExperienceIdle,["clientState","correlation","coreSettings","experienceChangeReportingService"])}async execute(e){const{clientState:t,correlation:n,coreSettings:i,experienceChangeReportingService:a}=e,{enableExperienceIdleStateManagement:o}=i.get(c.w.Core);if(!o)return;const r=t.observe().subscribe((async e=>{const t=e===Ba.Lg.LongInactive;a.report({correlationId:n.id,type:Ua.Mk.ExperienceIdleStateChanged,context:{target:"core-tasks-signal-core-lifecycle-changes-task",isIdle:t}})}));return e=>{switch(e){case"signout":case"quit":r.unsubscribe()}}}}class yH extends xp{constructor(){super(d.c1.UpdateDataClientContext,[])}async execute(e){!function(e,t){const{clientResolversFactory:n,writeClientDefaultsFn:i,pubsub:a}=e.getServices(),o={...t,pubsub:a,send:(0,Bh.nC)(ah.t,t.networkState.observeIsOnline())},r=Yb.singletonLink,s=n.get();if(!r||!s)throw new Error("Link and client resolvers should be created at this point");const{maxApolloResultCacheSize:l,enableApolloDoubleWriteFix:d}=t.coreSettings.get(c.w.Core),{enableApolloDevtools:u}=t.coreSettings.get(c.w.Diagnostics),m=l??void 0,p=t.leakDetectorService?.create(),g=zF({leakDetector:p,windowId:e.cache.apolloLeakInfo?.apolloLeakInfoWindowId,entityType:e.cache.apolloLeakInfo?.apolloLeakInfoEntityType,viewportContext:"cmd"},void 0,s,m,t.loggerFactory,t.scenarioFactory,i,void 0,u,GC.J.cmd,t.graphqlStoreStatsReporterService,d);mb(g,"cmdApolloClient",Boolean(u),t.platformService,t.config.experienceName);const h=UF.createUserDataRequestContext(o,g),v=QF(h,r);e.updateContext(h,v),g.setLink(v)}(e.client,e)}}class SH extends xp{constructor(){super(d.c1.UpdateNetworkStateDetection,[])}async execute(e){const t=e.authenticationUser&&(0,kt.Lw)(e.authenticationUser)||"",n=e.networkState.subscribeToEndpointsNetworkStateTracking?.(t,e.endpointsManager.networkState);return e=>{"signout"===e&&n()}}}class fH extends xp{constructor(){super(d.c1.WaitForCDLWorkerTask,["loggerFactory","coreSettings","coreSettingsContext","delegatedCommanding"])}async execute(e){const{loggerFactory:t,coreSettings:n,coreSettingsContext:i,delegatedCommanding:a}=e,{cdlWorkerService:o}=e,r=t.newLogger("WaitForCDLWorkerTask","core-services-tasks");if(!(0,Xy.ZG)(n))return;const{isCDLWorkerCriticalToStartup:s}=n.get(c.w.Core);if(o){r.log("Waiting for CDL worker to finish initialization");const e=await o.getCDLWorkerManager();if(e)e.syncEngineInitializationPromise.then((e=>{if(e.isSyncEngineInitialized)i.updatePlatformProviderSettings({bootType:e.bootType});else{let t;t=!e.isReliableSyncEngine||n.get(c.w.CdlWorker).disableReducedCapabilitiesOopsOnWorkerStartupFailure?e.isExpected?"sync-engine-expected-failure":"sync-engine-failure":"reduced-capabilities",o.triggerWorkerStartupFailure(t,e.isReliableSyncEngine,a)}}));else if(r.errorToTelemetry?.(`CDL worker manager not initialized. isCDLWorkerCriticalToStartup: ${s}.`,"cdl_wait_for_cdl_worker_task",void 0,!0),s)throw new Ha.a(Ha.D.CDL_WORKER_FAILURE)}else if(r.warnToTelemetry?.(`CDL worker service not present in core context. isCDLWorkerCriticalToStartup: ${s}.`,"cdl_wait_for_cdl_worker_task",void 0,!0),s)throw new Ha.a(Ha.D.CDL_WORKER_FAILURE)}}class kH extends xp{constructor(){super(d.c1.WrapChangeReportingServicesTask,["commandChangeReportingService","experienceChangeReportingService","authenticationUser"])}async execute(e){const{commandChangeReportingService:t,experienceChangeReportingService:n,authenticationUser:i}=e,a=(0,kt.Lw)(i);return e.commandChangeReportingService={...e.commandChangeReportingService,report:e=>{t.report({userContextId:a,...e})},observeChanges:t.observeChanges.bind(t)},e.experienceChangeReportingService={...e.experienceChangeReportingService,report:e=>{n.report({userContextId:a,...e})},observeChanges:n.observeChanges.bind(n)},Promise.resolve()}}class CH{constructor(e,t,n){this.cache=new Map,this.lastId=0,this.blacklist=["imgpsh_fullsize"],this.currentSize=0,this.cacheHits=0,this.cacheMisses=0,this.maxCacheSize=e,this.cachePruneRatio=t,this.scenarioFactory=n}add(e,t,n){if(this.maxCacheSize<=0)return!1;if(!t)return!1;if(!this.shouldCache(e))return!1;let i;if(this.has(e,t)){const a=this.get(e,t);i={...a,...n},a&&(a.blob!==n.blob&&URL.revokeObjectURL(a.blob),this.currentSize+=i.size-(a?.size??0))}else i={...n,time:this.lastId++},this.cacheMisses++,this.currentSize+=i.size;const a=this.getCacheKey(e,t);return this.cache.set(a,i),this.pruneIfNeeded(),!0}setCapacity(e,t){this.maxCacheSize=e,this.cachePruneRatio=t,this.pruneIfNeeded()}has(e,t){return!!t&&this.cache.has(this.getCacheKey(e,t))}get(e,t){if(!t)return;const n=this.getCacheKey(e,t),i=this.cache.get(n);return i&&(i.time=this.lastId++,this.cacheHits++),i}get size(){return this.cache.size}getCacheKey(e,t){return`${e}/${t}`}getCacheHitRatio(){const e=this.cacheHits+this.cacheMisses;if(!e)return 0;return Math.round(this.cacheHits/e*100)/100}shouldCache(e){for(const t of this.blacklist)if(e.includes(t))return!1;return!0}pruneIfNeeded(){if(this.currentSize>this.maxCacheSize){const e={};e.cacheCountBeforePruning=this.size;const t=this.scenarioFactory.newScenario(be.Cu.AMSMemoryCachePrune),n=Array.from(this.cache.entries());n.sort(((e,t)=>e[1].time-t[1].time));const i=Math.max(this.currentSize-this.maxCacheSize,Math.ceil(this.maxCacheSize*this.cachePruneRatio));let a=0;for(const[e,t]of n){const n=t.size;if(!(a+n<=i))break;this.currentSize-=n,this.cache.delete(e),a+=n,URL.revokeObjectURL(t.blob)}e.cacheHitRatio=this.getCacheHitRatio(),e.cacheCountAfterPruning=this.size,t.stop(e)}}}class bH extends xp{constructor(){super(d.c1.CreateAMSImageCaches,["coreSettings","scenarioFactory"]),this.BYTE_MULTIPLIER=1e6,this.PRUNE_RATIO=.2}async execute(e){const{coreSettings:t,scenarioFactory:n}=e,i=new CH(0,this.PRUNE_RATIO,n);e.amsImageCache=i;const a=t.getObservable(c.w.ImageCache).subscribe((e=>{let t=0;"number"==typeof e.amsImageCacheMaxCapacityInMB&&(t=e.amsImageCacheMaxCapacityInMB),i.setCapacity(t*this.BYTE_MULTIPLIER,this.PRUNE_RATIO)}));return()=>a.unsubscribe()}}var wH=n(543291),TH=n(244542),IH=n(948131);class NH{constructor(e,t,n){this._windowId=e,this._logger=t,this._commandChangeReportingService=n,this._entityExtensionSubject=new Sa.m,this._extendedEntityContainerStateSubject=new Sa.m,this._modalState=void 0}observeModalState(){return this._entityExtensionSubject}observeContainerState(){return this._extendedEntityContainerStateSubject.complete(),this._extendedEntityContainerStateSubject=new Sa.m,this._extendedEntityContainerStateSubject.pipe((0,TH.v)((e=>e.hasEntityExtension),!0),(0,IH.Z)({hasEntityExtension:!!this._modalState?.entity?.type,containerState:this._modalState?.containerState||g.iW.Closed}),(0,zW.J)(),(0,TH.v)((([e,t])=>{const n=t.containerState,i=t.hasEntityExtension,a=e.containerState,o=n===g.iW.Confirmed,r=n===g.iW.Cancelled,s=n===g.iW.Error,l=n===g.iW.Closed,c=a===g.iW.Open;return i&&!o&&!r&&!s&&!(c&&l)}),!0),(0,o.T)((([,e])=>e)))}isBlockingEntityExtension(){return!!this._blockingEntityExtension}isBlockedByEntity(e){return this._blockingEntityExtension?.type===e}setBlockingEntityExtension(e){this._blockingEntityExtension=e}setEntityExtension(e,t,n,i){this._logger.log(`setEntityExtension is called with ${e} ${t} ${n?.type}/${n?.action}`),t!==this._modalState?.isExternal||this.hasEntityChanged(n)?(this._modalState?.entity&&this._logger.warnToTelemetry?.(`Previous entity is not closed before opening a new one, Previous: ${this._modalState?.entity.type}/${this._modalState?.entity.action}, New: ${n?.type}/${n?.action}`,"webclient_framework_foundation_core_services_active_windows"),this._modalState={...this._modalState,isExternal:t,entity:n},this._entityExtensionSubject.next({isExternal:!!this._modalState?.isExternal,entityExtension:this._modalState?.entity,correlationId:e}),i&&this._commandChangeReportingService.report({correlationId:e,type:p.I.WindowUpdated,context:{target:"executeEntityCommand"}})):i&&this._commandChangeReportingService.report({correlationId:e,type:p.I.WindowNotUpdated,context:{target:"executeEntityCommand"}})}setContainerState(e,t){e!==this._modalState?.containerState&&(this._modalState={...this._modalState,containerState:e},this._modalState?.containerState&&this._extendedEntityContainerStateSubject.next({containerState:this._modalState?.containerState,hasEntityExtension:!!this._modalState?.entity?.type}),e!==g.iW.Open&&t&&this.setEntityExtension((0,E.v4)(),!1,void 0,t))}updateModalState(e){e.id===this._windowId?(this.setEntityExtension(e.correlation.id,e.extendedEntityContainerState?.isExternal||!1,e.activeEntities?.entityExtension||void 0,!1),this.setContainerState(e.extendedEntityContainerState?.containerState,!1)):this._logger.errorToTelemetry?.("updateModalState got called on wrong window","webclient_framework_foundation_core_services_active_windows")}hasEntityChanged(e){const t=this._modalState?.entity;return t?.id!==e?.id||t?.type!==e?.type||t?.action!==e?.action||t?.options!==e?.options}}var AH=n(81758);const EH=[ke.ck.callingdeeplink,ke.ck.meetings,ke.ck.platformapp,ke.ck.extensions];class FH{constructor(e,t){this._logger=e,this._enableAppPreCaching=t,this._preCacheAppListSubject=new Sa.m,this._preCacheState={appsToPreCache:[]}}observePreCacheState(){return this._preCacheAppListSubject}preCacheApps(e){this._enableAppPreCaching&&this.setPreCacheStateInternal({appsToPreCache:e})}interruptPreCaching(){this._enableAppPreCaching&&this.setPreCacheStateInternal({appsToPreCache:[]})}shouldInterruptPreCaching(e){return this._enableAppPreCaching&&EH.includes(e.type)}setPreCacheStateInternal(e){this.hasStateChanged(e)&&(this._logger.log(`${AH.b}Set new pre cache state: ${(0,ge.hR)(e.appsToPreCache)}`),this._preCacheState={...this._preCacheState,...e},this._preCacheAppListSubject.next(e.appsToPreCache))}hasStateChanged(e){return!(this._preCacheState.appsToPreCache.length===e.appsToPreCache.length&&!this._preCacheState.appsToPreCache.some(((t,n)=>t.correlationId!==e.appsToPreCache[n].correlationId||this.hasEntityChanged(t.entity,e.appsToPreCache[n].entity))))}hasEntityChanged(e,t){return!(e.id===t?.id&&e.type===t?.type&&e.action===t?.action)}}class _H{constructor(e,t,n,i,a,o){this._userContextId=t,this._enableDecoupleCommandingFromApollo=i,this._modalManager=new NH(e,n,o),this._preCacheManager=new FH(n,a)}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}get modalManager(){return this._modalManager}get preCacheManager(){return this._preCacheManager}setUserContextId(e){this._userContextId=e}validateUserContext(e){return this._userContextId!==e}}function DH({correlation:e,entity:t,openOnMainWindow:n,mainWindowLayoutMode:i,userContextId:a,windowId:o=d.N2,visibilityState:r}){let s=o;if(this._logger.log(`handleExtendCommand is called with: openOnMainWindow:${n}, mainWindowLayoutMode:${i}, userContextId: ${a}, windowId: ${o}, entity: ${t}, visibilityState: ${r}`),n&&(s=this.getMainWindowWithLayoutMode(i??Yt.Rm.standard)?.id),"hide"===r)return this._logger.log(`handleExtendCommand is hiding entity ${t?.type} with action ${t?.action}`),this.getWindowLayoutService(s).modalManager.setEntityExtension(e.id,!1,void 0,!0),void this.getWindowLayoutService(s).modalManager.setContainerState("Closed",!0);const l=s?this.getActiveWindow(s):void 0;if(("switchaccountdialog"!==t?.type||"view"!==t?.action)&&null!==a&&null!==l?.userContextId&&this.getWindowLayoutService(s).validateUserContext(a))return this._logger.log("User context of source window does not match user context of command. Rejecting command"),void this._commandChangeReportingService.report({correlationId:e.id||"",type:p.I.Incomplete,context:{errorInfo:k.Q.UserContextMismatch,target:"handleExtendCommand"}});const c=this.getWindowLayoutService(s);this._logger.log(`handleExtendCommand is acting on window ${s}`),c.modalManager.setEntityExtension(e.id,!1,t,!0)}class PH{constructor(e,t,n,i,a){this._enableDecoupleCommandingFromApollo=t,this._enableDecoupleCommandingFromApolloRerenderForCorrelation=n,this._enableAppPreCaching=i,this._commandChangeReportingService=a,this._activeWindowsSubject=new Sa.m,this.cleanup=(e,t)=>{this._logger.log(`cleaning up activeWindowsService for user: ${t} due to ${e}`)},this._activeWindows=new Map,this._windowLayoutServices=new Map,this._logger=e.newLogger("ActiveWindowsService","core-services-active-windows"),this._defaultMainWindowLayoutService=new _H(d.N2,void 0,this._logger,t,i,this._commandChangeReportingService),this._windowLayoutServices.set(d.N2,this._defaultMainWindowLayoutService)}getActiveWindowsObservable(){return this._activeWindowsSubject.pipe((0,o.T)((e=>Array.from(e.values()))))}updateLayoutConfig(e,t=d.N2){const n=this.getActiveWindow(t);if(!n)return;const i=Object.entries(e)?.reduce(((e,[t,i])=>{const a=Yt.I6[t];let o,r;const s=a===Yt.$n.end&&i?.legacyFoldState?i.legacyFoldState:void 0;return(i.foldState||i.toggleFoldState)&&(r=n.layoutConfig.slots?.[a]?.foldState,i.toggleFoldState?o=r===Yt.Vt.FOLDED?Yt.Vt.UNFOLDED:r===Yt.Vt.UNFOLDED?Yt.Vt.FOLDED:r:i.prevFoldState&&i.prevFoldState!==r||(o=i.foldState!==Yt.Vt.FOLDED||i.foldState===Yt.Vt.FOLDED&&i.useForce||i.foldState===Yt.Vt.FOLDED&&r!==Yt.Vt.UNFOLDED?i.foldState:r)),e[a]={...n.layoutConfig.slots?.[a],...s&&{legacyFoldState:s},...o&&{foldState:o},...void 0!==i.displayMode&&{displayMode:i.displayMode},...void 0!==i.width&&{width:i.width},...void 0!==i.height&&{height:i.height}},e}),{});n.layoutConfig.slots={...n.layoutConfig.slots,...i},this.setActiveWindow(t,n)}getActiveWindowObservable(e){return this._activeWindowsSubject.pipe((0,o.T)((t=>t.get(e))),(0,di.p)((e=>!!e)),(0,Tg.F)(((e,t)=>this.comparator(e,t))))}observeSlotLayoutConfig(e,t){return this._activeWindowsSubject.pipe((0,o.T)((t=>t.get(e))),(0,di.p)((e=>!!e)),(0,wH.E)("layoutConfig","slots",Yt.I6[t]),(0,Tg.F)(((e,t)=>e?.foldState===t?.foldState&&e?.height===t?.height&&e?.isHidden===t?.isHidden&&e?.displayMode===t?.displayMode&&e?.width===t?.width)))}observeSlotLayoutConfigProperty(e,t,n){return this._activeWindowsSubject.pipe((0,o.T)((t=>t.get(e))),(0,di.p)((e=>!!e)),(0,wH.E)("layoutConfig","slots",Yt.I6[t],n),(0,Tg.F)())}getSlotLayoutConfigProperty(e,t,n){return this._activeWindows.get(e)?.layoutConfig.slots?.[Yt.I6[t]]?.[n]||void 0}getActiveWindows(){return Array.from(this._activeWindows.values())}getActiveWindow(e){return this._activeWindows.get(e)}setActiveWindows(e,t,n){n?.(),!this._firstWindowCreationParams&&e.length&&(this._firstWindowCreationParams={windowId:e[0].id,correlationId:e[0].correlation.id});const i=new Set(Array.from(this._activeWindows.keys()));this._activeWindows.clear(),e.forEach((e=>{this._createWindowLayoutService(e.id,e.userContextId||void 0),this._activeWindows.set(e.id,e),i.delete(e.id)})),i.forEach((e=>this._windowLayoutServices.delete(e))),t?.(),this._activeWindowsSubject.next(this._activeWindows)}isAsFirstWindowCreation(e,t){return!!this._firstWindowCreationParams&&e===this._firstWindowCreationParams.windowId&&t===this._firstWindowCreationParams.correlationId}removeActiveWindowById(e){this._windowLayoutServices.delete(e);const t=this._activeWindows.get(e);return this._activeWindows.delete(e),this._activeWindowsSubject.next(this._activeWindows),t}getStandardMainWindow(){const e=this.getActiveWindows();return e?.find((e=>e.isMainWindow&&e.layoutConfig.layoutMode===Yt.Rm.standard))}getMainWindowWithLayoutMode(e){const t=this.getActiveWindows();return t?.find((t=>t.isMainWindow&&t.layoutConfig.layoutMode===e))}getWindowLayoutService(e=d.N2){if(!this._enableDecoupleCommandingFromApollo)return this._defaultMainWindowLayoutService;const t=this._windowLayoutServices.get(e);if(!t)throw new Ha.a(Ha.D.CORE_SERVICES_MISSING,new Error(`windowLayoutService was not created for windowId: ${e}`));return t}executeCommand(e){return{handleExtendCommand:DH.bind(this)}[e]}getMatchingWindow(e,t,n){return this.getActiveWindows().find((i=>this._matchingWindowFinder(i,e,t,n)))}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}isNewEntitySameAsCurrentEntity(e,t,n){const i=this.getActiveWindow(e)?.activeEntities[n];return t?.action===i?.action&&(t?.id||void 0)===(i?.id||void 0)&&(t?.linkedEntity?.action||void 0)===(i?.linkedEntity?.action||void 0)&&(t?.linkedEntity?.id||void 0)===(i?.linkedEntity?.id||void 0)&&t?.linkedEntity?.type===i?.linkedEntity?.type&&t?.type===i?.type}setActiveWindow(e,t){this._activeWindows.set(e,t),this._activeWindowsSubject.next(this._activeWindows)}_matchingWindowFinder(e,t,n,i){if(n!==e.userContextId||i?.includes(e.id))return!1;const a=e.activeEntities.mainEntity,o=e.activeEntities.endEntity,r=e.activeEntities.mainEntity?.linkedEntity,s=e.activeEntities.endEntity?.linkedEntity;return[a,o,r,s].find((e=>t.find((t=>e?.type===t?.type&&e?.id===t?.id))))}_createWindowLayoutService(e,t){this._windowLayoutServices.get(e)?this._windowLayoutServices.get(e)?.setUserContextId(t):this._windowLayoutServices.set(e,new _H(e,t,this._logger,this._enableDecoupleCommandingFromApollo,this._enableAppPreCaching,this._commandChangeReportingService))}comparator(e,t){return e?.userContextId===t?.userContextId&&this.hasSameActiveEntities(e?.activeEntities,t?.activeEntities)&&this.hasSameLayoutConfig(e?.layoutConfig,t?.layoutConfig)&&!(t?.correlation.id!==e?.correlation.id&&this._enableDecoupleCommandingFromApolloRerenderForCorrelation)}hasSameActiveEntities(e,t){return 0===Object.keys(ke.Ko).filter((n=>{const i=e?.[n],a=t?.[n];return i?.action!==a?.action||i?.id!==a?.id||i?.linkedEntity?.action!==a?.linkedEntity?.action||i?.linkedEntity?.id!==a?.linkedEntity?.id||i?.linkedEntity?.type!==a?.linkedEntity?.type||i?.options!==a?.options||i?.type!==a?.type})).length}hasSameLayoutConfig(e,t){if(e?.isFullscreen!==t?.isFullscreen||e?.layoutMode!==t?.layoutMode)return!1;return 0===Object.keys(Yt.$n).filter((n=>{const i=e?.slots?.[n],a=t?.slots?.[n];return i?.height!==a?.height||i?.isHidden!==a?.isHidden||i?.width!==a?.width||i?.displayMode!==a?.displayMode||i?.foldState!==a?.foldState})).length}}class MH extends xp{constructor(){super(d.c1.CreateActiveWindowsServiceTask,["loggerFactory","coreSettings","commandChangeReportingService"])}async execute(e){const{commandChangeReportingService:t,coreSettings:n,loggerFactory:i}=e,{enableDecoupleCommandingFromApollo:a,enableDecoupleCommandingFromApolloRerenderForCorrelation:o,enableAppPreCaching:r}=n.get(c.w.Core),s=new PH(i,!!a,!!o,!!r,t);return e.activeWindowsService=s,e=>s.cleanup(e)}}var RH=n(973503);class xH{constructor(e,t,n){this.logger=n;const i=this;this.proxy=new Proxy(t,{get(t,a){const o=t[a];if(o)return"function"!=typeof o?o:(...r)=>{let s="";s=i.getParamsAsString(r,!0),n.log(`Calling ${e}.${String(a)}(${s})`);const l=o.apply(t,r);return l&&l.then&&l.then((t=>n.log(`${e}.${String(a)}(${s}) response: ${i.getParamsAsString(t)}`))).catch((t=>n.error(`${e}.${String(a)}(${s}) response: ${i.getParamsAsString(t)}`))),l};n.error(`${e}.${String(a)}: Not Available`)}})}getProxy(){return this.proxy}getParamsAsString(e,t=!1){let n="";try{n=t?e.map((e=>JSON.stringify(e))).join(","):JSON.stringify(e);const i=1e3;if("string"==typeof n&&n.length>i){const e="...";n=`${n.substring(0,i-e.length)}${e}"`}}catch(e){this.logger.log(`Failed to serialize params: ${e.message}`)}return n}}const LH="tmp.vdiOptimizationMode";class OH{constructor(e,t,n){this.loggerFactory=e,this.hostCommunicationService=t,this.windowProvider=n,this.vdiOptimizationModeHandlers=[],this.logger=this.loggerFactory.newLogger("VDIPlatformService","core-services-vdi")}async init(){try{await this.loadVDIModule();const e=await(this.vdiModule?.getAllVDISettings?.());if(e){const{mode:t,provider:n,isAvRemoted:i,configFilter:a,optimizationMode:o,citrixVdaVersion:r,vmwareVdaVersion:s,sessionId:l,isWebRTCEnabled:c,isMaglevUpdateDisabled:d}=e,u=await(this.vdiModule?.isSlimcoreEnabled?.()),m=this.getVDIPlatformProvider(n);if(m===Rk.None)return;const p=this.getVDISubProvider(n),g=this.getProxiedVdiModule(),h=e=>Promise.reject(`${e}: Not Available`),v={isVDI:!0,mode:t,provider:m,subProvider:p,isAvRemoted:i,configFilter:"string"==typeof a&&a.length?a:null,sessionId:l,vdiOptimizationMode:o,isWebRTCEnabled:c,isSlimcoreEnabled:u,isMaglevUpdateDisabled:d,utils:{getWVDConfig:()=>g.getWVDConfig?.()??h("getWVDConfig"),getWindowHandleAsHex:async()=>{const e=await this.getMainWindowId();return this.getNativeWindowHandleAsHex(e??"invalid-id")},getNativeWindowHandle:async e=>this.getNativeWindowHandleAsHex(e),getVDILocalStackPolicy:()=>g.getVDILocalStackPolicy?.()??h("getVDILocalStackPolicy"),getVMWareSecureWebPort:()=>g.getVMWareSecureWebPort?.()??h("getVMWareSecureWebPort"),getCitrixMSTeamsRedir:()=>g.getCitrixMSTeamsRedir?.()??h("getCitrixMSTeamsRedir"),getCitrixVdaVersion:()=>Promise.resolve(r),getVMwareVdaVersion:()=>Promise.resolve(s),getVMWareViewClientId:()=>g.getVMWareViewClientId?.()??h("getVMWareViewClientId"),setVDIOptimizationMode:e=>this.setVDIOptimizationModeOverride(e),resetVDIOptimizationMode:()=>this.setVDIOptimizationModeOverride(void 0),subscribeToVdiOptimizationMode:e=>this.subscribeToVdiOptimizationMode(e),isWV2Whitelisted:()=>g.isWV2Whitelisted?.()??h("isWV2Whitelisted")}},y=this.getVDIOptimizationSettingsOverride(v,c);return v&&y&&(v.mode=y.mode,v.isAvRemoted=y.isAvRemoted,v.configFilter=y.configFilter,v.vdiOptimizationMode=y.vdiOptimizationMode,this.logger.log("VDIOptimizationSettingsOverride vdiPlatformConfig.vdiOptimizationMode:",v.vdiOptimizationMode)),v}}catch(e){let t="Unknown Error";this.vdiModule||(t="Failed to load vdiModule"),this.logger.error(`Failed to setup VDI environment: ${t}`)}}setVDIOptimizationModeOverride(e){switch(this.logger.log(`setVDIOptimizationModeOverride to: ${e}`),e){case RH.UR.webrtc:case RH.UR.slimcore:case RH.UR.none:this.windowProvider.localStorage.setItem(LH,e);break;default:this.windowProvider.localStorage.removeItem(LH)}this.triggerVdiOptimizationModeChangeEvent()}getVDIOptimizationModeOverride(){const e=this.windowProvider.localStorage.getItem(LH);switch(e){case RH.UR.webrtc:case RH.UR.slimcore:case RH.UR.none:return e;default:return}}subscribeToVdiOptimizationMode(e){return this.vdiOptimizationModeHandlers.push(e),()=>{this.vdiOptimizationModeHandlers=this.vdiOptimizationModeHandlers.filter((t=>t!==e))}}triggerVdiOptimizationModeChangeEvent(){const e=this.getVDIOptimizationModeOverride();this.vdiOptimizationModeHandlers.map((t=>t(e)))}getVDIOptimizationSettingsOverride(e,t){const n=this.getVDIOptimizationModeOverride();return this.logger.log(`getVDIOptimizationSettingsOverride local value: ${n}, isWebRTCEnabled: ${t}`),!1===t&&RH.UR.webrtc===n?null:n&&e?{mode:this.getVdiModeOverride(e.mode,n),isAvRemoted:RH.UR.webrtc===n,configFilter:this.getConfigFilterOverride(e.provider,n),vdiOptimizationMode:n}:null}getVdiModeOverride(e,t){let n="0";switch(t){case RH.UR.webrtc:n="1";break;case RH.UR.slimcore:n="2"}return 4===e.length?e[0]+n+e.substring(2):e}getConfigFilterOverride(e,t){let n="vdi";const i=this.getProviderConfigString(e);if(i)switch(t){case RH.UR.webrtc:n="vdi-av-".concat(i);break;case RH.UR.slimcore:n="vdi-slimcore-".concat(i)}return n}getProviderConfigString(e){switch(e){case Rk.CitrixXenDesktop:case Rk.CitrixXenApp:return"citrix";case Rk.VMWare:return"vmware";case Rk.WVD:return"wvd";case Rk.AWS:return"aws";default:return""}}getVDIPlatformProvider(e=RH.Xo.None){let t=Rk.None;switch(e){case RH.Xo.Citrix:t=Rk.CitrixXenDesktop;break;case RH.Xo.VMware:t=Rk.VMWare;break;case RH.Xo.AVD:case RH.Xo.Windows365:t=Rk.WVD;break;case RH.Xo.AWS:t=Rk.AWS;break;case RH.Xo.None:default:t=Rk.None}return t}getVDISubProvider(e=RH.Xo.None){let t=xk.none;if(e===RH.Xo.Windows365)t=xk.windows365;else t=xk.none;return t}async getMainWindowId(){return this.loadWindowControlsModule().then((e=>{if(e?.getWindowByTag)return e.getWindowByTag(Dt.ng.Main);throw new Error("Could not load window controls module")})).then((e=>(this.logger.log(`[getMainWindowId] Got main window ID: ${e}`),e))).catch((e=>{throw this.logger.error("[getMainWindowId] Failed to retrieve main window ID"),e}))}async getNativeWindowHandleAsHex(e){return this.logger.log(`[getNativeWindowHandleAsHex] trying to get native window handle for windowId: ${e}`),this.getNativeWindowHandle(e).then((t=>{if(t?.handle)return this.windowHandleToHex(t.handle);{const t=`Failed to retrieve native window handle for windowId: ${e}`;throw this.logger.log(`[getNativeWindowHandleAsHex] ${t}`),new Error(t)}})).then((e=>(this.logger.log(`[getNativeWindowHandleAsHex] Got native window handle as hex: ${e}`),e)))}async getNativeWindowHandle(e){return this.logger.log(`[getNativeWindowHandle] trying to get native window handle for windowId: ${e}`),this.loadOSUtilsModule().then((t=>{if(t?.getHostWindowHandle)return t.getHostWindowHandle(e).then((t=>(this.logger.log(`[getNativeWindowHandle] Got native window handle for ${e}: ${t?.handle}`),t))).catch((t=>{throw this.logger.error(`[getNativeWindowHandle] Failed to retrieve native window handle for ${e}`),t}));throw new Error("osUtils.getHostWindowHandle is not available")}))}windowHandleToHex(e){let t=e.toString(16);for(;t.length<16;)t=`0${t}`;return t.length%2!=0&&(t=`0${t}`),this.logger.log(`[windowHandleToHex] Converted native window handle ${e} to hex: ${t}`),this.convertWindowHandleHexEndianness(t)}convertWindowHandleHexEndianness(e){return e?.match(/[0-9a-f]{2}/gi)?.reverse().join("")??null}async loadVDIModule(){return void 0===this.vdiModule&&(this.vdiModule=await this.hostCommunicationService.loadModule("vdi")),this.vdiModule}getProxiedVdiModule(){return!this.proxiedVDIModule&&this.vdiModule&&(this.proxiedVDIModule=new xH("vdiModule",this.vdiModule,this.logger).getProxy()),this.proxiedVDIModule}async loadOSUtilsModule(){return void 0===this.osUtilsModule&&(this.osUtilsModule=await this.hostCommunicationService.loadModule("osutils")),this.osUtilsModule}async loadWindowControlsModule(){return void 0===this.windowControlsModule&&(this.windowControlsModule=await this.hostCommunicationService.loadModule("windowcontrols")),this.windowControlsModule}}class jH{constructor(e){this.utils=e}setSlimCoreCallingSupportService(e){this.vdiSlimCoreCallingSupportService=e}provideCallingSupportService(){return this.vdiSlimCoreCallingSupportService??void 0}}class BH{constructor(){}setVdiMediaService(e){this.service=e}provide(){return this.service}}class UH extends xp{constructor(){super(d.c1.InitVDIPlatformServiceTask,["loggerFactory","getPlatformConfigurationOverrides","windowProvider"])}async execute(e){const{loggerFactory:t,getPlatformConfigurationOverrides:n,windowProvider:i}=e,a=t.newLogger("InitVDIPlatformServiceTask","core-services-tasks");if(lt(i)&&!this.isTFL(i)){const o=KL(a),r=new OH(t,o,i),s=await r.init();if(s){const t=(e,t)=>{const i=n(e,t);if(!i.vdi){const{provider:e,mode:t,isAvRemoted:n,configFilter:a,sessionId:o,isVDI:r,vdiOptimizationMode:l,isWebRTCEnabled:c,isSlimcoreEnabled:d,utils:u,subProvider:m,isMaglevUpdateDisabled:p}=s;i.vdi={isVDI:r,mode:t,provider:e,isAvRemoted:n,configFilter:a,sessionId:o,vdiOptimizationMode:l,isWebRTCEnabled:c,isSlimcoreEnabled:d,utils:u,subProvider:m,isMaglevUpdateDisabled:p}}return i};e.getPlatformConfigurationOverrides=t,e.vdiServiceProvider=new jH(s.utils),e.vdiMediaServiceProvider=new BH}}}isTFL(e){return(e.loader?.getProperties()?.environment||$a.B.prod)===$a.B.life}}const $H={disableAnimations:!1};class WH extends xp{constructor(){super(d.c1.UpdateCoreSettingDependantClientPreferences,["coreSettings","clientPreferences"])}async execute(e){const{coreSettings:t,clientPreferences:n}=e,i=t.get(c.w.Core).disableAnimationsByDefault;void 0===n.getPreferences("animation").disableAnimations&&n.updatePreferences({animation:{disableAnimations:i??$H.disableAnimations}})}}const VH="[LocalMigratedSettingsService]",HH="localMigratedSettingsService.completedConsumers",zH=["client-preferences","device-settings","i18n"];function qH(e,t){e.errorToTelemetry?e.errorToTelemetry(`${VH} ${t}`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0):e.error(`${VH} ${t}`)}class GH{constructor(e,t){this.localStorage=e,this.logger=t}isMarked(e){return this.markedConsumers.includes(e)}areAllMarked(){return 0===this.getUnmarked().length}getUnmarked(){const e=new Set(this.markedConsumers);return zH.filter((t=>!e.has(t)))}mark(e){this.isMarked(e)||(this.markedConsumers.push(e),this.localStorage.trySet(HH,JSON.stringify(this.markedConsumers),"Settings","Experience")||qH(this.logger,"failed to save completed consumers to local storage"))}get markedConsumers(){return void 0===this.cachedMarkedConsumers&&(this.cachedMarkedConsumers=[],this.readInitialCompletedConsumers()),this.cachedMarkedConsumers}readInitialCompletedConsumers(){let e=null;try{e=this.localStorage.get(HH,"Experience")}catch{return void qH(this.logger,"failed to read initial completed consumers from local storage")}if((0,we.isNil)(e))return this.logger.log(`${VH} no previously completed consumers`),void(this.cachedMarkedConsumers=[]);try{this.cachedMarkedConsumers=JSON.parse(e)}catch{qH(this.logger,"failed to parse initial completed consumers value")}this.logger.log(`${VH} previously completed consumers: ${this.cachedMarkedConsumers?.join(", ")}`)}}const YH="tmp.localMigratedSettings",QH=1e3;class JH{constructor(e,t,n,i,a,o){this.coreSettings=e,this.scenarioFactory=a,this.timerPreviouslySet=!1,this.host=n,this.hostCommunicationService=i,this.logger=o.newLogger("LocalMigratedSettingsService","core-services-local-migrated-settings"),this.localMigratedSettings=e.get(c.w.LocalMigrated),this.completedConsumers=new GH(t,this.logger),this.scenario=a.newScenario(be.Cu.LocalSettingsMigration,{timeoutMs:9e5});const r=Object.keys(this.localMigratedSettings);this.logger.infoToTelemetry?.(`${VH} initialized migrated settings with ${r.length} keys: ${r.join(", ")}`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0);const s=function(e){if(!e.reservedMetadata)return;const t=e.reservedMetadata,n={};t.correlationId&&(n.migratedSettingsCorrelationId=t.correlationId);t.version&&(n.migratedSettingsSchemaVersion=t.version);t.reason&&(n.migrationReason=t.reason);t.created&&(n.migratedSettingsAgeSeconds=function(e){const t=new Date(e);if(isNaN(t.getTime()))return-1;const n=new Date;return Math.ceil((n.getTime()-t.getTime())/QH)}(t.created));return Object.keys(n).length>0?n:void 0}(this.localMigratedSettings);s&&this.scenario.appendEventData(s)}startTimer(){if(this.timerPreviouslySet)return void this.logger.logNoPii?.(`${VH} Will not start timer again as it was previously started.`);if(this.completedConsumers.areAllMarked())return void this.logger.logNoPii?.(`${VH} Will not start timer again as all consumers have completed.`);this.timerPreviouslySet=!0;const e=KH(this.coreSettings);this.logger.logNoPii?.(`${VH} Starting migration timer with timeout ${e}ms`),this.timer=this.host.setTimeout((()=>this.reportMigrationCompletion(!0)),e),this.scenarioFactory.changeTimeout?.(this.scenario,e+3e4)}registerConsumer(e,t){return this.nothingToMigrate(this.localMigratedSettings)||this.notifyConsumer(e,this.localMigratedSettings,t),{unregister:()=>{}}}registerOcdiConsumer(e,t){const n=this.localMigratedSettings.ocdiSettings;if(n){const i=n[e]||{};this.notifyConsumer(e,i,t)}return{unregister:()=>{}}}nothingToMigrate(e){return 0===Object.keys(e).length}async notifyConsumer(e,t,n){if(this.completedConsumers.isMarked(e))this.logger.infoToTelemetry?.(`${VH} Skipping previously migrated consumer ${e}.`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0);else{this.scenario.mark(be.BQ.LocalSettingsMigrationStepConsumerStarted,{consumer:e});try{await n(t)}catch{return qH(this.logger,`handler for ${e} failed.`),void this.scenario.mark(be.BQ.LocalSettingsMigrationStepConsumerCompleted,{consumer:e,consumerStatus:"Failed"})}this.scenario.mark(be.BQ.LocalSettingsMigrationStepConsumerCompleted,{consumer:e,consumerStatus:"Completed"}),this.completedConsumers.mark(e)}this.completedConsumers.areAllMarked()&&await this.reportMigrationCompletion()}async reportMigrationCompletion(e){const{reportLocalMigratedSettingsCompletionToDesktop:t}=this.coreSettings.get(c.w.Core,["reportLocalMigratedSettingsCompletionToDesktop"]);if(this.timer&&this.host.clearTimeout(this.timer),this.timer=void 0,e?this.logger.log(`${VH} Migration timed out. Incomplete consumers: ${this.completedConsumers.getUnmarked().join(", ")}.`):this.logger.log(`${VH} Migration completed successfully.`),this.host.localStorage.getItem(YH))try{this.host.localStorage.removeItem(YH)}catch(e){return void this.scenario.fail({reason:"FailedRemoveMigratedSettingsFromLocalStorage",incompleteConsumers:this.completedConsumers.getUnmarked()})}if(t){let e;try{e=await this.hostCommunicationService.loadModule("appswitcher")}catch{return void this.scenario.fail({reason:"FailedNoAppSwitcherModule",incompleteConsumers:this.completedConsumers.getUnmarked()})}const t=e?.completeT1LocalSettingsMigration;if(!t)return void this.scenario.fail({reason:"FailedNoCompletionApi",incompleteConsumers:this.completedConsumers.getUnmarked()});try{t()}catch(e){return void this.scenario.fail({reason:"FailedNotifyMigrationCompletion",incompleteConsumers:this.completedConsumers.getUnmarked()})}}e?this.scenario.fail({reason:"TimedOut",incompleteConsumers:this.completedConsumers.getUnmarked()}):this.scenario.stop()}}const KH=e=>{const{localMigratedSettingsConsumptionTimeoutInMs:t}=e.get(c.w.Core,["localMigratedSettingsConsumptionTimeoutInMs"]);return t??6e4};class ZH extends xp{constructor(){super(d.c1.CreateLocalMigratedSettingsServiceTask,["clientPreferences","coreSettings","hostCommunicationService","localStorage","loggerFactory","platformService","scenarioFactory","windowProvider"])}async execute(e){const{clientPreferences:t,coreSettings:n,hostCommunicationService:i,localStorage:a,loggerFactory:o,platformService:r,scenarioFactory:s,windowProvider:l}=e,d=o.newLogger("CreateLocalMigratedSettingsServiceTask","core-services-tasks"),{skip:u,reason:m}=function(e){if(function(e){const{disableLocalMigratedSettingsService:t}=e.get(c.w.Core,["disableLocalMigratedSettingsService"]);return!!t}(e))return{skip:!0,reason:"Service is disabled"};if(function(e){const t=e.get(c.w.LocalMigrated);if(!t)return!0;return 0===Object.keys(t).length}(e))return{skip:!0,reason:"Nothing to migrate"};return{skip:!1}}(n);if(u)return void d.log(`Skipping service creation. Reason: ${m}`);const p=function(e,t,n,i,a,o){return new JH(e,t,n,i,a,o)}(n,a,l,i,s,o);r.config.isOcdi?p.registerOcdiConsumer("client-preferences",(async e=>{t.updatePreferences(e),d.log(`Updating OCDI client preferences to: ${JSON.stringify(e)}`)})):function(e,t,n){e.registerConsumer("client-preferences",(async e=>{const i={};if((0,we.isNil)(e.chatDensity)||(i.density={chatDensity:XH(e.chatDensity)}),(0,we.isNil)(e.messagePreviewShown)||(i.messagePreviews={messagePreviewsSetting:ez(e.messagePreviewShown)}),(0,we.isNil)(e.performanceMode)||(i.animation={disableAnimations:tz(e.performanceMode)}),!(0,we.isNil)(e.cachedImage)){const{imageId:t,path:n,imageSrc:a}=e.cachedImage,o={imageId:t,imagePath:n,imageSrc:a,imageNeedsMigration:!0};i.backgroundEffect={lastUsedBackgroundEffect:o},i.videoEffect={lastUsedBackgroundImage:o}}0!==Object.keys(i).length?(n.log(`Updating client preferences to: ${JSON.stringify(i)}`),t.updatePreferences(i)):n.log("No client preferences to update.")}))}(p,t,d),e.localMigratedSettings=p}}const XH=e=>{switch(e){case"Comfy":default:return"comfy";case"Compact":return"compact"}},ez=e=>{switch(e){case"Default":default:return"default";case"ShowPreviews":return"showPreviews";case"HidePreviews":return"hidePreviews"}},tz=e=>"Low"===e,nz="webSettings.pendingSettingsForMigration";class iz{constructor(e,t){this.localStorage=e,this.pendingSettingsForMigration={},this.logger=t.newLogger("LocalMigratedSettingsCollectorService","core-services-local-migrated-settings-collector"),this.readPendingSettingsForMigration()}setSettingsForWebMigration(e,t){this.pendingSettingsForMigration={...this.pendingSettingsForMigration,[e]:t},this.localStorage.trySet(nz,JSON.stringify(this.pendingSettingsForMigration),"Settings","Experience")||this.logger.warnNoPii?.(`Failed to update local settings for Web migration for ${e}`)}readPendingSettingsForMigration(){try{const e=this.localStorage.get(nz,"Experience")||"{}";this.pendingSettingsForMigration=JSON.parse(e)}catch{this.logger.warnNoPii?.("Failed to get local settings for Web migration from local storage")}}}class az extends xp{constructor(){super(d.c1.CreateLocalMigratedSettingsCollectorTask,["clientPreferences","localStorage","loggerFactory","platformService"])}async execute(e){const{clientPreferences:t,localStorage:n,loggerFactory:i,platformService:a}=e;if(a.config.isOcdi)return;const o=((e,t)=>new iz(e,t))(n,i);e.localMigratedSettingsCollector=o,function(e,t){const n=t.getAllPreferences();e.setSettingsForWebMigration("client-preferences",n)}(o,t)}}class oz extends xp{constructor(){super(d.c1.CreateAuthStateConnector,["networkState","authStateProvider","coreSettings"])}async execute(e){const{networkState:t,authStateProvider:n,coreSettings:i}=e,{enableNetworkOnlineDetection:a,disableNetworkDetectionOnResume:o}=i.get(c.w.Core);!o&&a&&t.subscribeAuthStateEvent(n)}}const rz="lightExperience",sz=/\/meet\/(?!meet-now).*/g,lz=/\/l\/meetup-join\/.*/g,cz=e=>{const t=e.href.match(sz)||e.href.match(lz);return t?[new URL(t[0],e.origin),!0]:[e,!1]};var dz;!function(e){e.AUTH_NOT_OPT_IN="auth_not_opt_in",e.ANON_NOT_SELECTED="anon_not_selected"}(dz||(dz={}));class uz extends xp{constructor(){super(d.c1.CreateAnonJoinPreflightTask,["windowProvider","coreSettings","authenticationService","scenarioFactory","localStorage","loggerFactory","platformService"])}async execute(e){const t=e.windowProvider,n=e.coreSettings,i=e.authenticationService,a=e.scenarioFactory,o=e.localStorage,r=e.loggerFactory,s=e.platformService,l=r.newLogger("CreateAnonJoinPreflightTask","core-services-tasks"),d=a.findScenario(be.Cu.AnonJoinPreflightCoreTask)||a.newScenario(be.Cu.AnonJoinPreflightCoreTask),u=a.findScenario(be.Cu.ClientStart),{enableT2PreflightForAnonUser:m,enableAnonJoinPreflightCoreTask:p,enableRedirectToLightMeetingsForAnonUsers:g}=n.get(c.w.Calling,["enableT2PreflightForAnonUser","enableAnonJoinPreflightCoreTask","enableRedirectToLightMeetingsForAnonUsers"]),h=new URL(t.location.href),v="true"===o.get("isOptedIntoT2Web","Global"),y="true"===h.searchParams.get("meetingjoin");if(l.infoToTelemetry?.(`[anon-join-core-task]: isOptedInT2-${v}, enableT2PreflightForAnonUser-${m}, enableAnonJoinPreflightCoreTask-${p}`,"cmd_horizontals_web_anon_join_task",void 0,!0),!y)return d.stop({reason:"meetingjoin QSP is not true"}),void l.infoToTelemetry?.("[anon-join-core-task]:meetingjoin QSP is not true","cmd_horizontals_web_anon_join_task",void 0,!0);if(!p)return this.verifyOptInStateBeforeContinueToT2({windowProvider:t,currentUrl:h,isOptedInT2:v,scenario:d,reason:"Core task feature flag enableAnonJoinPreflightCoreTask is not enabled.",logger:l,localStorage:o,platformService:s,coreSettings:n}),void l.infoToTelemetry?.("[anon-join-core-task]:Core task feature flag enableAnonJoinPreflightCoreTask is not enabled.","cmd_horizontals_web_anon_join_task",void 0,!0);const S=new URLSearchParams(h.hash),f=S.get("deeplinkId")??void 0,k=await i.getUser();if(l.infoToTelemetry?.(`[anon-join-core-task]: user role ${k?.role}`,"cmd_horizontals_web_anon_join_task",void 0,!0),k&&k.role!==pg.a7.Anonymous)return this.verifyOptInStateBeforeContinueToT2({windowProvider:t,currentUrl:h,isOptedInT2:v,scenario:d,reason:"Auth user.",deeplinkId:f,isAuth:!0,logger:l,localStorage:o,platformService:s,coreSettings:n}),void l.infoToTelemetry?.("[anon-join-core-task]:auth user end","cmd_horizontals_web_anon_join_task",void 0,!0);const{hash:C,pathname:b,search:w}=h,T=`searchLength::${w.length}::hashLength::${C.length}::pathnameLength::${b.length}::deeplinkIdLength::${f?.length}`;if(g?k?.subType&&k.subType!==pg.as.Default?(d.mark(be.BQ.LightMeetingsRedirectIgnored,{reason:`User sub-type ${k?.subType} is not supported by LIME, ignoring LIME redirect for anon users.`}),l.log(`[anon-join-core-task]: User sub-type ${k?.subType} is not supported by LIME, ignoring LIME redirect for anon users.`)):this.redirectAnonUserToLightMeetingsIfSupported({windowProvider:t,currentUrl:h,hashSearchParams:S,isOptedInT2:v,scenario:d,reason:"User is not authenticated.",deeplinkId:f,isAuth:!1,logger:l,localStorage:o,platformService:s,coreSettings:n}):(d.mark(be.BQ.LightMeetingsRedirectIgnored,{reason:"Redirect to LIME for anon users is disabled in this browser, ignoring LIME redirect."}),l.log(`[anon-join-core-task]: Redirect to LIME for anon users is disabled in this browser (${s.config.browser}), ignoring LIME redirect.`)),m){d.stop({reason:"Anon user selected as part of T2 preflight"}),u?.appendEventData({reason:`WebAnonJoin::${T}`}),l.infoToTelemetry?.(`[anon-join-core-task]:Anon user selected as part of T2 preflight::${T}`,"cmd_horizontals_web_anon_join_task",void 0,!0);const e="skipT1WebRedirectionForAnonMeetingJoin";try{t.sessionStorage.setItem(e,"true")}catch(e){l.errorToTelemetry?.("[anon-join-core-task]:failed to set skipT1WebRedirectionForAnonMeetingJoin flag in sessionStorage","cmd_horizontals_web_anon_join_task",void 0,!0)}}else this.redirectToT1Web({windowProvider:t,currentUrl:h,isOptedInT2:v,scenario:d,reason:"Anon user not selected as part of T2 preflight",deeplinkId:f,logger:l,localStorage:o,platformService:s,coreSettings:n,redirectReason:dz.ANON_NOT_SELECTED})}verifyOptInStateBeforeContinueToT2(e){const{isOptedInT2:t,scenario:n,reason:i,logger:a}=e;if(t)return n.stop({reason:`${i} Opted into T2 web`}),void a.infoToTelemetry?.(`[anon-join-core-task]:${i} Opted into T2 web`,"cmd_horizontals_web_anon_join_task",void 0,!0);a.infoToTelemetry?.("[anon-join-core-task]:redirecting to T1 web","cmd_horizontals_web_anon_join_task",void 0,!0),this.redirectToT1Web({...e,redirectReason:dz.AUTH_NOT_OPT_IN})}redirectAnonUserToLightMeetingsIfSupported({currentUrl:e,scenario:t,deeplinkId:n,logger:i,reason:a,windowProvider:o}){if(!(e=>{const[t,n]=cz(e);if(!n)return!1;if(t.searchParams.has(rz))return!1;const i=t.searchParams.get("context");if(!i)return!0;const a=decodeURIComponent(i),o=JSON.parse(a),r=!!o.prid,s=!!o.IsBroadcastMeeting;return!r&&!s})(e))return t.mark(be.BQ.LightMeetingsRedirectIgnored,{reason:`${a}. The current URL is not supported by LIME or already contains the redirect QSP, ignoring LIME redirect.`}),void i.log(`[anon-join-core-task]:${a}. The current URL is not supported by LIME or already contains the redirect QSP, ignoring LIME redirect.`);const r=(e=>{const[t]=cz(e);return t.searchParams.set(rz,"true"),t})(e);t.appendEventData({deeplinkId:n}),t.stop({reason:`${a}. Browser supported by LIME in the current anonymous context, redirect to LIME.`}),i.log(`${a}. Browser supported by LIME in the current anonymous context, redirect to LIME.`),o.location.replace(r.href)}redirectToT1Web({windowProvider:e,currentUrl:t,scenario:n,reason:i,deeplinkId:a,isAuth:o,logger:r,localStorage:s,platformService:l,redirectReason:c}){const d=["clearcontainer","container","version","enablemcasfort21"];for(const e of d)if(t.searchParams.has(e))return n.stop({reason:`${i} URL contains noRedirectQSPs ${e}, and skipping redirect to T1 web.`}),void r.infoToTelemetry?.(`[anon-join-core-task]:${i} URL contains noRedirectQSPs ${e}, and skipping redirect to T1 web.`,"cmd_horizontals_web_anon_join_task",void 0,!0);t.pathname=o?"/":"/_",t.searchParams.delete("meetingjoin"),t.searchParams.set("clientexperience","t1"),a&&n.appendEventData({deeplinkId:a}),n.stop({reason:`${i} Redirecting to T1 web with isAuth=${o}`}),r.infoToTelemetry?.(`[anon-join-core-task]:${i} Redirecting to T1 web with isAuth=${o}`,"cmd_horizontals_web_anon_join_task",void 0,!0),s.set("redirectReason",JSON.stringify({sessionId:l.host.sessionId,reason:c}),"CMD","Global"),e.location.replace(t.href)}}class mz extends xp{constructor(){super(d.c1.UpdateI18nStorage,["coreSettings","windowProvider","localStorage","loggerFactory"])}async execute(e){const{coreSettings:t,windowProvider:n,localStorage:i,loggerFactory:a}=e;if(!(0,pO.bR)(t))return;const o=a.newLogger("UpdateI18nStorageTask","core-services-tasks");(0,pO.Fr)(n,i,o)}}var pz,gz=n(555260),hz=n(535835);class vz{constructor(e){this.store=(0,gz.y)((0,hz.eh)((()=>e)))}getSlice(e,t){return this.store.getState()[e][t]}setSlice(e,t,n){this.store.setState((i=>({...i,[e]:{...i[e],[t]:n}})))}updateSlice(e,t,n){const i=n(this.getSlice(e,t));this.setSlice(e,t,i)}subscribeToSlice(e,t,n){return this.store.subscribe((n=>n[e][t]),((e,t)=>{n(e,t)}))}removeSlice(e,t){this.store.setState((n=>{const i={...n};return delete i[e][t],i}))}}class yz extends xp{constructor(){super(d.c1.CreateStateManagementServices,[])}async execute(e){let t=e.stateManagementServices;if(!t){const e=new vz({userwindow:{},user:{},experience:{}}),n=new ra(e,"experience","experience");t={storeManager:e,experienceStore:n}}const n=e.authenticationUser;let i;return n&&(i=new ra(t.storeManager,"user",n.id),t.userStore=i),e.stateManagementServices=t,e=>{switch(e){case"signout":i?.dispose();break;case"quit":case"restart":t?.experienceStore.dispose(),i?.dispose()}}}}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(pz||(pz={}));var Sz=n(859876),fz=n(955346);const kz="DuplicateIncomingRequest",Cz="NoSubscribersForRequestedWindow",bz="ReceivedFailureResponse",wz="RequestTimedOut",Tz="l/useractivityrecall/notsupported";class Iz{constructor(e,t,n,i,a){this.hostCommunicationService=e,this.scenarioFactory=t,this.host=n,this.recallHostCommModule=void 0,this.recallRequestSubject=new Ye.B7,this.recallRequestSubscriptionTrackerByWindowId=new Map,this.pendingRecallRequests=new Map,this.logger=i.newLogger("UserActivityRecallService","core-services-user-activity-recall"),this.deeplinkDomainUrl=new URL(a.get(c.w.Host).deepLinkDomain??n.location.origin)}async initialize(){this.logger.log("Initializing UserActivityRecallService"),this.recallHostCommModule=await this.hostCommunicationService.loadModule("teamsuseractivityrecall"),this.recallHostCommModule&&this.recallHostCommModule.registerForUserActivityRequested?this.recallHostCommModule.registerForUserActivityRequested((async({requestId:e,windowId:t})=>{this.logger.log(`Received recall request for window[${t}], request[${e}]`);const n=this.scenarioFactory.newScenario(be.Cu.UserActivityRecallRequest,{clientId:e});if(n.appendEventData({"Panel.WindowID":t,requestId:e}),this.pendingRecallRequests.has(e))return this.logger.log(`${kz}: window[${t}], request[${e}]. Ignorning request.`),void n.stop({errorCode:kz},"failure");if(!this.recallRequestSubscriptionTrackerByWindowId.has(t))return this.logger.log(`${Cz}: window[${t}], request[${e}]. Returning error.`),this.pendingRecallRequests.set(e,void 0),void await this.setUserActivityResponse(t,{requestId:e,state:"Error",type:"Unknown",value:new URL(Tz,this.deeplinkDomainUrl).href,errorCode:Cz});const i=this.host.setTimeout((()=>{this.pendingRecallRequests.has(e)&&(this.logger.error(`Recall request timed out: window[${t}], request[${e}]`),this.setUserActivityResponse(t,{requestId:e,state:"Error",type:"Unknown",value:new URL(Tz,this.deeplinkDomainUrl).href,errorCode:wz}))}),5e3);this.pendingRecallRequests.set(e,{timeoutHandle:i}),this.logger.log(`Emitting recall request: window[${t}], request[${e}]`),this.recallRequestSubject.next({windowId:t,requestId:e})})):this.logger.error("Failed to load recall module or registerForUserActivityRequested is not available")}observeUserActivityRequest(e){return(0,Sz.v)((()=>(this.logger.log(`Subscribing to recall request for window ${e}`),this.recallRequestSubscriptionTrackerByWindowId.set(e,(this.recallRequestSubscriptionTrackerByWindowId.get(e)??0)+1),this.recallRequestSubject.pipe((0,di.p)((t=>t.windowId===e)),(0,o.T)((t=>({requestId:t.requestId,windowId:e}))))))).pipe((0,fz.j)((()=>{this.logger.log(`Unsubscribed from recall request for ${e}`);const t=this.recallRequestSubscriptionTrackerByWindowId.get(e)??0;t>1?this.recallRequestSubscriptionTrackerByWindowId.set(e,t-1):this.recallRequestSubscriptionTrackerByWindowId.delete(e)})))}async setUserActivityResponse(e,t){if(this.logger.log(`Received response: window[${e}], request[${t.requestId}]: ${JSON.stringify(t)}`),!this.pendingRecallRequests.has(t.requestId))return this.logger.error(`Received response for no pending request: window[${e}], request[${t.requestId}]: ${JSON.stringify(t)}`),!1;if(!this.recallHostCommModule?.setUserActivity)return this.logger.error(`setRecallableUserActivity is not available. Ignoring response: window[${e}], request[${t.requestId}]`),!1;const n=this.scenarioFactory.findScenarioByNameAndId(be.Cu.UserActivityRecallRequest,t.requestId),i=this.pendingRecallRequests.get(t.requestId)?.timeoutHandle;return void 0!==i&&this.host.clearTimeout(i),this.pendingRecallRequests.delete(t.requestId),await(this.recallHostCommModule?.setUserActivity?.({requestId:t.requestId,state:"Success"===t.state?pz.Success:pz.Error,deeplink:t.value},e)),"Success"===t.state?n?.stop():n?.fail({errorCode:t.errorCode??bz}),!0}}class Nz extends xp{constructor(){super(d.c1.CreateUserActivityRecallServiceTask,["coreSettings","windowProvider","hostCommunicationService","loggerFactory","scenarioFactory"])}async execute(e){const{coreSettings:t,hostCommunicationService:n,windowProvider:i,loggerFactory:a,scenarioFactory:o}=e,{enableUserActivityRecall:r}=t.get(c.w.Core);r&&(e.userActivityRecallService=new Iz(n,o,i,a,t))}}class Az extends xp{constructor(){super(d.c1.OCDIRedirectTask,["authenticationUser","coreSettings","localStorage","loggerFactory","scenarioFactory","windowProvider"])}async execute(e){const{authenticationUser:t,coreSettings:n,localStorage:i,loggerFactory:a,scenarioFactory:o,windowProvider:r}=e,s=a.newLogger("OCDIRedirectTask","core-services-tasks"),{enableOCDIRedirects:l,ocdiNoRedirectQSPs:d}=n.get(c.w.Core);if(!l)return void s.logNoPii?.("Redirects are disabled");const u=o.newScenario(be.Cu.OCDIRedirect);try{const e=new URL(r.location.href);u.appendEventData({currentUrl:e.origin+e.pathname});const a=d||[];for(const t of a)if(e.searchParams.has(t))return s.warnNoPii?.(`Redirect abandoned - URL contains a no-redirect QSP, '${t}'.`),void u.cancel({reason:"URL contains a no-redirect QSP",noRedirectQSP:t});const{assignedUrl:o,forced:l,error:c}=this.determineAssignedDomain(n);if(u.appendEventData({assignedUrl:o?.href,forcedRedirect:l}),c)return void u.fail({reason:c});if(!o)return void u.cancel({reason:"Did not determine an assigned domain."});if(o.hostname===e.hostname&&o.pathname===e.pathname)return s.logNoPii?.("Redirect abandoned - Already on assigned domain"),void u.cancel({reason:"Already on assigned domain."});u.stop(),this.setServerRedirectCookie(s,r,n,o),this.redirectToAssignedDomain(s,r,i,t,e,o)}catch{s.error("Redirect failed - Error during OCDI Redirect"),u.fail({reason:"Error during OCDI Redirect"})}}determineAssignedDomain(e){const{forceRedirectToOCDI:t,forceRedirectToTMC:n,ocdiRootUri:i,tmcRootUri:a}=e.get(c.w.Core);if(t){if(!i)return{error:"'ocdiRootUri' not provided in config."};try{return{assignedUrl:new URL(i),forced:!0}}catch(e){return{error:"'ocdiRootUri' is not a valid URL."}}}if(n){if(!a)return{error:"'tmcRootUri' not provided in config."};try{return{assignedUrl:new URL(a),forced:!0}}catch(e){return{error:"'tmcRootUri' is not a valid URL."}}}return{forced:!1}}setServerRedirectCookie(e,t,n,i){const{enableOCDIRedirectCookie:a,ocdiRedirectCookieName:o,ocdiRedirectCookieExpirationInDays:r,ocdiRedirectCookieAdditionalOptions:s}=n.get(c.w.Core);if(!a)return void e.logNoPii?.("OCDI Redirect Cookie is disabled - skipping setting.");if(void 0===t.document?.cookie)return void e.warnNoPii?.("Window is missing cookie API - Cannot set OCDI Redirect cookie.");const l={assignedUrl:i.href},d=o||"ocdiRedirect",u=r||150,m=s||";path=/;secure;samesite=none;partitioned",p=new Date;p.setDate(p.getDate()+u);const g=`${d}=${encodeURIComponent((0,ge.hR)(l))};expires=${p.toUTCString()}${m}`;e.logNoPii?.(`Setting '${d}' cookie.`),t.document.cookie=g}redirectToAssignedDomain(e,t,n,i,a,o){a.hostname=o.hostname,a.pathname=o.pathname;const r=n.get(nz,"Experience");if(r){const e=encodeURIComponent(r),t=new URLSearchParams(a.hash.substr(1));t.append("migratedSettings",e),a.hash=`#${t.toString()}`}i.loginUserName&&a.searchParams.set("loginHint",i.loginUserName),a.searchParams.set("ocdiRedirect","true"),e.log(`Redirecting to assigned domain: ${a.href}`),t.location.replace(a.href)}}class Ez extends xp{constructor(){super(d.c1.EmbedExitEarlyIfPreAuthOnlyTask,["config","hostCommunicationService","scenarioFactory","loggerFactory","windowProvider"])}async execute(e){const{config:t,hostCommunicationService:n,scenarioFactory:i,loggerFactory:a,windowProvider:o}=e;if(!t.preInitAuth)return Promise.resolve();const r=i.newScenario(be.Cu.EmbedPreAuth,{startTime:t.preInitAuthStartTime}),s=i.findScenario(be.Cu.ExperienceReady);s?.cancel();const l=(0,E.v4)();o.localStorage.setItem("embed-pre-auth-correlation-id",l),o.localStorage.setItem("embed-pre-auth-timestamp",Date.now().toString()),r.appendEventData({secondaryCorrelationId:l});const c=await n.loadModule("core"),d=await(0,Pt.AR)();return new Promise((e=>{if(!c||!c.registerForOnContinueWithTeamsCoreTasks||!c.signalPreAuthComplete){const e="Failed to load coreModule in EmbedExitEarlyIfPreAuthOnlyTask to signal preauth complete.";throw r.stop({message:e}),new Error(e)}c.registerForOnContinueWithTeamsCoreTasks((({reason:t})=>{a.newLogger("EmbedExitEarlyIfPreAuthOnlyTask","core-services-tasks").log(`Continue with core tasks because: ${t}`),e()})),r.stop();const t=o.setTimeout((()=>{d.flush(!0).finally((()=>{c?.signalPreAuthComplete?.()})),o.clearTimeout(t)}),1e3)}))}}class Fz extends xp{constructor(){super(d.c1.Polyfills,[])}async execute(){this.applyAsyncIteratorPolyfillIfNeeded()}applyAsyncIteratorPolyfillIfNeeded(){void 0===Symbol.asyncIterator&&(Symbol.asyncIterator=Symbol.asyncIterator||n(309887).$$asyncIterator)}}class _z{constructor(e,t,n,i,a,o,r,s,l,c,d,u){this._loggerFactory=e,this._appsRegistryService=t,this._config=n,this._configLoader=i,this._coreTasks=o,this._diagnosticsService=r,this._logsCollectorService=s,this._waitForRenderingContextReady=l,this._isEntityInView=c,this._criticalDynamicImports=d,this._getPlatformConfigurationOverrides=u,this._maxPerfMarkNameLength=150,this._logger=e.newLogger("TaskManagerService","core-services-activator"),this._appsRegistryService=t,this._taskContext=this.createNewContext(a)}async notifyLifeCycleEvent(e,t={},n){const i=this.extractApplicableTasks(this._appsRegistryService.registeredTasks,e),a=`notify::starting - lifeCycleEvent=${e}, taskCount=${i.length}`;this._logger.log(a);const o={...this._taskContext,...t};this.markCoreLifeCycleEventStart(o,e);const r={},s=performance?.timing?.navigationStart,l=new Map,c=[];let u=0;for(const t of i){const i=performance?.now?.(),a=e=>{const n=`notify:: Task Execute Error - taskId ${d.c1[t.id]}, code=${e.code} errorMsg=${(0,Je.BA)(e?.prevError||e)}.`;this._logger.errorToTelemetry?.(n,"webclient_framework_foundation_core_init",void 0,!0),l.set(t.id,e)},m=()=>t instanceof xp?t.executeSafe(o,r):t.execute(o,r),p=e=>e?(0,yi.a)(m(),e,`${d.c1[t.id]} timed out.`):m(),g=await p(this._config.coreTasksTimeoutMs).catch(a);g&&c.push({taskId:t.id,cleanupFn:g}),this.markCoreLifeCycleTaskCompleted(o,e,t,l,i,s,++u,n)}return this.logErrorSummary(e,l),this._logger.log(`notify::tasks complete - lifeCycleEvent=${e}, taskCount=${i.length}`),{context:{...r,...o},coreTaskErrors:Array.from(l.values()),cleanupFns:c}}async destroyContext(e,t){const n=e.cleanupFns.length;let i,a=0;for(;i=e.cleanupFns.pop();)try{await i.cleanupFn(t),a++}catch(e){this._logger.error(`Cleanup failed for task: ${d.c1[i.taskId]}`)}this._logger.log(`destroyContext complete: ${a}/${n} tasks succeeded.`)}hasTasks(e){return this.extractApplicableTasks(this._appsRegistryService.registeredTasks,e).length>0}markCoreLifeCycleEventStart(e,t){const n=e.altScenarioService?.altScenario,i=e.altScenarioService?.clientStartScenario,a=`${Ia}${t}`;n||i?(n&&n.mark(a),i&&i.mark(a)):performance?.mark?.(a)}markCoreLifeCycleTaskCompleted(e,t,n,i,a,o,r,s){const l=e.altScenarioService?.altScenario,c=e.altScenarioService?.clientStartScenario,u=i.get(n.id),m=vo(u).errorCode,p=`${t}_${d.c1[n.id]}`;l||c?(l&&l.mark(`core_task_${p}`,u?{errorCode:m}:void 0),c&&c.mark(`core_task_${p}`,u?{errorCode:m}:void 0)):(performance?.mark?.(`${Na}${p}`),u&&performance?.mark?.(`pre_core_error_${p}:reason:${m}`.substring(0,this._maxPerfMarkNameLength))),this.addTaskDetailsToLocalStorage(u||{},a,o,p,r,e),s?.(n.id,u)}addTaskDetailsToLocalStorage(e,t,n,i,a,o){try{const{windowProvider:r,config:s}=o;s.shouldTrackCoreInitTasks&&r?.localStorage.setItem(i,(0,ge.hR)({index:a,startTime:new Date(n+t).toISOString(),duration:performance?.now?.()-t,error:e}))}catch(e){e.code===DOMException.QUOTA_EXCEEDED_ERR?this._logger.error("Error: Quota exceeded while writing core task details to local storage."):this._logger.warn(`Couldn't write core init task details to local storage: ${(0,Je.BA)(e)}`)}}createNewContext(e){return{correlation:e,diagnosticsService:this._diagnosticsService,logsCollectorService:this._logsCollectorService,loggerFactory:this._loggerFactory,appsRegistryService:this._appsRegistryService,config:this._config,configLoader:this._configLoader,waitForRenderingContextReady:this._waitForRenderingContextReady,isEntityInView:this._isEntityInView,criticalDynamicImports:this._criticalDynamicImports,getPlatformConfigurationOverrides:this._getPlatformConfigurationOverrides}}extractApplicableTasks(e,t){const n=[];if(e){const i=e.filter((e=>!e.lifeCycleSubscriptions&&t===d.dy.Initialization||e.lifeCycleSubscriptions&&-1!==e.lifeCycleSubscriptions.indexOf(t)));n.push(...i)}return(this._coreTasks[t]?.()||[]).concat(n)}logErrorSummary(e,t){if(t.size>0){const n=(0,Je.$5)("TaskManagerService",d.O4.NotInitialized,`lifeCycleEvent=${e}`,{failedTaskErrors:t});this._logger.error(`Failed ${t.size} core tasks: ${Array.from(t.keys()).map((e=>d.c1[e])).join()}, lifeCycleEvent=${e}: `,n)}}}class Dz{constructor(e,t){this._taskManagerService=e,this._logger=t.newLogger("FullCoreContextFactory","core-services-activator")}createContext(e={}){const{authenticationUser:t,defaultCoreSettings:n,defaultRenderingContext:i,isMTMAEnabled:a,isPrimaryUser:o}=e;if(!t)return this._taskManagerService.notifyLifeCycleEvent(d.dy.Initialization);if(o)return this._taskManagerService.notifyLifeCycleEvent(d.dy.OnPrimaryUser,{...i?.context,primaryUser:t,authenticationUser:t});const r=a?d.dy.OnUserAuthenticated_MTMA:d.dy.OnUserAuthenticated,s=(0,kt.Lw)(t);return!!n?.get(c.w.Core)?.enableExperienceLifeCycleSignalsLogging&&this._logger.infoToTelemetry?.("starting OnUserAuthenticated tasks","webclient_framework_foundation_core_services_life_cycle_signals",{userId:s}),this._taskManagerService.notifyLifeCycleEvent(r,{...i?.context,authenticationUser:t},((e,t)=>i?.context.windowProvider.performance&&function(e,t,n,i,a){const o=a?vo(a):void 0;n.mark(yo(i,t),{detail:{taskId:d.c1[e],errorCode:o?.errorCode}})}(e,s,i?.context.windowProvider.performance,d.dy[r],t)))}destroyContext(e){const{context:t,reason:n}=e;return this._taskManagerService.destroyContext(t,n)}}const Pz=function(){const e=()=>null;return{...rp,manifest:jr,render:async()=>(0,Lr.Y)(e,{})}}(),Mz=e=>{const{getOrCreateRenderingContextForId:t,contextSubject:n,isEntityInView:i,coreOptions:a,loggerFactory:o,window:r,loaderProperties:s,diagnosticsService:l}=e,{apps:c,config:d,criticalDynamicImports:u,loadConfigs:m,getPlatformConfigurationOverrides:p}=a,g=new Mp(o,d,Pz,c),h=new Rp(o);let v;s&&s.isMaglev&&(v=s.preCoreHostCommunication);const y=new lp.U(o,h,void 0,v);r.addEventListener("downloadLogs",(async()=>{await y.downloadLogsFiles(r)})),h.registerCoreLogsProvider(l);const S=r?.loader?.getLogsProvider?.();S&&h.registerCoreLogsProvider(S),s&&s.isMaglev&&s.preCoreHostCommunication&&(async(e,t,n)=>{const i=await t.loadModule("logscollection");i&&i.registerForRequestWebLogsDownload?.((t=>{const i=!t.webLogsId;n.downloadLogsFiles(e,i,t.webLogsId)}))})(r,s.preCoreHostCommunication,y);const f=d.useReactWebClientCoreTasks?{Initialization:()=>[new OS,new zB,new F$,new UH,new xB,new MB,new CB,new Tx,new WS,new cC,new WH,new aH,new Of,new nO,new uW,new Ix,new kO,new lW,new eH,new Lp,new YL,new vO,new BB,new VB,new gL,new Sv,new ih,new lH,new cW,new MH,new CC,new EB,new P$,new _B,new ZH,new az,new HL,new jL,new rv,new uz,new $$,new Nx,new qL,new yv,new dW,new kx,new LS,new PS,new eS,new D$,new Af,new aO,new oH,new vB,new Nz,new fR,new YB,new yz,new HS,new VS,new yL,new mC,new Sx,new vL,new Ef,new RL,new pC,new Q$,new q$,new LL,new Qj,new rH,new hH,new fv,new NB,new fO,new SO,new bH,new rW],OnPrimaryUser:()=>[new mH,new uH,new jU,new dH,new fW,new J$,new Az,new sH,new A$],OnUserAuthenticated:()=>[new mH,new jU,new Vh,new B$,new uv,new aB,new bv,new kH,new yH,new mz,new tS,new vW,new x$,new gg,new OB,new gH,new _$,new SW,new Ef,new kg,new iH,new rh,new M$,new aW,new vH,new fH],OnUserAuthenticated_MTMA:()=>[new mH,new BU,new jU,new aB,new dC,new Vh,new oz,new qL,new yv,new gL,new uv,new SH,new kH,new mz,new _$,new SW,new bv,new DS,new rh,new aW,new QB,new YB,new HS,new yz,new VS,new yL,new mC,new vL,new Ef,new B$,new tS,new vW,new x$,new gg,new OB,new gH,new kg,new iH,new M$,new vH,new fH]}:{Initialization:()=>[new Fz,new OS,new zB,new F$,new xB,new MB,new CB,new Tx,new WS,new cC,new MH,new aH,new Of,new nO,new Ix,new kO,new eH,new vO,new BB,new gL,new Sv,new ih,new EB,new HL,new jL,new rv,new Ez,new $$,new Nx,new qL,new yv,new dW,new kx,new LS,new PS,new eS,new Af,new aO,new vB,new fR,new YB,new yz,new HS,new VS,new yL,new Sx,new vL,new pC,new Qj,new RL,new fv,new NB,new fO,new rW],OnUserAuthenticated:()=>[new mH,new jU,new dH,new fW,new _$,new SW,new Vh,new B$,new aB,new bv,new yH,new tS,new vW,new x$,new gH,new iH,new fH]},k=new _z(o,g,d,m,function(e){const t=F({externalId:e,source:A.p.ExternalCommand});return t.id=`Core-${t.id}`,t}(d.externalCorrelationId),f,l,h,((e,i,a)=>(async(e,t,n,i,a,o)=>Ar(o,i)?n(t):a.pipe((0,di.p)((t=>!e||!!t.authenticationUser?.isAuthenticated)),(0,Ca.$)()).toPromise())(e,i,t,a,n,d)),i,u,p);return{contextFactory:new Dz(k,o),coreServicesManager:k}},Rz=async e=>{const{authUser:t,renderingContextManager:n}=e;return await(async e=>{const{coreServicesManagerService:t,coreServices:n,renderingContextManager:i,setCoreServices:a}=e,{primaryUserTasksPromiseWrapper:o}=e;if(!t||!t.hasTasks(d.dy.OnPrimaryUser))return;if(n?.primaryUser)return;if(o.primaryUserTasksPromise)return o.primaryUserTasksPromise;const r=n?.authenticationService,s=await(r?.getCachedUsers?.({...F({source:A.p.Core}),scenarioName:be.Cu.AuthWebCachedUser},{isPrimaryUser:!0,isAuthenticated:!0})),l=s?.filter((e=>!0===e.isAuthenticated))?.[0];return l&&!o.primaryUserTasksPromise&&(o.primaryUserTasksPromise=i.executePrimaryUserTasks((0,kt.aj)(l)).then((e=>{a(e)}))),o.primaryUserTasksPromise})(e),n.getOrCreateUserRenderingContext(t)};var xz=n(809391);const Lz={auth:{enableRedirectToSignIn:[{viewportContext:["iFrame"],value:!1}],enableAuthenticateOrGetUser:[{viewportContext:["iFrame"],value:!1}],enableLoginFlow:[{viewportContext:["primary"],value:!0}],enableSISUOnMiniMode:[{viewportContext:["flyout"],value:!1}]},calendar:{disableCalendarOptimisticClosingForm:[{viewportContext:["secondary"],value:!0}],enableCalendarBIMSpecificOperations:[{viewportContext:["primary"],value:!0}],enableCalendarBlockingDiscardConfirmationDialog:[{viewportContext:["flyout","minimode","primary","secondary"],value:!1}],enableSFCloseRouteToCalendarSurface:[{viewportContext:["secondary"],value:!1}]},calling:{isCallingScreenInteractive:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],isCallingAlertDismissEnabled:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],enableRosterButtonInUbar:[{entityType:["meetingroomconsolecall"],value:!1}],ubarLayoutPresets:[{entityType:["meetingroomallinone","meetingroomallinonecall","meetingroomconsolecall"],value:[{groups:[{name:"start",items:[{name:"MeetingRoomViewModeButton",layout:"indicators",isCritical:!0,isDocked:!0},{name:"ViewModeButton",layout:"indicators",isDocked:!0,isCritical:!0,groups:[{name:"grid",items:[{name:"GridButton",layout:"overflow",isCritical:!0},{name:"AudienceButton",layout:"overflow",isGreenRoomDisabled:!0,isE2EEHidden:!0},{name:"LargeGridButton",layout:"overflow",isGreenRoomDisabled:!0,isE2EEHidden:!0},{name:"FrontRowButton",layout:"overflow"},{name:"FocusModeButton",layout:"overflow"}]},{name:"meetingRoomContent",items:[{name:"ContentAndPeopleButton",layout:"overflow"},{name:"ContentOnlyButton",layout:"overflow"},{name:"PeopleOnlyButton",layout:"overflow"},{name:"SwapScreensButton",layout:"overflow"}]},{name:"screen",items:[{name:"GalleryViewSizeButton",layout:"overflow"},{name:"PrioritizeVideoButton",layout:"overflow"},{name:"ChangeSceneButton",layout:"overflow"},{name:"AssignSeatsButton",layout:"overflow"},{name:"ViewModeMoreOptionsMenuControl",props:{buttonLabel:"calling_ubar_view_mode_more_options_menu_button_label",title:"calling_ubar_view_mode_more_options_menu_title",tooltip:"calling_ubar_view_mode_more_options_menu_tooltip"},groups:[{name:"ViewMenuMoreOptionsMenu",items:[{name:"NarrowModeButton",layout:"overflow"},{name:"ToggleHideMyselfButton",layout:"overflow"},{name:"ToggleMyselfInGridButton",layout:"overflow"},{name:"ByodExtendToRoomDisplayButton",layout:"overflow"},{name:"FullScreenButton",layout:"horizontal"}]}]}]}]}]},{name:"indicators",items:[{name:"E2EEncryptionIndicator",layout:"indicators"},{name:"CallHealthIndicator",layout:"indicators"},{name:"BroadcastStateIndicator",layout:"indicators"},{name:"RecordingIndicator",layout:"indicators",isE2EEHidden:!0},{name:"LockMeetingIndicator",layout:"indicators"},{name:"CallDurationIndicator",layout:"indicators",isStagingRoom:!0},{name:"VirtualEventsLiveIndicator",layout:"indicators"}]},{name:"secondary",items:[{name:"ResumeButton",layout:"horizontal",template:"button",width:160,isOnHold:!0},{name:"RosterButton",layout:"horizontal",isCritical:!0},{name:"ChatButton",layout:"horizontal",isCritical:!0,isStagingRoom:!0,isOnHold:!0},{name:"RaiseHandsButton",layout:"horizontal",isCritical:!0,isDocked:!0},{name:"ReactionButton",layout:"horizontal",isCritical:!0,isDocked:!0},{name:"MoreButton",layout:"horizontal",isCritical:!0,isDocked:!0,isStagingRoom:!0,isOnHold:!0,groups:[{name:"settings",items:[{name:"MeetingInfoButton",layout:"overflow",isStagingRoom:!0},{name:"ClosedCaptionsButton",layout:"overflow",isE2EEHidden:!0},{name:"MeetingRoomCaptionsSettingsButton",layout:"overflow",isE2EEHidden:!0},{name:"MeetingRoomContentCameraEnhancementButton",layout:"overflow"},{name:"MeetingRoomOEMControlButton",layout:"overflow"},{name:"MeetingRoomToggleSpeakerAttributionButton",layout:"overflow"}]},{name:"roomSystemOverflow",items:[{name:"RecordingButton",layout:"overflow"},{name:"DialpadButton",layout:"overflow"},{name:"ChatBubblesButton",layout:"overflow"},{name:"IncomingVideoButton",layout:"overflow"},{name:"StopSpotlightButton",layout:"horizontal"},{name:"HoldButton",layout:"overflow"},{name:"MeetingRoomRemoteControllerButton",layout:"overflow"},{name:"MeetingRoomAudioSettingsButton",layout:"overflow"},{name:"ReportProblemButton",layout:"overflow"}]}]},{name:"VolumeControlButton",layout:"horizontal",isDocked:!0},{name:"VideoButton",layout:"horizontal",isCritical:!0,isDocked:!0,isStagingRoom:!0,isImmersiveViewDisabled:!0,width:65},{name:"MicrophoneButton",layout:"horizontal",isCritical:!0,isDocked:!0,isStagingRoom:!0,isOnHold:!0,width:65},{name:"MeetingRoomShareButton",layout:"horizontal",isDocked:!0},{name:"StagingRoomStartMeetingButton",layout:"horizontalEnd",template:"button",width:250},{name:"CallButton",layout:"horizontalEnd",isCritical:!0,isStagingRoom:!0,isOnHold:!0,isLobbyEnabled:!0}]}]}]}],enableVideoPreviewPopup:[{entityType:["callsmonitor","presentertoolbar"],value:!1}],enableExternalCallMonitor:[{entityType:["callscontent","callsgallery","callsgalleryandcontent","meetingroomconsolecall","meetingroomallinonecall","meetingroomallinone"],value:!1}],enableModernCallMonitor:[{entityType:["callscontent","callsgallery","callsgalleryandcontent","meetingroomconsolecall","meetingroomallinonecall","meetingroomallinone"],value:!1}],allowMultipleCallingAlertBanners:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],allowPinningParticipantFromOutside:[{entityType:["callsgallery","callsgalleryandcontent"],value:!0}],allowGalleryToggleFromOutside:[{entityType:["callsgallery","callsgalleryandcontent"],value:!0}],forceDisableTitleBar:[{entityType:["callsmonitor"],value:!0}],isCallingAlertActionEnabled:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],isContentSharingShownOnCallingScreen:[{entityType:["callsgallery"],value:!1}],isContentOnlyCallingScreen:[{entityType:["callscontent","stagecontent"],value:!0}],isLayoutSwitcherSupported:[{entityType:["callsgalleryandcontent"],value:!0}],showAllCallingAlertsAsBanner:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!0}],isContentCameraSharingSupported:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!0}],isIncomingCallScreenSupported:[{entityType:["callsgallery","callsgalleryandcontent"],value:!0}],shouldShowCallingEndScreen:[{entityType:["callscontent","callsgallery","callsgalleryandcontent","meetingroomallinonecall","meetingroomallinone"],value:!1}],enableCallCloseHook:[{entityType:["callsmonitor","stagecontent","byodattendeewindow"],value:!1}],enableAVFramework:[{entityType:["callsmonitor","presentertoolbar"],value:!1}],isNonInteractiveMeetingChat:[{entityType:["byodattendeewindow"],value:!0}],enableUbarNonCriticalPhaseDelayedLoad:[{entityType:["presentertoolbar"],value:!1}],enableHideMyselfV2:[{entityType:["callsmonitor"],value:!1}],disableCoachmarksInUbar:[{entityType:["meetingroomconsolecall","callsmonitor"],value:!0}],enableEspCoachmarksInUbar:[{entityType:["meetingroomconsolecall","callsmonitor"],value:!1}],enableMeTileOverlayForOneOnOneInMVS:[{entityType:["callsmonitor"],value:!1}],isBYODAttendeeWindow:[{entityType:["byodattendeewindow"],value:!0}],enableAgentMonitorSessionMenuBar:[{entityType:["callsmonitor"],value:!0}],isTranscriptButtonClickInMainWindow:[{viewportContext:["primary","iFrame"],value:!0}]},core:{isHeaderDisabled:[{viewportContext:["iFrame"],value:!0}],isMinimodeWindow:[{viewportContext:["minimode"],value:!0}],isPrimaryWindow:[{viewportContext:["primary"],value:!0}],isSecondaryWindow:[{viewportContext:["secondary"],value:!0}],enableFluentTabs:[{viewportContext:["secondary"],value:!1}],enableSearchBoxInMainWindow:[{viewportContext:["primary"],value:!0}],enableNavControlInMainWindow:[{viewportContext:["primary"],value:!0}],enableMainWindowTitleBarStyles:[{viewportContext:["primary"],value:!0}],enableTitleTextInChildWindow:[{viewportContext:["secondary"],value:!0}],enableTransparentTitleBar:[{entityType:["calls","callingdeeplink","cast"],value:!1}],enableAppSwitcher:[{viewportContext:["secondary"],value:!1}],adjustSpacingBetweenChatHeaderButtons:[{viewportContext:["secondary"],value:!1}],isBorderDisabled:[{viewportContext:["primary"],value:!0}],enableThickFlyoutBorder:[{viewportContext:["flyout","minimode"],value:!0}],enableNovaMeControlAvatarSrcContext:[{viewportContext:["primary"],value:!0}],enableLonglivedSubscriptionForChannelsAppViewportSetting:[{viewportContext:["primary"],value:!0}],shouldSetBodyTransparent:[{viewportContext:["secondary","flyout","minimode"],value:!0}],enableWaffle:[{viewportContext:["secondary"],value:!1}],isMainWindowAppTitleEnabled:[{viewportContext:["primary"],value:!0}],shouldClearLocalStorageOnMainWindowError:[{viewportContext:["primary"],value:!0}]},people:{avatarDoubleClickDelayInMs:[{viewportContext:["flyout","minimode"],value:0}]},activity:{enableMTMANotificationBellInMainWindow:[{viewportContext:["primary"],value:!0}]},channels:{enableOnlyInMainWindowNotPopouts:[{viewportContext:["iFrame","primary"],value:!0}],showCloseButtonInChannelsRepliesPane:[{viewportContext:["iFrame","primary"],value:!0}],allowPostPopout:[{viewportContext:["iFrame","primary"],value:!0}],enableTabsInChannels:[{viewportContext:["secondary"],value:!1}]},chatList:{enableBlockContact:[{viewportContext:["minimode"],value:!0}]},compose:{enableEditorCiqAddOn:[{viewportContext:["flyout"],value:!1}]},extensibility:{enableAtGetBots:[{entityType:["email"],value:!1}],enableSTTV9Controls:[{entityType:["email"],value:!1}],openChatInNewWindowForSTT:[{viewportContext:["secondary"],value:!0},{entityType:["email"],value:!0}]},files:{showPreferenceDialog:[{viewportContext:["primary"],value:!0}],enablePopups:[{viewportContext:["primary"],value:!0}],loadItemsViewStringsFromHost:[{viewportContext:["primary"],value:!0}]},meetingRecap:{isRecapInPopout:[{viewportContext:["flyout","minimode","secondary"],value:!0}],set1pAudioErrorFallbackDelayInMs:[{viewportContext:["primary"],value:-1}]},messaging:{enableSaveNewChatDraftOnMainWindow:[{viewportContext:["primary"],value:!0}],enableDisableAutoScrollForHighActivityMeetings:[{viewportContext:["iFrame","primary"],value:!1}],fluidIsRenderingInPopout:[{viewportContext:["primary","secondary"],value:!0}],enableChatHeaderMeetingDetailsButton:[{viewportContext:["primary"],value:!0}],enableInlineVideoMessageDownload:[{viewportContext:["flyout","minimode"],value:!1}],disableInlineVideoMessageFullscreen:[{viewportContext:["flyout","minimode"],value:!0}],inlineVideoIsRenderingInPopout:[{viewportContext:["secondary"],value:!0}],recorderIsRenderingInPopout:[{viewportContext:["secondary"],value:!0}],showSingeMessageView:[{viewportContext:["primary"],value:!0}],showContextualSearchPrompt:[{viewportContext:["primary"],value:!0}],enableComposeCriticalPhaseLoadSecondaryViewport:[{viewportContext:["secondary"],value:!0}],enableComposeDebouncedDraftSyncSecondaryViewport:[{viewportContext:["secondary"],build:">=22011801900",value:!0}],entityCommandingTransitionForceFlush:[{viewportContext:["primary"],value:!0}],enableChatPopoutInContextMenu:[{viewportContext:["secondary"],value:!1}],disableAutoFocusOnCompose:[{viewportContext:["primary"],value:!0}]},chat:{disableChatPaneLoader:[{viewportContext:["primary"],value:!0}],chatSwitchInPopOut:[{viewportContext:["secondary"],value:!0}]},shortcuts:{shortcutsForPopout:[{viewportContext:["secondary"],value:!0}]},broadcast:{isRenderingInEmbedMode:[{viewportContext:["iFrame"],value:!0},{viewportContext:["primary"],value:!1}]},byod:{isBYODAttendeeWindow:[{entityType:["byodattendeewindow"],value:!0}]},ufd:{maxUnstackedPermanentDialogs:[{entityType:["meetingroomconsolecall"],value:4}],overrideUfdSyncSeverities:[{entityType:["meetingroomconsolecall"],value:["Critical"]}]},flyout:{enableLoadFlyoutChatBundleInL1:[{viewportContext:["flyout","minimode"],value:!0}],enableFlyoutV2WhenZoomed:[{viewportContext:["minimode"],value:!0}],isMinimodeChat:[{viewportContext:["minimode"],value:!0}],isFlyoutChat:[{viewportContext:["flyout","minimode"],value:!0}],showChatHeaderInFlyout:[{viewportContext:["flyout","minimode"],value:!0}],hideTabsInChatFlyout:[{viewportContext:["flyout","minimode"],value:!0}],enableSimplifiedFeaturesInFlyoutChat:[{viewportContext:["flyout","minimode"],value:!0}],useSimplePickerInChatFlyout:[{viewportContext:["flyout","minimode"],value:!0}],flyoutV2WebcamPreviewFooterButtonsConfig:[{viewportContext:["minimode"],value:["MeetNow","NewChat","People"]}],enablePeopleExperience:[{viewportContext:["minimode"],value:!0}],enableFrequentlyUsedContactsInChatFlyout:[{viewportContext:["minimode"],value:!0}],enableMeetNowUxUpdate:[{viewportContext:["minimode"],value:!0}],enablePrimaryActionUxUpdate:[{viewportContext:["minimode"],value:!0}],enableForYouSection:[{viewportContext:["minimode"],value:!0}],enableAcrylicEffect:[{viewportContext:["minimode"],value:!0}]},mercuryDesign:{enableMercuryDesign:[{viewportContext:["flyout","minimode"],value:!1}],enableMercuryThemeClass:[{viewportContext:["secondary","iFrame","flyout","minimode"],value:!1}],enableSimpleShell:[{viewportContext:["secondary","iFrame","flyout","minimode"],value:!1}],enableMercuryShell2_5:[{viewportContext:["secondary","iFrame","flyout","minimode"],value:!1}],forceBackdropEffectStateEnabled:[{viewportContext:["secondary","iFrame","flyout","minimode"],value:!1}],enableMercuryShellGradient:[{viewportContext:["secondary","iFrame","flyout","minimode"],value:!1}]}},Oz={auth:{enableModalCoachmarkPromptForMsaOnWork:[{region:["amer"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},calendar:{enableYammerQnACalendar:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},calling:{disableDefaultBotDataLanguage:[{region:["gcc","dod","gcchigh"],value:!0,resolutionStrategy:["merge"]}],callingEnableBufferSharing:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSendPanoVideo:[{meetingRoomLicenseCategory:["Basic"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStreamChatFeature:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableHotdesking:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],useLegacySkuCheck:[{meetingRoomLicenseCategory:["Premium","Pro"],resolutionStrategy:["merge"],value:!1},{value:!0,resolutionStrategy:["merge"]}],enablePMPBYOD:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStyleMyRoom:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},core:{enableHandlingDefaultCommandsInCoreLayoutApp:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableHandlingDeeplinkExtensionCommandsInCoreLayoutApp:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabAutopin:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableEDUColdBootApp:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},cdlWorker:{enableStartupUsingPartialData:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableConversationTableVersionGCC:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},people:{enablePeopleHighlightsInLPC:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},activity:{enableUserOnboardingToTeamNavigationInFeed:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},chatList:{enableSmbChatListSuggestedContacts:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbAllDirectorySuggestedContacts:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbExternalChatListSuggestedContacts:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSuggestedOrgGroupChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSuggestedProjectGroupChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableBizChatMetaOSChatListEntryPoint:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},compose:{enableDesignerInChannelAnnouncementPost:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["merge"]},{region:["amer"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableGenerateImageInDesignerMini:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["merge"]},{region:["amer"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},discoverSurface:{enableHybridDiscoverSurface:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDiscoverSurfaceSyncEngine:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDiscoverToggleInSettings:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},esp:{enableEspIrisIntegration:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableEspDLSurfaces:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},extensibility:{enableCardSharing:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableActionCommands:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableAppContextMenu:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMicrosoftBuiltAppScenes:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableTeamsAppPermissionPolicyFetch:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableTeamsAppSetupPolicyFetch:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],adaptiveCardFluentIconCdnRoot:[{region:["gcc"],value:"https://res-gcc.cdn.office.net",resolutionStrategy:["merge"]}],appBarNotToLandApps:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:["14d6962d-6eeb-4f48-8890-de55454bb136","ef56c0de-36fc-4ef8-b417-3d82ba9d073c","20c3440d-c67e-4420-9f80-0e50c39693df","86fcd49b-61a2-4701-b771-54728cd291fb"],resolutionStrategy:["merge"]},{value:["14d6962d-6eeb-4f48-8890-de55454bb136","ef56c0de-36fc-4ef8-b417-3d82ba9d073c","20c3440d-c67e-4420-9f80-0e50c39693df"],resolutionStrategy:["merge"]}],enableDeprecateWebsiteTab:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},files:{enableFilesAppBasedFileHandlingForPDFTMP:[{region:["gcchigh","dod","ag08","ag09"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableFilesAdminPreinstallCheckForPDFAppTMP:[{region:["gcchigh","dod","ag08","ag09"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},growth:{enablePrivatePreviewRingSelection:[{userLicenseCategory:["EducationStudent","EducationFaculty"],resolutionStrategy:["merge"],value:!1}]},meetingArtifacts:{byPassTeamsPremiumLicenseCheckForMA:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},messaging:{enableTfwTflFederation:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCustomEmoji:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDeprecatedM365ChatBanner:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMetaOSCopilotToggleInSettings:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],validAppThumbnailDomains:[{region:["gcc"],value:["https://res-gcc.cdn.office.net/","https://statics.gov.teams.microsoft.us/"],resolutionStrategy:["merge"]},{value:["https://res.cdn.office.net/","https://res-sdf.cdn.office.net/","https://statics.teams.cdn.office.net/","blob:https://teams.microsoft.com/"],resolutionStrategy:["merge"]}]},smb:{enableFetchingSmbTenantSettings:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbChatListInvite:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbChatZeroState:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSuggestedOrgGroupChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSuggestedProjectGroupChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableInternalSubstrateSuggestedChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableExternalSubstrateSuggestedChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTenantDirectorySuggestedChats:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTenantDirectoryStateMachine:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},teamsAndChannels:{enableCreateTeamFromGroup:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCreateTeamFromScratch:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],hideCreateTeamContextMenuItem:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableRemoveChannelFromTeam:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableGeneralChannelRecommend:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMemberMute:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeamMute:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeamLayoutSetting:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],defaultTeamLayoutSettingIsGrid:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableLeftRailAddChannelButton:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],disableSensitivityLabelEdu:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStaleChannelsFlow:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsSettings:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsRetryAndJitter:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsAdHocFlow:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsBatchAPI:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsHiddenFirstOrder:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableUserOnboardingToTeam:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableChannelHeaderBackButton:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableUserOnboardingToTeamRecommended:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableFirstChannelName:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableRenameGeneralChannel:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCreateTeamSimplification:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},chat:{enableHandlingChatWithUsersCommand:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},csaService:{enableStartupV3API:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},virtualEvents:{enableSchedulingTownhalls:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],isGroupMailboxEnabled:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableEndpointsManagerOnVirtualEventService:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSchedulingTownhallsInGcc:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTownhallEmbed:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCommentStreamSchedulingForTownHalls:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableBackroomChatThreadCreation:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableTownhallApps:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableLiveEventRedirectDialog:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSensitivityLabelDowngradeJustificationInVirtualEvents:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMandatoryLabelDialogInVirtualEvents:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSensitivityLabelForWebinarAndTownhall:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDownloadQnAReport:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMTRRoomsInVirtualEventsPresenterPeoplePicker:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},meetingOptions:{enableEditSensitivityInWebinar:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableEditSensitivityInTownHall:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},brb:{enableBrb:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["merge"]},{preReleaseFeaturesAllowed:[!0],value:!0,resolutionStrategy:["merge"]}]},byod:{enablePMPBYOD:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableBYODMeetingResourceToPmp:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},hotdesking:{enableHotdesking:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},virtualAppointments:{enableSchedulingVirtualAppointments:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},edu:{enableEduAskCommunity:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduSuggestFeature:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentInsightsLink:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeacherCreateTeam:[{userLicenseCategory:["EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentCreateBasicTeam:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduTeamActions:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeacherCreateTeamFromGroup:[{userLicenseCategory:["EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentTeamifyCustomization:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduAddMemberCustomization:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableAssignmentsApp:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSupportAppForFaculty:[{userLicenseCategory:["EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduEmptyChannelActionSets:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeamClassSettings:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentCloneTeamCustomization:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableClassTilesRefreshV1:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEndpointsManagerOnLockedTeams:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},simpleCollab:{enableSimpleCollabLeftRailReadItemsRemovalInFilteredView:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabApp:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabAppToggle:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabUpdateHistoryNavigation:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabSplitViewFRE:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabSplitOptInFRE:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabOptInFRE:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],disableSimpleCollabLeftRailAtMentionsStickyFilterPill:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabAppSplitView:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],canArchiveRestoreChannelContextMenu:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabConversationFolderSorting:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDraftCharm:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDraftFilter:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableBizChatMetaOSSimpleCollabEntryPoint:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSuggestedChatsInChatFolder:[{userLicenseCategory:["SmbLicense","Exploratory"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSimpleCollabRailSelectionV2:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabRailSelection:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabChatComfyLayout:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabTeamNameOverGeneralChannel:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabSwitchBackSurvey:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabStickyFilter:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabFilterUserPreferences:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabUnifiedAppRename:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabSplitChannelsAppRename:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabLegacyAvatar:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDiscoverScrollableInSimpleCollab:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabLeftRailHeaderNewMessageButton:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabAvatarRender:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabDiscoverUserPreferences:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabEngageCommunities:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]}},jz={calendar:{calendarAppPhaseTimeouts:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:{critical:36e3,postCritical:36e3},resolutionStrategy:["override"]}],fluid:[{region:["gcc"],value:{audience:"GCC",containerCodeDetailsUpgrade:!1,ipEnabled:!1,useServiceDeliveredDriver:!0},resolutionStrategy:["override"]}]},calling:{customViewBots:[{region:["gcc"],value:[{audienceBotId:"28:b102ccd8-1925-448b-90a7-b083aba25074",largeGridBotId:"28:556b15e7-452c-4773-b728-6313eaa47b77"}],resolutionStrategy:["override"]}],largeGridBotIdV2:[{region:["gcc"],value:"28:d123a3e6-7f0a-4bbd-91f2-6d0ad1707297",resolutionStrategy:["override"]}],cloudPeopleFeedBotId:[{region:["gcc"],value:"28:4062df8b-5499-49a2-abe0-29ad866b2c04",resolutionStrategy:["override"]}],callingConstants:[{region:["gcc"],resolutionStrategy:["override"],value:{audienceBotMri:"28:b102ccd8-1925-448b-90a7-b083aba25074",largeGridBotMri:"28:556b15e7-452c-4773-b728-6313eaa47b77",callRecording:{recordingBotMri:"28:4b25d9f8-18f5-4d09-a582-cd0a28f63181",closedCaptionsBotMri:"28:a8011016-05a6-4f6e-b2b3-26543cf329a0",recordingBotMrisFromAlternateRegions:["28:bdd75849-e0a6-4cce-8fc1-d7c0d4da43e5"]},transcript:{artifacts:{endpoint:"https://gcc-mtis.cortana.ai/meetingArtifacts/api/v2"},endpoint:"https://mi.svcs.gcc.teams.microsoft.com",settingsEndpoint:"https://mi.svcs.gcc.teams.microsoft.com"}}}],closedCaptionsBotMriForClientRegion:[{region:["gcc"],resolutionStrategy:["override"],value:"28:a8011016-05a6-4f6e-b2b3-26543cf329a0"}],yammerQnaGraphqlEndpoint:[{region:["gcc"],resolutionStrategy:["override"],value:"https://web.gov.yammer.com/graphql?operationName=QnAUnseenActivityIndicatorTeams"}],fluid:[{region:["gcc"],value:{audience:"GCC",containerCodeDetailsUpgrade:!1,ipEnabled:!1,useServiceDeliveredDriver:!0},resolutionStrategy:["override"]}],pptBootstrapperUrl:[{region:["gcc"],value:"https://powerpoint.cdn.office365.us/pods/s/PptScripts/powerpoint.boot.js",resolutionStrategy:["override"]}],pptFeatureGates:[{region:["gcc"],value:'{"ModernWebGLBlockListForBrowserVersion": "Chrome:66;Edge:19","ModernWebGLBlockListForGPURenderer": "PowerVR Rogue GX6250;SwiftShader", "ModernSlideShowAllowListForFileType": "pptx;ppsx;potx;pptm;ppsm;pot;ppt;odp;pps", "DetectAbandonsWithinIframeTimeouts":true, "PresUrlBootTimeoutMS":4000}â€‹â€‹â€‹â€‹',resolutionStrategy:["override"]}],enableStateServiceInPreviewerFeatures:[{region:["gcc"],value:["Ink","PresUrl","Nav","NavSync","PresUrlBoot","Media","OpticalZoomSync"],resolutionStrategy:["override"]}]},people:{lokiTokenResourceUrl:[{region:["gcc"],value:"https://gcc.loki.delve.office.com/",resolutionStrategy:["override"]}],lokiEnvironment:[{region:["gcc"],value:"gcc",resolutionStrategy:["override"]}]},telemetry:{toolingSamplingRules:[{region:["gcc"],value:{scenarions:{"*":1},userbins:{"*":100},loggingns:{"*":1},endpointns:{"*":1},httpns:{"*":1}},resolutionStrategy:["override"]}],oneDsCollectorUrl:[{region:["gcc"],value:"https://us-teams.events.data.microsoft.com/OneCollector/1.0/",resolutionStrategy:["override"]}],enableTelemetryRegionReinit:[{region:["gcc"],value:!0,resolutionStrategy:["override"]}]},artifactsPlatform:{fluid:[{region:["gcc"],value:{audience:"GCC",containerCodeDetailsUpgrade:!1,ipEnabled:!1,useServiceDeliveredDriver:!0},resolutionStrategy:["override"]}]},autosuggest:{disableSubstrateTCC:[{region:["gcc"],value:!0,resolutionStrategy:["override"]}]},channels:{fluid:[{region:["gcc"],value:{composeEnabledComponents:["bulletedList","checklist","FFX-KanbanBoard","numberedList","paragraph","FFX-ProgressTracker","questionAnswer","FFX-RetroBoard","table","votingTable","actionItems"],loadInChannelEnabled:!0,composeInChannelEnabled:!0,pasteInChannelEnabled:!0,pasteGrantPermissionsEnabled:!0,embedModeComposeEnabled:!0,embedModeLoadEnabled:!0,embedModePasteEnabled:!0,loadEnabled:!0,pasteEnabled:!0},resolutionStrategy:["override"]}]},cmdMeetingArtifactsService:{cmdMeetingArtifactsServiceEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/mcps/gcc/collab",resolutionStrategy:["override"]}]},extensibility:{storeDataProvidersList:[{region:["gcc"],value:[0,5],resolutionStrategy:["override"]}],collabCloudEndpointUrl:[{region:["gcc"],resolutionStrategy:["override"],value:"https://teamsgraph.gcc.teams.microsoft.com"}],workflowApp:[{region:["gcc"],value:{id:"c3a1996d-db0f-4857-a6ea-7aabf0266b00",linkedApps:[{id:"00001016-de05-492e-9106-4828fc8a8687",linkedAppId:"c3a1996d-db0f-4857-a6ea-7aabf0266b00"}],providerInfo:[{botId:"e4a2d064-3c07-48bd-a16d-6173958714c5",id:"00001016-de05-492e-9106-4828fc8a8687",nameOverride:"Power Automate"},{botId:"509e64f1-1e70-4744-91dc-3bba3977d3e2",id:"c3a1996d-db0f-4857-a6ea-7aabf0266b00",nameOverride:"Power Automate"}]},resolutionStrategy:["override"]}],cloudSpecificRingId:[{region:["gcc"],value:"gcc",resolutionStrategy:["override"]}],legacyChannelConnectorsToWorkflows:[{region:["gcc"],value:{searchUrl:"https://gov.api.flow.microsoft.us/providers/Microsoft.ProcessSimple/galleries/public/teamsworkflowtemplates?$filter=properties/categoryNames/any(x:x eq 'microsoftteams_channel') and properties/categoryNames/all(x:x ne 'reported')&useNewConfigUrl=true&supportBigTiles=true",collections:["wf:co:all"]},resolutionStrategy:["override"]}],workflowsEntryPointConfig:[{region:["gcc"],value:[{entrypoint:"channelworkflows",searchUrl:"https://gov.api.flow.microsoft.us/providers/Microsoft.ProcessSimple/galleries/public/teamsworkflowtemplates?$filter=properties/categoryNames/any(x:x eq 'microsoftteams_channel') and properties/categoryNames/all(x:x ne 'reported')&useNewConfigUrl=true&supportBigTiles=true",collections:["wf:co:all"]},{entrypoint:"chatworkflows",searchUrl:"https://gov.api.flow.microsoft.us/providers/Microsoft.ProcessSimple/galleries/public/teamsworkflowtemplates?$filter=properties/categoryNames/any(x:x eq 'microsoftteams_chat') and properties/categoryNames/all(x:x ne 'reported')&useNewConfigUrl=true&supportBigTiles=true",collections:["wf:co:all"]}],resolutionStrategy:["override"]}],channelWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"notify_a_team",heroTemplateIds:["wf:it:ed6dc6ffc0154db5bb90694ee15b9289","wf:it:c058ab6a8be646d5a7afb7b7bdeba59c","wf:it:e6670d91f2834394aeb63f1cb6f263bf","wf:it:817f4d64144e4c0aae710da4ab6297b8","wf:it:d3ea3143c7634106b20952709e52af95"]},{heroCollectionTitle:"post_a_digest",heroTemplateIds:["wf:it:e2c131a4be2e48f3a22af4a01509c780","wf:it:0916e2b8504d45edbb7ca76352e87663"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:c058ab6a8be646d5a7afb7b7bdeba59c","wf:it:c778b7fc01d943528786b4012b011702","wf:it:40649abe579f479c9dcacd6d6c9ca1ef","wf:it:e2c131a4be2e48f3a22af4a01509c780","wf:it:3c6294b5e0fd42ffbfe827dfb8023cb0","wf:it:ed6dc6ffc0154db5bb90694ee15b9289","wf:it:0916e2b8504d45edbb7ca76352e87663","wf:it:382aa0f154094795952014fb511b9ad2","wf:it:39e2b109962a4dc3b283197f71323eec","wf:it:383c63172a0048dabb702c53c7f95d49","wf:it:189cb2567d2d4370bcc5f37c0c4f0c86","wf:it:50baef9c102f44289d71d860b6e0eccc","wf:it:46327ebee65f467c9f0c552203c8c99d","wf:it:e1efc42fcf0742da94b88057dcac01ab"]}},resolutionStrategy:["override"]}],chatWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"notify_a_chat",heroTemplateIds:["wf:it:4572ea5465834767a303acc1006234c6","wf:it:9c104efa45ad432788a3bfdfd1c41188","wf:it:91ad3a43282143acb71977ec6e41322b","wf:it:22be1e10dcfa440fbb2a59533d4d8f26","wf:it:08d52de1a3524f12ae9636c507b98dfb"]},{heroCollectionTitle:"post_a_digest",heroTemplateIds:["wf:it:be04eb4566ee4553b92cb8335dde41d9","wf:it:974a60f84a1340ec8cdfef31fdadc2a8"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:be04eb4566ee4553b92cb8335dde41d9","wf:it:4572ea5465834767a303acc1006234c6","wf:it:40649abe579f479c9dcacd6d6c9ca1ef","wf:it:9c104efa45ad432788a3bfdfd1c41188","wf:it:91ad3a43282143acb71977ec6e41322b","wf:it:974a60f84a1340ec8cdfef31fdadc2a8","wf:it:22be1e10dcfa440fbb2a59533d4d8f26","wf:it:08d52de1a3524f12ae9636c507b98dfb"]}},resolutionStrategy:["override"]}],channelMessageExtensionWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"editor_pick",heroTemplateIds:["wf:it:9268a6e0f63d4241a8eff6eacf6cec62","wf:it:3e8b273f504b4642a501cc8df8d6d513","wf:it:392de20d7c84439f93decf2675813546"]},{heroCollectionTitle:"create_instant",heroTemplateIds:["wf:it:7ff9cd7e80264a35a77f61df8f8c67d4","wf:it:46327ebee65f467c9f0c552203c8c99d"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:c058ab6a8be646d5a7afb7b7bdeba59c","wf:it:c778b7fc01d943528786b4012b011702","wf:it:40649abe579f479c9dcacd6d6c9ca1ef","wf:it:e2c131a4be2e48f3a22af4a01509c780","wf:it:3c6294b5e0fd42ffbfe827dfb8023cb0","wf:it:ed6dc6ffc0154db5bb90694ee15b9289","wf:it:0916e2b8504d45edbb7ca76352e87663","wf:it:382aa0f154094795952014fb511b9ad2","wf:it:39e2b109962a4dc3b283197f71323eec","wf:it:383c63172a0048dabb702c53c7f95d49","wf:it:189cb2567d2d4370bcc5f37c0c4f0c86","wf:it:50baef9c102f44289d71d860b6e0eccc","wf:it:46327ebee65f467c9f0c552203c8c99d","wf:it:e1efc42fcf0742da94b88057dcac01ab"]}},resolutionStrategy:["override"]}],chatMessageExtensionWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"editor_pick",heroTemplateIds:["wf:it:9268a6e0f63d4241a8eff6eacf6cec62","wf:it:3e8b273f504b4642a501cc8df8d6d513"]},{heroCollectionTitle:"create_instant",heroTemplateIds:["wf:it:7ff9cd7e80264a35a77f61df8f8c67d4","wf:it:f68595fa35e84f2ab07b8075ae945278"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:be04eb4566ee4553b92cb8335dde41d9","wf:it:4572ea5465834767a303acc1006234c6","wf:it:40649abe579f479c9dcacd6d6c9ca1ef","wf:it:9c104efa45ad432788a3bfdfd1c41188","wf:it:91ad3a43282143acb71977ec6e41322b","wf:it:974a60f84a1340ec8cdfef31fdadc2a8","wf:it:22be1e10dcfa440fbb2a59533d4d8f26","wf:it:08d52de1a3524f12ae9636c507b98dfb"]}},resolutionStrategy:["override"]}],messageActionWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"editor_pick",heroTemplateIds:["wf:it:9f9f187e478b442c836a601d48ca02d2","wf:it:367cfb7f32c74ab784ca556d142b7ba7","wf:it:d1a667cd802c4555ab84326d70018c9a","wf:it:d4571c6fbc0c43a880fe0fc19e066953","wf:it:0a0676517d1842b4aff80b8ba7ed7d74"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:8c00bf0817ea44af8faa6c0dfb4df68a","wf:it:8640c42a62fe497681d30ef6732fa37e","wf:it:4e277966a1094528aa7bd322183cb6d3","wf:it:b68f13d17c9e40eb9d6c99c788a4177f","wf:it:f95ed0fd7281445685fdfda0148ef676","wf:it:79b4c4bd9ff74c55b3e3f78591618602","wf:it:37fb8360ec6d40dcaa4d62c9402cc5c7"]}},resolutionStrategy:["override"]}],workflowsAuthResourceUrl:[{region:["gcc"],value:"https://gov.service.flow.microsoft.us/",resolutionStrategy:["override"]}]},meetingArtifacts:{meetingArtifactsServiceEndpoint:[{region:["gcc"],value:"https://gcc-mtis.cortana.ai/MeetingArtifacts/api",resolutionStrategy:["override"]}],cmdTmisEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/artifacts/gcc/attendancereport/",resolutionStrategy:["override"]}],tmisEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/attendancereport/gcc/",resolutionStrategy:["override"]}],transcriptServiceEndpoint:[{region:["gcc"],value:"https://gcc-mtis.cortana.ai/meetingArtifacts/api/v2",resolutionStrategy:["override"]}],yammerQnaEndpointUrl:[{region:["gcc"],value:"https://web.gov.yammer.com/teamsmeeting/teams-meeting",resolutionStrategy:["override"]}]},meetingRecap:{fluid:[{region:["gcc"],value:{audience:"GCC",containerCodeDetailsUpgrade:!1,ipEnabled:!1,useServiceDeliveredDriver:!0},resolutionStrategy:["override"]}],enablePremiumDiscoverTryBuy:[{region:["gcc","dod","gcchigh"],value:!1,resolutionStrategy:["override"]}]},messaging:{fluid:[{region:["gcc"],value:{activityFeedMentionsEnabled:!0,ariaLoggerEnabled:!0,audience:"GCC",atMentionSuggestionsEnabled:!0,blueprintComposeInCanvas:!0,cachedHeightEnabled:!0,coachmarkEnabledList:["received"],commandingImageDescriptionEnabled:!0,commandingInsertHyperlinkEnabled:!0,commandingSurfaceEnabled:!0,composeActionsFromManifestEnabled:!0,composeActionsPreviewOnHoverExpEnabled:!0,composeEnabledComponents:["bulletedList","checklist","FFX-KanbanBoard","numberedList","paragraph","FFX-ProgressTracker","questionAnswer","FFX-RetroBoard","table","votingTable","actionItems"],composeShareLinkV2Enabled:!0,containerEnvironment:"Prod",customFluidCacheLifespan:7500,detachedContainerComposeEnabled:!0,disableAnyoneLinkPermission:!0,disableExtraTokenUrlValidation:!0,disableLoadingIndicatorOnPendingCreate:!0,eduEnabled:!0,embedModeComposeEnabled:!0,embedModeLoadEnabled:!0,embedModePasteEnabled:!0,enableOnlyInlineComponents:!1,enhancedLoopSenderCoachmarkEnabled:!1,fileDetailsViaGraphApi:!0,fluentV9LoopThemeEnabled:!0,forceWritePermissionEnabled:!0,invitePeopleSizeLimit:20,loadCodeFromHintEnabled:!0,loadEnabled:!0,loadTimeout:6e4,loopGlowBorderEnabled:!0,loopHostContextMigrationEnabled:!0,loopTrustedTypesEnabled:!0,odspShareDialogHiddenItemList:["specificPeopleFlex"],oneWayRedeemEnabled:!0,overwriteFluidCollaborate:!1,pasteEnabled:!0,pasteGrantPermissionsEnabled:!0,permissionsPanelEnabled:!0,phasedLoadEnabled:!0,prefetchOdspTokensEnabled:!0,sendMessageDelayMs:5e3,settingsProviderEnabled:!0,sharedHeaderEnabled:!1,sharedHeaderV2Enabled:!0,sharedHeaderV3LayoutEnabled:!0,shareLinkRedeemFallbackEnabled:!0,shareLinkChangePermissionEnabled:!0,shortenUrlEnabled:!0,sizeLimitEnabled:!0,sizeLimitValueBytes:3145728,snapshotCacheEnabled:!0,sourcelessIframeEnabled:!0,sourcelessIframeV2DriverPrecacheEnabled:!0,sourcelessIframeV2Enabled:!0,startContainerInPausedState:!1,startInPostCriticalEnabled:!0,useServiceDeliveredDriver:!0,useTelemetrySink:!0,viewportDelayMs:3e3,viewProperties:{layoutMode:"growHeight",maxHeight:"20rem",mediumVisualSpacingLeft:20,mediumVisualSpacingRight:20,sizeCategory:"small",viewType:"Large"},composeChecklistExpNameEnabled:!1,composeLoopTableExperimentEnabled:!1,composeParagraphExpNameEnabled:!1,containerCodeDetailsUpgrade:!1,ipEnabled:!1,patchHostConsoleEnabled:!1,requestAccessEnabled:!1,shareLinkDeferRedeemEnabled:!1,shareLinkPartialSuccessEnabled:!1,splitRenderEnabled:!1,tryLoopInSelfChatEnabled:!1,useResolvedUrlForLocator:!1},resolutionStrategy:["override"]}]},teamsAndChannels:{channelPhaseTimeoutSettings:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:{critical:6e4,postCritical:1e4},resolutionStrategy:["override"]},{value:{critical:41e3,postCritical:1e4},resolutionStrategy:["override"]}]},csaService:{apiConstants:[{region:["gcc"],value:{resource:"https://chatsvcagg.gcc.teams.microsoft.com",host:"https://chatsvcagg.gcc.teams.microsoft.com",version:"/api/v1/",endpoints:{startupclean:"teams/users/me",startupdelta:"teams/users/me/updates",startupgroupchats:"teams/users/me/groupchats",startupnonrecentchats:"teams/users/me/nonrecentchats",startupcleananonymous:"teams/users/anonymous",startupdeltaanonymous:"teams/users/anonymous/updates"}},resolutionStrategy:["override"]}],apiConstantsGCC:[{region:["gcc"],value:{resource:"https://chatsvcagg.gcc.teams.microsoft.com",host:"https://chatsvcagg.gcc.teams.microsoft.com",version:"/api/v1/",endpoints:{startupclean:"teams/users/me",startupdelta:"teams/users/me/updates",startupgroupchats:"teams/users/me/groupchats",startupnonrecentchats:"teams/users/me/nonrecentchats",startupcleananonymous:"teams/users/anonymous",startupdeltaanonymous:"teams/users/anonymous/updates"}},resolutionStrategy:["override"]}]},broadcast:{liveStreamPlayerJsSources:[{region:["gcc","dod","gcchigh"],value:["https://amp.azure.net/libs/amp/2.3.11/azuremediaplayer.min.js","/evergreen-assets/broadcast/player-skin.min.js"],resolutionStrategy:["override"]}],liveStreamPlayerCssSources:[{region:["gcc","dod","gcchigh"],value:["/evergreen-assets/broadcast/player-skin.min.css?v=3"],resolutionStrategy:["override"]}],microsoftSdnPluginUrl:[{region:["gcc"],value:"https://sdk.ecdn.gcc.teams.microsoft.com/peer5.microsoft-teams.plugin.js",resolutionStrategy:["override"]}]},feedback:{enableFloodgateService:[{region:["gcc","dod","gcchigh"],value:!1,resolutionStrategy:["override"]},{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["override"]}],enableInAppFeedback:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["override"]},{region:["gcc","dod","gcchigh"],value:!1,resolutionStrategy:["override"]}]},virtualEvents:{virtualEventsServiceEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/virtualevents/gcc/beta",resolutionStrategy:["override"]}],virtualEventInsightsUrl:[{region:["gcc"],resolutionStrategy:["override"],value:"https://app.tha.gcc.teams.microsoft.com/event-view?thread={threadId}#preferred_username={userEmail}"}]},brb:{enablePIIFreeLogsUpload:[{region:["gcc"],value:!0,resolutionStrategy:["override"]}]},meetingCollaboration:{enableFooterButtons:[{region:["gcc","dod","gcchigh"],value:!1,resolutionStrategy:["override"]}]},meetingTemplates:{meetingTemplateServiceEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/artifacts/gcc/meetingTemplate",resolutionStrategy:["override"]}]}},Bz={mappings:{calendar:{isOnCloud:{name:"userPropertiesSettings.isOnCloud"},autodiscoverSettings:{name:"userPropertiesSettings.autodiscoverSettings"},allowPrivateMeetingSchedulingPolicy:{name:"meetingPolicy.allowPrivateMeetingScheduling"},allowChannelMeetingSchedulingPolicy:{name:"meetingPolicy.allowChannelMeetingScheduling"},allowEngagementReportPolicy:{name:"meetingPolicy.allowEngagementReport"},enableCoachByPolicy:{name:"meetingPolicy.allowMeetingCoach"},allowFluidCollaboratePolicy:{name:"messagingPolicy.allowFluidCollaborate"},allowMeetingRegistrationPolicy:{name:"meetingPolicy.allowMeetingRegistration"},allowBroadcastSchedulingPolicy:{name:"broadcastMeetingPolicy.allowBroadcastScheduling"},whoCanRegisterPolicy:{name:"meetingPolicy.whoCanRegister"},allowWebinarsV2Policy:{name:"teamsEventsPolicy.allowWebinars"}},calling:{allowPrivateCallingPolicy:{name:"callingPolicy.allowPrivateCalling"},myPhoneNumber:{name:"voiceAdminSettings.phoneNumber"},adminSettings:{name:"adminSettings"},callingPolicy:{name:"callingPolicy"},policySettings:{name:"policySettings"},teamsMeetingBrandingPolicy:{name:"teamsMeetingBrandingPolicy"},syntheticAutomatedCallPolicy:{name:"syntheticAutomatedCallPolicy"},meetingPolicy:{name:"meetingPolicy"},tenantSettingsV2:{name:"tenantSettingsV2"},tenantVoiceSettings:{name:"tenantVoiceSettings"},userResourcesSettings:{name:"userResourcesSettings"},voiceAdminSettings:{name:"voiceAdminSettings"},teamsEmergencyCallingPolicy:{name:"teamsEmergencyCallingPolicy"},teamsEmergencyCallRoutingPolicy:{name:"teamsEmergencyCallRoutingPolicy"},teamsUserPhoneNumbers:{name:"teamsUserPhoneNumbers"},teamsMediaConnectivityPolicy:{name:"teamsMediaConnectivityPolicy"},delegationSettingsPolicy:{name:"voiceAdminSettings.delegationSettings"},dialPlanPolicy:{name:"policySettings.dialPlanPolicy"},safeTransferPolicy:{name:"callingPolicy.safeTransferEnabled"},allowCloudRecordingPolicy:{name:"meetingPolicy.allowCloudRecording"},allowRecordingStorageOutsideRegion:{name:"meetingPolicy.allowRecordingStorageOutsideRegion"},recordingStorageMode:{name:"meetingPolicy.recordingStorageMode"},allowCloudRecordingForCallsPolicy:{name:"callingPolicy.allowCloudRecordingForCalls"},closedCaptionsPolicy:{name:"meetingPolicy.liveCaptionsEnabledType"},closedCaptionsForCallingPolicy:{name:"callingPolicy.liveCaptionsEnabledTypeForCalling"},isPptSharingAllowedByPolicy:{name:"meetingPolicy.allowPowerPointSharing"},areMeetingNotesEnabledByPolicy:{name:"meetingPolicy.allowSharedNotes"},isMeetingReactionsAllowedByPolicy:{name:"meetingPolicy.allowMeetingReactions"},isAnnotationsEnabledByPolicy:{name:"meetingPolicy.allowAnnotations"},customVideoBackgroundsFilterByPolicy:{name:"meetingPolicy.videoFiltersMode"},screenSharingModePolicy:{name:"meetingPolicy.screenSharingMode"},meetingChatEnableTypePolicy:{name:"meetingPolicy.meetingChatEnableType"},allowPrivateMeetingSchedulingPolicy:{name:"meetingPolicy.allowPrivateMeetingScheduling"},allowMeetNowPolicy:{name:"meetingPolicy.allowMeetNow"},callParkPolicy:{name:"callParkPolicy"},teamsEnhancedEncryptionPolicy:{name:"teamsEnhancedEncryptionPolicy"},messagingPolicy:{name:"messagingPolicy"},isVideoAllowedByPolicy:{name:"meetingPolicy.allowIPVideo"},enableCallTranscriptByPolicy:{name:"meetingPolicy.allowTranscription"},enableCallTranscriptInCallsByPolicy:{name:"callingPolicy.allowTranscriptionForCalling"},onlineDialinConferencingPolicy:{name:"onlineDialinConferencingPolicy"},teamsVoiceApplicationsPolicy:{name:"teamsVoiceApplicationsPolicy"},allowLocalRecordingPolicy:{name:"meetingPolicy.allowLocalRecording"},enableCoachByPolicy:{name:"meetingPolicy.allowMeetingCoach"},allowFluidMeetingCalendarPolicy:{name:"callingPolicy.allowFluidMeetingCalendar"},allowDocumentCollaborationPolicy:{name:"meetingPolicy.allowDocumentCollaboration"},allowPrivateMeetNowPolicy:{name:"meetingPolicy.allowPrivateMeetNow"},enableMandatoryBackgroundPolicy:{name:"teamsMeetingBrandingPolicy.requireBackgroundEffect"},allowThirdPartyDevicesPolicy:{name:"meetingPolicy.connectToMeetingControls"},restrictLoopCreateWorkspacePolicy:{name:"teamsOfficeCloudPolicy.restrictLoopCreateWorkspace"},voicemailPolicy:{name:"voicemailPolicy"},teamsMediaLoggingPolicy:{name:"teamsMediaLoggingPolicy"},branchSurvivabilityPolicy:{name:"branchSurvivabilityPolicy"},vdiPolicy:{name:"vdiPolicy"},vdiSlimcoreOptimizationPolicy:{name:"vdiPolicy.vdI2Optimization"}},core:{useNewTeamsClient:{name:"updateManagementPolicy.useNewTeamsClient"},allowPublicPreview:{name:"updateManagementPolicy.allowPublicPreview"}},host:{enableBreakoutRoomsPreMeetingAssignmentTabInBiM:{name:"meetingPolicy.allowBreakoutRooms"}},people:{enableTfwUpdateGroupChatAvatar:{name:"messagingPolicy.allowCustomGroupChatAvatars"},allowScopedPeopleSearchandAccess:{name:"clientSettings.allowScopedPeopleSearchandAccess",defaultValue:!1}},telemetry:{ocpsSendTelemetry:{name:"feedbackPolicy.ocpsSendTelemetry"}},tenant:{isOrganizationTabEnabled:{name:"clientSettings.allowOrganizationTab",defaultValue:!0},tenantSiteUrl:{name:"tenantSiteUrl"},tenantSiteUrlAndDomains:{name:"tenantSiteUrlAndDomains"}},esp:{disabledCategories:{name:"teamsUpdateManagementPolicy.disabledInProductMessages"}},extensibility:{isSideLoadingInteractionEnabled:{name:"tenantSettingsV2.apps.isSideLoadingInteractionEnabled"},storeAppTenantBackground:{name:"tenantSettingsV2.apps.lobBackground"},storeAppTenantLogo:{name:"tenantSettingsV2.apps.lobLogo"},storeAppTenantTextColor:{name:"tenantSettingsV2.apps.lobTextColor"},storeAppTenantIcon:{name:"tenantSettingsV2.apps.lobLogomark"},teamsAppPermissionPolicyHash:{name:"teamsAppPermissionPolicy.policyHash"},teamsAppSetupPolicyHash:{name:"teamsAppSetupPolicy.policyHash"},appsTenantSettingsLastUpdatedTimestamp:{name:"tenantSettingsV2.apps.lastUpdatedTimestamp"},isUserPinningAllowed:{name:"teamsAppSetupPolicy.isUserPinningAllowed"}},files:{nativeFileEntryPoints:{name:"filesPolicy.nativeFileEntryPoints",defaultValue:"Enabled"},defaultFileUploadAppId:{name:"filesPolicy.defaultFileUploadAppId",defaultValue:""},enableFederationAccess:{name:"externalAccessPolicy.enableFederationAccess",defaultValue:!0},teamsLinkBrowserPreferencePolicy:{name:"teamsLinkPolicy.browserChoice"},fileSharingInChatswithExternalUsers:{name:"filesPolicy.fileSharingInChatswithExternalUsers",defaultValue:"Disabled"}},growth:{allowPrivatePreview:{name:"updateManagementPolicy.allowPrivatePreview"}},guardians:{parentGuardianPreferredContactMethod:{name:"educationSettings.parentGuardianPreferredContactMethod"},updateParentInformation:{name:"educationSettings.updateParentInformation"}},meet:{isMailboxDiscoverable:{name:"userPropertiesSettings.isMailboxDiscoverable"},isOnCloud:{name:"userPropertiesSettings.isOnCloud"},enableMeetForWork:{name:"userPropertiesSettings.isOnCloud"}},meetingArtifacts:{allowEngagementReportPolicy:{name:"meetingPolicy.allowEngagementReport"},allowTrackingInReportPolicy:{name:"meetingPolicy.allowTrackingInReport"},speakerAttributionModePolicy:{name:"meetingPolicy.speakerAttributionMode"}},messaging:{receiptsEnabledType:{name:"messagingPolicy.readReceiptsEnabledType",defaultValue:"UserPreference"},allowPasteInternetImage:{name:"messagingPolicy.allowPasteInternetImage",defaultValue:!0},EnableUpToEditInMW:{name:"messagingPolicy.allowUserEditMessage",defaultValue:!0},allowUserEditMessage:{name:"messagingPolicy.allowUserEditMessage",defaultValue:!0},allowGiphy:{name:"messagingPolicy.allowGiphy",defaultValue:!0},allowGiphyDisplay:{name:"messagingPolicy.allowGiphyDisplay",defaultValue:!0},allowStickers:{name:"messagingPolicy.allowStickers",defaultValue:!0},giphyRatingType:{name:"messagingPolicy.giphyRatingType",defaultValue:"Moderate"},allowPriorityMessages:{name:"messagingPolicy.allowPriorityMessages",defaultValue:!0},allowImmersiveReader:{name:"messagingPolicy.allowImmersiveReader",defaultValue:!0},allowUserChat:{name:"messagingPolicy.allowUserChat",defaultValue:!0},allowRemoveUser:{name:"messagingPolicy.allowRemoveUser",defaultValue:!0},areUrlPreviewsAllowed:{name:"messagingPolicy.allowUrlPreviews",defaultValue:!0},allowUserDeleteMessage:{name:"messagingPolicy.allowUserDeleteMessage",defaultValue:!0},enableSms:{name:"voiceAdminSettings.isSmsEnabled"},messagingPolicy:{name:"messagingPolicy"},enableTeamsConsumerAccess:{name:"externalAccessPolicy.enableTeamsConsumerAccess",defaultValue:!0},enableFederationAccess:{name:"externalAccessPolicy.enableFederationAccess",defaultValue:!1},enablePublicCloudAccess:{name:"externalAccessPolicy.enablePublicCloudAccess",defaultValue:!1},enableCustomEmoji:{name:"teamsMessagingConfiguration.customEmojis"},enableVideoMessaging:{name:"messagingPolicy.allowVideoMessages",defaultValue:!1},allowFluidCollaborate:{name:"messagingPolicy.allowFluidCollaborate",defaultValue:!1},enableInlineVideoMessageClosedCaptions:{name:"teamsMessagingConfiguration.enableVideoMessageCaptions",defaultValue:!0},enableCustomEmojiCreation:{name:"messagingPolicy.createCustomEmojis"},enableCustomEmojiDeletion:{name:"messagingPolicy.deleteCustomEmojis"},allowPrivateMeetingSchedulingPolicy:{name:"meetingPolicy.allowPrivateMeetingScheduling"},isMailboxDiscoverable:{name:"userPropertiesSettings.isMailboxDiscoverable"},isOnCloud:{name:"userPropertiesSettings.isOnCloud"},autodiscoverSettings:{name:"userPropertiesSettings.autodiscoverSettings"},allowCommunicationComplianceEndUserReporting:{name:"messagingPolicy.allowCommunicationComplianceEndUserReporting",defaultValue:!1},allowSmartReply:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableSmartRepliesForGroupChat:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableAnimatedEmojisInSmartReplies:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableSmartFilesSuggestions:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableSmartSchedulingSuggestions:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},allowMemes:{name:"messagingPolicy.allowMemes",defaultValue:!0},allowUserTranslation:{name:"messagingPolicy.allowUserTranslation",defaultValue:!1},chatPermissionRole:{name:"messagingPolicy.chatPermissionRole",defaultValue:"Restricted"},allowFullChatPermissionUserToDeleteAnyMessage:{name:"messagingPolicy.allowFullChatPermissionUserToDeleteAnyMessage",defaultValue:!1},allowOwnerDeleteMessage:{name:"messagingPolicy.allowOwnerDeleteMessage",defaultValue:!0},userInitiatedMode:{name:"feedbackPolicy.userInitiatedMode"},enableM365ChatFeedback:{name:"feedbackPolicy.ocpsAllowSendFeedback"},enableM365ChatFeedbackLogCollection:{name:"feedbackPolicy.ocpsAllowLogCollection"},allowSecurityEndUserReporting:{name:"messagingPolicy.allowSecurityEndUserReporting",defaultValue:!1},designerForBackgroundsAndImages:{name:"messagingPolicy.designerForBackgroundsAndImages"},userLanguageAccountSettings:{name:"userLanguageAccountSettings"},allowImmersiveReaderV2:{name:"messagingPolicy.allowImmersiveReader",defaultValue:!0},allowGroupChatJoinLinks:{name:"messagingPolicy.allowGroupChatJoinLinks",defaultValue:!0},allowUserDeleteChat:{name:"messagingPolicy.allowUserDeleteChat",defaultValue:!1},teamsUserPhoneNumbers:{name:"teamsUserPhoneNumbers"},enableInOrganizationChatControl:{name:"teamsMessagingConfiguration.enableInOrganizationChatControl",defaultValue:!1},inOrganizationChatControl:{name:"messagingPolicy.inOrganizationChatControl",defaultValue:"BlockingDisallowed"}},peopleTargeting:{tagPermissions:{name:"targetingPolicy.manageTagsPermissionMode"},ownersCanOverwriteTagSettings:{name:"targetingPolicy.teamOwnersEditWhoCanManageTagsMode"},suggestedTags:{name:"targetingPolicy.suggestedPresetTags"},customTagMode:{name:"targetingPolicy.customTagsMode"},disallowedSources:{name:"targetingPolicy.disallowedSources"}},smb:{tenantSizeSegment:{name:"smbTenantSettings.tenantSizeSegment"}},teamsAndChannels:{allowPrivateChannelCreation:{name:"teamsAndChannelsPolicy.allowPrivateChannelCreation"},allowSharedChannelCreation:{name:"teamsAndChannelsPolicy.allowSharedChannelCreation"},allowEmailIntoChannel:{name:"clientSettings.allowEmailIntoChannel"},restrictedSenderList:{name:"clientSettings.restrictedSenderList"},allowChannelSharingToExternalUser:{name:"teamsAndChannelsPolicy.allowChannelSharingToExternalUser"},allowGuestUser:{name:"clientSettings.allowGuestUser",defaultValue:"false"},showExternalTenantOnboardingSupportPage:{name:"tenantSettingsV2.miscellaneous.showTenantSupportPage",defaultValue:!1},externalTenantOnboardingSupportPageURL:{name:"tenantSettingsV2.miscellaneous.tenantSupportPageURL",defaultValue:""}},chat:{allowRoleBasedChatPermissions:{name:"clientSettings.allowRoleBasedChatPermissions",defaultValue:!1}},localization:{userAccountLocaleCodePolicy:{name:"userLanguageAccountSettings.defaultDisplayLanguage.locale"}},broadcast:{sdnConfiguration:{name:"broadcastMeetingPolicy.broadcastMeetingSDNConfigurationJsonBlob"}},feedback:{receiveSurveysMode:{name:"feedbackPolicy.receiveSurveysMode"},allowEmailCollection:{name:"feedbackPolicy.allowEmailCollection"},allowScreenshotCollection:{name:"feedbackPolicy.allowScreenshotCollection",defaultValue:!1},allowLogCollection:{name:"feedbackPolicy.allowLogCollection",defaultValue:!1},enableFeatureSuggestions:{name:"feedbackPolicy.enableFeatureSuggestions"},ocpsSendFeedback:{name:"feedbackPolicy.ocpsSendFeedback"},ocpsSendSurvey:{name:"feedbackPolicy.ocpsSendSurvey"},ocpsLogCollection:{name:"feedbackPolicy.ocpsLogCollection"},ocpsEmailCollection:{name:"feedbackPolicy.ocpsEmailCollection"},ocpsScreenshotCollection:{name:"feedbackPolicy.ocpsScreenshotCollection"},ocpsEmailCollectionDefault:{name:"feedbackPolicy.ocpsEmailCollectionDefault"},ocpsScreenshotCollectionDefault:{name:"feedbackPolicy.ocpsScreenshotCollectionDefault"},ocpsContentCollectionDefault:{name:"feedbackPolicy.ocpsContentCollectionDefault"},ocpsSendCopilotFeedback:{name:"feedbackPolicy.ocpsSendCopilotFeedback"}},virtualEvents:{eventAccessTypePolicy:{name:"teamsEventsPolicy.eventAccessType"},allowTownhallsPolicy:{name:"teamsEventsPolicy.allowTownhalls"},allowEventIntegrationsPolicy:{name:"teamsEventsPolicy.allowEventIntegrations"},allowedWebinarTypesForRecordingPublish:{name:"teamsEventsPolicy.allowedWebinarTypesForRecordingPublish"},allowedTownhallTypesForRecordingPublish:{name:"teamsEventsPolicy.allowedTownhallTypesForRecordingPublish"},allowEmailEditingPolicy:{name:"teamsEventsPolicy.allowEmailEditing"},allowedQuestionTypesInRegistrationFormPolicy:{name:"teamsEventsPolicy.allowedQuestionTypesInRegistrationForm"}},userResources:{isSfbCloud:{name:"userResourcesSettings.isSfbCloud"},isSipEnabled:{name:"userResourcesSettings.isSipEnabled"},isSfbCloudInBVD:{name:"voiceAdminSettings.isSfbCloud"},isSipEnabledInBVD:{name:"voiceAdminSettings.isSipEnabled"},licenseSettings:{name:"userResourcesSettings.licenseSettings"},licenseType:{name:"userResourcesSettings.licenseType"},userClassifications:{name:"userResourcesSettings.userClassifications"},isTenantAdmin:{name:"userResourcesSettings.isTenantAdmin"}},coach:{enableCoachByPolicy:{name:"meetingPolicy.allowMeetingCoach"}},meetingOptions:{enableWatermarkCustomizationForScreenSharing:{name:"meetingPolicy.allowWatermarkCustomizationForScreenSharing"},enableWatermarkCustomizationForCameraVideo:{name:"meetingPolicy.allowWatermarkCustomizationForCameraVideo"},enableVoiceIsolation:{name:"meetingPolicy.voiceIsolation"}},sdk:{licenseCategories:{name:"tenantSettingsV2.licenseCategorySettingsMap"}},distributionLists:{allowChatWithGroup:{name:"messagingPolicy.allowChatWithGroup",defaultValue:!0}},ageConsent:{ageGroup:{name:"ageConsentPolicy.ageGroup"}},marketplace:{defaultMarket:{name:"deviceStoreMetadata.market"},deviceStorePurchaseEnabled:{name:"deviceStoreMetadata.purchaseEnabled",defaultValue:!1},deviceStoreAdminEnabled:{name:"deviceStoreMetadata.storeVisibility",defaultValue:!1},deviceStoreMarket:{name:"deviceStoreMetadata.market"}},virtualAppointments:{enableSmsNotificationsPolicy:{name:"teamsVirtualAppointmentsPolicy.enableSmsNotifications"}},edu:{parentDigestEnabledType:{name:"educationAssignmentsAppPolicy.parentDigestEnabledType"}},places:{enableWorkLocationDetectionPolicy:{name:"teamsWorkLocationDetectionPolicy.enableWorkLocationDetection"}}},namespaces:["userPropertiesSettings","meetingPolicy","messagingPolicy","broadcastMeetingPolicy","teamsEventsPolicy","callingPolicy","voiceAdminSettings","adminSettings","policySettings","teamsMeetingBrandingPolicy","syntheticAutomatedCallPolicy","tenantSettingsV2","tenantVoiceSettings","userResourcesSettings","teamsEmergencyCallingPolicy","teamsEmergencyCallRoutingPolicy","teamsUserPhoneNumbers","teamsMediaConnectivityPolicy","callParkPolicy","teamsEnhancedEncryptionPolicy","onlineDialinConferencingPolicy","teamsVoiceApplicationsPolicy","teamsOfficeCloudPolicy","voicemailPolicy","teamsMediaLoggingPolicy","branchSurvivabilityPolicy","vdiPolicy","updateManagementPolicy","clientSettings","feedbackPolicy","tenantSiteUrl","tenantSiteUrlAndDomains","teamsUpdateManagementPolicy","teamsAppPermissionPolicy","teamsAppSetupPolicy","filesPolicy","externalAccessPolicy","teamsLinkPolicy","educationSettings","teamsMessagingConfiguration","userLanguageAccountSettings","targetingPolicy","smbTenantSettings","teamsAndChannelsPolicy","ageConsentPolicy","deviceStoreMetadata","teamsVirtualAppointmentsPolicy","educationAssignmentsAppPolicy","teamsWorkLocationDetectionPolicy"],controllingFeatureFlags:{teamsEmergencyCallingPolicy:{category:"calling",flagName:"enableTeamsEmergencyCallingPolicyFetch"},teamsEmergencyCallRoutingPolicy:{category:"calling",flagName:"enableTeamsEmergencyCallRoutingPolicyFetch"},teamsUserPhoneNumbers:{category:"calling",flagName:"enableTeamsUserPhoneNumbersFetching"},teamsMediaConnectivityPolicy:{category:"calling",flagName:"enableMediaConnectivityPolicy"},teamsVoiceApplicationsPolicy:{category:"calling",flagName:"enableTeamsVoiceApplicationsPolicyFetch"},teamsOfficeCloudPolicy:{category:"calling",flagName:"enableTeamsOfficeCloudPolicyFetch"},tenantSiteUrlAndDomains:{category:"extensibility",flagName:"enableTenantSiteUrlAndDomains"},teamsAppPermissionPolicy:{category:"extensibility",flagName:"enableTeamsAppPermissionPolicyFetch"},teamsAppSetupPolicy:{category:"extensibility",flagName:"enableTeamsAppSetupPolicyFetch"},educationSettings:{category:"guardians",flagName:"enableEducationSettingsFetch"},userLanguageAccountSettings:{category:"messaging",flagName:"enableUserLanguageAccountSettingsFetch"},smbTenantSettings:{category:"smb",flagName:"enableFetchingSmbTenantSettings"},ageConsentPolicy:{category:"ageConsent",flagName:"enableAgeConsentPolicyFetch"},deviceStoreMetadata:{category:"marketplace",flagName:"enableDeviceStoreMetadataFetch"},teamsWorkLocationDetectionPolicy:{category:"places",flagName:"enablesTeamsWorkLocationDetectionPolicyFetch"}}},Uz={cdlWorkerOnly:{activity:["activityComponentLoggerWaitTime","appsAllowedForActivities","appsDisallowedForActivities","disableCountValidator","disabledActivities","enableActivityMarkAsReadClientLie","enableActivityProvider","enableActivitySlicesFramework","enableAppActivitiesContextualSettings","enableBadgingInHeadlineSlices","enableBatchingForNewActivities","enableBotFeedItems","enableCachedSyncWindowToPreventDuplicateSyncJobs","enableChannelSpecificContextualSettings","enableContextualSettingsPhase1","enableDLPActivity","enableFeedProcessorAPICallBatching","enableHydrationDropOnUserRemoval","enableLoadNoneStartupStrategy","enableMarkAllAsReadLogic","enableMarkAsReadNetworkCallThrottling","enableMissedCallFeedCallBackAction","enableMissedCallFeedChatAction","enableSplitJoinInviteActivityType","enableThreadedChannelActivities","enableThreadedChatActivities","enableUserOnboardingToTeamNavigationInFeed","getConversationMaxBatchSize","honourAppsAllowlistForGraphActivities","markAsReadAPIThrottleRate","maxMsgsToCheckForReplyChainParticipant","mtmaMissedNotificationsProfilePicturePrefix","preventCommunitiesAFHydrationFailureOnConvNotFound","timestampClashTolerance"],activityNotification:["defaultMissedActivityEmailDelayOption","disableEmailSettingsForUserGraphSettings","enableAllTeamsChannelsMacTooltip","enableCoachmarkTimestampInUPS","enableGraphSettings","enableRefactorForGraphSettings","enableTeamsAndChannelsSettings","enableTrimGraphSettingsPayload"],artifactsPlatform:["artifactsPlatformAttachmentsCacheExpiryTimeInMinute","artifactsTableDataExpireDays","artifactsTableDataRefreshTimeInMinute","currentArtifactsPlatformTableVersion","enableArtifactsPlatformAttachmentsBatchSync","enableArtifactsPlatformAttachmentsSync","enableArtifactsPlatformBatchStore","enableLastUpdateTimeBasedDBCleanup","enableMeetingArtifactsBatchSync","enableMeetingArtifactsSync","enableMeetingRecommendationsBatchSync","enableMeetingRecommendationsSync","enableVersionBasedDBCleanup","meetingRecommendationsCacheExpiryTimeInMinute","meetingRecommendationsTableDataExpireDays"],auth:["disableThrowingErrorIfSkypeTokenIsEmpty","prefetchTokens","useForceRenewInSkypeTokenRetry"],autosuggest:["appSuggestionsExperienceType","disableSubstrateTCC","discoverServiceTimeoutInMs","domainScopingConfig","enableAdditionalPropertiesInSubstrateChat","enableAdditionalUserTypes","enableAppSuggestions","enableAutosuggestTopHits","enableClassicAttachments","enableDiscoverSurfaceEntryForAutosuggest","enableEmpty3SZQOnColdBoot","enableExternalPhoneSearchSuggestions","enableFeedbackForAutosuggest","enableGroupChatRosterSearch","enableMTOLabelInPowerbar","enableMTOSuggestions","enableMessageSerpEntry","enablePeoplePopOutChat","enablePopOutChat","enablePrivateChannel","enableQuerySuggestions","enableReloadingOfNamespace","enableRenamedGeneralChannelInAutosuggest","enableSharedChannel","enableSortingLocalTCCSearch","enableSubstrateSuggestions","enableTopNSuggestions","enableUnnamedGroupChatsFrom3S","enableVisioOneNoteFileType","localSearchDelayInMs","minQueryLengthConfig","minQueryLengthFederatedUsers","slashCommandSubstrateScenario","suggestionEntityTimeoutConfig","zeroQueryExperienceType"],calling:["enableCallGroupNotification","enableNativeCallsApp","enablePersonSchemaForCallHistory","skipCapiv3MigrationCheck"],cdlWorker:["blockedFolderOperationsWithoutSuccessfulMigration","conversationFolderFallbackDefaults","conversationFolderRemappings","disableConvIdToFolderIDMapValidation","disableConversationMappedToOneFolderValidation","disableFailedToFetchConversationsCleanup","disableSynchronizedConvIdToFolderIDMapUpdates","enableConvIdToFolderIDMapLogging","enableDeferredSyncForMissingConversationsInFolders","enableNonBlockingPinnedToFavoritesMigration"],channels:["channelInfoPaneCsaRequestDebounceTime","channelInfoPaneDeltaSyncThresholdInMS","channelInfoPaneGetReplyChainsCount","channelInfoPaneRecentContributorsRequestDebounceTime"],chatList:["smbAllDirectorySuggestedContactsExtraUsersToFetch","smbAllDirectorySuggestedContactsLimit","smbTotalSuggestedContactsLimit"],chatService:["maxChatsToShowSuggestedContacts","maxPinnedChats"],consumerGroups:["createOneOnOneTwoWaySmsChatEndpoint","inviteOffNetworkEndpoint","locationSharingQueryEndpoint","sendMessageEmailToMembersEndpoint"],core:["appsUsageSyncStrategyRefreshIntervalInMs","disablePoliciesSyncStrategy","enableChatBadgeCount","offlineActionsManagerDefaultActionExpirationInMs","offlineActionsManagerDefaultCrossSessionRetries","offlineActionsSyncStrategyRefreshIntervalInMs","offlineSupportedResolvers","policiesSettingsSyncStrategyRefreshIntervalInMs","policiesSyncStrategyRefreshIntervalInMs"],discoverSurface:["disablePollingUntilFirstReq","discoverBackgroundSyncOptimization","discoverCDLLoadMoreCount","discoverChannelsRequiredConfig","discoverHydrationOptimization","discoverResyncOnUserActivity","enableDataFetchOptimizer","enableDataSync","enableDiscoverDataValidation","enableItemComparison","enableZeroChannelSyncSkip","minPageSizeForLoadMoreAPI"],extensibility:["adaptiveCardsv2CacheLimit","aggregatedAppEntitlementsSyncDebounceMaxWaitMs","aggregatedAppEntitlementsSyncDebounceMs","appAmsImagesManagerConfig","appDefinitionsCacheExpirationSeconds","appEntitlementsCacheExpirationSeconds","appIdList","appInstallOptionChatLimit","appInstallOptionMeetingLimit","appStatusesCacheExpirationSeconds","appsRatingTrackerConfig","appsUsageMFUCacheSizeInDays","createAppEntitlementAllowedErrors","customAppPolicyCacheExpirationSeconds","defaultAppDefinitionsForAnonymous","defaultReviewsRequestFilter","disableAppTenantOrgPush","disableFilesAppSupportForGuestUsers","disableInstalledChatAppsPreCheckLogic","enableACv2JITInstallFromCDLv2","enableAboutForPersonalApps","enableAggregatedAppEntitlementsSyncDebounce","enableAppAmsImagesFetch","enableAppBarNetworkOnlineSubscription","enableAppMTAPIs","enableAppPolicyPush","enableBlockUnblockBotChatForPersonalApps","enableBotDefinitionSyncWithProfileManager","enableCertificationFilters","enableClientSideLocalizationOfAppBarApps","enableContextlessChatAppsPreCheckLogic","enableContextlessInstall","enableContextlessUpgrade","enableDefaultAppDefinitionsForAnonymous","enableInstalledAppQueryFromTab","enableInstalledAppsUpdateSubscription","enableMTSyncForAppsUsageMFU","enablePaginationForApps","enablePersonalLobApps","enablePlatformPersonalApps","enablePreCheckLogicForMeetings","enablePricingFilters","enableShareForPersonalApps","enableShareForTemplatedApps","enableUserSpecificContentInAdaptiveCards","enableUserSpecificContentInChannels","isAllowedAppList","isSubmitStagingAppsAllowed","outgoingWebhookConstants","priorityStaticTabAppIds"],files:["p2pFilesListService"],gallery:["enablePhotosTab"],growth:["enableMFUProfileCleanup","enableMfuContactsInPowerBar","enableTflJoinLinkSuggestion","enableTflPowerBarZeroState","espAllIrisPlacementIds","irisAllCampaignCache","irisCacheThrottleEmptyResponse","irisCacheValidTimeWhenCampaignExists","mfuContactsSyncRefreshIntervalInMs","mfuProfileCacheCapacity"],guardians:["enableAnnouncementsChatSuppression","membersAndRelatedContactsCacheExpirationSeconds","relatedContactsCacheExpirationSeconds","suppressAddMemberMessagesForGuardianChats"],host:["enableSyncEngine"],meet:["disablePrefetchOnStartup","enableFetchMRE","enableThumbnailFromMCO"],messaging:["enableChatIdValidationOnPin","enableCommentStreamReceiveHTMLSanitization","enablePinnedChatListValidation","enableSelfChatAutoPin","enableUnhidePinnedChats","msgEnableSfCInteropChats","oneOnOneTwoWaySMSThreadsInSearchEnabled","smartNavigatorTimeOutMillisecond","suggestedScheduleMessageDeliveryPreWorkHoursBufferMinutes","tflSmsFriendlyNameCacheExpiryInMinutes"],notifications:["disableCommunitiesMessageUpdateToasts","enableAppBadgeVNext","enableCommunitiesCalendarEventsToastNotifications","enableCommunitiesMembershipJoinRequestCreatedToastNotifications","enableCommunitiesMembershipPromotedToAdminToastNotifications","enableCommunitiesMembershipRequestToJoinToastNotifications","enableCommunitiesMentionEveryoneToastNotifications","enableCommunitiesMentionUserToastNotifications","enableCommunitiesNotificationFiltering","enableCommunitiesPersonalReplyToastNotifications","enableCommunitiesPostReplyNotificationsWebhook","enableCommunitiesPostToastNotifications","enableCommunitiesReactionsToastNotifications","enableCommunitiesReplyNotificationsActivityManager","enableCommunitiesReplyToReplyToastNotifications","enableCommunitiesReplyToastNotifications","enableDropLongpollMessagesFromReadThreads","enableNotificationDeduplication","enablePriorityContactsNotifications","enableSettingsPageWarnUser","enableSkypeUsersIcons","enableSplitJoinInviteActivityTypeToast","enableUrgentNotifications","notificationHistoryCacheSize","showInviteJoinedNotification","taskListCreatedNotification"],notificationsEngine:["enableConversationsReminder","intervalMinsBetweenMessageShouldBeShownConversationsReminderNotification","intervalMinsBetweenRemindersConversationsReminderNotification","intervalMsCdlStrategy","intervalMsMeetNowLinksNotification","intervalMsXDaysOfInactiveStatusNotification","timesToBeShownMeetNowLinksNotification","timesToBeShownXDaysOfInactiveStatusNotification"],people:["allowedShortExpiryForBotMris","botProfileExpiryInMinutes","bufferTimeForSuggestedContactsEvent","capiV3ContactsPageSize","capiV3ContactsSyncStrategyOnIntervalJitter","capiv3ContactsMaxCount","capiv3ContactsSyncMaxRetryCount","contactsSyncDeltaIntervalForLargerSetInMilliSeconds","contactsSyncDeltaIntervalInMilliSeconds","contactsSyncFetchPageSize","contactsSyncServiceEndpointManagerMaxRetries","contactsSyncStrategyIntervalInMilliSeconds","ddrProfileExpiryInMinutes","ddrProfileUpdateSyncChunkSize","ddrProfileUpdateSyncRefreshIntervalInMs","default3SScenarioName","default3SSearchResultsCount","defaultZeroState3SResultsCount","emailAndPhoneChunkSize","enableAddingDefaultContactsSyncSettings","enableAppendingImageUriForGroup","enableCacheSearchChannelAtMentionOnFailure","enableCachedProfileBackgroundFetch","enableCachedUserDataLoader","enableCallerInfoSanityCheckForProfileAPIs","enableEmailSearchForLocalProfileSearch","enableEmitProfilesUpdateEvent","enableEndpointsManagerForPeopleService","enableEndpointsManagerOnContactsSyncService","enableEndpointsManagerOnImplicitContactsService","enableEndpointsManagerOnPeoplePickerService","enableExpiryForWorkingSetProfiles","enableGroupAvatarsFor3SSuggestions","enableMTCallToSendKeepAliveSignalToSCD","enableMTCallToUnsyncSourceFromSCD","enableOfflineErrorCheckForPeopleScenarios","enablePrivateChannelsInPeoplePicker","enableProfilePictureV2","enableProfileUpdateSyncWorkflowOnAppLongInactive","enableProfileUpdateSyncWorkflowOnInterval","enableRankedSyncContacts","enableRefreshMeProfileOnStartUp","enableSetEmptyAvatarETagToSignedInTime","enableSfCProfileFetch","enableSharedChannelsInPeoplePicker","enableSubstrateInstrumentation","enableSubstrateSuggestions","enableSubstrateTopNAndWorkingSetComparison","enableSyncContactInteropStatus","enableSyncContactsSortingOnRank","enableTflProfileFetch","enableTflUsersOnlyForExternalUsersSearch","enableTfwUserProfileFetch","enableThrottleUnknownUserFetch","enableTopNSuggestions","enableUseInitialsForAvatarAsDefault","federatedProfileChunkSize","federatedProfileExpiryInMinutes","fullSyncRefreshTimestampOnECS","groupMaxSearchResultsFrom3S","includeOnlyPrimaryAliasInSuggestedContacts","includeOnlyRankedContacts","includeSearchInUpn","localSearchDelayInMs","maxBatchSizeForExternalUsers","maxChannelResultsFrom3S","maxSearchResultsFromCache","maxTeamResultsFrom3S","maxUserActionAllowedOnSyncBanner","mtoProfileExpiryInMinutes","nonWorkingSetProfileExpiryInMinutes","peopleBackfillTimeoutInMs","peopleCoreSyncStrategyOnIntervalJitter","peopleCoreSyncStrategyRefreshIntervalInMs","peopleMaxSearchResultsFrom3S","peopleServiceEndpointManagerMaxRetries","profileExpiryInMinutes","profileFetchChunkSize","profileFetchWorkingSetDeltaRefreshIntervalInMs","sharedChannelProfileChunkSize","shouldMakePeopleDBCall","shouldRemoveFormatCharacters","skypeConsumerFetchChunkSize","substrateSearchTimeOutInMs","syncBannerDisplayInterval","tflConsumerFetchChunkSize","tflProfileExpiryInMinutes","tflProfileFetchChunkSize","unknownUserBackroundRefreshThrottleInMinutes","unknownUserFetchStopThreshold","unknownUserFetchThrottleInMinutes","unknownUserFetchThrottleThreshold","useChatDataFromSubstrate","useUserLevelTimestampForAvatarETag","workingSetFetchPageSize","workingSetFetchTopNSize","workingSetProfileExpiryInMinutes","workingSetSyncStrategyRefreshIntervalInMs"],peopleTargeting:["disableEMInTagsAtMention","enablePeopleTargetingCDLManager"],presence:["debouncePublishPresenceTimeInMs","enableExtendedLogging","enableHandleSetPresenceSuccess","enableNoOpResponseTransformForPublishPresence","enablePresenceReportActivityWatcher","enableSerializingPublishPresence","enableStatesAggregationForUserActivity","getPresenceDebounceTimeInMs","getPresenceDebounceTimeMaxInMs","maxMrisToTrackPresence","maxNumberOfUpsEndpointIdsPerDevice","pendingMriListSyncDelay","presenceMriEntriesLogLimit","presencePostHeartbeatIntervalInMs","presencePostHeartbeatTrouterIntervalInMs","presenceReportActivityWatchIntervalInMs","presenceStrategyPollingIntervalInMs","presenceSyncIntervalInMs","removePresenceTrackingInfoOnCDLUnsubscribe","shouldCheckMachineState","shouldDebouncePublishPresenceWhenStateChange","shouldSetUserActivityInTrouterNotificationsProvider","shouldUnsetTrouterDisconnectedTimestamp","subscribePresenceTimeout","trackingPresenceUpdateDebounceTimeInMs","trackingPresenceUpdateDebounceTimeMaxInMs"],queues:["enableQueuesApp","queuesHistoricReportingServiceSettings"],searchCommon:["enableFullTextSearchOnTopN","maxTopNFetchSize","noOfResultsToLoadFromTopN","scenarioNameForSubstrateTopN","topNSuggestionsCacheExpiry"],smb:["enableExternalSuggestedTflUsersOnly"],sync:["channelReplyChainsToPrefetchInStore","chatReplyChainsToFetch","chatRetentionCount","chatServiceGapDetectionDebouncePeriodInMins","chatsStartupJobDeltaPageSize","chatsStartupJobPageSize","clearHistoryPruningBatchSize","conversationEventThrottlingOptions","conversationGapsThresholdForSync","conversationPruningBatchSize","conversationPruningIntervalDays","conversationsFetchDebounceInvokeOnTrailing","conversationsFetchDebounceMaxWaitMs","conversationsFetchDebounceMs","conversationsSyncDebounceInvokeOnTrailing","conversationsSyncDebounceMaxWaitMs","conversationsSyncDebounceMs","currentConversationTableVersion","currentConversationVersion","deadConversationPruningBatchSize","deepLinkNavigationThreshold","defaultWorkflowTimeoutSeconds","delayTrouterEventsUntilRegistered","deltaSyncDebounceInvokeOnTrailing","deltaSyncDebounceMaxWaitMs","deltaSyncDebounceMs","deltaSyncJitter","disableBatchedLegacyConversationUpdateEvent","disableBotMemberMergeV2","disableBotSplitForSoloGroupChats","disableCancelJobOnAuthNetworkUnavailable","disableCancelingTimeoutOnIntervalComplete","disableCleanStartupJobsOnAuthUp","disableConversationSupportedCheckForLongpollUpdate","disableConversationVersionFiltering","disableDetectResolveableReplychainGap","disableDisconnectBannerOnStartupForTrouter","disableFolderMigrationRetryOnInterval","disableIgnoreThreadUpdateOfSharedChannelParentTeam","disableInteropOneToOneChatFetch","disableInvalidThreadVersionCheck","disableIsReplyChainSyncedCheckInRelatedMessageSyncWorkflow","disableLastMessageConvSourceUpdate","disableLegacyLastMessageUpdateComparison","disableLieLastMessageResolve","disableLowRangeExclusiveOverride","disableMergeThreadProperties","disableMessageIdFetchValidation","disableNetworkFetchForMissingMessageInGetReplyChain","disablePartialLoadConversationNetworkFetch","disableRelatedMessageSyncOptimization","disableReplacingUnjoinedChannelsWithTopics","disableReplyChainResponseMissingMessageDetection","disableResolveablesFilteringInReplychains","disableScheduledMessageDeliverySuggestionWorkingHoursCache","disableSkipAccessCheckForSharedChannel","disableSyncMessagesPrefetch","disableTempjoinChannelIfExpired","disableTopicsCheckForReplyChainSync","disableTopicsCheckToDetermineChannelHardDelete","disableUsingTrouterForNetworkState","draftsConversationSyncStartOfSyncWindowDays","emitCreatorMRIs","enableChatMessageVersionFilterForDbWrites","enableChatNavigationOnChatServiceEventSubscription","enableClientLieInsertionValidation","enableConversationFetchResiliency","enableConversationPruning","enableConversationSyncForLargeChannelTempJoin","enableDataSpillageHardDeletion","enableDraftsConversationSync","enableDraftsStalenessDetection","enableErrorThrowOnEmptyConversationFetchResult","enableExecutingJobPriorityUpdate","enableFakeDraftLieResolvable","enableForcedMaintenanceWorkflow","enableGapDetectionForMessages","enableInMemoryCleanup","enableKillingTrouterConnection","enableL2chSync","enableLoggingOfRosterSummaryUpdate","enableMessageForReplyChainTrim","enableMessageIdLogs","enableMissingMessagesBanner","enablePersistencePruning","enableProcessingAndMutatingEmotionProperty","enableReplyChainPrefetchFromDb","enableReplychainMessagesPartialLoad","enableRestartNotificationProviderOnAuthUp","enableRestoreInvalidConsumptionHorizon","enableRetentionBasedLastMessageNuke","enableRetentionHorizonBasedPruning","enableRetentionHorizonV2Property","enableRetryNetworkFetchForSingleReplyChainFetchFailure","enableScheduledAndInstantMeetingsInRecents","enableSkipCNSEndpointCreation","enableSkypeMessageClassSanitization","enableStartNotificationProviderOnAuthUp","enableStartupStrategiesUnblockingForAnonymous","enableStartupSyncOnAuthUp","enableStartupSyncOnMachineActive","enableStartupSyncOnMachineUnsuspend","enableStopNotificationProviderOnRegistrationFailure","enableStopNotificationProviderOnTerminalError","enableStoppingTrouterNotificationProviderOnRefreshTokenFailure","enableStrictMessageSanitization","enableTPSGetPushUpdatesWithRetry","enableThreadDetailsFetch","enableThreadDetailsSyncOnNavigation","enableTokenRefreshOnTokenRevocation","enableTokenRefreshOnTrouterClaimsChallenge","enableTriggerSyncForGapDetection","enableUseTrouterStateDirectly","enableUsingChatTitleCacheInResolvers","enableUsingVerifiedSenderNameFromMessage","enableVerboseWorkerLogging","enableVivaInsightsLicenseCache","enableWorkflowDebouncer","enabledConvertToRCSJForLargeChannelDuringDeltaSync","eventLoopBusynessTimeoutValueInSeconds","excludeInactiveStateFromActiveState","extendHistoryPageSize","fanoutRosterSizeForLargeChannel","feedsStoreSettings","forceMaintenanceIntervalSeconds","forcedMaintenanceJobs","gqlResponseTrackerCleanupIntervalMs","groupChatsSyncJobPriority","inMemoryCleanupBatchSize","isReclaimEnabled","isTrouterConnectionDependsOnRegistration","isVersionBasedDBCleanupEnabled","jobFrequencyTelemetryAllowList","jobFrequencyTelemetryIntervalMs","jobFrequencyTelemetryLookbackMs","legacyActiveConversationConfig","loadMissingMessagesLimit","maxConcurrentJobsByPriority","maxDeltaSyncSkipCountFor403","maxMembersForMeetingForTitleCaching","maxMessageIdCountToLog","maxSyncTimeMultiplier","messageVerifiedSenderNameUsageValidityInSeconds","messagesGapThreshold","missingMessageReportingWaitIntervalMinutes","missingMessagesReportingConfig","modalityBasedConversationPruningBatchSize","mruChannelsSize","notificationProviderStateChangeHistoryLimit","outOfOrderWaitIntervalSeconds","overrideThreadTypeForPrivateFeeds","persistencePruningBatchSize","persistencePruningJobTimeOutSeconds","realTimeMessagingEventsLoggingPeriodInSeconds","requireValidAuthTokenBeforeDBCleanup","retentionPruningBatchSize","scheduledMessageDeliverySuggestionWorkingHoursCacheLengthSeconds","shouldCheckCachedTrouterEndpointOnDisk","shouldCleanupOnVersionBumpIfOffline","shouldSupportMachineState","shouldUseStartupSyncFailuresDuringIntervalSyncCheck","shouldUseStartupSyncFailuresDuringIntervalSyncCheckV2","skipIntervalForUnutilizedAcctConfig","startupJobTimeOutSeconds","suppressBotAddMemberLastMessageUpdate","syncEngineCommandDelay","syncIntervalSeconds","syncSchedulerDiagnosticsDebounceMs","syncSchedulerLongRunningTimeMs","syncSchedulerMaxJobCount","syncSchedulerStarvationTimeMs","threadDetailsSyncDebounceInvokeOnTrailing","threadDetailsSyncDebounceMaxWaitMs","threadDetailsSyncDebounceMs","threadRosterLimitForRelatedMessageSync","tpsSyncStrategyLoadTimeoutMs","unjoinedChannelPropertiesCacheTTLInMs","updateOnlineStateOnMachineStateChange","verboseWorkerLoggerMaxQueueLength","vivaInsightsLicenseCacheLengthSeconds"],teamsAndChannels:["channelMarkAsReadThrottleRate","disableExplicityAddCheckForSharedChannelBeforeHardDeleting","enableForceFetchUnjoinedConversation","teamsAndChannelsProvisioningServiceConstants"],telemetry:["cdlWorkerSamplingRules"],trouterService:["registrationMaxTTLInSeconds"],whatsNew:["enableBadgeInTaskBar"]},forwardToCdlWorker:{activity:["activityCustomizations","channelNotificationSettingsApiConfigs","channelNotificationSettingsUrl","enableActivityAppCommandResultHook","enableActivityDotBadge","enableActivityFeedForSubCommunity","enableActivityFeedItemDeletion","enableActivityFeedItemDeletionOnUI","enableActivityFeedItemDeletionWithToast","enableActivitySlices","enableAvatarUrlResolutionInActivityFeeds","enableChatLocationDisplayNameParity","enableCommunitiesCalendarEventsFeedItems","enableCommunitiesFeaturedActivity","enableCommunitiesFeedItems","enableCommunitiesInviteAcceptedActivity","enableCommunitiesOwnerPromotionActivity","enableEnhancedFilters","enableInviteeJoinedActivity","enableMTMAMissedNotificationsDotBadge","enableMTMAMissedNotificationsInTrustedUI","enableMTMANotificationsReadFromMaglevStorage","enableMTMANotificationsUnseenBehavior","enableMutePostInChannel","enableRealTimeUpdatesToMissedMTMANotifications","enableSeparateDateTimeParsing","enableUnreadToggle","enableVoicemailFeedItems","enabledCommunitiesActivities","enabledGenericActivities","enabledHeadlineSlicesInSimpleCollab","genericActivityDefinitions","localesWhereLastNamePreferred","mtmaNotificationsFetchMoreDebounceInterval","mtmaNotificationsPublishDebounceInterval","postNotificationUrl","slicesActivityTypeSubtypeMap","uisResourceURL"],activityNotification:["enableActivitySettingsV2","enableEnhancedSettingsExperience","enableEnhancedSettingsExperienceForApps","missedActivityEmailDelayOptions","notificationFeedSettingsNoiseThreshold"],ageConsent:["ageGroup"],artifactsPlatform:["channelMeetingAttachmentsMap","enable3SRTelemetry","enableChannelMeetingAttachmentsInMCO"],augloop:["resource","serviceUrl"],auth:["acquireTokenRetryDelayInMs","acquireTokenRetryableErrorCodeList","allowCdlWorkerToUpdateSetting","audience","authzResource","authzUrl","buildCloud","claimsChallenge401RetryMax","clientId","disableSTMFallback","disableSTMForAnonymousUser","disableSkipTokenRefreshForAnon","disableSkypeTokenOnCsa","disableSkypeTokenToMtInGtm","enableAsyncBatchScenario","enableCachedUser","enableMTO","enableRegionAndSTMHeadersOnCsa","enableSTMEnforcementCalendar","enableSTMHeaderForAuthZ","enableSTMSkypeCAECheck","enableSkypeTokenMigrationForMT","enableSkypeTokenMigrationForTrouter","enableTenantListPushUpdatesOverTPS","enableTokenMismatchCircuitBreaker","expectedErrors","forceRenewForAADToken","ic3CaeResource","ic3NonCaeResource","instanceUrl","maxAcquireTokenRetryForRetriableError","mtResource","mtResourceV2","regionGtmsEnv","requireSkypetokenForMT","retriableWebErrorMessage","sendMigrationHeaderToMtInGtm","skypeTokenMigrationEnabled","skypeTokenMigrationServiceInfo","stmFallbackMapTimerInHr","stmSourceList","tokenExpireOffsetSeconds","tokenExpireOffsetSecondsMin","webAuth"],autosuggest:["enable3SMessagesInQf","enable3SSharedChannelSuggestion","enable3sQueryTextSuggestionDelete","enableAppScopedSearchInVC","enableAppScopedSearchInVE","enableCenteredEchoQuery","enableCmdTextforShortcutsMac","enableContextualSearchEntryPointInASTypeahead","enableContextualSearchEntryPointInZQ","enableDomainScopingV1","enableEDUSersInAutosuggest","enableEndpointsManagerOnSubstrateSuggestionsService","enableExternalSearchSuggestions","enableHelpForAutosuggest","enableMirroringDomainScoping","enableMriFromServiceForMessage","enableQuickActions","enableSMSContactAutosuggest","enableSearchBoxAlignmentWithSerp","enableSearchIconOnFocus","enableSearchV2ForGuestInAutosuggest","enableSearchV2InPowerbar","enableSeeMoreForMessages","enableSerpCorsPreload","enableShortcutInPlaceholder","enableSlashCommand","enableSubstrateInstrumentation","gotoEnableRosterMatchForNamedGroups","gotoExperienceType","gotoSuggestionsCount","learningSlotConfig","pcsFilterConfig","serpCorsPreloadScenarioName","slashCommands","smsContactSupportedRegions","wpsSearchConfig"],calendar:["autodiscoverSettings","enableCalendarInviteRouting","enableM365Calendar","enableM365CalendarToggle","enableRememberAnonymousExternalContacts","enableRememberingExternalUsersInCalendar","enableResolvingInTenantEmailsInPasting","enableShortJoinUrl","enableWhiteboardCalendarTab","isOnCloud"],calling:["addCountryCodeDuringNormalization","allowNonE164Mri","allowPrivateCallingPolicy","callBlockingSettings","callHistorySettings","callLogsBlacklistedMRIs","commentStreamFetchPageSize","delegationSettingsPolicy","dialPlanPolicy","disableChatTranscriptTabForScheduleMeeting","disablePrivateLineActivityFeed","enableCallHistoryExternalTagging","enableCallableChannels","enableCallsAppPhaseStateMachine","enableCallsDotBadging","enableCapiV3Contacts","enableChatTranscriptTabOnReact","enableCoach","enableCoachByPolicy","enableCoachReportTabInChat","enableDeduplicateWindowingActions","enableDialPlans","enableDialpadCallingForOBOVoipCalls","enableDownloadAndDeleteTranscriptFromODSP","enableFixForDtmfTone","enableFormatNumberV2ForUI","enableFormattingFixForExtension","enableMaskAttendeesInMeetings","enableMediaConnectivityPolicy","enableMeetingChatAcceptBlockFlow","enableMeetingChatAcceptBlockFlowUI","enableMeetingChatYammerQnATab","enableMeetingDataAdditionalTelemetry","enableMeetingStartedNotificationV2","enableMeetingStartedNotificationV2ChatServiceBase","enableMeetingStartedNotificationV2ChatServiceBasedForChannels","enableMeetingsActiveCallIndicator","enableNewCallsBadging","enableNovaSpeedDial","enableParallelFocusAndContentUpdate","enablePrivateLine","enablePstnWithExtnFix","enableRemoveMeetingChatAcceptBlockAfterCallJoin","enableRichCallHistory","enableRichCallHistoryExtension","enableSLABossTabsForMW","enableSLACallHistory","enableSLACallHistoryFromPersonalHistory","enableStarfieldBackgroundsPromo","enableStreamChatFeature","enableTranscriptBlockDownloadAndDelete","enableUpdatedGetVoicemailsPath","enableWhiteboardAG08","enableWhiteboardAG09","enableWhiteboardChatTab","enableWhiteboardPolicy","forceCommentStreamForConversations","isFluidDefaultOn","meetingPolicy","sharedVoicemailServiceSettings","showCustomChatPaneErrorForNonChannelMember","stopNormalizationOnPlus","teamsVoiceApplicationsPolicy","useFluidWhiteboard","userIdPrefix","voiceAppBotIdPrefix","voicemailServiceSettings","yammerQnaGraphqlAuthEndpoint","yammerQnaGraphqlEndpoint"],cdlWorker:["blockedGqlOperationsInReducedMode","commentStreamMessageTrackerCleanupPeriodMs","commentStreamMessageTrackerMetricsPeriodMs","conversationUpdatesBatchingConfig","currentConversationTableVersionGCC","disableCommentStreamMessageTracker","disableFullLaunchIntentCheck","disableL2CHChannelsSync","disableLiveMessageUpdatesOverPNH","disableModalityCheckForConvUXSyncJobs","disableNoAccessChannelCleanup","disableOldMessageProcessInMessageSyncWorkflow","disableParseJsonStringInGetUserPreferences","disableReturningUnautheticatedUserFromBootstrapData","disableStaleConversationSyncOnNavigation","disableStartupJobInnerExceptionLogging","disableSyncForFavoritesRequireStatusFailed","disableSyncingPrivateAnnotations","disableUnreadCountCalculationInChannelActivitiesPublisher","eduRosterSyncIntervalInHours","enableAllowErrorsInSubscriptions","enableConvUXCachePruning","enableConvUXMessageCacheValidation","enableConversationFolderManagerStore","enableConversationFolderUpdatesOverTPS","enableConversationTableVersionGCC","enableConversationUpdatesBatching","enableExplicitPrivateAnnotationsFetchOnChatStartup","enableForceRecordAppsUsageExperimental","enableHasAccessToChannelV2ForFolderManager","enableLiveMessagesNotificationsOverANS","enableLiveMessagesNotificationsOverTrouter","enableLoggingMissingMessagesBetweenSyncAndWritingToStore","enableLongRunningTrouterConnectionForExperience","enableMTMAUserDataInMaglevStorage","enableModalityBasedCacheValidationDuringChatSwitch","enableReduceProfileFetchDuringConversationProcess","enableReliableSyncEngine","enableRepeatedDirectionalMessagesFetch","enableReplyChainChatUnwrapping","enableRetryingStartupStrategies","enableRetryingStartupStrategiesSubscription","enableRosterSync","enableSettingTeamsAndChannelsFolderViewType","enableStaleProfileFetchDuringConversationProcess","enableTelemetryOnAppStart","enableTelemetryOnMachineActive","forceGroupChatSync","limitActiveConversationsInMessagingSyncLogs","maxDirectionalMessageSyncJobMessageLimit","maxDirectionalMessageSyncJobRuns","maxMissingMessagesToReportToTelemetry","minDirectionalMessageSyncJobMessageLimit","nonHostAppSupportedResolvers","pageSizeForThreadedChat","portRegistrarAppConnectionsLimit","portRegistrarTimeoutInMs","recentChannelListPageSize","recentChatListPageSize","requestRateLimiterConfig","retryStartupStrategyMaxRetryLimit","retryStartupStrategyTimeoutInMins","rosterSyncFrequencyInHours","rosterSyncIntervalInHours","shouldSkipGroupChatSyncBasedOnIsPartialData","telemetryOnAppStartScenarioTimeoutMs","telemetryOnMachineActiveScenarioTimeoutMs","threadsToCheckForImpersonationLimit","trouterProductNameOverride"],channels:["enableAtMentionManyRecipientsWarningBanner","enableChannelCopilotInL1MessageAction","enableChannelCopilotInL2Header","enableChannelMessagesUserResolutionByUserDataLoader","enableConvUXinChannels","enableInfoPaneUserFetchingByUserDataLoader"],chat:["enableAvatarMoreErrorInfoLogging","enableBlockOneOnOneChatTopic","enableChatInfoPaneSharedSection","enableDebounceCreateChat","enableLandChatsToLastReadMessage","enableMultiplePinnedMessages","enableNewChatOnAppBarContextMenu","enableNewChatPopOut","enableRSVPBasedMeetingChatNotifications","enableRenderedMessagesVerificationForTelemetry","enableRoleBasedChatPermissions","enableUnreadThreadNavigationLogging","maxNumberOfMultiplePinnedMessages","numberOfSharedItemsInL1ChatInfoPane"],chatList:["bizChatMetaOSAppId","disablePinnedChatsInUserPreferences","enableBatchSubscriptionProfileFetchOptimization","enableBizChatMetaOSChatListEntryPoint","enableChatListRawErrorLogging","enableGraphApiDeleteChatSupport","enableGroupChatActiveCallIndicator","enablePopoutAction","enableRemoveMemberIds","enableShowMissedActivitiesInChatList","enableSmbAllDirectorySuggestedContacts","enableSmbChatListSuggestedContacts","enableSmbExternalChatListSuggestedContacts","enableSuggestedOrgGroupChats","enableSuggestedProjectGroupChats","smbSubstrateSuggestedContactsLimit"],chatService:["activeTimeoutCNSDefaultValue","botsAllowedForMedia","channelNotFoundRetryPolicy","chatServiceAfdHostnames","enablePartitioningBotMembersFor","enableRetryForNotFoundResponse","exponentialDelayFactor","exponentialDelayFactorForNotFound","maxEndpointFallbackCount","maxRetryCount","maxRetryCountForNotFoundResponse","maxRetryCountForOfflineResponse","maxRetryTimeMs","minRetryIntervalMs","minRetryIntervalMsForNotFound","pageSizeForFetchAnnotations","retryIntervalForOffline","retryMaxTimeMsForNotFound","streamChatRetryPolicy","useChatServiceAfd"],cmdMeetingArtifactsService:["cmdMeetingArtifactsServiceEndpoint","cmdMeetingArtifactsServiceResource","enableCMDMeetingArtifactsService","enableEndpointsManagerForCollabObjectService","enableMCPSTelemetryHeadersOverride","enableRegionalEndpointStrReplace","recoverableErrors","regionalArtifactsServiceEndpointPath","useRegionalArtifactsServiceEndpointResolver"],coach:["enableCoachReportTabInChat"],communities:["allowCommunitiesStatusBasedCancel","atMentionsSearchMembersLimit","atMentionsStorageExpiryTime","communitiesDeletedDanglingReplyRetentionInMinutes","communitiesFeaturedActivityAvatarUrl","communityAvatarMaxSizeInMB","enableCommunitiesApp","enableCommunitiesAtMentionsEveryone","enableCommunitiesAtMentionsWorkerResolver","enableCommunitiesCreate","enableCommunitiesDetailedBadgeCount","enableCommunitiesJoinDialogForPostlink","enableCommunitiesJoinFlyout","enableCommunitiesNicknames","enableCommunitiesNicknamesActivityFeed","enableCommunitiesNicknamesToast","enableCommunitiesOnNetworkInviteEmailToggle","enableCommunitiesReportAConcernTombstone","enableCommunitiesV2Mutations","enableCommunitiesV2Schema","enableDeltaProfilesFetchAtMention","enableDeltaProfilesFetchAtMentionUsingRosterDiff","enableGetCommunityThreadAfterSubcommunityCreation","enableMediaScanDeleteTombStone","enableMemberThreadDetailsSync","enablePinnedPostsForCommunities","hideCommunitiesDeletedDanglingReplies","nicknameExpiryTimeout","removeAdminCheckFromShareJoinLink","showTextScanDeletedPost","updateCommunitiesAtMentionLabelToEveryone","useV2FetchReplyChainApiForSubcommunities"],compose:["enableDesignerInChannelAnnouncementPost","enableSendPostAsEmail"],consumerGroups:["isConsumerGroupsServiceForGroupProfileAvatarsEnabled","useGroupsV2"],core:["appBarPinningDebounceTime","appBarUseAbbreviatedAppName","coreColdBootAppId","defaultAppMaxWaitTime","disableAppBarAppsSubscriptionThrottling","disableCachingM365SuggestedApps","disableTrouterConnectivityTracker","enable1JSGraphqlSearchBox","enableAppBarPinning","enableAppBarPinningDebounce","enableClientFiltersProvider","enableCommonMtHeadersWithSend","enableCommunitiesBadgeCount","enableEDUColdBootApp","enableEndpointsManagerOnPeopleTargetingService","enableEndpointsManagerOnTeamsPushService","enableFilteredSettingsSubject","enableImprovedActionOrderingAndReplay","enableLocaleFilterForFeatureFlags","enablePersonalFlyoutSearch","enablePersonalFlyoutSuggestions","enablePlatformAppsBadgeCount","enablePoliciesFetchViaEffectivePoliciesApi","enablePoliciesPushUpdates","enableProperStopSubscription","enableQueueExecutionOnFirstAttempt","enableRefactoredAppPinning","enableRelay","enableSettingsPushUpdates","enableSimpleCollabAutopin","enableSupermassiveCDL","enableSupermassiveResolverTracing","enableUnifiedRendererWorkerSettings","endpointsManagerBaseUrlResolutionTimeoutInMs","endpointsManagerDefaultRequestTimeoutInMs","endpointsManagerModelInitializationTimeoutInMs","graphQLTelemetry","policiesEndpointManagerConfig","policiesRetryFailedNamespacesMaxAttempts","policiesServiceScenarioTimeoutInMs","preloadedI18nNamespaces","searchBoxSuggestions"],crossDeviceAttach:["crossDeviceAttachInitialTime","crossDeviceAttachIntermediateTime","enableMobileAttachFilePicker"],csaService:["apiConstants","apiConstantsGCC","chatsStartupCallMaxRetryCount","chatsStartupCallMaxRetryInterval","chatsStartupCallMinRetryInterval","chatsStartupCallStalledInterval","conversationFolderActionsPreconditionRetryLimit","conversationFolderCallMaxRetryCount","conversationFolderCallMaxRetryInterval","conversationFolderCallMinRetryInterval","csaRetryOverrides","disableSkypeTokenForPinnedPostsAPIs","disableSkypeTokenForSystemMessagesAPI","disableStartupV2ApiForAnonymous","enableChatsStartupCallStalledTimeout","enableSkypeTokenForCSAReplyChainAPI","enableSkypeTokenForCSAStartupAPI","enableStartupUsingPartialData","enableStartupV3API","enableV3ChatsAPI","filterSystemMessagesGetReplyChains","httpTimeoutMillisGetCsaStartup","httpTimeoutMillisGetReplyChains","onlySkypeTokenForAllAPIs","phonelinkSmsApiResource","pinnedChannelCallMaxRetryCount","pinnedChannelCallMaxRetryInterval","pinnedChannelCallMinRetryInterval","replyChainCallMaxRetryCount","replyChainCallMaxRetryInterval","replyChainCallMinRetryInterval","replyChainRetryMaxNotAuthorizedRetries","skipCsaStartupForAnonymous","startupDataMaxRetryTimeMs","startupRetryIntervalAfterExponentialRetries","startupRetryMaximumExponentialRetries","startupRetryMaximumRetries","startupRetryMinimumInterval","startupUpdateRetryMaximumRetries","startupV3EnabledTenants","useCSARetryOverridesMap","useHostFromGtmTable"],diagnostics:["allowCacheStoredItemIDsInWorker","clientExtendedDiagnosticsData","consoleLogLevel","diagnosticsEventQueueMaxSize","diagnosticsLogsThrottling","disableExtendedDiagnosticsDataToggle","enableWorkerStoreDiagnosticsLogsInIDB","logReporterSendCountInterval","logReporterSendErrorCountInterval","logReporterSendTimeInterval","loggerReportCountInterval","loggerReportTimeInterval","loggerThrottleList","logsMarkInterval","savingLogsIntoIDBThrottleTime","throttleCapacity","throttleWindowSizeMs","workerDiagnosticsEventQueueMaxSize","workerDiagnosticsLogBufferArraySize","workerDiagnosticsLogsIDBObjectCount"],discoverSurface:["disableDiscoverForGuestUsers","enableDiscoverManagerRefactoring","enableHybridDiscoverSurface","hideUnjoinedChannelPost"],edu:["coldBootAppId","enableAssignmentsApp","enableStudentTeamifyCustomization"],esp:["categoryIdToNameMap","disabledCategories","enableEspDLSurfaces","enableEspPolicyDisabledCategories","enableSyntheticNotificationToast","irisEspCacheRefreshIntervalHours"],extensibility:["anonymousAppBasedLinkApps","anonymousAppBasedLinkPreconsentedApps","appBarNotToLandApps","appBasedLinkDomainPriorityApps","appDefinitionsCacheExpirationPeriodSeconds","appEntitlementsCacheExpirationPeriodSeconds","appInstallOptionsInitialRenderCount","appPrecachingMaxElapsedDaysSinceLastUsage","appPrecachingMaxEvictionRate","appPrecachingMaximumAppCount","appPrecachingMinimumAppUsagePerDay","appPrecachingOptInAppList","appStoreCategoryStringMapping","appStudioServiceAuthResource","appStudioServiceBaseURL","appSuggestionsExperiments","appsAllowedForDataLayerAccess","appsTenantSettingsLastUpdatedTimestamp","botDynamicCommandDebounceMaxWaitMs","botDynamicCommandDebounceMs","botDynamicCommandsSyncStrategyRefreshIntervalInMs","botDynamicSuggestedActionsDebounceMaxWaitMs","botDynamicSuggestedActionsDebounceMs","botImageCacheBustingConfig","cmsCollectionsMaxAgeInMinutes","defaultAppAllowList","defaultAppEntitlements","disableExtensionTabsContextFiltering","disableFetchBotInfoOptimization","disableMessageExtensionsInMeeting","disableStoreAppPolicySubscription","disabledTabAppIds","eduSelectAppEntityAllowList","enableAdminPrePinnedTabsInMeetings","enableAnonymousAppBasedLink","enableAppBarFlyout","enableAppBasedLink","enableAppBasedLinkDomainPriority","enableAppBasedLinkForApps","enableAppBasedLinkSsoAuth","enableAppBasedLinkUnfurlingPostSend","enableAppContentCacheWarmUp","enableAppDetailsConversationsManager","enableAppEntitlementsEtag","enableAppServiceInPlatformService","enableAppSupportForLWGChannels","enableAppSupportForPrivateChannelLaunchDate","enableAppSupportForPrivateChannels","enableAppSupportForSharedChannelLaunchDate","enableAppsFilterInFederatedChats","enableAppsUsageManagerLoadNoneStartupStrategy","enableAppsUsageManagerSyncWhileAwake","enableBannerLayouts","enableBotAvatarWithAppDefinition","enableBotDynamicCommandsSyncEngine","enableBotSsoV2","enableBotStreaming","enableCMSAppsStaging","enableCombineTabQueries","enableConversationalAppsFilterSyncEngine","enableCopilotExtensions","enableDeeplinkSupportForBuiltInTab","enableDynamicAppBar","enableEditorialArticlesInStore","enableEntityTypesFilters","enableFallbackClientStoreSearch","enableFileTabInFederatedChat","enableFilterPinnedAppsBasedOnPolicy","enableFlyoutAddAppButton","enableFlyoutQuickAccessSection","enableFlyoutSeeAllButton","enableForceFetchBlockedStoreAppsById","enableFrequentCollaborators","enableHeaderTabsInOneOnOneBotChat","enableLinkUnfurlingAppsQueryOptimization","enableLinkUnfurlingCardDismissIconPostSend","enableLowCodeWorkflowTemplatesSyncEngine","enableMRUSortingPersonalApps","enableMessageExtensionInTFLCommunities","enableNewAdminPreinstalledAppCoachmark","enableNewAppsCoachmarkRefactor","enableNukeUnsavedPinnedApps","enableOptimizedAppDefinition","enablePSTNExtensibility","enablePartnerApps","enablePersonalAppsPopOut","enablePinnedIncontextStoreApps","enablePowerbarMESearch","enablePowerbarUninstalledAppsSearch","enablePreconsentedBotAtMention","enablePreinstalledApps","enableReactTaskModuleForBIM","enableRichUrlPreview","enableServerSideStoreSearch","enableSharedInstalledAppsInManageApps","enableSortNewAppsBeforeMRU","enableStaticTabsPhase1","enableStaticTabsPhase1InChannels","enableStaticTabsWithPlatformTabs","enableStoreApiCapabilities","enableStoreAppPolicyCheck","enableStoreAppsContentCollectionsItemsRank","enableStoreDataSyncOnInit","enableStorePreview","enableStoreSyncEngine","enableStoreWorkerDataProvider","enableStorylineTabInOneOnOneChat","enableStrictTemplatedAppsFilter","enableSubscriptionAppsCategory","enableSuggestedActionsCommandsPrompt","enableSuggestionsServiceOdataEndpoints","enableSynchronizedSyncAndStorePut","enableTabsForFederatedChat","enableTabsInChatV2","enableTenantBasedAppRanking","enableTenantSiteUrlAndDomains","enableUAPCMSPreview","enableUnconsentedMRUApps","enableWorkflowsInChat","expectedAppBarCoreApps","extensibilityAppPickerUnifiedAppsChannelEntryPointConfig","extensibilityAppPickerUnifiedAppsChatEntryPointConfig","flyoutQuickAccessExcludedAppIds","flyoutQuickAccessSize","flyoutSeeAllButtonIndex","includeOpenAIPlugins","isSideLoadingInteractionEnabled","isUserPinningAllowed","linkUnfurlingAppDetailsFetchTimeoutInMs","lowCodeWorkflowTemplatesSyncStrategyRefreshInMs","meetingAddTabFlyoutConfig","meetingAddTabPanelConfig","messageExtensionFlyoutConfig","onlyUseUserPreferencesForDefaultAppCommand","pinnedIncontextStoreApps","ratingsOnRankingExperiment","selfChatFlyoutConfig","sharedChannelSupportedAppIds","skypeTeamsAppRankingEndpoint","storeApiCategoryMaxAgeInMinutes","storeApiMaxBackoffInMinutes","storeApiMaxOverviewItems","storeApiMinBackoffInMinutes","storeApiTemplatedAppsNoCache","storeAppItemsMaxAgeInMinutes","storeAppTenantBackground","storeAppTenantIcon","storeAppTenantLogo","storeAppTenantTextColor","storeAppsArticlesDoc","storeAppsCollections","storeAppsCollectionsDoc","storeBannerAppsCollectionsId","storeBannerCopilotAppsCollectionsId","storeContentCollectionsMaxAgeInMinutes","storeContentConfigs","storeContentHost","storeContentPreviewHost","storeDefaultDataProviderType","storePartnerAppsInitMaxAgeInMinutes","storePartnerAppsMaxAgeInMinutes","storePersistedCacheMinBuildVersion","storePersistedCacheMinTimestamp","storeProviderConfigs","storeSearchCircuitBreakerThreshold","storeSearchCircuitBreakerWaitAgeInMinutes","storeSearchQueryDebounceMs","storeSearchQueryTimeoutMs","storeSearchSettings","storeTemplateDefinitionsMaxAgeInMinutes","storeWorkerAppsSearchStrategy","storeWorkerDataProvidersList","suggestedAppsServiceEndpoint","teamsAppPermissionPolicyHash","teamsAppSetupPolicyHash","timeOutWindowPowerBarAppsSearch","uapCMSCollectionsAppsLocation","uapCMSCollectionsContentHost","uapCMSCollectionsContentPreviewHost","workflowApp"],federated:["enableFederatedUsersInAddToChat","enableFederatedUsersInAddToSpeedDialOrContacts"],files:["disableWorkingSetZeroPage","enableAddRedeemHeaderOnlyIfResponseIs403","enableBypassPreredeemFlagCheckForRedeemHeader","enableChatFilesTab","enableChatSharedTab","enableChatSharedTabLinksPreview","enableEndpointsManagerOnCloudStorageFoldersService","enableEndpointsManagerOnFilesBackfillThreadPropertiesService","enableEndpointsManagerOnRefreshSiteUrlService","enableEndpointsManagerOnSharepointRestClientService","enableEndpointsManagerOnTeamSiteStatusService","enableFilesPolicy","enableLoadNoneStrategyForThumbnailBlobContentDataStore","enablePreRedeemForPastedLinks","enablePreferAsRedeemSharingLinkInVroomThumbnailApi","enableSyncForFetchThumbnailUrlFromDataStore","enableUpdatedMessageFolderEndpoint","filesThumbnailBlobContentCurrentEvictionPolicy","filesThumbnailBlobContentMaxCount","filesThumbnailBlobContentResultValidity","indexDBCacheLimit","linksCachePageLimit","linksFirstPageLinksCount","linksMorePageLinksCount","nativeFileEntryPoints","scheduleRefreshALLFilesCallInterval"],flyout:["enableOverflowMenuInFlyout","enablePeopleExperience","enableScheduledMeetingsInForYou","enableTflFeaturedCommunitiesSync","frequentlyUsedContactsListSize","staticNowCardPromotionCampaigns","tflFeaturedCommunitiesSyncIntervalInMs"],growth:["enableMfuContacts"],guardians:["enableGuardiansPreferredMethodAndSmsInvite"],homepage:["enableTflHomepage"],host:["enableBreakoutRoomsOrganizerExperienceOnWeb","enableBreakoutRoomsPreMeetingAssignmentTabInBiM","enableChatInfoPane","enableChatInfoPaneDefaultOpen","enableProfilePicturesWithObjectId","enableRecordingAndTranscribingInCallsAppV2","userType"],hostCapabilities:["fullLaunchIntent","phoneLinkingBlocked","storagePartition"],localization:["enableImprovedYearRemovalRegex","enableLocaleSyncWithMSAccount","enableLocaleSyncWithOS","userAccountLocaleCodePolicy"],marketplace:["cartRetentionDays","catalogLocalCacheMaxTimeMs","catalogLocalCacheTimeMs","defaultMarket","deviceStoreAdminEnabled","deviceStoreCatalogCDNHost","deviceStorePurchaseEnabled","enableDeviceStoreMetadataFetch","enableStoreCartCdl","filterNullDeviceContent","stopDeviceStoreEntryLog"],meet:["busyUserInsightCountPerWeek","busyUserMeetingCountPerWeek","checkUserTypeThreshold","diffFetchBusyUser","disableArtifactsStoreSubscription","disableDynamicJobQueuePriority","disableLazyLoadUpcomingEventDetails","disableMCUMeetAppScenario","disableMeetForWorkManager","disableMeetForWorkRecentRefreshStrategy","disableMeetForWorkScenarioDetails","disableReduceCalendarCallOnIntervalForUpcoming","disableThumbnailFromMCO","disableUpcomingPagination","enableCalendarEventCountTelemetry","enableCalendarTPSForRecent","enableFetchBeforeEnterMeetApp","enableFetchUserProfilesInBatch","enableFileRecommendation","enableMCUMeetAppScenario","enableMeetAppAugloopWorkflow","enableMeetForWork","enableMeetForWorkCDL","enableMeetForWorkPrePin","enableMeetForWorkRecentRefreshStrategy","enableMeetingPreparation","enableMockCalendarFetchError","enableMockMCOFetchError","enableMockMCUFetchError","enableMockMREFetchError","enableNativeMeetApp","enablePrefetchOnInterval","enableRecapLastOccurrence","enableRecentShortSummary","enableSubstrateEventSearch","enableUpcomingPagination","enableUserProfilesCache","getThumbnailIgnoringMCU","graphqlBaseUrl","insightsProviderVersion","isMailboxDiscoverable","isOnCloud","maxRecentSyncingDays","maxStepForBusyUser","maxStepForNonBusyUser","mcuFlights","meetForWorkCDLSettings","mockFeatureForABTest","moreTelemetryForFetch","preFetchRecentAttendee","substrateBaseUrl","throttlePublishTime"],meetingArtifacts:["allowEngagementReportPolicy","enableBypassingEngagementReportPolicy","enableCheckCoOrganizerInRecentAttendanceReport","enableHidingOneOnOneMeetingAttendanceReportEntrances","enableMeetingChatAttendanceTab","transcriptServiceEndpoint","transcriptServiceResource"],meetingConversation:["enableSubscriptionHasUnreadUpdateFalse"],meetingRecap:["blockedMeetingTypesTemplateIds","convertROnlyToRnT","disableRecapsFilterOnFixedDuration","enable3SRPayloadScenarioForChiclet","enableConsumeOdspFileInfo","enableExpandViewAINotes","enableGPT4InRecap","enableGetHasRecapInChat","enableMeetingRecapInChat","enableMergeSeriesMasterCollabObject","enableOnDemandAINotes","enableOnDemandAINotesForChannelMeetings","enableRecapForChannelMeetings","enableRecapForSharedChannelMeetings","enableRecapTranscriptOnly","getDateOffset","meetingCatchUpServiceEndpoint","meetingCatchUpServiceResource","recapDurationDaysOffset","workingSetTimeSpanInHour"],mercuryDesign:["enableMercuryDesign","enableMercuryDesignAppBarRemoteIcons","enableMercuryDesignGriadientForIcons","mercuryDesignAlertIconAssetPath","mercuryDesignCalendarIconAssetPath","mercuryDesignChatIconAssetPath","mercuryDesignCommunityIconAssetPath","mercuryDesignVirtualConsumerEventsIconAssetPath"],messaging:["allowGroupChatJoinLinks","allowSmartReply","allowUserChat","allowUserTranslation","amsDownloadMaxRetryCount","chatHighlightsSmartActionUnreadThreshold","chatSmartNavigatorMaximumHistoryDays","chatSmartNavigatorUnreadMessageCharCountThreshold","chatSummarizationEnoughMessagesContentThreshold","chatSummarizationEnoughMessagesCountThreshold","chatSummarizationMaximumDays","commCopilotSummarizationRequestConfig","copilotAppIdForNewChat","copilotAppsIds","copilotPluginServiceAuthUrl","copilotPluginServiceUrl","disableChatHighlightsSmartAction","disableChatHighlightsSmartActionForGroup","disableChatHighlightsSmartActionForMeeting","disableChatHighlightsSmartActionForOneOne","disableGroupCopilotChatHistoryCheck","disableGroupCopilotMeetingChatHistoryCheck","disableSmartRepliesForMessagesOlderThan24Hours","emergencyMRIs","emergencySmsNumbers","enableAutoDeleteV2","enableAutoEditV2","enableAutomaticTranslationV2","enableBotDeliveryReports","enableCallKMApiDirectly","enableCallingSmartSuggestions","enableChannelLieEventsAndDedupe","enableChatHighlightsSmartAction","enableChatJoinLinksForTfwGroupChats","enableChatPillCountLogging","enableChatPinEventErrorMessageLogging","enableChatWithMtoFederatedIdentity","enableChattingWithMtoUserBanner","enableConsumerConversations","enableDataSpillageHardDeletion","enableDeleteChat","enableDeleteChatInConsumerGroup","enableEndpointsManagerForAsyncMediaService","enableEndpointsManagerForImageProxyService","enableEndpointsManagerForOnDemandTranslateService","enableFetchSmartNavigatorFromCSA","enableForwardMessageUnreadMarkers","enableGroupChatAudioDropin","enableGroupChatInviteFlow","enableGroupCopilotForNewChat","enableGroupCopilotInteraction","enableHasTeamsProProtectionLicenseCheck","enableHideExternalLabelForMTOUsers","enableHolisticRecap","enableImpersonationUpdatedApiCall","enableInOrganizationChatControl","enableInOrganizationChatControlFeature","enableInformationBarrierInMW","enableLargeMeetingControlMessageFiltering","enableLicenseCheckForM365ChatBot","enableMarkAllChannelsAsRead","enableMarkAllChatsAsRead","enableMeetingChatAutoUnmute","enableMessageBotMetadata","enableMtoUserChatBanner","enableOffNetworkSingleUserGroups","enableOnDemandTranslation","enableOneOnOneTwoWaySmsChatCreation","enablePaidSmsChat","enableReadReceipts","enableRedDotServiceIntegration","enableRetryingSendStatus","enableRoamMessageDraft","enableScheduleSendSuggestionsHeimdall","enableSendPipelineEnhancedErrorHandling","enableSinglePaneThreadingNavigation","enableSmartFilesSuggestions","enableSmartNavigator","enableSmartReplyV2","enableSmartSchedulingSuggestions","enableTeacherDelete","enableTfwTflFederation","enableThreadCreationChat","enableThreadingInChat","enableThreadingMultipleSelfMessageActions","enableTogetherEmojisV2","enableTopicAnnotationLogMismatch","enableTopicInline","enableTopicInlinePreview","enableTopicSmartReplies","enableTopicSmartRepliesPreview","enableTopicsSdkWebWorker","enableTranslationIntelligentSuggestions","enableTranslationSettingsRoaming","enablefeatureSettingManager","enablefeatureSettingResolver","expandedReactionsConfigs","groupCopilotMeetingChatHistoryAccessTimeThresholdMs","hideControlMessageMeetingThreshold","hotlineSMSNumbers","ignoreCopilotAddedControlMessageAsLastMessage","inOrganizationChatControl","isMultiWindowSendPipeline","largeMeetingHiddenMessageTypes","markAllAsReadBatchSize","maxRosterSizeInGroupChatChatServiceLimit","msgEnableAmsV2DomainInMW","msgEnableSfbCloudFromBVD","msgEnableUnlimitedReactions","overrideServicePlanChecksForGroupCopilot","realTimeMAARUpdatesForThreadingConfig","receiptsEnabledType","rejectNonAmsURLFromAsyncMediaService","shouldOverrideM365ChatBotLicense","smartNavigatorSupportedLocales","substrate","supportedSMSRegions","sydneyPromptServiceAuthUrl","sydneyPromptServiceUrl","teamsUserPhoneNumbers","tenantVerifiedDomainsRefreshInDays","tflSmsRequiredConsentPhoneNumberRegionCodes","topicAnnotationsMaxParticipants","topicAnnotationsMinParticipants","topicSmartRepliesMinAnnotationScore","topicSmartRepliesMinRelevanceScore","translationLanguageStampingTunerSettings","translationSettingChangesExpirationTime","useKServingInTopicsSDK","useTeamsCopilotServicePlanForGroupCopilot","userFeatureSettingsConfig","userLanguageAccountSettings","vivaTopicsAriaCollectorUri"],metadata:["countryCode","region","ring"],notifications:["enableMuteAllNotificationsSetting","enableNotificationExternalTagPrefix","enableNotificationsForThreads","enableShowPreviewInToastsCheckbox","enableSubCommunitiesToastNotifications","enableSuppressedChatToastNotificationsList","enableSuppressingOfChatToastNotifications","enableThrottleNotifications","enableUrgentToastsContentFixes","notificationThrottleTimeMs","showGenericNotificationsSoundSetting","showNotificationsCallsSoundSetting"],onboarding:["enableArkoseCaptchaChallenge","enableSignInToTflMobileWhatsNew"],people:["allowScopedPeopleSearchandAccess","atMentionInChannelTimeOutInMs","defaultNumberOfTopResultsFromUps","disableGroupChatDelimiterUsage","disableInMemoryProfileSearchThreshold","disableSearchV2ForMSAUser","disableUnverifiedLabelForPSTNUsers","disabledPickersFromSearchV2","enableAdditionalRequestHeadersToUPS","enableAtMentionInStatusNote","enableBackfillUPNForIbbarredUser","enableCapiv3MigrationStateCheckInLPC","enableChannelsInPickers","enableChatStateSync","enableCrossCloudAcceptBlock","enableDDRForProfileAndAvatarFreshness","enableEditContactCAPIDisplayNameWorkaround","enableEditContactSDSDisplayNameWorkaround","enableEditContactSDSNamesWorkaround","enableExtendedDirectory","enableExternalTagForPSTNUsers","enableGetProfilesWithLowPerfFederationFallbacks","enableInitialsImageForPstn","enableInviteFree","enableLPCOneGQLPerson","enableLPCPhotoViaOneGQLPerson","enableLabelingUsersByTrustLevel","enableLokiContactModifiedOnPersonMutation","enableMSABlockUnblockUsers","enableMTOLabel","enableMentionManagerCacheRefresh","enableNativeAvatarForMTO","enablePBCCreation","enablePBCsForEnterpriseOutTenantUsers","enablePeopleApp","enablePeopleAppPresence","enablePeoplePickerConfRoomRemovalAndAddition","enableRenamedGeneralChannelSearch","enableSCDLookupForTFLZeroState","enableSearchV2IncludeBotsOverride","enableSearchV2Results","enableSearchV2SearchForGuests","enableShowChannelsInPeoplePicker","enableShowTeamsInPeoplePicker","enableShowUUDebugInfoInLPC","enableSilentLokiAuthTokenRetrieval","enableTFLNewRelevanceSearch","enableTFLZeroStateSubstrateSuggestions","enableTeamsInPickers","enableTfwUpdateGroupChatAvatar","enableTfwUpdateGroupChatTransparentBackgroundAvatar","enableUnNamedGroupChats","enableUnNamedGroupChatsInPickers","experimentalPeoplePickerOrderChanges","hotlineNumbersMapping","includeIBBarredUsers","internationalChannelAtMentionKeyword","internationalTeamAtMentionKeyword","janaContactListFirstPageSize","janaContactListSubsequentPageSize","lokiTokenResourceUrl","lpcOneGQLPersonDebugPrefix","maxChannelResultsFromAtMentions","maxInviteFreeQuarantineCounter","respectChannelMentionUserSettings","topNSuggestionsExpiryCheckIntervalMiliseconds"],peopleTargeting:["customTagMode","disallowedSources","enableAllTeamsTagCardsCache","enableAutomaticTags","enableManageTeamTagsOptionInChannelForSimpleCollab","enableOwnersTag","enableOwnersTagInPrivateChannel","enableScheduledTags","enableTagsInPrivateChannels","enableTagsInSharedChannels","enableTenantTagSettingsV2","ownersCanOverwriteTagSettings","suggestedTags","tagPermissions","targetingTagMemberLimit"],phonelinkSms:["csaPhonelinkSmsRequestTimeout","enablePhoneLinkSmsWhatsNew","enablePhonelinkAltMeetLink","enablePhonelinkErrorStopSyncing","enablePhonelinkMainEntry","enablePhonelinkOobeFlow","enablePhonelinkRichTextProcessing","enablePhonelinkSms","enablePhonelinkSmsDismissUpsells","onlySkypeTokenForPhonelinkAPIsPlaywright","phonelinkSmsDCGEndpoint","phonelinkSmsDCGEndpointOverride","phonelinkSmsDCGResource"],places:["enableNewGetBuildingsAPIInMeControl","enableWorkLocationDetectionPolicy"],platform:["deviceInfo","isMaglev","isOcdi","isPwa","sessionId"],premium:["enableGetLFTEntity","enableLFTEntityForLicenseAcquire","lftAcquireRetryConfig","lftRefreshRetryConfig"],presence:["connectedDeviceUrl","createEndpointAfterTrouterConnectsDelayInMs","disableSourceEncodedMri","enableAfdPresenceEndpoint","enableAlwaysIncludeSelfInPresenceSubscription","enableAlwaysProcessUpdatePresence","enableAnonymousRequestsFiltering","enableAvailabilityComputationInCreateEndpointWorkflow","enableCallingClientState","enableCreateEndpointAfterTrouterConnects","enableEndpointsManagerOnBreakthroughService","enableFollowPresence","enableHTMLInStatusNote","enableHandlingPendingPresenceRequests","enableMultipleGetPresenceFix","enablePresenceNotificationsOverTrouter","enablePresenceServiceRetries","enableRefreshPresenceSubscriptions","enableRetrievingEndpointIdOnlyFromPresenceManager","enableSkipPresenceSyncWhileLongInactive","enableStatusNoteV2","enableT1PresenceEtagCheck","enableUnknownPresenceAppOffline","enableUnknownPresenceFix","enableUnknownPresenceFixTest","ic3LocationResourceUrl","maxNumOfFollowedPresenceContacts","presenceServiceMaxRetries","presenceSubscribeIntervalInMs","presenceUnsubscribeIntervalInMs","removePresenceDbProvider","reportNearbyDeviceUrl","requireConsumerTypeHeader","requireSkypetoken","shouldCheckMachineIdleState","trouterUpdateBatchSize","unifiedPresenceTrouterUserActivityUpdateTimeoutInMs","updateEventBatchCacheDebounceInMs","updateEventBatchUpdatesDebounceInMs"],queues:["disableQueuesAppPreviewTitle","enableAgentOptStatusPushNotifications","enableAnalyticsExtendedLoggingForQueuesApp","enableHistoricalReportingExport","enableHistoricalReportingForQueuesApp","enableIsQueuesAppUserCheck","enableLoadNoneStartupStrategyForHistoric","enableRealTimeStaticListForQueuesApp","enableRealTimeStatsForQueuesApp","enableRealTimeStatsForQueuesAppOnStartUp","enableRefreshConnectionForQueuesRealTimeStats","enableUpdatedConnectionForRtaSignalR","queuesRtaSignalRServiceSettings","queuesRtaVoiceAppsServiceSettings"],search:["enablePeopleSearchV2"],sensitivityLabel:["enableEndpointsManagerOnSensitivityLabel","sensitivityLabelCacheIntervalInHours","sensitivityLabelCacheSyncBlockingIntervalInHours","sensitivityLabelMiddleTierEndpoint","sensitivityLabelMiddleTierPolicyEndpoint"],serp:["allFilesAuthEndpoint","allFilesEndpointDomain","allFilesEndpointPath","enableBackButtonFixForTabSwitch","enableClientVersionHeader","enableUsingOidForXAnchormailboxWhenPuidIsAbsent","groupChatSettingConfig","osearchBaseUrl","osearchQuery","substrateBaseUrl","substrateInstrumentationClientVersion","substrateTokenUrl","teamChannelSearchConfig"],simpleCollab:["conversationFolderSortTypes","disableSimpleCollabLeftRailAtMentionsStickyFilterPill","enableBizChatMetaOSSimpleCollabEntryPoint","enableConversationFolderPropertyRemappings","enableDiscoverScrollableInSimpleCollab","enableDraftCharm","enableDraftFilter","enableSimpleCollabApp","enableSimpleCollabAppSplitView","enableSimpleCollabAppSplitViewOnly","enableSimpleCollabAppToggle","enableSimpleCollabBlockChat","enableSimpleCollabBoldingForDiscover","enableSimpleCollabChatComfyLayout","enableSimpleCollabCollapseAll","enableSimpleCollabConversationFolderSorting","enableSimpleCollabDiscoverUserPreferences","enableSimpleCollabEngageCommunities","enableSimpleCollabFolderOrderVerboseLogs","enableSimpleCollabHideChat","enableSimpleCollabHistoryNavigation","enableSimpleCollabLeftRailBrbLog","enableSimpleCollabLeftRailReadItemsRemovalInFilteredView","enableSimpleCollabLeftRailShortcuts","enableSimpleCollabLeftRailTypingIndicator","enableSimpleCollabLegacyAvatar","enableSimpleCollabNewMessageRename","enableSimpleCollabRailSelection","enableSimpleCollabRailSelectionHoisting","enableSimpleCollabRailSelectionV2","enableSimpleCollabShowHiddenTeams","enableSimpleCollabSplitChannelsAppRename","enableSimpleCollabStickyFilter","enableSimpleCollabSubscriptionDebug","enableSimpleCollabTAPVersionString","enableSimpleCollabTeamNameOverGeneralChannel","enableSimpleCollabUnifiedAppRename","enableSimpleCollabUpdateHistoryNavigation","enableSimpleCollabVerboseLogs","enableSuggestedChatsInChatFolder","enableUnifiedLeftRailSubscriptionBatching","enableViewportCheckForSelectConversationEvent","isHierarchicalViewEnabledDefaultValue","maxChatsToShowSuggestionsInChatFolder","simpleCollabAppECSOverride","unifiedLeftRailSubscriptionBuffer"],smb:["enableExternalSubstrateSuggestedChats","enableFilteringOutTFLOffNetworkSuggestedChats","enableInternalSubstrateSuggestedChats","enableSmbChatZeroState","enableSuggestedOrgGroupChats","enableSuggestedProjectGroupChats","enableTenantDirectoryStateMachine","enableTenantDirectorySuggestedChats","externalTopNSuggestionsCacheExpiry","maxSuggestedChats","numExtraTenantDirectorySuggestionsToFetchToAccountForEmailFilter","substrateSuggestionsLimit","tenantDirectoryCacheExpiryMinutes","tenantDirectorySuggestionsLimit","tenantSizeSegment"],sync:["conversationsSyncWorkflowTimeoutInSeconds","disableDeletedConversationPropertyCheck","disableRemoveReplyChainIdFromConversationId","disableThreadDetailsSyncOnRosterVersionMismatch","disableUserActivityReportingOnTrouterConnect","enablePrefetchUnreadMessages","messageSyncColdBootMaxCallCount","shouldSkipRelatedMessagesDeadThreadSync","unreadMessageMaxCallCount","unreadMessageSequenceIdGapThresholdForBackwardSync","unreadMessagesBidirectionalFetchLimit"],teamsAndChannels:["allowEmailIntoChannel","defaultTimeoutForStaleChannelsAPI","eduRosterSyncIntervalInHours","enableArchiveChannel","enableAutoFavoriteChannel","enableChannelActiveCallsResolver","enableChannelNewBadge","enableCopyDeepLinkForPrivateChannelTrinity","enableCopyDeepLinkForSharedChannelTrinity","enableCreateTeamSimplification","enableGeneralChannelShowHide","enableHasAccessToChannelV2ForDeeplinkNav","enableLeftRailAddChannelButton","enableLegacyChannelConnectorsToWorkflows","enableLoggingJoinedTeamsErrorMessage","enablePrivateAndSharedChannelUseTeamMention","enablePrivateChannelOnLWGT2","enableReactJoinTeamsGallery","enableRecommendedTeamsSync","enableRenameGeneralChannel","enableRetentionLabel","enableRosterSync","enableSensitivityLabelPrivacyValidationOptInBehavior","enableShareWithTeamSensitivityLabelEnforcementReact","enableSharedChannelLieCreation","enableStaleChannelsAdHocFlow","enableStaleChannelsBatchAPI","enableStaleChannelsFlow","enableStaleChannelsHiddenFirstOrder","enableStaleChannelsRetryAndJitter","enableStaleChannelsSettings","enableStaleTeamsFlow","enableT2ChannelsAtMentionBadging","enableT2ChannelsBadgingAppBar","enableTeamCreateOnMainView","enableTeamsAndChannelsUserResolutionByUserDataLoader","enableUserFetchForJoinTeamGallery","enableUserOnboardingToTeam","enableUserOnboardingToTeamRecommended","enableUserResolutionForChannelModeratorList","lastTimeFavoritedPropertyBatchSize","maximumGroupsLimit","maximumSearchThreadMembersLimit","minimumShownChannelsInShownTeamsCount","minimumTotalShownChannelsCount","privateChannelsOnLWGAllowedGroupsListT2","recommendedTeamsCacheIntervalInHours","rosterSyncFrequencyInHours","rosterSyncIntervalInHours","staleChannelsAdHocRunIntervalInDays","staleChannelsJitterBase","staleChannelsJitterRange","staleTeamsAbsentTotalDays","staleTeamsCalculationAdHocBatchLimit","staleTeamsCalculationAutomatedBatchLimit","staleTeamsCalculationChannelsLimit","staleTeamsCalculationTeamsLimit","staleTeamsCoachmarkTotalDays","staleTeamsFavoritedTotalDays","staleTeamsInactiveTotalDays","staleTeamsMinimumTotalTeams","staleTeamsRunJobInterval"],teamsInsider:["enableTeamsInsiderStateSync"],teamsPushService:["apiConstants","teamsPushServiceRetryPolicy","tpsRetryOverrides","useHostFromGtmTable","useTPSRetryOverridesMap"],telemetry:["applicationInsightsOfflineSettings","autoFlushPercent","blockedColumnRules","debugMenuCaptureContext","debugMenuCaptureEvents","defaultToken","disableMTMAPrimaryId","disablePlatformServiceOsVersion","disableRingNamePrefixing","ecsProvidedBuckets","enableBlockZeroSampleRate","enableCompression","enableDistributedTracing","enableEnhancedTelemetry","enableExpandedFractionalBuckets","enableGetUserTypeFromHost","enableNewScenarioTimeout","enableOfflineTelemetry","enableOneDsSdkNs","enablePreAuthIdSampling","enablePrivacyGuard","enableSDKContextOverrides","enableTelemetryCancelOnSuspendAndNetworkOffline","enableTelemetryRegionReinit","enableToolingSamplingRules","enableUserIdSamplingV2","enableWorkerBroadcast","eventPersistence","eventsLimitInMem","expRolloutIdAllowList","fixedColumnRules","httpnsDisabledServices","isSilent","normalPrioritySendTimeInSecs","oneDsCollectorUrl","privacyGuardIngestionToken","samplingRules","scenarioCancelOnNetworkStateChangeBlockList","scenarioCancelOnSuspendStateChangeBlockList","scenarioIncompleteOnShutdown","scenarioIncompleteOnShutdownBlockList","scenarioModes","scenarioPackedDataLimit","scenariosNotToTimeoutIfPaused","showAllConsoleLogs","telemetryRegion","telemetryRegionFetchComplete","telemetryServer","toolingSamplingRules","userIdSampleCohort","workerBroadcastBatchSize"],test:["testAutomation"],trouterService:["registrarDefaultEndpoint","registrarEndpointOverride","retryLimitOnTokenFetch","trouterDefaultEndpoint","trouterEndpointOverride","useShortLivedRegistration"],userResources:["isSfbCloud","isSfbCloudInBVD","isSipEnabled","isSipEnabledInBVD","isTenantAdmin","userClassifications"],virtualConsumerEvents:["enablePublicCommunitiesEvents","enableVirtualConsumerEvents","enableVirtualConsumerEventsInAppBar"],whatsNew:["chatViaSms","communities5k","communitiesBeta","communitiesCreate","communityBot","contactsSync","designerInChannelAnnouncementPost","enableEntryPointPromotions","enableWhatsNew","flyoutInlineChat","flyoutV2","gamebarWidget","maxFeaturesInOverlayCount","maxValidFromDaysToBeShown","mobileDownloadQrPromo","onDemandTranslations","peopleExperience","phonelinkSms","polls","sendPostAsEmail","signInToMobile","starfieldBackgroundsPromo","togetherEmojisHighFive","togetherEmojisV2","uploadCustomBackground"],windowsSignatureExperiences:["enableExtendedContactSyncStats","enableGamebarWidgetWhatsNew","enableHighFiveTogetherEmojis"]}};function $z(e){switch(e){case"ag08":return n.e(221682).then(n.bind(n,285066)).then((e=>e.default));case"ag09":return n.e(86075).then(n.bind(n,70449)).then((e=>e.default));case"dod":return n.e(15455).then(n.bind(n,907207)).then((e=>e.default));case"gallatin":return n.e(403912).then(n.bind(n,961828)).then((e=>e.default));case"gcc":return n.e(182931).then(n.bind(n,256387)).then((e=>e.default));case"gcchigh":return n.e(341523).then(n.bind(n,247451)).then((e=>e.default));case"life":return n.e(251684).then(n.bind(n,817224)).then((e=>e.default));case"prod":return n.e(426009).then(n.bind(n,618643)).then((e=>e.default));case"viewportOverrides":return Lz;case"clientFiltersMerge":return Oz;case"clientFiltersOverride":return jz;case"policies":return Bz;case"forwardCdlWorkerAllowlist":return Uz;default:throw new Error(`Requested config does not exist: ${e}`)}}const Wz=[{importFunc:()=>Promise.all([n.e(699899),n.e(714549),n.e(876152),n.e(893369)]).then(n.bind(n,311637)),chunkName:"data-schema"},{importFunc:()=>Promise.all([n.e(320494),n.e(224316),n.e(120951),n.e(914945),n.e(311914),n.e(725973),n.e(428348),n.e(669152),n.e(616161),n.e(524147),n.e(296930),n.e(5982),n.e(353927),n.e(505772),n.e(597680),n.e(965787),n.e(674958),n.e(221963),n.e(927767),n.e(524014),n.e(383414),n.e(634370),n.e(475841),n.e(407772)]).then(n.bind(n,705031)),chunkName:"core-essentials"},{importFunc:()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(181316),n.e(725973),n.e(842242),n.e(459959),n.e(984165),n.e(215618),n.e(867529),n.e(214218),n.e(811751),n.e(166017),n.e(698386),n.e(852774),n.e(909600),n.e(826932),n.e(49749),n.e(119068),n.e(27001),n.e(317183),n.e(367741),n.e(845091),n.e(814583),n.e(153409),n.e(43328),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(151748),n.e(370494),n.e(652658),n.e(296222),n.e(198771),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(834558),n.e(77029),n.e(684694),n.e(428410),n.e(813370),n.e(478723),n.e(288919),n.e(337595),n.e(223810),n.e(639495),n.e(743566),n.e(119940),n.e(670225),n.e(644740),n.e(876965),n.e(556261),n.e(969355),n.e(736579),n.e(443621)]).then(n.bind(n,668280)),chunkName:"shell-app"}];var Vz=n(777883);function Hz(e){var t="";Array.prototype.join;return t+='<div id="pre-core-title-bar" tabindex="-1" data-tid="pre-core-title-bar">\n  <span id="pre-core-title-bar-logo" class="pre-core-title-bar logo" role="img" aria-hidden="true" title="Microsoft Teams">\n    <svg role="presentation" viewBox="2 2 20 20" id="high-contrast-logo">\n      <path\n        fill-rule="evenodd"\n        clip-rule="evenodd"\n        d="M14 9V10H21.061C21.579 10 22 10.386 22 10.861V15.75C22 17.335 20.598 18.62 18.869 18.62C18.508 18.62 18.039 18.553 17.644 18.327C16.97 19.899 15.409 21 13.59 21H13.41C11.467 21 9.818 19.744 9.23 18H3C2.45 18 2 17.55 2 17V7C2 6.45 2.45 6 3 6H11C11 4.343 12.343 3 14 3C15.657 3 17 4.343 17 6C17 7.657 15.657 9 14 9ZM16 6C16 7.103 15.103 8 14 8V7C14 6.45 13.55 6 13 6H12C12 4.897 12.897 4 14 4C15.103 4 16 4.897 16 6ZM8.468 15.875V10.055H10.632V8.125H4.368V10.055H6.545V15.875H8.468ZM17 16.59V16.631C16.998 16.657 16.997 16.685 16.998 16.713C16.933 18.536 15.429 20 13.59 20H13.41C12.032 20 10.843 19.179 10.305 18H13C13.55 18 14 17.55 14 17V11H17V16.59ZM21 15.75C21 16.781 20.044 17.62 18.869 17.62C18.761 17.62 18.285 17.606 18.034 17.381C18.0368 17.2312 18.0252 17.0874 18.0147 16.9579L18.012 16.924L18.008 16.8821C18.0032 16.8321 17.9986 16.7839 17.997 16.74C17.999 16.69 18 16.64 18 16.59V11H21V15.75ZM21.2 7C21.2 7.662 20.662 8.2 20 8.2C19.338 8.2 18.8 7.662 18.8 7C18.8 6.338 19.338 5.8 20 5.8C20.662 5.8 21.2 6.338 21.2 7ZM20 5C21.105 5 22 5.896 22 7C22 8.104 21.105 9 20 9C18.896 9 18 8.104 18 7C18 5.896 18.896 5 20 5Z"\n      />\n    </svg>\n    <svg role="presentation" viewBox="2 2 20 20" id="normal-logo" style="width: 2rem">\n      <path\n        d="M21.0344 10.0012H16.8734L15.7124 10.9402V15.5972C15.7124 17.3262 17.1134 18.7282 18.8424 18.7282C20.5724 18.7282 21.9734 17.3262 21.9734 15.5972V10.9402C21.9734 10.4222 21.5534 10.0012 21.0344 10.0012Z"\n        fill="#5059C9"\n      />\n      <path\n        d="M22 7C22 8.104 21.105 9 20 9C18.895 9 18 8.104 18 7C18 5.896 18.895 5 20 5C21.105 5 22 5.896 22 7Z"\n        fill="#5059C9"\n      />\n      <path\n        d="M9.89214 10.0046H17.0961C17.5921 10.0046 17.9941 10.4066 17.9941 10.9026V16.5946C17.9941 19.0306 16.0201 21.0046 13.5841 21.0046H13.4041C10.9681 21.0046 8.99414 19.0306 8.99414 16.5946V10.9026C8.99414 10.4066 9.39614 10.0046 9.89214 10.0046Z"\n        fill="#7B83EB"\n      />\n      <path\n        d="M16.9065 5.99999C16.9065 7.60499 15.6055 8.90699 13.9995 8.90699C12.3945 8.90699 11.0935 7.60499 11.0935 5.99999C11.0935 4.39499 12.3945 3.09299 13.9995 3.09299C15.6055 3.09299 16.9065 4.39499 16.9065 5.99999Z"\n        fill="#7B83EB"\n      />\n      <path\n        opacity="0.5"\n        fillRule="evenodd"\n        clipRule="evenodd"\n        d="M15.0001 8.6814V8.0004C15.0001 7.4504 14.5281 7.0004 13.9511 7.0004H11.2711C11.6881 8.0944 12.7391 8.8754 13.9801 8.8754C14.3401 8.8754 14.6821 8.8014 15.0001 8.6814ZM8.99414 10.9024C8.99414 10.4064 9.39614 10.0044 9.89214 10.0044H15.0001V17.8394C15.0001 18.3894 14.3821 19.0004 13.7451 19.0004H9.71514C9.26214 18.3074 8.99414 17.4834 8.99414 16.5944V10.9024Z"\n        fill="black"\n      />\n      ',"life"===e.environment?t+='\n      <path\n        d="M3 18C2.45 18 2 17.55 2 17V7C2 6.45 2.45 6 3 6H13C13.55 6 14 6.45 14 7V17C14 17.55 13.55 18 13 18H3Z"\n        fill="white"\n      />\n      <path\n        d="M11.0001 10H8.83511V15.82H7.41211V10H5.23511V8.57001H11.0001V10Z"\n        fill="#4B53BC"\n      />\n      ':t+='\n        <path\n        d="M3 18C2.45 18 2 17.55 2 17V7C2 6.45 2.45 6 3 6H13C13.55 6 14 6.45 14 7V17C14 17.55 13.55 18 13 18H3Z"\n        fill="#4B53BC"\n      />\n      <path\n        d="M11.0001 10H8.83511V15.82H7.41211V10H5.23511V8.57001H11.0001V10Z"\n        fill="white"\n      />\n      ',t+='\n    </svg>\n  </span>\n\n  \x3c!-- loading window action buttons --\x3e\n  <div id="pre-core-action-buttons">\n    <button id="pre-core-title-bar-minimize-button" tabindex="-1" data-aa-class="Button"\n      class="pre-core-action-ui-button" data-tid="pre-core-title-bar-minimize-button" aria-hidden="true">\n      <div class="pre-core-action-ui-box">\n        <span role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path d="M3.5 7h9c.28 0 .5.22.5.5s-.22.5-.5.5h-9c-.28 0-.5-.22-.5-.5s.22-.5.5-.5z" />\n          </svg>\n        </span>\n      </div>\n    </button>\n    <button id="pre-core-title-bar-maximize-restore-button" tabindex="-1" data-aa-class="Button"\n      class="pre-core-action-ui-button" data-tid="pre-core-title-bar-maximize-button" aria-hidden="true">\n      <div class="pre-core-action-ui-box">\n        <span id="pre-core-maximize-icon" role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path\n              d="M4.5 3A1.5 1.5 0 003 4.5v7A1.5 1.5 0 004.5 13h7a1.5 1.5 0 001.5-1.5v-7A1.5 1.5 0 0011.5 3h-7zm0 1h7a.5.5 0 01.5.5v7a.5.5 0 01-.5.5h-7a.5.5 0 01-.5-.5v-7a.5.5 0 01.5-.5z" />\n          </svg>\n        </span>\n        <span id="pre-core-restore-icon" role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path d="M5.084 4a1.5 1.5 0 011.415-1h3.5a3 3 0 013 3v3.5a1.5 1.5 0 01-1 1.415V6a2 2 0 00-2-2H5.084z" />\n            <path\n              d="M4.5 5h5A1.5 1.5 0 0111 6.5v5A1.5 1.5 0 019.5 13h-5A1.5 1.5 0 013 11.5v-5A1.5 1.5 0 014.5 5zm0 1a.5.5 0 00-.5.5v5a.5.5 0 00.5.5h5a.5.5 0 00.5-.5v-5a.5.5 0 00-.5-.5h-5z" />\n          </svg>\n        </span>\n      </div>\n    </button>\n    <button id="pre-core-title-bar-close-button" tabindex="-1" data-aa-class="Button" class="pre-core-action-ui-button"\n      data-tid="pre-core-title-bar-close-button" aria-hidden="true">\n      <div class="pre-core-action-ui-box">\n        <span role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path\n              d="M2.589 2.716l.058-.069a.498.498 0 01.637-.058l.069.058L8 7.293l4.646-4.647a.5.5 0 01.707.707L8.707 8l4.647 4.646a.5.5 0 01.058.638l-.058.069a.5.5 0 01-.638.058l-.069-.058L8 8.707l-4.646 4.647a.5.5 0 01-.707-.707L7.293 8 2.646 3.354a.501.501 0 01-.057-.638l.058-.069-.058.069z" />\n          </svg>\n        </span>\n      </div>\n    </button>\n  </div>\n</div>'}const zz=({environment:e,theme:t,cspNonce:n,publicPathScript:i,containerVer:a,viewportContext:o})=>{const{favicons:r}=Vz.T,s=function(e){var t,n="";Array.prototype.join,n+='<!DOCTYPE html>\n<html lang="en">\n\n<head data-config="'+(null==(t=e.htmlWebpackPlugin.options.platformConfig)?"":t)+'">\n  ',e.htmlWebpackPlugin.options.isMainWindow&&(n+='\n    <script nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n      if(performance.now() > 5000) {\n        performance.mark("slow-read-index-html");\n      } else {\n        performance.mark("read-index-html");\n      }\n    <\/script>\n  '),n+='\n  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />\n  <meta name="containerVer" content="'+(null==(t=e.htmlWebpackPlugin.options.containerVer)?"":t)+'" />\n  ',e.htmlWebpackPlugin.options.viewportContext&&(n+='\n    <meta name="viewportContext" content="'+(null==(t=e.htmlWebpackPlugin.options.viewportContext)?"":t)+'" />\n  '),n+="\n  ",e.htmlWebpackPlugin.options.enablePwa&&(n+='\n    <link rel="manifest" href="manifest.json" crossorigin="use-credentials"/>\n  '),n+="\n  ";let i=[],a=[],o=[],r=[],s=[],l=[],c="",d="",u="";if(e.htmlWebpackPlugin.files.js){const p=e.htmlWebpackPlugin.options.lazy,g=new Set(e.htmlWebpackPlugin.options.preloadedChunks||[]),h=new Set(e.htmlWebpackPlugin.options.buildTimeConfigs||[]);function v(t){if("string"==typeof t&&(t=new Set([t])),!t||!t.size)return new Set;const n=Array.from(t).filter((e=>e&&"RegExp"===e.constructor.name)),i=new Set;return e.compilation.chunkGroups?e.compilation.chunkGroups.filter((e=>{const i=e.options&&e.options.name;return t.has(i)||n.some((e=>e.test(i)))})).forEach((e=>{(e.chunks||[]).forEach((e=>{(e.files||[]).forEach((e=>i.add(e)))}))})):Array.from(e.compilation.entrypoints.keys()).filter((e=>t.has(e)||n.some((t=>t.test(e))))).forEach((t=>{e.compilation.entrypoints.get(t).getFiles().forEach((e=>i.add(e)))})),i}function y(e){const t=Array.from(e).join("***");return i.filter((e=>{const n=e.path.split("/").pop();return t.includes(n)&&!e.isLazy&&!e.isGriffel}))}function S(e){const t=/\.css$/.test(e.path)?"style":"script";return`<link href="${e.path}" as="${t}" rel="preload" ${e.integrity?`integrity="${e.integrity}" crossorigin`:""} />`}function f(t){if(e.htmlWebpackPlugin.options.enableSubResourceIntegrity&&e.htmlWebpackPlugin.options.enableSubResourceIntegrityForIndexAndExperienceLoader)return`SRI-PLACEHOLDER-${t.split("/").pop()}`}function k(t){return{path:`${e.compilation.options.output.publicPath}${t}`,integrity:f(t),isPolyfill:!1}}i=e.htmlWebpackPlugin.files.js.concat(e.htmlWebpackPlugin.files.css).map((e=>{const t=e.split("/").pop().replace(/(-[0-9a-g]+)?\..+/,"");return{id:t,path:e,isPolyfill:/polyfill/.test(t),isLazy:p&&p.includes(t)||void 0,isGriffel:/griffel/.test(t)||void 0}}));const C=v("main"),b=v("loader"),w=v("reactdevtools"),T=v("async-entry"),I=v(g),N=v(h);b.forEach((e=>C.delete(e))),b.forEach((e=>w.delete(e)));const A=y(C);a=y(b),r=y(w);const E=e.htmlWebpackPlugin.options.createBatchedRemoteEntry(e.compilation);if(o=A.map((e=>({...e,integrity:f(e.path)}))),e.htmlWebpackPlugin.options.enableSubResourceIntegrity){const F={path:`${e.compilation.options.output.publicPath}INTEGRITIES-PATH-PLACEHOLDER`,isPolyfill:!1,isIntegritiesManifest:!0};e.htmlWebpackPlugin.options.enableSubResourceIntegrityForIndexAndExperienceLoader&&(F.integrity="INTEGRITIES-INTEGRITY-PLACEHOLDER"),o.unshift(F)}c=o.map(S).join("\n"),d=i.filter((e=>e.isGriffel)).map((e=>({path:e.path}))).map(S).join("\n"),u=[...Array.from(I),E].filter((e=>!!e)).map((t=>({path:`${e.compilation.options.output.publicPath}${t}`,integrity:f(t)}))).map(S).join("\n"),s=[...Array.from(T),E].filter((e=>!!e)).map(k),l=Array.from(N).map(k)}if(n+="\n\n  "+(null==(t=c)?"":t)+"\n  "+(null==(t=u)?"":t)+"\n  "+(null==(t=d)?"":t)+'\n  \n  <script nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n      performance.mark("main-bundle-downloaded");\n  <\/script>\n  <script nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n    '+(null==(t=e.htmlWebpackPlugin.options.publicPathScript)?"":t)+"\n\n    // Set container version to be captured in heap snapshots.\n    window.__debug_containerVersion__ = `CONTAINER_VERSION="+(null==(t=e.htmlWebpackPlugin.options.containerVer)?"":t)+"`;\n    __VERSION__  = '"+(null==(t=e.htmlWebpackPlugin.options.containerVer)?"":t)+"';\n\n    // TODO Remove the copy step once OnePlayer Loader supports dynamic importing. (https://onedrive.visualstudio.com/OMG/_workitems/edit/1170258)\n    onePlayerLoaderFullStaticPath = window.__webpack_public_path__;\n\n    // Set theme and default title.\n    document.documentElement.classList.add(\"theme-"+(null==(t=e.htmlWebpackPlugin.options.theme)?"":t)+'");\n    document.title = "Microsoft Teams";\n  <\/script>\n  '+(null==(t=e.htmlWebpackPlugin.options.partials.favicons)?"":t)+"\n\n  ",e.htmlWebpackPlugin.options.isMainWindow&&(n+='\n    <script type="text/javascript" nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+"\">\n      __webpack_nonce__ = '"+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+"';\n    <\/script>\n\n    <script nonce=\""+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n      performance.mark("execute-index-html-script");\n    <\/script>\n  '),n+="\n\n  <style>\n    html,\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Web', sans-serif;\n      width: 100%;\n      height: 100%;\n      padding: 0;\n      margin: 0;\n      color: var(--themeColor);\n    }\n\n    html {\n      font-size: 10px;\n      forced-color-adjust: none;\n    }\n\n    body {\n      /*\n        We cannot apply the background color on the HTML element. It covers the video during calls.\n      */\n      background-color: var(--themeBackgroundColor);\n      font-size: 1.4rem;\n      overflow: hidden;\n      /*\n      Prevent pinch-to-zoom\n      TODO: remove this when #1958571 is done\n      */\n      touch-action: none;\n    }\n\n    /** Enable antialiasing and font smoothing across supporting browsers for all elements */\n    * {\n      -webkit-font-smoothing: antialiased;\n      -moz-osx-font-smoothing: grayscale;\n    }\n\n    /*!*Remove hidden ADAL iframes borders as to not cause unnecessary vertical scrolling*!*/\n    body>iframe[id^=\"adal\"] {\n      border: 0;\n    }\n  </style>\n\n  ",e.htmlWebpackPlugin.options.partials.loadingScreenStyles&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.loadingScreenStyles)?"":t)+"\n  "),n+="\n\n  ",e.htmlWebpackPlugin.options.partials.titleBarStyles&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.titleBarStyles)?"":t)+"\n  "),n+="\n\n  ",e.htmlWebpackPlugin.options.partials.errorScreenStyles&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.errorScreenStyles)?"":t)+"\n  "),n+="\n\n  ",e.htmlWebpackPlugin.options.partials.themeStyles&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.themeStyles)?"":t)+"\n  "),n+="\n\n</head>\n\n<body>\n\n  ",e.htmlWebpackPlugin.options.partials.preloadTitleBar&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.preloadTitleBar)?"":t)+"\n  "),n+='\n\n  <div id="app" style="display: block; height: inherit;"></div>\n\n  ',e.htmlWebpackPlugin.options.partials.errorScreen&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.errorScreen)?"":t)+"\n  "),n+="\n\n  ",e.htmlWebpackPlugin.options.partials.loadingScreen&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.loadingScreen)?"":t)+"\n  "),n+="\n\n  ",e.htmlWebpackPlugin.options.partials.titleBar&&(n+="\n    "+(null==(t=e.htmlWebpackPlugin.options.partials.titleBar)?"":t)+"\n  "),n+='\n\n  <script type="application/javascript" nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n    // This code is required to provide post message communication between hosted iframe and core window.\n    (function() {\n      function proxyPostMessage(target, message, targetOrigin, transfer) {\n        if (targetOrigin && target && target.contentWindow) {\n          target.contentWindow.postMessage(message, targetOrigin, transfer);\n        } else {\n          console.log("either targetOrigin or target is invalid");\n        }\n      }\n      window.proxyPostMessage = proxyPostMessage;\n    })();\n  <\/script>\n\n  \x3c!-- Only use custom inject logic if `inject: false` is set --\x3e\n ',!e.htmlWebpackPlugin.options.inject&&e.htmlWebpackPlugin.files.js){for(var m of(n+='\n    \x3c!-- Chunk loader configuration - only named chunks --\x3e\n    <script id="cache-chunks" type="application/javascript" nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+"\">\n      window.__experienceWindowChunks__ = JSON.parse(\n        '"+(null==(t=JSON.stringify(Object.fromEntries(i.filter((e=>!/^[0-9]+$/.test(e.id))).map((e=>[e.id,e.path])))))?"":t)+'\');\n    <\/script>\n\n    <script id="loader-config" nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n      window.loaderConfig = {\n        experienceName: "'+(null==(t=e.htmlWebpackPlugin.options.experienceName)?"":t)+'",\n        build: "'+(null==(t=e.htmlWebpackPlugin.options.containerVer)?"":t)+'",\n        manifest: {\n          chunks: '+(null==(t=JSON.stringify(o))?"":t)+",\n          buildTimeConfigs: "+(null==(t=JSON.stringify(l))?"":t)+",\n          asyncEntry: {\n            chunks: "+(null==(t=JSON.stringify(s))?"":t)+"\n          },\n        },\n        ",e.htmlWebpackPlugin.options.isContainerBuild&&(n+='\n        buildId: "'+(null==(t=e.htmlWebpackPlugin.options.buildId)?"":t)+'", pullRequestId: "'+(null==(t=e.htmlWebpackPlugin.options.pullRequestId)?"":t)+'",\n        '),n+="\n        preInitWorker: true,\n        useDiagnosticsServiceV2: true\n      }\n    <\/script>\n\n    ",r))n+='\n        <script id="'+(null==(t=m.id)?"":t)+'" src="'+(null==(t=m.path)?"":t)+'"><\/script>\n    ';for(var m of(n+="\n    ",a))n+="\n      ",e.htmlWebpackPlugin.options.inlineLoaderScripts?n+='\n        <script id="'+(null==(t=m.id)?"":t)+'" nonce="'+(null==(t=e.htmlWebpackPlugin.options.cspNonce)?"":t)+'">\n          '+(null==(t=e.compilation.assets[m.path.substr(e.htmlWebpackPlugin.files.publicPath.length)].source())?"":t)+"\n        <\/script>\n      ":n+='\n        <script id="'+(null==(t=m.id)?"":t)+'" src="'+(null==(t=m.path)?"":t)+'"><\/script>\n      ',n+="\n    ";n+="\n\n  "}return n+"\n</body>\n</html>\n"}({htmlWebpackPlugin:{options:{containerVer:a,publicPathScript:i,cspNonce:n,theme:t,viewportContext:o,partials:{favicons:r(),themeStyles:'<style id="theme-styles">\n  .theme-defaultV2,\n  .theme-tfl-default {\n    --themeBackgroundColor: #F5F5F5;\n    --themeColor: #252423;\n  }\n\n  .theme-darkV2,\n  .theme-tfl-dark {\n    --themeBackgroundColor: #141414;\n    --themeColor: #FFF;\n  }\n\n  .theme-contrast {\n    --themeBackgroundColor: #000;\n    --themeColor: #FFF;\n  }\n\n  .mica {\n    --themeBackgroundColor: transparent;\n  }\n\n  .theme-tfl-dark.mercury {\n    --themeBackgroundColor: rgba(10, 10, 10, 0.8);\n  }\n  .theme-tfl-default.mercury {\n    --themeBackgroundColor: rgba(245, 245, 245, 0.6);\n  }\n\n</style>\n',titleBar:o===go.k.flyout?void 0:Hz({environment:e}),titleBarStyles:o===go.k.flyout?void 0:'<style id="pre-core-title-bar-styles">\n\n  #pre-core-title-bar {\n    position: absolute;\n    top: 0;\n    width: inherit;\n    height: 4.8rem;\n    overflow: hidden;\n    display: none;\n    align-items: center;\n    -webkit-app-region: drag;\n    background-color: var(--themeTitleBarBackgroundColor);\n  }\n\n  #pre-core-title-bar.show {\n    display: flex;\n  }\n\n  .pre-core-title-bar.logo {\n    display: inline-block;\n    margin-left: 2.4rem;\n    width: 2rem;\n    height: 2rem;\n    vertical-align: middle;\n  }\n\n  .pre-core-title-bar.logo.hide {\n    display: none;\n  }\n\n  #pre-core-action-buttons {\n    margin: 0 0 0 auto;\n    white-space: nowrap;\n    display: none;\n    -webkit-app-region: no-drag;\n    color: var(--themeTitleBarColor)\n  }\n\n  #pre-core-action-buttons.show {\n    display: flex;\n  }\n\n  .pre-core-action-ui-button {\n    height: 4.8rem;\n    width: 4.4rem;\n    border-radius: 0;\n    background-color: transparent;\n    min-width: 3.2rem;\n    padding: 0;\n    border: 0;\n    transition: all 100ms ease 0s;\n    cursor: pointer;\n    max-width: 28rem;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n    vertical-align: middle;\n    color: var(--themeTitleBarButtonColor);\n  }\n\n  /* default hover style of action ui button*/\n  .pre-core-action-ui-button:hover {\n    background-color: var(--themeTitleBarButtonHoverBackgroundColor);\n    color: var(--themeTitleBarButtonHoverColor);\n  }\n\n  .pre-core-action-ui-button:hover .pre-core-action-ui-icon {\n    visibility: visible;\n  }\n\n  .pre-core-action-ui-button:focus,\n  .pre-core-action-ui-button:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  .pre-core-action-ui-box {\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .pre-core-action-ui-icon {\n    vertical-align: middle;\n    display: inline-block;\n  }\n\n  .pre-core-action-ui-icon.hide {\n    display: none;\n  }\n\n  .pre-core-action-ui-svg {\n    height: 1.6rem;\n    width: 1.6rem;\n    display: block;\n    fill: currentColor;\n    transform: rotate(0deg);\n  }\n\n  /* Close button with hover*/\n  #pre-core-title-bar-close-button:hover {\n    background: rgb(196, 49, 75);\n    color: #fff;\n  }\n\n  #pre-core-title-bar-close-button:hover .outline {\n    display: none;\n  }\n\n  #pre-core-title-bar-close-button:hover .filled {\n    display: block;\n  }\n\n  /* Close button without hover*/\n  #pre-core-title-bar-close-button .outline {\n    display: block;\n  }\n\n  #pre-core-title-bar-close-button .filled {\n    display: none;\n  }\n\n  /* Light Theme */\n  .theme-defaultV2,\n  .theme-tfl-default {\n    --themeTitleBarBackgroundColor: #ebebeb;\n    --themeTitleBarColor: #616161;\n    --themeTitleBarButtonHoverBackgroundColor: rgba(255,255,255,0.65);\n    --themeTitleBarButtonHoverColor: #616161;\n  }\n\n  /* Dark Theme */\n  .theme-darkV2,\n  .theme-tfl-dark {\n    --themeTitleBarBackgroundColor: #0a0a0a;\n    --themeTitleBarColor: #adadad;\n    --themeTitleBarButtonHoverBackgroundColor: rgba(255,255,255,0.1);\n    --themeTitleBarButtonHoverColor: #adadad;\n  }\n\n  /* High Contrast Theme */\n  .theme-contrast {\n    --themeTitleBarBackgroundColor: rgb(90, 90, 90);\n    --themeTitleBarColor: #fff;\n    --themeTitleBarButtonHoverBackgroundColor: #1aebff;\n    --themeTitleBarButtonHoverColor: #000;\n  }\n\n  /* Mica overrides */\n  .mica {\n    --themeTitleBarBackgroundColor: transparent;\n  }\n  \n  #high-contrast-logo {\n    width: 2rem; \n    color:white;\n    fill: white; \n    display:none\n  }\n\n  .theme-contrast #high-contrast-logo {\n    display: block;\n  }\n\n  .theme-contrast #normal-logo {\n    display: none;\n  }\n</style>'}},files:{}}});return s};var qz=n(367966),Gz=n(893634);const Yz=({action:e,appRenderMode:t,coreSettings:n,type:i})=>{const a=new qz.D,{criticalPhaseTimeout:o,postCriticalPhaseTimeout:r,enableRenderingOrder:s}=n.get(c.w.Activity),l=[];switch(t){case se.w.Rail:i!==ke.ck.activityslicecontent&&(s?(l.push(Gz.m.FEED_LIST_ITEMS_RENDERED),l.push(Gz.m.FEED_ITEM_NAVIGATION)):l.push(Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED)),i===ke.ck.activityslicecontent&&l.push(Gz.m.FEED_SLICE_LIST_RENDERED);case se.w.Main:e===ke.SY.empty&&l.push(Gz.m.NO_FEED_GRAPHICS_RENDERED)}return a.registerAppPhase({phase:m.Jj.CRITICAL,signals:l,timeout:o||6e4}),a.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:r||12e4}),a.appPhases},Qz={id:"com.microsoft.teams.activity",name:"Activity",getLocalizedName:async e=>(await e.waitForNamespace("activity"),e.stringTranslate("activity","activity_app_name")),actors:[Hr],supportedEntities:[ke.ck.activity,ke.ck.notificationsettingsdefault,ke.ck.activityinapptoastundo,ke.ck.activityslicecontent],supportedRenderModes:[se.w.Main,se.w.Rail,se.w.Modal],getDefaultCommand:()=>({type:ke.ck.activity,action:ke.SY.default}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20},shouldDeferNavigationToMainSlotApp:!0},Jz=e=>{if(Kz(e))return Zz(e)?{subNavEntity:Xz(e),headerEntity:eq(e),startEntity:tq(e),mainEntity:nq(e),endEntity:aq(e),midNavEntity:iq(e)}:null},Kz=({layoutMode:e,entity:t,coreSettings:n})=>{const{action:i=null,type:a}={...t},o=[Yt.Rm.standard].includes(e),r=[ke.SY.list,ke.SY.default,ke.SY.empty],s=[ke.ck.activity];(n?.get(c.w.Activity).enableActivitySlices??!1)&&(s.push(ke.ck.activityslicecontent),r.push(ke.SY.view),r.push(ke.SY.update));const l=i&&r.includes(i),d=s.includes(a);return!!(o&&d&&l)},Zz=()=>!0,Xz=({entity:e})=>e,eq=({entity:e,contextEntity:t})=>rq(e,t),tq=()=>null,nq=({entity:e,contextEntity:t})=>{const{action:n=null}={...e};return n&&n===ke.SY.empty?{...e,action:n}:rq(e,t)},iq=({coreSettings:e,entity:t})=>e?.get(c.w.Activity).enableActivitySlices??!1?{...t,type:ke.ck.activityslicecontent}:null,aq=()=>null,oq=({areEmptySlotsTransparent:e,coreSettings:t})=>{const n=t?.get(c.w.Platform).deviceInfo,i=n&&(0,H$.D)(n),a=!!t?.get(c.w.Core).enableTransparentLeftRail,o=!!t?.get(c.w.MercuryDesign).enableMercuryDesign,r=!!t?.get(c.w.MercuryDesign).enableMercuryShell2_5;return{subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:(!i||r)&&(a||e),isColorSchemeDefaultBackground3:!e,isWideSubNav:o}},midNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!i&&(a||e),isColorSchemeDefaultBackground3:!e}}}},rq=(e,t)=>t&&(e=>e&&e.type===ke.ck.activity&&e.action===ke.SY.default)(e)?{...t,linkedEntity:null}:null,sq=e=>e?.get(c.w.Activity).enableActivitySlices??!1?be.Cu.SliceSwitch:be.Cu.ActivitySwitch,lq=(e,t,n)=>sq(n),cq=(e,t,n)=>{const i=sq(n);return e.command.stateTransition===g.Ar.flow?i:void 0},dq={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==ke.ck.activity,shouldRestoreClientToEntities:e=>e.subNavEntity?.type!==ke.ck.activity};var uq=n(697673);const mq="entitymoreinfo",pq="requestPersonMoreInfo",gq="requestPersonMoreOrgInfo",hq="requestTopicMoreInfo",vq=e=>({actor:mq,action:pq,data:e}),yq=e=>({actor:mq,action:gq,data:e}),Sq=e=>({actor:mq,action:hq,data:e});var fq=n(265830);const kq={onEventReceived:async({eventInput:e})=>{const{event:t}=e;switch(t.type){case uq.mu.requestPersonMoreInfo:const e=t.data?.();return{command:vq(e)};case fq.a.viewSliceFeedItems:const n=t.data?.();return{command:Yr(n)};case Br.mu.goBack:return Promise.resolve({command:ee.goBack()})}}};var Cq=n(620317),bq=n(207229),wq=n(184506),Tq=n(21307),Iq=n(977190);const Nq=e=>({visibilityState:g.Rp.show,stateTransition:e,correlation:{source:A.p.AppBar}}),Aq=e=>({id:e,action:ke.SY.default,type:ke.ck.activity}),Eq=e=>({entity:Aq(e),command:Nq(g.Ar.flush)}),Fq="ActivityEarlyFirstPageFetch",_q=(e,t,n)=>{const i=e?.edges[0]?.node;if(!i)return n.log("Top feed unavailable, cannot intercept command"),null;const{activityNavigationParams:a}=i;let o=!1,r=null;const s=t.executionContext.viewEntities.mainEntity?.type;if(a.navigationTarget===Iq.M.chat)o=s===ke.ck.chats,r=(({messageId:e,threadId:t},n,i)=>{if(!t)throw(0,Je.$5)(Fq,d.O4.MissingParameter,"getInterceptedChatCommand");const a=n.client?.ctx?.entityCommanding?.chat;if(!a)throw i.error("Did not find activityCommanding"),(0,Je.$5)(Fq,d.O4.NotPresent,"getInterceptedChatCommand");const o=a.getChatByIdCommand(t,{entityOptions:{focusOnLoad:Bt.I.DoNotMove,messageId:e}});if(!o)return i.error("Chat commanding did not return a command"),null;const{entity:r,entityOptions:s}=o;return{entity:{...r,linkedEntity:Aq(Cq.tV.noNavOnSameMainEntity)},command:Nq(g.Ar.forceFlush),entityOptions:s}})(a,t,n),n.log(`Top feed mainEntity: chat, previousMainEntity: ${s}`);return null===r?null:o?r:Eq(Cq.tV.navOnDifferentMainEntity)},Dq=async({commandInput:e,requestContext:t})=>{const{command:n,command:{action:i}}=e,a=t.loggerFactory.newLogger("ActivityApp onCommandReceived","apps-activity");if(n.actor!==Hr)return void a.error(`Command for actor '${n.actor}' cannot be handled by ActivityApp.`);const o=t?.coreSettings?.get(c.w.Activity).enableActivitySlices;switch(i){case zr:if(o)return Pq();const e={entity:{id:Cq.tV.navWithoutEarlyFetch,type:ke.ck.activity,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.AppBar}}};return await Mq(t,a)??e;case qr:return Qr(n)&&n.data?.sliceId?{entity:{id:n.data.sliceId,type:ke.ck.activity,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flow,correlation:{source:A.p.ActivitySlices}}}:void a.error(`Command for action ${qr} requires a sliceId`);default:a.error(`Command action '${i}' is not supported at ActivityApp.`)}},Pq=async()=>({entity:{id:bq.U.all,type:ke.ck.activity,action:ke.SY.update},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.AppBar}}}),Mq=async(e,t)=>{const n=e.scenarioFactory.findScenario(be.Cu.ActivitySwitch);if(n&&!e.executionContext.isHandlingAppActiveApp&&e.coreSettings.get(c.w.Activity).enableEarlyFirstPageFetch){if(!Rq(e,t))return null;n.mark(be.BQ.CDLEarlyFetchStart);const i=await xq(e,n,t);if(n.mark(be.BQ.CDLEarlyFetchEnd),i){const e=Oq(i);return wq.H.appendFeedDataBag(t,n,{earlyFetchNavType:e}),t.log(`Early fetch succesful load type: ${e}`),i}}return null},Rq=(e,t)=>{const n=e.executionContext.viewEntities.mainEntity?.type,i=n===ke.ck.chats;return i||t.log(`Early fetch for entity ${n} not supported`),i},xq=async(e,t,n)=>{try{const{earlyFirstPageFetchWaitTimeout:i,paginationFirstLoad:a,enableAvatarUrlResolutionInActivityFeeds:o}=e.coreSettings.get(c.w.Activity),r=Date.now(),{data:{activities:s}}=await(0,yi.a)(e.client.query({query:Tq.J,variables:{first:a??Cq.z2,isFirstPage:!0,filters:{feedTypes:[]},enableAvatarUrlResolutionInActivityFeeds:!!o},fetchPolicy:"network-only"}),i??Cq.h9),l=Date.now()-r;return wq.H.appendFeedDataBag(n,t,{earlyFetchWorkerResponseTime:l}),s?Lq(s,e,t,n)??Eq(Cq.tV.navOnEarlyFetch):(n.warn("Did not find activities in CDL response"),null)}catch(e){const i=(0,Je.rX)(e);return wq.H.appendFeedDataBag(n,t,{earlyFetchErrorCode:i}),n.error(`Early first page fetch failed with code ${i}`),null}},Lq=(e,t,n,i)=>{try{return _q(e,t,i)}catch(e){const t=(0,Je.rX)(e);return wq.H.appendFeedDataBag(i,n,{earlyFetchErrorCode:t}),i.error(`Early fetch command interception failed with code ${t}`),null}},Oq=e=>e.entity.linkedEntity?.id??e.entity.id??"unknown";var jq=n(920136);const Bq=async e=>{const{entityCommand:{entity:{type:t,action:n},command:{visibilityState:i}},requestContext:{loggerFactory:a,coreSettings:o}}=e,{enableActivityAppCommandResultHook:r}=o.get(c.w.Activity);if(!r)return;const s=a.newLogger("ActivityApp[onCommandResult]","apps-activity");if(t!==ke.ck.activity&&n===ke.SY.view&&(s.log(`Windowing command with visibilityState: ${i}`),i===g.Rp.show)){const t=e.entityCommand.metadata?.deepLink;if(t){const n=new URL(t),i=new URLSearchParams(n.search).get("activityId")||"",a=e.requestContext.client;return Uq(s,a,i)}s.warn("Deeplink Url not present")}},Uq=async(e,t,n)=>{e.log(`Marking activity activityId=${n} as read`);try{if(!n)return void e.warn(`Could not mark activity as read: activityId: ${n}`);await t.mutate({mutation:jq.x,variables:{id:n,isRead:!0}})}catch(t){e.errorToTelemetry?.(`mark activity as read failed: activityId ${n} failed`,"feeds_mark_as_read_failed",void 0,!0)}};var $q;!function(e){e.ActivityApp="activity-app",e.ActivityFeedDialogs="activity-feed-dialogs",e.ActivityMainPane="activity-main-pane",e.SlicesActivityApp="slices-activity-app",e.SlicesActivitySubNav="slices-activity-sub-nav"}($q||($q={}));const Wq=()=>Promise.all([n.e(912845),n.e(461500),n.e(669152),n.e(459959),n.e(492852),n.e(459467),n.e(441711),n.e(607842),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(632848),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(478723),n.e(288919),n.e(615002),n.e(830006),n.e(420399),n.e(869986)]).then(n.bind(n,644801)),Vq=()=>Promise.all([n.e(173388),n.e(694045)]).then(n.bind(n,176166)),Hq=()=>Promise.all([n.e(912845),n.e(461500),n.e(669152),n.e(459959),n.e(845039),n.e(492852),n.e(459467),n.e(441711),n.e(875051),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(632848),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(478723),n.e(288919),n.e(615002),n.e(830006),n.e(420399),n.e(765856)]).then(n.bind(n,776774)),zq=()=>null,qq=async(e,t,n,i)=>{switch(t("ChunkLoadStarted",{chunkName:e}),e){case $q.ActivityApp:const{ActivityViewsRenderer:a}=await(0,ev.wg)(Wq,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(a,{coreSettings:i});case $q.SlicesActivityApp:const{SlicesViewsRenderer:o}=await(0,ev.wg)(Hq,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(Or.Suspense,{fallback:"",children:(0,Lr.Y)(o,{})});case $q.SlicesActivitySubNav:const{SlicesActivityViewsRenderer:r}=await(0,ev.wg)(Hq,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(r,{coreSettings:i});case $q.ActivityFeedDialogs:const{ActivityDialogViewsRenderer:s}=await(0,ev.wg)(Vq,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(s,{});case $q.ActivityMainPane:const{ActivityMainPane:l}=await(0,ev.wg)(Wq,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(l,{});default:return(0,Lr.Y)(zq,{})}};var Gq=n(275188),Yq=n(980427),Qq=n(396477),Jq=n(851706),Kq=n(263821),Zq=n(631921),Xq=n(951195),eG=n(418864),tG=n(773379),nG=n(308446),iG=n(965804);const aG=(0,iG.O)({dialogSurface:{B2u0y6b:"fvgz9i8",Bqenvij:"fu2thx1",Byoj8tv:0,uwmqm3:0,z189sj:0,z8tnut:0,B0ocmuz:"f12d1y2"},dialogTitle:{a9b677:"f4cn2hj",B6of3ja:"f1xdg43u"},dialogSubTitle:{a9b677:"fl6va0v",B6of3ja:"f7w72kx"},dialogContent:{mc9l5x:"f22iagw",Beiy3e4:"f1vx9l62",B6of3ja:"f2zxqi"},dialogContentRow:{mc9l5x:"f22iagw",Beiy3e4:"f1063pyq",B6of3ja:"f1xdg43u",Bt984gj:"f122n59",Brf1p80:"f1869bpl"},dropdown:{a9b677:"f1hp80ii"},dropdownLabel:{a9b677:"f19i1hda"},dialogActions:{a9b677:"fly5x3f",B6of3ja:"f109tmk6"},dialogActionsRow:{mc9l5x:"f22iagw",Beiy3e4:"f1063pyq",Bt984gj:"f122n59",a9b677:"fly5x3f"},dialogActionButtons:{a9b677:"f1kyr2gn",Frg6f3:["ff9s3yw","f1phki43"]},dialogActionLink:{a9b677:"f1fay27e"},dialogActionButtonGroup:{mc9l5x:"f22iagw",Beiy3e4:"f1063pyq",Frg6f3:["fcgxt0o","f1ujusj6"]}}),oG=()=>{const[e,t]=Or.useState(!0),n=aG(),i=Or.useCallback(((e,n)=>{t(n.open)}),[]);return(0,Lr.Y)(Qq.l,{open:e,onOpenChange:i,children:(0,Lr.Y)(Jq.E,{className:n.dialogSurface,children:(0,Lr.Y)(Kq.R,{children:[(0,Lr.Y)(Zq.L,{children:(0,Lr.Y)(tG.E,{animation:"pulse",children:[(0,Lr.Y)(nG.H,{size:20,className:n.dialogTitle,"data-testid":"shape"}),(0,Lr.Y)(nG.H,{size:12,className:n.dialogSubTitle,"data-testid":"shape"})]})}),(0,Lr.Y)(Xq.C,{className:n.dialogContent,children:(0,Lr.Y)(tG.E,{animation:"pulse",children:[...Array(4)].map(((e,t)=>(0,Lr.Y)("div",{className:n.dialogContentRow,children:[(0,Lr.Y)(nG.H,{size:12,className:n.dropdownLabel,"data-testid":"shape"}),(0,Lr.Y)(nG.H,{size:32,className:n.dropdown,"data-testid":"shape"})]},t)))})}),(0,Lr.Y)(eG.i,{fluid:!0,className:n.dialogActions,children:(0,Lr.Y)(tG.E,{animation:"pulse",className:n.dialogActionsRow,children:[(0,Lr.Y)(nG.H,{size:12,className:n.dialogActionLink,"data-testid":"shape"}),(0,Lr.Y)("div",{className:n.dialogActionButtonGroup,children:[...Array(2)].map(((e,t)=>(0,Lr.Y)(nG.H,{size:32,className:n.dialogActionButtons,"data-testid":"shape"},t)))})]})})]})})})},rG=()=>Promise.all([n.e(842242),n.e(85394),n.e(175838),n.e(645813)]).then(n.bind(n,841124)),sG=e=>(0,Lr.Y)(Yq.t,{loggerName:"LazyNotificationSettingsRecommendationDialogEntityView",children:(0,Lr.Y)(Gq.d,{factory:rG,props:e,fallback:(0,Lr.Y)(oG,{})})});sG.displayName="LazyNotificationSettingsRecommendationDialogEntityView";var lG=n(556052),cG=n(966973);const dG=async e=>{const{entityCommand:t}=e,{entity:{type:n,action:i}}=t;if(n!==ke.ck.activityinapptoastundo||i!==ke.SY.mutate)return t;await uG(e)},uG=async e=>{const{entityCommand:t,requestContext:n}=e,{userBiService:i,loggerFactory:a}=n,o=t.entityOptions,r=a.newLogger("ActivityOnBeforeCommandHandled","apps-activity");switch(pG(i,o),o.supportedAction){case Cq.i.turnOffLikesAndReactions:case Cq.i.turnOffAllTeamAndChannelMentions:await mG(o,n,cG.n5.Notifications,r);break;case Cq.i.muteApp:await mG(o,n,cG.n5.GraphApps,r)}},mG=async(e,t,n,i)=>{const{scenarioFactory:a}=t,o=e.previousSettings;if(o&&o.length){const r=a.newScenario(be.Cu.ActivityContextualSettingsUpdate);try{await t.client.mutate({mutation:lG.N,variables:{settingsUpdate:{updatedSettings:o},appId:n,subCategoryPageId:e.appId}}),r.stop({supportedActions:`${e.supportedAction}-undo`},"success")}catch(t){const n=`ActivityOnBeforeCommandHandled: Couldn't update activity settings for supportedAction: ${e.supportedAction}, appId: ${e.appId}`;i.error(n),r.fail({supportedActions:`${e.supportedAction}-undo`,reason:n})}}else i.warn(`ActivityOnBeforeCommandHandled: noop, previousSettings is empty for supportedAction: ${e.supportedAction}, appId: ${e.appId}`)},pG=(e,t)=>{const n=e.createDatabag?.();if(n){const{supportedAction:e,activityType:i,activitySubtype:a}=t;n.type=i,n.subType=a,n.supportedAction=e}e.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.undo,actionScenario:GR.vB.activityInAppToastUndo,actionScenarioType:GR.DB.inAppToast,panelType:GR.HP.inAppToast,dataBag:n}),n?.dispose()},gG=()=>Qz.windowFeatures||{};function hG(){const e=()=>null;return{eventHandlers:kq,getAppPhases:Yz,getAppViewEntities:Jz,getAppViewEntitiesProps:oq,getAppWindowFeatures:gG,getCommandScenarioName:lq,getCommandScenarioNameFromSource:cq,getPlatformAppIdForEntity:e=>e.type===ke.ck.activity||e.type===ke.ck.activityslicecontent?"14d6962d-6eeb-4f48-8890-de55454bb136":void 0,manifest:Qz,onBeforeAddToNavigation:dq,onBeforeCommandHandled:dG,onCommandReceived:Dq,onCommandResult:Bq,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a,entity:o})=>{switch(t){case se.w.Main:return qq($q.ActivityMainPane,i,a,n);case se.w.Rail:switch(o.type){case ke.ck.activityslicecontent:return qq($q.SlicesActivityApp,i,a,n);case ke.ck.activity:default:const e=n?.get(c.w.Activity).enableActivitySlices??!1?$q.SlicesActivitySubNav:$q.ActivityApp;return qq(e,i,a,n)}case se.w.Modal:return o.type===ke.ck.notificationsettingsdefault?(0,Lr.Y)(sG,{}):qq($q.ActivityFeedDialogs,i,a,n);default:return(0,Lr.Y)(e,{})}}}}var vG=n(965937);const yG=e=>{if(SG(e))return fG(e)?{subNavEntity:kG(e),headerEntity:CG(e),startEntity:bG(e),mainEntity:wG(e),endEntity:TG(e)}:null},SG=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.annotation].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},fG=()=>!0,kG=()=>null,CG=()=>null,bG=()=>null,wG=({entity:e})=>e,TG=()=>null,IG=()=>({mainEntity:{[se.w.Main]:{forceDisableTitleBar:!0,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!0,isSlotBackgroundTransparent:!0,UNSAFE_enablePptProvider:!0,disableNotificationsBanners:!0}}}),NG={id:"com.microsoft.teams.annotation",name:"AnnotationApp",supportedEntities:[ke.ck.annotation],supportedRenderModes:[se.w.Main],windowFeatures:{additionalFeatures:{alwaysOnTop:"true",excludeWindowFromScreenSharing:"true",transparent:"true",hideWindowControl:"true",resizable:"false",movable:"false"},top:0,left:0,height:360,width:640,minHeight:360,minWidth:640}},AG=()=>Promise.all([n.e(736704),n.e(555694)]).then(n.bind(n,705465)),EG=({windowOptions:e,coreServices:t})=>{const n=t?.coreSettings.get(c.w.Calling).disableContentprotection,i=(!n).toString(),a={...NG.windowFeatures.additionalFeatures,contentprotection:i};return e&&NG.windowFeatures?{additionalFeatures:a,top:e.top,left:e.left>0?e.left:e.left/2,width:NG.windowFeatures.width,height:NG.windowFeatures.height,minWidth:NG.windowFeatures.minWidth,minHeight:NG.windowFeatures.minHeight,fullscreen:!0}:{...NG.windowFeatures,additionalFeatures:a,fullscreen:!0}};function FG(){const e=()=>null;return{getAppViewEntities:yG,getAppViewEntitiesProps:IG,getAppWindowFeatures:EG,manifest:NG,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===se.w.Main){const{Annotation:e}=await(0,ev.wg)(AG,"annotation-app",n);return(0,Lr.Y)(vG.e,{namespace:"calling",loaderRenderer:null,children:(0,Lr.Y)(e,{})})}return(0,Lr.Y)(e,{})}}}const _G={id:"com.microsoft.teams.breakout-rooms",name:"BreakoutRoomsApp",supportedEntities:[ke.ck.breakoutrooms,ke.ck.breakoutroomsassignment,ke.ck.breakoutroomsassignmenttype,ke.ck.breakoutroomscreaterooms,ke.ck.breakoutroomsdeleteroom,ke.ck.breakoutroomsdeleterooms,ke.ck.breakoutroomseditroom,ke.ck.breakoutroomssettings],supportedRenderModes:[se.w.Main,se.w.HorizontalBar,se.w.Rail],getDefaultCommand:()=>({type:ke.ck.breakoutrooms,action:ke.SY.view}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20}},DG=e=>{if(PG(e))return MG(e)?{subNavEntity:RG(e),headerEntity:xG(e),startEntity:LG(e),mainEntity:OG(e),endEntity:jG(e)}:null},PG=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=[Yt.Rm.standard,Yt.Rm.focus].includes(t),o=[ke.SY.view,null].includes(n),r=[ke.ck.breakoutrooms].includes(i);return!!(n&&a&&r&&o)},MG=()=>!0,RG=({entity:e,layoutMode:t})=>[Yt.Rm.standard].includes(t)?e:null,xG=({entity:e,layoutMode:t})=>[Yt.Rm.standard].includes(t)?e:null,LG=()=>null,OG=({layoutMode:e,entity:t})=>[Yt.Rm.standard,Yt.Rm.focus].includes(e)?t:null,jG=()=>null,BG=({areEmptySlotsTransparent:e})=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:!0}},subNavEntity:{[se.w.Rail]:{isBackgroundTransparent:e}},headerEntity:{[se.w.HorizontalBar]:{isBackgroundTransparent:e}}}),UG=()=>Promise.all([n.e(912845),n.e(953696),n.e(320494),n.e(224316),n.e(120951),n.e(914945),n.e(725973),n.e(616161),n.e(524147),n.e(296930),n.e(293328),n.e(5982),n.e(353927),n.e(703283),n.e(908275),n.e(307422),n.e(467129),n.e(202564),n.e(221963),n.e(524014),n.e(405226),n.e(736704),n.e(163525),n.e(317910),n.e(634370),n.e(889780),n.e(758449),n.e(724070)]).then(n.bind(n,224052)),$G="breakout-rooms-northstar-app",WG=()=>_G.windowFeatures||{};function VG(){const e=()=>null;return{manifest:_G,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){n("ChunkLoadStarted",{chunkName:$G});const{BreakoutRoomsAppEntry:e}=await(0,ev.wg)(UG,$G,i);return n("ChunkLoadSucceeded",{chunkName:$G}),(0,Lr.Y)(vG.e,{namespaces:["breakoutRooms"],loaderRenderer:null,children:(0,Lr.Y)(e,{})})}return(0,Lr.Y)(e,{})},getAppViewEntities:DG,getAppViewEntitiesProps:BG,getAppWindowFeatures:WG,onRegister:e=>{e.registerTask(new rh)}}}var HG=n(790628),zG=n(345640);const qG=e=>({entityCommand:{entity:{type:"unsupporteddeeplinkdialog",action:"view"},command:{layoutMode:"standard",stateTransition:"extend",visibilityState:"show"},entityOptions:{originalDeeplink:e}},metadata:{allowAnonymous:!1,userContextId:void 0}}),GG=(e,t,n,i,a,o,r,s)=>{const{tenantId:l,organizerId:c,conversationId:d,rootMessageId:u}=e,m=`${l}__${c}__${d}__${u}`;if((a||i)&&r?.config.clientType===nt.sK.Web)return Promise.resolve({entityCommand:{entity:{id:m,type:"broadcasts",action:"view"},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.standard},entityOptions:{threadId:d,messageId:u,tenantId:l,organizerId:c}},metadata:{allowAnonymous:!0,tenantId:l}});if(n){if(r&&r.config.clientType===nt.sK.Maglev)return Promise.resolve({entityCommand:{entity:{id:m,type:"broadcasts",action:"view"},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus},entityOptions:{threadId:d,messageId:u,tenantId:l,organizerId:c}},metadata:{allowAnonymous:!0,tenantId:l}});if(s&&r&&r.config.clientType===nt.sK.Web){const e=(0,Un.z)(),t=(0,zG.q2)(m,s,!0),n=o?"_self":"_blank";return e.open(t,n),Promise.resolve(void 0)}}return Promise.resolve(qG(t))};var YG,QG=n(264642);!function(e){e.EmptyDeeplinkUrl="empty-deeplink-url-received",e.EmptyContext="empty-context-received",e.InvalidIsBroadcastMeetingType="invalid-isBroadcastMeeting-type",e.InvalidRoleType="invalid-role-type"}(YG||(YG={}));const JG=/\{\"Tid\":\"([\w\-]{36})\",\"Oid\":\"([\w\-]{36})\",\"IsBr/,KG={filter:e=>{if(!e.pathname.includes("/l/meetup-join"))return!1;const t=new URLSearchParams(e.search).get("context");if(!t)return!1;try{const{IsBroadcastMeeting:e}=JSON.parse(t);return e}catch(e){return!!(e=>3===decodeURIComponent(e).match(JG)?.length)(t)}},execute:async({deeplinkUrl:{pathname:e,search:t},context:{coreSettings:n,__doNotUse_globalDataClient:i,getUserContexts:a}})=>{const{allowBroadcastAttendeeMeetingJoinsInT2:o,allowBroadcastAttendeeMeetingJoinsInT2Web:r,conveneTemplateUrl:s,allowBroadcastPresenterJoinsInT2:l}=n.get(c.w.Broadcast);if(!e)return Promise.reject({message:YG.EmptyDeeplinkUrl});t=decodeURIComponent(t);const d=ZG(await a()),u=decodeURIComponent(e).split(/[/?&]/),m=u.indexOf("meetup-join")+1,p=u[m],h=u[m+1],v=new URLSearchParams(t);v.set("anon","true");const y=v.get("deeplinkId"),S=v.get("context");if(!S)return Promise.reject({message:YG.EmptyContext});const{tenantId:f,organizerId:k,isBroadcastMeeting:C,roleHint:b,isTruncatedBroadcastLink:w}=await(e=>{let t,n,i,a;try{const o=JSON.parse(e);return t=o.Tid,n=o.Oid,i=o.IsBroadcastMeeting,a=o.role,{tenantId:t,organizerId:n,isBroadcastMeeting:i,roleHint:a,isTruncatedBroadcastLink:!1}}catch(o){const r=e.match(JG);if(3===r?.length){const e=2;return t=r[1],n=r[e],i=!0,a="a",{tenantId:t,organizerId:n,isBroadcastMeeting:i,roleHint:a,isTruncatedBroadcastLink:!0}}return Promise.reject(o)}})(S);if(w&&v.set("context",JSON.stringify({Tid:f,Oid:k,IsBroadcastMeeting:C,role:b})),!(0,we.isBoolean)(C))return Promise.reject({message:YG.InvalidIsBroadcastMeetingType});if(!("a"===b||void 0===b))return Promise.reject({message:YG.InvalidRoleType});const T="a"===b,I=`${e}?${v.toString()}`;let N;const A=((e,t)=>{if("null"!==e)return e;const n=t.get("fqdn");return n?`https://${n}`:void 0})(origin,v);A&&(N=`${A}/_#${e}?${v.toString()}`);const E={joinType:"Legacy",conversationId:p,messageId:h,rootMessageId:h,isChannel:"0"!==h,isAdhoc:!1,tenantId:f,organizerId:k,meetingCloud:v.get("fqdn")||(0,QG.Ru)(origin)};return((e,t,n,i,a,o,r,s,l,c,d,u,m,p)=>{const{tenantId:h,conversationId:v,rootMessageId:y}=o;return n&&!r?a?.config.clientType===nt.sK.Web?GG(o,i,e,t,c,!!u,a,d):Promise.resolve({entityCommand:{entity:{type:"callingdeeplink",action:"join",id:`${v}/${y}`},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus},entityOptions:{deeplinkUrl:i,coordinates:o,directMeetingLink:m,deepLinkId:u,roleHint:s,isBroadcastMeeting:l}},metadata:{allowAnonymous:!!p,tenantId:h}}):r?GG(o,i,e,t,c,!!u,a,d):Promise.resolve(qG(i))})(o||!1,r||!1,l||!1,I,i?.ctx?.platformService,E,T,b,C,d,s||void 0,y,N,!0)}},ZG=e=>{const t=e&&e.length>0?e[e.length-1]:void 0;return t?.context?.client?.ctx?.authenticationUser.role===pg.a7.Guest},XG=[KG],eY=e=>{if(tY(e))return nY(e)?{subNavEntity:iY(e),headerEntity:aY(e),startEntity:oY(e),mainEntity:rY(e),endEntity:sY(e)}:null},tY=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.broadcasts,ke.ck.eventsbroadcastqna,ke.ck.broadcastwebjoinnotsupporteddialog].includes(i),r=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view,ke.SY.info],s=n&&r.includes(n);return!!(a&&o&&s)},nY=()=>!0,iY=()=>null,aY=({entity:e})=>e,oY=()=>null,rY=({entity:e})=>e,sY=({contextEntity:e})=>{const{action:t,type:n}=e||{};return e&&(n===ke.ck.broadcasts&&t===ke.SY.info||n===ke.ck.eventsbroadcastqna)||e&&n===ke.ck.broadcastwebjoinnotsupporteddialog?e:null},lY={id:"com.microsoft.teams.broadcast",name:"Broadcast",supportedEntities:[ke.ck.broadcasts,ke.ck.broadcastfeedback,ke.ck.eventsbroadcastqna,ke.ck.broadcastwebjoinnotsupporteddialog],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail,se.w.Modal],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600}};var cY=n(81092),dY=n(805997);const uY={onEventReceived:async({eventInput:e})=>e.event.type===dY.h.leaveBroadcastQualityFeedback?Promise.resolve({command:ee.defaultCommand({forceTransition:!0})}):Promise.resolve(void 0)},mY=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(120951),n.e(984552),n.e(169767),n.e(914945),n.e(787454),n.e(490329),n.e(181316),n.e(984165),n.e(616161),n.e(293328),n.e(615694),n.e(307422),n.e(94139),n.e(784980),n.e(235881),n.e(524014),n.e(625303),n.e(53966),n.e(405226),n.e(40459),n.e(715192),n.e(936254),n.e(684694),n.e(813370),n.e(736704),n.e(840809),n.e(163525),n.e(317910),n.e(566999),n.e(461824),n.e(972591),n.e(889780),n.e(493534),n.e(991043),n.e(252751),n.e(99210)]).then(n.bind(n,378791)),pY=({coreServices:{coreSettings:e},host:t,isResize:n})=>{const{minHeight:i,minWidth:a}=lY.windowFeatures||{},o=t?.screen;if(n&&!o)return lY.windowFeatures||null;if(!o)return null;let{height:r=1,width:s=1}=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=lY.windowFeatures||{};let{width:a,height:o}=lY.windowFeatures||{};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:d}=t.get(c.w.Broadcast);if(s&&l&&d)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=d*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/d*a}return{height:o,width:a}})(o,e);const l=o.availHeight-20,d=s>=o.availWidth||r>=l;d&&(r=o.availHeight,s=o.availWidth);const{left:u,top:m}=((e,t,n,i,a)=>{if(i)return{left:0,top:0};const o="availLeft"in e?e.availLeft:0,r="availTop"in e?e.availTop:0,s=o+e.availWidth/2-t/2;let l;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":l=r+a;break;default:l=r+e.availHeight/2-n/2}return{left:s,top:l}})(o,s,r,d,20);return{additionalFeatures:{minHeight:`${i}`,minWidth:`${a}`},height:r,width:s,fullScreen:d,left:u,top:m,minHeight:i,minWidth:a}};function gY(){const e=()=>null;return{getAppViewEntities:eY,getAppWindowFeatures:pY,onBeforeDeeplinkParsed:XG,manifest:lY,render:async({appRenderMode:t,scenarioFactory:n})=>{const i=(0,E.v4)();switch(t){case se.w.HorizontalBar:case se.w.Main:case se.w.Rail:case se.w.Modal:const a="broadcast-app",{BroadcastViewsRenderer:o}=await(0,ev.wg)(mY,a,n);return(0,Lr.Y)(cY._P,{joinId:i,children:(0,Lr.Y)(vG.e,{namespace:"broadcast",loaderRenderer:null,children:(0,Lr.Y)(HG.TS,{children:(0,Lr.Y)(o,{appRenderMode:t})})})});default:return(0,Lr.Y)(e,{})}},eventHandlers:uY}}const hY="BroadcastEvents",vY="closeViewBroadcastEvent",yY="createBroadcastEvent",SY="editBroadcastEvent",fY="viewBroadcastEvent",kY="cancelBroadcastEvent",CY="showBroadcastEventError",bY="discardBroadcastEvent",wY=()=>({actor:hY,action:vY}),TY=()=>({actor:hY,action:yY}),IY=e=>({actor:hY,action:SY,data:e}),NY=e=>({actor:hY,action:fY,data:e}),AY=e=>({actor:hY,action:kY,data:e}),EY=()=>({actor:hY,action:CY}),FY=()=>({actor:hY,action:bY}),_Y={id:"com.microsoft.teams.broadcast-scheduling",name:"BroadcastSchedulingApp",actors:[hY],supportedEntities:[ke.ck.broadcastscheduling],supportedRenderModes:[se.w.Main,se.w.Modal,se.w.HorizontalBar],windowFeatures:{minWidth:1080,width:1080,minHeight:720,height:720}},DY=e=>{if(PY(e))return MY(e)?{subNavEntity:RY(e),headerEntity:xY(e),startEntity:LY(e),mainEntity:OY(e),endEntity:jY(e)}:null},PY=({entity:e})=>{const{action:t=null,type:n}={...e},i=[ke.ck.broadcastscheduling].includes(n),a=[ke.SY.create,ke.SY.view,ke.SY.update,ke.SY.confirm,ke.SY.error],o=t&&a.includes(t);return!(!i||!o)},MY=()=>!0,RY=()=>null,xY=({entity:e})=>e,LY=()=>null,OY=({entity:e})=>e,jY=()=>null;var BY=n(86221);const UY={onEventReceived:async({requestContext:{loggerFactory:e},eventInput:{event:{originator:t,type:n,data:i},source:a}})=>{const o=e.newLogger("onEventReceived","apps-broadcast-scheduling");if(t===BY.Nv)return $Y(o,n,i,a);o.error(`Event from originator '${t}' cannot be handled by BroadcastSchedulingApp.`)}},$Y=(e,t,n,i)=>{if(t===BY.mu.closeViewBroadcastEvent)return{command:wY(),source:i};if(t===BY.mu.showBroadcastEventError)return{command:EY(),source:i};if(t===BY.mu.discardBroadcastEvent)return{command:FY(),source:i};if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();switch(t){case BY.mu.editBroadcastEvent:return(0,BY.y8)(a)?{command:IY(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);case BY.mu.cancelBroadcastEvent:return(0,BY.k8)(a)?{command:AY(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);default:return void e.error(`Event type '${t}' is not supported by BroadcastSchedulingApp.`)}};var WY;!function(e){e.CancelEvent="CancelEvent",e.DiscardEvent="DiscardEvent"}(WY||(WY={}));const VY=async({requestContext:{loggerFactory:e},commandInput:{command:{actor:t,action:n,data:i}}})=>{const a=e.newLogger("onCommandReceived","apps-broadcast-scheduling");if(t===hY)switch(n){case vY:return{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.view},command:{stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.hide,correlation:{source:A.p.BroadcastScheduling}}};case yY:return{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.create},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastScheduling}}};case SY:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.update},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastScheduling}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case fY:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.view},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastScheduling}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case kY:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.confirm},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastScheduling}},entityOptions:{confirmationDialogType:WY.CancelEvent,option:{[WY.CancelEvent]:{eventId:i.eventId}}}}:void a.error(`Command data is invalid for command '${n}'.`);case CY:return{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.error},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastScheduling}}};case bY:return{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.confirm},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastScheduling}},entityOptions:{confirmationDialogType:WY.DiscardEvent}};default:return void a.error(`Command action '${n}' is not supported by BroadcastSchedulingApp.`)}a.error(`Command for actor '${t}' cannot be handled by BroadcastSchedulingApp.`)};var HY;!function(e){e.broadcastEventCreate="/l/broadcast/create",e.broadcastEvent="/l/broadcast"}(HY||(HY={}));const zY=[{filter:HY.broadcastEventCreate,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("BroadcastScehdulingApp onBeforeDeeplinkParsed","apps-broadcast-scheduling"),{pathname:i}=e;return n.log(`Parsing deeplinkUrl - pathname: ${i}`),Promise.resolve({entityCommand:{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.create},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{source:A.p.BroadcastEventOnBeforeDeeplinkParsed}}},metadata:{allowAnonymous:!1}})}},{filter:HY.broadcastEvent,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("BroadcastSchedulingApp onBeforeDeeplinkParsed","apps-broadcast-scheduling"),{pathname:i}=e;n.log(`Parsing deeplinkUrl - pathname: ${i}`);const a=i.split("/")[3];return Promise.resolve({entityCommand:{entity:{type:ke.ck.broadcastscheduling,action:ke.SY.view,id:a},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:A.p.BroadcastEventOnBeforeDeeplinkParsed}}},metadata:{allowAnonymous:!1}})}}],qY=({prevEntityType:e})=>e===ke.ck.broadcastscheduling?null:_Y.windowFeatures,GY=()=>Promise.all([n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(914945),n.e(461500),n.e(490329),n.e(598188),n.e(725973),n.e(842242),n.e(459959),n.e(255544),n.e(867529),n.e(628320),n.e(613193),n.e(836070),n.e(906930),n.e(170798),n.e(585280),n.e(892415),n.e(382218),n.e(867345),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(972751),n.e(921389),n.e(638918),n.e(151748),n.e(370494),n.e(681848),n.e(348623),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(337595),n.e(385971),n.e(935685),n.e(257394),n.e(673488)]).then(n.bind(n,977651));const YY=e=>{if(QY(e))return JY(e)?{subNavEntity:KY(e),headerEntity:ZY(e),startEntity:XY(e),mainEntity:eQ(e),endEntity:tQ(e)}:null},QY=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.standard,Yt.Rm.focus].includes(e),o=[ke.SY.create,ke.SY.default,ke.SY.view,ke.SY.list],r=n&&o.includes(n),s=[ke.ck.calendar,ke.ck.schedulingform].includes(i),l=ke.ck.schedulingform!==i&&ke.SY.view===n&&Yt.Rm.focus===e;return!(!(a&&s&&r)||l)},JY=()=>!0,KY=()=>null,ZY=({entity:e,coreSettings:t})=>{const n=t?.get(c.w.Calendar).enableCalendarSchedulingFormMultiSlot,i=t?.get(c.w.Calendar).enableFluentCalendarSurface,a=!!n&&e.type===ke.ck.schedulingform,o=!!i&&e.type===ke.ck.calendar;return a||o?e:null},XY=()=>null,eQ=({contextEntity:e,entity:t})=>{const n=[ke.ck.extensions,ke.ck.attendancereport,ke.ck.meetinganalytics,ke.ck.meetingrecap,ke.ck.transcriptcontent];return e?.type&&n.includes(e.type)?e:t},tQ=({contextEntity:e})=>e&&e.action&&e.type===ke.ck.meetingcollaboration?e:null,nQ=e=>({isColorSchemeDefaultBackground1:e}),iQ=({coreSettings:e})=>{const t=e?.get(c.w.Calendar).enableCalendarAppTransparentBackground,n=Boolean(e?.get(c.w.MercuryDesign)?.enableMercuryShell2_5);return{headerEntity:{[se.w.HorizontalBar]:nQ(n)},mainEntity:{[se.w.Main]:{isBackgroundTransparent:!!t&&!n,...nQ(n)}}}},aQ={id:"com.microsoft.teams.calendar",name:"CalendarApp",getLocalizedName:async e=>(await e.waitForNamespace("calendar"),e.stringTranslate("calendar","calendar_app_name")),actors:[Jr],supportedEntities:[ke.ck.calendar,ke.ck.schedulingform,ke.ck.connectedcalendardialog,ke.ck.connectedcalendarsurfacedialog,ke.ck.channelcalendar,ke.ck.calendarmultimeetingsviewdialog,ke.ck.livemeetingstatusbar],supportedRenderModes:[se.w.Main,se.w.HorizontalBar,se.w.Modal],getDefaultCommand:()=>({type:ke.ck.calendar,action:ke.SY.default}),windowFeatures:{minWidth:565,width:1241,minHeight:720,height:720}};const oQ=({action:e,appRenderMode:t,type:n,coreSettings:i})=>{const a=new qz.D,{calendarAppPhaseTimeouts:o}=i.get(c.w.Calendar,["calendarAppPhaseTimeouts"]),r=[],s=[];return n===ke.ck.calendar?function(e,t){switch(e){case se.w.Main:t.push(Gz.m.CALENDAR_VIEW_RENDERED);break;case se.w.HorizontalBar:t.push(Gz.m.CALENDAR_HEADER_RENDERED)}}(t,r):n===ke.ck.schedulingform&&function(e,t,n,i){switch(t){case se.w.Main:n.push(Gz.m.CALENDAR_SF_VIEW_RENDERED),e===ke.SY.view&&i.push(Gz.m.CALENDAR_SF_TRACKING_VIEW_RENDERED);break;case se.w.HorizontalBar:n.push(Gz.m.CALENDAR_SF_HEADER_RENDERED)}}(e,t,r,s),r.length>0&&a.registerAppPhase({phase:m.Jj.CRITICAL,signals:r,timeout:o?.critical||1e4}),s.length>0&&a.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:s,timeout:o?.postCritical||1e4}),a.appPhases},rQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarTryStartMeetingBotPublisherMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tryStartMeetingBotPublisher"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};function sQ(e){const{client:t,coreSettings:n,loggerFactory:i}=e,a=t,o=i.newLogger("[MeetingBot-StartJob]","apps-calendar");return{id:"start-meeting-bot",runOncePerId:!0,job:()=>{n.get(c.w.MeetingBot).enableMeetingBot?a.mutate({mutation:rQ,fetchPolicy:"no-cache"}):o.log("meetingbot is disabled")}}}const lQ={onEventReceived:({requestContext:{loggerFactory:e},eventInput:t})=>{const n=e.newLogger("onEventReceived","apps-calendar");switch(t.event.type){case Br.mu.goBack:return Promise.resolve({command:ee.goBack()});case uq.mu.requestPersonMoreInfo:const e=t.event.data?.();return Promise.resolve({command:vq(e)});case BY.mu.viewBroadcastEvent:const i=t.event.data?.();return(0,BY.fL)(i)?Promise.resolve({command:NY(i),source:t.source}):(n.error(`Event data is invalid for event type '${t.event.type}'.`),Promise.resolve(void 0))}return Promise.resolve(void 0)}},cQ=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("CalendarApp onCommandReceived","apps-calendar");if(e.command.actor===Jr)return n===Kr?{entity:{type:ke.ck.calendar,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}}:void i.error(`Command action '${n}' is not supported at CalendarApp.`);i.error(`Command for actor '${e.command.actor}' cannot be handled by CalendarApp.`)},dQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCalendarSyncConnectedCalendarSettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syncConnectedCalendarSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"accountAddress"}},{kind:"Field",name:{kind:"Name",value:"accountId"}},{kind:"Field",name:{kind:"Name",value:"isSyncAllowed"}}]}}]}}]},uQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCalendarGetExternalAccountsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"connectedAccountRequestResource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectedAccountRequestSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getExternalAccounts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}},{kind:"Argument",name:{kind:"Name",value:"connectedAccountRequestResource"},value:{kind:"Variable",name:{kind:"Name",value:"connectedAccountRequestResource"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"oAuthProviderDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"oAuthProviderType"}}]}},{kind:"Field",name:{kind:"Name",value:"userAccount"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"alternateId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"emailAddress"}}]}},{kind:"Field",name:{kind:"Name",value:"refreshTokenExpirationUnixTimestamp"}}]}}]}}]},mQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarRefreshExternalAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"refreshExternalAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]},pQ="lastRefreshAttemptTimestamp",gQ="pauseRefresh",hQ=e=>e/86400,vQ=()=>Math.round(Date.now()/1e3),yQ=async(e,t)=>{const{data:n}=await t.query({query:uQ,fetchPolicy:"network-only",variables:{callerInfo:e,connectedAccountRequestResource:"TflCloudCache"}});return n?.getExternalAccounts},SQ=async(e,t)=>{let n;const{data:i}=await t.query({query:dQ,fetchPolicy:"network-only",variables:{callerInfo:e}});return i?.syncConnectedCalendarSettings?.length&&(n=i.syncConnectedCalendarSettings.filter((e=>!1===e.isSyncAllowed))),n},fQ=async(e,t,n)=>{await n.mutate({mutation:mQ,variables:{accountId:e,callerInfo:t}})},kQ=(e,t)=>{if(!e||!t)return!0;const n=Number(e);if(isNaN(n))return!0;const i=vQ();return hQ(n-i)<=t},CQ=e=>`tmp.${e}.refreshExternalAccount`,bQ=(e,t,n,i)=>{const a={[pQ]:t,[gQ]:!!i};return n?.trySet(CQ(e),JSON.stringify(a),"Calendar","UserAndExperience")},wQ=(e,t,n,i)=>{const a=((e,t)=>{const n={[pQ]:null,[gQ]:!1};if(!t)return n;const i=t.get(CQ(e));if(!i)return n;try{const e=JSON.parse(i);n[pQ]=e[pQ]||null,n[gQ]=e[gQ]||!1}catch{return n}return n})(e,n);if(a[gQ])return t.mark(be.BQ.NoSrtRefreshNeededDueToPause),!1;if(!i)return!0;const o=a[pQ],r=Number(o);if(isNaN(r))return!0;const s=vQ();return!(hQ(s-r)<=i)||(t.mark(be.BQ.NoSrtRefreshNeededBasedOnLastRefreshTimestamp),!1)},TQ=(e,t,n,i)=>{let a=!1;for(const o of e){wQ(o.accountId,t,n,i)&&(a=!0)}return a},IQ=(e,t,n,i)=>{const a=`Failed createConnectedAccountRefreshSrtJob with error code: ${i}`;e.errorToTelemetry?.(a,"connected_account_refresh_srt_job"),n&&t.fail({errors:a})},NQ=async e=>{if(!e)return null;const t=e.graphQLErrors,n=t&&t[0]?.originalError?.serverResponse;if(!n)return null;try{const e=await n.body.clone().json();return{errorCode:e.errorCode,message:e.message}}catch{return{message:"Failed to extract server response in extractServerError"}}},AQ=e=>{if(!e)return!1;const t=e.graphQLErrors,n=t?.[0]?.originalError,i=n?.reason?.innerError?.context,a=n?.serverResponse;return i===d.Ir.Authentication||a?.status===Og.nW.NOT_AUTHORIZED},EQ="createConnectedAccountRefreshSrtJob";var FQ=n(108053);const _Q="m365-calendar",DQ="/scheduling-form/",PQ="/calendarv2";var MQ,RQ,xQ,LQ,OQ,jQ,BQ;!function(e){e[e.Channel=0]="Channel",e[e.PrivateChat=1]="PrivateChat"}(MQ||(MQ={})),function(e){e[e.UserEventUsingEventId=0]="UserEventUsingEventId",e[e.TeamEventUsingEventId=1]="TeamEventUsingEventId",e[e.UserEventUsingICalUId=2]="UserEventUsingICalUId",e[e.TeamEventUsingICalUId=3]="TeamEventUsingICalUId",e[e.UserSeriesEventUsingOccurenceEventId=4]="UserSeriesEventUsingOccurenceEventId"}(RQ||(RQ={})),function(e){e.newMeeting="/l/meeting/new",e.viewMeeting="/l/meeting/details",e.meetingDetails="/l/calendar/scheduling-form",e.surface="/l/calendar/surface"}(xQ||(xQ={})),function(e){e.NoEventId="calendar_on_before_deep_link_parsed_no_event_id_error",e.FeatureNotEnabled="calendar_on_before_deep_link_parsed_feature_not_enabled_error",e.InvalidContext="calendar_on_before_deep_link_parsed_invalid_context_error"}(LQ||(LQ={})),function(e){e.NoEventId="Parsed calendar deep link does not contain the event id",e.FeatureNotEnabled="Feature for parsing T1 calendar deep links in T2.1 is not enabled",e.InvalidContext="Parsed calendar deep link does not contain valid context query param"}(OQ||(OQ={})),function(e){e.StartTime="startTime",e.EndTime="endTime",e.Subject="subject",e.Content="content",e.Attendees="attendees",e.TemplateId="templateId",e.CorrelationId="correlationId",e.Source="source",e.SourceVersion="sourceVersion",e.UserObjectId="oid"}(jQ||(jQ={})),function(e){e.EventId="eventId",e.Context="context"}(BQ||(BQ={}));const UQ=({deeplinkUrl:e,parsedDeeplinkHash:t,preferredCommandInput:n,context:{coreSettings:i,loggerFactory:a}})=>{const o=a.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableParseT1CalendarDeeplinks:r}=i.get(c.w.Calendar);if(!r)throw o.errorToTelemetry?.(OQ.FeatureNotEnabled,LQ.FeatureNotEnabled),Error(OQ.FeatureNotEnabled);let s,l,d,u,m,p,h,v;if(t?.search){const{search:e}=t;s=e.eventId,l=e.conversationId,d=parseInt(e.providerType,10)||RQ.UserEventUsingEventId,u=parseInt(e.opener,10)||MQ.PrivateChat,m=$Q(e.context,o)}else{const{search:t}=e,n=new URLSearchParams(t);if(s=n.get(BQ.EventId)||void 0,p=!!n.get("isChannelMeeting"),h=A.p.Calendar,d=RQ.UserEventUsingEventId,n?.get("source")===_Q&&(h=A.p.CalendarM365),p&&h===A.p.CalendarM365){let e=n.get("startTime")||void 0;e&&(e=e.replace(" ","+"),v=new Date(e)),d=RQ.TeamEventUsingICalUId,l=n.get("conversationId")||void 0}u=MQ.PrivateChat;const i=n.get(BQ.Context);m=$Q(i,o)}const y=[A.p.ActivityFeed,A.p.ActivityFeedBellClick],S=!!n?.correlation.source&&y.includes(n.correlation.source)?FQ._3.NOTIFICATION_POPOVER:FQ._3.DEEP_LINK;if(s)return Promise.resolve({entityCommand:{entity:{type:ke.ck.schedulingform,action:ke.SY.view,id:s},command:{stateTransition:p&&h===A.p.CalendarM365?g.Ar.new:n?.stateTransition??g.Ar.flush,visibilityState:n?.visibilityState??g.Rp.show},entityOptions:{navCtx:S,eventId:s,opener:u,conversationId:l,providerType:d,startTime:v,...m}},metadata:{allowAnonymous:!1}});throw o.errorToTelemetry?.(OQ.NoEventId,LQ.NoEventId),Error(OQ.NoEventId)},$Q=(e,t)=>e&&(0,Py.j)(e,{},(()=>{throw t.errorToTelemetry?.(OQ.InvalidContext,LQ.InvalidContext),Error(OQ.InvalidContext)})),WQ=async({deeplinkUrl:e,parsedDeeplinkHash:t,context:{coreSettings:n,loggerFactory:i,getUserContexts:a}})=>{const o=i.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableVirtualAppointmentDeepLink:r}=n.get(c.w.VirtualAppointments),{enableParseT1CalendarDeeplinks:s,enableCalendarSchedulingFormInNewWindow:l}=n.get(c.w.Calendar);if(!s)throw o.errorToTelemetry?.(OQ.FeatureNotEnabled,LQ.FeatureNotEnabled),Error(OQ.FeatureNotEnabled);let d,u,m,p,g,h,v,y,S,f,k;if(t?.search){const{search:e}=t;d=e.startTime&&new Date(e.startTime)||void 0,u=e.endTime&&new Date(e.endTime)||void 0,m=e.subject,p=e.content,g=e.attendees,h=e.templateId,v=e.source,y=e.sourceVersion,S=e.correlationId,f=e.oid,k=!!e.isChannelMeeting}else{const{search:t}=e,n=new URLSearchParams(t),i=n.get(jQ.StartTime),a=n.get(jQ.EndTime);d=i&&new Date(i)||void 0,u=a&&new Date(a)||void 0,m=n.get(jQ.Subject)||void 0,p=n.get(jQ.Content)||void 0,g=n.get(jQ.Attendees)||void 0,h=n.get(jQ.TemplateId)||void 0,v=n.get(jQ.Source)||void 0,y=n.get(jQ.SourceVersion)||void 0,S=n.get(jQ.CorrelationId)||void 0,f=n.get(jQ.UserObjectId)||void 0,k=!!n.get("isChannelMeeting")}let C,b=void 0!==h?{templateId:h}:void 0;!1==!!r&&(v=void 0,y=void 0,S=void 0,f=void 0,b=void 0),b&&(C=JQ(await a(),f));const w=KQ(!!b,!!l,k);return Promise.resolve({entityCommand:{entity:{type:ke.ck.schedulingform,action:ke.SY.create,id:(0,E.v4)()},command:w,entityOptions:{navCtx:FQ._3.DEEP_LINK,startTime:d,endTime:u,subject:m,content:p,attendees:g,opener:1,templateMeetingParameters:b,externalSource:v,externalSourceVersion:y,externalSourceCorrelationId:S,shouldPopOutForm:k,channelMeeting:k}},metadata:{allowAnonymous:!1,accountsToUse:C}})},VQ={filter:xQ.surface,execute:({deeplinkUrl:e,preferredCommandInput:t})=>{const n=e.searchParams?.get("source")===_Q?A.p.CalendarM365:A.p.Calendar;return Promise.resolve({entityCommand:{entity:{type:ke.ck.calendar,action:ke.SY.view,id:(0,E.v4)()},command:{stateTransition:t?.stateTransition??g.Ar.flush,visibilityState:t?.visibilityState??g.Rp.show},entityOptions:{navCtx:FQ._3.DEEP_LINK,source:n}},metadata:{allowAnonymous:!1}})}},HQ={filter:(e,t)=>t?.pathname===PQ||e?.pathname===PQ,execute:({deeplinkUrl:e,parsedDeeplinkHash:t,context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableParseT1CalendarDeeplinks:o}=n.get(c.w.Calendar);if(!o)throw a.errorToTelemetry?.(OQ.FeatureNotEnabled,LQ.FeatureNotEnabled),Error(OQ.FeatureNotEnabled);const r=t?.search||e.search,s=new URLSearchParams(r),l=s?.get("source")===_Q?A.p.CalendarM365:A.p.Calendar;return Promise.resolve({entityCommand:{entity:{type:ke.ck.calendar,action:ke.SY.view,id:(0,E.v4)()},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entityOptions:{navCtx:FQ._3.DEEP_LINK,source:l}},metadata:{allowAnonymous:!1}})}},zQ={filter:(e,t)=>!!e.hash&&t?.pathname===DQ&&!t?.search?.eventId,execute:WQ},qQ={filter:xQ.newMeeting,execute:WQ},GQ={filter:(e,t)=>!!e.hash&&t?.pathname===DQ&&!!t?.search?.eventId,execute:UQ},YQ={filter:xQ.viewMeeting,execute:UQ},QQ={filter:xQ.meetingDetails,execute:({deeplinkUrl:e,preferredCommandInput:t,context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableParseT1CalendarDeeplinks:o}=n.get(c.w.Calendar);if(!o)throw a.errorToTelemetry?.(OQ.FeatureNotEnabled,LQ.FeatureNotEnabled),Error(OQ.FeatureNotEnabled);const{pathname:r,searchParams:s}=e,l=r.split("/")[4],d=(0,Py.j)(s.get("context"),{},(()=>{throw a.errorToTelemetry?.(OQ.InvalidContext,LQ.InvalidContext),Error(OQ.InvalidContext)}));if(!l)throw a.errorToTelemetry?.(OQ.NoEventId,LQ.NoEventId),Error(OQ.NoEventId);return Promise.resolve({entityCommand:{entity:{type:ke.ck.schedulingform,action:ke.SY.view,id:l},command:{stateTransition:t?.stateTransition??g.Ar.flush,visibilityState:t?.visibilityState??g.Rp.show},entityOptions:{navCtx:FQ._3.DEEP_LINK,opener:MQ.PrivateChat,eventId:l,...d}},metadata:{allowAnonymous:!1}})}},JQ=(e,t)=>{const n=e.filter((e=>e.context?.client?.ctx?.authenticationUser?.profile?.objectId===t))[0]?.userContextId;return n?[n]:void 0},KQ=(e,t,n)=>(n||e)&&t?{stateTransition:g.Ar.new,visibilityState:g.Rp.show,layoutMode:Yt.Rm.focus}:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show},ZQ=[qQ,YQ,zQ,GQ,QQ,VQ,HQ],XQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarSaveCalendarSettingsIndexdbMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"calendarSettings"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CalendarSettingsInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveCalendarSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"calendarSettings"},value:{kind:"Variable",name:{kind:"Name",value:"calendarSettings"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CalendarSettings"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"enableM365Calendar"}}]}}]}}]}}]},eJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarFireCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AddCallingIdToInitiateMeetingJoinInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addCallingIdToInitiateMeetingJoin"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AddCallingIdToInitiateMeetingJoinPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"joinMeetingContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeetingError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]};var tJ=n(883791);const nJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCalendarAppSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"calendarAppSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CalendarSettings"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"enableM365Calendar"}}]}}]}}]}}]},iJ=async(e,t,n,i)=>{const a={entity:{type:ke.ck.calendar,action:ke.SY.view},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.LiveMeetingStatusBarBanner}}},o={entity:{type:ke.ck.extensions,action:ke.SY.view,id:JSON.stringify({appId:aJ})},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.LiveMeetingStatusBarBanner}}};try{if(!(e=>{const{enableM365CalendarToggle:t}=e.get(c.w.Calendar);return t})(n))return t.log("M365 Calendar flags are not enabled, defaulted to Teams Calendar Surface"),i?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerViewMeetingsT21Surface),Promise.resolve(a);const{data:r}=await e.query({query:nJ,fetchPolicy:"no-cache"});return"CalendarSettings"===r.calendarAppSettings?.__typename?(t.log("Successfully queried calendar settings from IDB"),r.calendarAppSettings?.enableM365Calendar?(t.log("M365 Calendar is enabled by user"),i?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerViewMeetingsM365Surface),Promise.resolve(o)):(i?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerViewMeetingsT21Surface),Promise.resolve(a))):(t.error("Error received as calendar settings query result, defaulted to Teams Calendar Surface"),i?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerViewMeetingsT21Surface),Promise.resolve(a))}catch(e){t.error("Error in querying calendar settings from IDB, defaulted to Teams Calendar Surface")}return i?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerViewMeetingsT21Surface),Promise.resolve(a)},aJ="5966c135-e05f-4ce0-81e0-e138fe8e9583",oJ=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},entityOptions:a},requestContext:{userBiService:o,loggerFactory:r,client:s,coreSettings:l,scenarioFactory:c}}=e,d=r.newLogger("CallingOnBeforeCommandHandled","apps-calendar");if(n===ke.ck.calendar&&i===ke.SY.view&&a?.source===A.p.CalendarM365&&o.recordPanelAction({actionScenario:GR.vB.toggleCalendarSwitcher,actionGesture:GR.Od.toggle,actionOutcome:GR.nd.Off},d),"viewM365CalendarSurface"===a?.searchQuery)return s.mutate({mutation:XQ,variables:{calendarSettings:{id:"calendarSettings",enableM365Calendar:!0}}}),o.recordPanelAction({actionScenario:GR.vB.toggleCalendarSwitcher,actionGesture:GR.Od.toggle,actionOutcome:GR.nd.On},d),Promise.resolve({entity:{type:ke.ck.extensions,action:ke.SY.view,id:JSON.stringify({appId:aJ})},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.Unknown}}});if(n===ke.ck.livemeetingstatusbar){return await rJ(i,t,s,d,l,c)}return Promise.resolve(t)},rJ=async(e,t,n,i,a,o)=>{i.log(`Received Live Meeting Status Bar Command. Action: ${e}`);const r=o.newScenario(be.Cu.LiveMeetingStatusBarOnCommandFromBanner);let s=Promise.resolve(t);if(e===ke.SY.join){const{bannerId:e,...a}=t.entityOptions;r?.appendEventData({correlationTags:a?.lmsbUniqueId}),r?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerJoin);const{data:o,errors:l}=await n.mutate({mutation:eJ,variables:{input:{joinMeetingContext:a}}});!l&&o?(i.log("Successfully fired join mutation from live meeting status bar"),r?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerFireCallingIntentMutationSuccessful)):l&&(i.error("Error in join mutation function for live meeting status bar"),r?.fail({reason:"fire_calling_intent_mutation_failed"})),s=Promise.resolve(void 0)}else if(e===ke.SY.delete){r?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerDismiss);const{data:e,errors:t}=await n.mutate({mutation:tJ.J});if(e&&!t){const t=e?.removeAllMeetingsFromLiveMeetingStatusBar;t&&("RemoveAllMeetingsFromLiveMeetingStatusBarPayload"===t.__typename?(r?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerremoveAllMeetingsMutationSuccessful,{correlationTags:t?.liveMeetings?.map((e=>e?.lmsbUniqueId)).join(",")}),i.log("Successfully dismissed all meetings")):"LiveMeetingError"===t.__typename&&(r?.fail({reason:"remove_all_meetings_mutation_failed",calendarDataBag:JSON.stringify({errorCode:t?.errorCode,errorMessage:(0,Je.Mr)(t.errorMessage||"")})}),i.error(t.errorCode)))}else t&&(r?.fail({reason:"remove_all_meetings_mutation_failed",calendarDataBag:JSON.stringify({errorCode:t[0]?.extensions?.code,errorMessage:(0,Je.Mr)(t[0]?.message||"")})}),i.error("GraphQL Error in Dismissing Live Meeting Status Bar"));s=Promise.resolve(void 0)}else e===ke.SY.view&&(r?.mark(be.BQ.LiveMeetingStatusBarOnCommandFromBannerViewMeetings),s=Promise.resolve(await iJ(n,i,a,r)));return r?.stop(),s},sJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsCalendarLiveMeetingStatusBarEventsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"liveMeetingStatusBarEvents"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"event"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LiveMeeting"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"rsvpStatus"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"iCalUid"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserCallJoinEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userJoinTime"}},{kind:"Field",name:{kind:"Name",value:"groupContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}}]}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"JoinLiveMeetingContext"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}},{kind:"Field",name:{kind:"Name",value:"lmsbUniqueId"}}]}}]}}]}}]}}]};var lJ=n(7313),cJ=n(894772),dJ=n(106752),uJ=n(508648);const mJ=class{constructor(e){this.client=e,this.onMeetingsUpdate$=new ya.t([]),this.startSyncingLiveMeetings=this.startSyncingLiveMeetings.bind(this)}startSyncingLiveMeetings(){const e=this,t=this.client.watchQuery({query:cJ.J}).subscribe((({data:t})=>{"LiveMeetingStatusBarPayload"===t?.liveMeetingStatusBar?.__typename&&e.onMeetingsUpdate$.next(t.liveMeetingStatusBar.liveMeetings)}));return()=>t.unsubscribe()}registerNewMeetingsSubscriber(e){return this.onMeetingsUpdate$.subscribe(e)}async addMeeting(e,t){if(t){const{id:n,__typename:i,...a}=t;e?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventAddMeetingMutation);const{data:o,errors:r}=await this.client.mutate({mutation:dJ.l,variables:{input:{liveMeeting:a}}});if(r&&r.length>0)return this.failScenarioWithDetails(e,{lmsbUniqueId:t.lmsbUniqueId,meetingType:t.meetingType,rsvpStatus:t.rsvpStatus},"addMeeting: GraphQL Error",r[0]),null;const s=o?.addMeetingToLiveMeetingStatusBar;if(s){if("LiveMeetingError"!==s.__typename)return e?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventAddMeetingMutationSuccessful),s?.liveMeeting;if("AddMeetingToLiveMeetingStatusBarFailed"===s?.errorCode&&s?.errorMessage.includes("Meeting duplicate found in cache"))return e?.cancel({reason:(0,Je.Mr)(s?.errorMessage)}),null;this.failScenarioWithDetails(e,{lmsbUniqueId:t.lmsbUniqueId,meetingType:t.meetingType,rsvpStatus:t.rsvpStatus},"addMeeting: Resolver Error",void 0,s)}}return null}async removeMeeting(e,t){e?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventRemoveMeetingMutation);const{data:n,errors:i}=await this.client.mutate({mutation:uJ.v,variables:{input:{lmsbUniqueId:t}}});if(i&&i.length>0)return this.failScenarioWithDetails(e,{lmsbUniqueId:t},"removeMeeting: GraphQL Error",i[0]),null;const a=n?.removeMeetingFromLiveMeetingStatusBar;if(a){if("LiveMeetingError"!==a.__typename)return e?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventRemoveMeetingMutationSuccessful),a.liveMeeting;this.failScenarioWithDetails(e,{lmsbUniqueId:t},"removeMeeting: Resolver Error",void 0,a)}return null}async removeAllMeetings(e){e?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventRemoveAllMeetingsMutation);const{data:t,errors:n}=await this.client.mutate({mutation:tJ.J});if(n&&n.length>0)return this.failScenarioWithDetails(e,{},"removeAllMeetings: GraphQL Error",n[0]),null;const i=t?.removeAllMeetingsFromLiveMeetingStatusBar;if(i){if("LiveMeetingError"!==i.__typename)return e?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventRemoveAllMeetingsMutationSuccessful),i.liveMeetings;this.failScenarioWithDetails(e,{},"removeAllMeetings: Resolver Error",void 0,i)}return null}async getAllMeetings(){return this.onMeetingsUpdate$.getValue()}failScenarioWithDetails(e,t,n,i,a){e?.fail({reason:n,calendarDataBag:JSON.stringify({errorCode:i?i.extensions?.code:a?.errorCode,errorMessage:i?(0,Je.Mr)(i.message):(0,Je.Mr)(a?.errorMessage||""),meetingDetails:t})})}};const pJ=class{constructor(e,t){this.timers={},this.defaultTimeout=Math.max(0,e),this.windowProvider=t}add(e,t,n){this.timers[e]&&this.windowProvider.clearTimeout(this.timers[e]),this.timers[e]=this.windowProvider.setTimeout((()=>{delete this.timers[e],t(e)}),void 0!==n&&n>=0?n:this.defaultTimeout)}remove(e){this.timers[e]&&(this.windowProvider.clearTimeout(this.timers[e]),delete this.timers[e])}};const gJ=class{constructor(e,t,n){this.lmsbBannerId="lmsb-calendar-banner",this.entityCommanding=e,this.i18n=t,this.isVisible=!0,this.getLatestMeetings=n}render(e){if(this.isVisible)if(void 0===e&&(e=this.getLatestMeetings()),0===e.length)this.hideLMSBBanner();else{const t=this.getActionEntityCommand(e),n={entity:{type:ke.ck.livemeetingstatusbar,action:ke.SY.delete}},i=this.getBannerText(e);this.entityCommanding.shell.showBanner({id:this.lmsbBannerId,source:A.p.LiveMeetingStatusBarBanner,intentLevel:"Live",cause:"SettingsWarnUser",text:i,action:t,dismissable:!0,duration:0,dismissActionCommand:n,bannerScenario:"live_meeting_status_bar_banner"})}else this.hideLMSBBanner()}setVisibility(e){this.isVisible=e,this.render()}getBannerText(e){let t;return t=1===e.length?this.i18n.stringTranslate("calendar","calendar_lmsb_banner_text",{meetingTitle:e[0].subject}):this.i18n.stringTranslate("calendar","calendar_lmsb_banner_text_plus_multiple_meetings",{meetingTitle:e[0].subject,meetingsCount:e.length-1}),t}getActionEntityCommand(e){return{text:e.length>1?this.i18n.stringTranslate("calendar","calendar_lmsb_banner_view_meetings_action"):this.i18n.stringTranslate("calendar","calendar_lmsb_banner_join_action"),command:e.length>1?{entity:{type:ke.ck.livemeetingstatusbar,action:ke.SY.view}}:{entity:{type:ke.ck.livemeetingstatusbar,action:ke.SY.join},entityOptions:{callId:e[0].callId,threadId:e[0].threadId,subject:e[0].subject,meetingJoinUrl:e[0].meetingJoinUrl,meetingType:e[0].meetingType,lmsbUniqueId:e[0].lmsbUniqueId}},dismissOnAction:!1}}hideLMSBBanner(){this.entityCommanding.shell.dismissBanner(this.lmsbBannerId,A.p.LiveMeetingStatusBarBanner)}};var hJ;!function(e){e.LiveMeeting="LiveMeeting",e.UserCallJoinEvent="UserCallJoinEvent",e.JoinLiveMeetingContext="JoinLiveMeetingContext"}(hJ||(hJ={}));const vJ=async(e,t,n,i,a,o,r)=>{let s=t?.newScenario(be.Cu.LiveMeetingStatusBarSubscriptionOnIdle);const l=n.newLogger("live-meeting-status-bar-subscription-logger","components-live-meeting-status-bar");s?.mark(be.BQ.LiveMeetingStatusBarSubscriptionOnIdleJobStarted),l?.infoToTelemetry?.("Started LMSB Start Subscription Job","live_meeting_status_bar");try{const n=new mJ(e),c=new gJ(i,o,n.getAllMeetings.bind(n)),d=n.startSyncingLiveMeetings();s?.mark(be.BQ.LiveMeetingStatusBarSubscriptionOnIdleMeetingsSyncStarted),l.log("LMSBSubscription started");const u=n.registerNewMeetingsSubscriber(c.render.bind(c)),m=new pJ(6e5,r),p=e.subscribe({query:sJ,fetchPolicy:"no-cache"}).subscribe({next:async e=>{const o=t?.newScenario(be.Cu.LiveMeetingStatusBarSubscriptionProcessEvent),r=e?.data?.liveMeetingStatusBarEvents;if(o?.appendEventData({correlationTags:r?.event?.lmsbUniqueId}),l?.infoToTelemetry?.(`Received event with id: ${r?.id}`,"live_meeting_status_bar"),r)switch(r.id){case"128":if(o?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventReceived128),r.event?.__typename===hJ.LiveMeeting){const e=await n.addMeeting(o,r.event);e&&e.lmsbUniqueId&&(m.add(e.lmsbUniqueId,(async e=>{const i=t?.newScenario(be.Cu.LiveMeetingStatusBarSubscriptionProcessEvent);i?.appendEventData({correlationTags:e}),i?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventReceivedOnMeetingTimeout),await n.removeMeeting(i,e),i?.stop()})),o?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventMeetingScheduledForRemoval))}break;case"115":o?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventReceived115),await n.removeAllMeetings(o);break;case"2006":o?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventReceived2006),r.event?.__typename===hJ.JoinLiveMeetingContext&&await async function(e,t,n,i){const a={source:A.p.LiveMeetingStatusBarBanner};try{const o=(0,QG.vt)(e.meetingJoinUrl,t,e.subject,"live_meeting_status_bar");void 0!==o&&(t?.mark(be.BQ.LiveMeetingStatusBarSubscriptionProcessEventCallFireMeetingJoinCommand),await(0,lJ.N)(o,a,n,i)),t?.stop()}catch(e){t?.fail({reason:"Failure in fireMeetingJoinCommand"})}}(r.event,o,i,a)}o?.stop()},error:e=>{l?.errorToTelemetry?.(`Error in subscription, ${(0,Je.Mr)(e)}`,"live_meeting_status_bar"),s||(s=t?.newScenario(be.Cu.LiveMeetingStatusBarSubscriptionOnIdle)),s?.fail({reason:`Error in subscription, ${e}`})},complete:()=>{l?.infoToTelemetry?.("Subscription completed","live_meeting_status_bar")}});return s?.stop(),()=>{p.unsubscribe(),d(),u.unsubscribe()}}catch(e){return s||(s=t?.newScenario(be.Cu.LiveMeetingStatusBarSubscriptionOnIdle)),s?.fail({reason:"Failed to start the subscription"}),void l?.errorToTelemetry?.("Error in starting live meeting status bar subscription","live_meeting_status_bar")}},yJ=({context:e})=>{const t=(e=>{const{client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,entityCommanding:o,i18n:r,windowProvider:s}=e,{enableLiveMeetingStatusBar:l}=n.get(c.w.Calendar),d=[];return l&&d.push({id:"calendar-lmsb-start-subscription-on-idle-job",runOncePerId:!0,job:async()=>vJ(t,a,i,o,n,r,s)}),d})(e);return[...t]},SJ=()=>Promise.all([n.e(912845),n.e(273198),n.e(224316),n.e(120951),n.e(914945),n.e(484331),n.e(390761),n.e(280759),n.e(598200),n.e(506289),n.e(289847),n.e(153959),n.e(962777),n.e(94139),n.e(712284),n.e(719255),n.e(265816),n.e(367831),n.e(233794),n.e(746071),n.e(96657),n.e(837385),n.e(447479)]).then(n.bind(n,162534)),fJ=()=>aQ.windowFeatures||{};function kJ(){return{eventHandlers:lQ,getAppViewEntities:YY,getAppViewEntitiesProps:iQ,getAppWindowFeatures:fJ,getCommandScenarioName:CJ,getPlatformAppIdForEntity:e=>e.type===ke.ck.calendar||e.type===ke.ck.schedulingform?"ef56c0de-36fc-4ef8-b417-3d82ba9d073c":void 0,manifest:aQ,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="calendar-app";t("ChunkLoadStarted",{chunkName:i});const{CalendarViewsRenderer:a}=await(0,ev.wg)(SJ,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(vG.e,{namespaces:["calendar","compose","extensibility","files"],loaderRenderer:null,children:(0,Lr.Y)(a,{appRenderMode:e,onRenderEvent:t,scenarioFactory:n})})},onBeforeDeeplinkParsed:ZQ,onBeforeCommandHandled:oJ,onCommandReceived:cQ,onPreWarm:e=>{const{context:t}=e,n=t.coreSettings,{enableConnectedAccountSrtRefresh:i}=n.get(c.w.Calendar),a=[sQ(t)];return i&&a.push(function(e){const{client:t,coreSettings:n,localStorage:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("connected-account-refresh-srt-job","apps-calendar"),s=t,{numberOfDaysToWaitBeforeSrtExpires:l,numberOfDaysToWaitSinceLastSrtRefresh:u}=n.get(c.w.Calendar);return{id:"connected-account-refresh-srt-job",runOncePerId:!0,job:async()=>{const e=o.newScenario(be.Cu.ConnectedAccountRefreshSrtJob);let n=!1;const a=[];try{const o=await SQ(EQ,t);if(e.mark(be.BQ.GetConnectedCalendarSettingsComplete),!o||0===o.length)return e.mark(be.BQ.NoUnsyncedConnectedCalendarSettingFound),void e.stop();if(!TQ(o,e,i,u))return void e.stop();const c=await yQ(EQ,t);e.mark(be.BQ.GetExternalAccountsComplete),c&&0!==c.length||e.mark(be.BQ.NoExternalAccountsFound);for(let t=0;c&&t<c.length;t++){const u=c[t];if(!u)continue;const m=u.userAccount?.id,p=o.find((e=>e.accountId===m));try{if(!p){e.mark(be.BQ.NoMatchingExternalAccountToRefresh);continue}e.mark(be.BQ.ExternalAccountFound);const t=u.refreshTokenExpirationUnixTimestamp;kQ(t,l)?(await fQ(m,EQ,s),e.mark(be.BQ.RefreshExternalAccountComplete)):e.mark(be.BQ.NoSrtRefreshNeededBasedOnSrtExpirationTimestamp),bQ(m,vQ(),i)}catch(t){let o;o=AQ(t)?d.O4.Unauthorized:(await NQ(t))?.errorCode,bQ(m,vQ(),i,o===d.O4.Unauthorized),IQ(r,e,!1,o),n=!0,a.push(o)}}e.stop()}catch(t){const{errorCode:n}=await NQ(t)||{};IQ(r,e,!0,n)}n&&IQ(r,e,!0,a.join(", "))}}}(t)),a},getAppPhases:oQ,onIdle:yJ}}const CJ=e=>{const{command:t,entity:n}=e;switch(n.type){case ke.ck.schedulingform:if(t.visibilityState===g.Rp.hide)return;return n.action===ke.SY.create?be.Cu.CalSchedulingFormLoadForCreateMode:be.Cu.CalSchedulingFormLoad;case ke.ck.calendar:return n.action===ke.SY.default?be.Cu.CalendarSurfaceLoad:void 0;case ke.ck.channelcalendar:return be.Cu.ChannelCalendarLoad;case ke.ck.connectedcalendardialog:return be.Cu.ConnectedCalendarDialogLoad;default:return}},bJ={onEventReceived:({eventInput:e})=>{if(e.event.type===uq.mu.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:vq(t)})}return Promise.resolve(void 0)}};var wJ=n(649453);const TJ=e=>{if(IJ(e))return NJ(e)?{subNavEntity:AJ(e),headerEntity:EJ(e),startEntity:FJ(e),mainEntity:_J(e),endEntity:DJ(e)}:null},IJ=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.callablechannels].includes(i),r=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},NJ=()=>!0,AJ=({entity:e})=>e,EJ=({entity:e})=>e,FJ=()=>null,_J=({entity:e})=>e,DJ=()=>null,PJ={id:"com.microsoft.teams.callable-channel",name:"CallableChannelApp",supportedEntities:[ke.ck.callablechannels],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},MJ=()=>Promise.all([n.e(311576),n.e(677226),n.e(100538)]).then(n.bind(n,788766)),RJ=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,451798)),xJ=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,819867));function LJ(){const e=()=>null;return{eventHandlers:bJ,getAppViewEntities:TJ,manifest:PJ,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,coreSettings:a})=>{if(t===se.w.Main){const e="callable-channels-app";n("ChunkLoadStarted",{chunkName:e});const{enableEntityMoreInfo:t}=a.get(c.w.Core),o=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),{LPC:r}=t?{LPC:o}:await(0,ev.wg)(xJ,e,i),s=t?o:wJ.CA;n("ChunkLoadSucceeded",{chunkName:e});const[{CallableChannelEntryContainer:l},{CallsTabContextProvider:d}]=await Promise.all([(0,ev.wg)(MJ,e,i),(0,ev.wg)(RJ,e,i)]);return(0,Lr.Y)(vG.e,{namespaces:["calling","messaging"],loaderRenderer:null,children:(0,Lr.Y)(r,{children:(0,Lr.Y)(s,{children:(0,Lr.Y)(d,{children:(0,Lr.Y)(l,{})})})})})}return(0,Lr.Y)(e,{})}}}const OJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingDisposeCallingServiceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"disposeReason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DisposeReason"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"disposeSource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DisposeSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disposeCallingService"},arguments:[{kind:"Argument",name:{kind:"Name",value:"disposeReason"},value:{kind:"Variable",name:{kind:"Name",value:"disposeReason"}}},{kind:"Argument",name:{kind:"Name",value:"disposeSource"},value:{kind:"Variable",name:{kind:"Name",value:"disposeSource"}}}]}]}}]},jJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"InitCallingService"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entryPoint"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingServiceEntrypointType"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"initCallingService"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entryPoint"},value:{kind:"Variable",name:{kind:"Name",value:"entryPoint"}}}]}]}}]};var BJ;!function(e){e.DisposeMutationGenericJobError="DisposeMutationGenericJobError"}(BJ||(BJ={}));const UJ=(e,t,n,i,a)=>({id:"standup-calling",runOncePerId:!0,job:async()=>{const o=i.newScenario(be.Cu.CallingAppInit,{clientId:(0,E.v4)()});o.appendEventData({context:n});const r=i.newScenario(be.Cu.StandupCallingAppExecute);r.appendEventData({context:n}),r.mark(be.BQ.ExecuteJob);const s=t.newLogger("getStandupCallingJob","apps-calling");s.infoToTelemetry?.("[getStandupCallingJob] Initializing calling service","cmd_horizontals_standup_calling_job",void 0,!0);const{callingServiceDisposeTimeoutInMs:l,enableStandupCallingAppExecuteErrorStack:u}=a.get(c.w.Calling);try{const t=(e=>{switch(e){case be.BQ.OnAppPreWarm:return"onAppPreWarm";case be.BQ.OnAppPreInit:return"onAppPreInit";default:throw new Error(`StandupCallingJob - ${be.BQ} is not on_app_pre_warm or on_app_pre_init`)}})(n);if(o.mark(be.BQ.InitCallingServiceMutation),r.pause({reason:d.O4.WaitingForResponse}),!e||!e.mutate)throw new Error(`apollo is missing. [client:${!!e}, mutation:${!!e?.mutate}]`);await e.mutate({mutation:jJ,variables:{entryPoint:t},context:{scenarioClientId:o.clientId,scenarioName:o.name}}),r.resume()}catch(e){throw s.error(`[getStandupCallingJob] Error initializing calling service [error.name=${e?.name}, error.message=${e?.message}]`),u&&r.appendEventData({error:e?.stack}),r.fail({errors:e.name,message:`${be.BQ.ExecuteJob} failed with ${e.message}`}),o.fail({errors:e.name,message:`${be.BQ.InitCallingServiceMutation} failed with ${e.message}`}),(0,Je.$5)(n,d.O4.StandupCallingJobError,e.name,void 0,e.message)}return r.mark(be.BQ.JobCompleted),o.mark(be.BQ.EndStandupCallingJob),s.log("[getStandupCallingJob] Calling service initialized"),r.stop(),o.stop(),async()=>$J(e,s,i,n,l||45e3)}}),$J=async(e,t,n,i,a)=>{const o="SignOut",r="StandupCallingAppJob",s=n.newScenario(be.Cu.CallingServiceDispose);s.appendEventData({context:o,dataSource:r,origin:i}),n.hoistScenarioToCore?.(s),t.log(`[getStandupCallingJob] Calling service disposal initiated. [step: ${i}, reason:${o}, source:${r}, timeout:${a}]`);try{const t=e.mutate({mutation:OJ,variables:{disposeReason:o,disposeSource:r}});await(0,yi.a)(t,a,`Dispose mutation timed out. [timeoutAmount:${a}]`)}catch(e){throw t.error(`[getStandupCallingJob] Error disposing calling service [error.name=${e?.name}, error.code=${e?.code}, error.message=${e?.message}, timeout:${a}]`),s.fail({reason:e?.code||BJ.DisposeMutationGenericJobError,message:e?.message||e}),(0,Je.$5)(be.Cu.CallingServiceDispose,d.O4.StandupCallingJobError,o,void 0,e?.message)}s.stop(),t.log("[getStandupCallingJob] Calling service disposed")},WJ={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingContentEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingContentEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"action"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visibility"}}]}},{kind:"Field",name:{kind:"Name",value:"content"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBannerContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingLocalRecordingNotificationContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_mainAppContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_autoBrbDialogContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBreakoutRoomPanelContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingWindowingContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingDialogContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingNotificationContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToChatContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToChatListContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToSettingsPaneContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToCallListContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"crossCloudMeetingJoinContent"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBannerContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingBannerContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"intentLevel"}},{kind:"Field",name:{kind:"Name",value:"dismissable"}},{kind:"Field",name:{kind:"Name",value:"duration"}},{kind:"Field",name:{kind:"Name",value:"bannerScenario"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}},{kind:"Field",name:{kind:"Name",value:"actionButtonText"}},{kind:"Field",name:{kind:"Name",value:"bannerActions"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingLocalRecordingNotificationContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingLocalRecordingNotificationContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"fileId"}},{kind:"Field",name:{kind:"Name",value:"localRecordingNotificationType"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_mainAppContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MainAppContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_autoBrbDialogContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AutoBrbDialogContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"category"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBreakoutRoomPanelContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingBreakoutRoomPanelContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"containerId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingWindowingContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingWindowingContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewType"}},{kind:"Field",name:{kind:"Name",value:"windowingMode"}},{kind:"Field",name:{kind:"Name",value:"linkedContent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingDialogContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingDialogContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"dialogActions"}},{kind:"Field",name:{kind:"Name",value:"dialogStrings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"text"}}]}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingNotificationContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingNotificationContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"crossClientScenarioName"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"subtitle"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"toastType"}},{kind:"Field",name:{kind:"Name",value:"bypassOsLevelDoNotDisturb"}},{kind:"Field",name:{kind:"Name",value:"image"}},{kind:"Field",name:{kind:"Name",value:"ringtoneAssetUrl"}},{kind:"Field",name:{kind:"Name",value:"time"}},{kind:"Field",name:{kind:"Name",value:"userid"}},{kind:"Field",name:{kind:"Name",value:"primaryAction"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceLabel"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceLabelSecondary"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceId"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceIdSecondary"}},{kind:"Field",name:{kind:"Name",value:"audioApplicationDeviceId"}},{kind:"Field",name:{kind:"Name",value:"audioApplicationDeviceIdSecondary"}},{kind:"Field",name:{kind:"Name",value:"actions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"icon"}},{kind:"Field",name:{kind:"Name",value:"actionType"}}]}},{kind:"Field",name:{kind:"Name",value:"header"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultImageDataUrl"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"subtitle"}},{kind:"Field",name:{kind:"Name",value:"mri"}}]}},{kind:"Field",name:{kind:"Name",value:"isSilent"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"members"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"displayDuration"}},{kind:"Field",name:{kind:"Name",value:"timeoutAction"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToChatContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToChatContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"messageId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToChatListContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToChatListContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToSettingsPaneContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToSettingsPaneContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"tabItemId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToCallListContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToCallListContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"crossCloudMeetingJoinContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CrossCloudMeetingJoinContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"meetingUrl"}}]}}]}.definitions]},VJ={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingAppSetupEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingAppSetupEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"result"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingAppEventsSetupSuccess"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingAppEventsSetupSuccess"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingAppEventsSetupSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"_"}}]}}]}.definitions]},HJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsCallingCallingAppEventsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingAppEvents"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingAppEvent"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingAppEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingAppEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"event"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingContentEvent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingAppSetupEvent"}}]}},{kind:"Field",name:{kind:"Name",value:"context"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"externalId"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}},{kind:"Field",name:{kind:"Name",value:"source"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}}]}}]}},...WJ.definitions,...VJ.definitions]}.definitions]},zJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingMsaGroupProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MsaGroupProfilePictureInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaGroupProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"msaGroupInfo"},value:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]},qJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingPriorityContactsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shouldFetchFromNetwork"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"priorityContacts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shouldFetchFromNetwork"},value:{kind:"Variable",name:{kind:"Name",value:"shouldFetchFromNetwork"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"jobTitle"}}]}}]}}]},GJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"msaUserProfilePicture"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},YJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"toastImageAsDataUri"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]},QJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"resolveCallingAppEvent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingAppEventResolution"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingAppEventResolution"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveCallingAppEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingAppEventResolution"},value:{kind:"Variable",name:{kind:"Name",value:"callingAppEventResolution"}}}]}]}}]};function JJ(e,t,n){const{eventId:i,resolution:a,context:o}=e,{source:r}=o;return n.log(`[resolveCallingAppEvent] Resolving calling app event [eventId=${i}, source.name=${r.name}, source.description=${r.description}]`),t.mutate({mutation:QJ,variables:{callingAppEventResolution:{eventId:i,resolution:a,context:o}},fetchPolicy:"no-cache"})}const KJ=new class{constructor(){this.deeplinkEntitySet=!1,this.callingAppEventsSubscribed=!1,this.unlockDeeplinkEntity=()=>{const e=this.deeplinkEntityId;return this.deeplinkEntityId=void 0,this.deeplinkEntitySet=!1,this.resolvePromise&&this.resolvePromise(),e},this.lockDeeplinkEntity=e=>{this.deeplinkEntitySet||(this.initializingPromise=new Promise((e=>{this.resolvePromise=()=>{e()}})),this.deeplinkEntityId=e,this.deeplinkEntitySet=!0)},this.getDeeplinkEntityLocked=()=>this.deeplinkEntitySet,this.getDeeplinkReady=()=>this.initializingPromise,this.getCallingAppEventsSubscribed=()=>this.callingAppEventsSubscribed,this.setCallingAppEventsSubscribed=e=>{this.callingAppEventsSubscribed=e}}};function ZJ(e,t){switch(e){case"Show":return g.Rp.show;case"Hide":return g.Rp.hide;default:return t.warn(`${e} cannot be converted to visibility state, defaulting to hide`),g.Rp.hide}}function XJ(e,t,n){const{id:i,title:a,callId:o,crossClientScenarioName:r,subtitle:s,image:l,time:d,actions:u,type:m,primaryAction:p,header:h,toastType:v,ringtoneAssetUrl:y,audioDeviceLabel:S,audioDeviceLabelSecondary:f,audioDeviceId:k,audioDeviceIdSecondary:C,audioApplicationDeviceId:b,audioApplicationDeviceIdSecondary:w,isSilent:T,displayDuration:I,timeoutAction:N}=e,E=parseInt(d,10),F=h?{alt:h.subtitle,src:h.defaultImageDataUrl}:void 0,_=N?{action:Ot.qj.mutate,dataOptions:{actionType:N,toastId:i,toastType:v},id:i,type:Ot.w$.calls}:void 0;return{command:{correlation:{source:A.p.Notifications,id:n},stateTransition:g.Ar.new,visibilityState:g.Rp.show},entityOptions:{buttons:u?.map((e=>function(e,t,n,i,a){const{actionType:o,label:r,icon:s}=t;return{...s&&{image:{alt:r,src:s}},targetEntity:{action:Ot.qj.mutate,dataOptions:{actionType:o,toastId:e,toastType:a},id:e,type:Ot.w$.calls},text:r,preferImageOnly:n.get(c.w.Calling).forceTextOnT2Notifications?void 0:!!s,style:nK(o,i)}}(i,e,t,m,v))),callId:o,crossClientScenarioName:r,bypassOsLevelDoNotDisturb:eK(m,t),isIncomingCall:tK(m),mainImage:{alt:a,src:l},ringtone:y,targetEntity:{action:Ot.qj.mutate,dataOptions:{actionType:p,toastId:i,toastType:v},id:i,type:Ot.w$.calls},text:s,time:new Date(E),title:a,headerImage:F,headerTitle:h?.title,headerSubtitle:h?.subtitle,deviceLabel:S,deviceLabelSecondary:f,deviceId:k,deviceIdSecondary:C,applicationDeviceId:b,applicationDeviceIdSecondary:w,isSilent:T,displayDuration:I,useTeamsChime:!1,timeoutAction:N,timeoutEntity:_}}}const eK=(e,t)=>{let n;if("MeetingWentLive"===e)n=!!t.get(c.w.Calling).enableUrgentMeetingStartedNotificationV2;else n=!1;return n},tK=e=>"MeetingWentLive"!==e;function nK(e,t){if("Meeting"!==t)switch(e){case"ReplyIncomingCall":return;case"RejectIncomingCall":return Ot.x2.critical;default:return Ot.x2.success}}var iK,aK=n(265954);!function(e){e.Calling="Calling",e.Notifications="Notifications",e.Devices="Devices",e.PremiumBenefits="PremiumBenefits",e.Privacy="Privacy"}(iK||(iK={}));var oK=n(375687);function rK(e,t,n,i){const{id:a,viewType:o,windowingMode:r,linkedContent:s}=n,{action:{visibility:l}}=t,{source:c,timeStamp:d}=i,u=function(e){return"Show"===e?g.Rp.show:g.Rp.hide}(l),m=function(e){return"SingleWindow"===e?g.Ar.flush:g.Ar.new}(r),p=s&&function(e){if(!e||!e.id)return;return{id:e.id,type:ke.ck.chats}}(s);return{entity:{id:a,type:(0,oK.Xg)(o),action:ke.SY.view,linkedEntity:p},command:{visibilityState:u,stateTransition:m,correlation:{id:e,startTimestamp:d||void 0,source:`${A.p.CallingAppEvent_Windowing}::${c.name}::${c.description}`}}}}function sK(e,t,n){const{id:i,bannerScenario:a,bannerActions:o}=t,{action:{visibility:r}}=e,{timeStamp:s}=n,l=function(e){let t;if("Show"===e)t=g.Rp.show;else{if("Hide"!==e)return;t=g.Rp.hide}return t}(r);if(void 0===l)return;const c={visibilityState:l,stateTransition:g.Ar.extend,correlation:{id:i,startTimestamp:s||void 0,source:a}},d=function(e){switch(e){case"EndpointTransfer":case"LocationChange":return ke.ck.callingbannernotification;case"SystemLocationBanner":return ke.ck.systemlocationnotificationbanner;default:return}}(a),u=function(e,t){let n;if(e===g.Rp.show)switch(t){case"EndpointTransfer":n=ke.SY.join;break;case"SystemLocationBanner":n=ke.SY.view;break;case"LocationChange":n=ke.SY.default;break;default:n=void 0}else e===g.Rp.hide&&(n=ke.SY.delete);return n}(l,a);return d&&u?{bannerPrimaryActionEntity:{id:i,type:d,action:u},entityOptions:{bannerActions:o},command:c,bannerDismissCommandEntity:{id:i,type:ke.ck.callingbannernotification,action:ke.SY.delete}}:void 0}async function lK(e,t,n,i){try{const{eventId:i,resolution:a,context:o}=e;await JJ({eventId:i,resolution:a,context:o},t,n)}catch(e){n.error(i,`error: [errorName=${e.name}, errorMessage=${e.message}]]`)}}function cK(e,t,n,i,a){let o={success:{_:!0}};return i&&a&&(o={error:{name:i,message:a}}),{eventId:e,resolution:o,context:{source:{name:t,description:n}}}}const dK=e=>({name:e.name||"unknown-show-breakout-room-panel-event-error",message:e.message||"unknown-windowing-commanding-error-message"}),uK=async e=>{const{loggerFactory:t,delegatedCommanding:n,event:i,content:a,context:o,eventId:r,dataClient:s}=e,l=t.newLogger("handleCallingBreakoutRoomPanelContentEvent","apps-calling");l.log("Start executing breakout room panel content event handler");const{command:c}=function(e,t,n,i){const{action:{visibility:a}}=t,{timeStamp:o}=i;return{command:{visibilityState:ZJ(a,n),stateTransition:g.Ar.none,correlation:{id:e,startTimestamp:o||void 0,source:A.p.CallingAppEvent_NavigateToBreakoutRoomsPanel}}}}(r,i,l,o);try{await(n?.execute({command:ee.toggleEndRail({action:"view",source:A.p.CallingAppEvent,showOption:c.visibilityState,type:"breakoutroomspanel",correlationId:c.correlation.id,id:a.containerId,startTimestamp:c.correlation.startTimestamp,linkedEntity:{type:"calls",id:a.containerId}}),source:{inputType:"programmatic",timeStamp:Date.now()}})),l.log("Breakout room panel content event handler was executed successfully")}catch(e){return l.error("Error during processing of breakout room panel content event"),(async({eventId:e,logger:t,dataClient:n,error:i})=>{try{await JJ({eventId:e,resolution:{error:dK(i)},context:{source:{name:"WindowingCommandingTriggerError",description:`Error triggering windowing command on event to open breakout room panel (eventId=${e})`}}},n,t)}catch(n){t.error(`[handleCallingBreakoutRoomPanelContentEvent] Error when reporting event resolution [eventId=${e}, error.message=${n?.message}]`)}})({logger:l,dataClient:s,eventId:r,error:e})}};function mK(e,t,n){const{id:i,name:a,dialogActions:o,dialogStrings:r}=t,{action:{visibility:s}}=e,{timeStamp:l}=n;let c;if("Show"===s)c=g.Rp.show;else{if("Hide"!==s)return;c=g.Rp.hide}const d={visibilityState:c,stateTransition:g.Ar.extend,correlation:{id:i,startTimestamp:l||void 0,source:a}},u=function(e){switch(e){case"InteractionRequiredError":return ke.ck.interactionrequireddialog;case"WindowingError":return ke.ck.windowingerrordialog;case"CallingRestartRecomendedError":return ke.ck.restartrecomendeddialog;case"Alert":return ke.ck.callingalertdialog;case"CallingUnparkCall":return ke.ck.unparkcalldialog;case"CallingConfirm":return ke.ck.callingconfirmdialog;case"OptionsSettings":return ke.ck.optionssettingsdialog;case"PrejoinOverlay":return ke.ck.prejoinoverlaydialog;case"UserMedia":return ke.ck.usermediadialog;default:return}}(a);if(!u)return;const m={dialogActions:o?[...o]:[],dialogStrings:r?[...r]:[]};return{entity:{id:i,type:u,action:ke.SY.create},entityOptions:m,command:d}}var pK=n(794166),gK=n.n(pK),hK=n(162917),vK=n.n(hK),yK=n(175350),SK=n.n(yK);const fK={AssemblyStarted:gK(),AssemblyFinished:vK(),AssemblyError:SK()};const kK="CN:",CK=2e3,bK=(e,t,n,i,a,o,r,s,l)=>async()=>{const u=i.newLogger("getSetupAppEventsJob","apps-calling");u.infoToTelemetry?.("[getSetupAppEventsInnerJob] Initializing calling app event","cmd_horizontals_setup_app_events_job",void 0,!0);const{enableCallingEventJobsCleanup:m}=a.get(c.w.Calling);let p=!1;const g=(0,Wv.v)(),h=o.newScenario(be.Cu.CallingAppEventsSubscribe);KJ.setCallingAppEventsSubscribed(!0);const v=e.subscribe({query:HJ,fetchPolicy:"no-cache"}).map((({data:e})=>e?.callingAppEvents)).subscribe({next:async r=>{const c=o.newScenario(be.Cu.CallingAppEventSubscriptionNext,{clientId:r?.id});if(!r)return u.error("[getSetupAppEventsInnerJob] Received undefined calling app event"),void c?.fail({reason:"undefined-calling-app-event"});if("CallingAppSetupEvent"===r.event.__typename&&r.event.result&&"CallingAppEventsSetupSuccess"===r.event.result.__typename)return u.log("[getSetupAppEventsInnerJob] Successfully subscribed."),p=!0,g.resolve(),h?.stop(),void c?.stop();const{context:m}=r,{source:v}=m;u.log(`[getSetupAppEventsInnerJob] Received calling app event [event.id=${r.id}][context.externalId=${m.externalId}][source.name=${v.name}][source.description=${v.description}]`);try{await wK(s,r,a,e,t,n,i,o,l),c?.stop()}catch(t){u.error(`Calling app event handler threw error. [error.name=${t?.name}][error.message=${t?.message}]`),c?.fail({errorCode:t.name,message:t.message,reason:"job-subscription-next-error"}),JJ({eventId:r.id,resolution:{error:{name:t?.errorCode||d.O4.HandleCallingAppEventError,message:t?.errorMessage||`Unhandled exception while handling calling app events in job [eventId=${r.id}]`}},context:{source:{name:"CallingAppEventJobHandlerError",description:`Error handling event in app job setup calling app events [eventId=${r.id} error.errorCode=${t?.errorCode}, error.message=${t?.errorMessage}]`}}},e,u)}},error:e=>{if(u.error(`[getSetupAppEventsInnerJob] Error in calling app events subscription [error.name=${e?.name}][error.message=${e?.message}]`),!p){const t=(0,Je.$5)(r,d.O4.SetupCallingAppEventsJobError,"",{},`[getSetupAppEventsInnerJob] error.name=${e?.name}, error.message=${e?.message}`);g.reject(t)}let t=o.findScenario(be.Cu.CallingAppEventsSubscribe);t||(t=o.newScenario(be.Cu.CallingAppEventsSubscribe)),t.fail({errorCode:e?.name,message:e?.message,reason:"app-job-subscription-error"})},complete:()=>{o.newScenario(be.Cu.CallingAppEventsUnsubscribe).stop()}});return m?e=>{u.log(`Cleanup SetupCallingAppEventsJob called. reason: ${e}`),v?.unsubscribe(),KJ.unlockDeeplinkEntity(),KJ.setCallingAppEventsSubscribed(!1)}:g.promise},wK=async(e,t,n,i,a,o,r,s,l)=>{const{id:d,event:u,context:m}=t;if(!("action"in u)||!("content"in u)){throw r.newLogger("appEventsHandler","apps-calling").error("[getSetupAppEventsInnerJob] Expected event of type CallingAppEvent, not CallingAppSetupEvent."),new Error("IncorrectCallingAppEventTypeError")}switch(u.content.__typename){case"AutoBrbDialogContent":!async function(e,t,n,i,a,o){const r=e.newLogger("handleAutoBrbDialogContentEvent","apps-calling"),{enableAutoBrbViaScenarioCallback:s}=i.get(c.w.Calling);if(!s)return void r.warn("handleAutoBrbDialogContentEvent should not be called if enableAutoBrbViaScenarioCallback is false");const{title:l,category:d,correlationId:u}=n;if(r.log("Auto Brb with dialog request received"),!(l&&d&&u&&o)){const e=`[handleAutoBrbDialogContentEvent] Error handling auto brb content event due to undefined commanding with [eventId=${o},`,t=cK(o,"AutoBrbCommandingError",`Error converting auto brb content to commanding [eventId=${o}]`,"auto-brb-invalid-parameter",`Error in converting auto brb content to command, a required parameter is undefined [titleMissing: ${!!l}, categoryMissing: ${!!d}, correlationIdMissing: ${!!u}}, eventIdMissing: ${!!o}, eventId ${o}}]`);return void await lK(t,a,r,e)}const m={feedbackSelectedCategory:n.category,feedbackText:n.title},p=A.p.AutoBrb,h={visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{id:u,source:p}};try{t.brbFeedback.autoBrbFlowDialog(h,m);const e=`Show auto brb dialog command resolved successfully [eventId=${o}, correlationId=${u}]`,n=`[handleAutoBrbDialogContentEvent] Error when reporting show auto brb event "success" with [eventId=${o}, correlationId=${u},`,i=cK(o,"AutoBrbCommandingSuccess",e);await lK(i,a,r,n)}catch(e){const t=e?.name||"unknown-auto-brb-commanding-error-name",n=e?.message||"unknown-auto-brb-app-commanding-error-message";r.error(`[handleAutoBrbDialogContentEvent] Commanding error errorName=${t}, eventSource=${p}, errorMessage=${n}, correlationId: ${u}}, eventId: ${o}]`);const i="AutoBrbCommandingError",s=`Error triggering Auto Brb command [eventId=${o}, eventSource=${p}, correlationId: ${u}]`,l=`[handleAutoBrbDialogContentEvent] Error when reporting event "error" [eventId=${o}, eventSource=${p}, correlationId: ${u}, error.name=${e?.name}, error.message=${e?.message},`,c=cK(o,i,s,t,n);await lK(c,a,r,l)}}(r,a,u.content,n,i,d);break;case"MainAppContent":!async function(e,t,n,i,a){const o=e.newLogger("handleMainAppContentEvent","apps-calling"),r={id:a.context.externalId||i,startTimestamp:a.context.timeStamp||"undefined",scenarioName:be.Cu.CallingAppEventMainApp,source:A.p.CallingAppEvent_PeripheralDeviceTeamsButtonShortPress};try{await t.deepLink.launchMainApp(r)}catch(e){const t=e?.name||"unknown-launch-main-app-commanding-error-name",a=e?.message||"unknown-launch-main-app-commanding-error-message";o.error(`[handleMainAppContentEvent] Commanding error errorName=${t}, eventSource=${r.source}, errorMessage=${a}]`);try{await JJ({eventId:i,resolution:{error:{name:t,message:a}},context:{source:{name:"MainAppCommandingError",description:`Error triggering launch main app command [eventId=${i}, eventSource=${r.source}]`}}},n,o)}catch(e){o.error(`[handleMainAppContentEvent] Error when reporting event "error" [eventId=${i}, eventSource=${r.source}, error.name=${e?.name}, error.message=${e?.message}]`)}return}o.log(`[handleMainAppContentEvent] Commanding success [eventId=${i}, eventSource=${r.source}]`);try{await JJ({eventId:i,resolution:{success:{_:!0}},context:{source:{name:"MainAppCommandingSuccess",description:`Command resolved successfully [eventId=${i}, eventSource=${r.source}]`}}},n,o)}catch(e){o.error(`[handleMainAppContentEvent] Error when reporting event "success" [error.name=${e?.name}, error.message=${e?.message}]`)}}(r,a,i,d,t);break;case"CallingWindowingContent":!async function(e,t,n,i,a,o,r,s){const l=e.newLogger("handleCallingWindowingContentEvent","apps-calling"),{entity:d,command:u}=rK(i,a,o,r),m=KJ.unlockDeeplinkEntity();try{"CALL_MONITOR"===o.viewType?await t.call.callMonitorById(o.id,{visibilityState:u.visibilityState,stateTransition:u.stateTransition,correlation:u.correlation}):await t.call.callById(d.id,{visibilityState:u.visibilityState,stateTransition:u.stateTransition,correlation:u.correlation},d?.linkedEntity?.id,d.type,m)}catch(e){const t=e?.name||"unknown-windowing-commanding-error-name",a=e?.message||"unknown-windowing-commanding-error-message";l.error(`[handleCallingWindowingContentEvent] Windowing commanding error [entity.id=${d.id}, errorName=${t}, errorMessage=${a}]`);try{await JJ({eventId:i,resolution:{error:{name:t,message:a}},context:{source:{name:"WindowingCommandingTriggerError",description:`Error triggering windowing command [eventId=${i}, entity.id=${d.id}]`}}},n,l)}catch(e){l.error(`[handleCallingWindowingContentEvent] Error when reporting event "error" [eventId=${i}, entity.id=${d.id}, error.name=${e?.name}, error.message=${e?.message}]`)}return}const{enableCallingAppCommandResolvedHook:p}=s.get(c.w.Calling);if(p)return;l.log(`[handleCallingWindowingContentEvent] Windowing commanding success [eventId=${i}, entity.id=${d.id}]`);try{await JJ({eventId:i,resolution:{success:{_:!0}},context:{source:{name:"WindowingCommandingSuccess",description:`Windowing command resolved successfully [eventId=${i}, entity.id=${d.id}]`}}},n,l)}catch(e){l.error(`[handleCallingWindowingContentEvent] Error when reporting event "success" [entity.id=${d.id}, error.name=${e?.name}, error.message=${e?.message}]`)}}(r,a,i,d,u,u.content,m,n);break;case"CallingToChatContent":!async function(e,t,n,i,a){const o=e.newLogger("handleCallingToChatContentEvent","apps-calling"),{entity:r,command:s}=function(e,t,n,i){const a=t.id,{action:{visibility:o}}=e,{externalId:r,timeStamp:s}=i,l=ZJ(o,n),c=t.messageId?{id:t.messageId,type:ke.ck.messages}:void 0;return{entity:{id:a,type:ke.ck.chats,action:ke.SY.view,linkedEntity:c},command:{visibilityState:l,stateTransition:g.Ar.new,correlation:{id:r||void 0,startTimestamp:s||void 0,source:A.p.CallingAppEvent_NavigateToConversationPromiseChat}}}}(n,i,o,a);try{await t.chat.chatById(r.id,{entityCommand:{visibilityState:s.visibilityState,stateTransition:s.stateTransition,correlation:s.correlation},entityOptions:{messageId:r.linkedEntity?.id}})}catch(e){o.error(`[getSetupAppEventsInnerJob] Navigation to chat commanding error [entity.id: ${r.id}, error.name: ${e?.name}, error.message: ${e?.message}]`)}o.log(`[getSetupAppEventsInnerJob] Navigation to chat commanding success [entity.id: ${r.id}]`)}(r,a,u,u.content,m);break;case"CallingBreakoutRoomPanelContent":uK({eventId:d,loggerFactory:r,delegatedCommanding:o,dataClient:i,event:u,content:u.content,context:m});break;case"CrossCloudMeetingJoinContent":!async function(e,t,n,i,{meetingUrl:a}){let o;const r=e.newLogger("handleCrossCloudMeetingJoinContentEvent","apps-calling");r.log("handleCrossCloudMeetingJoinContentEvent called");try{await t.deepLink.executeFromUrlV2(a,void 0,void 0),o={success:{_:!0}}}catch(e){const t=e?.name||"unknown-cross-cloud-meeting-join-content-event";o={error:{name:t,message:e?.message||"unknown-windowing-commanding-error-message"}},r.error(`[handleCrossCloudMeetingJoinContentEvent] Cross Cloud commanding error [meetingUrl=${a}, errorName=${t}]`)}try{await JJ({eventId:i,resolution:o,context:{source:{name:"WindowingCommandingTriggerError",description:`Error triggering windowing command [eventId=${i}]`}}},n,r)}catch(e){r.error(`[handleCrossCloudMeetingJoinContentEvent] Error when reporting event resolution [eventId=${i}, error.name=${e?.name}, error.message=${e?.message}]`)}}(r,a,i,d,u.content);break;case"CallingToChatListContent":!async function(e,t,n,i){const a=e.newLogger("handleCallingToChatListContentEvent","apps-calling"),{command:o}=function(e,t,n){const{action:{visibility:i}}=e,{externalId:a,timeStamp:o}=n,r=ZJ(i,t);return{entity:{type:ke.ck.chats,action:ke.SY.view},command:{visibilityState:r,stateTransition:g.Ar.none,correlation:{id:a||void 0,startTimestamp:o||void 0,source:A.p.CallingAppEvent_NavigateToDefaultState}}}}(n,a,i);try{await t.chat.chatList({visibilityState:o.visibilityState,stateTransition:o.stateTransition,correlation:o.correlation})}catch(e){a.error(`[getSetupAppEventsInnerJob] Navigation to chat list commanding error, error.name: ${e?.name}, error.message: ${e?.message}]`)}a.log("[getSetupAppEventsInnerJob] Navigation to chat list commanding success")}(r,a,u,m);break;case"CallingToCallListContent":!async function(e,t,n,i){const a=e.newLogger("handleCallingToCallListContentEvent","apps-calling"),{command:o}=function(e,t,n){const{action:{visibility:i}}=e,{externalId:a,timeStamp:o}=n,r=ZJ(i,t);return{entity:{type:ke.ck.callsmain,action:ke.SY.view},command:{visibilityState:r,stateTransition:g.Ar.none,correlation:{id:a||void 0,startTimestamp:o||void 0,source:A.p.CallingAppEvent_NavigateToMainWindow}}}}(n,a,i);try{await t.call.callList({visibilityState:o.visibilityState,stateTransition:o.stateTransition,correlation:o.correlation})}catch(e){a.error(`[getSetupAppEventsInnerJob] Navigation to call list commanding error, error.name: ${e?.name}, error.message: ${e?.message}]`)}a.log("[getSetupAppEventsInnerJob] Navigation to call list commanding success")}(r,a,u,m);break;case"CallingToSettingsPaneContent":!async function(e,t,n){const i=e.newLogger("handleCallingToSettingsPaneContentEvent","apps-calling"),a=function(e){const t=new Map([[iK.Calling,aK.G.Calls],[iK.Notifications,aK.G.Notifications],[iK.Devices,aK.G.Devices],[iK.PremiumBenefits,aK.G.Benefits],[iK.Privacy,aK.G.Privacy]]);return{id:e.tabItemId?t.get(e.tabItemId):void 0,command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.CallingAppEvent}}}}(n),{id:o,command:r}=a;try{await t.settings.launchSection(o,r)}catch(e){i.error(`[getSetupAppEventsInnerJob] setting commanding error [entity.id: ${o}, error.name: ${e?.name}, error.message: ${e?.message}]`)}}(r,a,u.content);break;case"CallingBannerContent":!async function(e,t,n,i,a,o,r,s){const l=e.newLogger("handleCallingBannerContentEvent","apps-calling"),{enableCallingBannerContent:d}=s.get(c.w.Calling);if(!d)return;const u=sK(a,o,r);if(!u){l.error("[handleCallingBannerContentEvent] Banner commanding error - no command to fire, visibility state is undefined");const e=`[handleCallingBannerContentEvent] Error in handling calling banner content event due to undefined commanding with [eventId=${i},`,t=cK(i,"BannerContentToCommandingConversionError",`Error converting banner content to commanding [eventId=${i}]`,"Unknown-banner-commanding-error-name",`Unhandled exception while handling calling app events in job, error in converting banner content to command, visibility state is undefined [eventId=${i}]`);return void await lK(t,n,l,e)}const{bannerPrimaryActionEntity:m,entityOptions:p,command:g,bannerDismissCommandEntity:h}=u,{action:{visibility:v}}=a;if("Show"===v)try{await t.shell.showBanner({id:o.id,text:o.text,intentLevel:o.intentLevel,action:o.actionButtonText?{text:o.actionButtonText,command:{entity:m,entityOptions:p,command:g},dismissOnAction:o.dismissOnAction}:void 0,dismissable:o.dismissable||void 0,dismissActionCommand:{entity:h,entityOptions:p,command:g},duration:o.duration,bannerScenario:o.bannerScenario,source:o.source});const e="ShowBannerSuccess",a=`Show banner command resolved successfully [eventId=${i}, entity.id=${m.id}]`,r=`[handleCallingBannerContentEvent] Error when reporting show banner event "success" with [eventId=${i}, entity.id=${m.id},`,s=cK(i,e,a);await lK(s,n,l,r)}catch(e){l.error(`Error is displaying banner through shell.showBanner with [entity.id: ${m.id}, error.name: ${e.name}, error.message: ${e.message}]`);const t=`[handleCallingBannerContentEvent] Error in handling calling banner content event due to failure of shell.showBanner with [eventId=${i},`,a=cK(i,"ShowBannerError",`Error in showing banner through shell.showBanner [eventId=${i}]`,"Unknown-show-banner-error-name",`Unhandled exception while handling calling app events in job, failed to trigger shell.showBanner function, error in showing banner [eventId=${i}]`);await lK(a,n,l,t)}if("Hide"===v)try{await t.shell.dismissBanner(o.id,o.source),l.log(`[dismissBanner] Successfully hiding the banner with [bannerId: ${o.id}] when call is no longer active.`);const e="DismissBannerSuccess",a=`Dismiss banner command resolved successfully [eventId=${i}, entity.id=${h.id}]`,r=`[handleCallingBannerContentEvent] Error when reporting dismiss banner event "success" with [eventId=${i}, entity.id=${h.id},`,s=cK(i,e,a);await lK(s,n,l,r)}catch(e){l.error(`Error in dismissing the banner when call is no longer active. entity.id: ${h.id}, entity.action: ${h.action}, error.name=${e.name}, error.message=${e.message}]`);const t=`[handleCallingBannerContentEvent] Error in handling calling banner content event due to failure of shell.dismissBanner with [eventId=${i},`,a=cK(i,"DismissBannerError",`Error in dismissing banner through shell.dismissBanner [eventId=${i}]`,"Unknown-dismiss-banner-error-name",`Unhandled exception while handling calling app events in job, failed to trigger shell.dimissBanner function, error in dismissing banner [eventId=${i}]`);await lK(a,n,l,t)}}(r,a,i,d,u,u.content,m,n);break;case"CallingLocalRecordingNotificationContent":!function(e,t,n){e.newLogger("handleCallingLocalRecordingNotificationEvent","apps-calling").log("Local recording notification event received",n.localRecordingNotificationType),t.toasts.showLocalRecordingAssemblyNotification(`${Date.now()}`,{title:n.title,text:n.text,mainImage:{alt:"",src:fK[n.localRecordingNotificationType]},time:new Date,type:"LocalRecordingAssembly",quickReply:!1,conversationId:""})}(r,a,u.content);break;case"CallingDialogContent":!async function(e,t,n,i,a,o){const r=e.newLogger("handleCallingDialogContentEvent","apps-calling"),{id:s}=i,l=o.findScenarioByNameAndId(be.Cu.CallingDialogOpen,s);l||r.error(`[getSetupAppEventsInnerJob] Cannot find calling_dialog_open scenario [dialogId: ${s}]`),l?.mark(be.BQ.CallingDialogCallingAppEventReceived);const c=mK(n,i,a);if(!c){const e="[getSetupAppEventsInnerJob] Dialog commanding error - no command to fire, command is undefined";return r.error(e),void l?.fail({errors:e,errorCode:"command-is-undefined"})}const{entity:d,entityOptions:u,command:m}=c;if(!d.type){const e=`[getSetupAppEventsInnerJob] Dialog commanding error - no command to fire, entity type is undefined [entity.id: ${d.id}]`;return r.error(e),void l?.fail({errors:e,errorCode:"entity-type-is-undefined"})}l?.mark(be.BQ.BeforeCallingDialogEntityCommandTriggered);try{await t.call.openDialog(d,m,u)}catch(e){const t=`[getSetupAppEventsInnerJob] Dialog ENTITY commanding error [entity.id: ${d.id}, error.name: ${e?.name}, error.message: ${e?.message}]`;return r.error(t),void l?.fail({errors:t,errorCode:"open-dialog-commanding-error"})}l?.mark(be.BQ.AfterCallingDialogEntityCommandTriggered),r.log(`[getSetupAppEventsInnerJob] Dialog commanding success [entity.id: ${d.id}]`)}(r,a,u,u.content,m,s);break;case"CallingNotificationContent":!async function(e,t,n,i,a,o,r,s,l,d,u){const m=e.newLogger("handleCallingNotificationContentEvent","apps-calling");let p;const g=(0,E.v4)(),{enableIncomingCallCrossClientTelemetry:h}=r.get(c.w.Calling);h&&n.callId&&n.crossClientScenarioName&&(p=s.findScenarioByNameAndId(n.crossClientScenarioName,n.callId));const v=XJ(n,r,g);v.entityOptions&&r.get(c.w.Notifications).enableToastCollections&&(v.entityOptions.collectionId=(0,cB.pP)(d,u,m));if(await Promise.all([NK(n,o,v,m,p),TK(n,o,v,m,p)]),"CreateNotificationWithActions"===a.source?.name)if("Show"===i){let e;p?.mark(be.BQ.CrossClientTriggerShowToast);try{e=await t.call.callNotification(v,n.id,g,"Show")}catch(e){p?.fail({errorCode:$t.n.SubscriptionFailed,reason:"Subscription failed on show"});const t=e?.name,o=`${kK}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${t}]`;m.errorToTelemetry?.(o,"call_command_subscription_error",void 0,!0)}try{!function(e,t,n,i){JJ({eventId:t,resolution:{success:{_:!0}},context:{source:e?{name:"CallingAppEventJobHandlerSuccess",description:`Commading call notification [eventId=${t}] [notificationResult=${e}]`}:{name:"CallingAppEventJobHandlerWarning",description:`Call Notification was not executed, notification might be dropped for expected reasons [eventId=${t}]`}}},n,i)}(e,l,o,m)}catch(e){p?.mark(be.BQ.CrossClientCallingNotificationError);const t=e?.name,o=`${kK}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${t}]`;m.errorToTelemetry?.(o,"call_command_notification_error",void 0,!0)}}else{p?.mark(be.BQ.CrossClientTriggerHideToast);try{await t.call.callNotification(v,n.id,g,"Hide")}catch(e){p?.fail({errorCode:$t.n.SubscriptionFailed,reason:"Subscription failed on hide"}),m.error(`${kK}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${e?.name}, error.message: ${e?.message}]`)}}else{if("UpdateNotification"!==a.source?.name)return p?.fail({errorCode:$t.n.SubscriptionFailed,reason:`Invalid context.source.name [${a.source?.name}]`}),void m.error(`${kK}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error invalid context.source.name [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}`);p?.mark(be.BQ.CrossClientTriggerUpdateToast);try{await t.call.callNotification(v,n.id,g,"Show")}catch(e){p?.fail({errorCode:$t.n.SubscriptionFailed,reason:"Subscription failed on update"}),m.error(`${kK}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${e?.name}, error.message: ${e?.message}]`)}}p?.mark(be.BQ.CrossClientEntityCommandTriggered),m.log(`${kK}${n.id}:[handleCallingNotificationContentEvent] Notification commanding success [content.id: ${n.id}][entity.id: toasts][visibility: ${i.toString()}]`)}(r,a,u.content,u.action.visibility,m,i,n,s,d,e,l)}};async function TK(e,t,n,i,a){try{const o=await(0,yi.a)(async function(e,t){try{const n=await e.query({query:qJ,fetchPolicy:"network-only"});return n?n.data.priorityContacts.map((e=>e.id)):(t.error(`${kK}[handleCallingNotificationContentEvent] Failed to fetch priority contacts`),[])}catch(e){return t.error(`${kK}[handleCallingNotificationContentEvent] Failed to fetch priority contacts. error:${e.message}`),[]}}(t,i),CK);n.entityOptions.isUrgent=o.includes(e.userid),a?.mark(be.BQ.PriorityContactsFetched)}catch(t){i.error(`${kK}${e.id}:[handleCallingNotificationContentEvent] Error when fetching priority contacts. Error: ${t.message}`)}}async function IK(e,t,n,i,a,o,r){try{const s=o?await(0,yi.a)(async function(e,t,n){if(!n?.length)return null;const i=await e.query({query:zJ,variables:{msaGroupInfo:{pictureReadyUsers:n.map((({id:e,displayName:t})=>({userId:e,displayName:t}))).slice(0,4),conversationId:t}}});return i?.data.msaGroupProfilePicture}(e,r||"",o),CK):await(0,yi.a)(async function(e,t,n){const i=await e.query({query:GJ,variables:{userId:t,displayName:n,profilePictureSize:"HR96x96"}});return i?.data.msaUserProfilePicture}(e,t,n),CK);if(!s)return void a.error(`${kK}${i}:[handleCallingNotificationContentEvent] Failed to generate avatar image url`);const l=await e.query({query:YJ,variables:{url:s}});return l?.data.toastImageAsDataUri||void 0}catch(e){return void a.error(`${kK}${i}:[handleCallingNotificationContentEvent] failed to fetch avatar image. Error.name: ${e?.name}, error.message: ${e?.message}`)}}async function NK(e,t,n,i,a){try{let o,r;e.userid&&n.entityOptions?.mainImage?o=IK(t,e.userid,e.title,e.id,i):e.members?.length&&n.entityOptions?.mainImage&&"HuddleMeetingStart"===n.entityOptions?.targetEntity?.dataOptions?.toastType?o=IK(t,"",e.title,e.id,i,e.members,e.conversationId||""):i.log("[handleCallingNotificationContentEvent] Primary avatar not fetched, user id or main image property is not present on the content."),e.header?.mri&&n.entityOptions?.headerImage&&(r=IK(t,e.header.mri,e.header.subtitle,e.id,i));const[s,l]=await Promise.all([o,r]);s&&(n.entityOptions.mainImage={src:s,alt:e.title??""},a?.mark(be.BQ.CrossClientAvatarFetched)),l&&(n.entityOptions.headerImage={src:l,alt:e.header?.subtitle??""})}catch(e){i.error(`[handleCallingNotificationContentEvent] failed handle avatar fetches. Error: ${e}`)}}var AK=n(375474);const EK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingSetCallStatePresenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingClientState"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingClientStatePresence"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setCallStatePresence"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingClientState"},value:{kind:"Variable",name:{kind:"Name",value:"callingClientState"}}}]}]}}]},FK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"callingClientStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingClientStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingClientStateEvent"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingClientStateEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingClientStateEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"inCall"}},{kind:"Field",name:{kind:"Name",value:"isScreenSharing"}}]}}]}.definitions]},_K={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"updateClientStateVeryActive"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isVeryActive"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateClientStateSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateClientStateVeryActive"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isVeryActive"},value:{kind:"Variable",name:{kind:"Name",value:"isVeryActive"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}]}]}}]},DK=(e,t,n)=>async()=>{const i=t.newLogger("getCallingClientEventsJob","apps-calling"),{enableCallingEventJobsCleanup:a}=n.get(c.w.Calling),o=e.subscribe({query:FK,fetchPolicy:"no-cache"}).subscribe((async({data:n,errors:a})=>{if(a){const e=a.map((e=>e.message));i.error(`handleCallingClientStateEvent: Error receiving callingClientStateEvent [Errors: ${e.join()}]`)}else n&&(i.log(`handleCallingClientStateEvent: Processing callingClientStateEvent [Received: ${(0,ge.hR)(n)}]`),async function(e,t,n){const i=e.newLogger("handleCallingClientStateEvent","apps-calling");i.log(`Event received: ${(0,ge.hR)(t)}`);try{await n.mutate({mutation:_K,variables:{isVeryActive:t.inCall||t.isScreenSharing,source:"Calling"}})}catch(e){i.error(`mutation updateClientStateVeryActiveDocument error, error.name: ${e?.name}, error.message: ${e?.message}]`)}}(t,n.callingClientStateEvent,e),n.callingClientStateEvent.inCall&&n.callingClientStateEvent.isScreenSharing?(PK(t,"PRESENTING",e),MK("ScreenSharing",e)):n.callingClientStateEvent.inCall?(PK(t,"IN_A_CALL",e),MK("InCall",e)):(PK(t,"NOT_IN_A_CALL",e),MK("None",e)))}));if(a){return e=>{i.log(`Cleanup CallingClientEventsJob called. reason: ${e}`),o?.unsubscribe()}}};async function PK(e,t,n){const i=e.newLogger("setCallingClientStatePresence","apps-calling");i.log(`Call state presence received: ${t}`);try{await n.mutate({mutation:EK,variables:{callingClientState:t}})}catch(e){i.error(`mutation AppsCallingSetCallStatePresenceMutationDocument error, error.name: ${e?.name}, error.message: ${e?.message}]`)}}async function MK(e,t){await t.mutate({mutation:AK.e,variables:{newState:e},fetchPolicy:"no-cache"})}var RK=n(200121),xK=n(224832);function LK(e,t,n,i,a){const o=n.newLogger("emergency-location-notification-job-logger","apps-calling");return{id:"emergency-location-notification",job:async()=>{const n=i.stringTranslate(c.w.Calling,"emergency_manage_location_button_text"),r=e.subscribe({query:RK.S}).subscribe((({data:e})=>{if((0,xK.YE)(e?.emergencyAddressUpdatedEvent)){const a=((e,t)=>{const n=e.stringTranslate(c.w.Calling,"emergency_location_needs_confirmation_banner_text"),i=e.stringTranslate(c.w.Calling,"emergency_location_not_detected_banner_text");return"CLS"===t?.type?n:!t||t.editable&&"None"===t.type?i:""})(i,e?.emergencyAddressUpdatedEvent);!function(e,t,n){n.shell.showBanner({id:"E911LocationBanner",source:A.p.ShellE911LocationChange,bannerScenario:"emergency_location_banner",intentLevel:"Severe",cause:"EmergencyLocationBanner",text:e,action:{text:t,command:{entity:{type:ke.ck.locationnotificationbanner,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.ShellE911LocationChange}}},dismissOnAction:!0},dismissable:!0,duration:0})}(a,n,t)}else t.shell.dismissBanner("E911LocationBanner",A.p.ShellE911LocationChange);a&&a()}));return()=>{r.unsubscribe(),o.log("[location] unsubscribing ...")}}}}const OK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingVerifyMinSsaDriverVersionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"systemAudioDriverState"}}]}}]},jK=["Unavailable","Installed","InProgress"],BK=["UpdateAvailable","MustUpdate"];const UK=(e,t,n,i,a,o,r,s,l,d,u)=>{const{enableCallingStackInitialization:m,enableCallingClientEvents:p,enableCallingAppEvents:g,enableEmergencyLocationGlobalBanner:h,enableMinSSADriverBanner:v}=o.get(c.w.Calling),y=[];if(m){const t=$K(a,be.Cu.StandupCallingAppJob,r);y.push(UJ(e,i,r,a,o)),t.mark(be.BQ.JobAdded),t.stop()}return g&&y.push(((e,t,n,i,a,o,r,s,l)=>({id:"setup-calling-app-events",runOncePerId:!0,job:bK(e,t,n,i,a,o,r,s,l)}))(e,t,n,i,o,a,r,u,d)),p&&y.push(((e,t,n)=>({id:"calling-client-events",runOncePerId:!0,job:DK(e,t,n)}))(e,i,o)),h&&l&&y.push(LK(e,t,i,l)),r===be.BQ.OnAppPreWarm&&v&&s.config.osPlatform===nt.SA.Mac&&l&&y.push(function(e,t,n,i,a){const o=n.newLogger("VerifyMinimumSystemAudioDriverVersionJob","apps-shell");return{id:"desktop-verify-minimum-system-audio-driver-version-job",job:async()=>{if(a.config.clientType!==nt.sK.Maglev)return;const{data:{systemAudioDriverState:n}}=await i.query({query:OK});if(jK.includes(n))return void o.log(`Banner will not display. Driver state: ${n}`);let r,s,l="",c="";if("NotInstalled"===n)r="SystemAudioDriverMissing",l=e.stringTranslate("framework","ssa_driver_not_installed_banner_text"),c=e.stringTranslate("framework","ssa_driver_not_installed_banner_button_text"),s=ke.SY.install,o.log("Driver missing. Showing install banner.");else{if(!BK.includes(n))return;r="SystemAudioDriverBelowRequiredVersion",l=e.stringTranslate("framework","ssa_driver_below_required_version_banner_text"),c=e.stringTranslate("framework","ssa_driver_below_required_version_banner_button_text"),s=ke.SY.update,o.log("Driver outdated. Showing update banner.")}t.shell.showBanner({id:"SystemAudioDriverUpgradeBanner",intentLevel:"Severe",text:l,source:"SystemAudioDriverUpdateRequired",cause:r,dismissable:!0,duration:0,action:{text:c,dismissOnAction:!0,command:{entity:{type:ke.ck.installsystemaudiodriver,action:s}}}})}}}(l,t,i,e,s)),y},$K=(e,t,n)=>{let i=e.findScenario(t);return i||(i=e.newScenario(t)),i.mark(n),i},WK=({context:{authenticationUser:e,client:t,coreSettings:n,entityCommanding:i,delegatedCommanding:a,i18n:o,loggerFactory:r,scenarioFactory:s,userTrackingService:l,platformService:c}})=>UK(t,i,a,r,s,n,be.BQ.OnAppPreWarm,c,o,l,e),VK=({context:{client:e,coreSettings:t,entityCommanding:n,delegatedCommanding:i,loggerFactory:a,scenarioFactory:o,platformService:r}})=>UK(e,n,i,a,o,t,be.BQ.OnAppPreInit,r);var HK;!function(e){e.EmptyDeeplinkUrl="empty-deeplink-url-received",e.MeetingCodeParse="meeting-code-parse-error",e.LegacyCoordinatesParse="legacy-coordinates-parse-error",e.EmptyContext="empty-context-received",e.EmptyParsedUrlParams="empty-parsed-url-params",e.None="no-entity-command-expected",e.PresentDeepLinkT2Disabled="present-deeplink-t2-disabled",e.EmptySearch="empty-search-url",e.MeetingShareDeepLinkT2Disabled="meeting-share-deeplink-t2-disabled"}(HK||(HK={}));const zK=e=>({visibilityState:g.Rp.show,stateTransition:e?g.Ar.flush:g.Ar.new,layoutMode:e?Yt.Rm.standard:Yt.Rm.focus}),qK=(e,t,n)=>n?!(e&&"true"===e.get("enablemcasfort21")||(0,Un.z)().location.search.includes("enablemcasfort21=true"))&&(t||!1):t||!1,GK=(e,t)=>{if("null"!==e)return e;const n=t.get("fqdn");return n?`https://${n}`:void 0},YK=(e,t,n,i)=>{const a=t.get("fqdn");return a?(i?.infoToTelemetry?.(`fqdn exists, ${a}`,"cmd_meeting_join_missing_data",void 0,!1),a):(0,QG.Ru)(e,n,i)},QK={filter:"/meet/meet-now",execute:({deeplinkUrl:{pathname:e,search:t},context:{loggerFactory:n,coreSettings:i,scenarioFactory:a}})=>{const o=a.newScenario(be.Cu.SeamlessMeetNowLaunchDeeplinkCondition),r=n.newLogger("[Calling][onBeforeDeeplinkParsed][/meeting/meet-now]","apps-calling"),{enableSeamlessMeetNowLaunchFromOutlook:s,enableDeeplinkFlushCommand:l}=i.get(c.w.Calling);if(o.mark(be.BQ.SeamlessMeetNowLaunchDeeplinkConditionEnabled),!s){const e="Flag enableSeamlessMeetNowLaunchFromOutlook is not enabled. Skipping deeplink processing.";return r.debug(e),o.cancel({reason:e}),Promise.resolve(void 0)}r.infoToTelemetry&&r.infoToTelemetry(`MeetNow launch from Outlook deeplink condition executed. Pathname: ${e}`,"cmd_meeting_join",void 0,!1),r.log(`Parsing pathname: ${e}, search: ${t}, enableSeamlessMeetNowLaunchFromOutlook: ${s}`);const d=zK(!!l);return r.infoToTelemetry&&r.infoToTelemetry(`Requesting entity command: ${d}.`,"cmd_meeting_join",void 0,!1),o.stop({reason:be.BQ.SeamlessMeetNowLaunchDeeplinkConditionExecuted}),Promise.resolve({entityCommand:{entity:{type:ke.ck.callingdeeplink,action:ke.SY.join},command:d,entityOptions:{deeplinkUrl:e,coordinates:{joinType:"MeetingData",meetingData:{},isAdhoc:!0}}},metadata:{allowAnonymous:!1}})}},JK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingFormatPhoneNumberQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uri"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"formatPhoneNumber"},arguments:[{kind:"Argument",name:{kind:"Name",value:"uri"},value:{kind:"Variable",name:{kind:"Name",value:"uri"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"normalized"}}]}}]}}]},KK=e=>"tel:"===e||"callto:"===e,ZK={filter:({protocol:e})=>KK(e),execute:async({deeplinkUrl:{pathname:e,protocol:t},context:{coreSettings:n,loggerFactory:i,getUserContexts:a}})=>{const o=i.newLogger("[Calling][OnBeforeDeeplinkParsed][CallingProtocol]","apps-calling"),{enableCallWithUsersDeeplink:r}=n.get(c.w.Calling);if(!r||!KK(t)){const e=`enableCallWithUsersDeeplink=${r} or protocol=${t} is not supported`;throw o.warnToTelemetry?.(e,"calling_protocol_deeplink_condition",void 0,!0),new Error(e)}o.infoToTelemetry?.(`Returning calling protocol dialog intent for protocol=${t}`,"calling_protocol_deeplink_condition",void 0,!1),e=decodeURIComponent(e);const{normalized:s}=await XK(e,a,o);return o.log?.(`pathname="${e}" was normalized to number="${s}", triggering deeplink dialog intent on protocol="${t}" with target="${s}"`),{entityCommand:{entity:{type:ke.ck.callingprotocoldeeplinkdialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.standard},entityOptions:{protocol:t,target:s}},metadata:{allowAnonymous:!1}}}},XK=async(e,t,n)=>{try{const n=(await t())[0].context.client,{data:i}=await n.query({query:JK,variables:{uri:e}});return i.formatPhoneNumber}catch(e){const t=`Could not normalize, client.formatPhoneNumberQuery() failed. Error message=${e.message}`;n.errorToTelemetry?.(t,"calling_protocol_deeplink_condition",void 0,!0)}return{normalized:e}},eZ="/l/meetup-join",tZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingHandlePresentDeeplinkMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ver"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pptContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"handlePresentDeepLink"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ver"},value:{kind:"Variable",name:{kind:"Name",value:"ver"}}},{kind:"Argument",name:{kind:"Name",value:"deeplinkId"},value:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}}},{kind:"Argument",name:{kind:"Name",value:"pptContext"},value:{kind:"Variable",name:{kind:"Name",value:"pptContext"}}}]}]}}]},nZ=void 0,iZ=!0,aZ={filter:"/l/present",execute:async({deeplinkUrl:{search:e},context:{coreSettings:t,loggerFactory:n,__doNotUse_globalDataClient:i}})=>{const{enablePresentDeepLinkForMTMA:a}=t.get(c.w.Calling),o=n.newLogger("[Calling][onBeforeDeeplinkParsed][/present]","apps-calling");if(o.infoToTelemetry?.(`EnablePresentToTeamsT2: ${a}. Parsing search length: ${e.length}`,"cmd_meetings_pptsharing_handle_present_deeplink",nZ,iZ),!a)return Promise.reject({message:HK.PresentDeepLinkT2Disabled});if(""===e)return Promise.reject({message:HK.EmptySearch});const r=new URLSearchParams(e),s=r.get("ver"),l=r.get("deeplinkId"),d=r.get("pptContext");if(o.infoToTelemetry?.(`Parsed params ver: ${s}, deeplinkId: ${l}`,"cmd_meetings_pptsharing_handle_present_deeplink",nZ,iZ),!s||!l||!d)return Promise.reject({message:HK.EmptyParsedUrlParams});let u;try{u=await i.mutate({mutation:tZ,variables:{ver:s,deeplinkId:l,pptContext:d}})}catch(e){throw o.errorToTelemetry?.(e.message,"cmd_meetings_pptsharing_handle_present_deeplink",nZ,iZ),new Error(e.message)}return u&&u.data&&!u.data.handlePresentDeepLink?Promise.resolve({entityCommand:{entity:{type:ke.ck.presentdeeplinknomeetingcontextdialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.standard}},metadata:{allowAnonymous:!1}}):void 0}},oZ=e=>{const[,,t,n]=e.pathname.split("/"),{users:i,withVideo:a}=(({searchParams:e})=>{const t=(e.get("users")||"").trim(),n="true"===(e.get("withVideo")||"").toLocaleLowerCase();if(0===t.length)return{users:[],withVideo:n};const i=t.split(",").filter(Boolean).map((e=>e.toLocaleLowerCase()));return{users:[...new Set(i)],withVideo:n}})(e);return{type:t,containerId:n,users:i,withVideo:a}},rZ={filter:"/l/call",execute:async({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n}})=>{const i=n.newLogger("[Calling][OnBeforeDeeplinkParsed][CallingDeeplink]","apps-calling"),{enableCallingDeeplink:a}=t.get(c.w.Calling),o=(0,CR.q)(e,t),{type:r,containerId:s,users:l,withVideo:d}=oZ(o),u=JSON.stringify({type:r,containerId:s,usersCount:l.length});if(!a||!(e=>{const{type:t,containerId:n,users:i}=oZ(e);return"call"===t&&"0"===n&&i.length>0})(o)){const e=`Skip rendering deeplink dialog: enableCallingDeeplink=${a}, infoFromUrl=${u}`;throw i.warnToTelemetry?.(e,"calling_deeplink_navigation",void 0,!0),new Error(e)}return i.infoToTelemetry?.(`Render deeplink dialog: infoFromUrl=${u}`,"calling_deeplink_navigation",void 0,!0),{entityCommand:{entity:{type:ke.ck.callingdeeplinkDialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.standard},entityOptions:{users:l,withVideo:d}},metadata:{allowAnonymous:!1}}}},sZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingHandleMeetingShareDeeplinkMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"handleShareDeeplinkToStage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"deeplinkId"},value:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}}},{kind:"Argument",name:{kind:"Name",value:"appContext"},value:{kind:"Variable",name:{kind:"Name",value:"appContext"}}}]}]}}]},lZ=void 0,cZ=!0,dZ={filter:"/l/meeting-share",execute:async({deeplinkUrl:{search:e},context:{coreSettings:t,loggerFactory:n,getUserContexts:i}})=>{const{enableDeepLinkShareExtensibleApp:a}=t.get(c.w.Calling),o=n.newLogger("[Calling][onBeforeDeeplinkParsed][/meeting-share]","apps-calling");o.infoToTelemetry?.(`enableDeepLinkShareExtensibleAppT2: ${a}. Parsing search length: ${e.length}`,"cmd_meetings_appsharing_handle_meetingshare_deeplink",lZ,cZ);const r=await i(),s=r[r.length-1].context.client;if(!a)return Promise.reject({message:HK.MeetingShareDeepLinkT2Disabled});if(""===e)return Promise.reject({message:HK.EmptyParsedUrlParams});const l=new URLSearchParams(e),d=l.get("deeplinkId"),u=l.get("appContext");if(o.infoToTelemetry?.(`Parsed params - deeplinkId: ${d}`,"cmd_meetings_appsharing_handle_meetingshare_deeplink",lZ,cZ),!d||!u)return o.errorToTelemetry?.(`Empty Params for either deeplinkId or AppContext -deeplinkId: ${d}`,"cmd_meetings_appsharing_handle_meetingshare_deeplink",lZ,cZ),Promise.reject({message:HK.EmptyParsedUrlParams});let m;try{m=await s.mutate({mutation:sZ,variables:{deeplinkId:d,appContext:u}})}catch(e){throw o.errorToTelemetry?.(e.message,"cmd_meetings_appsharing_handle_meetingshare_deeplink",lZ,cZ),new Error(e.message)}return m&&m.data&&!m.data.handleShareDeeplinkToStage?Promise.resolve({entityCommand:{entity:{type:ke.ck.presentdeeplinknomeetingcontextdialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.standard}},metadata:{allowAnonymous:!1}}):void 0}},uZ=[QK,ZK,{filter:e=>{if(!(e.pathname.startsWith(eZ)||e.pathname.startsWith("/v2"+eZ)))return!1;const t=new URLSearchParams(e.search).get("context");if(!t)return!1;try{const{IsBroadcastMeeting:e}=JSON.parse(t);return!e}catch(e){return!t.includes("IsBroadcastMeeting")}},execute:({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n},homeCloud:i})=>{const a=n.newLogger("[Calling][onBeforeDeeplinkParsed][/l/meetup-join]","apps-calling"),o=e=>{a.infoToTelemetry?.(`Legacy deeplink condition: ${e}`,"cmd_meeting_join",void 0,!1)},r=e=>{a.errorToTelemetry?.(`${e}`,"cmd_meeting_join_missing_data",void 0,!1)};o("Execution started");const s=decodeURIComponent(e.href),l=new URL(s),{pathname:d,search:u,origin:m}=l,{allowAnonymousMeetingJoin:p,enableDeeplinkFlushCommand:g,enableMcasForWeb:h}=t.get(c.w.Calling);if(a.log(`Parsing pathname: ${d}, search: ${u}, allowAnonymousMeetingJoin: ${p}`),!d)return Promise.reject({message:HK.EmptyDeeplinkUrl});const v=d.split(/[/?&]/),y=v.indexOf("meetup-join")+1,S=v[y],f=v[y+1],k=new URLSearchParams(u);k.set("anon","true");const C=k.get("context");if(!C)return Promise.reject({message:HK.EmptyContext});const b=k.get("pp"),{Tid:w,Oid:T,MessageId:I,prid:N,isPublic:A}=JSON.parse(C);if(w&&""!==w?"tenantId"===w&&r(`Literal tId parsing: ${C}`):r(`Empty tId parsing: ${C}`),!(S&&f&&w&&T)){const e=`${S?"":"empty-conversationId"} ${f?"":"empty-rootMessageId"} ${w?"":"empty-tenantId"} ${T?"":"empty-organizerId"}`;return a.infoToTelemetry?.(`Legacy deeplink condition Promise.reject(${e}).`,"cmd_meeting_join",void 0,!1),Promise.reject({message:HK.LegacyCoordinatesParse,reason:e})}let E;const F=GK(m,k);F&&(E=`${F}/_#${d}?${k.toString()}`),o(`deeplink origin present: ${!!F}`);const _={joinType:"Legacy",conversationId:S,messageId:I||f,rootMessageId:f,isChannel:"0"!==f,isAdhoc:!1,tenantId:w,organizerId:T,meetingCloud:YK(m,k,w,a),participantPin:b,registration:N?{participantRegistrationId:N,isPublicEvent:A||!1}:null},D=k.get("deeplinkId");a.log(`Resolving ${JSON.stringify(_)}`),o(`Requesting entity command. deeplinkId: ${D}`);const P=zK(!!g);return o(`Resolving legacy deeplink condition with coordinates. deeplinkId: ${D}`),Promise.resolve({entityCommand:{entity:{type:ke.ck.callingdeeplink,action:ke.SY.join,id:`${S}/${f}`},command:P,entityOptions:{deeplinkUrl:d,coordinates:_,directMeetingLink:E,homeCloud:i,deeplinkId:D,correlationId:k.get("correlationId")||void 0,context:k.get("ctx")||void 0,launchAgent:k.get("launchAgent")||void 0,laEntry:k.get("laEntry")||void 0,laExpId:k.get("laExpId")||void 0}},metadata:{allowAnonymous:h?qK(k,p,h):p||!1,tenantId:w,prioritizeUserContextId:"true"===k.get("prioritizeUserContextId")||void 0}})}},{filter:({pathname:e})=>e.startsWith("/meet/")||e.startsWith("/v2/meet/"),execute:({deeplinkUrl:{pathname:e,search:t,origin:n},context:{coreSettings:i,loggerFactory:a},homeCloud:o})=>{const r=a.newLogger("[Calling][onBeforeDeeplinkParsed][/meet]","apps-calling");r.infoToTelemetry?.("Meet deepling condition executed.","cmd_meeting_join",void 0,!1);const{allowAnonymousMeetingJoin:s,defaultAnonTenantId:l,enableDeeplinkFlushCommand:d,enableMcasForWeb:u}=i.get(c.w.Calling),{enableXboxWatchparties:m}=i.get(c.w.WindowsSignatureExperiences);if(r.log(`Parsing pathname: ${e}, search: ${t}, allowAnonymousMeetingJoin: ${s}`),!e)return Promise.reject({message:HK.EmptyDeeplinkUrl});const p=e.split(/[/?&]/),g=p.indexOf("meet"),h=p[g+1];if(!h||-1===g)return Promise.reject({message:HK.MeetingCodeParse});const v=new URLSearchParams(t);let y,S;v.set("anon","true");const f=GK(n,v);f&&(y=`${f}/_#${e}?${v.toString()}`,S=`${f}${e}${t}`);const k=v.get("deeplinkId");r.infoToTelemetry?.(`Requesting entity command. deeplinkId: ${k}`,"cmd_meeting_join",void 0,!1);const C=zK(!!d);return r.log(`Resolving ${h}`),r.infoToTelemetry?.(`Resolving meet deeplink condition, deeplinkId=${k}`,"cmd_meeting_join",void 0,!1),Promise.resolve({entityCommand:{entity:{type:ke.ck.callingdeeplink,action:ke.SY.join,id:h},command:C,entityOptions:{deeplinkUrl:e,coordinates:{joinType:"MeetingData",meetingData:{meetingCode:h,passcode:v.get("p"),meetingUrl:S},participantPin:v.get("pp"),isAdhoc:!1,meetingCloud:YK(n,v)},directMeetingLink:y,homeCloud:o,deeplinkId:k,correlationId:v.get("correlationId")||void 0,laEntry:v.get("laEntry")||void 0,laExpId:v.get("laExpId")||void 0,launchAgent:v.get("launchAgent")||void 0,context:v.get("ctx")||void 0,isWatchParty:"true"===v.get("isWatchParty")&&m}},metadata:{allowAnonymous:u?qK(v,s,u):s||!1,tenantId:l||void 0,prioritizeUserContextId:"true"===v.get("prioritizeUserContextId")||void 0}})}},aZ,{filter:"/convene/events",execute:({deeplinkUrl:{pathname:e,search:t,origin:n},context:{coreSettings:i,loggerFactory:a}})=>{const o=a.newLogger("[Calling][onBeforeDeeplinkParsed][events]","apps-calling"),{allowAnonymousMeetingJoin:r,enableMcasForWeb:s}=i.get(c.w.Calling);if(o.log(`Parsing pathname: ${e}, search: ${t}, allowAnonymousMeetingJoin: ${r}`),!e)return Promise.reject({message:HK.EmptyDeeplinkUrl});if(!e.startsWith("/convene/events"))return Promise.reject({message:HK.MeetingCodeParse});const l=new URLSearchParams(t);l.set("anon","true");const d=`${n}/_#${e}?${l.toString()}`,u=l.get("url");if(!u)return Promise.reject({message:HK.MeetingCodeParse});const m="true"===l.get("hidePrejoin"),p=new URL(u),h=Array.from(l.keys()).some((e=>"tenantid"===e.toLowerCase())),v=decodeURIComponent(p.pathname).split("/").find((e=>e.startsWith("19:")))??"",y=p.searchParams.get("context");if(!y)return Promise.reject({message:HK.MeetingCodeParse});const{Tid:S,Oid:f,prid:k}=JSON.parse(y),C=p.searchParams.get("displayName");return Promise.resolve({entityCommand:{entity:{type:ke.ck.events,action:ke.SY.join},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,layoutMode:Yt.Rm.standard,correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.CallingOnBeforeDeeplinkParsed}},entityOptions:{embedUrl:d,meetingUrl:u,threadId:v,messageId:"0",tenantId:S,organizerId:f,registrationId:k,displayName:C,shouldShowPrejoinScreen:!m}},metadata:{allowAnonymous:(s?qK(l,r,s):r||!1)&&h,tenantId:S}})}},rZ,dZ],mZ={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==ke.ck.callingdeeplink&&e.mainEntity?.type!==ke.ck.calls,shouldRestoreClientToEntities:e=>e.mainEntity?.type!==ke.ck.callingdeeplink&&e.mainEntity?.type!==ke.ck.calls};var pZ=n(925331),gZ=n(865561);const hZ={onEventReceived:({eventInput:e})=>{switch(e.event.type){case uq.mu.requestPersonMoreInfo:const t=e.event.data?.();return Promise.resolve({command:vq(t)});case Br.mu.showMonitor:return Promise.resolve({command:ee.showMonitor(e.event.data?.())});case Br.mu.closeMonitor:return Promise.resolve({command:ee.closeMonitor()});case Br.mu.hideMonitor:return Promise.resolve({command:ee.hideMonitor()});case Br.mu.unhideMonitor:return Promise.resolve({command:ee.unhideMonitor()});case pZ.mu.hideUbar:return Promise.resolve({command:ee.hideHeader()});case pZ.mu.unhideUbar:return Promise.resolve({command:ee.unhideHeader()});case gZ.z6.openDeeplinkStageConsentDialog:{const t=e.event.data?.();return Promise.resolve({command:Bu(t)})}case pZ.mu.hideThreadPane:return Promise.resolve({command:Js({commandSource:A.p.Calling})});case pZ.mu.toggleInfoPane:return vZ(e.event)}return Promise.resolve(void 0)}},vZ=e=>{if((e=>e.type===pZ.mu.toggleInfoPane)(e)){const t=e.data();if(t){const{source:e,showOption:n,id:i,isBYODAttendeeView:a,infoPaneType:o,action:r,callingIntentId:s,linkedEntityType:l="calls",didMeetingNotesAutoOpen:c,devicePanelOptions:d={useCall:!0},closedCaptionsOptions:u={allowTranslatedCaptions:!1},roomRemoteOptions:m,correlationId:p,startTimestamp:g,copilotOptions:h,chatByIdOptions:v,noLinkedEntity:y,platformTabOptions:S,yammerQnaOptions:f,videoeffectsOptions:k,videoEffectsMoreViewPlanelOptions:C}=t,b={...a&&{isBYODAttendeeView:a},...c&&{didMeetingNotesAutoOpen:c},..."devicesettings"===o&&{...d},..."cameraeffects"===o&&{...{commandSource:e}},..."roomremote"===o&&{...m},..."closedcaptionssettings"===o&&{...u},..."meetingcollaboration"===o&&{...h},...["chats"].includes(o)&&{...v},..."extensions"===o&&{...S},..."yammerqna"===o&&{...f},...["videoeffectsandsettings","videoeffectsandavatar"].includes(o)&&{...k},..."videoeffectsmoreview"===o&&{...C}};return Promise.resolve({command:ee.toggleEndRail({action:r||"view",entityOptions:b,id:i,source:e,showOption:n,type:o,correlationId:p,startTimestamp:g,...!y&&s&&{linkedEntity:{type:l,id:s}}})})}}return Promise.resolve(void 0)},yZ=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{criticalPhaseTimeout:i}=t.get(c.w.Calling);return e!==se.w.Main||n.registerAppPhase({phase:m.Jj.CRITICAL,signals:[Gz.m.CALLING_SCREEN_RENDERED],timeout:i||9e4}),n.appPhases};var SZ=n(401178),fZ=n(771767);const kZ=e=>{if(CZ(e))return wZ(e)?{subNavEntity:TZ(e),headerEntity:IZ(e),startEntity:NZ(e),mainEntity:AZ(e),endEntity:EZ(e)}:null},CZ=({layoutMode:e,entity:t,contextEntity:n})=>{const{action:i=null,type:a}={...t},o=[Yt.Rm.focus,Yt.Rm.standard].includes(e),r=[ke.ck.callingdeeplink,ke.ck.calls,ke.ck.callsmonitor,ke.ck.meetings,ke.ck.events,ke.ck.meetingcollaboration,ke.ck.meetingroomallinonecall,ke.ck.yammerqna].includes(a),s=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view,ke.SY.join],l=i&&s.includes(i)||a===ke.ck.callingdeeplink&&!i&&!!n;return!!(o&&r&&l)},bZ=[ke.ck.identity,ke.ck.tflfre],wZ=({contextEntity:e})=>!e||!bZ.includes(e.type),TZ=()=>null,IZ=({entity:e,contextEntity:t})=>e.type===ke.ck.callingdeeplink||e.type===ke.ck.events?t||null:e,NZ=()=>null,AZ=({entity:e,contextEntity:t})=>e.type===ke.ck.callingdeeplink&&t?.type===ke.ck.calls?t:e,EZ=({contextEntity:e})=>{const t=[ke.ck.byodchat,ke.ck.chats,ke.ck.chatthread,ke.ck.devicesettings,ke.ck.meetings,ke.ck.extensions,ke.ck.transcript,ke.ck.meetingdetails,ke.ck.roster,ke.ck.byodroster,ke.ck.breakoutroomspanel,ke.ck.yammerqna,ke.ck.accessibilitypanel,ke.ck.meetingcollaboration,ke.ck.closedcaptionssettings,ke.ck.videobackgrounds,ke.ck.extensibilityapppickercallingpanel,ke.ck.stagecustomizationpanel,ke.ck.roomremote,ke.ck.audiosettings,ke.ck.videoeffectsandsettings];return e&&e.action&&t.includes(e.type)||e?.action===ke.SY.info&&e?.type===ke.ck.calls||e?.action===ke.SY.health&&e?.type===ke.ck.calls?e:null},FZ=(e,t)=>e?.find((e=>e.breakpoint===t))?.width,_Z="41rem",DZ=(e,t)=>{return e?new Map([[fZ.cw.IS_GREATER_THAN_0,"32rem"],[fZ.cw.IS_AT_LEAST_1350,FZ(t,fZ.cw.IS_AT_LEAST_1350)??_Z],[fZ.cw.IS_AT_LEAST_2560,FZ(t,fZ.cw.IS_AT_LEAST_2560)??"47rem"],[fZ.cw.IS_AT_LEAST_3840,FZ(t,fZ.cw.IS_AT_LEAST_3840)??"72rem"]]):(n=_Z,new Map([[fZ.cw.IS_GREATER_THAN_0,n],[fZ.cw.IS_AT_LEAST_947,n],[fZ.cw.IS_AT_LEAST_1350,n],[fZ.cw.IS_AT_LEAST_1500,n]]));var n},PZ=({entity:e,coreSettings:t,themeOptions:n})=>{const{enableLightThemeSupport:i=!1,forceDisableTitleBar:a=!1,renderHeaderAtBottomForCalls:o=!1,enableSmartDeviceLayout:r=!1,monitorSlotPosition:s=SZ.K.BottomRight,allowMultipleCallingAlertBanners:l=!0}=t?.get(c.w.Calling)??{},{enableResponsiveMeetingRoomPanel:d,isNonInteractiveMeetingRoomPanel:u,meetingRoomPanelWidthOnLargeScreen:m}=t?.get(c.w.MeetingRoom)??{},{enableCollapsibleUbar:p=!1}=t?.get(c.w.Streaming)??{},g=new Set([ke.ck.calls,ke.ck.meetingroomallinonecall]),h=n?.isCallingWindowDarkTheme,v=u?DZ(!!d,m):void 0;if(e?.type===ke.ck.callsmonitor||e?.type===ke.ck.callingdialog)return{mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!!a,doesHeaderOverlapMain:!1,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!i||h,UNSAFE_enablePptProvider:!0}},headerEntity:{[se.w.HorizontalBar]:{slotHeightOverrides:"5.4rem",doesHeaderOverlapMain:!1,isBackgroundTransparent:!0}}};const y=!l;return{mainEntity:{[se.w.Main]:{forceDisableTitleBar:!!a,doesHeaderOverlapMain:!!p,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:e?.type!==ke.ck.yammerqna&&(!i||h),canOverrideMeetingTheme:!1,UNSAFE_enablePptProvider:e?.type!==ke.ck.yammerqna,disableNotificationsBanners:y}},headerEntity:{[se.w.HorizontalBar]:{slotHeightOverrides:"auto",doesHeaderOverlapMain:!!p,isBackgroundTransparent:!1,renderHeaderAtBottom:!(!o&&!r||void 0===e?.type||!g.has(e.type))}},endEntity:{[se.w.Rail]:{slotWidthOverrides:v,doesHeaderOverlapMain:e?.type===ke.ck.videobackgrounds,isBackgroundTransparent:!!e&&MZ.includes(e.type),isHideInfoPaneDisabled:!0}},monitorEntity:{[se.w.Monitor]:{areaRectangle:{height:"auto",position:s,width:"32rem"},draggableAreaHeight:"3.2rem"}}}},MZ=[ke.ck.videobackgrounds,ke.ck.videoeffectsandavatar,ke.ck.videoeffectscustomization,ke.ck.videoeffectsmoreview,ke.ck.stylemyroom,ke.ck.videoeffectsandsettings],RZ={id:"com.microsoft.teams.calling",name:"Calls",supportedEntities:[ke.ck.callingdeeplink,ke.ck.callingdeeplinkDialog,ke.ck.callingprotocoldeeplinkdialog,ke.ck.calls,ke.ck.callscontent,ke.ck.callsgallery,ke.ck.callsgalleryandcontent,ke.ck.meetingroomallinonecall,ke.ck.callsmonitor,ke.ck.cameraeffects,ke.ck.contentcamerasetup,ke.ck.callingalertdialog,ke.ck.callingdialog,ke.ck.callingbannernotification,ke.ck.callingconfirmdialog,ke.ck.unparkcalldialog,ke.ck.usermediadialog,ke.ck.devicesettings,ke.ck.audiosettings,ke.ck.notes,ke.ck.mediastreams,ke.ck.meetingdetails,ke.ck.meetings,ke.ck.meetingstream,ke.ck.roster,ke.ck.pstncallmedialog,ke.ck.videobackgrounds,ke.ck.stylemyroom,ke.ck.broadcastqna,ke.ck.transcript,ke.ck.shareMeetingInfo,ke.ck.stagecontent,ke.ck.systemlocationnotificationbanner,ke.ck.breakoutroomspanel,ke.ck.videoeffectscustomization,ke.ck.videoeffectsmoreview,ke.ck.videoeffectsandavatar,ke.ck.videoeffectsandsettings,ke.ck.windowingerrordialog,ke.ck.restartrecomendeddialog,ke.ck.interactionrequireddialog,ke.ck.stagingroomstartmeetingconfirmationdialog,ke.ck.stagingroomendmeetingconfirmationdialog,ke.ck.meshavatar,ke.ck.events,ke.ck.yammerqna,ke.ck.roomremote,ke.ck.accessibilitypanel,ke.ck.closedcaptionssettings,ke.ck.meetingcollaboration,ke.ck.presentdeeplinknomeetingcontextdialog,ke.ck.floatingmonitor,ke.ck.byodattendeewindow,ke.ck.stagecustomizationpanel,ke.ck.byodroster,ke.ck.extensibilityapppickercallingpanel,ke.ck.installsystemaudiodriver],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Modal,se.w.Rail,se.w.Monitor],windowFeatures:{otherEntityTypes:{minWidth:800,width:800,minHeight:670,height:600},[ke.ck.callingdialog]:{width:700,height:400,top:300,left:400,additionalFeatures:{transparent:"true"}},[ke.ck.callsmonitor]:{height:247,width:304,additionalFeatures:{alwaysOnTop:"true",resizable:"false",fullscreenable:"false",maximizable:"false",closable:"false",hideWindowControl:"true",frame:"false",contentprotection:"true",excludeWindowFromScreenSharing:"true",closeoverride:"true",visibleOnAllWorkspaces:"true",positionClientArea:"true"}},[ke.ck.byodattendeewindow]:{minWidth:100,width:800,minHeight:100,height:600,additionalFeatures:{contentprotection:"true",excludeWindowFromScreenSharing:"true"}}},shouldErrorOnEntityCommandTimeout:!0},xZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"triggerCallingToastAction"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"notificationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actionType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerCallingToastAction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"notificationId"},value:{kind:"Variable",name:{kind:"Name",value:"notificationId"}}},{kind:"Argument",name:{kind:"Name",value:"actionType"},value:{kind:"Variable",name:{kind:"Name",value:"actionType"}}}]}]}}]},LZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"fireCallingIntent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},OZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingMoveUpcomingMeetingToPastMeetingsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"moveUpcomingMeetingToPastMeetings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}]}]}}]},jZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingAbandonCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"abandonCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntentId"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntentId"}}},{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}}]}]}}]};var BZ=n(141685);const UZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingTriggerBannerActionMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"bannerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actionName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BannerAction"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerBannerAction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"bannerId"},value:{kind:"Variable",name:{kind:"Name",value:"bannerId"}}},{kind:"Argument",name:{kind:"Name",value:"actionName"},value:{kind:"Variable",name:{kind:"Name",value:"actionName"}}}]}]}}]},$Z={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingUpdateSsaDriverMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"requestSystemAudioDriverInstallation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}}]}]}}]},WZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingBroadcastRoleQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"joinId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"broadcast"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"roleHint"},value:{kind:"Variable",name:{kind:"Name",value:"roleHint"}}},{kind:"Argument",name:{kind:"Name",value:"joinId"},value:{kind:"Variable",name:{kind:"Name",value:"joinId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"userRole"}},{kind:"Field",name:{kind:"Name",value:"byoe"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}}]}},{kind:"Field",name:{kind:"Name",value:"streamResource"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"encoderSource"}}]}}]}}]}}]},VZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingCallByCallIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamsCallIdByCallId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callId"},value:{kind:"Variable",name:{kind:"Name",value:"callId"}}}]}]}}]},HZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingCallMeetingInfoQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callMeetingInfo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"organizerId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}}]}}]}}]},zZ=async(e,t,n,i)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:a}=e.coreSettings.get(c.w.Calling);if(a&&i.infoToTelemetry?.(`handleBroadcastCommand. correlationId=${t.command.correlation.id}`,"app_on_before_command_handled_info"),!t.entityOptions){const e="[handleDeeplink] No entity options";return i.error(e),Promise.reject(e)}const{coordinates:o,roleHint:r}=t.entityOptions,{callingIntent:s}=t.entityOptions,l=o||s.coordinates.legacyMeeting,{tenantId:d,organizerId:u,conversationId:m,messageId:p,broadcast:h}=l,{allowBroadcastProducerJoinsInT2:v}=e.coreSettings.get(c.w.Broadcast),y=`${d}__${u}__${m}__${p}`,S=await(async(e,t,n,i,a,o)=>{const r=e.newScenario(be.Cu.BroadcastResolveRole);r.appendEventData({correlationId:a});try{const{data:e}=await t.query({query:WZ,variables:{id:n,roleHint:i,joinId:a}});return o.log(`[getBroadcastRole] userRole: ${e.broadcast.userRole}`),r.stop({"Call.BroadcastRole":e.broadcast.userRole}),e.broadcast}catch(e){return o.log("[getBroadcastRole] error: broadcastRoleQuery failed"),r.fail({"Call.BroadcastRole":null,broadcastError:"broadcastRoleQuery failed"}),{userRole:"None",streamResource:null,byoe:null}}})(e.scenarioFactory,n,y,r,t.command.correlation.id,i),f=h?.role&&"None"!==h?.role?h?.role:S.userRole;return GZ(f,v||!1,e)?k(ke.ck.broadcastwebjoinnotsupporteddialog):YZ(S,f)?k(ke.ck.unsupporteddeeplinkdialog):qZ(f,v||!1)?(t.entity.type=ke.ck.callingdeeplink,t.entity.id=y,t.entityOptions={...t.entityOptions,coordinates:{...l,broadcast:{role:f}}},QZ(e,t,i)):{entity:{id:y,type:ke.ck.broadcasts,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus,correlation:t.command.correlation},entityOptions:{threadId:m,messageId:p,tenantId:d,organizerId:u}};function k(e){return i.infoToTelemetry?.(`[handleBroadcastMeetingRedirect] launch launchUnsupportedDeeplink with userRole - ${f} and correlationId ${t.command.correlation.id} succeeded`,"cmd_meetings_virtual_events_broadcast_trigger_unsupported_deeplink_dialog_success"),{...t,entity:{...t.entity,id:y,type:e,action:ke.SY.view},command:{...t.command,layoutMode:Yt.Rm.standard,stateTransition:g.Ar.extend,visibilityState:g.Rp.show}}}},qZ=(e,t)=>"Contributor"===e||"Producer"===e&&t,GZ=(e,t,n)=>{const i=n.platformService?.config.clientType===nt.sK.Web;return"Producer"===e&&(!t||i)||"Contributor"===e&&i},YZ=(e,t)=>!!e.byoe?.isEnabled&&null===e.streamResource?.encoderSource||"Contributor"!==t&&!!e.byoe?.isEnabled&&"teams"===e.streamResource?.encoderSource,QZ=async(e,t,n)=>{const{coordinates:i}=t.entityOptions,a=KJ.getDeeplinkEntityLocked(),{enableAppOnBeforeCommandHandledExtraTelemetry:o}=e.coreSettings.get(c.w.Calling);if(o&&n.infoToTelemetry?.(`handleLockedDeeplink. coordinates=${JSON.stringify(i)} - locked=${a}`,"app_on_before_command_handled_info"),a||!a&&KJ.getCallingAppEventsSubscribed())return KJ.getDeeplinkReady()&&(n.log("[handleDeeplink] awaiting getDeeplinkReady"),await KJ.getDeeplinkReady()),JZ(e,t,n);const{conversationId:r,rootMessageId:s}=i,l=`${r}/${s}`;if(!l){const e="[handleDeeplink] Deeplink entity cannot be locked because lockId is undefined";return n.error(e),Promise.reject(e)}return n.log("[handleDeeplink] lockDeeplinkEntity"),KJ.lockDeeplinkEntity(l),t},JZ=async(e,t,n)=>{const i=t.entityOptions,{coordinates:a,deeplinkId:o}=i,{enableAppOnBeforeCommandHandledExtraTelemetry:r}=e.coreSettings.get(c.w.Calling);r&&n.infoToTelemetry?.(`handleDeeplink. coordinates=${JSON.stringify(a)} - deeplinkId=${o} - correlationId=${t.command.correlation.id}`,"app_on_before_command_handled_info");const s=(0,he.iX)(a,o);return n.log("[handleDeeplink] triggering fireCallingIntent mutation"),e.client.mutate({mutation:LZ,variables:{callingIntent:s}}).then((()=>{n.log("[handleDeeplink] fireCallingIntent succeeded")})).catch((e=>(n.error(`failed to fireCallingintent with ${(0,et.y)(e)}`),Promise.reject(e))))},KZ=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},dataOptions:a},requestContext:o,requestContext:{client:r}}=e,{allowBroadcastPresenterJoinsInT2:s,allowBroadcastProducerJoinsInT2:l}=o.coreSettings.get(c.w.Broadcast),{enableMeetNowLinksReminder:d}=o.coreSettings.get(c.w.Host),{enableAppOnBeforeCommandHandledExtraTelemetry:u,enableSeamlessMeetNowLaunchFromOutlook:m}=o.coreSettings.get(c.w.Calling),p=o.loggerFactory.newLogger("CallingOnBeforeCommandHandled","apps-calling");mX(p,`CallingOnBeforeCommandHandled. type=${n} - action=${i} - correlationId=${t.command.correlation.id}`,!!u);const g=(t.entityOptions||{}).isBroadcastMeeting;if(aX(n,i,!!g))return lX(o,t,p);if(oX(n,i))return sX(o,t,p);if(((e,t)=>e===ke.ck.callingbannernotification&&t===ke.SY.join||e===ke.ck.systemlocationnotificationbanner&&t===ke.SY.view)(n,i))return((e,t)=>{const n=e.loggerFactory.newLogger("CallingBannerCommandHandler[handleBannerPrimaryAction]","apps-calling");if(!t.entityOptions){const e=`Error when handling banner's primary action, join click since entity options is undefined for entityId=${t.entity.id}, entityType=${t.entity.type} and entityAction=${t.entity.action}`;return n.error(e),Promise.reject(new Error(e))}return e.client.mutate({mutation:UZ,variables:{bannerId:t.entity.id,actionName:"PrimaryAction"}})})(o,t);if(((e,t)=>e===ke.ck.callingbannernotification&&t===ke.SY.delete)(n,i))return((e,t)=>{const n=e.loggerFactory.newLogger("CallingBannerCommandHandler[handleBannerDismiss]","apps-calling");if(!t.entityOptions){const e=`Error when handling banner dismiss since entity options is undefined for entityId=${t.entity.id}, entityType=${t.entity.type} and entityAction=${t.entity.action}`;return n.error(e),Promise.reject(new Error(e))}return e.client.mutate({mutation:UZ,variables:{bannerId:t.entity.id,actionName:"DismissAction"}})})(o,t);if(eX(n,i,!!g))return zZ(o,t,r,p);if(tX(n))return(async e=>{await e.mutate({mutation:$Z,variables:{context:"banner"}})})(r);if(iX(n,i)){const e=KJ.getDeeplinkEntityLocked();if(e||!e&&KJ.getCallingAppEventsSubscribed())return KJ.getDeeplinkReady()&&await(async e=>{e.log("[handleDeeplink] awaiting getDeeplinkReady"),await KJ.getDeeplinkReady()})(p),d&&await(async(e,t,n)=>e.mutate({mutation:OZ,variables:{id:n.entityOptions?.deeplinkId}}).catch((()=>(t.errorToTelemetry?.("[CallingToastActionMutationFailed] failed","calling_deeplink_navigation"),Promise.reject($t.n.CallingToastActionMutationFailed)))))(r,p,t),cX(o,t,p);if(t.entityOptions){const{coordinates:e,deeplinkUrl:n}=t.entityOptions;ZZ(p,t,!!u);let i=(0,BZ.KX)(e)?`${e.conversationId}/${e.rootMessageId}`:e.meetingData.meetingCode||(e.meetingData.meetingUrl?(e=>{const t=e.split(/[/?&]/);return t[t.indexOf("meet")+1]})(e.meetingData.meetingUrl):void 0);if(!i&&m&&(e=>!!e&&e.includes("meet/meet-now"))(n)&&(i=(0,E.v4)()),!i)return(e=>{const t="[handleDeeplink] Deeplink entity cannot be locked because lockId is undefined";return e.errorToTelemetry?.(t,"calling_deeplink_navigation"),Promise.reject(t)})(p);mX(p,`[handleDeeplink] lockDeeplinkEntity. lockId=${i} - correlationId=${t.command.correlation.id}`,!!u),KJ.lockDeeplinkEntity(i)}}return a&&XZ(n,i,a)?dX(a,s,l,r,t):Promise.resolve(t)},ZZ=(e,t,n)=>{const{directMeetingLink:i,...a}=t.entityOptions,o=KJ.getDeeplinkEntityLocked();mX(e,`shouldHandleDeeplink. coordinates=${JSON.stringify(a)}} - locked=${o} - correlationId=${t.command.correlation.id}`,!!n)},XZ=(e,t,n)=>!!nX(n)&&(!!n.toastId&&e===ke.ck.calls&&t===ke.SY.mutate&&"Unknown"!==n.actionType),eX=(e,t,n)=>(e===ke.ck.callingdeeplink||e===ke.ck.meetings)&&t===ke.SY.join&&n,tX=e=>e===ke.ck.installsystemaudiodriver,nX=e=>void 0!==e.toastId,iX=(e,t)=>e===ke.ck.callingdeeplink&&t===ke.SY.join,aX=(e,t,n)=>e===ke.ck.meetings&&t===ke.SY.join&&!n,oX=(e,t)=>e===ke.ck.meetings&&t===ke.SY.abandon,rX=(e,t)=>{const n=t?.command.correlation.deeplinkId;let i=n?e.findScenarioByNameAndId(be.Cu.FireCallingIntent,n):e.findScenario(be.Cu.FireCallingIntent);return i||(i=e.newScenario(be.Cu.FireCallingIntent),e.hoistScenarioToCore&&e.hoistScenarioToCore(i),i.appendEventData({commandSource:t?.command.correlation.source||"on-before-command-handled"})),i.clientId=i.id,i.appendEventData({secondaryCorrelationId:t?.command.correlation.id||n,context:t?.command.correlation.source}),i},sX=async(e,t,n)=>{const{entity:i,command:{correlation:{source:a}}}=t,o=i.id;mX(n,`[handleMeetingAbandon] abandoning join for callingIntentId: ${o}, reason=${a}`);const r=rX(e.scenarioFactory,t);try{await e.client.mutate({mutation:jZ,variables:{callingIntentId:o,reason:a}}),r.cancel({reason:a})}catch(e){mX(n,`[handleMeetingAbandon]: abandonCallingIntent mutation failed for callingIntentId: ${o}, error=${e}`,!1,!0),r.fail({reason:(0,et.y)(e)})}},lX=(e,t,n)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:i}=e.coreSettings.get(c.w.Calling),a=rX(e.scenarioFactory,t);if(mX(n,`handleMeetingJoin. correlationId=${t.command.correlation.id}`,!!i),!t.entityOptions||!t.entityOptions.callingIntent){const e=`entityOptions must be of type IMeetingJoinOptions. entity.id=${t.entity.id} - correlationId=${t.command.correlation.id} - source=${t.command.correlation.source}`;return mX(n,e,!!i,!0),a.cancel({reason:e}),Promise.reject(e)}const{callingIntent:o}=t.entityOptions,{correlation:r}=t.command;return a.mark(be.BQ.HandleMeetingJoin),mX(n,`[handleMeetingJoin] triggering fireCallingIntent mutation. correlationId=${r.id}`,!!i),uX(e,n,o,a,r.id)},cX=async(e,t,n)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:i}=e.coreSettings.get(c.w.Calling);mX(n,`handleDeeplink. correlationId=${t.command.correlation.id}`,!!i);const a=rX(e.scenarioFactory,t);if(a.mark(be.BQ.HandleDeeplink),!t.entityOptions){const e="[handleDeeplink] No entity options";return mX(n,e,!!i,!0),a.cancel({reason:e}),Promise.reject(e)}const{correlation:o}=t.command,r=t.entityOptions,{coordinates:s,deeplinkId:l,isWatchParty:d,homeCloud:u,correlationId:m,context:p,launchAgent:g,laEntry:h,laExpId:v}=r;let y;return y=d?(0,he.t5)(l):(0,he.iX)(s,l,u,m,p,g,h,v),mX(n,"[handleDeeplink] triggering fireCallingIntent mutation",!!i),uX(e,n,y,a,o.id)},dX=async(e,t,n,i,a)=>{const o=e,r=o.toastId,s=o.actionType;return s?"AcceptIncomingCallThroughPrejoin"===s&&t&&!n&&await(async(e,t)=>{if(!e||!t)return!1;const{data:n}=await t.query({query:VZ,variables:{callId:e}});if(!n||!n.teamsCallIdByCallId)return!1;const{data:i}=await t.query({query:HZ,variables:{id:n.teamsCallIdByCallId}});if(!i||!i.callMeetingInfo)return!1;const a=(0,zG.yr)(i.callMeetingInfo?.tenantId,i.callMeetingInfo?.organizerId,i.callMeetingInfo?.threadId,i.callMeetingInfo?.messageId),{data:o}=await t.query({query:WZ,variables:{id:a}});return"Producer"===o?.broadcast?.userRole})(o.callId,i)?Promise.resolve({...a,entity:{...a.entity,type:ke.ck.unsupporteddeeplinkdialog,action:ke.SY.view},command:{...a.command,layoutMode:Yt.Rm.standard,stateTransition:g.Ar.extend,visibilityState:g.Rp.show}}):i.mutate({mutation:xZ,variables:{notificationId:r,actionType:s}}).then((()=>{})).catch((()=>Promise.reject($t.n.CallingToastActionMutationFailed))):Promise.reject($t.n.CallsActionTypeToNotificationActionFailed)},uX=async(e,t,n,i,a)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:o}=e.coreSettings.get(c.w.Calling),r=gX(n);pX(r,i,a);const s={...r,scenarioCorrelationId:i.clientId};return i.mark(be.BQ.BeforeFireCallingIntent),e.client.mutate({mutation:LZ,variables:{callingIntent:s},context:{correlationId:a}}).then((()=>{mX(t,`fireCallingIntent succeeded. navigation_command correlationId=${a}`,!!o)})).catch((e=>{const n=`failed to fireCallingintent with ${(0,et.y)(e)}`;return mX(t,n,!!o,!0),i.fail({message:n}),Promise.reject(e)}))},mX=(e,t,n=!1,i=!1)=>{i?(e.error(t),n&&e.errorToTelemetry?.(t,"app_on_before_command_handled_info")):(e.log(t),n&&e.infoToTelemetry?.(t,"app_on_before_command_handled_info"))},pX=(e,t,n)=>{const i=e.coordinates,a=e.joinOptions?.meeting;return t.appendEventData({secondaryCorrelationId:n,context:e.joinOptions?.context||""}),a&&t.appendEventData({correlationId:a.correlationId||"",homeCloud:a.homeCloud||"",deeplinkId:a.deeplinkId||"",launchAgent:a.launchAgent||""}),i.legacyMeeting?t.appendEventData({threadId:i.legacyMeeting.conversationId,messageId:i.legacyMeeting.messageId,organizerId:i.legacyMeeting.organizerId,meetingTenantId:i.legacyMeeting.tenantId}):i.meetingData&&t.appendEventData({meetingCode:i.meetingData.meetingCode||""}),t},gX=e=>e.joinOptions?.meeting?{...e,joinOptions:{...e.joinOptions,meeting:{...e.joinOptions.meeting,correlationId:e.joinOptions.meeting.correlationId||e.joinOptions.meeting.deeplinkId||(0,E.v4)()}}}:e,hX=e=>{return t=e.entityCommand.entity.type,ke.ck.callingdialog===t&&(({requestContext:e,result:t})=>t===zS.Incomplete&&"main"===e.client.name&&e.error?.errorCode===k.Q.UserContextMismatch)(e);var t};var vX;!function(e){e.Success="Success",e.Failure="Failure"}(vX||(vX={}));const yX=[ke.ck.calls,ke.ck.callsgalleryandcontent,ke.ck.callscontent,ke.ck.callsgallery,ke.ck.meetingroomallinonecall,ke.ck.callsmonitor],SX=e=>{switch(e){case ke.ck.calls:return"CallingCallsCommandError";case ke.ck.callsgalleryandcontent:return"CallingCallsGalleryAndContentCommandError";case ke.ck.callscontent:return"CallingCallsContentCommandError";case ke.ck.callsgallery:return"CallingCallsGalleryCommandError";case ke.ck.meetingroomallinonecall:return"CallingMeetingRoomAllInOneCallCommandError";case ke.ck.callsmonitor:return"CallingCallsMonitorCommandError";default:return"UnknownCallingEntityCommandError"}},fX=[({type:e,correlation:t})=>e===ke.ck.breakoutroomspanel&&t.source===A.p.CallingAppEvent_NavigateToBreakoutRoomsPanel?{resolveEvent:!0}:void 0,({correlation:e})=>e.source===A.p.CallMonitor||e.source===A.p.ShareTray?{resolveEvent:!1}:void 0],kX=async e=>{const{entityCommand:{entity:{type:t,action:n},command:{visibilityState:i,correlation:a}},requestContext:{coreSettings:o,loggerFactory:r}}=e,s=r.newLogger("CallingApp[onCommandResult]","apps-calling"),{enableBlockUnsanctionedAppEventsResolution:l,enableCallingAppCommandResolvedHook:d,enableCallingAppEventLogging:u,enableDialogWindow:m,enableWindowingFailOnNonSuccess:p,commandingAbandonsToBePropagated:h}=o.get(c.w.Calling);if(!d)return;const v=fX.map((e=>e({type:t,action:n,visibilityState:i,correlation:a}))).find((e=>!!e));if(v)return!v.resolveEvent||CX(e,!!p,h);if(yX.includes(t)&&n===ke.SY.view){if(l&&!a.id.includes("calling-app-event")){const e=`CMD windowing triggered outside of calling app event. [correlationId:${a.id}, source:${a.source}, correlatedScenario:${a.scenarioName}]`;return void(u?s.errorToTelemetry?.(e,"cmd_horizontals_app_events",void 0,!0):s.warn(e))}if(s.log(`[onCommandResult] Windowing command with visibilityState: ${i}, correlation: ${a.id}, type: ${t}, action: ${n}`),i===g.Rp.show)return CX(e,!!p,h)}return m&&hX(e)?(async e=>{const{entityCommand:{entity:t,command:n,entityOptions:i},requestContext:{entityCommanding:a,scenarioFactory:o}}=e;if(!i)throw new Error("[handleDialogContainerCommand] Error no entityOptions");const{entity:r,command:s,options:l}=i;if(!t.id)throw new Error(`[handleDialogContainerCommand] Error no dialog id: [type: ${r.type}]`);const c=o.findScenarioByNameAndId(be.Cu.CallingDialogOpen,t.id);try{c?.mark(be.BQ.BeforeCallingDialogContainerCommandTriggered),await a.call.openDialog(r,s,l,{correlation:n.correlation,stateTransition:g.Ar.new,visibilityState:g.Rp.show})}catch(e){throw c?.fail({errors:`[handleDialogContainerCommand] Error calling dialog container command: [type: ${r.type}, dialogId: ${t.id}, error.name: ${e?.name}, error.message: ${e?.message}]`,errorCode:"dialog-container-commanding-error"}),new Error(`[handleDialogContainerCommand] Error calling dialog container command: [type: ${r.type}, dialogId: ${t.id}, error.name: ${e?.name}, error.message: ${e?.message}]`)}c?.mark(be.BQ.AfterCallingDialogContainerCommandTriggered)})(e):void 0},CX=async(e,t,n)=>{const{entityCommand:{entity:{id:i,type:a,action:o},command:{correlation:{id:r,source:s}}},result:l,requestContext:{client:c,loggerFactory:d,scenarioFactory:u,error:m}}=e,p=d.newLogger("CallingApp[onCommandResult]","apps-calling");let g,h;const v=m?.errorCode?.toString()||"";if(t&&n?.includes(v)?l!==zS.Success:l===zS.Failure){if(g=vX.Failure,yX.includes(a)&&o===ke.SY.view){const e=i?u.findScenarioByNameAndId(be.Cu.CallingWindowPopoutIntent,i):void 0;e?.mark("OnAfterCommandResolved"),e?.appendEventData({errorCode:m?.errorCode||SX(a),message:m?.errorMessage||"[onCommandResult] Window Rendering command for a call resulted in Failure or Incomplete.",context:"CallingApp"})}h=bX(g,r,i,a,o,s,m)}else g=vX.Success,h=bX(g,r,i,a,o,s);try{await JJ(h,c,p)}catch(m){throw p.error(`[handleCallingWindowingContentEvent] Error when reporting event "${g}" [entity.id=${i}, error.name=${m.name}, error.message=${m.message}]`),new Error(`onCommandResult[error.name=${m.name},error.message=${m.message}]::resolveCallingAppEvent::${g}`)}},bX=(e,t,n,i,a,o,r)=>{const s=`[eventId=${t}, entity.id=${n}, entity.type=${i}, entity.action=${a}]`;return e===vX.Success?{eventId:t,resolution:{success:{_:!0}},context:{source:{name:o,description:`[onCommandResult] entity command resolved successfully ${s}`}}}:{eventId:t,resolution:{error:{name:r?.errorCode||SX(i),message:`Error processing windowing command ${s} with [error.errorCode=${r?.errorCode}, error.message=${r?.errorMessage}]`}},context:{source:{name:o,description:`[onCommandResult] entity command resolved with an error ${s}`}}}};var wX=n(542930),TX=n(323321),IX=n(763588);const NX=(0,iG.O)({flexContainer:{mc9l5x:"ftgm304"}}),AX=({isHeader:e,enableCollapsibleUbar:t,children:n})=>{const i=(0,IX.useNovaEventing)(),a=NX(),o=Or.useCallback((e=>{i.bubble({reactEvent:e,event:pZ.AZ.unhideUbar()})}),[i]),r=Or.useCallback((e=>{i.bubble({reactEvent:e,event:pZ.AZ.hideUbar()})}),[i]);return(0,Lr.Y)(TX.s,{fill:!0,hAlign:"center",vAlign:"center",className:e?a.flexContainer:"",...t&&{onPointerLeave:e=>{r(e)},onPointerEnter:e=>{o(e)}},"data-testid":"embedded-events-layout-manager",children:n})},EX=e=>{const{entity:{type:t,action:n}}=e;if(t===ke.ck.calls&&n===ke.SY.view)return be.Cu.CallingEntityCommandCallsView};var FX=n(902376),_X=n(778012),DX=n(634563),PX=n(851075),MX=n(757060),RX=n(483330),xX=n(213991),LX=n(917120);const OX=(0,iG.O)({isWebCallMonitorWrapper:{Bqenvij:"fk3a66p",a9b677:"fly5x3f",Bgfg5da:0,B9xav0g:0,oivjwe:0,Bn0qgzm:0,B4g9neb:0,zhjwy3:0,wvpqe5:0,ibv6hh:0,u1mtju:0,h3c5rm:0,vrafjx:0,Bekrc4i:0,i8vvqc:0,g2u3we:0,icvyot:0,B4j52fo:0,irswps:"fl4qhfp"},isWebCallMonitorWrapperWithinMCM:{Bqenvij:"fk3a66p",a9b677:"fly5x3f"},isWebCallMonitorUbar:{a9b677:"fly5x3f",Bqenvij:"fyhdfh7"},isWebCallMonitorCallingScreen:{a9b677:"fly5x3f",Bqenvij:"f1l02sjl"}});var jX=n(129123);const BX=({ubar:e,callingScreen:t})=>{const n=(0,jX.w2)(c.w.Calling),i=OX(),{intentIdOverride:a}=(0,_X.ly)();return a?(0,Lr.Y)(TX.s,{"data-tid":"floating-call-monitor",column:!0,className:n.enableMultiCallMonitorForWeb?i.isWebCallMonitorWrapperWithinMCM:i.isWebCallMonitorWrapper,children:[(0,Lr.Y)(LX.s,{className:i.isWebCallMonitorUbar,children:e}),(0,Lr.Y)(LX.s,{className:i.isWebCallMonitorCallingScreen,children:t})]}):null},UX=({ubar:e,callingScreen:t})=>{const n=(0,jX.w2)(c.w.Calling),{id:i}=(0,FX.At)().getEntityOptions(ke.ck.floatingmonitor,ke.SY.view);return n.enableMultiCallMonitorForWeb?(0,Lr.Y)(TX.s,{"data-tid":"floating-monitor",column:!0,children:(0,Lr.Y)(BX,{ubar:e,callingScreen:t})}):(0,Lr.Y)(_X.LQ,{intentIdOverride:i,children:(0,Lr.Y)(TX.s,{"data-tid":"floating-monitor",column:!0,children:(0,Lr.Y)(BX,{ubar:e,callingScreen:t})})})},$X=(0,iG.O)({isWebMultiCallMonitorWrapper:{a9b677:"fly5x3f",Bqenvij:"f1l02sjl",Bgfg5da:0,B9xav0g:0,oivjwe:0,Bn0qgzm:0,B4g9neb:0,zhjwy3:0,wvpqe5:0,ibv6hh:0,u1mtju:0,h3c5rm:0,vrafjx:0,Bekrc4i:0,i8vvqc:0,g2u3we:0,icvyot:0,B4j52fo:0,irswps:"fl4qhfp"},isIconWrapper:{a9b677:"fly5x3f",Bqenvij:"f3ra7uv",De3pzq:"f1dmdbja",Brf1p80:"f4d9j23",Bt984gj:"f122n59"}});var WX=n(451281),VX=n(719156),HX=n(441161),zX=n(452025),qX=n(245434),GX=n(28544),YX=n(388593),QX=n(899273),JX=n(846716),KX=n(117528),ZX=n(775207);const XX=(0,iG.O)({isMultiCallListItemWrapper:{Bt984gj:"f122n59",a9b677:"fly5x3f",Bqenvij:"fyw3hzw",jrapky:"f1itd6yx",B6of3ja:"f10kaskc",De3pzq:"f1dmdbja",Byoj8tv:0,uwmqm3:0,z189sj:0,z8tnut:0,B0ocmuz:"f1lapy62"},isMultiCallListItemButtonContainer:{Brf1p80:"f9c4gz4",a9b677:"f43i5ed"},isResumeCallButton:{Jwef8y:"ftrin2t",ecr2s2:"fazgzzr",iro3zm:"ff7k10l",f5ssp4:"f1kntyx9"},isLeaveCallButton:{Jwef8y:"fpsin02",ecr2s2:"f1au4jtj",iro3zm:"fmvue4i",f5ssp4:"f1mcyvn2",t0hwav:"f14p701a",g1a405:"fabs2s9",B1wtsvt:["f13fn5ob","f757zx4"],dm7nc1:"f17rcxh0",n6tcun:["f757zx4","f13fn5ob"]},isStatusText:{sj55zd:"f11d4kpn"},isCallInfo:{Haddrg:"f14ujvnu",a9b677:"fr584hq",Frg6f3:["f9swhlu","f1wift5j"],t21cq0:["f1wift5j","f9swhlu"]},isCallTitle:{B68tc82:0,Bmxbyg5:0,Bpg54ce:"f1a3p1vp",Huce71:"fz5stix"}});var e0=n(761051);const t0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetCallTitleQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getCallTitle"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}]}]}}]},n0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetParticipantsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"participantCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nParticipants"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}},{kind:"Argument",name:{kind:"Name",value:"participantCount"},value:{kind:"Variable",name:{kind:"Name",value:"participantCount"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},i0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorToggleHoldCallMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NamedType",name:{kind:"Name",value:"ToggleHoldCallContext"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleHoldCall"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}},{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},a0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorStopCallMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"stopOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"StopOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stopCall"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callId"},value:{kind:"Variable",name:{kind:"Name",value:"callId"}}},{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}},{kind:"Argument",name:{kind:"Name",value:"stopOptions"},value:{kind:"Variable",name:{kind:"Name",value:"stopOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},{useState:o0,useEffect:r0,useCallback:s0}=Or,l0=({callId:e,callHeldAt:t,title:n,callState:i,extendedCallState:a,callStateTitle:o,isServerHold:r,failureType:s,showDuration:l})=>{const c=XX(),d=(0,JX.PO)(),u=s0((t=>(0,Lr.Y)(zX.E,{"data-testid":`multi-call-list-item-${e}-duration`,className:c.isStatusText,size:200,children:t})),[e,c.isStatusText]);return(0,Lr.Y)(TX.s,{className:c.isCallInfo,"data-testid":`multi-call-list-item-${e}-title`,column:!0,children:[(0,Lr.Y)(zX.E,{className:c.isCallTitle,size:300,children:n}),(0,Lr.Y)(TX.s,{"data-testid":`multi-call-list-item-${e}-status`,gap:"gap.small",children:[(0,Lr.Y)((()=>{if((0,e0.He)(a)||(0,e0.AY)(a))return(0,Lr.Y)(zX.E,{className:c.isStatusText,size:200,children:o});switch(i){case VX.CallState.LocalHold:case VX.CallState.RemoteHold:return(0,Lr.Y)(zX.E,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_hold_button_icon_label")});case VX.CallState.Disconnecting:case VX.CallState.Disconnected:return s===HX.D1.CallDropped?(0,Lr.Y)(zX.E,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_call_dropped")}):(0,Lr.Y)(zX.E,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_call_ended")});case VX.CallState.Observing:if(r)return(0,Lr.Y)(zX.E,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_hold_button_icon_label")})}return(0,Lr.Y)(wX.f,{})}),{}),l&&(0,Lr.Y)(KX.fX,{startedAt:t,render:u})]})]})},c0=({callId:e,title:t,disableMonitorSwitch:n,shouldShowResumeButton:i,leaveCall:a,toggleHoldResume:o})=>{const r=XX(),s=(0,JX.PO)(),{loggerFactory:{newLogger:l}}=(0,QX.ur)();return(0,Lr.Y)(TX.s,{className:r.isMultiCallListItemButtonContainer,gap:"gap.small",children:[(0,Lr.Y)(ZX.W,{panelRegion:GR.rP.multiCallMonitor,panelType:GR.HP.ResumeButton,newLogger:l,disableWrapper:!0,children:i&&(0,Lr.Y)(qX.$,{className:r.isResumeCallButton,"data-testid":`multi-call-list-item-${e}-resume-button`,icon:(0,Lr.Y)(DX.jGG,{filled:!0}),shape:"circular",appearance:"outline",disabled:n,title:s.stringTranslate("calling","resume_call_multi_call_title",{callTitle:t}),onClick:o})}),(0,Lr.Y)(ZX.W,{panelRegion:GR.rP.multiCallMonitor,panelType:GR.HP.LeaveButton,newLogger:l,disableWrapper:!0,children:(0,Lr.Y)(qX.$,{className:r.isLeaveCallButton,"data-testid":`multi-call-list-item-${e}-leave-button`,icon:(0,Lr.Y)(DX.G3f,{filled:!0}),shape:"circular",appearance:"outline",title:s.stringTranslate("calling","end_call_multi_call_title",{callTitle:t}),onClick:a})})]})},d0=({callId:e,teamsCallId:t,callState:n,extendedCallState:i,callOrigin:a,callStateTitle:o,failureType:r,isServerHold:s,callHeldAt:l,intentId:c,isCallingWindowVisible:d,disableMonitorSwitch:u,disableCallSwitchToggle:m})=>{const p=(0,PX.U)("MultiCallListItem"),g=XX(),{setIntentIdOverride:h,showCallWindow:v}=(0,_X.ly)(),[y,S]=o0(""),[f]=(0,WX.n)(i0,{fetchPolicy:"no-cache"}),[k]=(0,WX.n)(a0,{ignoreResults:!0,fetchPolicy:"no-cache"}),{data:C,loading:b,error:w}=(0,MX.I)(t0,{variables:{teamsCallId:t},fetchPolicy:"no-cache"}),{data:T,loading:I,error:N}=(0,MX.I)(n0,{variables:{teamsCallId:t,participantCount:2},fetchPolicy:"no-cache"}),A=s0((()=>{c?(m(!0),p.log(`ResumeCall triggered for call ${e}, teamsCallId ${t}`),f({variables:{teamsCallId:t}}).catch((t=>{p.error(`Error in toggleHoldCall [callId:${e}][error:${t}]`)})).finally((()=>{m(!1)})),h(c),d&&v(t)):p.error(`Intent id is undefined for call ${e}`)}),[e,m,c,d,p,h,v,t,f]);r0((()=>{b||(w?p.error(`Could not fetch call title for callId: ${e} - ${w.message}`):C?.getCallTitle?S(C.getCallTitle):p.log(`No call title found for callId: ${e} - ${C?.getCallTitle}`))}),[C,b,w,e,p]),r0((()=>{I||(N?p.error(`Could not fetch participants for callId: ${e} - ${N.message}`):T?.nParticipants||p.log(`No participants found for callId: ${e} - ${T?.nParticipants}`))}),[T,I,N,e,p]);return(0,Lr.Y)(TX.s,{className:g.isMultiCallListItemWrapper,"data-testid":`multi-call-list-item-${e}`,children:[(0,Lr.Y)(GX.j,{"aria-hidden":!0,"data-testid":`multi-call-list-item-${e}-avatar`,users:T?.nParticipants?.map((e=>({id:e.id,displayName:null})))||[],profilePictureSize:YX.xi.Large,showPresence:!1,isFocusable:!1,callerInfo:"multi-call-list-item"}),(0,Lr.Y)(l0,{callId:e,callHeldAt:l,title:y,callState:n,extendedCallState:i,callStateTitle:o,isServerHold:s,failureType:r,showDuration:(0,e0.nD)(n)&&!(0,e0.S1)(n)&&!(0,e0.AY)(i)&&!(0,e0.He)(i)}),(0,Lr.Y)(c0,{callId:e,title:y,disableMonitorSwitch:u,shouldShowResumeButton:!!((0,e0.nD)(n)&&i!==HX.Fo.Transferring&&i!==HX.Fo.TransferSucceeded&&i!==HX.Fo.Parking&&i!==HX.Fo.ParkSucceeded&&!(0,e0.pe)(a)||(0,e0.ST)(n,s)),leaveCall:async()=>{p.log(`LeaveCall triggered for call ${e}`);try{await k({variables:{callId:e,context:"multi-call-list-hangup_click",stopOptions:{forEveryone:!1,forAllUserEndpoints:!1}}})}catch(t){p.error(`Leave call failed for call ${e} - ${t.message}`)}},toggleHoldResume:A})]})};var u0=n(221427),m0=n(442107);const p0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetAllCallsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getAllCalls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallUpdateFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallMuteFragment"}}]}}]}},...u0.k.definitions,...m0.c.definitions]},g0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorCallCreatedRemovedUpdatedSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callCreatedRemovedUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallAdded"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallUpdateFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallMuteFragment"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallRemoved"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallUpdateFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallMuteFragment"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallUpdated"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallUpdateFragment"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallMuteUpdated"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonCallMuteFragment"}}]}}]}}]}}]}},...u0.k.definitions,...m0.c.definitions]};const h0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetRenderedCallQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getRenderedCallInCallingWindow"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingFields"}}]}}]}},...n(325180).s.definitions]},v0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorCallingWindowingContainerVisibilityEventForMultiCallMonitorSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingWindowingContainerVisibilityEventForMultiCallMonitor"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingWindowingContainerVisibilityEventForMultiCallMonitor"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isCallingWindowVisible"}}]}}]}}]}}]},y0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorIsCallingWindowVisibleQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isCallingWindowVisible"}}]}}]},{useState:S0,useEffect:f0,useCallback:k0}=Or,C0=({ubar:e,callingScreen:t})=>{const n=(0,PX.U)("MultiCallList"),i=$X(),{close:a,mounted:o,intentIdOverride:r,setIntentIdOverride:s}=(0,_X.ly)(),[l,c]=S0([]),[d,u]=S0(""),[m,p]=S0(!1),[g,h]=S0(!1),{data:v,loading:y,error:S}=(0,MX.I)(p0,{fetchPolicy:"no-cache"}),[f,{data:k,loading:C,error:b}]=(0,RX._)(h0,{fetchPolicy:"no-cache"}),{data:w,error:T}=(0,xX.R)(g0),{data:I,error:N}=(0,xX.R)(v0),A=k0((e=>{h(e)}),[]);f0((()=>{o("call-list"),f()}),[o,f]),f0((()=>{y||(S?n.error(`Could not fetch call details - ${S.message}`):v?.getAllCalls?(n.log(`Received ${v.getAllCalls.length} calls`),c([...v.getAllCalls])):n.log(`No calls found - ${v?.getAllCalls}`))}),[v,y,S,c,n]),f0((()=>{if(!C){if(b)return n.error(`Could not fetch rendered call details - ${b.message}`),void u("");if(!k?.getRenderedCallInCallingWindow)return n.log(`No rendered calls found - ${k?.getRenderedCallInCallingWindow}`),void u("");n.log(`Rendered call id is ${k.getRenderedCallInCallingWindow.callId}`),u(k.getRenderedCallInCallingWindow.callId)}}),[k,C,b,u,n]),(({logger:e,setIsCallingWindowVisible:t,getRenderedCall:n})=>{const{data:i,loading:a,error:o}=(0,MX.I)(y0,{fetchPolicy:"no-cache"});f0((()=>{a||(o?e.error(`Could not fetch calling window visibility - ${o.message}`):i&&0!==Object.keys(i).length?(e.log(`Calling window visibility is ${i.isCallingWindowVisible}`),i.isCallingWindowVisible&&n(),t(i.isCallingWindowVisible)):e.log("Calling window visibility not found"))}),[a,o,i,t,n,e])})({logger:n,setIsCallingWindowVisible:p,getRenderedCall:f}),f0((()=>{if(T)return void n.error(`Call subscription error - ${T.message}`);if(!w?.callCreatedRemovedUpdatedEvent?.call)return void n.log(`No calls found in the subscription - ${w?.callCreatedRemovedUpdatedEvent?.call}`);const e=w.callCreatedRemovedUpdatedEvent.call,t=w.callCreatedRemovedUpdatedEvent.__typename;n.log(`Call subscription received for call ${e.callId} and operation ${t}`);let i=[];switch(t){case"CallAdded":f(),i=[...l,e],c(i);break;case"CallRemoved":f();for(const t of l)t.callId!==e.callId&&i.push(t);0===i.length&&(n.log("Closing the call list"),a("call-list")),c(i);break;case"CallUpdated":for(const t of l)t.callId===e.callId?(t.state!==e.state&&f(),i.push({...t,...e})):i.push(t);c(i)}}),[w,T,c,n]),f0((()=>{N?n.error(`Calling window subscription error - ${N.message}`):I?.callingWindowingContainerVisibilityEventForMultiCallMonitor&&void 0!==I.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible&&null!==I.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible?(I.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible&&f(),p(I.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible)):n.log("Calling window visibility not found")}),[I,N,p,f,n]);const[E,F]=(({allCalls:e,isCallingWindowVisible:t,renderedCallId:n,ubar:i,callingScreen:a,disableMonitorSwitch:o,disableCallSwitchToggle:r,logger:s,intentIdOverride:l,setIntentIdOverride:c})=>{let d=0;return t&&1===e.length||0===e.length?(s.log(`CallList is empty - isCallingWindowVisible: ${t}, totalCallsCount - ${e.length}`),[null,0]):[(0,Lr.Y)(Or.Fragment,{children:e.map((e=>t&&e.callId===n?(s.log(`MultiCallList skipped displaying for a call with call id ${e.callId} and intent id ${e.intent?.id} because calling window visibility is ${t} and rendered call id is ${n}`),(0,Lr.Y)(wX.f,{},e.id)):(0,e0.mg)(e)?(s.log(`MultiCallListItem displayed for ${e.callId} with call state as ${e.state} and extended state as ${e.extendedCallState} with calling window visibility as ${t}`),d++,(0,Lr.Y)(d0,{callId:e.callId,teamsCallId:e.id,callState:e.state,extendedCallState:e.extendedCallState,callOrigin:e.callOrigin,callStateTitle:e.callStateProps?.title,failureType:e.failureType,isServerHold:e.isServerHold,callHeldAt:e.callHeldAt||void 0,intentId:e.intent?.id,isCallingWindowVisible:t,disableMonitorSwitch:o,disableCallSwitchToggle:r},e.id)):(0,e0.vS)(e)&&e.intent?.id?(s.log(`Call Monitor Window displayed for ${e.callId} with call state as ${e.state} and extended state as ${e.extendedCallState} with calling window visibility as ${t}`),d++,l!==e.intent?.id&&c&&c(e.intent.id),(0,Lr.Y)(UX,{ubar:i,callingScreen:a},e.id)):(s.log(`MultiCallList skipped displaying for call ${e.callId} with call state as ${e.state} and extended state as ${e.extendedCallState} with calling window visibility as ${t}`),(0,Lr.Y)(wX.f,{},e.id))))}),d]})({allCalls:l,isCallingWindowVisible:m,renderedCallId:d,ubar:e,callingScreen:t,disableMonitorSwitch:g,disableCallSwitchToggle:A,logger:n,intentIdOverride:r,setIntentIdOverride:s});return 0===F?(n.log("MultiCallList is hidden - callCountInSlotView - 0"),(0,Lr.Y)(wX.f,{})):(0,Lr.Y)(TX.s,{className:i.isWebMultiCallMonitorWrapper,"data-tid":"multi-call-list",column:!0,children:[(0,Lr.Y)(TX.s,{className:i.isIconWrapper,children:(0,Lr.Y)(DX.oj1,{filled:!0})}),E]})},b0=e=>{const t=(0,FX.At)(),{id:n}=t.getEntityOptions(ke.ck.floatingmonitor,ke.SY.view);return(0,Lr.Y)(_X.LQ,{intentIdOverride:n,children:(0,Lr.Y)(C0,{...e})})},w0=()=>Promise.all([n.e(912845),n.e(953696),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(185332),n.e(325670),n.e(501156),n.e(729849),n.e(736709),n.e(216284),n.e(817556),n.e(178249),n.e(354130),n.e(967653),n.e(289657),n.e(787389),n.e(293328),n.e(683932),n.e(131961),n.e(79899),n.e(11697),n.e(566555),n.e(280759),n.e(995752),n.e(980261),n.e(496740),n.e(315308),n.e(373760),n.e(597362),n.e(201694),n.e(372962),n.e(969644),n.e(295103),n.e(951958),n.e(101622),n.e(391935),n.e(788871),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(202564),n.e(977204),n.e(784980),n.e(562201),n.e(837284),n.e(8601),n.e(359033),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(813370),n.e(311576),n.e(679354),n.e(736704),n.e(463675),n.e(288919),n.e(615002),n.e(836301),n.e(840809),n.e(688782),n.e(544618),n.e(163525),n.e(317910),n.e(566999),n.e(461824),n.e(351057),n.e(972591),n.e(768173),n.e(189542),n.e(929679),n.e(887759),n.e(817372),n.e(543766),n.e(295578),n.e(737380),n.e(298265),n.e(289102),n.e(743566),n.e(655313),n.e(991974),n.e(957630),n.e(91961),n.e(495022),n.e(889780),n.e(558652),n.e(269797),n.e(574995),n.e(482974),n.e(581241),n.e(909548),n.e(564316),n.e(818879),n.e(412801),n.e(88186),n.e(371448),n.e(599866),n.e(817210),n.e(237447),n.e(700899),n.e(922831)]).then(n.bind(n,852349)),T0=()=>Promise.all([n.e(912845),n.e(953696),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(185332),n.e(325670),n.e(501156),n.e(729849),n.e(736709),n.e(216284),n.e(817556),n.e(178249),n.e(354130),n.e(967653),n.e(289657),n.e(787389),n.e(293328),n.e(683932),n.e(131961),n.e(79899),n.e(11697),n.e(566555),n.e(280759),n.e(995752),n.e(980261),n.e(496740),n.e(315308),n.e(373760),n.e(597362),n.e(201694),n.e(372962),n.e(969644),n.e(295103),n.e(951958),n.e(101622),n.e(391935),n.e(788871),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(202564),n.e(977204),n.e(784980),n.e(562201),n.e(837284),n.e(8601),n.e(359033),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(813370),n.e(311576),n.e(679354),n.e(736704),n.e(463675),n.e(288919),n.e(615002),n.e(836301),n.e(840809),n.e(688782),n.e(544618),n.e(163525),n.e(317910),n.e(566999),n.e(461824),n.e(351057),n.e(972591),n.e(768173),n.e(189542),n.e(929679),n.e(887759),n.e(817372),n.e(543766),n.e(295578),n.e(737380),n.e(298265),n.e(289102),n.e(743566),n.e(655313),n.e(991974),n.e(957630),n.e(91961),n.e(495022),n.e(889780),n.e(558652),n.e(269797),n.e(574995),n.e(482974),n.e(581241),n.e(909548),n.e(564316),n.e(818879),n.e(412801),n.e(88186),n.e(371448),n.e(599866),n.e(817210),n.e(237447),n.e(700899),n.e(922831)]).then(n.bind(n,205125)),I0=()=>Promise.all([n.e(912845),n.e(953696),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(185332),n.e(325670),n.e(501156),n.e(729849),n.e(736709),n.e(216284),n.e(817556),n.e(178249),n.e(354130),n.e(967653),n.e(289657),n.e(787389),n.e(293328),n.e(683932),n.e(131961),n.e(79899),n.e(11697),n.e(566555),n.e(280759),n.e(995752),n.e(980261),n.e(496740),n.e(315308),n.e(373760),n.e(597362),n.e(201694),n.e(372962),n.e(969644),n.e(295103),n.e(951958),n.e(101622),n.e(391935),n.e(788871),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(202564),n.e(977204),n.e(784980),n.e(562201),n.e(837284),n.e(8601),n.e(359033),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(813370),n.e(311576),n.e(679354),n.e(736704),n.e(463675),n.e(288919),n.e(615002),n.e(836301),n.e(840809),n.e(688782),n.e(544618),n.e(163525),n.e(317910),n.e(566999),n.e(461824),n.e(351057),n.e(972591),n.e(768173),n.e(189542),n.e(929679),n.e(887759),n.e(817372),n.e(543766),n.e(295578),n.e(737380),n.e(298265),n.e(289102),n.e(743566),n.e(655313),n.e(991974),n.e(957630),n.e(91961),n.e(495022),n.e(889780),n.e(558652),n.e(269797),n.e(574995),n.e(482974),n.e(581241),n.e(909548),n.e(564316),n.e(818879),n.e(412801),n.e(88186),n.e(371448),n.e(599866),n.e(817210),n.e(237447),n.e(700899),n.e(922831)]).then(n.bind(n,819867)),N0="calling-app-LPC",A0="calling-app",E0=async({appRenderMode:e,coreSettings:t,host:n,isHeader:i,isMainPanel:a,logger:o,onRenderEvent:r,scenarioFactory:s})=>{o.log(`renderWithLPC: import LPC: isMainPanel=${a} isHeader=${i}`);const l=(0,ev.wg)(I0,N0,s);if(e===se.w.Main){r("ChunkLoadStarted",{chunkName:N0});const{chunkLoadTimerPromise:e,chunkLoadTimer:s}=(({coreSettings:e,host:t})=>{let n=0;return{chunkLoadTimerPromise:new Promise(((i,a)=>{let{chunkLoadTimeout:o}=e.get(c.w.Calling);o||(o=Number.MAX_SAFE_INTEGER),n=t.setTimeout(a,o,(0,Je.$5)("CallingApp",d.O4.ChunkLoadTimedOut,"renderMain"))})),chunkLoadTimer:n}})({coreSettings:t,host:n});await Promise.race([l,e]).then((()=>clearTimeout(s))).catch((e=>{throw o.error(`renderWithLPC: ChunkLoadTimedOut: isMainPanel=${a} isHeader=${i}`),e})),r("ChunkLoadSucceeded",{chunkName:N0})}const{LPC:u}=await l;return o.log(`renderWithLPC: construct the slot element: isMainPanel=${a} isHeader=${i}`),u},F0=e=>{const{coreServices:t,host:n,isResize:i,entityType:a}=e,o=n?.screen;if(a===ke.ck.callsmonitor)return(({host:e,windowOptions:t,coreServices:{coreSettings:n}})=>{const i={...RZ.windowFeatures?.[ke.ck.callsmonitor]}??{},a={width:i.width||0,height:i.height||0};return t&&(a.width=t.width||a.width,a.height=t.height||a.height),!!n.get(c.w.Calling,["disableContentprotection"]).disableContentprotection&&i.additionalFeatures&&(i.additionalFeatures={...i.additionalFeatures,contentprotection:"false"}),e&&e.screen&&a.width&&a.height&&(i.top=0===t?.top||t?.top?t.top:e.screen.availHeight-(a.height+100),i.left=0===t?.left||t?.left?t.left:e.screen.availWidth-(a.width+100)),{...i,...a}})(e);if(a===ke.ck.byodattendeewindow)return(({entityOptions:e,coreServices:{coreSettings:t}})=>{const{minHeight:n,minWidth:i,additionalFeatures:a}=RZ.windowFeatures.byodattendeewindow||{};if(!e)return null;const o=JSON.parse(e).displayProperties,{disableContentprotection:r}=t.get(c.w.Calling,["disableContentprotection"]),{enableHideByodWindowFromSharePane:s}=t.get(c.w.BYOD,["enableHideByodWindowFromSharePane"]);return{additionalFeatures:{minHeight:`${n}`,minWidth:`${i}`,show:"false",contentprotection:r||!s?"false":`${a?.contentprotection}`,excludeWindowFromScreenSharing:s?`${a?.excludeWindowFromScreenSharing}`:"false"},height:o?.height,width:o?.width,fullScreen:!0,left:o?.x,top:o?.y,minHeight:n,minWidth:i}})(e);if(a===ke.ck.callingdialog)return(({host:e})=>{const t={...RZ.windowFeatures?.[ke.ck.callingdialog]}??{};return e&&e.screen&&(t.top=0,t.left=0,t.width=e.screen.width,t.height=e.screen.height),{...t}})(e);if(i&&!o)return RZ.windowFeatures.otherEntityTypes||null;if(!o)return null;let{height:r=1,width:s=1}=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=RZ.windowFeatures.otherEntityTypes||{};let{width:a,height:o}=RZ.windowFeatures.otherEntityTypes||{};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:d}=t.get(c.w.Calling);if(s&&l&&d)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=d*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/d*a}return{height:o,width:a}})(o,t.coreSettings);const l=o.availHeight-20,d=s>=o.availWidth||r>=l;d&&(r=o.availHeight,s=o.availWidth);const{left:u,top:m}=((e,t,n,i,a)=>{if(i)return{left:0,top:0};const o="availLeft"in e?e.availLeft:0,r="availTop"in e?e.availTop:0,s=o+e.availWidth/2-t/2;let l;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":l=r+a;break;default:l=r+e.availHeight/2-n/2}return{left:s,top:l}})(o,s,r,d,20),{minHeight:p,minWidth:g}=_0(r,s,t.coreSettings);return{additionalFeatures:{minHeight:`${p}`,minWidth:`${g}`},height:r,width:s,fullScreen:d,left:u,top:m,minHeight:p,minWidth:g}},_0=(e,t,n)=>{const{minHeight:i,minWidth:a}=RZ.windowFeatures.otherEntityTypes||{};let o=i,r=a;const{enableCallingWindowMinSizeAdjustment:s}=n.get(c.w.Calling);return s&&i&&a&&(o=Math.min(i,e),r=Math.min(a,t)),{minWidth:r,minHeight:o}},D0=async e=>{const{logger:t,scenarioFactory:n,isMainPanel:i,isHeader:a,isModal:o,onRenderEvent:r}=e;r("ChunkLoadStarted",{chunkName:A0}),t.log(`render: import the necessary subcomponents: isMainPanel=${i} isHeader=${a} isModal=${o}`);const[{CallingViewsRenderer:s},{CallingContextProvider:l}]=await Promise.all([(0,ev.wg)(w0,A0,n),(0,ev.wg)(T0,A0,n)]);return r("ChunkLoadSucceeded",{chunkName:A0}),{CallingViewsRenderer:s,CallingContextProvider:l}},P0=(e,t,n,i)=>t?(0,Lr.Y)(HG.TS,{conveneHostMessaging:i,children:(0,Lr.Y)(AX,{isHeader:e,enableCollapsibleUbar:t,children:n})}):(0,Lr.Y)(Or.Fragment,{children:n}),M0=async e=>{const{isMainPanel:t,isHeader:n,isModal:i,logger:a,coreSettings:o,conveneHostMessaging:r,appRenderMode:s}=e,{CallingViewsRenderer:l,CallingContextProvider:d}=await D0(e),{enableCollapsibleUbar:u}=o.get(c.w.Streaming);return a.log(`render: construct the slot element: isMainPanel=${t} isHeader=${n} isModal=${i}`),(0,Lr.Y)(L0,{children:(0,Lr.Y)(d,{children:P0(n,u||!1,(0,Lr.Y)(l,{isMainPanel:t,isHeader:n,isModal:i,appRenderMode:s}),r)})})},R0=async({appRenderMode:e,loggerFactory:t,host:n,scenarioFactory:i,...a})=>{if(e===se.w.HorizontalBar||e===se.w.Main){const o=t.newLogger("CallingApp","apps-calling"),r=e===se.w.HorizontalBar;return M0({isMainPanel:!0,isHeader:r,isModal:!1,logger:o,scenarioFactory:i,appRenderMode:e,host:n,...a})}return(0,Lr.Y)(wX.f,{})};function x0(e){return{eventHandlers:hZ,getAppPhases:yZ,getAppViewEntities:kZ,getAppViewEntitiesProps:PZ,getAppWindowFeatures:F0,getCommandScenarioName:EX,manifest:RZ,render:async({appRenderMode:t,entity:n,loggerFactory:i,...a})=>{const o=i.newLogger("CallingApp","apps-calling");if(n.type===ke.ck.floatingmonitor)return(async({loggerFactory:e,entity:t,appRenderMode:n,...i})=>{const a=i.coreSettings.get(c.w.Calling),[o,r]=await Promise.all([R0({appRenderMode:se.w.HorizontalBar,entity:t,loggerFactory:e,...i}),R0({appRenderMode:se.w.Main,entity:t,loggerFactory:e,...i})]);return a.enableMultiCallMonitorForWeb?(0,Lr.Y)(b0,{ubar:o,callingScreen:r}):(0,Lr.Y)(UX,{ubar:o,callingScreen:r})})({appRenderMode:t,entity:n,loggerFactory:i,...a});if(n.type===ke.ck.callsmonitor)return R0({appRenderMode:t,entity:n,loggerFactory:i,...a});if(t===se.w.HorizontalBar||t===se.w.Modal){const n=t===se.w.HorizontalBar,i=t===se.w.HorizontalBar,r=t===se.w.Modal;return M0({conveneHostMessaging:e,isMainPanel:n,isHeader:i,isModal:r,logger:o,appRenderMode:t,...a})}if(t===se.w.Main||t===se.w.Rail){const n=t===se.w.Main;return(async e=>{const{isMainPanel:t,isHeader:n,isModal:i,logger:a,coreSettings:o,conveneHostMessaging:r,scenarioFactory:s,appRenderMode:l}=e;s.startStep(be.Cu.WindowLaunchTime,be.BQ.LoadCallingViewsRendererAndContext);const{CallingViewsRenderer:d,CallingContextProvider:u}=await D0(e);a.log(`render: construct the slot element: isMainPanel=${t} isHeader=${n} isModal=${i}`);const{enableEntityMoreInfo:m=!1}=o.get(c.w.Core),{enableCollapsibleUbar:p}=o.get(c.w.Streaming);s.startStep(be.Cu.WindowLaunchTime,be.BQ.LoadLPCLoader);const g=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),h=m?g:await E0(e),v=m?g:wJ.CA;return s.startStep(be.Cu.WindowLaunchTime,be.BQ.RenderWithLPC),(0,Lr.Y)(L0,{children:(0,Lr.Y)(h,{children:(0,Lr.Y)(v,{children:(0,Lr.Y)(u,{children:P0(n,p||!1,(0,Lr.Y)(d,{isMainPanel:t,isHeader:n,isModal:i,appRenderMode:l}),r||HG.IP)})})})})})({conveneHostMessaging:e,isMainPanel:n,isHeader:!1,isModal:!1,appRenderMode:t,logger:o,...a})}return(0,Lr.Y)(wX.f,{})},onPreWarm:WK,onPreInit:VK,onBeforeAddToNavigation:mZ,onBeforeCommandHandled:KZ,onBeforeDeeplinkParsed:uZ,onCommandResult:kX}}const L0=({children:e})=>(0,Lr.Y)(vG.e,{namespaces:["calling","broadcast","extensibility","hololens","messaging","meetingOptions","datepicker"],loaderRenderer:null,children:e}),O0={id:"com.microsoft.teams.closedcaptionsflyout",name:"ClosedCaptionsApp",supportedEntities:[ke.ck.closedcaptionsflyout],supportedRenderModes:[se.w.Main],windowFeatures:{height:180,width:800,minWidth:800,additionalFeatures:{alwaysOnTop:"true",resizable:"true",fullscreenable:"false",maximizable:"true",closable:"true",frame:"false",contentprotection:"true",excludeWindowFromScreenSharing:"true"}}},j0=e=>{if(B0(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:U0(e),endEntity:null}},B0=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===ke.ck.closedcaptionsflyout,a=t===ke.SY.view;return Boolean(i&&a)},U0=({entity:e})=>e,$0=()=>({mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,isBackgroundTransparent:!0,disableBorderInHighContrast:!0}}}),W0={onEventReceived:({eventInput:e})=>{if(e.event.type===pZ.mu.toggleInfoPane)if(V0(e.event)){const t=e.event.data(),{action:n,infoPaneType:i,id:a,showOption:o,source:r,closedCaptionsOptions:s={allowTranslatedCaptions:!1},linkedEntityType:l="calls",correlationId:c,startTimestamp:d,callingIntentId:u}=t,m={..."closedcaptionssettings"===i&&{...s}};return Promise.resolve({command:ee.toggleEndRail({action:n||"view",entityOptions:m,id:a,source:r,showOption:o,type:i,correlationId:c,startTimestamp:d,...u&&{linkedEntity:{type:l,id:u}}})})}return Promise.resolve(void 0)}},V0=e=>e.type===pZ.mu.toggleInfoPane,H0=()=>Promise.all([n.e(912845),n.e(224316),n.e(914945),n.e(729849),n.e(492852),n.e(768553),n.e(311576),n.e(688782),n.e(544618),n.e(461824),n.e(768173),n.e(957630),n.e(371448),n.e(666743)]).then(n.bind(n,298267)),z0=({host:e})=>{const t=e?.screen;if(!t)return null;const n=(e=>{const{minHeight:t=0,minWidth:n=0}=O0.windowFeatures||{};let{width:i=n,height:a=t}=O0.windowFeatures||{};const o=.3*e.availWidth;return i=o>n?o:n,a=.33*i,{height:a,width:i}})(t),i=((e,t,n)=>{const i=e.availLeft||0,a=e.availTop||0,o=i+(e.availWidth||0)/2-t/2,r=a+.85*(e.availHeight||0)-n/2;return{left:(0,we.isNaN)(o)?0:o,top:(0,we.isNaN)(r)?900:r}})(t,n.width,n.height);return{additionalFeatures:{alwaysOnTop:"true",closable:"true",excludeWindowFromScreenSharing:"true",fullscreenable:"false",maximizable:"true",minimizable:"true",resizable:"true",movable:"true",frame:"false",contentprotection:"true",transparent:"true",visibleOnAllWorkspaces:"true",minWidth:"400",minHeight:"90"},top:i.top,left:i.left,width:n.width,height:n.height,minWidth:O0.windowFeatures.minWidth}};function q0(){const e=()=>null;return{eventHandlers:W0,getAppViewEntities:j0,getAppViewEntitiesProps:$0,getAppWindowFeatures:z0,manifest:O0,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===se.w.Main&&n===ke.ck.closedcaptionsflyout){const{FlyoutClosedCaptions:e}=await(0,ev.wg)(H0,"flyout-closed-captions-app",i);return(0,Lr.Y)(e,{})}return(0,Lr.Y)(e,{})}}}const G0={id:"com.microsoft.teams.campaign-notifications",name:"CampaignNotificationsApp",supportedEntities:[ke.ck.campaignnotifications],supportedRenderModes:[se.w.Main,se.w.HorizontalBar]},Y0=e=>{if(Q0(e))return J0(e)?{subNavEntity:K0(e),headerEntity:Z0(e),startEntity:X0(e),mainEntity:e1(e),endEntity:t1(e)}:null},Q0=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=Boolean(ke.ck.campaignnotifications===i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},J0=()=>!0,K0=()=>null,Z0=({entity:e})=>"whatsNewCampaign"===e.id?e:null,X0=()=>null,e1=({entity:e})=>e,t1=()=>null,n1=({appRenderMode:e})=>{const t=new qz.D,n=[],i=[],a={};if(e===se.w.Main)i1({criticalSignals:n,featureFlags:a,postCriticalSignals:i});return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:1e4}),t.appPhases},i1=({criticalSignals:e})=>{e.push(Gz.m.CAMPAIGN_VIEW_RENDERED)},a1=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(120951),n.e(984552),n.e(169767),n.e(914945),n.e(787454),n.e(181316),n.e(725973),n.e(984165),n.e(616161),n.e(231020),n.e(568721),n.e(524147),n.e(296930),n.e(354130),n.e(11697),n.e(5982),n.e(353927),n.e(506289),n.e(153959),n.e(411141),n.e(912200),n.e(183543),n.e(307422),n.e(94139),n.e(221963),n.e(652658),n.e(524014),n.e(625303),n.e(53966),n.e(405226),n.e(40459),n.e(715192),n.e(936254),n.e(684694),n.e(813370),n.e(391),n.e(233794),n.e(634370),n.e(639495),n.e(679611)]).then(n.bind(n,233165));function o1(){const e=()=>null;return{getAppPhases:n1,getAppViewEntities:Y0,manifest:G0,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main||t===se.w.HorizontalBar){const e="campaign-notifications";n("ChunkLoadStarted",{chunkName:e});const{CampaignNotifications:a}=await(0,ev.wg)(a1,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(a,{appRenderMode:t})}return(0,Lr.Y)(e,{})}}}const r1={id:"com.microsoft.teams.changeDefaultApp",name:"ChangeDefaultApp",supportedEntities:[ke.ck.fileopensettings],supportedRenderModes:[se.w.Modal]};var s1=n(49180);var l1;!function(e){e.DeepLinkNotEnabled="deeplink-not-enabled-error",e.MissingFileType="missing-fileType-error"}(l1||(l1={}));const c1=e=>{const{fileType:t,serviceName:n,context:i}=e;return Promise.resolve({entityCommand:{entity:{type:ke.ck.fileopensettings,action:ke.SY.update},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.ChangeDefaultAppDialog}},entityOptions:{fileType:t,serviceName:n,context:i}},metadata:{allowAnonymous:!1}})},d1=[{filter:"/l/change-file-open-preference",execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{if(!u1(t))return Promise.reject({message:l1.DeepLinkNotEnabled});const{entityOptions:n}=(e=>{const{searchParams:t}=e;return{entityOptions:{fileType:t.get("fileType")??"",serviceName:t.get("serviceName")??"",context:s1.ff.ns}}})(e);return n.fileType?c1(n):Promise.reject({message:l1.MissingFileType})}}],u1=e=>!!e?.get(c.w.Files).enableChangeDefaultAppDialogV2,m1=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(616161),n.e(487867),n.e(325670),n.e(501156),n.e(484331),n.e(736709),n.e(216284),n.e(636192),n.e(393706),n.e(79981),n.e(817556),n.e(280759),n.e(598200),n.e(506289),n.e(289847),n.e(153959),n.e(50150),n.e(834742),n.e(962777),n.e(458391),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(977204),n.e(784980),n.e(262010),n.e(725353),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(214467),n.e(679354),n.e(397928),n.e(463675),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(367831),n.e(233794),n.e(298265),n.e(195009),n.e(350226),n.e(764852),n.e(811969),n.e(446090),n.e(96657),n.e(599984)]).then(n.bind(n,410126));function p1(){const e=()=>null;return{manifest:r1,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{const o=a.newLogger("ChangeDefaultApp","apps-change-default-app");if(t===se.w.Modal){const e="change-default-app";o.log("chunk load start"),n("ChunkLoadStarted",{chunkName:e}),o.log("experimental import start");const{ChangeDefaultAppDialog:t}=await(0,ev.wg)(m1,e,i);return o.log("report chunk load success"),n("ChunkLoadSucceeded",{chunkName:e}),o.log("Rendering change default app dialog"),(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})},onBeforeDeeplinkParsed:d1}}var g1=n(405947),h1=n(797922),v1=n(88205),y1=n(886987),S1=n(989771),f1=n(945549);const k1=async(e,t)=>{const{enableSimpleCollabApp:n,enableSimpleCollabAppToggle:i,enableSimpleCollabAppSplitView:a}=t.get(c.w.SimpleCollab);if(n&&i){const{data:t}=await e.query({query:Mj.W,fetchPolicy:"cache-first"}),o=t?.userPreferencesForSimpleCollab;let r={};o&&"simpleCollabUserSettings"in o&&o.simpleCollabUserSettings&&(r=o.simpleCollabUserSettings);const s=(0,Pj.Dt)(!!n,!!i,!!a,r);return(0,Pt.AR)().setContext("UserInfo.NewChatAndChannelEnabled",s!==Pj.LS.none),(0,Pt.AR)().setContext("UserInfo.CollabAppEnabled",s===Pj.LS.unified),s}return Pj.LS.none},C1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"sendMessage"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SendMessageInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"action"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SendMessageAction"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sendMessage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}},{kind:"Argument",name:{kind:"Name",value:"message"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}},{kind:"Argument",name:{kind:"Name",value:"action"},value:{kind:"Variable",name:{kind:"Name",value:"action"}}},{kind:"Argument",name:{kind:"Name",value:"correlationId"},value:{kind:"Variable",name:{kind:"Name",value:"correlationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},b1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatChatHighlightsCommandOptionsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chatHighlightsDetailsCommandOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convId"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"lastMessageOriginalArrivalTime"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]},w1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatCopilotSynthesisCommandOptionsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"copilotSynthesisCommandOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convId"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]},T1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatNotifyActiveContextChangedMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activeContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activeContextType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveContextType"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notifyActiveContextChangedToCDLWorker"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activeContextId"},value:{kind:"Variable",name:{kind:"Name",value:"activeContextId"}}},{kind:"Argument",name:{kind:"Name",value:"activeContextType"},value:{kind:"Variable",name:{kind:"Name",value:"activeContextType"}}}]}]}}]};var I1=n(717828),N1=n(84646);const A1=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i,id:a},dataOptions:o,entityOptions:r},requestContext:s}=e,l=s.client,{enableChatEnablePolicyCheckForCommand:d}=s.coreSettings.get(c.w.Chat);if(d&&n===ke.ck.chats&&r&&"shouldCheckChatPolicy"in r&&r.shouldCheckChatPolicy&&(0,f1.Ws)(s.coreSettings.get(c.w.Messaging))===f1.zL.Disabled)return Promise.resolve(void 0);if($1(l,s.coreSettings,n,i,a),n===ke.ck.chatHighlightsDetails&&"chatHighlightsDetailsCoachmark"===a)return P1(l,t,s.loggerFactory);if(n===ke.ck.chatcopilotsynthesis&&"groupCopilotSynthesisCoachmark"===a)return M1(l,t,s.loggerFactory);const u=F1(t),m=_1(t),{enablePopoutAction:p}=s.coreSettings.get(c.w.ChatList);if(!u&&!m){const e=await k1(l,s.coreSettings),n=e!==Pj.LS.none,i=E1(n,p,e,t,r);if(i)return i}const{enableHandlingChatWithUsersCommand:h}=s.coreSettings.get(c.w.Chat);return(h||u)&&i===ke.SY.create&&n===ke.ck.chats?W1(l,r??{},t,a):(n===ke.ck.chats&&t.command.correlation.source===A.p.ChatQuotedReply&&(t.entityOptions=D1(t)),m&&p&&n===ke.ck.chats&&(t.command={...t.command,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus}),R1(l,o,t,n,i))},E1=(e,t,n,i,a)=>j1(i,e)?x1(i,n,a??{}):B1(i,e,t)?L1(i,n):void 0,F1=e=>e.entityOptions&&"isViewFromSimpleCollab"in e.entityOptions&&e.entityOptions.isViewFromSimpleCollab||!1,_1=e=>e.entityOptions&&"isViewFromM365ChatDeeplink"in e.entityOptions&&e.entityOptions.isViewFromM365ChatDeeplink||!1,D1=e=>({...e.entityOptions,isFromQuotedReply:!0}),P1=(e,t,n)=>{const i=n.newLogger("chatCopilotCoachmark","apps-chat");try{const n=e.readQuery({query:b1});if(!n?.chatHighlightsDetailsCommandOptions)throw new Error;{const{convId:e,lastMessageOriginalArrivalTime:a}=n.chatHighlightsDetailsCommandOptions;t.entity.id=e,t.entityOptions?t.entityOptions={...t.entityOptions,lastMessageOriginalArrivalTime:a}:t.entityOptions={lastMessageOriginalArrivalTime:a},i.log(`Received chat id: ${e} ${a}`)}}catch(e){return Promise.reject("handleChatHighlightsDetailsCoachmark: falied to get chat id")}return Promise.resolve(t)},M1=(e,t,n)=>{const i=n.newLogger("groupCopilotSynthesisCoachmark","apps-chat");try{const n=e.readQuery({query:w1});if(!n?.copilotSynthesisCommandOptions)throw new Error;{const{convId:e}=n.copilotSynthesisCommandOptions;t.entity.id=e,i.log(`Received chat id: ${e}`)}}catch(e){return Promise.reject("handleGroupCopilotSynthesisCoachmark: falied to get chat id")}return Promise.resolve(t)},R1=(e,t,n,i,a)=>t&&O1(i,a)?U1(t)&&t.convId&&t.message?e.mutate({mutation:C1,variables:{convId:t.convId,message:{clientMessageId:(0,I1.sN)(),messageType:N1.Go.HTML,content:t.message},action:"Create"}}).then((()=>{})).catch((()=>Promise.reject($t.n.ChatToastActionMutationFailed))):Promise.reject($t.n.ChatActionTypeToNotificationActionFailed):Promise.resolve(n),x1=(e,t,n)=>({...e,entity:{...e.entity,linkedEntity:{...e.entity.linkedEntity,id:e.entity.linkedEntity?.id||"",type:t===Pj.LS.split?ke.ck.simplecollabchats:ke.ck.simplecollab}},entityOptions:{...n}}),L1=(e,t)=>{const n=t===Pj.LS.split?ke.ck.simplecollabchats:ke.ck.simplecollab;return{...e,entity:{...e.entity,type:n}}},O1=(e,t)=>e===ke.ck.chats&&t===ke.SY.mutate,j1=(e,t)=>{if(!t||!e.entity.linkedEntity)return!1;const n=[ke.ck.chatManageApps];return["flush"].includes(e.command.stateTransition)&&n.includes(e.entity.type)&&e.entity.linkedEntity.type===ke.ck.chats&&e.entity.linkedEntity.action===ke.SY.list},B1=(e,t,n)=>{const i=["flow","none","extend"];return n&&i.push("new"),(!e.dataOptions||!U1(e.dataOptions))&&!(e.entity.type===ke.ck.simplecollab||!t||i.includes(e.command.stateTransition)||e.entity.linkedEntity&&e.entity.linkedEntity?.type===ke.ck.simplecollab)},U1=e=>"actionType"in e&&e.actionType===xt.quickReply,$1=(e,t,n,i,a)=>{t.get(c.w.CdlWorker).enableNotifyActiveContextChangedToCDLWorker&&a&&n===ke.ck.chats&&i===ke.SY.view&&e.mutate({mutation:T1,fetchPolicy:"no-cache",variables:{activeContextId:a,activeContextType:"chat"}})},W1=async(e,t,n,i)=>{try{const a=i?JSON.parse(i):[];if(0===a.length)return Promise.reject("handleChatWithUsersCommand: no user id passed");const o="groupName"in t?t.groupName:void 0,r="guardiansChatGroupId"in t?t.guardiansChatGroupId:void 0,s="guardiansChatStudentId"in t?t.guardiansChatStudentId:void 0,l="guardiansPreferredToAlternateMriMappings"in t?t.guardiansPreferredToAlternateMriMappings:void 0,c="isGuardiansChat"in t?t.isGuardiansChat:void 0,{query:d,options:u}=V1(a,!!c,r,s,l,o),{data:m}=await e.query({query:d,...u}),p=H1(m);if(!p)return Promise.reject(`handleChatWithUsersCommand: not find conversation - ${i}`);const g={...n,entity:{...n.entity,id:p,action:ke.SY.view},entityOptions:{...n.entityOptions,focusOnLoad:Bt.I.Compose}};return Promise.resolve(g)}catch(e){return Promise.reject(`handleChatWithUsersCommand: failed to handle chat with user command - ${i}`)}},V1=(e,t,n,i,a,o)=>{let r,s;return 1===e.length&&!t?(r=v1.h,s={userId:e[0],createLieIfNotFound:!0}):t?(r=y1.l,s={studentId:i,teamId:n,guardians:e,topicName:o,preferredToAlternateMriMappings:a}):(r=S1.J,s={userIds:e,createLieIfNotFound:!0,topicName:o}),{query:r,options:{variables:s,fetchPolicy:"network-only"}}},H1=e=>{if(!e)return;let t;return"chatWithUser"in e&&e.chatWithUser?t=e.chatWithUser.id:"chatsWithUsers"in e&&e.chatsWithUsers&&e.chatsWithUsers.length>0?t=e.chatsWithUsers[0].id:"chatsWithGuardians"in e&&e.chatsWithGuardians&&e.chatsWithGuardians.length>0&&(t=e.chatsWithGuardians[0].id),t},z1=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(984165),n.e(616161),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(736709),n.e(306517),n.e(216284),n.e(636192),n.e(964401),n.e(231020),n.e(811751),n.e(405198),n.e(393706),n.e(568721),n.e(524147),n.e(845039),n.e(79981),n.e(258832),n.e(431784),n.e(964859),n.e(817556),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(122814),n.e(300954),n.e(194894),n.e(286993),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(613193),n.e(181780),n.e(773977),n.e(862449),n.e(57789),n.e(92198),n.e(739085),n.e(721630),n.e(867826),n.e(346069),n.e(46438),n.e(187739),n.e(92464),n.e(131961),n.e(79899),n.e(249917),n.e(20275),n.e(11697),n.e(187257),n.e(164734),n.e(56538),n.e(737305),n.e(655224),n.e(995752),n.e(849095),n.e(677912),n.e(145619),n.e(506289),n.e(899628),n.e(108827),n.e(496740),n.e(328452),n.e(791296),n.e(153959),n.e(20504),n.e(843087),n.e(373760),n.e(814583),n.e(36015),n.e(411141),n.e(372583),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(784980),n.e(938671),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(601715),n.e(652658),n.e(174155),n.e(783354),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(53131),n.e(214467),n.e(813370),n.e(478723),n.e(311576),n.e(679354),n.e(736704),n.e(397928),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(892960),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(708241),n.e(568202),n.e(875113),n.e(478040),n.e(391700),n.e(672666),n.e(240991),n.e(366328),n.e(328231),n.e(566999),n.e(391),n.e(25522),n.e(465160),n.e(400003),n.e(602692),n.e(868389),n.e(768173),n.e(310015),n.e(189542),n.e(569243),n.e(171868),n.e(275243),n.e(800350),n.e(216843),n.e(104945),n.e(233794),n.e(40823),n.e(746071),n.e(515758),n.e(944191),n.e(543766),n.e(707334),n.e(737380),n.e(639495),n.e(428434),n.e(528699),n.e(91961),n.e(687341),n.e(499675),n.e(410557),n.e(755399),n.e(914022),n.e(155688),n.e(945565),n.e(198787),n.e(643059),n.e(460759),n.e(638241),n.e(500179)]).then(n.bind(n,519495)),q1=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(984165),n.e(616161),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(736709),n.e(306517),n.e(216284),n.e(636192),n.e(964401),n.e(231020),n.e(811751),n.e(405198),n.e(393706),n.e(568721),n.e(524147),n.e(845039),n.e(79981),n.e(258832),n.e(431784),n.e(964859),n.e(817556),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(122814),n.e(300954),n.e(194894),n.e(286993),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(613193),n.e(181780),n.e(773977),n.e(862449),n.e(57789),n.e(92198),n.e(739085),n.e(721630),n.e(867826),n.e(346069),n.e(46438),n.e(187739),n.e(92464),n.e(131961),n.e(79899),n.e(249917),n.e(20275),n.e(11697),n.e(187257),n.e(164734),n.e(56538),n.e(737305),n.e(655224),n.e(995752),n.e(849095),n.e(677912),n.e(145619),n.e(506289),n.e(899628),n.e(108827),n.e(496740),n.e(328452),n.e(791296),n.e(153959),n.e(20504),n.e(843087),n.e(373760),n.e(814583),n.e(36015),n.e(411141),n.e(372583),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(784980),n.e(938671),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(601715),n.e(652658),n.e(174155),n.e(783354),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(53131),n.e(214467),n.e(813370),n.e(478723),n.e(311576),n.e(679354),n.e(736704),n.e(397928),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(892960),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(708241),n.e(568202),n.e(875113),n.e(478040),n.e(391700),n.e(672666),n.e(240991),n.e(366328),n.e(328231),n.e(566999),n.e(391),n.e(25522),n.e(465160),n.e(400003),n.e(602692),n.e(868389),n.e(768173),n.e(310015),n.e(189542),n.e(569243),n.e(171868),n.e(275243),n.e(800350),n.e(216843),n.e(104945),n.e(233794),n.e(40823),n.e(746071),n.e(515758),n.e(944191),n.e(543766),n.e(707334),n.e(737380),n.e(639495),n.e(428434),n.e(528699),n.e(91961),n.e(687341),n.e(499675),n.e(410557),n.e(755399),n.e(914022),n.e(155688),n.e(945565),n.e(198787),n.e(643059),n.e(460759),n.e(638241),n.e(500179)]).then(n.bind(n,819867)),G1=({action:e,appRenderMode:t,coreSettings:n,type:i})=>{const a=new qz.D,{isHeaderDisabled:o=!1}=n.get(c.w.Core),{chatAppPhaseTimeouts:r,enableComposeCriticalPhaseLoad:s=!1,enableComposeCriticalPhaseLoadSecondaryViewport:l=!1,enableComposeCriticalPhaseLoadSecondaryViewportGate:d=!1}=n.get(c.w.Messaging),u=[],p=[];switch(t){case se.w.HorizontalBar:Y1({criticalSignals:u,featureFlags:{isHeaderDisabled:o},postCriticalSignals:p,type:i});break;case se.w.Main:Q1({action:e,criticalSignals:u,featureFlags:{enableComposeCriticalPhaseLoad:s},postCriticalSignals:p,type:i});break;case se.w.Rail:J1({action:e,criticalSignals:u,featureFlags:{enableComposeCriticalPhaseLoad:s,enableComposeCriticalPhaseLoadSecondaryViewport:l,enableComposeCriticalPhaseLoadSecondaryViewportGate:d},postCriticalSignals:p,type:i})}return a.registerAppPhase({phase:m.Jj.CRITICAL,signals:u,timeout:r?.critical||6e4}),a.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:p,timeout:r?.postCritical||1e4}),a.appPhases},Y1=({featureFlags:{isHeaderDisabled:e},criticalSignals:t,postCriticalSignals:n})=>{!e&&t.push(Gz.m.CHAT_HEADER_TITLE_RENDERED),!e&&n.push(Gz.m.CHAT_HEADER_BUTTONS_RENDERED)},Q1=({action:e,criticalSignals:t,featureFlags:{enableComposeCriticalPhaseLoad:n},postCriticalSignals:i})=>{if(e===ke.SY.join)return;t.push(Gz.m.MESSAGES_RENDERED);const a=n;a&&t.push(Gz.m.COMPOSE_LOADED),i.push(Gz.m.MESSAGE_REACTIONS_RENDERED,Gz.m.PRESENCES_RENDERED,Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED),!a&&i.push(Gz.m.COMPOSE_LOADED)},J1=({action:e,criticalSignals:t,featureFlags:{enableComposeCriticalPhaseLoad:n,enableComposeCriticalPhaseLoadSecondaryViewport:i,enableComposeCriticalPhaseLoadSecondaryViewportGate:a},postCriticalSignals:o,type:r})=>{if(e===ke.SY.list)t.push(Gz.m.CHAT_LIST_ITEMS_RENDERED),o.push(Gz.m.PRESENCES_RENDERED);else if(e===ke.SY.view){t.push(Gz.m.MESSAGES_RENDERED);const e=a&&i,s=r!==ke.ck.byodchat&&(n||e);s&&t.push(Gz.m.COMPOSE_LOADED),o.push(Gz.m.MESSAGE_REACTIONS_RENDERED,Gz.m.PRESENCES_RENDERED,Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED),s||r===ke.ck.byodchat||o.push(Gz.m.COMPOSE_LOADED)}else r===ke.ck.chatthread&&e===ke.SY.info&&(t.push(Gz.m.MESSAGES_RENDERED,Gz.m.COMPOSE_LOADED),o.push(Gz.m.MESSAGE_REACTIONS_RENDERED,Gz.m.PRESENCES_RENDERED,Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED))},K1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"discardDuringMeetingsAndCalls"}},{kind:"Field",name:{kind:"Name",value:"interopConversationStatus"}},{kind:"Field",name:{kind:"Name",value:"members"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"givenName"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarETag"}}]}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"messagePreviewTemplateOption"}},{kind:"Field",name:{kind:"Name",value:"parentEntityTitle"}},{kind:"Field",name:{kind:"Name",value:"reaction"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderSurname"}},{kind:"Field",name:{kind:"Name",value:"senderId"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"tabId"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"topic"}},{kind:"Field",name:{kind:"Name",value:"translatedPreview"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"activityId"}},{kind:"Field",name:{kind:"Name",value:"isFromPriorityContact"}},{kind:"Field",name:{kind:"Name",value:"isUrgent"}},{kind:"Field",name:{kind:"Name",value:"isTextMessageVisible"}},{kind:"Field",name:{kind:"Name",value:"externalAppIcon"}},{kind:"Field",name:{kind:"Name",value:"isThreadMessage"}}]}}]}}]};var Z1,X1;!function(e){e.GroupMessage="GroupMessage",e.Message="Message",e.ForwardMessage="ForwardMessage",e.Mention="Mention",e.Reply="Reply",e.Reaction="Reaction",e.InviteJoined="InviteJoined",e.TeamsTasks="TeamsTasks",e.Reminder="Reminder",e.Priority="Priority",e.DLP="DLP",e.RecordingUploadFailed="RecordingUploadFailed",e.ChannelRecordingUploadFailed="ChannelRecordingUploadFailed",e.UserContact="UserContact"}(Z1||(Z1={})),function(e){e.Small="HR64x64"}(X1||(X1={}));var e4=n(774886);const t4={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"msaUserProfilePicture"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},n4={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}}]}}]},i4={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatChatQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}}]},a4={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"msaGroupProfilePicture"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MsaGroupProfilePictureInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaGroupProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"msaGroupInfo"},value:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]},o4={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"toastImageAsDataUri"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]},r4={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatEmoticonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchEmoticons"},arguments:[{kind:"Argument",name:{kind:"Name",value:"searchFilter"},value:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}}},{kind:"Argument",name:{kind:"Name",value:"exactMatch"},value:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}}},{kind:"Argument",name:{kind:"Name",value:"includeShortCuts"},value:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}}},{kind:"Argument",name:{kind:"Name",value:"includeKeywords"},value:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}}},{kind:"Argument",name:{kind:"Name",value:"maxResultCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}}},{kind:"Argument",name:{kind:"Name",value:"categoryId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsChatEmoticonFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsChatEmoticonFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Emoticon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"unicode"}},{kind:"Field",name:{kind:"Name",value:"animation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsChatEmoticonFragment_animation"}}]}},{kind:"Field",name:{kind:"Name",value:"etag"}},{kind:"Field",name:{kind:"Name",value:"diverse"}},{kind:"Field",name:{kind:"Name",value:"shortcuts"}},{kind:"Field",name:{kind:"Name",value:"searchMatch"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsChatEmoticonFragment_animation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmoticonAnimation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fps"}},{kind:"Field",name:{kind:"Name",value:"framesCount"}},{kind:"Field",name:{kind:"Name",value:"firstFrame"}}]}}]}.definitions]}.definitions]};var s4=n(800079),l4=n(673040),c4=n(715871),d4=n(15774);function u4(e,t,n){let i=e.senderGivenName||e.senderDisplayName;if(i||(n.mark(be.BQ.AssignedUnknownUserNameToChatToast),i=v4(t)),e.subtype)return t.stringTranslate("toastNotifications","new_task_list_added_toast_title",{sender:i})}function m4(e,t,n){const i=function(e,t,n){const i=t.topic;if(i)return i;if(!t.members?.length)return;return W4(e,t.members,n)?.displayName}(e,t,n);return t.subtype===d4.pz.tFLPlanCreated&&i&&t.text?e.stringTranslate("toastNotifications","task_list_in_group_chat_added_text",{groupChatTitle:i,taskListTitle:t.text}):t.text||void 0}function p4(e,t,n,i){const{enableInviteeJoinedActivity:a}=n.get(c.w.Activity),o=h4(e,a?t.senderDisplayName:t.senderGivenName,i);return e.stringTranslate("toastNotifications",a?"toast_invite_joined_with_activity_feed_title":"toast_invite_joined",{sender:o})}function g4(e,t,n,i,a){const{enableInviteeJoinedActivity:o}=i.get(c.w.Activity);if(o){const t=h4(e,n.senderDisplayName,a);return e.stringTranslate("toastNotifications","toast_invite_joined_with_activity_feed_text",{sender:t})}return n.members&&n.members.length?t(e,n,a,i):void 0}function h4(e,t,n){return t||(n.mark(be.BQ.AssignedUnknownUserNameToTFLtToast),v4(e))}function v4(e){return e.stringTranslate("toastNotifications","toast_unknown_user")}var y4=n(598569),S4=n(328984),f4=n.n(S4),k4=n(653948),C4=n(860643),b4=n(944297),w4=n(643502);function T4(e){return e===N1.$y.AcceptPending||e===N1.$y.ExtendedDirectoryAcceptPending}function I4(e,t){const{enableObscuringOfTextForNewChatRequestInToastNotification:n}=t.get(c.w.Notifications);return Boolean(n)&&T4(e)}async function N4(e,t,n,i){const{enableInAppNotificationsForChatsAndChannels:a}=i.get(c.w.Notifications,["enableInAppNotificationsForChatsAndChannels"]),{enableCustomNotificationsForChats:o}=i.get(c.w.Core,["enableCustomNotificationsForChats"]);try{const r=!a&&!o;if(I4(n.interopConversationStatus,i))return t.log(`${$t.n.ReturningHardcodedImage} Returning default group message avatar for toast ${n.correlationId} as it's a new chat request`),n.type===Z1.GroupMessage?y4.Mz:y4.Rl;if(n.type===Z1.Priority&&r)return t.log(`${$t.n.ReturningHardcodedImage}: Returning default priority message avatar for toast ${n.correlationId}`),y4.Vd;if(n.type===Z1.DLP)return t.log(`${$t.n.ReturningHardcodedImage}: Returning default dlp message avatar for toast ${n.correlationId}`),y4.T;if(1===n.members?.length&&n.type===Z1.GroupMessage)return t.log(`${$t.n.ReturningHardcodedImage} Returning default group message avatar for toast ${n.correlationId} as there is just one member`),y4.Mz;if((0,h1.qL)(n.conversationId)&&(0,n_.Ku)(n.senderId))return t.log(`${$t.n.ReturningHardcodedImage} Returning default PSTN avatar for toast ${n.correlationId} as sender is PSTN contact`),y4.Yt;if(n.type===Z1.RecordingUploadFailed||n.type===Z1.ChannelRecordingUploadFailed)return t.log(`${$t.n.ReturningHardcodedImage}: Returning recording upload failed message avatar for toast ${n.correlationId}`),f4();const s=n.type===Z1.GroupMessage?await async function(e,t){const{data:n}=await e.query({query:i4,variables:{convId:t.conversationId}});if(n.chat&&n.chat.avatarUrl)return n.chat.avatarUrl;if(!t.members?.length)return null;const{data:i}=await e.query({query:a4,variables:{msaGroupInfo:{pictureReadyUsers:t.members.map((({id:e,displayName:t,avatarETag:n})=>({userId:e,displayName:t,avatarETag:n}))).slice(0,yh.YM.FOUR),conversationId:t.conversationId}}});return i.msaGroupProfilePicture}(e,n):await async function(e,t){const{data:n}=await e.query({query:n4,variables:{userId:t.senderId},context:{callerInfo:"toast-event-subscription-job"}});if(n?.user&&!n.user?.displayName?.includes("Unknown User"))return n.user.avatarUrl;const{data:i}=await e.query({query:t4,variables:{userId:t.senderId,displayName:t.senderDisplayName,profilePictureSize:X1.Small}});return i.msaUserProfilePicture}(e,n);if(!s)return void t.error($t.n.ImageUrlGenerationFailed);if(s.startsWith("blob:"))return s;let l;if((0,b4.D$)(s)){const t=await(0,w4.z)(e,s,"Url",!0);l=t.result?.blob}else{const t=await e.query({query:o4,variables:{url:s}});l=t?.data.toastImageAsDataUri}return l?(t.log($t.n.ReturningFetchedImage),t.log(`Returning fetched image for toast ${n.correlationId}`),l):void t.error($t.n.ToastImageAsDataUriIsUndefined)}catch(e){return void t.error($t.n.ImageFetchFailed)}}function A4(e,t,n){const{enableUrgentToastsContentFixes:i,enableToastDefaultTextFallbackFix:a,enableObscuringOfTextForNewChatRequestInToastNotification:o}=e.get(c.w.Notifications);return T4(n.interopConversationStatus)?t.stringTranslate("people",o?"new_chat_invite_quarantined_notification_content":"invite_free_quarantined_notification_content"):n.isUrgent&&i?E4(t,n,!!a):F4(t,n,!!a)}function E4(e,t,n){return t.messagePreviewTemplateOption===Cq.Nb.hasText?_4(e,t,n):D4(e,t.translatedPreview,n)}function F4(e,t,n){switch(t.contentType){case C4.cM.FILE:return e.stringTranslate("toastNotifications","toast_messaging_sent_a_file");case C4.cM.VOICE:return e.stringTranslate("toastNotifications","toast_messaging_sent_a_voice_message");case C4.cM.IMAGE:return e.stringTranslate("toastNotifications","toast_messaging_sent_an_image");case C4.cM.LOCATION:return e.stringTranslate("toastNotifications","toast_messaging_sent_a_location_message");case C4.cM.VIDEO:return e.stringTranslate("toastNotifications","toast_messaging_sent_an_video");case C4.cM.TEXT:return _4(e,t,n);default:return D4(e,t.text,n)}}function _4(e,t,n){return!t.isTextMessageVisible&&n?e.stringTranslate("toastNotifications","toast_messaging_preview_hidden"):D4(e,t.text,n)}function D4(e,t,n){const i=function(e){const t=(0,l4.P)(e,!0).replace(/\s\s+/g," ");return(0,cB.QI)(t).trim()}(t||"");return n?i||e.stringTranslate("toastNotifications","toast_messaging_default_fallback"):i}async function P4(e,t,n,i,a,o){switch(a.log(`${$t.n.MappingCommandOptions}: Generating command options for type ${n.type}`),n.type){case Z1.Message:case Z1.Priority:return function(e,t,n,i){return{...j4(n),...O4(e,t,n.interopConversationStatus,n.isTextMessageVisible),text:A4(e,t,n),title:M4(e,t,n,i),isUrgent:!!n.isUrgent,isFromPriorityContact:!!n.isFromPriorityContact,externalAppIconType:n.externalAppIcon?n.externalAppIcon:void 0}}(e,t,n,o);case Z1.UserContact:return function(e,t){return{...j4(t),text:e.stringTranslate("toastNotifications","toast_new_contact_on_teams_text"),title:e.stringTranslate("toastNotifications","toast_new_contact_on_teams_title",{displayName:t.senderDisplayName})}}(t,n);case Z1.GroupMessage:return function(e,t,n,i){return{...j4(n),...O4(e,t,n.interopConversationStatus,n.isTextMessageVisible),text:L4(e,t,n),title:$4(t,n,i,e)}}(e,t,n,o);case Z1.Reply:case Z1.Mention:case Z1.Reaction:case Z1.ForwardMessage:return async function(e,t,n,i,a,o){const r=t.type===Z1.Reaction?await async function(e,t,n){try{const{id:t}=(0,k4.lj)(n?.toLocaleLowerCase().trim());if(!t)return;const{data:i}=await e.query({query:r4,variables:{searchFilter:t,exactMatch:!0}});return(i?.searchEmoticons||[])[0]}catch(e){return void t.error($t.n.ChatToastEmoticonsQueryFailed)}}(n,i,t.reaction):void 0,s=I4(t.interopConversationStatus,o);return{...j4(t),text:U4(e,(0,e4.ob)(e.locale,t.senderSurname||void 0,t.senderGivenName||void 0,t.senderDisplayName||void 0),t.members,t.topic,a,s),isUrgent:!!t.isUrgent,isFromPriorityContact:!!t.isFromPriorityContact,title:R4(e,t,s,r?.unicode||void 0)}}(t,n,i,a,o,e);case Z1.InviteJoined:return function(e,t,n,i){return{...j4(n),text:g4(t,$4,n,e,i),title:p4(t,n,e,i)}}(e,t,n,o);case Z1.TeamsTasks:return async function(e,t,n,i,a){const o=await async function(e,t,n,i){if(!i)return;const a=await e.query({query:c4.$,variables:{id:n,queryType:"QueryByThread"},fetchPolicy:"network-only"}).catch((()=>{t.error($t.n.ChatTabsFetchFailed)})),o=a?.data.platformTabs?.find((e=>e?.entityId&&e?.entityId.toLowerCase().includes(i.toLowerCase())));o||t.log($t.n.ToastNavigationDataNotFound);return o}(n,i,t.conversationId,t.tabId);return{...j4(t),text:m4(e,t,a)||"",title:u4(t,e,a)??"",type:Z1.TeamsTasks,tabId:JSON.stringify({tabId:o?.baseInfo.id,threadId:t.conversationId,appId:o?.baseInfo.appId,tabEntityId:o?.entityId})}}(t,n,i,a,o);case Z1.DLP:return async function(e,t,n){return{...j4(t),text:t.topic||B4(e,t.displayName||t.senderDisplayName,t.members,n),isUrgent:!!t.isUrgent,title:x4(e,t)}}(t,n,o);case Z1.RecordingUploadFailed:case Z1.ChannelRecordingUploadFailed:return async function(e,t,n,i){return{...j4(n),text:$4(t,n,i,e),isUrgent:!!n.isUrgent,title:t.stringTranslate("toastNotifications","recording_upload_failed_toast_header")}}(e,t,n,o);default:return}}function M4(e,t,n,i){if(I4(n.interopConversationStatus,e))return t.stringTranslate("people","new_chat_invite_quarantined_notification_title");const a=function(e,t,n){if(!t.senderDisplayName||s4.af.isDisplayNameUnknownUser(t.senderDisplayName))return n.mark(be.BQ.AssignedUnknownUserNameToChatToast),e.stringTranslate("toastNotifications","toast_unknown_user");return t.senderDisplayName}(t,n,i);return s4.af.isTFLSmsMri(n.senderId)?t.stringTranslate("toastNotifications","toast_messaging_sms_user_given_name",{sender:a}):n.isUrgent&&e.get(c.w.Notifications)?.enableUrgentToastsContentFixes?t.stringTranslate("toastNotifications","toast_messaging_urgent_message_title",{sender:a}):a}function R4(e,t,n,i){switch(t.type){case Z1.Reply:return e.stringTranslate("toastNotifications","toast_messaging_reply_thread",{sender:t.senderDisplayName});case Z1.ForwardMessage:return e.stringTranslate("toastNotifications","toast_messaging_forward_message",{sender:t.senderDisplayName});case Z1.Mention:if(n)return e.stringTranslate("people","new_chat_invite_quarantined_notification_title");{let n;switch(t.subtype){case"everyone":n=t.isThreadMessage?"toast_messaging_mention_everyone_thread":"toast_messaging_mention_everyone";break;case"nearby":n="toast_messaging_mention_nearby";break;default:n=t.isThreadMessage?"toast_messaging_mention_thread":"toast_messaging_mention"}return`${e.stringTranslate("toastNotifications",n,{sender:t.senderDisplayName})}`}case Z1.Reaction:return e.stringTranslate("toastNotifications",t.isThreadMessage?"toast_messaging_reaction_thread":"toast_messaging_reaction",{sender:t.senderDisplayName,emoji:i});default:return""}}function x4(e,t){if(t.type===Z1.DLP)return e.stringTranslate("toastNotifications","dlp_notify_sender_header")}function L4(e,t,n){const{enableUrgentToastsContentFixes:i,enableToastDefaultTextFallbackFix:a}=e.get(c.w.Notifications);if(I4(n.interopConversationStatus,e))return t.stringTranslate("people","new_chat_invite_quarantined_notification_content");let o=n.text;if(o=n.isUrgent&&i?E4(t,n,!!a):F4(t,n,!!a),!o)return;const r=(0,e4.ob)(t.locale,n.senderSurname||void 0,n.senderGivenName||void 0,n.senderDisplayName||void 0);if(s4.af.isTFLSmsMri(n.senderId))return t.stringTranslate("toastNotifications","toast_messaging_sms_group_text_with_sender",{sender:r,text:o});const{enableGroupChatInviteFlow:s}=e.get(c.w.Messaging);return s&&n.interopConversationStatus===N1.$y.AcceptPending?t.stringTranslate("toastNotifications","toast_messaging_group_chat_invite_flow_text_with_sender",{displayName:r}):t.stringTranslate("toastNotifications","toast_messaging_group_text_with_sender",{sender:r,text:o})}function O4(e,t,n,i){const{allowUserChat:a}=e.get(c.w.Messaging);return!a||!i||n===N1.$y.AcceptPending||n===N1.$y.ExtendedDirectoryAcceptPending||n===N1.$y.Quarantined?{quickReply:!1}:{quickReply:!0,quickReplyPlaceholder:t.stringTranslate("toastNotifications","toast_messaging_quickreply_placeholder_text"),quickReplyButton:t.stringTranslate("toastNotifications","toast_messaging_quickreply_button_text")}}function j4(e){return{conversationId:e.conversationId,messageId:e.messageId,quickReply:!1,time:new Date(+e.timestamp),discardDuringMeetingsAndCalls:!!e.discardDuringMeetingsAndCalls}}function B4(e,t,n,i){if(t)return e.stringTranslate("toastNotifications","toast_messaging_activity_text",{participants:t});const a=W4(e,n,i);return a?e.stringTranslate("toastNotifications",a.count?"toast_messaging_activity_text_with_count":"toast_messaging_activity_text",{participants:a.displayName,count:a.count}):e.stringTranslate("toastNotifications","toast_messaging_default_group_topic")}function U4(e,t,n,i,a,o){if(o)return e.stringTranslate("people","new_chat_invite_quarantined_notification_content");if(i)return i;const r=W4(e,n,a);return r?e.stringTranslate("toastNotifications",r.count?"toast_messaging_activity_text_with_count":"toast_messaging_activity_text",{participants:r.displayName,count:r.count}):t?e.stringTranslate("toastNotifications","toast_messaging_activity_text",{participants:t}):e.stringTranslate("toastNotifications","toast_messaging_default_group_topic")}function $4(e,t,n,i){const a=t.members;if(I4(t.interopConversationStatus,i))return e.stringTranslate("people","new_group_chat_invite_quarantined_notification_title");if(t.topic)return t.topic;const o=W4(e,a,n);return o?e.stringTranslate("toastNotifications",o.count?"toast_messaging_group_topic_with_count":"toast_messaging_group_topic",{participants:o.displayName,count:o.count}):e.stringTranslate("toastNotifications","toast_messaging_default_group_topic")}function W4(e,t,n){if(!t||!Array.isArray(t)||0===t.length)return;const i=e.stringTranslate("toastNotifications","toast_unknown_user");let a=!1;const o=t.map((t=>{const n=(0,e4.ob)(e.locale,t.surname||void 0,t.givenName||void 0,t.displayName||void 0);return n||(a=!0,i)}));return a&&n.mark(be.BQ.AssignedUnknownUserNameToGroupChatToast),(0,e4.Yx)(o,t.length)}function V4(e,t,n,i,a,o,r,s,l){const{enableCommandToHostCommService:d}=t.get(c.w.Core,["enableCommandToHostCommService"]),{enableBrowserToasts:u,enableInAppNotifications:m,enableInAppNotificationsForChatsAndChannels:p}=t.get(c.w.Notifications,["enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"toast-event-subscription",runOncePerId:!0,job:async()=>{const g=r.newLogger("ToastEventSubscription","apps-chat");d||u||m&&p?(g.log($t.n.Subscribing),n.subscribe({query:K1,fetchPolicy:"no-cache"}).forEach(function(e,t,n,i,a,o,r,s,l){const{enableToastCollections:d}=t.get(c.w.Notifications);return async c=>{if(c.errors){const e=(0,ge.hR)(c.errors.map((e=>e.message)).join());return r.error(`${$t.n.SubscriptionFailed} ${e}`),void H4(s,{errorCode:$t.n.SubscriptionFailed,errors:e})}if(!c.data?.toastEvent)return r.error($t.n.EmptyEvent),void H4(s,{errorCode:$t.n.EmptyEvent});r.log(`${$t.n.ToastEventReceivedInJob}: Received a valid event in the toast subscription job, correlationId:${c.data.toastEvent.correlationId}, activityId:${c.data.toastEvent.activityId}`);const{toastEvent:u}=c.data,m=s.newScenario(be.Cu.CrossClientToastView,{startTime:+u.timestamp});m.clientId=u.correlationId,m.appendEventData({activityId:c.data.toastEvent.activityId,isUrgent:!!c.data.toastEvent.isUrgent,mainEntityType:ke.ck.chats,mainEntitySubtype:c.data.toastEvent.type,messageId:c.data.toastEvent.messageId,isThreadMessage:!!c.data.toastEvent.isThreadMessage}),m.mark(be.BQ.CrossClientToastEventReceived),r.log(`${$t.n.LogToastInfo}: ${JSON.stringify(m.eventData)}`);const p=await P4(t,a,u,n,r,m);if(!p)return r.log(`${$t.n.UnhandledType} ${u.type}`),void m.incomplete({reason:$t.n.UnhandledType});const g=await o({id:p.conversationId,type:ke.ck.chats,action:ke.SY.view,linkedEntity:null},n);if(m.mark(be.BQ.CrossClientConversationFocusChecked),g)return r.log($t.n.ToastSuppressedForWindowInFocus),void m.incomplete({reason:$t.n.ToastSuppressedForWindowInFocus});const h=await N4(n,r,u,t);m.mark(be.BQ.CrossClientAvatarFetched),h&&(p.mainImage={alt:"",src:h}),s.hoistScenarioToCore?.(m),d&&(p.collectionId=(0,cB.pP)(e,l,r)),u.type===Z1.ChannelRecordingUploadFailed?i.toasts.showChannelsNotification(u.correlationId,p):p.type===Z1.TeamsTasks?i.toasts.showChatTabEntityNotification(u.correlationId,p):u.type===Z1.UserContact&&u.deeplinkUrl?i.toasts.showGraphItemNotification(u.correlationId,{...p,deeplinkUrl:u.deeplinkUrl,quickReply:!1,type:u.type}):i.toasts.showMessage(u.correlationId,p),m.mark(be.BQ.CrossClientEntityCommandTriggered),r.log(`${$t.n.ToastCommandSent} type:${p.type} correlationId:${u.correlationId} activityId:${u.activityId}`)}}(e,t,n,i,a,o,g,s,l))):g.log($t.n.NotEnabled)}}}function H4(e,t){const n=e.newScenario(be.Cu.CrossClientToastView);n.appendEventData({mainEntityType:ke.ck.chats}),n.fail(t)}const z4=({context:{authenticationUser:e,client:t,coreSettings:n,entityCommanding:i,i18n:a,isEntityInView:o,loggerFactory:r,scenarioFactory:s,userTrackingService:l}})=>[V4(e,n,t,i,a,o,r,s,l)],q4=({context:{scenarioFactory:e,coreSettings:t}})=>{const n=[{id:"import-chat-bundle",runOncePerId:!0,job:()=>(async({scenarioFactory:e,coreSettings:t})=>{const n=t?.get(c.w.Core).enableSerializeChunkImport,i="chat-app";if(n){const t=e.findScenario("application_launch_time");t?.mark("load_chat_app_start"),await(0,ev.wg)(z1,i,e),t?.mark("load_chat_app_end")}else(0,ev.wg)(z1,i,e)})({scenarioFactory:e,coreSettings:t})}];return n};var G4=n(831854);function Y4({scenarioFactory:e,loggerFactory:t,client:n,windowProvider:i,coreSettings:a,localStorage:o,authenticationUser:r}){return{id:"bizchat-app-pre-warm",runOncePerId:!0,job:async()=>(async(e,t,n,i,a,o,r)=>{const s=t.newLogger("BizChatAppPreWarmStrategy","apps-chat"),l=e.newScenario(be.Cu.BizChatPreWarm);l.appendEventData({correlationId:(0,E.v4)()});const d=async e=>{i.document.getElementById("bizChatAppIframe")?.remove(),s.infoToTelemetry?.("Removed Hidden Iframe","bizchat_pre_warm_info"),l?.stop({reason:"iframe-removed"}),Promise.resolve()};try{if(s.infoToTelemetry?.("BizChat pre-warm job started","bizchat_pre_warm_info"),!r?.profile.objectId||!r?.profile.tenantId)return s.errorToTelemetry?.("No authentication user found","bizchat_pre_warm_error"),void l?.fail();const{data:e}=await n.query({query:G4.y,variables:{scope:"Personal",appId:"b5abf2ae-c16b-4310-8f8a-d3bcdb52f162"},context:{callerInfo:"BizChatAppPreWarmStrategy"}});if(!e||!e.appDefinition)return s.infoToTelemetry?.("No app definition found. Cancelling bizchat pre-warm job","bizchat_pre_warm_info"),void l?.cancel({reason:"No App Definition"});let t=e.appDefinition?.staticTabs&&e.appDefinition.staticTabs[0]?.contentUrl||void 0;if(!t)return s.errorToTelemetry?.("No contentUrl found in the app definition","bizchat_pre_warm_error"),void l?.fail();const u=t.split("hosted/semanticoverview"),m=u[0],p=u[1],g=i.loader?.getProperties?.(),h=g?.sessionId||oo.get("sessionId"),{telemetryRegion:v}=a.get(c.w.Telemetry),{ring:y}=a.get(c.w.Metadata),S=encodeURIComponent(r.profile.objectId),f=encodeURIComponent(r.profile.tenantId),k=encodeURIComponent(h??""),C=encodeURIComponent(l.eventData.correlationId??"");t=`${m}semanticoverview/Users('OID:${S}@${f}')${p}&prewarm=true&sessionid=${k}&prewarmid=${C}&isEU=${encodeURIComponent("EMEA"===v)}&hostring=${encodeURIComponent(y?.id??"")}`;const b=((e,t)=>{const n=e.document.createElement("iframe");return n&&(n.setAttribute("id","bizChatAppIframe"),n.style.display="none",n.setAttribute("target","_self"),n.setAttribute("sandbox","allow-scripts allow-same-origin"),n.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),n.setAttribute("allow",""),n.setAttribute("src",t),e.document.body.appendChild(n)),n&&n.contentWindow||null})(i,t);if(!b)return s.errorToTelemetry?.("Failed to create hidden iframe","bizchat_pre_warm_error"),void l?.fail();((e,t,n)=>{let i;i=void 0,i=t.setTimeout((()=>{n?.(!0),t.clearTimeout(i)}),e)})(18e3,i,d),o?.set("BizChatAppPreWarmTimeStamp",Date.now().toString(),"Messaging")}catch(e){const t=`Failed BizChatAppPreWarmStrategy with errorCode ${e?.errorCode||e?.code}`;s.errorToTelemetry?.(t,"bizchat_pre_warm_error"),l?.fail()}})(e,t,n,i,a,o,r)}}const Q4=({context:{i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,entityCommanding:l,platformService:d,networkState:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v}})=>{const y=[],{enableBizChatPreWarm:S,bizChatPreWarmRelaunchInterval:f}=t.get(c.w.Messaging);if(S){const c=a?.newScenario(be.Cu.BizChatPreWarmIdleStateTrigger),S=r?.get("BizChatAppPreWarmTimeStamp");let k=!0;if(S){const e=f??288e5,t=+S;k=Date.now()-t>e}k?(c?.stop({reason:"Job-pushed"}),y.push(Y4({i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,entityCommanding:l,platformService:d,networkState:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v}))):c?.stop({reason:"Job-Skipped"})}return y},J4=({context:{i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,entityCommanding:l,platformService:d,networkState:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v}})=>{const y=[],{enableBizChatPreWarmOnIdle:S,bizChatPreWarmRelaunchInterval:f}=t.get(c.w.Messaging);if(S){const c=a?.newScenario(be.Cu.BizChatPreWarmIdleStateTrigger),S=r?.get("BizChatAppPreWarmTimeStamp");let k=!0;if(S){const e=f??288e5,t=+S;k=Date.now()-t>e}k?(c?.stop({reason:"Job-pushed"}),y.push(Y4({i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,entityCommanding:l,platformService:d,networkState:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v}))):c?.stop({reason:"Job-Skipped"})}return y};var K4=n(135197);const Z4=e=>{if(X4(e))return e9(e)?{subNavEntity:t9(e),headerEntity:n9(e),startEntity:i9(e),mainEntity:a9(e),endEntity:r9(e)}:null},X4=({contextEntity:e,entity:t,layoutMode:n})=>{const{action:i=null,type:a}={...t},{type:o,action:r}=e||{},s=[Yt.Rm.standard,Yt.Rm.focus].includes(n),l=[ke.SY.create,ke.SY.default,ke.SY.empty,ke.SY.info,ke.SY.infoDetails,ke.SY.join,ke.SY.list,ke.SY.view,ke.SY.manage],c=i&&l.includes(i),d=r&&o,u=[ke.ck.byodchat,ke.ck.chats,ke.ck.chatthread,ke.ck.chatthreadlist,ke.ck.chatsInfo,ke.ck.chatContextualSearch,ke.ck.chatcopilotsynthesis,ke.ck.chatsInfoView,ke.ck.chatManageApps,ke.ck.chatHighlightsDetails,ke.ck.chatfluidthread,ke.ck.chatfilesdetails,ke.ck.chatpeopledetails,ke.ck.chatworkflows,ke.ck.chatrequests,ke.ck.messageactionworkflows,ke.ck.messageextensionworkflows,ke.ck.chatpinnedmessagesdetails,ke.ck.holisticrecap,ke.ck.extensibilityapppickersidepanel,ke.ck.onedrivefileworkflows,ke.ck.sharepointfileworkflows,ke.ck.chatappenabledialog].includes(a),m=n===Yt.Rm.focus&&i===ke.SY.list;return!(!s||!u||!c&&!d||m)},e9=({entity:e,contextEntity:t})=>{const{type:n}=t||{},{action:i=null,type:a}=e||{},o=[ke.ck.byodattendeewindow,ke.ck.calls,ke.ck.callsgalleryandcontent,ke.ck.callsgallery,ke.ck.callscontent,ke.ck.platformStage,ke.ck.meetingroomallinonecall];return!(a!==ke.ck.chats&&a!==ke.ck.chatthread&&a!==ke.ck.chatthreadlist&&a!==ke.ck.byodchat&&a!==ke.ck.chatsInfoView&&a!==ke.ck.holisticrecap&&!E9(a)||!(i||n&&!o.includes(n)))},t9=({contextEntity:e,entity:t,layoutMode:n})=>{if(n===Yt.Rm.focus)return null;const{type:i,action:a}=t;let o,r;"options"in t?(o=F9(t),r=_9(t)):e&&"options"in e&&(o=F9(e),r=_9(e)),o||i!==ke.ck.chats||a!==ke.SY.default||(o=Bt.V.LeftRailSelectedItem);const s=i===ke.ck.chatthread?ke.ck.chats:i;return{action:ke.SY.list,entityState:{flushableByLinkedEntity:!0},id:null,linkedEntity:null,options:o||r?(0,ge.hR)({focusOnLoad:o,actionButtonSurfaceId:r}):null,type:s,windowOptions:null}},n9=({entity:e,contextEntity:t})=>{let n=ke.SY.view;const{type:i,action:a=null}={...e},o=[ke.SY.create,ke.SY.default,ke.SY.empty,ke.SY.join,ke.SY.info];if(a&&o.includes(a)&&(n=a),n===ke.SY.info){if(i===ke.ck.chatthread||i===ke.ck.chatthreadlist)return{id:D9(e).convId,type:ke.ck.chats,action:ke.SY.view};n=ke.SY.view}let r;return e?.type===ke.ck.chats&&(r=JSON.parse(t?.options||"{}")),r&&r.isViewFromM365ChatDeeplink?{...e,action:n,options:t?.options||null}:{...e,action:n}},i9=()=>null,a9=({entity:e,contextEntity:t})=>{let n=ke.SY.view;const{type:i,action:a=null}={...e},o=[ke.SY.create,ke.SY.default,ke.SY.empty,ke.SY.join,ke.SY.manage,ke.SY.info];if(a&&o.includes(a)&&(n=a),n===ke.SY.info){if(i===ke.ck.chatthread||i===ke.ck.chatthreadlist)return{id:D9(e).convId,type:ke.ck.chats,action:ke.SY.view};n=ke.SY.view}return t||{...e,action:n}},o9=[ke.ck.chatContextualSearch,ke.ck.chatcopilotsynthesis,ke.ck.chatHighlightsDetails,ke.ck.chatfluidthread,ke.ck.chatsInfoView,ke.ck.chatsInfo,ke.ck.chatpeopledetails,ke.ck.chatfilesdetails,ke.ck.chatpinnedmessagesdetails,ke.ck.extensibilityapppickersidepanel,ke.ck.chatthread,ke.ck.chatthreadlist],r9=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const{entityId:o,entityType:r,entityOptions:s,entityAction:l}=s9(e,t),d=l9(o,r,s,t);if(d)return d;const u=(0,K4.AD)(o,t,a,n,i);if(u)return{action:ke.SY.info,id:u.id,type:u.type,options:s};const{enableChatInfoPaneSearch:m,enableCopilotSynthesisInChat:p}=n?.get(c.w.Messaging)||{},{enableChatInfoPane:g}=n?.get(c.w.Host)||{},{enableExtensibilityAppPicker:h}=n?.get(c.w.Extensibility)||{},v=p9(a,n),y=g9(o,a),S=c9(o,r,s);if(S)return S;if(!((e,t,n,i,a,o,r,s,l)=>{const d=t&&(0,Py.j)(t);let u=r;return!(m9(e)||(0,g1.WC)(e)||u===ke.ck.chatrequests||d?.source===A.p.ChatRepliesPane||(d?.isFromQuotedReply&&l&&(u=ke.ck.chatHighlightsDetails),!l&&(u&&!o9.includes(u)&&(i!==Yt.Rm.standard||n||!o?.get(c.w.Core)?.enableInfoPaneAsResponsiveMenu)||!(u!==ke.ck.chatsInfoView&&u!==ke.ck.chatsInfo&&u!==ke.ck.chats||s)||a&&i!==Yt.Rm.standard&&i!==Yt.Rm.focus)))})(o,s,v,i,m,n,r,g,!!y))return null;if(A9(r,l,m,p,!!h))return{action:ke.SY.info,id:o,type:r,options:s};if(u9(r))return h9(o,!!y);if(E9(r))return{action:ke.SY.infoDetails,id:o,type:r,options:s};return d9(o,r,l,s)||null},s9=(e,t)=>{let n,i,a,o;return t?({id:n,type:i,options:a,action:o}=t):(({id:n,type:i,action:o}=e),"options"in e&&(a=e.options)),{entityId:n||"",entityType:i,entityOptions:a,entityAction:o}},l9=(e,t,n,i)=>{const a=n&&(0,Py.j)(n);return t===ke.ck.meetingcollaboration&&i?i:a?.source===A.p.ChatContextualSearch?{id:e,action:ke.SY.info,type:ke.ck.chatContextualSearch,options:n}:a?.openChatInEndSlot&&t===ke.ck.chats?{id:e,action:ke.SY.view,options:n,type:ke.ck.chats}:null},c9=(e,t,n)=>{const i=n&&(0,Py.j)(n);if(t===ke.ck.chats&&i?.isFluidThreadMention){return{action:ke.SY.info,id:e||"",options:n,type:ke.ck.chatfluidthread}}return null},d9=(e,t,n,i)=>t!==ke.ck.chatthread&&t!==ke.ck.chatthreadlist||n!==ke.SY.info?null:{action:ke.SY.info,id:e??"",type:t,options:i},u9=e=>e===ke.ck.byodchat||e===ke.ck.chats||e===ke.ck.chatsInfoView,m9=e=>(0,g1.l7)(e)||(0,g1.Fz)(e),p9=(e,t)=>{const n=(e=>{if(e){const{enableChatInfoPaneDefaultOpen:t}=e.get(c.w.Messaging),{enableChatInfoPaneDefaultOpen:n}=e.get(c.w.Host);return t||n}return!1})(t);return"closed"===(e?.infoPane?.chatsInfoView??(n?"hidden":"closed"))},g9=(e,t)=>e&&t?.sidePane?.sidePaneOpenState?.some((t=>t.id===e&&"copilot"===t.category)),h9=(e,t)=>({action:ke.SY.info,id:e||"",type:t?ke.ck.chatHighlightsDetails:ke.ck.chatsInfoView}),v9=e=>new Map([[fZ.cw.IS_GREATER_THAN_0,e],[fZ.cw.IS_AT_LEAST_947,e],[fZ.cw.IS_AT_LEAST_1350,e],[fZ.cw.IS_AT_LEAST_1500,e]]),y9=(e,t)=>e?.find((e=>e.breakpoint===t))?.width,S9="72rem",f9="41rem",k9="32rem",C9="0",b9="484px",w9=({areEmptySlotsTransparent:e,coreSettings:t,entity:n})=>{const{isFlyoutChat:i}=t?.get(c.w.Flyout)??{},{isNonInteractiveMeetingChat:a}=t?.get(c.w.Calling)??{},{enableResponsiveMeetingRoomPanel:o,meetingRoomPanelWidthOnLargeScreen:r}=t?.get(c.w.MeetingRoom)??{},s=t?.get(c.w.UserResources).licenseType,l=s&&["Teacher","Student"].includes(s),{enableMercuryShell2_5:d}=t?.get(c.w.MercuryDesign)??{};let u=l?v9("32rem"):void 0;!u&&a&&(u=o?new Map([[fZ.cw.IS_GREATER_THAN_0,k9],[fZ.cw.IS_AT_LEAST_1350,y9(r,fZ.cw.IS_AT_LEAST_1350)??f9],[fZ.cw.IS_AT_LEAST_2560,y9(r,fZ.cw.IS_AT_LEAST_2560)??"47rem"],[fZ.cw.IS_AT_LEAST_3840,y9(r,fZ.cw.IS_AT_LEAST_3840)??S9]]):v9(f9));const{chatInfoPaneVisibilityState:m}=t?.get(c.w.Host)??{};u=m&&"hidden"===m?new Map([[fZ.cw.IS_GREATER_THAN_0,C9],[fZ.cw.IS_AT_LEAST_947,C9],[fZ.cw.IS_AT_LEAST_1350,k9],[fZ.cw.IS_AT_LEAST_1500,k9]]):u,u=n?.type===ke.ck.chatfluidthread?new Map([[fZ.cw.IS_GREATER_THAN_0,C9],[fZ.cw.IS_AT_LEAST_947,k9],[fZ.cw.IS_AT_LEAST_1350,b9],[fZ.cw.IS_AT_LEAST_1500,b9],[fZ.cw.IS_AT_LEAST_1680,b9],[fZ.cw.IS_AT_LEAST_2560,b9]]):u;return u=T9(n)??u,{endEntity:{[se.w.Rail]:{slotWidthOverrides:u,isHideInfoPaneDisabled:n?.type===ke.ck.chatContextualSearch,infoPaneVisibilityStateInHybrid:m,isColorSchemeDefaultBackground1:!!d}},subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e,isWideSubNav:!!t?.get(c.w.MercuryDesign).enableMercuryDesign}},mainEntity:{[se.w.Main]:{isBackgroundTransparent:!!i&&!d,infoPaneVisibilityStateInHybrid:m,isColorSchemeDefaultBackground1:!!d}},headerEntity:{[se.w.HorizontalBar]:{isBackgroundTransparent:e&&!d,isColorSchemeDefaultBackground1:!!d}}}},T9=e=>{const t=e&&e.options&&(0,Py.j)(e.options);return t?.openChatInEndSlot&&N9(e?.type)&&I9(e)?new Map([[fZ.cw.IS_GREATER_THAN_0,C9],[fZ.cw.IS_AT_LEAST_947,k9],[fZ.cw.IS_AT_LEAST_1280,k9],[fZ.cw.IS_AT_LEAST_1350,f9],[fZ.cw.IS_AT_LEAST_1500,f9],[fZ.cw.IS_AT_LEAST_1680,b9],[fZ.cw.IS_AT_LEAST_2048,b9],[fZ.cw.IS_AT_LEAST_2560,S9],[fZ.cw.IS_AT_LEAST_3840,S9]]):void 0},I9=e=>{const t=e&&e.options&&(0,Py.j)(e.options);return t&&(t.source===A.p.HeadlineSlice||t.source===A.p.ChatScrollToPinMessage||t.source===A.p.ChatQuotedReply)},N9=e=>e===ke.ck.chats||e===ke.ck.chatthread,A9=(e,t,n,i,a)=>t!==ke.SY.infoDetails&&(e===ke.ck.chatHighlightsDetails||e===ke.ck.chatfluidthread||e===ke.ck.extensibilityapppickersidepanel&&a||e===ke.ck.chatContextualSearch&&n||e===ke.ck.chatcopilotsynthesis&&i),E9=e=>e===ke.ck.chatpeopledetails||e===ke.ck.chatfilesdetails||e===ke.ck.chatpinnedmessagesdetails||e===ke.ck.chatHighlightsDetails||e===ke.ck.chatContextualSearch||e===ke.ck.chatrequests||e===ke.ck.chatcopilotsynthesis||e===ke.ck.chatfluidthread||e===ke.ck.chatsInfo||e===ke.ck.extensibilityapppickersidepanel,F9=e=>{const t=e.options&&(0,Py.j)(e.options);if(t?.messageId||t?.searchSessionId||t?.focusOnLoad)return Bt.V.DoNotMove},_9=e=>{const t=e.options&&(0,Py.j)(e.options);return t?.actionButtonSurfaceId},D9=e=>{const[t="",n=""]=e?.id?.split(";replyChainId")??[];return{convId:t,replyChainId:n}};var P9=n(892256),M9=n(627062),R9=n(420645),x9=n(36751),L9=n(479427);const O9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatShowPrivateMeetingConversationMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showPrivateMeetingConversation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}}]}]}}]},j9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatSaveCopilotAppStatesMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"streamStopped"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appFocused"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveCopilotAppStates"},arguments:[{kind:"Argument",name:{kind:"Name",value:"streamStopped"},value:{kind:"Variable",name:{kind:"Name",value:"streamStopped"}}},{kind:"Argument",name:{kind:"Name",value:"appFocused"},value:{kind:"Variable",name:{kind:"Name",value:"appFocused"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"streamStopped"}},{kind:"Field",name:{kind:"Name",value:"appFocused"}}]}}]}}]},B9="/l/invite/",U9="/l/claim",$9={[U9]:Yn.Vd.Claim,[B9]:Yn.Vd.Invite},W9=new Set([U9,B9]),V9=e=>"Recap"===e||"BreakoutRooms"===e||"Attendance"===e,H9=e=>{switch(e){case"Recap":return ke.ck.meetingrecap;case"BreakoutRooms":return ke.ck.breakoutrooms;case"Attendance":return ke.ck.meetinganalytics;default:return ke.ck.chats}},z9=async(e,t,n,i,a,o,r)=>{const s=new URLSearchParams(e.search),l=s.get("users")?.split(",").map((e=>e.trim())),c=s.get("message"),d=s.get("topicName");t.log("deeplink_to_chat_qsp_received");const u=a?.context?.client;if(1===l?.length&&(0,n_.MX)(l[0],i))return n.fail({reason:"cannot navigate to deeplink to 1:1 chat with group copilot"}),{entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.error,id:P9.T.UnableToNavigateToGroupCopilotChat},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}};if(u&&l){let e;try{e=await(0,x9.eS)(u,l,!1,!0,!1,!1,1===l.length?void 0:d)}catch(n){t.warn(`deeplink to chat with users: cannot get chat with user, userCount-${l?.length}`),e=null}n.stop({reason:`deeplink to chat with users: userCount-${l?.length} isMessagePresent:${!!c} isTopicNamePresent:${!!d}`});const i=e?.id||g1.Uv;return(0,g1.l7)(i)&&await u.mutate({mutation:L9.y}),Promise.resolve({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.view,id:i},command:{visibilityState:r?.visibilityState??g.Rp.show,stateTransition:r?.stateTransition??g.Ar.forceFlush},correlation:{source:A.p.ChatDeeplinkUsers},entityOptions:{focusOnLoad:Bt.I.Compose,initialComposeMessage:c}},metadata:{allowAnonymous:!1,accountsToUse:Y9(o,a)}})}return n.fail({reason:`deeplink to chat with users: cannot get client with userCount-${l?.length} isMessagePresent:${!!c} isTopicNamePresent:${!!d} clientExists:${!!u}`}),Promise.reject("deeplink to chat with users fail")},q9=async(e,t,n,i,a,o)=>{const r=e.pathname.split("/");if(r.length>3){const s=decodeURIComponent(r[3]);if(s.startsWith(N1.gN.SkypeSpacesThread)||(0,h1.L5)(s)||(0,g1.l7)(s)){const r=a?.context?.client;if(r){(0,g1.l7)(s)&&await r.mutate({mutation:L9.y});const e=await Q9(r,s,t,n,i);if(e)return Promise.resolve(e)}return n.stop({reason:`deeplink to chat with id: ${s}`}),Promise.resolve({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.view,id:s},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new},correlation:{source:A.p.ChatDeeplinkId}},metadata:{allowAnonymous:!1,accountsToUse:Y9(o,a),tenantId:J9(e)}})}}return n.fail({reason:`deeplink to chat fail with invalid path: ${(0,et.y)(e.pathname.replace(/@/g,"_at_"))}`}),t.warnNoPii?.(`invalid path name ${e.pathname}`),Promise.reject("Deeplink to chat path invalid")},G9=(e,t)=>Promise.resolve({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.join},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush},entityOptions:{inviteLinkType:t,inviteLinkUrl:e.toString()}},metadata:{allowAnonymous:!1}}),Y9=(e,t)=>{if(e)return t?[t.userContextId]:void 0},Q9=async(e,t,n,i,a)=>{if((0,g1.l7)(t))return null;const{enableChatDeeplinkUnhideThread:o}=a.get(c.w.Calling);o&&(0,g1.gj)(t)&&(n.log(`Unhiding chat thread ${t} in deeplink to chat message`),i.mark(be.BQ.ExtDeeplinkToChatMessageUnhideThreadStart),await(async(e,t,n,i)=>{try{await e.mutate({mutation:O9,variables:{conversationId:t,context:"apps-chat"}}),i.mark(be.BQ.ExtDeeplinkToChatMessageUnhideThreadSuccess)}catch{const e=`Failed to unhide chat thread ${t} in deeplink to chat message`;n.errorNoPii?.(e),i.mark(be.BQ.ExtDeeplinkToChatMessageUnhideThreadFail)}})(e,t,n,i));const{data:r}=await e.query({query:R9.A,variables:{convId:t},context:{callerInfo:"apps-chat"}}),s=r?.chat;return!s||s.memberIds&&0!==s.memberIds.length?null:(i.fail({reason:be.BQ.ExtDeeplinkToChatMessageUserIsNotMember}),n.log("ext_deeplink_to_chat_message_user_is_not_member."),{entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.error,id:P9.T.UnableToViewChat},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}})},J9=e=>new URLSearchParams(e.search).get("tenantId")||void 0,K9=(e,t)=>{if(!e?.recordPanelAction)return;const n={moduleName:GR.Sn.copilotResponse,moduleType:GR.nR.botCopilotInteraction,actionGesture:GR.Od.auto,actionOutcome:GR.nd.info,actionScenario:GR.vB.CopilotAppDeeplinkReceived,actionScenarioType:GR.DB.botCopilotInteraction};e.recordPanelAction(n,t)},Z9={id:"com.microsoft.teams.chat",name:"Chat",getLocalizedName:async e=>(await e.waitForNamespace("messaging"),e.stringTranslate("messaging","messaging_app_name")),actors:[Ds],supportedEntities:[ke.ck.alttext,ke.ck.byodchat,ke.ck.chats,ke.ck.chatthread,ke.ck.chatthreadlist,ke.ck.chatContextualSearch,ke.ck.chatcopilotsynthesis,ke.ck.chatHighlightsDetails,ke.ck.chatfilesdetails,ke.ck.chatpinnedmessagesdetails,ke.ck.chatfluidthread,ke.ck.chatManageApps,ke.ck.chatmaxmultiplepinnedmessages,ke.ck.chatpeopledetails,ke.ck.chatsInfo,ke.ck.chatsInfoView,ke.ck.codesnippet,ke.ck.customizereactions,ke.ck.customemojiupload,ke.ck.deletechat,ke.ck.dlp,ke.ck.fluid,ke.ck.giphyconsent,ke.ck.hyperlink,ke.ck.holisticrecap,ke.ck.chatInviteConfirmation,ke.ck.leavechat,ke.ck.messagedraft,ke.ck.pinnedchatsmaxreached,ke.ck.pinnedconversationitems,ke.ck.removechatuser,ke.ck.reportConcern,ke.ck.forwardMessage,ke.ck.filesQuickShare,ke.ck.reportConcernForTFW,ke.ck.sharechatlink,ke.ck.streamcamera,ke.ck.streamcamerainchannels,ke.ck.streamcameraincommunities,ke.ck.translationfeedback,ke.ck.twowaysmsfriendlyname,ke.ck.updategroupchatavatar,ke.ck.tfwupdategroupchatavatar,ke.ck.blockChat,ke.ck.multiStepAcceptChat,ke.ck.leaveGroupAndBlockUser,ke.ck.m365ChatLike,ke.ck.m365ChatDislike,ke.ck.m365ChatReportHarm,ke.ck.chatworkflows,ke.ck.chatrequests,ke.ck.messageactionworkflows,ke.ck.messageextensionworkflows,ke.ck.extensibilityapppickersidepanel,ke.ck.reportuser,ke.ck.chatappenabledialog],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Modal,se.w.Rail],getDefaultCommand:e=>{const{enableFilterPinnedAppsBasedOnPolicy:t}=e.get(c.w.Extensibility);if(!t||(0,f1.Ws)(e.get(c.w.Messaging))!==f1.zL.Disabled)return{action:ke.SY.default,type:ke.ck.chats}},windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125},infoPaneStateMapping:{[ke.ck.chatpeopledetails]:ke.ck.chatsInfoView,[ke.ck.chatfilesdetails]:ke.ck.chatsInfoView,[ke.ck.chatpinnedmessagesdetails]:ke.ck.chatsInfoView},getAllowUserWindowingPreference:({coreSettings:e})=>!!e.get(c.w.Chat).chatDeeplinkRespectUserPreference},X9={shouldAddEntitiesToWindowHistory:e=>!(0,g1.Fz)(e?.mainEntity?.id)&&e?.mainEntity?.action!==ke.SY.create,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>!(0,g1.Fz)(e.id)},e2=(e,t)=>{const{userPreferences:n,coreSettings:i}=t,{enableSimpleCollabUpdateHistoryNavigation:a}=i?.get(c.w.SimpleCollab,["enableSimpleCollabUpdateHistoryNavigation"])??{enableSimpleCollabUpdateHistoryNavigation:!1};if(a){const t=n?.simpleCollab?.simpleCollabViewType;let i=e?.subNavEntity?.type;switch(t){case"unified":i=ke.ck.simplecollab;break;case"split":i=ke.ck.simplecollabchats;break;case"none":i=ke.ck.chats;break;default:return}if(i!==e?.subNavEntity?.type)return(0,Pj.Kw)(e,{type:i,action:ke.SY.list},"subNavEntity")}};var t2=n(469115),n2=n(551561),i2=n(358625);const a2="shell",o2="showToast",r2="updateProfilePicture",s2="updateDisplayName",l2="openPhonelinkDialog",c2=e=>({actor:a2,action:o2,data:e}),d2=()=>({actor:a2,action:r2}),u2=()=>({actor:a2,action:s2}),m2=()=>({actor:a2,action:l2}),p2=(e,t)=>{switch(e){case"HIDDEN_CHANNELS":return"hiddenChannels";case"RECENT_CHATS":return"recentChats";case"RECENT_CHANNELS":return"recentChannels";case"TEAMS_AND_CHANNELS":return"teamsAndChannels";case"APPS":return"apps";default:return t?"favorites":"customSection"}},g2=({event:e,requestContext:t,commonSimpleCollabBiTelemetry:n,selectedApp:i})=>{const{data:a,type:o}=e,r="function"==typeof a?a():{};switch(o){case i2.sU.createConversationFolder:return h2({eventData:r,requestContext:t,commonSimpleCollabBiTelemetry:n});case i2.T8.createConversationFolderConfirmAction:return y2({eventData:r,requestContext:t,commonSimpleCollabBiTelemetry:n,selectedApp:i});case i2.T8.createConversationFolderSucceeded:return S2({eventData:r,requestContext:t,commonSimpleCollabBiTelemetry:n});case i2.T8.createConversationFolderFailed:return f2({eventData:r,requestContext:t});case i2.T8.createConversationFolderCancelAction:return v2({requestContext:t,commonSimpleCollabBiTelemetry:n})}},h2=({eventData:e,requestContext:t,commonSimpleCollabBiTelemetry:n})=>{const{loggerFactory:i,userBiService:a}=t,o=i.newLogger("SimpleCollabEvents","simple-collab-event-action-handlers");return k2({eventData:e,logger:o,userBiService:a,commonSimpleCollabBiTelemetry:n}),Promise.resolve({command:nu(e)})},v2=({requestContext:e,commonSimpleCollabBiTelemetry:t})=>{const{loggerFactory:n,userBiService:i}=e,{recordPanelAction:a}=i,o=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");a({...t?.(),actionGesture:GR.Od.click,actionOutcome:GR.nd.cancel,actionScenario:GR.vB.createCustomSectionCancelButton,actionScenarioType:GR.DB.createCustomSection,moduleName:GR.Sn.createCustomSectionCancelButton,moduleType:GR.nR.cancelButton,panelRegion:GR.rP.modal,panelType:GR.HP.createCustomSectionDialog},o)},y2=({eventData:e,requestContext:t,commonSimpleCollabBiTelemetry:n,selectedApp:i})=>{const{loggerFactory:a,scenarioFactory:o,userBiService:r}=t,{recordPanelAction:s}=r,l=a.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{conversationId:c}=e;(!!c&&o.newScenario(be.Cu.SimpleCollabCreateConversationFolder,{clientId:c})||o.newScenario(be.Cu.SimpleCollabCreateConversationFolder)).appendEventData({viewType:i});o.newScenario(be.Cu.SimpleCollabCreateConversationFolderLie).appendEventData({viewType:i}),s({...n?.(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.createCustomSectionConfirmButton,actionScenarioType:GR.DB.createCustomSection,moduleName:GR.Sn.createCustomSectionConfirmButton,moduleType:GR.nR.confirmButton,panelRegion:GR.rP.modal,panelType:GR.HP.createCustomSectionDialog},l)},S2=({eventData:e,requestContext:t,commonSimpleCollabBiTelemetry:n})=>{const{i18n:i,loggerFactory:a,userBiService:o}=t,{createDatabag:r,recordPanelAction:s}=o,l=a.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");l.infoToTelemetry?.("Create conversation folder succeeded.","simple_collab_create_conversation_folder",void 0,!0);const{sectionId:c,conversationId:d}=e,u=r?.();u&&(u.sectionId=c);const m=!d;return s({...n?.(),actionOutcome:GR.nd.create,actionScenarioType:GR.DB.createCustomSection,moduleName:m?GR.Sn.createCustomSectionFromHeader:GR.Sn.createCustomSectionFromMoveToMenu,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:u},l),u?.dispose(),Promise.resolve({command:c2({intent:"Success",title:i.stringTranslate("simpleCollab","simple_collab_toast_create_folder_success"),dismissOnAction:!0})})},f2=({eventData:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,isExpected:l}=e,c="MaxFolderThreshold"===r;return o.errorToTelemetry?.(`Create conversation folder failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_create_conversation_folder",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabCreateConversationFolder,{errorCode:r},c||l?"abandoned":"failure"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab",c?"simple_collab_toast_create_folder_failed_max_threshold":"simple_collab_toast_create_folder_failed"),dismissOnAction:!0})})},k2=({eventData:e,logger:t,userBiService:n,commonSimpleCollabBiTelemetry:i})=>{const{createDatabag:a,recordPanelAction:o}=n,r=!e?.conversationId,{itemType:s,isLoadedFromTeamsHierarchy:l,folderType:c,isLegacyFavoritesFolder:d}=e,u=l?"teamsAndChannels":p2(c,d),m=a?.();m&&(m.sectionType=u,m.itemType=s,m.targetSectionType="customSection"),o({...i?.(),actionGesture:GR.Od.click,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,actionOutcome:GR.nd.openDialog,actionScenario:GR.vB.openCreateCustomSectionDialog,actionScenarioType:GR.DB.createCustomSection,moduleName:r?GR.Sn.createCustomSectionFromHeader:GR.Sn.createCustomSectionFromMoveToMenu,dataBag:m},t),m?.dispose()},C2="MaxItemsPerFolderThreshold",b2="MoveItemFailedToMoveWithinFolder",w2="InvalidClientLieFolderAction",T2=({event:e,requestContext:t,commonSimpleCollabBiTelemetry:n,selectedApp:i})=>{const{data:a,type:o}=e,r="function"==typeof a?a():{};switch(o){case i2.T8.moveConversationToFolderAction:return N2({eventData:r,requestContext:t,commonSimpleCollabBiTelemetry:n,selectedApp:i});case i2.T8.moveToSubMenuClick:return I2({eventData:r,requestContext:t,commonSimpleCollabBiTelemetry:n});case i2.T8.moveConversationToFolderSucceeded:return A2({eventData:r,requestContext:t});case i2.T8.moveConversationToFolderFailed:return E2({eventData:r,requestContext:t});default:return}},I2=({eventData:e,requestContext:t,commonSimpleCollabBiTelemetry:n})=>{const{loggerFactory:i,userBiService:a}=t,{createDatabag:o,recordPanelAction:r}=a,s=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isLoadedFromTeamsHierarchy:l}=e,c=l?"teamsAndChannels":void 0,d=o?.();d&&(d.sectionType=c),r({...n?.(),actionGesture:GR.Od.click,actionOutcome:GR.nd.move,actionScenario:GR.vB.moveToSubMenuClickButton,actionScenarioType:GR.DB.moveToSubMenuClick,moduleName:GR.Sn.moveItemToCustomSectionButton,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:d},s),d?.dispose()},N2=({eventData:e,requestContext:t,commonSimpleCollabBiTelemetry:n,selectedApp:i})=>{const{loggerFactory:a,userBiService:o,scenarioFactory:r}=t,{createDatabag:s,recordPanelAction:l}=o,c=a.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isLoadedFromTeamsHierarchy:d,fromFolderType:u,toFolderType:m,isFromLegacyFavoritesFolder:p,isToLegacyFavoritesFolder:g,itemType:h,conversationId:v}=e,y=d?"teamsAndChannels":p2(u,p),S=p2(m,g),f=s?.();f&&(f.sectionType=y,f.targetSectionType=S,f.itemType=h);r.newScenario(be.Cu.SimpleCollabMoveItemToConversationFolder,{clientId:v}).appendEventData({viewType:i}),l({...n?.(),actionGesture:GR.Od.click,actionOutcome:GR.nd.move,actionScenario:GR.vB.moveItemToCustomSectionButton,actionScenarioType:GR.DB.moveItemToCustomSection,moduleName:GR.Sn.moveItemToCustomSectionButton,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:f},c),f?.dispose()},A2=({eventData:e,requestContext:t})=>{const{i18n:n,loggerFactory:i}=t,a=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");a.infoToTelemetry?.("Move conversation to folder succeeded.","simple_collab_move_conversation_to_folder",void 0,!0);const{isChannel:o,isLoadedFromTeamsHierarchy:r,toFolderName:s}=e,l=r?"simple_collab_toast_show_in_folder_success":o?"simple_collab_toast_move_channel_to_folder_success":"simple_collab_toast_move_chat_to_folder_success";return Promise.resolve({command:c2({intent:"Success",title:n.stringTranslate("simpleCollab",l,{folderName:s}),dismissOnAction:!0})})},E2=({eventData:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,isChannel:l,isLoadedFromTeamsHierarchy:c,toFolderName:d,isExpected:u}=e;o.errorToTelemetry?.(`Move conversation to folder failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_move_conversation_to_folder",void 0,!0);const m=c?"simple_collab_toast_show_in_folder_failed_at_limit":"simple_collab_toast_move_chat_failed_at_limit";a.stopScenarioIfActive(be.Cu.SimpleCollabMoveItemToConversationFolder,{errorCode:r},r===C2||r===b2||r===w2||u?"abandoned":"failure");const p=c?"simple_collab_toast_show_in_folder_failed":l?"simple_collab_toast_move_channel_to_folder_failed":"simple_collab_toast_move_chat_to_folder_failed";return Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab",r===C2?m:p,{folderName:d}),dismissOnAction:!0})})},F2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsChatUtilsMessageDraftQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"convId"}},{kind:"Field",name:{kind:"Name",value:"message"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ComponentsChatUtilsMessageDraftFragment"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ComponentsChatUtilsMessageDraftFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DraftMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}.definitions]},_2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsChatUtilsTransferMessageDraftMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"fromConvId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"toConvId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"transferMessageDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"fromConvId"},value:{kind:"Variable",name:{kind:"Name",value:"fromConvId"}}},{kind:"Argument",name:{kind:"Name",value:"toConvId"},value:{kind:"Variable",name:{kind:"Name",value:"toConvId"}}}]}]}}]},D2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsChatUtilsRemoveMentionsFromMessageDraftMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeMentionsFromMessageDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},P2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsChatUtilsExpandMessageDraftMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"expandMessageDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},M2=async(e,t,n)=>{await(async(e,t)=>{const{data:n,error:i}=await e.query({query:F2,fetchPolicy:"no-cache",variables:{convId:t}});return!(i||!n.messageDraft||!n.messageDraft?.message?.content&&!n.messageDraft?.message?.files)})(e,t)?(await e.mutate({mutation:_2,variables:{fromConvId:t,toConvId:n}}),await e.mutate({mutation:D2,variables:{convId:n}}),await e.mutate({mutation:P2,variables:{convId:n}}),(0,x9.ME)(e,t)):(0,x9.ME)(e,t)};var R2=n(435431);const x2={onEventReceived:async({eventInput:e,requestContext:{client:t,loggerFactory:n,userBiService:i,coreSettings:a,viewportContext:o,scenarioFactory:r,i18n:s}})=>{const{event:l,event:{originator:c}}=e;if(c===t2.Nv)return L2(a,l,e.source,i,n);if(c===i2.Nv)return O2(l,n,i,r,s);if(j2(l)){switch(l.type){case uq.mu.requestPersonMoreInfo:const e=l.data();return Promise.resolve({command:vq(e)});case uq.mu.requestTopicMoreInfo:{const e=l.data();return Promise.resolve({command:Sq(e)})}case Br.mu.expandTab:{const e=l.data?.();return e&&Promise.resolve({command:ee.expandTab(e)})}case Br.mu.resetLayoutOverrides:return Promise.resolve({command:ee.resetLayoutOverrides()});case Br.mu.maximizeTab:return Promise.resolve({command:ee.maximizeTab()});case Br.mu.showMonitor:return Promise.resolve({command:ee.showMonitor(l.data())});case Br.mu.closeMonitor:return Promise.resolve({command:ee.closeMonitor()});case Br.mu.hideMonitor:return Promise.resolve({command:ee.hideMonitor()});case n2.mu.toggleInfoPane:if(B2(l)){const e=l.data();if(e){const{source:t,showOption:n,id:i,entityOptions:a,infoPaneType:r,action:s,callingIntentId:l,linkedEntityType:c="calls"}=e,d=o===go.k.primary;return{command:ee.toggleEndRail({action:s||"info",entityOptions:a,id:i,source:t,showOption:n,type:r,shouldPersistState:d,targetWindow:d?g.BA.main:void 0,...l&&{linkedEntity:{type:c,id:l}}})}}}return;case R2.f7.addContact:if(U2(l)){const e=l.data();return Promise.resolve({command:Im(e)})}case Br.mu.unhideMonitor:return Promise.resolve({command:ee.unhideMonitor()});case Br.mu.goBack:return Promise.resolve({command:ee.goBack()});case n2.mu.switchToChannel:if($2(l)){const e=l.data();return await M2(t,e.originId,e.destinationChannelId),Promise.resolve({command:Ul({channelId:e.destinationChannelId,teamId:e.destinationTeamId,expandCompose:!0})})}return}return Promise.resolve(void 0)}}},L2=async(e,t,n,i,a)=>{const{enableSinglePaneThreadingNavigation:o}=e.get(c.w.Messaging);return t2.v0.isThreadListPaneEvent(t)?((0,t2.$H)(t,"chat",Dm,i,a),{command:Gs(t.data()),source:n}):t2.v0.isOpenThreadPaneEvent(t)?o?{command:Qs(t.data()),source:n}:((0,t2.z1)(t,"chat",Dm,i,a),{command:Ys(t.data()),source:n}):t2.v0.isHideThreadPaneEvent(t)?o?{command:Ks(t.data()),source:n}:{command:Js(t.data()),source:n}:t2.v0.isPopoutThreadEvent(t)?{command:Zs(t.data()),source:n}:t2.v0.isGoBackToThreadedConversationEvent(t)?{command:Xs(t.data()),source:n}:void 0},O2=async(e,t,n,i,a)=>{const{type:o}=e;switch(o){case i2.sU.createConversationFolder:case i2.T8.createConversationFolderConfirmAction:case i2.T8.createConversationFolderSucceeded:case i2.T8.createConversationFolderFailed:case i2.T8.createConversationFolderCancelAction:return g2({event:e,requestContext:{loggerFactory:t,scenarioFactory:i,userBiService:n,i18n:a}});case i2.T8.moveConversationToFolderAction:case i2.T8.moveToSubMenuClick:case i2.T8.moveConversationToFolderSucceeded:case i2.T8.moveConversationToFolderFailed:return T2({event:e,requestContext:{loggerFactory:t,scenarioFactory:i,userBiService:n,i18n:a}})}},j2=e=>e.type in uq.mu||e.type in Br.mu||e.type in R2.f7||e.type in n2.mu,B2=e=>e.type===n2.mu.toggleInfoPane,U2=e=>e.type===R2.f7.addContact,$2=e=>e.type===n2.mu.switchToChannel,W2=(e,t,n,i)=>{const a=e.event;if(a.originator===t2.Nv&&t2.v0.isOpenThreadPaneEvent(a))return{scenarioName:be.Cu.ChatThreadSwitch,source:a.data().commandSource}},V2="openContextualSearch",H2=e=>({actor:"chat",action:V2,data:e}),z2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatChatWithUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"createLieIfNotFound"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chatWithUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"createLieIfNotFound"},value:{kind:"Variable",name:{kind:"Name",value:"createLieIfNotFound"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},q2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatUserPreferenceNewChatQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPersonalSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messagingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"alwaysPopOutNewChat"}}]}}]}}]}}]}}]},G2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatCreateNewChatMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNewChat"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"conversation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}}]}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"membersLimited"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"givenName"}}]}},{kind:"Field",name:{kind:"Name",value:"memberDisplayNamesLimited"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"hasIBPolicyRejectedUsers"}}]}}]}}]};var Y2=n(845768);const Q2=async(e,t,n)=>{await e.mutate({mutation:G2});let i=n;return i||(i=await(async(e,t)=>{const{enableNewChatPopOut:n}=t.get(c.w.Chat);if(!n)return!1;const{data:i}=await e.query({query:q2});return i?.userPreferences?.userPersonalSettings?.messagingSettings?.alwaysPopOutNewChat??!1})(e,t)),{entity:{type:ke.ck.chats,action:ke.SY.view,id:g1.Uv},command:{visibilityState:g.Rp.show,stateTransition:i?g.Ar.new:g.Ar.forceFlush,correlation:{source:A.p.AppBarContextMenu}}}},J2=async({commandInput:e,requestContext:{loggerFactory:t,client:n,executionContext:i,coreSettings:a}})=>{const{command:o,command:{action:r,data:s}}=e,l=t.newLogger("ChatApp onCommandReceived","apps-chat");if(e.command.actor===Ds)switch(r){case Ps:return{entity:{type:ke.ck.chats,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}};case Rs:return Q2(n,a,!1);case xs:return Q2(n,a,!0);case Ms:if(!el(o)||!o.data?.mri||!o.data?.correlationSource)return void l.error(`Command for action '${o.action}' requires an mri and correlationSource.`);const e=n,t=await(async(e,t)=>{const{data:n}=await e.query({query:z2,variables:{userId:t,createLieIfNotFound:!0},fetchPolicy:"network-only"});return n?.chatWithUser})(e,o.data.mri),c=t?.id;return c?{entity:{type:ke.ck.chats,action:ke.SY.view,id:c},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{id:(0,E.v4)(),source:o.data.correlationSource,startTimestamp:Date.now()}}}:void l.error("Could not fetch the user conversation using the mri");case $s:case Ls:case js:case Us:case Ws:return K2(o,i.viewEntities.endEntity?.id,i.viewEntities.endEntity?.type);case Os:case Bs:return X2(o);case V2:if(!(e=>"object"==typeof e&&null!==e&&"searchQuery"in e&&"entrySource"in e&&"convId"in e&&"logicalId"in e)(s))return void l.error(`Command for action '${r}' requires a searchQuery, entrySource, convId and logiclaId.`);const{entityTypeChat:d,entityTypeChannel:u}=(e=>{const t=e.viewEntities.mainEntity?.type;return{entityTypeChat:t===ke.ck.chats,entityTypeChannel:t===ke.ck.channels}})(i);if(!d&&!u)return void l.error(`Command for action '${r}' requires entity type to be ${ke.ck.chats} or ${ke.ck.channels}`);const m=((e,t)=>{let n;if(t)n=e.viewEntities.mainEntity?.id||"";else{const t=JSON.parse(e.viewEntities.mainEntity?.id||"").channelId;n=JSON.stringify({channelId:`${t}`})}return n})(i,d),p=d?ke.ck.chatContextualSearch:ke.ck.channelcontextualsearch,h=d?A.p.ChatContextualSearch:A.p.ChannelContextualSearch;return{entity:{id:m,action:ke.SY.info,type:p},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{id:(0,E.v4)(),source:h}},entityOptions:{detailViewType:Y2.lO.Search,searchQuery:s.searchQuery,entrySource:s.entrySource,convId:s.convId,logicalId:s.logicalId}};default:l.error(`Command action '${r}' is not supported at ChatApp.`)}else l.error(`Command for actor '${e.command.actor}' cannot be handled by ChatApp.`)},K2=async(e,t,n)=>{if(tl(e)&&e.data){const{convId:i,commandSource:a}=e.data,o=t&&n===ke.ck.chatthread&&a===A.p.ToggleThreadListPane,r=o?t:i,s=o?n:ke.ck.chatthreadlist;return{command:ee.toggleEndRail({id:r,type:s,action:ke.SY.info,source:a,showOption:"toggle",shouldPersistState:!0})}}if(nl(e)&&e.data){const t=n===ke.ck.chats,{convId:i,replyChainId:a,commandSource:o,showBackButton:r}=e.data;return{command:ee.toggleEndRail({id:`${i};replyChainId=${a}`,type:ke.ck.chatthread,action:ke.SY.info,entityOptions:{showBackButton:r||t,backButtonReturnsToConversation:t},source:o,showOption:"show",shouldPersistState:!0})}}if(al(e)&&e.data){const{convId:n,replyChainId:i,commandSource:a}=e.data;return{command:ee.toggleEndRail({id:Z2(t,n,i),type:ke.ck.chatthread,action:ke.SY.info,source:a,showOption:"hide",shouldPersistState:!0})}}if(rl(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i}=e.data;return{entity:{id:`${t};replyChainId=${n}`,type:ke.ck.chats,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:i}}}}if(sl(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i}=e.data;return{entity:{id:t,type:ke.ck.chats,action:ke.SY.view},entityOptions:{messageId:n},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:i}}}}},Z2=(e,t,n)=>{let i=e;return t&&n&&(i=`${t};replyChainId=${n}`),i??void 0},X2=async e=>{if(il(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i}=e.data;return{entity:{id:`${t};replyChainId=${n}`,type:ke.ck.chats,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:i}}}}if(ol(e)&&e.data){const{convId:t,commandSource:n}=e.data;return{entity:{id:`${t}`,type:ke.ck.chats,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:n}}}}},e5=({availableEntities:e,requestContext:t})=>{const{coreSettings:n,stateManagementServices:{userWindowStore:i}}=t,a=n.get(c.w.ChatList).bizChatMetaOSAppId;if(e.mainEntity?.type===ke.ck.chats&&(e.mainEntity?.action===ke.SY.view||e.mainEntity?.action===ke.SY.create||e.mainEntity?.action===ke.SY.default)||e.mainEntity?.type===ke.ck.chatManageApps)i?.set("selectedChatId",(e.mainEntity?.action===ke.SY.create?void 0:e.mainEntity?.id)||void 0);else if(e.mainEntity?.type===ke.ck.extensions&&e.mainEntity.action===ke.SY.view&&e.mainEntity.id){let t;try{t=JSON.parse(e.mainEntity.id).appId}catch(e){t=void 0}t&&a===t&&void 0!==i?.get("selectedChatId")&&i?.get("selectedChatId")!==t&&i?.set("selectedChatId",t)}return Promise.resolve(void 0)},t5={gqlTypeName:"ChatAppViewState",queryFieldName:"chatAppViewState",computedValues:void 0,navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{selectedChatId:null}},n5=(e,t)=>{if(!e||!t)return!1;const{action:n,id:i,type:a}=e||{},{action:o,id:r,type:s}=t||{};return o===n&&s===a&&r!==i},i5=(e,t,n)=>!!n.coreSettings.get(c.w.Chat).enableChatFasterPaint&&((e,t)=>{if(null===e)return!1;const{headerEntity:n,mainEntity:i}=t,{headerEntity:a,mainEntity:o}=e,r=n5(n,a),s=n5(i,o);return r||s})(e,t),a5=["artifactsPlatform","calling","chatList","compose","extensibility","files","funstuff","gallery","lightbox","messaging","meetingAnalytics","meetingRecap","urlPreview","datepicker","peoplePicker","phonelinkSms","simpleCollab"],o5=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),r5=(e,t,n)=>{const i=e.command.correlation.source,{entity:a,command:o,entityOptions:r}=e,s=!!(r&&"messageId"in r&&r.messageId);if(a.type===ke.ck.chats&&o.stateTransition===g.Ar.new&&o.visibilityState===g.Rp.show){if(s)return;if((0,g1.gj)(a.id))return be.Cu.MeetingChatPopOut;const{isNewContextSupportEnabled:e}=n.get(c.w.Host);return e?(0,h1.qL)(a.id)?be.Cu.PhonelinkSmsChatPopOut:be.Cu.ChatPopOut:be.Cu.ChatSwitchPopOut}if(!(a.type!==ke.ck.chats&&a.type!==ke.ck.byodchat&&a.type!==ke.ck.chatrequests||a.action!==ke.SY.view&&a.action!==ke.SY.default||o.visibilityState!==g.Rp.show||i===A.p.StandAlone)){if(s)return;return((e,t,n)=>{if(e.id===g1.Uv)return be.Cu.NewChat;if(t===A.p.ChatListMeetingItem||t===A.p.Calendar||(0,g1.gj)(e.id))return be.Cu.MeetingChatSwitch;const{enableChatRequests:i}=n.get(c.w.ChatList),a=e.type===ke.ck.chatrequests;if(i&&a)return be.Cu.ChatRequestSwitch;const{isFlyoutChat:o}=n.get(c.w.Flyout);if(o)return(0,h1.qL)(e.id)?be.Cu.PhonelinkSmsInlineChatSwitch:be.Cu.InlineChatSwitch;const{chatSwitchInPopOut:r}=n.get(c.w.Chat);return r?be.Cu.ChatSwitchPopOut:(0,h1.qL)(e.id)?be.Cu.PhonelinkSmsChatSwitch:be.Cu.ChatSwitch})(a,i,n)}return a.type===ke.ck.chatContextualSearch&&a.action===ke.SY.info&&o.visibilityState!==g.Rp.hide?be.Cu.ContextualSearchStart:a.type===ke.ck.chatHighlightsDetails&&a.action===ke.SY.info&&o.visibilityState===g.Rp.show?be.Cu.ChatHighlightsDetailsStart:void 0},s5=({coreServices:e,host:t,prevEntityType:n,screenState:i,windowOptions:a})=>{if(n===ke.ck.chats)return null;const{height:o,minHeight:r,minWidth:s,offset:l,width:d}=Z9.windowFeatures||{},u=t?.screenX||0,m=t?.screenY||0,p=(i?.numOpenWindows||1)*(l||1);return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},height:o,left:u+p,minHeight:r,minWidth:s,top:m+p,width:d,...e?.coreSettings.get(c.w.Core).enableRatioToScreenBasedSizing&&l5(t,Z9.windowFeatures),...a}};function l5(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}const c5=(e,t)=>{if(t){const t=e.find((e=>e.userContextAccountType===FR.SourceWindow));if(t)return t}const n=e.find((e=>e.userContextAccountType===FR.MainWindow));return n||(e&&e.length>0?e[e.length-1]:void 0)},d5=async({deeplinkUrl:e,context:{loggerFactory:t,scenarioFactory:n,coreSettings:i}})=>{const a=t.newLogger("ChatApp_parseM365ChatDeeplink","apps-chat");return((e,t,n,i)=>{const a=n.newScenario(be.Cu.M365DeeplinkToChat);if(!e.pathname.startsWith("/l/m365chat/"))return a.fail({reason:be.BQ.M365DeeplinkToChatPathNotFound}),t.log("ext_deeplink_to_chat_message_path_not_found"),Promise.reject("Deeplink to chat message path not found");const{pathname:o,search:r}=e;t.log(`Parsing deeplinkUrl - pathname: ${o}, search: ${r}`);const s=decodeURIComponent(o).split("/"),l=s.findIndex((e=>e.startsWith(N1.gN.SkypeSpacesThread))),d=s[l],u=new URLSearchParams(r),m=u.get("defaultTab")||void 0;a.appendEventData({"Thread.Id":d});const p=u.get("context");let h;try{h=p&&JSON.parse(p)}catch{const e="executem365ChatDeeplinkUrl(): Unable to parse context.";throw a.fail({reason:be.BQ.M365DeeplinkToChatContextParseFailed}),new Error(e)}const{enableM365DeeplinkRoutingToChat:v}=i.get(c.w.Calling),{enablePopoutAction:y}=i.get(c.w.ChatList);if(a.mark(be.BQ.M365DeeplinkToChatParamsReceived),t.log("m365_deeplink_to_chat_params_received"),v){if(!m)return a.stop({reason:be.BQ.M365DeeplinkToChatRoutingToChat}),Promise.resolve({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.view,id:d},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new},correlation:{source:A.p.CalendarM365},entityOptions:{isViewFromM365ChatDeeplink:!0}},metadata:{allowAnonymous:!1}});if(V9(m)){a.stop({reason:be.BQ.M365DeeplinkToChatRoutingToChatWithDefaultTab}),t.log(`deeplink to M365 chat with ${m} as Default Tab`);const e={type:H9(m),action:ke.SY.view,id:d,linkedEntity:{type:ke.ck.chats,action:ke.SY.view,id:d}},n=y?{stateTransition:g.Ar.new,visibilityState:g.Rp.show}:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show},i={source:A.p.CalendarM365};switch(m){case"Recap":return Promise.resolve({entityCommand:{entity:e,command:n,correlation:i,entityOptions:{isViewFromM365ChatDeeplink:!0,...h}},metadata:{allowAnonymous:!1}});case"Attendance":return Promise.resolve({entityCommand:{entity:e,command:n,correlation:i,entityOptions:{isViewFromM365ChatDeeplink:!0,subType:"meetingchat",...h}},metadata:{allowAnonymous:!1}});default:return Promise.resolve({entityCommand:{entity:e,command:n,correlation:i,entityOptions:{isViewFromM365ChatDeeplink:!0}},metadata:{allowAnonymous:!1}})}}else a.fail({reason:be.BQ.M365DeeplinkToChatUnsupportedDefaultTab}),t.log(`deeplink to M365 chat failed with unsupported default tab: ${m}`)}return a.stop({reason:be.BQ.M365DeeplinkToChatFeatureFlagDisabled}),Promise.reject("Deeplink to M365 chat fail becuase of FF being disabled")})((0,CR.q)(e,i),a,n,i)},u5=()=>{const e=({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("ChatApp","apps-chat");return((e,t,n)=>{const{pathname:i}=n,{enableInviteLinks:a}=e.get(c.w.InviteLinks);for(const e of Array.from(W9))if(i.startsWith(e)){if(!a){const e="Invite link redemption is disabled for this experience";return t.error(e),Promise.reject(e)}const i=$9[e];if(void 0===i){const e="No Invite link type found for the specified prefixType";return t.error(e),Promise.reject(e)}return G9(n,i)}const o="No DeeplinkPrefixType found for the specified deeplinkUrl";return t.error(o),Promise.reject(o)})(t.coreSettings,n,e)},t={filter:"/l/chat",execute:async({deeplinkUrl:e,context:{getUserContexts:t,loggerFactory:n,scenarioFactory:i,coreSettings:a},preferredCommandInput:o})=>{const r=n.newLogger("ChatApp_parseChatDeeplink","apps-chat"),s=!!a.get(c.w.Chat).chatDeeplinkRespectUserPreference,l=await t(),d=c5(l,s);return((e,t,n,i,a,o,r)=>{const s=n.newScenario(be.Cu.ExtDeeplinkToChat);if(e.pathname.startsWith("/l/chat/0/0"))return z9(e,t,s,i,a,o,r);{const{pathname:l,search:c}=e;t.log(`Parsing deeplinkUrl - pathname: ${l}, search: ${c}`);const d=decodeURIComponent(l),u=d.split("/"),m=d?.split(/[/?&]/),p=m?.indexOf("chat"),g=m?.[p+M9.lD],h=u.findIndex((e=>e.startsWith(N1.gN.SkypeSpacesThread))),v=u[h],y=new URLSearchParams(c),S=y.get("context");let f;try{f=S&&JSON.parse(S)}catch{const e="executeChatDeeplinkUrl(): Unable to parse context.";throw s.fail({reason:e}),new Error(e)}const k=y.get("tenantId")||void 0;if(g?.startsWith(M9.YT)||Object.keys(M9._v).includes(g)){const t=(0,M9.jI)("",v,e,k,f,g,n,r);return s.stop({reason:"deeplink to chat tab"}),Promise.resolve(t)}return q9(e,t,s,i,a,o)}})((0,CR.q)(e,a),r,i,a,d,s,o)}},n={filter:e=>{if(e.pathname?.startsWith("/l/message")){const t=new URLSearchParams(e.search).get("context");try{const e=null==t?null:JSON.parse(t);return"chat"===e?.contextType}catch{return!1}}return!1},execute:async({deeplinkUrl:e,preferredCommandInput:t,context:{getUserContexts:n,loggerFactory:i,scenarioFactory:a,coreSettings:o}})=>{const r=i.newLogger("ChatApp_parseChatDeeplink","apps-chat"),s=[A.p.ActivityFeed,A.p.ActivityFeedBellClick],l=!(!!t?.correlation?.source&&s.includes(t?.correlation?.source))&&!!o.get(c.w.Chat).chatDeeplinkRespectUserPreference,d=await n(),u=c5(d,l);return(async(e,t,n,i,a,o,r)=>{const s=i.newScenario(be.Cu.ExtDeeplinkToChatMessage);if(!e.pathname.startsWith("/l/message"))return s.fail({reason:be.BQ.ExtDeeplinkToChatMessagePathNotFound}),n.log("ext_deeplink_to_chat_message_path_not_found"),Promise.reject("Deeplink to chat message path not found");const{enableThreadingInChat:l}=t.get(c.w.Messaging),d=e.pathname.split("/"),u=new URL(e),m=new URLSearchParams(u.search),p=decodeURIComponent(d[3]);if(s.appendEventData({"Thread.Id":p}),d.length>3&&!p.startsWith(N1.gN.SkypeSpacesThread)&&!p.startsWith(N1.gN.PrivateFeed))return s.fail({reason:be.BQ.ExtDeeplinkToChatMessageTypeNotSupported}),n.log("ext_deeplink_to_chat_message_type_not_supported"),Promise.reject("Deeplink to chat message type not supported");let h=4<=d.length?d[4]:void 0;h="0"===h?void 0:h;const v=m.get("parentMessageId"),y=l&&v&&v!==h?`${p};replyChainId=${v}`:p;s.mark(be.BQ.ExtDeeplinkToChatMessageParamsReceived),n.log("ext_deeplink_to_chat_message_params_received");const S=o?.context?.client;if(S){const e=await Q9(S,p,n,s,t);if(e)return Promise.resolve(e)}s.stop({reason:be.BQ.ExtDeeplinkToChatMessageResolved}),n.log("ext_deeplink_to_chat_message_resolved");const f=l&&v&&v!==h?ke.ck.chatthread:ke.ck.chats,k=l&&v&&v!==h?ke.SY.info:ke.SY.view,C=(0,E.v4)();return Promise.resolve({entityCommand:{entity:{type:f,action:k,id:y},command:{visibilityState:a?.visibilityState??g.Rp.show,stateTransition:a?.stateTransition??g.Ar.flush},correlation:{source:A.p.ChatDeeplinkMessage},entityOptions:{messageId:h,uniqueId:C}},metadata:{allowAnonymous:!1,accountsToUse:Y9(r,o)}})})((0,CR.q)(e,o),o,r,a,t,u,l)}};return[{filter:"/l/claim",execute:e},{filter:"/l/invite/",execute:e},t,n,{filter:({protocol:e,pathname:t})=>{return"im:"===e||"sip:"===e&&(n=t.trim(),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n.toLowerCase()));var n},execute:async({deeplinkUrl:e,context:{getUserContexts:t,loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("ChatApp_parseChatProtocolDeeplink","apps-chat"),o=Z9.getAllowUserWindowingPreference?.({coreSettings:i})||!1,r=await t();return(async(e,t,n,i)=>{const{protocol:a,pathname:o}=e;t.log(`ChatApp_parseChatProtocolDeeplink: Deeplink to chat from protocol ${a} with pathname: ${o} received`);const r=n?.context?.client;if(r){let a;try{a=await(0,x9.fU)(r,e.pathname,!1,!0)}catch(e){t.warn("ChatApp_parseChatProtocolDeeplink: cannot get chat with user"),a=null}const o=a?.id||g1.Uv;return(0,g1.l7)(o)&&await r.mutate({mutation:L9.y}),Promise.resolve({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.view,id:o},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush},correlation:{source:A.p.ChatProtocolDeeplink},entityOptions:{focusOnLoad:Bt.I.Compose}},metadata:{allowAnonymous:!1,accountsToUse:Y9(i,n)}})}return t.warn("ChatApp_parseChatProtocolDeeplink: canot get apollo client"),Promise.reject("ChatApp_parseChatProtocolDeeplink fail")})(e,a,c5(r,o),o)}},{filter:"/l/copilot",execute:async({deeplinkUrl:e,context:{getUserContexts:t,loggerFactory:n,coreSettings:i,scenarioFactory:a,userBiService:o}})=>{const r=!!i.get(c.w.ChatList).enableBizChatMetaOSEntryPoint,s=n.newLogger("ChatApp_parseCopilotDeeplink","apps-chat"),l=!!i.get(c.w.Chat).chatDeeplinkRespectUserPreference,d=await t();return((e,t,n,i,a,o)=>{const r=o?.context?.client,{search:s}=e,l=n.newScenario(be.Cu.CopilotAppDeeplinkExecute);if(!e.pathname.startsWith("/l/copilot"))return l.fail({reason:"Invalid deeplink path"}),Promise.reject("Invalid deeplink path");if(K9(a,t),l.mark(be.BQ.CopilotAppDeeplinkReceived),!i)return l.stop({reason:"Deeplink call not handled because enableBizChatMetaOSEntryPoint is not enabled."}),Promise.resolve(void 0);if("?bold=false"===s)return l.stop({reason:"Expected: deeplink call not handled due to app reloads."}),Promise.resolve(void 0);try{r.mutate({mutation:j9,variables:{streamStopped:!0},fetchPolicy:"no-cache"}).then((()=>{l.mark(be.BQ.CopilotAppDeeplinkStatesWritten),l.stop({reason:"Deeplink call successfully handled."})}))}catch(e){t.errorToTelemetry?.("Could not write copilot app states to the cache.","messaging_copilot_app",void 0,!0),l.fail({reason:"Could not write copilot app states to the cache."})}return Promise.resolve(void 0)})(e,s,a,r,o,c5(d,l))}},{filter:"/l/loopthread",execute:async({deeplinkUrl:e,preferredCommandInput:t,context:{getUserContexts:n,coreSettings:i}})=>{const a=!!i.get(c.w.Chat).chatDeeplinkRespectUserPreference,o=await n();return(async(e,t,n,i)=>{if(!e.pathname.startsWith("/l/loopthread/"))return Promise.reject("Invalid deeplink path");const a=e.pathname.split("/"),o=decodeURIComponent(a[3]);return Promise.resolve({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.view,id:o},command:{visibilityState:t?.visibilityState??g.Rp.show,stateTransition:t?.stateTransition??g.Ar.flush},entityOptions:{isFluidThreadMention:!0},correlation:{source:A.p.ChatFluidThread}},metadata:{allowAnonymous:!1,accountToUse:Y9(i,n)}})})(e,t,c5(o,a),a)}},{filter:"/l/m365chat",execute:d5}]};function m5(){const e=u5();return{eventHandlers:x2,getAppPhases:G1,getAppViewEntities:Z4,getAppViewEntitiesProps:w9,getAppWindowFeatures:s5,getCommandScenarioName:r5,getEventScenarioData:W2,getPlatformAppIdForEntity:e=>e.type===ke.ck.chats||e.type===ke.ck.chatrequests?"86fcd49b-61a2-4701-b771-54728cd291fb":void 0,manifest:Z9,onBeforeAddToNavigation:X9,onBeforeNavigationFromHistory:e2,onBeforeCommandHandled:A1,onBeforeDeeplinkParsed:e,onCommandReceived:J2,onPreInit:q4,onPreWarm:z4,onRegister:e=>{e.registerTask(new rh)},onViewUpdateCommandResolved:e5,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n,coreSettings:i})=>{const{enableEntityMoreInfo:a=!1}=i.get(c.w.Core),{preloadedI18nNamespacesChatApp:o}=i.get(c.w.Chat),{ChatViewsRenderer:r,LPC:s}=await(async(e,t,n)=>{const i="chat-app";t("ChunkLoadStarted",{chunkName:i});const{ChatViewsRenderer:a}=await(0,ev.wg)(z1,i,e),{LPC:o}=n?{LPC:o5}:await(0,ev.wg)(q1,i,e);return t("ChunkLoadSucceeded",{chunkName:i}),{ChatViewsRenderer:a,LPC:o}})(n,t,!!a),l=a?o5:wJ.CA;return(0,Lr.Y)(vG.e,{namespaces:o??a5,loaderRenderer:null,children:(0,Lr.Y)(s,{children:(0,Lr.Y)(l,{children:(0,Lr.Y)(r,{appRenderMode:e})})})})},viewStateRegistration:t5,onExperienceLongIdle:Q4,getAllowSetActiveWindowsRAF:i5,onIdle:J4,sidePaneCallbacks:{getSidePaneState:K4.FH,setSidePaneState:K4.xB}}}var p5=n(936873);const g5={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainSetSpeedDialMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"setSpeedDialSystemTagInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SetSpeedDialSystemTagInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setSpeedDialSystemTag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"setSpeedDialSystemTagInput"},value:{kind:"Variable",name:{kind:"Name",value:"setSpeedDialSystemTagInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SetSpeedDialSystemTagMutationSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"successMessage"}},{kind:"Field",name:{kind:"Name",value:"edge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"}},{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_Person"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"contactId"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonOneGqlPersonFragment"}}]}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SpeedDialContactsError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}},...n(458160).c.definitions]},h5={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainDeleteContactMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contactPayload"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_DeleteContactInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteContact"},arguments:[{kind:"Argument",name:{kind:"Name",value:"contactPayload"},value:{kind:"Variable",name:{kind:"Name",value:"contactPayload"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ContactMutationSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"successMessage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ContactMutationErrorGeneric"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ContactMutationErrorNetworkOffline"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]};var v5=n(462973);const y5={onEventReceived:({eventInput:{event:e},requestContext:t})=>{if(S5(e))return Promise.resolve({command:vq(e.data())});if(f5(e))return Promise.resolve({command:yq(e.data())});if((0,R2.ni)(e))return Promise.resolve({command:Im(e.data())});if((0,p5.XD)(e))return(n=t.client,i=e.data(),n.mutate({mutation:g5,variables:{setSpeedDialSystemTagInput:i}})).then((({data:e})=>({command:c2({title:"SetSpeedDialSystemTagMutationSuccess"===e.setSpeedDialSystemTag.__typename?e.setSpeedDialSystemTag.successMessage:e.setSpeedDialSystemTag.errorMessage,intent:"SetSpeedDialSystemTagMutationSuccess"===e.setSpeedDialSystemTag.__typename?"Success":"Error",dismissOnAction:!0,duration:3e3})})));if((0,p5.j)(e))return Promise.resolve({command:c2({title:e.data().errorMessage,intent:"Error",dismissOnAction:!0,duration:3e3})});if((0,p5.Iu)(e))return((e,t)=>e.mutate({mutation:h5,variables:{contactPayload:t},update(e){const n=e.identify({id:t.id,__typename:"OneGQL_Person"});e.evict({id:n}),e.gc()}}))(t.client,e.data()).then((({data:{deleteContact:e}})=>({command:c2({title:"OneGQL_ContactMutationSuccess"===e.__typename?e.successMessage:e.errorMessage,intent:"OneGQL_ContactMutationSuccess"===e.__typename?"Success":"Error",dismissOnAction:!0,duration:3e3})})));if((0,p5.dz)(e))return Promise.resolve({command:Fs()});if((0,v5.A8)(e)){const{data:t}=e,n="function"==typeof t?t():{},{id:i}=n.row;return Promise.resolve({command:ee.toggleEndRail({action:"view",showOption:"show",entityOptions:n,id:i,source:v5.Nv,type:ke.ck.calllogsummary})})}if((0,v5.mq)(e)){const{data:t}=e,n="function"==typeof t?t():{};return Promise.resolve({command:_s(n)})}if((0,p5.zj)(e))return Promise.resolve({command:ee.toggleStartRail({showOption:"toggle"})});if((0,p5.Ob)(e)){const t=e.data();if(t){const{source:e,id:n,entityOptions:i,entityType:a,action:o,showOption:r}=t;return Promise.resolve({command:ee.toggleEndRail({action:o||"view",entityOptions:i,id:n,source:e,showOption:r,type:a})})}}var n,i;return Promise.resolve(void 0)}},S5=e=>e.type===uq.mu.requestPersonMoreInfo,f5=e=>e.type===uq.mu.requestPersonMoreOrgInfo,k5=e=>{if(C5(e))return b5(e)?{subNavEntity:w5(e),headerEntity:T5(e),startEntity:I5(e),mainEntity:N5(e),endEntity:A5(e)}:null},C5=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.callsmain,ke.ck.speeddial,ke.ck.calllogsummary,ke.ck.calllogcopilot,ke.ck.locationnotification,ke.ck.locationnotificationbanner].includes(i),r=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view,ke.SY.locationhandler],s=n&&r.includes(n);return!!(a&&o&&s)},b5=()=>!0,w5=()=>null,T5=({entity:e})=>e,I5=({entity:e,coreSettings:t})=>{const n=t?.get(c.w.Calling).enableSlotsInCallsApp,i=(0,Py.j)(e?.options??"{}");return n&&!!!i?.activityId?e:null},N5=({entity:e})=>e,A5=e=>{const{entity:t,coreSettings:n,contextEntity:i}=e,a=n?.get(c.w.Calling).enableSlotsInCallsApp;return a?i||{...t,type:ke.ck.speeddial}:null},E5={id:"com.microsoft.teams.callsmain",name:"CallsMain",actors:[fs],supportedEntities:[ke.ck.callsmain,ke.ck.locationnotification,ke.ck.locationnotificationbanner,ke.ck.speeddial,ke.ck.calllogsummary,ke.ck.calllogcopilot],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail,se.w.Modal],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600},getDefaultCommand:()=>({type:ke.ck.callsmain,action:ke.SY.view})},F5=({appRenderMode:e,coreSettings:t,type:n})=>{const{callsAppPhaseTimeouts:i,enableSlotsInCallsApp:a}=t.get(c.w.Calling),o=new qz.D,r=[],s=[];switch(e){case se.w.HorizontalBar:r.push(Gz.m.CALLS_APP_HEADER_RENDERED);break;case se.w.Main:a?r.push(Gz.m.CALLS_APP_HISTORY_FETCH_STARTED,Gz.m.CALLS_APP_HISTORY_FETCH_COMPLETED,Gz.m.CALL_HISTORY_RENDERED):(r.push(Gz.m.DIALPAD_RENDERED,Gz.m.CALLS_APP_HISTORY_FETCH_STARTED,Gz.m.CALLS_APP_HISTORY_FETCH_COMPLETED,Gz.m.CALL_HISTORY_RENDERED,Gz.m.CALLS_APP_SPEED_DIAL_FETCH_STARTED,Gz.m.CALLS_APP_SPEED_DIAL_FETCH_COMPLETED,Gz.m.SPEED_DIAL_RENDERED),s.push(Gz.m.CALL_GROUP_OWNERS_RENDERED,Gz.m.CALL_FORWARDING_SETTINGS_RENDERED,Gz.m.AUDIO_DEVICE_SETTINGS_RENDERED));break;case se.w.Rail:a&&(n===ke.ck.speeddial?r.push(Gz.m.CALLS_APP_SPEED_DIAL_FETCH_STARTED,Gz.m.CALLS_APP_SPEED_DIAL_FETCH_COMPLETED,Gz.m.SPEED_DIAL_RENDERED):(r.push(Gz.m.DIALPAD_RENDERED),s.push(Gz.m.CALL_GROUP_OWNERS_RENDERED,Gz.m.CALL_FORWARDING_SETTINGS_RENDERED,Gz.m.AUDIO_DEVICE_SETTINGS_RENDERED)))}return o.registerAppPhase({phase:m.Jj.CRITICAL,signals:r,timeout:i?.critical||1e4}),o.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:s,timeout:i?.postCritical||1e4}),o.appPhases},_5={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainMarkAllCallsAsReadMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"markMissedCallsAsRead"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivityReadStatusUpdateError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorFaced"}}]}}]}}]}}]},D5={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainFireCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},P5=async({commandInput:e,requestContext:{loggerFactory:t,client:n,coreSettings:i}})=>{const{command:{action:a,data:o}}=e,r=t.newLogger("CallsMainApp onCommandReceived","apps-calling");if(e.command.actor===fs)switch(a){case ks:return{entity:{type:ke.ck.callsmain,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}};case Cs:return r.infoToTelemetry?.("[UI]: marking all missed calls as read","calling_badge",void 0,!0),void n.mutate({mutation:_5}).then((({data:e})=>{const t=e?.markMissedCallsAsRead?.errorFaced;t?r.errorToTelemetry?.(`[UI]: marking all as read action failed: ${t}.`,"calling_badge",void 0,!0):r.infoToTelemetry?.("[UI]: successfully marked all missed calls as read","calling_badge",void 0,!0)})).catch((e=>{r.errorToTelemetry?.(`[UI]: marking all as read action failed: ${e.message}.`,"calling_badge",void 0,!0)}));case bs:if(!(e=>"object"==typeof e&&null!==e&&"mri"in e&&"correlationSource"in e)(o))return void r.error(`Command for action '${a}' requires an mri and correlationSource.`);const e=n,{enableTfwTflCallingFederation:t}=i.get(c.w.Calling),s=await(async(e,t,n)=>{const i={callingIntent:{type:"OneToOneCall",joinOptions:{outgoingVideo:!1,outgoingAudio:!0,oneToOne:{sharingSourceId:void 0,...n&&{targetApplicationType:"TFL"}},context:"NovaCommandStartAudioCall"},coordinates:{oneToOne:{mri:t}}}},{data:a}=await e.mutate({mutation:D5,variables:i});return a?.fireCallingIntent?.id})(e,o.mri,!!t);return s?{entity:{type:ke.ck.calls,action:ke.SY.view,id:s},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{intentId:(0,E.v4)(),source:o.correlationSource,startTimestamp:Date.now()}}}:void r.error("Could not fetch the user calling IntentId using user mri");case ws:if(!o||!o.row)return void r.error(`Command '${ws}' requires 'row' in data`);const l=o;return{entity:{type:ke.ck.calllogsummary,action:ke.SY.view,id:l.row.id},entityOptions:l,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:A.p.CallHistory}}};case Is:if(!o||!o.row)return void r.error(`Command '${Is}' requires 'row' in data`);const d=o;return{entity:{type:ke.ck.calllogcopilot,action:ke.SY.view,id:d.row.id},entityOptions:d,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:A.p.CallHistory}}};case Ts:return{entity:{type:ke.ck.speeddial,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:A.p.CallHistory}}};default:r.error(`Command action '${a}' is not supported at CallsMainApp.`)}else r.error(`Command for actor '${e.command.actor}' cannot be handled by CallsMainApp.`)},M5={filter:"/l/launch-callsapp",execute:async({deeplinkUrl:{pathname:e,protocol:t},context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("[Calling][OnBeforeDeeplinkParsed][callsAppDeepLinkCondition]","apps-calling"),{enableCallingRecall:o}=n.get(c.w.Calling),{environment:r}=n.get(c.w.Metadata),s=r===$a.B.life;if(!o||s){const e=`throwing error due to enableCallingRecall=${o} | isTFL=${s}`;throw a.warn?.(e),new Error(e)}return a.log?.(`Executing for protocol=${t}, pathname=${e}`),{entityCommand:{entity:{type:ke.ck.callsmain,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.CallingRecallDeeplinkCondition}}},metadata:{allowAnonymous:!1}}}},R5=[M5],x5=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,890301)),L5=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,451798)),O5=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,235097)),j5=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,819867)),B5=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,118743)),U5=()=>E5.windowFeatures||{},$5=()=>be.Cu.CallsAppSwitch,W5="calls-main-app",V5=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),H5=()=>null;const z5={id:"com.microsoft.teams.cast",name:"CastApp",supportedEntities:[ke.ck.cast],supportedRenderModes:[se.w.Main],windowFeatures:{width:640,height:720,minWidth:640,minHeight:720}},q5=e=>{if(G5(e))return Y5(e)?{subNavEntity:Q5(e),headerEntity:J5(e),startEntity:K5(e),mainEntity:Z5(e),endEntity:X5(e)}:null},G5=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.cast].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Y5=()=>!0,Q5=()=>null,J5=()=>null,K5=()=>null,Z5=({entity:e})=>e,X5=()=>null,e3=()=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:!1,isThemePinnedToDarkOrHighContrast:!0,UNSAFE_enablePptProvider:!0}}}),t3={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==ke.ck.cast,shouldRestoreClientToEntities:()=>!0},n3=()=>Promise.all([n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(185332),n.e(325670),n.e(501156),n.e(216284),n.e(817556),n.e(597362),n.e(101622),n.e(660074),n.e(307422),n.e(94139),n.e(459539),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(927129),n.e(430849),n.e(679354),n.e(463675),n.e(836301),n.e(298265),n.e(909548),n.e(700899),n.e(79368)]).then(n.bind(n,284279)),i3=({host:e})=>{const t=e?.screen;if(!t)return{};if(!z5.windowFeatures)return{};const{minHeight:n,minWidth:i}=z5.windowFeatures,{height:a=1,width:o=1}=z5.windowFeatures,{left:r,top:s}=((e,t,n,i)=>{const a=e.availLeft+e.availWidth/2-t/2;let o;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":o=e.availTop+i;break;default:o=e.availTop+e.availHeight/2-n/2}return{left:a,top:o}})(t,o,a,20);return{additionalFeatures:{minHeight:`${n}`,minWidth:`${i}`},height:a,width:o,left:r,top:s,minHeight:n,minWidth:i}};function a3(){const e=()=>null;return{getAppViewEntities:q5,getAppViewEntitiesProps:e3,getAppWindowFeatures:i3,manifest:z5,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){const e="cast-app";n("ChunkLoadStarted",{chunkName:e});const{CastWizard:t}=await(0,ev.wg)(n3,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})},onBeforeAddToNavigation:t3}}const o3={id:"com.microsoft.teams.communities",name:"CommunitiesApp",getLocalizedName:async e=>(await e.waitForNamespace("communities"),e.stringTranslate("communities","communities_app_name")),actors:[Xr],supportedEntities:[ke.ck.communities,ke.ck.communitiesonboarding,ke.ck.sharecommunitieslink,ke.ck.reportconcerncommunities,ke.ck.communitiesaddmember,ke.ck.communitiesblockmembers,ke.ck.communitiescreatechannel,ke.ck.communitieseditchannel,ke.ck.communitiesdelete,ke.ck.communitiescoverimagedialog,ke.ck.communitiesdeletechannel,ke.ck.communitiesevents,ke.ck.communitiescreateevent,ke.ck.communitiesguidelinesdialog,ke.ck.communitiesmembers,ke.ck.communitiesremovemember,ke.ck.communitiessendpostasemaildialog,ke.ck.communitiesgetappdialog,ke.ck.communitiescreatedialog,ke.ck.communitieswelcomebotconfigdialog,ke.ck.communitieseditdialog,ke.ck.communitiesjoinrequest,ke.ck.communitiesjoininviteview,ke.ck.embedcommunitycodedialog,ke.ck.leavecommunity,ke.ck.percommunitynotificationsettingsdialog,ke.ck.ownerleavecommunity,ke.ck.communitiessettings,ke.ck.communitiesreplychain,ke.ck.communitiescopilot,ke.ck.communitiesnickname,ke.ck.communitiesgallery,ke.ck.communitiesexplore,ke.ck.communitiespendinginvite,ke.ck.featurecommunityapplicationdialog,ke.ck.communitiesfiles,ke.ck.communitiespinnedposts,ke.ck.communitieswebsitelink],supportedRenderModes:[se.w.Main,se.w.HorizontalBar,se.w.Rail,se.w.Modal],getDefaultCommand:()=>({type:ke.ck.communitiesonboarding,action:ke.SY.default}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125}},r3=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("CommunitiesApp onCommandReceived","apps-communities");if(e.command.actor===Xr)return n===es?{entity:{type:ke.ck.communitiesonboarding,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}}:void i.error(`Command action '${n}' is not supported at CommunitiesApp.`);i.error(`Command for actor '${e.command.actor}' cannot be handled by CommunitiesApp.`)};var s3=n(314551);var l3=n(917947);const c3={onEventReceived:async({requestContext:{loggerFactory:e,client:t},eventInput:{event:{originator:n,type:i,data:a},source:o}})=>{const r=e.newLogger("onEventReceived","apps-communities-on-event-received");if(i===Br.mu.expandHeader||i===Br.mu.collapseHeader){const e=i===Br.mu.expandHeader;return await t.mutate({mutation:l3.q,variables:{isExpanded:e}}),{command:ee[i](),source:o}}if(n===s3.Nv)return function(e,t,n,i){switch(t){case s3.mu.createVirtualConsumerEvent:{if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();return(0,s3.Yv)(a)?{command:ms(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`)}case s3.mu.deleteVirtualConsumerEvent:{if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();return(0,s3.x8)(a)?{command:ps(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`)}case s3.mu.editVirtualConsumerEvent:{if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();return(0,s3.OE)(a)?{command:gs(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`)}case s3.mu.joinVirtualConsumerEvent:{if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();return(0,s3.Er)(a)?{command:hs(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`)}case s3.mu.shareVirtualConsumerEvent:{if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();return(0,s3.xl)(a)?{command:vs({...a}),source:i}:void e.error(`Event data is invalid for event type '${t}'.`)}case s3.mu.viewVirtualConsumerEvent:{if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();return(0,s3.Jj)(a)?{command:ys(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`)}default:return void e.error(`Event type '${t}' is not supported by CommunitiesApp.`)}}(r,i,a,o);r.error(`Event from originator '${n}' cannot be handled by CommunitiesApp.`)}};var d3=n(151692),u3=n(988510);const m3=e=>{if(p3(e))return g3(e)?{subNavEntity:h3(e),headerEntity:v3(e),startEntity:y3(e),mainEntity:S3(e),endEntity:f3(e)}:null},p3=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.standard].includes(e),o=[ke.ck.communities,ke.ck.communitiesonboarding,ke.ck.communitiesevents,ke.ck.communitiescreateevent,ke.ck.communitiesmembers,ke.ck.communitiesjoinrequest,ke.ck.communitiesjoininviteview,ke.ck.communitiesblockmembers,ke.ck.communitiessettings,ke.ck.communitiescopilot,ke.ck.communitiesgallery,ke.ck.communitiesfiles,ke.ck.communitiesexplore,ke.ck.communitiespendinginvite].includes(i),r=[ke.SY.default,ke.SY.view,ke.SY.join,ke.SY.manage,ke.SY.update,ke.SY.info],s=n&&r.includes(n);return!!(a&&o&&s)},g3=()=>!0,h3=({entity:e,coreSettings:t})=>{const n=t?.get(c.w.Communities).enableCriticalSignalsInOnboarding;switch(e.type){case ke.ck.communitiesonboarding:if(n&&e.action===ke.SY.default)return e;case ke.ck.communitiescreateevent:return null;default:return e}},v3=({entity:e,coreSettings:t})=>{const n=t?.get(c.w.Communities).enableCriticalSignalsInOnboarding;if(e.type===ke.ck.communitiesonboarding&&!n)return null;const i=t?.get(c.w.Calendar).enableCalendarSchedulingFormMultiSlot;return e.type!==ke.ck.communitiescreateevent||i?e.type===ke.ck.communitiespendinginvite?null:e:null},y3=()=>null,S3=({entity:e})=>e,f3=({entity:e,contextEntity:t})=>{if(t?.type===ke.ck.communitiescopilot){return{id:t.id||e.id||"",action:ke.SY.info,type:ke.ck.communitiescopilot}}return null},k3=({areEmptySlotsTransparent:e,coreSettings:t,entity:n})=>{const i=!!t?.get(c.w.Communities).enableCriticalSignalsInOnboarding,a=!!t?.get(c.w.Communities).enableCommunitiesCoverImage,o=(0,Py.j)(n?.id||"{}"),r=o?.replyChainId,s=(0,Py.j)(n?.options||"{}"),l=s?.isThreadTypeCommunity??(0,u3.ii)(),{toastType:d,teamId:u,activityId:m}=s,p=d&&u!==o?.channelId,g=n?.type,h=n?.action,v=a&&(g===ke.ck.communities||!!i&&g===ke.ck.communitiesonboarding&&h===ke.SY.default)&&!r&&!p&&!m&&l,y=!!t?.get(c.w.MercuryDesign).enableMercuryDesign,S=!!t?.get(c.w.MercuryDesign).enableMercuryShell2_5;return{subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e,isWideSubNav:y}},mainEntity:{[se.w.Main]:{isColorSchemeDefaultBackground2:!0,isSlotBackgroundSemiTransparent2:y&&!S,isColorSchemeDefaultBackground1:S}},headerEntity:{[se.w.HorizontalBar]:{slotHeightOverrides:a||i?"auto":void 0,isHeaderSlotExpandedOnMount:v,isColorSchemeDefaultBackground1:y}}}};var C3=n(175170),b3=n(710090),w3=n(1997),T3=n(145635),I3=n(607630),N3=n(313923),A3=n(214898),E3=n(961286);const F3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCommunitiesPinUnpinPostMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isPinned"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"communityId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"postId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pinUnpinPost"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isPinned"},value:{kind:"Variable",name:{kind:"Name",value:"isPinned"}}},{kind:"Argument",name:{kind:"Name",value:"teamId"},value:{kind:"Variable",name:{kind:"Name",value:"communityId"}}},{kind:"Argument",name:{kind:"Name",value:"channelId"},value:{kind:"Variable",name:{kind:"Name",value:"channelId"}}},{kind:"Argument",name:{kind:"Name",value:"postId"},value:{kind:"Variable",name:{kind:"Name",value:"postId"}}},{kind:"Argument",name:{kind:"Name",value:"correlationId"},value:{kind:"Variable",name:{kind:"Name",value:"correlationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonStandardPostMessageFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAnnouncementPostMessageFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailPostMessageFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingPostMessageFragment"}},{kind:"FragmentSpread",name:{kind:"Name",value:"connectorPostMessage"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonGuardiansPostMessageFragment"}}]}}]}},...w3.f.definitions,...T3.P.definitions,...I3.g.definitions,...N3.v.definitions,...A3.T.definitions,...E3.m.definitions]},_3=async e=>{const{entityCommand:t}=e,{entity:{type:n,action:i}}=t;if(n===ke.ck.communitiespinnedposts&&i===ke.SY.mutate){return await D3(e)}return t},D3=async e=>{const{entityCommand:t,requestContext:n}=e,{userBiService:i,loggerFactory:a,scenarioFactory:o}=n,r=t.entityOptions,s=a.newLogger("CommunitiesOnBeforeCommandHandled","apps-communities");i.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.undo,actionScenario:GR.vB.postPinnedInAppToastUndo,actionScenarioType:GR.DB.communitiesPinnedPosts,moduleName:GR.Sn.inAppToastTextButton,panelType:GR.HP.inAppToast,teamId:r.communityId,threadId:r.channelId});const l=o.newScenario(be.Cu.PinUnpinPost);try{await n.client.mutate({mutation:F3,variables:{...r,isPinned:!0,correlationId:l.id}}),l.stop()}catch(e){const n=`CommunitiesOnBeforeCommandHandled: Failed to unpin post from toast. conversation id: ${r.channelId}, messsage id ${r.postId}`;return s.error(n),l.fail({errors:n}),{entity:{type:ke.ck.communitiespinnedposts,action:ke.SY.error},entityOptions:{isPinned:!0},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{...t.command.correlation,source:A.p.CommunitiesPinnedPostSuccessToast}}}}};var P3,M3=n(413888);!function(e){e.invitecommunity="/l/community/invite",e.message="/l/message",e.community="/l/community",e.createeventcommunity="/l/community/create-event",e.eventscommunity="/l/community/events",e.createpostcommunity="/l/community/create-post",e.createcommunity="/l/community/create",e.editcommunity="/l/community/edit",e.addmembercommunity="/l/community/add-member"}(P3||(P3={}));const R3=Object.values(P3),x3=R3.reduce(((e,t)=>({...e,[t]:Yn.Vd.Community})),{}),L3=new Set(R3),O3=(e,t)=>{const n=(0,u3.FV)(),i=n?{channelId:n}:null;return Promise.resolve({entityCommand:{entity:{type:ke.ck.communities,action:ke.SY.update,...i?{id:JSON.stringify(i)}:{}},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush},entityOptions:{inviteLinkUrl:e.toString(),deepLinkId:t}},metadata:{allowAnonymous:!1}})},j3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesCommunityWithoutPostQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newestCommunityWithoutPosts"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},B3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesLastCreatedCommunityQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lastCreatedCommunity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var U3,$3;!function(e){e.NoChannelId="Parsed communities deep link does not contain the channel id",e.NoJoinCode="Parsed communities join link does not contain the join code",e.MinorAccount="Communities use is forbidden for the minor"}(U3||(U3={})),function(e){e.NoChannelId="channel_on_before_deep_link_parsed_no_channel_id_error",e.NoJoinCode="communities_join_no_join_code_failure",e.MinorAccount="channel_on_before_deep_link_parsed_feature_not_enabled_error"}($3||($3={}));const W3=(e,t,n,i)=>Promise.resolve({entityCommand:{entity:{type:ke.ck.communities,action:ke.SY.view,id:JSON.stringify({channelId:e,replyChainId:t})},command:{stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.show},entityOptions:{deepLinkId:n,...i?{owningTeamId:i}:{},isPostLink:!0}},metadata:{allowAnonymous:!1}}),V3={filter:P3.message,execute:({deeplinkUrl:e,context:{loggerFactory:t,coreSettings:n}})=>{const i=t.newLogger("CommunitiesApp onBeforeDeeplinkParsed","apps-communities"),{pathname:a,search:o}=e;i.log(`Parsing deeplinkUrl - pathname: ${a}, search: ${o}`);const r=a.split("/"),s=r.findIndex((e=>e.startsWith("19:"))),l=new URLSearchParams(o.replace(/&amp;/g,"&")),c=r[s],d=r[s+1],u=l.get("parentMessageId")||void 0,m=l.get("owningTeamId");if((0,M3.MM)(n))throw i.errorToTelemetry?.(U3.MinorAccount,$3.MinorAccount),Error(U3.MinorAccount);if(c)return i.log(`toNavigationIntent - channelId: ${c}, messageId: ${d}`),W3(c,u,d,m);throw i.errorToTelemetry?.(U3.NoChannelId,$3.NoChannelId),Error(U3.NoChannelId)}},H3=({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[3];if((0,M3.MM)(t.coreSettings))throw n.errorToTelemetry?.(U3.MinorAccount,$3.MinorAccount),Error(U3.MinorAccount);return a?((e,t)=>{const{pathname:n,searchParams:i}=t,{deeplinkId:a}=Object.fromEntries(i.entries());for(const e of Array.from(L3)){const i=x3[e];if(n.startsWith(e)&&i)return O3(t,a??(0,E.v4)())}const o="No DeeplinkPrefixType found for the specified deeplinkUrl";return e.error(o),Promise.reject(o)})(n,e):(n.errorToTelemetry?.(U3.NoJoinCode,$3.NoJoinCode),Promise.resolve({entityCommand:{entity:{type:ke.ck.communities,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush}},metadata:{allowAnonymous:!1}}))},z3=({deeplinkUrl:e,context:t})=>H3({deeplinkUrl:e,context:t}),q3={filter:P3.community,execute:z3},G3={filter:P3.invitecommunity,execute:z3},Y3={filter:P3.createcommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{enableCommunitiesCreationDeeplink:i}=t.coreSettings.get(c.w.Communities);return i?Promise.resolve({entityCommand:{entity:{id:"",type:ke.ck.communitiescreatedialog,action:ke.SY.view},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}):(n.debug(`Flag enableCommunitiesCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},Q3={filter:P3.createeventcommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[4];if(!a)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const{enableCommunitiesEventCreationDeeplink:o}=t.coreSettings.get(c.w.Communities);return o?Promise.resolve({entityCommand:{entity:{id:JSON.stringify({channelId:a}),type:ke.ck.communitiescreateevent,action:ke.SY.view},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entityOptions:{isGroup:!0,conversationId:a}},metadata:{allowAnonymous:!0}}):(n.debug(`Flag enableCommunitiesEventCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},J3={filter:P3.eventscommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[4];if(!a)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const{enableCommunitiesEventsDeeplink:o}=t.coreSettings.get(c.w.Communities);return o?Promise.resolve({entityCommand:{entity:{id:a,type:ke.ck.communitiesevents,action:ke.SY.view},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!0}}):(n.debug(`Flag enableCommunitiesEventCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},K3={filter:P3.createpostcommunity,execute:({deeplinkUrl:e,context:t})=>(async({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{enableCommunitiesPostCreationDeeplink:i}=t.coreSettings.get(c.w.Communities);if(!i)return n.debug(`Flag enableCommunitiesPostCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const a=(await t.getUserContexts())[0].context.client,o=await(async()=>{try{const{data:e}=await a.query({query:j3,fetchPolicy:"no-cache"});return e?.newestCommunityWithoutPosts}catch(e){const t=`Error while fetching last created community id. Failed with code: ${e.errorCode}. The reason is: ${e.reason}`;return void n.errorToTelemetry?.(t,"life_web_and_desktop_growth_synthetic_notification_campaign_error")}})();if(!o||!o.id)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const r=o.id;return Promise.resolve({entityCommand:{entity:{id:r,type:ke.ck.communities,action:ke.SY.view},command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}})})({deeplinkUrl:e,context:t})},Z3={filter:P3.editcommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[4];if(!a)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const{enableCommunitiesEditDeeplink:o}=t.coreSettings.get(c.w.Communities);return o?Promise.resolve({entityCommand:{entity:{id:a,type:ke.ck.communitieseditdialog,action:ke.SY.view},command:{correlation:{source:A.p.CommunitiesEditDialog},stateTransition:g.Ar.extend,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!0}}):(n.debug(`Flag enableCommunitiesEditDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},X3={filter:P3.addmembercommunity,execute:({deeplinkUrl:e,context:t})=>(async({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{enableCommunitiesAddMemberDeeplink:i}=t.coreSettings.get(c.w.Communities);if(!i)return n.debug(`Flag enableCommunitiesAddMemberDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const a=(await t.getUserContexts())[0].context.client,o=await(async()=>{try{const{data:e}=await a.query({query:B3,fetchPolicy:"no-cache"});return e?.lastCreatedCommunity}catch(e){const t=`Error while fetching last created community id. Failed with code: ${e.errorCode}. The reason is: ${e.reason}`;return void n.errorToTelemetry?.(t,"life_web_and_desktop_growth_synthetic_notification_campaign_error")}})();if(!o||!o.id)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const r=o.id;return Promise.resolve({entityCommand:{entity:{id:r,type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show},entityOptions:{campaignId:"communityInviteCampaign"}},metadata:{allowAnonymous:!1}})})({deeplinkUrl:e,context:t})},e6=[Q3,K3,Y3,J3,Z3,X3,V3,q3,G3],t6={shouldAddEntitiesToWindowHistory:()=>!0,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>{const{replyChainId:t}=(0,d3.Ep)(e?.id||"");switch(e?.type){case ke.ck.communities:return e?.action===ke.SY.view&&!t;case ke.ck.communitiespendinginvite:return e?.action===ke.SY.join&&!t;case ke.ck.communitiesonboarding:return!0;default:return!1}}},n6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsCommunitiesToastEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"communitiesToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"count"}},{kind:"Field",name:{kind:"Name",value:"teamId"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"channelName"}},{kind:"Field",name:{kind:"Name",value:"reaction"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderMri"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"replyChainId"}},{kind:"Field",name:{kind:"Name",value:"userNickname"}}]}}]}}]};var i6,a6,o6;!function(e){e.Follow="Follow",e.Reply="Reply",e.PersonalReply="PersonalReply",e.ReplyToReply="ReplyToReply",e.MentionInCommunity="MentionInCommunity",e.MentionInSubCommunity="MentionInSubCommunity",e.CommunityMention="CommunityMention",e.ReactionInCommunity="ReactionInCommunity",e.ReactionInSubCommunity="ReactionInSubCommunity",e.CommunityReply="CommunityReply",e.CommunityReplyToReply="CommunityReplyToReply",e.CommunityMembership="CommunityMembership",e.Calendar="Calendar"}(i6||(i6={})),function(e){e.Person="Person",e.Team="Team",e.Community="Community",e.CommunityMembershipJoinRequestCreated="CommunityMembershipJoinRequestCreated",e.CommunityMembershipJoinRequestAccepted="CommunityMembershipJoinRequestAccepted",e.CommunityMembershipPromotedToAdmin="CommunityMembershipPromotedToAdmin",e.NewCalendarEvent="NewCalendarEvent",e.CalendarEventCanceled="CalendarEventCanceled",e.CalendarEventUpdated="CalendarEventUpdated"}(a6||(a6={})),function(e){e.L1="L1",e.L2="L2",e.MemberRequests="MemberRequests",e.MembersView="MembersView"}(o6||(o6={}));const r6="toastNotifications",s6={communitiesPost:"new_community_post_toast_header",reply:"community_reply_toast_header",personalreply:"community_personal_reply_toast_header",mentionInCommunityPerson:"community_mention_person_toast_header",communityMentionEveryone:"community_mention_everyone_toast_header",singleMemberReactionInCommunity:"community_single_member_reaction_header",multipleMembersRactionInCommunity:"community_multiple_members_reaction_header",communityMembershipJoinRequestCreated:"community_join_request_created_toast_header",communityMembershipRequestToJoinAccepted:"community_request_to_join_accepted_header",communityMembershipPromotedToAdmin:"community_membership_promoted_to_admin_header",newCalendarEvent:"new_community_calendar_event_toast_header",calendarEventCancelled:"community_calendar_event_canceled_toast_header",calendarEventUpdated:"community_calendar_event_updated_toast_header"},l6={communityMembershipJoinRequestCreated:"community_join_request_created_toast_text",communityMembershipPromotedToAdmin:"community_membership_promoted_to_admin_toast_text"},c6="communities_toast_event_subscription_job";var d6=n(98073);const u6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},m6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]};async function p6(e,t,n,i){try{const a=await async function(e,t,n){const{data:i}=await e.query({query:u6,variables:{userId:t,displayName:n,profilePictureSize:d6.xi.Small}});return i.msaUserProfilePicture}(e,n,i);if(!a)return void t.errorToTelemetry?.($t.n.ImageUrlGenerationFailed,c6,void 0,!0);const o=await e.query({query:m6,variables:{url:a}});return o?.data.toastImageAsDataUri||void 0}catch(e){return void t.errorToTelemetry?.($t.n.ImageFetchFailed,c6,void 0,!0)}}const g6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchEmoticons"},arguments:[{kind:"Argument",name:{kind:"Name",value:"searchFilter"},value:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}}},{kind:"Argument",name:{kind:"Name",value:"exactMatch"},value:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}}},{kind:"Argument",name:{kind:"Name",value:"includeShortCuts"},value:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}}},{kind:"Argument",name:{kind:"Name",value:"includeKeywords"},value:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}}},{kind:"Argument",name:{kind:"Name",value:"maxResultCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}}},{kind:"Argument",name:{kind:"Name",value:"categoryId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Emoticon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"unicode"}},{kind:"Field",name:{kind:"Name",value:"animation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment_animation"}}]}},{kind:"Field",name:{kind:"Name",value:"etag"}},{kind:"Field",name:{kind:"Name",value:"diverse"}},{kind:"Field",name:{kind:"Name",value:"shortcuts"}},{kind:"Field",name:{kind:"Name",value:"searchMatch"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment_animation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmoticonAnimation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fps"}},{kind:"Field",name:{kind:"Name",value:"framesCount"}},{kind:"Field",name:{kind:"Name",value:"firstFrame"}}]}}]}.definitions]}.definitions]};function h6(e,t){return e!==a6.CommunityMembershipJoinRequestCreated&&t?t:""}const v6="";async function y6({teamName:e,type:t,senderDisplayName:n,senderGivenName:i,subtype:a,count:o,userNickname:r},s,l,c){const d=n||i;if(!d)return v6;const u={senderDisplayName:h6(a,r)||d,teamName:e};switch(t){case i6.Follow:return S6(s6.communitiesPost,u,s);case i6.Reply:case i6.PersonalReply:case i6.ReplyToReply:return S6(s6.reply,u,s);case i6.CommunityReply:return S6(s6.personalreply,u,s);case i6.CommunityReplyToReply:return S6(s6.reply,u,s);case i6.MentionInCommunity:case i6.MentionInSubCommunity:return a===a6.Person?S6(s6.mentionInCommunityPerson,u,s):v6;case i6.CommunityMention:return a===a6.Community?S6(s6.communityMentionEveryone,u,s):v6;case i6.ReactionInCommunity:case i6.ReactionInSubCommunity:const e=await async function(e,t,n){try{const{id:t}=(0,k4.lj)(n?.toLocaleLowerCase().trim());if(!t)return;const{data:i}=await e.query({query:g6,variables:{searchFilter:t,exactMatch:!0}});return(i?.searchEmoticons||[])[0]}catch(e){return void t.errorToTelemetry?.(`communities toast emoticon query failed for ${n}`,"communities_toast_emoticon_query_failed")}}(l,c,a),t=e?.unicode||void 0;return o&&o>0?S6(s6.multipleMembersRactionInCommunity,{...u,emoji:t,count:o},s):S6(s6.singleMemberReactionInCommunity,{...u,emoji:t},s);case i6.CommunityMembership:switch(a){case a6.CommunityMembershipJoinRequestCreated:return S6(s6.communityMembershipJoinRequestCreated,u,s);case a6.CommunityMembershipJoinRequestAccepted:return S6(s6.communityMembershipRequestToJoinAccepted,u,s);case a6.CommunityMembershipPromotedToAdmin:return S6(s6.communityMembershipPromotedToAdmin,u,s)}return v6;case i6.Calendar:switch(a){case a6.NewCalendarEvent:return S6(s6.newCalendarEvent,u,s);case a6.CalendarEventCanceled:return S6(s6.calendarEventCancelled,u,s);case a6.CalendarEventUpdated:return S6(s6.calendarEventUpdated,u,s);default:return v6}default:return v6}}function S6(e,{emoji:t,teamName:n,senderDisplayName:i,count:a},o){return o.stringTranslate(r6,e,{emoji:t,senderDisplayName:i,teamName:n,count:a})}const f6="";function k6(e,{teamName:t,senderDisplayName:n},i){return i.stringTranslate(r6,e,{senderDisplayName:n,teamName:t})}async function C6(e,t,n,i,a){const{conversationId:o,messageId:r,startTimestamp:s,teamName:l,senderMri:d,senderDisplayName:u,type:m,subtype:p,replyChainId:g,text:h,teamId:v}=e,y=await p6(n,i,d,u||""),S=function(e,t){switch(e){case i6.Reply:case i6.PersonalReply:case i6.ReplyToReply:case i6.CommunityReply:case i6.CommunityReplyToReply:case i6.MentionInCommunity:case i6.MentionInSubCommunity:case i6.CommunityMention:case i6.ReactionInCommunity:case i6.ReactionInSubCommunity:return o6.L2;case i6.Follow:case i6.CommunityMembership:if(t)switch(t){case a6.CommunityMembershipJoinRequestCreated:return o6.MemberRequests;case a6.CommunityMembershipJoinRequestAccepted:return o6.L1;case a6.CommunityMembershipPromotedToAdmin:return o6.MembersView}return o6.L1;default:return o6.L1}}(m,p),f=g&&S===o6.L2?g:void 0,k=await y6(e,t,n,i),C=await async function({teamName:e,type:t,senderDisplayName:n,senderGivenName:i,subtype:a,channelName:o,userNickname:r},s,l){const{enableSubCommunitiesToastNotifications:d}=l.get(c.w.Notifications);if(o&&d)return s.stringTranslate(r6,"shared_channel_toast_text",{teamName:e,channelName:o});const u=h6(a,r)||n||i;if(!u)return f6;const m={senderDisplayName:u,teamName:e};if(t===i6.CommunityMembership){switch(a){case a6.CommunityMembershipJoinRequestCreated:return k6(l6.communityMembershipJoinRequestCreated,m,s);case a6.CommunityMembershipPromotedToAdmin:return k6(l6.communityMembershipPromotedToAdmin,m,s)}return f6}return f6}(e,t,a);return{conversationId:o,quickReply:!1,messageId:(b=m,w=p,b===i6.CommunityMembership&&w&&w===a6.CommunityMembershipJoinRequestAccepted?void 0:r),time:new Date(+s),replyChainId:f,text:(C||l||h)??void 0,title:k,mainImage:y?{alt:"",src:y}:void 0,type:m,parentTeamId:v||o};var b,w}function b6(e,t,n,i,a,o,r,s,l){const{enableCommandToHostCommService:d}=t.get(c.w.Core,["enableCommandToHostCommService"]),{enableBrowserToasts:u,enableInAppNotifications:m,enableInAppNotificationsForChatsAndChannels:p}=t.get(c.w.Notifications,["enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"communities-toast-event-subscription",runOncePerId:!0,job:async()=>{const g=i.newLogger("CommunitiesToastEventSubscription","apps-communities");d||u||m&&p?n.subscribe({query:n6,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a,o,r,s,l){const{enableToastCollections:d}=t.get(c.w.Notifications);return async c=>{if(c.errors)return void n.errorToTelemetry?.(`${$t.n.SubscriptionFailed}`,c6,void 0,!0);const u=c?.data?.communitiesToastEvent;if(!u)return void n.errorToTelemetry?.($t.n.EmptyEvent,c6,void 0,!0);const m=i.newScenario(be.Cu.CrossClientToastView,{startTime:+u.startTimestamp});m.clientId=u.correlationId,m.appendEventData({mainEntityType:ke.ck.communities}),m.mark("get_communities_toast_display_data_started");const p={channelId:u.conversationId,replyChainId:u.replyChainId},g=await l({id:JSON.stringify(p),type:ke.ck.communities,action:ke.SY.view},r);if(m.mark(be.BQ.CrossClientConversationFocusChecked),g)return n.infoToTelemetry?.($t.n.ToastSuppressedForWindowInFocus,c6,void 0,!0),void m.stop({reason:$t.n.ToastSuppressedForWindowInFocus});const h=await C6(u,a,r,n,t);if(m.mark("get_communities_toast_display_data_completed"),!h?.title)return m.mark("unhandled_type_in_communities_toast"),n.errorToTelemetry?.(`${$t.n.UnhandledType} ${u.type}`,c6,void 0,!0),void m.stop({reason:$t.n.UnhandledType});switch(d&&(h.collectionId=(0,cB.pP)(e,s,n)),i.hoistScenarioToCore?.(m),u.type){case i6.Calendar:return o.toasts.showCommunitiesCalendarEventsNotifications(u.correlationId,h);case i6.CommunityMembership:switch(u.subtype){case a6.CommunityMembershipJoinRequestCreated:return o.toasts.showCommunitiesMemberRequestsNotifications(u.correlationId,h);case a6.CommunityMembershipPromotedToAdmin:return o.toasts.showCommunitiesMembersViewNotifications(u.correlationId,h)}}return o.toasts.showCommunitiesNotifications(u.correlationId,h)}}(e,t,g,a,o,r,n,s,l)):g.infoToTelemetry?.($t.n.NotEnabled,c6,void 0,!0)}}}const w6=({context:{authenticationUser:e,client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,i18n:o,entityCommanding:r,userTrackingService:s,isEntityInView:l}})=>[b6(e,n,t,i,a,o,r,s,l)],T6=({action:e,appRenderMode:t,coreSettings:n,type:i})=>{const a=new qz.D,{enableComposeCriticalPhaseLoadCommunities:o=!1,communitiesAppPhaseTimeouts:r,enableCriticalSignalsInOnboarding:s=!1}=n.get(c.w.Communities),l=[],d=[];switch(t){case se.w.HorizontalBar:I6({type:i,criticalSignals:l,featureFlags:{enableCriticalSignalsInOnboarding:s},postCriticalSignals:d});break;case se.w.Main:N6({type:i,criticalSignals:l,featureFlags:{enableComposeCriticalPhaseLoadCommunities:o,enableCriticalSignalsInOnboarding:s},postCriticalSignals:d});break;case se.w.Rail:A6({action:e,criticalSignals:l,postCriticalSignals:d,type:i,featureFlags:{enableCriticalSignalsInOnboarding:s}})}return a.registerAppPhase({phase:m.Jj.CRITICAL,signals:l,timeout:r?.critical||25e3}),a.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:d,timeout:r?.postCritical||1e4}),a.appPhases},I6=({criticalSignals:e,type:t,featureFlags:{enableCriticalSignalsInOnboarding:n}})=>{switch(t){case ke.ck.communitiesonboarding:if(!n)break;case ke.ck.communities:case ke.ck.communitiesjoinrequest:case ke.ck.communitiesmembers:e.push(Gz.m.COMMUNITIES_HEADER_RENDERED)}},N6=({criticalSignals:e,featureFlags:{enableComposeCriticalPhaseLoadCommunities:t,enableCriticalSignalsInOnboarding:n},postCriticalSignals:i,type:a})=>{switch(a){case ke.ck.communitiesonboarding:if(!n)break;case ke.ck.communities:e.push(Gz.m.MESSAGES_RENDERED),t?e.push(Gz.m.COMPOSE_LOADED):i.push(Gz.m.COMPOSE_LOADED),i.push(Gz.m.MESSAGE_REACTIONS_RENDERED,Gz.m.PRESENCES_RENDERED,Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED);break;case ke.ck.communitiesjoininviteview:e.push(Gz.m.COMMUNITIES_JOIN_INVITE_VIEW_RENDERED);break;case ke.ck.communitiesjoinrequest:case ke.ck.communitiesmembers:e.push(Gz.m.COMMUNITIES_MANAGE_VIEW_RENDERED)}},A6=({action:e,criticalSignals:t,type:n,featureFlags:{enableCriticalSignalsInOnboarding:i}})=>{i||n!==ke.ck.communities||e!==ke.SY.default?!i||n!==ke.ck.communitiesonboarding&&n!==ke.ck.communities||e!==ke.SY.default&&e!==ke.SY.view||t.push(Gz.m.COMMUNITIES_LIST_DATA_LOADED):t.push(Gz.m.CHANNEL_LIST_ITEMS_RENDERED)},E6=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(185332),n.e(255544),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(306517),n.e(964401),n.e(811751),n.e(405198),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(354130),n.e(300954),n.e(194894),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(862449),n.e(57789),n.e(721630),n.e(867826),n.e(46438),n.e(92464),n.e(131961),n.e(79899),n.e(249917),n.e(392982),n.e(187257),n.e(597272),n.e(831554),n.e(819947),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(563678),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(664960),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(311576),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(214445),n.e(460976),n.e(568202),n.e(391700),n.e(566999),n.e(25522),n.e(465160),n.e(400003),n.e(602692),n.e(868389),n.e(361035),n.e(189542),n.e(275243),n.e(233794),n.e(707334),n.e(388107),n.e(676629),n.e(499675),n.e(514403),n.e(572067),n.e(314122),n.e(857787),n.e(320912)]).then(n.bind(n,326963)),F6=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(185332),n.e(255544),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(306517),n.e(964401),n.e(811751),n.e(405198),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(354130),n.e(300954),n.e(194894),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(862449),n.e(57789),n.e(721630),n.e(867826),n.e(46438),n.e(92464),n.e(131961),n.e(79899),n.e(249917),n.e(392982),n.e(187257),n.e(597272),n.e(831554),n.e(819947),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(563678),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(664960),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(311576),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(214445),n.e(460976),n.e(568202),n.e(391700),n.e(566999),n.e(25522),n.e(465160),n.e(400003),n.e(602692),n.e(868389),n.e(361035),n.e(189542),n.e(275243),n.e(233794),n.e(707334),n.e(388107),n.e(676629),n.e(499675),n.e(514403),n.e(572067),n.e(314122),n.e(857787),n.e(320912)]).then(n.bind(n,819867)),_6=({coreServices:e,host:t,screenState:n,windowOptions:i})=>{const{height:a,minHeight:o,minWidth:r,offset:s,width:l}=o3.windowFeatures||{},d=t?.screenX||0,u=t?.screenY||0,m=(n?.numOpenWindows||1)*(s||1);return{additionalFeatures:{minHeight:`${o}`,minWidth:`${r}`},height:a,left:d+m,minHeight:o,minWidth:r,top:u+m,width:l,...o3.windowFeatures,...e?.coreSettings.get(c.w.Core).enableRatioToScreenBasedSizing&&D6(t,o3.windowFeatures),...i}};function D6(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}const P6=(e,t)=>{const{entity:n,command:i}=e,a=i?.correlation?.source,o=i.stateTransition===g.Ar.flush||i.stateTransition===g.Ar.forceFlush||i.stateTransition===g.Ar.new;if(n.type===ke.ck.communities&&n.action===ke.SY.view&&i.visibilityState===g.Rp.show&&o&&n.id){const{channelId:e,replyChainId:o}=(0,d3.Ep)(n.id,t);if(e){const e=[A.p.ChannelListItem,A.p.CommunitiesList,A.p.ChannelPostMessage,A.p.ChannelRepliesPane];if(a===A.p.CommunitiesPendingInvitesList)return be.Cu.CommunitiesInviteCardSwitch;if(i.stateTransition===g.Ar.new)return o?be.Cu.CommunitiesSwitchL2Popout:void 0;if(o)return be.Cu.CommunitiesSwitchL2;if(e.includes(a))return be.Cu.CommunitiesSwitchL1}}else if(n.action===ke.SY.view&&n.type===ke.ck.communitiesfiles)return be.Cu.P2PFilesListSwitchCommunities};const M6="com.microsoft.teams.homepage",R6={id:M6,name:"HomepageApp",actors:[vm],supportedEntities:[ke.ck.homepage],supportedRenderModes:[se.w.Main],getDefaultCommand:e=>{const{enableTflHomepage:t}=e.get(c.w.Homepage),{coreColdBootAppId:n}=e.get(c.w.Core);if(t&&(n&&n===M6))return{type:ke.ck.homepage,action:ke.SY.default}}},x6=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("HomepageApp onCommandReceived","apps-homepage");if(e.command.actor===vm)return n===ym?{entity:{type:ke.ck.homepage,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}}:void i.log(`Command action '${n}' is not supported at HomepageApp.`);i.log(`Command for actor '${e.command.actor}' cannot be handled by HomepageApp.`)},L6=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(668172),n.e(787454),n.e(181316),n.e(598188),n.e(842242),n.e(984165),n.e(487867),n.e(960122),n.e(231020),n.e(811751),n.e(568721),n.e(845039),n.e(258832),n.e(567830),n.e(178249),n.e(354130),n.e(346069),n.e(826932),n.e(317183),n.e(367741),n.e(461369),n.e(968775),n.e(791296),n.e(845091),n.e(495544),n.e(464079),n.e(326317),n.e(307422),n.e(94139),n.e(467129),n.e(202564),n.e(712284),n.e(601715),n.e(75416),n.e(777944),n.e(652658),n.e(544228),n.e(627867),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(715192),n.e(331703),n.e(936254),n.e(668415),n.e(684694),n.e(813370),n.e(478723),n.e(577607),n.e(108698),n.e(367831),n.e(391),n.e(879803),n.e(515758),n.e(223810),n.e(639495),n.e(506888),n.e(119940),n.e(605837),n.e(247727),n.e(598562),n.e(644740),n.e(914022),n.e(14921),n.e(764553)]).then(n.bind(n,511385)),O6=()=>null,j6=e=>{const{entity:t,command:n}=e;return(n.stateTransition===g.Ar.flush||n.stateTransition===g.Ar.forceFlush||n.stateTransition===g.Ar.new)&&t.type===ke.ck.homepage&&t.action===ke.SY.default?be.Cu.HomepageAppLoad:void 0};const B6=e=>e.type===ke.ck.homepage?"7133fca9-0853-4e7a-bb5d-32d4e5f6020a":void 0,U6={id:"com.microsoft.teams.contacts-sync",name:"ContactsSyncApp",supportedEntities:[ke.ck.contactssync],supportedRenderModes:[se.w.Main,se.w.Modal],windowFeatures:{additionalFeatures:{minHeight:"490",minWidth:"530"},minWidth:530,width:775,minHeight:490,height:585}};var $6=n(898011);const{memo:W6,useEffect:V6,useState:H6,useRef:z6}=Or,q6=()=>Promise.all([n.e(912845),n.e(273198),n.e(320494),n.e(120951),n.e(984552),n.e(169767),n.e(248327),n.e(938490),n.e(625303),n.e(53966),n.e(331703),n.e(223810),n.e(998082),n.e(168601)]).then(n.bind(n,628454)),G6=()=>Promise.all([n.e(598188),n.e(185332),n.e(56538),n.e(495544),n.e(472903),n.e(896808),n.e(484898)]).then(n.bind(n,501416)),Y6=()=>Promise.all([n.e(951007),n.e(959745)]).then(n.bind(n,720892)),Q6=()=>null,J6=W6((({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const{entity:i}=(0,FX.At)(),{id:a}=i,[o,r]=H6((()=>Q6)),s=z6({});switch(V6((()=>{let i=!1;return(async()=>{switch(a){case void 0:case null:case $6.Y.Default:if(e===se.w.Main||e===se.w.Modal){const e="contacts-sync-dialog";t("ChunkLoadStarted",{chunkName:e});const[{ContactsSyncDialog:a}]=await Promise.all([(0,ev.wg)(q6,e,n)]);if(t("ChunkLoadSucceeded",{chunkName:e}),i)return;r((()=>a))}break;case $6.Y.MobileSync:if(e===se.w.Modal||e===se.w.Main){const e="contacts-sync-mobile-sync-dialog";t("ChunkLoadStarted",{chunkName:e});const[{ContactsSyncMobileSyncDialog:a}]=await Promise.all([(0,ev.wg)(G6,e,n)]);if(t("ChunkLoadSucceeded",{chunkName:e}),i)return;r((()=>a))}break;case $6.Y.MobileUnsync:if(e===se.w.Modal){const e="contacts-sync-mobile-unsync-dialog";t("ChunkLoadStarted",{chunkName:e});const[{ContactsSyncMobileUnsyncDialog:a}]=await Promise.all([(0,ev.wg)(Y6,e,n)]);if(t("ChunkLoadSucceeded",{chunkName:e}),i)return;r((()=>a))}}})(),()=>{i=!0}}),[a,t,n,e,r]),a){case void 0:case null:case $6.Y.Default:case $6.Y.MobileSync:e!==se.w.Main&&e!==se.w.Modal||(s.current={isModal:e===se.w.Modal});break;case $6.Y.MobileUnsync:e===se.w.Modal&&(s.current={})}return(0,Lr.Y)(o,{...s.current})})),K6=()=>U6.windowFeatures||{};function Z6(){const e=()=>null;return{getAppWindowFeatures:K6,manifest:U6,render:async({appRenderMode:t,entity:n,onRenderEvent:i,scenarioFactory:a})=>"contactssync"===n.type?(0,Lr.Y)(J6,{appRenderMode:t,onRenderEvent:i,scenarioFactory:a}):(0,Lr.Y)(e,{})}}const X6={id:"com.microsoft.teams.discover-surface",name:"DiscoverSurfaceApp",supportedEntities:[ke.ck.discoversurface,ke.ck.discoversurfacesettings],supportedRenderModes:[se.w.Main,se.w.Rail,se.w.HorizontalBar,se.w.Modal],getDefaultCommand:()=>({type:ke.ck.discoversurface,action:ke.SY.default})},e8=e=>{if(t8(e))return n8(e)?{subNavEntity:i8(e),headerEntity:a8(e),startEntity:o8(e),mainEntity:r8(e),endEntity:s8(e)}:null},t8=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.standard].includes(e),o=[ke.SY.view,ke.SY.default],r=n&&o.includes(n),s=[ke.ck.discoversurface].includes(i);return!!(a&&s&&r)},n8=()=>!0,i8=({coreSettings:e})=>{const{enableHybridChannelList:t}=e?.get(c.w.Host)||{};return t?{action:ke.SY.list,entityState:{flushableByLinkedEntity:!0},id:null,linkedEntity:null,options:null,type:ke.ck.channels,windowOptions:null}:null},a8=({entity:e})=>e,o8=()=>null,r8=({entity:e})=>e,s8=()=>null,l8=()=>({}),c8=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{criticalPhaseTimeout:i,postCriticalPhaseTimeout:a}=t.get(c.w.DiscoverSurface),o=[];switch(e){case se.w.HorizontalBar:o.push(Gz.m.DISCOVER_SURFACE_HEADER_RENDERED);break;case se.w.Main:o.push(Gz.m.DISCOVER_SURFACE_VIEW_RENDERED)}return n.registerAppPhase({phase:m.Jj.CRITICAL,signals:o,timeout:i||25e3}),n.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:a||1e4}),n.appPhases};var d8=n(502111);const u8=e=>be.Cu.DiscoverSurfaceSwitchV2,m8=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(185332),n.e(255544),n.e(325670),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(306517),n.e(964401),n.e(811751),n.e(405198),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(354130),n.e(300954),n.e(194894),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(721630),n.e(867826),n.e(46438),n.e(92464),n.e(131961),n.e(249917),n.e(597272),n.e(831554),n.e(462886),n.e(954410),n.e(549475),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(563678),n.e(562201),n.e(272115),n.e(117721),n.e(244016),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(311576),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(214445),n.e(460976),n.e(568202),n.e(391700),n.e(566999),n.e(25522),n.e(400003),n.e(602692),n.e(868389),n.e(768173),n.e(189542),n.e(233794),n.e(388107),n.e(676629),n.e(499675),n.e(514403),n.e(857787),n.e(804902)]).then(n.bind(n,668195)),p8=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(185332),n.e(255544),n.e(325670),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(306517),n.e(964401),n.e(811751),n.e(405198),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(354130),n.e(300954),n.e(194894),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(721630),n.e(867826),n.e(46438),n.e(92464),n.e(131961),n.e(249917),n.e(597272),n.e(831554),n.e(462886),n.e(954410),n.e(549475),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(563678),n.e(562201),n.e(272115),n.e(117721),n.e(244016),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(311576),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(214445),n.e(460976),n.e(568202),n.e(391700),n.e(566999),n.e(25522),n.e(400003),n.e(602692),n.e(868389),n.e(768173),n.e(189542),n.e(233794),n.e(388107),n.e(676629),n.e(499675),n.e(514403),n.e(857787),n.e(804902)]).then(n.bind(n,819867)),g8="discover-surface-app";function h8(){const e=()=>null;return{manifest:X6,render:async({appRenderMode:t,entity:n,scenarioFactory:i,onRenderEvent:a})=>{if(a("ChunkLoadStarted",{chunkName:g8}),t===se.w.Modal&&n.type===ke.ck.discoversurfacesettings){const{DiscoverSurfaceUserPreferencesDialogLazyRenderer:e}=await(0,ev.wg)(m8,g8,i);return(0,Lr.Y)(e,{})}const[{DiscoverFeed:o,DiscoverSurfaceHeader:r},{LPC:s}]=await Promise.all([(0,ev.wg)(m8,g8,i),(0,ev.wg)(p8,g8,i)]);return a("ChunkLoadSucceeded",{chunkName:g8}),t===se.w.Main||t===se.w.HorizontalBar?(0,Lr.Y)(vG.e,{namespaces:["channels","teamsAndChannels","funstuff","discoverSurface"],loaderRenderer:null,children:[t===se.w.Main&&(0,Lr.Y)(s,{children:(0,Lr.Y)(wJ.CA,{children:(0,Lr.Y)(d8.L1,{children:(0,Lr.Y)(o,{})})})}),t===se.w.HorizontalBar&&(0,Lr.Y)(r,{})]}):(0,Lr.Y)(e,{})},getAppPhases:c8,getAppViewEntities:e8,getAppViewEntitiesProps:l8,getCommandScenarioName:u8}}var v8=n(51713);const y8=e=>{if(S8(e))return{subNavEntity:f8(e),headerEntity:k8(e),startEntity:C8(e),mainEntity:b8(e),endEntity:w8(e)}},S8=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=i===ke.ck.error,r=n===ke.SY.view;return!!(a&&o&&r)},f8=()=>null,k8=()=>null,C8=()=>null,b8=({entity:e})=>e,w8=()=>null,T8=()=>({mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,isBackgroundTransparent:!0}}});var I8=n(258322);const N8={id:"com.microsoft.teams.error",name:"ErrorApp",supportedEntities:[ke.ck.error],supportedRenderModes:[se.w.Main]};var A8=n(139150);const{useMemo:E8}=Or;const F8=async(e,t)=>{if(e!==se.w.Main)return(0,Lr.Y)(wX.f,{});const{ErrorActionContextProvider:i,ErrorPage:a}=await Promise.all([n.e(320494),n.e(224316),n.e(120951),n.e(914945),n.e(311914),n.e(725973),n.e(428348),n.e(669152),n.e(616161),n.e(524147),n.e(296930),n.e(5982),n.e(353927),n.e(505772),n.e(597680),n.e(965787),n.e(674958),n.e(221963),n.e(927767),n.e(524014),n.e(383414),n.e(634370),n.e(475841),n.e(407772)]).then(n.bind(n,110658));return(0,Lr.Y)((()=>{const{getEntityOptions:e}=(0,FX.At)(),{serializedError:n}=e(ke.ck.error,ke.SY.view),o=(0,A8.m)(),{coreSettings:r,host:s,loggerFactory:l}=(0,QX.ur)(),c=l.newLogger("ErrorAppViewsRenderer","apps-error"),{isOnline:d}=(0,QX.WB)(),u=n&&function(e){let t;try{t=JSON.parse(e)}catch(t){return new I8.B(t,{source:"error-app",serializedError:e})}const n=D8(t);return null!=n?n:new I8.B(new Error(e),{source:"error-app",serializedError:e})}(n),m=d?u||new Ha.a(Ha.D.UNKNOWN):new Ha.a(Ha.D.NETWORK_OFFLINE);_8(d,t,n,c);const{hostCommunicationService:p}=(0,v8.C)(),g=E8((()=>({client:o,coreSettings:r,loggerFactory:l,hostCommunicationService:p})),[o,r,l,p]);return(0,Lr.Y)(i,{errorActionServices:g,children:(0,Lr.Y)(a,{error:m,coreSettings:r,windowProvider:s,skipFluentThemeProvider:!0})})}),{})},_8=(e,t,n,i)=>{e?(i.errorToTelemetry&&i.errorToTelemetry("ErrorAppViewsRenderer: errorApp caught an error.","webclient_framework_foundation_apps_error"),i.error(`ErrorAppViewsRenderer: errorApp caught an error message:${n}`),t("RenderingFailure",{errorInfo:k.Q.ErrorAppError,errorMessage:n})):t("RenderingCanceled",{errorInfo:k.Q.NetworkOffline})};function D8(e){if(!e)return;if(e.prevError){const t=D8(e.prevError);t&&(e.prevError=t)}let t=null;switch(e?.type){case"AuthError":t=wr.l.fromSerialized(e);break;case"CoreError":t=Ha.a.fromSerialized(e);break;case"TaskError":t=br.fromSerialized(e)}return t}const P8={id:"com.microsoft.teams.esp",name:"EspApp",supportedEntities:[ke.ck.esp,ke.ck.esppinteamstotaskbar],supportedRenderModes:[se.w.Modal],getDefaultCommand:()=>({type:ke.ck.esp,action:ke.SY.default}),windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}};var M8=n(797111);class R8{constructor(e,t){this.userBiService=e,this.logger=t.newLogger("esp-bi-telemetry","apps-esp")}recordEspPanelView(e,t,n,i){const a=this.userBiService?.createDatabag?.();a&&(a.identifier=t,a.irisCampaignId=i);const o={panelType:n?GR.HP.EligibleEngagementSurface:GR.HP.DisplayedEngagementSurface,panelRegion:(0,M8.qE)(e),dataBag:a};this.userBiService?.recordPanelView(o,this.logger),a&&a.dispose()}}const x8=()=>Promise.all([n.e(767232),n.e(34200)]).then(n.bind(n,210576)),L8=async e=>(0,ev.wg)(x8,"esp-engine",e);var O8=n(81014);const j8="growth_growthplatform_start_esp_job",B8="growth_growthplatform_esp_engine";function U8(e){const{client:t,coreSettings:n,entityCommanding:i,loggerFactory:a,platformService:o,scenarioFactory:r,userBiService:s,authenticationUser:l,isMainWindow:d}=e;return{id:"start-esp-app-ready-hander",runOncePerId:!0,job:async()=>{const{enableEsp:e,enableEspAppReadyWindowWarmTrigger:u,enableFirstRunTrigger:m,enableSetFirstLoginInformation:p}=n.get(c.w.Esp);if(!l?.type||"Anonymous"===l?.type)return;if(!d)return;const g=a.newLogger("esp-engine","apps-esp");g.debug("AppReady handler started");let h=!1;if(p){const e=await(0,O8.wj)(t,g);try{const n=await async function(e,t){const{clientType:n}=t?.config??{},i=n===nt.sK.Maglev&&!e?.maglev,a=n===nt.sK.Web&&!e?.WebNorthStar;return i?"maglev":a?"WebNorthStar":void 0}(e,o);n&&(g.log("Setting first login information"),h=!0,await(0,O8.Dk)(t,n,new Date,e,g))}catch(e){const t=(0,Je.rX)(e);g.errorToTelemetry?.(`Failed to update first login information ${t}`,j8)}}e&&u&&(h&&m?await $8(t,n,a,r,i,s,o,l,g,"FirstRun"):await $8(t,n,a,r,i,s,o,l,g,"AppReady"))}}}async function $8(e,t,n,i,a,o,r,s,l,d){const{enableBlockingUntilAppReadyTriggers:u}=t.get(c.w.Esp);try{const{displayEspSurface:l}=await L8(i),c=await l(e,t,n,r,d,new R8(o,n),s);if(c){const{entity:{id:e,type:t}}=c;e&&a.esp.launchDialog(e,t)}}catch(e){const t=(0,Je.rX)(e);l.errorToTelemetry?.(`${d} failed to show any surface. Error: ${t}`,B8)}finally{u&&(0,O8.M_)(e,l)}}const W8={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsEspTriggerSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espTriggerEvent"}}]}}]};function V8(e){const{client:t,coreSettings:n,authenticationUser:i}=e;return{id:"esp-time-based-trigger-job",runOncePerId:!0,job:async()=>{const{enableEsp:a,enableTimeBasedEspTrigger:o}=n.get(c.w.Esp);if(!a||!o)return;if(!i?.type||"Anonymous"===i?.type)return;const r=t.subscribe({query:W8,fetchPolicy:"no-cache"}).subscribe((()=>async function(e){const{client:t,coreSettings:n,loggerFactory:i,platformService:a,scenarioFactory:o,userBiService:r,authenticationUser:s}=e,l="esp_time_based_trigger_job",c=i.newLogger(l,"apps-esp");try{const{displayEspSurface:e}=await L8(o);await e(t,n,i,a,"Daily",new R8(r,i),s),c.infoToTelemetry?c.infoToTelemetry("Daily Trigger was invoked",l):c.log("Daily Trigger was invoked")}catch(e){const t=(0,Je.rX)(e);c.errorToTelemetry?c.errorToTelemetry(`Daily Trigger has an error ${t}`,l):c.error("Daily Trigger has an error")}}(e)));return()=>{r.unsubscribe()}}}}const H8={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsEspHostCommunicationMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isConsumer"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tryPinningTeamsApp"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isConsumer"},value:{kind:"Variable",name:{kind:"Name",value:"isConsumer"}}}]}]}}]},z8=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i,id:a},entityOptions:o},requestContext:{client:r,coreSettings:s,loggerFactory:l,platformService:d,scenarioFactory:u,userBiService:m,authenticationUser:p}}=e,{enableEsp:g}=s.get(c.w.Esp),h=a||void 0;if(!p?.type||"Anonymous"===p?.type)return t;if(n!==ke.ck.esppinteamstotaskbar||i!==ke.SY.empty){if(n===ke.ck.esp&&i===ke.SY.create){let e;if(g){const t=l.newLogger("esp-engine","apps-esp"),{forceShow:n,triggerType:i,customParams:a,windowId:c}=o||{},g="FollowUp"===i?"FollowUp":"Manual";try{const{displayEspSurface:t}=await L8(u);e=await t(r,s,l,d,g,new R8(m,l),p,{surfaceId:h,forceShow:n,customParams:a},c)}catch(e){const n=(0,Je.rX)(e);t.errorToTelemetry?.(`${g} failed to show any surface. Error: ${n}`,"growth_growthplatform_esp_engine",{surfaceId:h})}}return e}return t}await r.mutate({mutation:H8,variables:{isConsumer:(o||{})?.isConsumer??!0},fetchPolicy:"no-cache"})},q8={filter:"/l/help-action-button",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{n.newLogger("[ESP][/help-action-button]","apps-esp").debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableStartChatActionButtonDeeplink:a,enableDeleteChatActionButtonDeeplink:o}=i.get(c.w.Help,["enableStartChatActionButtonDeeplink","enableDeleteChatActionButtonDeeplink"]);return a&&e.includes("/start-chat")?G8("startChatActionButtonCoachmark"):o&&e.includes("/delete-chat")?G8("deleteChatActionButtonCoachmark"):void 0}},G8=e=>({entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.view},command:{stateTransition:g.Ar.none,visibilityState:g.Rp.show},entityOptions:{actionButtonSurfaceId:e}},metadata:{allowAnonymous:!1}}),Y8=[{filter:"/l/campaign/chat",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/campaign/chat]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableSyntheticNotificationCampaignDeeplink:o}=i.get(c.w.Esp),r="toast"===t.get("source")?g.Ar.new:g.Ar.flow;return o?{entityCommand:{entity:{id:"chatCampaign",type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:r,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableSyntheticNotificationCampaignDeeplink is not enabled. Skipping deeplink processing.")}},{filter:"/l/discover-teams",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/discover-teams]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableDiscoverTeamsDeeplink:o}=i.get(c.w.Esp);return o?{entityCommand:{entity:{id:"",type:ke.ck.teamsgallery,action:ke.SY.view},command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableDiscoverTeamsDeeplink is not enabled. Skipping deeplink processing.")}},{filter:"/l/campaign/do-it-later",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][l/campaign/do-it-later]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableDoItLaterPhonelinkCampaign:o}=i.get(c.w.Esp),r="toast"===t.get("source")?g.Ar.new:g.Ar.flow;return o?{entityCommand:{entity:{id:"doItLaterPhonelinkCampaign",type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:r,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableDoItLaterPhonelinkCampaign is not enabled. Skipping deeplink processing.")}},{filter:"/l/exploratory-awareness",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/exploratory-awareness]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableExploratoryAwarenessDeeplink:o}=i.get(c.w.Smb);return o?{entityCommand:{entity:{id:"exploratoryAwarenessCampaign",type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableExploratoryAwarenessDeeplink is not enabled. Skipping deeplink processing.")}},q8,{filter:"/l/campaign/meeting",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/campaign/meeting]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableSyntheticNotificationCampaignDeeplink:o}=i.get(c.w.Esp),r="toast"===t.get("source")?g.Ar.new:g.Ar.flow;return o?{entityCommand:{entity:{id:"meetingCampaign",type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:r,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableSyntheticNotificationCampaignDeeplink is not enabled. Skipping deeplink processing.")}},{filter:"/l/phonelink",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][l/phonelink]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enablePhonelinkCampaign:o}=i.get(c.w.Esp),r="toast"===t.get("source")?g.Ar.new:g.Ar.flow;return o?{entityCommand:{entity:{id:"phonelinkCampaign",type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:r,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableSynteticNotificationCampaignDeeplink is not enabled. Skipping deeplink processing.")}},{filter:"/l/esp/whats-new-content",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/esp/whats-new-content]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableWhatsNewContentDeeplink:o}=i.get(c.w.Growth,["enableWhatsNewContentDeeplink"]),r="toast"===t.get("source")?g.Ar.new:g.Ar.flow;return o?{entityCommand:{entity:{id:"whatsNewCampaign",type:ke.ck.campaignnotifications,action:ke.SY.view},command:{stateTransition:r,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableWhatsNewContentDeeplink is not enabled. Skipping deeplink processing.")}}],Q8={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsEspSyntheticNotificationToastSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syntheticNotificationToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderId"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"campaignType"}},{kind:"Field",name:{kind:"Name",value:"imageUrl"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}}]}}]}}]},J8={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEspToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"credentials"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}},{kind:"Argument",name:{kind:"Name",value:"credentials"},value:{kind:"Variable",name:{kind:"Name",value:"credentials"}}}]}]}}]};var K8;function Z8(e){const{client:t,coreSettings:n,i18n:i,entityCommanding:a,loggerFactory:o,authenticationUser:r}=e;return{id:"esp-synthetic-notification-toast-subscription-job",runOncePerId:!0,job:async()=>{const{enableEsp:e,enableSyntheticNotificationToast:s}=n.get(c.w.Esp);if(!e||!s)return;if(!r?.type||"Anonymous"===r?.type)return;const l=t.subscribe({query:Q8,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a){return async o=>{const r=n.newLogger("SyntheticNotificationToastEventSubscription","apps-esp");if(o.errors){const e=(0,ge.hR)(o.errors.map((e=>e.message)).join());return void r.error?.(`${$t.n.SubscriptionFailed} ${e}`)}if(!o.data?.syntheticNotificationToastEvent)return void r.error?.($t.n.EmptyEvent);const{syntheticNotificationToastEvent:s}=o.data,l=function(e,t,n,i){return{conversationId:t.messageId,messageId:t.messageId,quickReply:!1,time:new Date(+t.timestamp),text:e7(e,t,"description",n),title:e7(e,t,"title",n),type:"SyntheticNotification",campaignType:t.campaignType??void 0,deeplinkUrl:X8(t,i)}}(t,s,r,a),c=await t7(i,r,s.imageUrl||void 0);return c&&(l.mainImage={alt:"",src:c}),l.campaignType?e.toasts.showEspSyntheticNotificationWithCampaignType(s.correlationId,l):e.toasts.showEspSyntheticNotification(s.correlationId,l)}}(a,i,o,t,n));return()=>{l.unsubscribe()}}}}function X8(e,t){const{enableDeeplinkNotifications:n,disallowedDeeplinkApps:i}=t.get(c.w.Notifications,["enableDeeplinkNotifications","disallowedDeeplinkApps"]),a=n&&!i?.includes("synthetic-notifications")?e.deeplinkUrl:void 0;if(a){const e=new URL(a);return e.searchParams.set("source","toast"),e.toString()}return a??void 0}function e7(e,t,n,i){if(t.campaignType){const a=(()=>{switch(t.campaignType){case K8.meeting:return`activity_esp_meeting_recommendation_${n}`;case K8.chat:return`activity_esp_chat_recommendation_${n}`;case K8.upgrade:return`activity_esp_upgrade_recommendation_${n}`;case K8.files:return`activity_esp_files_recommendation_${n}`;default:return void i.error(`Campaign Type is not valid ${t.campaignType}`)}})();return a?e.stringTranslate("activity",a):""}return"title"===n?t.title||"":t.text||""}!function(e){e.chat="chatCampaign",e.meeting="meetingCampaign",e.upgrade="upgradeCampaign",e.files="filesCampaign"}(K8||(K8={}));const t7=async(e,t,n)=>{if(n)try{const t=await e.query({query:J8,fetchPolicy:"no-cache",variables:{url:n,credentials:"omit"}});return t?.data.toastImageAsDataUri||void 0}catch(e){return void t.error($t.n.ImageFetchFailed)}};const n7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ComponentsEspCommonEspSurfacesUpdateSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espSurfacesUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ComponentsEspCommonSurfaceFragment"}}]}}]}},...n(958970).t_.definitions]};var i7=n(710837),a7=n(425415);const o7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsEspSurfaceShownSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"surfaceIds"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espSurfaceShownEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"surfaceIds"},value:{kind:"Variable",name:{kind:"Name",value:"surfaceIds"}}}]}]}}]};class r7{constructor(e,t,n,i,a,o,r,s){this.logger=i,this.entityCommanding=a,this.parseExpression=o,this.getEspConfig=r,this.displaySurface=s;const l=t.getObservable(c.w.Esp);this.biSurfaces=this.toBiSurfaces(e),this.configSubscription=l.subscribe((async()=>{await this.updateSurfaces()})),this.espCdlSurfaceSubscription=n.subscribe({query:n7,fetchPolicy:"no-cache"}).subscribe((async()=>{await this.updateSurfaces(),await n.query({query:i7.e,fetchPolicy:"network-only"})})),this.surfaceShownSubscription=n.subscribe({query:o7,variables:{surfaceIds:this.biSurfaces.map((e=>e.id))},fetchPolicy:"no-cache"}).subscribe((async()=>{await this.updateSurfaces()}))}async onSignal(e){const t=this.biSurfaces.filter((t=>t.invoke(e))).map((e=>e.id));if(!t.length)return;let n=e.data["Panel.WindowID"];this.isEventFromSyntheticNotificationToast(e)&&(n=a7.A$);const i=await this.displaySurface(t,n);if(i){const{entity:{id:e,type:t}}=i;e&&this.entityCommanding.esp.launchDialog(e,t)}}unsubscribe(){this.configSubscription.unsubscribe(),this.surfaceShownSubscription.unsubscribe(),this.espCdlSurfaceSubscription.unsubscribe()}toBiSurfaces(e){return e.filter((e=>-1===e.recur||e.recur>e.displayed.length)).filter((e=>"BIEvent"===e.trigger)).map((e=>{try{const t=this.parseExpression(e.triggerFilter||"");return{id:e.id,invoke:e=>t.evaluate(e)}}catch{return void this.logger.error(`invalid BITrigger trigger filter value for surface ${e.id} with triggerFilter ${e.triggerFilter}`)}})).filter((e=>!!e))}isEventFromSyntheticNotificationToast(e){return"SyntheticNotification"===e.data["Panel.Type"]&&"toast"===e.data["Panel.Region"]}async updateSurfaces(){const{surfaces:e}=await this.getEspConfig();this.biSurfaces=this.toBiSurfaces(e)}}const s7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsEspRecordCompletedActionMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actions"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recordEspCompletedActions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"actions"},value:{kind:"Variable",name:{kind:"Name",value:"actions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"completedActions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"action"}}]}}]}}]}}]};var l7=n(51653);class c7{constructor(e,t,n,i,a,o){this.logger=t,this.parseExpression=n,this.client=i,this.coreSettings=a;const r=a.getObservable(c.w.Esp);this.actionRegistrations=this.getActionRegistrations(e),this.configSubscription=r.subscribe((async()=>{const{espState:e}=await o();this.actionRegistrations=this.getActionRegistrations(e)}))}onSignal(e){const t=this.actionRegistrations.filter((t=>t.invoke(e))).map((e=>e.action));if(t.length){this.actionRegistrations=this.actionRegistrations.filter((e=>-1===t.indexOf(e.action)));const{enableEspStateApolloCache:e}=this.coreSettings.get(c.w.Esp);this.client.mutate({mutation:s7,variables:{actions:t},refetchQueries:e?[{query:l7.L,fetchPolicy:"no-cache"}]:void 0})}}unsubscribe(){this.configSubscription.unsubscribe()}getActionRegistrations(e){const t=e.userState.completedActions.reduce(((e,t)=>e.add(t.action)),new Set);return this.getEspTrackedActions(this.coreSettings).filter((e=>!t.has(e.action))).map((e=>{try{const t=this.parseExpression(e.expression);return{action:e.action,invoke:e=>t.evaluate(e)}}catch{return void this.logger.errorToTelemetry?.(`invalid data registration expression for action ${e.action} with expression ${e.expression}`,"esp_signal_handler")}})).filter((e=>!!e))}getEspTrackedActions(e){const t=e.get(c.w.Esp),n=[];return Object.keys(t).forEach((e=>{const i=t[e];i?.trackedAction&&!i?.disabled&&n.push({action:i.trackedAction,expression:i.expression})})),n}}class d7{onSignal(e){}unsubscribe(){}}function u7(e){const{coreSettings:t,userBiService:n,scenarioFactory:i,client:a,loggerFactory:o,platformService:r,entityCommanding:s,authenticationUser:l}=e;return{id:"esp-signal-handler-job",runOncePerId:!0,job:async()=>{const{enableEsp:e,enableEspBiEventTrigger:d,enableEspCompletedActions:u}=t.get(c.w.Esp);if(!e)return;if(!l?.type||"Anonymous"===l?.type)return;if(!d&&!u)return;const{getConfig:m,parseExpression:p,displayEspSurface:g}=await L8(i),h=o.newLogger("esp-signal-handler-job","apps-esp"),{surfaces:v,espState:y}=await m(a,t,h),S=()=>m(a,t,h,"network-only"),f=d?new r7(v,t,a,h,s,p,S,((e,i)=>g(a,t,o,r,"BIEvent",new R8(n,o),l,{surfaceIds:e},i))):new d7,k=u?new c7(y,h,p,a,t,S):new d7,C=n?.observe?.().subscribe({next:async e=>{k.onSignal(e),f.onSignal(e)}});return()=>{C?.unsubscribe(),f.unsubscribe(),k.unsubscribe()}}}}const m7="settings",p7="openScheduleOOF",g7="setStatusMessage",h7="changeAppTheme",v7=e=>({actor:m7,action:h7,data:e});var y7=n(812589);const S7={onEventReceived:async e=>{const t=e.requestContext.loggerFactory.newLogger("apps-esp-event-handler","apps-esp"),n=e.eventInput.event;if(n.originator===y7.Nv){if(n.type===y7.mu.changeAppTheme){const e=n.data?.();return Promise.resolve({command:v7(e)})}return t.warn("Theme change request contains an invalid type",n.type),Promise.resolve(void 0)}return t.warn("Unhandled event originator",n.originator),Promise.resolve(void 0)}},f7=()=>Promise.all([n.e(502175),n.e(383414),n.e(743566),n.e(670225),n.e(177655),n.e(769430)]).then(n.bind(n,943882));function k7(){const e=()=>null;return{manifest:P8,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Modal){const e="esp-dialog";n("ChunkLoadStarted",{chunkName:e});const{EspDialogComponent:t}=await(0,ev.wg)(f7,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})},onPreWarm:e=>{const{context:t}=e;return[V8(t),Z8(t),u7(t)]},onUserWindowPreWarm:e=>{const{context:t}=e;return[U8(t)]},onBeforeCommandHandled:z8,onBeforeDeeplinkParsed:Y8,eventHandlers:S7}}const C7={id:"com.microsoft.teams.filePicker",name:"FilePickerApp",supportedEntities:[ke.ck.filepicker],supportedRenderModes:[se.w.Modal]},b7=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(616161),n.e(487867),n.e(325670),n.e(501156),n.e(484331),n.e(736709),n.e(216284),n.e(636192),n.e(393706),n.e(79981),n.e(817556),n.e(280759),n.e(598200),n.e(506289),n.e(289847),n.e(153959),n.e(50150),n.e(834742),n.e(962777),n.e(458391),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(977204),n.e(784980),n.e(262010),n.e(725353),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(214467),n.e(679354),n.e(397928),n.e(463675),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(367831),n.e(233794),n.e(298265),n.e(195009),n.e(350226),n.e(764852),n.e(811969),n.e(446090),n.e(96657),n.e(599984)]).then(n.bind(n,533499));function w7(){const e=()=>null;return{manifest:C7,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{const o=a.newLogger("FilePickerApp","apps-file-picker");if(t===se.w.Modal){const e="file-picker-app";o.log("chunk load start"),n("ChunkLoadStarted",{chunkName:e}),o.log("experimental import start");const{FilePickerComposeDialogRenderer:t}=await(0,ev.wg)(b7,e,i);return o.log("report chunk load success"),n("ChunkLoadSucceeded",{chunkName:e}),o.log("Rendering file picker compose dialog"),(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})}}}const T7={id:"com.microsoft.teams.add-cloud-storage-folder-dialog",name:"AddCloudStorageFolderDialogApp",supportedEntities:[ke.ck.cloudStorageDialog],supportedRenderModes:[se.w.Modal]},I7=()=>Promise.all([n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(428348),n.e(325670),n.e(501156),n.e(216284),n.e(817556),n.e(834742),n.e(307422),n.e(94139),n.e(262010),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(927129),n.e(430849),n.e(679354),n.e(463675),n.e(836301),n.e(298265),n.e(811969),n.e(446090),n.e(475353)]).then(n.bind(n,533499));const N7={id:"com.microsoft.teams.files",name:"FilesApp",supportedEntities:[ke.ck.file,ke.ck.files],supportedRenderModes:[se.w.Main],getDefaultCommand:()=>({type:ke.ck.file,action:ke.SY.error}),windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},A7=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{criticalPhaseTimeout:i,enableChatSharedTab:a,postCriticalPhaseTimeout:o}=t.get(c.w.Files),r=[];if(e===se.w.Main)a?r.push(Gz.m.P2P_SHARED_LIST_VIEW_RENDERED):r.push(Gz.m.P2P_FILES_LIST_VIEW_RENDERED);return n.registerAppPhase({phase:m.Jj.CRITICAL,signals:r,timeout:i||6e4}),n.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:o||1e4}),n.appPhases},E7=({entity:e},t,n)=>{if(e.type===ke.ck.file&&(e.action===ke.SY.list||e.action===ke.SY.update)){const{enableChatSharedTab:e}=n.get(c.w.Files,["enableChatSharedTab"]);return e?(t.log("getCommandScenarioName: Click to Load Chat Shared Tab"),be.Cu.P2PSharedListSwitch):(t.log("getCommandScenarioName: Click to Load Chat Files Tab"),be.Cu.P2PFilesListSwitch)}return be.Cu.FilesAppSwitch},F7=e=>{if(_7(e))return D7(e)?{subNavEntity:P7(e),headerEntity:M7(e),startEntity:R7(e),mainEntity:x7(e),endEntity:L7(e)}:null},_7=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=i===ke.ck.file,r=[ke.SY.list,ke.SY.error],s=n&&r.includes(n);return!!(a&&o&&s)},D7=()=>!0,P7=()=>null,M7=()=>null,R7=()=>null,x7=({entity:e})=>e,L7=()=>null,O7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesPersonalSiteDetailsUserPreferenceStoreQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"personalSiteInfoFromUserPreferenceStore"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"listUrl"}}]}}]}}]},j7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsFilesRegisterTokenWarmingResourceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"service"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"resource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"registerTokenWarmingResource"},arguments:[{kind:"Argument",name:{kind:"Name",value:"service"},value:{kind:"Variable",name:{kind:"Name",value:"service"}}},{kind:"Argument",name:{kind:"Name",value:"resource"},value:{kind:"Variable",name:{kind:"Name",value:"resource"}}}]}]}}]},B7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesPersonalSiteDetailsFromUploadQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getPersonalSiteInfoForUpload"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"listUrl"}}]}}]}}]},U7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesJoinedTeamsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsOrder"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"JoinedTeamsOrderInput"}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isSortingEnforced"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"excludeHiddenAndArchivedTeams"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"joinedTeamsAndChannels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsOrder"},value:{kind:"Variable",name:{kind:"Name",value:"teamsOrder"}}},{kind:"Argument",name:{kind:"Name",value:"isSortingEnforced"},value:{kind:"Variable",name:{kind:"Name",value:"isSortingEnforced"}}},{kind:"Argument",name:{kind:"Name",value:"activitiesFromWorker"},value:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}}},{kind:"Argument",name:{kind:"Name",value:"excludeHiddenAndArchivedTeams"},value:{kind:"Variable",name:{kind:"Name",value:"excludeHiddenAndArchivedTeams"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"joinedTeams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"channelOnlyMember"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"isFavorite"}},{kind:"Field",name:{kind:"Name",value:"membershipSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"memberCount"}},{kind:"Field",name:{kind:"Name",value:"botCount"}}]}},{kind:"Field",name:{kind:"Name",value:"visibility"}},{kind:"Field",name:{kind:"Name",value:"pictureETag"}},{kind:"Field",name:{kind:"Name",value:"teamGuestSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}}]}},{kind:"Field",name:{kind:"Name",value:"dynamicMembership"}},{kind:"Field",name:{kind:"Name",value:"isTenantWide"}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"teamLockState"}},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}}]}}]}}]}}]}}]},$7=async(e,t,n)=>{let i="";const a=n.newScenario(be.Cu.FileSPOHomeSiteODTokenPrewarm);try{const{enableTenantSiteUrlAndDomains:n}=t.get(c.w.Extensibility);let o;if(n){const{tenantSiteUrlAndDomains:e}=t.get(c.w.Tenant);o=e?.webUrl&&new URL(e?.webUrl)}else{const{tenantSiteUrl:e}=t.get(c.w.Tenant);o=e?.webUrl&&new URL(e?.webUrl)}const r=o&&o.origin||void 0;i=r||"",r?(e.mutate({mutation:j7,variables:{service:"Files",resource:r}}),a.stop()):a.incomplete()}catch(e){a.mark("Home site domain token prewarm failed"),a.fail({errorMessage:"Home site domain token prewarm failed"})}const{maxSPDomainsForFileBrowserPrewarmingSW:o}=t.get(c.w.Files);if(o&&o>0){const t=n.newScenario(be.Cu.FileSPOOtherDomainsODTokenPrewarm);try{const n=(e=>{const t=e?.data?.joinedTeamsAndChannels?.joinedTeams?[...e.data.joinedTeamsAndChannels.joinedTeams]:[],n={};return t.forEach((e=>{const t=e?.teamSiteInformation?.sharepointSiteUrl,i=e?.teamSiteInformation?.groupId||void 0;if(t){const e=(e=>{const t=e.match(/\/\/(www\.)?(.[^/]+)/);return t?t[2]:e})(t);n[e]?(n[e].frequency+=1,n[e].groupId=n[e].groupId?n[e].groupId:i):n[e]={frequency:1,groupId:i}}})),Object.entries(n).sort(((e,t)=>t[1].frequency-e[1].frequency)).map((([e,{frequency:t,groupId:n}])=>({domain:e,frequency:t,groupId:n})))})(await e.query({query:U7,fetchPolicy:"cache-first",variables:{teamsOrder:[],isSortingEnforced:!1,activitiesFromWorker:!1,excludeHiddenAndArchivedTeams:!0}}));let a=n.length>1?0:-1,r=!0;const s=i.replace(/^(https?:\/\/)/,"");n.every((async n=>{if(n.domain===s)return!0;if(a===o)return!1;++a;try{e.mutate({mutation:j7,variables:{service:`FilesOtherDomain${a}`,resource:`https://${n.domain}`}})}catch(e){r=!1,t.mark(`Non - root domain token prewarm failed for domain ${n.domain}`)}return!0})),r?0===a?t.incomplete():t.stop():t.fail({errorMessage:`Other domains token prewarm failed for ${a} domains out of ${n.length-1} domains`})}catch(e){t.fail({errorMessage:"Other domains token prewarm failed because of Joined Teams Query failure"})}}},W7=({context:{client:e,coreSettings:t,scenarioFactory:n}})=>[{id:"files-register-resources",runOncePerId:!0,job:async()=>{const{environment:i}=t.get(c.w.Metadata);i===$a.B.life||(await $7(e,t,n),await(async(e,t)=>{const n=t.newScenario(be.Cu.FileSPOPersonalODTokenPrewarm);let i;try{const t=await e.query({query:O7,fetchPolicy:"cache-first",context:{scenario:n}});i=t?.data?.personalSiteInfoFromUserPreferenceStore?.siteUrl}catch(e){n.mark("Preference Store fetch failed")}try{if(!i||""===i){n.mark("Falling back to upload query");const t=await e.query({query:B7,context:{scenario:n}});i=t?.data?.getPersonalSiteInfoForUpload?.siteUrl}if(!i||""===i)return void n.fail({errorMessage:"Personal OD Token Prewarming failed due to invalid personal siteUrl"})}catch(e){return void n.fail({errorMessage:"upload query fetch failed"})}try{const t=new URL(i),a=t&&t.origin;n.mark("Starting Prewarm code"),e.mutate({mutation:j7,variables:{service:"PersonalFiles",resource:a}}),n.stop()}catch(e){n.fail({errorMessage:"Personal OD Token Prewarming failed"})}})(e,n))}}],V7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesGetAppDetailsInstalledAppQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedScope"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedApp"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedScope"},value:{kind:"Variable",name:{kind:"Name",value:"installedScope"}}},{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"installationState"}},{kind:"Field",name:{kind:"Name",value:"appBarPinState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isPinned"}}]}}]}}]}}]},H7={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsFileBrowserPreWarmAuthenticationTokenQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"resource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"AcquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resource"},value:{kind:"Variable",name:{kind:"Name",value:"resource"}}},{kind:"Argument",name:{kind:"Name",value:"acquireTokenOptions"},value:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"token"}}]}}]}}]},z7=async(e,t,n,i)=>{const a=new URL(t).origin,o=await n({resource:a});if(o&&e){const n=e.document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","access_token"),n.setAttribute("value",o);const a=e.document.createElement("form");a.appendChild(n),a.setAttribute("action",t),a.setAttribute("method","POST"),e.document.body.appendChild(a),a.submit(),i?.mark("Form Created and submitted")}else i?.fail({errorMessage:"Token fetch failed"})},q7=(e,t,n,i)=>{let a;return new Promise(((o,r)=>{let s;const l=n=>{if(n.source&&t&&n.source===t){const t=n.data;if("initialize"===t.type&&t.channelId===e){s&&(clearInterval(s),s=void 0);const e=n.ports&&n.ports[0];if(e)return a=e,void o(a);r(a)}}};i?(n.removeEventListener("message",l),o(a)):t?(s=setInterval((()=>{a?(clearInterval(s),s=void 0):t.postMessage({type:"identify-parent",channelId:e},n.document.location?.origin)}),100),n.addEventListener("message",l)):o(a)}))};var G7=n(625730);const Y7=(e,t,n,i)=>({close:async()=>{n?.log("Close post meessage received"),i?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_close_post_message),await t(!1)},authenticate:async t=>{n?.log(`Authenticate post meessage received for ${t.resource}`),i?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_auth_post_message);const a=await e({resource:t.resource});return a?{result:"token",scheme:"bearer",token:a}:(n?.log("Not able to PreWarm the App"),i?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_auth_token_failed),{result:"error",error:{code:"NoTokenObtained",message:"Could not obtain a token for resource."}})}}),Q7=()=>({result:"success"}),J7=(e,t)=>(t.error("Error executing command in filebrowser pre warm: ".concat(e.message)),{result:"error",error:{code:e.code||"unknown",message:e.message}}),K7=e=>({result:"error",error:{code:"unsupportedCommand",message:e.command}}),Z7=(e,t)=>{e&&t&&e.removeEventListener("message",t)},X7=(e,t,n,i)=>{const{close:a,authenticate:o}=t,r=(({sendAck:e,sendCommandResult:t,close:n,authenticate:i,logger:a})=>async o=>{if("command"===o.type){e(o);const r=o.data;switch(r.command){case"close":n(r).then((()=>{t(o,Q7())}),(e=>{t(o,J7(e,a))}));break;case"authenticate":i(r).then((e=>{t(o,e)}),(e=>{t(o,J7(e,a))}));break;default:t(o,K7(r))}}})({sendAck:t=>{e&&e.postMessage({type:"acknowledge",id:t.id})},sendCommandResult:(t,n)=>{e&&e.postMessage({type:"result",id:t.id,data:n})},close:a,authenticate:o,logger:n});return((e,t,n)=>{const i=e=>{t(e.data)},a=e=>{t(e.data)};return e?("Files"===n?e.addEventListener("message",i):e.addEventListener("message",a),e.start(),e.postMessage({type:"activate"}),"Files"===n?i:a):null})(e,r,i)},eee=e=>{const t=e.document.createElement("iframe");return t&&(t.setAttribute("id","filesAppIframe"),t.style.display="none",t.setAttribute("target","_self"),e.document.body.appendChild(t)),t&&t.contentWindow||null},tee=(e,t,n)=>{let i,a=12e3;return e&&e>0&&(a=e),i=void 0,i=t.setTimeout((()=>{n(!0),t.clearTimeout(i)}),a),i},nee="Files",iee=(e,t,n,i,a,o,r,s,l)=>{let c=`${e}_layouts/15/${a?"prewarm.ashx":"filebrowser.aspx"}?app=TeamsFile&fileBrowser={"sdk":"8.0","messaging":{"origin":"${t?.location?.origin??void 0}","channelId":"${n}"},"authentication":{},"entry":{"oneDrive":{"recent":{}}}}&scenario=OneDriveFiles&auth=none&locale=${i}&hostName=TeamsModern&preWarmFB=true`;return o&&"Idle"===s?(l?.mark("DataFetchOnIdle"),c+="&dataFetchOnIdle=true"):r&&"LongIdle"===s&&(l?.mark("DatfetchOnLongIdle"),c+="&dataFetchOnLongIdle=true"),c},aee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesAppPrecacheAppListQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"precacheAppList"}}]}}]},oee="5af6a76b-40fc-4ba1-af29-8f49b08e44fd";function ree(e,t){const{authenticationUser:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,coreSettings:l,networkState:d,platformService:u}=e;return{id:"files-app-pre-warm-job",job:async()=>{const e=a.newScenario("Idle"===t?be.Cu.FileBrowserPreWarmOnIdle:be.Cu.FileBrowserPreWarm),{enablePrewarmOnlyIfAppWasPinnedOntoAppbar:m,enablePrewarmWhenAppNotGettingPrecached:p}=l.get(c.w.Files);try{if(!d.isOnline())return void e.incomplete({errorMessage:"No network, Terminating the Job"});if(p&&"Idle"===t)try{const t=await async function(e,t){const n=await e.query({query:aee,fetchPolicy:"cache-first"});if(n.data.precacheAppList&&-1!==n.data.precacheAppList?.indexOf(t))return!0;return!1}(o,oee);if(t)return e.incomplete({errorMessage:"App is getting precached, Terminating the Job"}),void r?.set("FileAppPreWarmTimeStamp",Date.now().toString(),"Files")}catch(t){e.mark("Failed to read Precache app details")}if(m)try{const t=await async function(e,t,n){try{const{data:i,loading:a,error:o}=await n.query({query:V7,variables:{appId:e,installedScope:"Personal"},fetchPolicy:"cache-first"});if(o||a||!i)throw new Error("Error while fetching app info");const r=i.installedApp?.appBarPinState?.isPinned;return!!r&&(t.mark("OneDrive App pinned/installed"),!0)}catch(e){throw t.mark("Failed to read the App details"),e}}(oee,e,o);if(!t)return void e.incomplete({errorMessage:"OneDrive App not Pinned, Terminating the Job"})}catch(t){e.mark("Failed to get App pinned status")}if(n?.role===pg.a7.Guest||n?.role===pg.a7.Anonymous)return void e.incomplete({errorMessage:"Guest-Anonymous User, Terminating the Job"});let g;try{const e=await o.query({query:O7});g=e?.data?.getPersonalSiteInfoFromUserPreferenceStore?.siteUrl}catch{e.mark("Preference Store fetch failed")}if(!g){e.mark("Reading from IndexDB");const t=await o.query({query:B7,context:{scenario:e}});g=t?.data?.getPersonalSiteInfoForUpload?.siteUrl}g?(e.mark("Starting Prewarm code"),await(async(e,t,n,i,a,o,r,s,l,d)=>{const u=n.newLogger("fileBrowserPreWarm","components-file-browser-pre-warm"),m=t.findScenario(be.Cu.FileBrowserPreWarm)||t.findScenario(be.Cu.FileBrowserPreWarmOnIdle),{fileBrowserHiddenIframeCloseInterval:p,enableDedicatedPrewarm:g,enablePrewarmInStoragePartition:h,enablePreWarmDataFetchOnIdle:v,enablePreWarmDataFetchOnLongIdle:y}=o.get(c.w.Files),S=`${Math.random().toFixed(8)}`;let f=null;const k=async e=>{const{resource:t}=e,n=new URL(t).origin;u.log(`getAuthToken triggered for resource: ${t}`),m?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_auth_token_start);const a=await i.query({query:H7,fetchPolicy:"cache-first",variables:{resource:n}}),o=a.data?.authenticationToken?.token??"";return m?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_auth_token_end),Promise.resolve(o)},C=(0,Uo.J)(o,s);let b=null;if(h&&C){if(m?.mark("Hidden Window created"),!r?.id)return u.log("Failed to create hidden window, userId absent"),void m?.fail({errorMessage:"Failed to create hidden window as UserId absent"});const e="width=0,height=0,left=-9999,top=-9999,toolbar=no,menubar=no,location=no,status=no,titlebar=no",t=`about:blank?usercontextid=${r?.id}&show=false`;if(f=a.open(t,`preWarmAppWindow_${r?.id}_${nee}`,e),!f)return u.log("Failed to create hidden Window"),void m?.fail({errorMessage:"Failed to create hidden Window"});f.blur(),b=f}else m?.mark("Hidden Iframe created"),b=eee(a);const w=async e=>{const i=n.newLogger("fileBrowserPreWarm","components-file-browser-pre-warm"),o=t.findScenario(be.Cu.FileBrowserPreWarm)||t.findScenario(be.Cu.FileBrowserPreWarmOnIdle);if(!e)try{a.clearTimeout(N),l?.set("FileAppPreWarmTimeStamp",Date.now().toString(),"Files")}catch(e){i.log("Writing PreWarm date to local storage has failed")}q7(S,b,a,!0),F&&Z7(A,F),f?(f.close(),i.log("Removed Hidden Window"),o?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_partition_window_removed,void 0,e?"timeout":"success")):(a.document.getElementById("filesAppIframe")?.remove(),i.log("Removed Hidden Iframe"),o?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_window_removed,void 0,e?"timeout":"success")),o?.stop(),Promise.resolve()};b||(m?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_window_creation_failed),m?.fail({errorMessage:"Failed to create iframe"}),Promise.resolve()),u.log("Created Hidden Iframe"),m?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_window_creation_successful);const{localeCode:T}=o.get(c.w.Platform),I=iee(e,a,S,T??void 0,g??!1,v??!1,y??!1,d,m);await z7(b,I,k,m);const N=tee(p,a,w),A=await q7(S,b,a,!1),E=Y7(k,w,u,m),F=X7(A,E,u,nee)})(g,a,i,o,s,l,n,u,r,t)):e.incomplete({errorMessage:"Personal SiteInfo fetch failed"})}catch(t){const n=t?.serverResponse?.status||t?.errorCode||t?.code,i=`Failed filesAppPreWarmJob with errorCode ${n}`;return void e.fail({errorCode:n,message:t?.message,errors:t?.name,errorMessage:i})}}}}var see=n(126469),lee=n(42163);const cee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesChannelsInfoByGroupIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"groupId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamByGroupId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"groupId"},value:{kind:"Variable",name:{kind:"Name",value:"groupId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChannelListTeamFragment"}},{kind:"Field",name:{kind:"Name",value:"channels"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChannelListChannelFragment"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"hostTenantId"}},{kind:"Field",name:{kind:"Name",value:"isShownByDefault"}},{kind:"Field",name:{kind:"Name",value:"substrateGroupId"}},{kind:"Field",name:{kind:"Name",value:"lastMessageArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}}]}}]}},...see.j.definitions,...lee.l.definitions]},dee=(e,t,n,i)=>{let a;return new Promise(((o,r)=>{let s;const l=n=>{if(n.source&&t&&n.source===t){const t=n.data;if("initialize"===t.type&&t.channelId===e){s&&(clearInterval(s),s=void 0);const e=n.ports&&n.ports[0];if(e)return a=e,void o(a);r(a)}}};i?(n.removeEventListener("message",l),o(a)):t?(s=setInterval((()=>{a?(clearInterval(s),s=void 0):t.postMessage({type:"identify-parent",channelId:e},n.document.location?.origin)}),100),n.addEventListener("message",l)):o(a)}))},uee=(e,t,n,i,a,o,r)=>{const s=new URL(e).pathname;return`${e}/_layouts/15/${r?"prewarm.ashx":"filebrowser.aspx"}?fileBrowser={"sdk":"8.0","messaging":{"origin":"${t?.location?.origin??void 0}","channelId":"${n}"},"authentication":{},"entry":{"sharePoint":{"byPath":{"web":"${s}","folder":"${a}"}}}}&app=teamsfile&teamId=${i}&channelId=${n}&scenario=ChannelFiles&auth=none&locale=${o}&hostName=TeamsModern&preWarmFB=true`};function mee(e,t){const{loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,coreSettings:s,networkState:l,authenticationUser:d,platformService:u}=e;return{id:"files-app-pre-warm-cft-job",job:async()=>{const e=i.newScenario("Idle"===t?be.Cu.FileBrowserPreWarmForCFTOnIdle:be.Cu.FileBrowserPreWarmForCFT);n.newLogger("FilesAppPreWarmForCFTJob","apps-files").log("files_app_pre_warm_cft_job triggered");try{let t=0;if(!l.isOnline())return void e.incomplete({errorMessage:"No network, Terminating the Job"});const m=await a.query({query:U7,fetchPolicy:"cache-first",variables:{teamsOrder:[],isSortingEnforced:!1,activitiesFromWorker:!1,excludeHiddenAndArchivedTeams:!0}});if(!m?.data?.joinedTeamsAndChannels?.joinedTeams)return void e.incomplete({errorMessage:"JoinedTeamsAndChannels query does not joinedTeams data, joinedTeams could be null or undefined"});if(t=m?.data?.joinedTeamsAndChannels?.joinedTeams?.findIndex((e=>null!=e?.teamSiteInformation?.groupId)),m?.data?.joinedTeamsAndChannels?.joinedTeams?.[t]?.teamSiteInformation?.groupId){const l=await a.query({query:cee,fetchPolicy:"cache-first",variables:{groupId:m.data.joinedTeamsAndChannels.joinedTeams[t].teamSiteInformation.groupId}}),p=l.data.teamByGroupId?.channels?.[0]?.defaultFileSettings?.filesRelativePath,g=l.data.teamByGroupId?.teamSiteInformation?.sharepointSiteUrl,h=l.data.teamByGroupId?.channels?.[0]?.id,v=l.data.teamByGroupId?.id;if(g&&v&&h&&p)await(async(e,t,n,i,a,o,r,s,l,d,u,m)=>{const p=o.newLogger("fileBrowserPreWarmForCFT","components-file-browser-pre-warm"),g=a.findScenario(be.Cu.FileBrowserPreWarmForCFT)||a.findScenario(be.Cu.FileBrowserPreWarmForCFTOnIdle),{fileBrowserHiddenIframeCloseInterval:h,enableDedicatedPrewarm:v,enablePrewarmInStoragePartition:y}=l.get(c.w.Files);let S=null;const f=async e=>{const{resource:t}=e,n=new URL(t).origin;p.log(`getAuthToken triggered for resource: ${t}`),g?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_auth_token_start);const i=await r.query({query:H7,fetchPolicy:"cache-first",variables:{resource:n}}),a=i.data?.authenticationToken?.token??"";return g?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_auth_token_end),Promise.resolve(a)},k=(0,Uo.J)(l,u);let C=null;if(y&&k){if(!d?.id)return p.log("Failed to create hidden window as userId absent"),void g?.fail({errorMessage:"Failed to create hidden window as UserId absent"});const e="width=0,height=0,left=-9999,top=-9999,toolbar=no,menubar=no,location=no,status=no,titlebar=no",t=`about:blank?usercontextid=${d?.id}&show=false`;if(S=s.open(t,`preWarmAppWindow_${d?.id}_CFT`,e),!S)return p.log("Failed to create hidden window"),void g?.fail({errorMessage:"Failed to create hidden wiindow"});S.blur(),C=S}else C=eee(s);const b=async e=>{const t=o.newLogger("fileBrowserPreWarmForCFT","components-file-browser-pre-warm"),i=a.findScenario(be.Cu.FileBrowserPreWarmForCFT)||a.findScenario(be.Cu.FileBrowserPreWarmForCFTOnIdle);e||(s.clearTimeout(I),m?.set("ChannelFilesTabPreWarmTimeStamp",Date.now().toString(),"Files")),await dee(n,C,s,!0),E&&Z7(N,E),S?(S.close(),t.log("Removed Hidden Window"),i?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_partition_window_removed,void 0,e?"timeout":"success")):(s.document.getElementById("filesAppIframe")?.remove(),t.log("Removed Hidden Iframe"),i?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_window_removed,void 0,e?"timeout":"success")),i?.stop(),Promise.resolve()};C||(g?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_window_creation_failed),g?.fail({errorMessage:"Failed to create iframe"}),Promise.resolve()),p.log("Created Hidden Iframe"),g?.mark(G7.Id.telemetry.markers.filebrowser_prewarm_window_creation_successful);const{localeCode:w}=l.get(c.w.Platform),T=uee(e,s,n,t,i,w??void 0,v??!1);await z7(C,T,f,g);const I=tee(h,s,b),N=await dee(n,C,s,!1),A=Y7(f,b,p,g),E=X7(N,A,p,"CFT")})(g,v,h,p,i,n,a,r,s,d,u,o);else{const t=`Required information is missing ${g?"":"siteUrl"} ${v?"":"teamId"} ${h?"":"channelId"} ${p?"":"folderRelativePath"}`;e.incomplete({errorMessage:t})}}else e.incomplete({errorMessage:"JoinedTeamsAndChannels query does not return any team/site, possibly teamId or siteInformation is not available"})}catch(t){const n=t?.errorCode||t?.code,i=`Failed filesAppPreWarmForCFTJob with errorCode ${n}`;return void e.fail({errorCode:n,message:t?.message||i,errors:t?.name})}}}}const pee=864e5,gee=({context:{i18n:e,authenticationUser:t,coreSettings:n,hostCommunicationService:i,loggerFactory:a,scenarioFactory:o,client:r,localStorage:s,windowProvider:l,platformService:d,networkState:u,entityCommanding:m,config:p,clientState:g,rebootService:h,userTrackingService:v}})=>{const y=[],{preWarmFileBrowser:S,fileBrowserRelaunchHiddenIframeInterval:f,preWarmFileBrowserForCFT:k}=n.get(c.w.Files),{environment:C}=n.get(c.w.Metadata),b=C===$a.B.life,w=a.newLogger("FilesAppPreWarmJob","apps-files");if(S&&!b){const c=o?.newScenario(be.Cu.FileBrowserPreWarmIdleStateTrigger);w?.log("Entered Idle Experience path");const S=s?.get("FileAppPreWarmTimeStamp");let k=!0;if(S){const e=f??pee,t=+S;k=Date.now()-t>e}k?(w?.log("Push the Files App pre Warm Job"),c?.stop({reason:"Job-pushed"}),y.push(ree({i18n:e,authenticationUser:t,coreSettings:n,hostCommunicationService:i,loggerFactory:a,scenarioFactory:o,client:r,localStorage:s,windowProvider:l,platformService:d,networkState:u,entityCommanding:m,config:p,clientState:g,rebootService:h,userTrackingService:v},"LongIdle"))):(w?.log("Skip the Files App pre Warm Job"),c?.stop({reason:"Job-Skipped"}))}if(k){const t=o?.newScenario(be.Cu.FileBrowserForCFTPreWarmIdleStateTrigger);w?.log("Entered Idle Experience path for Iframe CFT");const c=s?.get("ChannelFilesTabPreWarmTimeStamp");let S=!0;if(c){const e=f??pee,t=+c;S=Date.now()-t>e}S?(w?.log("Push the Channel Files Tab pre Warm Job"),t?.stop({reason:"Job-pushed"}),y.push(mee({i18n:e,coreSettings:n,hostCommunicationService:i,loggerFactory:a,scenarioFactory:o,client:r,localStorage:s,windowProvider:l,platformService:d,networkState:u,entityCommanding:m,config:p,clientState:g,rebootService:h,userTrackingService:v},"LongIdle"))):(w?.log("Skip the Channel Files Tab pre Warm Job"),t?.stop({reason:"Job-Skipped"}))}return y},hee=864e5,vee=({context:{i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v}})=>{const y=[],{preWarmFileBrowserOnIdle:S,fileBrowserRelaunchHiddenIframeInterval:f,preWarmFileBrowserForCFTOnIdle:k}=t.get(c.w.Files),{environment:C}=t.get(c.w.Metadata),b=C===$a.B.life,w=i.newLogger("FilesAppPreWarmJobOnIdle","apps-files");if(S&&!b){const c=a?.newScenario(be.Cu.FileBrowserPreWarmOnIdleStateTrigger);w?.log("Entered Idle Experience path");const S=r?.get("FileAppPreWarmTimeStamp");let k=!0;if(S){const e=f??hee,t=+S;k=Date.now()-t>e}k?(w?.log("Push the Files App pre Warm Job"),c?.stop({reason:"Job-pushed"}),y.push(ree({i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v},"Idle"))):(w?.log("Skip the Files App pre Warm Job"),c?.stop({reason:"Job-Skipped"}))}if(k){const c=a?.newScenario(be.Cu.FileBrowserForCFTPreWarmOnIdleStateTrigger);w?.log("Entered Idle Experience path for Iframe CFT");const S=r?.get("ChannelFilesTabPreWarmTimeStamp");let k=!0;if(S){const e=f??hee,t=+S;k=Date.now()-t>e}k?(w?.log("Push the Channel Files Tab pre Warm Job"),c?.stop({reason:"Job-pushed"}),y.push(mee({i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v},"Idle"))):(w?.log("Skip the Channel Files Tab pre Warm Job"),c?.stop({reason:"Job-Skipped"}))}return y},yee={onEventReceived:({eventInput:e})=>{if(e.event.type===uq.mu.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:vq(t)})}return Promise.resolve(void 0)}},See={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesChannelInfoQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]};var fee=n(516997),kee=n(778368),Cee=n(562292);var bee;!function(e){e.DeepLinkNotEnabled="deeplink-not-enabled-error",e.MissingFileId="missing-fileId-error",e.MissingApolloClient="missing-apollo-client-error",e.CouldNotResolveViewer="could-not-resolve-viewer-error"}(bee||(bee={}));const wee=(e,t)=>({entity:{type:ke.ck.extensions,action:ke.SY.view,id:JSON.stringify({appId:e,fileId:t.fileId.toLowerCase()}),linkedEntity:{id:JSON.stringify({subEntityId:JSON.stringify(t)}),type:ke.ck.extensions}},command:{visibilityState:g.Rp.show,stateTransition:t.shouldOpenInMultiWindow?g.Ar.new:g.Ar.flush},entityOptions:{entryPoint:"personalApp"}}),Tee=e=>({entity:{type:ke.ck.filesoneupviewer,action:ke.SY.view,id:e.fileId},command:{visibilityState:g.Rp.show,stateTransition:e.shouldOpenInMultiWindow?g.Ar.new:g.Ar.flush},entityOptions:e}),Iee=[{filter:"/l/file",execute:async({deeplinkUrl:e,context:{coreSettings:t,getUserContexts:n,scenarioFactory:i,loggerFactory:a}})=>{if(!Nee(t))return Promise.reject({message:bee.DeepLinkNotEnabled});const o=a.newLogger("FileViewDeeplink","apps-files");let r=(e=>{const{pathname:t,searchParams:n}=e,i=t.split("/l/file/");return{fileId:i[i.length-1]??void 0,fileType:n.get("fileType")??"",tenantId:n.get("tenantId")??void 0,threadId:n.get("threadId")??void 0,objectUrl:n.get("objectUrl")??"",serviceName:n.get("serviceName")??"",shareUrl:n.get("shareUrl")||n.get("emailHtmlLink")||void 0,siteUrl:n.get("baseUrl")??void 0,context:"rwc"}})(e);if(!r.fileId)return Promise.reject({message:bee.MissingFileId});const s=await n(),l=s&&s.length>0?s[s.length-1]:void 0,d=l?.context?.client;if(!d)return Promise.reject({message:bee.MissingApolloClient});const u=(0,fee.sI)(r.fileType);let m;if(r.threadId)try{const{data:e}=await d.query({query:See,fetchPolicy:"cache-first",variables:{conversationId:r.threadId}});m=e}catch{m=void 0}r.tenantId=m?.channelByID.owningTeam?.tenantId||r.tenantId,t.get(c.w.Extensibility).enablePopOutFileChicletInMultiWindow&&!t.get(c.w.Core).isPrimaryWindow&&(r={...r,shouldOpenInMultiWindow:!0});const p=await(0,kee.h5)(d,r.fileType,!!t.get(c.w.Files).enableAppBasedFileHandlingForWXPTMP,!!t.get(c.w.Files).enableFilesAppBasedFileHandlingForPDFTMP,!!t.get(c.w.Files).enableFilesAAACheckForPDFAppTMP,t.get(c.w.Files).enableFilesPDFAppIdForViewTMP,t.get(c.w.Files).allowedInstallerAzureADAppIdsForPDFApp,!!t.get(c.w.Files).enableFilesAdminPreinstallCheckForPDFAppTMP,!!t.get(c.w.Files).enableAppBasedFileHandlingForOneNoteTMP,!!t.get(c.w.Files).enableAppBasedFileHandlingForVisioTMP,!!t.get(c.w.Extensibility).enableAppsQueryOptimization,!!t.get(c.w.Extensibility).enableInstalledAppQueryOptimization,o,i);return p?((0,Cee.RL)(i,p,"personalApp",o,r.shouldOpenInMultiWindow,!0),Promise.resolve({entityCommand:wee(p,r),metadata:{allowAnonymous:!1}})):u===fee.j_.OneUpViewer?Promise.resolve({entityCommand:Tee(r),metadata:{allowAnonymous:!1}}):Promise.reject({message:bee.CouldNotResolveViewer})}}],Nee=e=>!!e.get(c.w.Files).enableFileOpenDeeplink,Aee=async e=>{const{entityCommand:t,requestContext:n}=e,{entity:i}=t,{hostCommunicationService:a,loggerFactory:o}=n,r=o.newLogger("FilesOnBeforeCommandHandled","apps-files");if(i.type!==ke.ck.files||"localRecordingAssembly"!==i.id)return t;try{const e=await(a?.loadModule("files"));if(!e?.openLocalRecordingFolder){const e="openLocalRecordingFolder API is not available";throw r.error(e),Error(e)}await e.openLocalRecordingFolder()}catch(e){r.error("Failed to open local recording folder: API is not available or API internal error")}},Eee=()=>Promise.all([n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(325670),n.e(501156),n.e(216284),n.e(817556),n.e(980534),n.e(674495),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(562201),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(679354),n.e(463675),n.e(288919),n.e(615002),n.e(836301),n.e(478040),n.e(440353),n.e(123727),n.e(298493)]).then(n.bind(n,988200)),Fee=()=>Promise.all([n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(325670),n.e(501156),n.e(216284),n.e(817556),n.e(980534),n.e(674495),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(562201),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(679354),n.e(463675),n.e(288919),n.e(615002),n.e(836301),n.e(478040),n.e(440353),n.e(123727),n.e(298493)]).then(n.bind(n,819867));function _ee(){const e=()=>null,t="apps-files",n={chunkName:t};return{eventHandlers:yee,getAppPhases:A7,getAppViewEntities:F7,getCommandScenarioName:E7,manifest:N7,render:async({appRenderMode:i,coreSettings:a,onRenderEvent:o,scenarioFactory:r,entity:s})=>{if(s.type===ke.ck.file&&(s.action===ke.SY.list||s.action===ke.SY.update)){o("ChunkLoadStarted",n);const{enableEntityMoreInfo:e}=a.get(c.w.Core),s=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),{P2PFilesListViewsRenderer:l}=await(0,ev.wg)(Eee,t,r),{LPC:d}=e?{LPC:s}:await(0,ev.wg)(Fee,t,r),u=e?s:wJ.CA;return o("ChunkLoadSucceeded",n),(0,Lr.Y)(d,{children:(0,Lr.Y)(u,{children:(0,Lr.Y)(l,{appRenderMode:i})})})}return(0,Lr.Y)(e,{})},onPreWarm:W7,onExperienceLongIdle:gee,onIdle:vee,onBeforeDeeplinkParsed:Iee,onBeforeCommandHandled:Aee}}const Dee={id:"com.microsoft.teams.filesoneupviewer",name:"FilesoneupviewerApp",supportedEntities:[ke.ck.filesoneupviewer],supportedRenderModes:[se.w.HorizontalBar,se.w.Main]},Pee=e=>{if(Mee(e))return Ree(e)?{subNavEntity:xee(e),headerEntity:Lee(e),startEntity:Oee(e),mainEntity:jee(e),endEntity:Bee(e)}:null},Mee=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.filesoneupviewer].includes(i),r=[ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Ree=()=>!0,xee=({entity:e,layoutMode:t})=>t===Yt.Rm.focus?null:e,Lee=({entity:e})=>e,Oee=()=>null,jee=({entity:e})=>e,Bee=({contextEntity:e})=>e?.type===ke.ck.chats?e:null,Uee=e=>{const{entity:t,command:n}=e;return(n.stateTransition===g.Ar.flush||n.stateTransition===g.Ar.new)&&t.type===ke.ck.filesoneupviewer&&t.action===ke.SY.view&&n.visibilityState===g.Rp.show?be.Cu.FileOneUpViewer:void 0},$ee=({appRenderMode:e})=>{const t=new qz.D,n=[];switch(e){case se.w.HorizontalBar:n.push(Gz.m.ONEUP_HEADER_RENDERED);break;case se.w.Main:n.push(Gz.m.ONEUP_RENDERED)}return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:12e4}),t.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:1e4}),t.appPhases},Wee=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(428348),n.e(501156),n.e(967633),n.e(307422),n.e(94139),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(927129),n.e(944259)]).then(n.bind(n,489469));const Vee={id:"com.microsoft.teams.floating-ufd",name:"FloatingUfdApp",supportedEntities:[ke.ck.floatingufd],supportedRenderModes:[se.w.Main],getDefaultCommand:()=>({action:ke.SY.default,type:ke.ck.floatingufd}),windowFeatures:{width:300,height:200,top:0,left:0,additionalFeatures:{alwaysOnTop:"true",closable:"false",fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"false",movable:"false",hideWindowControl:"true",frame:"false",closeoverride:"true",transparent:"true",show:"false",excludeWindowFromScreenSharing:"true",contentprotection:"true",visibleOnAllWorkspaces:"true"}}},Hee=e=>{if(zee(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:qee(e),endEntity:null}},zee=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===ke.ck.floatingufd,a=t===ke.SY.view;return Boolean(i&&a)},qee=({entity:e})=>e,Gee=()=>({mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,disableBorderInHighContrast:!0}}}),Yee=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(914945),n.e(293328),n.e(280759),n.e(332197),n.e(307422),n.e(524014),n.e(383414),n.e(405226),n.e(736704),n.e(163525),n.e(317910),n.e(889780),n.e(237447),n.e(748559)]).then(n.bind(n,11699)),Qee=({coreServices:e})=>{const t=!!e?.coreSettings.get(c.w.Calling).disableContentprotection,n=(!t).toString(),i={...Vee.windowFeatures};return t&&i?.additionalFeatures&&(i.additionalFeatures.excludeWindowFromScreenSharing=n,i.additionalFeatures.contentprotection=n),i};function Jee(){const e=()=>null;return{getAppViewEntities:Hee,getAppViewEntitiesProps:Gee,getAppWindowFeatures:Qee,manifest:Vee,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===se.w.Main&&n===ke.ck.floatingufd){const{FloatingUfd:e}=await(0,ev.wg)(Yee,"floating-ufd-app",i);return(0,Lr.Y)(e,{})}return(0,Lr.Y)(e,{})}}}const Kee={id:"com.microsoft.teams.flyout",name:"FlyoutApp",supportedEntities:[ke.ck.flyout,ke.ck.flyoutphonelink,ke.ck.flyoutwhatsnew],supportedRenderModes:[se.w.Main],getDefaultCommand:()=>({action:ke.SY.default,type:ke.ck.flyout}),windowFeatures:{minWidth:378,maxWidth:378,width:378,minHeight:688,maxHeight:688,height:688,resizable:"false"}},Zee=e=>{if(Xee(e))return ete(e)?{subNavEntity:tte(e),headerEntity:nte(e),startEntity:ite(e),mainEntity:ate(e),endEntity:ote(e)}:null},Xee=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.flyout].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},ete=()=>!0,tte=()=>null,nte=()=>null,ite=()=>null,ate=({entity:e})=>e,ote=()=>null,rte=()=>({mainEntity:{[se.w.Main]:{forceDisableTitleBar:!0,isBackgroundTransparent:!0}}}),ste=({type:e,action:t,appRenderMode:n,coreSettings:i})=>{const a=new qz.D,{flyoutAppPhaseTimeouts:o}=i.get(c.w.Core),r=[],s=[];if(n===se.w.Main)lte({type:e,action:t,criticalSignals:r,postCriticalSignals:s,featureFlags:{}});return a.registerAppPhase({phase:m.Jj.CRITICAL,signals:r,timeout:o?.critical||6e4}),a.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:s,timeout:o?.postCritical||1e4}),a.appPhases},lte=({type:e,action:t,criticalSignals:n})=>{e===ke.ck.flyout&&t===ke.SY.update?n.push(Gz.m.CONNECT_WITH_ANYONE_SHOWN):n.push(Gz.m.CHAT_LIST_ITEMS_RENDERED)},cte=({context:{coreSettings:e,entityCommanding:t,loggerFactory:n}})=>{const i=n.newLogger("FlyoutPrewarmJob","apps-flyout"),{deviceInfo:a}=e.get(c.w.Platform);if(!a||!(0,H$.X)(a))return i.debug("FlyoutPreWarmJobDisabledOnNonWin11"),[];const{enableFlyoutPrewarm:o,enableFlyoutOnExperienceWarm:r,enableMinimodePrewarm:s,enableMinimodeWindow:l}=e.get(c.w.Core);return i.infoToTelemetry?.(`enableFlyoutPrewarm ${o}, enableFlyoutOnExperienceWarm ${r}, enableMinimodePrewarm ${s}, enableMinimodeWindow ${l}`,"tfl_app_pre_warm"),l&&s?(i.log("MinimodePreWarmJobEnabled"),[{id:"flyout-prewarm-job",runOncePerId:!0,job:()=>(i.log("MinimodePrewarmJobInvoked"),t.deepLink.prewarmMinimode(A.p.MinimodePrewarmJob))}]):l||s?(i.log(`skipping flyout prewarm enableMinimodeWindow ${l} enableMinimodePrewarm ${s}`),[]):!o||r?(i.log("FlyoutPreWarmJobDisabled"),[]):(i.log("FlyoutPreWarmJobEnabled"),[{id:"flyout-prewarm-job",runOncePerId:!0,job:()=>(i.log("FlyoutPrewarmJobInvoked"),t.deepLink.prewarmFlyout(A.p.FlyoutPrewarmJob))}])},dte=({context:{coreSettings:e,entityCommanding:t,loggerFactory:n}})=>{const i=n.newLogger("FlyoutOnExperienceJob","apps-flyout"),{deviceInfo:a}=e.get(c.w.Platform);if(!a||!(0,H$.X)(a))return i.debug("FlyoutExperienceWarmJobDisabledOnNonWin11"),[];const{enableFlyoutOnExperienceWarm:o,enableMinimodeWindow:r}=e.get(c.w.Core);return r?(i.debug("enableMinimodeWindow - skipping flyout prewarm"),[]):o?(i.debug("FlyoutOnExperienceWarmJobEnabled"),[{id:"flyout-on-experience-warm-job",runOncePerId:!0,job:()=>(i.debug("FlyoutOnExperienceWarmJobInvoked"),t.deepLink.prewarmFlyout(A.p.FlyoutOnExperienceWarmJob))}]):(i.debug("FlyoutOnExperienceWarmJobDisabled"),[])},ute=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(668172),n.e(787454),n.e(181316),n.e(598188),n.e(842242),n.e(984165),n.e(487867),n.e(960122),n.e(231020),n.e(811751),n.e(568721),n.e(845039),n.e(258832),n.e(567830),n.e(178249),n.e(354130),n.e(346069),n.e(826932),n.e(317183),n.e(367741),n.e(461369),n.e(968775),n.e(791296),n.e(845091),n.e(495544),n.e(464079),n.e(326317),n.e(307422),n.e(94139),n.e(467129),n.e(202564),n.e(712284),n.e(601715),n.e(75416),n.e(777944),n.e(652658),n.e(544228),n.e(627867),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(715192),n.e(331703),n.e(936254),n.e(668415),n.e(684694),n.e(813370),n.e(478723),n.e(577607),n.e(108698),n.e(367831),n.e(391),n.e(879803),n.e(515758),n.e(223810),n.e(639495),n.e(506888),n.e(119940),n.e(605837),n.e(247727),n.e(598562),n.e(644740),n.e(914022),n.e(14921),n.e(356144)]).then(n.bind(n,187674)),mte=()=>Kee.windowFeatures||{},pte=()=>be.Cu.FlyoutLaunch;const gte={id:"com.microsoft.teams.gallery",name:"GalleryApp",supportedEntities:[ke.ck.gallery],supportedRenderModes:[se.w.Main],getDefaultCommand:()=>({type:ke.ck.gallery,action:ke.SY.view}),windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},hte=e=>{if(vte(e))return yte(e)?{subNavEntity:Ste(e),headerEntity:fte(e),startEntity:kte(e),mainEntity:Cte(e),endEntity:bte(e)}:null},vte=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.gallery].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},yte=()=>!0,Ste=()=>null,fte=()=>null,kte=()=>null,Cte=({entity:e})=>e,bte=()=>null,wte=()=>Promise.all([n.e(224316),n.e(914945),n.e(306517),n.e(674958),n.e(11413),n.e(659229),n.e(801553)]).then(n.bind(n,318926));function Tte(){const e=()=>null;return{getAppViewEntities:hte,manifest:gte,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){const e="gallery-app";n("ChunkLoadStarted",{chunkName:e});const{Gallery:t}=await(0,ev.wg)(wte,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})}}}const Ite=e=>{if(Nte(e))return Ate(e)?{subNavEntity:Ete(e),headerEntity:Fte(e),startEntity:_te(e),mainEntity:Dte(e),endEntity:Pte(e)}:null},Nte=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=Boolean(ke.ck.help===i),r=[ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Ate=()=>!0,Ete=()=>null,Fte=()=>null,_te=()=>null,Dte=()=>null,Pte=()=>null,Mte="help",Rte="viewHelpPersonalApp",xte="viewHelpComponent",Lte={id:"com.microsoft.teams.help",name:"HelpApp",actors:[Mte],supportedEntities:[ke.ck.help,ke.ck.whatsnewdialog],supportedRenderModes:[se.w.Modal,se.w.Main],windowFeatures:{minWidth:800,minHeight:600,width:800,height:600,offset:20,top:0,left:0}},Ote=async({commandInput:e,requestContext:{executionContext:t,loggerFactory:n}})=>{const{command:{action:i,data:a}}=e,o=n.newLogger("HelpApp onCommandReceived","apps-help");if(e.command.actor!==Mte)return void o.errorToTelemetry?.(`Command for actor '${e.command.actor}' cannot be handled by HelpApp.`,"help_on_command_received",void 0,!0);const{popOut:r,appId:s,tabEntityId:l,subEntityId:c}=a||{},d=r?g.Ar.new:g.Ar.flush;switch(i){case Rte:let e;return e=c&&l?JSON.stringify({appId:s,tabEntityId:l,subEntityId:c}):l?JSON.stringify({appId:s,tabEntityId:l}):JSON.stringify({appId:s}),{entity:{id:e,action:ke.SY.view,type:ke.ck.extensions,linkedEntity:{id:e,type:ke.ck.extensions}},command:{visibilityState:g.Rp.show,stateTransition:d,correlation:{source:A.p.Nova}}};case xte:return{entity:{action:ke.SY.default,type:ke.ck.help},command:{visibilityState:g.Rp.show,stateTransition:d,correlation:{source:A.p.Nova}},entityOptions:{contextType:t?.viewEntities?.mainEntity?.type,helpId:l,helpSubId:c}};default:o.errorToTelemetry?.(`Command action '${i}' is not supported at HelpApp.`,"help_on_command_received",void 0,!0)}},jte=({appRenderMode:e})=>{const t=new qz.D,n=[];if(e===se.w.Main)n.push(Gz.m.HELP_APP_RENDERED);return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:25e3}),t.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:1e4}),t.appPhases},Bte=()=>Promise.all([n.e(724556),n.e(383414),n.e(743566),n.e(670225),n.e(177655),n.e(510817)]).then(n.bind(n,887984)),Ute=()=>n.e(889700).then(n.bind(n,834122)),$te=()=>Lte.windowFeatures||{},Wte=()=>be.Cu.HelpAppLoaded;function Vte(){const e=()=>null;return{manifest:Lte,onCommandReceived:Ote,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{if(t===se.w.Modal){const e="whats-new-modal",o=a.newLogger(e,"apps-help");try{n("ChunkLoadStarted",{chunkName:e});const{WhatsNewViewsRenderer:a}=await(0,ev.wg)(Bte,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(a,{appRenderMode:t})}catch(e){o.error(`chunk load failed with ${e}`)}}if(t===se.w.Main){const e="help-app",o=a.newLogger(e,"apps-help");try{n("ChunkLoadStarted",{chunkName:e});const{HelpViewRenderer:a}=await(0,ev.wg)(Ute,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(a,{appRenderMode:t})}catch(e){o.error(`chunk load failed with ${e}`)}}return(0,Lr.Y)(e,{})},getAppPhases:jte,getAppViewEntities:Ite,getAppWindowFeatures:$te,getCommandScenarioName:Wte}}const Hte={shouldAddEntitiesToWindowHistory:e=>e?.mainEntity?.type!==ke.ck.identity,shouldRestoreClientToEntities:e=>e?.mainEntity?.type!==ke.ck.identity},zte=e=>{if(Gte(e))return Yte(e)?{subNavEntity:Qte(e),headerEntity:Jte(e),startEntity:Kte(e),mainEntity:Zte(e),endEntity:Xte(e)}:null},qte=({entity:e})=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:"minimal"===e?.id&&e?.action===ke.SY.signin}}}),Gte=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.chats,ke.ck.authrefreshdialog,ke.ck.authaccounttransfer,ke.ck.accountselectiondialog,ke.ck.signoutNoDialog].includes(i),r=[ke.SY.default,ke.SY.view,ke.SY.update],s=n&&r.includes(n);return!!(a&&o&&s)},Yte=()=>!0,Qte=()=>null,Jte=()=>null,Kte=()=>null,Zte=({entity:e})=>e,Xte=()=>null,ene={id:"com.microsoft.teams.integrated-auth",name:"IntegratedAuthApp",actors:["identity"],supportedEntities:[ke.ck.identity,ke.ck.oauthcode,ke.ck.authrefreshdialog,ke.ck.accountselectiondialog,ke.ck.authaccounttransfer,ke.ck.signoutNoDialog],supportedRenderModes:[se.w.Main,se.w.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},tne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"resolveThirdPartyOauthCode"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"code"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"state"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveThirdPartyOauthCode"},arguments:[{kind:"Argument",name:{kind:"Name",value:"code"},value:{kind:"Variable",name:{kind:"Name",value:"code"}}},{kind:"Argument",name:{kind:"Name",value:"state"},value:{kind:"Variable",name:{kind:"Name",value:"state"}}}]}]}}]},nne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsIntegratedAuthGetActiveCallsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasActiveCalls"}}]}}]},ine={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsIntegratedAuthGetAccountsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"homeAccountId"}}]}}]}}]},ane={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthAccountTransferMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"launchAccountTransfer"}}]}}]},one={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthRemoveAuthenticatedUserMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}},{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}]}]}}]},rne=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},entityOptions:a},requestContext:{client:o}}=e;if(n===ke.ck.oauthcode&&i===ke.SY.update)try{return await o.mutate({mutation:tne,variables:{code:a?.code||null,state:a?.state||null}}),{entity:{type:ke.ck.default,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:t.command.correlation}}}catch{return}else if(n===ke.ck.authaccounttransfer&&i===ke.SY.view){const e={entity:{type:ke.ck.authaccounttransfer,action:ke.SY.error},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:t.command.correlation}},n={id:(0,mh.DA)(),scenarioName:be.Cu.AuthWebAccountTransfer,source:"apps_integrated_auth"},[i,a]=(0,uh.we)({options:{correlation:n},source:"apps_integrated_auth",scenarioName:be.Cu.AuthWebAccountTransfer,subContext:"launchAccountTransferInteractively",eventData:["launch_account_transfer_interactively"],startWithoutScenario:!0});try{const{data:t}=await o.query({query:nne,fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});if(i.addScenarioMark(be.BQ.AuthAccountTransferGetActiveCalls),t.hasActiveCalls)return i.addScenarioMark(be.BQ.AuthAccountTransferUserHasActiveCall),a(),{...e,entityOptions:{hasActiveCalls:!0}}}catch(t){return a({error:t}),e}try{return await o.mutate({mutation:ane,context:{correlation:n}}),void a()}catch{return a(),e}}else if(n===ke.ck.signoutNoDialog&&i===ke.SY.update){const e={id:(0,mh.DA)(),scenarioName:be.Cu.AuthWebDeeplinkSignout,source:"apps_integrated_auth"},[t,n]=(0,uh.we)({options:{correlation:e},source:"apps_integrated_auth",scenarioName:be.Cu.AuthWebDeeplinkSignout,subContext:"signoutViaDeeplink",eventData:["signout_no_dialog_deeplink"]});try{const e=await async function(e,t){const n=await lne(e,!1),i=n?.data?.authenticationUsers;return i?.length>0?(t.addEventData([`nonPrimaryUserAccounts: ${i.length}`]),i):(t.addEventData(["nonPrimaryUserAccounts: 0"]),[])}(o,t),i=await lne(o,!0);t.addEventData(["primaryUser:Fetched"]);const a=i?.data?.authenticationUsers;return a?.length>0&&t.addEventData([`primaryUserAccounts:${a?.length}`]),async function(e,t,n,i){i.addEventData(["signoutStart"]);for(const n of t)sne(e,n,i);for(const t of n)sne(e,t,i)}(o,e,a,t),void n()}catch(e){return void n({error:e})}}return t};async function sne(e,t,n){n.addEventData(["signoutMutationStart"]),t.id===t.homeAccountId?(n.addEventData([`HomeUser:${t.id}.Signout`]),await e.mutate({mutation:one,variables:{reason:"SignoutDeeplink",userContextId:t.id}})):n.addEventData(["GuestUser:SkippedSignout"])}async function lne(e,t){return e.query({query:ine,fetchPolicy:"network-only",nextFetchPolicy:"cache-first",variables:{filter:{isPrimaryUser:t}}})}var cne;!function(e){e.GoogleAuthDisabled="google-auth-disabled",e.SignoutDeeplinkDisabled="signout-auth-deeplink-disabled"}(cne||(cne={}));const dne=[{filter:"/l/auth/google",execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{const{enableDesktopExternalBrowserGoogleAuth:n}=t.get(c.w.Auth);if(!n)return Promise.reject({message:cne.GoogleAuthDisabled});const{state:i,code:a}=function(e){const t=e.search,n=new URLSearchParams(t),i=n.get("state");return{code:n.get("code"),state:i}}(e);return Promise.resolve({entityCommand:{entity:{type:ke.ck.oauthcode,action:ke.SY.update,id:(0,E.v4)()},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.GoogleAuthOnBeforeDeepLinkParsed}},entityOptions:{code:a,state:i}},metadata:{allowAnonymous:!1}})}},{filter:"/l/auth/signout",execute:({context:{coreSettings:e}})=>{const{enableSignoutDeeplink:t}=e.get(c.w.Auth);return t?Promise.resolve({entityCommand:{entity:{type:ke.ck.signoutNoDialog,action:ke.SY.update,id:(0,E.v4)()},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.SignoutOnBeforeDeepLinkParsed}}},metadata:{allowAnonymous:!1}}):Promise.reject({message:cne.SignoutDeeplinkDisabled})}}],une={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"initializeAccounts"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"initializeAccounts"}}]}}]},mne=({context:{authenticationService:e,client:t,coreSettings:n,entityCommanding:i}})=>{const a={scenarioName:be.Cu.AuthWebInitializeAccounts,source:"integrated-auth-app",id:(0,mh.DA)()},[o,r]=(0,uh.we)({scenarioName:be.Cu.AuthWebInitializeAccounts,subContext:"onExperienceWarm",source:"integrated-auth-app",options:{correlation:a}}),{enableLazyInitializeAccounts:s,enableCrossTabLogout:l}=n.get(c.w.Auth);if(!s)return r({message:"LazyInitializeAccountsJobDisabled"}),[];if(l&&e){const t=e.getCrossTabCallbacks?.();t&&t.contextChangeSubscribe(i)}return o.addScenarioMark(be.BQ.AuthWebInitializeAccountsJobQueued),[{id:"lazy-initialize-accounts-job",runOncePerId:!0,job:async()=>{o.addScenarioMark(be.BQ.AuthWebInitializeAccountsJobStart);try{t.mutate({mutation:une,context:{correlation:a}})}catch(e){r({error:e})}}}]},pne=(e,t)=>({overrideType:ER.OverrideIntent,intent:{...t,entityCommand:{...t.entityCommand,entity:{id:`${t.entityCommand.command.layoutMode}`,type:ke.ck.identity,action:ke.SY.error},entityOptions:{error:e}}}}),gne=(e,t)=>({overrideType:ER.OverrideIntent,intent:{...t,entityCommand:{...t.entityCommand,entity:{id:`${t.entityCommand.command.layoutMode}`,type:ke.ck.identitydialog,action:ke.SY.error},command:{...t.entityCommand.command,visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.focus},entityOptions:{error:e}}}}),hne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthAuthenticateOrGetUserMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"allowAnon"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"loginHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tenantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}},type:{kind:"NamedType",name:{kind:"Name",value:"CrossCloudMeetingAuthDetails"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplink"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticateOrGetUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"allowAnon"},value:{kind:"Variable",name:{kind:"Name",value:"allowAnon"}}},{kind:"Argument",name:{kind:"Name",value:"loginHint"},value:{kind:"Variable",name:{kind:"Name",value:"loginHint"}}},{kind:"Argument",name:{kind:"Name",value:"tenantId"},value:{kind:"Variable",name:{kind:"Name",value:"tenantId"}}},{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"meetingDetails"},value:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}}},{kind:"Argument",name:{kind:"Name",value:"deeplink"},value:{kind:"Variable",name:{kind:"Name",value:"deeplink"}}},{kind:"Argument",name:{kind:"Name",value:"prioritizeUserContextId"},value:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]},vne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthAuthenticateOrGetUserForMeetingMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"loginHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tenantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}},type:{kind:"NamedType",name:{kind:"Name",value:"CrossCloudMeetingAuthDetails"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplink"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticateOrGetUserForMeeting"},arguments:[{kind:"Argument",name:{kind:"Name",value:"loginHint"},value:{kind:"Variable",name:{kind:"Name",value:"loginHint"}}},{kind:"Argument",name:{kind:"Name",value:"tenantId"},value:{kind:"Variable",name:{kind:"Name",value:"tenantId"}}},{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"meetingDetails"},value:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}}},{kind:"Argument",name:{kind:"Name",value:"deeplink"},value:{kind:"Variable",name:{kind:"Name",value:"deeplink"}}},{kind:"Argument",name:{kind:"Name",value:"prioritizeUserContextId"},value:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]},yne={filter:"*",execute:async({intent:e,context:{client:t,coreSettings:n,scenarioFactory:i}})=>{const{authTelemetry:a,closeTelemetry:o}=((e,t)=>{const{scenarioCorrelation:{correlation:n,clientLaunchId:i}}=t;let a,o,r;t.shouldRenderContent&&(a=t.entityCommand.command.layoutMode,o=t.entityCommand.entity.type,r=t.entityCommand.entity.action);const s={id:n?.id??(0,E.v4)(),source:n?.source??"onBeforeIntentAuth",scenarioName:n?.scenarioName??be.Cu.AuthWebUser},l=s.scenarioName&&i&&e.findScenarioByNameAndId(s.scenarioName,i)||void 0,[c,d]=(0,uh.yw)({correlation:s,subContext:"onBeforeIntentAuthenticated",scenario:l,eventData:[`layoutMode:${a}`,`entityType:${o}`,`action:${r}`,`isNRC:${t.shouldRenderContent}`,`intentMetadata:[anon:${+t.metadata.allowAnonymous},allowXTenantAccess:${t.metadata.allowXTenantAccess??void 0},  tid: ${+!!t.metadata.tenantId}, uid: ${+!!t.metadata.userContextId}, loginHint:${+!!t.metadata.loginHint}]`]});return c.appendScenarioEventData({targetedUser:t.metadata.userContextId,target:t.metadata.tenantId,allowAnon:t.metadata.allowAnonymous,allowXTenantAccess:t.metadata.allowXTenantAccess}),c.addScenarioMark("auth_web_app_on_before_intent_auth_start"),{authTelemetry:c,closeTelemetry:d}})(i,e);if(!n.get(c.w.Auth).enableIntegratedAuthApp)return a.addScenarioMark("auth_web_app_on_before_intent_auth_stop",{message:"enableIntegratedAuthApp is disabled"}),o({reason:"enableIntegratedAuthApp is disabled"}),{overrideType:ER.NoOverride};const{enableAuthenticateOrGetUserForMeeting:r,enableMAIntentHandling:s,enableCCM:l,isWebClientType:d,enableTenantSwitchQsp:u,enableAccountSelectionOnPreMeetingJoin:m,disableAllowXTenantAccessQSP:p}=n.get(c.w.Auth);let h;l&&(h=(e=>{if(e.shouldRenderContent)return(0,kt.oH)(e.entityCommand)})(e));const v=d||m,y=function(e,t,n,i){if(!e||!t)return;const a=new URLSearchParams;if(!i)return a;try{const e=Object.entries(i);for(const[t,n]of e)a.append(t.toLowerCase(),n)}catch{return n.addEventData([`fail to getQsParamFromUrl:${i}`]),new URLSearchParams}return a}(!!d,!!u,a,t.ctx?.platformService?.queryStringParameters),S=y?.get("tenantid"),f=y?.get("loginhint")||y?.get("login_hint"),k=e.metadata.allowXTenantAccess&&!p?void 0:e.metadata.tenantId||S,C=e.metadata.loginHint||f,b=v?e.metadata.deepLink:void 0;let w;a.addEventData(["enableCCM:"+ +!!l,"meetingDetails:"+ +!!h,`allowXTenantAccess:${e.metadata.allowXTenantAccess}`,`tenantIdQsp:${S}`,"loginHintQsp:"+ +!!f]);const T={allowXTenantAccess:e.metadata.allowXTenantAccess,tenantId:k,loginHint:C,userContextId:e.metadata.userContextId,meetingDetails:h,deeplink:b,prioritizeUserContextId:e.metadata.prioritizeUserContextId},I={correlation:e.scenarioCorrelation.correlation};try{let i;if(r&&(e=>e.shouldRenderContent&&("callingdeeplink"===e.entityCommand.entity.type||"meetings"===e.entityCommand.entity.type))(e)){const{data:{authenticateOrGetUserForMeeting:e}}=await t.mutate({mutation:vne,variables:T,context:I});i=e}else{const{data:{authenticateOrGetUser:n}}=await t.mutate({mutation:hne,variables:{...T,allowAnon:e.metadata.allowAnonymous},context:I});i=n}if(i?.isAuthenticated)return((e,t,n,i,a,o)=>{e.addEventData([`user:1,role:${a}`]),e.addScenarioMark("auth_web_app_on_before_intent_auth_stop",{targetedUser:t.metadata.userContextId,accountId:i,target:t.metadata.tenantId,tenantId:n,allowAnon:t.metadata.allowAnonymous,allowXTenantAccess:t.metadata.allowXTenantAccess,message:`user:${i},role:${a},type:${o}`}),a===pg.a7.Anonymous&&e.recordAuthUserBiTelemetry(i,{scenario:sv.Yq.authAnonLaunch})})(a,e,i.profile.tenantId,i.id,i.role,i.type),((e,t)=>{const{enableAccountSelectionOnPreMeetingJoin:n,buildCloud:i}=t.get(c.w.Auth);return!!n&&i!==e})(i.cloud,n)?{overrideType:ER.OverrideCloud,cloud:i.cloud}:(a.recordAuthUserBiTelemetry(void 0,{scenario:sv.Yq.authInitComplete}),{overrideType:ER.OverrideUserContext,userContextId:i.id})}catch(e){w=e.graphQLErrors?.[0]?.originalError,function(e,t,n,i){i.addScenarioMark("auth_web_app_user_query_fails",{error:{...e,correlationId:i.correlation.id,errorCode:e?.code||t||"NoErrorCodeFoundInOnBeforeIntentAuthentication",message:e?.message||n}})}(w,e.code,e.message,a)}return a.addEventData([`user:0,operationType:cold,isMAIntentHandlingEnabled:${s}`]),((e,t,n,i)=>{if(i.addScenarioMark("auth_web_app_on_before_intent_auth_new_intent"),!e.shouldRenderContent)return{overrideType:ER.NoOverride};if(t&&!0===t.redirectToEndPage)return i.recordAuthUserBiTelemetry(void 0,{scenario:sv.Yq.authInitComplete}),t.isModal?gne(t,e):pne(t,e);let a,o=t,r=e.entityCommand.command,s=e.entityCommand.command.layoutMode===Yt.Rm.minimal?ke.SY.signin:ke.SY.default;if(n&&e.metadata.tenantId){const n='Unexpected error value: { message: "Multiple users found in cache with same tenantId", errorCode: "MultipleUsersPresentWithSpecifiedIdentifier" }'===t?.message;a=n?e.metadata.tenantId:"",o=n?void 0:t,i.addEventData(["showAccountPicker:1","tenantIdFromOptions:"+ +!!a]),i.addScenarioMark("auth_web_app_on_before_intent_auth_show_account_picker",{tenantId:a}),r={...r,visibilityState:g.Rp.show,stateTransition:g.Ar.new,layoutMode:Yt.Rm.focus},s=ke.SY.list}i.addScenarioMark("auth_web_app_on_before_intent_auth_stop");const l=e?.entityCommand?.entity?.type;return i.recordAuthUserBiTelemetry(void 0,{scenario:sv.Yq.authLoginPage}),i.recordAuthUserBiTelemetry(void 0,{scenario:sv.Yq.authInitComplete}),{overrideType:ER.OverrideIntent,intent:{...e,entityCommand:{...e.entityCommand,command:r,entity:{id:`${e.entityCommand.command.layoutMode}`,type:ke.ck.identity,action:s,linkedEntity:e.entityCommand.command.layoutMode===Yt.Rm.focus?{type:e.entityCommand.entity.type,action:e.entityCommand.entity.action,id:e.entityCommand.entity.id??e.entityCommand.command.correlation.id}:void 0},entityOptions:{error:o,tenantId:a,hideTitleAndOptions:l===ke.ck.meetings||l===ke.ck.callingdeeplink||l===ke.ck.channels}}}}})(e,w,s,a)}};const Sne=e=>{const{entity:t}=e;if(t.type===ke.ck.identity)return be.Cu.AuthLaunch};var fne=n(663789);const kne="identity",Cne="signOut",bne="addNewAccount",wne="switchAccount",Tne="switchTenants",Ine="manageTenant",Nne="openMeControl",Ane=()=>({actor:kne,action:Cne}),Ene=(e,t)=>({actor:kne,action:wne,data:{targetAccountId:e,targetEntity:t}}),Fne=e=>({actor:kne,action:Tne,data:{targetTenantId:e}}),_ne=()=>({actor:kne,action:Nne}),Dne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthSwitchAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetEntity"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"switchAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"targetEntity"},value:{kind:"Variable",name:{kind:"Name",value:"targetEntity"}}}]}]}}]},Pne={actionOutcome:GR.nd.switchAccount,actionScenario:GR.vB.AuthMeControlEvent,actionScenarioType:GR.DB.appAuth,actionWorkload:GR.E0.auth,panelRegion:GR.rP.main,moduleName:GR.Sn.AuthAppOnCommandReceived},Mne={actionOutcome:GR.nd.switchTenants,actionScenario:GR.vB.AuthMeControlEvent,actionScenarioType:GR.DB.appAuth,actionWorkload:GR.E0.auth,panelRegion:GR.rP.main,moduleName:GR.Sn.AuthAppOnCommandReceived},Rne={actionOutcome:GR.nd.manageTenant,actionScenario:GR.vB.AuthMeControlEvent,actionScenarioType:GR.DB.appAuth,actionWorkload:GR.E0.auth,panelRegion:GR.rP.main,moduleName:GR.Sn.AuthAppOnCommandReceived},xne={actionOutcome:GR.nd.addNewAccount,actionScenario:GR.vB.AuthMeControlEvent,actionScenarioType:GR.DB.appAuth,actionWorkload:GR.E0.auth,panelRegion:GR.rP.main,moduleName:GR.Sn.AuthAppOnCommandReceived},Lne={actionOutcome:GR.nd.signOut,actionScenario:GR.vB.AuthMeControlEvent,actionScenarioType:GR.DB.appAuth,actionWorkload:GR.E0.auth,panelRegion:GR.rP.main,moduleName:GR.Sn.AuthAppOnCommandReceived},One={actionOutcome:GR.nd.openMeControl,actionScenario:GR.vB.AuthMeControlEvent,actionScenarioType:GR.DB.appAuth,actionWorkload:GR.E0.auth,panelRegion:GR.rP.main,moduleName:GR.Sn.AuthAppOnCommandReceived},jne=async({commandInput:e,requestContext:{client:t,coreSettings:n}})=>{const{command:i}=e,a={scenarioName:be.Cu.AuthCommandReceived,source:i.data?.commandSource??A.p.AuthApp,id:(0,mh.DA)()},o=i.data?.targetAccountId||i.data?.targetTenantId,[r,s]=(0,uh.we)({scenarioName:be.Cu.AuthCommandReceived,subContext:"auth-command",source:"integrated-auth-app",options:{correlation:a},eventData:[`command: ${i.action}`],scenarioEventData:{targetedUser:o}}),l=fne.l.getUserBiService(o||"GLOBAL");let d;if(!ene.actors.includes(i.actor)){return void s({error:{name:"unsupported_target",message:"target is unsupport",correlationId:a.id,context:"on_command_received",subContext:"integrated_auth",errorCode:"unsupported_target"}})}const{enableModalForAddAccount:u,disableAddAccount:m}=n.get(c.w.Auth),p=u||m?ke.ck.identitydialog:ke.ck.identity,h=u||m?g.Ar.extend:g.Ar.new,{targetEntity:v}=i.data??{};switch(i.action){case wne:if(l.recordPanelAction(Pne),r.addScenarioMark("auth_switch_account_mutation"),!o){s({error:{name:"missing_parameter",message:"Account Id missing in switch account command",correlationId:a.id,context:"on_command_received",subContext:"integrated_auth",errorCode:"missing_parameter"}});break}return s(),void t.mutate({mutation:Dne,variables:{userContextId:o,targetEntity:v},context:{correlation:a}});case Tne:if(l.recordPanelAction(Mne),r.addScenarioMark("auth_switch_tenant_mutation"),!o){s({error:{name:"missing_parameter",message:"Account Id missing in switch tenant command",correlationId:a.id,context:"on_command_received",subContext:"integrated_auth",errorCode:"missing_parameter"}});break}return s(),void t.mutate({mutation:Dne,variables:{userContextId:o},context:{correlation:a}});case Ine:{l.recordPanelAction(Rne),r.addScenarioMark("auth_manage_org_mutation");const e={source:A.p.AuthApp};return d={entity:{id:aK.G.Accounts,type:ke.ck.settingsstore,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:e},entityOptions:{correlation:e}},s(),d}case bne:{l.recordPanelAction(xne),r.addScenarioMark("auth_add_new_account_command");const e={source:i.data?.commandSource??A.p.AuthApp};return d={entity:{type:p,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:h,layoutMode:Yt.Rm.focus,correlation:e},entityOptions:{correlation:e}},s(),d}case Cne:return l.recordPanelAction(Lne),r.addScenarioMark("auth_sign_out_dialog_command"),d={entity:{type:ke.ck.signoutdialog,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.AuthApp}}},s(),d;case Nne:return l.recordPanelAction(One),(0,uh.we)({scenarioName:be.Cu.AuthWebMeControlRender,subContext:"auth-command",source:"integrated-auth-app",options:{correlation:{scenarioName:be.Cu.AuthWebMeControlRender,source:"integrated-auth-app",id:(0,mh.DA)()}}}),r.addScenarioMark("auth_open_mecontrol_command"),void s();default:s({error:{name:"invalid_command",message:`command is invalid ${i.action}`,correlationId:a.id,context:"on_command_recieved",subContext:"integrated_auth",errorCode:"invalid_command"}})}},Bne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsIntegratedAuthTenantListUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantListUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"userTenantId"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"tenantList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantName"}},{kind:"Field",name:{kind:"Name",value:"tenantPrimaryDomainName"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"userId"}},{kind:"Field",name:{kind:"Name",value:"tenantType"}},{kind:"Field",name:{kind:"Name",value:"userType"}},{kind:"Field",name:{kind:"Name",value:"isInvitationRedeemed"}},{kind:"Field",name:{kind:"Name",value:"cloudType"}},{kind:"Field",name:{kind:"Name",value:"tenantRelationship"}},{kind:"Field",name:{kind:"Name",value:"isTenantHidden"}},{kind:"Field",name:{kind:"Name",value:"userTenantState"}}]}}]}}]}}]};function Une(e){const{authenticationUser:t,client:n,loggerFactory:i,authenticationService:a}=e,o=n,r=i.newLogger("AuthTenantListUpdateEventSubscriptionJob","apps-integrated-auth");return{id:"auth-tenant-list-update-event-subscription",runOncePerId:!0,job:()=>{const e=o.subscribe({query:Bne,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i){const a={id:e?.data?.tenantListUpdateEvent?.correlationId??(0,mh.DA)(),source:"auth-tenant-list-update-event-subscription-job:handleAuthTenantListUpdateEvent",scenarioName:be.Cu.AuthHandleTenantsPushNotification};if(t?.id!==t?.homeAccountId){const[e,n]=(0,uh.we)({options:{correlation:a},subContext:"handleAuthTenantListUpdateEvent",scenarioName:be.Cu.AuthHandleTenantsPushNotificationSkipped,source:"auth-tenant-list-update-event-subscription-job"});return e.addEventData(["auth-tenant-list-update-event-subscription-job:handleAuthTenantListUpdateEvent:ProcessingSkipped"]),e.appendScenarioEventData({accountId:t?.id}),void n()}const[o,r]=(0,uh.we)({options:{correlation:a},subContext:"handleAuthTenantListUpdateEvent",scenarioName:be.Cu.AuthHandleTenantsPushNotification,source:"auth-tenant-list-update-event-subscription-job"});try{o.appendScenarioEventData({accountId:t?.id}),o.addScenarioMark("auth_handle_tenants_push_notification_subscription_job_start");const s="auth-tenant-list-update-event-subscription-job:handleAuthTenantListUpdateEvent";if(e.errors){const t=(0,ge.hR)(e.errors.map((e=>e.message)).join(","));throw i.errorToTelemetry?.("Tenant List Push Event received with Errors in home account context","auth_tenant_list_update_event_subscription_job",{errors:t},!0),o.addScenarioMark("auth_handle_tenants_push_notification_event_received_with_errors"),(0,Jt.$5)({context:"auth-tenant-list-update-event-subscription-job",subContext:s,message:"Tenant List Push Event received with Errors in home account context ",errorCode:Qt.tG.PushNotificationEventWithErrors,isExpected:!1,correlationId:a.id})}if(!e.data?.tenantListUpdateEvent)throw i.warn(`Received empty event for home account context with tenantId: ${t?.profile?.tenantId}`),o.addScenarioMark("auth_handle_tenants_push_notification_empty_event_received"),(0,Jt.$5)({context:"auth-tenant-list-update-event-subscription-job",subContext:s,message:"Empty Tenant List Push Event received in home account context ",errorCode:Qt.tG.MissingRequiredFields,isExpected:!1,correlationId:a.id});const{tenantListUpdateEvent:l}=e.data,{userAccountId:c,userTenantId:d,tenantList:u,version:m,correlationId:p}=l,g=u?.map((e=>({tenantName:e.tenantName,tenantPrimaryDomainName:e.tenantPrimaryDomainName,tenantId:e.tenantId,userId:e.userId,tenantType:e.tenantType,userType:e.userType,isInvitationRedeemed:e.isInvitationRedeemed,cloudType:e.cloudType,tenantRelationship:e.tenantRelationship,isTenantHidden:e.isTenantHidden,userTenantState:e.userTenantState})))||[];i.log(`Tenant list push notification received for home tenantId: ${d}, updated tenant count: ${g?.length}, updated version: ${m} with correlation Id: ${p}`),await(n?.handleTenantListPushNotification?.({correlation:a,forceRefresh:!0,accountId:c},{userAccountId:c,userTenantId:d,tenantList:g})),o.addScenarioMark("auth_handle_tenants_push_notification_stop"),r()}catch(e){o.addEventData([`auth-tenant-list-update-event-subscription-job:handleAuthTenantListUpdateEventFailed: ${e.errorCode}`]),o.addScenarioMark("auth_handle_tenants_push_notification_stop",e),i.errorToTelemetry?.(`Handling Tenant List Push Notification failed for home account with tenantId: ${t?.profile?.tenantId}, ${e.errorCode}`,"auth_tenant_list_update_event_subscription_job",{errors:e.message},!0),r({error:e})}}(e,t,a,r)}));return()=>{e.unsubscribe()}}}}const $ne=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(668172),n.e(787454),n.e(181316),n.e(598188),n.e(842242),n.e(984165),n.e(487867),n.e(960122),n.e(231020),n.e(811751),n.e(568721),n.e(845039),n.e(258832),n.e(567830),n.e(178249),n.e(354130),n.e(346069),n.e(826932),n.e(317183),n.e(367741),n.e(461369),n.e(968775),n.e(791296),n.e(845091),n.e(495544),n.e(464079),n.e(326317),n.e(307422),n.e(94139),n.e(467129),n.e(202564),n.e(712284),n.e(601715),n.e(75416),n.e(777944),n.e(652658),n.e(544228),n.e(627867),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(715192),n.e(331703),n.e(936254),n.e(668415),n.e(684694),n.e(813370),n.e(478723),n.e(577607),n.e(108698),n.e(367831),n.e(391),n.e(879803),n.e(515758),n.e(223810),n.e(639495),n.e(743566),n.e(506888),n.e(119940),n.e(670225),n.e(605837),n.e(247727),n.e(598562),n.e(644740),n.e(914022),n.e(14921),n.e(556261),n.e(477697)]).then(n.bind(n,612846));const Wne={id:"com.microsoft.teams.meet",name:"MeetApp",getLocalizedName:async e=>(await e.waitForNamespace("meetForWork"),e.stringTranslate("meetForWork","meet_app_name")),actors:[ll],supportedEntities:[ke.ck.meet],supportedRenderModes:[se.w.Main,se.w.HorizontalBar]},Vne=e=>{if(Hne(e))return zne(e)?{subNavEntity:qne(e),headerEntity:Gne(e),startEntity:Yne(e),mainEntity:Qne(e),endEntity:Jne(e)}:null},Hne=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.meet].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},zne=()=>!0,qne=()=>null,Gne=({entity:e,coreSettings:t})=>{const{enableHeaderSlotInMeet:n}=t?.get(c.w.Meet)||{};return n?e:null},Yne=()=>null,Qne=({entity:e})=>e,Jne=({contextEntity:e})=>e&&e.action&&e.type===ke.ck.meetingcollaboration?e:null,Kne=()=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:!0}}}),Zne={onEventReceived:({eventInput:e})=>{if(e.event.type===uq.mu.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:vq(t)})}return Promise.resolve(void 0)}},Xne=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("MeetApp onCommandReceived","apps-meet");if(e.command.actor===ll)return n===cl?{entity:{type:ke.ck.meet,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}}:void i.error(`Command action '${n}' is not supported at MeetApp.`);i.error(`Command for actor '${e.command.actor}' cannot be handled by MeetApp.`)},eie=({appRenderMode:e})=>{const t=new qz.D;return e!==se.w.Main||t.registerAppPhase({phase:m.Jj.CRITICAL,signals:[Gz.m.MEET_APP_RENDERED],timeout:1e4}),t.appPhases},tie="a63f7012-8cc9-42d5-99c3-e35f526fab17",nie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMeetPinM365ApplicationMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PinM365ApplicationInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pinM365Application"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsMeetPinM365ApplicationFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsMeetPinM365ApplicationFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationPinStatusUpdateResult"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationPinStatusUpdateResult"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"updatedM365Applications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"platformType"}},{kind:"Field",name:{kind:"Name",value:"pinnedIndex"}}]}}]}}]}}]}.definitions]},iie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMeetTriggerFetchBeforeEnterMeetAppMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerFetchBeforeEnterMeetApp"}}]}}]},aie=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i}},requestContext:a,requestContext:{client:o,userBiService:r,coreSettings:s}}=e,l=a.loggerFactory.newLogger("CallingOnBeforeCommandHandled","apps-meet");if(oie(n,i)&&((e,t)=>{const{enableFetchBeforeEnterMeetApp:n}=t.get(c.w.Meet);n&&e.mutate({mutation:iie})})(o,s),rie(n,i))try{const e=await(o?.mutate({mutation:nie,variables:{...t,input:{applicationID:tie}},fetchPolicy:"no-cache"}));if(e){const t=e.data?.pinM365Application?.updatedM365Applications?.[0],{id:n,pinnedIndex:i=null}=t||{};n===tie&&null!==i&&i>=0&&sie(r,l)}}catch(e){return l?.errorToTelemetry?.("[MeetPinM365ApplicationMutation] failed","calling_deeplink_navigation",e?.code),Promise.resolve(t)}return Promise.resolve(t)},oie=(e,t)=>e===ke.ck.meet&&(t===ke.SY.list||t===ke.SY.default),rie=(e,t)=>e===ke.ck.meet&&t===ke.SY.pin,sie=(e,t)=>{if(!e?.recordPanelAction)return;const n={appName:"MeetApp",panelType:GR.HP.pinMeet,panelRegion:GR.rP.popover,moduleName:GR.Sn.pinMeetCoachmarkCTA,moduleType:GR.nR.button,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenarioType:GR.DB.pinMeet};e.recordPanelAction(n,t)},lie=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(616161),n.e(487867),n.e(325670),n.e(501156),n.e(484331),n.e(736709),n.e(216284),n.e(636192),n.e(393706),n.e(79981),n.e(817556),n.e(280759),n.e(598200),n.e(506289),n.e(289847),n.e(153959),n.e(50150),n.e(834742),n.e(962777),n.e(458391),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(977204),n.e(784980),n.e(262010),n.e(725353),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(214467),n.e(679354),n.e(397928),n.e(463675),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(367831),n.e(233794),n.e(298265),n.e(195009),n.e(350226),n.e(764852),n.e(811969),n.e(446090),n.e(96657),n.e(599984)]).then(n.bind(n,127161)),cie=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(616161),n.e(487867),n.e(325670),n.e(501156),n.e(484331),n.e(736709),n.e(216284),n.e(636192),n.e(393706),n.e(79981),n.e(817556),n.e(280759),n.e(598200),n.e(506289),n.e(289847),n.e(153959),n.e(50150),n.e(834742),n.e(962777),n.e(458391),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(977204),n.e(784980),n.e(262010),n.e(725353),n.e(524014),n.e(383414),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(214467),n.e(679354),n.e(397928),n.e(463675),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(367831),n.e(233794),n.e(298265),n.e(195009),n.e(350226),n.e(764852),n.e(811969),n.e(446090),n.e(96657),n.e(599984)]).then(n.bind(n,819867));function die(){const e=()=>null;return{eventHandlers:Zne,getAppPhases:eie,getAppViewEntities:Vne,getAppViewEntitiesProps:Kne,getPlatformAppIdForEntity:e=>e.type===ke.ck.meet?tie:void 0,manifest:Wne,onCommandReceived:Xne,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a})=>{if(t===se.w.Main||t===se.w.HorizontalBar){const e="meet-app";i("ChunkLoadStarted",{chunkName:e});const{enableEntityMoreInfo:o}=n.get(c.w.Core),r=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e});t===se.w.Main&&(a.newScenario(be.Cu.MeetAppRender),a.newScenario(be.Cu.MeetAppUpcomingRender),a.newScenario(be.Cu.MeetAppRecentRender));const{Meet:s}=await(0,ev.wg)(lie,e,a),{LPC:l}=o?{LPC:r}:await(0,ev.wg)(cie,e,a),d=o?r:wJ.CA;return i("ChunkLoadSucceeded",{chunkName:e}),t===se.w.Main&&(a.markStep(be.Cu.MeetAppRender,be.BQ.MeetAppRenderWebpackLoaded),a.markStep(be.Cu.MeetAppUpcomingRender,be.BQ.MeetAppUpcomingRenderWebpackLoaded),a.markStep(be.Cu.MeetAppRecentRender,be.BQ.MeetAppRecentRenderWebpackLoaded)),(0,Lr.Y)(l,{children:(0,Lr.Y)(d,{children:(0,Lr.Y)(s,{appRenderMode:t})})})}return(0,Lr.Y)(e,{})},getCommandScenarioName:uie,onBeforeCommandHandled:aie}}const uie=()=>be.Cu.MeetAppLaunch,mie=e=>{if(pie(e))return gie(e)?{subNavEntity:hie(e),headerEntity:vie(e),startEntity:yie(e),mainEntity:Sie(e),endEntity:fie(e)}:null},pie=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.attendancereport,ke.ck.meetinganalytics].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},gie=()=>!0,hie=()=>null,vie=({entity:e})=>e,yie=()=>null,Sie=({entity:e})=>e,fie=()=>null,kie={id:"com.microsoft.teams.meetinganalytics",name:"MeetingAnalytics",supportedEntities:[ke.ck.attendancereport,ke.ck.meetinganalytics],supportedRenderModes:[se.w.Main,se.w.HorizontalBar],getDefaultCommand:()=>({type:ke.ck.meetinganalytics,action:ke.SY.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}};var Cie,bie,wie;!function(e){e.meetinganalytics="/l/meetinganalytics"}(Cie||(Cie={})),function(e){e.InvalidContext="Parsed meeting analytics deep link does not contain valid context query param"}(bie||(bie={})),function(e){e.OganizerId="organizerId",e.ThreadId="threadId",e.CallId="callId",e.MessageId="messageId",e.SubType="subType"}(wie||(wie={}));const Tie=[{filter:Cie.meetinganalytics,execute:({deeplinkUrl:e,preferredCommandInput:t})=>{const{searchParams:n}=e,i=n.get(wie.ThreadId)||"",a=n.get(wie.OganizerId)||"",o=n.get(wie.CallId)||"",r=n.get(wie.MessageId)||"0",s=n.get(wie.SubType)||"deep-link";return Boolean(i&&a)?Promise.resolve({entityCommand:{entity:{type:ke.ck.meetinganalytics,action:ke.SY.view,id:i},command:{stateTransition:t?.stateTransition??g.Ar.new,visibilityState:t?.visibilityState??g.Rp.show},entityOptions:{subType:s,threadId:i,organizerId:a,messageId:r,callId:o}},metadata:{allowAnonymous:!1}}):Promise.reject({message:bie.InvalidContext})}}],Iie=()=>Promise.all([n.e(912845),n.e(320494),n.e(120951),n.e(842242),n.e(616161),n.e(102216),n.e(390761),n.e(85394),n.e(864774),n.e(700879),n.e(467129),n.e(202564),n.e(449827),n.e(239470),n.e(407914),n.e(214467),n.e(835167),n.e(387912),n.e(577187)]).then(n.bind(n,85139)),Nie=()=>kie.windowFeatures||{};function Aie(){const e=()=>null;return{getAppViewEntities:mie,getAppWindowFeatures:Nie,manifest:kie,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main||t===se.w.HorizontalBar){const e="meeting-analytics-app";n("ChunkLoadStarted",{chunkName:e});const{MeetingAnalyticsRenderer:a}=await(0,ev.wg)(Iie,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(vG.e,{namespaces:["meetingAnalytics"],loaderRenderer:null,children:(0,Lr.Y)(a,{appRenderMode:t})})}return(0,Lr.Y)(e,{})},onBeforeDeeplinkParsed:Tie}}const Eie=e=>{if(Fie(e))return _ie(e)?{subNavEntity:Die(e),headerEntity:Pie(e),startEntity:Mie(e),mainEntity:Rie(e),endEntity:xie(e)}:null},Fie=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.meetingrecap].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},_ie=()=>!0,Die=()=>null,Pie=()=>null,Mie=()=>null,Rie=({entity:e})=>e,xie=()=>null,Lie={id:"com.microsoft.teams.meeting-recap-chiclet",name:"MeetingRecapChiclet",supportedEntities:[ke.ck.meetingrecapchiclet],supportedRenderModes:[se.w.Main],getDefaultCommand:()=>({type:ke.ck.meetingrecapchiclet,action:ke.SY.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},Oie=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(306517),n.e(636192),n.e(393706),n.e(79981),n.e(144800),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(214467),n.e(397928),n.e(288919),n.e(615002),n.e(343201),n.e(354884),n.e(892960),n.e(672666),n.e(104945),n.e(686325)]).then(n.bind(n,274740)),jie=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(459959),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(306517),n.e(636192),n.e(393706),n.e(79981),n.e(144800),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(214467),n.e(397928),n.e(288919),n.e(615002),n.e(343201),n.e(354884),n.e(892960),n.e(672666),n.e(104945),n.e(686325)]).then(n.bind(n,819867)),Bie=()=>Lie.windowFeatures||{};function Uie(){const e=()=>null;return{getAppViewEntities:Eie,getAppWindowFeatures:Bie,manifest:Lie,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,coreSettings:a})=>{if(t===se.w.Main){const{MeetingRecapChicletRenderer:e}=await(async(e,t)=>{const n="meeting-recap-chiclet-app";t("ChunkLoadStarted",{chunkName:n});const[{MeetingRecapChicletRenderer:i},{LPC:a}]=await Promise.all([(0,ev.wg)(Oie,n,e),(0,ev.wg)(jie,n,e)]);return t("ChunkLoadSucceeded",{chunkName:n}),{MeetingRecapChicletRenderer:i,LPC:a}})(i,n),{enableEntityMoreInfo:t}=a.get(c.w.Core),o=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),{LPC:r}=t?{LPC:o}:await(0,ev.wg)(jie,"meeting-recap-chiclet-app",i),s=t?o:wJ.CA;return(0,Lr.Y)(vG.e,{namespaces:["meetingRecap"],loaderRenderer:null,children:(0,Lr.Y)(r,{children:(0,Lr.Y)(s,{children:(0,Lr.Y)(e,{})})})})}return(0,Lr.Y)(e,{})}}}const $ie=e=>{if(Wie(e))return Vie(e)?{subNavEntity:Hie(e),headerEntity:zie(e),startEntity:qie(e),mainEntity:Gie(e),endEntity:Yie(e)}:null},Wie=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.meetingrecap].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Vie=()=>!0,Hie=()=>null,zie=({entity:e})=>e,qie=()=>null,Gie=({entity:e})=>e,Yie=({contextEntity:e})=>e&&e.action&&e.type===ke.ck.meetingcollaboration?e:null,Qie={id:"com.microsoft.teams.meeting-recap",name:"MeetingRecap",supportedEntities:[ke.ck.meetingrecap,ke.ck.meetingrecaptab],supportedRenderModes:[se.w.Main,se.w.HorizontalBar],getDefaultCommand:()=>({type:ke.ck.meetingrecap,action:ke.SY.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},Jie="deep-link";var Kie,Zie,Xie,eae;!function(e){e.recapMeeting="/l/meetingrecap"}(Kie||(Kie={})),function(e){e.FeatureNotEnabled="recap_on_before_deep_link_parsed_feature_not_enabled_error",e.InvalidContext="recap_on_before_deep_link_parsed_invalid_context_error"}(Zie||(Zie={})),function(e){e.FeatureNotEnabled="Feature for parsing recap deep links in T2.1 is not enabled",e.InvalidContext="Parsed recap deep link does not contain valid context query param"}(Xie||(Xie={})),function(e){e.driveId="driveId",e.driveItemId="driveItemId",e.sitePath="sitePath",e.fileUrl="fileUrl",e.iCalUid="iCalUid",e.masterICalUid="masterICalUid",e.threadId="threadId",e.timestamp="timestamp",e.timeSeek="timeSeek",e.defaultRightTab="defaultRightTab",e.organizerId="organizerId",e.tenantId="tenantId",e.meetingType="meetingType",e.recordingId="recordingId",e.organizerGroupId="organizerGroupId",e.channelType="channelType",e.replyChainId="replyChainId",e.subType="subType"}(eae||(eae={}));const tae=(e,t,n,i,a)=>{return e?(o=i||"",{type:ke.ck.chats,action:ke.SY.view,id:o}):t&&n?.startsWith("Activity")?(e=>({type:ke.ck.schedulingform,action:ke.SY.view,id:JSON.stringify({eventId:e,providerType:2,tabId:"Recap",key:e})}))(a||""):void 0;var o},nae=({deeplinkUrl:e,parsedDeeplinkHash:t,preferredCommandInput:n,context:{loggerFactory:i,coreSettings:a}})=>{const o=i.newLogger("MeetingRecapApp onBeforeDeeplinkParsed","apps-meeting-recap");if(o.log(`Handling recap deeplink: ${e}`),t?.search)return(e=>{const{pathname:t}=e,n=t.split("/")[2];return Promise.resolve({entityCommand:{entity:{type:ke.ck.meetingrecap,action:ke.SY.view,id:n},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show},entityOptions:{subType:Jie,threadId:n}},metadata:{allowAnonymous:!1}})})(t);const{driveId:r,driveItemId:s,sitePath:l,fileUrl:d,threadId:u,iCalUid:m,masterICalUid:p,timestamp:h,timeSeek:v,defaultRightTab:y,organizerId:S,tenantId:f,meetingType:k,recordingId:C,organizerGroupId:b,channelType:w,replyChainId:T,subType:I}=(e=>{const t=e.get(eae.driveId),n=e.get(eae.driveItemId),i=e.get(eae.sitePath),a=e.get(eae.fileUrl),o=e.get(eae.threadId)||"",r=e.get(eae.iCalUid)||"",s=e.get(eae.masterICalUid),l=e.get(eae.timestamp),c=e.get(eae.timeSeek),d=e.get(eae.defaultRightTab),u=e.get(eae.organizerId),m=e.get(eae.tenantId),p=e.get(eae.meetingType),g=e.get(eae.recordingId),h=e.get(eae.organizerGroupId),v=e.get(eae.channelType),y=e.get(eae.replyChainId),S=e.get(eae.subType)||"",f=e.get("activityPreviewType");return{driveId:t,driveItemId:n,sitePath:i,fileUrl:a,threadId:o,iCalUid:r,masterICalUid:s,timestamp:l,timeSeek:c,defaultRightTab:d,organizerId:u,tenantId:m,meetingType:p,recordingId:g,organizerGroupId:h,channelType:v,replyChainId:y,subType:S&&f?`${S}-${f}`:S}})(e.searchParams),{forceRecapDeeplinkV1:N,enablePopOutRecapFromChiclet:A,enableCalendarHeaderInRecap:E,enableChatHeaderInRecap:F}=a.get(c.w.MeetingRecap),_=(!N||!N?.includes(I))&&r&&s&&l&&u;if(!Boolean(u)&&!Boolean(_))throw o.errorToTelemetry?.(Xie.InvalidContext,Zie.InvalidContext),Error(Xie.InvalidContext);const D=tae(F,E,I,u,m),P=((e,t,n)=>{const i=e?g.Ar.new:g.Ar.forceFlush;return{stateTransition:t??i,visibilityState:n??g.Rp.show}})(!!A,n?.stateTransition,n?.visibilityState);return _?Promise.resolve({entityCommand:{entity:{type:ke.ck.meetingrecap,action:ke.SY.view,id:`recap-${r}-${s}`,linkedEntity:D},command:P,entityOptions:{subType:I||Jie,driveId:r,driveItemId:s,sitePath:l,fileUrl:d,threadId:u,iCalUid:m,masterICalUid:p,defaultRightTab:y,timeSeek:v||h,organizerId:S,tenantId:f,organizerGroupId:b,channelType:w,replyChainId:T}},metadata:{allowAnonymous:!1}}):Promise.resolve({entityCommand:{entity:{type:ke.ck.meetingrecap,action:ke.SY.view,id:u},command:P,entityOptions:{subType:I?`${Jie}-${I}`:Jie,externalEntityKey:m,threadId:u,timestamp:h,defaultRightTab:y,organizerId:S,tenantId:f,meetingType:k,recordingId:C}},metadata:{allowAnonymous:!1}})},iae=[{filter:Kie.recapMeeting,execute:nae},{filter:(e,t)=>Boolean(e.hash)&&(t?.pathname||"").startsWith("/meetingrecap/"),execute:nae}],{memo:aae,useState:oae,useEffect:rae,useRef:sae}=Or,lae="meeting-recap-app",cae=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(636192),n.e(393706),n.e(845039),n.e(79981),n.e(572891),n.e(251639),n.e(209576),n.e(124579),n.e(525474),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(784980),n.e(527908),n.e(905965),n.e(569158),n.e(685119),n.e(672768),n.e(423830),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(214467),n.e(397928),n.e(288919),n.e(615002),n.e(343201),n.e(892960),n.e(672666),n.e(640233),n.e(195009),n.e(350226),n.e(764852),n.e(691026),n.e(890399),n.e(948782)]).then(n.bind(n,141484)),dae=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(636192),n.e(393706),n.e(845039),n.e(79981),n.e(572891),n.e(251639),n.e(209576),n.e(124579),n.e(525474),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(784980),n.e(527908),n.e(905965),n.e(569158),n.e(685119),n.e(672768),n.e(423830),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(214467),n.e(397928),n.e(288919),n.e(615002),n.e(343201),n.e(892960),n.e(672666),n.e(640233),n.e(195009),n.e(350226),n.e(764852),n.e(691026),n.e(890399),n.e(948782)]).then(n.bind(n,108636)),uae=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(636192),n.e(393706),n.e(845039),n.e(79981),n.e(572891),n.e(251639),n.e(209576),n.e(124579),n.e(525474),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(784980),n.e(527908),n.e(905965),n.e(569158),n.e(685119),n.e(672768),n.e(423830),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(214467),n.e(397928),n.e(288919),n.e(615002),n.e(343201),n.e(892960),n.e(672666),n.e(640233),n.e(195009),n.e(350226),n.e(764852),n.e(691026),n.e(890399),n.e(948782)]).then(n.bind(n,200188)),mae=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(636192),n.e(393706),n.e(845039),n.e(79981),n.e(572891),n.e(251639),n.e(209576),n.e(124579),n.e(525474),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(784980),n.e(527908),n.e(905965),n.e(569158),n.e(685119),n.e(672768),n.e(423830),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(214467),n.e(397928),n.e(288919),n.e(615002),n.e(343201),n.e(892960),n.e(672666),n.e(640233),n.e(195009),n.e(350226),n.e(764852),n.e(691026),n.e(890399),n.e(948782)]).then(n.bind(n,819867)),pae=()=>null,gae=aae((({appRenderMode:e,coreSettings:t,onRenderEvent:n,scenarioFactory:i})=>{const{entity:a}=(0,FX.At)(),{id:o,action:r}=a,[s,l]=oae((()=>pae)),d=sae({}),{isRecapInPopout:u}=t.get(c.w.MeetingRecap);return rae((()=>{let a=!1;return(async()=>{const{enableEntityMoreInfo:s}=t.get(c.w.Core),d=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),m=s?d:wJ.CA,p=e=>e?{LPC:d}:(0,ev.wg)(mae,lae,i);if(ke.SY.view===r&&String(o).startsWith("recap-"))switch(e){case se.w.Main:{const{enableEntityMoreInfo:e}=t.get(c.w.Core);n("ChunkLoadStarted",{chunkName:lae});const[{IntelligentRecap:o},{LPC:r}]=await Promise.all([(0,ev.wg)(dae,lae,i),p(!!e)]);n("ChunkLoadSucceeded",{chunkName:lae});const s=aae((()=>(0,Lr.Y)(vG.e,{namespaces:["meetingAnalytics","meetingRecap","premiumBenefits"],loaderRenderer:null,children:(0,Lr.Y)(r,{children:(0,Lr.Y)(m,{children:(0,Lr.Y)(o,{})})})})));if(s.displayName="IntelligentRecapComponent",a)return;return void l(s)}case se.w.HorizontalBar:{n("ChunkLoadStarted",{chunkName:lae});const{IntelligentRecapHorizontalBar:e}=await(0,ev.wg)(cae,lae,i);if(n("ChunkLoadSucceeded",{chunkName:lae}),a)return;return void l((()=>e))}}if(e===se.w.Main||!u&&e===se.w.HorizontalBar){n("ChunkLoadStarted",{chunkName:lae});const[{MeetingRecapRenderer:e},{LPC:t}]=await Promise.all([(0,ev.wg)(uae,lae,i),p(!!s)]);n("ChunkLoadSucceeded",{chunkName:lae});const o=aae((({appRenderMode:n})=>(0,Lr.Y)(vG.e,{namespaces:["meetingAnalytics","meetingRecap","premiumBenefits"],loaderRenderer:null,children:(0,Lr.Y)(t,{children:(0,Lr.Y)(m,{children:(0,Lr.Y)(e,{appRenderMode:n})})})})));if(o.displayName="MeetingRecapComponent",a)return;l(o)}})(),()=>{a=!0}}),[e,t,r,o,n,i,u]),ke.SY.view===a.action&&String(a.id).startsWith("recap-")&&(d.current={}),(e===se.w.Main||!u&&e===se.w.HorizontalBar)&&(d.current={appRenderMode:e}),(0,Lr.Y)(s,{...d.current})})),hae=()=>Qie.windowFeatures||{};const vae=e=>{if(yae(e))return Sae(e)?{subNavEntity:fae(e),headerEntity:kae(e),startEntity:Cae(e),mainEntity:bae(e),endEntity:wae(e)}:null},yae=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.transcriptcontent].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Sae=()=>!0,fae=()=>null,kae=()=>null,Cae=()=>null,bae=({entity:e})=>e,wae=()=>null,Tae={id:"com.microsoft.teams.transcript-content",name:"TranscriptContentApp",supportedEntities:[ke.ck.transcriptcontent],supportedRenderModes:[se.w.Main],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},Iae="transcript-content-app",Nae=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(598188),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(616161),n.e(487867),n.e(215618),n.e(501156),n.e(736709),n.e(636192),n.e(393706),n.e(845039),n.e(79981),n.e(572891),n.e(251639),n.e(209576),n.e(124579),n.e(459149),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(972751),n.e(921389),n.e(638918),n.e(784980),n.e(527908),n.e(905965),n.e(569158),n.e(685119),n.e(672768),n.e(188430),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(927129),n.e(214467),n.e(397928),n.e(343201),n.e(892960),n.e(672666),n.e(640233),n.e(195009),n.e(350226),n.e(764852),n.e(691026),n.e(574961),n.e(940627)]).then(n.bind(n,683712)),Aae=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,451798));function Eae(){const e=()=>null;return{getAppViewEntities:vae,manifest:Tae,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===se.w.Main){const[{TranscriptContentViews:e},{CallsTabContextProvider:t}]=await Promise.all([(0,ev.wg)(Nae,Iae,n),(0,ev.wg)(Aae,Iae,n)]);return(0,Lr.Y)(vG.e,{namespaces:["calling","meetingRecap"],loaderRenderer:null,children:(0,Lr.Y)(t,{children:(0,Lr.Y)(e,{})})})}return(0,Lr.Y)(e,{})}}}var Fae=n(91133),_ae=n(878523);const Dae="switchToPeople",Pae=()=>n.e(114642).then(n.bind(n,217238)),Mae={onEventReceived:async({eventInput:{event:e,source:t},requestContext:{coreSettings:n,scenarioFactory:i,client:a}})=>{if(e.type===Dae)return Promise.resolve({command:Em(),source:t});if(((0,Fae.W)(e)||(0,_ae.D)(e))&&"pxNovaTelemetryEvent"===e.type){const o="px-nova-telemetry-service",{PXNovaTelemetryService:r}=await(0,ev.wg)(Pae,o,i);return r.logEvent({event:e,coreSettings:n,sessionStartGesture:t.inputType,client:a}),Promise.resolve(void 0)}if((0,R2.ni)(e))return Promise.resolve({command:Im(e.data())});if((0,R2.ui)(e))return Promise.resolve({command:c2({title:e.data().message,intent:"Error",dismissOnAction:!0,duration:3e3})});if((0,Fae.W)(e))switch(e.type){case"onDismiss":return Promise.resolve({command:Nm()});case"onRenderComplete":{const t=e.data();return i.findScenario(be.Cu.LoadLivePersonaEditor)?.stop({overrideTimestamp:t}),Promise.resolve(void 0)}case"onSaveContactSuccess":return Promise.resolve({command:c2({title:e.data().successMessage,intent:"Success",dismissOnAction:!0,duration:3e3})});case"onSaveContactFailure":if(["DuplicateFound","UnprocessableEntity"].includes(e.data().errorCode))return Promise.resolve({command:c2({title:e.data().errorMessage,intent:"Error",dismissOnAction:!0,duration:3e3})});default:return Promise.resolve(void 0)}if((0,_ae.D)(e))switch(e.type){case"onEditContact":{const{personNodeID:t,placement:n}=e.data();return Promise.resolve({command:Im({mri:"",personNodeID:t,isInSpeedDialMode:!1,isFederatedUser:!1,placement:n})})}case"onStartChat":{const{hostAppPersonaId:t}=e.data();return Promise.resolve({command:Hs({mri:t,correlationSource:A.p.PeopleApp})})}case"onStartAudioCall":{const{hostAppPersonaId:t}=e.data();return Promise.resolve({command:Es({mri:t,correlationSource:A.p.PeopleApp})})}case"onComposeEmail":{const{emailUrl:t}=e.data();return(0,Un.z)().open(t,"_blank"),Promise.resolve(void 0)}case"onPhoneCall":{const{phoneUrl:t}=e.data();return(0,Un.z)().open(t,"_blank"),Promise.resolve(void 0)}case"onNewContactClicked":return Promise.resolve({command:Fm(),source:t});case"onNavigationRequest":return Promise.resolve({command:Am(e.data())});case"showProfile":{const{personNodeId:n}=e.data(),i={eventType:"click",userId:"",personNodeId:n,left:0,top:0};return Promise.resolve({command:vq(i),source:t})}case"showActionResult":{const{message:t,status:n}=e.data();return Promise.resolve({command:c2({title:t,dismissOnAction:!0,duration:3e3,intent:"success"===n?"Success":"Error"})})}case"onRenderComplete":{const t=e.data();return i.findScenario(be.Cu.PeopleAppSwitch)?.stop({overrideTimestamp:t}),Promise.resolve(void 0)}}return Promise.resolve(void 0)}},Rae={id:"com.microsoft.teams.people",name:"PeopleApp",getLocalizedName:async e=>(await e.waitForNamespace("jana"),e.stringTranslate("jana","jana_app_name")),actors:Object.keys(fm),supportedEntities:[ke.ck.livepersonaeditor,ke.ck.peopleapp,ke.ck.addcontactdialog],supportedRenderModes:[se.w.Modal,se.w.Main,se.w.Rail],windowFeatures:{minWidth:565,width:1241,minHeight:720,height:720},getDefaultCommand:e=>{const{enablePeopleApp:t}=e.get(c.w.People);if(t)return{action:ke.SY.default,type:ke.ck.peopleapp}}},xae=async({commandInput:{command:e},requestContext:{loggerFactory:t,scenarioFactory:n,clientPreferences:i}})=>{const a=t.newLogger("PeopleApp onCommandReceived","apps-people");return e.action===km?(a.infoToTelemetry?.("View People App command received","people_apps_people_command"),{entity:{type:ke.ck.peopleapp,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Nova}},entityOptions:{navigationId:i.peopleAppNavigation.activeNavigationId,navigationLabel:i.peopleAppNavigation.activeNavigationLabel}}):(e=>e.action===Cm)(e)?(a.infoToTelemetry?.("Switch to contact tag command received","people_apps_people_command"),{entity:{type:ke.ck.peopleapp,action:ke.SY.view,id:(0,E.v4)()},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Nova}},entityOptions:e.data}):(e=>e.action===Tm)(e)?(a.infoToTelemetry?.("Open Add Contact command received","people_apps_people_command"),{entity:{type:ke.ck.addcontactdialog,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Nova}}}):(e=>e.action===bm)(e)?(n.newScenario(be.Cu.LoadLivePersonaEditor),a.infoToTelemetry?.("Open LPE command received","people_apps_people_command"),Lae(ke.ck.livepersonaeditor,ke.SY.view,e.data,g.Rp.show)):(e=>e.action===wm)(e)?(a.infoToTelemetry?.("Close LPE command received","people_apps_people_command"),Lae(ke.ck.livepersonaeditor,ke.SY.view,{mri:"",personNodeID:void 0,isInSpeedDialMode:!1,isFederatedUser:!1,placement:"center"},g.Rp.hide)):void a.errorToTelemetry?.(`Command action '${e.action}' is not supported by PeopleApp`,"people_apps_people_command")},Lae=(e,t,n,i)=>({entity:{type:e,action:t},command:{visibilityState:i,stateTransition:g.Ar.extend,correlation:{source:A.p.Nova}},entityOptions:n}),Oae=(e,t)=>{const i=Or.useCallback((async()=>{const{LivePersonaEditorEntry:i}=await(async(e,t)=>{const i="live-persona-editor";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ev.wg)((()=>Promise.all([n.e(912845),n.e(620314),n.e(668172),n.e(214218),n.e(390761),n.e(206009),n.e(777944),n.e(693593),n.e(803591),n.e(296222),n.e(859257),n.e(1897),n.e(494769),n.e(867844)]).then(n.bind(n,551136))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return e.findScenario(be.Cu.LoadLivePersonaEditor)?.mark(be.BQ.LoadedLivePersonaEditorChunk),{default:i}}),[e,t]),a=Or.useCallback((async()=>{const{PeoplePickerDialog:i}=await(async(e,t)=>{const i="speed-dial-nova";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ev.wg)((()=>Promise.all([n.e(912845),n.e(273198),n.e(320494),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(531240),n.e(113443),n.e(312993),n.e(625303),n.e(53966),n.e(331703),n.e(311576),n.e(677226),n.e(418497),n.e(418026)]).then(n.bind(n,441681))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return{default:i}}),[e,t]),o=Or.useCallback((async()=>{const{PeopleAppMainViewEntry:i}=await(async(e,t)=>{const i="people-app-main-view";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ev.wg)((()=>Promise.all([n.e(912845),n.e(867529),n.e(166017),n.e(698386),n.e(102216),n.e(852774),n.e(909600),n.e(492852),n.e(49749),n.e(119068),n.e(27001),n.e(475634),n.e(467129),n.e(803591),n.e(296222),n.e(710570),n.e(855615),n.e(537404)]).then(n.bind(n,90055))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return e.findScenario(be.Cu.PeopleAppSwitch)?.mark(be.BQ.LoadedPeopleAppMainViewChunk),{default:i}}),[e,t]),r=Or.useCallback((async()=>{const{PeopleAppLeftNavEntry:i}=await(async(e,t)=>{const i="people-app-nova";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ev.wg)((()=>Promise.all([n.e(296222),n.e(621410)]).then(n.bind(n,554140))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return e.findScenario(be.Cu.PeopleAppSwitch)?.mark(be.BQ.LoadedPeopleAppLeftNavChunk),{default:i}}),[e,t]);return{LivePersonaEditor:i,PeopleAppMainView:o,PeopleAppLeftNav:r,AddContactPickerDialog:a}};var jae=n(162952),Bae=n(465742),Uae=n(11053),$ae=n(940041),Wae=n(806299),Vae=n(364071),Hae=n(449289),zae=n(8720),qae=n(846026);const Gae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsPeopleAppViewsRendererFloodgateLogActivityQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activityName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"increment"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateLogActivity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activityName"},value:{kind:"Variable",name:{kind:"Name",value:"activityName"}}},{kind:"Argument",name:{kind:"Name",value:"increment"},value:{kind:"Variable",name:{kind:"Name",value:"increment"}}}]}]}}]},Yae=({appRenderMode:e,onRenderEvent:t,scenarioFactory:n,entity:i})=>{const{coreSettings:a}=(0,QX.ur)(),o=(0,JX.PO)();((e,t,n)=>{Or.useEffect((()=>{t===se.w.Main&&n===ke.ck.peopleapp&&e.mutate({mutation:Gae,variables:{activityName:"janaCSAT",increment:1}})}),[e,t,n])})((0,A8.m)(),e,i.type),Or.useEffect((()=>{(e=>{const t=(0,jae.F)(e);if(t){const e=(0,Uae.C)(t);Bae.r.associateIngestionKeyWithAppNameIfNecessary(e,$ae.C,[Hae.f1])}})(a),(e=>{const t=(0,jae.F)(e);if(t){const e=(0,Wae.C)(t);Bae.r.associateIngestionKeyWithAppNameIfNecessary(e,Vae.C,[Hae.f1])}})(a)}),[a]);const{LivePersonaEditor:r,PeopleAppLeftNav:s,PeopleAppMainView:l,AddContactPickerDialog:c}=Oae(n,t);if(e===se.w.Modal&&i.type===ke.ck.livepersonaeditor)return(0,Lr.Y)(Gq.d,{factory:r,props:{},fallback:!1});if(e===se.w.Main&&i.type===ke.ck.peopleapp)return(0,Lr.Y)(Gq.d,{factory:l,props:{},fallback:!1});if(e===se.w.Rail&&i.type===ke.ck.peopleapp)return(0,Lr.Y)(Gq.d,{factory:s,props:{},fallback:!1});if(e===se.w.Modal&&i.type===ke.ck.addcontactdialog){const e=zae.H.fromName(qae.d1.addContacts),t=o.stringTranslate("jana","add_to_contacts"),n={moduleNameOnSelection:GR.Sn.peopleAppAddContactPeoplePickerAdd,moduleNameOnInitiation:GR.Sn.peopleAppAddContactPeoplePicker,panelType:GR.HP.SpeedDial,pickerUsageArea:"AddContactPeoplePickerDialog",moduleName:GR.Sn.peopleAppAddContactDialog,subWorkLoad:GR.i7.addContact};return(0,Lr.Y)(Gq.d,{factory:c,props:{dialogTitle:t,isSpeedDialScenario:!1,peoplePickerFilters:e,openPickerDialog:!0,userBiTelemetryInfo:n,userActionLocation:CW.Ly.PeopleApp}})}return null},Qae=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(459959),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(501156),n.e(729849),n.e(484331),n.e(960122),n.e(306517),n.e(964401),n.e(231020),n.e(405198),n.e(568721),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(697027),n.e(567830),n.e(178249),n.e(116447),n.e(194894),n.e(915633),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(46438),n.e(280759),n.e(145619),n.e(847573),n.e(380285),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(641675),n.e(692492),n.e(854047),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(354884),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(568202),n.e(746071),n.e(571498),n.e(876965),n.e(542831),n.e(969261)]).then(n.bind(n,819867)),Jae=e=>{const{enableEntityMoreInfo:t,children:n}=e,[i,a]=Or.useState();return Or.useEffect((()=>{t||async function(){const{LPC:e}=await(0,ev.wg)(Qae,"people-app-lpc");a((()=>e))}()}),[t,a]),!t&&i?(0,Lr.Y)(i,{appName:"PeopleApp",children:(0,Lr.Y)(wJ.CA,{children:n})}):(0,Lr.Y)(Or.Fragment,{children:n})},Kae=({appRenderMode:e,children:t,scenarioFactory:n})=>(n.findScenario(be.Cu.PeopleAppSwitch)||n.newScenario(be.Cu.PeopleAppSwitch),Or.useEffect((()=>()=>{e===se.w.Main&&n.findScenario(be.Cu.PeopleAppSwitch)?.cancel({reason:"people_render_unmounted"})}),[e,n]),(0,Lr.Y)(Or.Fragment,{children:t})),Zae=Or.memo((function(e){return(0,Lr.Y)(vG.e,{namespaces:["livePersonaEditor","jana"],loaderRenderer:null,children:(0,Lr.Y)(Yae,{...e})})})),Xae=async({onRenderEvent:e,scenarioFactory:t,appRenderMode:n,entity:i,coreSettings:a})=>{const{enableEntityMoreInfo:o}=a.get(c.w.Core);return(0,Lr.Y)(Kae,{appRenderMode:n,scenarioFactory:t,children:(0,Lr.Y)(Jae,{enableEntityMoreInfo:!!o,children:(0,Lr.Y)(Zae,{onRenderEvent:e,scenarioFactory:t,appRenderMode:n,entity:i})})})},eoe=({appRenderMode:e})=>{const t=new qz.D,n=[],i=[];switch(e){case se.w.Main:toe({criticalSignals:n,postCriticalSignals:i,featureFlags:{}});case se.w.Rail:}return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:6e4}),t.appPhases},toe=({criticalSignals:e})=>{e.push(Gz.m.PEOPLE_APP_RENDERED)},noe=e=>{if(ioe(e))return{subNavEntity:aoe(e),headerEntity:ooe(e),startEntity:roe(e),mainEntity:soe(e),endEntity:loe(e)}},ioe=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=[Yt.Rm.focus,Yt.Rm.standard].includes(t),o=[ke.ck.peopleapp].includes(i),r=[ke.SY.list,ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},aoe=({entity:e,layoutMode:t})=>{if(t===Yt.Rm.focus)return null;const{type:n,id:i,options:a,windowOptions:o}=e;return{action:ke.SY.list,entityState:{flushableByLinkedEntity:!0},id:i,linkedEntity:null,type:n,windowOptions:o,options:a}},ooe=()=>null,roe=()=>null,soe=({entity:e,contextEntity:t})=>{let n=ke.SY.view;const{action:i=null}={...e},a=[ke.SY.view,ke.SY.default];return i&&a.includes(i)&&(n=i),t||{...e,action:n}},loe=()=>null,coe=({areEmptySlotsTransparent:e,coreSettings:t})=>{const{isFlyoutChat:n}=t?.get(c.w.Flyout)??{};return{subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e}},mainEntity:{[se.w.Main]:{isBackgroundTransparent:!!n}}}},doe=(e,t,n)=>{const{userPreferences:i,coreSettings:a,layoutMode:o}=t,r=e.mainEntity;if(r.action===ke.SY.view)return noe({contextEntity:null,coreSettings:a,entity:{id:(0,E.v4)(),type:ke.ck.peopleapp,action:ke.SY.list,options:r.options},layoutMode:o,userPreferences:i})},uoe={id:"com.microsoft.teams.store.notifications.app",name:"TeamsStoreNotificationsApp",supportedEntities:[ke.ck.lobnotifications,ke.ck.onboardingnotifications,ke.ck.discoverappsnotifications,ke.ck.autoinstallnotification],supportedRenderModes:[se.w.Main,se.w.Rail]},moe="/l/autoinstallnotification",poe=(e,t)=>{const n=new RegExp(`${moe}/([a-zA-Z0-9,-]+)$`),i=e.pathname.match(n);if(i){const[,e]=i;if(!e.split(",").includes(""))return Promise.resolve({entityCommand:{entity:{type:ke.ck.autoinstallnotification,action:ke.SY.view,id:e},entityOptions:{autoInstallAppIds:e.split(",")},command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}})}return t.warnNoPii?.(`invalid path name ${e.pathname}`),Promise.reject("Auto install notification deeplink is invalid")},goe=e=>{if(hoe(e))return voe(e)?{subNavEntity:yoe(e),headerEntity:Soe(e),startEntity:foe(e),mainEntity:koe(e),endEntity:Coe(e)}:null},hoe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.lobnotifications,ke.ck.onboardingnotifications,ke.ck.discoverappsnotifications,ke.ck.autoinstallnotification].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},voe=()=>!0,yoe=({entity:e})=>e,Soe=()=>null,foe=()=>null,koe=({entity:e})=>e,Coe=()=>null,boe=({appRenderMode:e})=>{const t=new qz.D,n=[];if(e===se.w.Main)n.push(Gz.m.LOB_NOTIFICATIONS_RENDERED);return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:3e4}),t.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:1e4}),t.appPhases},woe="/l/lobnotifications",Toe=(e,t,n)=>{const i=new RegExp(`${woe}/([a-zA-Z0-9,-]+)$`),a=e.pathname.match(i);if(a){const[,e]=a;if(!e.split(",").includes(""))return Promise.resolve({entityCommand:{entity:{type:ke.ck.lobnotifications,action:ke.SY.view,id:e},entityOptions:{headItem:e.split(",")[0],bodyItems:e.split(",").slice(1)},command:{stateTransition:n?.stateTransition||g.Ar.flow,visibilityState:n?.visibilityState||g.Rp.show}},metadata:{allowAnonymous:!1}})}return t.warnNoPii?.(`invalid path name ${e.pathname}`),Promise.reject("Lob notification deeplink is invalid")},Ioe=()=>Promise.all([n.e(940543),n.e(311576),n.e(677226),n.e(283628),n.e(922570)]).then(n.bind(n,997879)),Noe=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(306517),n.e(215111),n.e(636192),n.e(845039),n.e(499319),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(36690),n.e(79899),n.e(724003),n.e(187257),n.e(785043),n.e(572891),n.e(809110),n.e(600824),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(16945),n.e(613978),n.e(991504),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(685119),n.e(420340),n.e(816410),n.e(747607),n.e(196395),n.e(47330),n.e(725236),n.e(422790),n.e(293970),n.e(71257),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(688782),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(428906),n.e(418497),n.e(86631),n.e(875452),n.e(574961),n.e(155688),n.e(374752),n.e(526689),n.e(960889),n.e(449475),n.e(646235),n.e(720453),n.e(903266)]).then(n.bind(n,451798));function Aoe(){const e=()=>null;return{getAppViewEntities:goe,manifest:uoe,onBeforeDeeplinkParsed:[{filter:e=>!!e.pathname.startsWith("/l/lobnotifications"),execute:({deeplinkUrl:e,preferredCommandInput:t,context:n})=>{const i=n.loggerFactory.newLogger("ActivityApp","apps-activity");return i.log("Executing deep link for lob notifications"),((e,t,n,i)=>{const{pathname:a}=n;return a.startsWith(woe)?Toe(n,t,i):Promise.reject("No DeeplinkPrefixType found for the specified deeplinkUrl")})(n.coreSettings,i,e,t)}},{filter:e=>!!e.pathname.startsWith("/l/autoinstallnotification"),execute:({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("ActivityApp","apps-activity");return n.log("Executing deep link for Auto Install notifications"),((e,t,n)=>{const{pathname:i}=n,{enableSendAutoInstallNotification:a}=e.get(c.w.Extensibility);if(i.startsWith(moe)){const e="Send auto install notification is disabled for this experience";return a?poe(n,t):(t.errorToTelemetry?.(e,"auto_install_notification_feature_not_enabled"),Promise.reject("Send auto install notification is disabled for this experience"))}const o="No DeeplinkPrefixType found for the specified deeplinkUrl";return t.errorToTelemetry?.(o,"auto_install_notification_deep_link_prefix_type_not_found"),Promise.reject(o)})(t.coreSettings,n,e)}}],render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){const e="teamsStoreNotifications";n("ChunkLoadStarted",{chunkName:e});const[{NotificationsEntry:t},{CallsTabContextProvider:a}]=await Promise.all([(0,ev.wg)(Ioe,e,i),(0,ev.wg)(Noe,e,i)]);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(a,{children:(0,Lr.Y)(t,{})})})}return(0,Lr.Y)(e,{})},getAppPhases:boe}}var Eoe=n(590548);const Foe=new Set([ke.ck.chats,ke.ck.calls,ke.ck.taskmodule,ke.ck.hwctaskmodule,ke.ck.extensions]);var _oe=n(300986),Doe=n(325749);const Poe="/l/stage",Moe="No DeeplinkPrefixType found for the specified deeplinkUrl",Roe=e=>{const{pathname:t,search:n}=e,i=new URLSearchParams(n).get("context"),a=i&&JSON.parse(i),o=t.split(/[/?&]/),r=o.indexOf("stage");return{appId:o[r+1],deeplinkContext:a}},xoe={filter:e=>{if(!e.pathname.startsWith(Poe))return!1;try{const{appId:t,deeplinkContext:n}=Roe(e),{contentUrl:i}=n;return!!(t&&n&&i)}catch{return!1}},execute:async({deeplinkUrl:e,context:{loggerFactory:t,scenarioFactory:n,coreSettings:i,getUserContexts:a,userBiService:o},preferredCommandInput:r,sourceViewEntity:s})=>{const l=t.newLogger("PlatformApp_parseStageDeeplink","apps-platform-app"),{enableReactStageModal:d,disablePlatformEntityIdDecoding:u}=i.get(c.w.Extensibility);if(!d)return Promise.reject("Stage modal feature flag is disabled");if(!e.pathname.startsWith(Poe))return l.log(Moe),Promise.reject(Moe);if(!s){const e="No sourceViewEntity found";return l.log(e),Promise.reject(e)}const{chatId:m,parentMessageId:p,channelMeetingMessageId:g,replyChainId:h,channelId:v}=(0,Doe.pE)(s,l,!!u),{appId:y,deeplinkContext:S}=Roe(e),{contentUrl:f,websiteUrl:k,name:C,sourceChatId:b,sourceChannelId:w,messageId:T,threadId:I,openMode:N,entityId:A}=S;let E=m,F=v,_=g||p;(b||w)&&(_=T),b&&(E=b),S.replyChainId&&(F=w);const D={appId:y,contentUrl:f,websiteUrl:k,name:C,entityId:A,entryPoint:Ln.hB.deepLinkStageView,openMode:N,messageId:_,replyChainId:S.replyChainId??h,convId:F??(E||""),channelId:F,correlationId:r?.correlation.id,scenarioStartTime:r?.correlation.startTimestamp},P=await a();if(!P||0===P.length)return Promise.reject("No user context found");const M=P.find((e=>e.userContextAccountType===FR.MainWindow));if(!M)return Promise.reject("No main window account found");const R=M.context.client;return(0,_oe.N)(D,i,R,n,l,I,void 0,void 0,o).then((e=>Promise.resolve(e))).catch((e=>Promise.reject(e)))}},Loe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsHostedWebContentSendExternalAuthDeeplinkMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"authId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"result"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sendExternalAuthDeeplink"},arguments:[{kind:"Argument",name:{kind:"Name",value:"authId"},value:{kind:"Variable",name:{kind:"Name",value:"authId"}}},{kind:"Argument",name:{kind:"Name",value:"result"},value:{kind:"Variable",name:{kind:"Name",value:"result"}}}]}]}}]},Ooe={reloadTrigger:!1},joe={id:""},Boe="/l/entity",Uoe="/l/task",$oe="No DeeplinkPrefixType found for the specified deeplinkUrl",Woe={[Boe]:Yn.Vd.PlatformExtension},Voe=e=>{const{pathname:t,search:n}=e,i=new URLSearchParams(n),a=i.get("context"),o=i.get("tenantId");let r;try{r=a&&JSON.parse(a)}catch(e){}const s=r?.channelId,l=r?.chatId,c=t?.split(/[/?&]/),d=c?.indexOf("entity"),u=c?.[d+1];return{tenantId:o,appId:u,entityId:decodeURIComponent(c?.[d+2]||""),channelId:s,chatId:l,deeplinkContext:r,pathname:t}},Hoe=new Set([Boe]),zoe=async(e,t,n,i,a,o,r,s,l)=>{const{appId:c,entityId:d,deeplinkContext:u,pathname:m,tenantId:p}=Voe(e);t.log(`Parsing deepLink for platform app - appId: ${c}, pathname: ${m} search: ${e.search}`);const g=r?.correlation?.source,h=[A.p.ActivityFeed,A.p.ActivityFeedBellClick],v=!!g&&h.includes(g);let y,S;if(s&&l&&u?.user&&(0,Cee.uh)(c)){const e=await(0,x9.eS)(l,u?.user,!1,!0),t=e&&e?.id;u.chatId=t}n&&(v?(u?.chatId||u?.channelId||((e,t,n)=>{try{const i=e.createDatabag?.();i&&(i.appId=t,i.appName="PlatformApp");const a={actionScenario:GR.vB.openApp,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenarioType:GR.DB.nav,moduleType:GR.nR.nav,moduleName:GR.Sn.appBarItem,panelType:GR.HP.activityFeed,panelRegion:GR.rP.main,dataBag:i,extensibilityData:{id:t,name:"PlatformApp",scenarioCapability:SU.n3.na,scope:SU.bY.personal}};e.recordPanelAction(a,n),i?.dispose()}catch(e){n.log("firePlatformBiTelemetry error",e)}})(o,c,t),S=Ln.hB.activityFeed):S=u?.channelId||u?.chatId?u.channelId?Ln.hB.channelTab:u.chatId?Ln.hB.chatTab:"Unknown":Ln.hB.personalApp,a?.findScenario(be.Cu.PlatformTabDeeplinkHandling)?.cancel(),y=a?.newScenario(be.Cu.PlatformTabDeeplinkHandling),y&&a?.hoistScenarioToCore?.(y));for(const n of Array.from(Hoe))if(m?.startsWith(n)){return void 0===Woe[n]?(t.errorToTelemetry?.($oe,"platform_deeplink_prefix_type"),Promise.reject($oe)):((0,Cee.RL)(a,c,`${S}Deeplink`,t,!1),qoe(e,c,d,u,t,v,i,a,r,y,p))}return t.errorToTelemetry?.($oe,"platform_deeplink_prefix_type"),Promise.reject($oe)},qoe=(e,t,n,i,a,o,r,s,l,c,d)=>{c?.mark("create_deeplink_command"),a.log(`create_deeplink_command with appId: ${t} tabEntityId:${n} context: ${i}`);const u=JSON.stringify({appId:t,tabEntityId:n,subEntityId:i?.subEntityId});o&&joe.id===u?Ooe.reloadTrigger=!Ooe.reloadTrigger:Ooe.reloadTrigger=!1,joe.id=u;const m={entityCommand:{...i?.channelId||i?.chatId?(0,M9.VI)(e,t,i.channelId||"",i.chatId||"",s,c,n,l,i?.subEntityId,Ooe.reloadTrigger,d):(0,M9._C)(t,!1,Ooe.reloadTrigger,o,A.p.PlatformPersonalAppDeepLink,n,l,i?.subEntityId,void 0,e,!0)},metadata:{shouldTargetSourceWindow:r,allowAnonymous:!1,tenantId:d??void 0}};return c?.mark("return_deeplink_command"),c?.appendEventData({"PlatformTabDeeplink.generatedCommand":m.toString()}),Promise.resolve(m)},Goe=()=>n.e(166691).then(n.bind(n,322063)),Yoe=async e=>{const{deeplinkUrl:t,preferredCommandInput:n,context:i,sourceViewEntity:a}=e,{coreSettings:o,loggerFactory:r,scenarioFactory:s,userBiService:l}=i,d=r.newLogger("platform-app","apps-platform-app"),{enablePlatformDeepLinkRouting:u,appIdList:m,disabledTabAppIds:p,isAllowedAppList:g,enableDeeplinkSupportForBuiltInTab:h}=o.get(c.w.Extensibility),v=m&&JSON.parse(m),{appId:y}=Voe(t),S=await e.context.getUserContexts();let f=!1;if(a&&a.type===ke.ck.extensions&&a.id)try{const e=JSON.parse(a.id);f=e?.appId===y}catch(e){d.errorToTelemetry?.("[parseAndExecuteDeeplink] could not parse sourceViewEntity.id","platform_deeplink_source_entity_parse_error"),d.error(`[parseAndExecuteDeeplink] could not parse sourceViewEntity.id: ${a.id}`)}const k=(0,Eoe.bw)(d,y,!1,p||[],v,g);if(u&&k)return Promise.reject(`App ${y} is not supported for deeplink navigation in T2.1`);const C=new URLSearchParams(t.search).get("context");let b;try{b=C&&JSON.parse(C)}catch(e){d.errorToTelemetry?.("[parseAndExecuteDeeplink] could not parse deeplink context","platform_deeplink_context_parse_error")}return!u&&b?.channelId&&b?.chatId?Promise.reject("Feature for parsing teams and channels deep links in T2.1 is not enabled"):zoe(t,d,!!u,f,s,l,n,!!h,S?.[0]?.context?.client)},Qoe={filter:Uoe,execute:({deeplinkUrl:e,context:{loggerFactory:t,scenarioFactory:n,coreSettings:i},sourceViewEntity:a})=>{const o=t.newLogger("PlatformApp_parseTaskModuleDeeplink","apps-platform-app");return Joe(e,i,o,n,a)}},Joe=(e,t,n,i,a)=>{if(e.pathname.startsWith(Uoe)){const o=i.newScenario(be.Cu.ExtDeeplinkToTaskModule),{enableDeepLinkToTaskModule:r}=t.get(c.w.Extensibility);if(!r)return o.stop({reason:be.BQ.ExtDeeplinkToTaskModuleFeatureFlagDisabled}),n.log("ext_deeplink_to_task_module_featureflag_disabled"),Promise.reject("Deeplink to task module feature flag is disabled");if(!a)return o.stop({reason:be.BQ.ExtDeeplinkToTaskModuleNotSupported}),n.log("ext_deeplink_to_task_module_not_supported"),Promise.reject("Deeplink to task module is not supported");const s=(0,E.v4)();return Promise.resolve({entityCommand:{entity:{type:ke.ck.taskmodule,action:ke.SY.create,id:s},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.TaskModuleDeeplink}},entityOptions:{deeplinkSourceEntityInput:a,deeplinkUrl:e}},metadata:{allowAnonymous:!1,shouldTargetSourceWindow:!0}})}return n.log($oe),Promise.reject($oe)},Koe={filter:"/l/auth-callback",execute:async e=>{const{context:{coreSettings:t}}=e,{enablePlatformExternalAuth:n}=t.get(c.w.Extensibility);if(!n)return Promise.reject("External auth feature is not enabled");{const{search:t}=e.deeplinkUrl,n=new URLSearchParams(t),i=n.get("authId"),a=n.get("result"),o=await e.context.getUserContexts();o?.[0]?.context?.client?.mutate({mutation:Loe,variables:{authId:i,result:a}})}return Promise.resolve(void 0)}},Zoe=[{filter:e=>{if(!e.pathname.startsWith(Boe))return!1;const{appId:t,chatId:n,entityId:i,deeplinkContext:a}=Voe(e);return!(!(t&&n&&i&&a)||"chat"!==a.contextType&&"meeting"!==a.contextType)},execute:async e=>{const{context:{coreSettings:t}}=e,{enablePlatformDeepLinkRouting:n}=t.get(c.w.Extensibility);if(!(({deeplinkUrl:e,sourceViewEntity:t,context:{coreSettings:n}})=>{if("false"===e.searchParams.get("openInMeeting")?.toLowerCase()||!n.get(c.w.Extensibility).handleDeepLinkToMeetingSidePanel||!t)return!1;const{type:i,action:a,linkedEntity:o}=t,r=t;return i===ke.ck.calls||!!r.options&&(i===ke.ck.extensions&&a===ke.SY.view&&o?.type===ke.ck.calls?!!o.id:Foe.has(i)&&r.options.includes("teamsCallId"))})(e)){if(n)return Yoe(e);throw new Error("Groupchat/team scope tab deeplink disabled")}const{executeDeepLinkToGroupChatOrTeamTab:i}=await(0,ev.wg)(Goe,"platform-app-execute-group-chat-or-team-scope-tab-deeplink");try{return await i(e)}catch(t){if(n)return Yoe(e);throw t}}},{filter:e=>{try{const{appId:t}=Voe(e);return!!t}catch{return!1}},execute:Yoe},Qoe,xoe,Koe];var Xoe=n(884542),ere=n(231758);const tre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataClientPlatformAppButtonMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"action"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateAppButtonSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"action"},value:{kind:"Variable",name:{kind:"Name",value:"action"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},{getIsFirstFlyoutClickAfterAppLoad:nre,setIsFirstFlyoutClickAfterAppLoad:ire}=(()=>{let e=!0;return{getIsFirstFlyoutClickAfterAppLoad:()=>e,setIsFirstFlyoutClickAfterAppLoad:t=>{e=t}}})();var are=n(884839);const ore={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsAppsPlatformQueriesBlockUnblockBotChatForAppMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"blockUnblockBotChatForApp"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}]}]}}]},rre=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(787454),n.e(181316),n.e(598188),n.e(984165),n.e(729849),n.e(214218),n.e(306517),n.e(431784),n.e(475896),n.e(567830),n.e(116447),n.e(164734),n.e(56538),n.e(307339),n.e(677912),n.e(145619),n.e(831554),n.e(899628),n.e(586691),n.e(134498),n.e(307422),n.e(94139),n.e(977204),n.e(449127),n.e(268921),n.e(351715),n.e(711866),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(668415),n.e(684694),n.e(53131),n.e(813370),n.e(736704),n.e(170031),n.e(325254),n.e(385242),n.e(351057),n.e(800350),n.e(399289),n.e(707334),n.e(528699),n.e(695586),n.e(964956)]).then(n.bind(n,34413)),sre=async({commandInput:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i,client:a,coreSettings:o}=t,r=e.command,s=r.action,l=n.newLogger("PlatformApp onCommandReceived","apps-platform-app");if(e.command.actor===vu)switch(s){case yu:return lre(r,t,l);case Su:const{enablePrewarmPlatformChunk:n}=o.get(c.w.Extensibility);return void(n&&nre()&&(l.log("enablePrewarmPlatformChunk is enabled."),(0,ev.wg)(rre,"platform-app",i),ire(!1)));case fu:return cre(r);case ku:const{appId:d}=r.data;return{entityOptions:{appId:d,entryPoint:fU.NS.PersonalAppAbout},entity:{id:d,type:ke.ck.platformapp,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding}}};case Cu:{const{appId:e}=r.data,n=await(0,are.xR)(a,e,void 0,void 0,"app-on-command-received"),s=n.staticTabs?.some((e=>e.scopes?.some((e=>e?.toLowerCase()==="Personal".toLowerCase()))));if(s){const{enableAppsQueryOptimization:n}=o.get(c.w.Extensibility);return await(0,are.Pe)(a,i,be.Cu.PlatformAppFlyoutJITInstallApp,e,"Personal",l,!!n),lre(r,t,l)}return cre(r)}case Fu:{const{appId:e}=r.data;return dre(e)}case bu:{const{appId:e,appName:t,isInUse:n}=r.data;return{entityOptions:{appId:e,appName:t,scope:"Personal",navigateToDefaultAppOnUninstall:n},entity:{id:e,type:ke.ck.manageapps,action:ke.SY.delete},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding}}}}case wu:const u=r,m=u.data?.appId;return m?void await a.mutate({mutation:ore,variables:{appId:m}}):void l.error("app id for block unblock was undefined.");case Tu:return ure(r);case Iu:return{entityOptions:r.data,entity:{type:ke.ck.deeplinkstageconsentdialog,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Nova}}};case Nu:return{entityOptions:r.data,entity:{type:ke.ck.presentappnowconfirmationdialog,action:ke.SY.create},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.Nova}}};case Au:{const t=e.command.data;return{entityOptions:t?.platformAppErrorOptions,entity:{type:ke.ck.platformapp,action:ke.SY.error},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.Nova}}}}case Eu:{const t=e.command.data;return{entityOptions:t?.platformAppErrorCodeDetailsOptions,entity:{type:ke.ck.customapp,action:ke.SY.error},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.Nova}}}}default:l.error(`Command action '${s}' is not supported at PlatformApp.`)}else l.error(`Command for actor '${e.command.actor}' cannot be handled by PlatformApp.`)},lre=(e,t,n)=>{const{scenarioFactory:i,executionContext:a,client:o}=t,{viewEntities:{mainEntity:r}}=a;if("object"!=typeof(s=e.data)||null===s||!("appId"in s))return void n.error(`Command for action '${e.action}' requires an appId.`);var s;const l=mre(r?.id,r?.type,e.data.appId,n);return l?(async(e,t,n,i)=>{if(!t)return;const a={appId:t,action:n};await e.mutate({mutation:tre,variables:a}).catch((()=>i.errorToTelemetry?.(`[AppId: ${t}] Failed to register app button to cache`,"platform_personal_app_app_button_api",void 0,!0)))})(o,e.data.appId,e.action,n):(0,Cee.RL)(i,e.data.appId,Ln.hB.personalApp,n,e.data.isMultiWindow,!1,e.data.isDefaultCommand),(0,M9._C)(e.data.appId,e.data.isMultiWindow||!1,!1,!1,A.p.AppBar,void 0,void 0,void 0,l)},cre=e=>{const t=e.data?.appId??"",n=e.data?.scrollToSection;return{entityOptions:{appId:t,entryPoint:fU.NS.PersonalFlyoutAppSuggestions,viewOptions:{scrollToSection:n}},entity:{id:t,type:ke.ck.platformapp,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.ExtensionCommanding}}}},dre=e=>{const t=(0,Un.z)(),n=(0,Xoe.aE)(t);return{entityOptions:{url:(0,ere.ip)(n,e,"app-share-dialog"),preview:!0,entryPoint:Yn.XJ.AppBarContextMenu,zeroStateSuggestionsTimeout:5e3},entity:{id:e,type:ke.ck.shareformdialog,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{id:(0,E.v4)(),source:A.p.ExtensionCommanding,startTimestamp:Date.now()}}}},ure=e=>{const t=e.data?.tileId;if(!t)return;const n=JSON.parse(t),i={id:n.isChannel?JSON.stringify({channelId:n.threadId}):n.threadId,type:n.isChannel?ke.ck.channels:ke.ck.chats,action:ke.SY.view};delete n.isChannel;return{entity:{id:JSON.stringify(n),type:ke.ck.extensions,action:ke.SY.view,linkedEntity:i},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{id:(0,E.v4)(),source:A.p.ExtensionCommanding,startTimestamp:Date.now()}},entityOptions:{entryPoint:Ln.hB.deepLinkQuickAccess,source:A.p.PlatformTabDeepLink,...!n.isChannel&&{focusOnLoad:Bt.I.DoNotMove}}}},mre=(e,t,n,i)=>{try{if(t===ke.ck.extensions&&e){return JSON.parse(e).appId===n}return!1}catch(t){return i.errorToTelemetry?.(`failed to parse main entity id ${e}`,"platform_personal_app_main_entity_parse",void 0,!0),!1}},pre={onEventReceived:async({eventInput:e})=>{switch(e.event.type){case Br.mu.expandTab:{const t=e.event.data?.();return Promise.resolve({command:ee.expandTab(t)})}case Br.mu.resetLayoutOverrides:return Promise.resolve({command:ee.resetLayoutOverrides()});case Br.mu.maximizeTab:return Promise.resolve({command:ee.maximizeTab()});case uq.mu.requestPersonMoreInfo:const t=e.event.data?.();return Promise.resolve({command:vq(t)});case gZ.z6.launchDefaultPersonalApp:return Promise.resolve({command:ee.defaultCommand({forceTransition:!0})});case gZ.z6.openPresentAppNowConfirmationDialog:{const t=e.event.data?.();return Promise.resolve({command:Uu(t)})}case gZ.z6.launchAppError:{const t=e.event.data?.();return Promise.resolve({command:$u(t)})}case gZ.z6.launchManifestParsingErrorDialog:{const t=e.event.data?.();return Promise.resolve({command:Wu(t)})}}return Promise.resolve(void 0)}},gre=e=>{if(hre(e))return vre(e)?{subNavEntity:yre(e),headerEntity:Sre(e),startEntity:fre(e),mainEntity:kre(e),endEntity:Cre(e)}:null},hre=({contextEntity:e,entity:t,coreSettings:n,layoutMode:i})=>{const{action:a=null,type:o}={...t};if(wre(t,e,n))return!1;const r=[Yt.Rm.focus,Yt.Rm.standard].includes(i),s=[ke.ck.platformapp,ke.ck.platformappdetails,ke.ck.incontextstore,ke.ck.platformapps,ke.ck.extensions,ke.ck.enableappdialog].includes(o),l=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view,ke.SY.update,ke.SY.manage,ke.SY.loading],c=a&&l.includes(a),d=e&&e.action;return!(!r||!s||!c&&!d)},vre=()=>!0,yre=()=>null,Sre=({contextEntity:e,entity:t,coreSettings:n})=>{const i=n?.get(c.w.Extensibility).enablePlatformHeaderEntry;if(bre(t))return null;if(e&&e.action){if(e.type===ke.ck.chats)return t;if(e.type===ke.ck.extensions&&i)return e}return i?t:null},fre=()=>null,kre=({entity:e,contextEntity:t})=>t&&t.action&&(t.type===ke.ck.chats||t.type===ke.ck.extensions)?t:e,Cre=({entity:e,contextEntity:t})=>{if(t&&t.action&&t.type===ke.ck.chats)return t;let n;n=t&&t.action&&t.type===ke.ck.extensions?t:e;const{threadId:i,shouldOpenBotChatPane:a}=Tre(n);return a&&i?{action:ke.SY.view,type:ke.ck.chats,id:i,options:JSON.stringify({focusOnLoad:Bt.I.DoNotMove})}:null},bre=e=>e.type===ke.ck.extensions&&e.action===ke.SY.loading,wre=(e,t,n)=>{const i=n?.get(c.w.Extensibility).enablePlatformHeaderEntry;return e.type===ke.ck.extensions&&t?.type===ke.ck.extensions&&!i},Tre=e=>{if(e.id?.includes("threadId")){const{threadId:t}=(0,Py.j)(e.id),{shouldOpenBotChatPane:n}=(0,Py.j)("options"in e&&e.options||void 0);return{shouldOpenBotChatPane:n,threadId:t}}return{shouldOpenBotChatPane:!1,threadId:void 0}},Ire=({coreSettings:e})=>({headerEntity:{[se.w.HorizontalBar]:{slotHeightOverrides:e?.get(c.w.Extensibility)?.enablePlatformPersonalAppHeaderLayout?"auto":void 0}}}),Nre={id:"com.microsoft.teams.platform-app",name:"Platform App",actors:[vu],supportedEntities:[ke.ck.extensions,ke.ck.taskmodule,ke.ck.hwctaskmodule,ke.ck.platformapp,ke.ck.platformappdetails,ke.ck.platformappconsent,ke.ck.platformapps,ke.ck.platformsubscriptionplans,ke.ck.customapp,ke.ck.platformauthconsentdialog,ke.ck.workflows,ke.ck.selectMediaApi,ke.ck.viewImagesApi,ke.ck.platformtab,ke.ck.locationapi,ke.ck.selectpeoplepicker,ke.ck.platformappratingcoachmark,ke.ck.stagedapps,ke.ck.platformTabGallery,ke.ck.manageapps,ke.ck.manageappswebhook,ke.ck.incontextstore,ke.ck.platformappdevicepermissions,ke.ck.settingsdialog,ke.ck.platformstagemodal,ke.ck.enableappdialog,ke.ck.deeplinkstageconsentdialog,ke.ck.presentappnowconfirmationdialog],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Modal,se.w.Rail,se.w.PreCache],windowFeatures:{width:800,height:600,minWidth:800,minHeight:600,offset:20}},Are=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{platformAppCriticalPhaseTimeout:i}=t.get(c.w.Extensibility);return"Main"!==e&&"PreCache"!==e||n.registerAppPhase({phase:m.Jj.CRITICAL,signals:[Gz.m.PLATFORM_APP_CONTAINER_RENDERED,Gz.m.PLATFORM_APP_FRAME_RENDERED,Gz.m.PLATFORM_APP_FRAME_CONTENT_RENDERED],timeout:i||35e3}),n.appPhases},Ere=({context:{coreSettings:e,scenarioFactory:t}})=>[{id:"prewarm-platform-app",runOncePerId:!0,job:async()=>{const{enablePostALTPrewarmPlatformChunk:i}=e.get(c.w.Extensibility);i&&await(0,ev.wg)((()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(787454),n.e(181316),n.e(598188),n.e(984165),n.e(729849),n.e(214218),n.e(306517),n.e(431784),n.e(475896),n.e(567830),n.e(116447),n.e(164734),n.e(56538),n.e(307339),n.e(677912),n.e(145619),n.e(831554),n.e(899628),n.e(586691),n.e(134498),n.e(307422),n.e(94139),n.e(977204),n.e(449127),n.e(268921),n.e(351715),n.e(711866),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(668415),n.e(684694),n.e(53131),n.e(813370),n.e(736704),n.e(170031),n.e(325254),n.e(385242),n.e(351057),n.e(800350),n.e(399289),n.e(707334),n.e(528699),n.e(695586),n.e(964956)]).then(n.bind(n,34413))),"platform-app",t)}}],Fre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoBrowserAppPreWarmAuthenticationTokenQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"resource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"AcquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resource"},value:{kind:"Variable",name:{kind:"Name",value:"resource"}}},{kind:"Argument",name:{kind:"Name",value:"acquireTokenOptions"},value:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"token"}}]}}]}}]};const _re={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoBrowserAppPreWarmAppDefinitionQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"scope"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDefinition"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"scope"},value:{kind:"Variable",name:{kind:"Name",value:"scope"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"appDefinition"}}]}}]}},...n(706397).h.definitions]};var Dre;!function(e){e.GroupChat="GroupChat",e.Personal="Personal",e.Team="Team"}(Dre||(Dre={}));const Pre={markers:{app_prewarm_start:"app_prewarm_start",app_prewarm_end:"app_prewarm_end",app_prewarm_auth_token_start:"app_prewarm_auth_token_start",app_prewarm_auth_token_end:"app_prewarm_auth_token_end",app_prewarm_auth_token_failed:"app_prewarm_auth_token_failed",app_prewarm_window_removed:"app_prewarm_window_removed",app_prewarm_window_creation_failed:"app_prewarm_window_creation_failed",app_prewarm_window_creation_successful:"app_prewarm_window_creation_successful",app_prewarm_app_definition_received:"app_prewarm_app_definition_received",app_prewarm_content_url_received:"app_prewarm_content_url_received",app_prewarm_close_post_message:"app_prewarm_close_post_message",app_prewarm_auth_post_message:"app_prewarm_auth_post_message"}},Mre=()=>({result:"success"}),Rre=(e,t)=>(t.error("Error executing command in filebrowser pre warm: ".concat(e.message)),{result:"error",error:{code:e.code||"unknown",message:e.message}}),xre=e=>({result:"error",error:{code:"unsupportedCommand",message:e.command}}),Lre=e=>t=>{e(t.data)},Ore=(e,t,n)=>{const{close:i,authenticate:a}=t,o=(({sendAck:e,sendCommandResult:t,close:n,authenticate:i,logger:a})=>async o=>{if("command"===o.type){e(o);const r=o.data;switch(r.command){case"close":n(r).then((()=>{t(o,Mre())}),(e=>{t(o,Rre(e,a))}));break;case"authenticate":i(r).then((e=>{t(o,e)}),(e=>{t(o,Rre(e,a))}));break;default:t(o,xre(r))}}})({sendAck:t=>{e&&e.postMessage({type:"acknowledge",id:t.id})},sendCommandResult:(t,n)=>{e&&e.postMessage({type:"result",id:t.id,data:n})},close:i,authenticate:a,logger:n});((e,t)=>{const n=Lre(t);e&&(e.addEventListener("message",n),e.start(),e.postMessage({type:"activate"}))})(e,o)},jre=async(e,t,n,i,a,o,r)=>{const s=n.findScenario(be.Cu.AppPreWarm);s?.mark(`AppPreWarm_${e}_Start`);const l=async t=>{const a=o.document.getElementById(`${e}Iframe`),r=n.findScenario(be.Cu.AppPreWarm);a?a.remove():o.document.getElementById("prewarmAppIframe")?.remove(),i.log("Removed Hidden Iframe"),r?.mark(Pre.markers.app_prewarm_window_removed,void 0,t?"timeout":"success"),r?.stop(),Promise.resolve()},c=async e=>{const{resource:t}=e,n=new URL(t).origin;i.log(`getAuthToken triggered for resource: ${t}`),s?.mark(Pre.markers.app_prewarm_auth_token_start);const o=await a.query({query:Fre,fetchPolicy:"cache-first",variables:{resource:n}}),r=o.data?.authenticationToken?.token??"";return s?.mark(Pre.markers.app_prewarm_auth_token_end),Promise.resolve(r)};try{const{data:n}=await a.query({query:_re,variables:{scope:Dre.Personal,appId:t},context:{callerInfo:`${e}PreWarmStrategy`}}),{appDefinition:r}=n;s?.mark(Pre.markers.app_prewarm_app_definition_received);const d=r?.staticTabs&&r?.staticTabs[0]?.contentUrl||"";s?.mark(Pre.markers.app_prewarm_content_url_received);const u=d.split("hosted/").join(""),m=((e,t)=>{const n=e.document.createElement("iframe");return n&&(n.setAttribute("id",t?`${t}Iframe`:"prewarmAppIframe"),n.style.display="none",n.setAttribute("target","_self"),e.document.body.appendChild(n)),n&&n.contentWindow||null})(o,e);m||(s?.mark(Pre.markers.app_prewarm_window_creation_failed),s?.fail({errorMessage:"Failed to create iframe"}),s?.incomplete({reason:"Failed to create iframe"}),Promise.resolve()),s?.mark(Pre.markers.app_prewarm_window_creation_successful),await(async(e,t,n,i)=>{const a=new URL(t).origin,o=await n({resource:a});if(o&&e){const n=e.document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","access_token"),n.setAttribute("value",o);const a=e.document.createElement("form");a.appendChild(n),a.setAttribute("action",t),a.setAttribute("method","POST"),e.document.body.appendChild(a),a.submit(),i?.mark("Form Created and submitted")}else i?.fail({errorMessage:"Token fetch failed"})})(m,u,c,s),((e,t,n)=>{let i,a=12e3;e&&e>0&&(a=e),i=void 0,i=t.setTimeout((()=>{n(!0),t.clearTimeout(i)}),a)})(18e3,o,l);const p=`${Math.random().toFixed(8)}`,g=await((e,t,n)=>{let i;return new Promise(((a,o)=>{let r;const s=e=>{if(e.source&&t&&e.source===t&&"initialize"===e.data.type){r&&(clearInterval(r),r=void 0);const t=e.ports&&e.ports[0];if(t)return i=t,void a(i);o(i)}};t?(r=setInterval((()=>{i?(clearInterval(r),r=void 0):t.postMessage({type:"identify-parent",channelId:e},n.document.location?.origin)}),100),n.addEventListener("message",s)):a(i)}))})(p,m,o),h=((e,t,n,i)=>({close:async()=>{n?.log("Close post meessage received"),i?.mark(Pre.markers.app_prewarm_close_post_message),await t(!1)},authenticate:async t=>{n?.log(`Authenticate post meessage received for ${t.resource}`),i?.mark(Pre.markers.app_prewarm_auth_post_message);const a=await e({resource:t.resource});return a?{result:"token",scheme:"bearer",token:a}:(n?.log("Not able to PreWarm the App"),i?.mark(Pre.markers.app_prewarm_auth_token_failed),{result:"error",error:{code:"NoTokenObtained",message:"Could not obtain a token for resource."}})}}))(c,l,i,s);Ore(g,h,i)}catch(t){const n=`Failed ${e} PreWarmStrategy with errorCode ${t?.errorCode||t?.code}`;i.error?.(n),s?.fail({reason:n})}},Bre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsPlatformAppPrecacheAppListQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"precacheAppList"}}]}}]},Ure={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsPlatformAppCachedAppListQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cachedAppList"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"isPreloadedApp"}}]}}]}}]}}]},$re=async(e,t,n)=>{const{client:i,coreSettings:a,loggerFactory:o,preCacheManager:r}=e,{appPrecachingOverrideAppList:s,appCachingMaxPrecacheSize:l}=a.get(c.w.Extensibility),d=o.newLogger(n,"apps-platform-app");d.log(`${AH.b}Precaching job started.`),t.mark(be.BQ.PrecacheJobStarted);const u=await Wre(i,t,d);if(!u||Vre(u,l||0,t,d))return;let m=[];const p=await Hre(i,s,t,d);p&&(m=zre(p,u,t,d)),m?.length&&(qre(d,t,r,m),t.stop())},Wre=async(e,t,n)=>{try{const n=await e.query({query:Ure});t.mark(be.BQ.CachedAppListFetched);return n.data.cachedAppList?.apps||[]}catch{return n.error(`${AH.b}Error fetching cached app list. Query Failed.`),void t.fail({errorCode:"CachedAppListQueryError"})}},Vre=(e,t,n,i)=>e.filter((e=>e.isPreloadedApp)).length>=t&&(i.log(`${AH.b}Precache slots are full. Skipping precaching.`),n.mark(be.BQ.PrecacheSlotsAreFull),n.stop(),!0),Hre=async(e,t,n,i)=>{try{const a=await e.query({query:Bre,fetchPolicy:"cache-first"});n.mark(be.BQ.PrecacheAppListFetched);const o=t?.length?t:a.data.precacheAppList;return o?.length&&i.log(`${AH.b}Precache app suggestions${t?.length&&" from settings override"}: ${o.join(", ")}`),o}catch{return i.error(`${AH.b}Error fetching precache app list. Query Failed.`),void n.fail({errorCode:"PrecacheAppListQueryError"})}},zre=(e,t,n,i)=>{const a=e.filter((e=>{const n=t.some((t=>t.appId===e));return n&&i.log(`${AH.b}App ${e} is already cached. Skipping precaching.`),!n}));return a.length?i.log(`${AH.b}Precaching apps: ${a.join(", ")}`):(i.log(`${AH.b}No apps to precache. Skipping precaching.`),n.mark(be.BQ.NoAppsToPrecache),n.stop()),a},qre=(e,t,n,i)=>{const a=i.map((e=>({correlationId:(0,E.v4)(),entity:{id:JSON.stringify({appId:e}),type:ke.ck.extensions,action:ke.SY.loading,options:{entryPoint:Ln.hB.precache}}})));e.log(`${AH.b}Settings precaching state with ${i.length} Apps`),n?.preCacheApps(a),t.mark(be.BQ.PrecacheListSentToManager),t.appendEventData({"Platform.AppIds":i})},Gre=e=>{const{client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,windowProvider:o}=e,r=a.findScenario(be.Cu.AppPreWarm),{enablePreWarmAppsJob:s,enableAppPreCaching:l}=n.get(c.w.Core),{appCachingMaxPrecacheSize:d}=n.get(c.w.Extensibility),u=[];if(s&&u.push({id:"app-pre-load-job",runOncePerId:!0,job:async()=>{r?.mark("preWarmApps job pushed"),r?.mark("Job Pushed",{reason:"Job Pushed"}),await(async(e,t,n,i,a)=>{const o=t.newLogger("AppPreWarmStrategy","apps-pre-warm"),r=a.get(c.w.Core).appConfigForPreWarm;r?.forEach((t=>{const{appName:r,appId:s}=t;jre(r,s,e,o,n,i,a)}))})(a,i,t,o,n)}}),l&&d){const t=a.newScenario(be.Cu.PlatformAppPrecacheJob);t.appendEventData({appLifeCycleState:"Idle"}),t.mark(be.BQ.OnIdleTriggered),u.push({id:"pre-cache-apps-job",job:async()=>$re(e,t,"platform-app-on-idle")})}return u},Yre=({context:e})=>{const t=e.scenarioFactory.newScenario(be.Cu.AppPreWarm);t.mark("OnIdle triggered for app pre-warm jobs"),t.mark("Job triggered",{reason:"Job Triggered"});return Gre(e).map((e=>({...e,id:e.id})))},Qre=({context:e})=>{const t=(e=>{const{coreSettings:t,scenarioFactory:n}=e,{enableAppPreCaching:i}=t.get(c.w.Core),{appCachingMaxPrecacheSize:a}=t.get(c.w.Extensibility),o=[];if(i&&a){const t=n.newScenario(be.Cu.PlatformAppPrecacheJob);t.appendEventData({appLifeCycleState:"ExperienceLongIdle"}),t.mark(be.BQ.OnLongIdleTriggered),o.push({id:"pre-cache-apps-job",job:async()=>$re(e,t,"platform-app-on-experience-long-idle")})}return o})(e);return t.map((e=>({...e,id:e.id})))},Jre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsPlatformAppAppsLastSyncTimeEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appsLastSyncTimeEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"reason"}}]}}]}}]},Kre=e=>({id:"apps-sync-subscription",runOncePerId:!0,job:()=>{const{client:t,coreSettings:n,loggerFactory:i}=e,{enableAppsDynamicCacheEviction:a,enableNewAdminPreinstalledAppCoachmark:o,appsDynamicCacheEvictionConfig:r,enableNewAppsCoachmarkRefactor:s}=n.get(c.w.Extensibility);if(!a||!r)return;const l=i.newLogger("createAppsSyncSubscriptionJob","apps-platform-app"),d=t.subscribe({query:Jre}).subscribe((({data:n})=>{if(n?.appsLastSyncTimeEvent&&r[n.appsLastSyncTimeEvent.type])try{const{broadcast:i,fieldNames:a,validSyncReasons:c}=r[n.appsLastSyncTimeEvent.type];if(c&&!c.includes(n.appsLastSyncTimeEvent.reason??""))return;a.forEach((e=>{t.cache.evict({fieldName:e,broadcast:i})})),l.infoToTelemetry?.(`${n.appsLastSyncTimeEvent.type} cache got evicted for the following reason ${n.appsLastSyncTimeEvent.reason}`,"platform_apps_sync_subscription_job",void 0,!0),!s&&o&&"InstalledApp"===n.appsLastSyncTimeEvent.type&&e.entityCommanding.esp.displaySurface("newAdminPreinstalledAppCoachmark")}catch(e){l.errorToTelemetry?.(`${n.appsLastSyncTimeEvent.type} cache failed to evict: ${e}`,"platform_apps_sync_subscription_job",void 0,!0)}}));return()=>d.unsubscribe()}}),Zre=e=>({id:"new-apps-subscription",runOncePerId:!0,job:()=>{const{client:t,coreSettings:n,loggerFactory:i}=e,{enableAppsDynamicCacheEviction:a,appsDynamicCacheEvictionConfig:o,enableNewAdminPreinstalledAppCoachmark:r,enableNewAppsCoachmarkRefactor:s}=n.get(c.w.Extensibility);if(!(a&&o&&r&&s))return;const l=i.newLogger("createNewAppsSubscriptionJob","apps-platform-app"),d=t.subscribe({query:Jre}).subscribe((({data:t})=>{"InstalledApp"===t?.appsLastSyncTimeEvent?.type&&(l.log("InstalledApp cache got evicted, checking for new admin preinstalled apps."),e.entityCommanding.esp.displaySurface("newAdminPreinstalledAppCoachmark"))}));return()=>d.unsubscribe()}}),Xre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsPlatformAppContextlessInstalledAppsUpdateEventSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedContexts"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallContext"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedAppsUpdateEventV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedContexts"},value:{kind:"Variable",name:{kind:"Name",value:"installedContexts"}}},{kind:"Argument",name:{kind:"Name",value:"subscribeToContextlessApps"},value:{kind:"BooleanValue",value:!0}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"eventType"}},{kind:"Field",name:{kind:"Name",value:"installedScope"}},{kind:"Field",name:{kind:"Name",value:"app"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},ese=e=>({id:"contextless-apps-subscription",runOncePerId:!0,job:()=>{const{client:t,coreSettings:n,loggerFactory:i}=e,{enableUnconsentedMRUApps:a,enableAppsDynamicCacheEviction:o,appsDynamicCacheEvictionConfig:r}=n.get(c.w.Extensibility);if(!a||!o||!r)return;const s=i.newLogger("createContextlessAppsSubscriptionJob","apps-platform-app"),l=t.subscribe({query:Xre,variables:{installedContexts:[]}}).subscribe((({data:e})=>{if("Added"===e?.installedAppsUpdateEventV2?.eventType)try{const{broadcast:e,fieldNames:n}=r.InstalledApp;n.forEach((n=>{t.cache.evict({fieldName:n,broadcast:e})})),s.infoToTelemetry?.("InstalledApp cache got evicted due to newly added contextless app","platform_contextless_apps_subscription_job",void 0,!0)}catch(e){s.errorToTelemetry?.("InstalledApp cache failed to evict","platform_contextless_apps_subscription_job",void 0,!0)}}));return()=>l.unsubscribe()}}),tse=({context:e})=>[Kre(e),Zre(e),ese(e)],nse=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(787454),n.e(490329),n.e(181316),n.e(984165),n.e(616161),n.e(729849),n.e(214218),n.e(307339),n.e(417997),n.e(307422),n.e(94139),n.e(784980),n.e(449127),n.e(268921),n.e(351715),n.e(711866),n.e(516359),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(684694),n.e(53131),n.e(813370),n.e(385242),n.e(461824),n.e(351057),n.e(399289),n.e(695586),n.e(637729)]).then(n.bind(n,373661)),ise=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(787454),n.e(181316),n.e(598188),n.e(984165),n.e(729849),n.e(214218),n.e(306517),n.e(431784),n.e(475896),n.e(567830),n.e(116447),n.e(164734),n.e(56538),n.e(307339),n.e(677912),n.e(145619),n.e(831554),n.e(899628),n.e(586691),n.e(134498),n.e(307422),n.e(94139),n.e(977204),n.e(449127),n.e(268921),n.e(351715),n.e(711866),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(668415),n.e(684694),n.e(53131),n.e(813370),n.e(736704),n.e(170031),n.e(325254),n.e(385242),n.e(351057),n.e(800350),n.e(399289),n.e(707334),n.e(528699),n.e(695586),n.e(964956)]).then(n.bind(n,34413)),ase=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(984165),n.e(616161),n.e(185332),n.e(255544),n.e(325670),n.e(729849),n.e(484331),n.e(214218),n.e(960122),n.e(736709),n.e(306517),n.e(964401),n.e(405198),n.e(524147),n.e(845039),n.e(431784),n.e(964859),n.e(475896),n.e(940543),n.e(296930),n.e(567830),n.e(116447),n.e(92198),n.e(187739),n.e(5982),n.e(353927),n.e(280759),n.e(164734),n.e(56538),n.e(737305),n.e(785043),n.e(655224),n.e(307339),n.e(677912),n.e(145619),n.e(168524),n.e(899628),n.e(20504),n.e(273558),n.e(586691),n.e(253),n.e(16570),n.e(46687),n.e(900716),n.e(931455),n.e(307422),n.e(94139),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(938671),n.e(527908),n.e(449127),n.e(268921),n.e(351715),n.e(221963),n.e(711866),n.e(828633),n.e(399498),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(668415),n.e(684694),n.e(53131),n.e(813370),n.e(736704),n.e(119597),n.e(170031),n.e(325254),n.e(148703),n.e(385242),n.e(566999),n.e(351057),n.e(800350),n.e(746071),n.e(634370),n.e(399289),n.e(528699),n.e(615071),n.e(620368),n.e(495022),n.e(593547),n.e(225748),n.e(925560),n.e(798002),n.e(573748),n.e(290799),n.e(317929),n.e(312098)]).then(n.bind(n,555020)),ose=({coreServices:{coreSettings:e},host:t,screenState:n})=>{const{disablePlatformAppWindowFeatures:i,enablePlatformAppLargePopout:a}=e.get(c.w.Extensibility),o=t?.screen;if(i||!o)return null;const{minHeight:r,minWidth:s,offset:l=1,height:d=0,width:u=0}=Nre.windowFeatures||{};let m,p,g,h;const v=((n?.numOpenWindows||1)-1)*l;if(a){const t=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=Nre.windowFeatures||{};let{width:a=i,height:o=n}=Nre.windowFeatures||{};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:d}=t.get(c.w.Calling);if(s&&l&&d)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=d*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/d*a}return{height:o,width:a}})(o,e),n=((e,t,n)=>{const i=Nre.windowFeatures.offset||0,a="availLeft"in e&&e.availLeft||0,o="availTop"in e&&e.availTop||0,r=a+e.availWidth/2-t/2;let s;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":s=o+i;break;default:s=o+e.availHeight/2-n/2}return{left:r,top:s}})(o,t.width,t.height);m=t.height,p=t.width,g=n.left,h=n.top}else{const e={left:t?.screenX||0,top:t?.screenY||0};m=d,p=u,g=e.left,h=e.top}return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},left:g+v,top:h+v,minHeight:r,minWidth:s,height:m,width:p}};function rse(){const e=()=>null;return{getCommandScenarioName:sse,getAppPhases:Are,getAppViewEntities:gre,getAppWindowFeatures:ose,getPlatformAppIdForEntity:e=>{if(e.type===ke.ck.extensions){const{appId:t}=e.id&&JSON.parse(e.id);return t}},getAppViewEntitiesProps:Ire,onBeforeDeeplinkParsed:Zoe,manifest:Nre,onCommandReceived:sre,onRegister:e=>{e.registerTask(new rh)},render:async({appRenderMode:t,scenarioFactory:n,onRenderEvent:i})=>{switch(t){case se.w.Modal:{const e="platform-modal",t=n?.findScenario(be.Cu.PlatformTabStageModalLaunch),i=n?.findScenario(be.Cu.PlatformTabStageViewFrameLoading),a=t||i;a?.mark(be.BQ.PlatformTabRenderBeforeChunkLoad);const{Modal:o}=await(0,ev.wg)(ase,e,n);return a?.mark(be.BQ.PlatformTabRenderAfterChunkLoad),(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(o,{})})}case se.w.HorizontalBar:case se.w.PreCache:case se.w.Main:{const e="platform-app",a=n?.findScenario(be.Cu.PlatformTabFrameLoading);a?.currentStep!==be.BQ.PlatformTabRenderAfterChunkLoad&&(a?.mark(be.BQ.PlatformTabRenderBeforeChunkLoad),a?.startStep(be.BQ.PlatformTabRenderAfterChunkLoad)),i("ChunkLoadStarted",{chunkName:e});const{PlatformAppViewsEntryRenderer:o}=await(0,ev.wg)(ise,e,n);return i("ChunkLoadSucceeded",{chunkName:e}),a?.currentStep===be.BQ.PlatformTabRenderAfterChunkLoad&&a?.mark(be.BQ.PlatformTabRenderAfterChunkLoad),(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(o,{appRenderMode:t})})}case se.w.Rail:{const e="platform-app-rail",{PlatformTabPanel:t}=await(0,ev.wg)(nse,e,n);return(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(t,{})})}default:return(0,Lr.Y)(e,{})}},eventHandlers:pre,onPreWarm:Ere,onUserWindowPreWarm:tse,onIdle:Yre,onExperienceLongIdle:Qre}}const sse=e=>{const{entity:{type:t,action:n}}=e;if(!(t!==ke.ck.extensions&&t!==ke.ck.platformstagemodal||n!==ke.SY.view&&n!==ke.SY.loading))return be.Cu.PlatformTabCommandingScenario},lse={id:"com.microsoft.teams.presenter-toolbar",name:"PresenterToolbarApp",supportedEntities:[ke.ck.presentertoolbar],supportedRenderModes:[se.w.Main],windowFeatures:{height:59,width:480,offset:-2}},cse=e=>{if(dse(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:use(e),endEntity:null}},dse=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===ke.ck.presentertoolbar,a=t===ke.SY.view;return Boolean(i&&a)},use=({entity:e})=>e,mse=()=>({mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,disableBorderInHighContrast:!0}}}),pse={onEventReceived:({eventInput:e})=>{if(e.event.type===pZ.mu.toggleInfoPane)if(gse(e.event)){const t=e.event.data();if(t){const{source:e,showOption:n,id:i,isBYODAttendeeView:a,infoPaneType:o,action:r,callingIntentId:s,linkedEntityType:l="calls",correlationId:c}=t,d={...a&&{isBYODAttendeeView:a}};return Promise.resolve({command:ee.toggleEndRail({action:r||"view",entityOptions:d,id:i,source:e,showOption:n,type:o,correlationId:c,...s&&{linkedEntity:{type:l,id:s}}})})}}return Promise.resolve(void 0)}},gse=e=>e.type===pZ.mu.toggleInfoPane,hse=()=>Promise.all([n.e(383414),n.e(311576),n.e(736704),n.e(688782),n.e(448989)]).then(n.bind(n,859694)),vse=({host:e,coreServices:t})=>{const n=e?.screen;if(!n)return null;const i=lse.windowFeatures.width||480,a=lse.windowFeatures.height||60,o=lse.windowFeatures.offset||10,r=("availLeft"in n?n.availLeft:0)+n.availWidth/2-i/2,s=t?.coreSettings.get(c.w.Calling).disableContentprotection,l=(!s).toString();return{additionalFeatures:{alwaysOnTop:"true",closable:"false",excludeWindowFromScreenSharing:l,fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"false",movable:"false",hideWindowControl:"true",frame:"false",closeoverride:"true",contentprotection:l,transparent:"true",show:"false",visibleOnAllWorkspaces:"true"},top:o,left:r,width:i,height:a}};function yse(){const e=()=>null;return{eventHandlers:pse,getAppViewEntities:cse,getAppViewEntitiesProps:mse,getAppWindowFeatures:vse,manifest:lse,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===se.w.Main&&n===ke.ck.presentertoolbar){const{PresenterToolbar:e}=await(0,ev.wg)(hse,"presenter-toolbar-app",i);return(0,Lr.Y)(e,{})}return(0,Lr.Y)(e,{})}}}const Sse=({action:e,appRenderMode:t,coreSettings:n})=>{const i=new qz.D,{queuesAppPhaseTimeouts:a}=n.get(c.w.Queues),o=[],r=[];switch(t){case se.w.Rail:kse({action:e,criticalSignals:o,postCriticalSignals:r,featureFlags:{}});break;case se.w.Main:Cse({action:e,criticalSignals:o,postCriticalSignals:r,featureFlags:{}});break;case se.w.HorizontalBar:fse({action:e,criticalSignals:o,postCriticalSignals:r,featureFlags:{}})}return i.registerAppPhase({phase:m.Jj.CRITICAL,signals:o,timeout:a?.critical||6e4}),i.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:r,timeout:a?.postCritical||1e4}),i.appPhases},fse=({criticalSignals:e})=>{e.push(Gz.m.QUEUES_APP_HEADER_STARTED),e.push(Gz.m.QUEUES_APP_HEADER_DATA_LOADED),e.push(Gz.m.QUEUES_APP_HEADER_RENDERED)},kse=({action:e,criticalSignals:t})=>{e===ke.SY.view&&(t.push(Gz.m.QUEUES_APP_LEFT_STARTED),t.push(Gz.m.QUEUES_APP_LEFT_RENDERED))},Cse=({criticalSignals:e})=>{e.push(Gz.m.QUEUES_APP_CENTER_STARTED),e.push(Gz.m.QUEUES_APP_CENTER_RENDERED)},bse="33rem",wse=e=>{if(Ise(e))return Nse(e)?{subNavEntity:Ase(e),headerEntity:Ese(e),startEntity:Fse(e),mainEntity:_se(e),endEntity:Dse(e)}:null},Tse=({coreSettings:e})=>{const t=e?.get(c.w.Core).enableReflow,n=new Map([[fZ.cw.IS_GREATER_THAN_0,"0"],[fZ.cw.IS_AT_LEAST_947,bse],[fZ.cw.IS_AT_LEAST_1350,"37rem"],[fZ.cw.IS_AT_LEAST_1500,"41rem"]]);return t&&n.set(fZ.cw.IS_AT_LEAST_640,bse),{startEntity:{[se.w.Rail]:{slotWidthOverrides:n}}}},Ise=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.queuesanalyticsheadertab,ke.ck.queuesanalyticsrealtimenavigationitem,ke.ck.queuesanalyticshistoricalnavigationitem,ke.ck.queues,ke.ck.queueuser,ke.ck.callhistoryrow].includes(i),r=[ke.SY.info,ke.SY.default,ke.SY.list,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Nse=()=>!0,Ase=()=>null,Ese=({entity:e})=>e,Fse=({entity:e})=>e,_se=({entity:e})=>e,Dse=()=>null,Pse={id:"com.microsoft.teams.queues",name:"Queues",actors:[Vu],supportedEntities:[ke.ck.queues,ke.ck.queueuser,ke.ck.queuesanalyticsheadertab,ke.ck.queuesanalyticsrealtimenavigationitem,ke.ck.queuesanalyticshistoricalnavigationitem,ke.ck.callhistoryrow],supportedRenderModes:[se.w.HorizontalBar,se.w.Rail,se.w.Main],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600},getDefaultCommand:()=>({type:ke.ck.queues,action:ke.SY.default})};var Mse=n(718645);const Rse=(e,t)=>{t.errorToTelemetry?.(e,"cmd_queues_on_command_received",void 0,!0)},xse=e=>{const{callQueueId:t}=e;return!!t},Lse=e=>{const{callQueueId:t}=e||{};return!!t},Ose=e=>{const{userId:t,callQueueId:n}=e||{};return!!t&&!!n},jse=e=>{const{callQueueId:t,itemType:n}=e||{};return!!t&&!!n},Bse=e=>{const{channelId:t,callQueueId:n}=e||{};return!!t&&!!n},Use={visibilityState:g.Rp.show,stateTransition:g.Ar.flush},$se=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n,data:i}}=e,a=t.newLogger("QueuesApp onCommandReceived","apps-queues");if(e.command.actor===Vu)switch(n){case Hu:return{entity:{type:ke.ck.queues,action:ke.SY.default},command:{...Use,correlation:{source:A.p.Unknown}}};case zu:return{entity:{type:ke.ck.queues,action:ke.SY.view},command:{...Use,correlation:{source:A.p.Unknown}}};case qu:return((e,t)=>{if(!Lse(e))return void Rse(`Command '${qu}' requires 'callQueueId' in data`,t);const n=e;return{entity:{type:ke.ck.queues,action:ke.SY.view,id:JSON.stringify({callQueueId:n.callQueueId,itemType:Mse.SP.Queue,isSupervisor:n.isSupervisor,isSupervisorAndAgent:n.isSupervisorAndAgent,channelId:n.channelId})},command:{...Use,correlation:{source:A.p.QueuesAppHeader}}}})(i,a);case Qu:return(e=>{const t=e;return{entity:{type:ke.ck.queuesanalyticsheadertab,action:ke.SY.view,id:t?.lastTabValue},command:{...Use,correlation:{source:A.p.QueuesAppHeader}}}})(i);case Ju:return((e,t)=>{if(e&&e.realTimeAnalyticsSelectedItemId)return{entity:{type:ke.ck.queuesanalyticsrealtimenavigationitem,action:ke.SY.view,id:e.realTimeAnalyticsSelectedItemId},command:{...Use,stateTransition:g.Ar.flow,correlation:{source:A.p.QueuesAnalyticsLeftNavigation}}};Rse(`Command '${Ju}' requires 'realTimeAnalyticsSelectedItemId' in data`,t)})(i,a);case Ku:return((e,t)=>{if(e&&e.historicalAnalyticsSelectedItemId)return{entity:{type:ke.ck.queuesanalyticshistoricalnavigationitem,action:ke.SY.view,id:e.historicalAnalyticsSelectedItemId},command:{...Use,stateTransition:g.Ar.flow,correlation:{source:A.p.QueuesAnalyticsLeftNavigation}}};Rse(`Command '${Ku}' requires 'historicalAnalyticsSelectedItemId' in data`,t)})(i,a);case Gu:return((e,t)=>{if(!Ose(e))return void Rse(`Command '${Gu}' requires 'userId' and 'callQueueId' in data`,t);const n=e;return{entity:{type:ke.ck.queueuser,action:ke.SY.view,id:JSON.stringify({callQueueId:n.callQueueId,userId:n.userId,isSupervisor:n.isSupervisor,showAnalyticsData:n.showAnalyticsData,itemType:n.itemType,showMonitorButton:n.showMonitorButton,monitorSessionTargetUserId:n.monitorSessionTargetUserId})},command:{...Use,correlation:{source:A.p.QueuesPeopleManagement}}}})(i,a);case Yu:return((e,t)=>{if(!e||!e.callQueueId||!e.row)return void Rse(`Command '${Yu}' requires 'row' and 'callQueueId' in data`,t);const n=e;return{entity:{type:ke.ck.callhistoryrow,action:ke.SY.view,id:JSON.stringify({callQueueId:n.callQueueId,messageId:n.row?.messageId})},entityOptions:n,command:{...Use,correlation:{source:A.p.CallHistory}}}})(i,a);case Zu:return((e,t)=>{if(!jse(e))return void Rse(`Command '${Zu}' requires 'callQueueId' and 'itemType' in data`,t);const n=e;return{entity:{type:ke.ck.queues,action:ke.SY.view,id:JSON.stringify({callQueueId:n.callQueueId,itemType:n.itemType,isSupervisor:n.isSupervisor,isSupervisorAndAgent:n.isSupervisorAndAgent,channelId:n.channelId})},command:{...Use,correlation:{source:A.p.QueuesAppQuickAccess}}}})(i,a);case Xu:return((e,t)=>{if(!Bse(e))return void Rse(`Command '${Xu}' requires 'callQueueId' and 'channelId' in data`,t);const n=e;return{entity:{type:ke.ck.callablechannels,action:ke.SY.list,id:n.callQueueId,linkedEntity:{id:n.channelId,type:ke.ck.channels}},command:{...Use,correlation:{source:A.p.QueuesAnalyticsMain}}}})(i,a);case em:return((e,t)=>{if(!xse(e))return void Rse(`Command '${em}' requires 'callQueueId' in data`,t);const n=e;return n.isSupervisorAndNotAgent?{entity:{type:ke.ck.settingsstorecallqueue,action:ke.SY.view,id:n.callQueueId},entityOptions:{callSettingsTabParams:{category:"callQueue",authorizedSettings:{id:n.callQueueId}}},command:{...Use,correlation:{source:A.p.QueuesAnalyticsMain}}}:{entity:{type:ke.ck.settingsstorecallqueue,action:ke.SY.view,id:n.callQueueId},entityOptions:{callSettingsTabParams:{category:"callQueue",agentCallQueueSetting:{id:n.callQueueId}}},command:{...Use,correlation:{source:A.p.QueuesAnalyticsMain}}}})(i,a);case tm:return(e=>{const t=e?.errorType;return{entity:{type:ke.ck.queues,action:ke.SY.view,id:JSON.stringify({errorType:t})},command:{...Use,correlation:{source:A.p.Unknown}}}})(i);default:Rse(`Command action '${n}' is not supported by QueuesApp`,a)}else Rse(`Command for actor '${e.command.actor}' cannot be handled by QueuesApp`,a)},Wse=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(215618),n.e(306517),n.e(636192),n.e(231020),n.e(811751),n.e(568721),n.e(845039),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(79899),n.e(566555),n.e(187257),n.e(572891),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(623178),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(449827),n.e(239470),n.e(685119),n.e(422790),n.e(574395),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(418497),n.e(574961),n.e(155688),n.e(526689),n.e(701109)]).then(n.bind(n,755622)),Vse=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(490329),n.e(311914),n.e(181316),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(255544),n.e(215618),n.e(306517),n.e(636192),n.e(231020),n.e(811751),n.e(568721),n.e(845039),n.e(122814),n.e(102216),n.e(286993),n.e(967653),n.e(79899),n.e(566555),n.e(187257),n.e(572891),n.e(168524),n.e(531240),n.e(843675),n.e(843087),n.e(24444),n.e(623178),n.e(307422),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(905965),n.e(569158),n.e(449827),n.e(239470),n.e(685119),n.e(422790),n.e(574395),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(331703),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(311576),n.e(397928),n.e(288919),n.e(615002),n.e(354884),n.e(892960),n.e(708241),n.e(391700),n.e(240991),n.e(640233),n.e(677226),n.e(620368),n.e(418497),n.e(574961),n.e(155688),n.e(526689),n.e(701109)]).then(n.bind(n,819867)),Hse={onEventReceived:({eventInput:{event:e},requestContext:{loggerFactory:t}})=>{const n=t.newLogger("QueuesApp eventHandlers","apps-queues"),{data:i}=e,a="function"==typeof i?i():{};if(!(0,Mse.tn)(e))return Promise.resolve(void 0);let o;switch(e.type){case Mse.mu.switchToCallQueue:o=a;return!!o.callQueueId?Promise.resolve({command:rm(o)}):(n.error("No callQueueId in event data"),Promise.resolve(void 0));case Mse.mu.selectQueueUser:return o=a,qse(o)?Promise.resolve({command:sm(o)}):(n.error("No userId or callQueueId in event data"),Promise.resolve(void 0));case Mse.mu.switchToQueuesAnalytics:return o=a,Promise.resolve({command:im(o)});case Mse.mu.selectRealTimeAnalyticsNavigationItem:return o=a,o.realTimeAnalyticsSelectedItemId?Promise.resolve({command:am(o)}):(n.error("No queues app analytics tab left rail real time select item id"),Promise.resolve(void 0));case Mse.mu.selectHistoricalAnalyticsNavigationItem:return o=a,o.historicalAnalyticsSelectedItemId?Promise.resolve({command:om(o)}):(n.error("No queues app analytics tab left rail real time select item id"),Promise.resolve(void 0));case v5._D.viewCallHistoryDetails:o=a;return!(!o.row||!o.callQueueId)?Promise.resolve({command:lm(o)}):(n.error("No call history row or callQueueId in event data"),Promise.resolve(void 0));case Mse.mu.selectCallQueueOverview:return o=a,o.callQueueId?o.itemType?Promise.resolve({command:cm(o)}):(n.error("No itemType in event data"),Promise.resolve(void 0)):(n.error("No callQueueId in event data"),Promise.resolve(void 0));case Mse.mu.navigateToChannel:return o=a,Gse(o)?Promise.resolve({command:dm(o)}):(n.error("No callQueueId or channelId in event data"),Promise.resolve(void 0));case Mse.mu.navigateToSettings:return o=a,o.callQueueId?Promise.resolve({command:um(o)}):(n.error("No callQueueId in event data"),Promise.resolve(void 0));case Mse.mu.goBack:return Promise.resolve({command:ee.goBack()});case Mse.mu.toggleStartRail:const{showOption:e}=a;return Promise.resolve({command:ee.toggleStartRail({showOption:e})});case Mse.mu.displayErrorMessage:return zse(a)}return Promise.resolve(void 0)}},zse=e=>{const t=e;return Promise.resolve({command:mm(t)})},qse=e=>{const{userId:t,callQueueId:n}=e;return!!t&&!!n},Gse=e=>{const{channelId:t,callQueueId:n}=e;return!!t&&!!n},Yse={shouldAddEntitiesToWindowHistory:()=>!0,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>e.type!==ke.ck.callhistoryrow},Qse={filter:"/l/launch-queuesapp",execute:async({deeplinkUrl:{pathname:e,protocol:t},context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("[Calling][OnBeforeDeeplinkParsed][queuesAppDeepLinkCondition]","apps-calling"),{enableCallingRecall:o}=n.get(c.w.Calling),{environment:r}=n.get(c.w.Metadata),s=r===$a.B.life;if(!o||s){const e=`throwing error due to enableCallingRecall=${o} | isTFL=${s}`;throw a.warn?.(e),new Error(e)}return a.log?.(`Executing queuesAppDeepLinkCondition for protocol=${t}, pathname=${e}`),{entityCommand:{entity:{type:ke.ck.queues,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.CallingRecallDeeplinkCondition}}},metadata:{allowAnonymous:!1}}}},Jse=[Qse],Kse=()=>Pse.windowFeatures||{},Zse=e=>e.command.correlation.source!==A.p.StandAlone?be.Cu.QueuesAppSwitch:void 0;function Xse(){return{eventHandlers:Hse,getAppPhases:Sse,getAppViewEntities:wse,getAppViewEntitiesProps:Tse,getAppWindowFeatures:Kse,getCommandScenarioName:Zse,getPlatformAppIdForEntity:e=>Pse.supportedEntities.includes(e.type)?"a02e4d17-af86-4ceb-9c97-4c2626eb3587":void 0,manifest:Pse,onCommandReceived:$se,onBeforeAddToNavigation:Yse,onBeforeDeeplinkParsed:Jse,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const{QueuesAppViewsRenderer:i,LPC:a}=await(async(e,t)=>{const n="queues-app";t("ChunkLoadStarted",{chunkName:n});const[{QueuesAppViewsRenderer:i},{LPC:a}]=await Promise.all([(0,ev.wg)(Wse,n,e),(0,ev.wg)(Vse,n,e)]);return t("ChunkLoadSucceeded",{chunkName:n}),{QueuesAppViewsRenderer:i,LPC:a}})(n,t);return(0,Lr.Y)(vG.e,{namespaces:["queues"],loaderRenderer:null,children:(0,Lr.Y)(a,{children:(0,Lr.Y)(wJ.CA,{children:(0,Lr.Y)(i,{appRenderMode:e})})})})}}}const ele={id:"com.microsoft.teams.public-preview",name:"PublicPreviewApp",supportedEntities:void 0,supportedRenderModes:[se.w.Main]};function tle(e,t){const{coreSettings:n}=t,{publicPreviewOfficeChannels:i}=n.get(c.w.Core,["publicPreviewOfficeChannels"]);return i?.includes(e)}const nle={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsPublicPreviewTeamsInsiderLifeOptInMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"optDecision"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"OptDecision"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamsInsiderSwitchStatus"},arguments:[{kind:"Argument",name:{kind:"Name",value:"optDecision"},value:{kind:"Variable",name:{kind:"Name",value:"optDecision"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isInsider"}}]}}]}}]};const ile=({context:{i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h}})=>{const v=[],{enablePublicPreviewTACSettings:y}=t.get(c.w.Core),{ring:S}=t.get(c.w.Metadata,["ring"]);return"ring3_6"===S?.id&&l.ecsOverrides.isAssignedRing||y&&v.push(function(e){const{coreSettings:t,hostCommunicationService:n,scenarioFactory:i}=e;return{id:"public-preview-policy-job",runOncePerId:!0,job:async()=>{const a=i.newScenario(be.Cu.PublicPreviewPolicyJob);a.mark(be.Cu.PublicPreviewPolicyJob);const o=await n.loadModule("publicpreview");if(!o)return void a.fail({reason:"Could not get hostComms"});const{allowPublicPreview:r}=t.get(c.w.Core,["allowPublicPreview"]),{ring:s}=t.get(c.w.Metadata,["ring"]);switch(a.appendEventData({publicPreviewPolicy:r?.toString(),ring:s?.id?.toString()}),r){case"Forced":if("general"===s?.id){if(await(o.setNextLaunchIsPublicPreview?.(!0)))return void a.stop({result:"public_preview set to true",reason:"Policy is Forced and ring is general"});a.fail({reason:"No result from setNextLaunchIsPublicPreview"})}else a.stop({result:"public_preview not modified",reason:"Policy is Forced, but ring is not general"});break;case"FollowOfficePreview":if("general"===s?.id){const t=await(o.getOfficePreviewChannel?.());return a.appendEventData({officePreviewChannel:t}),t?tle(t,e)?await(o.setNextLaunchIsPublicPreview?.(!0))?void a.stop({result:"public_preview set to true",reason:"Policy is FollowOfficePreview and officeChannel is a preview channel"}):void a.fail({reason:"No result from setNextLaunchIsPublicPreview"}):void a.stop({result:"public_preview not modified",reason:"Policy is FollowOfficePreview, ring is general, but officeChannel is not a preview channel"}):void a.fail({reason:"No result from getOfficePreviewChannel"})}if("ring3_6"===s?.id){const t=await(o.getOfficePreviewChannel?.());return a.appendEventData({officePreviewChannel:t}),t?tle(t,e)?void a.stop({result:"public_preview not modified",reason:"Policy is FollowOfficePreview and officeChannel is a preview channel, but ring is already ring3_6"}):await(o.setNextLaunchIsPublicPreview?.(!1))?void a.stop({result:"public_preview set to false",reason:"Policy is FollowOfficePreview and officeChannel is not a preview channel"}):void a.fail({reason:"No result from setNextLaunchIsPublicPreview"}):void a.fail({reason:"No result from getOfficePreviewChannel"})}a.stop({result:"public_preview not modified",reason:"Policy is FollowOfficePreview, but ring is not ring3_6 or general"});break;case"Enabled":a.stop({result:"public_preview not modified",reason:"Policy is Enabled, so public_preview can be set by the user via the UI element"});break;case"Disabled":if("ring3_6"===s?.id){if(await(o.setNextLaunchIsPublicPreview?.(!1)))return void a.stop({result:"public_preview set to false",reason:"Policy is Disabled, and user is in ring3_6"});a.fail({reason:"No result from setNextLaunchIsPublicPreview"})}else a.stop({result:"public_preview not modified",reason:"Policy is Disabled, but user is not in ring3_6"});break;default:a.stop({result:"public_preview not modified",reason:`allowPublicPreview value is an unknown value: ${r}`})}}}}({i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h})),v},ale=({context:{i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v}})=>{const y=[],{enableInsiderMigration:S}=t.get(c.w.TeamsInsider);return S&&y.push(function(e){const{client:t,hostCommunicationService:n,scenarioFactory:i}=e;return{id:"create-teams-insider-life-local-setting-migration-job",runOncePerId:!0,job:async()=>{const e=i.newScenario(be.Cu.TeamsInsiderSettingMigrationJob);e.mark(be.Cu.TeamsInsiderSettingMigrationJob);const a=await n.loadModule("publicpreview");a?await(a?.getNextLaunchIsPublicPreview?.())?(t.mutate({mutation:nle,variables:{optDecision:"optIn"},fetchPolicy:"no-cache"}),e.stop({reason:"Teams Insider Life Opting Into program mutation complete."})):e.cancel({reason:"User isn't registered to the Insider program."}):e.fail({reason:"Could not get hostComms"})}}}({i18n:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:d,entityCommanding:u,config:m,clientState:p,rebootService:g,userTrackingService:h,authenticationUser:v})),y};const ole=()=>null,rle={onEventReceived:({eventInput:e})=>{if(e.event.type===uq.mu.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:vq(t)})}return Promise.resolve(void 0)}},sle=()=>Promise.all([n.e(34804),n.e(67449),n.e(198245),n.e(736046),n.e(441253),n.e(420774)]).then(n.bind(n,952725)),lle=e=>({id:"search-data-load",runOncePerId:!0,job:async()=>{const t=e.newLogger("dataResolverSearchJob","apps-search");t.log("[dataResolversSearchJob] Initializing calling service");try{await(0,ev.wg)(sle,"search-data-resolvers")}catch(e){t.error("[dataResolversSearch] Error initializing bundle")}t.log("[dataResolversSearch] Calling service initialized")}}),cle=({context:{loggerFactory:e}})=>[lle(e)];var dle=n(854410),ule=n(48399);const mle=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(459959),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(501156),n.e(729849),n.e(484331),n.e(960122),n.e(306517),n.e(964401),n.e(231020),n.e(405198),n.e(568721),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(697027),n.e(567830),n.e(178249),n.e(116447),n.e(194894),n.e(915633),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(46438),n.e(280759),n.e(145619),n.e(847573),n.e(380285),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(641675),n.e(692492),n.e(854047),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(354884),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(568202),n.e(746071),n.e(571498),n.e(876965),n.e(542831),n.e(969261)]).then(n.bind(n,449813)),ple=()=>Promise.all([n.e(736046),n.e(344332)]).then(n.bind(n,868709)),gle="backButton",hle="search-app",vle=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},command:{stateTransition:a}},requestContext:o}=e,{client:r,coreSettings:s}=o,{enablePretriggerImprovement:l,enableAnswersV2:d,layoutRetentionTime:u}=s.get(c.w.Serp),m=t.entityOptions||{},p=m.loadBundle,g=m.substrateSearchWarmUpInExpRenderer;if(n===ke.ck.search&&i===ke.SY.view&&p)return await async function(e,t){t?(0,ev.wg)(ule.Am,"search-answer-v2"):(0,ev.wg)(dle.Iw,"search-answer");yle(e)}(o,!!d),Promise.resolve(void 0);if(n===ke.ck.search&&i===ke.SY.view&&g){const{enableSerpServiceWarmupOnPowerBarClick:e}=s.get(c.w.Serp);if(e)await yle(o);else{const{searchWarmup:e}=await(0,ev.wg)(mle,hle);await r.query({query:e,variables:{scenario:"powerbar",cvid:m.conversationId}})}return Promise.resolve(void 0)}if(l&&n===ke.ck.search&&i===ke.SY.view&&"flush"===a&&"TabSwitch"!==m.entrySource&&"MainSlot"!==m.entrySource){const{searchQuery:e,logicalId:t,conversationId:n,entrySource:i,navLocationContext:a,currentTab:o,filterSet:l}=m,{enableNavLocationContext:d}=s.get(c.w.Serp),p=i===gle,{searchServiceCache:g,Tabs:h}=await(0,ev.wg)(ple,"services-io-search"),v=g.getSearchResultLayout();g.clearAll(),v?.layoutSetTimestamp&&Date.now()-v.layoutSetTimestamp<=(u??3e5)&&g.setSearchResultLayout(v.layout,v.layoutSetTimestamp),d&&a&&g.setNavLocationContext(a);const y=(0,E.v4)(),S=(0,E.v4)();g.setUpstreamTelmetryIds(y,S);const{searchPreTriggerQuery:f,numberOfAllPageResults:k}=await(0,ev.wg)(mle,hle);await r.query({query:f,variables:{searchTerm:e,noOfResults:k,pageNumber:0,correlationId:y,allFilters:l?l[h.All]:{},messageFilters:l?l[h.Messages]:{},searchStartCorrelationId:S,currentTab:o,isBackButton:p,conversationId:n,logicalId:t,entrySource:i,isFromRefinerClick:!1}})}return Promise.resolve(t)};async function yle(e){const{client:t,coreSettings:n}=e,{enableSerpServiceToPrewarm:i}=n.get(c.w.Serp),{pingSearch:a}=await(0,ev.wg)(mle,hle);i&&await t.mutate({mutation:a,variables:{correlationId:(0,E.v4)()}})}const Sle=({appRenderMode:e})=>{const t=new qz.D,n=[],i=[];if(e===se.w.Main)fle({featureFlags:{},criticalSignals:n,postCriticalSignals:i});return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:1e4}),t.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:i,timeout:1e4}),t.appPhases},fle=({criticalSignals:e})=>{e.push(Gz.m.SEARCH_RESULTS_RENDERED)},kle=e=>{if(Cle(e))return ble(e)?{subNavEntity:wle(e),headerEntity:Tle(e),startEntity:Ile(e),mainEntity:Nle(e),endEntity:Ale(e)}:null},Cle=({contextEntity:e,entity:t,layoutMode:n})=>{const{action:i=null,type:a}={...t},o=[Yt.Rm.focus,Yt.Rm.standard].includes(n),r=[ke.ck.search,ke.ck.openfeedbackdialog].includes(a),s=[ke.SY.default,ke.SY.view],l=i&&s.includes(i),c=e&&e.action&&e.type===ke.ck.chats;return!(!o||!r||!l&&!c)},ble=()=>!0,wle=()=>null,Tle=({entity:e,contextEntity:t,coreSettings:n})=>{const i=n?.get(c.w.Serp).enableTabsInHeaderSlot;return t&&t.action&&t.type===ke.ck.chats?t:i?e:null},Ile=()=>null,Nle=({entity:e,contextEntity:t})=>t&&t.action&&t.type===ke.ck.chats?t:e,Ale=()=>null,Ele={id:"com.microsoft.teams.search",name:"Search",getLocalizedName:async e=>(await e.waitForNamespace("search"),e.stringTranslate("search","search_app_name")),supportedEntities:[ke.ck.search,ke.ck.openfeedbackdialog,ke.ck.searchmodal],supportedRenderModes:[se.w.Main,se.w.Modal,se.w.HorizontalBar],windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3}},Fle={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSearchFloodgateLogActivityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activityName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"increment"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateLogActivity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activityName"},value:{kind:"Variable",name:{kind:"Name",value:"activityName"}}},{kind:"Argument",name:{kind:"Name",value:"increment"},value:{kind:"Variable",name:{kind:"Name",value:"increment"}}}]}]}}]};class _le extends xp{constructor(){super(d.c1.LogActivityTask,["client","hostCommunicationService","coreSettings","loggerFactory"])}async execute(e){const{client:t,hostCommunicationService:n,coreSettings:i,loggerFactory:a}=e,o=i?.get(c.w.Serp).enableAutosuggestFps||!1,r=i?.get(c.w.SurveyForm).enableCsatTaskRegistration;if(o&&!r){const e=await(n?.loadModule("search")),i=a.newLogger("LogActivityTaskRegistered","apps-search");e?.registerForLogActivity?.((e=>{i.log(`activity ${e.activityName} and increment ${e.incrementValue}`),"teamsSearchFps"===e.activityName&&(e=>{e.mutate({mutation:Fle,variables:{activityName:"teamsSearchFps",increment:1}})})(t)}))}}}var Dle=n(502249);const Ple=(e,t,n)=>{const{userPreferences:i,coreSettings:a,layoutMode:o}=t,r=e?.mainEntity,s=JSON.parse(r?.options||"{}"),l=n?.mainEntity,d=JSON.parse(l?.options||"{}"),u=a?.get(c.w.Serp)?.enableBackButtonFixForTabSwitch,m=a?.get(c.w.Serp)?.enableTabsInHeaderSlot;if(!(m||u&&r))return;!m&&u&&Dle.m.clear();const p=!n;let g={...d?.filterSet};p&&(g={...s?.filterSet});const h=JSON.stringify({...JSON.parse(r?.options||"{}"),entrySource:gle,filterSet:g});return kle({contextEntity:null,coreSettings:a,entity:{...r,options:h,id:r?.id},layoutMode:o,userPreferences:i})},Mle=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(459959),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(501156),n.e(729849),n.e(484331),n.e(960122),n.e(306517),n.e(964401),n.e(231020),n.e(405198),n.e(568721),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(697027),n.e(567830),n.e(178249),n.e(116447),n.e(194894),n.e(915633),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(46438),n.e(280759),n.e(145619),n.e(847573),n.e(380285),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(641675),n.e(692492),n.e(854047),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(354884),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(568202),n.e(746071),n.e(571498),n.e(876965),n.e(542831),n.e(969261)]).then(n.bind(n,449813)),Rle=()=>Promise.all([n.e(912845),n.e(953696),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(311914),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(459959),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(501156),n.e(729849),n.e(484331),n.e(960122),n.e(306517),n.e(964401),n.e(231020),n.e(405198),n.e(568721),n.e(524147),n.e(258832),n.e(431784),n.e(964859),n.e(475896),n.e(697027),n.e(567830),n.e(178249),n.e(116447),n.e(194894),n.e(915633),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(46438),n.e(280759),n.e(145619),n.e(847573),n.e(380285),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(641675),n.e(692492),n.e(854047),n.e(524014),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(428410),n.e(53131),n.e(478723),n.e(679354),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(354884),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(568202),n.e(746071),n.e(571498),n.e(876965),n.e(542831),n.e(969261)]).then(n.bind(n,819867)),xle=()=>n.e(739586).then(n.bind(n,854210)),Lle=()=>Ele.windowFeatures||{};function Ole(){const e=()=>null;return{eventHandlers:rle,getAppPhases:Sle,onRegister:e=>{e.registerTask(new rh),e.registerTask(new _le)},getAppViewEntities:kle,getAppWindowFeatures:Lle,manifest:Ele,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a,loggerFactory:o})=>{const r="search-app";i("ChunkLoadStarted",{chunkName:r});const{SearchViewsRenderer:s,SearchHeaderRenderer:l}=await(0,ev.wg)(Mle,r);switch(i("ChunkLoadSucceeded",{chunkName:r}),t){case se.w.Main:{const{enableEntityMoreInfo:e}=n.get(c.w.Core),t=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),{LPC:i}=e?{LPC:t}:await(0,ev.wg)(Rle,r),a=e?t:wJ.CA,o="search";return(0,Lr.Y)(vG.e,{namespace:"messaging",loaderRenderer:null,children:(0,Lr.Y)(i,{appName:o,children:(0,Lr.Y)(a,{children:(0,Lr.Y)(s,{})})})})}case se.w.Modal:{const e="feedback-renderer",t=o.newLogger(e,"apps-search");try{i("ChunkLoadStarted",{chunkName:e});const{FeedbackDialog:t}=await(0,ev.wg)(xle,e,a);return i("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(t,{})}catch(e){t.error(`chunk load failed with ${e}`)}}case se.w.HorizontalBar:{const{enableTabsInHeaderSlot:t}=n.get(c.w.Serp);return t?(0,Lr.Y)(vG.e,{namespace:"search",loaderRenderer:null,children:(0,Lr.Y)(l,{})}):(0,Lr.Y)(e,{})}default:return(0,Lr.Y)(e,{})}},onPreWarm:cle,onBeforeCommandHandled:vle,onBeforeNavigationFromHistory:Ple}}const jle={id:"com.microsoft.teams.sensitivity-update",name:"SensitivityUpdateApp",supportedEntities:[ke.ck.sensitivityupdate],supportedRenderModes:[se.w.Main]},Ble=e=>{if(Ule(e))return $le(e)?{subNavEntity:Wle(e),headerEntity:Vle(e),startEntity:Hle(e),mainEntity:zle(e),endEntity:qle(e)}:null},Ule=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.sensitivityupdate].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},$le=()=>!0,Wle=()=>null,Vle=()=>null,Hle=()=>null,zle=({entity:e})=>e,qle=()=>null;var Gle,Yle;!function(e){e.NoEventId="Parsed sensitivityupdate deep link does not contain the event id",e.FeatureNotEnabled="Feature for parsing sensitivityupdate deep links in T2.1 is not enabled"}(Gle||(Gle={})),function(e){e.EventId="eventId",e.CurrentLabel="currentLabel",e.NewLabel="newLabel",e.SensitiveResourceLocation="sensitiveResourceLocation",e.ResourceId="resourceId",e.ResourceType="resourceType"}(Yle||(Yle={}));const Qle=[{filter:"/l/sensitivity-update",execute:({deeplinkUrl:e,parsedDeeplinkHash:t,context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("SensitivityUpdateApp onBeforeDeeplinkParsed","apps-sensitivity-update"),{enableSensitivityLabelUpdateApp:o}=n.get(c.w.SensitivityUpdate);if(!o)return a.errorToTelemetry?.(Gle.FeatureNotEnabled,"sensitivityupdate_on_before_deep_link_parsed_feature_not_enabled_error"),Promise.resolve(void 0);let r,s,l,d,u,m;if(t?.search){const{search:e}=t;r=e.eventId,s=e.currentLabel,l=e.newLabel,d=e.sensitiveResourceLocation,u=e.resourceId,m=e.resourceType}else{const{search:t}=e,n=new URLSearchParams(t);r=n.get(Yle.EventId)||void 0,s=n.get(Yle.CurrentLabel)||void 0,l=n.get(Yle.NewLabel)||void 0,d=n.get(Yle.SensitiveResourceLocation)||void 0,u=n.get(Yle.ResourceId)||void 0,m=n.get(Yle.ResourceType)||void 0}if(r)return Promise.resolve({entityCommand:{entity:{type:ke.ck.sensitivityupdate,action:ke.SY.view,id:r},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entityOptions:{navCtx:FQ._3.DEEP_LINK,eventId:r,currentLabel:s,newLabel:l,sensitiveResourceLocation:d,resourceId:u,resourceType:m}},metadata:{allowAnonymous:!1}});throw a.errorToTelemetry?.(Gle.NoEventId,"sensitivityupdate_on_before_deep_link_parsed_no_event_id_error"),new Error(Gle.NoEventId)}}],Jle=()=>Promise.all([n.e(978582),n.e(351833)]).then(n.bind(n,510372));function Kle(){const e=()=>null;return{manifest:jle,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){const e="sensitivity-update-app";n("ChunkLoadStarted",{chunkName:e});const{SensitivityUpdateAppViewsRenderer:a}=await(0,ev.wg)(Jle,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(a,{appRenderMode:t})}return(0,Lr.Y)(e,{})},getAppViewEntities:Ble,onBeforeDeeplinkParsed:Qle}}const Zle=e=>{if(Xle(e))return ece(e)?{subNavEntity:tce(e),headerEntity:nce(e),startEntity:ice(e),mainEntity:ace(e),endEntity:oce(e)}:null},Xle=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.settingsstore,ke.ck.settingsstorecallqueue,ke.ck.settingsstoredelegator].includes(i),r=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},ece=()=>!0,tce=({entity:e})=>e,nce=({entity:e})=>e,ice=()=>null,ace=({entity:e})=>e,oce=()=>null,rce=({areEmptySlotsTransparent:e,coreSettings:t})=>{const{enableMercuryDesign:n}=t?.get(c.w.MercuryDesign)||{};return!!t?.get(c.w.Core).enableTransparentLeftRail||e||!(e=>{const{leftRailDefaultBackgroundMicaDisabled:t}=e?.get(c.w.Core)??{},{deviceInfo:n}=e?.get(c.w.Platform)??{},i=n&&(0,H$.D)(n);return!!t||!!i})(t)&&!!n},sce=({areEmptySlotsTransparent:e,coreSettings:t})=>{const n=(({coreSettings:e})=>{const t={isColorSchemeDefaultBackground1:Boolean(e?.get(c.w.MercuryDesign)?.enableMercuryShell2_5)};return{headerEntity:{[se.w.HorizontalBar]:{...t}},mainEntity:{[se.w.Main]:{...t}}}})({coreSettings:t});return{...n,subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:rce({areEmptySlotsTransparent:e,coreSettings:t}),isColorSchemeDefaultBackground3:!e,isWideSubNav:!!t?.get(c.w.MercuryDesign).enableMercuryDesign}}}},lce={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"connectedAccountStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"connectedAccountStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorState"}},{kind:"Field",name:{kind:"Name",value:"source"}}]}}]}}]};const cce={id:"com.microsoft.teams.settings",name:"Settings",actors:[m7],supportedEntities:[ke.ck.settingsstore,ke.ck.settingsstorecallqueue,ke.ck.settingsstoredelegator,ke.ck.localizationsettings,ke.ck.deletecontact],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail,se.w.Modal],getDefaultCommand:()=>({action:ke.SY.default,type:ke.ck.settingsstore})};var dce=n(36252),uce=n(789334),mce=n(906937),pce=n(860709),gce=n(494180),hce=n(291555);const vce="APPS_SETTINGS_ERROR_CLEANUP",yce=async e=>{const{client:t,coreSettings:n,scenarioFactory:i,loggerFactory:a}=e,{enableContactsSync:o}=n.get(c.w.People),r=i.newScenario(be.Cu.ConnectedCalendarCleanup),s=a.newLogger("[ConnectedCalendar-Cleanup]","apps-settings"),l=await Sce(t,s,r),d=l?.find((e=>e.isSyncAllowed));if(d){const e=await fce(t,!!o,s,r),{accountAddress:n,accountId:i,source:a}=d,l=await Cce(t,n,s,r);let c=!1;if(e){const n=[],i=e.find((e=>"Google"===e.source));if(i){const e={...i,isSyncAllowed:!1};n.push(e),c=await bce(t,n,s,r)}}const u=await kce(t,i,n,a,s,r);return r.stop(),u&&l&&c}return r.fail({errors:`${vce} connected calendar information is not found `}),!1},Sce=async(e,t,n)=>{try{const{data:t}=await e.query({query:hce.V,fetchPolicy:"network-only",variables:{callerInfo:vce}});return t.syncConnectedCalendarSettings}catch(e){t.log(`${vce} Sync Connected Calendar Settings: ${e}`),n.fail({errors:`${vce} Sync Connected Calendar Settings Failed! `})}},fce=async(e,t,n,i)=>{try{const{data:n}=await e.query({query:uce.n,fetchPolicy:"network-only",variables:{isContactsSyncEnabled:t,callerInfo:vce},notifyOnNetworkStatusChange:!0});return n.contactsSyncSettings}catch(e){return n.log(`${vce} Get Contacts Sync Settings: ${e}`),void i.fail({errors:`${vce} Get Contacts Sync Settings Failed! `})}},kce=async(e,t,n,i,a,o)=>{try{await e.mutate({mutation:mce.z,fetchPolicy:"no-cache",variables:{accountId:t,callerInfo:vce,accountAddress:n,provider:i}})}catch(e){return a.log(`${vce} Hard Delete External Account: ${e}`),o.fail({errors:`${vce} Hard Delete External Account Failed! `}),!1}return!0},Cce=async(e,t,n,i)=>{try{e.mutate({mutation:pce.G,fetchPolicy:"no-cache",variables:{mailboxAddress:t}})}catch(e){return n.log(`${vce} Delete Calendar Events Cache: ${e}`),i.fail({errors:`${vce} Delete Calendar Events Cache Failed! `}),!1}return!0},bce=async(e,t,n,i)=>{try{e.mutate({mutation:gce.E,fetchPolicy:"no-cache",variables:{callerInfo:vce,syncSettings:t}})}catch(e){return n.log(`${vce} Publish Contacts Sync Settings: ${e}`),i.fail({errors:`${vce} Publish Contacts Sync Settings Failed! `}),!1}return!0};var wce=n(811478);const Tce=async e=>{const{entityCommand:t,entityCommand:{entity:{id:n,type:i,action:a},command:{correlation:{source:o}}},requestContext:r}=e;if(o===A.p.CalendarSyncBanner&&n===aK.G.Calendar&&i===ke.ck.settingsstore&&a===ke.SY.view){const{client:e,coreSettings:n,scenarioFactory:i,loggerFactory:a}=r,o={client:e,coreSettings:n,scenarioFactory:i,loggerFactory:a};try{await yce(o)}catch(e){}const s=t.entityOptions||{};return s.callerInfo="CalendarSyncBanner",s.callerParam={isCalendarConnected:!1,source:dce.nx.Google,accountId:"",accountAddress:""},t.entityOptions=s,Promise.resolve(t)}if(i===ke.ck.localizationsettings&&(a===ke.SY.enable||a===ke.SY.disable)){const e=a===ke.SY.enable,{client:t,rebootService:n,loggerFactory:i}=r,o=i.newLogger("OnBeforeCommandHandledLocaleSync","apps-settings");try{await t.mutate({mutation:wce.U,variables:{newSyncWithMSAccount:e,saveCurrentlyDisplayedLanguage:!e}}),e&&n&&n.rebootApp(jp.g.LanguageSwitch,jp.Z.AccountLocaleChangeNotificationBanner)}catch(e){const t=e?.code||"unknown";o.error("Error occurred while updating the locale synchronization with MSA / AAD account and restarting the app. Error code: ",t)}}return Promise.resolve(t)},Ice={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"calendarSyncStateUpdates"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventNames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CalendarSyncStatusEnum"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"calendarSyncStateUpdates"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventNames"},value:{kind:"Variable",name:{kind:"Name",value:"eventNames"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"eventName"}},{kind:"Field",name:{kind:"Name",value:"payload"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CalendarSyncPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}},{kind:"Field",name:{kind:"Name",value:"mailboxAddress"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ConnectedCalendarSyncPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}},{kind:"Field",name:{kind:"Name",value:"mailboxAddress"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}}]}}]}}]},Nce=["CONNECTED_CALENDAR_SYNCING","CONNECTED_CALENDAR_SYNC_FAILED","CONNECTED_CALENDAR_UPTO_DATE"];var Ace=n(932496);const Ece={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsSettingsSyncUnifiedCalendarSyncStateSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syncUnifiedCalendarSyncState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syncState"}},{kind:"Field",name:{kind:"Name",value:"payload"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}}]}}]}}]}}]};var Fce=n(995316),_ce=n(609476),Dce=n(380771);const Pce={onEventReceived:async({eventInput:e,requestContext:t})=>{const{event:{data:n,originator:i,type:a}}=e,o=(0,Un.z)(),{client:r,coreSettings:s,loggerFactory:l,userBiService:{recordPanelAction:d}}=t,u=l.newLogger(`SettingsApp[onEventReceived] - ${i}`,"apps-settings");if(i===_ce.c){switch(a){case _ce.N.handleTenantVisibility:if(n){const{homeAccountId:e,tenantId:t,isTenantHidden:i,dataBag:a}=n();(0,Dce.Kv)({userHomeAccountId:e,isTenantHidden:i,client:r,recordPanelAction:d,dataBag:a,tenantId:t})}else u.warn(`Event from originator '${i}', no data for event type '${a}'.`);break;case _ce.N.manageAccount:if(n){const{emailPhone:e,accountUrlPrefix:t,loginHint:i}=n(),{disableManageAccountUrlByCloud:a}=s.get(c.w.Auth,["disableManageAccountUrlByCloud"]);(0,Dce.w8)({recordPanelAction:d,emailPhone:e,accountUrlPrefix:t,loginHint:i,disableManageAccountUrlByCloud:!!a,host:o})}else u.warn(`Event from originator '${i}', no data for event type '${a}'.`);break;case _ce.N.tenantInvitationAccept:if(n){const{userId:e,cloud:t,dataBag:i}=n();return(0,Dce.Vu)({userId:e,recordPanelAction:d,cloud:t,dataBag:i}),Promise.resolve({command:Fne(e)})}u.warn(`Event from originator '${i}', no data for event type '${a}'.`);break;case _ce.N.tenantInvitationDecline:if(n){const{tenantName:e,tenantId:t,isInvitationRedeemed:i,homeAccountId:a,userId:o,cloud:s,dataBag:l,declineSuccessText:c,declineFailureText:u}=n();let m;if(await(0,Dce.jv)({recordPanelAction:d,showToast:e=>{m={title:e.title,intent:e.intent,dismissOnAction:!0}},client:r,declineSuccessText:c,declineFailureText:u,tenantName:e,tenantId:t,isInvitationRedeemed:i,homeAccountId:a,userId:o,cloud:s,dataBag:l}),m)return Promise.resolve({command:c2(m)})}else u.warn(`Event from originator '${i}', no data for event type '${a}'.`);break;case _ce.N.tenantsLeaveOrg:if(n){const{emailPhone:e,tenantId:t,leaveOrgUrl:i,dataBag:a}=n();(0,Dce.P$)({recordPanelAction:d,emailPhone:e,tenantId:t,leaveOrgUrl:i,host:o,dataBag:a})}else u.warn(`Event from originator '${i}', no data for event type '${a}'.`);break;case _ce.N.tenantsUpdate:if(n){const{userHomeAccountId:e,tenantId:t,isTenantHidden:i,dataBag:a}=n();(0,Dce.Ae)({userHomeAccountId:e,tenantId:t,isTenantHidden:i,dataBag:a,client:r,recordPanelAction:d})}else u.warn(`Event from originator '${i}', no data for event type '${a}'.`);break;default:u.warn(`Event ${a} from originator '${i}' cannot be handled by AppsSettings app.`)}return Promise.resolve(void 0)}switch(a){case uq.mu.requestPersonMoreInfo:const e=n?.();return Promise.resolve({command:vq(e)});case y7.mu.changeAppTheme:const t=n?.();return Promise.resolve({command:v7(t)});case Fce.z.SwitchBackSurveySimpleCollab:const i=n?.();return Promise.resolve({command:fd({commandSource:i?.commandSource??A.p.SimpleCollabSwitchButton,surveyId:i?.surveyId??"simpleCollabAppSwitcher"})});case Fce.z.SwitchOffSimpleCollabConfirmation:const a=n?.();return Promise.resolve({command:vd({commandSource:a?.commandSource})})}return u.warn(`Event ${a} from originator '${i}' cannot be handled.`),Promise.resolve(void 0)}};var Mce=n(667279),Rce=n(794171);const xce={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSettingsUpdateThemeSettingsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ClientPreferencesInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateClientPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"theme"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"userTheme"}},{kind:"Field",name:{kind:"Name",value:"followOsTheme"}},{kind:"Field",name:{kind:"Name",value:"isClassicTheme"}},{kind:"Field",name:{kind:"Name",value:"isCallingWindowDarkTheme"}}]}}]}}]}}]},Lce="settings_on_command_received",Oce=async({commandInput:e,requestContext:{client:t,loggerFactory:n}})=>{const{command:{action:i,data:a}}=e,o=n.newLogger("SettingsApp[onCommandReceived]","apps-settings");if(e.command.actor===m7){switch(i){case p7:return Promise.resolve({entity:{type:ke.ck.settingsstore,action:ke.SY.view,id:Mce.M.OOFSettingsPage},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.ScheduleOOFFromMeMenu}}});case h7:return a?(async(e,t)=>{const{theme:n,isCallingWindowDarkTheme:i}=t,a="OSTheme"===n,o="Classic"===n;let r;if(!a)if(o)r=Rce.SV.Light;else switch(n){case"Dark":r=Rce.SV.Dark;break;case"Light":default:r=Rce.SV.Light;break;case"Contrast":r=Rce.SV.Contrast}await e.mutate({mutation:xce,variables:{value:{theme:{userTheme:r,followOsTheme:a,isClassicTheme:o,isCallingWindowDarkTheme:i}}}})})(t,a).then((()=>{})):(jce(o,i),Promise.resolve(void 0));default:o.errorToTelemetry?.(`Command action '${i}' is not supported by SettingsApp.`,Lce)}return Promise.resolve(void 0)}o.errorToTelemetry?.(`Command for actor '${e.command.actor}' cannot be handled by SettingsApp.`,Lce)},jce=(e,t)=>{e.errorToTelemetry?.(`Command action '${t}' has no data.`,Lce)},Bce=(e,t,n)=>(0,Pj.Kw)(e,t,n);function Uce(e){const{coreSettings:t,hostCommunicationService:n,loggerFactory:i}=e;return{id:"m365-links-set-policy-value-job",job:async()=>{const e=i.newLogger("M365LinksPolicyJob","apps-settings"),a=await n.loadModule("m365link");if(!a)return void e.errorToTelemetry?.("Could not get hostComms","settings_m365_links_policy_job");const o=t.getObservable(c.w.Files,["teamsLinkBrowserPreferencePolicy"]).subscribe((async({teamsLinkBrowserPreferencePolicy:t})=>{switch(t){case 0:e.log("Setting M365 links policy to default browser"),await(a.setM365LinksPolicy?.(0));break;case 1:e.log("Setting M365 links policy to Microsoft Edge"),await(a.setM365LinksPolicy?.(1));break;default:return e.log("No M365 links policy value. Setting M365 links policy to undefined"),void await(a.setM365LinksPolicy?.(void 0))}}));return()=>o.unsubscribe()}}}const $ce="account-locale-change-notification-banner";const Wce=e=>{e.shell.dismissBanner($ce,A.p.AccountLocaleChangeNotificationJob)},Vce=(e,t)=>{e.shell.showBanner({id:$ce,source:A.p.AccountLocaleChangeNotificationJob,intentLevel:"Neutral",text:t.stringTranslate("framework","account_locale_change_notification_banner_text"),action:{text:t.stringTranslate("framework","account_locale_change_notification_banner_apply_button"),command:{entity:{id:aK.G.Localization,type:ke.ck.localizationsettings,action:ke.SY.enable},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:A.p.AccountLocaleChangeNotificationJob}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"account_locale_change_notification",dismissActionCommand:{entity:{id:aK.G.Localization,type:ke.ck.localizationsettings,action:ke.SY.disable},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.none,correlation:{source:A.p.AccountLocaleChangeNotificationJob}}}})},Hce=(e,t,n,i)=>{const{accountLocaleCode:a}=(0,pO.TJ)(t),o=e?.toLowerCase(),r=a!==o,s=o!==n.locale;return r&&i.log(`Account locale has changed: new account locale = ${o}; previous account locale = ${a}; i18n.locale: ${n.locale}.`),r&&s},zce=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(120951),n.e(984552),n.e(169767),n.e(787454),n.e(181316),n.e(669152),n.e(842242),n.e(984165),n.e(185332),n.e(255544),n.e(325670),n.e(729849),n.e(960122),n.e(231020),n.e(811751),n.e(568721),n.e(964859),n.e(698386),n.e(102216),n.e(289657),n.e(92198),n.e(909600),n.e(293328),n.e(187739),n.e(566555),n.e(737305),n.e(785043),n.e(980261),n.e(317183),n.e(461369),n.e(251639),n.e(843675),n.e(16570),n.e(50150),n.e(153409),n.e(988454),n.e(810658),n.e(307422),n.e(94139),n.e(712284),n.e(485986),n.e(422790),n.e(837284),n.e(237780),n.e(6419),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(715192),n.e(331703),n.e(936254),n.e(684694),n.e(813370),n.e(311576),n.e(736704),n.e(688782),n.e(317910),n.e(461824),n.e(879803),n.e(972591),n.e(929679),n.e(887759),n.e(817372),n.e(295578),n.e(223810),n.e(289102),n.e(119940),n.e(957630),n.e(671182),n.e(269797),n.e(187610),n.e(991043),n.e(998082),n.e(175838),n.e(720453),n.e(969355),n.e(837385),n.e(212366)]).then(n.bind(n,945445)),qce=()=>Promise.all([n.e(461500),n.e(669152),n.e(459959),n.e(459467),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(524014),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(720843)]).then(n.bind(n,819867)),Gce=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e});function Yce(){return{eventHandlers:Pce,getAppViewEntities:Zle,getAppViewEntitiesProps:sce,onBeforeCommandHandled:Tce,manifest:cce,onCommandReceived:Oce,onBeforeUpdateHistoryItem:Bce,onPreWarm:e=>{const{context:t}=e,n=t.coreSettings,{enableSyncStateBanner:i}=n.get(c.w.People),{enableCalendarSyncStateBanner:a,enableUnifiedCalendarEvents:o}=n.get(c.w.Calendar),r=[];if(i&&r.push(function(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o}=e,r=o.newLogger("connected-account-state-subscription-job","apps-settings"),s=n;let l;return{id:"connected-account-state-subscription",job:()=>{try{l=s.subscribe({query:lce}).filter((e=>!!e?.data?.connectedAccountStateEvent?.errorState)).subscribe((async e=>{"ConnectedAccountsSyncError"===e.data.connectedAccountStateEvent.errorState&&i.shell.showBanner({id:"connected-account-state-banner",source:A.p.ContactsSyncBanner,cause:"ConnectedAccountError",intentLevel:"Neutral",text:a.stringTranslate("people","google_sign_in_required"),action:{text:a.stringTranslate("people","go_to_settings"),command:{entity:{type:"settingsstore",action:"view",id:"privacy_manage_contacts_sync"},command:{stateTransition:"flush",visibilityState:"show",correlation:{source:A.p.ContactsSyncBanner}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"connected_account_sync_error"}),t?.()}))}catch(e){const t=`Failed connectedAccountStateEventJob with error: ${e&&e.message}, errorCode ${e&&e.code}`;l.unsubscribe(),r.error(t)}}}}(t)),a){const e=o?function(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o}=e,r=o.newLogger("unified-calendar-sync-state-job","apps-settings");let s;return{id:"unified-calendar-sync-state-job",job:()=>{try{s=n.subscribe({query:Ece,fetchPolicy:"no-cache"}).subscribe((async n=>{const o=n?.data?.syncUnifiedCalendarSyncState?.syncState,r=n?.data?.syncUnifiedCalendarSyncState?.payload;if(o===Ace.D.UNIFIED_CALENDAR_SYNC_FAILED){const t=r?.error?.code;switch(t){case d.O4.ConnectedAccountNotFound:case d.O4.ShadowMailboxDeleted:await yce(e);break;case d.O4.Unauthorized:case d.O4.UnauthorizedAccess:case d.O4.ShadowTokenRevoked:case d.O4.ShadowTokenExpired:case d.O4.ShadowRefreshTokenExpired:i.shell.showBanner({id:"unified-calendar-sync-state-banner",source:A.p.CalendarSyncBanner,cause:"ConnectedAccountError",intentLevel:"Severe",text:a.stringTranslate("calendar","tfl_cc_connect_external_account_banner_error",{provider:"Google"}),action:{text:a.stringTranslate("calendar","tfl_cc_banner_go_to_settings_button_text"),command:{entity:{type:"settingsstore",action:"view",id:aK.G.Calendar},command:{stateTransition:"flush",visibilityState:"show",correlation:{source:A.p.CalendarSyncBanner}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"unified_calendar_sync_error"})}}t?.()}))}catch(e){const t=`Failed createUnifiedCalendarSyncStateJob with error: ${e?.message}, errorCode ${e?.code}`;s.unsubscribe(),r.error(t)}}}}(t):function(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o}=e,r=o.newLogger("connected-calendar-sync-state-job","apps-settings"),s=n;let l;return{id:"connected-calendar-sync-state-job",job:()=>{try{l=s.subscribe({query:Ice,fetchPolicy:"no-cache",variables:{eventNames:Nce}}).subscribe((async n=>{const o=n?.data?.calendarSyncStateUpdates?.eventName,r=n?.data?.calendarSyncStateUpdates?.payload?.error?.code;if("CONNECTED_CALENDAR_SYNC_FAILED"===o)switch(r){case d.O4.ConnectedAccountNotFound:case d.O4.ShadowMailboxDeleted:await yce(e);break;case d.O4.Unauthorized:case d.O4.UnauthorizedAccess:case d.O4.ShadowTokenRevoked:case d.O4.ShadowTokenExpired:case d.O4.ShadowRefreshTokenExpired:i.shell.showBanner({id:"connected-calendar-sync-state-banner",source:A.p.CalendarSyncBanner,cause:"ConnectedAccountError",intentLevel:"Severe",text:a.stringTranslate("calendar","tfl_cc_connect_external_account_banner_error",{provider:"Google"}),action:{text:a.stringTranslate("calendar","tfl_cc_banner_go_to_settings_button_text"),command:{entity:{type:"settingsstore",action:"view",id:aK.G.Calendar},command:{stateTransition:"flush",visibilityState:"show",correlation:{source:A.p.CalendarSyncBanner}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"connected_calendar_sync_error"})}t?.()}))}catch(e){const t=`Failed createConnectedCalendarSyncStateJob with error: ${e?.message}, errorCode ${e?.code}`;l.unsubscribe(),r.error(t)}}}}(t);r.push(e)}return(0,pO.bR)(n)&&r.push(function(e){const{coreSettings:t,entityCommanding:n,i18n:i,localStorage:a,loggerFactory:o,hostCommunicationService:r}=e,{enableLocaleSyncWithMSAccount:s}=t?.get(c.w.Localization),l=s||!1,d=o.newLogger("AccountLocaleChangeNotificationJob","apps-settings"),u=async e=>{if(e)try{Hce(e,a,i,d)?Vce(n,i):Wce(n)}catch(e){const t=e?.code||"unknown";d.error("Error occurred while processing account locale change notification job. Error code: ",t)}};return{id:"account-locale-change-notification-job",job:async()=>{if(l){const e=t?.getObservable(c.w.Localization,["userAccountLocaleCodePolicy"]).subscribe((({userAccountLocaleCodePolicy:e})=>{u(e)}));return()=>{e.unsubscribe()}}const e=await r.loadModule("osutils"),n=await(e?.getUserLocale?.());u(n?.localeName)}}}(t)),r},onUserWindowPreWarm:e=>{const{context:t}=e;return[Uce(t)]},render:async({appRenderMode:e,coreSettings:t,onRenderEvent:n,scenarioFactory:i})=>{const a="settings-app";n("ChunkLoadStarted",{chunkName:a});const{SettingsViewsRenderer:o}=await(0,ev.wg)(zce,a,i),{enableEntityMoreInfo:r}=t.get(c.w.Core),{LPC:s}=r?{LPC:Gce}:await(0,ev.wg)(qce,a,i),l=r?Gce:wJ.CA;return n("ChunkLoadSucceeded",{chunkName:a}),(0,Lr.Y)(s,{children:(0,Lr.Y)(l,{children:(0,Lr.Y)(vG.e,{namespaces:["people","settings"],loaderRenderer:null,children:(0,Lr.Y)(o,{appRenderMode:e})})})})}}}const Qce={getDefaultCommand:()=>({type:ke.ck.email,action:ke.SY.create}),id:"com.microsoft.teams.share-email",name:"ShareEmailApp",supportedEntities:[ke.ck.email],supportedRenderModes:[se.w.Main],windowFeatures:{minWidth:530,width:748,minHeight:490,height:691}},Jce=e=>{if(Kce(e))return Zce(e)?{subNavEntity:Xce(e),headerEntity:ede(e),startEntity:tde(e),mainEntity:nde(e),endEntity:ide(e)}:null},Kce=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.email].includes(i),r=[ke.SY.default,ke.SY.create],s=n&&r.includes(n);return!!(a&&o&&s)},Zce=()=>!0,Xce=()=>null,ede=()=>null,tde=()=>null,nde=({entity:e})=>e,ide=()=>null,ade=({appRenderMode:e})=>{const t=new qz.D,n=[];return e===se.w.Main&&n.push(Gz.m.SHARE_PAGE_RENDERED),t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:2e4}),t.appPhases},ode={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShareEmailSttoInstallMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shareToTeamsInstall"}}]}}]},rde="share_to_teams_installed",sde=({context:{coreSettings:e,localStorage:t,authenticationUser:n,client:i,loggerFactory:a,scenarioFactory:o}})=>{const{enableSttoInstall:r}=e.get(c.w.Outlook),s={id:"share-to-teams-outlook-install",runOncePerId:!0,job:async()=>{if(r){const r=function(e){return e.cancelExistingAndCreateScenario(be.Cu.STTOInstall,"Share to teams Install")}(o),{isOnCloud:s,isMailboxDiscoverable:l}=e.get(c.w.Messaging),d=a.newLogger("ShareToTeamsApp Install","apps-share-email"),u=i,m=t?.get(rde)||!1,p=n?.role===pg.a7.Guest;if(s&&l&&!p&&!m)try{const{data:e}=await u.mutate({mutation:ode});e?.shareToTeamsInstall?(d.log("ShareToTeams install successful"),t?.trySet(rde,"true","Messaging"),r.stop()):(d.log("ShareToTeams install not successful"),r.fail({errors:"ShareToTeams install not successful"}))}catch{d.log("ShareToTeams install mutation unexpectedly failed"),r.fail({errors:"ShareToTeams install mutation unexpectedly failed"})}else d.log("Skipping ShareToTeams install"),r.cancel({reason:"Skipping ShareToTeams install"})}}};return[s]};const lde=({context:{coreSettings:e,localStorage:t,loggerFactory:n}})=>{const{enableChannelLocalCache:i,enableClearTeamsListLocalStorage:a}=e.get(c.w.Search);return[{id:"share-to-teams-clear-teams-list-localstorage",runOncePerId:!0,job:async()=>{if(!i&&a){const e=n.newLogger("ShareToTeamsApp ClearTeamsListLocalStorage","apps-share-email");try{t?.remove("teams-list")}catch{e.warn("Failed to clear teams list localstorage")}}}}]};var cde;!function(e){e.DeepLinkNotEnabled="deeplink-not-enabled-error",e.MissingEmailRestId="missing-emailRestId-error"}(cde||(cde={}));const dde=e=>{try{return JSON.parse(`[${e}]`)}catch{return[]}},ude=(e,t,n)=>{const{emailRestId:i,attachmentSize:a,attachmentCount:o,fileTypes:r,from:s,toRecipients:l,ccRecipients:c,cloudAttachments:d,outlookTid:u,outlookUid:m,outlookSmtpAddress:p}=e;return Promise.resolve({entityCommand:{entity:{type:ke.ck.email,id:i,action:n},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{id:t,startTimestamp:Date.now(),source:A.p.ShareEmail}},entityOptions:{emailRestId:i,correlationId:t,attachmentSize:a,attachmentCount:o,fileTypes:r,from:s,toRecipients:l,ccRecipients:c,cloudAttachments:d,outlookTid:u,outlookUid:m,outlookSmtpAddress:p}},metadata:{allowAnonymous:!1}})},mde=[{filter:"/l/share-email",execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{if(!pde(t))return Promise.reject({message:cde.DeepLinkNotEnabled});const{entityOptions:n,correlationId:i}=(e=>{const{pathname:t,searchParams:n}=e,i=t.split("/"),a=i[i.length-1],o=Number(n.get("attachmentSize"))||0,r=Number(n.get("attachmentCount"))||0,s=n.get("fileTypes")?.split(",")??[],l=n.get("from")??"",c=n.get("toRecipients")?.split(",")??[],d=n.get("ccRecipients")?.split(",")??[],u=n.get("cloudAttachments")??"";return{entityOptions:{emailRestId:a,attachmentSize:o,attachmentCount:r,fileTypes:s,from:l,toRecipients:c,ccRecipients:d,cloudAttachments:dde(u),outlookTid:n.get("tid")??"",outlookUid:n.get("uid")??"",outlookSmtpAddress:n.get("userEmail")??""},correlationId:n.get("correlationId")??""}})(e);return n.emailRestId?ude(n,i,ke.SY.create):Promise.reject({message:cde.MissingEmailRestId})}}],pde=e=>!!e?.get(c.w.Outlook).enableDeepLinkShareEmail,gde=()=>Promise.all([n.e(912845),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(668172),n.e(490329),n.e(725973),n.e(215618),n.e(729849),n.e(475896),n.e(773977),n.e(862449),n.e(57789),n.e(392982),n.e(382218),n.e(367328),n.e(965787),n.e(151748),n.e(370494),n.e(681848),n.e(104215),n.e(625303),n.e(53966),n.e(327091),n.e(331703),n.e(465160),n.e(337595),n.e(361035),n.e(935685),n.e(562773),n.e(657731)]).then(n.bind(n,799804)),hde=e=>{e.registerTask(new rh)},vde=({windowOptions:e})=>e?{height:e.height,left:e.left,top:e.top,width:e.width}:{minHeight:Qce.windowFeatures.height,minWidth:Qce.windowFeatures.width,height:Qce.windowFeatures.height,width:Qce.windowFeatures.width};function yde(){const e=()=>null;return{getAppPhases:ade,getAppViewEntities:Jce,getAppWindowFeatures:vde,manifest:Qce,onBeforeDeeplinkParsed:mde,onRegister:hde,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===se.w.Main){const{ShareFormEmail:e}=await(0,ev.wg)(gde,"share-form-email-entry",n);return(0,Lr.Y)(e,{})}return(0,Lr.Y)(e,{})},onPreWarm:sde,onExperienceLongIdle:lde}}const Sde="/l/fileshare";const fde=[{filter:Sde,execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{if(!kde(t)){const e="share to files is not enabled";return Promise.reject(e)}const{pathname:n,search:i}=e;if(n.startsWith(Sde)){const e=i.split(/[/?&=]/);if(e.length>0){const t=e[e.length-1];return Promise.resolve(function(e){return{entityCommand:{entity:{type:ke.ck.chats,action:ke.SY.share,id:g1.Uv},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{id:(0,E.v4)(),startTimestamp:Date.now(),source:A.p.OSFileShareEvent}},entityOptions:{inviteLinkType:Yn.Vd.FileShare,filesUrl:e}},metadata:{allowAnonymous:!1}}}(t))}}return Promise.reject("No deeplink type found for the specified prefixType")}}],kde=e=>!!e?.get(c.w.WindowsSignatureExperiences).enableShareFilesToTeams,Cde={id:"com.microsoft.teams.share-to-chat",name:"ShareToChatApp",supportedRenderModes:[se.w.Main]};function bde(){const e=()=>null;return{manifest:Cde,render:async()=>(0,Lr.Y)(e,{}),onBeforeDeeplinkParsed:fde}}const wde=e=>{if(Tde(e))return Ide(e)?{subNavEntity:Nde(e),headerEntity:Ade(e),startEntity:Ede(e),mainEntity:Fde(e),endEntity:_de(e)}:null},Tde=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.standard].includes(e),o={[ke.ck.brbfeedbackdialog]:[ke.SY.default,ke.SY.view],[ke.ck.brbmemorysnapshotconsentdialog]:[ke.SY.default,ke.SY.view],[ke.ck.tpndialog]:[ke.SY.default,ke.SY.view],[ke.ck.appswitcherdesktopactivecalldialog]:[ke.SY.default,ke.SY.view],[ke.ck.appswitchert1downloaddialog]:[ke.SY.default,ke.SY.view],[ke.ck.appswitcherwebactivecalldialog]:[ke.SY.default,ke.SY.view],[ke.ck.appswitcherwebmultipletabsdialog]:[ke.SY.default,ke.SY.view],[ke.ck.signoutdialog]:[ke.SY.default,ke.SY.view],[ke.ck.identitydialog]:[ke.SY.create],[ke.ck.joinlinkdialog]:[ke.SY.default,ke.SY.view],[ke.ck.premiumtrialdialog]:[ke.SY.default,ke.SY.view],[ke.ck.premiumtrialdialogesp]:[ke.SY.default,ke.SY.view],[ke.ck.bannerNotification]:[ke.SY.create,ke.SY.delete],[ke.ck.hybridplaceholder]:[ke.SY.default,ke.SY.view],[ke.ck.updatemsaprofileavatardialog]:[ke.SY.default,ke.SY.view],[ke.ck.updatemsaprofilenamedialog]:[ke.SY.default,ke.SY.view],[ke.ck.autobrbconfirmationdialog]:[ke.SY.default,ke.SY.view],[ke.ck.autobrbflowdialog]:[ke.SY.default,ke.SY.view],[ke.ck.pearnotdefaultapp]:[ke.SY.view],[ke.ck.licenserequestdialog]:[ke.SY.view],[ke.ck.vdirestartworkflow]:[ke.SY.default,ke.SY.view],[ke.ck.servicesunavailable]:[ke.SY.update]},r=n&&(o[i]||[]).includes(n);return!(!a||!r)},Ide=()=>!0,Nde=({entity:e})=>e.type===ke.ck.pearnotdefaultapp?null:e,Ade=({entity:e})=>e.type===ke.ck.pearnotdefaultapp?null:e,Ede=({entity:e})=>e.type===ke.ck.pearnotdefaultapp?null:e,Fde=({entity:e})=>e,_de=({entity:e})=>e.type===ke.ck.pearnotdefaultapp?null:e,Dde=({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[se.k.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:e,isColorSchemeDefaultBackground6:!e},[se.k.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e}},headerEntity:{[se.k.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:e,isColorSchemeDefaultBackground6:!e}},startEntity:{[se.k.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:e,isColorSchemeDefaultBackground6:!e}},mainEntity:{[se.k.ThinHorizontalBar]:{isBackgroundTransparent:e||!!t?.get(c.w.MercuryDesign).enableMercuryShell2_5},[se.k.TitleBar]:{isBackgroundTransparent:!0,isTitleBarFoldable:!!t?.get(c.w.MercuryDesign).enableSimpleShell},[se.k.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentAppBar||e,displayNavBorder:!!t?.get(c.w.MercuryDesign).enableMercuryDesign,isColorSchemeDefaultBackground6:!e}},endEntity:{[se.k.Rail]:{isBackgroundTransparent:e}}});var Pde=n(251763);const Mde=({coreSettings:e,userPreferences:t})=>{if(!e?.get(c.w.TeamsAndChannels)?.enableTeamLayoutSetting&&!e?.get(c.w.TeamsAndChannels)?.enableTeamLayoutSettingOverride)return!1;if(e?.get(c.w.Edu)?.enableDogfoodingInEduGridLayout)return!0;switch(t?.teamLayout?.currentLayout){case"grid":return!0;case"list":return!1;default:return e?.get(c.w.TeamsAndChannels)?.defaultTeamLayoutSettingIsGrid}},Rde=(e,t,n)=>{const i=A.p.AppBar;switch(e.tileID){case _m:return{scenarioName:t?.get(c.w.Activity).enableActivitySlices??!1?be.Cu.SliceSwitch:be.Cu.ActivitySwitch,source:i};case Pm:return{scenarioName:be.Cu.CalendarSurfaceLoad,source:i};case Mm:const e=n?.getAllPreferences();if("split"===e?.simpleCollab?.simpleCollabViewType)return{scenarioName:be.Cu.SimpleCollabSwitch,source:i,eventData:{viewType:ke.ck.simplecollabchannels}};return Mde({coreSettings:t,userPreferences:e})?{scenarioName:be.Cu.TeamsGridLoad,source:i}:{scenarioName:be.Cu.ChannelSwitchL1,source:i};case Dm:const a=n?.getAllPreferences();return"split"===a?.simpleCollab?.simpleCollabViewType?{scenarioName:be.Cu.SimpleCollabSwitch,source:i,eventData:{viewType:ke.ck.simplecollabchats}}:{scenarioName:be.Cu.ChatSwitch,source:i};case Rm:return{scenarioName:be.Cu.SimpleCollabSwitch,source:i,eventData:{viewType:ke.ck.simplecollab}};case xm:return{scenarioName:be.Cu.CallsAppSwitch,source:i};case Vm:return{scenarioName:be.Cu.HomepageAppLoad,source:i};case Hm:return{scenarioName:be.Cu.QueuesAppSwitch,source:i};case Bm:return{scenarioName:be.Cu.CommunitiesAppLoad,source:i};default:return{scenarioName:void 0,source:i}}},xde=(e,t,n,i)=>{const a=e.event;switch(a.originator){case Pde.KG:case Pde.k4:return((e,t,n,i)=>{if(!e.data)return void t.error("Received a launch event without data!");const a=e.data(),{enableApbbarTilePosition:o}=n.get(c.w.Core);switch(e.type){case Pde.w7.launch:const r=!!a.reactEvent;if(o&&!r)return;case Pde.w7.install:case Pde.w7.description:return Rde(a,n,i);case Pde.w7.appTileHover:return;default:return void t.warn(`Received an unhandled Launch tile event, type: ${e.type}`)}})(a,t,n,i)}},Lde={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellGetBannerNotificationQueueQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bannerNotificationQueue"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bannerId"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"bannerScenario"}},{kind:"Field",name:{kind:"Name",value:"intentLevel"}},{kind:"Field",name:{kind:"Name",value:"cause"}},{kind:"Field",name:{kind:"Name",value:"debugInfo"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"props"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"linkActions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationAction"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"command"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"action"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"command"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"behavior"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dismissable"}},{kind:"Field",name:{kind:"Name",value:"dismissActionCommand"}},{kind:"Field",name:{kind:"Name",value:"duration"}}]}}]}}]}}]},Ode={MostSevere:0,Live:1,Severe:2,Location:3,Positive:4,Neutral:5},jde=e=>{const{bannerId:t,source:n,bannerScenario:i,intentLevel:a,cause:o,props:{text:r,title:s,linkActions:l,action:c},behavior:d,debugInfo:u,correlationId:m}=e;return{__typename:"BannerNotification",bannerId:t,source:n,bannerScenario:i??null,intentLevel:a,cause:o??null,debugInfo:u??null,correlationId:m??null,props:{__typename:"BannerNotificationProperties",text:r??null,title:s??null,linkActions:l?l.map((e=>({__typename:"NotificationAction",command:e.command,text:e.text??null,dismissOnAction:e.dismissOnAction}))):null,action:c?{__typename:"NotificationAction",command:c.command,text:c.text??null,dismissOnAction:c.dismissOnAction}:null},behavior:{__typename:"BannerNotificationBehavior",dismissable:d?.dismissable??!1,dismissActionCommand:d?.dismissActionCommand??null,duration:d?.duration??0}}},Bde=(e,t)=>{let n=[];try{n=t.readQuery({query:Lde})?.bannerNotificationQueue??[]}catch(t){e.error("Failed to read banner queue from data client cache. ",t)}return n.map(jde)},Ude=(e,t,n)=>{const i={bannerNotificationQueue:n.map(jde)};try{t.writeQuery({query:Lde,data:i})}catch(t){e.error("Failed to write banner queue to data client cache. ",t)}},$de=(e,t,n)=>{let i=Bde(e,t);const a=i.length;i=i.filter((e=>e.bannerId!==n)),a===i.length&&e.errorToTelemetry?.("Banner was dismissed but was not found in the queue.","banner_dismissed_not_found",{reason:n},!0),Ude(e,t,i)},Wde={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellReauthenticateMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reauthenticateUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"success"}}]}}]}}]},Vde=(e,t)=>t.mutate({mutation:Wde})?.then((e=>e.data?.reauthenticateUser?.success)).catch((t=>(e.error("Failed to perform reauthentication. ",t),Promise.resolve(void 0)))),Hde={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellGetToastNotificationQueueQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastNotificationQueue"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"intent"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"body"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"action"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"command"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"duration"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"isBannerToast"}},{kind:"Field",name:{kind:"Name",value:"dismissable"}}]}}]}}]},zde=e=>{return e?{__typename:"ConfirmationToastProperties",action:(t=e.action,t?{__typename:"NotificationAction",command:t.command,text:t.text??null,dismissOnAction:t.dismissOnAction}:null)}:null;var t},qde=e=>{const{id:t,source:n,intent:i,title:a,body:o,duration:r,isBannerToast:s,dismissable:l}=e;return{__typename:"ToastNotification",id:t,intent:i,title:a,body:zde(o??void 0),duration:r??0,source:n,isBannerToast:s??!1,dismissable:l??!0}},Gde=(e,t)=>{let n=[];try{n=t.readQuery({query:Hde})?.toastNotificationQueue??[]}catch(t){e.error("Failed to read toasts queue from data client cache. ",t)}return n.map(qde)},Yde=(e,t,n)=>{const i={toastNotificationQueue:n.map(qde)};try{t.writeQuery({query:Hde,data:i})}catch(t){e.error("Failed to write toast notifications queue to data client cache. ",t)}},Qde=(e,t)=>-1===e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"});function Jde(e,t,n,i){if(t&&e){if(e.toLowerCase().includes("macos"))return n.macOS;if(e.toLowerCase().includes("windows"))switch(!0){case t.includes("x64")||t.includes("amd64")||t.includes("intel64"):return n.x64;case t.includes("x86"):return n.x86;case t.includes("arm64"):return n.arm64;default:i.errorToTelemetry?.(`Unknown cpuarch: ${t}`,"unsupported-version-banner-job",{},!0)}}}function Kde(e,t){const{bannerDisplayBuildAgeThreshold:n,minimumDesktopVersion:i,overrideDesktopMinVersionWithBuildAge:a}=t.get(c.w.Core),{desktopVersion:o}=t.get(c.w.Host),{deviceInfo:r}=t.get(c.w.Platform),s=r?.cpuArchitecture?.toLowerCase(),l=r?.osName?.toLowerCase();return a?function(e,t,n,i,a){if(!e||!t)return void a.log("Desktop client version or build age threshold empty. Desktop version check skipped.");const o=function(e,t,n,i){if(t&&e){if(e.toLowerCase().includes("macos"))return n.macOS;if(e.toLowerCase().includes("windows"))switch(!0){case t.includes("x64")||t.includes("amd64")||t.includes("intel64"):return n.x64;case t.includes("x86"):return n.x86;case t.includes("arm64"):return n.arm64;default:i.errorToTelemetry?.(`Unknown cpuarch: ${t}`,"unsupported-version-banner-job",{},!0)}}}(i,n,t,a);if(a.log(`Build age threshold is ${o}`),void 0===o)return void a.log("Build age could not be determined. Desktop version check skipped.");if(function(e,t,n){if(!e||""===e.trim())return n.log("Unknown version token. Build age calculation skipped."),0;if(!/^[0-9]{5}$/.test(e))return n.log("Invalid package version detected. Build age calculation skipped."),0;if("59999"===e)return n.log("Local build detected, build age is 0"),0;try{const i=parseInt(`20${e.substring(0,2)}`,10),a=5,o=parseInt(`${e.substring(2,a)}`,10),r=new Date(i,1,1),s=864e5,l=Math.floor((t.getTime()-r.getTime())/s)-o,c=l>0?l:0;return n.log(`Current build age is: ${c}`),c}catch(e){return n.log(`Error processing version token: ${e.message}`),0}}(e.split(".")[0],new Date,a)>=o)return a.log("Unsupported desktop version detected."),!0;return!1}(o,n,s,l,e):function(e,t,n,i,a){if(!e||!t)return void a.log("Desktop client version or minimum version not found. Desktop version check skipped.");const o=Jde(i,n,t,a);if(a.log(`Minimum supported version is ${o}`),void 0===o)return void a.log("Minimum version could not be determined. Desktop version check skipped.");if(Qde(e,o))return a.log("Unsupported desktop version detected."),!0;return!1}(o,i,s,l,e)}const Zde="exploratory_banner_last_dismissed_at";function Xde(e,t){return(t.getTime()-e.getTime())/864e5}function eue(e,t){const n=t.toISOString();e.localStorage.setItem(Zde,n)}const tue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellPlacesSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"placesSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"autoUpdateLocationPreference"}},{kind:"Field",name:{kind:"Name",value:"autoLocationFirstRunBannerIncrementCount"}},{kind:"Field",name:{kind:"Name",value:"autoLocationFirstRunBannerLastIncrementDate"}}]}}]}}]}}]},nue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellAutoUpdateLocationPreferenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateUserPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}},{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserPreferences"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"placesSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"autoUpdateLocationPreference"}}]}}]}}]}}]}}]},iue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellReportPlacesInOfficeMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"canShareLocationDetails"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reportPlacesInOffice"},arguments:[{kind:"Argument",name:{kind:"Name",value:"canShareLocationDetails"},value:{kind:"Variable",name:{kind:"Name",value:"canShareLocationDetails"}}}]}]}}]},aue=async(e,t)=>{const{loggerFactory:n,userBiService:i}=e,a=n.newLogger("auto-detect-location-first-run-banner-command-handler-logger","apps-shell");!function(e,t){e?.recordPanelAction({panelType:GR.HP.autoLocationFirstRunBanner,panelRegion:GR.rP.banner,actionGesture:GR.Od.click,moduleName:GR.Sn.autoLocationFirstRunBannerCTAButton},t)}(i,a);const o="places_auto_location_first_run_banner_cta_error";let r,s;try{const t=await e.client.query({query:tue});r=t.data?.userPreferences?.placesSettings}catch(e){return a.errorToTelemetry?.("Failed to get placesSettings from userPreferences",o),Promise.resolve(void 0)}const l=JSON.stringify({...r,autoUpdateLocationPreference:"Enabled"});try{const t=await e.client.mutate({mutation:nue,variables:{category:"placesSettings",value:l}});s=t.data?.updateUserPreferences?.placesSettings?.autoUpdateLocationPreference}catch(e){return a.errorToTelemetry?.("Failed to update autoUpdateLocationPreference value to Enabled",o),Promise.resolve(void 0)}try{await e.client.mutate({mutation:iue,variables:{canShareLocationDetails:"Enabled"===s}})}catch(e){return a.errorToTelemetry?.("Failed to fire new location update API call",o),Promise.resolve(void 0)}return a.log("CTA button action completed"),Promise.resolve(void 0)};const oue={[ke.SY.create]:(e,t)=>{const{command:{correlation:{source:n}},entityOptions:i,entity:{id:a}}=t,{client:o,loggerFactory:r}=e,s=r.newLogger("addBannerNotificationToQueue","apps-shell"),l=i;if(l){const{text:e,title:t,linkActions:i,action:r,dismissable:c,dismissActionCommand:d,duration:u,...m}=l;let p,g;i&&(g=i.map((e=>({...e,command:(0,ge.hR)(e.command)})))),r&&(p={...r,command:(0,ge.hR)(r.command)}),((e,t,n)=>{let i=Bde(e,t);i=i.filter((e=>e.bannerId!==n.bannerId)),i.unshift(n),i=i.sort(((e,t)=>Ode[e.intentLevel]-Ode[t.intentLevel])),Ude(e,t,i)})(s,o,{...m,bannerId:a||"no-id",source:n,props:{text:e,title:t,action:p,linkActions:g},behavior:{dismissable:c,dismissActionCommand:d?(0,ge.hR)(d):void 0,duration:u}})}else s.error("entityOptions is missing IBannerNotificationOptions fields. ",i);return Promise.resolve(void 0)},[ke.SY.delete]:(e,t)=>{const{entity:{id:n}}=t,{client:i,loggerFactory:a}=e,o=a.newLogger("removeBannerNotificationFromQueue","apps-shell");return n&&$de(o,i,n),Promise.resolve(void 0)},[ke.SY.signin]:async(e,t)=>{const{entityOptions:n}=t,{client:i,loggerFactory:a}=e,o=a.newLogger("handleSignInBannerActionCommand","apps-shell"),r=n;return await Vde(o,i)&&r?.bannerId&&$de(o,i,r.bannerId),Promise.resolve(void 0)}},rue={[ke.SY.create]:(e,t)=>{const{command:{correlation:{source:n}},entityOptions:i,entity:{id:a}}=t,{client:o,loggerFactory:r}=e,s=r.newLogger("addToastNotificationToQueue","apps-shell"),l=i;if(a&&l){const{body:e,...t}=l;let i;e?.action&&(i={...e?.action,command:JSON.stringify(e?.action.command)}),((e,t,n)=>{let i=Gde(e,t);i=i.filter((e=>e.id!==n.id)),i.push(n),Yde(e,t,i)})(s,o,{...t,id:a,source:n,body:{action:i}})}else s.error("entityOptions is missing IToastNotificationParams fields. ",i);return Promise.resolve(void 0)},[ke.SY.delete]:(e,t)=>{const{entity:{id:n}}=t,{client:i,loggerFactory:a}=e,o=a.newLogger("removeToastNotificationFromQueue","apps-shell");return n&&((e,t,n)=>{let i=Gde(e,t);i=i.filter((e=>e.id!==n)),Yde(e,t,i)})(o,i,n),Promise.resolve(void 0)},[ke.SY.update]:(e,t)=>{const{command:{correlation:{source:n}},entityOptions:i,entity:{id:a}}=t,{client:o,loggerFactory:r}=e,s=r.newLogger("addToastNotificationToQueue","apps-shell"),l=i;if(a&&l){const{body:e,...t}=l;let i;e?.action&&(i={...e?.action,command:JSON.stringify(e?.action.command)}),((e,t,n)=>{const i=Gde(e,t);let a=!1;for(let e=0;e<i.length;e++)if(i[e].id===n.id){i[e]=n,a=!0;break}a||i.push(n),Yde(e,t,i)})(s,o,{...t,id:a,source:n,body:{action:i}})}else s.error("entityOptions is missing IToastNotificationParams fields. ",i);return Promise.resolve(void 0)}},sue={[ke.SY.view]:async(e,t)=>{throw new Error("Method not implemented yet")}},lue={[ke.SY.info]:async(e,t)=>{const{exploratoryExpiryBannerLearnMoreUrl:n}=e.coreSettings.get(c.w.Growth),i=(0,Un.z)();return i.open(n,"_blank"),eue(i,new Date),Promise.resolve(void 0)},[ke.SY.delete]:async(e,t)=>(eue((0,Un.z)(),new Date),Promise.resolve(void 0))},cue={[ke.SY.info]:async(e,t)=>{const{bygcDeprecationLearnMoreLink:n}=e.coreSettings.get(c.w.Calendar);return(0,Un.z)().open(n,"_blank"),Promise.resolve(void 0)}},due=e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i}},requestContext:a,windowProvider:o}=e;if(n===ke.ck.bannerNotification){const e=oue[i];if(e)return e(a,t)}else if(n===ke.ck.inAppToast){const e=rue[i];if(e)return e(a,t)}else if(n===ke.ck.memenu){const e=sue[i];if(e)return e(a,t)}else{if(n===ke.ck.updatedesktopapp&&i===ke.SY.confirm)return(async(e,t,n)=>{const{coreSettings:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("downloadAppInstaller","apps-shell"),{enableDesktopMinimumVersionBanner:s}=i.get(c.w.Core);if(!s)return r.log("Sedimentation banner disabled by feature flag"),Promise.resolve(t);const{desktopAppInstallerLinks:l}=i.get(c.w.Core),{deviceInfo:d}=i.get(c.w.Platform),u=d?.cpuArchitecture||void 0,m=Jde(d?.osName||void 0,u,l,r),p=o?.newScenario(be.Cu.MinimumVersionBannerButton);if(m)try{r.log(`Downloading the msix file for ${u}`);const e=n?.document.createElement("a");return e.setAttribute("href",m),e.setAttribute("download",""),e.click(),e.remove(),p?.mark("banner_clicked"),p?.stop(),Promise.resolve(void 0)}catch(e){const n=`Failed to download msix file, where setup values is enableDesktopMinimumVersionBanner: \n    ${s}, cpuarch: ${u}, desktopAppInstallerLink: ${m}; \n    ${e.message}`;return r.errorToTelemetry?.(n,"unsupported-version-banner-job",{errorCode:e.name},!0),p?.fail({errorCode:e.name,reason:"download-msix-file-error"}),Promise.resolve(t)}return r.log("Failed to download msix file - desktopAppInstallerLink not defined."),p?.cancel({reason:"undefined-desktop-app-installer-link-event"}),Promise.resolve(t)})(a,t,o);if(n===ke.ck.exploratorylicensenotificationbanner){const e=lue[i];if(e)return e(a,t)}else if(n===ke.ck.bygcdeprecationbanner){const e=cue[i];if(e)return e(a,t)}else{if(n===ke.ck.remotebrbbanner)return(async(e,t)=>{const{coreSettings:n}=e,{aboutPrivacyLink:i}=n.get(c.w.Core),a=(0,Un.z)();return i&&a.open(i,"_blank"),Promise.resolve(void 0)})(a);if(n===ke.ck.autodetectlocationfirstrunbanner)return aue(a)}}return Promise.resolve(t)},uue=[{filter:"/notdefaultapp",execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableAppSwitcher:n}=e.get(c.w.Core),i=t.newLogger("Shell:BeforeDeeplinkParsedCondition","apps-shell");return n?(i.log("execute command onBeforeDeeplinkParsed"),Promise.resolve({entityCommand:{entity:{type:ke.ck.pearnotdefaultapp,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.standard}},metadata:{allowAnonymous:!0}})):(i.log(`app switcher is not enabled, enableAppSwitcher value is ${n}`),Promise.reject({message:"app-switcher-not-enabled"}))}},{filter:e=>e.search.includes("officeWaffle"),execute:async()=>({entityCommand:{command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush},entity:{type:ke.ck.default,action:ke.SY.default}},metadata:{allowAnonymous:!0}})},{filter:"/l/teamsInsider",execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableJoinInsidersTab:n}=e.get(c.w.Core),i=t.newLogger("Shell:BeforeDeeplinkParsedTeamsInsiderCondition","apps-shell");return n?(i.log("execute command onBeforeDeeplinkParsedTeamsInsiderCondition"),Promise.resolve({entityCommand:{entity:{type:ke.ck.settingsstore,action:ke.SY.default,id:aK.G.Insiders},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.standard}},metadata:{allowAnonymous:!1}})):(i.log(`teams insider is not enabled, enableJoinInsidersTab value is ${n}`),Promise.reject({message:"teams-insider-not-enabled"}))}},{filter:"/l/useractivityrecall",execute:({context:{loggerFactory:e},deeplinkUrl:t})=>{const n=e.newLogger("Shell:BeforeDeeplinkParsedUserActivityRecallCondition","apps-shell"),i=t.pathname.split("/");if(4!==i.length)return n.log(`Invalid deeplink path, expected 4 fragments but got ${i.length}`),Promise.reject({message:"invalid-deeplink-path"});return"notsupported"!==i[i.length-1]?(n.log("Invalid recall entity requested"),Promise.reject({message:"invalid-requested-entity"})):Promise.resolve({entityCommand:{entity:{type:ke.ck.useractivityrecallnotsupported,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,layoutMode:Yt.Rm.standard}},metadata:{allowAnonymous:!1}})}}],mue={filter:new Set([ke.ck.pearnotdefaultapp]),execute:async({intent:e})=>({overrideType:ER.OverrideIntent,intent:e})};function pue(e){const{coreSettings:t,i18n:n,entityCommanding:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("DesktopUnsupportedVersionCheckJob","apps-shell"),s=o.newScenario(be.Cu.MinimumVersionBanner);return{id:"desktop-minimum-version-check-job",runOncePerId:!0,job:async()=>{r.log("Checking unsupported desktop client versions...");Kde(r,t)&&(!function(e,t,n,i,a,o){t.shell.showBanner({id:e,source:A.p.ShellVersionCheck,bannerScenario:a,intentLevel:"Severe",cause:"UnsupportedAppVersionDetected",text:n.stringTranslate("framework",a),action:{text:n.stringTranslate("framework",o),command:{entity:{type:ke.ck.updatedesktopapp,action:ke.SY.confirm,id:aK.G.Notifications}},dismissOnAction:!0},dismissable:!0,duration:0}),i.log("Desktop sedimentation banner displayed")}("DesktopSedimentationBanner",i,n,r,"desktopapp_version_unsupported_generic_banner","more_options_menu_initiate_update"),s?.mark("banner_shown")),s?.stop()}}}const gue=({context:e})=>{const t=[],{enableDiskProfileMeasurement:n,enableDesktopMinimumVersionBanner:i}=e.coreSettings.get(c.w.Core);return n&&t.push(function(e){const{loggerFactory:t,hostCommunicationService:n}=e;return{id:"disk-footprint-job",runOncePerId:!1,job:async()=>{const e=t.newLogger("DiskFootprintStrategy","apps-shell");try{const e=await n.loadModule("osutils");e?.sendDiskProfileInfo?.()}catch(t){const n=`Failed Disk Footprint with errorCode ${t?.errorCode||t?.code}`;e.error?.(n)}}}}(e)),i&&t.push(pue(e)),t},hue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"OnAuthenticationStateChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationStateChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"isExpected"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"subContext"}}]}}]}}]}}]}}]},vue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]},yue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellAuthEndPagesDataQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMRU"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEndPageData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"isMRU"},value:{kind:"Variable",name:{kind:"Name",value:"isMRU"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"pictureBlob"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"subContext"}}]}}]}}]}}]},Sue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellShowTaskbarAttentionIconMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showTaskbarAttentionIcon"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}}]}]}}]},fue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellAuthHideTaskbarAttentionIconMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hideTaskbarAttentionIcon"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}}]}]}}]},kue=({errorCode:e,message:t,isExpected:n,context:i,subContext:a})=>`errorCode: [${e}], message: [${t}], isExpected: [${+!!n}], context: [${i}::${a}]`,Cue=3e4;function bue(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o,authenticationUser:r,coreSettings:s}=e,l=o.newLogger("auth-state-job","apps-shell"),d=n,u="auth-banner";let m,p=!0;return{id:"auth-state-subscription",job:()=>{d.subscribe({query:hue}).filter((e=>!!e?.data?.authenticationStateChanged?.authenticationState)).subscribe((async e=>{const n=await d.query({query:vue});if(0===n?.data?.authenticationUsers?.length)return void l.warn("No authenticated user found, not displaying auth-banner.");const o=e?.data?.authenticationStateChanged?.authenticationState;switch(m&&"InteractionRequired"!==o?.state&&(globalThis.window.clearTimeout(m),m=void 0),o?.state){case"AADReconnecting":case"SkypeReconnecting":!function(e,t,n,i){let a="",o="";"AADReconnecting"===t.state?(a=n.stringTranslate("auth","aad_reconnecting_text"),o="auth_aad_reconnecting"):"SkypeReconnecting"===t.state&&(a=n.stringTranslate("auth","skype_reconnecting_text"),o="auth_skype_reconnecting");i.shell.showBanner({id:e,source:A.p.ShellAuthState,intentLevel:"Severe",text:a,dismissable:!0,duration:0,bannerScenario:o,correlationId:t.customError?.correlationId||"",debugInfo:kue(t.customError||{})})}(u,o,a,i);break;case"InteractionRequired":const{enableInteractionRequiredRetry:e,interactionRequiredBannerDelay:t}=s.get(c.w.Auth);e?m||(m=globalThis.window.setTimeout((()=>{wue(u,a,i,o,r,l,s,d),globalThis.window.clearTimeout(m),m=void 0}),t??Cue)):wue(u,a,i,o,r,l,s,d);break;case"LicenseError":case"SignInRestriction":await async function(e,t,n,i,a){if(!function(e,t,n){const{enableAuthEndPagesLicenseWarm:i,disableAuthEndPagesSigninRestrictionWarm:a}=t?.get(c.w.Auth)||{};if(!e)return!1;switch(n){case"LicenseError":return i;case"SignInRestriction":return!a;default:return!1}}(n,i,a))return;const o=n?.id||"",r=await t.query({query:yue,variables:{userContextId:o,isMRU:!0}});if(!r.data.userEndPageData)return;const s=r.data.userEndPageData;e.authentication.showAuthEndPage(A.p.ShellAuthState,{error:(0,Jt.Oi)(s,a,o)})}(i,d,r,s,o.state);break;default:p||(i.shell.dismissBanner(u,A.p.ShellAuthState),async function(e,t,n,i){const{enableInteractionRequiredTaskbarIcon:a}=i.get(c.w.Auth);if(!a)return void t.log("TaskbarBadge: Flag is disabled. Not showing interaction required icon on taskbar.");try{const t=e?.id||"";await n.mutate({mutation:fue,variables:{accountId:t}})}catch{t.error("TaskbarBadge: Could not hide interaction required icon on taskbar.")}t.log("TaskbarBadge: interaction required icon on taskbar hidden.")}(r,l,d,s))}t&&t(),p=!1}))}}}function wue(e,t,n,i,a,o,r,s){!function(e,t,n,i){n.shell.showBanner({id:e,source:A.p.ShellAuthState,bannerScenario:"auth_sign_in_required",intentLevel:"MostSevere",cause:"AuthError",text:t.stringTranslate("auth","sign_in_required_text"),action:{text:t.stringTranslate("auth","sign_in_required_cta_text"),command:{entity:{type:"bannerNotification",action:"signin"}},dismissOnAction:!1},dismissable:!1,duration:0,correlationId:i.customError?.correlationId||"",debugInfo:kue(i.customError||{})})}(e,t,n,i),function(e,t,n,i,a){const{enableInteractionRequiredToast:o}=a.get(c.w.Auth);if(!o)return void t.log("AlertToasts: Flag is disabled. Not showing interaction required toast.");const r={conversationId:"",quickReply:!1,time:new Date,title:n.stringTranslate("auth","auth_alert_toast_interaction_required_title"),text:n.stringTranslate("auth","auth_alert_toast_interaction_required_text"),mainImage:{alt:"",src:SL.aZ.Alert}};i.toasts.showInteractionRequiredToast(`dma-toast-for-${e?.id||"unknown-user"}`,r)}(a,o,t,n,r),async function(e,t,n,i){const{enableInteractionRequiredTaskbarIcon:a}=i.get(c.w.Auth);if(!a)return void t.log("TaskbarBadge: Flag is disabled. Not showing interaction required icon on taskbar.");const o=e?.id||"";try{await n.mutate({mutation:Sue,variables:{accountId:o}})}catch{t.error("TaskbarBadge: Could not show interaction required icon on taskbar.")}t.warn(`TaskbarBadge: interaction required icon on taskbar shown for account ${o}.`)}(a,o,s,r)}const Tue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsShellCdlServicesStateSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appServiceStateChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appService"}},{kind:"Field",name:{kind:"Name",value:"previousState"}},{kind:"Field",name:{kind:"Name",value:"currentStateChangeTimestamp"}},{kind:"Field",name:{kind:"Name",value:"currentStateChangeReason"}},{kind:"Field",name:{kind:"Name",value:"currentStateChangeCode"}},{kind:"Field",name:{kind:"Name",value:"currentState"}}]}}]}}]};function Iue(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o,coreSettings:r,networkState:s}=e,l=n,d="cdl-services-state-banner",u=o.newLogger("cdl-services-state-job","apps-shell");let m=!1,p=0,g=0,h=!0;return{id:"cdl-services-state-subscription",job:()=>{const e=r.get(c.w.CdlWorker).disableTrouterDisconnectedBannerT2,n=!!r.get(c.w.CdlWorker).enableCdlAppStateService;if(e||!n)return void u.logNoPii?.("disableTrouterDisconnectedBanner killswitch is enabled or enableCdlAppStateService is disabled; not listening to app service state change events");const o=l.subscribe({query:Tue}).subscribe((e=>{if(!e?.data)return void(t&&t());const n=e?.data?.appServiceStateChanged,{appService:o,currentState:r}=n,l=s.getState();if("ChatSync"===o)m||"OFFLINE"!==r||l!==Pg.Q.Online?!h&&p>0&&"ONLINE"===r&&((e,t,n,i,a,o)=>{m=!1,g++,n.infoToTelemetry&&n.infoToTelemetry("ChatSync app service is back up; dismissing existing disconnected banner "+(void 0!==o?`(networkState=${o.toString()})`:""),"cdl_app_state_chatsync_disconnected_banner_dismiss",Nue(t,p,g),!0),i.shell.dismissBanner(e,A.p.ShellCDLServicesState),a&&a(!1)})(d,n,u,i,t,l):((e,t,n,i,a,o)=>{m=!0,p++,i.infoToTelemetry&&i.infoToTelemetry("ChatSync app service is OFFLINE; displaying new disconnected banner","cdl_app_state_chatsync_disconnected_banner_show",Nue(t,p,g),!0),a.shell.showBanner({id:e,source:A.p.ShellCDLServicesState,intentLevel:"Neutral",text:n.stringTranslate("errors","chatsync_app_service_disconnected"),dismissable:!0,duration:0,bannerScenario:"cdl-service-state-disconnected-banner"}),o&&o(!0)})(d,n,a,u,i,t),h=!1}));return()=>{o.unsubscribe()}}}}function Nue(e,t,n){const{appService:i,currentState:a,currentStateChangeReason:o,currentStateChangeCode:r,previousState:s}=e;return{appService:i,currentState:a.toString(),currentStateChangeReason:o,currentStateChangeCode:r,previousState:s?.toString(),bannerShownCount:t,bannerDismissCount:n}}const Aue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsShellTenantDataSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isInvitationRedeemed"}},{kind:"Field",name:{kind:"Name",value:"tenantName"}}]}}]}}]};function Eue(e){const{client:t,entityCommanding:n,i18n:i,coreSettings:a,loggerFactory:o}=e,r=o.newLogger("tenant-invite-state-subscription-logger","apps-shell"),s=t,l="auth-banner";let d=!0;return{id:"tenant-invite-state-subscription",job:()=>{const e=s.subscribe({query:Aue}).subscribe((({data:e})=>{const t=e?.tenantChangedEvent,o=t?.isInvitationRedeemed,r=t?.tenantName||"",{enableShowGuestInviteBanner:s}=a.get(c.w.Auth);s&&(o?d||n.shell.dismissBanner(l,A.p.ShellAuthState):function(e,t,n,i){const a=n.stringTranslate("auth","auth_pending_guest_settings_text"),o={source:A.p.ShellAuthState},r={text:a,command:{entity:{type:ke.ck.settingsstore,action:ke.SY.view,id:aK.G.Accounts},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,targetWindow:g.BA.main,correlation:o},entityOptions:{correlation:o}},dismissOnAction:!0};i.shell.showBanner({id:e,source:A.p.ShellAuthState,bannerScenario:"auth_pending_guest_invite",intentLevel:"Neutral",cause:"AuthError",text:n.stringTranslate("auth","auth_pending_guest_invite_text",{tenantName:t}),action:r,dismissable:!0,duration:0,debugInfo:""})}(l,r,i,n)),d=!1}));return()=>{e.unsubscribe(),r.log("[Auth] Unsubscribing from tenant data updates...")}}}}const Fue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellIsApplianceModeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isApplianceMode"}}]}}]},_ue="offline banner",Due="offline branch survivability banner";function Pue(e){const{clientState:t,coreSettings:n,entityCommanding:i,i18n:a,loggerFactory:o,networkState:r,client:s}=e,l=o.newLogger("network-state-subscription-logger","apps-shell"),d=s;return{id:"network-state-subscription",job:()=>{const{disableOfflineBannerSupressionInCall:e,enableNetworkStateBannerSubscription:o}=n.get(c.w.Core,["disableOfflineBannerSupressionInCall","enableNetworkStateBannerSubscription"]);if(!o)return void l.logNoPii?.("network state banner subscription is disabled");const{enableSurvivabilityT21:s}=n.get(c.w.Calling,["enableSurvivabilityT21"]);let u,m=!1,p=!0,g=t.getState();const h=e?void 0:t.observe().subscribe((t=>{if(m||e)return;const n=!r.isOnline();n&&t!==Ba.Lg.VeryActive&&g===Ba.Lg.VeryActive?(l.logNoPii?.("Offline and ClientState is not VeryActive -> showing offline banner"),Mue(i,a,l,u)):n&&t===Ba.Lg.VeryActive&&g!==Ba.Lg.VeryActive&&(l.logNoPii?.("Offline and ClientState is VeryActive -> supressing offline banner"),function(e){e.shell.dismissBanner(_ue,A.p.ShellNetworkState)}(i)),g=t})),v=r.observe().subscribe((async t=>{const n=s?await d.query({query:Fue,fetchPolicy:"no-cache"}):void 0;if(t===Pg.Q.Offline)u=(0,ai.aq)(),n&&n.data?.isApplianceMode?(l.debug("showing branch survivability banner"),m=!0,i.shell.showBanner({id:Due,source:A.p.ShellNetworkState,bannerScenario:"framework_branch_survivability_offline_banner",intentLevel:"Severe",cause:"Offline",text:a.stringTranslate("calling","offline_banner_message_branch_survivability_v2"),dismissable:!1,duration:0})):e||g!==Ba.Lg.VeryActive?Mue(i,a,l,u):l.logNoPii?.("ClientState is VeryActive, supressing offline banner");else if(!p){const e=m?Due:_ue;l.logNoPii?.(`dismissing banner: ${e}`),i.shell.dismissBanner(e,A.p.ShellNetworkState),m=!1,u=void 0}p=!1}));return()=>{v.unsubscribe(),h?.unsubscribe()}}}}function Mue(e,t,n,i){n.logNoPii?.("showing offline banner"),e.shell.showBanner({id:_ue,source:A.p.ShellNetworkState,bannerScenario:"framework_offline_banner",intentLevel:"Severe",cause:"Offline",text:t.stringTranslate("framework","offline_banner_message"),dismissable:!1,duration:0,correlationId:i})}const Rue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"notifyWorkerSyncCanStart"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notifyWorkerSyncCanStart"}}]}}]};const xue={id:"com.microsoft.teams.shell",name:"Shell",actors:[a2],supportedEntities:[ke.ck.appswitcherdesktopactivecalldialog,ke.ck.appswitchert1downloaddialog,ke.ck.appswitcherwebactivecalldialog,ke.ck.appswitcherwebmultipletabsdialog,ke.ck.bannerNotification,ke.ck.brbfeedbackdialog,ke.ck.brbmemorysnapshotconsentdialog,ke.ck.hybridplaceholder,ke.ck.identitydialog,ke.ck.pearnotdefaultapp,ke.ck.signoutdialog,ke.ck.inAppToast,ke.ck.tpndialog,ke.ck.unsupporteddeeplinkdialog,ke.ck.updatemsaprofileavatardialog,ke.ck.updatemsaprofilenamedialog,ke.ck.joinlinkdialog,ke.ck.autobrbconfirmationdialog,ke.ck.autobrbflowdialog,ke.ck.framework,ke.ck.officeintegrationfredialog,ke.ck.memenu,ke.ck.premiumtrialdialog,ke.ck.premiumtrialdialogesp,ke.ck.updatedesktopapp,ke.ck.licenserequestdialog,ke.ck.switchaccountdialog,ke.ck.exploratorylicensenotificationbanner,ke.ck.vdirestartworkflow,ke.ck.addphonelinkdialog,ke.ck.autodetectlocationfirstrunbanner,ke.ck.bygcdeprecationbanner,ke.ck.remotebrbbanner,ke.ck.useractivityrecallnotsupported,ke.ck.servicesunavailable],supportedRenderModes:[se.k.Main,se.k.Modal,se.k.Rail,se.k.ThinHorizontalBar,se.k.TitleBar,se.k.VerticalBar],windowFeatures:{minWidth:602,width:602,minHeight:520,height:520,offset:20}};var Lue=n(396579);const Oue={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellSelectedAppStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectedAppbarTileState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"tileIndex"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"tilePositionVertical"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isHovered"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]},jue=(e,t,n,i,a,o)=>{if(!e.data)return void t.error(`handleLaunchTileEvent::Received an event without data! Event type: ${e.type}`);const{enableApbbarTilePosition:r}=a.get(c.w.Core);switch(e.type){case Pde.w7.launch:const a=e.data(),l=qm((s=a).tileID,s),c=!!a.reactEvent||!r,d=l?.focusOnLeftRailItem,u=l?.appName;if(t.log(`handleLaunchTileEvent::launch::uiInteraction=${c}::focus=${d}::enableApbbarTilePosition=${r}::type=${a.reactEvent?.type}::context=${a.tileHostContext}::appName${u}`),c){d&&o?.();const e=(e=>{switch(e.tileID){case Mm:return GR.HP.teams;case Dm:return GR.HP.chat;case Pm:return GR.HP.calendar;case xm:return GR.HP.calls;case Lm:return GR.HP.files;default:return GR.HP.AppBar}})(a),i=a.tileID,r=n.createDatabag?.();r&&(r.launchTileId=i,r.launchTilePosition=a.tilePosition,r.launchTileEventType=a.reactEvent?.type,r.launchTileAppName=u,r.launchOut=a.launchOut,r.tileHostContext=a.tileHostContext);const s=i===Wm?GR.vB.navAppStore:GR.vB.openApp;n.recordPanelAction({actionScenario:s,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenarioType:GR.DB.nav,moduleType:GR.nR.nav,moduleName:GR.Sn.appBarItem,panelType:e,panelRegion:GR.rP.main,dataBag:r,extensibilityData:{id:i,name:u,scenarioCapability:SU.n3.na,scope:SU.bY.personal}},t),r?.dispose()}return r&&Bue(i,t,{id:a.tileID,tileIndex:a.tilePosition,tilePositionVertical:a.tilePositionVertical,isHovered:!!c||void 0}),c?l?.appViewCommand:void 0;case Lue.BJ.PlatformEvents.markAllAsRead:{const i=((e,t)=>{if(e===xm)return{appName:"callsmain",markAsReadCommand:{command:As()}};t.error(`Received an unknown or unsupported core app id. Cannot use markAllAsRead command on app with id ${e}.`)})(e.data(),t);return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.markAllAsRead,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),i?.markAsReadCommand}case Pde.w7.uninstall:const m=e.data();return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.uninstallAppOnAppBarAndPersonalAppsFlyout,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),{command:Ru(m.tileID,m.appName,m.isInUse)};case Lue.BJ.PlatformEvents.about:{const i=e.data();return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.personalAppAbout,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),{command:xu(i)}}case Lue.BJ.PlatformEvents.share:{const i=e.data();return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.personalAppShare,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),{command:Lu(i)}}case Lue.BJ.PlatformEvents.blockUnblockBotChat:{const i=e.data();return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.blockUnblockBotChatInPersonalAppsFlyout,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),{command:Ou(i)}}case Lue.BJ.PlatformEvents.newChat:return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.newChatCreation,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),{command:zs()};case Lue.BJ.PlatformEvents.popNewChat:return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.newChatCreation,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left},t),{command:qs()};case Pde.w7.appTileHover:if(r){const n=e.data();Bue(i,t,{id:n.id,tileIndex:n.tilePosition,tilePositionVertical:n.tilePositionVertical,isHovered:n.isHovered})}return;case Pde.w7.appIconError:return void t.errorToTelemetry?.(`App icon error: ${JSON.stringify(e.data())}`,"webclient_framework_shell_appbar_icon_render_failure_event",void 0,!0);default:return void t.warn(`Received an unhandled tile event, type: ${e.type}`)}var s};function Bue(e,t,n){try{const t=20;e.writeQuery({query:Oue,data:{selectedAppbarTileState:{__typename:"SelectedAppbarTile",id:n.id,tileIndex:n.tileIndex||null,tilePositionVertical:(n.tilePositionVertical??0+t)||null,isHovered:n.isHovered||null}}})}catch(e){t.error(`handleLaunchTileEvent::failure to write SelectedApp to cache: ${e?.message}`)}}var Uue=n(4650);const $ue=({userBiService:e,actionScenario:t,actionOutcome:n,moduleName:i,moduleType:a,actionScenarioType:o,logger:r,actionGesture:s=GR.Od.click,panelType:l=GR.HP.meControl,panelRegion:c=GR.rP.main,dataBag:d})=>{e.recordPanelAction({actionOutcome:n,actionGesture:s,actionScenarioType:o,panelRegion:c,panelType:l,actionScenario:t,moduleName:i,moduleType:a,dataBag:d},r),d?.dispose()},Wue={OneHour:"settings_note_expiry_hour",HalfHour:"settings_expiry_status_half_hour",TwoHours:"settings_note_expiry_hours_two",FourHours:"settings_note_expiry_hours_four",Today:"settings_note_expiry_today",ThisWeek:"settings_note_expiry_this_week",Custom:"settings_note_expiry_custom",Never:"settings_note_expiry_never"},Vue={Home:"Remote",Remote:"Remote",Office:"Office",TimeOff:"TimeOff",Unknown:null},Hue=(e,t,n)=>{switch(e.type){case Uue.xk.updateDisplayName:return{command:u2()};case Uue.xk.updateProfilePicture:return{command:d2()};case Uue.xk.scheduleOOF:return $ue({userBiService:t,actionScenario:GR.vB.oofSettingsOpen,actionOutcome:GR.nd.navigateToPanel,moduleName:GR.Sn.oofSettingsOpenLink,moduleType:GR.nR.link,actionScenarioType:GR.DB.oofSettings,logger:n}),{command:{actor:m7,action:p7}};case Uue.xk.openProfileCard:const{presenceIdMRI:i,eventType:a,position:o}=e.data?.();return function(e,t,n){if(!e)return;switch(t){case"mouseenter":case"mouseleave":case"click":case"keydown":return{command:vq({eventType:t,userId:e,left:n.left,top:n.top,width:n.width,height:n.height,useNewEventObserver:!0})};default:return}}(i,a,o);case Uue.xk.setStatusMessageSubmitted:{const i=e.data?.(),a=t.createDatabag?.();if(i&&a){const{pinStatusToChat:e,isOutOfOffice:t,expiry:n}=i.statusNoteRequest;a.pinnedStatusMessage=e,a.oof=t,a.expiryDate=n?.preDefined?Wue[n.preDefined]:null}return $ue({userBiService:t,actionScenario:GR.vB.setStatusMessage,actionOutcome:GR.nd.submit,moduleName:GR.Sn.statusMessageForm,moduleType:GR.nR.button,actionScenarioType:GR.DB.statusMessage,logger:n,dataBag:a}),{command:{actor:m7,action:g7}}}case Uue.xk.setAvailabilitySubmitted:{const i=e.data?.(),a=t.createDatabag?.();if(i&&a){const{category:e,presetDuration:t,customExpiry:n}=i;a.expiryStatusOverridden=!(!t&&!n),a.expiryDate=t?Wue[t]:void 0,a.selectedStatus=e}return void $ue({userBiService:t,actionScenario:GR.vB.setPresence,actionOutcome:GR.nd.select,moduleName:GR.Sn.availabilityDropdown,moduleType:GR.nR.dropdown,actionScenarioType:GR.DB.availability,logger:n,dataBag:a})}case Uue.xk.setWorkLocationSubmitted:{const i=e.data?.(),a=t.createDatabag?.();if(i&&a){const{workLocationId:e}=i;a.workLocation=Vue[e||"Unknown"]}return void $ue({userBiService:t,actionScenario:GR.vB.setWorkLocation,actionOutcome:GR.nd.select,moduleName:GR.Sn.workLocationDropdown,moduleType:GR.nR.dropdown,actionScenarioType:GR.DB.hybridPresence,logger:n,dataBag:a})}default:return}};var zue=n(881072);const que=(e,t,n,i)=>{const{mtmaTenantSwitchTargetEntityOverride:a}=n.get(c.w.Activity);switch(e.type){case zue.C.switchAccount:{const n=t.createDatabag?.(),i=e.data?.();n&&i.userBiData&&Object.assign(n,i.userBiData);const o={actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.mtmaNotificationListItemClick,actionScenarioType:GR.DB.mtmaNotifications,panelRegion:GR.rP.top,panelType:GR.HP.MissedMtmaNotifications,moduleName:GR.Sn.mtmaNotificationListItem,moduleType:GR.nR.mtmaNotifications,dataBag:n};t.recordPanelAction(o),n?.dispose();const r=i.userId,s=((e,t)=>{switch(t){case"activity":return ke.ck.activity;case"chats":return ke.ck.chats;default:return e}})(i.accountSwitchTargetEntityType,a||"default");return{command:Ene(r,s)}}case zue.C.renderComplete:{const n=t.createDatabag?.(),a=e.data?.();n&&a&&Object.assign(n,a);const o={panelType:GR.HP.MissedMtmaNotifications,panelRegion:GR.rP.top,dataBag:n};t.recordPanelView(o),n?.dispose();const r=i.findScenario(be.Cu.notificationDropdownRender);return void r?.stop()}case zue.C.scroll:{const n=t.createDatabag?.(),i=e.data?.();n&&i&&Object.assign(n,i);const a={actionGesture:GR.Od.scroll,actionOutcome:GR.nd.read,actionScenario:GR.vB.scrollMtmaNotificationsList,actionScenarioType:GR.DB.scroll,moduleName:GR.Sn.mtmaNotificationsList,panelRegion:GR.rP.top,panelType:GR.HP.MissedMtmaNotifications,moduleType:GR.nR.mtmaNotifications,dataBag:n};return t.recordPanelAction(a),void n?.dispose()}default:return}};var Gue=n(405958);var Yue=n(479459);const Que={onEventReceived:async e=>{const t=e.requestContext.loggerFactory.newLogger("apps-shell-event-handler","apps-shell"),n=e.requestContext.userBiService,i=e.requestContext.scenarioFactory,a=e.requestContext.client,o=e.requestContext.coreSettings,r=e.eventInput.event;switch(r.originator){case Gue.N:if(r.type===Gue.m.openContextualSearch){const e=r.data?.();return{command:H2(e)}}break;case Pde.KG:return jue(r,t,n,a,o,(()=>{const t=e.requestContext.client?.ctx;t&&e.requestContext.shortcutExecutionService.executeCommand(t.windowId,"FocusOnLeftRailItem")}));case Pde.sj:return((e,t,n)=>{e.type!==Pde.w7.userSearch?t.warn(`Received an unhandled Launch tile event, type: ${e.type}`):n.recordPanelAction({actionGesture:GR.Od.keypress,actionOutcome:GR.nd.show,actionScenario:GR.vB.userSearchFromPersonalFlyout,actionScenarioType:GR.DB.appBar,moduleName:GR.Sn.novaAppBar,panelRegion:GR.rP.left},t)})(r,t,n);case Pde.k4:return((e,t,n)=>{if(!e.data)return void t.error("Received a launch event without data!");const i=n.createDatabag?.(),a=(0,Un.z)(),o=SU.bY.personal.toString(),r=SU.n3.na.toString();switch(e.type){case Pde.w7.install:{const a=e.data();return i&&(i.launchTileId=a.tileID),n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.clickAddFromPersonalFlyoutSuggestions,actionScenarioType:GR.DB.appBar,moduleName:GR.Sn.novaAppBar,panelRegion:GR.rP.left,dataBag:i},t),i?.dispose(),{command:Mu(a.tileID)}}case Pde.w7.description:{const a=e.data();return i&&(i.launchTileId=a.tileID),n.recordPanelAction({appId:a.tileID,appScenarioCapability:r,appScope:o,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.flyoutAppItemClicked,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.nav,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left,dataBag:i},t),i?.dispose(),{command:Pu(a.tileID)}}case Pde.w7.privacy:{const s=e.data();return i&&(i.launchTileId=s.tileID),n.recordPanelAction({appId:s.tileID,appScenarioCapability:r,appScope:o,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.personalFlyoutPrivacyLink,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left,dataBag:i},t),i?.dispose(),void a.open(s.privacyUrl)}case Pde.w7.termsOfUse:{const s=e.data();return i&&(i.launchTileId=s.tileID),n.recordPanelAction({appId:s.tileID,appScenarioCapability:r,appScope:o,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.personalFlyoutTermsOfUseLink,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left,dataBag:i},t),i?.dispose(),void a.open(s.termsOfUseUrl)}case Pde.w7.permissions:{const a=e.data();return i&&(i.launchTileId=a.tileID),n.recordPanelAction({appId:a.tileID,appScenarioCapability:r,appScope:o,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.personalFlyoutItemPermissions,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.AppBar,panelRegion:GR.rP.left,dataBag:i},t),i?.dispose(),{command:Pu(a.tileID,"permissions")}}default:return void t.warn(`Received an unhandled Launch tile event, type: ${e.type}`)}})(r,t,n);case Pde.QG:return((e,t,n)=>{if(e.data){if(e.type===Pde.w7.suggestedLinkClick){const i=e.data(),{appId:a,isChannel:o}=JSON.parse(i.tileID);return n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.quickAccessLinkClicked,actionScenarioType:GR.DB.appBar,moduleName:GR.Sn.novaAppBar,panelRegion:GR.rP.left,threadType:o?"Channel":"GroupChat",extensibilityData:{id:a,scenarioCapability:SU.n3.tabs,scope:o?SU.bY.team:SU.bY.group,entryPoint:i.userSearchQuery?SU.f4.personalAppsFlyoutSearch:SU.f4.personalAppsFlyout}},t),{command:ju(i.tileID)}}t.warn(`Received an unhandled suggested link tile launch event, type: ${e.type}`)}else t.error("Received a suggested link tile launch event without data!")})(r,t,n);case Pde.Ju:return((e,t,n)=>{e.type!==Pde.w7.seeAllButtonClick?t.warn(`Received an unhandled see all button click event, type: ${e.type}`):n.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionScenario:GR.vB.flyoutSeeAllClicked,actionScenarioType:GR.DB.appBar,moduleName:GR.Sn.novaAppBar,panelRegion:GR.rP.left},t)})(r,t,n);case Fce.l.SimpleCollabSwitcher:return((e,t)=>{let n;switch(e.data?n=e.data():t.warn("No data in event",e),t.infoToTelemetry?.(`${e.type}: simpleCollabAppSplitViewEnabled: ${n?.simpleCollabAppSplitViewEnabled}, commandSource: ${n?.commandSource}`,"simple_collab_app_switcher_event"),e.type){case Fce.z.SwitchOnSimpleCollab:return{command:yd()};case Fce.z.SwitchOnSplitView:return{command:Sd()};case Fce.z.SwitchOffSimpleCollab:return n?.simpleCollabAppSplitViewEnabled?{command:vd({commandSource:n?.commandSource})}:void 0;case Fce.z.SwitchBackSurveySimpleCollab:const i={surveyId:n?.surveyId??"simpleCollabAppSwitcher",commandSource:n?.commandSource??A.p.SimpleCollabSwitchButton};return{command:fd(i)};default:return void t.warn(`Received an unhandled simple collab switcher event, type: ${e.type}`)}})(r,t);case Pde.D8:return{command:hm()};case Pde.T$:return((e,t,n,i)=>{switch(e.type){case Pde.w7.appBarImpression:return void n.stopScenarioIfActive(be.Cu.AppBarLoad);case Pde.w7.renderError:{let i;e.data&&(i=e.data());const a=i?.error||{};t.errorToTelemetry&&t.errorToTelemetry("AppBarRenderFailed!","webclient_framework_shell_appbar_render_failure_event",{type:a.name,error:a.message}),t.error(`AppBarRenderError::(name:${a.name}, message:${a.message})`);const o=/(?:\.\.\/)+[^\/]+\/|https?:\/\/[^\/]+\/[^\/]+\/|\.tsx/g,r=i?.errorInfo?.componentStack?.replace(o,"");t.error(`AppBarRenderErrorInfo::${r}`);const s=n.findScenario(be.Cu.AppBarLoad);return void(s&&s.fail())}case Pde.w7.flyoutOpened:return i.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionScenario:GR.vB.launchPersonalFlyout,actionScenarioType:GR.DB.appMgmt,moduleType:GR.nR.nav,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.appsFlyoutPopover,panelRegion:GR.rP.popover},t),{command:Du()};case Pde.w7.flyoutRendered:{if(!e.data)return void t.error("AppBarRender::Received a launch event without data!");const n=e.data(),a=i.createDatabag?.();return a&&(a.overflowCount=n.overflowCount),i.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionScenario:GR.vB.appsFlyoutOpen,actionScenarioType:GR.DB.appBar,moduleType:GR.nR.button,moduleName:GR.Sn.novaAppBar,panelType:GR.HP.appsFlyoutPopover,panelRegion:GR.rP.popover,dataBag:a},t),void a?.dispose()}case Pde.w7.flyoutButtonHover:return;default:return void t.warn(`AppBarRender::Received an unhandled Launch tile event, type: ${e.type}`)}})(r,t,i,n);case Br.Nv:if(r.type===Br.mu.toggleAppBar)return Promise.resolve({command:ee.toggleAppBar()});if(Jue(r))return Promise.resolve({command:ee.displayTitleBar({isDisplayed:!!(r.data?.()).isDisplayed})});case zue.B:return que(r,n,o,i)}return r.type===Yue.mu.openPhonelinkDialog?{command:m2()}:r.originator===Uue.bt?((e,t)=>{switch(e.type){case Uue.xk.addNewAccount:return{command:{actor:kne,action:bne,data:{commandSource:A.p.AddAccountFromMeMenu}}};case Uue.xk.switchTenant:const n=e.data?e.data().tenantId:void 0;return n?{command:Fne(n)}:void(t.errorToTelemetry&&t.errorToTelemetry("Me Control Switch Tenant called without tenant id.","webclient_framework_shell_event_handler_error"));case Uue.xk.switchAccount:const i=e.data?e.data().accountId:void 0;return i?{command:Ene(i)}:void(t.errorToTelemetry&&t.errorToTelemetry("Me Control Switch account called without account id.","webclient_framework_shell_event_handler_error"));default:return}})(r,t):r.originator===Uue.Vs?(e=>{switch(e.type){case Uue.xk.openMeControl:return{command:_ne()};case Uue.xk.signOut:return{command:Ane()};default:return}})(r):r.originator===Uue.vI?Hue(r,n,t):Promise.resolve(void 0)}},Jue=e=>e.type===Br.mu.displayTitleBar,Kue=async({commandInput:{command:e},requestContext:{loggerFactory:t}})=>{const n=e.action,i=t.newLogger("ShellApp onCommandReceived","apps-shell");return n===o2?"object"==typeof(a=e.data)&&null!==a&&"title"in a&&"intent"in a&&"dismissOnAction"in a?{command:{correlation:{source:A.p.Nova},stateTransition:g.Ar.none,visibilityState:g.Rp.show},entity:{type:ke.ck.inAppToast,action:ke.SY.create,id:(0,E.v4)()},entityOptions:e.data}:void i.errorNoPii?.(`Command for action '${e.action}' requires title, intent and dismissOnAction.`):n===r2?{command:{correlation:{source:A.p.Nova},stateTransition:g.Ar.extend,visibilityState:g.Rp.show},entity:{type:ke.ck.updatemsaprofileavatardialog,action:ke.SY.view}}:n===l2?{entity:{type:ke.ck.addphonelinkdialog,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Nova}}}:n===s2?{command:{correlation:{source:A.p.Nova},stateTransition:g.Ar.extend,visibilityState:g.Rp.show},entity:{type:ke.ck.updatemsaprofilenamedialog,action:ke.SY.view}}:void 0;var a},Zue=(e,t,n)=>(0,Pj.Kw)(e,t,n),Xue=({type:e,appRenderMode:t})=>{const n=new qz.D,i=[];return e===ke.ck.pearnotdefaultapp&&t===se.k.Main?i.push(Gz.m.APP_SWITCHER_CONFIRMATION_RENDERED):t===se.k.TitleBar?i.push(Gz.m.SHELL_TITLE_BAR_RENDERED):t===se.k.VerticalBar&&i.push(Gz.m.SHELL_APP_BAR_RENDERED),n.registerAppPhase({phase:m.Jj.CRITICAL,signals:i,timeout:6e4}),n.appPhases};var eme=n(203564),tme=n(244463),nme=n(879396);const ime={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellMeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}}]}}]}}]},ame={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellAttemptAutoDetectLocationShowSecondRunBannerMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attemptAutoDetectLocationShowSecondRunBanner"}}]}}]};var ome=n(510699);const rme="presence-donotdisturb-banner",sme="presence-statusmessage-banner",lme="Unknown";function cme(e){const{i18n:t,entityCommanding:n,loggerFactory:i,authenticationUser:a,client:o,coreSettings:r,userBiService:s}=e,l=i.newLogger("presence-state-subscription-logger","apps-shell"),d=o;return{id:"presence-prewarm-job",job:async()=>{const{enablePresenceTopBanner:e}=r.get(c.w.Presence),{enableAutoDetectLocationBanners:i}=r.get(c.w.Places,["enableAutoDetectLocationBanners"]);if(!e)return void l.log("presence state banner subscription is disabled");const o=await d.query({query:ime});let u;const m=d.subscribe({query:tme.C,variables:{userId:o.data.me?.mri,source:"ups"}}).subscribe((({data:e})=>{const{presenceUpdateEvent:o}=e||{};var r,c;o?.availability!==u?.availability&&(o?.availability===eme.e.DoNotDisturb?function(e,t){const n=e.stringTranslate("presence","dnd_info_banner_message"),i=e.stringTranslate("presence","presence_info_banner_change_settings"),a={source:A.p.ShellPresenceState},o="privacy_manage_priority_access",r={text:i,command:{entity:{type:ke.ck.settingsstore,action:ke.SY.view,id:aK.G.Privacy,linkedEntity:{id:o,action:ke.SY.view,type:ke.ck.settingsstore}},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,targetWindow:g.BA.main,correlation:a},entityOptions:{correlation:a}},dismissOnAction:!1};mme(rme,t,"PresenceDoNotDisturb",n,r)}(t,n):ume(rme,n)),r=o?.statusNote,c=u?.statusNote,(r?.message!==c?.message||r?.expiry!==c?.expiry)&&(o?.statusNote&&dme(o.statusNote)?function(e,t,n){let i;i=new Date(n??ome.Ae).getFullYear()>=ome.Hs||!n?e.stringTranslate("presence","status_note_expirynever_info_banner_message"):e.stringTranslate("presence","status_note_info_banner_message",{expiryTime:e.formatDateTime(new Date(n),nme.mT)});mme(sme,t,"PresencePinnedStatusNote",i)}(t,n,o?.statusNote?.expiry):ume(sme,n));const m=o?.workLocation,p=u?.workLocation;if(u&&m?.location!==p?.location&&"Office"===m?.location&&"VerifiedLocation"===m?.locationSource&&i&&async function(e,t){try{await e.mutate({mutation:ame})}catch{t.error("Error attempting to show second run banner.")}}(d,l),m?.location&&s){const e=s.createDatabag?.(),t=m?.location!==p?.location||m?.locationSource!==p?.locationSource,n=m?.approximateDetails?.id!==p?.approximateDetails?.id||m?.approximateDetails?.idType!==p?.approximateDetails?.idType;if(e&&(t||n)){if(e.workLocation=m?.location??lme,e.locationSource=m?.locationSource??lme,n){const t=!!p?.approximateDetails?.id,n=!!m?.approximateDetails?.id,i=!n&&t;e.workLocationDetails=n?"Set":i?"Cleared":"Empty"}$ue({userBiService:s,actionScenario:GR.vB.readWorkLocation,actionOutcome:GR.nd.read,moduleName:GR.Sn.presenceUpdateEventRead,moduleType:GR.nR.event,actionScenarioType:GR.DB.hybridPresence,actionGesture:GR.Od.asyncStateChange,logger:l,dataBag:e})}}u=o,l.log(`[Presence State Subscription] ID: ${a?.id}`)}));return()=>{m.unsubscribe(),l.log("[Presence] unsubscribing ...")}}}}const dme=e=>e.message?.includes("<pinnednote></pinnednote>");function ume(e,t){t.shell.dismissBanner(e,A.p.ShellPresenceState)}function mme(e,t,n,i,a,o){t.shell.showBanner({id:e,source:A.p.ShellPresenceState,intentLevel:"Neutral",cause:n,text:i,action:a,dismissable:!0,duration:0,dismissActionCommand:o})}const pme="downloading_weblogs";function gme(e){const{coreSettings:t,entityCommanding:n,i18n:i,loggerFactory:a,logsCollectorService:o}=e,r=a.newLogger("download-log-subscription-logger","apps-shell");return{id:"download-log-subscription",job:()=>{if(!o)return void r.log("logsCollectorService is invalid");if(t.get(c.w.Core).disableDownloadLogStatusSubscription)return void r.log("download log banner subscription is disabled");const e=o.observeDownloadLogStatus().subscribe((e=>{e?(r.debug("showing download log banner"),n.shell.showBanner({id:pme,source:A.p.LogsDownloading,bannerScenario:"downloading_Weblogs",intentLevel:"Neutral",duration:0,text:i.stringTranslate("framework","downloading_weblogs")})):(r.debug("dismissing download log banner"),n.shell.dismissBanner(pme,A.p.LogsDownloading))}));return()=>{e.unsubscribe()}}}}const hme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsShellUserPreferencesPlacesSettingsSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesChangedEventForCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"placesSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"autoLocationFirstRunBannerIncrementCount"}},{kind:"Field",name:{kind:"Name",value:"autoLocationSecondRunBannerLastShownDate"}}]}}]}}]}}]},vme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellUserPreferencesPlacesSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"placesSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"autoLocationFirstRunBannerIncrementCount"}},{kind:"Field",name:{kind:"Name",value:"autoLocationSecondRunBannerLastShownDate"}}]}}]}}]}}]};function yme(e){const{i18n:t,entityCommanding:n,loggerFactory:i,authenticationUser:a,client:o,coreSettings:r,userBiService:s}=e,l=i.newLogger("auto-detect-location-banners-logger","apps-shell"),d=o;return{id:"auto-detect-location-first-run-banner-prewarm-job",job:async()=>{const{enableAutoDetectLocationBanners:e}=r.get(c.w.Places,["enableAutoDetectLocationBanners"]);if(!e)return void l.log("enableAutoDetectLocationBanners is disabled");const{data:i}=await d.query({query:vme}),o=i?.userPreferences?.placesSettings,u=o?.autoLocationFirstRunBannerIncrementCount,m=o?.autoLocationSecondRunBannerLastShownDate;let p=u,h=m;const v=d.subscribe({query:hme,variables:{category:"placesSettings"}}).subscribe((({data:e})=>{const i=e?.userPreferencesChangedEventForCategory?.placesSettings,o=i?.autoLocationFirstRunBannerIncrementCount,r=i?.autoLocationSecondRunBannerLastShownDate;0===p&&1===o&&function(e,t,n,i){const a=e.stringTranslate("presence","presence_location_auto_updated_first_run_banner_title"),o=e.stringTranslate("presence","presence_location_auto_updated_first_run_banner_text"),r=e.stringTranslate("presence","presence_location_auto_updated_first_run_banner_cta_button");t.shell.showBanner({id:"presence-auto-location-first-run-banner",source:A.p.ShellPresenceState,intentLevel:"Location",cause:"PresenceAutoLocationUpdate",title:a,text:o,dismissable:!0,duration:0,action:{text:r,command:{entity:{type:ke.ck.autodetectlocationfirstrunbanner,action:ke.SY.view}},dismissOnAction:!0},bannerScenario:"presence_auto_location_first_run_banner"}),Sme(n,i,GR.HP.autoLocationFirstRunBanner)}(t,n,s,l),!h&&r&&function(e,t,n,i){const a=e.stringTranslate("presence","presence_location_auto_updated_banner_title"),o=e.stringTranslate("presence","presence_location_auto_updated_banner_text"),r=e.stringTranslate("presence","presence_location_auto_updated_banner_settings_link");t.shell.showBanner({id:"presence-auto-location-second-run-banner",source:A.p.ShellPresenceState,intentLevel:"Location",cause:"PresenceAutoLocationUpdate",title:a,text:o,dismissable:!0,duration:0,action:{text:r,command:{entity:{id:aK.G.Privacy,type:ke.ck.settingsstore,action:ke.SY.view},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.ShellPresenceState}}},dismissOnAction:!0},bannerScenario:"presence_auto_location_update_banner"}),Sme(n,i,GR.HP.autoLocationSecondRunBanner)}(t,n,s,l),p=o,h=r,l.log(`[AutoDetectLocationBanners] ID: ${a?.id}`)}));return()=>{v.unsubscribe(),l.log("[AutoDetectLocationBanners] unsubscribing ...")}}}}function Sme(e,t,n){const i={panelType:n,panelRegion:GR.rP.banner};e?.recordPanelView(i,t)}const fme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellUserLicenseDetailsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userLicenseDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isTrial"}},{kind:"Field",name:{kind:"Name",value:"exploratoryTrialLicenseEndDate"}}]}}]}}]};function kme(e){const{client:t,entityCommanding:n,loggerFactory:i,coreSettings:a,i18n:o}=e,r=i.newLogger("exploratory-upgrade-banner-job","apps-shell"),s=t,l="smb_web_and_desktop_growth_exploratory_upgrade_banner";return{id:"exploratory-upgrade-banner-job",job:async()=>{const{enableExploratoryExpiryBanner:t,exploratoryExpirySevereBannerDaysBeforeExpiryThreshold:i}=a.get(c.w.Growth);if(!t)return;const d=performance.now();try{let t;try{t=await s.query({query:fme})}catch{return void r.errorToTelemetry?.("Failed to get user license details",l)}const{isTrial:u,exploratoryTrialLicenseEndDate:m}=t?.data?.userLicenseDetails||{};if(!u)return void r.infoToTelemetry?.("Skip because user is not trial",l);if(!m)return void r.errorToTelemetry?.("exploratoryTrialLicenseEndDate is not present in the trial user's license details",l);const p=function(e){const t=e.localStorage.getItem(Zde);if(!t)return null;const n=new Date(t);return isNaN(n.getTime())?null:n}(e.windowProvider),h=function(e){return Xde(new Date,e)}(m);if(!function(e,t,n){const{exploratoryExpiryBannerDaysBeforeExpiryThreshold:i,exploratoryExpiryBannerNoCooldownThreshold:a,exploratoryExpiryBannerCooldownInDays:o}=n.get(c.w.Growth),r=o||0;return e<(i||0)&&(e<(a||0)||null===t||Xde(t,new Date)>r)}(h,p,a)){const e=performance.now()-d;return void r.infoToTelemetry?.("Trial user not eligible for banner",l,{totalRequestTime:e})}const v=h<(i||0)?"Severe":"Neutral",y=o.formatDateTime(m,nme.zc);await o.waitForNamespace("growth");const S=o.stringTranslate("growth","exploratory_expiry_banner_text",{expiryDate:y}),f=o.stringTranslate("growth","exploratory_expiry_banner_action");n.shell.showBanner({id:"exploratoryExpirationBanner",source:A.p.ExploratoryUpgradeBannerJob,intentLevel:v,dismissable:!0,text:S,action:{dismissOnAction:!0,text:f,command:{entity:{type:ke.ck.exploratorylicensenotificationbanner,action:ke.SY.info},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.ExploratoryUpgradeBannerJob}}}},dismissActionCommand:{entity:{type:ke.ck.exploratorylicensenotificationbanner,action:ke.SY.delete}},duration:0,bannerScenario:"exploratory_expiration_banner"});const k=performance.now()-d;r.infoToTelemetry?.(`Queued banner with severity ${v}`,l,{totalRequestTime:k})}catch(e){const t=performance.now()-d;r.errorToTelemetry?.("Failed to show exploratory product banner",l,{totalRequestTime:t})}}}}const Cme=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(181316),n.e(725973),n.e(842242),n.e(459959),n.e(984165),n.e(215618),n.e(867529),n.e(214218),n.e(811751),n.e(166017),n.e(698386),n.e(852774),n.e(909600),n.e(826932),n.e(49749),n.e(119068),n.e(27001),n.e(317183),n.e(367741),n.e(845091),n.e(814583),n.e(153409),n.e(43328),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(151748),n.e(370494),n.e(652658),n.e(296222),n.e(198771),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(834558),n.e(77029),n.e(684694),n.e(428410),n.e(813370),n.e(478723),n.e(288919),n.e(337595),n.e(223810),n.e(639495),n.e(743566),n.e(119940),n.e(670225),n.e(644740),n.e(876965),n.e(556261),n.e(969355),n.e(736579),n.e(443621)]).then(n.bind(n,668280)),bme=({host:e,screenState:t,isResize:n})=>{if(n){if(!xue.windowFeatures)return null;const{offset:e,...t}=xue.windowFeatures;return t}const{height:i,minHeight:a,minWidth:o,offset:r,width:s}=xue.windowFeatures||{},l=e?.screenX||0,c=e?.screenY||0,d=(t?.numOpenWindows||1)*(r||1);return{additionalFeatures:{minHeight:`${a}`,minWidth:`${o}`},height:i,left:l+d,minHeight:a,minWidth:o,top:c+d,width:s}};function wme(e){xue.supportedRenderModes?.push(se.k.PartialOverlay),xue.supportedRenderModes?.push(se.k.OverlayThinHorizontalBar);return{getAppPhases:Xue,getAppViewEntities:wde,getAppViewEntitiesProps:Dde,getAppWindowFeatures:bme,getEventScenarioData:xde,manifest:xue,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="shell-app";t("ChunkLoadStarted",{chunkName:i});const a=(await(0,ev.wg)(Cme,i,n)).T2ShellViewsRenderer;return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(a,{appRenderMode:e})},onPreWarm:e=>{const{context:t}=e,n=[bue(t),yme(t),Iue(t),Pue(t),cme(t),gme(t),kme(t),Eue(t)],i=function(e){const{client:t,coreSettings:n}=e,i=t;if(n.get(c.w.CdlWorker).enableStartupDeferral)return{id:"worker-start-sync",runOncePerId:!0,job:()=>{i.mutate({mutation:Rue,fetchPolicy:"no-cache",variables:{}})}}}(t);return i&&n.push(i),n},onBeforeDeeplinkParsed:uue,eventHandlers:Que,onBeforeIntentAuthenticated:mue,onBeforeCommandHandled:due,onBeforeUpdateHistoryItem:Zue,onCommandReceived:Kue,onExperienceLongIdle:gue}}const Tme={StoreDevices:"StoreDevices",StoreCartCheckout:"StoreCartCheckout",StoreCart:"StoreCart"},Ime="viewStoreCartCheckout",Nme="viewDeviceDetails",Ame="viewStoreCart",Eme="closeStoreCartCheckout",Fme=e=>({actor:Tme.StoreDevices,action:Nme,data:e}),_me=()=>({actor:Tme.StoreCart,action:Ame}),Dme=e=>({actor:Tme.StoreCartCheckout,action:Ime,data:e}),Pme=()=>({actor:Tme.StoreCartCheckout,action:Eme}),Mme=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("StoreApp onCommandReceived","apps-store");if(e.command.actor===pm||e.command.actor===Tme.StoreDevices||e.command.actor===Tme.StoreCartCheckout||e.command.actor===Tme.StoreCart)switch(n){case gm:return{entity:{type:ke.ck.store,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}};case Nme:return{entity:{type:ke.ck.devicedetails,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Store}},entityOptions:e.command.data};case Ame:return{entity:{type:ke.ck.storecart,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Store}}};case Ime:return{entity:{type:ke.ck.storecartcheckout,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.Store}},entityOptions:e.command.data};case Eme:return{entity:{type:ke.ck.storecartcheckout,action:ke.SY.view},command:{visibilityState:g.Rp.hide,stateTransition:g.Ar.flush,correlation:{source:A.p.Store}}};default:i.error(`Command action '${n}' is not supported by StoreApp.`)}else i.error(`Command for actor '${e.command.actor}' cannot be handled by StoreApp.`)},Rme=e=>{if(xme(e))return Lme(e)?{subNavEntity:Ome(e),headerEntity:jme(e),startEntity:Bme(e),mainEntity:Ume(e),endEntity:$me(e)}:null},xme=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.store].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Lme=()=>!0,Ome=()=>null,jme=()=>null,Bme=()=>null,Ume=({entity:e})=>e,$me=()=>null,Wme={id:"com.microsoft.teams.store",name:"StoreApp",actors:[pm,...Object.keys(Tme)],getLocalizedName:async e=>(await e.waitForNamespace("extensibility"),e.stringTranslate("extensibility","extensibility_apps_label")),supportedEntities:[ke.ck.store,ke.ck.storefre,ke.ck.devicedetails,ke.ck.storecart,ke.ck.storecartcheckout],supportedRenderModes:[se.w.Main,se.w.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},Vme="/subscriptionmanagement",Hme={filter:(e,t)=>!!e?.pathname?.toLowerCase().startsWith("/l/subscriptionmanagement")||!!e?.pathname?.toLowerCase().startsWith(Vme)||Boolean(e.hash)&&(t?.pathname?.toLowerCase()||"").startsWith(Vme),execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableSubscriptionManagementInStore:n}=e.get(c.w.Extensibility),i=t.newLogger("Store:BeforeDeeplinkParsedCondition","apps-store");return n?(i.log("execute command handleSubscriptionManagementDeeplink"),Promise.resolve({entityCommand:{entity:{type:ke.ck.store,action:ke.SY.manage},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,layoutMode:Yt.Rm.standard},entityOptions:{tabType:"Subscriptions"}},metadata:{allowAnonymous:!1}})):(i.log(`Teams app subscription management is not enabled, enableSubscriptionManagementInStore value is ${n}`),Promise.reject({message:"teams-app-subscription-management-not-enabled"}))}},zme={filter:e=>e.pathname?.startsWith("/l/store"),execute:async({deeplinkUrl:e})=>{const t=e.searchParams.get("id")??"",n=e.searchParams.get("tabType");return n?Promise.resolve({entityCommand:{entity:{id:t,type:ke.ck.store,action:ke.SY.manage},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show}},entityOptions:{tabType:n},metadata:{allowAnonymous:!1}}):Promise.resolve({entityCommand:{entity:{id:t,type:ke.ck.store,action:ke.SY.view},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}})}},qme={filter:e=>e.pathname?.startsWith("/l/manageApps"),execute:async({deeplinkUrl:e})=>{const t=e.searchParams.get("id")??"",n=e.searchParams.get("scope")??"",i="Team"===n;return Promise.resolve({entityCommand:{entity:{type:i?ke.ck.teammanageapps:ke.ck.chatManageApps,action:i?ke.SY.view:ke.SY.manage,id:t,linkedEntity:{type:i?ke.ck.channels:ke.ck.chats,id:t}},command:{stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.show,targetWindow:g.BA.main},entityOptions:{id:t,scope:n}},metadata:{allowAnonymous:!1}})}},Gme={filter:e=>{if(!e.pathname.startsWith("/l/app"))return!1;const{pathname:t}=e,n=t?.split(/[/?&]/),i=n?.indexOf("app"),a=n?.[i+1];return!!a},execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("Store_handleAppInstallDeeplink","apps-store"),{pathname:i,search:a}=e,o=new URLSearchParams(a),r=o.get("source"),s=o.get("sharedAppResource"),l=o.get("viewState"),c=o.get("templateInstanceId"),d=o.get("environment"),u=o.get("installAppPackage"),m=o.get("appTenantId"),p=o.get("scrollToSection"),h=o.get("tenantId"),v=i?.split(/[/?&]/),y=v?.indexOf("app"),S=v?.[y+1];let f;try{if("string"!=typeof l||l!==fU.AR.PostReview&&l!==fU.AR.ViewReviews){const e=l&&JSON.parse(l);"object"==typeof e&&"name"in e&&e.name in fU.AR&&(f=e)}else f={name:l}}catch{}const k=!!u&&!c,C="TaosSharedApp"===s??void 0;let b=fU.NS.DeepLink;k?b=fU.NS.DeepLinkSideLoad:c&&(b=fU.NS.DeepLinkTrustedSideLoad);const w={appId:S,deepLinkSource:r||"unknown",templateInstanceId:c||void 0,environment:d||void 0,installAppPackage:!!u,appTenantId:m||void 0,entryPoint:b,viewOptions:{defaultViewState:f,scrollToSection:p||void 0},isDebugging:k,isTaosSharedApp:C};return n.log("execute command handleAppInstallDeeplink"),Promise.resolve({entityCommand:{entityOptions:w,entity:{id:S,type:ke.ck.platformapp,action:ke.SY.create},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.StageViewDeeplink}}},metadata:{allowAnonymous:!1,tenantId:h||void 0}})}};var Yme;!function(e){e.DeviceIdNotFound="device-id-not-found",e.isTeamsRoomDeviceNotFound="is-teams-room-device-not-found",e.DeviceStoreAdminNotEnabled="device-store-admin-not-enabled",e.DeeplinkDisabled="deeplink-disabled"}(Yme||(Yme={}));const Qme=[Hme,zme,qme,Gme,{filter:e=>{if(!e.pathname.startsWith("/l/marketplace"))return!1;return!!e.searchParams.get("deviceId")},execute:({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n}})=>{const{deviceStoreAdminEnabled:i,enableDeepLinkShare:a}=t.get(c.w.Marketplace,["deviceStoreAdminEnabled","enableDeepLinkShare"]),o=n.newLogger("Store_handleDeviceDetailsDeeplink","apps-store");i||o.warn(Yme.DeviceStoreAdminNotEnabled),a||o.warn(Yme.DeeplinkDisabled);const r=e.searchParams.get("deviceId")??"",s=e.searchParams.get("isTeamsRoomDevice")??"",l=["true","false"].includes(s.toLowerCase())?"true"===s.toLowerCase():null;r||o.warn(Yme.DeviceIdNotFound),null===l&&o.warn(Yme.isTeamsRoomDeviceNotFound);const d={deviceId:r,isTeamsRoomDevice:l,entryPoint:fU.NS.DeepLink};return Promise.resolve({entityCommand:{entity:{type:ke.ck.devicedetails,action:ke.SY.view,id:r},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:A.p.ChatDeeplinkMessage}},entityOptions:d},metadata:{allowAnonymous:!1}})}}];var Jme=n(211489);const Kme={onEventReceived:async({eventInput:{event:e,source:t}})=>(0,Jme.B4)(e)?Promise.resolve({command:Fme(e.data()),source:t}):(0,Jme.sT)(e)?Promise.resolve({command:_me(),source:t}):(0,Jme.QV)(e)?Promise.resolve({command:Dme(e.data()),source:t}):(0,Jme.Sx)(e)?Promise.resolve({command:Pme(),source:t}):Promise.resolve(void 0)},Zme=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(181316),n.e(598188),n.e(725973),n.e(984165),n.e(616161),n.e(185332),n.e(729849),n.e(484331),n.e(214218),n.e(736709),n.e(306517),n.e(964401),n.e(231020),n.e(568721),n.e(524147),n.e(845039),n.e(964859),n.e(940543),n.e(296930),n.e(122814),n.e(613193),n.e(92198),n.e(5982),n.e(353927),n.e(307339),n.e(168524),n.e(531240),n.e(36015),n.e(46687),n.e(931455),n.e(964073),n.e(307422),n.e(94139),n.e(467129),n.e(202564),n.e(712284),n.e(938671),n.e(527908),n.e(449127),n.e(268921),n.e(351715),n.e(221963),n.e(711866),n.e(891306),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(684694),n.e(53131),n.e(813370),n.e(385242),n.e(351057),n.e(634370),n.e(399289),n.e(615071),n.e(620368),n.e(945565),n.e(225748),n.e(798002),n.e(283628),n.e(565544)]).then(n.bind(n,251379)),Xme=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(787454),n.e(181316),n.e(842242),n.e(984165),n.e(616161),n.e(729849),n.e(867529),n.e(214218),n.e(102216),n.e(307339),n.e(345785),n.e(307422),n.e(94139),n.e(449127),n.e(268921),n.e(351715),n.e(711866),n.e(727039),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(684694),n.e(53131),n.e(813370),n.e(385242),n.e(351057),n.e(399289),n.e(743566),n.e(670225),n.e(664680)]).then(n.bind(n,983995)),epe=()=>Promise.all([n.e(703083),n.e(393873)]).then(n.bind(n,343772)),tpe=()=>Promise.all([n.e(746112),n.e(478883),n.e(248701),n.e(194875)]).then(n.bind(n,412029));function npe(){const e=()=>null;return{getPlatformAppIdForEntity:e=>e.type===ke.ck.store?"ac40aa4a-fef1-4896-aea2-46d1c14dbfd5":void 0,onCommandReceived:Mme,getAppViewEntities:Rme,manifest:Wme,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){const e="store-app";n("ChunkLoadStarted",{chunkName:e});const[{StoreEntryRenderer:t}]=await Promise.all([(0,ev.wg)(Zme,e,i),(0,ev.wg)(epe,e,i),(0,ev.wg)(tpe,e,i)]);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(t,{})})}if(t===se.w.Modal){const e="store-fre-modal";n("ChunkLoadStarted",{chunkName:e});const{Modal:t}=await(0,ev.wg)(Xme,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(t,{})})}return(0,Lr.Y)(e,{})},onBeforeDeeplinkParsed:Qme,eventHandlers:Kme}}const ipe={id:"com.microsoft.teams.survey-form",name:"SurveyFormApp",supportedEntities:[ke.ck.survey,ke.ck.givefeedbackchoices],supportedRenderModes:[se.w.Main,se.w.Modal],windowFeatures:{[ke.ck.survey]:{minWidth:600,width:800,minHeight:400,height:640,offset:20},[ke.ck.givefeedbackchoices]:{minWidth:602,width:602,minHeight:500,height:500,offset:20}}},ape=e=>{if(ope(e))return rpe(e)?{subNavEntity:spe(e),headerEntity:lpe(e),startEntity:cpe(e),mainEntity:dpe(e),endEntity:upe(e)}:null},ope=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o={[ke.ck.givefeedbackchoices]:[ke.SY.default,ke.SY.view],[ke.ck.survey]:[ke.SY.default,ke.SY.view]},r=n&&(o[i]||[]).includes(n);return!(!a||!r)},rpe=()=>!0,spe=()=>null,lpe=()=>null,cpe=()=>null,dpe=({entity:e})=>e,upe=()=>null,mpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"bootstrapFloodgate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"firstLoginInformation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bootstrapFloodgate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"firstLoginInformation"},value:{kind:"Variable",name:{kind:"Name",value:"firstLoginInformation"}}},{kind:"Argument",name:{kind:"Name",value:"userSurveyNotificationEnabled"},value:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}}}]}]}}]},ppe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"onSurveySend"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"onSurveySend"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"coachmarkId"}}]}}]}}]},gpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesForCategorySubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesChangedEventForCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEnableSurveysNotification"}}]}}]}}]},hpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSurveyFormFloodgateUpdateUserSurveyNotificationEnabledMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateUpdateUserSurveyNotificationEnabled"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userSurveyNotificationEnabled"},value:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}}}]}]}}]},vpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"firstLoginInfo"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"firstLoginInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Web"}}]}}]}.definitions]},ype={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"userEnableSurveysNotification"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Web"}},{kind:"Field",name:{kind:"Name",value:"WebNorthStar"}},{kind:"Field",name:{kind:"Name",value:"maglev"}},{kind:"Field",name:{kind:"Name",value:"electron"}}]}}]}.definitions]},Spe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSurveyFormGetTeamsMeetingPoliciesQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamsMeetingConfiguration"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"enableQoS"}},{kind:"Field",name:{kind:"Name",value:"clientAudioPort"}},{kind:"Field",name:{kind:"Name",value:"clientAudioPortRange"}},{kind:"Field",name:{kind:"Name",value:"clientVideoPort"}},{kind:"Field",name:{kind:"Name",value:"clientVideoPortRange"}},{kind:"Field",name:{kind:"Name",value:"clientAppSharingPort"}},{kind:"Field",name:{kind:"Name",value:"clientAppSharingPortRange"}},{kind:"Field",name:{kind:"Name",value:"disableAnonymousJoin"}},{kind:"Field",name:{kind:"Name",value:"feedbackSurveyForAnonymousUsers"}}]}}]}}]},fpe=async e=>{const t=await e.query({query:ype});return t.data?.userPreferences?.firstLoginInformation},kpe="telemetry_instrumentation_feedback_platform_app_job_setup_floodgate",Cpe=async(e,t,n,i,a)=>{let o=null,r=null;if(i){const t=await fpe(e),n=a?[t?.maglev,t?.WebNorthStar]:[t?.electron,t?.Web];o=n.every((e=>!e||isNaN(Date.parse(e)))),r=n.map((e=>e&&!isNaN(Date.parse(e))?new Date(e):new Date)).reduce(((e,t)=>e<t?e:t),new Date).toISOString()}else{let t=null;t=n?await fpe(e):await(async e=>{const t=await e.query({query:vpe});return t.data?.userPreferences?.firstLoginInformation??null})(e),r=t?.Web||"",o=!r}return o&&t.errorToTelemetry?.(`First login information is not available! with enableUserPreferencesForCategoryQuery : ${n?"enabled":"disabled"} enableClientBasedFirstLoginInformation : ${i?"enabled":"disabled"} isReactWebClient : ${a?"yes":"no"}`,kpe),r},bpe=(e,t,n,i,a,o)=>({id:"bootstrap-floodgate",runOncePerId:!0,job:async()=>{const{enableUserPreferencesForCategoryQuery:r,enableClientBasedFirstLoginInformation:s}=a.get(c.w.Feedback),{isReactWebClient:l}=a.get(c.w.Extensibility),{enableEnforcingFeedbackTeamsPolicyForAnonUsers:d}=a.get(c.w.Calling),u=n.newLogger("getBootstrapFloodgateJob","apps-suvey-form");u.log(`[getBootstrapFloodgateJob] Initializing floodgate [isAnonymousUser=${o}]`);try{if(o&&d){const t=await e.query({query:Spe});if(t.error)return void u.errorToTelemetry?.("[getBootstrapFloodgateJob] Failed to query teams meeting configuration.",kpe);if(!t.data||t.loading)return void u.errorToTelemetry?.("[getBootstrapFloodgateJob] Failed to get data from the query for teams meeting configuration.",kpe);if(t.data&&"Disabled"===t.data?.teamsMeetingConfiguration?.feedbackSurveyForAnonymousUsers)return void u.log("[getBootstrapFloodgateJob] TeamsMeetingConfiguration policy has disabled surveys for anonymous users.")}const n=(new Date).toISOString(),a=o?n:await Cpe(e,u,r,s,l),c=o?null:await(async e=>{const t=await e.query({query:ype});return t.data?.userPreferences?.userEnableSurveysNotification??null})(e),m=await e.subscribe({query:ppe,fetchPolicy:"no-cache"}).subscribe((async({data:e,errors:n})=>{if(n){u.errorToTelemetry?.("[getBootstrapFloodgateJob] Error subscribing to floodgate. Stopping the subscription",kpe);try{m.unsubscribe()}catch(e){u.errorToTelemetry?.("[getBootstrapFloodgateJob] Error stopping floodgate",kpe)}}u.log?.(`Activated survey: ${e?.onSurveySend.id} with coachmark ${e?.onSurveySend.coachmarkId}`,kpe),e?.onSurveySend.coachmarkId&&(await t.esp.displaySurface(e.onSurveySend.coachmarkId),i.newScenario(be.Cu.FloodgateSurvey).stop({context:JSON.stringify({surveyId:e?.onSurveySend.id,coachmarkId:e?.onSurveySend.coachmarkId})}))}));await e.mutate({mutation:mpe,variables:{firstLoginInformation:a,userSurveyNotificationEnabled:c}});const p=await e.subscribe({query:gpe,variables:{category:"userEnableSurveysNotification"},fetchPolicy:"no-cache"}).subscribe((async({data:t,errors:n})=>{if(n){u.errorToTelemetry?.("[getBootstrapFloodgateJob] Error subscribing to userSettings. Stopping the subscription",kpe);try{p.unsubscribe()}catch(e){u.errorToTelemetry?.("[getBootstrapFloodgateJob] Error stopping userSurveyNotificationEnabledSubscription",kpe)}}const i=t?.userPreferencesChangedEventForCategory?.userEnableSurveysNotification;null!=i&&await e.mutate({mutation:hpe,variables:{userSurveyNotificationEnabled:i}})}))}catch(e){u.errorToTelemetry?.(`[getBootstrapFloodgateJob] Error initializing floodgate [error.name=${e?.name}] [isAnonymousUser=${o}]`,kpe)}u.log("[getBootstrapFloodgateJob] Floodgate initialized")}}),wpe=({context:{client:e,coreSettings:t,loggerFactory:n,entityCommanding:i,scenarioFactory:a,authenticationUser:o}})=>{const{enableFloodgateService:r,enableFloodgateServiceOnExperienceIdle:s,enableAnonMeetingEndNpsSurvey:l,enableFloodgateInCore:d}=t.get(c.w.Feedback),u=[],m=e,p=o?.type===pg.aS.Anonymous;return!r||d||s&&!(p&&l)||u.push(bpe(m,i,n,a,t,p)),u},Tpe=({context:{floodgateService:e,windowProvider:t,isMainWindow:n,coreSettings:i,client:a,loggerFactory:o,scenarioFactory:r,authenticationUser:s,entityCommanding:l}})=>{const d=[];if(n){const{enableFloodgateService:n,enableFloodgateInCore:u}=i.get(c.w.Feedback);if(n&&e&&u){const n=a,c=s?.type===pg.aS.Anonymous,u=t.document.createElement("div");u.id="floodgateSurveyContainer",t.document.body.appendChild(u),e.setSurveyContainer(u),d.push(bpe(n,l,o,r,i,c))}}return d},Ipe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSurveyFormFloodgateLogActivityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activityName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"increment"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateLogActivity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activityName"},value:{kind:"Variable",name:{kind:"Name",value:"activityName"}}},{kind:"Argument",name:{kind:"Name",value:"increment"},value:{kind:"Variable",name:{kind:"Name",value:"increment"}}}]}]}}]};class Npe extends xp{constructor(){super(d.c1.GeneralizedLogActivityTask,["client","hostCommunicationService","coreSettings","loggerFactory"])}async execute(e){const{client:t,hostCommunicationService:n,coreSettings:i,loggerFactory:a}=e,o=a.newLogger("generalizedLogActivityTask","apps-suvey-form"),r=i?.get(c.w.SurveyForm).enableCsatTaskRegistration;if(r){if(!n)return;try{const e=await n.loadModule("surveyform"),i=e?.registerForLogActivity?.((e=>{((e,t,n)=>{e.mutate({mutation:Ipe,variables:{activityName:t,increment:n}})})(t.client,e.activityName,e.incrementValue)}));return()=>{i&&i()}}catch(e){return void o.errorToTelemetry?.(`Loading module surveyform failed with errorCode: ${e.errorCode}`,"generalized_log_activity_task")}}}}const Ape=({context:{client:e,coreSettings:t,loggerFactory:n,entityCommanding:i,scenarioFactory:a}})=>{const{enableFloodgateService:o,enableFloodgateServiceOnExperienceIdle:r,enableFloodgateInCore:s}=t.get(c.w.Feedback),l=[],d=e;return o&&!s&&r&&l.push(bpe(d,i,n,a,t,false)),l},Epe=()=>Promise.all([n.e(953696),n.e(224316),n.e(416397),n.e(725973),n.e(393706),n.e(53556),n.e(92198),n.e(836070),n.e(830355),n.e(856565),n.e(70236),n.e(307422),n.e(636570),n.e(899250),n.e(446471),n.e(478723),n.e(33912),n.e(142043)]).then(n.bind(n,708275)),Fpe=new Map([["General_BRB",780],["General_Smile_Internal",780],["General_Smile",730],["General_Frown",730]]),_pe=({host:e,entityType:t,entityOptions:n})=>{if(!e)return null;const{windowFeatures:i}=ipe,a=t&&"survey"===t&&n&&JSON.parse(n)?.feedbackMetadata?.feedbackType,o=t&&i&&i[t]?i[t]:i??void 0,r=Fpe.get(a)||0,{height:s=1,width:l=1,minHeight:c,minWidth:d}=o||{},u={left:e.screenX,top:e.screenY};if(e.screen){return{left:Math.max((e.screen.availWidth-l)/2,0),top:Math.max((e.screen.availHeight-s)/2,0),additionalFeatures:{minHeight:`${c}`,minWidth:`${d}`},minHeight:c,minWidth:d,height:Math.min(Math.max(s,r),e.screen.availHeight),width:Math.min(l,e.screen.availWidth)}}return{left:Math.max(u.left,0),top:Math.max(u.top,0),additionalFeatures:{minHeight:`${c}`,minWidth:`${d}`},minHeight:c,minWidth:d,height:Math.max(s,r),width:l}};var Dpe=n(319600),Ppe=n(835953);const{getSidePaneState:Mpe,setSidePaneState:Rpe,getSidePaneEndEntity:xpe,appendSidePaneDataToCommandScenario:Lpe}=(0,Ppe.R)({});var Ope=n(986223),jpe=n(976003),Bpe=n(254889);const Upe=e=>{if(!Wpe(e))return;const{entity:t,coreSettings:n}=e,i=$pe(t,n),a={...e,entity:i};return{subNavEntity:Vpe(a),headerEntity:Ype(a),startEntity:Qpe(a),mainEntity:Jpe(a),endEntity:Xpe(a)}},$pe=(e,t)=>{if(e.action===ke.SY.default&&(e.type===ke.ck.simplecollabchats||e.type===ke.ck.simplecollabchannels)){const n={...e};if(e.id)n.action=ke.SY.view;else{Ope.simpleCollabStore.set(Ope.selectedAppIdAtom,e.type);const i=Ope.simpleCollabStore.get(Ope.selectedConversationIdAtom);if(!wge(i,t))return e;switch(e.type){case ke.ck.simplecollabchats:i&&(n.id=i,n.action=ke.SY.view);break;case ke.ck.simplecollabchannels:{const e=Ope.simpleCollabStore.get(Ope.selectedTeamIdAtom);i&&e&&(n.id=JSON.stringify({channelId:i,teamId:e}),n.action=ke.SY.view);break}}}return n}return e},Wpe=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=["focus","standard"].includes(t),o=[ke.ck.simplecollab,ke.ck.simplecollabchats,ke.ck.simplecollabchannels,ke.ck.simplecollabcreateconversationfolder,ke.ck.simplecollabremoveconversationfolder,ke.ck.teamseeallchannels,ke.ck.simplecollabrenameconversationfolder,ke.ck.simplecollabmanageteamchannels,ke.ck.simplecollabswitchbackconfirmationdialog,ke.ck.simplecollabhideallchannelsdialog].includes(i),r=[ke.SY.create,ke.SY.default,ke.SY.info,ke.SY.list,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},Vpe=({entity:e,layoutMode:t})=>{if("focus"===t)return null;const{type:n,options:i,windowOptions:a}=e,o=n;return{action:ke.SY.list,entityState:{flushableByLinkedEntity:!0},linkedEntity:null,type:o,windowOptions:a,options:i}},Hpe=e=>{const t=(0,d3.vf)(e);return t?.ifConvUxChannel&&t?.source===A.p.InternalDeeplink},zpe=(e,t)=>{let n=e.type;if(t?.type===ke.ck.simplecollabmanageteamchannels)return ke.ck.teamchannels;switch(n){case ke.ck.simplecollabchats:return ke.ck.chats;case ke.ck.simplecollabchannels:return ke.ck.channels}if(e.id){n=ke.ck.chats;try{const t=JSON.parse(e.id);t?.channelId?n=ke.ck.channels:t?.teamId&&(n=ke.ck.teamseeallchannels)}catch{}}return n},qpe=(e,t)=>t?.type===ke.ck.simplecollabmanageteamchannels?t.options:e.options,Gpe=(e,t)=>{if(Zpe(e,t))return Kpe(e).convId;if(Hpe(e)){const t=(0,d3.Wo)(e);return t?.channelId}return e.id||""},Ype=({entity:e,contextEntity:t})=>{if(t&&t.action===ke.SY.view)switch(t.type){case ke.ck.channels:case ke.ck.teamseeallchannels:case ke.ck.teammanage:case ke.ck.teammembers:case ke.ck.teamchannels:case ke.ck.teampendingrequests:case ke.ck.teamsettings:case ke.ck.teamanalytics:case ke.ck.teammanageapps:case ke.ck.teammanagetags:case ke.ck.extensions:case ke.ck.channelmanage:case ke.ck.channelmembers:case ke.ck.channelanalytics:case ke.ck.channelapps:case ke.ck.channelsettings:case ke.ck.channelinvitations:case ke.ck.channeltags:case ke.ck.discoversurface:case ke.ck.useronboardingteam:case ke.ck.headlineslice:return t}const n=Gpe(e);return{...e,id:n,type:zpe(e,t),options:qpe(e,t)}},Qpe=()=>null,Jpe=({entity:e,contextEntity:t,coreSettings:n})=>{let i=ke.SY.view;const{action:a=null}={...e},o=[ke.SY.view,ke.SY.default,ke.SY.create];a&&o.includes(a)&&(i=a);let r=(0,d3.vf)(e);const s=zpe(e);if(Hpe(e)){const n=(0,d3.Wo)(e),a=r.deepLinkId===n?.replyChainId?r.deepLinkId:void 0;return t||{...e,action:i,type:s,id:n?.channelId,options:(0,ge.hR)({...r,deepLinkId:a})}}r=Zpe(e,n)?(0,ge.hR)({...r,messageId:void 0}):(0,ge.hR)(r);const l=Gpe(e,n);return t||{...e,action:i,type:s,id:l,options:r}},Kpe=e=>{const[t="",n=""]=e?.id?.split(";replyChainId=")??[];return{convId:t,replyChainId:n}},Zpe=(e,t)=>{if(!e||!t)return!1;const{replyChainId:n}=Kpe(e),{enableThreadingInChat:i}=t.get(c.w.Messaging);return"chats"===zpe(e)&&!!n&&i},Xpe=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const o=zpe(e);return o===ke.ck.chats?tge({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a}):o===ke.ck.channels?ege({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a}):null},ege=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const o=t?.id||e.id,r=t?.type||e.type,s=t?.options??e.options,l=JSON.parse(s??"{}"),d=xpe(o,t,a,n,i);if(d)return{id:d.id,action:ke.SY.info,type:d.type,options:s};const u=dge(a,n);if(!oge(o,r,t,n,i,u,l.source)&&!l.channelCopilotOpen&&!Hpe(e))return null;const{enableChannelInfoPaneSearch:m}=n?.get(c.w.Channels)??{};if(Sge(r,n,l.source))return{id:o,action:ke.SY.info,type:ke.ck.channelcontextualsearch};if(fge(t?.type,s)||kge(t?.type,l.source))return{id:o,action:ke.SY.info,type:t?.type};if(Hpe(e)){const t=(0,d3.Wo)(e),n=l?.deepLinkId;if(n!==t?.replyChainId)return{id:o,action:ke.SY.info,type:ke.ck.channelthread,options:e.options,entityState:{flushableByLinkedEntity:!0},windowOptions:null,linkedEntity:null}}const{replyChainId:p}=(e=>{if(!e)return{replyChainId:void 0};try{const{replyChainId:t}=JSON.parse(e);return{replyChainId:t}}catch{return{replyChainId:void 0}}})(o??"");if(p&&(!m||t?.type!==ke.ck.channelcontextualsearch)&&t?.type!==ke.ck.channelthread)return null;if(t){const{action:e,type:n}=t;if(e===ke.SY.info&&sge(n,!!m))return t;if(n!==ke.ck.channels)return null}const{channelId:g}=(0,d3.Ep)(o??"");return{id:(0,ge.hR)({channelId:g}),action:ke.SY.info,type:ke.ck.channels}},tge=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const o=t?.id||e.id,r=t?.type||e.type,s=t?.options??e.options,l=JSON.parse(s??"{}"),d=t?.action||e.action,{enableChatInfoPane:u}=n?.get(c.w.Host)||{};if(!rge(o,r,i))return null;const m=bge(o,s);if(m)return m;const p=(0,K4.AD)(o,t,a,n,i);if(p)return Cge(p.id,ke.SY.info,p.type,s);if(pge(r,d)||gge(r,d)||hge(r,n)||yge(r,n))return Cge(o,ke.SY.info,r,s);if(vge(r,n,s))return Cge(o,ke.SY.info,ke.ck.chatfluidthread,s);if(uge(o,a,n,r))return Cge(o,ke.SY.info,mge(r),s);if(l.source===A.p.ChatContextualSearch)return Cge(o,ke.SY.info,ke.ck.chatContextualSearch,s);if(u&&!cge(a,n)){const e=lge(r);return Cge(o,e?ke.SY.infoDetails:ke.SY.info,e?r:ke.ck.chatsInfoView,s)}return Zpe(e,n)?Cge(o,ke.SY.info,ke.ck.chatthread,s):null},nge=({areEmptySlotsTransparent:e,coreSettings:t})=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:e}},headerEntity:{[se.w.HorizontalBar]:{isBackgroundTransparent:e}},subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e}}}),ige=[ke.ck.channels,ke.ck.channelcopilot,ke.ck.channelcontextualsearch,ke.ck.channelextensibilityapppickersidepanel,ke.ck.channelsPinnedPost,ke.ck.channelsSystemMessage,ke.ck.channelsthreadlist,ke.ck.channelthread,ke.ck.simplecollab,ke.ck.simplecollabchannels,ke.ck.simplecollabchats,ke.ck.chatpeopledetails,ke.ck.chatContextualSearch,ke.ck.chatpinnedmessagesdetails,ke.ck.chatsInfoView,ke.ck.chatHighlightsDetails,ke.ck.chatcopilotsynthesis,ke.ck.extensibilityapppickersidepanel,ke.ck.chatfluidthread,ke.ck.chats,ke.ck.chatthread,ke.ck.chatthreadlist],age=["standard","focus"],oge=(e,t,n,i,a,o,r)=>{const{enableChannelInfoPaneSearch:s,enableChannelInfoPane:l=!1,enableChannelCopilotInL2Header:d=!1}=i?.get(c.w.Channels)??{},{enableExtensibilityAppPicker:u}=i?.get(c.w.Extensibility)??{},{enableInfoPaneAsResponsiveMenu:m=!1}=i?.get(c.w.Core)??{};return!!(e&&age.includes(a)&&ige.includes(t))&&(!(!s||r!==A.p.ChannelContextualSearch&&n?.type!==ke.ck.channelcontextualsearch)||(!(!d||n?.type!==ke.ck.channelcopilot)||(!(!u||n?.type!==ke.ck.channelextensibilityapppickersidepanel)||(n?.type===ke.ck.channelsthreadlist||n?.type===ke.ck.channelthread||!(o||!l||!m)))))},rge=(e,t,n)=>!!(e&&age.includes(n)&&ige.includes(t))&&(!(0,g1.l7)(e)&&!(0,g1.Fz)(e)&&t!==ke.ck.chatrequests),sge=(e,t)=>{switch(e){case ke.ck.channelsPinnedPost:case ke.ck.channelsSystemMessage:case ke.ck.channelsthreadlist:case ke.ck.channelthread:return!0;case ke.ck.channelcontextualsearch:return t;default:return!1}},lge=e=>e===ke.ck.chatpinnedmessagesdetails||e===ke.ck.chatpeopledetails||e===ke.ck.chatContextualSearch,cge=(e,t)=>e?.infoPane?.chatsInfoView?"closed"===e.infoPane.chatsInfoView:!t?.get(c.w.Messaging).enableChatInfoPaneDefaultOpen,dge=(e,t)=>e?.infoPane?.channels?"closed"===e.infoPane.channels:!!t?.get(c.w.Channels).disableChannelInfoPaneOpenByDefault,uge=(e,t,n,i)=>{const{enableCopilotSynthesisInChat:a}=n?.get(c.w.Messaging)||{};return!(!a||i!==ke.ck.chatcopilotsynthesis)||(((e,t)=>!!e&&!!t?.sidePane?.sidePaneOpenState?.some((t=>t.id===e&&"copilot"===t.category)))(e,t)&&(i===ke.ck.chatHighlightsDetails||i===ke.ck.simplecollabchats)||!1)},mge=e=>e===ke.ck.chatcopilotsynthesis?ke.ck.chatcopilotsynthesis:ke.ck.chatHighlightsDetails,pge=(e,t)=>e===ke.ck.chatthread&&t===ke.SY.info,gge=(e,t)=>e===ke.ck.chatthreadlist&&t===ke.SY.info,hge=(e,t)=>{const{enableExtensibilityAppPicker:n}=t?.get(c.w.Extensibility)||{};return n&&e===ke.ck.extensibilityapppickersidepanel||!1},vge=(e,t,n)=>{const i=JSON.parse(n??"{}"),{enableFluidThread:a}=t?.get(c.w.FluidThread)||{};return a&&(e===ke.ck.chatfluidthread||i?.isFluidThreadMention)||!1},yge=(e,t)=>{const{enableChatInfoPaneSearch:n}=t?.get(c.w.Messaging)||{};return n&&e===ke.ck.chatContextualSearch},Sge=(e,t,n)=>{const{enableChannelInfoPaneSearch:i}=t?.get(c.w.Channels)||{};return i&&(e===ke.ck.channelcontextualsearch||n===A.p.ChannelContextualSearch)},fge=(e,t)=>{const n=JSON.parse(t??"{}");return e===ke.ck.channelcopilot||n.channelCopilotOpen},kge=(e,t)=>e===ke.ck.channelextensibilityapppickersidepanel||t===A.p.ExtensibilityAppPickerSidePanel,Cge=(e,t,n,i)=>({action:t,id:e,type:n,options:i}),bge=(e,t)=>(e=>{const t=e&&(0,Py.j)(e);return t?.openChatInEndSlot})(t)?Cge(e,ke.SY.view,ke.ck.chats,t):null,wge=(e,t)=>![t?.get(c.w.ChatList)?.bizChatMetaOSAppId,jpe.w.Activities_Mentions_Chat,jpe.w.Activities_Mentions_Channel,Bpe.A].includes(e),Tge={id:"com.microsoft.teams.simpleCollab",actors:[vc],name:"SimpleCollabApp",getLocalizedName:async e=>(await e.waitForNamespace("messaging"),e.stringTranslate("messaging","messaging_app_name")),supportedEntities:[ke.ck.simplecollab,ke.ck.simplecollabchats,ke.ck.simplecollabchannels,ke.ck.simplecollabcreateconversationfolder,ke.ck.simplecollabremoveconversationfolder,ke.ck.teamseeallchannels,ke.ck.simplecollabrenameconversationfolder,ke.ck.simplecollabmanageteamchannels,ke.ck.simplecollabswitchbackconfirmationdialog,ke.ck.simplecollabcombinedoptin,ke.ck.simplecollabsplitoptin,ke.ck.simplecollabhideallchannelsdialog],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail,se.w.Modal],getDefaultCommand:()=>({type:ke.ck.simplecollab,action:ke.SY.default}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125}},Ige=(e,t,n)=>(0,Pj.Kw)(e,t,n),Nge=(e,t)=>{const{userPreferences:n,coreSettings:i}=t,{enableSimpleCollabUpdateHistoryNavigation:a}=i?.get(c.w.SimpleCollab,["enableSimpleCollabUpdateHistoryNavigation"])??{enableSimpleCollabUpdateHistoryNavigation:!1};if(a){const t=n?.simpleCollab?.simpleCollabViewType;let i=e?.subNavEntity?.type;if("unified"===t)i=ke.ck.simplecollab;else if((0,Pj.c3)(e))switch(t){case"split":i=ke.ck.simplecollabchats;break;case"none":i=ke.ck.chats;break;default:return}else{if(!(0,Pj.Aw)(e))return;switch(t){case"split":i=ke.ck.simplecollabchannels;break;case"none":i=ke.ck.channels;break;default:return}}if(i!==e?.subNavEntity?.type)return(0,Pj.Kw)(e,{type:i,action:ke.SY.list},"subNavEntity")}};var Age=n(431692);const Ege=async(e,t,n)=>{const i=t.newLogger("setSimpleCollabViewType","simple_collab_view_type_setting"),a={hasUserEnabledAdaptiveRailForDesktop:!0,hasUserEnabledUnifiedAppForDesktop:n};try{await e.mutate({mutation:Age.h,variables:{value:JSON.stringify(a)},optimisticResponse:{updateUserPreferencesForSimpleCollab:{__typename:"UserPreferences",simpleCollabUserSettings:{__typename:"SimpleCollabUserSettings",id:"simpleCollabUserSettingsId",...a}}}}),(0,Pt.AR)().setContext("UserInfo.NewChatAndChannelEnabled",!0),(0,Pt.AR)().setContext("UserInfo.CollabAppEnabled",n)}catch(e){return i.errorToTelemetry?.(`setSimpleCollabViewType: Failed to update hasUserEnabledAdaptiveRailForDesktop to ${a.hasUserEnabledAdaptiveRailForDesktop} or hasUserEnabledUnifiedAppForDesktop to ${a.hasUserEnabledUnifiedAppForDesktop}`,"simple_collab_view_type_setting"),!1}return!0},Fge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSimpleCollabDefaultChatIdQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultChatId"}}]}}]},_ge=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i}},requestContext:a}=e,o=a.client;return n===ke.ck.simplecollabcombinedoptin&&i===ke.SY.enable?Dge(o,t,a.coreSettings,a.loggerFactory):n===ke.ck.simplecollabsplitoptin&&i===ke.SY.enable?Pge(o,t,a.coreSettings,a.loggerFactory):t},Dge=async(e,t,n,i)=>{if(!n.get(c.w.SimpleCollab).enableSimpleCollabOptInFRE)return Promise.resolve(void 0);const a=i.newLogger("handleSimpleCollabCombinedOptInAction","app-before-command-handled");try{await Ege(e,i,!0),t.entityOptions={isViewFromSimpleCollab:!0};const{data:n}=await e.query({query:Fge});if(n?.defaultChatId){const e=n.defaultChatId;t.entity={action:ke.SY.view,id:e,type:ke.ck.chats,linkedEntity:{id:e,type:ke.ck.simplecollab,action:ke.SY.view}},a.log(`handleSimpleCollabCombinedOptInAction:Received default chat id: ${e}`)}else t.entity={type:ke.ck.chats,action:ke.SY.view,linkedEntity:{id:"",type:ke.ck.simplecollab,action:ke.SY.view}},a.warn("handleSimpleCollabCombinedOptInAction:Not received default chat id and random chat rendered as fallback")}catch(e){return Promise.reject("handleSimpleCollabCombinedOptInAction: failure during simple collab combined opt in")}return Promise.resolve(t)},Pge=async(e,t,n,i)=>{if(!n.get(c.w.SimpleCollab).enableSimpleCollabSplitOptInFRE)return Promise.resolve(void 0);const a=i.newLogger("handleSimpleCollabSplitOptInAction","app-before-command-handled");try{await Ege(e,i,!1),t.entityOptions={isViewFromSimpleCollab:!0};const{data:n}=await e.query({query:Fge});if(n?.defaultChatId){const e=n.defaultChatId;t.entity={action:ke.SY.view,id:e,type:ke.ck.chats,linkedEntity:{id:e,type:ke.ck.simplecollabchats,action:ke.SY.view}},a.log(`handleSimpleCollabSplitOptInAction:Received default chat id: ${e}`)}else t.entity={type:ke.ck.chats,action:ke.SY.view,linkedEntity:{id:"",type:ke.ck.simplecollabchats,action:ke.SY.view}},a.warn("handleSimpleCollabSplitOptInAction:Not received default chat id and random chat rendered as fallback")}catch(e){return Promise.reject("handleSimpleCollabSplitOptInAction: failure during simple collab split opt in")}return Promise.resolve(t)};var Mge=n(945824),Rge=n(806104);function xge(){const e=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);switch(e){case ke.ck.simplecollabchats:case ke.ck.simplecollabchannels:return e;default:return ke.ck.simplecollab}}const Lge=JSON.stringify({hostSettings:{enableDeeplinks:"true"}}),Oge=async({commandInput:e,requestContext:t})=>{const{command:{action:n,data:i}}=e,{client:a,coreSettings:o,loggerFactory:r}=t;if(e.command.actor===vc)switch(n){case yc:return async function(e,t,n){let i={type:ke.ck.simplecollab,action:ke.SY.default};const a=Ope.simpleCollabStore.get(Ope.selectedConversationIdAtom),o=Ope.simpleCollabStore.get(Ope.selectedTeamIdAtom);let r={};const s={id:a,type:ke.ck.simplecollab,action:ke.SY.default};if(a&&!o){if((0,Rge.Sb)(a))return Bge(a);const{bizChatMetaOSAppId:e}=n.get(c.w.ChatList);if(a===e||a===Bpe.A){if(i=a===e?{id:JSON.stringify({appId:a,subEntityId:Lge}),type:ke.ck.extensions,action:ke.SY.view,linkedEntity:s}:{id:JSON.stringify({appId:a}),type:ke.ck.discoversurface,action:ke.SY.view,linkedEntity:s},r=a===e?{subEntityId:Lge}:{isViewFromSimpleCollab:!0},a===Bpe.A)return{entity:i,entityOptions:r,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,correlation:{source:A.p.DiscoverSurfaceEntry}}}}else i={action:ke.SY.view,id:a,type:ke.ck.chats,linkedEntity:{id:a,type:ke.ck.simplecollab,action:ke.SY.view}},r={isViewFromSimpleCollab:!0}}else if(a){const e=JSON.stringify({channelId:a,teamId:o});s.id=e,i={action:ke.SY.view,id:e,type:ke.ck.channels,linkedEntity:s},r={isViewFromSimpleCollab:!0}}else{const n=await jge(e,t);n&&(r={isViewFromSimpleCollab:!0},i={action:ke.SY.view,id:n,type:ke.ck.chats,linkedEntity:{id:n,type:ke.ck.simplecollab,action:ke.SY.view}})}return{entity:i,entityOptions:r,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,correlation:{source:A.p.Unknown}}}}(a,r,o);case Sc:return async function(e,t,n){let i={type:ke.ck.simplecollabchats,action:ke.SY.default},a={};const o=Ope.simpleCollabStore.get(Ope.selectedConversationIdAtom),r=Ope.simpleCollabStore.get(Ope.selectedTeamIdAtom);if(o&&!r){if((0,Rge.Sb)(o))return Bge(o);const{bizChatMetaOSAppId:e}=n.get(c.w.ChatList);o===e?(i={id:JSON.stringify({appId:o,subEntityId:Lge}),type:ke.ck.extensions,action:ke.SY.view,linkedEntity:{id:o,type:ke.ck.simplecollabchats,action:ke.SY.default}},a={subEntityId:Lge}):(i={action:ke.SY.view,id:o,type:ke.ck.chats,linkedEntity:{id:o,type:ke.ck.simplecollabchats,action:ke.SY.default}},a={isViewFromSimpleCollab:!0})}else if(o){const e=JSON.stringify({channelId:o,teamId:r});i={action:ke.SY.view,id:e,type:ke.ck.channels,linkedEntity:{id:e,type:ke.ck.simplecollabchannels,action:ke.SY.default}},a={isViewFromSimpleCollab:!0}}else{const n=await jge(e,t);n&&(a={isViewFromSimpleCollab:!0},i={action:ke.SY.view,id:n,type:ke.ck.chats,linkedEntity:{id:n,type:ke.ck.simplecollabchats,action:ke.SY.default}})}return{entity:i,entityOptions:a,command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,correlation:{source:A.p.Unknown}}}}(a,r,o);case fc:return async function(e){const{surveyId:t,commandSource:n}=e;return{entity:{type:ke.ck.survey,action:ke.SY.view,id:t},command:{correlation:{source:n},stateTransition:g.Ar.extend,visibilityState:g.Rp.show},entityOptions:{source:n,entityStateTransition:g.Ar.extend}}}(i);case kc:return function(e){const{commandSource:t}=e,n={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:t||A.p.SimpleCollabSwitchButton}},i={action:ke.SY.view,type:ke.ck.simplecollabswitchbackconfirmationdialog};return{command:n,entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case Cc:return function(e){const{id:t,openInPopout:n,correlationId:i,commandSource:a}=e,o={action:ke.SY.view,id:t,type:ke.ck.chats};return{command:{stateTransition:n?g.Ar.new:g.Ar.flow,visibilityState:g.Rp.show,correlation:{id:i,source:a||A.p.SimpleCollabChatListItem,startTimestamp:Date.now()}},entity:o,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case bc:return function(e){const{commandSource:t,correlationId:n,groupChatName:i,chatMemberMris:a,suggestedChatType:o}=e;let r,s,l;"org"===o||"project"===o?(r=g1.Uv,s=ke.SY.view,l={isViewFromSimpleCollab:!0,groupChatType:o,groupName:i,users:a}):(r=JSON.stringify(a),s=ke.SY.create,l={isViewFromSimpleCollab:!0});const c={id:r,action:s,type:ke.ck.chats};return{command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{id:n,source:t||A.p.SimpleCollabChatListSuggestedItem,startTimestamp:Date.now()}},entity:c,entityOptions:l}}(i);case pd:return function(e){const{id:t,openInPopout:n,focusOnLoad:i}=e,a=JSON.stringify({hostSettings:{enableDeeplinks:"true",focusOnLoad:i}}),o={id:JSON.stringify({appId:t,subEntityId:a}),type:ke.ck.extensions,action:ke.SY.view};return{command:{stateTransition:n?g.Ar.new:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabBizChatMetaOSListItem,startTimestamp:Date.now()}},entity:o,entityOptions:{subEntityId:a,entryPoint:"SimpleCollabMetaOSEntryPoint"}}}(i);case wc:return function(e){const{channelId:t,teamId:n,replyChainId:i,deepLinkId:a,correlationId:o,commandSource:r,back:s,stateTransition:l,linkedEntity:c,isViewFromSimpleCollab:d}=e,u=JSON.stringify({channelId:t,teamId:n,replyChainId:i}),m={action:ke.SY.view,id:u,type:ke.ck.channels,linkedEntity:c};return{command:{stateTransition:l??g.Ar.flow,visibilityState:g.Rp.show,correlation:{id:o,source:r||A.p.SimpleCollabChannelListItem}},entity:m,entityOptions:{isViewFromSimpleCollab:void 0===d||d,deepLinkId:a,back:!!s}}}(i);case Tc:return function(e){const{channelId:t,channelName:n,teamName:i,commandSource:a}=e,o={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:a||A.p.ChannelActions}},r={id:t,action:ke.SY.view,type:ke.ck.channelnotificationsettings},s={isViewFromSimpleCollab:!0,commandSource:a||A.p.ChannelActions,teamName:i,channelName:n};return{command:o,entity:r,entityOptions:s}}(i);case Ic:return function(e){const{teamId:t,channelId:n,teamName:i,channelName:a,correlationIdOverride:o,commandSource:r}=e,s={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:r||A.p.SimpleCollabChannelListItem,id:o||(0,E.v4)()}},l={id:n,action:ke.SY.view,type:ke.ck.channelworkflows},c={isViewFromSimpleCollab:!0,commandSource:r||A.p.SimpleCollabChannelListItem,teamName:i,channelName:a,teamId:t,conversationId:n};return{command:s,entity:l,entityOptions:c}}(i);case Nc:return function(e){const{teamId:t,channelId:n,channelDisplayName:i,channelType:a}=e,o={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.TeamChannels}},r={action:ke.SY.view,type:ke.ck.archivechannel};return{command:o,entity:r,entityOptions:{isViewFromSimpleCollab:!0,teamId:t,channelId:n,channelDisplayName:i,channelType:a}}}(i);case Ac:return function(e){const{channelId:t,channelName:n,channelType:i,filesUrl:a,teamId:o,teamName:r,channelSubstrateGroupId:s,channelOnlyMember:l,isGeneral:c,isShown:d,groupId:u,teamTenantId:m}=e,p={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.TeamChannels}},h={action:ke.SY.view,type:ke.ck.deletechannelreactdialog};return{command:p,entity:h,entityOptions:{isViewFromSimpleCollab:!0,channelName:n,teamName:r,channelType:i,filesUrl:a,channelId:t,teamId:o,channelSubstrateGroupId:s,channelOnlyMember:l,isGeneral:c,isShown:d,groupId:u,teamTenantId:m}}}(i);case Ec:return function(e){const{teamId:t,channelId:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},a={action:ke.SY.view,type:ke.ck.createchanneldialog},o={isViewFromSimpleCollab:!0,channelId:n,teamId:t,entryPoint:Mge.k.TrinityLeftRail,channelType:t===n?Mge.x.Default:Mge.x.Regular};return{command:i,entity:a,entityOptions:o}}(i);case Fc:return function(e){const{teamId:t,channelId:n,channelName:i,channelType:a,displayName:o,groupId:r,teamName:s,channelResourceTenantId:l,commandSource:c}=e,d={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:c||A.p.GetLinkToChannelMenuButton}},u={action:ke.SY.view,type:ke.ck.getlinktoteamorchanneldialog};return{command:d,entity:u,entityOptions:{isViewFromSimpleCollab:!0,selectedChannelId:n,linkType:"STANDARD"===a?"Channel":"PRIVATE"===a?"PrivateChannel":"SHARED"===a?"SharedChannel":"Unknown",teamId:t,groupId:r,displayName:o,teamName:s,channelName:i,channelResourceTenantId:l}}}(i);case Dc:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a=i||A.p.SimpleCollabChannelListItem,o={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:a}},r=xge(),s={id:t,action:ke.SY.view,type:ke.ck.channelmanage,linkedEntity:{id:t,type:r,action:ke.SY.list}};return{command:o,entity:s,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:n}}}(i);case Mc:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:i||A.p.SimpleCollabChannelListItem}},o={id:t,action:ke.SY.view,type:ke.ck.channelmembers,linkedEntity:{id:t,type:ke.ck.channels,action:ke.SY.list}};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:n}}}(i);case _c:return function(e){const{commandSource:t}=e,n={type:ke.ck.stalechannelsadhocdialog,action:ke.SY.view};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:t||A.p.StaleChannelsAdhocContextMenu}},entity:n,entityOptions:{isViewFromSimpleCollab:!0,commandSource:t||A.p.StaleChannelsAdhocContextMenu}}}(i);case Pc:return function(e){const{channelId:t,teamId:n,tagId:i,commandSource:a}=e,o={stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:a||A.p.SimpleCollabChannelListItem}},r={id:t,action:ke.SY.view,type:ke.ck.channeltags,linkedEntity:{id:t,type:ke.ck.channels,action:ke.SY.list}};return{command:o,entity:r,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:n,tagId:i}}}(i);case Rc:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelEmail}},a={id:t,action:ke.SY.view,type:ke.ck.channelemailv2};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0,channelId:t}}}(i);case Vc:return function(e){const{teamId:t,channelId:n,commandSource:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},o={id:n,action:ke.SY.view,type:ke.ck.addmembertoprivatechanneldialog};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:t}}}(i);case Hc:return function(e){const{teamId:t,channelId:n,teamName:i,channelName:a,isLastOwner:o,groupId:r,channelOnlyMember:s,commandSource:l}=e,c=o?ke.ck.leavechannellastownerdialog:ke.ck.leavechanneldialog,d={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:l||A.p.ChannelLeaveContextMenuButton}},u={action:ke.SY.view,type:c};return{command:d,entity:u,entityOptions:{isViewFromSimpleCollab:!0,channelName:a,channelId:n,teamId:t,teamName:i,isLastOwner:o,groupId:r,channelOnlyMember:s}}}(i);case zc:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}},a={id:t,action:ke.SY.view,type:ke.ck.sharechannelwithuserdialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case qc:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},o={id:t,action:ke.SY.view,type:ke.ck.sharedchannelcreateinvitationsdialog,linkedEntity:{id:t,type:ke.ck.channels,action:ke.SY.list}};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,channelId:t,teamId:n}}}(i);case Gc:return function(e){const{channelId:t,teamId:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},a={id:t,action:ke.SY.view,type:ke.ck.sharewithteamyouowndialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0,channelId:t,teamId:n}}}(i);case xc:return function(e,t){const{teamId:n,commandSource:i}=e,{enableTrinityChannelsTab:a}=t.get(c.w.TeamsAndChannels),o={id:n,action:ke.SY.view,type:a?ke.ck.simplecollabmanageteamchannels:ke.ck.teammanage,linkedEntity:{id:n||"",type:a?ke.ck.simplecollabmanageteamchannels:ke.ck.channels,action:ke.SY.view}};return{command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:i||A.p.SimpleCollabChannelListItem}},entity:o,entityOptions:{isViewFromSimpleCollab:!0}}}(i,o);case dd:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:ke.SY.view,type:ke.ck.teammembers,linkedEntity:{id:t||"",type:ke.ck.channels,action:ke.SY.list}};return{command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}},entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case ud:return function(e,t){const{teamId:n,commandSource:i}=e,{enableTrinityChannelsTab:a}=t.get(c.w.TeamsAndChannels),o={id:n,action:ke.SY.view,type:a?ke.ck.simplecollabmanageteamchannels:ke.ck.teamchannels,linkedEntity:{id:n||"",type:a?ke.ck.simplecollabmanageteamchannels:ke.ck.channels,action:a?ke.SY.view:ke.SY.list}};return{command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},entity:o,entityOptions:{isViewFromSimpleCollab:!0}}}(i,o);case Lc:return function(e){const{teamId:t,commandSource:n}=e,i={stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:n||A.p.SimpleCollabChannelListItem}},a={id:t,action:ke.SY.view,type:ke.ck.teammanagetags};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case Oc:return function(e){const{teamId:t,displayName:n,groupId:i,teamName:a,channelResourceTenantId:o}=e,r={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.GetLinkToTeamMenuButton}},s={action:ke.SY.view,type:ke.ck.getlinktoteamorchanneldialog};return{command:r,entity:s,entityOptions:{isViewFromSimpleCollab:!0,selectedChannelId:t,linkType:"Team",teamId:t,groupId:i,displayName:n,teamName:a,channelResourceTenantId:o}}}(i);case jc:return function(e){const{teamId:t,groupId:n,teamName:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChannelListItem}},o={id:t,action:ke.SY.view,type:ke.ck.leaveteam};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,teamName:i,groupId:n,teamThreadId:t}}}(i);case Bc:return function(e){const{teamId:t,teamName:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChannelListItem}},a={id:t,action:ke.SY.view,type:ke.ck.simplecollabhideallchannelsdialog};return{command:i,entity:a,entityOptions:{teamName:n,teamId:t}}}(i);case Uc:return function(e){const{teamId:t}=e,n={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},i={id:t,action:ke.SY.view,type:ke.ck.addmembertoteamdialog};return{command:n,entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case $c:return function(e){const{teamId:t,groupId:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},a={action:ke.SY.view,type:ke.ck.createchanneldialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0,teamId:t,groupId:n,entryPoint:"TeamContextMenu"}}}(i);case Wc:return function(e){const{teamId:t,teamName:n,groupId:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChannelListItem}},o={id:t,action:ke.SY.view,type:ke.ck.deleteteam};return{command:a,entity:o,entityOptions:{teamName:n,groupId:i,threadId:t,isViewFromSimpleCollab:!0}}}(i);case Zc:return function(e){const{id:t}=e,n={id:t,action:ke.SY.manage,type:ke.ck.chatManageApps,linkedEntity:{id:t,type:ke.ck.chats}};return{command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChatListItem}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case Xc:return function(e){const{id:t,isGuardianChat:n}=e,i={id:t,action:ke.SY.delete,type:ke.ck.leavechat};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChatListItem}},entity:i,entityOptions:{isViewFromSimpleCollab:!0,convId:t,isGuardianChat:n}}}(i);case ed:return function(e){const{id:t}=e,n={id:t,action:ke.SY.view,type:ke.ck.blockChat};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChatListItem}},entity:n,entityOptions:{isViewFromSimpleCollab:!0,conversationId:t}}}(i);case td:return function(e){const{id:t,title:n,isGroupChat:i,isOneOnOneChat:a}=e,o={id:t,action:ke.SY.delete,type:ke.ck.deletechat};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabChatListItem}},entity:o,entityOptions:{isViewFromSimpleCollab:!0,title:n,isGroupChat:i,isOneOnOneChat:a,convId:t}}}(i);case nd:return function(e){const{id:t,commandSource:n,correlationIdOverride:i}=e,a={id:t,action:ke.SY.view,type:ke.ck.chatworkflows};return{command:{visibilityState:g.Rp.show,stateTransition:g.Ar.extend,correlation:{source:n||A.p.SimpleCollabChatListItem,id:i||(0,E.v4)()}},entity:a,entityOptions:{isViewFromSimpleCollab:!0,conversationId:t,commandSource:n||A.p.SimpleCollabChatListItem}}}(i);case Qc:return function(e){const{conversationId:t,simpleCollabFilterType:n}=e,i={action:ke.SY.view,type:ke.ck.simplecollabcreateconversationfolder};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabConversationFolder}},entity:i,entityOptions:{isViewFromSimpleCollab:!0,conversationId:t,simpleCollabFilterType:n}}}(i);case Jc:return function(e){const{conversationFolderName:t,folderId:n,conversationFoldersConnectionId:i,commandSource:a,folderType:o,isLegacyFavoritesFolder:r,hasConversations:s,simpleCollabFilterType:l}=e,c={action:ke.SY.view,type:ke.ck.simplecollabremoveconversationfolder};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:a||A.p.SimpleCollabConversationFolder}},entity:c,entityOptions:{isViewFromSimpleCollab:!0,conversationFolderName:t,folderId:n,conversationFoldersConnectionId:i,folderType:o,isLegacyFavoritesFolder:r,hasConversations:s,simpleCollabFilterType:l}}}(i);case Kc:return function(e){const{conversationFolderName:t,folderId:n,folderType:i,isLegacyFavoritesFolder:a,simpleCollabFilterType:o}=e,r={action:ke.SY.view,type:ke.ck.simplecollabrenameconversationfolder};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.SimpleCollabConversationFolder}},entity:r,entityOptions:{isViewFromSimpleCollab:!0,conversationFolderName:t,folderId:n,folderType:i,isLegacyFavoritesFolder:a,simpleCollabFilterType:o}}}(i);case Yc:return function(e){const t={stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:A.p.DiscoverSurfaceEntry}},{id:n}=e,i={id:JSON.stringify({appId:n}),type:ke.ck.discoversurface,action:ke.SY.view};return{command:t,entity:i,entityOptions:{entryPoint:"SimpleCollabDiscoverEntryPoint",isViewFromSimpleCollab:!0}}}(i);case id:return function(e){const{teamId:t,commandSource:n,hideSlotHeader:i}=e,a={stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:n||A.p.UserOnboardingTeam}},o={id:t,action:ke.SY.view,type:ke.ck.teamseeallchannels,linkedEntity:{id:t,action:ke.SY.view,type:ke.ck.teamseeallchannels}};return{command:a,entity:o,entityOptions:{hideSlotHeader:i,isViewFromSimpleCollab:!0}}}(i);case ad:return function(e){const{commandSource:t}=e,n={type:ke.ck.teamsgallery,action:ke.SY.view};return{command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:t||A.p.TeamsGallery}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case od:return function(e){const{openInPopout:t,commandSource:n}=e,i={action:ke.SY.view,id:"newchat",type:ke.ck.chats};return{command:{stateTransition:t?g.Ar.new:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:n||A.p.SimpleCollabChatListItem,startTimestamp:Date.now()}},entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case rd:return function(e){const{commandSource:t}=e,n={type:ke.ck.createchannelleftraildialog,action:ke.SY.view};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:t||A.p.ExtensionCommanding}},entity:n,entityOptions:{isViewFromSimpleCollab:!0,entryPoint:"ChannelListHeaderContextMenu"}}}(i);case sd:return function(e){const{commandSource:t}=e,n={type:ke.ck.teamcreatedialog,action:ke.SY.view};return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:t||A.p.ExtensionCommanding}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case ld:return function(e){const{commandSource:t}=e,n={type:ke.ck.teamslist,action:ke.SY.view};return{command:{stateTransition:g.Ar.flow,visibilityState:g.Rp.show,correlation:{source:t||A.p.SimpleCollabChannelListItem}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case cd:return function(e){const{commandSource:t}=e,n={id:"chats_and_channels",type:ke.ck.settingsstore,action:ke.SY.view};return{command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:t||A.p.Unknown}},entity:n}}(i);case hd:return function(e){const{commandSource:t,canUserCreateTeam:n}=e,i={id:Yn.$D.template,type:ke.ck.teams,action:ke.SY.create};return{command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:t||A.p.SimpleCollabChannelListItem}},entity:i,entityOptions:{isViewFromSimpleCollab:!0,canUserCreateTeam:n}}}(i);default:return}};async function jge(e,t){let n=null;try{const{data:t}=await e.query({query:Fge});n=t.defaultChatId}catch{t.newLogger("SimpleCollabApp defaultChatId","app-on-command-received").error("Failed to get defaultChatId for simple collab app")}return n}function Bge(e){const t=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);let n=ke.ck.simplecollab;t!==ke.ck.simplecollabchannels&&t!==ke.ck.simplecollabchats||(n=t);const i={id:e,type:n,action:ke.SY.default};return{entity:{id:e,type:ke.ck.headlineslice,action:ke.SY.view,linkedEntity:i},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,correlation:{source:A.p.AppBar}}}}var Uge=n(458410),$ge=n(847819);const Wge={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsSimpleCollabSimpleCollabSettingsFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SimpleCollabUserSettings"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledAdaptiveRailForDesktop"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledUnifiedAppForDesktop"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledMessagePreviews"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledShowTimeStamps"}}]}}]},Vge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsSimpleCollabSimpleCollabSettingsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesChangedEventForSimpleCollab"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"EnumValue",value:"simpleCollabUserSettings"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"simpleCollabUserSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsSimpleCollabSimpleCollabSettingsFragment"}}]}}]}}]}},...Wge.definitions]},Hge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSimpleCollabLocalStoreSettingsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ClientPreferencesInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateClientPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"simpleCollab"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"simpleCollabViewType"}}]}}]}}]}}]},zge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSimpleCollabSimpleCollabSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesForSimpleCollab"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"simpleCollabUserSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsSimpleCollabSimpleCollabSettingsFragment"}}]}}]}}]}},...Wge.definitions]},qge=async(e,t,n)=>{t.registerRelayHandler?.("connection",Xge((()=>({selectedConversationData:e.simpleCollabStore.get(e.selectedConversationDataAtom),selectedAppId:e.simpleCollabStore.get(e.selectedAppIdAtom),selectionId:e.simpleCollabStore.get(e.selectionIdAtom)}))));const{data:i}=await t.query({query:zge,fetchPolicy:"network-only"});Yge(e,t,i,n);const a=t.subscribe({query:Vge}).subscribe({next:({data:i})=>{Gge(e,t,i,n)}});return{subscription:a,unsubscribe:()=>a?.unsubscribe()}},Gge=(e,t,n,i)=>{Qge(e,t,n?.userPreferencesChangedEventForSimpleCollab?.simpleCollabUserSettings??null,i)},Yge=(e,t,n,i)=>{const a=n.userPreferencesForSimpleCollab.simpleCollabUserSettings;Qge(e,t,a,i)},Qge=async(e,t,n,i)=>{if(!n)return;let a=n.hasUserEnabledMessagePreviews;const o=(e=>e.hasUserEnabledAdaptiveRailForDesktop?e.hasUserEnabledUnifiedAppForDesktop?"unified":"split":"none")(n);if(null===a)switch(o){case Pj.LS.split:const{messagePreviews:{messagePreviewsSetting:e},density:{chatDensity:t}}=ehe(i),n="comfy"===t;a=(0,Pj.K5)(e,n);break;case Pj.LS.unified:a=!1}e.simpleCollabStore.set(e.showMessagePreviewsAtom,a),e.simpleCollabStore.set(e.showTimestampsAtom,(n.hasUserEnabledShowTimeStamps||a)??!1),t.mutate({mutation:Hge,variables:{value:{simpleCollab:{simpleCollabViewType:o}}}});try{const e=t.parent;e?.writeQuery({query:Mj.W,data:{userPreferencesForSimpleCollab:{__typename:"UserPreferences",simpleCollabUserSettings:{__typename:"SimpleCollabUserSettings",id:"simpleCollabUserSettingsId",hasUserEnabledAdaptiveRailForDesktop:"none"!==o,hasUserEnabledUnifiedAppForDesktop:"unified"===o,hasUserEnabledMessagePreviews:a,hasUserEnabledShowTimeStamps:n.hasUserEnabledShowTimeStamps}}}})}catch(e){}},Jge="SimpleCollabLeftRailConversationFolder_conversations",Kge=new Set(["OneGQL_GroupChatConversation","OneGQL_OneOnOneChatConversation","OneGQL_MeetingChatConversation","OneGQL_BotChatConversation","OneGQL_SelfChatConversation","OneGQL_NewChatConversation"]),Zge=new Set(["OneGQL_ChannelConversation","OneGQL_Team"]),Xge=e=>({update(t,n){if(n.handleKey.startsWith(`__${Jge}_connection`)){const{selectedConversationData:i,selectedAppId:a,selectionId:o}=e();if(i.conversationNodeId&&i.folderNodeId&&i.folderNodeId===n.dataID){const e=t.get(i.folderNodeId),r=t.get(i.conversationNodeId);if(e&&r&&((e,t)=>{switch(t){case ke.ck.simplecollabchats:return Kge.has(e);case ke.ck.simplecollabchannels:return Zge.has(e);case ke.ck.simplecollab:default:return!0}})((e=>`${e.getValue("__typename")}`)(r),a)){const a=$ge.ConnectionHandler.getConnection(e,Jge,{filter:n.args.filter});a&&((e,t,n,i,a)=>{const o=t.getLinkedRecords("edges");if(o){const r=o.findIndex((e=>a?e?.getValue("id")===a:e?.getLinkedRecord("node")?.getDataID()===i));if(r>=0){const e=o[r];e&&(o.splice(r,1),(0,Uge.kX)(t,e,o))}else{const i=$ge.ConnectionHandler.createEdge(e,t,n,"OneGQL_ConversationsEdge");i.setValue(a,"id"),(0,Uge.kX)(t,i)}}})(t,a,r,i.conversationNodeId,o)}}}}}),ehe=e=>{const t=e?.get("local-user-preferences","Experience");return t?(0,Py.j)(t):{}},the=e=>({context:{client:t,coreSettings:n,localStorage:i}})=>[{id:"initialize-simple-collab-user-preference-to-store",runOncePerId:!0,job:async()=>{const{enableSimpleCollabStorePreInit:a}=n.get(c.w.SimpleCollab);if(a){const{unsubscribe:n}=await qge(e,t,i);return n}}}],nhe=e=>({context:{client:t,coreSettings:n,localStorage:i}})=>[{id:"app-simple-collab-user-preference-subscription",runOncePerId:!0,job:async()=>{const{enableSimpleCollabStorePreInit:a}=n.get(c.w.SimpleCollab);if(!a){const{unsubscribe:n}=await qge(e,t,i);return n}}}];var ihe=n(853676);const ahe="SimpleCollabLeftRailConversationFolder_conversations";function ohe(e,t,i,a){const{commitLocalUpdate:o,ConnectionHandler:r}=n(892908);o(e,(e=>{const n=e.get(t),o=e.getRoot()?.getLinkedRecord("conversationFolders",{filter:i})?.getLinkedRecords("edges")?.find((e=>"HIDDEN_CHANNELS"===e.getLinkedRecord("node").getValue("folderType")))?.getLinkedRecord("node");if(n&&o){const s=r.getConnection(o,ahe,{filter:i});if(s){const i=s.getLinkedRecords("edges")[0]?.getLinkedRecord("node");if(i?.getDataID()===t)return;const o=r.createEdge(e,s,n,"OneGQL_ConversationsEdge");a&&o.setValue(a,"id"),s.setLinkedRecords([o],"edges")}}}))}function rhe(e,t){const{commitLocalUpdate:i,ConnectionHandler:a}=n(892908);i(e,(e=>{const n=e.getRoot()?.getLinkedRecord("conversationFolders",{filter:t})?.getLinkedRecords("edges")?.find((e=>"HIDDEN_CHANNELS"===e.getLinkedRecord("node").getValue("folderType")))?.getLinkedRecord("node");if(n){const e=a.getConnection(n,ahe,{filter:t});e&&e.getLinkedRecords("edges").length&&e.setLinkedRecords([],"edges")}}))}function she(e,t,n,i,a,o){if(t===n&&e){const t=e.getLinkedRecord("activityStatus");t&&(!o?.tags?.includes("UNREAD")&&!o?.tags?.includes("MENTIONS")||a?t.setValue(t.getValue("hasUnreadMessage"),"hasUnreadMessage_Snapshot"):t.setValue(!0,"hasUnreadMessage_Snapshot"),t.setValue(t.getValue("hasPersonalMention"),"hasPersonalMention_Snapshot"),t.setValue(t.getValue("hasEveryoneMention"),"hasEveryoneMention_Snapshot"),t.setValue(t.getValue("hasChannelMention"),"hasChannelMention_Snapshot"),t.setValue(t.getValue("hasTeamMention"),"hasTeamMention_Snapshot"),e.setValue(e.getValue("isDraft"),"isDraft_Snapshot"),e.setValue(e.getValue("isMuted"),"isMuted_Snapshot"),e.setValue(mhe(e),"isChat_Snapshot"),e.setValue(phe(e),"isChannel_Snapshot"),e.setValue(ghe(e),"isMeeting_Snapshot"))}if(t===i&&e){const t=e.getLinkedRecord("activityStatus");t&&(o?.tags?.includes("UNREAD")||o?.tags?.includes("MENTIONS")?a&&(t.setValue(void 0,"hasUnreadMessage_Snapshot"),t.setValue(void 0,"hasPersonalMention_Snapshot"),t.setValue(void 0,"hasEveryoneMention_Snapshot"),t.setValue(void 0,"hasChannelMention_Snapshot"),t.setValue(void 0,"hasTeamMention_Snapshot")):(t.setValue(void 0,"hasUnreadMessage_Snapshot"),t.setValue(void 0,"hasPersonalMention_Snapshot"),t.setValue(void 0,"hasEveryoneMention_Snapshot"),t.setValue(void 0,"hasChannelMention_Snapshot"),t.setValue(void 0,"hasTeamMention_Snapshot")),e.setValue(void 0,"isDraft_Snapshot"),e.setValue(void 0,"isMuted_Snapshot"))}}const lhe=new Set(["OneGQL_GroupChatConversation","OneGQL_OneOnOneChatConversation","OneGQL_MeetingChatConversation","OneGQL_BotChatConversation","OneGQL_SelfChatConversation","OneGQL_NewChatConversation"]),che=new Set(["OneGQL_ChannelConversation","OneGQL_Team"]),dhe=new Set(["OneGQL_MeetingChatConversation"]),uhe=e=>`${e.getValue("__typename")}`,mhe=e=>lhe.has(uhe(e)),phe=e=>che.has(uhe(e)),ghe=e=>dhe.has(uhe(e));var hhe=n(858974);const vhe=()=>({appName:"simpleCollab",appId:Rm}),yhe=e=>{switch(e){case"OneGQL_OneOnOneChatConversation":return GR.bF.OneOnOneChat;case"OneGQL_GroupChatConversation":return GR.bF.GroupChat;case"OneGQL_ChannelConversation":return GR.bF.Channel;case"OneGQL_MeetingChatConversation":return GR.bF.Meeting;case"OneGQL_BotChatConversation":return GR.bF.Botchat;default:return}},She=e=>{switch(e){case"SimpleCollabHeaderNewMessageButton":return"leftrailheader";case"SimpleCollabHeaderListItem":return"leftrailheadermenu";default:return}},fhe=e=>{switch(e){case"STANDARD":return"Regular";case"PRIVATE":return"Private";case"SHARED":return"Shared";case"STANDALONE":return"Standalone";default:return}},khe={panelRegion:GR.rP.main,panelType:GR.HP.ChatList},Che=e=>{Ope.simpleCollabStore.set(Ope.selectionIdAtom,e||""),Ope.simpleCollabStore.set(Ope.seeAllChannelsAtom,"")},bhe=()=>{Ope.simpleCollabStore.set(Ope.selectionIdAtom,""),Ope.simpleCollabStore.set(Ope.seeAllChannelsAtom,"")},whe=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabChatContextMenuEvent","simple-collab-context-menu");switch(a){case i2.$G.chatManageApps:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`chatManageApps: chatId: ${e.id}`,"simple_collab_chat_context_menu_chat_manage_apps"),Che(e.selectedId),((e,t,n,i)=>{const a=n?.();t({...vhe(),moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListManageAppsChatMoreMenuOptions,actionScenarioType:GR.DB.chatListManageApps,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:Jd(e)})}case i2.$G.leaveChat:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChat: chatId: ${e.id}, isGuardianChat: ${e.isGuardianChat}`,"simple_collab_chat_context_menu_leave_chat"),((e,t,n,i)=>{const a=n?.();t({...vhe(),moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListLeaveChat,actionScenarioType:GR.DB.chatListLeaveChat,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:Kd(e)})}case i2.$G.blockChat:{const e="function"==typeof i?i():{};return((e,t,n,i)=>{const a=n?.();t({...vhe(),moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListBlockContact,actionScenarioType:GR.DB.chatListBlockContact,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:Zd(e)})}case i2.$G.deleteChat:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`deleteChat: chatId: ${e.id}, title: ${e.title}, isGroupChat: ${e.isGroupChat}, isOneOnOneChat: ${e.isOneOnOneChat}`,"simple_collab_chat_context_menu_delete_chat"),((e,t,n,i)=>{const a=n?.();t({...vhe(),moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListDeleteChat,actionScenarioType:GR.DB.chatListDeleteChat,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:Xd(e)})}case i2.$G.chatWorkflows:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`chatWorkflows: chatId: ${e.id}, correlationIdOverride: ${e.correlationIdOverride}`,"simple_collab_chat_context_menu_workflows"),((e,t,n,i)=>{const a=n?.();t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListWorkflowsChatMoreMenuOptions,actionScenarioType:GR.DB.chatListWorkflows,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:eu(e)})}case i2.$G.muteChat:return((e,t,n,i)=>{const a=n?.();t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListMuteChat,actionScenarioType:GR.DB.chatListMuteChat,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,("function"==typeof i?i():{}).id),Promise.resolve(void 0);case i2.$G.unmuteChat:return((e,t,n,i)=>{const a=n?.();t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListUnmuteChat,actionScenarioType:GR.DB.chatListMuteChat,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,("function"==typeof i?i():{}).id),Promise.resolve(void 0);case i2.$G.markAsReadChat:return((e,t,n,i)=>{const a=n?.();t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListMarkAsRead,actionScenarioType:GR.DB.chatListMarkReadChat,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,("function"==typeof i?i():{}).id),Promise.resolve(void 0);case i2.$G.markAsUnreadChat:return((e,t,n,i)=>{const a=n?.();t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListMarkAsUnread,actionScenarioType:GR.DB.chatListMarkReadChat,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,("function"==typeof i?i():{}).id),Promise.resolve(void 0);case i2.$G.openInNewWindowChat:return((e,t,n,i)=>{const a=n?.();t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListOpenInNewWindow,actionScenarioType:GR.DB.chatListOpenInNewWindow,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:a},e),a?.dispose()})(s,o,r,("function"==typeof i?i():{}).id),Promise.resolve(void 0);case i2.$G.followPresence:{const e="function"==typeof i?i():{},{id:t,intent:n,isPresenceFollowed:a,message:l}=e;return"Success"===n&&((e,t,n,i,a)=>{const o=n?.();o&&(o.tagged=a),t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.chatListTagContact,actionScenarioType:GR.DB.chat,moduleName:GR.Sn.chatActions,moduleType:GR.nR.button,tabOrdinal:1,threadId:i,...khe,dataBag:o},e),o?.dispose()})(s,o,r,t,a),Promise.resolve({command:c2({title:l,intent:n,duration:4e3,dismissOnAction:!0})})}case i2.$G.chatContextMenuClick:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),actionGesture:GR.Od.click,actionScenario:GR.vB.chatListOpenMenu,actionScenarioType:GR.DB.chat,moduleName:GR.Sn.menuButton,moduleType:GR.nR.menuItem,...khe,dataBag:i},e),i?.dispose()})(s,o,r);default:return Promise.resolve(void 0)}},The={actionGesture:GR.Od.click,actionOutcome:GR.nd.select,actionOutcomeNew:GR.nd.nav},Ihe={panelRegion:GR.rP.left,panelRegionNew:GR.rP.left,panelType:GR.HP.teamChannelList,panelTypeNew:GR.HP.teamChannelList,panelUri:"app.conversation"},Nhe={actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.manageChannel,actionSubworkload:GR.i7.channelManagement,actionWorkload:GR.E0.teamChannelManagement};var Ahe;!function(e){e.Regular="Regular",e.Private="Private",e.Shared="Shared",e.Standalone="Standalone"}(Ahe||(Ahe={}));const Ehe=(e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers,i.channelType="Shared"),t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.submit,actionScenario:GR.vB.chnlSetSaved,actionScenarioType:GR.DB.chnlSet,actionSubworkload:GR.i7.channelNotification,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.popoverMenuService_channelOverflowMenu_click_chnlSetSaved,moduleName:GR.Sn.popoverMenuService,moduleNameNew:GR.Sn.popoverMenuService,moduleType:GR.nR.channelOverflowMenu,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()},Fhe=(e,t,n,i)=>{const a=n?.();a&&(a.isChannelsV2=!0,a.channelAction=JB.s4.deleteChannel,a.channelType=(e=>{switch(e){case Ahe.Regular:case Ahe.Private:case Ahe.Shared:case Ahe.Standalone:return e;default:return Ahe.Regular}})(i)),t({...vhe(),...Nhe,actionSubworkload:GR.i7.deleteChannel,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.deleteChannel,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:a},e),a?.dispose()},_he=e=>{const t=Ope.simpleCollabStore.get(Ope.selectedConversationFolderSeeReadAtom);e&&t&&t!==e&&Ope.simpleCollabStore.set(Ope.selectedConversationFolderSeeReadAtom,"")},Dhe=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabChannelContextMenuEvent","simple-collab-context-menu");switch(a){case i2.$G.channelNotificationSettings:return Phe({data:i,logger:s,recordPanelAction:o,createDatabag:r});case i2.$G.channelWorkflows:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelWorkflows: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_channel_workflow"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.editChannelWorkflows),t({...vhe(),...Nhe,actionScenario:GR.vB.channelWorkflowsDialog,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.workflows,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Id(e)})}case i2.$G.editChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`editChannel: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_edit_channel"),Promise.resolve({command:Ed(e)})}case i2.$G.archiveChannel:{const e="function"==typeof i?i():{};return Promise.resolve({command:Nd(e)})}case i2.$G.toastMessageChannelEvent:return Lhe({data:i});case i2.$G.deleteChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`deleteChannel: channelId: ${e.channelId}, channelType: ${e.channelType}, filesUrl: ${e.filesUrl}, teamId: ${e.teamId}, channelSubstrateGroupId: ${e.channelSubstrateGroupId}, channelOnlyMember: ${e.channelOnlyMember}, isGeneral: ${e.isGeneral}, isShown: ${e.isShown}, groupId: ${e.groupId}, teamTenantId: ${e.teamTenantId}`,"simple_collab_channel_context_menu_delete_channel"),Fhe(s,o,r,e.channelType),Promise.resolve({command:Ad(e)})}case i2.$G.getLinkToChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`getLinkToChannel: channelId: ${e.channelId}, groupId: ${e.groupId}, teamId: ${e.teamId}, channelResourceTenantId: ${e.channelResourceTenantId}`,"simple_collab_channel_context_menu_get_link_to_channel"),((e,t,n,i)=>{const a=n?.();a&&(a.isChannelsV2=!0,a.channelAction=JB.s4.getChannelLink,a.channelType=fhe(i)),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.getChannelLink,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:a},e),a?.dispose()})(s,o,r,e.channelType),Promise.resolve({command:Fd(e)})}case i2.$G.manageChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannel: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_manage_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.manageChannel),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.manageChannelMenuItem,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(s,o,r),Che(e.selectedId),Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),_he(e.sectionId),Promise.resolve({command:Dd(e)})}case i2.$G.manageChannelTags:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannelTags: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_manage_channel_tags"),Che(e.selectedId),Promise.resolve({command:Md(e)})}case i2.$G.viewChannelEmail:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`viewChannelEmail: channelId: ${e.channelId}`,"simple_collab_channel_context_menu_view_channel_email"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.getChannelEmail),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.getChannelEmailAddress,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Rd(e)})}case i2.$G.channelAddMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelAddMembers: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_add_members"),Promise.resolve({command:xd(e)})}case i2.$G.leaveChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, isLastOwner: ${e.isLastOwner}, groupId: ${e.groupId}, channelOnlyMember: ${e.channelOnlyMember}`,"simple_collab_channel_context_menu_leave_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.leaveChannel),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.leaveChannel,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Ld(e)})}case i2.$G.shareChannelWithUser:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithUser: channelId: ${e.channelId}`,"simple_collab_channel_context_menu_share_channel_with_user"),Ehe(s,o,r),Promise.resolve({command:Od(e)})}case i2.$G.shareChannelWithTeam:return Mhe({data:i,logger:s,recordPanelAction:o,createDatabag:r});case i2.$G.shareChannelWithTeamYouOwn:return Rhe({data:i,logger:s,recordPanelAction:o,createDatabag:r});case i2.$G.showHideChannel:return void((e,t,n,i)=>{const a=n?.();a&&(a.isChannelsV2=!0,a.channelAction=i?.lastChannelHide?JB.s4.lastChannelHide:JB.s4.favoriteChannel,a.channelState=i?.isShown?JB.d8.shown:JB.d8.hidden,a.isGeneralChannel=i?.isGeneral?JB.wy.General:JB.wy.NotGeneral),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:a},e),a?.dispose()})(s,o,r,"function"==typeof i?i():{});case i2.$G.manageTeamChannels:return xhe({data:i,logger:s,recordPanelAction:o,createDatabag:r});case i2.$G.channelContextMenuClick:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...Nhe,actionScenario:GR.vB.channelOpenMenu,actionScenarioType:GR.DB.admin,actionSubworkload:GR.i7.teamManagement,actionWorkload:GR.E0.teamChannelManagement,moduleName:GR.Sn.menuButton,moduleNameNew:GR.Sn.teamOverflowMenu,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(s,o,r);case i2.$G.setChannelRecommendation:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.setChannelRecommendation),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(s,o,r);default:return}},Phe=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`channelNotificationSettings: channelId: ${a.channelId}`,"simple_collab_channel_context_menu_channel_notification"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.channelNotificationSettings),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleNameNew:GR.Sn.channelNotificationSettings,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(t,n,i),Promise.resolve({command:Td(a)})},Mhe=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`shareChannelWithTeam: channelId: ${a.channelId}, teamId: ${a.teamId}`,"simple_collab_channel_context_menu_share_channel_with_team"),Ehe(t,n,i),Promise.resolve({command:jd(a)})},Rhe=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`shareChannelWithTeamYouOwn: channelId: ${a.channelId}, teamId: ${a.teamId}`,"simple_collab_channel_context_menu_share_channel_with_team_you_own"),Ehe(t,n,i),Promise.resolve({command:Bd(a)})},xhe=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`manageTeamChannels: channelId: ${a.channelId}, teamId: ${a.teamId}`,"simple_collab_channel_context_menu_manage_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.manageTeam),t({...vhe(),...Nhe,eventIdentifier:GR.AJ.channelActionMenu_menuItem_click_channelAction,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.channelOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(t,n,i),Che(a.selectedId),Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:a.channelId,teamId:a.teamId})),_he(a.sectionId),Promise.resolve({command:$d(a)})},Lhe=({data:e})=>{const t="function"==typeof e?e():{},n=t.success?"Success":"Error",i=t.title;return Promise.resolve({command:c2({intent:n,title:i,dismissOnAction:!0})})},Ohe=async(e,t,n,i)=>{const{data:a,type:o}=e,r=t.newLogger("SimpleCollabTeamContextMenuEvent","simple-collab-context-menu"),{recordPanelAction:s,createDatabag:l}=n;switch(o){case i2.$G.manageTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`manageTeam: teamId: ${e.teamId}`,"simple_collab_team_context_menu_manage_team"),bhe(),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.teamNav,actionScenarioType:GR.DB.openteam,actionSubworkload:GR.i7.teamManagement,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.listItem_menuItem_click_teamNav,moduleName:GR.Sn.listItem,moduleNameNew:GR.Sn.manageTeamMenuItem,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:Ud(e)})}case i2.$G.manageTags:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`manageTags: teamId: ${e.teamId}`,"simple_collab_team_context_menu_manage_tags"),bhe(),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.openManageTagsDialog,actionScenarioType:GR.DB.openDialog,actionSubworkload:GR.i7.tagManagement,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.button_click_openManageTagsDialog,moduleNameNew:GR.Sn.manageTeamTags,moduleType:GR.nR.button,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:Vd(e)})}case i2.$G.getLinkToTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`getLinkToTeam: teamId: ${e.teamId}, groupId: ${e.groupId}`,"simple_collab_team_context_menu_get_link_to_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.getTeamDeeplink,actionScenarioType:GR.DB.openDialog,actionSubworkload:GR.i7.teamManagement,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.listItem_menuItem_click_getTeamDeeplink,moduleName:GR.Sn.listItem,moduleNameNew:GR.Sn.getTeamLinkMenuItem,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:Hd(e)})}case i2.$G.leaveTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`getLinkToTeam: teamId: ${e.teamId}, groupId: ${e.groupId}`,"simple_collab_team_context_menu_leave_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.leaveTeam,actionScenarioType:GR.DB.admin,actionSubworkload:GR.i7.leaveTeam,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.listItem_menuItem_click_leaveTeam,moduleName:GR.Sn.listItem,moduleNameNew:GR.Sn.leaveTeamMenuItem,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:zd(e)})}case i2.$G.teamAddMember:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`teamAddMember: teamId: ${e.teamId}`,"simple_collab_team_context_menu_team_add_member"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.addMember,actionScenarioType:GR.DB.openDialog,actionSubworkload:GR.i7.addMember,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.addMember_menuItem_click_addMember,moduleName:GR.Sn.addMember,moduleNameNew:GR.Sn.addMemberMenuItem,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:Gd(e)})}case i2.$G.teamAddChannel:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`teamAddChannel: teamId: ${e.teamId}`,"simple_collab_team_context_menu_team_add_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.addChannel,actionScenarioType:GR.DB.openDialog,actionSubworkload:GR.i7.addChannel,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.addChannel_teamActionMenu_click_addChannel,moduleName:GR.Sn.addChannel,moduleNameNew:GR.Sn.addChannelMenuItem,moduleType:GR.nR.teamActionMenu,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:Yd(e)})}case i2.$G.deleteTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`deleteTeam: teamId: ${e.teamId}, groupId: ${e.groupId}`,"simple_collab_team_context_menu_delete_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.deleteTeam,actionScenarioType:GR.DB.openDialog,actionSubworkload:GR.i7.teamManagement,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.manageTagsDialog_teamActionMenu_click_deleteTeam,moduleName:GR.Sn.manageTagsDialog,moduleNameNew:GR.Sn.deleteTeamMenuItem,moduleType:GR.nR.teamActionMenu,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:Qd(e)})}case i2.$G.forceHideTeam:{const e="function"==typeof a?a():{},{teamName:t}=e;return Promise.resolve({command:c2({intent:"Success",title:i.stringTranslate("teamsAndChannels","hide_team_toast_details",{teamName:t}),dismissOnAction:!0})})}case i2.$G.teamContextMenuClick:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...The,actionScenario:GR.vB.teamOpenMenu,actionScenarioType:GR.DB.admin,actionSubworkload:GR.i7.teamManagement,actionWorkload:GR.E0.teamChannelManagement,moduleName:GR.Sn.menuButton,moduleNameNew:GR.Sn.teamOverflowMenu,moduleType:GR.nR.menuItem,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(r,s,l);case i2.$G.hideAllChannelsDialog:case i2.$G.hideAllChannelsSucceeded:case i2.$G.hideAllChannelsFailed:case i2.$G.hideAllChannelsDialogCancelAction:case i2.$G.hideAllChannelsDialogConfirmAction:return jhe(e,n,i,r);default:return}},jhe=async(e,t,n,i)=>{const{data:a,type:o}=e,{recordPanelAction:r,createDatabag:s}=t;switch(o){case i2.$G.hideAllChannelsDialog:{const e="function"==typeof a?a():{};return i.infoToTelemetry?.(`Dialog: Opening Hide all channels dialog for teamId: ${e.teamId}`,"simple_collab_team_context_menu_hide_all_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.openDialog,actionScenario:GR.vB.openHideAllChannelsDialog,actionScenarioType:GR.DB.hideAllChannels,moduleName:GR.Sn.listItem,moduleType:GR.nR.menuItem,...Ihe,moduleTypeNew:GR.nR.teamListOverflowMenu,dataBag:i},e),i?.dispose()})(i,r,s),Promise.resolve({command:qd(e)})}case i2.$G.hideAllChannelsSucceeded:{const e="function"==typeof a?a():{};return i.infoToTelemetry?.(`Succeeded: Hide all channels succeeded for teamId: ${e.teamId}`,"simple_collab_team_context_menu_hide_all_channels"),Promise.resolve({command:c2({intent:"Success",title:n.stringTranslate("simpleCollab","simple_collab_hide_all_channels_toast_success"),dismissOnAction:!0})})}case i2.$G.hideAllChannelsFailed:{const e="function"==typeof a?a():{};return i.errorToTelemetry?.(`Error: Hide all channels failed for teamId: ${e.teamId}`,"simple_collab_team_context_menu_hide_all_channels"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_hide_all_channels_toast_failed"),dismissOnAction:!0})})}case i2.$G.hideAllChannelsDialogCancelAction:{const e="function"==typeof a?a():{};return i.infoToTelemetry?.(`Cancelled: Hide all channels dialog cancelled for teamId: ${e.teamId}`,"simple_collab_team_context_menu_hide_all_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.cancel,actionScenario:GR.vB.hideAllChannelsDialogCancelButton,actionScenarioType:GR.DB.hideAllChannels,moduleName:GR.Sn.listItem,moduleType:GR.nR.button,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(i,r,s),Promise.resolve(void 0)}case i2.$G.hideAllChannelsDialogConfirmAction:{const e="function"==typeof a?a():{};return i.infoToTelemetry?.(`Confirmed: Hide all channels confirmed for teamId: ${e.teamId}`,"simple_collab_team_context_menu_hide_all_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.hideAllChannelsDialogHideButton,actionScenarioType:GR.DB.hideAllChannels,moduleName:GR.Sn.listItem,moduleType:GR.nR.button,moduleTypeNew:GR.nR.teamListOverflowMenu,...Ihe,dataBag:i},e),i?.dispose()})(i,r,s),Promise.resolve(void 0)}default:return Promise.resolve(void 0)}},Bhe={actionGesture:GR.Od.click,actionOutcome:GR.nd.nav},Uhe={panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList},$he={actionGesture:GR.Od.click,actionOutcome:GR.nd.openChatListFilter},Whe=(e,t)=>{const n=t?GR.vB.hideStickyFilterAtTopFromLeftRail:GR.vB.showStickyFilterAtTopOfLeftRail;switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:n,panelType:GR.HP.teamChannelList};case"CHATS":return{actionScenario:n,panelType:GR.HP.chatList};default:return{actionScenario:n,panelType:GR.HP.combinedList}}},Vhe=async(e,t,n)=>{const{data:i,type:a}=e,o=t.newLogger("SimpleCollabLeftRailHeaderContextMenuEvent","simple-collab-left-rail-header-context-menu"),{recordPanelAction:r,createDatabag:s}=n;switch(a){case i2.$G.joinTeam:{o.infoToTelemetry?.("Join Team","simple_collab_left_rail_header_context_menu_join_team");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...Bhe,...vhe(),...Uhe,actionScenario:GR.vB.clickHeaderMenuJoinTeamItem,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.headerAddMenu,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:ru(e)})}case i2.$G.createChannel:{o.infoToTelemetry?.("Create Channel","simple_collab_left_rail_header_context_menu_create_channel");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...Bhe,...vhe(),...Uhe,actionScenario:GR.vB.clickHeaderMenuNewChannelItem,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.headerAddMenu,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:lu(e)})}case i2.$G.createTeam:{o.infoToTelemetry?.("Create Team","simple_collab_left_rail_header_context_menu_create_team");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...Bhe,...vhe(),...Uhe,actionScenario:GR.vB.clickHeaderMenuCreateTeamItem,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.headerAddMenu,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:cu(e)})}case i2.$G.manageTeams:{o.infoToTelemetry?.("Manage Teams","simple_collab_left_rail_header_context_menu_manage_teams");const e="function"==typeof i?i():{};return Promise.resolve({command:du(e)})}case i2.$G.viewMoreSettings:{o.infoToTelemetry?.("view more settings","simple_collab_left_rail_header_context_menu_view_more_settings");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...Bhe,...vhe(),...Uhe,actionScenario:GR.vB.clickHeaderViewMoreSettingsItem,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.viewMoreSettingsContextMenuItem,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:uu(e)})}case i2.$G.leftRailHeaderPlusMenuOpen:{o.infoToTelemetry?.("Header plus menu","simple_collab_left_rail_header_plus_menu");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...Bhe,...vhe(),...Uhe,actionScenario:GR.vB.openSimpleCollabListMoreMenu,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.listMoreMenuHeader,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:mu(e)})}case i2.$G.openFilterLeftRail:{o.infoToTelemetry?.("Filter menu","simple_collab_open_filter_left_rail_menu");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...$he,...vhe(),...Uhe,actionScenario:GR.vB.openChatListFilter,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.chatList,entityType:ke.ck.chats,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:pu(e)})}case i2.$G.clickLeftRailHeaderShowAtTopFilterMenu:o.infoToTelemetry?.("Filter menu","simple_collab_left_rail_header_context_menu_show_at_top_filter"),((e,t,n,i)=>{const a="function"==typeof e?e():{},o=i?.(),{actionScenario:r,panelType:s}=Whe(a.BIEventData?.type,a.BIEventData?.disableShowAtTop);n({...vhe(),actionGesture:GR.Od.click,actionScenario:r,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.showAtTopFilterHeaderContextMenuItem,panelRegion:GR.rP.left,panelType:s,dataBag:o},t),o?.dispose()})(i,o,r,s);case i2.$G.openManageTeams:return o.infoToTelemetry?.("Header more menu","simple_collab_left_rail_header_more_menu"),((e,t,n)=>{const i=n?.();t({...Bhe,...vhe(),...Uhe,actionScenario:GR.vB.teamsMoreButtonClick,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.button,moduleName:GR.Sn.teamsNavigateBarMoreButton,entityType:ke.ck.channels,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:gu()});case i2.$G.createTeamOnMainView:{const e="function"==typeof i?i():{};return Promise.resolve({command:hu(e)})}default:return}},Hhe={actionGesture:GR.Od.click,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList},zhe=({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i}=t,a=n.newLogger("SimpleCollabEvents","simple-collab-event-action-handlers"),o=e();return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r=i?.isLegacyFavoritesFolder?"favorites":"customSection",s=a?.();s&&(s.sectionType=r,s.sectionId=i?.sectionId),o({...vhe(),...Hhe,actionOutcome:GR.nd.openDialog,actionScenario:GR.vB.openRenameCustomSectionDialog,actionScenarioType:GR.DB.renameCustomSection,dataBag:s},t),s?.dispose()})({data:e,logger:a,userBiService:i}),Promise.resolve({command:au(o)})},qhe=({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i}=t,a=n.newLogger("SimpleCollabEvents","simple-collab-event-action-handlers"),o=e();return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r=i?.isLegacyFavoritesFolder?"favorites":"customSection",s=a?.();s&&(s.sectionType=r,s.targetSectionType=r,s.sectionId=i?.sectionId,s.itemType=i?.itemType),o({...vhe(),...Hhe,actionOutcome:GR.nd.openDialog,actionScenario:GR.vB.openRemoveCustomSectionDialog,actionScenarioType:GR.DB.removeCustomSection,dataBag:s},t),s?.dispose()})({data:e,logger:a,userBiService:i}),Promise.resolve({command:iu(o)})},Ghe=(e,t)=>{switch(e){case"HIDDEN_CHANNELS":return"hiddenChannels";case"RECENT_CHATS":return"recentChats";case"RECENT_CHANNELS":return"recentChannels";case"TEAMS_AND_CHANNELS":return"teamsAndChannels";case"APPS":return"apps";default:return t?"favorites":"customSection"}},Yhe=e=>{switch(e){case"CHANNELS_ONLY":return"recentChannels";case"TEAMS_AND_CHANNELS":return"teamsAndChannels";default:throw new Error(`Unsupported viewType: ${e}`)}};var Qhe;!function(e){e.MaxItemsPerFolderThreshold="MaxItemsPerFolderThreshold",e.MoveItemFailedToMoveWithinFolder="MoveItemFailedToMoveWithinFolder",e.InvalidClientLieFolderAction="InvalidClientLieFolderAction"}(Qhe||(Qhe={}));const Jhe=({appType:e,appTypeOverride:t,leftRailAppType:n,logger:i,userBiService:a})=>{const{recordPanelAction:o}=a;if("unified"===n&&t){const e={actionGesture:GR.Od.click,actionScenarioType:GR.DB.unifiedMoreMenu,moduleName:GR.Sn.markAllUnifiedListRead,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList};let n={};switch(t){case"chat":n={actionOutcome:GR.nd.markAllChatsAsRead,actionScenario:GR.vB.markAllChatsAsReadUnified};break;case"channel":n={actionOutcome:GR.nd.markAllChannelsAsRead,actionScenario:GR.vB.markAllChannelsAsReadUnified};break;case"unified":n={actionOutcome:GR.nd.markAllAsRead,actionScenario:GR.vB.markAllAsReadUnified}}o({...vhe(),...e,...n},i)}else"chat"===e?o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.markAllAsRead,actionScenario:GR.vB.markAllChatListRead,actionScenarioType:GR.DB.chatMoreMenu,moduleName:GR.Sn.markAllChatListRead,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.ChatList},i):"channel"===e?o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.markAllAsRead,actionScenario:GR.vB.markAllTeamChannelsListRead,actionScenarioType:GR.DB.teamsMoreMenu,moduleName:GR.Sn.markAllTeamChannelsListRead,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.teamChannelList},i):"unified"===e&&o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.markAllAsRead,actionScenario:GR.vB.markAllAsReadUnified,actionScenarioType:GR.DB.markAllAsReadByApp,moduleName:GR.Sn.markAllAsReadByAppButton,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList},i)},Khe=async(e,t)=>{if(!Zhe(e))return;const{data:n,type:i}=e,a=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);switch(i){case i2.sU.createConversationFolder:case i2.T8.createConversationFolderCancelAction:case i2.T8.createConversationFolderConfirmAction:case i2.T8.createConversationFolderSucceeded:case i2.T8.createConversationFolderFailed:return g2({event:e,requestContext:t,commonSimpleCollabBiTelemetry:vhe,selectedApp:a});case i2.T8.renameConversationFolderCancelAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i}=t,{createDatabag:a,recordPanelAction:o}=i,r=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isLegacyFavoritesFolder:s}=e(),l=s?"favorites":"customSection",c=a?.();c&&(c.sectionType=l),o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.cancel,actionScenario:GR.vB.renameCustomSectionCancelButton,actionScenarioType:GR.DB.renameCustomSection,moduleName:GR.Sn.renameCustomSectionCancelButton,moduleType:GR.nR.cancelButton,panelRegion:GR.rP.modal,panelType:GR.HP.renameCustomSectionDialog,dataBag:c},r),c?.dispose()})({data:n,requestContext:t});case i2.T8.renameConversationFolderConfirmAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i,userBiService:a}=t,{createDatabag:o,recordPanelAction:r}=a,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.newScenario(be.Cu.SimpleCollabRenameConversationFolder);const{isLegacyFavoritesFolder:l}=e(),c=l?"favorites":"customSection",d=o?.();d&&(d.sectionType=c),r({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.renameCustomSectionSaveButton,actionScenarioType:GR.DB.renameCustomSection,moduleName:GR.Sn.renameCustomSectionSaveButton,moduleType:GR.nR.saveButton,panelRegion:GR.rP.modal,panelType:GR.HP.renameCustomSectionDialog,dataBag:d},s),d?.dispose()})({data:n,requestContext:t});case i2.T8.renameConversationFolderSucceeded:return(({requestContext:e})=>{const{i18n:t,loggerFactory:n,scenarioFactory:i}=e,a=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");return a.infoToTelemetry?.("Rename conversation folder succeeded.","simple_collab_rename_conversation_folder",void 0,!0),i.stopScenarioIfActive(be.Cu.SimpleCollabRenameConversationFolder),Promise.resolve({command:c2({intent:"Success",title:t.stringTranslate("simpleCollab","simple_collab_toast_rename_folder_success"),dismissOnAction:!0})})})({requestContext:t});case i2.sU.renameConversationFolder:return zhe({data:n,requestContext:t});case i2.T8.renameConversationFolderFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,folderName:l,isExpected:c}=e();return o.errorToTelemetry?.(`Rename conversation folder failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_rename_conversation_folder",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabRenameConversationFolder,{errorCode:r},c?"abandoned":"failure"),Promise.resolve({command:c2({intent:"Error",title:r===d.O4.DuplicateFolderNamesNotAllowed?n.stringTranslate("simpleCollab","simple_collab_toast_rename_folder_failed_duplicate_name",{folderName:l}):n.stringTranslate("simpleCollab","simple_collab_toast_rename_folder_failed"),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.sU.removeConversationFolder:return qhe({data:n,requestContext:t});case i2.T8.removeConversationFolderCancelAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i}=t,{createDatabag:a,recordPanelAction:o}=i,r=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isLegacyFavoritesFolder:s}=e(),l=s?"favorites":"customSection",c=a?.();c&&(c.sectionType=l),o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.cancel,actionScenario:GR.vB.removeCustomSectionCancelButton,actionScenarioType:GR.DB.removeCustomSection,moduleName:GR.Sn.removeCustomSectionCancelButton,moduleType:GR.nR.cancelButton,panelRegion:GR.rP.dialog,panelType:GR.HP.removeCustomSectionDialog,dataBag:c},r),c?.dispose()})({data:n,requestContext:t});case i2.T8.removeConversationFolderConfirmAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i,userBiService:a}=t,{createDatabag:o,recordPanelAction:r}=a,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.newScenario(be.Cu.SimpleCollabRemoveConversationFolder);const{isLegacyFavoritesFolder:l}=e(),c=l?"favorites":"customSection",d=o?.();d&&(d.sectionType=c),r({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.confirm,actionScenario:GR.vB.removeCustomSectionRemoveButton,actionScenarioType:GR.DB.removeCustomSection,moduleName:GR.Sn.removeCustomSectionRemoveButton,moduleType:GR.nR.confirmDeleteButton,panelRegion:GR.rP.dialog,panelType:GR.HP.removeCustomSectionDialog,dataBag:d},s),d?.dispose()})({data:n,requestContext:t});case i2.T8.removeConversationFolderSucceeded:return(({requestContext:e})=>{const{i18n:t,loggerFactory:n,scenarioFactory:i}=e,a=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");return a.infoToTelemetry?.("Remove conversation folder succeeded.","simple_collab_remove_conversation_folder",void 0,!0),i.stopScenarioIfActive(be.Cu.SimpleCollabRemoveConversationFolder),Promise.resolve({command:c2({intent:"Success",title:t.stringTranslate("simpleCollab","simple_collab_toast_remove_folder_success"),dismissOnAction:!0})})})({requestContext:t});case i2.T8.removeConversationFolderFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,isExpected:l}=e();return o.errorToTelemetry?.(`Remove conversation folder failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_remove_conversation_folder",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabRemoveConversationFolder,{errorCode:r},l?"abandoned":"failure"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_toast_remove_folder_failed"),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.removeFromFolderAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i,scenarioFactory:a}=t,{createDatabag:o,recordPanelAction:r}=i,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isLegacyFavoritesFolder:l,itemType:c,viewType:d}=e();a.newScenario(be.Cu.SimpleCollabRemoveFromConversationFolder);const u=l?"favorites":"customSection",m="channel"===c?Yhe(d):"recentChats",p=o?.();p&&(p.sectionType=u,p.itemType=c,p.targetSectionType=m),r({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.remove,actionScenario:GR.vB.removeFromCustomSectionButton,actionScenarioType:GR.DB.removeFromCustomSection,moduleName:GR.Sn.removeFromCustomSectionButton,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:p},s),p?.dispose()})({data:n,requestContext:t});case i2.T8.removeFromFolderSucceeded:return(({requestContext:e})=>{const{i18n:t,loggerFactory:n,scenarioFactory:i}=e,a=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");return a.infoToTelemetry?.("Remove conversation from folder succeeded.","simple_collab_remove_from_folder",void 0,!0),i.stopScenarioIfActive(be.Cu.SimpleCollabRemoveFromConversationFolder),Promise.resolve({command:c2({intent:"Success",title:t.stringTranslate("simpleCollab","simple_collab_toast_remove_conv_from_folder_success"),dismissOnAction:!0})})})({requestContext:t});case i2.T8.removeFromFolderFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,isExpected:l}=e();return o.errorToTelemetry?.(`Remove from folder failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_remove_from_folder",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabRemoveFromConversationFolder,{errorCode:r},l?"abandoned":"failure"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_toast_remove_conv_from_folder_failed"),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.moveConversationToFolderAction:case i2.T8.moveToSubMenuClick:case i2.T8.moveConversationToFolderSucceeded:case i2.T8.moveConversationToFolderFailed:return T2({event:e,requestContext:t,commonSimpleCollabBiTelemetry:vhe,selectedApp:a});case i2.T8.setConversationFolderSeeReadsExpandedStateAction:return(({data:e})=>{const{sectionId:t,isExpanded:n}=e();n&&t?Ope.simpleCollabStore.set(Ope.selectedConversationFolderSeeReadAtom,t):n||Ope.simpleCollabStore.set(Ope.selectedConversationFolderSeeReadAtom,"")})({data:n});case i2.T8.setConversationFolderExpandedStateAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i,scenarioFactory:a}=t,{createDatabag:o,recordPanelAction:r}=i,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isExpanded:l,isLegacyFavoritesFolder:c,folderType:d,sectionId:u}=e();a.newScenario(be.Cu.SimpleCollabSetConversationFolderExpandedState);const m=Ghe(d,c),p=o?.();p&&(p.sectionType=m,p.sectionId=u),r({...vhe(),actionGesture:GR.Od.click,actionOutcome:l?GR.nd.expanded:GR.nd.collapsed,actionScenario:GR.vB.setSectionExpandedState,actionScenarioType:GR.DB.setSectionExpandedState,moduleName:GR.Sn.sectionTreeItem,moduleType:GR.nR.chevron,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:p},s),p?.dispose()})({data:n,requestContext:t});case i2.T8.setConversationFolderExpandedStateSucceeded:return(({requestContext:e})=>{const{loggerFactory:t,scenarioFactory:n}=e,i=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.infoToTelemetry?.("Set conversation folder expanded state succeeded.","simple_collab_set_conversation_expanded_state",void 0,!0),n.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFolderExpandedState)})({requestContext:t});case i2.T8.setConversationFolderExpandedStateFailed:return(({data:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i}=t,a=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:o,errorDetail:r,isExpected:s}=e();o!==d.O4.FeatureNotSupported?(a.errorToTelemetry?.(`Set conversation folder expanded state failed. errorCode: ${o}, errorDetail: ${r}`,"simple_collab_set_conversation_expanded_state",void 0,!0),i.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFolderExpandedState,{errorCode:o},s?"abandoned":"failure")):i.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFolderExpandedState,{reason:"Known unsupported action"},"abandoned")})({data:n,requestContext:t});case i2.T8.setConversationFoldersExpandedStateAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i,scenarioFactory:a}=t,{createDatabag:o,recordPanelAction:r}=i,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{itemType:l,isExpanded:c}=e();a.newScenario(be.Cu.SimpleCollabSetConversationFoldersExpandedState);const d=o?.();d&&(d.itemType=l),r({...vhe(),actionGesture:GR.Od.click,actionOutcome:c?GR.nd.expanded:GR.nd.collapsed,actionScenario:GR.vB.bulkSetSectionsExpandedState,actionScenarioType:GR.DB.bulkSetSectionsExpandedState,moduleName:GR.Sn.sectionTreeItem,moduleType:GR.nR.chevron,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:d},s),d?.dispose()})({data:n,requestContext:t});case i2.T8.setConversationFoldersExpandedStateSucceeded:return(({requestContext:e})=>{const{loggerFactory:t,scenarioFactory:n}=e,i=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.infoToTelemetry?.("Set folders expanded state succeeded.","simple_collab_set_conversation_folders_expanded_state",void 0,!0),n.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFoldersExpandedState)})({requestContext:t});case i2.T8.setConversationFoldersExpandedStateFailed:return(({data:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i}=t,a=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:o,errorDetail:r}=e();o!==d.O4.FeatureNotSupported?(a.errorToTelemetry?.(`Set folders expanded state failed. errorCode: ${o}, errorDetail: ${r}`,"simple_collab_set_conversation_folders_expanded_state",void 0,!0),i.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFoldersExpandedState,{errorCode:o},"failure")):i.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFoldersExpandedState,{reason:"Known unsupported action"},"abandoned")})({data:n,requestContext:t});case i2.T8.reorderConversationFoldersAction:return(({requestContext:e})=>{const{loggerFactory:t,scenarioFactory:n,userBiService:i}=e,{recordPanelAction:a}=i,o=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");n.newScenario(be.Cu.SimpleCollabReorderConversationFolders),a({...vhe(),actionGesture:GR.Od.dragAndDrop,actionOutcome:GR.nd.reorder,actionScenario:GR.vB.dragAndDropReorderCustomSections,actionScenarioType:GR.DB.reorderCustomSections,moduleName:GR.Sn.sectionTreeItem,moduleType:GR.nR.treeItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList},o)})({requestContext:t});case i2.T8.reorderConversationFoldersSucceeded:return(({requestContext:e})=>{const{loggerFactory:t,scenarioFactory:n}=e,i=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.infoToTelemetry?.("Reorder conversation folders succeeded.","simple_collab_reorder_conversation_folders",void 0,!0),n.stopScenarioIfActive(be.Cu.SimpleCollabReorderConversationFolders)})({requestContext:t});case i2.T8.reorderConversationFoldersFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,isExpected:l}=e();return o.errorToTelemetry?.(`Reorder conversation folders failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_reorder_conversation_folders",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabReorderConversationFolders,{errorCode:r},l?"abandoned":"failure"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_toast_reorder_folders_failed"),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.reorderConversationFolderItemsAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i,scenarioFactory:a}=t,{createDatabag:o,recordPanelAction:r}=i,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{folderType:l,isLegacyFavoritesFolder:c,itemType:d}=e();a.newScenario(be.Cu.SimpleCollabReorderConversationFolderListItems);const u=Ghe(l,c),m=o?.();m&&(m.sectionType=u,m.itemType=d),r({...vhe(),actionGesture:GR.Od.dragAndDrop,actionOutcome:GR.nd.reorder,actionScenario:GR.vB.dragAndDropReorderWithinCustomSection,actionScenarioType:GR.DB.reorderCustomSectionItems,moduleName:GR.Sn.sectionListItem,moduleType:GR.nR.treeItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:m},s),m?.dispose()})({data:n,requestContext:t});case i2.T8.reorderConversationFolderItemsSucceeded:return(({requestContext:e})=>{const{loggerFactory:t,scenarioFactory:n}=e,i=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.infoToTelemetry?.("Reorder conversation folder items succeeded.","simple_collab_reorder_conversation_folder_items",void 0,!0),n.stopScenarioIfActive(be.Cu.SimpleCollabReorderConversationFolderListItems)})({requestContext:t});case i2.T8.reorderConversationFolderItemsFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,isExpected:l}=e();return o.errorToTelemetry?.(`Reorder conversation folder items failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_reorder_conversation_folder_items",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabReorderConversationFolderListItems,{errorCode:r},l?"abandoned":"failure"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_toast_reorder_item_in_folder_failed"),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.dndItemToConversationFolderAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i,scenarioFactory:a}=t,{createDatabag:o,recordPanelAction:r}=i,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{fromFolderType:l,fromFolderId:c,toFolderType:d,toFolderId:u,isFromLegacyFavoritesFolder:m,isToLegacyFavoritesFolder:p,itemType:g,conversationId:h}=e();if(c===u)return void s.warnToTelemetry?.(`Drag and Drop Folder initiated with same source and destination. fromFolderId: ${c} toFolderId: ${u}`,"simple_collab_dnd_item_to_conversation_folder",void 0,!0);const v=a.newScenario(be.Cu.SimpleCollabDnDItemToConversationFolder,{clientId:h}),y=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);v.appendEventData({viewType:y});const S=Ghe(l,m),f=Ghe(d,p),k=o?.();k&&(k.sectionType=S,k.targetSectionType=f,k.itemType=g),r({...vhe(),actionGesture:GR.Od.dragAndDrop,actionOutcome:GR.nd.reorder,actionScenario:GR.vB.dragAndDropReorderBetweenCustomSections,actionScenarioType:GR.DB.reorderCustomSectionItems,moduleName:GR.Sn.sectionListItem,moduleType:GR.nR.treeItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:k},s),k?.dispose()})({data:n,requestContext:t});case i2.T8.dndItemToConversationFolderSucceeded:return(({requestContext:e})=>{const{loggerFactory:t}=e,n=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");n.infoToTelemetry?.("Drag and drop item to conversation folder succeeded.","simple_collab_dnd_item_to_conversation_folder",void 0,!0)})({requestContext:t});case i2.T8.dndItemToConversationFolderFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorCode:r,errorDetail:s,folderName:l,isLoadedFromTeamsHierarchy:c,isExpected:d}=e();o.errorToTelemetry?.(`Drag and drop item to conversation folder failed. errorCode: ${r}, errorDetail: ${s}`,"simple_collab_dnd_item_to_conversation_folder",void 0,!0);const u=c?"simple_collab_toast_show_in_folder_failed_at_limit":"simple_collab_toast_move_chat_failed_at_limit";a.stopScenarioIfActive(be.Cu.SimpleCollabDnDItemToConversationFolder,{errorCode:r},r===Qhe.InvalidClientLieFolderAction||r===Qhe.MaxItemsPerFolderThreshold||r===Qhe.MoveItemFailedToMoveWithinFolder||d?"abandoned":"failure");const m=r===Qhe.MaxItemsPerFolderThreshold?u:"simple_collab_toast_reorder_item_in_folder_failed";return Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab",m,{folderName:l}),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.markAllAsReadByAppAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i,userBiService:a}=t,o=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{appType:r,appTypeOverride:s,leftRailAppType:l}=e();i.newScenario(be.Cu.MarkAllAsRead).appendEventData({appConsumptionHorizonAppType:r}),o.infoToTelemetry?.(`Mark all as read for ${r} app started (leftRailAppType: ${l}, appTypeOverride: ${s}).`,"simple_collab_mark_all_as_read_by_app",void 0,!0),Jhe({appType:r,appTypeOverride:s,leftRailAppType:l,userBiService:a,logger:o})})({data:n,requestContext:t});case i2.T8.markAllAsReadByAppSucceeded:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{appType:r,appTypeOverride:s,leftRailAppType:l}=e();o.infoToTelemetry?.(`Mark all as read by app ${r} succeeded (leftRailAppType: ${l}, appTypeOverride: ${s}).`,"simple_collab_mark_all_as_read_by_app",void 0,!0),a.stopScenarioIfActive(be.Cu.MarkAllAsRead);let c="mark_all_as_read_success";return"unified"===l&&"chat"===s?c="mark_all_chats_as_read_success":"unified"===l&&"channel"===s&&(c="mark_all_channels_as_read_success"),Promise.resolve({command:c2({intent:"Success",title:n.stringTranslate("messaging",c),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.markAllAsReadByAppFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{appType:r,appTypeOverride:s,errorCode:l,errorDetail:c,leftRailAppType:d}=e();o.errorToTelemetry?.(`Mark all as read by app ${r} failed. errorCode: ${l}, errorDetail: ${c}`,"simple_collab_mark_all_as_read_by_app",void 0,!0),a.stopScenarioIfActive(be.Cu.MarkAllAsRead,{errorCode:l},"failure");let u="mark_all_as_read_error";return"unified"===d&&"chat"===s?u="mark_all_chats_as_read_error":"unified"===d&&"channel"===s&&(u="mark_all_channels_as_read_error"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("messaging",u),dismissOnAction:!0})})})({data:n,requestContext:t});case i2.T8.markAllAsReadByAppLog:return(({data:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i}=t,a=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{message:o,logType:r}=e();switch(r){case"errorToTelemetry":a.errorToTelemetry?.(`MAAR: ${o}`,"simple_collab_mark_all_as_read_by_app",void 0,!0);break;case"infoToTelemetry":a.infoToTelemetry?.(`MAAR: ${o}`,"simple_collab_mark_all_as_read_by_app",void 0,!0);break;case"warnToTelemetry":a.warnToTelemetry?.(`MAAR: ${o}`,"simple_collab_mark_all_as_read_by_app",void 0,!0)}const s=i.findScenario(be.Cu.MarkAllAsRead);s?.mark("MarkAllAsReadByAppLog",{reason:o})})({data:n,requestContext:t});case i2.T8.sortConversationFolderAction:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i,scenarioFactory:a}=t,{createDatabag:o,recordPanelAction:r}=i,s=n.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{isLegacyFavoritesFolder:l,folderType:c,sortType:d}=e();a.newScenario(be.Cu.SimpleCollabSetConversationFolderSortType);const u=Ghe(c,l),m=o?.();m&&(m.sectionType=u,m.sortType=d),r({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.sort,actionScenario:GR.vB.sortConversationFolderButton,actionScenarioType:GR.DB.sortConversationFolder,moduleName:GR.Sn.sortConversationFolderButton,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:m},s),m?.dispose()})({data:n,requestContext:t});case i2.T8.sortConversationFolderSucceeded:return(({requestContext:e})=>{const{loggerFactory:t,scenarioFactory:n}=e,i=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");i.infoToTelemetry?.("Sort conversation folder succeeded.","simple_collab_sort_conversation_folder",void 0,!0),n.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFolderSortType)})({requestContext:t});case i2.T8.sortConversationFolderFailed:return(({data:e,requestContext:t})=>{const{i18n:n,loggerFactory:i,scenarioFactory:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{errorDetail:r}=e();return o.errorToTelemetry?.(`Sort conversation folder failed. errorDetail: ${r}`,"simple_collab_sort_conversation_folder",void 0,!0),a.stopScenarioIfActive(be.Cu.SimpleCollabSetConversationFolderSortType,{errorMessage:r},"failure"),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_toast_sort_conversation_folder_failed"),dismissOnAction:!0})})})({data:n,requestContext:t});default:return}},Zhe=e=>e.type in i2.sU||e.type in i2.T8,Xhe=Fce.l.SimpleCollabSwitcher,eve=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabSwitcherEvent","simple-collab-app-switcher-event"),l="function"==typeof i?i():{};switch(s.infoToTelemetry?.(`${a}: commandSource: ${l.commandSource}`,"simple_collab_app_switcher_event"),a){case Fce.z.SwitchOffSimpleCollab:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),actionScenario:GR.vB.toggleSimpleCollabAppSwitcherOff,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenarioType:GR.DB.simpleCollabConfirmDialog,moduleName:GR.Sn.simpleCollabSwitchBack,moduleType:GR.nR.button,dataBag:i},e),i?.dispose()})(s,o,r);case Fce.z.SwitchOnSplitView:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),actionScenario:GR.vB.toggleSimpleCollabAppSwitcherOffConfirmDialogKeepOn,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenarioType:GR.DB.simpleCollabConfirmDialog,moduleName:GR.Sn.simpleCollabKeepOn,moduleType:GR.nR.button,dataBag:i},e),i?.dispose()})(s,o,r);case Fce.z.SwitchBackSurveySimpleCollab:const t={surveyId:l.surveyId??"simpleCollabAppSwitcher",commandSource:l.commandSource??A.p.SimpleCollabSwitchBackConfirmationDialog};return{command:fd(t)};default:return void s.warn(`Received an unhandled simple collab switcher event, type: ${e.type}`)}},tve=Fce.l.SimpleCollabUpdater;var nve=n(825225);const ive={actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.channelAction,actionSubworkload:GR.i7.channelCardQuickActions,actionWorkload:GR.E0.teamChannelManagement,panelRegion:GR.rP.popover,panelType:GR.HP.ChannelCard,panelUri:"app.conversation"},ave=nve.V5.ChannelCard,ove=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabChannelCardEvent","simple-collab-channel-card");switch(a){case nve.Mi.manageTeamMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeamMembers: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_team_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...ive,actionScenario:GR.vB.teamNav,actionScenarioType:GR.DB.openteam,eventIdentifier:GR.AJ.channelCard_manageTeamMembersLink_click_teamNav,moduleName:GR.Sn.channelCardManageTeamMembers,moduleType:GR.nR.manageTeamMembersLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Wd(e)})}case nve.Mi.manageTeamChannels:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeamChannels: teamId: ${e.teamId}, channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_team_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...ive,actionScenario:GR.vB.teamNav,actionScenarioType:GR.DB.openteam,eventIdentifier:GR.AJ.channelCard_manageTeamChannelsLink_click_teamNav,moduleName:GR.Sn.channelCardManageTeamChannels,moduleType:GR.nR.manageTeamChannelsLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:$d(e)})}case nve.Mi.manageChannelMembers:{const e="function"==typeof i?i():{};return Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),_he(e.sectionId),s.infoToTelemetry?.(`manageChannelMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_channel_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vhe(),...ive,actionScenario:GR.vB.channelNav,actionScenarioType:GR.DB.openchannel,eventIdentifier:GR.AJ.channelCard_manageChannelMembersLink_click_channelNav,moduleName:GR.Sn.channelCardManageChannelMembers,moduleType:GR.nR.manageChannelMembersLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Pd(e)})}case nve.Mi.getLinkToChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`getLinkToChannel: channelId: ${e.channelId}, groupId: ${e.groupId}, teamId: ${e.teamId}, channelResourceTenantId: ${e.channelResourceTenantId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_get_link_to_channel"),((e,t,n,i)=>{const a=n?.();a&&(a.isChannelsV2=!0,a.channelAction=JB.s4.getChannelLink,a.channelType=fhe(i)),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_getChannelLinkButton_click_channelAction,actionScenarioType:GR.DB.getChannelLink,moduleName:GR.Sn.channelCardGetChannelLink,moduleType:GR.nR.getChannelLinkButton,dataBag:a},e),a?.dispose()})(s,o,r,e.channelType),Promise.resolve({command:Fd(e)})}case nve.Mi.viewChannelEmail:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`viewChannelEmail: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_view_channel_email"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.getChannelEmail),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_getChannelEmailButton_click_channelAction,actionScenarioType:GR.DB.getChannelEmail,moduleName:GR.Sn.channelCardGetChannelEmail,moduleType:GR.nR.getChannelEmailButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Rd(e)})}case nve.Mi.leaveChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, isLastOwner: ${e.isLastOwner}, groupId: ${e.groupId}, channelOnlyMember: ${e.channelOnlyMember}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_leave_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.leaveChannel),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_leaveChannelButton_click_channelAction,actionScenarioType:GR.DB.leaveChannel,moduleName:GR.Sn.channelCardLeaveChannel,moduleType:GR.nR.leaveChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Ld(e)})}case nve.Mi.manageChannel:{const e="function"==typeof i?i():{};return Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),_he(e.sectionId),s.infoToTelemetry?.(`manageChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.manageChannel),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_manageChannelButton_click_channelAction,actionScenarioType:GR.DB.manageChannel,moduleName:GR.Sn.channelCardManageChannel,moduleType:GR.nR.manageChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Dd(e)})}case nve.Mi.channelAddMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelAddMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_channel_add_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_channelAddMembersButton_click_channelAction,actionScenarioType:GR.DB.channelAddMembers,moduleName:GR.Sn.channelCardAddMembers,moduleType:GR.nR.channelAddMembersButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:xd(e)})}case nve.Mi.shareChannelWithUser:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithUser: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_share_channel_with_user"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers,i.channelType="Shared"),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_shareChannelWithUserButton_click_channelAction,actionScenarioType:GR.DB.shareChannelWithUser,moduleName:GR.Sn.channelCardShareChannelWithUser,moduleType:GR.nR.shareChannelWithUserButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Od(e)})}case nve.Mi.shareChannelWithTeam:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithTeam: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_share_channel_with_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers,i.channelType="Shared"),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_shareChannelWithTeamButton_click_channelAction,actionScenarioType:GR.DB.shareChannelWithTeam,moduleName:GR.Sn.channelCardShareChannelWithTeam,moduleType:GR.nR.shareChannelWithTeamButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:jd(e)})}case nve.Mi.channelNotificationSettings:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelNotificationSettings: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_channel_notification_settings"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.channelNotificationSettings),t({...vhe(),...ive,eventIdentifier:GR.AJ.channelCard_channelNotificationSettingsButton_click_channelAction,actionScenarioType:GR.DB.channelNotificationSettings,moduleName:GR.Sn.channelCardChannelNotificationSettings,moduleType:GR.nR.channelNotificationSettingsButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Td(e)})}default:return}};var rve=n(506453);const sve=rve.Nv,lve=({eventData:e,type:t,logger:n,userBiService:i,scenarioFactory:a})=>{const o=cve[t];if(!o)return;const{channelAction:r,channelState:s,scenarioName:l,...c}=o,d=e?.actionWorkload||c.actionWorkload;a.newScenario(l);const u=i.createDatabag?.();u&&(u.isChannelsV2=!0,u.channelAction=r,u.channelState=s,u.isGeneralChannel=e?.generalChannelType),i.recordPanelAction({...c,...vhe(),actionWorkload:d,dataBag:u},n),u?.dispose()},cve={[rve.w6.seeAllChannelsAction]:{scenarioName:be.Cu.UserOnboardingToTeamSeeAllChannels,actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.seeAllChannelsInChannelList,actionScenarioType:GR.DB.channelList,moduleName:GR.Sn.seeAllChannelsButton,moduleType:GR.nR.button,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,entityType:ke.ck.channels},[rve.w6.seeAllChannelsOnLoadAction]:{scenarioName:be.Cu.UserOnboardingToTeamSeeAllChannels,actionScenario:GR.vB.onboardingPage,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.channelPreviewAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelPreview,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelPreview,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.channelListItem,moduleType:GR.nR.listItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.channelBackAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelBack,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelPreview,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.channelMessagePane,moduleName:GR.Sn.backButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.openContextMenuAction]:{scenarioName:be.Cu.UserOnboardingToTeamOpenContextMenu,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelContextMenu,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.menuButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.goToTeamAction]:{scenarioName:be.Cu.UserOnboardingToTeamGoToTeam,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.goToTeamButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.activityFeed},[rve.w6.activityFeedOnLoadAction]:{scenarioName:be.Cu.UserOnboardingToTeamActivityFeed,actionScenario:GR.vB.activityFeed,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.showChannelAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.shown,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.hideChannelAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.hidden,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.allPillAction]:{scenarioName:be.Cu.UserOnboardingToTeamAllPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectAllChannelFilter,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.allChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.shownPillAction]:{scenarioName:be.Cu.UserOnboardingToTeamShownPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectShownChannelFilter,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.shownChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.hiddenPillAction]:{scenarioName:be.Cu.UserOnboardingToTeamHiddenPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectHiddenChannelFilter,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.hiddenChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.sortByAction]:{scenarioName:be.Cu.UserOnboardingToTeamSortBy,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectSort,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.sortSelection,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.searchAction]:{scenarioName:be.Cu.UserOnboardingToTeamSearch,actionGesture:GR.Od.click,actionScenario:GR.vB.search,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.searchButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.searchResultsAction]:{scenarioName:be.Cu.UserOnboardingToTeamSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.searchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.searchNoResultsAction]:{scenarioName:be.Cu.UserOnboardingToTeamSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.noSearchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel}},dve=(e,t)=>{const{data:n}=e,i="function"==typeof n?n():{},{conversationId:a,isChat:o,hasMention:r}=i;if(!a)return;const s=gve();s&&s.id!==a&&mve(s,t),r&&s?.id!==a&&pve(a,o)},uve=e=>{const t=gve();t&&mve(t,e)},mve=(e,t)=>{hve();const{timestamp:n,id:i,isChat:a}=e,o=Date.now()-parseInt(n,10),r=t.createDatabag?.();r&&(r.read=!0,r.dwellTime=o,r.conversationId=i,r.subType="person",r.type=a?"mentionInChat":"mentionInChannel"),t.recordPanelAction({actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.leftRailConversationEngaged,actionScenarioType:GR.DB.leftRail,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,moduleName:GR.Sn.leftRailList,moduleType:GR.nR.nav,dataBag:r}),r?.dispose()},pve=(e,t)=>{const n=JSON.stringify({id:e,isChat:t,timestamp:Date.now().toString()});Ope.simpleCollabStore.set(Ope.selectedConversationUnreadMentionAtom,n)},gve=()=>{const e=Ope.simpleCollabStore.get(Ope.selectedConversationUnreadMentionAtom);return e?JSON.parse(e):null},hve=()=>{Ope.simpleCollabStore.set(Ope.selectedConversationUnreadMentionAtom,"")};var vve=n(629693);const yve=vve.Nv,Sve=({eventData:e,type:t,logger:n,userBiService:i,scenarioFactory:a})=>{const o=fve[t];if(!o)return;const{channelAction:r,channelState:s,scenarioName:l,...c}=o,d=e?.actionWorkload||c.actionWorkload;a.newScenario(l);const u=i.createDatabag?.();u&&(u.isChannelsV2=!0,u.channelAction=r,u.channelState=s,u.isGeneralChannel=e?.generalChannelType),i.recordPanelAction({...c,...vhe(),actionWorkload:d,dataBag:u},n),u?.dispose()},fve={[vve.W3.seeAllChannelsAction]:{scenarioName:be.Cu.TrinityChannelsTabSeeAllChannels,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenarioType:GR.DB.trinityChannelsTab,moduleName:GR.Sn.seeAllButton,moduleType:GR.nR.button,panelRegion:GR.rP.left,panelType:GR.HP.teamChannelList},[vve.W3.seeAllChannelsOnLoadAction]:{scenarioName:be.Cu.TrinityChannelsTabSeeAllChannels,actionScenario:GR.vB.leftRail,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.channelPreviewAction]:{scenarioName:be.Cu.TrinityChannelsTabChannelPreview,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelPreview,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.channelListItem,moduleType:GR.nR.listItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.openContextMenuAction]:{scenarioName:be.Cu.TrinityChannelsTabOpenContextMenu,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelContextMenu,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.menuButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.showChannelAction]:{scenarioName:be.Cu.TrinityChannelsTabChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.shown,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.hideChannelAction]:{scenarioName:be.Cu.TrinityChannelsTabChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.hidden,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.allPillAction]:{scenarioName:be.Cu.TrinityChannelsTabAllPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectAllChannelFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.allChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.shownForYouPillAction]:{scenarioName:be.Cu.TrinityChannelsTabShownForYouPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectShownChannelFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.shownChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.hiddenPillAction]:{scenarioName:be.Cu.TrinityChannelsTabHiddenPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectHiddenChannelFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.hiddenChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.sharedFromOtherTeamsPillAction]:{scenarioName:be.Cu.TrinityChannelsTabSharedFromOtherTeamsPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectSharedFromOtherTeamsPillFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.sharedFromOtherTeamsButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.archivedPillAction]:{scenarioName:be.Cu.TrinityChannelsTabArchivedPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectArchivedPillFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.archivedChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.deletedPillAction]:{scenarioName:be.Cu.TrinityChannelsTabDeletedPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectDeletedPillFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.deletedChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.sortByAction]:{scenarioName:be.Cu.TrinityChannelsTabSortBy,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectSort,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.sortSelection,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.searchAction]:{scenarioName:be.Cu.TrinityChannelsTabSearch,actionGesture:GR.Od.click,actionScenario:GR.vB.search,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.searchButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.searchResultsAction]:{scenarioName:be.Cu.TrinityChannelsTabSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.searchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.searchNoResultsAction]:{scenarioName:be.Cu.TrinityChannelsTabSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.noSearchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.addChannel]:{scenarioName:be.Cu.TrinityChannelsTabAddChannelButtonClick,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.addChannel,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.menuButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel}},kve=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelAction:a}=n,o="function"==typeof e?e():{},{actionScenario:r,actionScenarioType:s,moduleName:l,panelType:c,actionOutcome:d}=Fve(o.BIEventData||{}),u=i?.();a({...vhe(),actionGesture:GR.Od.click,actionOutcome:d,actionScenario:r,actionScenarioType:s,moduleType:GR.nR.button,moduleName:l,panelRegion:GR.rP.left,panelType:c,dataBag:u},t),u?.dispose()},Cve=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelAction:a}=n,o="function"==typeof e?e():{},{actionScenario:r,actionScenarioType:s,moduleName:l,panelType:c}=_ve(o.BIEventData?.type),d=i?.();a({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.deselect,actionScenario:r,actionScenarioType:s,moduleType:GR.nR.button,moduleName:l,panelRegion:GR.rP.left,panelType:c,dataBag:d},t),d?.dispose()},bve=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelAction:a}=n,o="function"==typeof e?e():{},{actionOutcome:r,actionScenario:s,actionScenarioType:l,moduleName:c,panelType:d}=Dve(o.BIEventData||{}),u=i?.();a({...vhe(),actionGesture:GR.Od.click,actionOutcome:r,actionScenario:s,actionScenarioType:l,moduleType:GR.nR.button,moduleName:c,panelRegion:GR.rP.left,panelType:d,dataBag:u},t),u?.dispose()},wve=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelAction:a}=n,o="function"==typeof e?e():{},{actionScenario:r,actionScenarioType:s,moduleName:l,panelType:c}=Eve(o.BIEventData?.type),d=i?.();a({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionScenario:r,actionScenarioType:s,moduleType:GR.nR.button,moduleName:l,panelRegion:GR.rP.left,panelType:c,dataBag:d},t),d?.dispose()},Tve=({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r=a?.();if(i.text||i.tags){if(i.text){const{actionScenario:e,actionScenarioType:n,moduleName:a,panelType:s}=Mve(i.BIEventData?.type);o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:e,actionScenarioType:n,moduleType:GR.nR.textbox,moduleName:a,panelRegion:GR.rP.left,panelType:s,dataBag:r},t)}}else{const{actionScenario:e,actionScenarioType:n,moduleName:a,panelType:s}=Rve(i.BIEventData?.type);o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.cancel,actionScenario:e,actionScenarioType:n,moduleType:GR.nR.button,moduleName:a,panelRegion:GR.rP.left,panelType:s,dataBag:r},t)}r?.dispose()},Ive=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelAction:a}=n,o="function"==typeof e?e():{},{actionScenario:r,actionScenarioType:s,moduleName:l,panelType:c}=Lve(o.BIEventData?.type),d=i?.();a({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:r,actionScenarioType:s,moduleType:GR.nR.textbox,moduleName:l,panelRegion:GR.rP.left,panelType:c,dataBag:d},t),d?.dispose()},Nve=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelAction:a}=n,o="function"==typeof e?e():{},{actionScenario:r,actionScenarioType:s,moduleName:l,panelType:c}=xve(o.BIEventData?.type),d=i?.();a({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.clear,actionScenario:r,actionScenarioType:s,moduleType:GR.nR.button,moduleName:l,panelRegion:GR.rP.left,panelType:c,dataBag:d},t),d?.dispose()},Ave=(e,t)=>{const n=e.cancelExistingAndCreateScenario(be.Cu.SimpleCollabLeftRailFilter,"abandon");n&&n.appendEventData({viewType:t})},Eve=e=>{switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:GR.vB.showChannelListFilter,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.channelListFilterButton};case"CHATS":return{actionScenario:GR.vB.showChatListFilter,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterButton};default:return{actionScenario:GR.vB.showCombinedListFilter,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterButton}}},Fve=e=>{const{type:t,currentTag:n,isSelected:i}=e,a=Pve.get(`${i?"deselect":"select"}-${n}`),o=i?GR.nd.deselect:GR.nd.select;switch(t){case"TEAMS_AND_CHANNELS":return{actionOutcome:o,actionScenario:a,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterTagButton};case"CHATS":return{actionOutcome:o,actionScenario:a,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterTagButton};default:return{actionOutcome:o,actionScenario:a,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterTagButton}}},_ve=e=>{switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:GR.vB.deselectTeamChannelListFilterOverflowButton,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterOverflowButton};case"CHATS":return{actionScenario:GR.vB.deselectChatListFilterOverflowButton,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterOverflowButton};default:return{actionScenario:GR.vB.deselectCombinedListFilterOverflowButton,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterOverflowButton}}},Dve=e=>{const{type:t,isSelected:n}=e,i=n?GR.nd.close:GR.nd.show;switch(t){case"TEAMS_AND_CHANNELS":return{actionOutcome:i,actionScenario:n?GR.vB.closeTeamChannelListFilterMore:GR.vB.showTeamChannelListFilterMore,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterMoreButton};case"CHATS":return{actionOutcome:i,actionScenario:n?GR.vB.closeChatListFilterMore:GR.vB.showChatListFilterMore,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterMoreButton};default:return{actionOutcome:i,actionScenario:n?GR.vB.closeCombinedListFilterMore:GR.vB.showCombinedListFilterMore,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterMoreButton}}},Pve=new Map([["select-UNREAD",GR.vB.selectLeftRailUnreadTag],["select-MENTIONS",GR.vB.selectLeftRailMentionTag],["select-MEETINGS",GR.vB.selectLeftRailMeetingsTag],["select-TEAMS_AND_CHANNELS",GR.vB.selectLeftRailChannelsTag],["select-MUTED",GR.vB.selectLeftRailMutedTag],["select-CHATS",GR.vB.selectLeftRailChatsTag],["deselect-UNREAD",GR.vB.deselectLeftRailUnreadTag],["deselect-MENTIONS",GR.vB.deselectLeftRailMentionTag],["deselect-MEETINGS",GR.vB.deselectLeftRailMeetingsTag],["deselect-TEAMS_AND_CHANNELS",GR.vB.deselectLeftRailChannelsTag],["deselect-MUTED",GR.vB.deselectLeftRailMutedTag],["deselect-CHATS",GR.vB.deselectLeftRailChatsTag]]),Mve=e=>{switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:GR.vB.typeChannelListFilter,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterTypeTextBox};case"CHATS":return{actionScenario:GR.vB.typeChatListFilter,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterTypeTextBox};default:return{actionScenario:GR.vB.typeCombinedListFilter,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterTypeTextBox}}},Rve=e=>{switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:GR.vB.cancelTeamChannelListFilter,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterCancelButton};case"CHATS":return{actionScenario:GR.vB.cancelChatListFilter,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterCancelButton};default:return{actionScenario:GR.vB.cancelCombinedListFilter,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterCancelButton}}},xve=e=>{switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:GR.vB.clearTeamChannelListFilter,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterTextClearButton};case"CHATS":return{actionScenario:GR.vB.clearChatListFilter,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterTextClearButton};default:return{actionScenario:GR.vB.clearCombinedListFilter,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterTextClearButton}}},Lve=e=>{switch(e){case"TEAMS_AND_CHANNELS":return{actionScenario:GR.vB.clickChannelListFilter,actionScenarioType:GR.DB.teamChannelListFilter,panelType:GR.HP.teamChannelList,moduleName:GR.Sn.teamChannelListFilterTextBox};case"CHATS":return{actionScenario:GR.vB.clickChatListFilter,actionScenarioType:GR.DB.chatListFilter,panelType:GR.HP.chatList,moduleName:GR.Sn.chatListFilterTextBox};default:return{actionScenario:GR.vB.clickCombinedListFilter,actionScenarioType:GR.DB.combinedListFilter,panelType:GR.HP.combinedList,moduleName:GR.Sn.combinedListFilterTextBox}}},Ove="headlineSlice",jve="viewHeadlineSlice",Bve=(e,t)=>({actor:Ove,action:jve,data:{id:e,focusOnLoad:t}}),Uve=({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i}=t,a=n.newLogger("SimpleCollabStaleChannelsAdhocEvents","simple-collab-event-action-handlers"),o="function"==typeof e?e():{};return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r="recentChannels"===i?.folderType?"recentChannels":"teamsAndChannels",s=a?.();s&&(s.sectionType=r),o({...vhe(),...Hhe,actionOutcome:GR.nd.openDialog,actionScenario:GR.vB.inactiveTeamsAndChannelsCleanUpProcess,actionScenarioType:GR.DB.inactiveTeamsAndChannelsContextMenuUserAction,moduleName:GR.Sn.inactiveTeamsAndChannelsContextMenuUserAction,dataBag:s},t),s?.dispose()})({data:e,logger:a,userBiService:i}),Promise.resolve({command:_d(o)})},$ve=({data:e,requestContext:t,logger:n})=>{const{coreSettings:i}=t,{enableSimpleCollabVerboseLogs:a}=i.get(c.w.SimpleCollab);if(a){const t="function"==typeof e?e():{},{logType:i,logMessage:a}=t;switch(i){case"errorToTelemetry":n.errorToTelemetry?.(a,"simple_collab_conversation_folder_sort",void 0,!0);break;case"infoToTelemetry":n.infoToTelemetry?.(a,"simple_collab_conversation_folder_sort",void 0,!0);break;case"warnToTelemetry":n.warnToTelemetry?.(a,"simple_collab_conversation_folder_sort",void 0,!0)}}},Wve={onEventReceived:async({eventInput:e,requestContext:t})=>{const{event:n}=e,{type:i,originator:a}=n,{coreSettings:o,i18n:r,loggerFactory:s,phaseStateMachine:l,scenarioFactory:c,userBiService:d}=t,u=t.client.relayEnvironment;if((async(e,t)=>{const{type:n}=e;switch(n){case i2.$G.startTimerSelectedUnreadMention:dve(e,t);break;case i2.$G.leftRailRenderDataLoaded:case i2.$G.manageChannelTags:case i2.$G.manageChannel:case i2.$G.joinTeam:case i2.$G.chatManageApps:case i2.$G.manageTags:case i2.$G.manageTeamChannels:case i2.$G.manageTeams:case i2.$G.newMessage:case i2.$G.stopTimerSelectedUnreadMention:case i2.$G.switchToActivitySlice:case i2.$G.switchToBizChatMetaOS:case i2.$G.viewDiscover:case i2.$G.viewMoreSettings:case i2.$G.viewTeamSeeAllChannels:uve(t)}})(n,d),a===Xhe)return eve(n,s,d);if(a===tve)return(async(e,t)=>{const{data:n,type:i}=e,a=t.newLogger("SimpleCollabUpdaterEvent","simple-collab-app-updater-event"),o="function"==typeof n?n():{};switch(a.infoToTelemetry?.(`${i}: commandSource: ${o.commandSource}`,"simple_collab_app_updater_event"),i){case Fce.z.SwitchOnSimpleCollab:return{command:yd()};case Fce.z.SwitchOffSimpleCollab:return{command:Vs()};case Fce.z.SwitchOnSplitView:return{command:Sd()};default:return void a.warn(`Received an unhandled simple collab updater event, type: ${e.type}`)}})(n,s);if(a===ave)return ove(n,s,d);const m=Yve(Ope.simpleCollabStore.get(Ope.selectedAppIdAtom));if(a===sve)return(async(e,t,n,i,a,o)=>{const{type:r,data:s}=e,l=t.newLogger("simpleCollabApp UserOnboardingToTeamEvents","apps-teams-and-channels");switch(r){case rve.w6.seeAllChannelsLoadMoreRenderStart:return void i.newScenario(be.Cu.UserOnboardingToTeamLoadNext);case rve.w6.seeAllChannelsLoadMoreRenderFail:{const e=be.Cu.UserOnboardingToTeamLoadNext,t=i.findScenario(e);return void(t&&t.fail())}case rve.w6.seeAllChannelsLoadMoreRenderComplete:{const e=be.Cu.UserOnboardingToTeamLoadNext;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.UserOnboardingToTeamLoadNextComplete),i.stopScenarioIfActive(e)))}case rve.w6.useronboardingFilterSortLoadStart:{const e="function"==typeof s?s():{};return void i.newScenario(be.Cu.UserOnboardingToTeamFilterSortLoad).appendEventData({dataSource:e.actionWorkload})}case rve.w6.useronboardingFilterSortLoadFail:{const e=be.Cu.UserOnboardingToTeamFilterSortLoad,t=i.findScenario(e);return void(t&&t.fail())}case rve.w6.useronboardingFilterSortLoadComplete:{const e=be.Cu.UserOnboardingToTeamFilterSortLoad;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.UserOnboardingToTeamFilterSortLoadComplete),i.stopScenarioIfActive(e)))}case rve.w6.switchToChannel:{const e="function"==typeof s?s():{};return e.isViewFromSimpleCollab=!1,Che(e.selectedId),Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),_he(e.sectionId),e.isHidden?ohe(a,e.id,o):rhe(a,o),Promise.resolve({command:wd(e)})}case rve.w6.userOnboardingRenderStart:return void i.newScenario(be.Cu.UserOnboardingToTeamRender);case rve.w6.userOnboardingRenderFail:{const e=be.Cu.UserOnboardingToTeamRender,t=i.findScenario(e);return void(t&&t.fail())}case rve.w6.userOnboardingRenderComplete:{const e=be.Cu.UserOnboardingToTeamRender;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.UserOnboardingToTeamRenderComplete),i.stopScenarioIfActive(e)))}case rve.w6.seeAllChannelsAction:case rve.w6.seeAllChannelsOnLoadAction:case rve.w6.channelPreviewAction:case rve.w6.channelBackAction:case rve.w6.openContextMenuAction:case rve.w6.goToTeamAction:case rve.w6.activityFeedOnLoadAction:case rve.w6.showChannelAction:case rve.w6.hideChannelAction:case rve.w6.allPillAction:case rve.w6.shownPillAction:case rve.w6.hiddenPillAction:case rve.w6.sortByAction:case rve.w6.searchAction:case rve.w6.searchResultsAction:case rve.w6.searchNoResultsAction:{const e="function"==typeof s?s():void 0;return lve({eventData:e,type:r,logger:l,userBiService:n,scenarioFactory:i})}default:return}})(n,s,d,c,u,m);if(a===yve)return(async(e,t,n,i,a,o)=>{const{type:r,data:s}=e,l=t.newLogger("simpleCollabApp TrinityChannelsTabEvents","simple-collab-trinity-channels-tab");switch(r){case vve.W3.trinitychannelstabFilterSortLoadStart:{const e="function"==typeof s?s():{};return void i.newScenario(be.Cu.TrinityChannelsTabFilterSortLoad).appendEventData({dataSource:e.actionWorkload})}case vve.W3.trinitychannelstabFilterSortLoadFail:{const e=be.Cu.TrinityChannelsTabFilterSortLoad,t=i.findScenario(e);return void(t&&t.fail())}case vve.W3.trinitychannelstabFilterSortLoadComplete:{const e=be.Cu.TrinityChannelsTabFilterSortLoad;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.TrinityChannelsTabFilterSortLoadComplete),i.stopScenarioIfActive(e)))}case vve.W3.switchToChannel:{const e="function"==typeof s?s():{},t=JSON.stringify({id:e.channelId,teamId:e.teamId});Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,t),_he(e.sectionId),e.isHidden?ohe(a,e.id,o):rhe(a,o);const n={id:t,type:xge(),action:ke.SY.list};return Promise.resolve({command:wd({...e,linkedEntity:n})})}case vve.W3.trinitychannelstabRenderStart:return void i.newScenario(be.Cu.TrinityChannelsTabRender);case vve.W3.trinitychannelstabRenderFail:{const e=be.Cu.TrinityChannelsTabRender,t=i.findScenario(e);return void(t&&t.fail())}case vve.W3.trinitychannelstabRenderComplete:{const e=be.Cu.TrinityChannelsTabRender;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.TrinityChannelsTabRenderComplete),i.stopScenarioIfActive(e)))}case vve.W3.seeAllChannelsAction:case vve.W3.seeAllChannelsOnLoadAction:case vve.W3.channelPreviewAction:case vve.W3.openContextMenuAction:case vve.W3.showChannelAction:case vve.W3.hideChannelAction:case vve.W3.allPillAction:case vve.W3.shownForYouPillAction:case vve.W3.hiddenPillAction:case vve.W3.sharedFromOtherTeamsPillAction:case vve.W3.archivedPillAction:case vve.W3.deletedPillAction:case vve.W3.sortByAction:case vve.W3.searchAction:case vve.W3.searchResultsAction:case vve.W3.searchNoResultsAction:{const e="function"==typeof s?s():void 0;return Sve({eventData:e,type:r,logger:l,userBiService:n,scenarioFactory:i})}case vve.W3.addChannel:{const e="function"==typeof s?s():{};return Sve({eventData:e,type:r,logger:l,userBiService:n,scenarioFactory:i}),Promise.resolve({command:Yd(e)})}default:return}})(e.event,s,d,c,u,m);const p=wye(i);return p===bye.ChatContextMenuEvent?whe(n,s,d):p===bye.ChannelContextMenuEvent?Dhe(n,s,d):p===bye.TeamContextMenuEvent?Ohe(n,s,d,r):p===bye.LeftRailHeaderContextMenuEvent?Vhe(n,s,d):p===bye.FolderActionCompletionEvent?Khe(n,t):p===bye.FolderMutationUpdaterEvent?((e,t,n)=>{const{data:i,type:a}=e,o=t.newLogger("FolderMutationUpdaterEvents","simple-collab-folder-mutation-updater"),r="function"==typeof i?i():{},{scenarioName:s,stepName:l,failureReason:c,conversationId:d}=r,u=!!d&&n.findScenarioByNameAndId(s,d)||n.findScenario(s);if(u)switch(a){case i2.sU.folderMutationUpdaterStarted:o.infoToTelemetry?.(l,s,void 0,!0),u?.mark(l);break;case i2.sU.folderMutationUpdaterCompleted:o.infoToTelemetry?.(l,s,void 0,!0),u?.mark(r.stepName),n.stopScenarioIfActive(s);break;case i2.sU.folderMutationUpdaterFailed:o.errorToTelemetry?.(c||"",s,void 0,!0),u?.mark(l);break;case i2.sU.folderMutationOptimisticUpdaterCompleted:o.log(`Optimistic update completed for ${r.scenarioName}`),u?.mark(r.stepName),n.stopScenarioIfActive(r.scenarioName)}else o.warnToTelemetry?.(`scenario not found for ${s}`,s,void 0,!0)})(n,s,c):p===bye.FolderSubscriptionUpdaterEvent?((e,t)=>{const{data:n}=e,i="function"==typeof n?n():{},{conversationNodeId:a,conversationId:o,stepName:r}=i;let s=be.Cu.SimpleCollabMoveItemToConversationFolder,l=t.findScenarioByNameAndId(be.Cu.SimpleCollabMoveItemToConversationFolder,a);if(l||(l=t.findScenarioByNameAndId(be.Cu.SimpleCollabReorderConversationFolderListItems,a),s=be.Cu.SimpleCollabReorderConversationFolderListItems),l||(l=t.findScenarioByNameAndId(be.Cu.SimpleCollabDnDItemToConversationFolder,a),s=be.Cu.SimpleCollabDnDItemToConversationFolder),l||(l=t.findScenarioByNameAndId(be.Cu.SimpleCollabCreateConversationFolder,o),s=be.Cu.SimpleCollabCreateConversationFolder),l||(l=t.findScenario(be.Cu.SimpleCollabCreateConversationFolder),s=be.Cu.SimpleCollabCreateConversationFolder),!l)return;let c="";switch(s){case be.Cu.SimpleCollabMoveItemToConversationFolder:switch(r){case i2.Bm.completedBySubscription:c=be.BQ.SimpleCollabMoveItemToConversationFolderCompletedBySubscription;break;case i2.Bm.failedBySubscription:c=be.BQ.SimpleCollabMoveItemToConversationFolderFailedBySubscription}break;case be.Cu.SimpleCollabDnDItemToConversationFolder:switch(r){case i2.Bm.completedBySubscription:c=be.BQ.SimpleCollabDnDItemToConversationFolderCompletedBySubscription;break;case i2.Bm.failedBySubscription:c=be.BQ.SimpleCollabDnDItemToConversationFolderFailedBySubscription}break;case be.Cu.SimpleCollabCreateConversationFolder:switch(r){case i2.Bm.completedBySubscription:c=be.BQ.SimpleCollabCreateConversationFolderCompletedBySubscription;break;case i2.Bm.failedBySubscription:c=be.BQ.SimpleCollabCreateConversationFolderFailedBySubscription}}const d=(c===be.BQ.SimpleCollabCreateConversationFolderCompletedBySubscription||c===be.BQ.SimpleCollabCreateConversationFolderFailedBySubscription)&&o||a;switch(c){case be.BQ.SimpleCollabMoveItemToConversationFolderCompletedBySubscription:case be.BQ.SimpleCollabDnDItemToConversationFolderCompletedBySubscription:case be.BQ.SimpleCollabCreateConversationFolderCompletedBySubscription:t.markStep(s,c,{eventData:{conversationId:d}}),t.stopScenarioIfActive(s);break;case be.BQ.SimpleCollabMoveItemToConversationFolderFailedBySubscription:case be.BQ.SimpleCollabDnDItemToConversationFolderFailedBySubscription:case be.BQ.SimpleCollabCreateConversationFolderFailedBySubscription:t.markStep(s,c,{eventData:{conversationId:d}}),t.stopScenarioIfActive(s,{errorCode:"failure"},"failure")}})(n,c):p===bye.CopilotEvent?(async(e,t)=>{const{i18n:n,loggerFactory:i,scenarioFactory:a,userBiService:o}=t,{data:r,type:s}=e,{recordPanelAction:l,createDatabag:c}=o,d=i.newLogger("SimpleCollabCopilotEvent","simple-collab-context-menu");switch(s){case i2.lP.hideBizChatMetaOS:{const e="function"==typeof r?r():{},t=be.Cu.HideBizChatMetaOSFromSimpleCollab,n=a.findScenario(t);d.infoToTelemetry?.(`Hide Copilot: convId: ${e.id}`,"simple_collab_hide_copilot_event");const i=c?.();return i&&(i.appId=e.id),l({actionScenarioType:GR.DB.botCopilotInteraction,actionScenario:GR.vB.bizChatCopilotMetaOSSimpleCollab,actionGesture:GR.Od.click,actionOutcome:GR.nd.hideMetaOSBizChatChatListEntry,moduleType:GR.nR.list,moduleName:GR.Sn.bizChatCopilotMetaOSSimpleCollab,dataBag:i},d),n&&a.startStep(t,be.BQ.HideMetaOSBizChat),void i?.dispose()}case i2.lP.hideBizChatMetaOSFailed:{const e=i.newLogger("handleHideBizChatMetaOSItemFailed","copilot-hide-action");return e.infoToTelemetry?.("Hide BizChat MetaOS failed.","simple_collab_hide_copilot_event",void 0,!0),a.stopScenarioIfActive(be.Cu.HideBizChatMetaOSFromSimpleCollab),Promise.resolve({command:c2({intent:"Error",title:n.stringTranslate("simpleCollab","simple_collab_toast_hide_copilot_failed"),dismissOnAction:!0})})}case i2.lP.hideBizChatMetaOSSucceeded:{const{i18n:e,loggerFactory:n,scenarioFactory:i}=t,a=n.newLogger("handleHideBizChatMetaOSItemSucceeded","copilot-hide-action"),o=be.Cu.HideBizChatMetaOSFromSimpleCollab,r=i.findScenario(o);return a.infoToTelemetry?.("Hide BizChat MetaOS succeeded.","simple_collab_hide_copilot_event",void 0,!0),i.stopScenarioIfActive(be.Cu.HideBizChatMetaOSFromSimpleCollab),r&&i.startStep(o,be.BQ.UpdateUserPreference),Promise.resolve({command:c2({intent:"Success",title:e.stringTranslate("simpleCollab","simple_collab_toast_hide_copilot_success"),dismissOnAction:!0})})}default:return}})(n,t):function(e,t,n,i,a,o,r,s){const{data:l,type:c}=e,d=i.newLogger("SimpleCollabEvents","simple-collab-event-action-handlers"),u=e=>e.type===R2.f7.addContact;switch(c){case R2.f7.addContact:if(u(e)){const t=e.data();return Promise.resolve({command:Im(t)})}case i2.$G.switchToChat:return zve(l,d,a,o,s,r);case i2.$G.newMessage:return qve(l,d,a);case i2.$G.switchToSuggestedChat:{const e="function"==typeof l?l():{};return nye(l,d,a),Promise.resolve({command:Cd(e)})}case i2.$G.switchToChannel:{const e="function"==typeof l?l():{};iye(l,d,a);const t=Ope.simpleCollabStore.get(Ope.selectedConversationIdAtom);return Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),Che(e.selectedId),Ope.simpleCollabStore.set(Ope.selectedConversationDataAtom,{folderNodeId:e.folderNodeId,conversationNodeId:e.id,currentTeamId:e.currentTeamId}),_he(e.sectionId),Hve(o,e),Gve(o,e.channelId||"",t,Ope.simpleCollabStore.get(Ope.selectedConversationFolderSeeReadAtom),d,s,r),Promise.resolve({command:wd(e)})}case i2.$G.stickyFilterUpdated:return void function(e){const t="function"==typeof e?e():{};switch(t.viewType){case"NONE":Ope.simpleCollabStore.set(Ope.selectedStickyFiltersInUnifiedViewAtom,{tags:t.tags,text:t.text});break;case"CHATS":Ope.simpleCollabStore.set(Ope.selectedStickyFiltersInChatsViewAtom,{tags:t.tags,text:t.text});break;case"TEAMS_AND_CHANNELS":Ope.simpleCollabStore.set(Ope.selectedStickyFiltersInChannelsViewAtom,{tags:t.tags,text:t.text})}}(l);case i2.$G.filterLeftRailComplete:return cye(t);case i2.$G.filterLeftRailFail:return dye(t);case i2.$G.switchToActivitySlice:return gye(l,d,a);case i2.$G.viewDiscover:return vye({data:l,logger:d,userBiService:a});case i2.$G.viewSavedMessageSlice:return yye();case i2.$G.leftRailRenderStart:return void Sye(t);case i2.$G.leftRailRenderDataLoaded:return void fye(t,l);case i2.$G.leftRailRenderComplete:return kye(t,l,r),void n?.fireSignals({signals:[Gz.m.SIMPLE_COLLAB_ADAPTIVE_LEFT_RAIL_LOADED]});case i2.$G.leftRailRenderFail:return sye(t,l),void uye(t,"left rail render failure");case i2.$G.leftRailRenderAbandonIfActive:return void lye(t);case i2.$G.simpleCollabNavigation:return void Zve({data:l,logger:d,userBiService:a});case i2.$G.simpleCollabConversationFolderNavigation:return void Kve({data:l,userBiService:a});case i2.$G.seeMoreRenderStart:{const{isSeeRead:e}="function"==typeof l?l():{},n=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);return t.newScenario(be.Cu.SimpleCollabLeftRailSeeMore).appendEventData({isSeeRead:e,viewType:n}),void Xve(d,a)}case i2.$G.seeMoreRenderComplete:return mye(t);case i2.$G.seeMoreRenderFail:return pye(t);case i2.$G.viewTeamSeeAllChannels:return Vve(l);case i2.$G.switchToBizChatMetaOS:return aye(l,t,d,a,r);case i2.$G.stopBizChatMetaOSE2EScenarioIfActive:return rye(t,d,r);case i2.$G.reorderTeamsStart:return void t.newScenario(be.Cu.SimpleCollabReorderTeams);case i2.$G.reorderTeamsSucceeded:return((e,t)=>{const n="function"==typeof e?e():{},{teamId:i}=n,{loggerFactory:a,scenarioFactory:o}=t,r=be.Cu.SimpleCollabReorderTeams;o.findScenario(r)&&(o.markStep(r,be.BQ.SimpleCollabReorderTeamsSucceeded),o.stopScenarioIfActive(r));const s=a.newLogger("SimpleCollabTeamActionCompletionEvents","simple-collab-team-action-completion");s.infoToTelemetry?.(`Reordering the team succeeded. Id:${i}`,"simple_collab_reorder_team",void 0,!0)})(l,s);case i2.$G.reorderTeamsFailed:return((e,t)=>{const n="function"==typeof e?e():{},{teamName:i,teamId:a}=n,{loggerFactory:o,scenarioFactory:r,i18n:s}=t,l=be.Cu.SimpleCollabReorderTeams,c=r.findScenario(l);c&&c.fail();const d=o.newLogger("SimpleCollabTeamActionCompletionEvents","simple-collab-team-action-completion");return d.errorToTelemetry?.(`Reordering the team failed. Id:${a}`,"simple_collab_reorder_team",void 0,!0),Promise.resolve({command:c2({intent:"Error",title:s.stringTranslate("teamsAndChannels","simpleCollab_list_teams_reorder_error_message",{teamName:i}),dismissOnAction:!0})})})(l,s);case i2.$G.staleChannelsAdhocDialog:return Uve({data:l,requestContext:s});case i2.$G.setFolderViewType:return(({data:e,requestContext:t})=>{const{loggerFactory:n,userBiService:i}=t,{createDatabag:a,recordPanelAction:o}=i,r=n.newLogger("SimpleCollabSetFolderViewTypeEvent","simple-collab-event-action-handlers"),s="function"==typeof e?e():{},{viewType:l}=s,c=Yhe(l),d=a?.();d&&(d.viewType=c),o({...vhe(),actionGesture:GR.Od.click,actionOutcome:"CHANNELS_ONLY"===l?GR.nd.setRecentChannelsView:GR.nd.setTeamsAndChannelsView,actionScenario:"CHANNELS_ONLY"===l?GR.vB.setRecentChannelsViewType:GR.vB.setTeamsAndChannelsView,actionScenarioType:GR.DB.setChannelsViewType,moduleName:GR.Sn.listOptions,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:d},r),d?.dispose()})({data:l,requestContext:s});case i2.$G.setFolderViewTypeSwitch:return void Qve(t,l);case i2.$G.teamsAndChannelFolderRenderCompleted:return Jve(t);case i2.$G.setFolderViewTypeFailed:return(({data:e,requestContext:t})=>{const n="function"==typeof e?e():{},{loggerFactory:i,i18n:a}=t,o=i.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion");return o.errorToTelemetry?.(`Set folder view type failed. errorCode: ${n.errorCode}, errorDetail: ${n.errorDetail}`,"simple_collab_set_folder_view_type",void 0,!0),Promise.resolve({command:c2({intent:"Error",title:a.stringTranslate("simpleCollab","simple_collab_toast_set_folder_view_type_failed"),dismissOnAction:!0})})})({data:l,requestContext:s});case i2.$G.setTeamExpandedStateAction:return(({data:e,requestContext:t})=>{const n="function"==typeof e?e():{},{loggerFactory:i,userBiService:a}=t,{createDatabag:o,recordPanelAction:r}=a,s=i.newLogger("SimpleCollabTeamActionCompletionEvents","simple-collab-team-action-completion"),l=o?.();r({...vhe(),actionGesture:GR.Od.click,actionOutcome:n.isExpanded?GR.nd.expanded:GR.nd.collapsed,actionScenario:GR.vB.setTeamExpandedState,actionScenarioType:GR.DB.setTeamExpandedState,moduleName:GR.Sn.teamTreeItem,moduleType:GR.nR.chevron,panelRegion:GR.rP.main,panelType:GR.HP.SimpleCollabAppList,dataBag:l},s),l?.dispose()})({data:l,requestContext:s});case i2.$G.setTeamExpandedStateSucceeded:return(({requestContext:e})=>{const{loggerFactory:t}=e,n=t.newLogger("SimpleCollabTeamActionCompletionEvents","simple-collab-team-action-completion");n.infoToTelemetry?.("Set conversation team expanded state succeeded.","simple_collab_set_conversation_team_expanded_state",void 0,!0)})({requestContext:s});case i2.$G.setTeamExpandedStateFailed:return(({data:e,requestContext:t})=>{const n="function"==typeof e?e():{},{loggerFactory:i}=t,a=i.newLogger("SimpleCollabTeamActionCompletionEvents","simple-collab-team-action-completion");return a.errorToTelemetry?.(`Set conversation team expanded state failed. errorDetail: ${n.errorDetail}`,"simple_collab_set_conversation_team_expanded_state",void 0,!0),Promise.resolve({command:c2({intent:"Error",title:n.errorLabel||"",dismissOnAction:!0})})})({data:l,requestContext:s});case i2.$G.logConnectionSortMessages:return $ve({data:l,requestContext:s,logger:d});case i2.$G.suggestedChatsRenderCompleted:return void Cye({data:l,logger:d,userBiService:a});default:return void((e,t,n,i)=>{const{data:a,type:o}=e;switch(o){case i2.$G.openFilterLeftRail:return void wve({data:a,logger:t,userBiService:i});case i2.$G.filterLeftRail:{const e=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);return Ave(n,e),void Tve({data:a,logger:t,userBiService:i})}case i2.$G.leftRailFilterPillClick:return void kve({data:a,logger:t,userBiService:i});case i2.$G.leftRailFilterOverflowButtonClick:return void Cve({data:a,logger:t,userBiService:i});case i2.$G.leftRailFilterMoreFilterPillsClick:return void bve({data:a,logger:t,userBiService:i});case i2.$G.leftRailFilterTextClick:return void Ive({data:a,logger:t,userBiService:i});case i2.$G.leftRailFilterTextClearButtonClick:return void Nve({data:a,logger:t,userBiService:i});default:;}})(e,d,t,a)}}(n,c,l,s,d,u,o,t)}};const Vve=e=>{const t="function"==typeof e?e():{};var n;return n=t.teamId,Ope.simpleCollabStore.set(Ope.seeAllChannelsAtom,n||""),Ope.simpleCollabStore.set(Ope.selectionIdAtom,""),Promise.resolve({command:ou(t)})},Hve=(e,t)=>{const n=Yve(Ope.simpleCollabStore.get(Ope.selectedAppIdAtom));t.isHidden?(Ope.simpleCollabStore.set(Ope.selectedHiddenChannelIdAtom,t.channelId),ohe(e,t.id,n,t.selectedId)):Ope.simpleCollabStore.get(Ope.selectedHiddenChannelIdAtom)&&(Ope.simpleCollabStore.set(Ope.selectedHiddenChannelIdAtom,void 0),rhe(e,n))},zve=(e,t,n,i,a,o)=>{const r="function"==typeof e?e():{};eye(e,t,n);const s=Ope.simpleCollabStore.get(Ope.selectedConversationIdAtom);Che(r.selectedId);const l=r.internalId;if(Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:l})),_he(r.sectionId),Ope.simpleCollabStore.set(Ope.selectedConversationDataAtom,{folderNodeId:r.folderNodeId,conversationNodeId:r.id}),Ope.simpleCollabStore.get(Ope.selectedHiddenChannelIdAtom)){Ope.simpleCollabStore.set(Ope.selectedHiddenChannelIdAtom,void 0);rhe(i,Yve(Ope.simpleCollabStore.get(Ope.selectedAppIdAtom)))}return Gve(i,l,s,Ope.simpleCollabStore.get(Ope.selectedConversationFolderSeeReadAtom),t,a,o),Promise.resolve({command:kd({id:l,openInPopout:r.openInPopout,commandSource:r.commandSource,correlationId:r.correlationId})})},qve=(e,t,n)=>{const i="function"==typeof e?e():{};return tye(e,t,n),Promise.resolve({command:su({openInPopout:i.openInPopout,commandSource:i.commandSource})})},Gve=(e,t,i,a,o,r,s)=>{const{enableSimpleCollabLeftRailReadItemsRemovalInFilteredView:l}=s.get(c.w.SimpleCollab);if(i!==t){const s=Yve(Ope.simpleCollabStore.get(Ope.selectedAppIdAtom)),c=(e,t)=>{$ve({data:()=>({logMessage:e,logType:t}),requestContext:r,logger:o})};!function(e,t,i,a,o){const{commitLocalUpdate:r,ConnectionHandler:s}=n(892908);r(e,(e=>{const n=e.getRoot()?.getLinkedRecord("conversationFolders",{filter:a})?.getLinkedRecords("edges");n&&n.length>0&&n.forEach((e=>{const n=e.getLinkedRecord("node"),r=s.getConnection(n,ahe,{filter:a}),l=r?.getLinkedRecords("edges");l&&l.length>0&&l.forEach((e=>{if("TEAMS_AND_CHANNELS"===n.getValue("folderType")&&"TEAMS_AND_CHANNELS"===n.getValue("viewType")){const n=e.getLinkedRecord("node"),r=!!n&&s.getConnection(n,"SimpleCollabLeftRail_channels",{filter:a}),l=r?.getLinkedRecords("edges");l&&l.forEach((e=>{const n=e?.getLinkedRecord("node"),r=String(n?.getValue("internalId")||"");she(n,r,t,i,o,a)}))}else{const n=e.getLinkedRecord("node"),r=n.getValue("internalId");she(n,r,t,i,o,a)}}))}))}))}(e,t,i,s,!!l),function(e,t,i,a,o){const{commitLocalUpdate:r,ConnectionHandler:s}=n(892908);r(e,(e=>{const n=e.getRoot()?.getLinkedRecord("conversationFolders",{filter:i})?.getLinkedRecords("edges");n&&n.length>0&&n.forEach((e=>{const n=e.getLinkedRecord("node"),r=s.getConnection(n,ahe,{filter:i});if(r&&n){const e=r.getLinkedRecords("edges"),l=n.getValue("internalId"),c=!!a&&l===a,d=n.getValue("sortType");e&&e.length>0&&e.forEach((e=>{if("TEAMS_AND_CHANNELS"===n.getValue("folderType")&&"TEAMS_AND_CHANNELS"===n.getValue("viewType")){const n=e.getLinkedRecord("node"),a=!!n&&s.getConnection(n,"SimpleCollabLeftRail_channels",{filter:i}),o=a?.getLinkedRecords("edges");o&&o.forEach((e=>{const n=e?.getLinkedRecord("node");if(String(n?.getValue("internalId")||"")===t&&a){const e=[];i.tags?.includes("UNREAD")&&e.push({keyPath:"node.activityStatus.hasUnreadMessage_Snapshot,node.activityStatus.hasUnreadMessage"}),i.tags?.includes("MENTIONS")&&e.push({keyPath:"node.activityStatus.hasPersonalMention_Snapshot,node.activityStatus.hasPersonalMention||node.activityStatus.hasChannelMention_Snapshot,node.activityStatus.hasChannelMention||node.activityStatus.hasTeamMention_Snapshot,node.activityStatus.hasTeamMention"}),(0,ihe.LC)(a,e)}}))}const a=e.getLinkedRecord("node");if(a&&a.getValue("internalId")===t){const e=[];if((i.tags?.includes("UNREAD")||"UnreadOnly"===d&&!c)&&e.push({keyPath:"node.activityStatus.hasUnreadMessage_Snapshot,node.activityStatus.hasUnreadMessage"}),i.tags?.includes("MENTIONS")&&e.push({keyPath:"node.activityStatus.hasPersonalMention_Snapshot,node.activityStatus.hasPersonalMention||node.activityStatus.hasEveryoneMention_Snapshot,node.activityStatus.hasEveryoneMention||node.activityStatus.hasChannelMention_Snapshot,node.activityStatus.hasChannelMention||node.activityStatus.hasTeamMention_Snapshot,node.activityStatus.hasTeamMention"}),i.tags?.includes("MUTED")&&e.push({keyPath:"node.isMuted_Snapshot,node.isMuted"}),i.tags?.includes("CHATS")&&e.push({keyPath:"node.isChat_Snapshot"}),i.tags?.includes("TEAMS_AND_CHANNELS")&&e.push({keyPath:"node.isChannel_Snapshot"}),i.tags?.includes("MEETINGS")&&e.push({keyPath:"node.isMeeting_Snapshot"}),(0,ihe.LC)(r,e,["unread-only-sentinel-value"]),"UnreadOnly"===d||"UnreadThenMostRecent"===d){const e=(e,t)=>{const n=`commitSortingAndFilteringUpdate: folderId: ${l}, sortType: ${d}, ${e}`;o?.(n,t)};(0,Uge.n3)(r,e,"node.internalId")}}}))}}))}))}(e,i,s,a,c)}},Yve=e=>e===ke.ck.simplecollabchats?(0,hhe.cl)("CHATS",Ope.simpleCollabStore.get(Ope.selectedStickyFiltersInChatsViewReadOnlyAtom)):e===ke.ck.simplecollabchannels?(0,hhe.cl)("TEAMS_AND_CHANNELS",Ope.simpleCollabStore.get(Ope.selectedStickyFiltersInChannelsViewReadOnlyAtom)):(0,hhe.cl)("NONE",Ope.simpleCollabStore.get(Ope.selectedStickyFiltersInUnifiedViewReadOnlyAtom)),Qve=(e,t)=>{const n=e.newScenario(be.Cu.SimpleCollabSetFolderViewTypeSwitch),i="function"==typeof t?t():{},{viewType:a}=i;n.appendEventData({viewType:a})},Jve=e=>{const t=be.Cu.SimpleCollabSetFolderViewTypeSwitch;e.findScenario(t)&&e.stopScenarioIfActive(t)},Kve=({data:e,userBiService:t})=>{const{createDatabag:n,appendBiData:i}=t,a="function"==typeof e?e():{},o=n?.();o&&(0!==a.totalTeams&&(o.totalTeams=a.totalTeams),0!==a.totalFavoriteItems&&(o.totalFavoriteItems=a.totalFavoriteItems),i(GR.E0.simpleCollab,{dataBag:o})),o?.dispose()},Zve=({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},a=!!Ope.simpleCollabStore.get(Ope.showMessagePreviewsAtom),o=!!Ope.simpleCollabStore.get(Ope.showTimestampsAtom),{createDatabag:r,recordPanelAction:s,appendBiData:l}=n,c=r?.();c&&(c.atMentionCount=i.atMentionCount,c.totalSections=i.totalSections,c.isFlatListEnabled=i.isFlatListEnabled,c.isMessagePreviewEnabled=a,c.isTimestampsEnabled=o,c.totalShownGeneralChannels=i.totalShownGeneralChannels,c.totalFavoriteChats=i.totalFavoriteChats,c.totalFavoriteChannels=i.totalFavoriteChannels,c.totalCustomSections=i.totalCustomSections,c.totalCustomSectionShowingChannels=i.totalCustomSectionShowingChannels,c.totalCustomSectionShowingChats=i.totalCustomSectionShowingChats,c.totalChats=i.totalChats,c.totalShownChannels=i.totalShownChannels),l(GR.E0.simpleCollab,{dataBag:c}),s({...vhe(),actionGesture:GR.Od.auto,actionOutcome:GR.nd.nav,actionWorkload:GR.E0.simpleCollab,actionScenario:GR.vB.openAdaptiveRail,actionScenarioType:GR.DB.nav,moduleType:GR.nR.nav,moduleName:GR.Sn.openAdaptiveRailNav,panelRegion:GR.rP.left,panelType:GR.HP.teamChannelList,dataBag:c},t,[GR.E0.simpleCollab]),c?.dispose()},Xve=(e,t)=>{const{recordPanelAction:n,createDatabag:i}=t,a=i?.();n({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionScenario:GR.vB.showMoreChatsInChatList,actionScenarioType:GR.DB.chatList,entityType:ke.ck.chats,moduleType:GR.nR.button,moduleName:GR.Sn.showMoreChatsButton,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,dataBag:a},e),a?.dispose()},eye=(e,t,n)=>{const{recordPanelAction:i,createDatabag:a}=n,o=a?.(),r="function"==typeof e?e():{};o&&(o.sectionId=r.sectionId,o.itemTotalUnreadCharmsCount=r.itemTotalUnreadCharmsCount,o.itemMentionCount=r.itemMentionCount,o.sectionType=r.sectionType,o.itemMuted=r.itemMuted,o.newChatEntryPoint=She(r.commandSource)),i({...vhe(),moduleName:GR.Sn.chatList,actionGesture:GR.Od.click,actionOutcome:GR.nd.openConversation,actionScenario:GR.vB.openConversationFromChatList,actionScenarioType:GR.DB.openConversation,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,threadType:r?.threadType?yhe(r.threadType):void 0,threadId:r?.internalId,dataBag:o},t),o?.dispose()},tye=(e,t,n)=>{const{recordPanelAction:i,createDatabag:a}=n,o="function"==typeof e?e():{},r=a?.();r&&(r.newChatEntryPoint=She(o.commandSource));const s=o.commandSource===A.p.SimpleCollabHeaderListItem?GR.vB.clickHeaderMenuNewMessageItem:GR.vB.clickHeaderNewMessage,l=o.commandSource===A.p.SimpleCollabHeaderListItem?GR.Sn.headerAddMenu:GR.Sn.chatListHeaderNewMessageButton;i({...vhe(),moduleName:l,moduleType:GR.nR.button,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:s,actionScenarioType:GR.DB.headerNavSimpleCollab,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,dataBag:r},t),r?.dispose()},nye=(e,t,n)=>{const{recordPanelAction:i,createDatabag:a}=n,o=a?.(),r="function"==typeof e?e():{};o&&(o.suggestedChatType=r.suggestedChatType),i({...vhe(),moduleName:GR.Sn.chatList,actionGesture:GR.Od.click,actionOutcome:GR.nd.openConversation,actionScenario:GR.vB.openSuggestedConversationFromChatList,actionScenarioType:GR.DB.openConversation,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,dataBag:o},t),o?.dispose()},iye=(e,t,n)=>{const{recordPanelAction:i,createDatabag:a}=n,o=a?.(),r="function"==typeof e?e():{};o&&(o.sectionId=r.sectionId,o.itemTotalUnreadCharmsCount=r.itemTotalUnreadCharmsCount,o.itemMentionCount=r.itemMentionCount,o.sectionType=r.sectionType,o.isGeneralChannel=r.isGeneralChannel,o.channelResourceTenantId=r.channelResourceTenantId,o.channelResourceTeamId=r.channelResourceTeamId,o.channelTeamRole=r.channelTeamRole,o.channelRole=r.channelRole,o.channelType=r.channelType,o.hasUnreadMessages=r.hasUnreadMessages),i({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.select,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelNav,actionScenarioType:GR.DB.admin,actionSubworkload:GR.i7.channelListNavigation,actionWorkload:GR.E0.teamChannelManagement,eventIdentifier:GR.AJ.channelButton_nav_click_channelNav,moduleName:GR.Sn.channelButton,moduleNameNew:GR.Sn.channelListItem,moduleType:GR.nR.nav,moduleTypeNew:GR.nR.channelList,officeGroupId:r?.teamOfficeGroupId??void 0,threadId:r?.channelId,teamId:r?.teamId,threadType:GR.bF.Channel,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,dataBag:o},t),o?.dispose()},aye=(e,t,n,i,a)=>{const o="function"==typeof e?e():{},{bizChatMetaOSAppId:r}=a.get(c.w.ChatList),s=r??"";return Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:s})),Ope.simpleCollabStore.set(Ope.selectedConversationFolderSeeReadAtom,""),Che(o.selectedId),oye(t,n,i,o,s),Promise.resolve({command:bd({id:s,openInPopout:o.openInPopout,focusOnLoad:o.focusOnLoad})})},oye=(e,t,n,i,a)=>{(0,Cee.RL)(e,a,"SimpleCollabMetaOSEntryPoint",t,i.openInPopout);const{createDatabag:o,recordPanelAction:r}=n,s=o?.();s&&(s.appId=a,s.isPopOutBizChat=i.openInPopout),r({actionScenarioType:GR.DB.botCopilotInteraction,actionScenario:GR.vB.bizChatCopilotMetaOSSimpleCollab,actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,moduleType:GR.nR.list,moduleName:GR.Sn.bizChatCopilotMetaOSSimpleCollab,dataBag:s},t),s?.dispose()},rye=(e,t,n)=>{const i=e.findScenario(be.Cu.PlatformTabLaunch),{bizChatMetaOSAppId:a}=n.get(c.w.ChatList),o=a??"";i&&i.eventData?.["App.Id"]===o&&"SimpleCollabMetaOSEntryPoint"===i.eventData?.["App.EntryPoint"]&&(t.log("Abandon BizChat MetaOS scenario due to app/chat switch or reopen."),i.stop({reason:"Abandon BizChat MetaOS scenario due to app/chat switch or reopen."},"abandoned"))},sye=(e,t)=>{const n=be.Cu.SimpleCollabRenderLeftRail,i=e.findScenario(n);if(i){const e="function"==typeof t?t():{};i.fail({errorMessage:e?.errorMessage})}},lye=e=>{const t=be.Cu.SimpleCollabRenderLeftRail,n=e.findScenario(t);n&&n.cancel()},cye=e=>{const t=be.Cu.SimpleCollabLeftRailFilter;e.findScenario(t)&&(e.startStep(t,be.BQ.SimpleCollabLeftRailFilterComplete),e.stopScenarioIfActive(t))},dye=e=>{const t=be.Cu.SimpleCollabLeftRailFilter,n=e.findScenario(t);n&&n.fail()},uye=(e,t)=>{e.stopScenarioIfActive(be.Cu.SimpleCollabLeftRailFilter,{reason:`Abandon SimpleCollabLeftRailFilter scenario due to ${t}.`},"abandoned")},mye=e=>{const t=be.Cu.SimpleCollabLeftRailSeeMore;e.findScenario(t)&&(e.startStep(t,be.BQ.SimpleCollabSeeMoreRenderComplete),e.stopScenarioIfActive(t))},pye=e=>{const t=be.Cu.SimpleCollabLeftRailSeeMore,n=e.findScenario(t);n&&n.fail()},gye=(e,t,n)=>{const{internalId:i,focusOnLoad:a,selectedId:o}="function"==typeof e?e():{internalId:"unknown",focusOnLoad:!1,selectedId:void 0};return Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:i})),Che(o),hye(t,n,i),{command:Bve(i,!!a)}},hye=(e,t,n)=>{const{createDatabag:i,recordPanelAction:a}=t,o=i?.();o&&(o.sliceId=(0,Rge.IT)(n),o.headlineSliceId=n,o.sectionType="slices",o.sectionId="slices",a({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.feedSlicesClick,actionScenarioType:GR.DB.sliceClick,moduleName:GR.Sn.sliceList,moduleType:GR.nR.slice,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,dataBag:o},e),o?.dispose())},vye=({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{};Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:Bpe.A})),Ope.simpleCollabStore.set(Ope.selectedConversationFolderSeeReadAtom,""),Che(i.selectedId);const{createDatabag:a,recordPanelAction:o}=n,r=a?.();return o({...vhe(),actionGesture:GR.Od.click,actionOutcome:GR.nd.select,actionScenario:GR.vB.discoverSurfaceNav,actionScenarioType:GR.DB.headerNavSimpleCollab,moduleType:GR.nR.menuItem,moduleName:GR.Sn.menuButton,panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabAppList,dataBag:r},t),r?.dispose(),Promise.resolve({command:tu({id:Bpe.A})})},yye=()=>(Ope.simpleCollabStore.set(Ope.selectedConversationIdAtom,JSON.stringify({id:Bpe.g})),Promise.resolve({command:kd({id:Bpe.g})})),Sye=e=>{const t=e.newScenario(be.Cu.SimpleCollabRenderLeftRail),n=e.findScenario(be.Cu.ApplicationLaunchTime),i=Ope.simpleCollabStore.get(Ope.selectedAppIdAtom);t.appendEventData({isFirstLoad:!!n,viewType:i})},fye=(e,t)=>{const n=be.Cu.SimpleCollabRenderLeftRail,i=e.findScenario(n);if(i){const a="function"==typeof t?t():{};i.appendEventData({isPageVisible:a.isPageVisible}),e.startStep(n,be.BQ.SimpleCollabLeftRailRenderDataLoaded)}};const kye=(e,t,n)=>{const i=be.Cu.SimpleCollabRenderLeftRail;e.findScenario(i)&&(e.startStep(i,be.BQ.SimpleCollabLeftRailRenderComplete),e.stopScenarioIfActive(i));const a=e.findScenario(be.Cu.SimpleCollabSwitch);if(a){const e="function"==typeof t?t():{},{enableSimpleCollabShowHiddenTeams:i}=n.get(c.w.SimpleCollab),{totalShownChannels:o,totalShownChannelsUnderShownTeams:r,totalShownChannelsUnderHiddenTeams:s,totalShownTeams:l,totalHiddenTeams:d,totalTeams:u,isTeamsAndChannelsFolderHierarchicalViewEnabled:m}=e;a.appendEventData({isTeamsAndChannelsFolderHierarchicalViewEnabled:m,isSimpleCollabShowHiddenTeamsEnabled:i??void 0,totalShownChannels:o,totalShownChannelsUnderShownTeams:r,totalShownChannelsUnderHiddenTeams:s,totalShownTeams:l,totalHiddenTeams:d,totalTeams:u})}},Cye=({data:e,logger:t,userBiService:n})=>{const{createDatabag:i,recordPanelView:a}=n,o="function"==typeof e?e():{},r=i?.();r&&(r.numOfSuggestedChats=o.numOfSuggestedChats,r.numOfExternalSubstrateSuggestions=o.numOfExternalSubstrateSuggestions,r.numOfInternalSubstrateSuggestions=o.numOfInternalSubstrateSuggestions,r.numOfTenantDirectorySuggestions=o.numOfTenantDirectorySuggestions,r.numOfFederatedSuggestedContacts=o.numOfFederatedSuggestedContacts,r.numOfSkypeSuggestedContacts=o.numOfSkypeSuggestedContacts,r.numOfTflOffNetworkSuggestedContacts=o.numOfTflOffNetworkSuggestedContacts,r.numOfTflConsumerSuggestedContacts=o.numOfTflConsumerSuggestedContacts,r.isSuggestingOrgGroupChat=o.isSuggestingOrgGroupChat,r.isSuggestingProjectGroupChat=o.isSuggestingProjectGroupChat,a({...vhe(),panelRegion:GR.rP.left,panelType:GR.HP.SimpleCollabSuggestedChats,dataBag:r},t)),r?.dispose()};var bye;!function(e){e[e.ChatContextMenuEvent=0]="ChatContextMenuEvent",e[e.ChannelContextMenuEvent=1]="ChannelContextMenuEvent",e[e.TeamContextMenuEvent=2]="TeamContextMenuEvent",e[e.Default=3]="Default",e[e.FolderActionCompletionEvent=4]="FolderActionCompletionEvent",e[e.FolderMutationUpdaterEvent=5]="FolderMutationUpdaterEvent",e[e.FolderSubscriptionUpdaterEvent=6]="FolderSubscriptionUpdaterEvent",e[e.LeftRailHeaderContextMenuEvent=7]="LeftRailHeaderContextMenuEvent",e[e.LettRailHeaderButtonsEvent=8]="LettRailHeaderButtonsEvent",e[e.CopilotEvent=9]="CopilotEvent"}(bye||(bye={}));const wye=e=>{switch(e){case i2.$G.chatManageApps:case i2.$G.leaveChat:case i2.$G.blockChat:case i2.$G.deleteChat:case i2.$G.chatWorkflows:case i2.$G.muteChat:case i2.$G.unmuteChat:case i2.$G.markAsReadChat:case i2.$G.markAsUnreadChat:case i2.$G.openInNewWindowChat:case i2.$G.followPresence:case i2.$G.chatContextMenuClick:return bye.ChatContextMenuEvent;case i2.$G.channelNotificationSettings:case i2.$G.channelWorkflows:case i2.$G.editChannel:case i2.$G.toastMessageChannelEvent:case i2.$G.archiveChannel:case i2.$G.deleteChannel:case i2.$G.getLinkToChannel:case i2.$G.manageChannel:case i2.$G.manageChannelTags:case i2.$G.viewChannelEmail:case i2.$G.channelAddMembers:case i2.$G.leaveChannel:case i2.$G.shareChannelWithUser:case i2.$G.shareChannelWithTeam:case i2.$G.shareChannelWithTeamYouOwn:case i2.$G.showHideChannel:case i2.$G.manageTeamChannels:case i2.$G.channelContextMenuClick:case i2.$G.setChannelRecommendation:return bye.ChannelContextMenuEvent;case i2.$G.manageTeam:case i2.$G.manageTags:case i2.$G.getLinkToTeam:case i2.$G.leaveTeam:case i2.$G.hideAllChannelsDialog:case i2.$G.hideAllChannelsSucceeded:case i2.$G.hideAllChannelsFailed:case i2.$G.hideAllChannelsDialogCancelAction:case i2.$G.hideAllChannelsDialogConfirmAction:case i2.$G.teamAddMember:case i2.$G.teamAddChannel:case i2.$G.deleteTeam:case i2.$G.forceHideTeam:case i2.$G.teamContextMenuClick:return bye.TeamContextMenuEvent;case i2.$G.joinTeam:case i2.$G.createChannel:case i2.$G.createTeam:case i2.$G.manageTeams:case i2.$G.viewMoreSettings:case i2.$G.leftRailHeaderPlusMenuOpen:case i2.$G.openManageTeams:case i2.$G.createTeamOnMainView:case i2.$G.clickLeftRailHeaderShowAtTopFilterMenu:return bye.LeftRailHeaderContextMenuEvent;case i2.$G.openFilterLeftRail:return bye.LettRailHeaderButtonsEvent;case i2.sU.createConversationFolder:case i2.T8.createConversationFolderCancelAction:case i2.T8.createConversationFolderConfirmAction:case i2.T8.createConversationFolderSucceeded:case i2.T8.createConversationFolderFailed:case i2.sU.renameConversationFolder:case i2.T8.renameConversationFolderCancelAction:case i2.T8.renameConversationFolderConfirmAction:case i2.T8.renameConversationFolderSucceeded:case i2.T8.renameConversationFolderFailed:case i2.sU.removeConversationFolder:case i2.T8.removeConversationFolderCancelAction:case i2.T8.removeConversationFolderConfirmAction:case i2.T8.removeConversationFolderSucceeded:case i2.T8.removeConversationFolderFailed:case i2.T8.removeFromFolderAction:case i2.T8.removeFromFolderSucceeded:case i2.T8.removeFromFolderFailed:case i2.T8.moveToSubMenuClick:case i2.T8.moveConversationToFolderAction:case i2.T8.moveConversationToFolderSucceeded:case i2.T8.moveConversationToFolderFailed:case i2.T8.setConversationFolderSeeReadsExpandedStateAction:case i2.T8.setConversationFolderExpandedStateAction:case i2.T8.setConversationFolderExpandedStateSucceeded:case i2.T8.setConversationFolderExpandedStateFailed:case i2.T8.setConversationFoldersExpandedStateAction:case i2.T8.setConversationFoldersExpandedStateSucceeded:case i2.T8.setConversationFoldersExpandedStateFailed:case i2.T8.reorderConversationFoldersAction:case i2.T8.reorderConversationFoldersSucceeded:case i2.T8.reorderConversationFoldersFailed:case i2.T8.reorderConversationFolderItemsAction:case i2.T8.reorderConversationFolderItemsSucceeded:case i2.T8.reorderConversationFolderItemsFailed:case i2.T8.dndItemToConversationFolderAction:case i2.T8.dndItemToConversationFolderSucceeded:case i2.T8.dndItemToConversationFolderFailed:case i2.T8.markAllAsReadByAppAction:case i2.T8.markAllAsReadByAppSucceeded:case i2.T8.markAllAsReadByAppFailed:case i2.T8.markAllAsReadByAppLog:case i2.T8.sortConversationFolderAction:case i2.T8.sortConversationFolderSucceeded:case i2.T8.sortConversationFolderFailed:return bye.FolderActionCompletionEvent;case i2.sU.folderMutationUpdaterStarted:case i2.sU.folderMutationUpdaterCompleted:case i2.sU.folderMutationUpdaterFailed:case i2.sU.folderMutationOptimisticUpdaterCompleted:return bye.FolderMutationUpdaterEvent;case i2.sU.logTelemetryForSubscriptionEvent:return bye.FolderSubscriptionUpdaterEvent;case i2.lP.hideBizChatMetaOS:case i2.lP.hideBizChatMetaOSFailed:case i2.lP.hideBizChatMetaOSSucceeded:return bye.CopilotEvent;case i2.$G.reorderTeamsStart:case i2.$G.reorderTeamsSucceeded:case i2.$G.reorderTeamsFailed:case i2.$G.setFolderViewType:case i2.$G.staleChannelsAdhocDialog:case i2.$G.setFolderViewTypeFailed:case i2.$G.setTeamExpandedStateAction:case i2.$G.setTeamExpandedStateSucceeded:case i2.$G.setTeamExpandedStateFailed:default:return bye.Default}},Tye=({appRenderMode:e,type:t})=>{const n=new qz.D,i=[],a=[];switch(e){case se.w.HorizontalBar:Aye({type:t,criticalSignals:i,featureFlags:{},postCriticalSignals:a});break;case se.w.Main:Iye({type:t,criticalSignals:i,featureFlags:{},postCriticalSignals:a});break;case se.w.Rail:Nye({type:t,criticalSignals:i,featureFlags:{},postCriticalSignals:a})}return n.registerAppPhase({phase:m.Jj.CRITICAL,signals:i,timeout:25e3}),n.appPhases},Iye=({criticalSignals:e,type:t})=>{t===ke.ck.teamseeallchannels?e.push(Gz.m.USER_ONBOARDING_TO_TEAM_VIEW_RENDERED):(e.push(Gz.m.MESSAGES_RENDERED),e.push(Gz.m.COMPOSE_LOADED))},Nye=({criticalSignals:e})=>{e.push(Gz.m.SIMPLE_COLLAB_ADAPTIVE_LEFT_RAIL_LOADED)},Aye=({criticalSignals:e,type:t})=>{t===ke.ck.teamseeallchannels&&e.push(Gz.m.USER_ONBOARDING_HEADER_RENDERED)},Eye=({coreServices:e,host:t,screenState:n,windowOptions:i})=>{const{height:a,minHeight:o,minWidth:r,offset:s,width:l}=Tge.windowFeatures||{},d=t?.screenX||0,u=t?.screenY||0,m=(n?.numOpenWindows||1)*(s||1);return{additionalFeatures:{minHeight:`${o}`,minWidth:`${r}`},height:a,left:d+m,minHeight:o,minWidth:r,top:u+m,width:l,...Tge.windowFeatures,...e?.coreSettings.get(c.w.Core).enableRatioToScreenBasedSizing&&Fye(t,Tge.windowFeatures),...i}};function Fye(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}function _ye(e=Ope){return{eventHandlers:Wve,getAppPhases:Tye,getAppViewEntities:Upe,getAppViewEntitiesProps:nge,getAppWindowFeatures:Eye,manifest:Tge,onBeforeUpdateHistoryItem:Ige,onBeforeNavigationFromHistory:Nge,onBeforeCommandHandled:_ge,onCommandReceived:Oge,onPreInit:the(e),onPreWarm:nhe(e),getPlatformAppIdForEntity(t){switch(e.simpleCollabStore.set(e.selectedAppIdAtom,t.type),t.type){case ke.ck.simplecollab:return"3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40";case ke.ck.simplecollabchannels:return"2a84919f-59d8-4441-a975-2a8c2643b741";case ke.ck.simplecollabchats:return"86fcd49b-61a2-4701-b771-54728cd291fb";default:return}},async render({appRenderMode:t,coreSettings:i,onRenderEvent:a,scenarioFactory:o}){const{enableEntityMoreInfo:r}=i.get(c.w.Core),{SimpleCollabEntry:s,LPC:l,LpcContextProvider:d}=await(async(e,t,i)=>{const a="simple-collab-app";function o(t){return(0,ev.wg)(t,a,e)}t("ChunkLoadStarted",{chunkName:a});const[{SimpleCollabEntry:r},{LPC:s},{LpcContextProvider:l}]=await Promise.all([o((()=>Promise.all([n.e(912845),n.e(620314),n.e(461500),n.e(668172),n.e(669152),n.e(459959),n.e(845039),n.e(492852),n.e(875051),n.e(257815),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(305404),n.e(512379),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(34804),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(460976),n.e(644420),n.e(158662),n.e(198787),n.e(623843)]).then(n.bind(n,618293)))),i?{LPC:Or.Fragment}:o((()=>Promise.all([n.e(912845),n.e(620314),n.e(461500),n.e(668172),n.e(669152),n.e(459959),n.e(845039),n.e(492852),n.e(875051),n.e(257815),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(305404),n.e(512379),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(34804),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(460976),n.e(644420),n.e(158662),n.e(198787),n.e(623843)]).then(n.bind(n,819867)))),i?{LpcContextProvider:Or.Fragment}:o((()=>Promise.all([n.e(912845),n.e(620314),n.e(461500),n.e(668172),n.e(669152),n.e(459959),n.e(845039),n.e(492852),n.e(875051),n.e(257815),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(712284),n.e(305404),n.e(512379),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(34804),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(460976),n.e(644420),n.e(158662),n.e(198787),n.e(623843)]).then(n.bind(n,194768))))]);return t("ChunkLoadSucceeded",{chunkName:a}),{SimpleCollabEntry:r,LPC:s,LpcContextProvider:l}})(o,a,!!r);return(0,Lr.Y)(vG.e,{namespaces:["simpleCollab"],loaderRenderer:null,children:(0,Lr.Y)(Dpe.Kq,{store:e.simpleCollabStore,children:(0,Lr.Y)(l,{children:(0,Lr.Y)(d,{children:(0,Lr.Y)(s,{appRenderMode:t,coreSettings:i,appState:e})})})})})},async onViewUpdateCommandResolved({availableEntities:t,requestContext:n}){const i=n.coreSettings,{enableSimpleCollabRailSelection:a}=i.get(c.w.SimpleCollab);if(a)return;const o=t.mainEntity;if(o?.action===ke.SY.view&&o.id)if(o.type===ke.ck.chats)e.simpleCollabStore.set(e.selectedConversationIdAtom,JSON.stringify({id:o.id}));else if(o.type===ke.ck.channels){let t;try{t=JSON.parse(o.id)}catch{t={}}"object"==typeof t&&t.channelId&&t.teamId&&e.simpleCollabStore.set(e.selectedConversationIdAtom,JSON.stringify({id:t.channelId,teamId:t.teamId}))}},getEventScenarioData(t,n,i,a){let o;const{data:r}=t.event,s="function"==typeof r?r():{},l=e.simpleCollabStore.get(e.selectedAppIdAtom);switch(Pye(e,a),t.event.type){case i2.$G.switchToChat:case i2.$G.switchToChannel:let e;e=s.internalId===g1.Uv?be.Cu.NewChat:s.openInPopout?(c=s.internalId,"OneGQL_MeetingChatConversation"===s.threadType?be.Cu.MeetingChatPopOut:(0,h1.qL)(c)?be.Cu.PhonelinkSmsChatPopOut:be.Cu.ChatPopOut):be.Cu.SimpleCollabSwitch,o={scenarioName:e,source:s.commandSource,eventData:l?{viewType:l,isTeamsAndChannelsFolderHierarchicalViewEnabled:s.isTeamsAndChannelsFolderHierarchicalViewEnabled}:{}};break;case i2.$G.viewTeamSeeAllChannels:o={scenarioName:be.Cu.SimpleCollabSeeAllChannelsSwitch,source:s.commandSource,eventData:l?{viewType:l}:{}};break;case i2.$G.viewDiscover:o={scenarioName:be.Cu.DiscoverSurfaceSwitchV2,source:s.commandSource,eventData:l?{viewType:l}:{}};break;case i2.$G.switchToBizChatMetaOS:o={scenarioName:be.Cu.NavigateToBizChatMetaOSFromSimpleCollab,eventData:{isPopOut:s.openInPopout,...l&&{viewType:l}}};break;case i2.lP.hideBizChatMetaOS:o={scenarioName:be.Cu.HideBizChatMetaOSFromSimpleCollab,source:s.commandSource};break;case i2.$G.switchToActivitySlice:o={scenarioName:be.Cu.SimpleCollabSliceSwitch,source:s.commandSource,eventData:{viewType:s.internalId}}}var c;return o}}}const Dye={NONE:["SHOWN_AND_HOISTED"],CHATS:["CHATS"],TEAMS_AND_CHANNELS:["TEAMS_AND_CHANNELS","SHOWN_AND_HOISTED"]},Pye=(e,t)=>{if((e=>{const t=e.simpleCollabStore.get(e.selectedStickyFiltersInUnifiedViewReadOnlyAtom),n=e.simpleCollabStore.get(e.selectedStickyFiltersInChatsViewReadOnlyAtom),i=e.simpleCollabStore.get(e.selectedStickyFiltersInChannelsViewReadOnlyAtom);return!t.tags||!n.tags||!i.tags})(e)){const n=t&&t.getAllPreferences(),{simpleCollabStickyFilter:{chatsViewFilter:i,channelsViewFilter:a,unifiedViewFilter:o}}=n;i&&i.pills&&e.simpleCollabStore.set(Ope.selectedStickyFiltersInChatsViewAtom,{tags:[...Dye.CHATS,...i.pills],text:i?.text||void 0}),a&&a.pills&&e.simpleCollabStore.set(Ope.selectedStickyFiltersInChannelsViewAtom,{tags:[...Dye.TEAMS_AND_CHANNELS,...a.pills],text:a?.text||void 0}),o&&o.pills&&e.simpleCollabStore.set(Ope.selectedStickyFiltersInUnifiedViewAtom,{tags:[...Dye.NONE,...o.pills],text:o?.text||void 0})}},Mye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"substrateGroupId"}}]}}]}}]},Rye=(e,t)=>{const n=e.newScenario(be.Cu.OpenThreadListPane),i=t(),{convId:a}=i;n.appendEventData({convId:a})},xye=e=>{const t=be.Cu.OpenThreadListPane;e.stopScenarioIfActive(t)},Lye={actionGesture:GR.Od.click,actionOutcome:GR.nd.nav,actionScenario:GR.vB.channelAction,actionSubworkload:GR.i7.channelCardQuickActions,actionWorkload:GR.E0.teamChannelManagement,panelRegion:GR.rP.popover,panelType:GR.HP.ChannelCard,panelUri:"app.conversation"},Oye=nve.V5.ChannelCard,jye=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("TeamsAndChannelsAppChannelCardEvent","apps-teams-and-channels-channel-card");switch(a){case nve.Mi.manageTeamMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeamMembers: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_team_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...Lye,actionScenario:GR.vB.teamNav,actionScenarioType:GR.DB.openteam,eventIdentifier:GR.AJ.channelCard_manageTeamMembersLink_click_teamNav,moduleName:GR.Sn.channelCardManageTeamMembers,moduleType:GR.nR.manageTeamMembersLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Gl(e)})}case nve.Mi.manageChannelMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannelMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_channel_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...Lye,actionScenario:GR.vB.channelNav,actionScenarioType:GR.DB.openchannel,eventIdentifier:GR.AJ.channelCard_manageChannelMembersLink_click_channelNav,moduleName:GR.Sn.channelCardManageChannelMembers,moduleType:GR.nR.manageChannelMembersLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Hl(e)})}case nve.Mi.getLinkToChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`getLinkToChannel: channelId: ${e.channelId}, groupId: ${e.groupId}, teamId: ${e.teamId}, channelResourceTenantId: ${e.channelResourceTenantId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_get_link_to_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.getChannelLink),t({...Lye,eventIdentifier:GR.AJ.channelCard_getChannelLinkButton_click_channelAction,actionScenarioType:GR.DB.getChannelLink,moduleName:GR.Sn.channelCardGetChannelLink,moduleType:GR.nR.getChannelLinkButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Wl(e)})}case nve.Mi.viewChannelEmail:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`viewChannelEmail: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_view_channel_email"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.getChannelEmail),t({...Lye,eventIdentifier:GR.AJ.channelCard_getChannelEmailButton_click_channelAction,actionScenarioType:GR.DB.getChannelEmail,moduleName:GR.Sn.channelCardGetChannelEmail,moduleType:GR.nR.getChannelEmailButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Vl(e)})}case nve.Mi.leaveChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, isLastOwner: ${e.isLastOwner}, groupId: ${e.groupId}, channelOnlyMember: ${e.channelOnlyMember}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_leave_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.leaveChannel),t({...Lye,eventIdentifier:GR.AJ.channelCard_leaveChannelButton_click_channelAction,actionScenarioType:GR.DB.leaveChannel,moduleName:GR.Sn.channelCardLeaveChannel,moduleType:GR.nR.leaveChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Yl(e)})}case nve.Mi.manageChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.manageChannel),t({...Lye,eventIdentifier:GR.AJ.channelCard_manageChannelButton_click_channelAction,actionScenarioType:GR.DB.manageChannel,moduleName:GR.Sn.channelCardManageChannel,moduleType:GR.nR.manageChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Ql(e)})}case nve.Mi.manageTeamChannels:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeamChannels: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_team_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...Lye,actionScenario:GR.vB.teamNav,actionScenarioType:GR.DB.openteam,eventIdentifier:GR.AJ.channelCard_manageTeamChannelsLink_click_teamNav,moduleName:GR.Sn.channelCardManageTeamChannels,moduleType:GR.nR.manageTeamChannelsLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:ql(e)})}case nve.Mi.channelAddMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelAddMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_channel_add_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers),t({...Lye,eventIdentifier:GR.AJ.channelCard_channelAddMembersButton_click_channelAction,actionScenarioType:GR.DB.channelAddMembers,moduleName:GR.Sn.channelCardAddMembers,moduleType:GR.nR.channelAddMembersButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Jl(e)})}case nve.Mi.shareChannelWithUser:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithUser: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_share_channel_with_user"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers,i.channelType="Shared"),t({...Lye,eventIdentifier:GR.AJ.channelCard_shareChannelWithUserButton_click_channelAction,actionScenarioType:GR.DB.shareChannelWithUser,moduleName:GR.Sn.channelCardShareChannelWithUser,moduleType:GR.nR.shareChannelWithUserButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Zl(e)})}case nve.Mi.shareChannelWithTeam:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithTeam: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_share_channel_with_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.addMembers,i.channelType="Shared"),t({...Lye,eventIdentifier:GR.AJ.channelCard_shareChannelWithTeamButton_click_channelAction,actionScenarioType:GR.DB.shareChannelWithTeam,moduleName:GR.Sn.channelCardShareChannelWithTeam,moduleType:GR.nR.shareChannelWithTeamButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:Xl(e)})}case nve.Mi.channelNotificationSettings:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelNotificationSettings: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_channel_notification_settings"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=JB.s4.channelNotificationSettings),t({...Lye,eventIdentifier:GR.AJ.channelCard_channelNotificationSettingsButton_click_channelAction,actionScenarioType:GR.DB.channelNotificationSettings,moduleName:GR.Sn.channelCardChannelNotificationSettings,moduleType:GR.nR.channelNotificationSettingsButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:ec(e)})}default:return}},Bye="TeamsApp",Uye=vve.Nv,$ye=({eventData:e,type:t,logger:n,userBiService:i,scenarioFactory:a})=>{const{channelAction:o,channelState:r,scenarioName:s,...l}=Wye[t],c=e?.actionWorkload||l.actionWorkload;a.newScenario(s);const d=i.createDatabag?.();d&&(d.isChannelsV2=!0,d.channelAction=o,d.channelState=r,d.isGeneralChannel=e?.generalChannelType),i.recordPanelAction({...l,actionWorkload:c,appName:Bye,dataBag:d},n),d?.dispose()},Wye={[vve.W3.seeAllChannelsAction]:{scenarioName:be.Cu.TrinityChannelsTabSeeAllChannels,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenarioType:GR.DB.trinityChannelsTab,moduleName:GR.Sn.seeAllButton,moduleType:GR.nR.button,panelRegion:GR.rP.left,panelType:GR.HP.teamChannelList},[vve.W3.seeAllChannelsOnLoadAction]:{scenarioName:be.Cu.TrinityChannelsTabSeeAllChannels,actionScenario:GR.vB.leftRail,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.channelPreviewAction]:{scenarioName:be.Cu.TrinityChannelsTabChannelPreview,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelPreview,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.channelListItem,moduleType:GR.nR.listItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.openContextMenuAction]:{scenarioName:be.Cu.TrinityChannelsTabOpenContextMenu,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelContextMenu,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.menuButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.showChannelAction]:{scenarioName:be.Cu.TrinityChannelsTabChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.shown,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.hideChannelAction]:{scenarioName:be.Cu.TrinityChannelsTabChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.hidden,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.allPillAction]:{scenarioName:be.Cu.TrinityChannelsTabAllPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectAllChannelFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.allChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.shownForYouPillAction]:{scenarioName:be.Cu.TrinityChannelsTabShownForYouPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectShownChannelFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.shownChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.hiddenPillAction]:{scenarioName:be.Cu.TrinityChannelsTabHiddenPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectHiddenChannelFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.hiddenChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.sharedFromOtherTeamsPillAction]:{scenarioName:be.Cu.TrinityChannelsTabSharedFromOtherTeamsPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectSharedFromOtherTeamsPillFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.sharedFromOtherTeamsButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.archivedPillAction]:{scenarioName:be.Cu.TrinityChannelsTabArchivedPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectArchivedPillFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.archivedChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.deletedPillAction]:{scenarioName:be.Cu.TrinityChannelsTabDeletedPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectDeletedPillFilter,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.deletedChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.sortByAction]:{scenarioName:be.Cu.TrinityChannelsTabSortBy,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectSort,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.sortSelection,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.searchAction]:{scenarioName:be.Cu.TrinityChannelsTabSearch,actionGesture:GR.Od.click,actionScenario:GR.vB.search,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.searchButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.searchResultsAction]:{scenarioName:be.Cu.TrinityChannelsTabSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.searchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.searchNoResultsAction]:{scenarioName:be.Cu.TrinityChannelsTabSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.noSearchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[vve.W3.addChannel]:{scenarioName:be.Cu.TrinityChannelsTabAddChannelButtonClick,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.addChannel,actionScenarioType:GR.DB.trinityChannelsTab,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.menuButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel}},Vye=rve.Nv,Hye=({eventData:e,type:t,logger:n,userBiService:i,scenarioFactory:a})=>{const{channelAction:o,channelState:r,scenarioName:s,...l}=zye[t],c=e?.actionWorkload||l.actionWorkload;a.newScenario(s);const d=i.createDatabag?.();d&&(d.isChannelsV2=!0,d.channelAction=o,d.channelState=r,d.isGeneralChannel=e?.generalChannelType),i.recordPanelAction({...l,actionWorkload:c,appName:Bye,dataBag:d},n),d?.dispose()},zye={[rve.w6.seeAllChannelsAction]:{scenarioName:be.Cu.UserOnboardingToTeamSeeAllChannels,actionGesture:GR.Od.click,actionOutcome:GR.nd.show,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.seeAllChannelsInChannelList,actionScenarioType:GR.DB.channelList,moduleName:GR.Sn.seeAllChannelsButton,moduleType:GR.nR.button,panelRegion:GR.rP.left,panelType:GR.HP.teamChannelList,entityType:ke.ck.channels},[rve.w6.seeAllChannelsOnLoadAction]:{scenarioName:be.Cu.UserOnboardingToTeamSeeAllChannels,actionScenario:GR.vB.onboardingPage,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.channelPreviewAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelPreview,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelPreview,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.channelListItem,moduleType:GR.nR.listItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.channelBackAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelBack,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenario:GR.vB.channelPreview,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.channelMessagePane,moduleName:GR.Sn.backButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.openContextMenuAction]:{scenarioName:be.Cu.UserOnboardingToTeamOpenContextMenu,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelContextMenu,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.menuButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.goToTeamAction]:{scenarioName:be.Cu.UserOnboardingToTeamGoToTeam,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionOutcomeNew:GR.nd.nav,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.goToTeamButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.activityFeed},[rve.w6.activityFeedOnLoadAction]:{scenarioName:be.Cu.UserOnboardingToTeamActivityFeed,actionScenario:GR.vB.activityFeed,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.showChannelAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.shown,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.hideChannelAction]:{scenarioName:be.Cu.UserOnboardingToTeamChannelItem,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.channelAction,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.channelManagement,channelAction:JB.s4.favoriteChannel,channelState:JB.d8.hidden,moduleName:GR.Sn.channelActionMenu,moduleType:GR.nR.menuItem,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.allPillAction]:{scenarioName:be.Cu.UserOnboardingToTeamAllPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectAllChannelFilter,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.allChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.shownPillAction]:{scenarioName:be.Cu.UserOnboardingToTeamShownPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectShownChannelFilter,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.shownChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.hiddenPillAction]:{scenarioName:be.Cu.UserOnboardingToTeamHiddenPill,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectHiddenChannelFilter,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.hiddenChannelButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.sortByAction]:{scenarioName:be.Cu.UserOnboardingToTeamSortBy,actionGesture:GR.Od.click,actionOutcome:GR.nd.submit,actionScenario:GR.vB.selectSort,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.sortSelection,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.searchAction]:{scenarioName:be.Cu.UserOnboardingToTeamSearch,actionGesture:GR.Od.click,actionScenario:GR.vB.search,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,moduleName:GR.Sn.searchButton,moduleType:GR.nR.button,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.searchResultsAction]:{scenarioName:be.Cu.UserOnboardingToTeamSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.searchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel},[rve.w6.searchNoResultsAction]:{scenarioName:be.Cu.UserOnboardingToTeamSearch,actionScenario:GR.vB.search,actionScenarioType:GR.DB.onboardingPage,actionWorkload:GR.E0.allChannelsViewSortByAToZ,actionSubworkload:GR.i7.noSearchResults,panelRegion:GR.rP.main,panelType:GR.HP.Channel}},qye=nve.V5.ManageTeams,Gye={onEventReceived:async({eventInput:e,requestContext:{client:t,loggerFactory:n,scenarioFactory:i,userBiService:a,viewEntity:o,viewportContext:r,i18n:s}})=>{switch(e.event.originator){case t2.Nv:case Oye:case qye:case Vye:case Uye:case i2.Nv:return Yye(e,n,i,a,s)}switch(e.event.type){case Br.mu.goBack:return{command:ee.goBack()};case Br.mu.resetLayoutOverrides:return{command:ee.resetLayoutOverrides()}}var l;if(l=e.event,Boolean(l.data))switch(e.event.type){case Br.mu.expandTab:{const t=e.event.data();return{command:ee.expandTab(t)}}case uq.mu.requestPersonMoreInfo:{const n=e.event.data();let i=!1,a="";if(o?.id){const{data:{chat:e}}=await t.query({query:Mye,variables:{convId:o?.id},context:{callerInfo:"apps-teams-and-channels-event-handler"}});i=!!e?.substrateGroupId,a=e?.tenantId||""}return{command:vq({...n,...a&&{tenantId:a},...o?.id&&{conversationId:o?.id},isSharedChannel:i})}}case uq.mu.requestTopicMoreInfo:{const t=e.event.data();return{command:Sq({...t})}}case nve.Mi.toggleInfoPane:{const{action:t,entityOptions:n,id:i,showOption:a,source:o,subId:s,type:l}=e.event.data(),c=r===go.k.primary;return{command:ee.toggleEndRail({action:t||ke.SY.info,entityOptions:n,id:i,linkedEntity:s?{action:ke.SY.info,id:s,type:ke.ck.channels}:void 0,shouldPersistState:c,targetWindow:c?g.BA.main:void 0,showOption:a,source:o,type:l||ke.ck.channels})}}}}};const Yye=async(e,t,n,i,a)=>e.event.originator===t2.Nv?(async(e,t,n,i,a)=>t2.v0.isThreadListPaneEvent(e)?((0,t2.$H)(e,"channel",Mm,i,a),{command:tc(e.data()),source:t}):t2.v0.isOpenThreadPaneEvent(e)?((0,t2.z1)(e,"channel",Mm,i,a),{command:nc(e.data()),source:t}):t2.v0.isHideThreadPaneEvent(e)?{command:ic(e.data()),source:t}:t2.v0.isPopoutThreadEvent(e)?{command:ac(e.data()),source:t}:void(t2.v0.isFetchThreadListPaneDataEvent(e)?Rye(n,e.data):t2.v0.isThreadListPaneRenderedEvent(e)&&xye(n)))(e.event,e.source,n,i,t):e.event.originator===i2.Nv?(async(e,t,n,i,a)=>{const{type:o}=e;switch(o){case i2.sU.createConversationFolder:case i2.T8.createConversationFolderConfirmAction:case i2.T8.createConversationFolderSucceeded:case i2.T8.createConversationFolderFailed:case i2.T8.createConversationFolderCancelAction:return g2({event:e,requestContext:{loggerFactory:t,scenarioFactory:i,userBiService:n,i18n:a}});case i2.T8.moveConversationToFolderAction:case i2.T8.moveToSubMenuClick:case i2.T8.moveConversationToFolderSucceeded:case i2.T8.moveConversationToFolderFailed:return T2({event:e,requestContext:{loggerFactory:t,userBiService:n,scenarioFactory:i,i18n:a}})}})(e.event,t,i,n,a):e.event.originator===Oye?jye(e.event,t,i):e.event.originator===qye?(async e=>{const{data:t,type:n}=e;switch(n){case nve.Mi.manageTeamChannels:{const e="function"==typeof t?t():{};return Promise.resolve({command:ql(e)})}case nve.we.manageTeam:{const e="function"==typeof t?t():{};return Promise.resolve({command:zl(e)})}case nve.we.manageTags:{const e="function"==typeof t?t():{};return Promise.resolve({command:sc(e)})}case nve.we.getLinkToTeam:{const e="function"==typeof t?t():{};return Promise.resolve({command:dc(e)})}case nve.we.leaveTeam:{const e="function"==typeof t?t():{};return Promise.resolve({command:lc(e)})}case nve.we.teamAddMember:{const e="function"==typeof t?t():{};return Promise.resolve({command:oc(e)})}case nve.we.teamAddChannel:{const e="function"==typeof t?t():{};return Promise.resolve({command:rc(e)})}case nve.we.deleteTeam:{const e="function"==typeof t?t():{};return Promise.resolve({command:uc(e)})}case nve.we.hideAllChannelsDialog:{const e="function"==typeof t?t():{};return Promise.resolve({command:cc(e)})}default:return}})(e.event):e.event.originator===Vye?(async(e,t,n,i)=>{const{type:a,data:o}=e,r=t.newLogger("TeamsAndChannelsApp UserOnboardingToTeamEvents","apps-teams-and-channels");switch(a){case rve.w6.switchToChannel:{const e="function"==typeof o?o():{};return Promise.resolve({command:Ul(e)})}case rve.w6.loadUserOnboardingToTeamPage:{const e="function"==typeof o?o():{};return Promise.resolve({command:$l(e)})}case rve.w6.seeAllChannelsLoadMoreRenderStart:return void i.newScenario(be.Cu.UserOnboardingToTeamLoadNext);case rve.w6.seeAllChannelsLoadMoreRenderFail:{const e=be.Cu.UserOnboardingToTeamLoadNext,t=i.findScenario(e);return void(t&&t.fail())}case rve.w6.seeAllChannelsLoadMoreRenderComplete:{const e=be.Cu.UserOnboardingToTeamLoadNext;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.UserOnboardingToTeamLoadNextComplete),i.stopScenarioIfActive(e)))}case rve.w6.useronboardingFilterSortLoadStart:{const e="function"==typeof o?o():{};return void i.newScenario(be.Cu.UserOnboardingToTeamFilterSortLoad).appendEventData({dataSource:e.actionWorkload})}case rve.w6.useronboardingFilterSortLoadFail:{const e=be.Cu.UserOnboardingToTeamFilterSortLoad,t=i.findScenario(e);return void(t&&t.fail())}case rve.w6.useronboardingFilterSortLoadComplete:{const e=be.Cu.UserOnboardingToTeamFilterSortLoad;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.UserOnboardingToTeamFilterSortLoadComplete),i.stopScenarioIfActive(e)))}case rve.w6.userOnboardingRenderStart:return void i.newScenario(be.Cu.UserOnboardingToTeamRender);case rve.w6.userOnboardingRenderFail:{const e=be.Cu.UserOnboardingToTeamRender,t=i.findScenario(e);return void(t&&t.fail())}case rve.w6.userOnboardingRenderComplete:{const e=be.Cu.UserOnboardingToTeamRender;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.UserOnboardingToTeamRenderComplete),i.stopScenarioIfActive(e)))}case rve.w6.seeAllChannelsAction:case rve.w6.seeAllChannelsOnLoadAction:case rve.w6.channelPreviewAction:case rve.w6.channelBackAction:case rve.w6.openContextMenuAction:case rve.w6.goToTeamAction:case rve.w6.activityFeedOnLoadAction:case rve.w6.showChannelAction:case rve.w6.hideChannelAction:case rve.w6.allPillAction:case rve.w6.shownPillAction:case rve.w6.hiddenPillAction:case rve.w6.sortByAction:case rve.w6.searchAction:case rve.w6.searchResultsAction:case rve.w6.searchNoResultsAction:{const e="function"==typeof o?o():void 0;return Hye({eventData:e,type:a,logger:r,userBiService:n,scenarioFactory:i})}}})(e.event,t,i,n):e.event.originator===Uye?(async(e,t,n,i)=>{const{type:a,data:o}=e,r=t.newLogger("TeamsAndChannelsApp TrinityChannelsTabEvents","apps-teams-and-channels");switch(a){case vve.W3.switchToChannel:{const e="function"==typeof o?o():{};return Promise.resolve({command:Ul(e)})}case vve.W3.seeAllChannelsLoadMoreRenderStart:return void i.newScenario(be.Cu.TrinityChannelsTabLoadNext);case vve.W3.seeAllChannelsLoadMoreRenderFail:{const e=be.Cu.TrinityChannelsTabLoadNext,t=i.findScenario(e);return void(t&&t.fail())}case vve.W3.seeAllChannelsLoadMoreRenderComplete:{const e=be.Cu.TrinityChannelsTabLoadNext;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.TrinityChannelsTabLoadNextComplete),i.stopScenarioIfActive(e)))}case vve.W3.trinitychannelstabFilterSortLoadStart:{const e="function"==typeof o?o():{};return void i.newScenario(be.Cu.TrinityChannelsTabFilterSortLoad).appendEventData({dataSource:e.actionWorkload})}case vve.W3.trinitychannelstabFilterSortLoadFail:{const e=be.Cu.TrinityChannelsTabFilterSortLoad,t=i.findScenario(e);return void(t&&t.fail())}case vve.W3.trinitychannelstabFilterSortLoadComplete:{const e=be.Cu.TrinityChannelsTabFilterSortLoad;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.TrinityChannelsTabFilterSortLoadComplete),i.stopScenarioIfActive(e)))}case vve.W3.trinitychannelstabRenderStart:return void i.newScenario(be.Cu.TrinityChannelsTabRender);case vve.W3.trinitychannelstabRenderFail:{const e=be.Cu.TrinityChannelsTabRender,t=i.findScenario(e);return void(t&&t.fail())}case vve.W3.trinitychannelstabRenderComplete:{const e=be.Cu.TrinityChannelsTabRender;return void(i.findScenario(e)&&(i.startStep(e,be.BQ.TrinityChannelsTabRenderComplete),i.stopScenarioIfActive(e)))}case vve.W3.seeAllChannelsAction:case vve.W3.seeAllChannelsOnLoadAction:case vve.W3.channelPreviewAction:case vve.W3.openContextMenuAction:case vve.W3.showChannelAction:case vve.W3.hideChannelAction:case vve.W3.allPillAction:case vve.W3.shownForYouPillAction:case vve.W3.hiddenPillAction:case vve.W3.sharedFromOtherTeamsPillAction:case vve.W3.archivedPillAction:case vve.W3.deletedPillAction:case vve.W3.sortByAction:case vve.W3.searchAction:case vve.W3.searchResultsAction:case vve.W3.searchNoResultsAction:{const e="function"==typeof o?o():void 0;return $ye({eventData:e,type:a,logger:r,userBiService:n,scenarioFactory:i})}case vve.W3.addChannel:{const e="function"==typeof o?o():{};return $ye({eventData:e,type:a,logger:r,userBiService:n,scenarioFactory:i}),Promise.resolve({command:Kl(e)})}}})(e.event,t,i,n):void 0,Qye=(e,t,n,i)=>{const a=e.event;if(function(e){return Boolean(e.data)}(a)&&a.type===nve.Mi.toggleInfoPane){const{source:e}=a.data();return{source:e}}if(a.originator===t2.Nv&&t2.v0.isOpenThreadPaneEvent(a))return{scenarioName:be.Cu.ChannelThreadSwitch,source:a.data().commandSource}};var Jye,Kye,Zye,Xye,eSe,tSe=n(726464);!function(e){e.teamDashboard="/l/team-dashboard",e.channelDashboard="/l/channel-dashboard",e.pendingInvites="/l/manage-teams/myinvites",e.channel="/l/channel",e.replyChain="/l/message",e.team="/l/team",e.teamsPremiumTrial="/l/trial/teamsPremiumTrial",e.teamsPremiumLicenseRequest="/l/trial/teamsPremiumLicenseRequest"}(Jye||(Jye={})),function(e){e.FeatureNotEnabled="Feature for parsing T1 teams and channels deep links in T2.1 is not enabled",e.NoChannelId="Parsed teams and channels deep link does not contain the channel id",e.NoThreadId="Parsed teams and channels deep link does not contain the thread id",e.InvalidDeeplinkType="Parsed teams and channels deep link does not contain a valid deeplink type",e.NoTabId="Parsed teams and channels deep link does not contain the tab id",e.MalformedContext="Parsed teams and channels deep link contains malformed search context"}(Kye||(Kye={})),function(e){e.FeatureNotEnabled="channel_on_before_deep_link_parsed_feature_not_enabled_error",e.NoChannelId="channel_on_before_deep_link_parsed_no_channel_id_error",e.NoThreadId="channel_on_before_deep_link_parsed_no_thread_id_error",e.InvalidDeeplinkType="channel_on_before_deep_link_parsed_invalid_deeplink_type_error",e.NoTabId="channel_on_before_deep_link_parsed_no_tab_id_error",e.MalformedContext="channel_on_before_deep_link_parsed_malformed_search_context_error"}(Zye||(Zye={})),function(e){e.TeamDashboard="team-dashboard",e.ChannelDashboard="channel-dashboard",e.TeamsDashboard="manage-teams"}(Xye||(Xye={})),function(e){e.MembersId="td.members",e.SettingsId="td.settings",e.AppsId="td.apps",e.PendingRequestsId="td.joinRequests",e.ChannelsId="td.channels",e.AnalyticsId="td.analytics",e.SharedChannelPendingRequestsId="sharedChannelPendingRequests",e.TagsId="td.tags"}(eSe||(eSe={}));const nSe=async({deeplinkUrl:e,parsedDeeplinkHash:t,preferredCommandInput:n,context:{coreSettings:i,loggerFactory:a,scenarioFactory:o,getUserContexts:r}})=>{const s=a.newLogger("TeamsAndChannelsApp onBeforeDeeplinkParsed","apps-teams-and-channels"),l=o.newScenario(be.Cu.TeamsAndChannelsDeeplinkNavigation),{enablePlatformDeepLinkRouting:d}=i.get(c.w.Extensibility),{enableParseT1TeamsAndChannelsDeeplinks:u}=i.get(c.w.Channels);if(!u)throw s.errorToTelemetry?.(Kye.FeatureNotEnabled,Zye.FeatureNotEnabled),l.cancel(),Error(Kye.FeatureNotEnabled);let m,p,g,h,v,y,S,f,k,C={};if(t?.search){const{search:e}=t;s.log(`Parsing parsedDeeplinkHash - channelId: ${e.threadId}, replyChainId: ${e.replyChainId}, messageId: ${e.messageId}, tenantId: ${e.tenantId}, allowXTenantAccess: ${e.allowXTenantAccess}, nextGenerationChannel: ${e.nextGenerationChannel}`),l.mark(be.BQ.ParsingHash),m=e.threadId,p=e.replyChainId,g=e.messageId,h=e.tenantId,y=e.groupId,f=e.channelName,k=aSe(e.nextGenerationChannel),S=aSe(e.allowXTenantAccess)}else{const{pathname:t,search:n}=e;s.log(`Parsing deeplinkUrl - pathname: ${t}, search: ${n}`),l.mark(be.BQ.ParsingUrl);const i=decodeURIComponent(t),a=i.split("/"),o=i?.split(/[/?&]/),r=o?.indexOf("channel");v=o?.[r+M9.lD];const c=a.findIndex((e=>e.startsWith(N1.gN.SkypeSpacesThread)));m=a[c];const d=new URLSearchParams(n),u=d.get("context");C=rSe(s,u),p=d.get("parentMessageId")||void 0,g=c+1<a.length&&(0,n_.v3)(a[c+1])?a[c+1]:void 0,h=d.get("tenantId")||void 0,y=d.get("groupId")||void 0,S=aSe(d.get("allowXTenantAccess")||void 0),k=aSe(d.get("ngc")||void 0),f=d.get("channelName")||oSe(t,a,c+1)}if(m){l.mark(be.BQ.DeeplinkParsed);const t={channelType:sSe(k,S)};if(l.appendEventData(t),d&&v?.includes(M9.YT)){s.log(`toPlatformTabNavigationIntent - tabId: ${v} channelId: ${m}, deeplinkContext: ${C}, tenantId: ${h}`);const t=await r(),n=iSe(t);return(0,M9.jI)(m,"",e,h,C,v,o,void 0,n)}s.log(`toNavigationIntent - channelId: ${m}, replyChainId: ${p}, messageId: ${g}, tenantId: ${h}`);const i=kSe(n);return cSe(m,p,g,h,y,S,f,k,n,i)}return s.errorToTelemetry?.(Kye.NoChannelId,Zye.NoChannelId),l.fail(),Promise.resolve(void 0)},iSe=e=>{const t=e.find((e=>e.userContextAccountType===FR.SourceWindow));if(t)return t.context.client;const n=e.find((e=>e.userContextAccountType===FR.MainWindow));return n?.context.client},aSe=e=>"true"===e?.toLowerCase(),oSe=(e,t,n)=>{if(e.startsWith(Jye.channel)&&!(n>=t.length))return t[n]},rSe=(e,t)=>{try{return t&&JSON.parse(t)}catch(t){return e.errorToTelemetry?.("[handleTeamsAndChannelsDeeplink] could not parse deeplink context","platform_deeplink_context_parse_error"),{}}},sSe=(e,t)=>e&&t?"Shared":e?"Private":"Standard",lSe=({deeplinkUrl:e,preferredCommandInput:t,context:{loggerFactory:n}})=>{const i=n.newLogger("TeamsAndChannelsApp onBeforeDeeplinkParsed","apps-teams-and-channels"),{pathname:a}=e;i.log(`Parsing deeplinkUrl - pathname: ${a}`);const o=a.split("/"),r=o[2];let s;switch(r){case Xye.TeamsDashboard:return i.log(`toNavigationTeamsDashboard - deeplinkType: ${r}`),pSe(t);case Xye.TeamDashboard:case Xye.ChannelDashboard:const n=o.findIndex((e=>e.startsWith(N1.gN.SkypeSpacesThread))),a=o[n];if(!a)return i.errorToTelemetry?.(Kye.NoThreadId,Zye.NoThreadId),Promise.resolve(void 0);if(s=o[4],!s)return i.errorToTelemetry?.(Kye.NoTabId,Zye.NoTabId),Promise.resolve(void 0);let l;if(s===eSe.TagsId){const t=e?.searchParams?.get("context");try{l=t?JSON.parse(t)?.tagId:void 0}catch(e){i.errorToTelemetry?.(Kye.MalformedContext,Zye.MalformedContext)}}return i.log(`toNavigationThreadDashboard - deeplinkType: ${r}, threadId: ${a}, tab: ${s}`),dSe(r,a,s,t,l);default:return i.errorToTelemetry?.(Kye.InvalidDeeplinkType,Zye.InvalidDeeplinkType),Promise.resolve(void 0)}},cSe=(e,t,n,i,a,o,r,s,l,c)=>Promise.resolve({entityCommand:{entity:{type:ke.ck.channels,action:ke.SY.view,id:JSON.stringify({channelId:e,replyChainId:t})},command:{stateTransition:l?.stateTransition??g.Ar.flush,visibilityState:l?.visibilityState??g.Rp.show},entityOptions:{focusOnLoad:c,deepLinkId:n,groupId:a,nextGenerationChannel:s,channelName:r,source:A.p.InternalDeeplink}},metadata:{allowAnonymous:!1,allowXTenantAccess:o,tenantId:i}}),dSe=(e,t,n,i,a)=>{const o=e===Xye.TeamDashboard?uSe(n):mSe(n);return Promise.resolve({entityCommand:{entity:{type:o,action:ke.SY.view,id:t},command:{stateTransition:i?.stateTransition??g.Ar.flush,visibilityState:i?.visibilityState??g.Rp.show},entityOptions:{tagId:a,commandSource:i?.correlation?.source}},metadata:{allowAnonymous:!1}})},uSe=e=>{switch(e){case eSe.AnalyticsId:return ke.ck.teamanalytics;case eSe.ChannelsId:return ke.ck.teamchannels;case eSe.SettingsId:return ke.ck.teamsettings;case eSe.AppsId:return ke.ck.teammanageapps;case eSe.PendingRequestsId:return ke.ck.teampendingrequests;case eSe.TagsId:return ke.ck.teammanagetags;case eSe.MembersId:return ke.ck.teammembers;default:return ke.ck.teammanage}},mSe=e=>{switch(e){case eSe.AnalyticsId:return ke.ck.channelanalytics;case eSe.SettingsId:return ke.ck.channelsettings;case eSe.SharedChannelPendingRequestsId:return ke.ck.channelinvitations;case eSe.MembersId:return ke.ck.channelmembers;case eSe.TagsId:return ke.ck.channeltags;default:return ke.ck.channelmanage}},pSe=e=>Promise.resolve({entityCommand:{entity:{type:ke.ck.sharedchannelspendinginvites,action:ke.SY.view},command:{stateTransition:e?.stateTransition??g.Ar.flush,visibilityState:e?.visibilityState??g.Rp.show},entityOptions:{uniqueId:e?.correlation?.startTimestamp}},metadata:{allowAnonymous:!1}}),gSe={filter:Jye.teamDashboard,execute:lSe},hSe={filter:Jye.channelDashboard,execute:lSe},vSe={filter:Jye.pendingInvites,execute:lSe},ySe={filter:Jye.channel,execute:nSe},SSe={filter:Jye.replyChain,execute:nSe},fSe={filter:Jye.team,execute:nSe},kSe=e=>{const t=e?.correlation?.source;return t===A.p.ActivityFeed||t===A.p.ActivityFeedBellClick?Bt.I.DoNotMove:void 0},CSe=[gSe,hSe,vSe,ySe,SSe,fSe,{filter:(e,t)=>!!e.hash&&"channel"===t?.search?.ctx,execute:nSe},{filter:Jye.teamsPremiumTrial,execute:({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n}})=>{const{enableTeamsPremiumTrialDeeplink:i}=t.get(c.w.Premium),a=n.newLogger("TeamsAndChannelsApp:BeforeDeeplinkParsedCondition:teamsPremiumTrial","apps-teams-and-channels");if(!i)return a.log(`Teams Premium Trial Deeplink is not enabled, enableTeamsPremiumTrialDeeplink value is ${i}`),Promise.reject({message:"teams-premium-trial-deeplink-not-enabled"});a.log("execute command executeTeamsPremiumTrialDialogDeeplinkUrl");const o=(new URLSearchParams(e.search).get("source")??"").toLocaleLowerCase();return Promise.resolve({entityCommand:{entity:{type:ke.ck.premiumtrialdialog,action:ke.SY.view},entityOptions:{entryPoint:o},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}})}},{filter:Jye.teamsPremiumLicenseRequest,execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableTeamsPremiumLicenseRequestDeeplink:n}=e.get(c.w.Premium),i=t.newLogger("TeamsAndChannelsApp:BeforeDeeplinkParsedCondition:teamsPremiumLicenseRequest","apps-teams-and-channels");return n?(i.log("execute command executeTeamsPremiumLicenseRequestDialogDeeplinkUrl"),Promise.resolve({entityCommand:{entity:{type:ke.ck.licenserequestdialog,action:ke.SY.view},entityOptions:{licenseType:tSe.J.TeamsPremium},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show}},metadata:{allowAnonymous:!1}})):(i.log(`Teams Premium License Request Deeplink is not enabled, enableTeamsPremiumLicenseRequestDeeplink value is ${n}`),Promise.reject({message:"teams-premium-license-request-deeplink-not-enabled"}))}}],bSe={shouldAddEntitiesToWindowHistory:()=>!0,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>{if(e?.type===ke.ck.schoolteams)return!0;if(e?.type===ke.ck.discoversurface)return!0;if(e?.type!==ke.ck.channels)return!1;const{replyChainId:t}=(0,d3.Ep)(e?.id||"");return!t}},wSe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsChannelAccessByIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelAccessByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"canAccess"}},{kind:"Field",name:{kind:"Name",value:"errorType"}},{kind:"Field",name:{kind:"Name",value:"ifConvUxChannel"}}]}}]}}]},TSe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsConversationFolderQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"conversationFolders"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ConversationFoldersConnection"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_BaseConversationFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_SystemDefinedConversationFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewType"}}]}}]}}]}}]}}]}}]}}]}}]},ISe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsChannelInfoByIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"groupId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelThreadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelJoinInfo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"groupId"},value:{kind:"Variable",name:{kind:"Name",value:"groupId"}}},{kind:"Argument",name:{kind:"Name",value:"channelThreadId"},value:{kind:"Variable",name:{kind:"Name",value:"channelThreadId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"memberCount"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"hasPendingJoinRequest"}},{kind:"Field",name:{kind:"Name",value:"teamV2"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NonMemberSharedTeam"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Team"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]}}]}}]},NSe=async e=>{const{entityCommand:t,entityCommand:{entity:n,entityOptions:i},requestContext:{client:a,coreSettings:o,loggerFactory:r,scenarioFactory:s}}=e,{enableTeamJoinDialog:l}=o.get(c.w.TeamsAndChannels),{enableConvUXinChannels:d}=o.get(c.w.Channels),u=r.newLogger("TeamsAndChannels CallingOnBeforeCommandHandled","apps-teams-and-channels");let m=!1;if(l&&LSe(t.command.correlation.source)){const e=(0,d3.Wo)(n),{channelId:r,replyChainId:l}=e,p=i,g=p?.groupId,h=p?.nextGenerationChannel||!1,v=p?.deepLinkId||void 0,y=p?.channelName,S=xSe(t?.metadata?.deepLink);if(r){try{const{data:e,error:i}=await a.query({query:wSe,fetchPolicy:"network-only",nextFetchPolicy:"cache-first",variables:{conversationId:r}});if(i)return RSe(u,`Error getting channel join information for ${r}`),OSe(s,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.TeamJoinErrorDialog,!1,!0),Promise.resolve(DSe(t,g,r,l,void 0,!0));if(e&&"ChannelDeleted"===e.channelAccessByID.errorType)return RSe(u,`Channel ${r} has been deleted.`),OSe(s,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.DeletedDialog,!0,!1),Promise.resolve(MSe(t,Yn.Wu.ChannelDeleted,y));if(e&&!e.channelAccessByID.canAccess){const{enableChannelJoinDialog:e}=o.get(c.w.TeamsAndChannels);return _Se(a,s,u,!!e,h,t,g,r,l,S,y)}d&&n?.type===ke.ck.channels&&n?.action===ke.SY.view&&l&&v&&(m=e&&e.channelAccessByID.ifConvUxChannel)}catch(e){return RSe(u,`Error getting channel join information for ${r}`),OSe(s,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.TeamJoinErrorDialog,!1,!0),Promise.resolve(DSe(t,g,r,l,S,!0))}OSe(s,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.NavigateToResource,!0)}}if(!(t.entityOptions&&t.entityOptions.isViewFromSimpleCollab||!1)){const e=await k1(a,o),r=e!==Pj.LS.none,{enablePopoutAction:s}=o.get(c.w.ChatList),{enableTrinityChannelsTab:l}=o.get(c.w.TeamsAndChannels);if(t.entity.type===ke.ck.teamchannels&&r&&l){return{...t,entity:{...t.entity,type:ke.ck.simplecollabmanageteamchannels,linkedEntity:{id:t.entity.linkedEntity?.id||"",type:e===Pj.LS.split?ke.ck.simplecollabchannels:ke.ck.simplecollab,action:ke.SY.view}},entityOptions:{...i,ifConvUxChannel:m}}}if(ASe(t,r)){return{...t,entity:{...t.entity,linkedEntity:{...t.entity.linkedEntity,id:t.entity.linkedEntity?.id||"",type:e===Pj.LS.split?ke.ck.simplecollabchannels:ke.ck.simplecollab}},entityOptions:{...i,ifConvUxChannel:m}}}if(ESe(t,r,s)){const o=await FSe(n,e,a,u,l);return{...t,entity:{...t.entity,...o},entityOptions:{...i,ifConvUxChannel:m}}}}return{...t,entityOptions:{...i,ifConvUxChannel:m}}},ASe=(e,t)=>{if(!t||!e.entity.linkedEntity)return!1;const n=[ke.ck.teammanage,ke.ck.teammembers,ke.ck.teamchannels,ke.ck.teampendingrequests,ke.ck.teamsettings,ke.ck.teammanageapps,ke.ck.teammanagetags,ke.ck.teamanalytics,ke.ck.channelanalytics,ke.ck.channelapps,ke.ck.channelmanage,ke.ck.channelmembers,ke.ck.channelsettings,ke.ck.channelinvitations,ke.ck.channeltags,ke.ck.crossteamanalytics];return["flush"].includes(e.command.stateTransition)&&n.includes(e.entity.type)&&e.entity.linkedEntity.type===ke.ck.channels&&e.entity.linkedEntity.action===ke.SY.list},ESe=(e,t,n)=>{const i=["flow","none","extend"];return n&&i.push("new"),!(e.entity.type===ke.ck.simplecollab||!t||i.includes(e.command.stateTransition)||e.entity.linkedEntity&&e.entity.linkedEntity?.type===ke.ck.simplecollab)},FSe=async(e,t,n,i,a)=>{const{type:o,id:r}=e;if(o===ke.ck.useronboardingteam&&r){const e=await async function(e,t){try{const{data:t}=await e.query({query:TSe,fetchPolicy:"network-only"});if(!t||"OneGQL_ConversationFoldersError"===t.conversationFolders.__typename)return!1;return-1!==t.conversationFolders.edges?.findIndex((e=>"OneGQL_SystemDefinedConversationFolder"===e.node.__typename&&"CHANNELS_ONLY"===e.node.viewType))}catch(e){return t.error("Failed to fetch conversation folder"),!1}}(n,i);if(e){const e=JSON.parse(r).teamId.slice(0,-1);return{type:a?ke.ck.simplecollabmanageteamchannels:ke.ck.teamchannels,id:e,linkedEntity:{id:e,type:t===Pj.LS.split?ke.ck.simplecollabchannels:ke.ck.simplecollab,action:ke.SY.view}}}return{type:ke.ck.useronboardingteam,id:r,linkedEntity:{id:r,type:t===Pj.LS.split?ke.ck.simplecollabchannels:ke.ck.simplecollab,action:ke.SY.view}}}return t===Pj.LS.split?{type:ke.ck.simplecollabchannels,id:r}:{type:ke.ck.simplecollab,id:r}};const _Se=async(e,t,n,i,a,o,r,s,l,c,d)=>{if(a){if(i)try{const{data:n}=await e.query({query:ISe,fetchPolicy:"network-only",variables:{groupId:r,channelThreadId:s}});if(r&&s&&n&&"Shared"===n.channelJoinInfo?.channelType){OSe(t,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.ChannelJoinDialog,!0);const e=n.channelJoinInfo;return PSe(o,r,s,e.displayName||void 0,e.teamV2?.displayName||void 0,e.channelType||void 0,e.memberCount||void 0,c,!!e.hasPendingJoinRequest)}}catch(e){RSe(n,`Error getting channel info for ${s}`)}return OSe(t,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.NoAccessDialog,!0),MSe(o,Yn.Wu.NoAccessToChannel,d)}return OSe(t,be.Cu.TeamsAndChannelsDeeplinkNavigation,be.BQ.TeamJoinDialog,!0),DSe(o,r,s,l,c,!1)},DSe=(e,t,n,i,a,o)=>({...e,entity:{type:ke.ck.teamjoindialog,action:ke.SY.view},command:{stateTransition:"extend",visibilityState:g.Rp.show,correlation:e.command.correlation},entityOptions:{groupId:t,channelId:n,messageId:i,linkType:a,isError:o}}),PSe=(e,t,n,i,a,o,r,s,l)=>({...e,entity:{type:ke.ck.channeljoindialog,action:ke.SY.view},command:{stateTransition:"extend",visibilityState:g.Rp.show,correlation:e.command.correlation},entityOptions:{groupId:t,channelId:n,channelName:i,teamName:a,channelType:o,memberCount:r,linkType:s,requestSent:l}}),MSe=(e,t,n)=>({...e,entity:{type:ke.ck.defaultchannelnavdialog,action:ke.SY.view},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:e.command.correlation},entityOptions:{error:t,channelName:n}}),RSe=(e,t)=>{e?.errorToTelemetry&&e.errorToTelemetry(t,"teams_and_channels_on_before_command_handled_error",void 0,!0)},xSe=e=>{const t=e?.match(/\/(team|channel|message)\//i);return t&&t.length>1?t[1]:void 0},LSe=e=>{switch(e){case A.p.AuthApp:case A.p.ExternalCommand:case A.p.InternalDeeplink:return!0;default:return!1}},OSe=(e,t,n,i=!1,a=!1)=>{const o=e.findScenario(t);o&&(o.mark(n),i&&o.stop(),a&&o.fail())},jSe=e=>{if(BSe(e))return USe(e)?{subNavEntity:WSe(e),headerEntity:YSe(e),startEntity:QSe(e),mainEntity:JSe(e),endEntity:XSe(e)}:null},BSe=({layoutMode:e,contextEntity:t,entity:n})=>{const{action:i=null,type:a}={...n},{type:o,action:r}=t||{},s=[Yt.Rm.standard,Yt.Rm.focus].includes(e),l=[ke.ck.acceptsharedchannelinvitationdialog,ke.ck.archiveteam,ke.ck.archivechannel,ke.ck.callablechannels,ke.ck.channelapps,ke.ck.channelanalytics,ke.ck.channelcalendar,ke.ck.channelconnectors,ke.ck.channelcopilot,ke.ck.channelworkflows,ke.ck.channelemailerror,ke.ck.channelemailv2,ke.ck.channeljoindialog,ke.ck.channelmanage,ke.ck.channelmembers,ke.ck.channels,ke.ck.channelsPinnedPost,ke.ck.channelsSystemMessage,ke.ck.channelsettings,ke.ck.channelinvitations,ke.ck.channeltags,ke.ck.channelcontextualsearch,ke.ck.channelthread,ke.ck.createchanneldialog,ke.ck.crosspostchannelselectiondialog,ke.ck.crosspostchannelselectiondialogV2,ke.ck.deleteteam,ke.ck.filesoneupviewer,ke.ck.removechannelemail,ke.ck.restoreteam,ke.ck.schoolteams,ke.ck.sharedchanneldenyinvitation,ke.ck.sharedchanneldeclinejoinrequestdialog,ke.ck.sharewithteamyouowndialog,ke.ck.sharedchannelcreateinvitationsdialog,ke.ck.sharedchannelspendinginvites,ke.ck.showformemberdialogv2,ke.ck.staleteamsdialog,ke.ck.staleteamsdismiss,ke.ck.leaveteam,ke.ck.crossteamanalytics,ke.ck.teamslist,ke.ck.teamanalytics,ke.ck.teammembers,ke.ck.teamchannels,ke.ck.teamjoindialog,ke.ck.teamdiscover,ke.ck.teammanage,ke.ck.teammanageapps,ke.ck.teammanagetags,ke.ck.teampendingrequests,ke.ck.teamserrordialog,ke.ck.teamsettings,ke.ck.useronboardingteam,ke.ck.changeteampicture,ke.ck.wiki,ke.ck.channelextensibilityapppickersidepanel,ke.ck.appenabledialog,ke.ck.channelsthreadlist].includes(a),c=[ke.SY.create,ke.SY.default,ke.SY.info,ke.SY.list,ke.SY.view],d=i&&c.includes(i),u=[ke.ck.extensions,ke.ck.guardians,ke.ck.channelcalendar,ke.ck.callablechannels,ke.ck.filesoneupviewer,ke.ck.wiki],m=o&&u.includes(o),p=[ke.SY.view,ke.SY.list],g=r&&p.includes(r);return!(!s||!l||!d&&!(g&&m))},USe=()=>!0,$Se=e=>({action:ke.SY.list,type:ke.ck.schoolteams,entityState:{flushableByLinkedEntity:!0},id:null,linkedEntity:null,options:e.options,windowOptions:null}),WSe=({layoutMode:e,entity:t,coreSettings:n,userPreferences:i,contextEntity:a})=>{if(e===Yt.Rm.focus)return null;if(t.type===ke.ck.teams&&t.action===ke.SY.create)return t;if(t.type===ke.ck.schoolteams&&(t.action===ke.SY.list||t.action===ke.SY.join))return null;const o=VSe(t,a);if(Mde({coreSettings:n,userPreferences:i})||n?.get(c.w.Host)?.isGridNavigationLayoutActive){if(t.action===ke.SY.default)return null;const e=[ke.ck.teamslist,ke.ck.sharedchannelspendinginvites,ke.ck.crossteamanalytics];if(a&&e.includes(a.type)&&a.action===ke.SY.view)return null;const n=qSe(a)??qSe(t)??o,i=zSe(a)??zSe(t),r=i&&i!==n?(0,ge.hR)({teamId:i,channelId:n}):n;return{action:ke.SY.view,type:ke.ck.schoolteams,entityState:{flushableByLinkedEntity:!0},id:r,linkedEntity:null,options:t.options,windowOptions:null}}return{action:ke.SY.list,entityState:{flushableByLinkedEntity:!0},id:o,linkedEntity:null,options:t.options,type:ke.ck.channels,windowOptions:null}},VSe=(e,t)=>{if(t&&t.action===ke.SY.view)switch(t.type){case ke.ck.channelmanage:case ke.ck.teammanage:case ke.ck.teammanageapps:case ke.ck.teamsettings:case ke.ck.teamanalytics:case ke.ck.teampendingrequests:case ke.ck.teammembers:case ke.ck.teamchannels:case ke.ck.channelapps:case ke.ck.channelmembers:case ke.ck.channelsettings:case ke.ck.channelinvitations:case ke.ck.channelanalytics:case ke.ck.channeltags:case ke.ck.teamslist:case ke.ck.crossteamanalytics:case ke.ck.sharedchannelspendinginvites:case ke.ck.extensions:return e.id;case ke.ck.teammanagetags:return e.id?.trim()?e.id:sessionStorage.manageTagsTargetThreadId}let n=e.type===ke.ck.channels&&e.action===ke.SY.view?e.id:null;if(e.type===ke.ck.teammanage&&e.action===ke.SY.view&&(n=e.id),!n)return null;const{channelId:i}=(0,d3.Ep)(n);return i},HSe=[ke.ck.teamanalytics,ke.ck.teammanage,ke.ck.teammanagetags,ke.ck.teammanageapps,ke.ck.teampendingrequests,ke.ck.teamsettings,ke.ck.teammembers,ke.ck.teamchannels],zSe=e=>{if(!e)return;if(HSe.includes(e.type))return e.id;if(e.hasOwnProperty("options")&&null!==e.options){return JSON.parse(e.options).parentTeamId}},qSe=e=>{if(e&&e.id)try{const{channelId:t}=(0,d3.Ep)(e.id);return t}catch{return}},GSe=e=>{const t=(0,d3.vf)(e);return t?.ifConvUxChannel&&t?.source===A.p.InternalDeeplink},YSe=({contextEntity:e,entity:t,coreSettings:n,userPreferences:i})=>{if(e&&e.action===ke.SY.view)switch(e.type){case ke.ck.channelmanage:case ke.ck.teammanage:case ke.ck.teammanagetags:case ke.ck.teammanageapps:case ke.ck.teamsettings:case ke.ck.teamanalytics:case ke.ck.teampendingrequests:case ke.ck.teammembers:case ke.ck.teamchannels:case ke.ck.channelapps:case ke.ck.channelmembers:case ke.ck.channelsettings:case ke.ck.channelinvitations:case ke.ck.channelanalytics:case ke.ck.channeltags:case ke.ck.teamslist:case ke.ck.crossteamanalytics:case ke.ck.sharedchannelspendinginvites:case ke.ck.useronboardingteam:return e}if(e&&t.type===ke.ck.schoolteams){const t=[ke.ck.guardians];return e.type&&t.includes(e.type)?{...e,action:ke.SY.view,type:ke.ck.extensions}:e}const a=e?.options&&(0,Py.j)(e.options);if(e?.type===ke.ck.extensions&&e.action===ke.SY.view&&a?.source===A.p.PlatformTabDeepLink&&a?.isAppTeamLevelApp&&Mde({coreSettings:n,userPreferences:i}))return e;if(t.type===ke.ck.channels&&t.action===ke.SY.default&&Mde({coreSettings:n,userPreferences:i}))return $Se(t);if(t.type===ke.ck.useronboardingteam){if((e=>e.hasOwnProperty("options"))(t)&&null!==t.options){if((t?.options&&(0,Py.j)(t.options)).hideSlotHeader)return null}}if(t.type===ke.ck.channels&&t.action===ke.SY.view&&GSe(t)){const e=(0,d3.Wo)(t),n=e?.channelId;return{...t,id:n}}return t},QSe=()=>null,JSe=({contextEntity:e,entity:t,coreSettings:n,userPreferences:i})=>{const a=[ke.ck.archiveteam,ke.ck.archivechannel,ke.ck.deleteteam,ke.ck.leaveteam,ke.ck.restoreteam,ke.ck.extensions,ke.ck.guardians,ke.ck.callablechannels,ke.ck.channelcalendar,ke.ck.channelconnectors,ke.ck.channelworkflows,ke.ck.filesoneupviewer,ke.ck.wiki,ke.ck.teammanage,ke.ck.teammanagetags,ke.ck.teammanageapps,ke.ck.teamsettings,ke.ck.teamanalytics,ke.ck.teampendingrequests,ke.ck.teammembers,ke.ck.teamchannels,ke.ck.channelemailv2,ke.ck.sharewithteamyouowndialog,ke.ck.changeteampicture,ke.ck.channelapps,ke.ck.channelmembers,ke.ck.channelmanage,ke.ck.channelsettings,ke.ck.channelinvitations,ke.ck.channeltags,ke.ck.channelanalytics,ke.ck.removechannelemail,ke.ck.teamslist,ke.ck.teamserrordialog,ke.ck.crossteamanalytics,ke.ck.sharedchannelspendinginvites,ke.ck.unarchivechannel,ke.ck.useronboardingteam];if(e?.type&&a.includes(e.type))return e;if(t.type===ke.ck.channels&&t.action===ke.SY.view){const e=(0,d3.vf)(t),n=(0,d3.Wo)(t);if(GSe(t)&&e.deepLinkId){const i=e.deepLinkId===n?.replyChainId?e.deepLinkId:void 0;return{...t,id:n?.channelId,options:(0,ge.hR)({...e,deepLinkId:i})}}}return t.type===ke.ck.channels&&t.action===ke.SY.default&&Mde({coreSettings:n,userPreferences:i})?$Se(t):t},KSe=[ke.ck.channels,ke.ck.channelcopilot,ke.ck.channelcontextualsearch,ke.ck.channelsPinnedPost,ke.ck.channelsSystemMessage,ke.ck.channelextensibilityapppickersidepanel,ke.ck.channelsthreadlist,ke.ck.channelthread],ZSe=["standard","focus"],XSe=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const o=t?.id||e.id,{channelId:r,replyChainId:s}=(0,d3.V2)(o??""),l=t?.type||e.type,d=t?.options??e.options,u=JSON.parse(d??"{}")??{},m=xpe(o,t,a,n,i);if(m)return{action:ke.SY.info,id:m.id,type:m.type,options:d};const p=a?.infoPane?.channels?"closed"===a.infoPane.channels:!!n?.get(c.w.Channels)?.disableChannelInfoPaneOpenByDefault;if(!((e,t,n,i,a,o,r)=>{const{enableChannelInfoPaneSearch:s,enableChannelInfoPane:l=!1,enableChannelCopilotInL2Header:d=!1,enableConvUXinChannels:u=!1}=i?.get(c.w.Channels)??{},{enableInfoPaneAsResponsiveMenu:m=!1}=i?.get(c.w.Core)??{},{enableExtensibilityAppPicker:p}=i?.get(c.w.Extensibility)||{};return!(!(e&&ZSe.includes(a)&&KSe.includes(t))||(!s||r!==A.p.ChannelContextualSearch&&n?.type!==ke.ck.channelcontextualsearch)&&(!d||n?.type!==ke.ck.channelcopilot)&&(!p||n?.type!==ke.ck.channelextensibilityapppickersidepanel)&&n?.type!==ke.ck.channelsthreadlist&&n?.type!==ke.ck.channelthread&&(!u||t!==ke.ck.channels||r!==A.p.InternalDeeplink)&&(o||!l||!m))})(o,l,t,n,i,p,u.source)&&!u.channelCopilotOpen&&!GSe(e))return null;const{enableChannelInfoPaneSearch:g}=n?.get(c.w.Channels)??{};if(u.source===A.p.ChannelContextualSearch)return{id:o,action:ke.SY.info,type:ke.ck.channelcontextualsearch};const h=efe(t||e);if(h)return h;if(t?.type===ke.ck.channelcopilot||u.channelCopilotOpen)return{id:o,action:ke.SY.info,type:ke.ck.channelcopilot};if(t?.type===ke.ck.channelsthreadlist)return{id:r,action:ke.SY.info,type:ke.ck.channelsthreadlist};if(t?.type===ke.ck.channelextensibilityapppickersidepanel)return{id:o,action:ke.SY.info,type:ke.ck.channelextensibilityapppickersidepanel};if(s&&(!g||t?.type!==ke.ck.channelcontextualsearch)&&t?.type!==ke.ck.channelthread)return null;const v=tfe({contextEntity:t,enableChannelInfoPaneSearch:!!g});return v||{id:(0,ge.hR)({channelId:r}),action:ke.SY.info,type:ke.ck.channels}},efe=e=>{const t=e.id,n=e?.type,i=e?.action;if(n===ke.ck.channels&&i===ke.SY.view&&GSe(e)){const n=(0,d3.Wo)(e),i=(0,d3.vf)(e),a=i?.deepLinkId;if(a!==n?.replyChainId)return{id:t,action:ke.SY.info,type:ke.ck.channelthread,options:e.options,entityState:{flushableByLinkedEntity:!0},windowOptions:null,linkedEntity:null}}return null},tfe=({contextEntity:e,enableChannelInfoPaneSearch:t})=>{if(e){const{action:n,type:i}=e;if(n===ke.SY.info&&nfe(i,!!t))return e;if(i!==ke.ck.channels)return null}return null},nfe=(e,t)=>{switch(e){case ke.ck.channelsPinnedPost:case ke.ck.channelsSystemMessage:case ke.ck.channelthread:return!0;case ke.ck.channelcontextualsearch:return t;default:return!1}},ife="72rem",afe="41rem",ofe="32rem",rfe="484px",sfe=e=>{const t=e&&e.options&&(0,Py.j)(e.options);return e?.type===ke.ck.channelthread&&t?.source===A.p.HeadlineSlice?new Map([[fZ.cw.IS_GREATER_THAN_0,"0"],[fZ.cw.IS_AT_LEAST_947,ofe],[fZ.cw.IS_AT_LEAST_1280,ofe],[fZ.cw.IS_AT_LEAST_1350,afe],[fZ.cw.IS_AT_LEAST_1500,afe],[fZ.cw.IS_AT_LEAST_1680,rfe],[fZ.cw.IS_AT_LEAST_2048,rfe],[fZ.cw.IS_AT_LEAST_2560,ife],[fZ.cw.IS_AT_LEAST_3840,ife]]):void 0},lfe=({areEmptySlotsTransparent:e,coreSettings:t,entity:n})=>({endEntity:{[se.w.Rail]:{slotWidthOverrides:sfe(n),isHideInfoPaneDisabled:n?.type===ke.ck.channelcontextualsearch}},mainEntity:{[se.w.Main]:{isBackgroundTransparent:!!t?.get(c.w.Channels).enableMicaBackgroundForChannelPane||e}},headerEntity:{[se.w.HorizontalBar]:{isBackgroundTransparent:!!t?.get(c.w.Channels).enableMicaBackgroundForChannelPane||e,isColorSchemeDefaultBackground4:!e}},subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e}}}),cfe=(e,t,n)=>{const{userPreferences:i,coreSettings:a,layoutMode:o}=t;if(e?.endEntity?.type!==ke.ck.channelsthreadlist&&e?.endEntity?.type!==ke.ck.channelthread||(e.endEntity=null),n){const e=n.mainEntity;if(e&&"options"in e&&e.options&&e.id)try{const t=JSON.parse(e.options),{channelId:n,replyChainId:r}=(0,d3.Ep)(e.id);if(t&&r&&n&&t.source===A.p.ChannelPostMessage)return jSe({contextEntity:null,coreSettings:a,entity:{id:n,type:ke.ck.channels,action:ke.SY.view,options:JSON.stringify({deepLinkId:r,source:A.p.ChannelL2NavigateViaHistory})},layoutMode:o,userPreferences:i})}catch{return}}const{enableSimpleCollabUpdateHistoryNavigation:r}=a?.get(c.w.SimpleCollab,["enableSimpleCollabUpdateHistoryNavigation"])??{enableSimpleCollabUpdateHistoryNavigation:!1};if(r){const t=i?.simpleCollab?.simpleCollabViewType;let n=e?.subNavEntity?.type;switch(t){case"unified":n=ke.ck.simplecollab;break;case"split":n=ke.ck.simplecollabchannels;break;case"none":n=ke.ck.channels;break;default:return}if(n!==e?.subNavEntity?.type)return(0,Pj.Kw)(e,{type:n,action:ke.SY.list},"subNavEntity")}},dfe=[ke.ck.teammanage,ke.ck.teammembers,ke.ck.teamchannels,ke.ck.teampendingrequests,ke.ck.teammanagetags],ufe=[ke.ck.channelapps,ke.ck.channelmanage,ke.ck.channelmembers,ke.ck.channelinvitations],mfe=[ke.ck.sharedchannelspendinginvites],pfe=({action:e,appRenderMode:t,coreSettings:n,type:i,logger:a})=>{const o=new qz.D,{enableComposeCriticalPhaseLoad:r=!1,enableComposeCriticalPhaseLoadForPopout:s=!1,enableComposeCriticalPhaseLoadSecondaryViewport:l=!1,enableComposeCriticalPhaseLoadSecondaryViewportGate:d=!1}=n.get(c.w.Messaging),{enableHybridChannelList:u=!1,msgEnableChannelsV2:p=!1,msgEnableChannelsV2Header:g=!1}=n.get(c.w.Host),{channelPhaseTimeoutSettings:h}=n.get(c.w.TeamsAndChannels),v=[],y=[];switch(t){case se.w.HorizontalBar:gfe({action:e,type:i,logger:a,criticalSignals:v,featureFlags:{msgEnableChannelsV2Header:g,msgEnableChannelsV2:p},postCriticalSignals:y});break;case se.w.Main:hfe({action:e,type:i,logger:a,criticalSignals:v,featureFlags:{enableComposeCriticalPhaseLoad:r,enableComposeCriticalPhaseLoadForPopout:s,enableComposeCriticalPhaseLoadSecondaryViewport:l,enableComposeCriticalPhaseLoadSecondaryViewportGate:d,msgEnableChannelsV2:p},postCriticalSignals:y});break;case se.w.Rail:vfe({action:e,criticalSignals:v,featureFlags:{enableHybridChannelList:u},postCriticalSignals:y,type:i})}return o.registerAppPhase({phase:m.Jj.CRITICAL,signals:v,timeout:h?.critical||25e3}),o.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:y,timeout:h?.postCritical||1e4}),o.appPhases},gfe=({action:e,criticalSignals:t,featureFlags:{msgEnableChannelsV2Header:n,msgEnableChannelsV2:i},type:a,logger:o})=>{a===ke.ck.schoolteams&&e===ke.SY.list?t.push(Gz.m.TEAMS_GRID_VIEW_HEADER_RENDERED):i&&n&&a===ke.ck.channels&&(e===ke.SY.default||e===ke.SY.view)?t.push(Gz.m.CHANNEL_HEADER_RENDERED):a&&dfe.includes(a)?t.push(Gz.m.TEAM_DASHBOARD_HEADER_RENDERED):a&&ufe.includes(a)?t.push(Gz.m.CHANNEL_DASHBOARD_HEADER_RENDERED):a&&mfe.includes(a)?t.push(Gz.m.TEAMS_DASHBOARD_HEADER_RENDERED):a===ke.ck.useronboardingteam?t.push(Gz.m.USER_ONBOARDING_HEADER_RENDERED):o?.log(`Not adding header slot phase signals for action: ${e}, type: ${a}, msgEnableChannelsV2: ${i}, msgEnableChannelsV2Header: ${n}`)},hfe=({action:e,criticalSignals:t,featureFlags:{enableComposeCriticalPhaseLoad:n,enableComposeCriticalPhaseLoadForPopout:i,enableComposeCriticalPhaseLoadSecondaryViewport:a,enableComposeCriticalPhaseLoadSecondaryViewportGate:o,msgEnableChannelsV2:r},postCriticalSignals:s,type:l,logger:c})=>{if(l===ke.ck.schoolteams&&e===ke.SY.list)t.push(Gz.m.TEAMS_GRID_VIEW_RENDERED);else if(!r||l!==ke.ck.channels||e!==ke.SY.default&&e!==ke.SY.view)l&&dfe.includes(l)?t.push(Gz.m.TEAM_DASHBOARD_VIEW_RENDERED):l&&ufe.includes(l)?t.push(Gz.m.CHANNEL_DASHBOARD_VIEW_RENDERED):l&&mfe.includes(l)?t.push(Gz.m.TEAMS_DASHBOARD_VIEW_RENDERED):l===ke.ck.useronboardingteam?t.push(Gz.m.USER_ONBOARDING_TO_TEAM_VIEW_RENDERED):c?.log(`Not adding main slot phase signals for action: ${e}, type: ${l}, msgEnableChannelsV2: ${r}`);else{t.push(Gz.m.MESSAGES_RENDERED);n||i&&o&&a?t.push(Gz.m.COMPOSE_LOADED):s.push(Gz.m.COMPOSE_LOADED),s.push(Gz.m.MESSAGE_REACTIONS_RENDERED,Gz.m.PRESENCES_RENDERED,Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED)}},vfe=({action:e,criticalSignals:t,postCriticalSignals:n,featureFlags:{enableHybridChannelList:i},type:a})=>{a===ke.ck.channels&&e===ke.SY.list?i&&t.push(Gz.m.CHANNEL_LIST_ITEMS_RENDERED):a===ke.ck.schoolteams&&e===ke.SY.view?t.push(Gz.m.SINGLE_TEAM_VIEW_LEFT_RAIL_LOADED):a===ke.ck.channelthread&&e===ke.SY.info&&(t.push(Gz.m.MESSAGES_RENDERED,Gz.m.COMPOSE_LOADED),n.push(Gz.m.MESSAGE_REACTIONS_RENDERED,Gz.m.PRESENCES_RENDERED,Gz.m.VIRTUAL_LIST_RENDER_BUFFER_FILLED))},yfe={id:"com.microsoft.teams.teamsAndChannels",name:"TeamsAndChannelsApp",getLocalizedName:async e=>(await e.waitForNamespace("teamsAndChannels"),e.stringTranslate("teamsAndChannels","teams_and_channels_app_name")),actors:[ul],supportedEntities:[ke.ck.acceptsharedchannelinvitationdialog,ke.ck.addmembertoprivatechanneldialog,ke.ck.addmembertoteamdialog,ke.ck.archiveteam,ke.ck.archivechannel,ke.ck.channelapps,ke.ck.channelanalytics,ke.ck.channelconnectors,ke.ck.channelcopilot,ke.ck.channelworkflows,ke.ck.channelemailerror,ke.ck.channelemailv2,ke.ck.channelmanage,ke.ck.channelmembers,ke.ck.channels,ke.ck.channelsPinnedPost,ke.ck.channelsSystemMessage,ke.ck.channelcontextualsearch,ke.ck.channelsettings,ke.ck.channelinvitations,ke.ck.channeltags,ke.ck.channeljoindialog,ke.ck.channelthread,ke.ck.connectorinstanceconfiguration,ke.ck.createchanneldialog,ke.ck.createchannelleftraildialog,ke.ck.crosspostchannelselectiondialog,ke.ck.crosspostchannelselectiondialogV2,ke.ck.crosspostdeletedialog,ke.ck.defaultchannelnavdialog,ke.ck.deletechannelreactdialog,ke.ck.deleteteam,ke.ck.leaveteam,ke.ck.showhidegeneralchannelwarningdialog,ke.ck.restoreteam,ke.ck.leavechanneldialog,ke.ck.leavechannellastownerdialog,ke.ck.pinunpinpost,ke.ck.getlinktoteamorchanneldialog,ke.ck.removechannelemail,ke.ck.restorechannelreactdialog,ke.ck.schoolteams,ke.ck.sharedchanneldenyinvitation,ke.ck.sharedchanneldeclinejoinrequestdialog,ke.ck.sharewithteamyouowndialog,ke.ck.sharedchannelcreateinvitationsdialog,ke.ck.sharedchannelspendinginvites,ke.ck.sharechannelwithuserdialog,ke.ck.showformemberdialogv2,ke.ck.stopsharingchannelwithteamreactdialog,ke.ck.showchannelownersreactdialog,ke.ck.crossteamanalytics,ke.ck.teammembers,ke.ck.teamchannels,ke.ck.teamcreatedialog,ke.ck.teamdiscover,ke.ck.teamjoindialog,ke.ck.teammanage,ke.ck.teammanageapps,ke.ck.teammanagetags,ke.ck.teampendingrequests,ke.ck.teamserrordialog,ke.ck.teamsettings,ke.ck.changeteampicture,ke.ck.teamanalytics,ke.ck.teamslist,ke.ck.channelnotificationsettings,ke.ck.stalechannelsadhocdialog,ke.ck.staleteamsdialog,ke.ck.staleteamsdismiss,ke.ck.unarchivechannel,ke.ck.useronboardingteam,ke.ck.channelextensibilityapppickersidepanel,ke.ck.channelsthreadlist,ke.ck.appenabledialog],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail,se.w.Modal],getDefaultCommand:e=>{const{enableHybridChannelList:t,msgEnableChannelsV2:n}=e.get(c.w.Host);if(t&&n)return{type:ke.ck.channels,action:ke.SY.default}},windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125},infoPaneStateMapping:{[ke.ck.channelsSystemMessage]:ke.ck.channels,[ke.ck.channelsPinnedPost]:ke.ck.channels},getAllowUserWindowingPreference:({coreSettings:e})=>!!e.get(c.w.Channels).enableChannelDeeplinkWindowUserPreference},Sfe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"channelName"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"discardDuringMeetingsAndCalls"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"reaction"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderMri"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"replyChainId"}},{kind:"Field",name:{kind:"Name",value:"tagName"}},{kind:"Field",name:{kind:"Name",value:"isThreadMessage"}}]}}]}}]};var ffe,kfe;!function(e){e.Follow="Follow",e.Mention="Mention",e.Reaction="Reaction",e.Reply="Reply",e.ReplyToReply="ReplyToReply",e.TeamMembershipChange="TeamMembershipChange",e.DLP="DLP"}(ffe||(ffe={})),function(e){e.Person="Person",e.Team="Team",e.AddedToSharedChannel="AddedToSharedChannel",e.TeamShareTeamOwnerNotify="TeamShareTeamOwnerNotify",e.PromotedToSharedChannelOwner="PromotedToSharedChannelOwner",e.ChannelOwnerUnshareTeamOwnerNotify="ChannelOwnerUnshareTeamOwnerNotify",e.TeamOwnerUnshareChannelOwnerNotify="TeamOwnerUnshareChannelOwnerNotify",e.NotifySender="NotifySender",e.Tag="Tag",e.ChannelNewMessage="ChannelNewMessage",e.ChannelReplyMessage="ChannelReplyMessage"}(kfe||(kfe={}));const Cfe="toastNotifications",bfe="new_channel_post_toast_header",wfe="channel_new_message_toast_header",Tfe="channel_reply_message_toast_header",Ife="channel_reaction_toast_header",Nfe="channel_reply_toast_header",Afe="channel_reply_to_reply_toast_header",Efe="channel_mention_team_toast_header",Ffe="channel_mention_person_toast_header",_fe="channel_mention_tag_toast_header",Dfe="shared_channel_shared_with_a_user_header",Pfe="shared_channel_sharing_stopped_by_owner_header",Mfe="shared_channel_shared_with_a_team_header",Rfe="shared_channel_sharing_stopped_by_team_owner_header",xfe="shared_channel_role_promotion_header",Lfe="dlp_notify_sender_header",Ofe="channel_reaction_toast_header_thread",jfe="channel_reply_message_toast_header_thread",Bfe="channel_reply_toast_header_thread",Ufe="channel_reply_to_reply_toast_header_thread",$fe="channel_mention_team_toast_header_thread",Wfe="channel_mention_person_toast_header_thread",Vfe="channel_mention_tag_toast_header_thread",Hfe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},zfe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}}]}}]},qfe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]};async function Gfe(e,t,n,i){try{const a=await async function(e,t,n){const{data:i}=await e.query({query:zfe,variables:{userId:t},context:{callerInfo:"toast-event-subscription-job"}});if(i.user&&i.user.avatarUrl)return i.user.avatarUrl;const{data:a}=await e.query({query:Hfe,variables:{userId:t,displayName:n,profilePictureSize:d6.xi.Small}});return a.msaUserProfilePicture}(e,n,i);if(!a)return void t.error($t.n.ImageUrlGenerationFailed);if(a.startsWith("blob:"))return a;if((0,b4.D$)(a)){const t=await(0,w4.z)(e,a,"Url",!0);return t.result?.blob}{const t=await e.query({query:qfe,variables:{url:a}});return t?.data.toastImageAsDataUri||void 0}}catch(e){return void t.error($t.n.ImageFetchFailed)}}const Yfe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchEmoticons"},arguments:[{kind:"Argument",name:{kind:"Name",value:"searchFilter"},value:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}}},{kind:"Argument",name:{kind:"Name",value:"exactMatch"},value:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}}},{kind:"Argument",name:{kind:"Name",value:"includeShortCuts"},value:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}}},{kind:"Argument",name:{kind:"Name",value:"includeKeywords"},value:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}}},{kind:"Argument",name:{kind:"Name",value:"maxResultCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}}},{kind:"Argument",name:{kind:"Name",value:"categoryId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Emoticon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"unicode"}},{kind:"Field",name:{kind:"Name",value:"animation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment_animation"}}]}},{kind:"Field",name:{kind:"Name",value:"etag"}},{kind:"Field",name:{kind:"Name",value:"diverse"}},{kind:"Field",name:{kind:"Name",value:"shortcuts"}},{kind:"Field",name:{kind:"Name",value:"searchMatch"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment_animation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmoticonAnimation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fps"}},{kind:"Field",name:{kind:"Name",value:"framesCount"}},{kind:"Field",name:{kind:"Name",value:"firstFrame"}}]}}]}.definitions]}.definitions]},Qfe={[ffe.Follow]:{[kfe.ChannelNewMessage]:wfe,[kfe.ChannelReplyMessage]:Tfe,default:bfe},[ffe.Reply]:{default:Nfe},[ffe.ReplyToReply]:{default:Afe},[ffe.Mention]:{[kfe.Tag]:_fe,[kfe.Person]:Ffe,default:Efe},[ffe.Reaction]:{default:Ife},[ffe.DLP]:{default:Lfe},[ffe.TeamMembershipChange]:{[kfe.AddedToSharedChannel]:Dfe,[kfe.ChannelOwnerUnshareTeamOwnerNotify]:Pfe,[kfe.PromotedToSharedChannelOwner]:xfe,[kfe.TeamOwnerUnshareChannelOwnerNotify]:Rfe,[kfe.TeamShareTeamOwnerNotify]:Mfe,default:""}},Jfe={[ffe.Follow]:{[kfe.ChannelReplyMessage]:jfe,default:""},[ffe.Reply]:{default:Bfe},[ffe.ReplyToReply]:{default:Ufe},[ffe.Mention]:{[kfe.Tag]:Vfe,[kfe.Person]:Wfe,default:$fe},[ffe.Reaction]:{default:Ofe}};function Kfe(e,t,n){if(!n[e])return"";const i=n[e];return t&&i[t]?i[t]:i.default}async function Zfe({reaction:e,channelName:t,teamName:n,type:i,subtype:a,senderDisplayName:o,senderGivenName:r,tagName:s,isThreadMessage:l},c,d,u){const m=o||r;if(!m&&i!==ffe.DLP)return"";if(i===ffe.Mention&&!a)return"";if(i===ffe.Reaction&&!e)return"";const p={channelName:t,senderDisplayName:m,teamName:n,tagName:s};let g;if(i===ffe.Reaction){const t=await async function(e,t,n){try{const{id:t}=(0,k4.lj)(n?.toLocaleLowerCase().trim());if(!t)return;const{data:i}=await e.query({query:Yfe,variables:{searchFilter:t,exactMatch:!0}});return(i?.searchEmoticons||[])[0]}catch(e){return void t.error($t.n.ChannelToastEmoticonsQueryFailed)}}(d,u,e);g=t?.unicode||void 0,p.emoji=g}let h="";return l&&(h=Kfe(i,a,Jfe)),h||(h=Kfe(i,a,Qfe)),h?function(e,{emoji:t,channelName:n,teamName:i,senderDisplayName:a,tagName:o},r){return r.stringTranslate(Cfe,e,{channelName:n,emoji:t,senderDisplayName:a,teamName:i,tagName:o})}(h,p,c):""}async function Xfe(e,t,n,i){const{conversationId:a,messageId:o,startTimestamp:r,replyChainId:s,teamName:l,channelName:c,senderMri:d,senderDisplayName:u,text:m}=e,p=e.type===ffe.DLP?y4.T:await Gfe(n,i,d,u||""),g=await Zfe(e,t,n,i),h=m||function(e,t,n,i){switch(e.subtype){case kfe.ChannelOwnerUnshareTeamOwnerNotify:return i.stringTranslate("toastNotifications","shared_channel_owner_unshare_team_owner_notify_text",{teamName:t});case kfe.TeamOwnerUnshareChannelOwnerNotify:return i.stringTranslate("toastNotifications","shared_channel_team_owner_unshare_channel_owner_notify_text",{channelName:n});case kfe.NotifySender:return i.stringTranslate("toastNotifications","dlp_notification_notify_sender_text",{teamName:t,channelName:n});default:return i.stringTranslate("toastNotifications","channel_toasts_text",{teamName:t,channelName:n})}}(e,l,c,t);return{conversationId:a,quickReply:!1,discardDuringMeetingsAndCalls:!!e.discardDuringMeetingsAndCalls,messageId:o,time:new Date(+r),replyChainId:s||"",text:h,title:g,mainImage:p?{alt:"",src:p}:void 0}}function eke(e,t){const n=e.newScenario(be.Cu.CrossClientToastView);n.appendEventData({mainEntityType:ke.ck.channels}),n.fail(t)}function tke(e,t,n,i,a,o,r,s){const{enableCommandToHostCommService:l}=t.get(c.w.Core,["enableCommandToHostCommService"]),{enableChannelsNotifications:d,enableBrowserToasts:u,enableInAppNotifications:m,enableInAppNotificationsForChatsAndChannels:p}=t.get(c.w.Notifications,["enableChannelsNotifications","enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"channel-toast-event-subscription",runOncePerId:!0,job:async()=>{const g=i.newLogger("ChannelToastEventSubscription","apps-teams-and-channels");l||u||m&&p?d?(g.log(`${$t.n.Subscribing}: subscribing to channel toasts resolver`),n.subscribe({query:Sfe,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a,o,r,s){const{enableToastCollections:l}=t.get(c.w.Notifications);return async t=>{if(t.errors){const e=(0,ge.hR)(t.errors.map((e=>e.message)).join());return n.error(`${$t.n.SubscriptionFailed} ${e}`),void eke(i,{errorCode:$t.n.SubscriptionFailed,errors:e})}const c=t.data?.channelToastEvent;if(!c)return n.error($t.n.EmptyEvent),void eke(i,{errorCode:$t.n.EmptyEvent});const d=i.newScenario(be.Cu.CrossClientToastView,{startTime:+c.startTimestamp});d.clientId=c.correlationId,d.appendEventData({mainEntityType:ke.ck.channels,mainEntitySubtype:c.type,isThreadMessage:!!c.isThreadMessage});const u=await Xfe(c,a,r,n);if(!u.title)return n.error(`${$t.n.UnhandledType}: Dropping channel toast with type ${c.type}`),void d.incomplete({reason:$t.n.UnhandledType});l&&(u.collectionId=(0,cB.pP)(e,s,n)),i.hoistScenarioToCore?.(d),o.toasts.showChannelsNotification(c.correlationId,u),d.mark(be.BQ.CrossClientEntityCommandTriggered),n.log(`${$t.n.ToastCommandSent} type:${c.type} correlationId:${c.correlationId}`)}}(e,t,g,a,o,r,n,s))):g.log(`${$t.n.NotEnabled}: channel notifications are off`):g.log($t.n.NotEnabled)}}}const nke=({context:{authenticationUser:e,client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,i18n:o,entityCommanding:r,userTrackingService:s}})=>[tke(e,n,t,i,a,o,r,s)],ike=async({commandInput:e,requestContext:{clientPreferences:t,coreSettings:n,executionContext:i,loggerFactory:a}})=>{const{command:o,command:{action:r,data:s}}=e,l=a.newLogger("TeamsAndChannelsApp onCommandReceived","apps-teams-and-channels");if(e.command.actor===ul)switch(r){case ml:return i.isHandlingAppActiveApp&&Mde({coreSettings:n,userPreferences:t})?{entity:{type:ke.ck.schoolteams,action:ke.SY.list},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.SchoolTeams}}}:{entity:{type:ke.ck.channels,action:ke.SY.default},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flush,correlation:{source:A.p.Unknown}}};case pl:{const{channelId:e,teamId:t,commandSource:n,back:i,isHidden:a,expandCompose:o}=s;return{command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:n||A.p.UserOnboardingTeam}},entity:{id:JSON.stringify({channelId:e,teamId:t}),action:ke.SY.view,type:ke.ck.channels},entityOptions:{back:!!i,hiddenChannel:a,parentTeamId:t,expandCompose:!!o}}}case gl:{const{teamId:e,commandSource:t,selectedItemId:n,hideSlotHeader:i,pinned:a}=s;return{command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:t||A.p.UserOnboardingTeam}},entity:{id:JSON.stringify({teamId:e}),action:ke.SY.view,type:ke.ck.useronboardingteam},entityOptions:{selectedItemId:n,parentTeamId:e?.endsWith("#")?e.slice(0,-1):e,hideSlotHeader:i,pinned:a}}}case hl:return function(e){const{teamId:t,channelId:n,channelName:i,displayName:a,groupId:o,teamName:r,channelResourceTenantId:s,commandSource:l}=e,c={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:l||A.p.ChannelActions}},d={action:ke.SY.view,type:ke.ck.getlinktoteamorchanneldialog};return{command:c,entity:d,entityOptions:{selectedChannelId:n,linkType:"Channel",teamId:t,groupId:o,displayName:a,teamName:r,channelName:i,channelResourceTenantId:s}}}(s);case Dl:return oke(s);case vl:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}},a={id:t,action:ke.SY.view,type:ke.ck.channelemailv2};return{command:i,entity:a,entityOptions:{isEventingCall:!0,channelId:t}}}(s);case yl:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},o={id:t,action:ke.SY.view,type:ke.ck.channelmembers,linkedEntity:{id:t,type:ke.ck.channels,action:ke.SY.list}};return{command:a,entity:o,entityOptions:{parentTeamId:n}}}(s);case Sl:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:ke.SY.view,type:ke.ck.teammanage,linkedEntity:{id:t||"",type:ke.ck.channels,action:ke.SY.list}},a={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}};return{command:a,entity:i,entityOptions:{parentTeamId:t}}}(s);case fl:return function(e){const{teamId:t,channelId:n,teamName:i,channelName:a,isLastOwner:o,groupId:r,channelOnlyMember:s,commandSource:l}=e,c=o?ke.ck.leavechannellastownerdialog:ke.ck.leavechanneldialog,d={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:l||A.p.ChannelActions}},u={action:ke.SY.view,type:c};return{command:d,entity:u,entityOptions:{isEventingCall:!0,channelName:a,channelId:n,teamId:t,teamName:i,isLastOwner:o,groupId:r,channelOnlyMember:s}}}(s);case kl:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},o={id:t,action:ke.SY.view,type:ke.ck.channelmanage,linkedEntity:{id:t,type:ke.ck.channels,action:ke.SY.list}};return{command:a,entity:o,entityOptions:{parentTeamId:n}}}(s);case Cl:return function(e){const{teamId:t,channelId:n,commandSource:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},o={id:n,action:ke.SY.view,type:ke.ck.addmembertoprivatechanneldialog};return{command:a,entity:o,entityOptions:{parentTeamId:t}}}(s);case bl:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}},a={id:t,action:ke.SY.view,type:ke.ck.sharechannelwithuserdialog};return{command:i,entity:a}}(s);case wl:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:i||A.p.ChannelActions}},o={id:t,action:ke.SY.view,type:ke.ck.sharedchannelcreateinvitationsdialog,linkedEntity:{id:t,type:ke.ck.channels,action:ke.SY.list}};return{command:a,entity:o,entityOptions:{channelId:t,teamId:n}}}(s);case Tl:return function(e){const{channelId:t,channelName:n,teamName:i,commandSource:a}=e,o={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:a||A.p.ChannelActions}},r={id:t,action:ke.SY.view,type:ke.ck.channelnotificationsettings},s={commandSource:a||A.p.ChannelActions,teamName:i,channelName:n};return{command:o,entity:r,entityOptions:s}}(s);case Il:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:ke.SY.view,type:ke.ck.teammembers,linkedEntity:{id:t||"",type:ke.ck.channels,action:ke.SY.list}},a={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}};return{command:a,entity:i}}(s);case Nl:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:ke.SY.view,type:ke.ck.teamchannels,linkedEntity:{id:t||"",type:ke.ck.channels,action:ke.SY.list}},a={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:n||A.p.ChannelActions}};return{command:a,entity:i,entityOptions:{back:!0}}}(s);case Al:case El:case Fl:case _l:return ake(o,i.viewEntities.endEntity?.id,i.viewEntities.endEntity?.type);case Pl:return function(e){const{teamId:t}=e,n={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},i={id:t,action:ke.SY.view,type:ke.ck.addmembertoteamdialog};return{command:n,entity:i,entityOptions:{isViewFromSimpleCollab:!1}}}(s);case Ml:return function(e){const{teamId:t,groupId:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ExtensionCommanding}},a={action:ke.SY.view,type:ke.ck.createchanneldialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!1,teamId:t,groupId:n,entryPoint:"TeamContextMenu"}}}(s);case Rl:return function(e){const{teamId:t,commandSource:n}=e,i={stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:n||A.p.ManageTeams}},a={id:t,action:ke.SY.view,type:ke.ck.teammanagetags};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!1}}}(s);case xl:return function(e){const{teamId:t,groupId:n,teamName:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ManageTeams}},o={id:t,action:ke.SY.view,type:ke.ck.leaveteam};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!1,teamName:i,groupId:n,teamThreadId:t}}}(s);case Ll:return function(e){const{teamId:t,teamName:n}=e,i={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ManageTeams}},a={id:t,action:ke.SY.view,type:ke.ck.simplecollabhideallchannelsdialog};return{command:i,entity:a,entityOptions:{teamName:n,teamId:t}}}(s);case Ol:return function(e){const{teamId:t,displayName:n,groupId:i,teamName:a,channelResourceTenantId:o}=e,r={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.GetLinkToTeamMenuButton}},s={action:ke.SY.view,type:ke.ck.getlinktoteamorchanneldialog};return{command:r,entity:s,entityOptions:{isViewFromSimpleCollab:!1,selectedChannelId:t,linkType:"Team",teamId:t,groupId:i,displayName:n,teamName:a,channelResourceTenantId:o}}}(s);case jl:return function(e){const{teamId:t,teamName:n,groupId:i}=e,a={stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.ManageTeams}},o={id:t,action:ke.SY.view,type:ke.ck.deleteteam};return{command:a,entity:o,entityOptions:{teamName:n,groupId:i,threadId:t,isViewFromSimpleCollab:!1}}}(s);default:l.error(`Command action '${r}' is not supported at TeamsAndChannelsApp.`)}else l.error(`Command for actor '${e.command.actor}' cannot be handled by TeamsAndChannelsApp.`)};const ake=async(e,t,n)=>{if(mc(e)&&e.data){const{convId:i,commandSource:a}=e.data,o=t&&n===ke.ck.channelthread&&a===A.p.ToggleThreadListPane,r=o?t:i,s=o?n:ke.ck.channelsthreadlist;return{command:ee.toggleEndRail({id:r,type:s,action:ke.SY.info,source:a,showOption:"toggle",shouldPersistState:!0})}}if(pc(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i,showBackButton:a}=e.data;return{command:ee.toggleEndRail({id:JSON.stringify({channelId:t,replyChainId:n}),type:ke.ck.channelthread,action:ke.SY.info,entityOptions:{showBackButton:a},source:i,showOption:"show",shouldPersistState:!0})}}if(gc(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i}=e.data;return{command:ee.toggleEndRail({id:JSON.stringify({channelId:t,replyChainId:n}),type:ke.ck.channelthread,action:ke.SY.info,source:i,showOption:"hide",shouldPersistState:!0})}}if(hc(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i}=e.data;return{entity:{id:JSON.stringify({channelId:t,replyChainId:n}),type:ke.ck.channels,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:i}}}}},oke=async e=>{const{teamId:t,groupId:n}=e;return{command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.TrinityChannelsTab}},entity:{action:ke.SY.view,type:ke.ck.createchanneldialog},entityOptions:{isViewFromSimpleCollab:!1,teamId:t,groupId:n,entryPoint:"TeamContextMenu"}}};const rke=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(984165),n.e(616161),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(736709),n.e(306517),n.e(216284),n.e(636192),n.e(964401),n.e(231020),n.e(811751),n.e(405198),n.e(393706),n.e(568721),n.e(524147),n.e(79981),n.e(258832),n.e(431784),n.e(964859),n.e(817556),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(354130),n.e(122814),n.e(102216),n.e(300954),n.e(194894),n.e(286993),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(862449),n.e(57789),n.e(739085),n.e(721630),n.e(867826),n.e(346069),n.e(46438),n.e(187739),n.e(92464),n.e(131961),n.e(79899),n.e(249917),n.e(20275),n.e(392982),n.e(187257),n.e(164734),n.e(56538),n.e(655224),n.e(849095),n.e(677912),n.e(145619),n.e(597272),n.e(831554),n.e(899628),n.e(496740),n.e(328452),n.e(20504),n.e(373760),n.e(814583),n.e(882633),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(784980),n.e(563678),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(75416),n.e(664960),n.e(174155),n.e(6419),n.e(873621),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(53131),n.e(214467),n.e(813370),n.e(478723),n.e(311576),n.e(679354),n.e(736704),n.e(397928),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(892960),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(214445),n.e(460976),n.e(708241),n.e(568202),n.e(875113),n.e(478040),n.e(391700),n.e(672666),n.e(240991),n.e(366328),n.e(328231),n.e(566999),n.e(391),n.e(25522),n.e(465160),n.e(400003),n.e(602692),n.e(879803),n.e(868389),n.e(361035),n.e(768173),n.e(310015),n.e(189542),n.e(569243),n.e(171868),n.e(275243),n.e(800350),n.e(216843),n.e(104945),n.e(233794),n.e(40823),n.e(746071),n.e(515758),n.e(944191),n.e(543766),n.e(707334),n.e(428434),n.e(528699),n.e(91961),n.e(388107),n.e(676629),n.e(499675),n.e(514403),n.e(644258),n.e(755399),n.e(572067),n.e(314122),n.e(857787),n.e(643059),n.e(865317),n.e(654917),n.e(84122)]).then(n.bind(n,769444)),ske=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(669152),n.e(842242),n.e(459959),n.e(984165),n.e(616161),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(736709),n.e(306517),n.e(216284),n.e(636192),n.e(964401),n.e(231020),n.e(811751),n.e(405198),n.e(393706),n.e(568721),n.e(524147),n.e(79981),n.e(258832),n.e(431784),n.e(964859),n.e(817556),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(354130),n.e(122814),n.e(102216),n.e(300954),n.e(194894),n.e(286993),n.e(915633),n.e(967653),n.e(289657),n.e(787389),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(862449),n.e(57789),n.e(739085),n.e(721630),n.e(867826),n.e(346069),n.e(46438),n.e(187739),n.e(92464),n.e(131961),n.e(79899),n.e(249917),n.e(20275),n.e(392982),n.e(187257),n.e(164734),n.e(56538),n.e(655224),n.e(849095),n.e(677912),n.e(145619),n.e(597272),n.e(831554),n.e(899628),n.e(496740),n.e(328452),n.e(20504),n.e(373760),n.e(814583),n.e(882633),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(712284),n.e(784980),n.e(563678),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(75416),n.e(664960),n.e(174155),n.e(6419),n.e(873621),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(927129),n.e(834558),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(53131),n.e(214467),n.e(813370),n.e(478723),n.e(311576),n.e(679354),n.e(736704),n.e(397928),n.e(463675),n.e(577607),n.e(108698),n.e(288919),n.e(615002),n.e(343201),n.e(836301),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(892960),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(214445),n.e(460976),n.e(708241),n.e(568202),n.e(875113),n.e(478040),n.e(391700),n.e(672666),n.e(240991),n.e(366328),n.e(328231),n.e(566999),n.e(391),n.e(25522),n.e(465160),n.e(400003),n.e(602692),n.e(879803),n.e(868389),n.e(361035),n.e(768173),n.e(310015),n.e(189542),n.e(569243),n.e(171868),n.e(275243),n.e(800350),n.e(216843),n.e(104945),n.e(233794),n.e(40823),n.e(746071),n.e(515758),n.e(944191),n.e(543766),n.e(707334),n.e(428434),n.e(528699),n.e(91961),n.e(388107),n.e(676629),n.e(499675),n.e(514403),n.e(644258),n.e(755399),n.e(572067),n.e(314122),n.e(857787),n.e(643059),n.e(865317),n.e(654917),n.e(84122)]).then(n.bind(n,819867)),lke=({coreServices:e,host:t,screenState:n,windowOptions:i,prevEntityType:a})=>{if(a===ke.ck.channels)return null;const{height:o,minHeight:r,minWidth:s,offset:l,width:d}=yfe.windowFeatures||{},u=t?.screenX||0,m=t?.screenY||0,p=(n?.numOpenWindows||1)*(l||1);return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},height:o,left:u+p,minHeight:r,minWidth:s,top:m+p,width:d,...yfe.windowFeatures,...e?.coreSettings.get(c.w.Core).enableRatioToScreenBasedSizing&&cke(t,yfe.windowFeatures),...i}};function cke(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}function dke(){return{eventHandlers:Gye,getAppPhases:pfe,getAppViewEntities:jSe,getAppViewEntitiesProps:lfe,getAppWindowFeatures:lke,getCommandScenarioName:(e,t,n,i)=>{const{entity:a,command:o}=e,r=Mde({coreSettings:n,userPreferences:i?.getAllPreferences()});if(a.type===ke.ck.channels&&(a.action===ke.SY.view||a.action===ke.SY.default)&&o.visibilityState===g.Rp.show&&(e=>e.stateTransition===g.Ar.flush||e.stateTransition===g.Ar.forceFlush||e.stateTransition===g.Ar.new)(o)){const e=a.id?(0,d3.Ep)(a.id,t):void 0;if(e)return o.stateTransition===g.Ar.new?e.replyChainId?r?be.Cu.SingleTeamViewChannelSwitchL2Popout:be.Cu.ChannelSwitchL2Popout:void 0:r?e.replyChainId?be.Cu.SingleTeamViewChannelSwitchL2:be.Cu.SingleTeamViewChannelSwitchL1:e.replyChainId?be.Cu.ChannelSwitchL2:be.Cu.ChannelSwitchL1;if(a.action===ke.SY.default)return r?be.Cu.TeamsGridLoad:be.Cu.ChannelSwitchL1}return a.type===ke.ck.schoolteams&&a.action===ke.SY.list?be.Cu.TeamsGridLoad:a.type===ke.ck.channelcontextualsearch&&a.action===ke.SY.info&&o.visibilityState!==g.Rp.hide?be.Cu.ContextualSearchStart:a.type===ke.ck.useronboardingteam&&a.action===ke.SY.view?be.Cu.TeamsSeeAllChannelsSwitch:void 0},getEventScenarioData:Qye,getPlatformAppIdForEntity:e=>e.type===ke.ck.channels||e.type===ke.ck.schoolteams?"2a84919f-59d8-4441-a975-2a8c2643b741":void 0,onBeforeAddToNavigation:bSe,onBeforeCommandHandled:NSe,onBeforeNavigationFromHistory:cfe,manifest:yfe,onBeforeDeeplinkParsed:CSe,render:async({appRenderMode:e,coreSettings:t,onRenderEvent:n,scenarioFactory:i})=>{const a="teams-and-channels-app";n("ChunkLoadStarted",{chunkName:a});const{enableEntityMoreInfo:o}=t.get(c.w.Core),r=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),s=o?r:wJ.CA,{TeamsAndChannelsViewsRenderer:l}=await(0,ev.wg)(rke,a,i),{LPC:d}=o?{LPC:r}:await(0,ev.wg)(ske,a,i);return n("ChunkLoadSucceeded",{chunkName:a}),(0,Lr.Y)(d,{children:(0,Lr.Y)(s,{children:(0,Lr.Y)(d8.L1,{children:(0,Lr.Y)(l,{appRenderMode:e,coreSettings:t})})})})},onCommandReceived:ike,onPreWarm:nke,sidePaneCallbacks:{getSidePaneState:Mpe,setSidePaneState:Rpe}}}const uke={id:"com.microsoft.teams.tfl-consent",name:"TFLConsentApp",supportedEntities:[ke.ck.tflfre],supportedRenderModes:[se.w.Main],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}};var mke=n(596889);const pke={shouldAddEntitiesToWindowHistory:e=>e?.mainEntity?.type!==ke.ck.tflfre,shouldRestoreClientToEntities:e=>e?.mainEntity?.type!==ke.ck.tflfre},gke=e=>{if(hke(e))return vke(e)?{subNavEntity:yke(e),headerEntity:Ske(e),startEntity:fke(e),mainEntity:kke(e),endEntity:Cke(e)}:null},hke=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.tflfre].includes(i),r=[ke.SY.default,ke.SY.view,ke.SY.update],s=n&&r.includes(n);return!!(a&&o&&s)},vke=()=>!0,yke=()=>null,Ske=()=>null,fke=()=>null,kke=({entity:e})=>e,Cke=()=>null,bke=({entity:e})=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:"minimal"===e?.id}}}),wke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTflConsentGetEspStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"displayed"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayedTimestamps"}}]}}]}}]}}]},Tke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTflConsentGetPinStatusQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"canPinTeamsToTaskbar"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isPinningAllowedForNonTrampolinedConsumer"}},{kind:"Field",name:{kind:"Name",value:"isPinningAllowedForTrampolinedConsumer"}}]}}]}}]},Ike="tfl_convergence_uninstall_t2_job";function Nke(e,t,n,i){const{enableTflConvergenceUninstallT2:a}=t.get(c.w.Onboarding,["enableTflConvergenceUninstallT2"]);return{id:"tfl-convergence-uninstall-t2-job",runOncePerId:!0,job:async()=>{if(!a)return;const t=n.newLogger("TflConvergenceUninstallT2Job","apps-tfl-consent");try{const{data:n}=await e.query({query:wke});t?.infoToTelemetry?.("Received ESP state data",Ike,void 0,!0);let a=!1;const o=n?.espState.displayed;for(const e of o)if("pinTrampolinedTeamsModalForConsumer"===e.id){if(a=!0,e.displayedTimestamps.length<3)return void t?.infoToTelemetry?.(`ESP modal with ID 'pinTrampolinedTeamsModalForConsumer' has displayed ${e.displayedTimestamps.length} times`,Ike,void 0,!0);t?.infoToTelemetry?.("ESP modal with ID 'pinTrampolinedTeamsModalForConsumer' has displayed at least 3 times. Start uninstalling T2",Ike,void 0,!0);break}if(!a)return void t?.infoToTelemetry?.("ESP modal with ID 'pinTrampolinedTeamsModalForConsumer' has displayed 0 times",Ike,void 0,!0);const r=await i.loadModule("taskbar");if(!r||!r.tryUninstallLegacyApp)return void t.warn("Taskbar HostComms API unavailable");const{data:s}=await e.query({query:Tke,fetchPolicy:"no-cache"}),{canPinTeamsToTaskbar:l}=s??{};if(!!!l?.isPinningAllowedForNonTrampolinedConsumer&&!!!l?.isPinningAllowedForTrampolinedConsumer)return void t?.infoToTelemetry?.("Don't uninstall T2 since isPinningAllowedForNonTrampolinedConsumer=false and isPinningAllowedForTrampolinedConsumer=false",Ike,void 0,!0);r.tryUninstallLegacyApp()}catch(e){const n=(0,Je.rX)(e);t?.errorToTelemetry?.(`Failed to complete job to uninstall T2. Error: ${n}`,Ike,void 0,!0)}}}}const Ake=({context:{client:e,coreSettings:t,loggerFactory:n,hostCommunicationService:i}})=>[Nke(e,t,n,i)],Eke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsTflConsentSetTflUserMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setCurrentUserIsTFLUser"}}]}}]},Fke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTflConsentGetUserPreferencesQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"maglev"}},{kind:"Field",name:{kind:"Name",value:"WebNorthStar"}}]}}]}}]}}]},_ke=async(e,t,n)=>(e.report({correlationId:t.entityCommand.command.correlation.id,type:Ua.Mk.UserConsentedToConsumeResources,userContextId:(0,kt.Lw)(n),context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),{overrideType:ER.NoOverride}),Dke=()=>Promise.all([n.e(258832),n.e(598562),n.e(115856)]).then(n.bind(n,285357)),Pke=()=>null,Mke="TflSignInFlyoutDisplayed",Rke=()=>be.Cu.TFLConsentLaunch,xke=(e,t,n)=>({overrideType:ER.OverrideIntent,intent:{...e,entityCommand:{...e.entityCommand,entity:{id:e.entityCommand.command.layoutMode,type:t,action:n}}}});function Lke(){const e={filter:"*",execute:async({intent:e,context:{client:t,authenticatedUser:n,localStorage:i,coreSettings:a,experienceChangeReportingService:o,loggerFactory:r,scenarioFactory:s}})=>{const{enableIsTflUserApiCall:l}=a.get(c.w.Growth),{enableDelayedConsent:d}=a.get(c.w.Flyout);if(l&&(0,pH.xA)(n)&&n.type===pg.aS.MsaLife&&t.mutate({mutation:Eke}),!e.shouldRenderContent)return{overrideType:ER.NoOverride};if((0,pH.yL)(n,a,i))return _ke(o,e,n);const u=(0,pH.xA)(n)&&await(async(e,t,n,i)=>{const a=n.newLogger("canSkipConsentUsingFirstLoginInformation","apps-tfl-consent"),{skipConsentByFirstLoginMinDate:o}=e.get(c.w.Onboarding);if(a.infoToTelemetry?.(`Checking if we can skip consent using first login information. Flags: ${JSON.stringify({skipConsentByFirstLoginMinDate:o})}`,"can_skip_consent_using_first_login_information",void 0,!0),!o)return a.infoToTelemetry?.("Skipping canSkipConsentUsingFirstLoginInformation because of flag values","can_skip_consent_using_first_login_information",void 0,!0),!1;const r=i.newScenario(be.Cu.CanSkipConsentUsingFirstLoginInformation);try{const{data:e,error:n}=await t.query({query:Fke});if(n)throw r.appendEventData({errorMessage:"Failure in the GraphQL query"}),n;const i=e.userPreferences?.firstLoginInformation;if(!i)return r.cancel({reason:"'firstLoginInformation' is not present in the response"}),!1;const s=new Date(o);return a.log(`First login information: ${JSON.stringify(i)}`),i.maglev&&new Date(i.maglev)>s?(r.stop({reason:"Consent was given on maglev"}),!0):i.WebNorthStar&&new Date(i.WebNorthStar)>s?(r.stop({reason:"Consent was given on WebNorthStar"}),!0):(r.stop({reason:"Consent was not given on any checked client"}),!1)}catch(e){return r.fail(),a.log(`Error in canSkipConsentUsingFirstLoginInformation: ${(0,Je.BA)(e)}`),!1}})(a,t,r,s);return u?(i.set(Qt.yq,"true","Growth"),_ke(o,e,n)):((e,t)=>"true"!==e.get(Mke)&&t.entityCommand.command.layoutMode===Yt.Rm.minimal)(i,e)?xke(e,ke.ck.identity,ke.SY.signin):((e=>{e.set(Mke,"true","Growth")})(i),d&&(e.entityCommand.command.layoutMode===Yt.Rm.minimal||e.entityCommand.command.layoutMode===Yt.Rm.minimode)?xke(e,ke.ck.flyout,ke.SY.update):xke(e,ke.ck.tflfre,ke.SY.default))}};return{getCommandScenarioName:Rke,manifest:uke,onAfterIntentAuthenticated:e,onBeforeAddToNavigation:pke,render:async({appRenderMode:e,loggerFactory:t,onRenderEvent:n,scenarioFactory:i,entity:a,coreSettings:o})=>{if(e===se.w.Main){const e=t.newLogger("TflConsentApp","apps-tfl-consent"),r="tfl-consent-app",{action:s,type:l}=a,{isFlyoutChat:d}=o.get(c.w.Flyout),u=a.type===ke.ck.flyout||d||false,m=s===ke.SY.update||!u;e.log(`entity action:${s} type:${l}`),e.log("coreSettings type "+typeof o),n("ChunkLoadStarted",{chunkName:r});const{TflFreUserProfile:p}=await(0,ev.wg)(Dke,r,i);return n("ChunkLoadSucceeded",{chunkName:r}),e.log("render: loading tfl consent app"),(0,Lr.Y)(mke.H,{namespaces:["tflOnboarding","auth"],children:(0,Lr.Y)(p,{isFlyout:u,allowEdit:m})})}return(0,Lr.Y)(Pke,{})},getAppViewEntities:gke,getAppViewEntitiesProps:bke,onExperienceLongIdle:Ake}}const Oke={id:"com.microsoft.teams.virtual-events",name:"VirtualEventsApp",supportedEntities:[ke.ck.virtualevents],supportedRenderModes:[se.w.Main,se.w.Modal,se.w.HorizontalBar],windowFeatures:{minWidth:1241,width:1241,minHeight:720,height:720}},jke=e=>{if(Bke(e))return Uke(e)?{subNavEntity:$ke(e),headerEntity:Wke(e),startEntity:Vke(e),mainEntity:Hke(e),endEntity:zke(e)}:null},Bke=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.virtualevents].includes(i),r=[ke.SY.default,ke.SY.view,ke.SY.create,ke.SY.list],s=n&&r.includes(n);return!!(a&&o&&s)},Uke=()=>!0,$ke=()=>null,Wke=({entity:e})=>e,Vke=()=>null,Hke=({entity:e})=>e,zke=()=>null,qke=()=>({headerEntity:{[se.w.HorizontalBar]:{slotHeightOverrides:"6.1rem"}}});var Gke;!function(e){e.Webinar="Webinar",e.Townhall="Townhall",e.Conference="Conference"}(Gke||(Gke={}));var Yke;!function(e){e.virtualEventCreate="/l/virtualevent/new",e.virtualEvent="/l/virtualevent",e.virtualEventDuplicate="/l/virtualevent/duplicate"}(Yke||(Yke={}));const Qke={Conference:Gke.Conference,Townhall:Gke.Townhall,Webinar:Gke.Webinar},Jke={filter:Yke.virtualEventCreate,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("VirtualEventsApp onBeforeDeeplinkParsed","apps-virtual-events"),{pathname:i,search:a}=e;n.log(`Parsing deeplinkUrl - pathname: ${i}, search: ${a}`);const o=new URLSearchParams(a),r=o.get("eventType"),s=o.get("source"),l=o.get("startTime"),c=o.get("endTime");return r&&Qke[r]?Promise.resolve({entityCommand:{entity:{type:ke.ck.virtualevents,action:ke.SY.create},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualEventsOnBeforeDeeplinkParsed}},entityOptions:{eventType:Qke[r],source:s??"Teams",startTime:l,endTime:c}},metadata:{allowAnonymous:!1}}):Promise.resolve(void 0)}},Kke={filter:Yke.virtualEvent,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("VirtualEventsApp onBeforeDeeplinkParsed","apps-virtual-events"),{pathname:i}=e;n.log(`Parsing deeplinkUrl - pathname: ${i}`);const a=i.split("/")[3];return Promise.resolve({entityCommand:{entity:{type:ke.ck.virtualevents,action:ke.SY.view,id:a},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.new,correlation:{source:A.p.VirtualEventsOnBeforeDeeplinkParsed}}},metadata:{allowAnonymous:!1}})}},Zke=[Jke,{filter:Yke.virtualEventDuplicate,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("VirtualEventsApp onBeforeDeeplinkParsed","apps-virtual-events"),{pathname:i}=e;n.log(`Parsing deeplinkUrl - pathname: ${i}`);const a=i.split("/")[4];return Promise.resolve({entityCommand:{entity:{type:ke.ck.virtualevents,action:ke.SY.create},command:{stateTransition:g.Ar.new,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualEventsOnBeforeDeeplinkParsed}},entityOptions:{eventId:a,shouldDuplicateEvent:!0}},metadata:{allowAnonymous:!1}})}},Kke],Xke={onEventReceived:async({requestContext:{loggerFactory:e},eventInput:{event:{originator:t,type:n},source:i}})=>{const a=e.newLogger("onEventReceived","apps-virtual-events");if(t===BY.Nv)return eCe(n,i);a.error(`Event from originator '${t}' cannot be handled by VirtualEventsApp.`)}},eCe=(e,t)=>{if(e===BY.mu.createBroadcastEvent)return{command:TY(),source:t}},tCe=({prevEntityType:e})=>e===ke.ck.virtualevents?null:Oke.windowFeatures,nCe=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(914945),n.e(461500),n.e(490329),n.e(311914),n.e(598188),n.e(725973),n.e(842242),n.e(459959),n.e(616161),n.e(185332),n.e(255544),n.e(729849),n.e(484331),n.e(867529),n.e(736709),n.e(306517),n.e(231020),n.e(568721),n.e(258832),n.e(475896),n.e(628320),n.e(102216),n.e(613193),n.e(92198),n.e(836070),n.e(906930),n.e(170798),n.e(585280),n.e(187739),n.e(683932),n.e(892415),n.e(56538),n.e(7024),n.e(382218),n.e(315308),n.e(273558),n.e(867345),n.e(864774),n.e(700879),n.e(971402),n.e(924752),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(712284),n.e(151748),n.e(370494),n.e(449827),n.e(239470),n.e(681848),n.e(348623),n.e(155583),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(265816),n.e(327091),n.e(552331),n.e(331703),n.e(214467),n.e(708241),n.e(337595),n.e(835167),n.e(191448),n.e(363392),n.e(385971),n.e(824059),n.e(350422),n.e(935685),n.e(75887),n.e(387912),n.e(257394),n.e(33536)]).then(n.bind(n,215630));const iCe={id:"com.microsoft.teams.virtual-consumer-events",name:"VirtualConsumerEventsApp",actors:[ns],supportedEntities:[ke.ck.virtualconsumerevents],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Modal,se.w.Rail]},aCe={onEventReceived:async({requestContext:{loggerFactory:e,phaseStateMachine:t},eventInput:{event:{originator:n,type:i,data:a},source:o}})=>{const r=e.newLogger("onEventReceived","apps-communities-on-event-received");switch(n){case s3.Nv:return rCe(r,i,a,o);case"Sidecars":const e=oCe(i);return void(t&&e&&t.fireSignals({signals:[e],fireAfterLayoutAndPaint:!0}));default:return void r.error(`Event from originator '${n}' cannot be handled by VirtualConsumerEventsApp.`)}}},oCe=e=>{switch(e){case"loadMeetingLinks":return Gz.m.MEETING_LINK_CARD_RENDERED;case"loadUpcomingEvents":return Gz.m.UPCOMING_EVENT_CARD_RENDERED;default:return}},rCe=(e,t,n,i)=>{if(t===s3.mu.closeViewVirtualConsumerEvent)return{command:us(),source:i};if(!n)return void e.error(`Event data is missing for event type '${t}'.`);const a=n();switch(t){case s3.mu.createVirtualConsumerEvent:return(0,s3.Yv)(a)?{command:ms(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);case s3.mu.deleteVirtualConsumerEvent:return(0,s3.x8)(a)?{command:ps(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);case s3.mu.editVirtualConsumerEvent:return(0,s3.OE)(a)?{command:gs(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);case s3.mu.joinVirtualConsumerEvent:return(0,s3.Er)(a)?{command:hs(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);case s3.mu.shareVirtualConsumerEvent:return(0,s3.xl)(a)?{command:vs(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);case s3.mu.viewVirtualConsumerEvent:return(0,s3.Jj)(a)?{command:ys(a),source:i}:void e.error(`Event data is invalid for event type '${t}'.`);default:return void e.error(`Event type '${t}' is not supported by VirtualConsumerEventsApp.`)}},sCe=({entity:e})=>"view"===e.action?e:null,lCe=()=>null,cCe=({entity:e})=>e,dCe=({entity:e})=>"view"===e.action?e:null,uCe={eventHandlers:aCe,getCommandScenarioName:e=>{const{entity:t}=e;if(t.type===ke.ck.virtualconsumerevents)switch(t.action){case ke.SY.create:return be.Cu.VirtualConsumerEventsCreateEvent;case ke.SY.update:return be.Cu.VirtualConsumerEventsEditEvent;case ke.SY.share:return be.Cu.VirtualConsumerEventsShareEvent;case ke.SY.delete:return be.Cu.VirtualConsumerEventsDeleteEvent;case ke.SY.list:return be.Cu.VirtualConsumerEventsAppSwitch;default:return}},onCommandReceived:async({requestContext:{loggerFactory:e},commandInput:{command:{actor:t,action:n,data:i}}})=>{const a=e.newLogger("onCommandReceived","apps-virtual-consumer-events-on-command-received");if(t===ns)switch(n){case is:return{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.view},command:{stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.hide,correlation:{source:A.p.VirtualConsumerEvents}}};case as:return(e=>"object"==typeof e&&!!e&&"communityId"in e)(i)?{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.create},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualConsumerEvents}},entityOptions:{communityId:i.communityId}}:void a.error(`Command data is invalid for command '${n}'.`);case os:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.delete},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case rs:return(e=>"object"==typeof e&&!!e&&"eventId"in e&&"isMainSeriesEvent"in e&&"communityId"in e)(i)?{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.update},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId,isMainSeriesEvent:i.isMainSeriesEvent,communityId:i.communityId}}:void a.error(`Command data is invalid for command '${n}'.`);case ss:return(e=>"object"==typeof e&&!!e&&"joinLink"in e&&"title"in e)(i)?{entity:{type:ke.ck.meetings,action:ke.SY.join},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualConsumerEvents}},entityOptions:{callingIntent:{type:"Meeting",joinOptions:{meeting:{showPrejoin:!0,title:i.title,isPSTN:!1},context:"VirtualConsumerEvents"},coordinates:{meetingData:{meetingUrl:i.joinLink}}}}}:void a.error(`Command data is invalid for command '${n}'.`);case ls:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.share},command:{stateTransition:g.Ar.extend,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case cs:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.view},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case ds:return{entity:{type:ke.ck.virtualconsumerevents,action:ke.SY.list},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.forceFlush,correlation:{source:A.p.Unknown}}};default:return void a.error(`Command action '${n}' is not supported by VirtualConsumerEventsApp.`)}a.error(`Command for actor '${t}' cannot be handled by VirtualConsumerEventsApp.`)},getPlatformAppIdForEntity:e=>[ke.ck.virtualconsumerevents].includes(e.type)?C3.Z.virtualConsumerEvents:void 0,getAppViewEntities:e=>({headerEntity:sCe(e),subNavEntity:lCe(e),mainEntity:cCe(e),endEntity:dCe(e)}),getAppViewEntitiesProps:({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e,isWideSubNav:!!t?.get(c.w.MercuryDesign).enableMercuryDesign}},mainEntity:{[se.w.Main]:{isColorSchemeDefaultBackground2:!0}}})},mCe=({appRenderMode:e,type:t})=>{const n=new qz.D,i=[];if(e===se.w.Main)t===ke.ck.virtualconsumerevents&&i.push(Gz.m.MEETING_LINK_CARD_RENDERED,Gz.m.UPCOMING_EVENT_CARD_RENDERED);return n.registerAppPhase({phase:m.Jj.CRITICAL,signals:i,timeout:25e3}),n.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:1e4}),n.appPhases},pCe=()=>Promise.all([n.e(912845),n.e(224316),n.e(416397),n.e(120951),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(598188),n.e(725973),n.e(842242),n.e(459959),n.e(255544),n.e(487867),n.e(215618),n.e(867529),n.e(811751),n.e(628320),n.e(613193),n.e(836070),n.e(906930),n.e(170798),n.e(585280),n.e(466152),n.e(968775),n.e(568385),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(972751),n.e(921389),n.e(638918),n.e(151748),n.e(370494),n.e(777944),n.e(544228),n.e(954779),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(337595),n.e(385971),n.e(518135)]).then(n.bind(n,362453));const gCe=e=>{if(hCe(e))return vCe(e)?{subNavEntity:yCe(e),headerEntity:SCe(e),startEntity:fCe(e),mainEntity:kCe(e),endEntity:CCe(e)}:null},hCe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.registration].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},vCe=()=>!0,yCe=()=>null,SCe=()=>null,fCe=()=>null,kCe=({entity:e})=>e,CCe=()=>null,bCe={getDefaultCommand:()=>({type:ke.ck.registration,action:ke.SY.view}),id:"com.microsoft.teams.webinar-registration",name:"WebinarRegistrationApp",supportedRenderModes:[se.w.Main],supportedEntities:[ke.ck.registration],windowFeatures:{minWidth:1140,width:1140,minHeight:720,height:720}},wCe=()=>Promise.all([n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(169767),n.e(914945),n.e(461500),n.e(490329),n.e(598188),n.e(725973),n.e(459959),n.e(616161),n.e(255544),n.e(484331),n.e(867529),n.e(524147),n.e(258832),n.e(940543),n.e(296930),n.e(628320),n.e(613193),n.e(92198),n.e(836070),n.e(906930),n.e(170798),n.e(585280),n.e(683932),n.e(5982),n.e(353927),n.e(892415),n.e(598200),n.e(785043),n.e(648855),n.e(382218),n.e(954e3),n.e(951958),n.e(779876),n.e(325645),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(151748),n.e(370494),n.e(221963),n.e(681848),n.e(468570),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(214467),n.e(337595),n.e(634370),n.e(935685),n.e(906489)]).then(n.bind(n,969544)),TCe=()=>bCe.windowFeatures||{};function ICe(){const e=()=>null;return{getAppViewEntities:gCe,getAppWindowFeatures:TCe,manifest:bCe,render:async({appRenderMode:t})=>{if(t===se.w.Main){const e="webinar-registration-app",{WebinarRegistrationViewsRenderer:t}=await(0,ev.wg)(wCe,e);return(0,Lr.Y)(vG.e,{namespaces:["compose","webinar"],loaderRenderer:null,children:(0,Lr.Y)(t,{})})}return(0,Lr.Y)(e,{})}}}const NCe={id:"com.microsoft.teams.guardians",name:"GuardiansApp",supportedEntities:[ke.ck.guardians,ke.ck.guardiansapprovalrequest,ke.ck.guardianssendapprovalsuccess,ke.ck.guardianssendapprovalerror],supportedRenderModes:[se.w.HorizontalBar,se.w.Main,se.w.Rail,se.w.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},ACe=e=>{if(ECe(e))return FCe(e)?{subNavEntity:_Ce(e),headerEntity:DCe(e),startEntity:PCe(e),mainEntity:MCe(e),endEntity:RCe(e)}:null},ECe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.guardians].includes(i),r=[ke.SY.list],s=n&&r.includes(n);return!!(a&&o&&s)},FCe=()=>!0,_Ce=({entity:e,layoutMode:t})=>t===Yt.Rm.focus?null:e,DCe=({entity:e})=>e,PCe=()=>null,MCe=({entity:e})=>e,RCe=()=>null,xCe={onEventReceived:({eventInput:e})=>{if(e.event.type===uq.mu.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:vq(t)})}return Promise.resolve(void 0)}},LCe=({appRenderMode:e})=>{const t=new qz.D,n=[],i=[];switch(e){case se.w.Main:OCe({criticalSignals:n,postCriticalSignals:i,featureFlags:{}});case se.w.HorizontalBar:case se.w.Rail:}return t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:3e4}),t.appPhases},OCe=({criticalSignals:e})=>{e.push(Gz.m.GUARDIANS_APP_RENDERED)};var jCe=n(786554),BCe=n(635158);const UCe=(0,iG.O)({guardiansApprovalRequestDialogSurface:{Beyfa6y:0,Bbmb7ep:0,Btl43ni:0,B7oj6ja:0,Dimara:"fwbpcpn",a9b677:"f177j64f"},showDialogBody:{Bqenvij:"f1j8dsdc"},showGuardiansApprovalRequestFormLabel:{jrapky:"f1jlhsmd",Be2twd7:"fses1vf"},showGuardiansApprovalRequestFormInput:{B6of3ja:"fvjh0tl"},showAddNewParentButton:{sj55zd:"f16muhyy",uwmqm3:["f1asdtw4","fifp7yv"],B6of3ja:"f1xdg43u",Dyrjrp:"f1cqwcg4"},rightActionButton:{B6of3ja:"f1xdg43u"},showGuardiansAvatarAndArrowIcon:{uwmqm3:["f1asdtw4","fifp7yv"],z189sj:["fifp7yv","f1asdtw4"],sshi5w:"f1y4q817"},showItemLayout:{Frg6f3:["ff9s3yw","f1phki43"],t21cq0:["f1phki43","ff9s3yw"]},isParentAvatar:{Bf4jedk:"ff9fk16",Frg6f3:["f9yszdx","fibjyge"]},showArrowIcon:{z189sj:["fifp7yv","f1asdtw4"]},showParentDisplayName:{Bf4jedk:"ff9fk16",sj55zd:"fkfq4zb",Be2twd7:"fses1vf",B80ckks:"fmd4ok8",Bhrd7zp:"f71fsbu",Bg96gwp:"f1n95isl"},alignAvatarAndArrowIcon:{a9b677:"fly5x3f"},showDialogDivider:{B6of3ja:"f2zxqi",jrapky:"febqm8h"},showDialogDividerForList:{B6of3ja:"f2zxqi"},parentInputFieldError:{Bgfg5da:0,B9xav0g:0,oivjwe:0,Bn0qgzm:0,B4g9neb:0,zhjwy3:0,wvpqe5:0,ibv6hh:0,u1mtju:0,h3c5rm:0,vrafjx:0,Bekrc4i:0,i8vvqc:0,g2u3we:0,icvyot:0,B4j52fo:0,irswps:"ft74l40"},showErrorMsg:{B6of3ja:"f4gg0ds",sj55zd:"f1hcrxcs"},showFormView:{B6of3ja:"f18og1rn"},spinner:{B6of3ja:"f1uinfot"},disableGridItem:{sj55zd:"f1s2aq7o",Bkecrkj:"f1aehjj5"},showDialogSubHeader:{B6of3ja:"f2zxqi",jrapky:"febqm8h",Bhrd7zp:"f71fsbu",Be2twd7:"fses1vf"}}),$Ce=({errorCode:e})=>{const[t,n]=Or.useState(!0),i=(0,JX.PO)(),a=e===d.O4.GatewayTimeout?i.stringTranslate("guardians","guardians_approval_request_timeout_error_dialog_title"):i.stringTranslate("guardians","guardians_approval_request_generic_error_dialog_title"),o=e===d.O4.GatewayTimeout?i.stringTranslate("guardians","guardians_approval_request_timeout_error_dialog_content"):i.stringTranslate("guardians","guardians_approval_request_generic_error_dialog_content"),r=UCe(),s=Or.useCallback((()=>{n(!1)}),[n]),l=Or.useCallback((e=>{"Escape"!==e.key&&"Esc"!==e.key||s()}),[s]);return(0,Lr.Y)(Qq.l,{open:t,"data-tid":"guardians-send-approval-error-dialog-renderer",children:(0,Lr.Y)(Jq.E,{onKeyDown:l,className:r.guardiansApprovalRequestDialogSurface,"data-tid":"guardians-send-approval-error-dialog-renderer-surface",children:(0,Lr.Y)(Kq.R,{children:[(0,Lr.Y)(Zq.L,{children:a}),(0,Lr.Y)(Xq.C,{children:(0,Lr.Y)(BCe.D,{children:o})}),(0,Lr.Y)(eG.i,{position:"end",children:(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"outline","data-tid":"guardians-approval-request-error-dialog-close-button",className:r.rightActionButton,onClick:s,children:i.stringTranslate("guardians","guardians_approval_request_dialog_close_button")})})})]})})})};var WCe=n(795631),VCe=n(483851),HCe=n(786394),zCe=n(526521),qCe=n(338933),GCe=n(183200),YCe=n(785294);const QCe=({relatedContacts:e,onClickSaveButtonHandler:t,onClickBackButtonHandler:n,isSaveButtonEnabled:i})=>{const a=(0,JX.PO)();return(0,Lr.Y)(Or.Fragment,{children:[e.length>0&&(0,Lr.Y)(eG.i,{position:"start",children:(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"subtle",icon:(0,Lr.Y)(DX.JGc,{filled:!0,fontSize:GCe.f.large}),onClick:n,"data-tid":"guardians-approval-request-dialog-back-button",children:a.stringTranslate("guardians","guardians_approval_request_dialog_back_button")})})}),(0,Lr.Y)(eG.i,{position:"end",children:(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"primary",size:"medium",onClick:t,disabled:!i,"data-tid":"guardians-approval-request-dialog-save-button",children:a.stringTranslate("guardians","guardians_approval_request_dialog_save_button")})})})]})};var JCe=n(249456),KCe=n(930891);const ZCe=/[@#$%^&*()_:"=<>[\]{};?\/|~\\]/,XCe=async(e,t,n)=>{const{displayNameErr:i}=((e,t)=>{let n;return Boolean(""!==e?.trim())?e.length>256?n=t.stringTranslate("guardians","guardians_name_max_length_field_error"):ZCe.test(e)&&(n=t.stringTranslate("guardians","guardians_name_special_characters_error")):n=t.stringTranslate("guardians","guardians_name_required_field_error"),{displayNameErr:n}})(t.displayName,n),a=e.emailAddress?.trim()===t.emailAddress?.trim(),{emailAddressErr:o}=((e,t,n)=>{let i;const a=Boolean(""!==e?.trim());if(a||(i=n.stringTranslate("guardians","guardians_email_required_field_error")),!t){const t=(0,KCe.B)(e);a&&!t&&(i=n.stringTranslate("guardians","guardians_email_format_field_error"))}return{emailAddressErr:i}})(t.emailAddress,a,n),r=e.mobilePhone?.trim()===t.mobilePhone?.trim(),{mobilePhoneErr:s}=await(async(e,t,n)=>{let i;if(!t){const t=Boolean(""!==e?.trim()),a=await JCe.g.tryParse(e),o=a&&e===a.toString();t&&!o&&(i=n.stringTranslate("guardians","guardians_phone_format_field_error"))}return{mobilePhoneErr:i}})(t.mobilePhone,r,n);return{displayNameErr:i,emailAddressErr:o,mobilePhoneErr:s}};var ebe=n(639188);const tbe={displayName:"",emailAddress:"",mobilePhone:""},nbe=({relatedContacts:e,parentRowSelected:t,setDialogViewMode:n,setRelatedContacts:i})=>{const a=(0,JX.PO)(),o=UCe(),[r,s]=Or.useState(tbe),[l,c]=Or.useState({displayNameErr:void 0,emailAddressErr:void 0,mobilePhoneErr:void 0}),d=-1!==t?e[t]:tbe,u=((e,t)=>Object.keys(t).some((n=>{const i=e?.[n],a=t?.[n];return"string"==typeof i&&"string"==typeof a&&i.trim()!==a.trim()})))(d,r),{handleParentInputChange:m}=((e,t)=>({handleParentInputChange:Or.useCallback((n=>{const{name:i,value:a}=n.target;e((e=>({...e,[i]:a}))),t((e=>({...e,[`${i}Err`]:void 0})))}),[t,e])}))(s,c),p=Or.useCallback((()=>{n(YCe._.List)}),[n]),g=Or.useCallback((async()=>{const{displayNameErr:e,emailAddressErr:o,mobilePhoneErr:s}=await XCe(d,r,a);c((t=>({...t,displayNameErr:e,emailAddressErr:o,mobilePhoneErr:s})));!e&&!o&&!s&&(n(YCe._.List),i((e=>{const n=[...e||[]];return-1!==t?n[t]=r:n.push(r),n})))}),[n,i,t,r,d,a]);Or.useEffect((()=>{-1!==t&&s({...e[t]})}),[t,e]);const h=(0,ebe.Dy)("focus-first-input-field"),v=Or.useRef(!0),y=(0,ebe.S1)();return Or.useEffect((()=>{v.current&&(y.requestFocus("focus-first-input-field"),v.current=!1)}),[y]),(0,Lr.Y)(Or.Fragment,{children:[(0,Lr.Y)(Xq.C,{children:[(0,Lr.Y)(WCe.c,{className:o.showDialogDivider}),(0,Lr.Y)(TX.s,{column:!0,className:o.showFormView,children:[(0,Lr.Y)(TX.s,{column:!0,className:o.showGuardiansApprovalRequestFormLabel,children:[(0,Lr.Y)(VCe.J,{id:"nameLabel",required:!0,children:a.stringTranslate("guardians","guardians_approval_request_dialog_parent_name_label")}),(0,Lr.Y)(HCe.p,{type:"text",name:"displayName",ref:h,value:r.displayName||"",onChange:m,className:o.showGuardiansApprovalRequestFormInput,"aria-labelledby":"nameLabel","aria-required":"true"}),(0,Lr.Y)(BCe.D,{size:"small",className:o.showErrorMsg,"aria-live":"polite","aria-atomic":"true","aria-relevant":"all",error:!0,children:l.displayNameErr&&(0,Lr.Y)(TX.s,{vAlign:"center",children:[(0,Lr.Y)(DX.pO8,{filled:!0,fontSize:GCe.f.medium}),l.displayNameErr]})})]}),(0,Lr.Y)(TX.s,{column:!0,className:o.showGuardiansApprovalRequestFormLabel,children:[(0,Lr.Y)(VCe.J,{id:"emailLabel",required:!0,children:a.stringTranslate("guardians","guardians_approval_request_dialog_parent_email_label")}),(0,Lr.Y)(HCe.p,{type:"text",name:"emailAddress",value:r.emailAddress||"",onChange:m,className:(0,zCe.z)(o.showGuardiansApprovalRequestFormInput,l.emailAddressErr&&o.parentInputFieldError),"aria-labelledby":"emailLabel","aria-required":"true"}),(0,Lr.Y)(BCe.D,{size:"small",className:o.showErrorMsg,"aria-live":"polite","aria-atomic":"true","aria-relevant":"all",error:!0,children:l.emailAddressErr&&(0,Lr.Y)(TX.s,{vAlign:"center",children:[(0,Lr.Y)(DX.pO8,{filled:!0,fontSize:GCe.f.medium}),l.emailAddressErr]})})]}),(0,Lr.Y)(TX.s,{column:!0,className:o.showGuardiansApprovalRequestFormLabel,children:[(0,Lr.Y)(qCe.$,{id:"phoneLabel",info:{children:a.stringTranslate("guardians","guardians_approval_request_dialog_phone_tooltip")},children:a.stringTranslate("guardians","guardians_approval_request_dialog_parent_phone_label")}),(0,Lr.Y)(HCe.p,{type:"text",name:"mobilePhone","data-testid":"guardians-approval-request-dialog-parent-phone-number",value:r.mobilePhone||"",onChange:m,className:(0,zCe.z)(o.showGuardiansApprovalRequestFormInput,l.mobilePhoneErr&&o.parentInputFieldError),"aria-labelledby":"phoneLabel"}),(0,Lr.Y)(BCe.D,{size:"small",className:o.showErrorMsg,"aria-live":"polite","aria-atomic":"true","aria-relevant":"all",error:!0,children:l.mobilePhoneErr&&(0,Lr.Y)(TX.s,{vAlign:"center",children:[(0,Lr.Y)(DX.pO8,{filled:!0,fontSize:GCe.f.medium}),l.mobilePhoneErr]})})]})]})]}),(0,Lr.Y)(QCe,{relatedContacts:e,onClickBackButtonHandler:p,onClickSaveButtonHandler:g,isSaveButtonEnabled:u})]})};var ibe=n(985212),abe=n(634214),obe=n(910316),rbe=n(814356);const sbe=({onClickAddParentButtonHandler:e,isSendApprovalButtonEnabled:t,onClickSendForApprovalButtonHandler:n,isRequestInProgress:i,relatedContacts:a})=>{const o=(0,JX.PO)(),r=UCe(),s=(0,rbe.A_)(),l=Or.useCallback((()=>{n(a)}),[n,a]),c=o.stringTranslate("guardians","guardians_approval_request_loader_label"),d=o.stringTranslate("guardians","guardians_approval_request_loader_icon_label"),u={"data-track-action-gesture":GR.Od.click,"data-track-module-type":GR.nR.button,"data-track-module-name":GR.Sn.sendApprovalButton,"data-track-panel-region":GR.rP.modal,"data-track-action-outcome":GR.nd.submit,"data-track-panel-type":GR.HP.GuardiansApprovalRequestDialog},m={"data-track-action-gesture":GR.Od.click,"data-track-module-type":GR.nR.button,"data-track-module-name":GR.Sn.addNewParentButton,"data-track-panel-region":GR.rP.modal,"data-track-action-outcome":GR.nd.open,"data-track-panel-type":GR.HP.GuardiansApprovalRequestDialog};return Or.useEffect((()=>{i&&s.announce(c,!0)}),[i,c,s]),(0,Lr.Y)(Or.Fragment,{children:[(0,Lr.Y)(eG.i,{position:"start",children:(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"subtle",icon:(0,Lr.Y)(DX.OMN,{}),onClick:e,disabled:i,"data-tid":"guardians-approval-request-dialog-add-new-parent-button",className:r.showAddNewParentButton,...m,children:o.stringTranslate("guardians","guardians_approval_request_dialog_add_new_parent_button")})})}),(0,Lr.Y)(eG.i,{position:"end",children:i?(0,Lr.Y)(obe.y,{size:"extra-small","aria-label":d,label:c,className:r.spinner}):(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"primary","data-tid":"guardians-approval-request-dialog-send-approval-button",disabled:t,className:r.rightActionButton,onClick:l,...u,children:o.stringTranslate("guardians","guardians_approval_request_dialog_send_approval_button")})})})]})},lbe=e=>{const t=UCe(),n=(0,JX.PO)().stringTranslate("guardians","guardians_approval_request_dialog_arrow_icon");return(0,Lr.Y)(TX.s,{vAlign:"center",space:"between",className:(0,zCe.z)(t.showGuardiansAvatarAndArrowIcon,t.showItemLayout,t.alignAvatarAndArrowIcon),children:[(0,Lr.Y)(TX.s,{gap:"gap.medium",vAlign:"center",children:[(0,Lr.Y)(GX.j,{v9ClassName:t.isParentAvatar,users:[{displayName:e.displayName,email:e.emailAddress,id:""}],isFocusable:!1,isPresencePrefetched:!1,showPresence:!1,hidePersonaCard:!0,narrateProfilePicture:!1,callerInfo:"guardians-approval-request-dialog-list",isSharedChannel:!1}),(0,Lr.Y)(BCe.D,{className:(0,zCe.z)(t.showParentDisplayName,e.disableGridRow&&t.disableGridItem),children:e.displayName})]}),(0,Lr.Y)(TX.s,{children:(0,Lr.Y)(DX.c_$,{fontSize:GCe.f.large,"aria-label":n,"data-tid":"guardians-approval-request-dialog-arrow-icon",className:(0,zCe.z)(t.showArrowIcon,e.disableGridRow&&t.disableGridItem)})})]})},cbe=({relatedContacts:e,setActionType:t,setDialogViewMode:n,setParentRowSelected:i,memberAndRelatedContacts:a,onClickSendForApprovalButtonHandler:o,isRequestInProgress:r})=>{const s=(0,JX.PO)().stringTranslate("guardians","guardians_grid_info_text",{student:a.displayName||""}),l=UCe();e.map((e=>e.disableGridRow=r));const[c,d]=Or.useState(!1),u=Or.useCallback((e=>{r||(n(YCe._.Form),t(YCe.a.Edit),i(e))}),[t,n,i,r]),m=Or.useCallback((e=>{u(Number(e.currentTarget.id))}),[u]),p=Or.useCallback((e=>{"Enter"===e.key&&u(Number(e.currentTarget.id))}),[u]),g=Or.useCallback((()=>{n(YCe._.Form),t(YCe.a.Add),i(-1)}),[t,n,i]);Or.useEffect((()=>{const t=(0,we.isEqual)(e,a.guardiansInfo);d(t)}),[a.guardiansInfo,e]);const h=(0,ebe.Dy)("focus-first-list-item"),v=Or.useRef(!0),y=(0,ebe.S1)();return Or.useEffect((()=>{v.current&&(y.requestFocus("focus-first-list-item"),v.current=!1)}),[y]),(0,Lr.Y)(Or.Fragment,{children:[(0,Lr.Y)(Xq.C,{children:[(0,Lr.Y)(WCe.c,{className:l.showDialogDividerForList}),(0,Lr.Y)(ibe.B,{"data-tid":"guardians-approval-request-dialog-list","aria-label":s,navigationMode:"items",children:e.map(((e,t)=>(0,Lr.Y)(Or.Fragment,{children:[(0,Lr.Y)(abe.c,{className:(0,zCe.z)(l.showGuardiansAvatarAndArrowIcon,l.alignAvatarAndArrowIcon),id:t.toString(),onKeyDown:p,onClick:m,"data-tid":`guardians-approval-request-dialog-item-${t}`,ref:0===t?h:void 0,children:(0,Lr.Y)(lbe,{...e})}),(0,Lr.Y)(WCe.c,{})]},t)))})]}),(0,Lr.Y)(sbe,{onClickAddParentButtonHandler:g,isSendApprovalButtonEnabled:c,onClickSendForApprovalButtonHandler:o,isRequestInProgress:r,relatedContacts:e})]})};var dbe=n(370275);const ube=({memberAndRelatedContacts:e,onCloseDialogHandler:t,onClickSendForApprovalButtonHandler:n,isDialogOpen:i,initialAction:a,initialViewMode:o,isRequestInProgress:r})=>{const s=(0,JX.PO)(),l=UCe(),[c,d]=Or.useState(a),[u,m]=Or.useState(o),[p,g]=Or.useState(-1),[h,v]=Or.useState(e.guardiansInfo),y=Or.useCallback((e=>{"Escape"!==e.key&&"Esc"!==e.key||t()}),[t]);return(0,Lr.Y)(Qq.l,{open:i,"data-tid":"guardians-approval-request-dialog-renderer",children:(0,Lr.Y)(Jq.E,{onKeyDown:y,className:l.guardiansApprovalRequestDialogSurface,"data-tid":"guardians-approval-request-dialog-renderer-surface",children:(0,Lr.Y)(Kq.R,{className:l.showDialogBody,children:[(0,Lr.Y)(Zq.L,{action:(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"subtle",disabled:r,icon:(0,Lr.Y)(DX.pVq,{}),onClick:t,"data-tid":"guardians-approval-request-dialog-close-button","aria-label":s.stringTranslate("guardians","guardians_approval_request_dialog_close_button")})}),children:(0,Lr.Y)(TX.s,{column:!0,children:[(0,Lr.Y)(LX.s,{children:s.stringTranslate("guardians","guardians_approval_request_dialog_renderer_title",{actionType:c})}),(0,Lr.Y)(BCe.D,{className:l.showDialogSubHeader,children:s.stringTranslate("guardians","guardians_approval_request_dialog_sub_header")}),(0,Lr.Y)(dbe.vq,{member:e,isParentsEndSlot:!1,isGuardiansApprovalRequestDialog:!0})]})}),u===YCe._.Form?(0,Lr.Y)(nbe,{relatedContacts:h,setRelatedContacts:v,parentRowSelected:p,setDialogViewMode:m}):(0,Lr.Y)(cbe,{relatedContacts:h,setActionType:d,setParentRowSelected:g,memberAndRelatedContacts:e,setDialogViewMode:m,onClickSendForApprovalButtonHandler:n,isRequestInProgress:r})]})})})};var mbe=n(540466),pbe=n(325841);const gbe=(e,t,n,i,a,o,r)=>{const{message:s}=e,{code:l,context:c,reason:u}=e?.graphQLErrors?.[0]?.extensions?.prevError??{},m=`ErrorMessage: ${s}`;o.fail({context:c,reason:u,errorCode:l,errors:m,statusCode:u?.status});let p=d.O4.Unknown;((e,t)=>e===d.O4.GatewayTimeout||e===d.O4.FailedToCreateGuardiansApproval||t?.status===Og.nW.GATEWAY_TIMEOUT||t?.status===Og.nW.SERVER_ERROR)(l,u)&&((0,mbe.M3)(n,i,a),p=d.O4.GatewayTimeout),t(),r(p)},hbe=({initialAction:e,initialViewMode:t,isDialogOpen:n,setIsDialogOpen:i,memberAndRelatedContacts:a})=>{const o=(0,JX.PO)(),r=(0,A8.m)(),{loggerFactory:{newLogger:s},scenarioFactory:l}=(0,QX.ur)(),c=a.objectId||"",u=a.groupId||"",m=o.stringTranslate("guardians","guardians_approval_request_title",{studentName:a.displayName||""}),p=Or.useCallback((()=>{i(!1)}),[i]),g=(0,pbe.Ue)(),h=(0,pbe.xp)(),{createGuardiansApproval:v,loading:y}=(0,mbe.oH)(u,c,m,r),S=Or.useCallback((async e=>{const t=l.newScenario(be.Cu.CreateGuardiansApproval);t.appendEventData({studentId:c,groupId:u});try{const n=e.map((e=>({displayName:e.displayName,emailAddress:e.emailAddress,mobilePhone:e.mobilePhone,relationship:"parent"}))),i=await v(n);p();const a=i.data?.createGuardiansApproval?.approvalId;a?(t.stop({approvalId:a}),g()):(t.cancel({errorCode:d.O4.Unknown,errors:"Missing approval id on the create guardians approval request."}),h())}catch(e){gbe(e,p,r,c,u,t,h)}}),[v,p,g,h,c,u,r,l]);return(0,Lr.Y)(ZX.W,{panelRegion:GR.rP.modal,panelType:GR.HP.GuardiansApprovalRequestDialog,newLogger:s,children:(0,Lr.Y)(ube,{memberAndRelatedContacts:a,onCloseDialogHandler:p,onClickSendForApprovalButtonHandler:S,initialAction:e,initialViewMode:t,isDialogOpen:n,isRequestInProgress:y})})};hbe.displayName="GuardiansApprovalRequestDialogContainer";const vbe=()=>{const[e,t]=Or.useState(!0),n=(0,JX.PO)(),i=UCe(),a=Or.useCallback((()=>{t(!1)}),[t]),o=Or.useCallback((e=>{"Escape"!==e.key&&"Esc"!==e.key||a()}),[a]);return(0,Lr.Y)(Qq.l,{open:e,"data-tid":"guardians-send-approval-success-dialog-renderer",children:(0,Lr.Y)(Jq.E,{onKeyDown:o,className:i.guardiansApprovalRequestDialogSurface,"data-tid":"guardians-send-approval-success-dialog-renderer-surface",children:(0,Lr.Y)(Kq.R,{children:[(0,Lr.Y)(Zq.L,{children:n.stringTranslate("guardians","guardians_approval_request_success_dialog_title")}),(0,Lr.Y)(Xq.C,{children:(0,Lr.Y)(BCe.D,{children:n.stringTranslate("guardians","guardians_approval_request_success_dialog_content")})}),(0,Lr.Y)(eG.i,{position:"end",children:(0,Lr.Y)(jCe.z,{children:(0,Lr.Y)(qX.$,{appearance:"outline","data-tid":"guardians-approval-request-success-dialog-close-button",className:i.rightActionButton,onClick:a,children:n.stringTranslate("guardians","guardians_approval_request_dialog_close_button")})})})]})})})},ybe=()=>null,Sbe=()=>{const{getEntityOptions:e}=(0,FX.At)(),{errorCode:t}=e(ke.ck.guardianssendapprovalerror,ke.SY.create);return(0,Lr.Y)($Ce,{errorCode:t})},fbe=()=>{const{getEntityOptions:e}=(0,FX.At)(),{memberAndRelatedContacts:t,initialAction:n,initialViewMode:i}=e(ke.ck.guardiansapprovalrequest,ke.SY.create),[a,o]=Or.useState(!0);return(0,Lr.Y)(hbe,{initialAction:n,initialViewMode:i,memberAndRelatedContacts:t,isDialogOpen:a,setIsDialogOpen:o})},kbe=()=>Promise.all([n.e(461500),n.e(669152),n.e(459959),n.e(258832),n.e(390761),n.e(350037),n.e(459467),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(977204),n.e(524014),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(467131),n.e(523111)]).then(n.bind(n,649639)),Cbe=()=>Promise.all([n.e(461500),n.e(669152),n.e(459959),n.e(258832),n.e(390761),n.e(350037),n.e(459467),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(977204),n.e(524014),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(467131),n.e(523111)]).then(n.bind(n,819867)),bbe=()=>null;function wbe(){return{eventHandlers:xCe,getAppPhases:LCe,getAppViewEntities:ACe,getCommandScenarioName:()=>be.Cu.GuardiansAppLoad,manifest:NCe,render:async({appRenderMode:e,coreSettings:t,onRenderEvent:n,entity:i})=>{if(e===se.w.Modal)return(async e=>{switch(e.type){case ke.ck.guardiansapprovalrequest:return(0,Lr.Y)(fbe,{});case ke.ck.guardianssendapprovalsuccess:return(0,Lr.Y)(vbe,{});case ke.ck.guardianssendapprovalerror:return(0,Lr.Y)(Sbe,{});default:return(0,Lr.Y)(ybe,{})}})(i);if(e===se.w.Main){const i="guardians-app";n("ChunkLoadStarted",{chunkName:i});const{enableEntityMoreInfo:a}=t.get(c.w.Core),o=({children:e})=>(0,Lr.Y)(Or.Fragment,{children:e}),{GuardiansAppViews:r}=await(0,ev.wg)(kbe,i),{LPC:s}=a?{LPC:o}:await(0,ev.wg)(Cbe,i),l=a?o:wJ.CA;return n("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(s,{children:(0,Lr.Y)(l,{children:(0,Lr.Y)(r,{appRenderMode:e})})})}return(0,Lr.Y)(bbe,{})}}}const Tbe=screen.availHeight-250-10,Ibe=screen.availWidth-400-10,Nbe={id:"com.microsoft.teams.notifications",name:"NotificationsApp",supportedEntities:[ke.ck.externalnavigation,ke.ck.toasts,ke.ck.notificationsdeeplink,ke.ck.browsernotificationsbannerdismissed],supportedRenderModes:[se.w.Main,se.w.PartialOverlay],windowFeatures:{top:Tbe,left:Ibe,width:0,height:0,minWidth:0,minHeight:0,offset:0,toolbar:"no",titlebar:"no",menubar:"no",location:"no",scrollbars:"no",resizable:"no",status:"no"},getAllowUserWindowingPreference:e=>!0},Abe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsMeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"tenantName"}}]}}]}}]},Ebe="ModuleLoaded",Fbe="createCollection not available on module.",_be="removeCollection not available on module.",Dbe="HostComms is unable to load toast collection module. Bailing out.";class Pbe{constructor(e,t){this.hostCommunicationService=t,this.logger=e.newLogger("ToastCollectionService","services-io-toast-collection")}async createCollection(e){const t=await this.hostCommunicationService.loadModule("toasts");if(t){if(t.createCollection)return this.logger.log(Ebe),t.createCollection(e);this.logger.error(Fbe)}else this.logger.error(Dbe)}async removeCollection(e){const t=await this.hostCommunicationService.loadModule("toasts");if(t){if(t.removeCollection)return this.logger.log(Ebe),t.removeCollection(e);this.logger.error(_be)}else this.logger.error(Dbe)}}function Mbe(e,t){const n=`${e} - ${t}`;if(n.length<=36)return n;const i=18-t.length,a=i>0?18+i:18;if(e.length<=a)return n;return`${e.slice(0,a-3)}... - ${t}`}function Rbe(e,t,n,i,a){const{enableToastCollections:o}=a.get(c.w.Notifications);return{id:"create-toast-collection",runOncePerId:!0,job:async()=>{const a=n.newLogger("ToastCollectionCreation","apps-notifications");if(!o)return void a.log("not enabled by feature flag");if(!e||!e.loginUserName)return void a.error("AuthenticationUserContext is not found");const r=await t.query({query:Abe});if(!r.data.me||!r.data.me.tenantName)return void a.error("User data not available");const s=new Pbe(n,i),l=(0,kt.Lw)(e);return s.createCollection({collectionId:l,name:Mbe(e.loginUserName,r.data.me.tenantName)}),async e=>{if("signout"===e)await s.removeCollection(l)}}}}const xbe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsMePresenceQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"presence"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},Lbe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsPresenceUpdateEventSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presenceUpdateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var Obe,jbe;!function(e){e.Presenting="Presenting",e.DoNotDisturb="DoNotDisturb",e.OSdoNotDisturb="OSdoNotDisturb"}(Obe||(Obe={})),function(e){e.Default="default",e.Presence="presence",e.MeetingOrCall="meetingOrCall",e.GeneralMute="generalMute",e.GeneralMuteIncludingUrgentAndPriority="generalMuteIncludingUrgentAndPriority"}(jbe||(jbe={}));class Bbe{constructor(){this.notificationsBlockingCaches={}}blockUserNotifications(e,t,n){let i=this.notificationsBlockingCaches[e];i||(i={}),i={...i,...t},n.log(`NotificationsBlockingCache: set new blocking cache for userId ${e}`),this.notificationsBlockingCaches[e]=i}unblockUserNotifications(e,t,n){n.log(`NotificationsBlockingCache unblockUserNotifications ${e}`);const i=this.notificationsBlockingCaches[e];i?(Object.keys(t).forEach((e=>{Reflect.deleteProperty(i,e)})),Object.keys(i).length||(n.log(`NotificationsBlockingCache, unblockUserNotifications: blocking cache is empty, deleting the entry for the user ${e}`),Reflect.deleteProperty(this.notificationsBlockingCaches,e))):n.log("No blocking cache found for the user id")}unblockUserNotificationsByBlockingType(e,t,n){n.log(`NotificationsBlockingCache unblockUserNotificationsByBlockingType ${e}`);const i=this.notificationsBlockingCaches[e];if(i){for(const e in i)i[e]===t&&Reflect.deleteProperty(i,e);Object.keys(i).length||(n.log(`NotificationsBlockingCache, unblockUserNotificationsByBlockingType: blocking cache is empty, deleting the entry for the user ${e}`),Reflect.deleteProperty(this.notificationsBlockingCaches,e))}else n.log("No blocking cache found for the user id")}getBlockedState(e){e.log("NotificationsBlockingCache, getBlockedState: reading blocked state");const t=Object.keys(this.notificationsBlockingCaches),n=[];for(const i of t)e.log(`NotificationsBlockingCache, getBlockedState: reading cache for userId ${i}`),n.push({userId:i,blockingReasons:this.notificationsBlockingCaches[i]});if(n.length)return e.log("NotificationsBlockingCache, getBlockedState: returning blocked state"),{state:"blocked",blocks:n};e.log("NotificationsBlockingCache, getBlockedState: blocks not found")}getUserBlockedState(e,t,n){e.log(`NotificationsBlockingCache, getUserBlockedState: getting blocked state for userId ${t}`);const i=Object.keys(this.notificationsBlockingCaches).find((e=>{const i=n?e:e.replace(/-/g,""),a=n?t:t.replace(/-/g,"");return i.includes(a)}));if(i)return{userId:i,blockingReasons:this.notificationsBlockingCaches[i]};e.log("No blocking cache found for the user id")}isUserBlockedBySpecificTypes(e,t,n,i){const a=this.getUserBlockedState(e,t,n);if(!a)return!1;let o=!1;return Object.keys(a?.blockingReasons).forEach((e=>{i.includes(a?.blockingReasons[e])&&(o=!0)})),e.log(`NotificationsBlockingCache, userId ${t} is blocked for types:, ${i.join(",")} , result: ${o}`),o}}const Ube=new RegExp(`^(${Object.values(RS.C).join("|")})`);function $be(e){return e?function(e){return e.replace(Ube,"")}(e.replace(/-/g,"")):""}function Wbe(e,t,n,i,a){return{id:"presence-blocking-signal-subscription",runOncePerId:!0,job:async()=>{const o=n.newLogger("PresenceBlockingSignalSubscription","apps-notifications"),{enableNotificationsFiltering:r,enableUserIdMismatchFix:s}=a.get(c.w.Notifications);if(!r)return void o.log($t.n.NotEnabled);const l=await t.query({query:xbe});if(!l.data.me||!l.data.me.presence?.availability)return void o.log("user presence missing");if(!e?.id)return void o.log("user id missing");const d=s?$be(e.id):e.id;Vbe(d,i,l.data.me.presence?.availability,o,l.data.me.presence?.activity);const u=t.subscribe({query:Lbe,fetchPolicy:"no-cache",variables:{userId:l.data.me.mri,source:"ups"}}).subscribe((e=>{const t=e.data?.presenceUpdateEvent?.availability,n=e.data?.presenceUpdateEvent?.activity;t&&Vbe(d,i,t,o,n)}));return()=>{u?.unsubscribe()}}}}function Vbe(e,t,n,i,a){t.unblockUserNotificationsByBlockingType(e,jbe.Presence,i),"DoNotDisturb"!==n&&"Busy"!==n||t.blockUserNotifications(e,{[a]:jbe.Presence},i)}const Hbe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsGraphItemToastEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"graphItemToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"customIconUrl"}},{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderMri"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"teamsAppId"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"isSquareImage"}}]}}]}}]},zbe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsGraphItemToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"credentials"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}},{kind:"Argument",name:{kind:"Name",value:"credentials"},value:{kind:"Variable",name:{kind:"Name",value:"credentials"}}}]}]}}]},qbe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsGraphItemMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]};var Gbe;!function(e){e.MsGraph="MsGraph"}(Gbe||(Gbe={}));const Ybe="msgraph_toast_event_subscription_job";async function Qbe(e,t,n,i,a,o){try{const r=o===Cq.Cy.taco?await async function(e,t,n){const{data:i}=await e.query({query:qbe,variables:{userId:t,displayName:n,profilePictureSize:d6.xi.Small}});return i.msaUserProfilePicture}(e,n,i):a;if(!r)return void t.errorToTelemetry?.(`${$t.n.ImageFetchFailed}`,Ybe,void 0,!0);const s=await e.query({query:zbe,variables:{url:r,credentials:"omit"}});return s?.data.toastImageAsDataUri||void 0}catch(e){return void t.errorToTelemetry?.(`${$t.n.ImageFetchFailed} ${e}`,Ybe,void 0,!0)}}const Jbe=(e,t)=>{if(!e.deeplinkUrl)return;const{enableDeeplinkNotifications:n,disallowedDeeplinkApps:i}=t.get(c.w.Notifications);return n&&!i?.includes(e.teamsAppId)?e.deeplinkUrl:void 0},Kbe=async(e,t,n)=>{const i=await Qbe(t,n,e.senderMri,e.senderDisplayName||"",e.customIconUrl,e.teamsAppId);if(i)return{alt:"",src:i}};function Zbe(e,t,n,i,a,o,r){const{enableToastCollections:s}=t.get(c.w.Notifications);return async l=>{if(l.errors){const e=(0,ge.hR)(l.errors.map((e=>e.message)).join());return void n.errorToTelemetry?.(`${$t.n.SubscriptionFailed} ${e}`,Ybe,void 0,!0)}const c=l?.data?.graphItemToastEvent;if(!c)return void n.errorToTelemetry?.(`${$t.n.EmptyEvent}`,Ybe,void 0,!0);const d=i.newScenario(be.Cu.CrossClientToastView,{startTime:+c.startTimestamp});d.clientId=c.correlationId,d.appendEventData({mainEntityType:ke.ck.channels});const u=await async function(e,t,n,i){return{conversationId:"",deeplinkUrl:Jbe(e,n),quickReply:!1,time:new Date(+e.startTimestamp),title:e.title,text:e.content,mainImage:await Kbe(e,t,i),isSquareImage:e.isSquareImage||!1}}(c,o,t,n);return"MsGraph"===c.type&&u?.title?(s&&(u.collectionId=(0,cB.pP)(e,r,n)),i.hoistScenarioToCore?.(d),a.toasts.showGraphItemNotification(c.correlationId,u)):(n.errorToTelemetry?.(`${$t.n.GraphItemToastUnhandledType} ${c.type}`,Ybe,void 0,!0),void d.stop({reason:$t.n.GraphItemToastUnhandledType}))}}function Xbe(e,t,n,i,a,o,r){const{enableCommandToHostCommService:s}=t.get(c.w.Core),{enableGraphItemToastNotifications:l,enableBrowserToasts:d,enableInAppNotifications:u,enableInAppNotificationsForChatsAndChannels:m}=t.get(c.w.Notifications,["enableGraphItemToastNotifications","enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"graph-item-toast-event-subscription",runOncePerId:!0,job:async()=>{const c=i.newLogger("graphItemToastEventSubscription","apps-notifications");if(!(s||d||u&&m))return void c.log($t.n.NotEnabled);if(!l)return void c.log(`The enableGraphItemToastNotifications flag is not enabled ${$t.n.NotEnabled}`);const p=n.subscribe({query:Hbe,fetchPolicy:"no-cache"}).subscribe(Zbe(e,t,c,a,o,n,r));return()=>{p?.unsubscribe()}}}}const ewe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsNotificationsEngineEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notificationsEngineUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"data"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationXDaysOfInactiveStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"lastUserActivityTimestamp"}},{kind:"Field",name:{kind:"Name",value:"timesToBeShown"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationTflMeetingLinks"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"lastUserActivityTimestamp"}},{kind:"Field",name:{kind:"Name",value:"timesToBeShown"}},{kind:"Field",name:{kind:"Name",value:"meetingLinkPrejoinData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"deepLinkId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationConversationsReminder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"lastMessageId"}},{kind:"Field",name:{kind:"Name",value:"lastMessageComposeTime"}},{kind:"Field",name:{kind:"Name",value:"lastMessageAuthor"}},{kind:"Field",name:{kind:"Name",value:"missedThreadsCount"}},{kind:"Field",name:{kind:"Name",value:"userNames"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"correlationId"}}]}}]}}]};function twe(e){return e.stringTranslate("toastNotifications","toast_messaging_sent_a_remind_message")}function nwe(e){return e.stringTranslate("toastNotifications","toast_messaging_sent_a_meet_now_links_reminder_message")}var iwe,awe,owe;!function(e){e.NotificationXDaysOfInactiveStatus="NotificationXDaysOfInactiveStatus",e.NotificationTflMeetingLinks="NotificationTflMeetingLinks",e.NotificationConversationsReminder="NotificationConversationsReminder"}(iwe||(iwe={})),function(e){e.notifications_x_days_of_inactive_status="notifications_x_days_of_inactive_status",e.notifications_tfl_meeting_links="notifications_tfl_meeting_links",e.notifications_conversations_reminder="notifications_conversations_reminder"}(awe||(awe={})),function(e){e.asc="asc",e.desc="desc"}(owe||(owe={}));const rwe={MAX_BANNER_VIEW_COUNT:3,BANNER_VIEW_COUNT_LOCAL_STORAGE_KEY:"NotificationBannerViewCount",BANNER_ID_WINDOWS_NOTIFICATION:"WindowsNotificationBanner",BANNER_ID_BROWSER_NOTIFICATION:"BrowserNotificationBanner",BANNER_ID_TEAMS_NOTIFICATION:"TeamsNotificationBanner",BANNER_ID_WINDOWS_DND:"WindowsDoNotDisturbBanner",BROWSER_NOTIFICATION_SETTINGS_BANNER_DISMISS:"BrowserNotificationSettingsBannerDismiss"},swe={topic:"topic",text:"text",buttonText:"buttonText"},lwe=1,cwe=0,dwe="CN:",uwe=Object.freeze({FIVE_SECONDS:5e3,TWENTY_SECONDS:2e4,THIRTY_SECONDS:3e4,SIXTY_TWO_SECONDS:62e3}),mwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsTriggerCallingToastActionMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"notificationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actionType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerCallingToastAction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"notificationId"},value:{kind:"Variable",name:{kind:"Name",value:"notificationId"}}},{kind:"Argument",name:{kind:"Name",value:"actionType"},value:{kind:"Variable",name:{kind:"Name",value:"actionType"}}}]}]}}]},pwe=e=>({id:(0,E.v4)(),source:A.p.NotificationsActivation,scenarioName:be.Cu.ToastActivation,startTimestamp:e??Date.now()}),gwe=(e,t)=>({correlation:t,stateTransition:e?g.Ar.flush:g.Ar.new,visibilityState:g.Rp.show}),hwe=e=>({id:e.id,action:e.action,type:e.type}),vwe=e=>e.isIncomingCall?"AcceptIncomingCallThroughPrejoin"===e.targetEntity.dataOptions.actionType?SL.Ck.MeetingNudge:SL.Ck.Calling:"calls"===e.targetEntity?.type?SL.Ck.MSN:SL.Ck.Standard,ywe=e=>{const{targetEntity:t,startTimestamp:n}=e;return{command:{correlation:pwe(n),stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entity:hwe(t),dataOptions:{...t.dataOptions}}},Swe=(e,t)=>{const{targetEntity:n,isOnWeb:i,startTimestamp:a}=e,o=n.dataOptions;t||(t=pwe(a));return{command:gwe(i,t),entity:hwe(n),entityOptions:{messageId:o.messageId,focusOnLoad:void 0,userContextId:o.userContextId},dataOptions:{...o}}};function fwe(e,t){const{i18n:n,missedConversationsNumber:i,sender:a,otherSenders:o}=t;switch(e){case swe.topic:switch(o){case cwe:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_topic",{sender:a});case lwe:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_two_senders_group_topic",{sender:a});default:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_more_than_two_senders_group_topic",{sender:a,otherSenders:o})}case swe.buttonText:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_button_text");case swe.text:default:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_text",{number:i})}}function kwe(e,t,n){return e.mutate({mutation:mwe,variables:{notificationId:n,actionType:t}})}function Cwe(e,t,n,i,a){return{id:"notifications-engine-event-subscription",runOncePerId:!0,job:async()=>{const o=e.watchQuery({query:ewe,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i){const a=n.newLogger("notificationsEngineUpdatedEvent","apps-notifications");return async o=>{const r=o.data?.notificationsEngineUpdatedEvent,{data:s,correlationId:l=""}=r||{},{__typename:c}=s||{},d=i.newScenario(be.Cu.NotificationsEngineEventSubscriptionJob);if(d.appendEventData({correlationId:l}),!c||!s){const e=`Received a NE event with missed event type or data. Type "${c}"`;return a?.errorToTelemetry&&a.errorToTelemetry(e,"life_web_and_desktop_growth_notification_engine_error",void 0,!0),d.fail({reason:e}),Promise.resolve()}const u=`Received a NE event of type "${c}"`;switch(a?.infoToTelemetry&&a.infoToTelemetry(u,"life_web_and_desktop_growth_notification_engine_info",void 0,!0),d.appendEventData({notificationEngineEventType:c}),d.stop({reason:u}),c){case iwe.NotificationXDaysOfInactiveStatus:return e.toasts.showReEngageNudge(l,{conversationId:g1.oq,title:twe(t),time:new Date,quickReply:!1,messageId:void 0,type:iwe.NotificationXDaysOfInactiveStatus});case iwe.NotificationTflMeetingLinks:const{meetingLinkPrejoinData:i}=s;bwe(l,i,e,t,n,c);break;case iwe.NotificationConversationsReminder:const a=function(e,{threadId:t,lastMessageAuthor:n,lastMessageId:i,lastMessageComposeTime:a,userNames:o,missedThreadsCount:r,type:s}){const l={i18n:e,missedConversationsNumber:r,sender:n,otherSenders:o.length-1};return{text:fwe(swe.text,l),title:fwe(swe.topic,l),buttonText:fwe(swe.buttonText,l),mainImage:{alt:n,src:y4.Mz},conversationId:t,messageId:i,time:new Date(a),quickReply:!1,type:s}}(t,{...s,type:iwe.NotificationConversationsReminder});return e.toasts.showReminder(l,a);default:return Promise.resolve()}}}(t,n,i,a));return()=>{o.unsubscribe()}}}}const bwe=(e,t,n,i,a,o)=>{const r=a.newLogger("notificationsEngineUpdatedEvent","apps-activity");if(!t)return r?.infoToTelemetry&&r.infoToTelemetry(`Received empty data in "notificationsEngineUpdatedEvent". "meetingLinkPrejoinData" of type "${o}" is not defined correctly: ${t}. CorrelationId: ${e}.`,"life_web_and_desktop_growth_notification_engine_info",void 0,!0),Promise.resolve();const{deeplinkUrl:s,conversationId:l,deepLinkId:c}=t||{};return s&&l&&c?n.toasts.showMeetNowNudge(e,{conversationId:l,title:nwe(i),time:new Date,quickReply:!1,messageId:void 0,deeplinkUrl:s,deepLinkId:c,type:iwe.NotificationTflMeetingLinks}):(r?.infoToTelemetry&&r.infoToTelemetry(`Some data is missing in ${t} of type "${o}". CorrelationId: ${e}.`,"life_web_and_desktop_growth_notification_engine_info",void 0,!0),Promise.resolve())},wwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsTaskbarBadgeUpdatedEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"taskbarBadgeUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"badgeCount"}}]}}]}}]};var Twe=n(438430);const Iwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsTaskbarBadgeUpdatedMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"badgeCount"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateTaskbarMTMABadgeCount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}},{kind:"Argument",name:{kind:"Name",value:"badgeCount"},value:{kind:"Variable",name:{kind:"Name",value:"badgeCount"}}}]}]}}]},Nwe=2,Awe=0;function Ewe(e,t,n,i,a,o){return{id:"taskbar-badge-event-subscription",runOncePerId:!0,job:async()=>{const r=t.newLogger("TaskbarBadgeEventSubscription","apps-notifications");if(i.config.clientType!==nt.sK.Maglev)return void r.log(Twe.hL.NotEnabled);const s=e.subscribe({query:wwe,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a){let o=0;const{enableIconFlashingTaskbar:r}=i.get(c.w.Notifications);return async i=>{if(i.errors){const t=i.errors.map((e=>e.message)).join();return void e.error(`${Twe.hL.SubscriptionFailed} ${(0,ge.hR)(t)}`)}if(!i.data?.taskbarBadgeUpdatedEvent)return void e.log(Twe.hL.EmptyEvent);const{taskbarBadgeUpdatedEvent:s}=i.data,{badgeCount:l}=s;e.log(`${Twe.lE.UpdatedEvent} badgeCount: ${l}`);try{const{data:i}=await n.mutate({mutation:Iwe,variables:{accountId:a,badgeCount:l}}),s=i?.updateTaskbarMTMABadgeCount;if(e.log(`New badge count: ${l} last badgeCount: ${o} update result: ${s}`),r&&s){const i=l>o,a=await(t?.loadModule("windowcontrols")),r=await(a?.getWindowByTag?.(Dt.ng.Main));await async function(e,t,n,i,a){t.log("Flash Frame event");const o=await n.query({query:xbe,fetchPolicy:"no-cache"}),r=o.data.me?.presence?.availability;if(!r)return void t.log("User presence missing");if(i&&"DoNotDisturb"!==r){const t=await(e?.loadModule("windowcontrols"));await(t?.flashFrame?.(i,a?Nwe:Awe))}else t.log(`User state is ${r}`)}(t,e,n,r,i)}o=l}catch(t){e.log(`Error on setting badge ${t}`)}}}(r,n,e,a,o?.id));return async t=>{switch(s.unsubscribe(),t){case"quit":case"signout":case"switch_user":try{await e.mutate({mutation:Iwe,variables:{accountId:o?.id,badgeCount:0}})}catch(e){r.log(`Error on badge update mutation ${e}`)}}}}}}const Fwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsActivitySettingsSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activitySettingsChangedEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"subCategoryPageId"},value:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"settings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"error"}},{kind:"Field",name:{kind:"Name",value:"settingsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]}}]},_we={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsActivitySettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activitySettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"subCategoryPageId"},value:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"error"}},{kind:"Field",name:{kind:"Name",value:"settingsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]},Dwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsOutOfTabToastSettingMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ClientPreferencesInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateClientPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"outOfTabNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"allowOutOfTabNotifications"}},{kind:"Field",name:{kind:"Name",value:"setDuringBrowserToastsAllowed"}}]}}]}}]}}]},Pwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsOutOfTabToastSettingQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clientPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"EnumValue",value:"outOfTabNotifications"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OutOfTabNotificationPreferences"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"allowOutOfTabNotifications"}},{kind:"Field",name:{kind:"Name",value:"setDuringBrowserToastsAllowed"}}]}}]}}]}}]};function Mwe(e,t){const n="granted"===Notification.permission;t.log(`Updating out of tab setting to: ${n}`);try{e.mutate({mutation:Dwe,variables:{value:{outOfTabNotifications:{allowOutOfTabNotifications:n,setDuringBrowserToastsAllowed:n}}}})}catch{t.errorToTelemetry?.("Failed to write new permission state to the local storage.","app_notifications_out_of_tab_setting_error",void 0,!0)}}const Rwe=async e=>{const t=await e.query({query:Pwe,fetchPolicy:"no-cache"});return t?.data?.clientPreferences??void 0};async function xwe(e,t,n,i){const a=function(e,t){return async()=>{const n=await Rwe(e).catch((()=>{t.errorToTelemetry?.("Failed to fetch the current out of tab setting value.","app_notifications_out_of_tab_setting_error",void 0,!0)}));n||t.errorToTelemetry?.("Local cache value is undefined during the update, setting will be assigned per browser permission.","app_notifications_out_of_tab_setting_error",void 0,!0);const i=Notification.permission;switch(i){case"granted":n?.setDuringBrowserToastsAllowed?t.log(`Out of tab setting set during 'Allow' permission already exists. Current value: ${n.allowOutOfTabNotifications}`):Mwe(e,t);break;case"denied":case"default":!1===n?.setDuringBrowserToastsAllowed?t.log(`Out of tab setting set during a blocking permission already exists. \n            Current value: ${n.allowOutOfTabNotifications}, permission: '${i}'`):Mwe(e,t);break;default:t.errorToTelemetry?.(`Unexpected notification permission: ${i}.`,"app_notifications_out_of_tab_setting_error",void 0,!0)}}}(e,n);a().catch((()=>{n.errorToTelemetry?.("Failed to populate initial value.","app_notifications_out_of_tab_setting_error",void 0,!0)}));const o=t.navigator;o&&o.permissions?o.permissions.query({name:"notifications"}).then((e=>{e.addEventListener("change",(()=>{"granted"===e.state&&i&&(n.log("Sending browser notifications 'ON' confirmation as the broser's notification changed to 'granted' state."),i.showPermissionConfirmationBrowserNotification()),a()})),n.log("Added onchange handler for browser notifications permission.")})).catch((()=>{n.errorToTelemetry?.("Failed to set onchange handler for browser notifications permission.","app_notifications_out_of_tab_setting_error",void 0,!0)})):n.errorToTelemetry?.("Failed to subscribe to browser notifications setting change, API methods are missing.","app_notifications_out_of_tab_setting_error",void 0,!0)}function Lwe(e,t,n,i,a,o,r,s,l){return{id:"user-settings-signal-subscription",runOncePerId:!0,job:async()=>{const d=a.newLogger("UserSettingsSignalSubscription","apps-notifications"),{showGenericNotificationsSoundSetting:u,showNotificationsCallsSoundSetting:m,enableUserIdMismatchFix:p,enablePopulateBrowserNotificationSetting:g}=o.get(c.w.Notifications);if(g&&(0,cB.O$)(s,d)&&xwe(t,r,d,l),!u||!m)return void d.log($t.n.NotEnabled);if(!e?.id)return void d.log("user id missing");const h=p?$be(e.id):e.id,v=await t.query({query:_we,variables:{appId:"notifications"},fetchPolicy:"no-cache"}).catch((()=>(d.error("Failed to fetch initial user settings"),{data:void 0})));n.updateUserActivitySettingsCache(h,v.data?.activitySettings.settingsList,o,i,d);const y=t.subscribe({query:Fwe,variables:{appId:"notifications"},fetchPolicy:"no-cache"}).subscribe((e=>{n.updateUserActivitySettingsCache(h,e.data?.activitySettingsChangedEvent?.settings?.settingsList,o,i,d)}));return()=>{y?.unsubscribe()}}}}var Owe=n(537400);const jwe=2;function Bwe(e,t,n,i,a){return{id:"taskbar-legacy-badge-event-subscription",runOncePerId:!0,job:async()=>{const o=t.newLogger("TaskbarLegacyBadgeEventSubscription","apps-notifications");if(i.config.clientType!==nt.sK.Maglev)return void o.log(Twe.hL.NotEnabled);const r=new Owe.C(t,a,n),s=e.subscribe({query:wwe,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a){let o=0;const{enableIconFlashingTaskbar:r}=a.get(c.w.Notifications);return async a=>{if(a.errors){const t=a.errors.map((e=>e.message)).join();return void e.log(`${Twe.hL.SubscriptionFailed} ${(0,ge.hR)(t)}`)}if(!a.data?.taskbarBadgeUpdatedEvent)return void e.log(Twe.hL.EmptyEvent);const{taskbarBadgeUpdatedEvent:s}=a.data,{badgeCount:l}=s;if(e.log(`${Twe.lE.UpdatedEvent} badgeCount: ${l}`),r&&l>o){const t=await(n?.loadModule("windowcontrols")),a=await(t?.getWindowByTag?.(Dt.ng.Main));await async function(e,t,n,i){t.log("Flash Frame event");const a=await n.query({query:xbe,fetchPolicy:"no-cache"});if(!a.data.me||!a.data.me.presence?.availability)return void t.log("User presence missing");const o=a.data.me.presence?.availability;if(i&&"DoNotDisturb"!==o){const t=await(e?.loadModule("windowcontrols"));await(t?.flashFrame?.(i,jwe))}else t.log(`User state is ${o}`)}(n,e,i,a)}return o=l,t.showBadgeCount(l)}}(o,r,n,e,a));return async e=>{switch(s.unsubscribe(),e){case"quit":case"signout":await r.resetBadge()}}}}}var Uwe=n(83930);function $we(){return Notification.permission}function Wwe(e,t,n,i){i?.trySet(e,t,"Desktop"),n.log(`Notification banner view count ${t} saved to local storage.`)}function Vwe(e,t){const n=t?.get(e);return n||void 0}var Hwe=n(679406);async function zwe(e,t,n,i,a,o,r,s){const l=t.newLogger("WarnUserNoticeJob","apps-notifications"),{disableWarnUserNotificationBanner:d,enableWarnUserNotificationDialog:u,enableBrowserWarnUserBanner:m,maximumShowingsOfBrowserNotificationsBanner:p}=o.get(c.w.Notifications),{enableCustomNotificationsForCalls:g,enableCustomNotificationsOnDesktop:h}=o.get(c.w.Core);if(!a)return void l.errorToTelemetry?.("AuthenticationUserContext is not found for warn user notice job","app_notifications_warn_user_notice");if(m){const t=r.localStorage.getItem(rwe.BROWSER_NOTIFICATION_SETTINGS_BANNER_DISMISS),i=!t||!p||Number(t)<p;"granted"!==$we()&&"denied"!==$we()&&i?function(e,t){e.shell.showBanner({id:rwe.BANNER_ID_BROWSER_NOTIFICATION,source:A.p.NotificationSettings,bannerScenario:"toast_browser_user_notice_banner",intentLevel:"Neutral",cause:"SettingsWarnUser",text:t.stringTranslate("toastNotifications","toast_browser_user_notice_banner"),action:{text:t.stringTranslate("toastNotifications","toast_browser_notification_button"),command:{entity:{type:ke.ck.externalnavigation,action:ke.SY.manage,id:aK.G.Notifications}},dismissOnAction:!0},dismissable:!0,dismissActionCommand:{entity:{type:ke.ck.browsernotificationsbannerdismissed,action:ke.SY.info}},duration:0})}(e,n):l.log("Out of tab notifications permission banner was not displayed due to the browser notification permission state or number of showings of the banner")}const v=Number(Vwe(rwe.BANNER_VIEW_COUNT_LOCAL_STORAGE_KEY,s));if(v&&v>=rwe.MAX_BANNER_VIEW_COUNT)return void l.log("Warn user banner was not displayed due to the maximum view count reached");const y=new Uwe.Y(t,i),S=await async function(e){const t=await e.getGlobalNotificationSettingsAsync();if(t)return t.global===Hwe.Br.Enabled}(y);let f=0;if(!1===S){if(u&&(g&&h?e.esp.displaySurface("customNotificationsWarning"):e.esp.displaySurface("notificationsWarning")),!d){!function(e,t,n){e.shell.showBanner({id:rwe.BANNER_ID_WINDOWS_NOTIFICATION,source:A.p.NotificationSettings,bannerScenario:n,intentLevel:"Neutral",cause:"SettingsWarnUser",text:t.stringTranslate("toastNotifications",n),action:{text:t.stringTranslate("toastNotifications","toast_warn_user_button"),command:{entity:{type:ke.ck.externalnavigation,action:ke.SY.empty,id:aK.G.Notifications}},dismissOnAction:!0},dismissable:!0,duration:0})}(e,n,g&&h?"toast_global_windows_custom_notifications_banner":"toast_global_windows_notifications_banner"),f=v?v+1:1}f&&Wwe(rwe.BANNER_VIEW_COUNT_LOCAL_STORAGE_KEY,f.toString(),l,s)}}async function qwe(e,t,n,i){const a=i.newLogger("subscribeAndCacheDnDData","apps-notifications"),o=function(e,t,n){return i=>{e.setOsDoNotDistubState(i,t,n)}}(t,n,a);await async function(e,t,n){const i=await Gwe(e,t,1);if(t.log(`${$t.n.UpdateBlockingCacheWithOSDnD} Fetched the initial OS 'Do not disturb' state: ${i}`),i){const e=function(e,t){switch(e){case Hwe.BY.AlarmsOnly:return Hwe.qu.AlarmsOnly;case Hwe.BY.PriorityOnly:return Hwe.qu.PriorityOnly;case Hwe.BY.Off:return Hwe.qu.Unrestricted;default:return t.warn(`${$t.n.UpdateBlockingCacheWithOSDnD} Focus assist state '${e}' was not recognised. Converting to '${Hwe.qu.Unrestricted}'`),Hwe.qu.Unrestricted}}(i,t);n(e)}}(e,a,o),e.registerForNotificationModeChanged(o)}async function Gwe(e,t,n){if(n>2)return void t.error(`${$t.n.UpdateBlockingCacheWithOSDnD} Could not fetch the initial state of OS Do not Disturb on the second attempt, skipping`);let i;try{i=await e.getFocusAssistStateAsync()}catch{return t.warn(`${$t.n.UpdateBlockingCacheWithOSDnD} Could not fetch the initial state of OS Do not Disturb, trying again`),void Gwe(e,t,n+1)}return i}function Ywe(e,t){e.shell.showBanner({id:rwe.BANNER_ID_WINDOWS_DND,source:A.p.NotificationSettings,bannerScenario:"toast_focus_assist_banner",intentLevel:"Neutral",cause:"SettingsWarnUser",text:t.stringTranslate("toastNotifications","toast_focus_assist_banner"),action:{text:t.stringTranslate("toastNotifications","toast_focus_assist_button"),command:{entity:{type:ke.ck.settingsstore,action:ke.SY.view,id:aK.G.Notifications},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:{source:A.p.BannerNotification}}},dismissOnAction:!0},dismissable:!0,duration:0})}async function Qwe(e,t,n,i,a){const o=t.newLogger("NotificationsApp_macOS_banner","apps-notifications"),r="mac_os_settings_banner_shown_once",s="banner_shown";if(Vwe(r,a)===s)return void o.log("banner was  already shown once");const l=new Uwe.Y(t,i),c=await l.getGlobalNotificationSettingsAsync();!1===(c?.global===Hwe.Br.Enabled)&&(!function(e,t){const n="macos_notifications_settings_banner",i="macos_settings_banner_title",a="macos_settings_banner_text",o="macos_settings_banner_action_text";e.shell.showBanner({id:n,source:A.p.NotificationSettings,bannerScenario:n,intentLevel:"Neutral",cause:"SettingsWarnUser",title:t.stringTranslate("toastNotifications",i),text:t.stringTranslate("toastNotifications",a),action:{text:t.stringTranslate("toastNotifications",o),command:{entity:{type:ke.ck.externalnavigation,action:ke.SY.empty,id:aK.G.Notifications}},dismissOnAction:!0},dismissable:!0,duration:0})}(e,n),Wwe(r,s,o,a))}function Jwe(e,t,n,i,a,o,r,s,l,d){const{enableWarnUserNotificationSettings:u,enableOSDnDSupportForCustomToasts:m,enableMacOsSettingsBanner:p}=i.get(c.w.Notifications,["enableWarnUserNotificationSettings","enableOSDnDSupportForCustomToasts","enableMacOsSettingsBanner"]);return{id:"warn-notifications-settings-banner-job",runOncePerId:!0,job:async()=>{p&&Qwe(e,t,n,a,d),u&&zwe(e,t,n,a,o,i,l,d),m&&await async function(e,t,n,i,a,o,r){const s=t.newLogger("setupHonorDnDEvents","apps-notifications");if(!o?.id)return void s.log("user id missing");const{enableUserIdMismatchFix:l}=r.get(c.w.Notifications),d=l?$be(o.id):o.id;(async function(e,t,n,i,a){const o=e.newLogger("warn-notifications-settings-banner-job","apps-notifications");if(!a)return void o.log(`${$t.n.OSDnDBannerJobUserFetchFailed} User ID is empty, skipping OS DND banner job`);i.registerOnCacheUpdatedCallback(a,(function(e){e?Ywe(t,n):t.shell.dismissBanner(rwe.BANNER_ID_WINDOWS_DND,A.p.NotificationSettings)})),i.shouldDropToastBasedOnDnD(a,o)&&Ywe(t,n)})(t,e,n,i,d),qwe(a,i,d,t)}(e,t,n,r,s,o,i)}}}const Kwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsConnectedCallsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"connectedCallsChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}}]}}]},Zwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsMuteNotificationsDuringMeetingEventSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"muteNotificationsDuringMeetingEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isNotificationMuted"}},{kind:"Field",name:{kind:"Name",value:"teamsCallId"}}]}}]}}]},Xwe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsMuteNotificationsDuringMeetingsGlobalQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"muteNotificationsDuringMeetings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isNotificationMuted"}},{kind:"Field",name:{kind:"Name",value:"teamsCallId"}}]}}]}}]},eTe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsMuteNotificationsDuringMeetingMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isNotificationMuted"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"muteNotificationsDuringMeeting"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isNotificationMuted"},value:{kind:"Variable",name:{kind:"Name",value:"isNotificationMuted"}}},{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isNotificationMuted"}}]}}]}}]};var tTe,nTe=n(62652);function iTe(e,t,n,i,a){return{id:"meetings-blocking-signal-subscription",runOncePerId:!0,job:async()=>{const o=n.newLogger("SettingsAndMeetingsBlockingSignalSubscription","apps-notifications"),{enableNotificationsFilteringInMeetingsAndCalls:r,enableMuteAllNotificationsSetting:s,enableUserIdMismatchFix:l}=a.get(c.w.Notifications);if(!r&&!s)return void o.log($t.n.NotEnabled);const d=new oTe(t);if(!e?.id)return void o.error("User data not available");const u=l?$be(e.id):e.id,m=r?function(e,t,n,i,a){const o=async e=>{const{isNotificationMuted:n,teamsCallId:o}=e.data?.muteNotificationsDuringMeetingEvent||{};n?(a.log("CN: -> SeetingsAndMeetingsSubscription: adding blocking cache because user entered a meeting"),t.blockUserNotifications(i,{[o]:jbe.MeetingOrCall},a)):(a.log("CN: -> SeetingsAndMeetingsSubscription: removing blocking cache because user left from a meeting"),t.unblockUserNotifications(i,{[o]:jbe.MeetingOrCall},a))},r=e.subscribe({query:Kwe,fetchPolicy:"no-cache"}).subscribe((async r=>{const s=r.data?.connectedCallsChangedEvent;if(s?.state===tTe.Connected){n.register(s?.id,o);(await e.query({query:Xwe,variables:{teamsCallId:s?.id}})).data.muteNotificationsDuringMeetings.isNotificationMuted&&t.blockUserNotifications(i,{[s?.id]:jbe.MeetingOrCall},a)}else s?.id&&n.unregister(s.id),t.unblockUserNotifications(i,{[s?.id]:jbe.MeetingOrCall},a)}));return r}(t,i,d,u,o):void 0,p=await t.query({query:_we,variables:{appId:cG.n5.Notifications},fetchPolicy:"no-cache"}).catch((()=>(o.error("Failed to fetch initial user settings"),{data:void 0})));let g=p.data?.activitySettings.settingsList.find((e=>"HideNotificationDuringCallsAndMeetings"===e?.key))?.value===nTe.d.On;s&&aTe(i,u,o,p.data?.activitySettings.settingsList);const h=t.subscribe({query:Fwe,variables:{appId:cG.n5.Notifications},fetchPolicy:"no-cache"}).subscribe((async e=>{const n=e.data?.activitySettingsChangedEvent;if(!n)return;s&&aTe(i,u,o,n?.settings?.settingsList);const a=n?.settings?.settingsList.find((e=>"HideNotificationDuringCallsAndMeetings"===e?.key))?.value===nTe.d.On;g!==a&&(g=a,await d.triggerIndividualMuteNotificationDuringMeetings(t,g))}));return()=>{m?.unsubscribe(),h?.unsubscribe()}}}}function aTe(e,t,n,i){const a=i?.find((e=>"muteGenericNotifications"===e?.key))?.value===nTe.d.On;a?e.blockUserNotifications(t,{[jbe.GeneralMute]:jbe.GeneralMute},n):e.unblockUserNotifications(t,{[jbe.GeneralMute]:jbe.GeneralMute},n);const o=i?.find((e=>"allowUrgentNotifications"===e?.key))?.value===nTe.d.Off;a&&o?e.blockUserNotifications(t,{[jbe.GeneralMuteIncludingUrgentAndPriority]:jbe.GeneralMuteIncludingUrgentAndPriority},n):e.unblockUserNotifications(t,{[jbe.GeneralMuteIncludingUrgentAndPriority]:jbe.GeneralMuteIncludingUrgentAndPriority},n)}!function(e){e[e.Connected=3]="Connected",e[e.Disconnected=7]="Disconnected"}(tTe||(tTe={}));class oTe{constructor(e){this.dataClient=e,this.subscriptions=new Map}register(e,t){const n=this.dataClient.subscribe({query:Zwe,variables:{teamsCallId:e},fetchPolicy:"no-cache"}).subscribe(t);this.subscriptions.set(e,(()=>{n.unsubscribe(),this.subscriptions.delete(e)}))}unregister(e){const t=this.subscriptions.get(e);t?.()}async triggerIndividualMuteNotificationDuringMeetings(e,t){const n=[];return[...this.subscriptions.keys()].forEach((i=>{n.push(e.mutate({mutation:eTe,variables:{teamsCallId:i,isNotificationMuted:t}}))})),Promise.all(n)}}function rTe(e,t,n,i){return({context:{authenticationUser:a,client:o,coreSettings:r,entityCommanding:s,hostCommunicationService:l,i18n:d,scenarioFactory:u,userTrackingService:m,localStorage:p,loggerFactory:g,platformService:h,notificationsHandler:v,windowProvider:y}})=>{i.initialize(v,d);const S=new Uwe.Y(g,l),f=o,{enableCoherenceBadgeForWindows:k,enableCoherenceBadgeForMac:C}=r.get(c.w.Notifications),b=[Lwe(a,f,n,t,g,r,y,h,v),Wbe(a,f,g,e,r),iTe(a,f,g,e,r),Rbe(a,f,g,l,r),Xbe(a,r,f,g,u,s,m),Jwe(s,g,d,r,l,a,t,S,y,p)];return r.get(c.w.CdlWorker)?.enableNotificationsEngine&&b.push(Cwe(f,s,d,g,u)),k||C?b.push(Ewe(f,g,l,h,r,a)):b.push(Bwe(f,g,l,h,r)),b}}const sTe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsResetTaskbarBadgeOnAccountSwitchMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resetTaskbarBadgeOnAccountSwitch"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}}]}]}}]};function lTe(){return({context:{client:e,authenticationUser:t,hostCommunicationService:n,loggerFactory:i,platformService:a,isMainWindow:o,coreSettings:r}})=>{const{enableCoherenceBadgeForWindows:s,enableRequestNotificationAuthorizationJob:l}=r.get(c.w.Notifications),d=[];if(s){const n=e;d.push(function(e,t,n,i,a){return{id:"reset-taskbar-badge-on-account-switch",runOncePerId:!0,job:async()=>{const o=t.newLogger("ResetTaskbarBadgeOnAccountSwitch","apps-notifications");n.config.clientType===nt.sK.Maglev?a&&await e.mutate({mutation:sTe,variables:{accountId:i?.id}}):o.log(Twe.hL.NotEnabled)}}}(n,i,a,t,o))}return l&&d.push(function(e,t){return{id:"request-notification-authorization",runOncePerId:!0,job:async()=>{const n=e.newLogger("RequestNotificationAuthorizationJob","apps-notifications"),i=await t.loadModule("toasts");i?.requestNotificationAuthorization?(i.requestNotificationAuthorization(),n.log("Notification authorization requested.")):n.warn("API not available.")}}}(i,n)),d}}var cTe;!function(e){e.alertSound="alertSound",e.incomingCallsAndMeetingStartSound="IncomingCallsAndMeetingStartSound",e.PlayNotificationSoundsWhenBusyOrInMeetings="PlayNotificationSoundsWhenBusyOrInMeetings",e.PlayNotificationSoundsForUrgentAndPriority="PlayNotificationSoundsForUrgentAndPriority",e.respectOsDnDForCustomToasts="respectOsDnDForCustomToasts",e.muteGenericNotifications="muteGenericNotifications",e.useTeamsChimeForToasts="useTeamsChimeForToasts",e.notificationStyleList="notificationStyleList",e.alertSoundType="alertSoundType",e.alertUrgentSoundType="alertUrgentSoundType"}(cTe||(cTe={}));const dTe={[cTe.alertSound]:"On",[cTe.incomingCallsAndMeetingStartSound]:"On",[cTe.respectOsDnDForCustomToasts]:"Off",[cTe.muteGenericNotifications]:"Off",[cTe.notificationStyleList]:"Purple",[cTe.PlayNotificationSoundsWhenBusyOrInMeetings]:"On",[cTe.PlayNotificationSoundsForUrgentAndPriority]:"On",[cTe.useTeamsChimeForToasts]:"On",[cTe.alertSoundType]:"Default",[cTe.alertUrgentSoundType]:"DefaultUrgent"};const uTe={[Ot.w$.activity]:GR.HP.activityToast,[Ot.w$.alerts]:GR.HP.alertsToast,[Ot.w$.calls]:GR.HP.callingToast,[Ot.w$.campaignnotifications]:GR.HP.campaignnotificationsToast,[Ot.w$.channels]:GR.HP.channelsToast,[Ot.w$.chats]:GR.HP.chatToast,[Ot.w$.extensions]:GR.HP.extensionsToast,[Ot.w$.reminders]:GR.HP.remindersToast,[Ot.w$.communities]:GR.HP.communitiesToast,[Ot.w$.communitiesevents]:GR.HP.communitiesEventsToast,[Ot.w$.callingdeeplink]:GR.HP.callingToast,[Ot.w$.settingsstore]:GR.HP.activityToast,[Ot.w$.communitiesjoinrequest]:GR.HP.communitiesToast,[Ot.w$.communitiesmembers]:GR.HP.communitiesToast,[Ot.w$.notificationsdeeplink]:GR.HP.notificationsDeepLinkToast},mTe=e=>{const{targetEntity:t}=e.entityOptions;switch(t.type){case Ot.w$.communities:case Ot.w$.communitiesjoinrequest:case Ot.w$.communitiesmembers:const e=t?.dataOptions?.teamId;return e;default:return}},pTe=(e,t,n)=>{if(!t.createDatabag)return;const i=t.createDatabag(),a=e.entityOptions,{targetEntity:o,ringtone:r}=a;switch(o.type){case Ot.w$.calls:i.callingToastType=(o?.dataOptions).toastType;break;case Ot.w$.communities:case Ot.w$.communitiesjoinrequest:i.communitiesToastType=o?.dataOptions?.toastType;break;case Ot.w$.reminders:case Ot.w$.chats:case Ot.w$.callingdeeplink:i.chatToastType=o?.dataOptions?.toastType;break;case Ot.w$.notificationsdeeplink:i.notificationsDeepLinkToastType=(o?.dataOptions).toastType}return n&&(i.isCustomNotification=n),i.ringtone=r,i};const gTe=(e,t)=>{const n=e.collectionId||e.targetEntity.dataOptions?.userContextId;return t?$be(n):n};var hTe,vTe;!function(e){e.DND="DND",e.Presenting="Presenting",e.MeetingOrCall="MeetingOrCall",e.OSDnD="OSDnd",e.SuppressedDueToSilentLaunch="SuppressedDueToSilentLaunch",e.SuppressedByGeneralMute="SuppressedByGeneralMute",e.SuppressedByGeneralMuteIncludingUrgentAndPriority="SuppressedByGeneralMuteIncludingUrgentAndPriority"}(hTe||(hTe={})),function(e){e.UrgentToast="UrgentToast",e.IncomingCall="IncomingCall",e.SingleAccount="SingleAccount",e.AllowedByPresence="AllowedByPresence",e.AllowedInMeetingOrCall="AllowedInMeetingOrCall"}(vTe||(vTe={}));const yTe=(e,t,n,i,a,o,r,s,l)=>{const{enableNotificationsFiltering:d}=e.get(c.w.Notifications),{enableHonoringPresenceForNotification:u}=e.get(c.w.Calling);if(!d)return t.log($t.n.NotEnabled),n;const m=n.entityOptions,{dropNotification:p,reason:g}=fTe(o,r,m,e,t,l);return t.log(`Is toast dropped: ${p} because "reason: ${g}"`),!p&&m?.isUrgent&&a.recordPanelAction({panelRegion:GR.rP.notificationsApp,actionScenario:GR.vB.priorityToastIssued}),p?(function(e,t,n,i){const a=e.entityOptions,o=[{scenarioName:be.Cu.CrossClientToastView,scenarioId:e.command.correlation.id},{scenarioName:a.crossClientScenarioName,scenarioId:a.callId||e.command.correlation.id},{scenarioName:be.Cu.WebToastShow,scenarioId:e.command.correlation.id}];o.forEach((({scenarioName:e,scenarioId:a})=>{if(e&&a){const o=n.findScenarioByNameAndId(e,a);o?o.incomplete({reason:t}):i.errorToTelemetry?.(`AppsNotifications: Could not find scenario with name: ${e} and id: ${a}`,"app_notifications_scenario_not_found",void 0,!0)}}))}(n,g,i,t),void STe(a,g)):(u&&m.isIncomingCall&&function(e,t,n){n.infoToTelemetry?.("[sendDroppedCallStatus] Notification was not dropped by Presenting/DND; Sending canNotifyForCallingNotification action","app_notifications");try{kwe(e,"canNotifyForCallingNotification",t.entity.id)}catch(e){n.errorToTelemetry?.("[sendDroppedCallStatus] Could not send call dropped state mutation","app_notifications",{error:`${e.message}`},!0)}}(s,n,t),n)},STe=(e,t)=>{const n={[hTe.DND]:GR.DB.toastDiscardedByDND,[hTe.MeetingOrCall]:GR.DB.toastDiscardedByMeetingOrCall,[hTe.Presenting]:GR.DB.toastDiscardedByPresenting,[hTe.OSDnD]:GR.DB.toastDiscardedByOSDND,[hTe.SuppressedDueToSilentLaunch]:GR.DB.toastDiscardedBySilentLaunch,[hTe.SuppressedByGeneralMute]:GR.DB.toastDiscardedByTeamsMuteNotifications,[hTe.SuppressedByGeneralMuteIncludingUrgentAndPriority]:GR.DB.toastDiscardedByTeamsMuteUrgentAndPriorityNotifications};e.recordPanelAction({panelRegion:GR.rP.notificationsApp,actionScenario:GR.vB.toastDiscarded,actionScenarioType:n[t]})},fTe=(e,t,n,i,a,o)=>{const{disableNotificationsForSilentLaunch:r,enableUserIdMismatchFix:s}=i.get(c.w.Notifications),{launchIntent:l}=i.get(c.w.HostCapabilities);if(r&&"LaunchCoreNoSystemTray"===l)return{dropNotification:!0,reason:hTe.SuppressedDueToSilentLaunch};const d=function(e,t,n,i){const a=vwe(n);if(a!==SL.Ck.Standard)return;const o=e.getBlockedState(i),r=o?.blocks?.find((e=>e.blockingReasons[jbe.GeneralMute]&&e.userId===t)),s=o?.blocks?.find((e=>e.blockingReasons[jbe.GeneralMuteIncludingUrgentAndPriority]));if(i.log(`isBlockedByGeneralMuteSetting: ${r}, any blocks present: ${!!o?.blocks}`),i.log(`isUrgentOrPriorityNotificationBlockedByGeneralSetting: ${s}, any blocks present: ${!!o?.blocks}`),r&&!n.isUrgent)return{dropNotification:!0,reason:hTe.SuppressedByGeneralMute};if(r&&s&&n.isUrgent)return{dropNotification:!0,reason:hTe.SuppressedByGeneralMuteIncludingUrgentAndPriority};return}(e,o,n,a);if(d)return d;const u=n?.isUrgent;if(u)return{dropNotification:!1,reason:vTe.UrgentToast};const m=function(e,t){const n=e.getBlockedState(t),i=n?.blocks?.find((e=>e.blockingReasons.Presenting));return t.log(`isNotificationBlockedByPresenting: presentingBlockedState: ${i}, any blocks present: ${!!n?.blocks}`),!!i}(e,a);if(m)return{dropNotification:!0,reason:hTe.Presenting};if(n.isIncomingCall&&!i.get(c.w.Notifications)?.onlyPriorityCallsInDnD)return{dropNotification:!1,reason:vTe.IncomingCall};if(function(e,t,n){const i=vwe(t);if(i!==SL.Ck.Standard)return!1;const a=e.getBlockedState(n),o=a?.blocks?.find((({blockingReasons:e})=>Object.keys(e).find((t=>e[t]===jbe.MeetingOrCall))));return!!o}(e,n,a))return{dropNotification:!0,reason:hTe.MeetingOrCall};const p=function(e,t,n,i){const a=gTe(t,i);if(!a)return!1;const o=e.getUserBlockedState(n,a,i);return!!o?.blockingReasons.DoNotDisturb}(e,n,a,Boolean(s));return p?{dropNotification:!0,reason:hTe.DND}:i.get(c.w.Notifications)?.enableOSDnDSupportForCustomToasts&&function(e,t,n,i){if(!i)return void n.log("User id is missing, isNotificationBlockedByOsDnD returns false");const a=e.shouldDropToastBasedOnDnD(i,n),o=t?.targetEntity.type===Ot.w$.calls;if(o)return!1;return a}(t,n,a,o)?{dropNotification:!0,reason:hTe.OSDnD}:{dropNotification:!1,reason:vTe.AllowedByPresence}};class kTe{constructor(e,t,n){this.setTimeout=e,this.clearTimeout=t,this.timer=0,this.remainingTimeOnScreen=0,this.startTimeInMS=0,this.toast=n.toast,this.callback=n.callback,this.remainingTimeOnScreen=this.toast.displayDuration||uwe.FIVE_SECONDS}cancelTimer(){this.clearTimeout(this.timer)}resetTimer(){this.remainingTimeOnScreen=this.toast.displayDuration||uwe.FIVE_SECONDS,this.cancelTimer(),this.startTimer()}pauseTimer(){const e=Date.now()-this.startTimeInMS;this.remainingTimeOnScreen-=e,this.cancelTimer()}startTimer(e){this.startTimeInMS=Date.now(),e&&(this.remainingTimeOnScreen=e),this.timer=this.setTimeout((()=>{this.callback()}),this.remainingTimeOnScreen)}}class CTe{constructor(){this.registeredCallbacks=[],this.dismissCallbacks=[],this.priorityMap={[SL.YH.Call]:new Map,[SL.YH.High]:new Map,[SL.YH.Normal]:new Map},this.timers=new Map,this.prevActiveToasts=[],this.defaultTimerForStandardNotifications=uwe.FIVE_SECONDS,this.window=(0,Un.z)()}overrideDefaultTimerForStandardNotifications(e){this.defaultTimerForStandardNotifications=e||uwe.FIVE_SECONDS}registerDependencies(e,t,n){this.logger=e,this.scenarioFactory=t,this.client=n}registerOnStateChangedCallback(e){this.registeredCallbacks.push(e),this.generateUpdatedActiveState()}registerOnDismissCallback(e){this.dismissCallbacks.push(e)}pinToast(e){const t=this.prevActiveToasts.find((({id:t})=>t===e));t&&(t.pinned=!0,this.timers.get(e)?.pauseTimer())}unpinToast(e){const t=this.prevActiveToasts.find((({id:t})=>t===e));t&&(t.pinned=!1,this.timers.get(e)?.startTimer(),this.generateUpdatedActiveState())}addIncomingToast(e){const t=this.getPriority(e);e.displayDuration=this.getDisplayDuration(e);const n=this.priorityMap[t].get(e.id);if(n?.pinned)return this.findAssociatedScenarios(e,(e=>e.incomplete({reason:"updateToPinnedToast"}))),void this.log(`Discarding ${e.id} toastType: ${e.type} as it is an update to a pinned toast`);n&&!this.prevActiveToasts.find((e=>e.id===n.id))&&this.findAssociatedScenarios(n,(e=>e.incomplete({reason:"updatedBeforeBeingShown"})));const i=e.type===SL.Ck.Calling?void 0:uwe.THIRTY_SECONDS;this.resetTimer(e,i),this.priorityMap[t].set(e.id,e),this.generateUpdatedActiveState(e),this.log(`Adding ${e.id} toastType: ${e.type} to Notification queue`)}dismissToast(e,t=!0,n=!1){const i=this.getPriority(e);this.priorityMap[i].delete(e.id);const a=this.prevActiveToasts.findIndex((({id:t})=>t===e.id));this.prevActiveToasts.splice(a,1),this.cancelTimer(e),this.dismissCallbacks.forEach((t=>{t(e,n?"timeout":"unknown",this.client,this.logger)})),t&&(this.generateUpdatedActiveState(),n&&!e.shown&&this.findAssociatedScenarios(e,(e=>{e.incomplete({reason:"noSlotAvailable"})})),this.log(`${e.id}: Dismiss ${n?"by timer":""}`))}log(e){if(!this.logger)return;let t=0;for(const e of Object.keys(this.priorityMap)){t+=this.priorityMap[e].size}this.logger.log(`CN:${e} activeToasts: ${this.prevActiveToasts.length} totalToasts: ${t}`)}generateUpdatedActiveState(e){let t=[];for(const e of Object.keys(this.priorityMap)){const n=this.priorityMap[e];t=t.concat(Array.from(n.values()))}let n=-1;for(let e=this.prevActiveToasts.length-1;e>=0;e--)if(this.prevActiveToasts[e].pinned){n=e;break}const i=-1===n?[]:this.prevActiveToasts.slice(0,n+1),a={};i.map((e=>a[e.id]=e)),t=t.filter((e=>!a[e.id])),t=t.slice(0,3-i.length);const o=i.concat(t);this.replaceActiveToasts(o,e),o.forEach((e=>e.shown=!0));for(const e of this.registeredCallbacks)e({activeToasts:[...o].reverse()})}replaceActiveToasts(e,t){const n={};e.map((e=>n[e.id]=e));const i={};this.prevActiveToasts.map((e=>i[e.id]=e));for(const e of Object.keys(i)){const t=i[e];n[e]||(this.dismissToast(t,!1),delete i[e])}for(const e of Object.keys(n)){const t=n[e];t.type===SL.Ck.Calling||i[e]||this.resetTimer(t)}t&&n[t.id]&&t.type!==SL.Ck.Calling&&this.resetTimer(t),this.prevActiveToasts=e}resetTimer(e,t){const n=this.timers.get(e.id);if(n)return void n.resetTimer();const i=new kTe(this.window.setTimeout,this.window.clearTimeout,{toast:e,callback:()=>{this.dismissToast(e,!0,!0)}});this.timers.set(e.id,i),i.startTimer(t)}cancelTimer(e){this.timers.get(e.id)?.cancelTimer(),this.timers.delete(e.id)}getPriority(e){switch(e.type){case SL.Ck.Calling:case SL.Ck.MeetingNudge:return SL.YH.Call;case SL.Ck.MSN:return SL.YH.High;default:return SL.YH.Normal}}getDisplayDuration(e){if(e.displayDuration)return e.displayDuration;switch(e.type){case SL.Ck.Calling:case SL.Ck.MeetingNudge:return uwe.SIXTY_TWO_SECONDS;case SL.Ck.MSN:return uwe.TWENTY_SECONDS;default:return this.defaultTimerForStandardNotifications}}findAssociatedScenarios(e,t){const n=[be.Cu.CrossClientToastView,be.Cu.WebToastShow];e.type===SL.Ck.Calling&&e.telemetry.callingScenarioName&&n.push(e.telemetry.callingScenarioName),n.forEach((n=>{const i=this.scenarioFactory?.findScenarioByNameAndId(n,e.telemetry.toastScenarioClientId);i&&t(i)}))}}const bTe=(e,t)=>{const n=vwe(t);return{id:t.targetEntity.id||e,mainImageSrc:t.mainImage?.src||"",title:t.title,composedTitle:t.composedTitle,text:t.text,composedText:t.composedText,type:n,isIncomingCall:Boolean(t.isIncomingCall),isUrgent:Boolean(t.isUrgent),actions:t.buttons?.map((e=>({text:e.text,style:e.style,img:e.image?.src,targetEntity:e.targetEntity}))),headerTitle:t.headerTitle,headerSubTitle:t.headerSubtitle,headerImageSrc:t.headerImage?.src||"",ringtone:t.ringtone,deviceLabel:t.deviceLabel,deviceId:t.deviceId,applicationDeviceId:t.applicationDeviceId,deviceLabelSecondary:t.deviceLabelSecondary,deviceIdSecondary:t.deviceIdSecondary,applicationDeviceIdSecondary:t.applicationDeviceIdSecondary,targetEntity:t.targetEntity,isSilent:t.isSilent,textInput:t.textInput,telemetry:{callingScenarioName:t.crossClientScenarioName,callId:t.callId,toastType:t.targetEntity.dataOptions.toastType,toastScenarioClientId:e},mtmaHeader:t.mtmaHeader,displayDuration:t.displayDuration,externalAppIconType:t.externalAppIconType,isSquareImage:Boolean(t.isSquareImage),timeoutAction:t.timeoutAction}},wTe=async(e,t,n,i)=>{if(!e)return i.errorToTelemetry?.("Toast activated with notificationsHandler unset","app_notifications_activation_handler_not_found"),n;const a=n.entityOptions,o=a?.targetEntity?.id;if(!o||!a)return i.errorToTelemetry?.("Toast activated with toast id unset","app_notifications"),n;const r=bTe(o,a);e&&a.targetEntity.id&&t?.dismissToast(r,"ActivatedByUser");const s=((e,t)=>{switch(e.type){case Ot.w$.chats:case Ot.w$.channels:return Swe({isOnWeb:!0,targetEntity:e,startTimestamp:t.startTimestamp?+t.startTimestamp:Date.now()},t);case Ot.w$.calls:return;case Ot.w$.notificationsdeeplink:return ywe({isOnWeb:!0,targetEntity:e,startTimestamp:t.startTimestamp?+t.startTimestamp:Date.now()});default:return}})(a.targetEntity,n.command.correlation);s&&await e.activateNotification(s)};class TTe{constructor(e,t,n){this.entityCommand=e,this.isRtl=t,this.scenario=n,this.shown=!1}getWebToastOptions(){return this.entityCommand.entityOptions}getNotificationOptionsPayload(){const e=this.entityCommand.entityOptions;return{notificationTitle:e.title,notificationOptions:{body:e.text,icon:e.mainImage?.src,timestamp:new Date(e.time).getTime(),tag:void 0,requireInteraction:!0,dir:this.isRtl?SL.b7.Rtl:SL.b7.Auto}}}registerGetNotificationCallback(e){this.getNotificationCallback=e}getNotification(){return this.getNotificationCallback?.()}addCloseNotificationListener(e){this.closeNotificationCallback=e,this.getNotification()?.addEventListener("close",e)}closeNotification(){const e=this.getNotification();this.closeNotificationCallback&&(e?.removeEventListener("close",this.closeNotificationCallback),this.closeNotificationCallback=void 0),e?.close()}}const ITe=(e,t)=>{t.registerOnDismissCallback((t=>{e?.dismissToast(t,"DismissedWithInAppToast")})),t.registerOnDismissCallback(DTe)},NTe=e=>{e.registerOnDismissCallback(((t,n)=>{if("timeout"===n){const n=e.getNotification(t.id);n&&(n.closeNotification(),n.scenario.stop({reason:"Timeout"}),e.deleteNotification(t.id))}}))},ATe=e=>{e.registerOnStateChangedCallback((async({activeToasts:t})=>{ETe(t,e),FTe(t,e),await _Te(t,e)}))},ETe=(e,t)=>{for(const n of t.getToastIds()){const i=t.getNotification(n);!e.find((e=>e.id===n))&&i&&(i.closeNotification?.(),i.scenario.stop(),t.deleteNotification(n))}},FTe=(e,t)=>{e.length&&e.forEach((n=>{const i=n.id,a=t.getNotification(i);a&&a.shown&&n.id!==e[e.length-1].id&&(a.closeNotification(),a.scenario.stop({reason:"DismissedByHigherPriorityNotification"}),t.deleteNotification(i))}))},_Te=async(e,t)=>{if(e.length){const n=e[e.length-1];if(t.isExistingToast(n.id)){const e=t.getNotification(n.id);if(e&&!e.shown&&t.notificationsHandler){e.shown=!0;switch(await t.notificationsHandler.tryShowBrowserNotification(e)){case"queued":e.scenario.mark(be.BQ.BrowserToastStepRequested),e.addCloseNotificationListener((()=>{t.dismissToast(n,"DismissedByUser")}));break;case"skippedNoPermissions":t.dismissToast(n,"SkippedNoPermissions");break;case"skippedAppInFocus":t.dismissToast(n,"SkippedAppInFocus");break;default:t.dismissToast(n,"SkippedReasonUnknown")}}}}},DTe=(e,t,n,i)=>{if("timeout"===t&&e.isIncomingCall)if(n){i?.log("[dismissToast] Notification dismissed due to timeout; Sending TimeOut action");try{kwe(n,e.timeoutAction||"",e.id)}catch(e){i?.errorToTelemetry?.("[dismissToast] Could not send timeout state mutation","app_notifications",{error:`${e.message}`},!0)}}else i?.errorToTelemetry?.("[dismissToast] Cannot invoke timeout callback for dismiss notification","app_notifications",{error:"Apollo client not available"},!0)},PTe=!0;function MTe({callId:e,isSilent:t,isUrgent:n},i,a,o,r){const{enableNotificationsAdvancedSoundSettings:s}=o.get(c.w.Notifications);if(!function(e,t,n,i){if(!t||!i)return!0;const{enableNotificationsAdvancedSoundSettings:a}=e.get(c.w.Notifications),o=RTe(t[cTe.PlayNotificationSoundsWhenBusyOrInMeetings],n);if(a&&!o)return n.log("Sound for notification muted because user is busy or in a meeting"),!1;return!0}(o,i,a,r))return!1;if(s&&n)return function(e,t){if(!e)return!0;const n=RTe(e[cTe.PlayNotificationSoundsForUrgentAndPriority],t);n||t.log("Sound for urgent or priority notification muted");return n}(i,a);if(!function(e,t){const{showGenericNotificationsSoundSetting:n,showNotificationsCallsSoundSetting:i}=t.get(c.w.Notifications);if(e&&i)return!0;if(!e&&n)return!0;return!1}(e,o))return a.log("Allowing to play toast sounds as the sound check feature is disabled"),PTe;if(!i)return a.warn("Returning default value. SettingsCache is undefined"),PTe;if(e){const e=RTe(i[cTe.incomingCallsAndMeetingStartSound],a);return void 0!==t&&!1!==e?!t:e}return RTe(i[cTe.alertSound],a)}function RTe(e,t){const n=function(e,t){switch(e){case"On":return!0;case"Off":return!1;default:return t.warn(`Fall back to play toast sounds as the setting is ${e}`),PTe}}(e,t);return t.log(`Allowed to play sound: ${n}`),n}var xTe=n(49350);const LTe={Default:"msteams-asset://teams_notification.mp3",MeetingStarted:"msteams-asset://teams_meet_up_reminder.mp3"};var OTe;function jTe(e,t,n,i){if(!n)return i.error("Trying to apply ringtone to toast command: user settings are missing."),e;const a=e.entityOptions;if(!a.isIncomingCall){const e=(a?.targetEntity?.dataOptions).toastType||"";a.ringtone=function(e,t,n,i){const a=e===OTe.MeetingStarted||e===OTe.HuddleMeetingStart||e===OTe.MeetingStartFromLobby;if(a)return LTe.MeetingStarted;const{enableNotificationSoundPicker:o}=t.get(c.w.Notifications);if(!o)return LTe.Default;return i?(0,xTe.yq)(n.alertUrgentSoundType).soundFile:(0,xTe.yq)(n.alertSoundType).soundFile}(e,t,n,a.isUrgent),i.log(`Added ringtone "${a.ringtone?.split("//")[1]}" to toast`)}return e}function BTe(e,t,n,i,a){const o=e.entityOptions;if(!o)return n.error("Trying to apply ringtone data to toast command: entity options are missing"),e;const{enableUserIdMismatchFix:r,enableNotificationsAdvancedSoundSettings:s,enableUseTeamsChimeForToasts:l}=t.get(c.w.Notifications),d=gTe(o,!!r);if(!d)return n.error("Trying to apply ringtone data to toast command: userId not found"),e;const u=i.getUserActivitySettings(d,Boolean(r)),m=s&&a.isUserBlockedBySpecificTypes(n,d,!!r,[jbe.Presence,jbe.MeetingOrCall]);return o.isSilent=!MTe(o,u,n,t,!!m),o.isIncomingCall&&!o.buttons?.length&&(o.isSilent=!0),o.useTeamsChime=!!l&&function(e){return!(!e||"On"!==e.useTeamsChimeForToasts)}(u),n.log(`isSilent: ${o.isSilent};useTeamsChime: ${o.useTeamsChime};(enableUseTeamsChimeForToasts: ${l})`),e.entityOptions=o,function(e,t,n){const{enableUseTeamsChimeForToasts:i}=t.get(c.w.Notifications);if(i&&!e.entityOptions.useTeamsChime)return!0;if(e.entityOptions.ringtone)return n.log("Ringtone already exists on the command"),!0;return!1}(e,t,n)?e:e=jTe(e,t,u,n)}!function(e){e.HuddleMeetingStart="HuddleMeetingStart",e.MeetingStarted="MeetingStart",e.MeetingStartFromLobby="MeetingStartFromLobby"}(OTe||(OTe={}));const UTe=36;async function $Te(e,t,n,i,a,o,r){const s=BTe(e,t,n,i,a);if(!s.entityOptions)return s;const l=s.entityOptions;l.mainImage?.src===SL.aZ.Alert&&(l.mainImage={alt:"",src:y4.$Z});try{l.mtmaHeader=await async function(e,t,n,i){i||n.warn("User tracking service is undefined, the system cannot determine MTMA context but the header will be created");if(i&&i.getAccountMode()!==kR.J.MultipleAccounts)return void n.log("User is logged in to one account, skipping MTMA header");const{enableMtmaHeaderForCustomToasts:a}=t.get(c.w.Notifications);if(!a)return void n.log("MTMA Header feature is disabled");const{email:o,tenantName:r}=await async function(e,t){const n=await e.query({query:Abe});if(!n||!n.data||!n.data.me||!n.data.me.email&&!n.data.me.tenantName)return t.errorToTelemetry?.("User data not available","app_notifications_enrich_command",void 0,!0),{email:void 0,tenantName:void 0};return{email:n.data.me.email,tenantName:n.data.me.tenantName}}(e,n);if(!o)return void n.warnToTelemetry?.("Email is undefined, skipping creation of MTMA header","app_notifications_enrich_command",void 0,!0);if(!r)return n.warnToTelemetry?.("Tenant name is undefined, MTMA header will be created without tenant name for TFL","app_notifications_enrich_command",void 0,!0),WTe(o,"",UTe);const s=WTe(o,r,UTe);return n.log(`Created formatted header. Length: ${s.length}, args intial length: {email: ${o.length}, tenant name length: ${r.length}}`),s}(o,t,n,r)}catch(e){n.warnToTelemetry?.("Error getting MTMA header:","app_notifications_enrich_command",e,!0)}return s}function WTe(e,t,n){const i=Math.floor(.6*n)-1;let a=e.length<i?e.length:i;const o=n-a-2-1;return t.length<o&&(a=n-t.length-2-1),e.length>i&&(e=`${e.slice(0,a-3).trim()}...`),t.length>o&&(t=`${t.slice(0,o-3).trim()}...`),t?`${e} - ${t}`:`${e}`}const VTe=(e,t,n,i,a)=>{((e,t)=>{ITe(e,t),NTe(e),ATe(e)})(a,i);return o=>{const{entityCommand:r,entityCommand:{entityOptions:s,entity:{type:l,action:d}},notificationsHandler:u,requestContext:{scenarioFactory:m,loggerFactory:p,coreSettings:h,userBiService:v,client:y,userTrackingService:S},windowProvider:f}=o,k=p.newLogger("NotificationsApp_OnBeforeCommandHandled","apps-notifications");if(l===ke.ck.notificationsdeeplink)return Promise.resolve(void 0);if(l===ke.ck.externalnavigation&&d===ke.SY.empty)return(async(e,t,n,i)=>{const{enableMacOsSettingsBanner:a,enableWarnUserNotificationSettings:o}=e.get(c.w.Notifications,["enableMacOsSettingsBanner","enableWarnUserNotificationSettings"]);if(!a&&!o)return t.log("Banner's link to OS Notifications settings page not enabled by feature flag"),Promise.resolve(n);let r="ms-settings:notifications";return a&&(r="x-apple.systempreferences:com.apple.preference.notifications?id=com.microsoft.teams2"),i?.open(r,"_blank"),t.log("OS Notification settings page opened"),Promise.resolve(void 0)})(h,k,r,f);const{enableInAppNotificationsForCalls:C,enableOutOfTabNotificationSetting:b,enableBrowserToasts:w}=h.get(c.w.Notifications,["enableInAppNotificationsForCalls","enableOutOfTabNotificationSetting","enableBrowserToasts"]);return l===ke.ck.externalnavigation&&d===ke.SY.manage?(async e=>(Notification.requestPermission().then((t=>{e.log(`Permission changed from the banner: ${t}`)})),Promise.resolve(void 0)))(k):b&&l===ke.ck.browsernotificationsbannerdismissed&&d===ke.SY.info?function(e){const t=e.localStorage.getItem(rwe.BROWSER_NOTIFICATION_SETTINGS_BANNER_DISMISS);return e.localStorage.setItem(rwe.BROWSER_NOTIFICATION_SETTINGS_BANNER_DISMISS,(t?Number(t)+1:1).toString()),Promise.resolve(void 0)}(f):l===ke.ck.toasts?r.entity.action===ke.SY.confirm?wTe(u,a,r,k):r.command.visibilityState===g.Rp.hide?function(e,t,n){const{enableCustomNotificationsForCalls:i}=e.get(c.w.Core,["enableCustomNotificationsForCalls"]);return i||t||n}(h,Boolean(C),Boolean(w))?qTe(i,a,r,!!C,h,u):Promise.resolve(r):r.command.visibilityState===g.Rp.show?HTe(h,k,r,m,v,e,t,n,a,y,u,S,s):(k.warn(`Unsupported combination of action ${r.entity.action} and visibilityState ${r.command.visibilityState} for EntityType.toasts`),Promise.resolve(r)):(k.warn(`Entity type is not of EntityType.toasts or EntityType.externalnavigation, received one is: ${r.entity.type}`),Promise.resolve(r))}},HTe=async(e,t,n,i,a,o,r,s,l,d,u,m,p)=>{let g;GTe(i,n,u);const{enableBrowserToasts:h,enableUserIdMismatchFix:v}=e.get(c.w.Notifications,["enableBrowserToasts","enableUserIdMismatchFix"]);h&&(g={browserToastScenario:YTe(i,n)});const y=i.findScenarioByNameAndId(be.Cu.CrossClientToastView,n.command.correlation.id),S=u?.isCustomNotificationsEnabled(n.entityOptions);y&&y.appendEventData({isCustomNotification:S});const f=p?.targetEntity.dataOptions.userContextId||"",k=v?$be(f):f;let C=yTe(e,t,n,i,a,o,r,d,k);return C?(C=await $Te(C,e,t,s,o,d,m),((e,t,n)=>{const{entityOptions:i}=e,a=i?.targetEntity.type,o=uTe[a];if(a&&o){const i=pTe(e,t,n);t.recordPanelView({panelLaunchMethod:JB.D2.notification,panelRegion:GR.rP.toast,dataBag:i,appName:"apps-notifications",panelType:o,teamId:mTe(e)}),i?.dispose()}})(C,a,S),function(e,t,n,i,a,o){if(!e)return void a.warn("Entity options are not found, skipping creating OS DnD coachmark");const r=n.getSettingStateForUser(o,cTe.notificationStyleList)===nTe.d.Native,s=e.targetEntity.type,l=uTe[s];l!==GR.HP.callingToast&&!t.isHonoringDnDEnabled(o,a)&&t.isOSDnDEnabled(a)&&r&&i.recordPanelAction({panelRegion:GR.rP.toast,panelType:l,actionScenario:GR.vB.toastIssuedDuringOsDndOn,actionScenarioType:GR.DB.issueToastDuringDnDOnForExNativeToastsUsers})}(C.entityOptions,r,s,a,t,k),g&&zTe(u,l,n,g.browserToastScenario),Promise.resolve(C)):(g?.browserToastScenario.stop({reason:"SkippedByFilters"}),Promise.resolve(C))},zTe=(e,t,n,i)=>{if(!e)return void i.stop({reason:"ErrorMissingNotificationsHandler"});const a=n.entityOptions,o=a.targetEntity.id;if(!o)return void i.stop({reason:"ErrorMissingToastId"});const r=new TTe(n,t.isRtl,i),s=bTe(o,a);if(t.isExistingToast(o)){const e=t.getNotification(o);e?.scenario.stop({reason:"DismissedToUpdateContent"}),e?.getNotification()?.close()}i.mark(be.BQ.BrowserToastStepAddedToStateContainer),t.addIncomingToast(s,r)},qTe=async(e,t,n,i,a,o)=>{const{enableBrowserToasts:r}=a.get(c.w.Notifications),s=n.entity.id,l=n.entityOptions;if(!s||!l)return Promise.resolve(void 0);const d=bTe(s,l);return r&&o&&l.targetEntity.id&&t?.dismissToast(d,"DismissedByApplication"),e.dismissToast(d),Promise.resolve(i?n:void 0)},GTe=(e,t,n)=>{const i=e.newScenario(be.Cu.WebToastShow);i.clientId=t.command.correlation.id;const a=t.entityOptions;return i.appendEventData({mainEntityType:a?.targetEntity?.type,isCustomNotification:n?.isCustomNotificationsEnabled(a)||n?.isInAppNotificationsEnabled(a)}),e.hoistScenarioToCore?.(i),i},YTe=(e,t)=>{const n=e.newScenario(be.Cu.BrowserToast);return n.appendEventData({mainEntityType:t.entityOptions?.targetEntity?.type}),e.hoistScenarioToCore?.(n),n};var QTe=n(704695);const JTe={eventHandlers:{onEventReceived:async e=>{const{eventInput:t,notificationsHandler:n,requestContext:{coreSettings:i,loggerFactory:a,hostCommunicationService:o}}=e,r=t.event,s=a.newLogger("NotificationsEventHandlers","apps-notifications"),{enableInAppNotifications:l}=i.get(c.w.Notifications,["enableInAppNotifications"]);if(r.originator!==QTe.Nv)return s.errorToTelemetry?.(`Unhandled event ${t.event.type} is not a notification event`,"app_notifications_unhandled_event"),Promise.resolve(void 0);let d,u;switch(r.type){case QTe.mu.activateChatToast:d=r.data?.(),u=Swe({...d,isOnWeb:Boolean(l)});break;case QTe.mu.activateCallToast:d=r.data?.(),u=(e=>{const{targetEntity:t,isOnWeb:n,startTimestamp:i}=e,a=t.dataOptions,o=pwe(i);return{command:gwe(n,o),entity:hwe(t),dataOptions:{...a},entityOptions:{...a}}})({...d,isOnWeb:Boolean(l)});break;case QTe.mu.activateGraphItemToast:d=r.data?.(),u=(e=>{const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions;return{command:{correlation:pwe(n),stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entity:hwe(t),dataOptions:{...i}}})({...d,isOnWeb:Boolean(l)});break;case QTe.mu.activateNotificationDeeplink:d=r.data?.(),u=ywe({...d,isOnWeb:Boolean(l)});break;case QTe.mu.activateCommunitiesToast:d=r.data?.(),u=(e=>{const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions;return{command:{correlation:pwe(n),stateTransition:g.Ar.flush,visibilityState:g.Rp.show},entity:hwe(t),entityOptions:{...i},dataOptions:i}})({...d,isOnWeb:Boolean(l)});break;case QTe.mu.activateRemindersToast:d=r.data?.(),u=(e=>{const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions,a=pwe(n);return{command:gwe(!0,a),entity:{...hwe(t),type:ke.ck.chats},entityOptions:{messageId:i.messageId,focusOnLoad:void 0,...i},dataOptions:{...i}}})({...d,isOnWeb:Boolean(l)});break;case QTe.mu.activateAlerts:d=r.data?.(),u=function(e){const{targetEntity:t,startTimestamp:n}=e;return{command:{correlation:pwe(n),stateTransition:g.Ar.forceFlush,visibilityState:g.Rp.show,targetWindow:g.BA.main},entity:{type:ke.ck.default,action:ke.SY.default},dataOptions:{...t.dataOptions}}}({...d,isOnWeb:Boolean(l)});break;case QTe.mu.files:(async(e,t)=>{try{const t=await e.loadModule("files");if(!t?.openLocalRecordingFolder)throw Error("filesModule is not available.");await t.openLocalRecordingFolder()}catch(e){t.errorToTelemetry?.("Open local recording folder failed.","cmd_recordings_open_local_recording_folder_failed")}})(o,s);break;case QTe.mu.resizeWindow:d=r.data?.(),n.resizeNotificationsWindow(d);break;case QTe.mu.focusWindow:n.focusNotificationsWindow();break;case QTe.mu.sendTelemetry:d=r.data?.(),n.sendTelemetry(d);break;case QTe.mu.sendDismissToastTelemetry:d=r.data?.(),n.sendDismissToastTelemetry(d);break;case QTe.mu.settingsstore:d=r.data?.(),u=function(e){const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions,a=i?.subMenu;return{entity:{type:ke.ck.settingsstore,action:ke.SY.default,...a?{id:a}:{}},command:{stateTransition:g.Ar.flush,visibilityState:g.Rp.show,correlation:pwe(n)},dataOptions:{...i}}}({...d,isOnWeb:Boolean(l)});break;case QTe.mu.offsetNotificationsWindow:d=r.data?.(),n.offsetNotificationsWindow(d.offset);break;default:s.errorToTelemetry?.(`Unhandled event ${t.event.type}`,"app_notifications_unhandled_event")}return u&&n.activateNotification(u),Promise.resolve(void 0)}}},KTe=({coreSettings:e,stateContainer:t,NotificationsRenderer:n,loggerFactory:i,scenarioFactory:a,host:o})=>{const{entity:{id:r},getEntityOptions:s}=(0,FX.At)(),l=(0,IX.useNovaEventing)(),d=Or.useRef(!1),u=(0,A8.m)(),m=Or.useMemo((()=>{const e=i.newLogger("NotificationsApp","apps-notifications");return t.registerDependencies(e,a,u),e}),[i,a,t,u]);m.log(`${dwe}Parsing notification details`);const p=s(ke.ck.toasts,ke.SY.view);let g;if(r){d.current||(!function(e,t){const{delayCustomNotificationsWindowCreation:n,enableCustomNotificationWindowOffset:i,customNotificationWindowOffset:a}=e.get(c.w.Notifications,["delayCustomNotificationsWindowCreation","enableCustomNotificationWindowOffset","customNotificationWindowOffset"]);n&&i&&t.generateEvent({event:QTe.AZ.offsetNotificationsWindow({offset:a})})}(e,l),d.current=!0),g=bTe(p.telemetryClientId||"",p);const{id:t,telemetry:{callingScenarioName:n,callId:i,toastType:a,toastScenarioClientId:o}}=g;l.generateEvent({event:QTe.AZ.sendTelemetry({toastScenarioClientId:o,stepName:be.BQ.RootNotificationRenderBegin,callId:i,callingScenarioName:n,toastType:a})}),m.log(`${dwe}${t}:Beginning to render notification. correlationId=${o} callId=${i} type=${g.type} toastType=${a} scenario=${n}`)}else m.errorToTelemetry?.(`${dwe}: Missing entityId in Toast Command of type ${p.targetEntity.type}`,"app_notifications",void 0,!0);return(0,Lr.Y)(n,{host:o,logger:m,scenarioFactory:a,stateContainer:t,uiToast:g})};const ZTe=e=>{if(XTe(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:eIe(e),endEntity:null}},XTe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=e===Yt.Rm.minimal,o=i===ke.ck.toasts,r=[ke.SY.delete,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},eIe=({entity:e})=>e,tIe=({coreSettings:e})=>{const{enableCustomNotificationWindowOffset:t=!1}=e?.get(c.w.Notifications)??{};return{mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0}},inAppNotificationsEntity:{[se.w.PartialOverlay]:{shouldOffsetInAppNotificationsForActionItems:t}}}},nIe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsNewWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};const iIe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsRestoreTaskbarBadgeOnMainWindowOpenMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"restoreTaskbarBadgeOnMainWindowOpen"}}]}}]};const aIe=({context:{hostCommunicationService:e,coreSettings:t,client:n,loggerFactory:i}})=>{const a=i.newLogger("NotificationsOnExperienceJob","apps-notifications"),o=n,{enableCustomNotificationsForCalls:r,enableCustomNotificationsForChats:s,enableCustomNotificationsOnDesktop:l}=t.get(c.w.Core),{enableRestoreTaskbarBadgeOnWindowOpen:d}=t.get(c.w.Notifications),{allowPrivateCallingPolicy:u}=t.get(c.w.Calling),m=[];if(d&&m.push(function(e,t,n){return{id:"restore-taskbar-badge-on-main-window-open",runOncePerId:!0,job:async()=>{const i=t.newLogger("RestoreTaskbarBadgeOnMainWindowOpenJob","apps-notifications"),a=await n.loadModule("windowcontrols");let o=!0;const r=a?.registerForWindowVisibilityChanged?.((async({visible:t,windowId:n})=>{if(n===await(a?.getWindowByTag?.(Dt.ng.Main)))return t&&!1===o?(o=!0,i.log("Main Window is visible again. Restoring taskbar badge"),void await e.mutate({mutation:iIe})):void(o=t);i.debug(`windowId: ${n} is not the main window. Ignoring this event.`)}));return()=>{r&&r()}}}}(n,i,e)),!l||!r&&!s)return a.debug(`${dwe}CreateNotificationsWindowOnExperienceWarmDisabled`),m;if(!u)return a.debug(`${dwe}CreateNotificationsWindowSkippedAsCallingNotEnabledByPolicy`),m;const{delayCustomNotificationsWindowCreation:p,enableCustomNotificationWindowOffset:g,customNotificationWindowOffset:h}=t.get(c.w.Notifications,["delayCustomNotificationsWindowCreation","enableCustomNotificationWindowOffset","customNotificationWindowOffset"]);return p?(a.log(`${dwe}Creation of notifications window is delayed until 1st notification arrives.`),m):(a.log(`${dwe}Attempting to create notifications window on experience warm.`),m.push(function(e,t){return{id:"create-notifications-window-on-experience-warm-job",runOncePerId:!0,job:()=>(t.newLogger("NotificationsWindowCreation","apps-notifications").log("CN:Issuing mutation to create notifications window."),e.mutate({mutation:nIe,fetchPolicy:"no-cache"}),()=>{})}}(o,i)),g&&m.push(function(e,t,n){return{id:"reposition-notifications-window-on-experience-warm-job",runOncePerId:!0,job:async()=>{const i=t.newLogger("NotificationsWindowReposition","apps-notifications");i.log("Calling pie api to reposition notification window at the bottom");const a=await e.loadModule("toasts");if(a){if(a.offsetNotificationsPanel)return a.offsetNotificationsPanel(n||0);i.error("toasts.offsetNotificationsPanel method not available")}else i.error("cannot load toasts module")}}}(e,i,h)),m)};class oIe{constructor(){this.notificationSettingsCache={}}updateUserActivitySettingsCache(e,t,n,i,a){if(!t)return void a.error("Empty activity settings, update failed");const{enableOSDnDSupportForCustomToasts:o,enableMuteAllNotificationsSetting:r}=n.get(c.w.Notifications),s=function(e,t){const n={...dTe},i=new Map;for(const t of e)t&&i.set(t.key.toLowerCase(),t.value);for(const[e,a]of Object.entries(n)){const o=i.get(e.toLowerCase());o?(n[e]=o,t.debug(`Assigned ${e} setting value ${a}`)):t.debug(`Setting ${e} not found in user settings, fallback to ${a}`)}return n}(t,a);if(a.log(`Settings successfully updated for id ${e}. Generic toasts sound value: ${s[cTe.alertSound]}, calling toasts: ${s[cTe.incomingCallsAndMeetingStartSound]}`),this.notificationSettingsCache[e]=s,o){const t=this.getSettingStateForUser(e,cTe.respectOsDnDForCustomToasts);i.setHonorDnDSettingState(t,a,e)}if(r){const t=this.getSettingStateForUser(e,cTe.muteGenericNotifications);i.setMuteGenericSettingState(t,a,e)}}getUserActivitySettings(e,t){const n=Object.entries(this.notificationSettingsCache),[i,a]=n.find((([n])=>{const i=t?n:n.replace(/-/g,""),a=t?e:e.replace(/-/g,"");return i.includes(a)}))||[];return a}getSettingStateForUser(e,t){return this.notificationSettingsCache[e]?.[t]}}class rIe{constructor(){this.browserNotificationStateContainer=new CTe,this.toastIdToNotification=new Map}initialize(e,t){this.notificationsHandler=e,this.i18n=t}get isRtl(){return!!this.i18n?.isRtl}isExistingToast(e){return!!this.toastIdToNotification.has(e)}getToastIds(){return this.toastIdToNotification.keys()}getNotification(e){return this.toastIdToNotification.get(e)}setNotification(e,t){this.toastIdToNotification.set(e,t)}deleteNotification(e){this.toastIdToNotification.delete(e)}registerOnStateChangedCallback(e){this.browserNotificationStateContainer.registerOnStateChangedCallback(e)}registerOnDismissCallback(e){this.browserNotificationStateContainer.registerOnDismissCallback(e)}addIncomingToast(e,t){this.setNotification(e.id,t),this.browserNotificationStateContainer.addIncomingToast(e)}dismissToast(e,t){t&&this.toastIdToNotification.get(e.id)?.scenario.appendEventData({reason:t}),this.browserNotificationStateContainer.dismissToast(e)}}class sIe{constructor(){this.doNotDisturbState=Hwe.qu.Unrestricted,this.honorOsDoNotDisturbSetting={},this.muteGenericNotificationsSetting={},this.cacheUpdatedCallbacks={}}registerOnCacheUpdatedCallback(e,t){this.cacheUpdatedCallbacks[e]?this.cacheUpdatedCallbacks[e].push(t):this.cacheUpdatedCallbacks[e]=[t]}setOsDoNotDistubState(e,t,n){n.log(`New OS 'Do not Disturb' state set to ${e}`),this.doNotDisturbState=e,this.invokeCacheUpdatedCallbacks(t,n)}setHonorDnDSettingState(e,t,n){t.log(`Setting new state of OS DnD ${e}`),this.honorOsDoNotDisturbSetting[n]=e,this.invokeCacheUpdatedCallbacks(n,t)}setMuteGenericSettingState(e,t,n){t.log(`Setting new state of Mute Generic Notifications ${e}`),this.muteGenericNotificationsSetting[n]=e,this.invokeCacheUpdatedCallbacks(n,t)}isHonoringDnDEnabled(e,t){const n=this.honorOsDoNotDisturbSetting[e];switch(t.log(`Current 'Honor DnD' setting state: ${n}`),n){case nTe.d.On:return!0;case nTe.d.Off:return!1;default:return t.log("Current setting state is undefined, returning isHonoringDnDEnabled: false"),!1}}isOSDnDEnabled(e){switch(this.doNotDisturbState){case Hwe.qu.AlarmsOnly:case Hwe.qu.PriorityOnly:return e.log("isOSDnDEnabled: true"),!0;case Hwe.qu.Unrestricted:return!1;default:return e.log("Current OS DnD state is unrecognised, returning isOSDnDEnabled: false"),!1}}isMuteGenericSettingEnabled(e){return this.muteGenericNotificationsSetting[e]===nTe.d.On}shouldDropToastBasedOnDnD(e,t){return t.log(` \n      [shouldDropToastBasedOnDnD] Honor OS DnD: ${this.honorOsDoNotDisturbSetting[e]}, \n      OS DnD state: ${this.doNotDisturbState}. Checking for userId ${e},  \n      Mute Generic Notification state: ${this.muteGenericNotificationsSetting[e]}. \n      Checking for userId ${e}`),this.isOSDnDEnabled(t)&&!this.isMuteGenericSettingEnabled(e)&&this.isHonoringDnDEnabled(e,t)}invokeCacheUpdatedCallbacks(e,t){this.cacheUpdatedCallbacks[e]&&this.cacheUpdatedCallbacks[e].forEach((n=>n(this.shouldDropToastBasedOnDnD(e,t))))}}const lIe=async e=>{const{entityCommand:t,requestContext:{entityCommanding:n}}=e;if(t.entity.type===ke.ck.notificationsdeeplink){const e=t.dataOptions,i=e?.deeplinkUrl;i&&n.deepLink.executeFromUrlV2(i,t.command)}return Promise.resolve(void 0)},cIe=()=>Promise.all([n.e(912845),n.e(346069),n.e(566555),n.e(383414),n.e(292039)]).then(n.bind(n,791));function dIe(){const e=new Bbe,t=new sIe,n=new oIe,i=new CTe,a=new rIe,o=()=>null;return{...JTe,getAppViewEntities:ZTe,getAppViewEntitiesProps:tIe,getAppWindowFeatures:()=>Nbe.windowFeatures||{},onUserWindowPreWarm:lTe(),onBeforeCommandHandled:VTe(e,t,n,i,a),onPreWarm:rTe(e,t,n,a),onCommandResult:lIe,manifest:Nbe,render:async({loggerFactory:e,scenarioFactory:t,host:n,coreSettings:a})=>{try{const{NotificationsRenderer:o}=await(0,ev.wg)(cIe,"notifications-app",t),{standardNotificationDuration:r}=a.get(c.w.Notifications);return r&&!isNaN(r)&&Number(r)>0&&i.overrideDefaultTimerForStandardNotifications(Number(r)),(0,Lr.Y)(vG.e,{namespaces:["communities","people","toastNotifications"],loaderRenderer:null,children:(0,Lr.Y)(KTe,{coreSettings:a,loggerFactory:e,stateContainer:i,NotificationsRenderer:o,scenarioFactory:t,host:n})})}catch(t){return e.newLogger("NotificationsApp","apps-notifications").errorToTelemetry?.(`CN:Error in notification app render method: ${t.message}`,"app_notifications",void 0,!0),(0,Lr.Y)(o,{})}},onExperienceWarm:aIe}}const uIe={id:"com.microsoft.teams.teamsGallery",name:"TeamsGalleryApp",supportedEntities:[ke.ck.teamsgallery,ke.ck.teams],supportedRenderModes:[se.w.Main,se.w.Rail],getDefaultCommand:()=>({action:ke.SY.view,type:ke.ck.teamsgallery})},mIe=e=>{if(pIe(e))return gIe(e)?{subNavEntity:hIe(e),headerEntity:vIe(e),startEntity:yIe(e),mainEntity:SIe(e),endEntity:fIe(e)}:null},pIe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.teamsgallery,ke.ck.teams].includes(i),r=[ke.SY.create,ke.SY.default,ke.SY.list,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},gIe=()=>!0,hIe=({entity:e})=>e,vIe=()=>null,yIe=()=>null,SIe=({entity:e})=>e,fIe=()=>null,kIe=({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[se.w.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(c.w.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e}}}),CIe=()=>Promise.all([n.e(978582),n.e(268800),n.e(727560),n.e(75192)]).then(n.bind(n,11111));const bIe={id:"com.microsoft.teams.entitymoreinfo",actors:["entitymoreinfo"],name:"EntityMoreInfoApp",supportedRenderModes:[se.w.Configurations]},wIe={gqlTypeName:"EntityMoreInfoAppViewState",queryFieldName:"entityMoreInfoAppViewState",navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{readyToBootstrapLPC:!1},computedValues:void 0},TIe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEntityMoreInfoUsersForConversationQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mriArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isShortProfileRequested"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"peoplePickerFilters"}},type:{kind:"NamedType",name:{kind:"Name",value:"PeoplePickerFiltersInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isSharedChannel"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"hostTenantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUsersForConversation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mriArray"},value:{kind:"Variable",name:{kind:"Name",value:"mriArray"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"isShortProfileRequested"},value:{kind:"Variable",name:{kind:"Name",value:"isShortProfileRequested"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}},{kind:"Argument",name:{kind:"Name",value:"peoplePickerFilters"},value:{kind:"Variable",name:{kind:"Name",value:"peoplePickerFilters"}}},{kind:"Argument",name:{kind:"Name",value:"isSharedChannel"},value:{kind:"Variable",name:{kind:"Name",value:"isSharedChannel"}}},{kind:"Argument",name:{kind:"Name",value:"hostTenantId"},value:{kind:"Variable",name:{kind:"Name",value:"hostTenantId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"companyName"}},{kind:"Field",name:{kind:"Name",value:"tenantName"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"userType"}},{kind:"Field",name:{kind:"Name",value:"isFederated"}},{kind:"Field",name:{kind:"Name",value:"xtapUser"}}]}}]}}]},IIe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEntityMoreInfoLpcStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lpcState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isLivePersonaCardInitialized"}}]}}]}}]},NIe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEntityMoreInfoAuthenticationUsersQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]};var AIe=n(969013),EIe=n(585126);const FIe=e=>{switch(e){case"Card":return"Card";case"Expanded":return"ExpandedView";default:return}},_Ie=e=>{const{ariaLabel:t,coreSettings:n,eventType:i,externalAppSessionCorrelationId:a,host:o,hostConversationId:r,hostTenantId:s,isSharedChannel:l,locationToOpen:d,logger:u,personNodeId:m,tabIndex:p,userBiService:g,smtp:h,upn:v,aadObjectId:y,displayName:S,personaType:f,userId:k}=e;let C,b="Card";switch(i){case"mouseout":case"mousedown":default:C="MouseHover";break;case"click":case"dblclick":C="MouseClick",b=d??"ExpandedView";break;case"keydown":C="KeyboardPress",b=d??"ExpandedView";break;case"app-request":C="AppRequest",b=d??"ExpandedView"}const w=()=>{o?.document.dispatchEvent(new MouseEvent("mousemove"))},T=!!n.get(c.w.People).isInIframe;return{cardParameters:{personaInfo:{identifiers:{PersonaType:f||"NotResolved",HostAppPersonaId:(0,EIe.lz)({userId:k,isSharedChannel:!!l,hostTenantId:s,hostConversationId:r,personNodeId:m}),TeamsMri:k,Smtp:h,Upn:v,AadObjectId:y},displayName:S},behavior:{cardPlacementMode:"AnchorSide",locationToOpen:b,onCardOpen:()=>{o?.document.addEventListener("mouseleave",w);const e={panelRegion:GR.rP.popover,panelType:GR.HP.LivePersonaCard};g?.recordPanelView(e,u)},onCardClose:()=>{o?.document.removeEventListener("mouseleave",w);const e={actionGesture:GR.Od.mouseleave,actionOutcome:GR.nd.closePanel,actionScenarioType:GR.DB.people,actionScenario:GR.vB.closePanel,moduleName:GR.Sn.lpcClose,panelRegion:GR.rP.popover,panelType:GR.HP.LivePersonaCard};g?.recordPanelAction(e,u)},shouldDeferCardOpenToParentWindow:T},externalAppSessionCorrelationId:a,ariaLabel:t,clientScenario:"MicrosoftTeams_MultiWindow",openCardTriggerType:C,cardOpenTime:Date.now()},tabIndex:p}},DIe=async({commandData:{isSharedChannel:e,conversationId:t,smtp:n,upn:i,aadObjectId:a,userId:o,personNodeId:r},tenantId:s,coreSettings:l,client:d,logger:u,host:m})=>{const p=await(async(e,t,n,i,a,o,r,s)=>{const{enableTflSms:l}=o.get(c.w.Messaging),{showPersonCardForSMSUser:d,showPersonCardForXTapUser:u}=o.get(c.w.People),{isCallingScreenInteractive:m,disablePstnPersonaCard:p}=o.get(c.w.Calling),{enableFlyoutInlineChat:g,enableSimplifiedFeaturesInFlyoutChat:h}=o.get(c.w.Flyout);if(!m||g&&h)return!1;if(i)return!0;if(e&&s4.af.isTFLSmsMri(e))return!!l&&!!d;if(e&&s4.af.isTFLOffNetworkUser(e))return!1;if(p&&(0,AIe.Ku)(e))return!1;if(t&&!u){const t=(0,EIe.vU)(e,n,a,"lpc-persona-container",s);if(!t)return s.warn("xTap profile Query variables are not defined for a shared channel"),!1;const{data:i}=await r.query({query:TIe,variables:t});if(!i||!i.getUsersForConversation)return s.warn("xTap profile Query returned null data"),!1;const o=i.getUsersForConversation,l=!!(o.length>0&&o[0]&&s4.af.isFederatedUser(o[0])&&o[0].xtapUser);return!l||!!u&&l}return!0})(o,!!e,t,r,s,l,d,u),{data:{lpcState:g}}=await d.query({query:IIe}),h=!!(o||r||a||n||i);return!!(h&&p&&g?.isLivePersonaCardInitialized&&m?.LPC)||(u.warn(`Lpc is not ready, \n          isIdentifierProvided: ${h},\n          isLpcAllowed: ${!!p},\n          isLivePersonaCardInitialized: ${g?.isLivePersonaCardInitialized}, \n          host.LPC:${!!m?.LPC}\n        `),!1)},PIe=async e=>{const{data:{authenticationUsers:t}}=await e.query({query:NIe,variables:{filter:{isAuthenticated:!0}}});return t[0]?.profile?.tenantId},MIe=(e,t,n)=>n?.LPC.openCard(new n.DOMRect(e.left,e.top,e.width,e.height),t);var RIe=n(796179),xIe=n(897604);const LIe={onCommandReceived:async e=>{const{commandInput:t,host:n,requestContext:{client:i,coreSettings:a,loggerFactory:o},userBiService:r}=e,{command:{action:s,actor:l,data:c}}=t,d=o.newLogger("EntityMoreInfo onCommandReceived","apps-entity-more-info");if(d.log(`Command {action:${t.command.action}} received.`),!bIe.actors.includes(l))return void d.error(`Command {action:${t.command.action}, actor:${t.command.actor}} is sent to the wrong App.`);const u=async(e,o)=>!!await DIe({client:i,commandData:e,coreSettings:a,host:n,logger:d,tenantId:o})||(d.error(`Command failed, LPC is not ready for command: {action:${t.command.action}}}.`),!1);switch(s){case pq:{const e=c,t=e.tenantId||await PIe(i);if(!await u(e,t))return;const o=_Ie({...e,locationToOpen:FIe(e.modality),...t&&{tenantId:t},coreSettings:a,externalAppSessionCorrelationId:(0,E.v4)(),host:n,logger:d,userBiService:r});return void(e.useNewEventObserver&&(e=>!!e?.LPC.eventObserver)(n)?((e,t,n)=>{if(!n)return;const{eventType:i,top:a,left:o,width:r,height:s}=e;let l;switch(i){case"click":l="HoverTargetClick";break;case"mouseenter":l="HoverTargetEnter";break;case"keydown":l="HoverTargetKeyPress";break;case"mouseleave":l="HoverTargetLeave";break;default:return}const c={kind:l,params:{personaInfo:{identifiers:{personaType:t.personaInfo.identifiers.PersonaType,hostAppPersonaId:t.personaInfo.identifiers.HostAppPersonaId,teamsMri:t.personaInfo.identifiers.TeamsMri},displayName:t.personaInfo.displayName},behavior:{cardPlacementMode:["bottom","top","overlap"],onCardOpen:t.behavior.onCardOpen,onCardClose:t.behavior.onCardClose},clientScenario:"MicrosoftTeams_MultiWindow",cardOpenTime:t.cardOpenTime,externalAppSessionCorrelationId:t.externalAppSessionCorrelationId},targetLocation:new n.DOMRect(o,a,r,s)};n.LPC.eventObserver?.next(c)})(e,o.cardParameters,n):MIe(e,o.cardParameters,n))}case gq:{const e=c,t=e.tenantId||await PIe(i);if(!await u(e,t))return;const o=_Ie({...e,...t&&{tenantId:t},locationToOpen:"ExpandedViewOrganizationSection",coreSettings:a,externalAppSessionCorrelationId:(0,E.v4)(),host:n,logger:d,userBiService:r});return void MIe(e,o.cardParameters,n)}case hq:{const e=c,t=e.tenantId||await PIe(i);if(!await u(e,t))return;const o=(({ariaLabel:e,contextId:t,conversationId:n,coreSettings:i,eventType:a,externalAppSessionCorrelationId:o,highlightedText:r,host:s,isSharedChannel:l,logger:c,tenantId:d,topicId:u,userBiService:m,userId:p,clientRequestId:g})=>{const h=_Ie({ariaLabel:e,coreSettings:i,eventType:a,externalAppSessionCorrelationId:o,host:s,hostConversationId:n,hostTenantId:d,isSharedChannel:l,logger:c,userBiService:m,userId:p}),v={contextId:t,highlightedText:r,hideEntityAndContextQuestion:!0,clientRequestId:g};return{...h,cardParameters:{...h.cardParameters,personaInfo:{...h.cardParameters.personaInfo,identifiers:{...h.cardParameters.personaInfo.identifiers,PersonaType:"Topic",TeamsMri:void 0,TopicId:u},topicMetadata:v},behavior:{...h.cardParameters.behavior,onCardOpen:()=>{if(h.cardParameters.behavior.onCardOpen?.(),u){const e=(0,RIe.KB)({userAadObjectId:p,tenantAadObjectId:d});e?.logEvent(xIe.P.TopicCardOpen,{topicId:u})}}}}}})({...e,...t&&{tenantId:t},coreSettings:a,externalAppSessionCorrelationId:(0,E.v4)(),host:n,logger:d,userBiService:r});return void MIe(e,o.cardParameters,n)}default:d.error(`Command action ${s} is not supported at EntityMoreInfoApp.`)}},viewStateRegistration:wIe};var OIe=n(855167);const{useRef:jIe,useEffect:BIe}=Or,UIe=()=>Promise.all([n.e(461500),n.e(669152),n.e(459959),n.e(459467),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(524014),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(288919),n.e(615002),n.e(720843)]).then(n.bind(n,819867)),$Ie=({logger:e,onRenderEvent:t,scenarioFactory:i})=>{const a=(0,OIe.ab)(m.Jj.COMPLETE);e.log(`LpcLazyLoader: isAppPhaseComplete=${a}`);const[o,r]=(0,Or.useState)(null);return(e=>{const t=jIe(),i=jIe(),{host:a,scenarioFactory:o}=(0,QX.ur)();BIe((()=>{e&&(async()=>{const e=()=>n.e(648155).then(n.t.bind(n,102385,23));try{const{freeBootstrapperMemory:n}=await(0,ev.wg)(e,"lpc-teams-bootstrapper",o);t.current=n,i.current=a.__lpcWindowProxy}catch(e){}})()}),[a,e,o]),BIe((()=>()=>t.current&&i.current&&t.current(i.current)),[])})(a),(0,Or.useEffect)((()=>{if(a){const e="entity-more-info-app";t("ChunkLoadStarted",{chunkName:e}),(0,ev.wg)(UIe,e,i).then((e=>r((()=>e.LPC)))),t("ChunkLoadSucceeded",{chunkName:e})}}),[t,i,a]),o&&(0,Lr.Y)(o,{})};const WIe={getDefaultCommand:()=>({type:ke.ck.meetings,action:ke.SY.view}),id:"com.microsoft.teams.meeting-options",name:"MeetingOptionsApp",supportedRenderModes:[se.w.Main,se.w.Modal],supportedEntities:[ke.ck.meetings,ke.ck.meetingsettings,ke.ck.licenses,ke.ck.meetingoptionscreatedialog],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},VIe=e=>{if(HIe(e))return zIe(e)?{subNavEntity:qIe(e),headerEntity:GIe(e),startEntity:YIe(e),mainEntity:QIe(e),endEntity:JIe(e)}:null},HIe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.meetings,ke.ck.meetingsettings,ke.ck.licenses,ke.ck.meetingoptionscreatedialog].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},zIe=()=>!0,qIe=()=>null,GIe=()=>null,YIe=()=>null,QIe=({entity:e})=>e,JIe=()=>null,KIe=()=>({mainEntity:{[se.w.Main]:{isBackgroundTransparent:!0}}}),ZIe=()=>Promise.all([n.e(912845),n.e(273198),n.e(842242),n.e(616161),n.e(255544),n.e(739085),n.e(390761),n.e(85394),n.e(703283),n.e(356701),n.e(94139),n.e(784980),n.e(191448),n.e(824059),n.e(164171),n.e(651881)]).then(n.bind(n,542825));const XIe=({scenarioFactory:e,children:t})=>(eNe(e),(0,Lr.Y)(Or.Fragment,{children:t})),eNe=e=>{const t=Or.useRef(e.findScenario(be.Cu.MeetingOptionsStart));Or.useEffect((()=>{t.current||(t.current=e.cancelExistingAndCreateScenario(be.Cu.MeetingOptionsStart,"remount"))}),[e])},tNe={id:"com.microsoft.teams.unified-consent",name:"UnifiedConsentApp",supportedEntities:[ke.ck.unifiedconsentdialog],supportedRenderModes:[se.w.Modal]},nNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsUnifiedConsentDialogGetConsentStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"consentSurface"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unifiedConsentState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"consentSurface"},value:{kind:"Variable",name:{kind:"Name",value:"consentSurface"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelType"}},{kind:"Field",name:{kind:"Name",value:"platform"}},{kind:"Field",name:{kind:"Name",value:"osVersion"}},{kind:"Field",name:{kind:"Name",value:"deviceId"}}]}}]}}]},iNe={UNSAFE_onSignal:async(e,t)=>{const{coreSettings:n,entityCommanding:i,client:a,loggerFactory:o}=t,{enableUnifiedConsent:r}=n.get(c.w.WindowsSignatureExperiences);if(!r||"main_window_rendered"!==e.type)return;const s=o.newLogger("UCWindowRenderTrigger","apps-unified-consent"),{data:l,error:d}=await a.query({query:nNe,fetchPolicy:"no-cache",variables:{consentSurface:"AppStart"}});d&&s.error(`Failed to query unified consent state: ${d.message}`);const u=l?.unifiedConsentState;u&&u.modelType&&i.unifiedConsent.launchUnifiedConsent(u)}},aNe=()=>Promise.all([n.e(953696),n.e(307422),n.e(641675),n.e(848596)]).then(n.bind(n,490591));const oNe=e=>rNe(e)?{subNavEntity:sNe(e),headerEntity:lNe(e),startEntity:cNe(e),mainEntity:dNe(e),endEntity:uNe(e)}:null,rNe=({entity:e})=>{const{type:t}={...e};return t!==ke.ck.platformstageinactivemeeting},sNe=()=>null,lNe=({entity:e})=>{try{const t=JSON.parse(e.options||"{}");if(e.type===ke.ck.platformstagewithoutchat&&t.isFullScreenApp)return null}catch(t){return e}return e},cNe=()=>null,dNe=({entity:e})=>e,uNe=({entity:e,contextEntity:t})=>{const n=e.linkedEntity,i=e.options;return n?e.type===ke.ck.platformStage&&n.type===ke.ck.chats?{...n,action:ke.SY.view,options:i}:e.type===ke.ck.platformStage&&t?.type===ke.ck.chats?{...t,action:ke.SY.view,options:i}:null:null},mNe={id:"com.microsoft.teams.collab-stage-view",name:"CollabStageViewApp",supportedEntities:[ke.ck.platformStage,ke.ck.platformstageinactivemeeting,ke.ck.platformstagewithoutchat,ke.ck.unsupportedcollabstageerrordialog],supportedRenderModes:[se.w.Main,se.w.HorizontalBar,se.w.Modal],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600,offset:20}},pNe={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==ke.ck.platformStage,shouldRestoreClientToEntities:e=>e.mainEntity?.type!==ke.ck.platformStage},gNe=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{platformAppCriticalPhaseTimeout:i}=t.get(c.w.Extensibility),a=e=>{n.registerAppPhase({phase:m.Jj.CRITICAL,signals:[e],timeout:i||35e3})};switch(e){case se.w.HorizontalBar:a(Gz.m.COLLAB_STAGE_HEADER_TITLE_RENDERED);break;case se.w.Main:a(Gz.m.PLATFORM_APP_FRAME_CONTENT_RENDERED)}return n.appPhases},hNe=async e=>{const{entityCommand:{command:{visibilityState:t,correlation:{id:n}},entityOptions:i},result:a,requestContext:{scenarioFactory:o}}=e,{appId:r,correlationId:s,convId:l,appInstallScope:c,launchScenarioId:d,phase1OnlyScenarioDetails:u}=i||{},m=u?o.findScenarioByNameAndId(u.scenarioMarkerName,u.scenarioMarkerId):null,p=d?o.findScenarioByNameAndId(be.Cu.PlatformTabLaunch,d):null;if(m&&p&&t===g.Rp.show&&n===s){let e;switch(a){case zS.Success:m?.stop(),p?.stop();break;case zS.Failure:const t=`CollabStage window launch scenario failed for appId-${r} with correlationId-${s}, convId-${l} and appInstallScope-${c}`;m?.fail({reason:t}),p?.fail({reason:t});break;case zS.Incomplete:e=`CollabStage window launch scenario is incomplete for appId-${r} with correlationId-${s}, convId-${l} and appInstallScope-${c}`,m?.incomplete({reason:e}),p?.incomplete({reason:e});break;case zS.Canceled:e=`CollabStage window launch scenario is cancelled for appId-${r} with correlationId-${s}, convId-${l} and appInstallScope-${c}`,m?.cancel({reason:e}),p?.cancel({reason:e})}}return Promise.resolve()},vNe=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(787454),n.e(311914),n.e(181316),n.e(598188),n.e(984165),n.e(729849),n.e(484331),n.e(214218),n.e(960122),n.e(964401),n.e(405198),n.e(431784),n.e(567830),n.e(187739),n.e(164734),n.e(56538),n.e(737305),n.e(785043),n.e(307339),n.e(677912),n.e(145619),n.e(899628),n.e(586691),n.e(16570),n.e(439378),n.e(307422),n.e(94139),n.e(449127),n.e(268921),n.e(351715),n.e(711866),n.e(246619),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(40459),n.e(697073),n.e(715192),n.e(936254),n.e(668415),n.e(684694),n.e(53131),n.e(813370),n.e(736704),n.e(385242),n.e(351057),n.e(800350),n.e(399289),n.e(528699),n.e(290799),n.e(376619)]).then(n.bind(n,544798)),yNe=({coreServices:{coreSettings:e},host:t,prevEntityType:n,entityType:i,screenState:a,isResize:o})=>{if((n===ke.ck.platformStage||n===ke.ck.calls)&&i===ke.ck.platformStage)return null;const{minHeight:r,minWidth:s,offset:l=1}=mNe.windowFeatures||{},d=t?.screen;if(o&&!d)return mNe.windowFeatures||null;if(!d)return null;let{height:u=1,width:m=1}=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=mNe.windowFeatures||{};let{width:a,height:o}=mNe.windowFeatures||{};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:d}=t.get(c.w.Calling);if(s&&l&&d)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=d*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/d*a}return{height:o,width:a}})(d,e);const p=d.availHeight-l,g=m>=d.availWidth||u>=p;g&&(u=d.availHeight,m=d.availWidth);const{left:h,top:v}=((e,t,n,i,a)=>{if(i)return{left:0,top:0};const o="availLeft"in e?e.availLeft:0,r="availTop"in e?e.availTop:0,s=o+e.availWidth/2-t/2;let l;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":l=r+a;break;default:l=r+e.availHeight/2-n/2}return{left:s,top:l}})(d,m,u,g,l),y=g?0:(a?.numOpenWindows||1)*l;return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},height:u,left:h+y,minHeight:r,minWidth:s,top:v+y,width:m}};const SNe=e=>{const{entity:{type:t,action:n}}=e;return t===ke.ck.platformStage&&n===ke.SY.create?be.Cu.PlatformTabCollabStageFrameLoading:t===ke.ck.platformstagewithoutchat&&n===ke.SY.view?be.Cu.PlatformTabStageWithoutChatFrameLoading:void 0},fNe={id:"com.microsoft.teams.mtma",name:"MtmaApp",supportedEntities:[],supportedRenderModes:[]},kNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaUserActivityUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mtmaUserActivityUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"count"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTimestamp"}},{kind:"Field",name:{kind:"Name",value:"notificationSignalsInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notificationSignalsWithCount"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activityType"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}},{kind:"Field",name:{kind:"Name",value:"mostRecentNotificationSignal"}},{kind:"Field",name:{kind:"Name",value:"mostRecentNotificationTimestamp"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"}}]}}]}}]},CNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaSetUserNotificationsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mtmaUserNotificationsParam"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MTMAUserNotificationsDataInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setMTMAUserNotificationsData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mtmaUserNotificationsParam"},value:{kind:"Variable",name:{kind:"Name",value:"mtmaUserNotificationsParam"}}}]}]}}]};function bNe(e){const{authenticationUser:t,client:n,loggerFactory:i}=e,a=n,o=i.newLogger("MTMAUserActivityUpdateEventSubscriptionJob","apps-mtma");return{id:"mtma-user-activity-update-event-subscription",runOncePerId:!0,job:()=>{const e=a.subscribe({query:kNe,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i){const a=t?.id;if(e.errors){const t=(0,ge.hR)(e.errors.map((e=>e.message)).join());return void i.errorToTelemetry?.(`encountered error for user: ${a}, ${t}`,"mtma_user_activity_update_event_subscription_job",{context:"error_event",reason:t,userId:a},!0)}if(!e.data?.mtmaUserActivityUpdateEvent)return void i.warn(`received empty event for user: ${a}`);const{mtmaUserActivityUpdateEvent:o}=e.data,{userAccountId:r,count:s,lastUpdatedTimestamp:l,notificationSignalsInfo:c,consumptionHorizon:d}=o;i.log(`activity updated for user: ${a}, count: ${s}, signals: ${JSON.stringify(c.notificationSignalsWithCount)}`);const u=[];c.notificationSignalsWithCount.forEach((e=>{u.push({activityType:e.activityType,count:e.count})})),n.mutate({mutation:CNe,variables:{mtmaUserNotificationsParam:{userAccountId:r,notifications:{count:s,lastUpdatedTimestamp:l,notificationSignalsInfo:{notificationSignalsWithCount:u,mostRecentNotificationSignal:c.mostRecentNotificationSignal,mostRecentNotificationTimestamp:c.mostRecentNotificationTimestamp},consumptionHorizon:d}}},fetchPolicy:"no-cache"})}(e,t,a,o)}));return()=>{e.unsubscribe()}}}}const wNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaUserPresenceUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mtmaUserPresenceUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"presence"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userPresenceData"}}]}}]}}]}},...n(109587).x.definitions]},TNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaSetUserPresenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mtmaUserPresenceParam"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MTMAUserPresenceDataInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setMTMAUserPresenceData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mtmaUserPresenceParam"},value:{kind:"Variable",name:{kind:"Name",value:"mtmaUserPresenceParam"}}}]}]}}]};function INe(e){const{authenticationUser:t,client:n,loggerFactory:i}=e,a=n,o=i.newLogger("MTMAUserPresenceUpdateEventSubscriptionJob","apps-mtma");return{id:"mtma-user-presence-update-event-subscription",runOncePerId:!0,job:()=>{const e=a.subscribe({query:wNe,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i){const a=t?.id;if(e.errors){const t=(0,ge.hR)(e.errors.map((e=>e.message)).join());return void i.errorToTelemetry?.(`encountered error for user: ${a}, ${t}`,"mtma_user_presence_update_event_subscription_job",{context:"error_event",reason:t,userId:a},!0)}if(!e.data?.mtmaUserPresenceUpdateEvent)return void i.warn(`received empty event for user: ${a}`);const{mtmaUserPresenceUpdateEvent:o}=e.data,{userAccountId:r,presence:s}=o,l=s.availability;i.log(`presence updated for user: ${a}, presence: ${s.availability}`),n.mutate({mutation:TNe,variables:{mtmaUserPresenceParam:{userAccountId:r,presence:{availability:l}}},fetchPolicy:"no-cache"})}(e,t,a,o)}));return()=>{e.unsubscribe()}}}}const NNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaUserProfileUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mtmaUserProfileUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFields"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}}]}}]}}]}},...s_.x.definitions]},ANe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaSetUserProfileMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mtmaUserProfileParam"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MTMAUserProfileDataInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setMTMAUserProfileData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mtmaUserProfileParam"},value:{kind:"Variable",name:{kind:"Name",value:"mtmaUserProfileParam"}}}]}]}}]},ENe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsMtmaGetUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]};var FNe=n(445715);function _Ne(e){const{authenticationUser:t,client:n,loggerFactory:i,coreSettings:a}=e,o=n,r=i.newLogger("MTMAUserProfileUpdateEventSubscriptionJob","apps-mtma");return{id:"mtma-user-profile-update-event-subscription",runOncePerId:!0,job:()=>{const e=o.subscribe({query:NNe,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i,a){const o=t?.id;if(e.errors){const t=(0,ge.hR)(e.errors.map((e=>e.message)).join());return void i.errorToTelemetry?.(`encountered error for user: ${o}, ${t}`,"mtma_user_profile_update_event_subscription_job",{context:"error_event",reason:t,userId:o},!0)}if(!e.data?.mtmaUserProfileUpdateEvent)return void i.warn(`received empty event for user: ${o}`);const{mtmaUserProfileUpdateEvent:r}=e.data,{userAccountId:s,profile:l}=r;i.log(`profile updated for user: ${o}`);let d="";a.get(c.w.CdlWorker).enableProfilePictureInMaglevStorage&&(d=await DNe(n,i,r.profile.id,r.profile.displayName));n.mutate({mutation:ANe,variables:{mtmaUserProfileParam:{userAccountId:s,profile:{avatarBlob:d,displayName:l.displayName||"",email:l.email||"",tenantName:l.tenantName||"",userPrincipalName:l.userPrincipalName||""}}},fetchPolicy:"no-cache"})}(e,t,o,r,a)}));return()=>{e.unsubscribe()}}}}const DNe=async(e,t,n,i)=>{if(!i)return t.error(`failed to retrieve avatar blob for: ${n}. Missing required parameters`),"";try{const a=await e.query({query:ENe,variables:{userId:n,displayName:i,profilePictureSize:"HR96x96"}}),o=a.data?.msaUserProfilePicture;return o?await(async e=>{const t=await Rx()(e,{credentials:"include"});if(!t.ok)throw new Error(`Failed to fetch avatar: ${e}`);const n=await t.blob();if(!n.type.includes("image"))throw new Error(`Invalid blob type for avatar: ${n.type}`);const i=await(0,FNe.y)(n),a=i?.split("base64,");if(!a||0===a.length)throw new Error('Expected base64 data for avatar"');return a[1]})(o):(t.error(`failed to retrieve avatar blob for: ${n}. Missing msaProfilePicture on data`),"")}catch(e){return t.error(`failed to retrieve avatar blob for: ${n}`),""}},PNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsMtmaGetHostMachineUsersQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hostMachineUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accountType"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}}]}}]}}]};var MNe=n(694296);const RNe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaEspSurfaceShownSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espSurfaceShownEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"surfaceIds"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"AddAccountsSuggestionCoachmark",block:!1}]}}]}]}}]};function xNe(){return({context:e})=>{const t=[];if(e.coreSettings.get(c.w.CdlWorker).enableMTMAUserDataInMaglevStorage){const n=LNe(e);t.push(...n)}const{enableAddAccountSuggestionCoachmark:n,addAccountSuggestionCoachmarkDays:i}=e.coreSettings.get(c.w.Auth);return e.authenticationUser?.id===e.authenticationUser?.homeAccountId&&n&&i&&t.push(function(e,t){const n=e.client,i=new Date(-1),a=n.subscribe({query:RNe,fetchPolicy:"no-cache"}).subscribe((async()=>{sh.Vh.put(lh.O4.addAccountsSuggestionCoachMarkTimeStamp,i.toString())}));return{id:"mtma-add-accounts-suggestion",runOncePerId:!0,job:async()=>{const o={id:(0,mh.DA)(),scenarioName:be.Cu.AuthAddAccountsSuggestion,source:"apps-mtma:app-pre-warm"},[r,s]=(0,uh.we)({scenarioName:be.Cu.AuthAddAccountsSuggestion,subContext:"appPrewarm",source:"mtma-add-accounts-suggestion:createMTMAAddAccountsSuggestionJob",options:{correlation:o}});try{const{entityCommanding:a}=e,l=sh.Vh.getValue(lh.O4.addAccountsSuggestionCoachMarkTimeStamp)||"",c=new Date(l);if(c.getTime()<0)return void s();const d=(await n.query({query:PNe,fetchPolicy:"no-cache",context:{correlation:o}})).data.hostMachineUsers,u=d.filter((e=>!e.isAuthenticated)),m=d.filter((e=>e.isAuthenticated));if(m.length>1)return r.addScenarioMark(be.BQ.AuthAddAccountsSuggestionNotTriggered),sh.Vh.put(lh.O4.addAccountsSuggestionCoachMarkTimeStamp,i.toString()),void s();if(!l&&m.length>0)return r.addScenarioMark(be.BQ.AuthAddAccountsSuggestionNotTriggered),sh.Vh.put(lh.O4.addAccountsSuggestionCoachMarkTimeStamp,(new Date).toString()),void s();if((0,MNe.Y8)(new Date,(0,MNe.K1)(c,t)))return r.addScenarioMark(be.BQ.AuthAddAccountsSuggestionNotTriggered),void s();u.length>0&&(a.esp.displaySurface("AddAccountsSuggestionCoachmark"),r.addScenarioMark(be.BQ.AuthAddAccountsSuggestionTriggered))}catch(e){r.addScenarioMark(be.BQ.AuthAddAccountsSuggestionFailed)}return s(),()=>{a?.unsubscribe()}}}}(e,i||0)),t}}const LNe=e=>[bNe(e),INe(e),_Ne(e)],ONe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaCleanupStaleUserDataMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cleanupStaleMTMAUserData"}}]}}]};function jNe(e){const{client:t}=e,n=t;return{id:"mtma-cleanup-stale-user-data-job",runOncePerId:!0,job:()=>(n.mutate({mutation:ONe,fetchPolicy:"no-cache"}),()=>{})}}function BNe(){const e=()=>null;return{onPreWarm:xNe(),onExperienceWarm:({context:e})=>[jNe(e)],manifest:fNe,render:async()=>(0,Lr.Y)(e,{})}}const UNe={id:"com.microsoft.teams.headline-slices",name:"HeadlineSlicesApp",supportedEntities:[ke.ck.headlineslice],supportedRenderModes:[se.w.Main],actors:[Ove],getLocalizedName:async()=>"Headline Slices"},$Ne=e=>{if(!WNe(e))return;return{mainEntity:VNe(e)}},WNe=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=[Yt.Rm.standard].includes(t),o=[ke.ck.headlineslice].includes(i),r=[ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},VNe=({entity:e})=>e,HNe=async({commandInput:e,requestContext:t})=>{const{command:{action:n,actor:i,data:a}}=e,o=t.loggerFactory.newLogger("HeadlineSlicesApp onCommandReceived","apps-headline-slices");if(i===Ove){if(n===jve){const{id:e,focusOnLoad:t}=a??{};return e?{entity:{id:e,type:ke.ck.headlineslice,action:ke.SY.view},command:{visibilityState:g.Rp.show,stateTransition:g.Ar.flow,correlation:{source:A.p.Unknown}},entityOptions:{focusOnLoad:t}}:void o.error("Missing required data field 'id'.")}o.error(`Command action '${n}' is not supported at HeadlineSlicesApp.`)}else o.error(`Command for actor '${i}' cannot be handled by HeadlineSlicesApp.`)};var zNe=n(574892);const qNe=(e,t)=>{const n=e.findScenario(be.Cu.SimpleCollabSliceSwitch),i=e.findScenario(be.Cu.SimpleCollabSwitch);return n||i?n&&i?(t.warn("simpleCollabSwitch and simpleCollabSliceSwitch - both switch scenarios found"),n.incomplete({reason:"marking simpleCollabSliceSwitch incomplete because it was found running with simpleCollabSwitch"}),i):n||i:(t.warn("No switch scenario for Headline Slice found"),null)},GNe=(e,t,n)=>{const i=e.findScenario(t);return i||(n.log(`${t} not found`),null)},YNe=({scenarioFactory:e,scenarioName:t,logger:n,status:i,eventData:a})=>{const o=GNe(e,t,n);o&&o.stop(a,i)},QNe=(e,t,n)=>{const i=e.newScenario(t);return i.appendEventData(n),i},JNe=(e,t,n,i)=>{const a=GNe(e,t,n);if(!a)return;const o={message:i};a.cancel(o)};var KNe=n(743155);const ZNe=(e,t,n)=>{const i={actionGesture:n.actionGesture||GR.Od.click,actionScenario:n.actionScenario||GR.vB.feedItemClick,actionOutcome:n.actionOutcome||GR.nd.nav,actionScenarioType:n.actionScenarioType||GR.DB.activityFeed,panelType:n.panelType||GR.HP.SimpleCollabSlicesActivityFeed,moduleName:GR.Sn.feedList,moduleType:GR.nR.feeds,panelRegion:GR.rP.main},a=e.createDatabag?.();if(a){if(a.sliceId=(0,Rge.IT)(t),a.headlineSliceId=t,n?.metaInformation){const e=n.metaInformation;a.appliedUpfrontFilters=e.appliedUpfrontFilters,a.threadType=e.threadType,a.type=e.feedType,a.feedId=e.feedId,a.subType=e.feedSubtype,a.isContextMenuVisible=e.isContextMenuVisible,a.dwellTime=e.dwellTime,a.read=e.isRead,a.originatedTimeStamp=e.originatedTimeStamp,a.itemsCount=e.itemsCount,a.threadType=e.threadType,a.upfrontFilterKey=e.upfrontFilterKey,a.slicetotalFilteredActivityCount=e.slicetotalFilteredActivityCount,a.chatModality=e.chatModality,a.isReplyMessage=e.isReplyMessage}i.dataBag=a,e.recordPanelAction(i),a?.dispose()}},XNe={onEventReceived:async({eventInput:e,requestContext:t})=>{const{event:n}=e,{loggerFactory:i,shortcutExecutionService:a,client:o}=t,r=i.newLogger("HeadlineSlicesEvents","headlines-slices-event-handlers");switch(n.type){case uq.mu.requestPersonMoreInfo:const e=n.data?.();return{command:vq(e)};case zNe.P.itemClick:return eAe(n,t,r);case zNe.P.feedMounted:return iAe(t,r);case zNe.P.feedDataReceived:return aAe(n,t,r);case zNe.P.errorWhileFetchingFeeds:return oAe(n,t,r);case zNe.P.prefetchTriggered:return rAe(t);case zNe.P.headlineCriticalPhaseCompleted:return sAe(n,t,r);case zNe.P.feedUnmounted:return cAe(t);case zNe.P.feedPainted:return dAe(n,t,r);case zNe.P.feedLoadStarted:return uAe(n,t,r);case zNe.P.feedLoadMoreStarted:return mAe(n,t);case zNe.P.upfrontFilterClick:return lAe(n,t,r);case zNe.P.contextMenuOpenClose:return pAe(n,t);case zNe.P.escapeKeyPressed:const i=o?.ctx;return void a.executeCommand(i.windowId,"FocusOnLeftRailItem");default:return}}},eAe=(e,{userBiService:t,coreSettings:n},i)=>{const{id:a,navigationTarget:o,sliceId:r,feedClickAnalyticsData:s,feedEngageAnalytics:l}=e.data(),c=((e,t)=>({actionScenario:GR.vB.feedItemClick,actionScenarioType:GR.DB.activityFeed,actionOutcome:GR.nd.nav,actionGesture:GR.Od.click,metaInformation:{feedId:e,...t}}))(a,s);if(ZNe(t,r,c),l){const e=((e,t)=>({actionScenario:GR.vB.activityFeedItemEngaged,actionScenarioType:GR.DB.activityFeed,actionOutcome:GR.nd.nav,actionGesture:GR.Od.click,metaInformation:{feedId:t.previouslyClickedFeedItemId,dwellTime:t.dwellTime,feedSubtype:e.feedSubtype,feedType:e.feedType,isRead:e.isRead,originatedTimeStamp:e.originatedTimeStamp,threadType:e.threadType}}))(s,l);ZNe(t,r,e)}switch(o){case Iq.M.channel:return nAe(e,i);case Iq.M.chat:return tAe(e,n,i);default:i.error(`Unsupported navigation target ${o} for id ${a}`)}},tAe=(e,t,n)=>{const{id:i,threadId:a,replyChainId:o,messageId:r}=e.data(),s=performance.now().toString(),l={messageId:r,focusOnLoad:Bt.I.DoNotMove,source:A.p.HeadlineSlice,focusShortcutForEscapeKeyEvent:"Escape",uniqueId:s,openChatInEndSlot:!0},{enableThreadingInChat:d}=t.get(c.w.Messaging);return d&&r&&o&&o!==r?{command:ee.toggleEndRail({id:`${a};replyChainId=${o}`,action:ke.SY.info,source:A.p.HeadlineSlice,showOption:"show",type:ke.ck.chatthread,targetWindow:g.BA.main,entityOptions:{...l,showBackButton:!0}})}:r?{command:ee.toggleEndRail({id:a,action:ke.SY.view,source:A.p.HeadlineSlice,showOption:"show",type:ke.ck.chats,targetWindow:g.BA.main,entityOptions:{...l,showChatTitleForHeader:!0,convId:a}})}:void n.error(`MessageId not found for ${i}`)},nAe=(e,t)=>{const{threadId:n,replyChainId:i,messageId:a}=e.data();if(a&&i){const e={channelId:n,replyChainId:i};return{command:ee.toggleEndRail({id:JSON.stringify(e),action:ke.SY.info,source:A.p.HeadlineSlice,showOption:"show",type:ke.ck.channelthread,entityOptions:{deepLinkId:a,messageId:a,focusOnLoad:Bt.I.DoNotMove,focusShortcutForEscapeKeyEvent:"Escape",source:A.p.HeadlineSlice}})}}t.error(`Error When attempting navigation: threadId: ${n} messageId: ${a} replyChainId: ${i}`)},iAe=({scenarioFactory:e},t)=>{const n=qNe(e,t);n&&n.mark(be.BQ.ActivityFeedMounted)},aAe=(e,{scenarioFactory:t,userBiService:n},i)=>{const{isFirstPageLoad:a,scenarioEventData:o,canSendTelemetry:r,feedScenarioName:s}=e.data(),{sliceTotalFilteredActivityCount:l,sliceId:c}=o;if(o.type=c,r){const e=GNe(t,s,i);e&&(e.mark(be.BQ.FeedListDataReceived),e.appendEventData(o))}if(!a)return;var d;((e,t,n)=>{const i={panelType:n.panelType||GR.HP.SlicesActivityFeed,panelRegion:GR.rP.main},a=e.createDatabag?.();if(a){if(a.sliceId=(0,Rge.IT)(t),a.headlineSliceId=t,n?.metaInformation){const e=n.metaInformation;a.slicetotalFilteredActivityCount=e.slicetotalFilteredActivityCount}i.dataBag=a,e.recordPanelView(i),a?.dispose()}})(n,c||"unknown-slice-id",(d=l,{panelType:GR.HP.SlicesActivityFeed,metaInformation:{slicetotalFilteredActivityCount:d}}));const u=qNe(t,i);u&&(u.mark(be.BQ.FeedListDataReceived),u.appendEventData(o))},oAe=(e,{scenarioFactory:t},n)=>{const{isFirstPageLoad:i,scenarioEventData:a}=e.data();if(YNe({scenarioFactory:t,scenarioName:be.Cu.SimpleCollabSliceFeedLoad,logger:n,status:"failure",eventData:a}),YNe({scenarioFactory:t,scenarioName:be.Cu.SimpleCollabSliceFeedLoadMore,logger:n,status:"failure",eventData:a}),!i)return;const o=qNe(t,n);o&&o.fail(a)},rAe=({scenarioFactory:e})=>{e.markStep(be.Cu.SimpleCollabSliceSwitch,be.BQ.FeedListPrefetchTriggered),e.markStep(be.Cu.SimpleCollabSwitch,be.BQ.FeedListPrefetchTriggered)},sAe=(e,{scenarioFactory:t},n)=>{const{onPhaseWillCompleteReason:i}=e.data(),a=`Headline feed CriticalPhase completed with reason: ${i}`;if(i===m.Oe.PHASE_TIMEOUT_FIRED){n.errorToTelemetry?.(a,"headline_slice",void 0,!0);const e={message:a};YNe({scenarioFactory:t,scenarioName:be.Cu.SimpleCollabSliceFeedLoad,logger:n,status:"timeout",eventData:e})}else n.log(a)},lAe=(e,{userBiService:t,scenarioFactory:n},i)=>{const{appliedUpfrontFilters:a,upfrontFilterKey:o,operationName:r,previousInstanceCancelReason:s,filterAction:l,sliceId:c}=e.data(),d=((e,t)=>({actionScenario:GR.vB.upfrontFilterClick,actionScenarioType:GR.DB.activityFeed,actionOutcome:GR.nd.nav,actionGesture:GR.Od.click,metaInformation:{appliedUpfrontFilters:e,upfrontFilterKey:t}}))(a,o);ZNe(t,c,d),JNe(n,be.Cu.SimpleCollabSliceFeedLoad,i,s);const u={operationName:r,sliceId:c,viewType:c},m=QNe(n,be.Cu.SimpleCollabSliceFeedLoad,u),{appendFeedDataBag:p}=wq.H;p(i,m,{filterAction:l})},cAe=({scenarioFactory:e})=>{const t={message:"Headline feed container unmounting"};e.stopScenarioIfActive(be.Cu.SimpleCollabSliceFeedLoad,t,"abandoned"),e.stopScenarioIfActive(be.Cu.SimpleCollabSliceFeedLoadMore,t,"abandoned")},dAe=(e,{scenarioFactory:t,phaseStateMachine:n},i)=>{const{isFirstPageLoad:a,feedScenarioName:o,feedScenarioEventData:r}=e.data();if(a){const e=[Gz.m.SIMPLE_COLLAB_SLICE_FEED_RENDERED];n?.fireSignals({signals:e,fireAfterLayoutAndPaint:!1}),i.log(`Headline feed - ${e} - fired`)}YNe({scenarioFactory:t,scenarioName:o,logger:i,status:"success",eventData:r})},uAe=(e,{scenarioFactory:t},n)=>{const{operationName:i,filterAction:a,sliceId:o}=e.data();JNe(t,be.Cu.SimpleCollabSliceFeedLoad,n,i);const r={operationName:i,sliceId:o,viewType:o},s=QNe(t,be.Cu.SimpleCollabSliceFeedLoad,r);if(!a)return;const{appendFeedDataBag:l}=wq.H;l(n,s,{filterAction:a})},mAe=(e,{scenarioFactory:t,userBiService:n})=>{const{operationName:i,listId:a,itemsCount:o,slicetotalFilteredActivityCount:r,appliedUpfrontFilters:s}=e.data(),l={operationName:i,sliceId:a,viewType:a};if(QNe(t,be.Cu.SimpleCollabSliceFeedLoadMore,l),i===KNe.Z.Scroll){const e=((e,t,n)=>({actionScenario:GR.vB.loadNextActivityFeedList,actionScenarioType:GR.DB.scroll,actionGesture:GR.Od.scroll,actionOutcome:GR.nd.read,metaInformation:{appliedUpfrontFilters:e,itemsCount:t,slicetotalFilteredActivityCount:n}}))(s,o,r);ZNe(n,a,e)}},pAe=(e,{userBiService:t})=>{const{sliceId:n,isContextMenuVisible:i}=e.data(),a=(e=>({actionScenario:GR.vB.contextMenuClick,actionScenarioType:GR.DB.activityFeed,actionOutcome:GR.nd.show,actionGesture:GR.Od.click,metaInformation:{isContextMenuVisible:e}}))(i);ZNe(t,n,a)},gAe=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{criticalPhaseTimeout:i,postCriticalPhaseTimeout:a}=t.get(c.w.Activity),o=[];if(e===se.w.Main)o.push(Gz.m.SIMPLE_COLLAB_SLICE_FEED_RENDERED);return n.registerAppPhase({phase:m.Jj.CRITICAL,signals:o,timeout:i||6e4}),n.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:a||12e4}),n.appPhases},hAe=({event:e})=>{if(e.type===zNe.P.itemClick){const{navigationTarget:t,sliceId:n,type:i,subtype:a,feedClickAnalyticsData:{chatModality:o,isReplyMessage:r}}=e.data();return{scenarioName:be.Cu.HeadlineSliceItemSwitch,source:A.p.HeadlineSlice,eventData:{target:t,viewType:n,sliceId:n,type:i,subtype:a,chatModality:o,isReplyMessage:r}}}},vAe=({command:{stateTransition:e},entity:{type:t}})=>{const n=e===g.Ar.new;switch(t){case ke.ck.channels:return n?be.Cu.ChannelSwitchL2Popout:be.Cu.ChannelSwitchL2;case ke.ck.chats:return n?be.Cu.ChatSwitchPopOut:be.Cu.ChatSwitch}},yAe=()=>Promise.all([n.e(912845),n.e(461500),n.e(669152),n.e(459959),n.e(492852),n.e(459467),n.e(607842),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(524014),n.e(383414),n.e(265816),n.e(327091),n.e(552331),n.e(697073),n.e(104538),n.e(834558),n.e(668415),n.e(77029),n.e(428410),n.e(478723),n.e(288919),n.e(615002),n.e(544618),n.e(830006),n.e(675252)]).then(n.bind(n,775894));function SAe(){const e=()=>null;return{manifest:UNe,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,coreSettings:a})=>{if(t===se.w.Main){const e="headline-slices-app";n("ChunkLoadStarted",{chunkName:e});const{HeadlineSlicesViewsRenderer:t}=await(0,ev.wg)(yAe,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(t,{coreSettings:a})}return(0,Lr.Y)(e,{})},getAppViewEntities:$Ne,onCommandReceived:HNe,eventHandlers:XNe,getAppPhases:gAe,getEventScenarioData:hAe,getCommandScenarioNameFromSource:vAe}}const fAe={id:"com.microsoft.teams.biometric-enrollment",name:"BiometricEnrollmentApp",supportedRenderModes:[se.w.Main],supportedEntities:[ke.ck.voiceenrollment,ke.ck.faceenrollment],windowFeatures:{minWidth:900,width:900,minHeight:950,height:950}},kAe=e=>{if(CAe(e))return bAe(e)?{subNavEntity:wAe(e),headerEntity:TAe(e),startEntity:IAe(e),mainEntity:NAe(e),endEntity:AAe(e)}:null},CAe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.faceenrollment,ke.ck.voiceenrollment].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},bAe=()=>!0,wAe=()=>null,TAe=()=>null,IAe=()=>null,NAe=({entity:e})=>e,AAe=()=>null,EAe=()=>Promise.all([n.e(320494),n.e(120951),n.e(490329),n.e(842242),n.e(255544),n.e(85394),n.e(788196),n.e(211893),n.e(519083)]).then(n.bind(n,208232)),FAe=()=>fAe.windowFeatures||{};function _Ae(){const e=()=>null;return{getAppViewEntities:kAe,getAppWindowFeatures:FAe,manifest:fAe,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===se.w.Main){const e="biometric-enrollment-entry",{BiometricEnrollmentEntry:t}=await(0,ev.wg)(EAe,e,n);return(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})}}}const DAe=e=>{if(PAe(e))return MAe(e)?{subNavEntity:RAe(e),headerEntity:xAe(e),startEntity:LAe(e),mainEntity:OAe(e),endEntity:jAe(e)}:null},PAe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.coachreport].includes(i),r=[ke.SY.default,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},MAe=()=>!0,RAe=()=>null,xAe=()=>null,LAe=()=>null,OAe=({entity:e})=>e,jAe=()=>null,BAe={id:"com.microsoft.teams.coachreport",name:"CoachReport",supportedEntities:[ke.ck.coachreport],supportedRenderModes:[se.w.Main],getDefaultCommand:()=>({type:ke.ck.coachreport,action:ke.SY.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},UAe=({appRenderMode:e,coreSettings:t})=>{const n=new qz.D,{speakerCoachCriticalPhaseTimeout:i,speakerCoachPostCriticalPhaseTimeout:a}=t.get(c.w.Coach),o=[];if(e===se.w.Main)o.push(Gz.m.COACH_REPORT_VIEW_RENDERED);return n.registerAppPhase({phase:m.Jj.CRITICAL,signals:o,timeout:i||3e4}),n.registerAppPhase({phase:m.Jj.POST_CRITICAL,signals:[],timeout:a||1e4}),n.appPhases},$Ae=()=>Promise.all([n.e(320494),n.e(120951),n.e(461500),n.e(393706),n.e(940543),n.e(739085),n.e(826932),n.e(493561),n.e(500864),n.e(112736),n.e(301904)]).then(n.bind(n,597197)),WAe=()=>BAe.windowFeatures||{};function VAe(){const e=()=>null;return{getAppViewEntities:DAe,getAppWindowFeatures:WAe,getAppPhases:UAe,manifest:BAe,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===se.w.Main){const e="coach-report-app";n("ChunkLoadStarted",{chunkName:e});const{CoachReportRenderer:t}=await(0,ev.wg)($Ae,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(vG.e,{namespaces:["calling","messaging","meetingAnalytics","coachReport"],loaderRenderer:null,children:(0,Lr.Y)(t,{})})}return(0,Lr.Y)(e,{})}}}const HAe={id:"com.microsoft.teams.peoplecore",name:"PeopleCore",supportedEntities:[],supportedRenderModes:[]},zAe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsPeopleCoreProfilesUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"profilesUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}}]}}]};function qAe(e,t,n){return{id:"profiles-update-event-subscription-job",runOncePerId:!0,job:async()=>{const{enableProfilesUpdateToApolloCache:i}=n.get(c.w.People);if(!i)return;const a=t.newLogger("ProfilesUpdateSubscriptionJob","apps-people-core"),o=e.subscribe({query:zAe}).subscribe((e=>{a.log(`profilesUpdateEvent received ${e?.data?.profilesUpdateEvent?.length} profiles`)}));return()=>{o?.unsubscribe()}}}}function GAe(){const e=()=>null;return{onUserWindowPreWarm:({context:{client:e,loggerFactory:t,coreSettings:n}})=>{const i=[],{enableProfilesUpdateToApolloCache:a}=n.get(c.w.People);return a&&i.push(qAe(e,t,n)),i},onPreWarm:({context:{client:e,loggerFactory:t,coreSettings:n}})=>{const i=[],{enableProfilesUpdateToApolloCache:a,profilesUpdateSubscriptionJobLoadStrategy:o}=n.get(c.w.People);return a&&"onPreWarm"===o?(i.push(qAe(e,t,n)),i):[]},onIdle:({context:{client:e,loggerFactory:t,coreSettings:n}})=>{const i=[],{enableProfilesUpdateToApolloCache:a,profilesUpdateSubscriptionJobLoadStrategy:o}=n.get(c.w.People);return a&&"onIdle"===o?(i.push(qAe(e,t,n)),i):[]},manifest:HAe,render:async()=>(0,Lr.Y)(e,{})}}const YAe={id:"com.microsoft.teams.presence",name:"Presence",supportedEntities:[],supportedRenderModes:[]},QAe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsPresenceFollowPresenceEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followPresenceUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}}]}}]}}]},JAe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsPresenceMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},KAe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsPresenceToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]};function ZAe(e,t,n,i,a){return{id:"follow-presence-event-subscription-job",runOncePerId:!0,job:async()=>{const{enableFollowPresence:o}=n.get(c.w.Presence);if(!o)return;const r=t.newLogger("FollowPresenceEventSubscriptionJob","apps-presence"),s=e.subscribe({query:QAe}).subscribe((async t=>{const n=t.data?.followPresenceUpdateEvent;let o=null;switch(n?.availability){case eme.e.Available:o="online";break;case eme.e.Offline:o="offline"}if(n&&o){const t=await async function(e,t,n){const i=(await n.query({query:JAe,variables:{userId:e,displayName:t,profilePictureSize:YX.xi.Small}})).data.msaUserProfilePicture,a=(await n.query({query:KAe,variables:{url:i}})).data.toastImageAsDataUri;return a}(n.mri,n.name,e)||"";i.toasts.showFollowPresenceToast("follow-presence-toast",{conversationId:n.conversationId,mainImage:{alt:"",src:t},text:a.stringTranslate("presence",`presence_status_change_${o}`),time:new Date,title:n.name}),r.log("followPresenceUpdateEvent received")}}));return()=>{s?.unsubscribe()}}}}function XAe(){const e=()=>null;return{onUserWindowPreWarm:({context:{client:e,loggerFactory:t,coreSettings:n,entityCommanding:i,i18n:a}})=>{const o=[],{enableFollowPresence:r}=n.get(c.w.Presence);return r&&o.push(ZAe(e,t,n,i,a)),o},manifest:YAe,render:async()=>(0,Lr.Y)(e,{})}}var eEe=n(498409);const tEe=e=>{if(nEe(e))return iEe(e)?{subNavEntity:aEe(e),headerEntity:oEe(e),startEntity:rEe(e),mainEntity:sEe(e),endEntity:lEe(e)}:null},nEe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.attendeeview].includes(i),r=[ke.SY.default,ke.SY.create,ke.SY.view],s=n&&r.includes(n);return!!(a&&o&&s)},iEe=()=>!0,aEe=()=>null,oEe=({entity:e})=>e,rEe=()=>null,sEe=({entity:e})=>e,lEe=()=>null,cEe=({coreSettings:e,themeOptions:t})=>{const{enableLightThemeSupport:n=!1}=e?.get(c.w.Calling)??{};return{mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!n||t?.isCallingWindowDarkTheme}},headerEntity:{[se.w.HorizontalBar]:{doesHeaderOverlapMain:!1,isBackgroundTransparent:!0}}}},dEe={id:"com.microsoft.teams.attendee-view",name:"AteendeeViewApp",supportedEntities:[ke.ck.attendeeview],supportedRenderModes:[se.w.Main,se.w.HorizontalBar],windowFeatures:{height:218,width:360,minHeight:218,minWidth:360,maxHeight:336,maxWidth:560,offset:20}},uEe=()=>Promise.all([n.e(669152),n.e(131667),n.e(892153),n.e(383414),n.e(311576),n.e(736704),n.e(688782),n.e(317910),n.e(461824),n.e(972591),n.e(929679),n.e(887759),n.e(295578),n.e(574995),n.e(817210),n.e(615195)]).then(n.bind(n,844017)),mEe=()=>Promise.all([n.e(669152),n.e(131667),n.e(892153),n.e(383414),n.e(311576),n.e(736704),n.e(688782),n.e(317910),n.e(461824),n.e(972591),n.e(929679),n.e(887759),n.e(295578),n.e(574995),n.e(817210),n.e(615195)]).then(n.bind(n,108645)),pEe="attendee-view-app",gEe=(e,t=218)=>t+(0,eEe.BY)(e,6)+(0,eEe.BY)(e,2.4),hEe=(e,t,n,i)=>{const a=(e=>{const t=e.get(c.w.Host).disableOldDesktopCallMonitor;return e.get(c.w.Calling).enableModernCallMonitor||t?{width:304,height:247,cornerMargin:100}:{width:280,height:160,cornerMargin:16}})(i),o=a.cornerMargin,r=a.height+a.cornerMargin+16,s="availLeft"in e?e.availLeft:0,l=("availTop"in e?e.availTop:0)+e.availHeight-n-r,d=s+e.availWidth-t-o,u=l<0||d<0;return{top:u?0:l,left:u?0:d}},vEe=({coreServices:{coreSettings:e,platformService:t,windowProvider:n},host:i})=>{const a=i?.screen;if(!a)return null;const o=e.get(c.w.Calling,["disableContentprotection","enableCallMonitorGallery","enableNativeControlsAttendeeViewWindows"]),r=o?.disableContentprotection,s=o?.enableCallMonitorGallery,l=o?.enableNativeControlsAttendeeViewWindows,d=(!r).toString(),u=!!s,m=dEe.windowFeatures.width||360,p=dEe.windowFeatures.maxWidth||360,g=gEe(n),h=gEe(n,dEe.windowFeatures.maxHeight),{top:v,left:y}=hEe(a,m,g,e);return{additionalFeatures:{alwaysOnTop:"true",closable:u.toString(),minimizable:(!u).toString(),excludeWindowFromScreenSharing:d,contentprotection:d,fullscreenable:"false",maximizable:"false",resizable:"true",hideWindowControl:t.config.osPlatform===nt.SA.Windows&&!l?"true":"false",minWidth:`${m}`,minHeight:`${g}`,maxWidth:`${p}`,maxHeight:`${h}`},top:v,left:y,width:m,height:g,minWidth:m,minHeight:g,maxWidth:p,maxHeight:h}};function yEe(){const e=()=>null;return{getAppViewEntities:tEe,getAppViewEntitiesProps:cEe,getAppWindowFeatures:vEe,manifest:dEe,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===se.w.Main){const{AttendeeView:e}=await(0,ev.wg)(uEe,pEe,n);return(0,Lr.Y)(SEe,{children:(0,Lr.Y)(e,{})})}if(t===se.w.HorizontalBar){const{AttendeeToolbar:e}=await(0,ev.wg)(mEe,pEe,n);return(0,Lr.Y)(SEe,{children:(0,Lr.Y)(e,{})})}return(0,Lr.Y)(e,{})}}}const SEe=({children:e})=>(0,Lr.Y)(vG.e,{namespace:"calling",loaderRenderer:null,children:e}),fEe={getDefaultCommand:()=>({type:ke.ck.messages,action:ke.SY.create}),id:"com.microsoft.teams.share",name:"ShareApp",supportedEntities:[ke.ck.messages,ke.ck.shareformdialog],supportedRenderModes:[se.w.Main,se.w.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}};var kEe=n(543804),CEe=n(808692);const bEe=({children:e})=>{const t=kEe._A,{unblockOutlookDesktopIE11:n,unblockSafari:i}=(0,jX.w2)(c.w.Outlook,["unblockOutlookDesktopIE11","unblockSafari"]);if(n&&(t.ie=`>=${kEe.tu}`),i&&(t.safari=`>=${kEe.Xg}`),!((0,CEe.hl)(t)||(0,CEe.bR)()&&i))throw(0,Je.$5)("UnsupportedBrowserCheck",d.O4.FeatureNotSupported,"render",void 0,"Unsupported Browser");if(!i&&(0,CEe.oW)())throw(0,Je.$5)("UnsupportedBrowserCheck",d.O4.FeatureNotSupported,"render",{itpError:!0},"Unsupported Browser (ITP Enabled)");return(0,Lr.Y)(Or.Fragment,{children:e})},wEe=e=>{if(TEe(e))return IEe(e)?{subNavEntity:NEe(e),headerEntity:AEe(e),startEntity:EEe(e),mainEntity:FEe(e),endEntity:_Ee(e)}:null},TEe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.messages,ke.ck.shareformdialog].includes(i),r=[ke.SY.default,ke.SY.view,ke.SY.create],s=n&&r.includes(n);return!!(a&&o&&s)},IEe=()=>!0,NEe=()=>null,AEe=()=>null,EEe=()=>null,FEe=({entity:e})=>e,_Ee=()=>null,DEe=({appRenderMode:e})=>{const t=new qz.D,n=[];return e===se.w.Main&&n.push(Gz.m.SHARE_PAGE_RENDERED),t.registerAppPhase({phase:m.Jj.CRITICAL,signals:n,timeout:2e4}),t.appPhases},PEe=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(620314),n.e(914945),n.e(461500),n.e(668172),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(725973),n.e(428348),n.e(459959),n.e(984165),n.e(215618),n.e(729849),n.e(484331),n.e(960122),n.e(306517),n.e(964401),n.e(405198),n.e(431784),n.e(964859),n.e(475896),n.e(116447),n.e(773977),n.e(862449),n.e(57789),n.e(392982),n.e(367328),n.e(271603),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(977204),n.e(151748),n.e(370494),n.e(412160),n.e(251896),n.e(524014),n.e(625303),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(936254),n.e(77029),n.e(684694),n.e(53131),n.e(813370),n.e(119597),n.e(170031),n.e(325254),n.e(148703),n.e(875113),n.e(465160),n.e(337595),n.e(361035),n.e(243811),n.e(562773),n.e(731807)]).then(n.bind(n,810054)),MEe=()=>null;const REe={id:"com.microsoft.teams.exploratory-license",name:"ExploratoryLicenseApp",supportedEntities:[ke.ck.exploratorylicense],supportedRenderModes:[se.w.Main]},xEe=e=>{if(LEe(e))return OEe(e)?{subNavEntity:jEe(e),headerEntity:BEe(e),startEntity:UEe(e),mainEntity:$Ee(e),endEntity:WEe(e)}:null},LEe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.focus,Yt.Rm.standard].includes(e),o=[ke.ck.exploratorylicense].includes(i),r=[ke.SY.create],s=n&&r.includes(n);return!!(a&&o&&s)},OEe=()=>!0,jEe=()=>null,BEe=()=>null,UEe=()=>null,$Ee=({entity:e})=>e,WEe=()=>null,VEe=()=>n.e(318192).then(n.bind(n,842188));const HEe={id:"com.microsoft.teams.presenter-chat",name:"PresenterChatApp",supportedEntities:[ke.ck.presenterchat],supportedRenderModes:[se.w.Main],windowFeatures:{height:502,width:320,offset:70}},zEe=e=>{if(qEe(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:GEe(e),endEntity:null}},qEe=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===ke.ck.presenterchat,a=t===ke.SY.view;return Boolean(i&&a)},GEe=({entity:e})=>e,YEe=()=>({mainEntity:{[se.w.Main]:{disableNotificationsBanners:!0,isBackgroundTransparent:!0,forceDisableTitleBar:!0}}}),QEe=()=>Promise.all([n.e(912845),n.e(953696),n.e(273198),n.e(320494),n.e(224316),n.e(416397),n.e(120951),n.e(984552),n.e(169767),n.e(914945),n.e(461500),n.e(787454),n.e(490329),n.e(311914),n.e(181316),n.e(598188),n.e(725973),n.e(428348),n.e(842242),n.e(459959),n.e(984165),n.e(616161),n.e(185332),n.e(255544),n.e(487867),n.e(325670),n.e(215618),n.e(501156),n.e(729849),n.e(484331),n.e(867529),n.e(960122),n.e(736709),n.e(306517),n.e(216284),n.e(636192),n.e(964401),n.e(231020),n.e(811751),n.e(405198),n.e(393706),n.e(568721),n.e(524147),n.e(79981),n.e(258832),n.e(431784),n.e(964859),n.e(817556),n.e(475896),n.e(296930),n.e(697027),n.e(567830),n.e(628320),n.e(178249),n.e(116447),n.e(53556),n.e(122814),n.e(300954),n.e(194894),n.e(286993),n.e(915633),n.e(967653),n.e(289657),n.e(610926),n.e(419156),n.e(181780),n.e(773977),n.e(739085),n.e(721630),n.e(867826),n.e(346069),n.e(46438),n.e(187739),n.e(92464),n.e(131961),n.e(249917),n.e(20275),n.e(164734),n.e(655224),n.e(849095),n.e(496740),n.e(328452),n.e(719677),n.e(112241),n.e(307422),n.e(94139),n.e(787318),n.e(656899),n.e(35991),n.e(965787),n.e(972751),n.e(921389),n.e(638918),n.e(467129),n.e(202564),n.e(977204),n.e(784980),n.e(562201),n.e(674958),n.e(272115),n.e(117721),n.e(8601),n.e(964353),n.e(524014),n.e(625303),n.e(383414),n.e(53966),n.e(405226),n.e(265816),n.e(40459),n.e(327091),n.e(552331),n.e(697073),n.e(715192),n.e(331703),n.e(104538),n.e(936254),n.e(927129),n.e(668415),n.e(77029),n.e(430849),n.e(684694),n.e(428410),n.e(53131),n.e(214467),n.e(813370),n.e(478723),n.e(311576),n.e(679354),n.e(736704),n.e(397928),n.e(463675),n.e(577607),n.e(108698),n.e(343201),n.e(836301),n.e(840809),n.e(354884),n.e(688782),n.e(119597),n.e(170031),n.e(367831),n.e(325254),n.e(892960),n.e(544618),n.e(148703),n.e(163525),n.e(237817),n.e(8005),n.e(460976),n.e(708241),n.e(568202),n.e(875113),n.e(478040),n.e(391700),n.e(672666),n.e(240991),n.e(366328),n.e(328231),n.e(566999),n.e(391),n.e(25522),n.e(400003),n.e(602692),n.e(868389),n.e(310015),n.e(189542),n.e(569243),n.e(171868),n.e(275243),n.e(800350),n.e(216843),n.e(104945),n.e(40823),n.e(515758),n.e(944191),n.e(428434),n.e(91961),n.e(581241),n.e(552498)]).then(n.bind(n,639459)),JEe=({host:e,coreServices:t,windowOptions:n})=>{const i=e?.screen;if(!i)return null;const a=HEe.windowFeatures.width||320,o=HEe.windowFeatures.height||502,r=16+(n?.top||HEe.windowFeatures.offset||70),s=n?.left||i.availWidth/2,l=t?.coreSettings.get(c.w.Calling).disableContentprotection,d=(!l).toString();return{additionalFeatures:{alwaysOnTop:"true",closable:"false",excludeWindowFromScreenSharing:d,fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"false",movable:"true",hideWindowControl:"true",contentprotection:d,transparent:"false"},top:r,left:s,width:a,height:o}};function KEe(){const e=()=>null;return{getAppViewEntities:zEe,getAppViewEntitiesProps:YEe,getAppWindowFeatures:JEe,manifest:HEe,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===se.w.Main&&n===ke.ck.presenterchat){const e=(0,ev.wg)(QEe,"presenter-chat-app",i),t=i.findScenario(be.Cu.PresenterChatLoad);return t?.mark(be.BQ.WindowOpened),(0,Lr.Y)(Gq.d,{factory:e,fallback:(0,Lr.Y)(obe.y,{}),props:{}})}return(0,Lr.Y)(e,{})}}}const ZEe=e=>{if(XEe(e))return eFe(e)?{subNavEntity:tFe(e),headerEntity:nFe(e),startEntity:iFe(e),mainEntity:aFe(e),endEntity:oFe(e)}:null},XEe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[Yt.Rm.standard].includes(e),o=[ke.ck.whiteboard].includes(i),r=[ke.SY.default,ke.SY.view,ke.SY.create],s=n&&r.includes(n);return!!(a&&o&&s)},eFe=()=>!0,tFe=()=>null,nFe=()=>null,iFe=()=>null,aFe=({entity:e})=>e,oFe=()=>null,rFe=()=>({}),sFe={id:"com.microsoft.teams.whiteboard",name:"WhiteboardApp",supportedEntities:[ke.ck.whiteboard],supportedRenderModes:[se.w.Main,se.w.Modal],windowFeatures:{additionalFeatures:{minHeight:"2000",minWidth:"2000"},minWidth:2e3,width:2e3,minHeight:2e3,height:2e3}},lFe=()=>n.e(914811).then(n.bind(n,987002)),cFe=()=>n.e(22183).then(n.bind(n,143839)),dFe=()=>sFe.windowFeatures||{};function uFe(){const e=()=>null;return{getAppViewEntities:ZEe,getAppViewEntitiesProps:rFe,getAppWindowFeatures:dFe,manifest:sFe,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===se.w.Modal){const[{WhiteboardModalDialog:e}]=await Promise.all([(0,ev.wg)(lFe,"whiteboard-modal-dialog",n)]);return(0,Lr.Y)(e,{})}if(t===se.w.Main){const[{WhiteboardChatTab:e}]=await Promise.all([(0,ev.wg)(cFe,"components-whiteboard-chat-tab",n)]);return(0,Lr.Y)(e,{})}return(0,Lr.Y)(e,{})}}}const mFe={id:"com.microsoft.teams.captcha-challenge",name:"CaptchaChallengeApp",supportedEntities:[ke.ck.captchachallenge],supportedRenderModes:[se.w.Modal]},pFe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsCaptchaChallengeCaptchaChallengeSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeToCaptchaChallenge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"arkoseCaptchaToken"}}]}}]}}]};const gFe=(e,t)=>{e?.data?.subscribeToCaptchaChallenge?.arkoseCaptchaToken&&t.captchaChallenge.viewCaptchaChallenge(e.data.subscribeToCaptchaChallenge.arkoseCaptchaToken)};const hFe=()=>n.e(143827).then(n.bind(n,943654));const vFe={id:"com.microsoft.teams.flora-fre-dialog",name:"FloraFreDialogApp",supportedEntities:[ke.ck.florafredialog],supportedRenderModes:[se.w.Modal]},yFe=()=>n.e(617125).then(n.bind(n,839800));function SFe(){const e=()=>null;return{manifest:vFe,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{const o=a.newLogger("floraFreDialogApp","apps-flora-fre-dialog");if(t===se.w.Modal){const e="flora-fre-dialog-app";o.log("chunk load start"),n("ChunkLoadStarted",{chunkName:e}),o.log("experimental import start");const{FloraFreDialogAppViewsRenderer:t}=await(0,ev.wg)(yFe,e,i);return o.log("report chunk load success"),n("ChunkLoadSucceeded",{chunkName:e}),o.log("Rendering flora fre app dialog"),(0,Lr.Y)(t,{})}return(0,Lr.Y)(e,{})}}}const fFe=e=>{const t=e===$a.B.life?[{getAppPhases:ste,getAppViewEntities:Zee,getAppViewEntitiesProps:rte,getAppWindowFeatures:mte,getCommandScenarioName:pte,manifest:Kee,onExperienceWarm:dte,onPreWarm:cte,render:async({appRenderMode:e,scenarioFactory:t,onRenderEvent:n})=>{const i="flyout-app";n("ChunkLoadStarted",{chunkName:i});const{FlyoutViewsRenderer:a}=await(0,ev.wg)(ute,i,t);return n("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(a,{appRenderMode:e})}},Lke(),{manifest:R6,render:async({appRenderMode:e,onRenderEvent:t})=>{if(e===se.w.Main){const e="homepage-app";t("ChunkLoadStarted",{chunkName:e});const[{TflHomepage:n}]=await Promise.all([(0,ev.wg)(L6,e)]);return t("ChunkLoadSucceeded",{chunkName:e}),(0,Lr.Y)(vG.e,{namespaces:["tflHomepage","svFlyout"],loaderRenderer:null,children:(0,Lr.Y)(n,{})})}return(0,Lr.Y)(O6,{})},getPlatformAppIdForEntity:B6,onCommandReceived:x6,getCommandScenarioName:j6},bde(),{getAppPhases:T6,getAppViewEntitiesProps:k3,getAppWindowFeatures:_6,getPlatformAppIdForEntity:e=>[ke.ck.communities,ke.ck.communitiesonboarding,ke.ck.communitiesevents,ke.ck.communitiescreateevent,ke.ck.communitiesmembers,ke.ck.communitiesjoinrequest,ke.ck.communitiesblockmembers,ke.ck.communitiessettings,ke.ck.communitiesgallery,ke.ck.communitiesexplore,ke.ck.communitiesfiles,ke.ck.communitiespendinginvite].includes(e.type)?C3.Z.communities:void 0,onBeforeAddToNavigation:t6,getAppViewEntities:m3,manifest:o3,onCommandReceived:r3,eventHandlers:c3,onBeforeDeeplinkParsed:e6,getCommandScenarioName:P6,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="communities-app";t("ChunkLoadStarted",{chunkName:i});const[{CommunitiesAppViews:a},{LPC:o}]=await Promise.all([(0,ev.wg)(E6,i,n),(0,ev.wg)(F6,i,n)]);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(o,{children:(0,Lr.Y)(wJ.CA,{children:(0,Lr.Y)(vG.e,{namespaces:["communities","chatList","extensibility","channels","gallery","lightbox","teamsAndChannels"],loaderRenderer:null,children:(0,Lr.Y)(b3.V,{children:(0,Lr.Y)(a,{appRenderMode:e})})})})})},onPreWarm:w6,onBeforeCommandHandled:_3},{manifest:tNe,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="unified-consent-app";t("ChunkLoadStarted",{chunkName:i});const{UnifiedConsentViewsRenderer:a}=await(0,ev.wg)(aNe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(a,{appRenderMode:e})},...iNe},{manifest:iCe,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="virtual-consumer-events-app";t("ChunkLoadStarted",{chunkName:i});const{VirtualConsumerEventsViewsRenderer:a}=await(0,ev.wg)(pCe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(vG.e,{namespaces:["virtualConsumerEvents","errors"],loaderRenderer:null,children:(0,Lr.Y)(a,{appRenderMode:e})})},getAppPhases:mCe,...uCe},{manifest:mFe,render:async({appRenderMode:e,entity:{type:t},onRenderEvent:n,scenarioFactory:i})=>{const a="captcha-challenge";if(n("ChunkLoadStarted",{chunkName:a}),e===se.w.Modal&&t===ke.ck.captchachallenge){const{CaptchaChallenge:e}=await(0,ev.wg)(hFe,a,i);return n("ChunkLoadSucceeded",{chunkName:a}),(0,Lr.Y)(e,{})}return(0,Lr.Y)((()=>null),{})},onPreWarm:({context:{client:e,entityCommanding:t,loggerFactory:i,coreSettings:a}})=>{const{enableArkoseCaptchaChallenge:o}=a.get(c.w.Onboarding);return o?[(n=e,{id:"captcha-challenge-subscription",runOncePerId:!0,job:async()=>{const e=i.newLogger("CaptchaChallengeSubscription","apps-captcha-challenge"),a=n.subscribe({query:pFe,fetchPolicy:"no-cache"}).subscribe((n=>{e.infoToTelemetry?.("received captcha challenge subscription event","captcha_challenge_job_subscription"),gFe(n,t)}));return()=>{a?.unsubscribe()}}})]:[]}}]:[dke(),_ye(),gY(),{getAppViewEntities:DY,getAppWindowFeatures:qY,manifest:_Y,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="broadcast-scheduling-app";t("ChunkLoadStarted",{chunkName:i});const{BroadcastSchedulingViewsRenderer:a}=await(0,ev.wg)(GY,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(vG.e,{namespaces:["broadcastScheduling","webinar","compose","calendar","extensibility"],loaderRenderer:null,children:(0,Lr.Y)(a,{appRenderMode:e})})},onCommandReceived:VY,eventHandlers:UY,onBeforeDeeplinkParsed:zY},{getAppPhases:eoe,manifest:Rae,render:Xae,onCommandReceived:xae,eventHandlers:Mae,getPlatformAppIdForEntity:e=>e.type===ke.ck.peopleapp?C3.Z.peopleApp:void 0,getAppViewEntities:noe,getAppViewEntitiesProps:coe,onBeforeNavigationFromHistory:doe},{getAppViewEntities:jke,getAppViewEntitiesProps:qke,getAppWindowFeatures:tCe,manifest:Oke,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="virtual-events-app";t("ChunkLoadStarted",{chunkName:i});const{VirtualEventsViewsRenderer:a}=await(0,ev.wg)(nCe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(vG.e,{namespaces:["virtualEvents","webinar","messaging","meetingAnalytics","compose","calendar","extensibility","meetingOptions"],loaderRenderer:null,children:(0,Lr.Y)(a,{appRenderMode:e})})},onRegister:e=>{e.registerTask(new rh)},eventHandlers:Xke,onBeforeDeeplinkParsed:Zke},ICe(),LJ(),yde(),VG(),Xse(),_Ae(),{manifest:T7,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="apps-add-cloud-storage",a={chunkName:i};if(e===se.w.Modal){t("ChunkLoadStarted",a);const{AddCloudStorageDialogRenderer:e}=await(0,ev.wg)(I7,i,n);return t("ChunkLoadSucceeded",a),(0,Lr.Y)(e,{})}return(0,Lr.Y)((()=>null),{})}},VAe(),FG(),uFe(),GAe(),XAe(),SAe(),{getAppPhases:DEe,getAppViewEntities:wEe,manifest:fEe,onRegister:e=>{e.registerTask(new rh)},render:async({appRenderMode:e,scenarioFactory:t})=>{if(e===se.w.Modal||e===se.w.Main){const e=await(0,ev.wg)(PEe,"share-form",t),{ShareForm:n}=e;return(0,Lr.Y)(bEe,{children:(0,Lr.Y)(n,{})})}return(0,Lr.Y)(MEe,{})}},{manifest:REe,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="exploratory-license-app";t("ChunkLoadStarted",{chunkName:i});const{ExploratoryLicenseViewsRenderer:a}=await(0,ev.wg)(VEe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(a,{appRenderMode:e})},getAppViewEntities:xEe}];var n;return[wme(),{onPreWarm:({context:e})=>{const t=[];return e.coreSettings.get(c.w.Auth).enableTenantListPushUpdatesOverTPS&&t.push(Une(e)),t},getCommandScenarioName:Sne,manifest:ene,onBeforeDeeplinkParsed:dne,onBeforeCommandHandled:rne,onBeforeAddToNavigation:Hte,onBeforeIntentAuthenticated:yne,onExperienceWarm:mne,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="integrated-auth-app";t("ChunkLoadStarted",{chunkName:i});const{AuthViewsRenderer:a}=await(0,ev.wg)($ne,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(a,{appRenderMode:e})},getAppViewEntities:zte,getAppViewEntitiesProps:qte,getAppWindowFeatures:()=>{const{height:e,minHeight:t,minWidth:n,width:i}=ene.windowFeatures||{};return{additionalFeatures:{minHeight:`${t}`,minWidth:`${n}`},height:e,minHeight:t,minWidth:n,width:i}},onCommandReceived:jne},{getAppViewEntities:y8,getAppViewEntitiesProps:T8,manifest:N8,render:async({appRenderMode:e,onRenderEvent:t})=>F8(e,t)},m5(),...t,x0(),{eventHandlers:y5,getAppPhases:F5,getAppViewEntities:k5,getAppWindowFeatures:U5,getCommandScenarioName:$5,getPlatformAppIdForEntity:e=>e.type===ke.ck.callsmain?"20c3440d-c67e-4420-9f80-0e50c39693df":void 0,manifest:E5,onBeforeDeeplinkParsed:R5,onCommandReceived:P5,render:async e=>{const{appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a}=e,{enableSlotsInCallsApp:o}=n.get(c.w.Calling);if(o){i("ChunkLoadStarted",{chunkName:W5});const{CallsAppViewsRenderer:t}=await(0,ev.wg)(x5,W5,a);return i("ChunkLoadSucceeded",{chunkName:W5}),(0,Lr.Y)(t,{...e})}let r=!0;const s=e=>r=e,{enableLocationNotificationPopup:l,enableEmergencyLocationGlobalBanner:d}=n.get(c.w.Calling);if(t===se.w.Rail||t===se.w.Main){const e=t===se.w.Main,{enableEntityMoreInfo:o}=n.get(c.w.Core),r=e=>e?{LPC:V5}:(0,ev.wg)(j5,W5,a),s=o?V5:wJ.CA;e&&i("ChunkLoadStarted",{chunkName:W5});const[{CallsMainViewsRenderer:l},{CallsTabContextProvider:d},{LPC:u}]=await Promise.all([(0,ev.wg)(x5,W5,a),(0,ev.wg)(L5,W5,a),r(!!o)]);return e&&i("ChunkLoadSucceeded",{chunkName:W5}),(0,Lr.Y)(vG.e,{namespaces:["calling","messaging"],loaderRenderer:null,children:(0,Lr.Y)(u,{children:(0,Lr.Y)(s,{children:(0,Lr.Y)(d,{children:(0,Lr.Y)(l,{isMainPanel:e})})})})})}if(t===se.w.Modal&&(l||d)){const e="calls-main-app";i("ChunkLoadStarted",{chunkName:W5});const{EditEmergencyAddressDialogComponent:t}=await(0,ev.wg)(B5,e,a);return i("ChunkLoadSucceeded",{chunkName:W5}),(0,Lr.Y)(t,{showEditAddressDialog:r,setShowEditAddressDialog:s,moduleName:GR.Sn.emergencyLocationManageLocationButton})}if(t===se.w.HorizontalBar){i("ChunkLoadStarted",{chunkName:W5});const[{CallsHeaderRenderer:e},{CallsTabContextProvider:t}]=await Promise.all([(0,ev.wg)(O5,W5,a),(0,ev.wg)(L5,W5,a)]);return i("ChunkLoadSucceeded",{chunkName:W5}),(0,Lr.Y)(t,{children:(0,Lr.Y)(e,{})})}return(0,Lr.Y)(H5,{})}},a3(),Ole(),{getAppViewEntities:ape,getAppWindowFeatures:_pe,manifest:ipe,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="survey-form-entry";t("ChunkLoadStarted",{chunkName:i});const a=(await(0,ev.wg)(Epe,i,n)).SurveyAppViewsRenderer;return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(vG.e,{namespace:"survey",loaderRenderer:null,children:(0,Lr.Y)(a,{appRenderMode:e})})},onPreWarm:wpe,onUserWindowPreWarm:Tpe,onRegister:e=>{e.registerTask(new Npe)},onExperienceLongIdle:Ape},hG(),die(),Aie(),{getAppViewEntities:$ie,getAppWindowFeatures:hae,manifest:Qie,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n,coreSettings:i})=>(n.cancelExistingAndCreateScenario(be.Cu.MrNavigateSkeleton,"abandon",1e4),(0,Lr.Y)(gae,{appRenderMode:e,onRenderEvent:t,scenarioFactory:n,coreSettings:i})),onBeforeDeeplinkParsed:iae},Uie(),BNe(),Eae(),kJ(),rse(),yse(),q0(),KEe(),Yce(),Z6(),_ee(),w7(),p1(),{getAppViewEntities:Pee,getCommandScenarioName:Uee,getAppPhases:$ee,manifest:Dee,render:async({appRenderMode:e,onRenderEvent:t})=>{const n="files-viewer-oneup";t("ChunkLoadStarted",{chunkName:n});const[{FilesViewerOneupViewsRenderer:i}]=await Promise.all([(0,ev.wg)(Wee,n)]);return t("ChunkLoadSucceeded",{chunkName:n}),(0,Lr.Y)(i,{appRenderMode:e})}},Jee(),Tte(),k7(),h8(),npe(),o1(),dIe(),{getAppViewEntities:mIe,getAppViewEntitiesProps:kIe,manifest:uIe,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="teams-gallery-app";t("ChunkLoadStarted",{chunkName:i});const{TeamsGalleryEntry:a}=await(0,ev.wg)(CIe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(a,{appRenderMode:e})}},Aoe(),wbe(),{...LIe,manifest:bIe,render:async({coreSettings:e,loggerFactory:t,onRenderEvent:n,scenarioFactory:i})=>{const a=t.newLogger("EntityMoreInfoApp","apps-entity-more-info"),{enableEntityMoreInfo:o}=e.get(c.w.Core);return a.log(`render: loading EntityMoreInfoApp with enableEntityMoreInfo=${o}`),o?(0,Lr.Y)($Ie,{logger:a,onRenderEvent:n,scenarioFactory:i}):(0,Lr.Y)(Or.Fragment,{})}},Vte(),{getAppViewEntities:VIe,getAppViewEntitiesProps:KIe,manifest:WIe,onRegister:e=>{e.registerTask(new rh)},render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="meeting-options-app";t("ChunkLoadStarted",{chunkName:i});const{MeetingOptions:a}=await(0,ev.wg)(ZIe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,Lr.Y)(XIe,{scenarioFactory:n,children:(0,Lr.Y)(a,{appRenderMode:e})})}},{getCommandScenarioName:SNe,getAppViewEntities:oNe,getAppPhases:gNe,getAppWindowFeatures:yNe,manifest:mNe,render:async({appRenderMode:e,scenarioFactory:t,onRenderEvent:n,entity:i})=>{const a="collab-stage-view-app",o=t?.findScenario(be.Cu.PlatformTabCollabStageLaunch),r=t?.findScenario(be.Cu.PlatformTabStageViewFrameLoading),s=o||r;n("ChunkLoadStarted",{chunkName:a}),s?.currentStep!==be.BQ.PlatformTabRenderAfterChunkLoad&&(s?.mark(be.BQ.PlatformTabRenderBeforeChunkLoad),s?.startStep(be.BQ.PlatformTabRenderAfterChunkLoad));const{StageViewEntry:l,StageViewWithoutChatEntry:c,UnsupportedCollabStageErrorDialog:d}=await(0,ev.wg)(vNe,a,t);return n("ChunkLoadSucceeded",{chunkName:a}),s?.currentStep===be.BQ.PlatformTabRenderAfterChunkLoad&&s?.mark(be.BQ.PlatformTabRenderAfterChunkLoad),i.type===ke.ck.platformstagewithoutchat?(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(c,{appRenderMode:e})}):i.type===ke.ck.unsupportedcollabstageerrordialog?(0,Lr.Y)(d,{}):(0,Lr.Y)(vG.e,{namespace:"extensibility",loaderRenderer:null,children:(0,Lr.Y)(l,{appRenderMode:e})})},onBeforeAddToNavigation:pNe,onCommandResult:hNe},{manifest:ele,onExperienceLongIdle:ile,render:async({appRenderMode:e})=>(0,Lr.Y)(ole,{appRenderMode:e}),onIdle:ale},yEe(),Kle(),SFe()]},kFe={Application:{onPreInit:["calling-client-events","emergency-location-notification","import-chat-bundle","import-course-calendar-critical-bundles","import-teams-classes-critical-bundles","initialize-simple-collab-user-preference-to-store","setup-calling-app-events","standup-calling"],onExperienceWarm:["flyout-on-experience-warm-job","lazy-initialize-accounts-job","high-memory-restart-service","memory-feedback-service-start","init-diagnostics-idb-job","clear-t2-web-boot-attempts-counter","create-notifications-window-on-experience-warm-job","reposition-notifications-window-on-experience-warm-job","notify-desktop-experience-warm-job","mtma-cleanup-stale-user-data-job","detect-third-party-cookie-support-job","cleanup-t1-desktop-job","restore-taskbar-badge-on-main-window-open","settings-ecs-fetch","initialize-user-activity-recall-service","reset-client-start-failure-count"],onPreWarm:["active-windows-history-job","app-simple-collab-user-preference-subscription","auth-state-subscription","captcha-challenge-subscription","cdl-services-state-subscription","bootstrap-floodgate","esp-time-based-trigger-job","esp-synthetic-notification-toast-subscription-job","files-register-resources","flyout-prewarm-job","graph-item-toast-event-subscription","start-esp","esp-signal-handler-job","download-log-subscription","network-state-subscription","presence-prewarm-job","setup-calling-app-events","standup-calling","toast-event-subscription","channel-toast-event-subscription","communities-toast-event-subscription","taskbar-badge-event-subscription","taskbar-legacy-badge-event-subscription","worker-start-sync","connected-account-state-subscription","connected-calendar-sync-state-job","unified-calendar-sync-state-job","user-bi-initialize-smb-user-intent","notifications-engine-event-subscription","create-toast-collection","initialize-office-integration-service","start-local-migrated-settings-timer-job","presence-blocking-signal-subscription","user-settings-signal-subscription","warn-notifications-settings-banner-job","meetings-blocking-signal-subscription","connected-account-refresh-srt-job","share-to-teams-outlook-install","mtma-add-accounts-suggestion","auth-tenant-list-update-event-subscription","mtma-user-activity-update-event-subscription","mtma-user-presence-update-event-subscription","mtma-user-profile-update-event-subscription","emergency-location-notification","maglev-provider-host-settings","prewarm-platform-app","exploratory-upgrade-banner-job","notify-desktop-experience-warm-for-user-job","account-locale-change-notification-job","auto-detect-location-first-run-banner-prewarm-job","profiles-update-event-subscription-job","desktop-verify-minimum-system-audio-driver-version-job","tenant-invite-state-subscription"],onUserWindowPreWarm:["apps-sync-subscription","new-apps-subscription","bootstrap-floodgate","contextless-apps-subscription","m365-links-set-policy-value-job","profiles-update-event-subscription-job","follow-presence-event-subscription-job","request-notification-authorization","reset-taskbar-badge-on-account-switch","start-esp-app-ready-hander"],onIdle:["app-pre-load-job","files-app-pre-warm-cft-job","calendar-lmsb-start-subscription-on-idle-job","files-app-pre-warm-job","create-teams-insider-life-local-setting-migration-job","pre-cache-apps-job","profiles-update-event-subscription-job","bizchat-app-pre-warm","subscribe-to-experience-loader-settings-job"],onExperienceLongIdle:["bizchat-app-pre-warm","bootstrap-floodgate","desktop-minimum-version-check-job","disk-footprint-job","files-app-pre-warm-cft-job","files-app-pre-warm-job","pre-cache-apps-job","public-preview-policy-job","share-to-teams-clear-teams-list-localstorage","tfl-convergence-uninstall-t2-job"]}},CFe=e=>{let t,n;return lt(e)&&(t=nt.sK.Maglev,n=ct(e)),{clientType:t,platformId:n}},bFe=async()=>{const e=wFe();e.performance?.mark?.(ha.ActivateAppStart),await(e.loader?.flushTelemetry()),e.loader?.signalCoreInitStarted();const t=Date.now(),o=n(241219),r=e.loader?.getProperties()?.environment||$a.B.prod,{correlationId:s}=(0,xz.J)(e.location.search),l=function(e){const t={primaryUserTasksPromise:void 0},n=(0,Un.z)(),i=n?.defaultConsoleLogLevel||n?.loader?.getInitConsoleLogLevel?.(),a=n?.loader?.getProperties?.();let o;o=e.config.useDiagnosticsServiceV2?new Cp(a?.sessionId||"",e.config.experienceName,ma.DiagnosticsLogsMain,i?.preECSConsoleLogLevel,i?.userConsoleLogLevel):new Np(a?.sessionId||"",e.config.experienceName,ma.DiagnosticsLogsMain,i?.preECSConsoleLogLevel,i?.userConsoleLogLevel);const r=new Ap(n);o.setLogsCountReporter(r);const s=new Vi(o,"00000000-0000-0000-0000-000000000000");return new xr({...e,createNewScenarioFactory:ua,regenerateContextStream:ca,regenerateContextStreamForWindowAndUser:da,getContextFactory:t=>Mz({...t,coreOptions:e,diagnosticsService:o,loggerFactory:s,loaderProperties:a,window:n}),loggerFactory:s,onUserAuthenticated:e=>Rz({...e,primaryUserTasksPromiseWrapper:t})})}({config:{...o,externalCorrelationId:s,lifeCycleJobPermissions:kFe,startTimeMS:t},apps:fFe(r),criticalDynamicImports:Wz,loadConfigs:$z,generateChildWindowTemplate:zz,getPlatformConfigurationOverrides:CFe});await l.init();const d=l.coreServices,{enableMercuryDesign:u}=d.coreSettings.get(c.w.MercuryDesign),m={config:o,uiVariables:{isMultiWindow:!0,disableExperienceSlotShadows:!!u}};await(0,i.k)(l.activeWindows,d,(0,a.M)(m)),d.scenarioFactory.findScenario(be.Cu.ExperienceReady)?.stop()},wFe=()=>window;bFe().catch((e=>{(async e=>{wFe().loader?.onErrorHandler(e,"CoreInitFailure")})(e)}))},32587:(e,t,n)=>{"use strict";n.d(t,{n4:()=>o,yP:()=>r});var i=n(833219);function a(e){if(e.definitions.length>1)return null;const t=e.definitions[0];return"FragmentDefinition"!==t.kind?null:t}function o(e){const t=(0,i.A)(e);if(!t?.name)throw new Error("Operation name must be set");return t.name.value}function r(e){let t=(0,i.A)(e);return t||(t=a(e)),t?.name?.value||null}},750307:(e,t,n)=>{"use strict";n.d(t,{m5:()=>h,es:()=>p,PF:()=>m});var i=n(894784),a=n(232755),o=n(757346),r=n(792703),s=n(702183);class l extends r.D{constructor(e,t){super(e),this.definitionOverflowLogged=new Set,this.isDuplicateWrite=e=>this.lastWrite&&this.lastDiff&&this.lastWrite===this.lastDiff.precedingWrite&&e.result===this.lastDiff.result,this.cacheStatsCallback=()=>({nodeCount:Object.keys(this.data.data).length});const{loggerFactory:n,scenarioFactory:i,graphqlStoreStatsReporterService:a,storeType:o,enableApolloDoubleWriteFix:r}=t;this.storeType=o,this.enableApolloDoubleWriteFix=r,n&&(this.logger=n.newLogger("InMemoryCacheWrapper","frameworks-apollo")),i&&(this.scenarioFactory=i),a&&(this.graphqlStoreStatsReporterService=a,this.graphqlStoreStatsReporterService.addCacheStatsCallback(this.storeType,this.cacheStatsCallback))}write(e){let t,n=0;try{if(this.lastWrite&&this.isDuplicateWrite(e)&&(this.graphqlStoreStatsReporterService?.markDuplicateWrite(this.storeType,e.query,this.lastWrite.elapsed??0),this.enableApolloDoubleWriteFix))return this.lastWrite.result;t=this.graphqlStoreStatsReporterService?.markWriteStart(this.storeType,e.query);const i=super.write(e);return t&&(n=this.graphqlStoreStatsReporterService?.markWriteEnd(t)??0),this.lastWrite={result:i,elapsed:n},i}catch(e){throw this.logger?.error(e.message),t&&this.graphqlStoreStatsReporterService?.markWriteError(t),e}}read(e){let t;try{t=this.graphqlStoreStatsReporterService?.markReadStart(this.storeType,e.query);const n=super.read(e);return t&&this.graphqlStoreStatsReporterService?.markReadEnd(t),n}finally{this.logResultCacheOverflowOnce("read",e.query)}}modify(e){let t;try{t=this.graphqlStoreStatsReporterService?.markWriteStart(this.storeType,`modify ${e.id||"ROOT_QUERY"}`);const n=super.modify(e);return t&&this.graphqlStoreStatsReporterService?.markWriteEnd(t),n}catch(e){throw this.logger?.error(e.message),t&&this.graphqlStoreStatsReporterService?.markWriteError(t),e}}diff(e){let t;try{t=this.graphqlStoreStatsReporterService?.markDiffStart(this.storeType,e.query);const n=super.diff(e);return t&&this.graphqlStoreStatsReporterService?.markDiffEnd(t),this.lastDiff={result:n.result,precedingWrite:this.lastWrite},n}finally{this.logResultCacheOverflowOnce("diff",e.query)}}destroy(){this.graphqlStoreStatsReporterService?.removeCacheStatsCallback(this.storeType,this.cacheStatsCallback)}logResultCacheOverflowOnce(e,t){const n=t.definitions[0],i=this.getLastResultCacheOverflow();if(!this.scenarioFactory||i<=0||"OperationDefinition"!==n.kind)return;let a;if(n.name||1!==n.selectionSet.selections.length||"FragmentSpread"!==n.selectionSet.selections[0].kind){a={definitionKind:"query",definitionName:n.name?.value??"(unnamed)",overflowSize:i,method:e}}else{a={definitionKind:"fragment",definitionName:n.selectionSet.selections[0]?.name?.value??"",overflowSize:i,method:e}}const o=`${a.definitionKind}-${a.definitionName}`;if(!this.definitionOverflowLogged.has(o)){this.scenarioFactory.createScenarioWithoutStarting(s.Cu.ApolloResultCacheOverflow).stop(a),this.definitionOverflowLogged.add(o)}}getLastResultCacheOverflow(){return(((this.storeReader??{}).executeSelectionSet??{}).__DEBUG_ONLY_optimismCache??{}).__DEBUG_ONLY_lastOverflow||0}}const c=l;var d=n(975021);var u=n(873058);const m=(e={})=>{const{apolloLeakOptions:t,cache:n,loggerFactory:o,scenarioFactory:r,enableApolloDevtools:s,enableApolloDoubleWriteFix:l,storeType:c=a.J.other,graphqlStoreStatsReporterService:d,...u}=e,m=new i.R({...u,cache:n||p({apolloLeakOptions:t,loggerFactory:o,scenarioFactory:r,storeType:c,graphqlStoreStatsReporterService:d,enableApolloDoubleWriteFix:l}),assumeImmutableResults:!0,connectToDevTools:Boolean(s)});return g(m,t),m},p=({apolloLeakOptions:e,loggerFactory:t,scenarioFactory:n,graphqlStoreStatsReporterService:i,storeType:r,enableApolloDoubleWriteFix:s,enableGlobalObjectIdStoreKeys:l,...m}={})=>{const p=l?(e=>{return{...e,typePolicies:{...e.typePolicies,...u.b,Query:{fields:{...e.typePolicies?.Query?.fields,...u.b.Query.fields}}},dataIdFromObject:(t=e.dataIdFromObject,n=e.possibleTypes,(e,i)=>(e=>t=>{if(t.id&&t.__typename&&e&&e.Node.includes(t.__typename))return t.id})(n)(e,i)||(t?t(e,i):(0,d.or)(e,i)))};var t,n})(m):m,h={loggerFactory:t,scenarioFactory:n,graphqlStoreStatsReporterService:i,storeType:r||a.J.other,enableApolloDoubleWriteFix:s},v=new c(p,h);return e?.leakDetector?.track(o.J.ApolloCache,v),g(v,e),v},g=(e,{userContextId:t,windowId:n,entityType:i,viewportContext:a}={})=>{e.apolloLeakInfo={apolloLeakInfoStartTime:(new Date).toISOString(),apolloLeakInfoEntityType:i,apolloLeakInfoUserContextId:t,apolloLeakInfoViewportContext:a,apolloLeakInfoWindowId:n}},h=e=>{e.apolloLeakInfo||(e.apolloLeakInfo={}),e.apolloLeakInfo.apolloLeakInfoEndTime=(new Date).toISOString()}},445494:(e,t,n)=>{"use strict";n.d(t,{q:()=>o});var i=n(354281),a=n.n(i);const o=e=>{const t=performance.now();return{cacheSize:a()({data:e.data.data,optimisticData:e.optimisticData.data}),measuringTime:performance.now()-t}}},802716:(e,t,n)=>{"use strict";n.d(t,{X9:()=>r,tx:()=>s,SD:()=>c});var i=n(354281),a=n.n(i);function o(e){const t=e.storeReader,n=t?.executeSelectionSet?.__DEBUG_ONLY_optimismCache,i=t?.executeSubSelectedArray?.__DEBUG_ONLY_optimismCache;return{selectionSetCache:n,selectionSetArrayCache:i}}function r(e){const{selectionSetCache:t,selectionSetArrayCache:n}=o(e),i=performance.now(),r=[Array.from(t.map),Array.from(n.map)];return{cacheSize:a()(r),measuringTime:performance.now()-i}}function s(e){const{selectionSetCache:t,selectionSetArrayCache:n}=o(e);return{objectCount:t.map.size,arrayCount:n.map.size}}function l(e){if(0===e.length)return"[Dirty]";let t="";return e[0]&&e[0].result&&(t=e[0].result?.__typename??"[Query]"),e[1]&&(t+=` (Error: ${e[1]?.message??""})`),t}function c(e){const{selectionSetCache:t}=o(e),n=new Map;for(const e of t.map.values()){const t=l(e.value.value),i=n.get(t)??0;n.set(t,i+1)}return Array.from(n).sort(((e,t)=>t[1]-e[1]))}},316178:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});var i=n(523861),a=n(45530);const o=["NoNetwork","RemoteOperationFailed"];class r extends i.C{constructor(e,t){super({type:"AuthError",code:s(e,t),prevError:"boolean"==typeof e?void 0:e})}getBoundaryProps(){switch(this.code){case"SIGN_IN_RESTRICTIONS":return{title:"default_signinrestrictions_title",description:"default_signinrestrictions_description",actions:["RESTART"]};case"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED":return{title:"default_error_getuser_when_anon_not_supported_title",description:"default_error_getuser_when_anon_not_supported_description"};case"OFFLINE":return{title:"default_auth_no_network_title",description:"default_auth_no_network_description",actions:["RESTART"]};default:return{title:"default_authentication_title",description:"default_authentication_description",actions:["RESTART","SIGN_OUT"]}}}static fromSerialized(e){if("AuthError"!==e?.type)return null;const t=new r(void 0,e.code);return t.deserialize(e),t}}function s(e,t){if(t)return t;if("boolean"==typeof e)return e?"SIGN_IN_RESTRICTIONS":"UNKNOWN";if((0,a.C)(e)){const t=e.code;switch(t){case"SignInRestrictions":return"SIGN_IN_RESTRICTIONS";case"ErrorGetUserWhenAnonNotSupported":return"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED";default:return o.includes(t)?"OFFLINE":"UNKNOWN"}}return"UNKNOWN"}},258322:(e,t,n)=>{"use strict";n.d(t,{B:()=>a});var i=n(523861);class a extends i.C{constructor(e,t){super({type:"UnknownError",code:"NONE",message:e.message,prevError:e}),this.context=t}getExtensions(){return{...super.getExtensions(),...this.context}}toTelemetryCode(){return`[${this.type}]`}}},779191:(e,t,n)=>{"use strict";n.d(t,{X:()=>i});const i=async()=>n.e(791849).then(n.bind(n,791849))},853676:(e,t,n)=>{"use strict";n.d(t,{LC:()=>o});var i=n(403379);function a(e,t,n){return function(e,t,n){const a=[];return e.slice().forEach((e=>{let o=!0;t.forEach((({keyPath:t})=>{const a=function(e,t){return n=>{if(t&&t.length){const e=n?.getLinkedRecord("node")?.getValue("id"),i=String(e||"");if(t.includes(i))return!0}const a=(0,i.aV)(n,e);return void 0===a||!!a}}(t,n);o=o&&a(e)})),o&&a.push(e)})),a}(e,t,n)}function o(e,t,n){const i=e.getLinkedRecords("edges");if(!i||0===i.length||!t||0===t.length)return;const o=a(i,t,n);o&&e.setLinkedRecords(o,"edges")}},458410:(e,t,n)=>{"use strict";n.d(t,{$R:()=>a,kX:()=>o,Jq:()=>r,n3:()=>s});var i=n(403379);function a(e,t,n,i){if(n||(n=e.getLinkedRecords("edges")),!n)return-1;if(0===n.length)return 0;const a=l(e);if(!a)return-1;const o=c(a,i),r=n.findIndex((e=>o(t,e)<0));return-1===r?n.length:r}function o(e,t,n){const i=a(e,t,n);-1!==i&&(n||(n=e.getLinkedRecords("edges")),n?(n.splice(i,0,t),e.setLinkedRecords(n,"edges")):e.setLinkedRecords([t],"edges"))}function r(e,t,n,a){const o=l(e,n);if(o)return function(e,t,n,a){const o=c(t,n),r=e.slice(),s=e.slice().sort(((e,t)=>o(e,t)));if(!function(e,t){if(e.length!==t.length)return!1;return e.every(((e,n)=>e===t[n]))}(r,s))return n&&a&&function(e,t,n,a){const o=[],r=new Map(e.map((e=>[e.getDataID(),(0,i.Rh)(e,a)]))),s=new Map(e.map(((e,t)=>[e.getDataID(),t]))),l=new Map(t.map(((e,t)=>[e.getDataID(),t])));s.forEach(((e,t)=>{const n=l.get(t),i=r.get(t);n!==e&&o.push(`[Index ${e} -> ${n}] - edge identifier: ${i}`)}));const c=`Connection sorting changes applied, order updates are:\n${o.join("\n")}`;n(c,"infoToTelemetry")}(r,s,n,a),s;return}(t,o,n,a)}function s(e,t,n){const i=e.getLinkedRecords("edges");if(!i||0===i.length)return;const a=r(e,i,t,n);a&&e.setLinkedRecords(a,"edges")}function l(e,t){const n=e.getLinkedRecords("sortInfo");if(n&&0!==n.length)return n.map((e=>{const n=e.getValue("keyPath"),i=e.getValue("direction");return n&&i||t?.(`Missing keyPath or direction in sort descriptor, keyPath: ${n}, direction: ${i}`,"warnToTelemetry"),{keyPath:n,direction:i}}));t?.("No sort descriptors found in connection","warnToTelemetry")}function c(e,t){const n=e.map((e=>({direction:e.direction,keyPath:e.keyPath})));return(e,a)=>{let o=0;for(const{keyPath:r,direction:s}of n){if(o=d((0,i.aV)(e,r),(0,i.aV)(a,r),s,r,t),0!==o)return o}return o}}function d(e,t,n,i,a){if(void 0===e||void 0===t)return 0;if(null===e&&null===t)return 0;if(null===e)return"ASC"===n?-1:1;if(null===t)return"ASC"===n?1:-1;if(typeof e!=typeof t){const n=`Cannot sort on different types: ${typeof e} and ${typeof t} for keyPath: ${i}`;return a?.(n,"errorToTelemetry"),0}if("string"==typeof e&&"string"==typeof t)return"ASC"===n?e.localeCompare(t):t.localeCompare(e);if("number"==typeof e&&"number"==typeof t)return"ASC"===n?e-t:t-e;if("boolean"==typeof e&&"boolean"==typeof t)return"ASC"===n?+e-+t:+t-+e;{const n=`Cannot sort on given types: ${typeof e} and ${typeof t} for keyPath: ${i}`;return a?.(n,"errorToTelemetry"),0}}},403379:(e,t,n)=>{"use strict";function i(e,t){return function(e,t){return t.reduce(((e,n,i)=>t.length-1===i?e&&e.getValue(n):e&&e.getLinkedRecord(n)),e)}(e,t.split("."))}function a(e,t){return t.split("||").reduce(((t,n)=>{const a=n.split(",");let o;for(const t of a)void 0===o&&(o=i(e,t));return void 0===o&&void 0===t?void 0:void 0===o?t:void 0===t?o:o||t}),void 0)}n.d(t,{Rh:()=>i,aV:()=>a})},443400:(e,t,n)=>{"use strict";n.d(t,{k:()=>F});var i=n(489431),a=n(127671),o=n(119872),r=n(953730),s=n(854190),l=n(754255),c=n(850434),d=n(210841),u=n(910857),m=n(762322),p=n(554186),g=n(553882),h=n(188468),v=n(141873),y=n(458648),S=n(446320),f=n(139496),k=n(199448);const C=3e5;var b=n(924820),w=n(702183),T=n(195695);const I="beta/imageauth/cookie",N="beta/users/{objectId}/cookiev2",A=1e3,E=new Map([[y.oF.SKYPE_KEY,["ams","amsV2"]],[y.oF.MT_KEY,["mtImageService"]]]);class F{constructor(e,t,n,c,d,p,h,y,b,w,T,E,F,_,D,P){var M;this._gtmRegistry=t,this._discover=n,this.coreSettings=d,this.scenarioFactory=p,this.windowProvider=h,this.platformService=y,this.localStorage=w,this._authenticationService=T,this.config=E,this.user=F,this.clientState=_,this.networkState=D,this.hostState=P,this._imageAuthCookieExpiryTsKey="ImageAuthCookieExpiryTime",this._activeAmsRequest={},this._baseImageUrlSubject=new g.t(null),this._isInitialized=!1,this._isImageAuthCookieValidSubject=new g.t(!1),this._imageCookieRetryInterval=2e4,this._imageCookieRetryMaxCount=5,this._isSetupImageCookieInProgress=!1,this._useAadV2MiddleTierToken=!1,this._enableEpmForSetCookie=!1,this.checkImageAuthCookie=()=>{let e=-1;const t=(new Date).getTime()/A,n=this.localStorage&&this.localStorage.get(this._imageAuthCookieExpiryTsKey,"Global")||"-1";e=parseInt(n,10);const i=e>t,a=i?`Image auth cookie has NOT expired. Expiry time stamp: ${e}`:`Image auth cookie has expired. Expiry time stamp: ${e}`;this._logger.log(a),this._isImageAuthCookieValidSubject.next(i),this.startImageAuthCookiePollingTimer(i,e)},this.getRequest=(e,{requestUrl:t,requestBody:n,headers:i,serviceName:a},o)=>this._gtmRegistry.bind(this._send,e)({url:t,headers:i,credentials:"include",method:"POST",body:n,serviceName:a,apiName:o}),this.setupImageAuthCookie=()=>Promise.resolve({constructRequest:()=>({url:this._isMTMAProfilePicturesEnabled&&this._userObjectId?N.replace("{objectId}",this._userObjectId):I,method:"POST",headers:{"x-ms-client-caller":"imageAuthCookieSetupEM","x-ms-client-type":(0,v.Y)(this.platformService,this.config)},credentials:"include",apiName:"imageAuthCookie"}),allowedResponses:[r.bw.HTTP_2XX],retryPolicy:this.imageCookieRetryPolicy(),transformResponse:e=>{if(e.status===r.nW.OK)return Promise.resolve();throw(0,u.$)(m.B.RequireStatusFailed,e)}}),this.setupImageAuthCookieEndpoints=({discover:e,authenticationResources:t})=>({baseUrlPromise:()=>e.regionGtm("middleTier"),serviceName:s.p.MiddleTier,authResource:t.mtAuthResource,models:{setupImageAuthCookie:this.setupImageAuthCookie()}}),this._logger=c.newLogger("Content Media Auth","services-io-browser-aync-media"),this._send=(0,i.w)((0,a.c)((0,o.A)(e),r.nW.NO_CONTENT,r.nW.OK),(M=this._logger,{shouldRetry:e=>(0,k.GQ)(e)||[r.nW.THROTTLED,-1].indexOf(e)>-1,errorHandler:(e,t)=>{const{serverResponse:{status:n}}=e;if(!t.retriesTable[n])throw new Error(`AsyncMediaAuthServiceRetryPolicy: retry count for ${n} is empty`);return M.error(`asyncMediaAuthServiceRetryPolicy: retrying '[${t.retryCount}]' times due to response status - '[${n}]'`),(0,S.y)(t.delay.next())},retryMaxTimeMs:C,maxRetryCount:6,createDelay:()=>new f.nC(1e3,2,C)})),this._setupImageAuthCookieApi=b.createApi(this.setupImageAuthCookieEndpoints),this._imageCookieRetryInterval=d.get(l.w.People).imageCookieRetryInterval||2e4,this._imageCookieRetryMaxCount=d.get(l.w.People).imageCookieRetryMaxCount||5,this._isMTMAProfilePicturesEnabled=!!d.get(l.w.People).enableProfilePicturesWithObjectId,this._isDeleteImageAuthCookieEnabled=!!d.get(l.w.People).enableDeleteImageAuthCookie,this._enableEpmForSetCookie=!!d.get(l.w.People).enableEpmForSetCookie;const R=!!d.get(l.w.People).enableProfileObjectIdForSetCookie;this._userObjectId=R?this.user?.profile.objectId:this.user?.id,this._isMTMAProfilePicturesEnabled&&(this._imageAuthCookieExpiryTsKey=`${this._imageAuthCookieExpiryTsKey}_${this._userObjectId}`),this._useAadV2MiddleTierToken=!!d.get(l.w.Auth).enableAadV2TokenForMiddleTier}initAsyncMediaAuthService(){if(this._isInitialized)return;this.initBaseImageUrl().catch((()=>{this._logger.error("Error in initCookieImageAuth")}));const{enableAmsCookieValidation:e}=this.coreSettings.get(l.w.Core),{isImageAuthCookiePollingCheckEnabled:t}=this.coreSettings.get(l.w.People),{skipAmsAuthRequest:n,disableTokenCacheReadEvent:i}=this.coreSettings.get(l.w.Auth);e&&t?this.checkImageAuthCookie():n?this._isImageAuthCookieValidSubject.next(!0):(this._discover.validateSkypeToken({correlation:(0,T.$q)("async-media-auth-service:initAsyncMediaAuthService")}).catch((()=>{})),this.subscribeToToken(y.oF.SKYPE_KEY),i?this.subscribeToMiddleTierToken():this.subscribeToToken(y.oF.MT_KEY),this.subscribeToClientAndMachineStates()),this._isInitialized=!0}async logout(){let e,t=s.p.Skype;const n=y.oF.MT_KEY,i=this.getMtResource();if(i&&this._isDeleteImageAuthCookieEnabled&&this._userObjectId&&this._authenticationService?.acquireTokenV2)try{const{token:a}=await(this._authenticationService?.acquireTokenV2(i)),o=E.get(n)??[],r=this.getHeaders(a,n);e=this._isMTMAProfilePicturesEnabled?"beta/users/{objectId}/deletecookiev2".replace("{objectId}",this._userObjectId):"beta/imageauth/deletecookie",t=s.p.MiddleTier;const{requireSkypetokenForMT:c}=this.coreSettings.get(l.w.Auth);return c&&(r["x-skypetoken"]=await this._discover.validateSkypeToken({correlation:(0,T.$q)("async-media-auth-service:logoout")})),this._logger.log("queueing request for deleting image auth cookie"),this.queueRequests(o,n,{requestUrl:e,headers:r,requestBody:undefined,serviceName:t},"deleteCookieOnLogout"),this._activeAmsRequest[n]&&this._activeAmsRequest[n][0]?this._activeAmsRequest[n][0]:(this._logger.warn("no request was sent for deleting image auth cookie"),Promise.resolve())}catch(e){const t=`Failed to delete image auth cookie on logout: errorCode: ${e?.code}, errorReason: ${e?.reason},errorContext: ${e?.context}, errorMessage: ${e?.message}`,n=(0,b.y)(t);this._logger.errorToTelemetry?this._logger.errorToTelemetry(n,"async_media_auth_service",void 0,!0):this._logger.error(t)}}startImageAuthCookiePollingTimer(e,t){this._imageAuthCookiePollingTimerId&&(this._logger.log(`Clearing image auth cookie polling. Timer ID: ${this._imageAuthCookiePollingTimerId}`),this.windowProvider.clearInterval(this._imageAuthCookiePollingTimerId));const n=Math.abs(t*A-(new Date).getTime()),i=e?n:5e3;this._imageAuthCookiePollingTimerId=this.windowProvider.setInterval((()=>this.checkImageAuthCookie()),i);const a=e?`Image auth cookie valid. expiry check timer started. Timer ID: ${this._imageAuthCookiePollingTimerId}`:`Image auth cookie NOT valid. polling validity timer started. Timer ID: ${this._imageAuthCookiePollingTimerId}`;e||this._logger.warn(a)}async initBaseImageUrl(){const e=E.get(y.oF.MT_KEY)??[],t=await this.getBaseUrl(e[0]);t&&this._baseImageUrlSubject.next(t)}async getBaseUrl(e){try{const t=await this._discover.regionGtm(e);return t||this._logger.error("baseImageUrl is undefined"),t}catch(t){const n=`Fetching baseImageUrl failed from regionGTM, passed gtm: ${e.length}, errorCode: ${t?.code}, errorContext: ${t?.context}, errorMessage: ${t?.message}`,i=(0,b.y)(n);return this._logger.errorToTelemetry?this._logger.errorToTelemetry(i,"async_media_auth_service",void 0,!0):this._logger.error(n),Promise.reject(t)}}subscribeToToken(e){e===y.oF.SKYPE_KEY&&this._discover.observeSkypeToken().subscribe((e=>this.persistTokenToAMS(e,y.oF.SKYPE_KEY))),e===y.oF.MT_KEY&&this._authenticationService?.observeMiddleTierToken().subscribe((e=>{this._enableEpmForSetCookie?this.setupImageAuthCookieAndExpiry():this.persistTokenToAMS(e,y.oF.MT_KEY)}))}getHeaders(e,t){const n={},i=(0,p.v4)();return n.Authorization=`${t===y.oF.SKYPE_KEY?"skype_token":"Bearer"} ${e}`,n["Content-Type"]="application/x-www-form-urlencoded",n.RequestId=i,n.CorrelationId=i,n.TransactionId=i,n["x-ms-client-type"]=(0,v.Y)(this.platformService,this.config),n}async persistTokenToAMS(e,t){let n,i,a,o,r=s.p.Skype;const d=E.get(t)??[],u=this.getHeaders(e,t);if(!e)return Promise.resolve(null);if(this._activeAmsRequest[t])return this._activeAmsRequest[t];switch(this._logger.log(`persistTokenToAMS: received new token for ${t}`),t){case y.oF.SKYPE_KEY:n=`skypetoken=${e}`,i="v1/skypetokenauth",r=s.p.Skype;break;case y.oF.MT_KEY:o=this.scenarioFactory.newScenario(w.Cu.ImageAuthCookie),i=this._isMTMAProfilePicturesEnabled&&this._userObjectId?N.replace("{objectId}",this._userObjectId):I,r=s.p.MiddleTier,a=await this.getBaseUrl(d[0]);const{requireSkypetokenForMT:t}=this.coreSettings.get(l.w.Auth),{disableSkypeTokenInCookieRequest:c}=this.coreSettings.get(l.w.People);t&&!c&&(u["x-skypetoken"]=await this._discover.validateSkypeToken({correlation:(0,T.$q)("async-media-auth-service:persistTokenToAMS")}))}return this._logger.log(`persistTokenToAMS: queueing request for ${t}`),this.queueRequests(d,t,{requestUrl:i,headers:u,requestBody:n,serviceName:r},"persistTokenToAMS"),Promise.all(this._activeAmsRequest[t]).then((()=>{this._activeAmsRequest[t]=void 0,this._logger.log(`persistTokenToAMS: persist token for ${t}`),t===y.oF.MT_KEY&&(this.setImageAuthCookieValidityAndExpiry(),o&&o.stop({reason:"Cookie_success"}),a?this._baseImageUrlSubject.next(a):this._logger.error("baseImageUrl is undefined"))})).catch((e=>{if(t===y.oF.MT_KEY){const{reason:t,code:n,context:i}=e,a=(0,k.WZ)(e)||(0,k.ej)(t,i),r={errors:(0,b.y)(e),errorCode:n,reason:(0,b.y)(t)};o&&(a?o.cancel(r):o.fail(r))}this._logger.error(`Unable to persist token: tokenType ${t} error ${e}`),this._activeAmsRequest[t]=void 0;const{enableRetryAuthCookieWithEM:n}=this.coreSettings.get(l.w.People);n&&e?.code===c.O4.RemoteOperationFailed&&t===y.oF.MT_KEY&&(this._logger.log("persistTokenToAMS: retry cookie set up with EM"),this.setupImageAuthCookieAndExpiry())})),this._activeAmsRequest[t]}queueRequests(e,t,n,i){this._activeAmsRequest[t]=[],e.map((e=>{this._activeAmsRequest[t].push(this.getRequest(e,n,i))}))}async checkAuthCookieValidity(){if(this.isImageCookieExpired()){this._logger.log(`image auth cookie expired for account ${this._userObjectId}`),this._isImageAuthCookieValidSubject.next(!1);const e=this.networkState?.isOnline();if(e){const e=this.getMtResource();if(e&&this._authenticationService?.acquireTokenV2){const t=Math.round(Date.now()/A);this._logger.log(`force token refresh now ${t} for account ${this._userObjectId}`);const n=await(this._authenticationService?.acquireTokenV2(e));this._logger.log(`refreshed token expiry ${n?.expires} for account ${this._userObjectId}`)}}}}subscribeToClientAndMachineStates(){const{enableAuthCookieValidityCheck:e}=this.coreSettings.get(l.w.People);e&&(this.clientState?.observe().subscribe((async e=>{this._logger.log(`receive clientState ${e} for account ${this._userObjectId}`);(e===d.Lg.Active||e===d.Lg.VeryActive)&&this.checkAuthCookieValidity()})),this.networkState?.observeIsOnline().subscribe((e=>{this._logger.log(`receive isOnline ${e} for account ${this._userObjectId}`),e&&this.checkAuthCookieValidity()})),this.hostState?.observe().pipe((0,h.F)(((e,t)=>e.machineLockState===t.machineLockState))).subscribe((e=>{this._logger.log(`receive machineLockState ${e.machineLockState} for account ${this._userObjectId}`),e.machineLockState===d.iP.Active&&this.checkAuthCookieValidity()})),this.hostState?.observe().pipe((0,h.F)(((e,t)=>e.machineIdleState===t.machineIdleState))).subscribe((e=>{this._logger.log(`receive machineIdleState ${e.machineIdleState} for account ${this._userObjectId}`),e.machineIdleState===d.B6.Active&&this.checkAuthCookieValidity()})))}subscribeToMiddleTierToken(){this._authenticationService?.observeMiddleTierToken().subscribe((e=>{if(e||this.isImageCookieExpired()){const t=e?"token changed":"cookie expired";this._logger.log(`Set up image auth cookie due to: ${t}`),this.setupImageAuthCookieAndExpiry()}else this._isImageAuthCookieValidSubject.next(!0)}))}async setImageAuthCookieValidityAndExpiry(){this._isImageAuthCookieValidSubject.next(!0);const e=this.getMtResource();if(e&&this._authenticationService?.acquireTokenV2){const t=await(this._authenticationService?.acquireTokenV2(e)),n=t?.expires;n&&this.localStorage?.set(this._imageAuthCookieExpiryTsKey,n.toString(),"Auth","Global"),this._logger.log(`Successfully set up image auth cookie expiry ${n}`)}}async setupImageAuthCookieAndExpiry(){if(this._isSetupImageCookieInProgress)return;this._isSetupImageCookieInProgress=!0,this._logger.log("Setting up image auth cookie");const e=this.scenarioFactory.newScenario(w.Cu.ImageAuthCookieEpm);try{await this._setupImageAuthCookieApi.setupImageAuthCookie(),this.setImageAuthCookieValidityAndExpiry(),e.stop()}catch(t){this._logger.error(`setupImageAuthCookieAndExpiry error ${t}`),e.fail()}finally{this._isSetupImageCookieInProgress=!1}}isImageCookieExpired(){const e=Math.round(Date.now()/A),t=this.localStorage?.get(this._imageAuthCookieExpiryTsKey,"Global")||"-1";return parseInt(t,10)<e}getMtResource(){const{mtResource:e,mtResourceV2:t}=this.coreSettings.get(l.w.Auth)||{};return this._useAadV2MiddleTierToken?t:e}imageCookieRetryPolicy(){return{shouldRetry:(e,t,n)=>{if(t>=r.nW.OK&&t<=r.nW.NOT_MODIFIED)return!1;const i=e<this._imageCookieRetryMaxCount&&t!==r.nW.BAD_REQUEST&&t!==r.nW.NOT_AUTHORIZED&&t!==r.nW.FORBIDDEN;return this._logger.warn(`imageCookieRetryPolicy retry count ${e} responseCode ${t} canRetry ${i}`),i},nextDelay:e=>this._imageCookieRetryInterval*Math.pow(2,e)}}get baseImageUrlObservable(){return this._baseImageUrlSubject.asObservable()}get isImageAuthCookieValidObservable(){return this._isImageAuthCookieValidSubject.asObservable()}get baseImageUrl(){return this._baseImageUrlSubject.value}get isImageAuthCookieValid(){return this._isImageAuthCookieValidSubject.value}}},581386:(e,t,n)=>{"use strict";n.d(t,{WI:()=>ot,k6:()=>nt,cn:()=>at,fS:()=>it});var i=n(383851),a=n(364819),o=n(754255),r=n(702183),s=n(600824),l=n(780952),c=n(781463),d=n(102029),u=n(556139);const m=e=>{e&&d.L.DomUtils.hasAttrib(e,u.eS.type)&&delete e.attribs[u.eS.type]};var p=n(218324),g=n(625730),h=n(220192),v=n(894143);const y={fileDetailsPromiseResolved:"file_deatails_promise_resolved"};let S=class{constructor(){this._allowAsyncChicletCreation=!1,this._asyncLinkConversionDetailsByItemId=new Map,this._loggerCb=a.noop,this._timeout=0}async preTransform(e,t){if(!e||!t||!d.L.DomUtils.hasAttrib(e,"href"))return;this._setupConstants(t);const n=e.attribs[u.eS.itemid];if(!n)return;const i=!!d.L.DomUtils.hasAttrib(e,u.eS.dataProcessedUrl)&&"true"===e.attribs[u.eS.dataProcessedUrl],o=t.hasEdit;if(this._allowAsyncChicletCreation&&!i&&!o){const i=(0,a.unescape)(e.attribs.href),{fileReferenceService:o}=t,s=o.parseFileLabelFromUrl(i);if(!s)return void m(e);const c=this._scenarioFactory?.newScenario(r.Cu.AsyncLinkToChiclet),d=this._asyncLinkConversionDetailsByItemId.get(n);if(d)return void _(d,i,c,(e=>this._asyncLinkConversionDetailsByItemId.set(n,e)));try{const e=(0,l.a)(o.getFileDetails(s,"chat",["fluid"]),this._timeout,"file details call timed out");this._asyncLinkConversionDetailsByItemId.set(n,{fileDetailsPromise:e,scenario:c,linkInfo:{href:i,count:1}})}catch(t){return F(e,c,t?.message||"")}}return e}async transform(e,t){if(!(e&&d.L.DomUtils.hasAttrib(e,"href")&&t&&t.files&&t.messageProperties&&t.existingLinks))return;const n=e.attribs[u.eS.itemid];if(!n)return;const i=this._asyncLinkConversionDetailsByItemId.get(n);if(i){const{scenario:n}=i;try{const a=await k(t,e,i);return n&&n.stop(),a}catch(t){return m(e),void(0,p.$)(t,this._loggerCb,n)}}if(!d.L.DomUtils.hasAttrib(e,u.eS.itemProps))return E(e,t);const{files:a}=t;try{const i=A(a,e);if(!i)return;const{shareUrl:o,title:r}=i;o&&(e.attribs.href=o),b(e,r,o),C(i,n,t)}catch(e){return}return e}_setupConstants({coreSettings:e,loggerFactory:t,scenarioFactory:n}){this._loggerCb=f(t.newLogger("SharepointLinkSerializer","services-io-files-compose-serializer-extensions")),this._scenarioFactory=n;const{enableFilesAsyncChicletCreationInMultiWindow:i,asyncChicletCreationTimeout:a}=e.get(o.w.Files);this._allowAsyncChicletCreation=!!i,this._timeout=a||3e3}};S=(0,i.__decorate)([(0,s.hY)({name:"SharepointLinkSerializer",filter:"a"})],S);const f=e=>t=>{e.error(t)},k=async(e,t,n)=>{const{fileDetailsPromise:i,scenario:a}=n,o=await i;return a&&a.mark(y.fileDetailsPromiseResolved),C(o,o.fileId,e),((e,t)=>{const{files:n}=t;return-1!==n.findIndex((t=>t.id===e.fileId))})(o,e)||N(e,(({objectUrl:e,shareUrl:t,type:n,fileId:i,title:a,baseUrl:o,shareId:r,fileSourceDetail:s})=>{const l=(0,v.AZ)(e),{permissionScope:c}=s||{permissionScope:""};return{id:i,baseUrl:o,objectUrl:e,shareUrl:t,shareId:r,type:n,title:a,permissionScope:c,state:"reference",isReferencedFile:!0,serviceName:"p2p",previewUrl:"",chicletBreadcrumbs:{sourceChannelName:l?.sourceChannelName||null,sourceTeamName:l?.sourceTeamName||null},previewHeight:null,previewWidth:null,progressComplete:null,hasUploadFailed:!1}})(o)),m(t),t},C=(e,t,n)=>{const{objectUrl:i,shareUrl:a,title:o,type:r}=e,s=T({objectUrl:i,shareUrl:a,itemid:t,type:r,title:o});I(n,s)},b=(e,t,n)=>{e.children&&w(t,e,n)},w=(e,t,n)=>{const i=[t];for(;0!==i.length;){const o=i.pop();if(o&&o.children)for(const r of o.children){if("text"===r.type&&(0,a.startsWith)(r.data,"https"))return r.data=e,t.attribs&&(t.attribs.title=n),!0;i.push(r)}}return!1},T=({objectUrl:e,shareUrl:t,itemid:n,type:i,title:a})=>({title:a,objectUrl:e,description:"",fileShareUrlMeta:{id:n,objectUrl:e,type:i,shareUrl:t}}),I=(e,t)=>{e.messageProperties.embeddedLinks=[...e.messageProperties.embeddedLinks||[],t],e.telemetryDatabag["DataBag.links"]=(e.telemetryDatabag["DataBag.links"]||0)+1},N=(e,t)=>{e.files.push(t)},A=(e,t)=>{const n=t.attribs[u.eS.itemid],i=e.find((e=>e.id===n));if(i){const{shareUrl:e,title:t,objectUrl:n,type:a}=i;return{shareUrl:e||"",title:t||"",type:a||"",objectUrl:n||""}}if(t.attribs[u.eS.itemtype]===h.A.filesHyperlink){const e=t.attribs[u.eS.itemProps];if(e){const t=(0,a.unescape)((0,a.unescape)(e)),n=JSON.parse(t),{type:i,objectUrl:o,shareUrl:r,title:s}=n;return{shareUrl:r,title:s,objectUrl:o,type:i}}}},E=(e,t)=>{if(d.L.DomUtils.hasAttrib(e,"href")){const n=e.attribs.href||"",i=t.existingLinks.filter((e=>e.fileShareUrlMeta?.shareUrl===n));if(i&&i.length&&i[0].fileShareUrlMeta)return I(t,(0,c.h)(i[0],"__typename")),e}},F=(e,t,n)=>{m(e),t?.fail({errorCode:g.Id.telemetry.errorCodes.asyncLinkConversionPretransformFailure,errors:JSON.stringify(n)})},_=(e,t,n,i)=>{const{linkInfo:a}=e;let o="";if(a&&t===a.href){const{count:n}=a;o=`Duplicate links: ${n}`,i({...e,linkInfo:{href:t,count:n+1}})}else o="Different href for same itemid";n?.incomplete({errorCode:g.Id.telemetry.errorCodes.asyncLinkMultiplePretransform,errors:o})};var D=n(318501),P=n(503210),M=n(84646),R=n(806658),x=n(849933);let L=class{constructor(){this._getTelemetryDatabagKeyByTagType=e=>e.startsWith(x.o1)?"PeopleTargeting.numScheduledTagMentions":e.startsWith(x.Oq)?"PeopleTargeting.numAutomaticTagMentions":"PeopleTargeting.numTeamTagMentions",this._shouldGroupMentions=()=>this._enableComposeFrameworkV2&&this._enableGroupedMentions,this._unescapeMentionText=e=>this._enableComposeFrameworkV2?(0,a.unescape)(e).replace(/&nbsp;/g," "):e,this._removeExtraSpacesInMention=e=>{e.parent?.children.forEach((e=>{"text"!==e.type||" "!==e.data&&!this._isWhitespaceFromComposeV2(e.data)||d.L.DomUtils.removeElement(e)}))},this._getMentionKey=e=>{const t=e.children?.[0]?.data,n=e.attribs?.[u.eS.mri];return`${n}_${t}`},this._mergeMentions=(e,t)=>{if(!e.attribs)return;const n=e.attribs[u.eS.mri]||"";let i=this._getNextContigousMention(e,n);for(;e.children&&e.children.length>0&&i;){const a=i.children;if(a&&a.length>0&&a[0].data){const n=this._getMentionKey(i),o=t.get(n);o?t.set(n,o+1):t.set(n,1),e.children[0].data+=` ${a[0].data}`}i=this._getNextContigousMention(i,n)}},this._isWhitespaceFromComposeV2=e=>!("&nbsp;"!==e||!this._shouldGroupMentions()),this._getNextContigousMention=(e,t)=>{if(!e||!e.next)return null;const n=e.next,i=t===n?.attribs?.[u.eS.mri];return" "===n.data||this._isWhitespaceFromComposeV2(n.data)||i?n:null},this._enableComposeFrameworkV2=!1,this._enableGroupedMentions=!1}transform(e,t){const{enableComposeFrameworkV2:n}=t.coreSettings.get(o.w.Messaging),{enableGroupedMentions:i}=t.coreSettings.get(o.w.Compose);if(this._enableComposeFrameworkV2=!!n,this._enableGroupedMentions=!!i,!(e&&t&&t.messageProperties&&d.L.DomUtils.hasAttrib(e,u.eS.mri)))return;t.seenMentions||(t.seenMentions=new Map);const r=this._getMentionKey(e),s=t.seenMentions.get(r);if(s)return 1===s?t.seenMentions.delete(r):t.seenMentions.set(r,s-1),null;this._mergeMentions(e,t.seenMentions);const{messageProperties:l,telemetryDatabag:c}=t;l.mentions||(l.mentions=[]),l.onBehalfOf||(l.onBehalfOf=[]);const m=`${l.mentions.length+l.onBehalfOf.length}`,p=this._unescapeMentionText((0,P.q4)(e)),g=e?.attribs?.[u.eS.type]||(O(e)?"bot":"person");if("nearby"===g)return;if("tag"===g){const t=e?.attribs?.[u.eS.mri];if(t){const e=this._getTelemetryDatabagKeyByTagType(t);c[e]=(c[e]||0)+1}}else c["DataBag.atmentions"]=(c["DataBag.atmentions"]||0)+1;const v=(0,P.VZ)(D.S8.span),y=(0,P.GZ)((0,a.escape)(p)),S=d.L.DomUtils.hasAttrib(e,u.eS.stale),f=d.L.DomUtils.getAttributeValue(e,u.eS.mri)||"";return d.L.DomUtils.appendChild(v,y),S||("webhook"===g?(l.onBehalfOf.push({itemId:m,displayName:p,userId:f,mentionType:g}),l.mentions.push({itemId:`${Number(m)+1}`,displayName:p,userId:M.Th.InterceptorBotMris[0],mentionType:g})):l.mentions.push({itemId:m,displayName:p,userId:f,mentionType:g}),v.attribs[u.eS.itemtype]=h.A.mention,v.attribs[u.eS.itemscope]=e?.attribs?.[u.eS.itemscope]??"",v.attribs[u.eS.itemid]=m),this._removeExtraSpacesInMention(e),v}};L=(0,i.__decorate)([(0,s.dL)({name:"AtMentionSerializer",filter:"mention"}),(0,i.__metadata)("design:paramtypes",[])],L);const O=e=>(0,R.Iz)(e?.attribs?.[u.eS.mri]||"");let j=class{transform(e,t){if(!e.attribs)return void t.logger.error("image attribs is missing");const n=d.L.DomUtils.getAttributeValue(e,u.eS.cacheKey);if(n&&n.length)return e.attribs["data-cke-saved-src"]=void 0,e.attribs.src=t.offlineCacheManager.getCachedUrlByKey(n),e;t.logger.error("image missing cache key")}};j=(0,i.__decorate)([(0,s.dL)({name:"CachedImageSerializer",filter:[{itemtype:h.A.cachedImage}]})],j);let B=class{preTransform(e){return null}};B=(0,i.__decorate)([(0,s.dL)({name:"RemoveHiddenSelectionSerializer",filter:["data-cke-hidden-sel"]})],B);var U=n(373639);let $=class{transform(e){if(e.data&&U.EF.test(e.data))return e.data=e.data.replace(new RegExp(U.EF,"g"),""),e}};$=(0,i.__decorate)([(0,s.dL)({name:"RemoveZwsSerializer",filter:"text",transient:!0})],$);const W="data-only-whitespace",V=/^(\s|[\u200B-\u200D\uFEFF])*$/;let H=class{preTransform(e,t){return z(e)?void(t.whiteSpaceId&&t.whiteSpaceId++):(t.whiteSpaceId||(t.whiteSpaceId=1),e.attribs||(e.attribs={}),e.attribs[W]=`${t.whiteSpaceId+1}`,e)}};H=(0,i.__decorate)([(0,s.dL)({name:"WhiteSpacePreprocessor",filter:["div","p","br","span","text"],transient:!0})],H);const z=e=>!V.test((0,P.q4)(e))||!!d.L.DomUtils.findOne((e=>{if(e.attribs&&Object.keys(e.attribs).length||!e.name)return!0;switch(e.name.toLowerCase()){case"br":case"div":case"p":case"span":break;default:return!0}return!1}),[e]);let q=class{transform(e,t){const n=d.L.DomUtils.getAttributeValue(e,W);return!t.whiteSpaceId||!n||+n>t.whiteSpaceId?null:(e.attribs&&delete e.attribs[W],e)}};q=(0,i.__decorate)([(0,s.dL)({name:"TrailingWhiteSpaceSerializer",filter:[W],transient:!0})],q);var G=n(333704);const Y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataM365ChatSuggestionStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365ChatSuggestionState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convId"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"experience"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]},Q={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataM365ChatGeoLocationQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365GeoLocation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"latitude"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"longitude"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]};let J=class{transform(e,t){const{messageProperties:n,coreSettings:i,conversationMembers:r,cache:s,convId:l,loggerFactory:c}=t,{m365ChatBotIds:m,copilotBotDataVersion:p}=i.get(o.w.Messaging);if(!(K(m,r,n,c,s,l,p,e)&&e&&t&&t.messageProperties&&d.L.DomUtils.hasAttrib(e,u.eS.itemtype)))return;const g=d.L.DomUtils.getAttributeValue(e,u.eS.itemtype);if(g!==h.A.editorCiqFile&&g!==h.A.editorCiqPeople&&g!==h.A.editorCiqMeeting&&g!==h.A.editorCiqEmail&&g!==h.A.editorCiqChat)return;const v=d.L.DomUtils.getAttributeValue(e,u.eS.itemProps);return v&&Z((0,a.unescape)(v),n,p??ae,g),e}};J=(0,i.__decorate)([(0,s.dL)({name:"CopilotSerializer",filter:"*"})],J);const K=(e,t,n,i,a,o,r,s)=>{const l=t?.filter((e=>e?.startsWith("28:")))??[];let c=!1;if(1===l?.length&&e){const t=e.indexOf(l[0]);void 0!==t&&(c=t>-1)}let d=n.mentions?.find((e=>e.mentionType===ie));if(c&&!d){const e=X(o,i,a,s);d={itemId:"0",userId:"3209c41b-0e5c-45cb-b72e-68dcecbaa23d",mentionType:ie,displayName:JSON.stringify({copilotBotDataVersion:r??"1.0",files:[],people:[],meetings:[],chats:[],emails:[],...e})},n.mentions=[d]}return c},Z=(e,t,n,i)=>{let a=t.mentions?.find((e=>e.mentionType===ie));a||(a={itemId:"0",userId:"3209c41b-0e5c-45cb-b72e-68dcecbaa23d",mentionType:ie,displayName:JSON.stringify({copilotBotDataVersion:"1.0",files:[],people:[],meetings:[],chats:[],emails:[]})});const o=JSON.parse(a.displayName),r=o.files,s=o.people,l=o.meetings,c=o.chats,d=o.emails,u=o.experienceType,m=o.locationInfo;let p;try{p=JSON.parse(ne(ne(e)))}catch(e){return}i===h.A.editorCiqFile&&r.push(p),i===h.A.editorCiqPeople&&s.push(p),i===h.A.editorCiqMeeting&&l.push(p),i===h.A.editorCiqChat&&c.push(p),i===h.A.editorCiqEmail&&d.push(p);const g={experienceType:u,locationInfo:m,copilotBotDataVersion:n||o.CopilotBotDataVersion,files:r,people:s,meetings:l,chats:c,emails:d};a.displayName=JSON.stringify(g),t.mentions=[a]},X=(e,t,n,i)=>{const a=t.newLogger("CopilotSerializer","services-io-browser-compose-serializer-extensions");return{experienceType:ee(e,a,n,i),locationInfo:te(n,a)}},ee=(e,t,n,i)=>{const a="Default";if(!i)return a;const{experience:o,convId:r}=((e,t)=>{let n=null;try{n=e.readQuery({query:Y})}catch(e){t?.error("Cannot read zero prompt state from the cache.")}const{convId:i,experience:a}=n?.m365ChatSuggestionState??{};return{convId:i,experience:a}})(n,t);return r===e&&o?o:a},te=(e,t)=>{const{latitude:n,longitude:i}=((e,t)=>{let n=null;try{n=e.readQuery({query:Q})}catch(e){t?.error("Cannot read zero prompt state from the cache.")}const{latitude:i,longitude:a}=n?.m365GeoLocation??{};return{latitude:i,longitude:a}})(e,t);return n&&i?{lat:n,long:i}:void 0},ne=e=>e?e.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g,"Â ").replace(/&amp;/g,"&"):"",ie="Copilot",ae="1.0";var oe=n(827558),re=n(653948);let se=class{transform(e,t){const n=e.attribs["data-orig-src"],i=e.attribs.itemid;if(!n||!i)return;const a=t.superSizeEmoticons?"large":"small",o=(0,re.uj)(a),r=e.attribs.alt;t.telemetryDatabag&&(t.telemetryDatabag["DataBag.emojiList"]=[...t.telemetryDatabag["DataBag.emojiList"]||[],"CustomEmojiId"]);const s=(0,P.VZ)("img",{alt:r,itemid:i,itemtype:h.A.customEmoji,src:n,style:`width:${o}px;height:${o}px;`}),l=(0,P.VZ)("span",{contenteditable:"false"});return d.L.DomUtils.appendChild(l,s),l}};se=(0,i.__decorate)([(0,s.dL)({name:"CustomEmojiSerializer",filter:{itemtype:h.A.customEmoji}})],se);var le=n(858554);let ce=class{transform(e){return d.L.DomUtils.getAttributeValue(e,u.eS.itemProps)&&delete e.attribs[u.eS.itemProps],e}};ce=(0,i.__decorate)([(0,s.dL)({name:"FluidEmbedSerializer",filter:{itemtype:h.A.fluidEmbedLink}})],ce);var de=n(957653),ue=n(692184);let me=class{transform(e,t){const n=d.L.DomUtils.getAttributeValue(e,"href");if(!n||!e.attribs)return;const i=n.replace(/&amp;/g,"&");d.L.DomUtils.getAttributeValue(e,u.eS.itemProps)&&delete e.attribs[u.eS.itemProps];const a={appId:"fluid-card",cardClientId:(0,de.A)(),contentType:ue.b.Fluid,content:JSON.stringify({componentUrl:i})};return t.messageProperties.cards=[a],t.files=void 0,e}};me=(0,i.__decorate)([(0,s.dL)({name:"FluidSerializer",filter:{itemtype:h.A.fluidLink}})],me);var pe=n(953730),ge=n(231684),he=n(649288),ve=n(944297),ye=n(912146),Se=n(639908),fe=n(952375),ke=n(470646),Ce=n(729555);let be=class{constructor(){this.getImageBlobUrlFromCache=async(e,t)=>{const n=await e.offlineCacheManager.get(t),i=await n.blob();return URL.createObjectURL(i)},this.processCachedImage=async(e,t,n)=>{const i=d.L.DomUtils.getAttributeValue(e,u.eS.cacheKey);if(!i)return void this._logger.error("Cached image missing key attribute.");this._logger.log(`processing cached image: ${i}`);const a=this._scenarioFactory?.newScenario(r.Cu.SerializeCachedImage);try{const o=d.L.DomUtils.getAttributeValue(e,"src"),s=!!o?.startsWith("blob");let l;try{const e=await t.offlineCacheManager.get(i);l=await(e?.blob())}catch(e){l=null,this._logger.warn(`processCachedImage: Could not find cached image with key=${i} in offlineCacheManager`)}if(!l&&s&&o&&(l=await(0,Se.cP)(o)),null===l)throw Error("Could not get image Blob neither from cache nor from blob data");a?.mark(r.BQ.SerializeCachedImageGotData);let c=l;if(n&&o){const e=await(0,ve.QK)(o,this._logger);e&&e!==o&&URL.revokeObjectURL(o),c=await Ie(e,"BlobUrl",t)}const u=await this.uploadImage(c,t);Te(e,u,t),a?.mark(r.BQ.SerializeCachedImageUploadedData),await this.markCachedImageForDeletionIfUploaded(u,e,i,t,a)}catch(e){throw this._logger.error(`processCachedImage: Failed to process cached image with key=${i}`),a?.fail(),e}finally{a?.stop()}return e}}transform(e,t){if(this._logger=t.loggerFactory.newLogger("InlineImageSerializer","services-io-browser-compose-serializer-extensions"),(0,Ce.CH)(e.attribs.src))return Promise.resolve(e);if(e.attribs.itemtype===h.A.customEmoji)return Promise.resolve(e);if(!this.isConfigValid(t))return this._logger.error("invalid config"),Promise.resolve(void 0);this._scenarioFactory=t.scenarioFactory,this._settings=t.coreSettings;let n=d.L.DomUtils.getAttributeValue(e,"src");const i=d.L.DomUtils.getAttributeValue(e,fe.Vt),{enableImprovedImageHandling:a,enableComposeFrameworkV2:r,enableImageBlobConversionForMessageEdit:s,enableAmsImageResizing:l}=this._settings.get(o.w.Messaging);if(!n)return this._logger.errorToTelemetry?.("Image src is missing","compose_inline_image_error_tracking",void 0,!0),Promise.resolve(void 0);if(a&&i!==ke.n.SUCCESS&&e.attribs.itemtype===h.A.inlineImage&&this._logger.errorToTelemetry?.(`Inline image failed to load (imageLoadingState: ${i}, imageSrcEmpty: ${!!n}).`,"compose_inline_image_error_tracking",void 0,!0),(a||s)&&r){const t=d.L.DomUtils.getAttributeValue(e,"data-orig-src");n=t&&(0,ve.vB)(t)?t:n}const c=(e.attribs.itemtype===h.A.amsImage||e.attribs.itemtype===h.A.cachedImage||e.attribs.itemtype===h.A.inlineImage?d.L.DomUtils.getAttributeValue(e,u.eS.itemid):void 0)??(0,ve.vB)(n);if(c)return this.handleAmsSourceTag(c,e,t);const m=d.L.DomUtils.getAttributeValue(e,u.eS.itemtype)===h.A.cachedImage,p=d.L.DomUtils.getAttributeValue(e,u.eS.itemtype)===h.A.inlineImage&&n.startsWith("blob:");return m||p?this.processCachedImage(e,t,!!l):n.startsWith("http://")||n.startsWith("https://")?(0,ye.nD)(n)?this.processKnownImage(n,t.telemetryDatabag):this.handleKnownProtcolSourceTag(n,"HttpUrl",e,t,!!l):n.startsWith("blob:")?this.handleKnownProtcolSourceTag(n,"BlobUrl",e,t,!!l):(this._logger.error("Unsupported image! deleting it."),Promise.resolve(null))}async uploadPermissionsUpdateToCache(e,t){try{this._logger.log("uploadPermissionsUpdateToCache: uploading image permissions update to offline cache storage");const n={type:"PermissionsUpdate",amsId:e,convId:t.conversationId},i=JSON.stringify(n),[a,o]=await t.offlineCacheManager.saveDynamic(new Response(i,{headers:new Headers({"Content-Type":"application/json","Cache-Control":"max-age=259200, s-maxage=0, private","Content-Length":`${i.length}`,Date:(new Date).toUTCString()})}));return this._logger.log(`uploadPermissionsUpdateToCache: Uploaded image permissions update to offline cache, response URL: ${o} objectId: ${a}`),t.messageProperties.offlineAssets=[...t.messageProperties.offlineAssets||[],a],a}catch(e){throw this._logger.error("uploadPermissionsUpdateToCache: uploading image permissions update to offline cache store failed!"),e}}async handleAmsSourceTag(e,t,n){try{const i="AMS",a=d.L.DomUtils.getAttributeValue(t,"data-orig-src"),o=(0,ge.y)(a),r=await n.asyncMediaService.forwardContent(e,n.conversationId,o);return this._logger.log(`forwarded ams image ${e} to ${r.objectId}`),n.messageProperties.amsReferences=[...n.messageProperties.amsReferences||[],r.objectId],Te(t,{...r,uploadType:i},n),t}catch(e){const{enableAutoEditV2:t}=this._settings.get(o.w.Messaging);if(!t)throw this._logger.error("handleAmsSourceTag: forward content failed!"),e;this._logger.warn("handleAmsSourceTag: initial forward content failed, attempting to upload image to cache")}try{return await this.uploadPermissionsUpdateToCache(e,n),we(n),t}catch(e){throw this._logger.error("handleAmsSourceTag: forward content failed! Fallback uploading to the cache also failed!"),e}}async handleKnownProtcolSourceTag(e,t,n,i,a){try{let o;if(a){const n=await(0,ve.QK)(e,this._logger);n&&n!==e&&URL.revokeObjectURL(e),o=await Ie(n,t,i)}else o=await Ie(e,t,i);const r=await this.uploadImage(o,i);return Te(n,r,i),n}catch(e){throw this._logger.error("handleKnownProtcolSourceTag: pasted from web image upload failed"),this.addDiagnosticCodeToError(e),e}}async uploadImage(e,t,n=!1){try{return await this.uploadImageToAms(e,t,this._logger)}catch(i){this._logger.error("uploadImage: image upload to AMS failed!");const{enableCacheStorageInSendMessageMW:a,msgEnableRestrictImagePasting:r}=this._settings.get(o.w.Messaging);if(!a||r||n)throw i;this._logger.debug("Trying to upload inline image to cache storage");return await this.uploadToCache(e,t,this._logger)}}async uploadImageToAms(e,t,n){const i=t.asyncMediaService.createAmsScenario(r.Cu.AmsImageUpload);try{const a="AMS",o=await t.asyncMediaService.uploadItem(e,t.conversationId,"IMAGE","MicrosoftTeams-image.png",he.vV.Inline,!1,t.correlationId);return n.log(`Uploaded image to ams, image: ${o.inlineSizeUrl} objectId: ${o.objectId}`),i.stop(),t.messageProperties.amsReferences=[...t.messageProperties.amsReferences||[],o.objectId],{...o,uploadType:a}}catch(e){throw i.fail({errors:e.message}),n.error("Ams image upload failed!"),e}}async uploadToCache(e,t,n){try{n.log("uploading inline image to offline cache storage");const[i,a]=await t.offlineCacheManager.saveDynamic(new Response(e,{headers:new Headers({"Content-Type":e.type,"Cache-Control":"max-age=259200, s-maxage=0, private","Content-Length":`${e.size}`,Date:(new Date).toUTCString()})}));n.log(`Uploaded image to offline cache, image: ${a} objectId: ${i}`);const o="OfflineCache";t.messageProperties.offlineAssets=[...t.messageProperties.offlineAssets||[],i];return{objectId:i,inlineSizeUrl:await this.getImageBlobUrlFromCache(t,i),uploadType:o}}catch(e){throw n.error("uploadToCache: uploading inline image to offline cache store failed!"),e}}async markCachedImageForDeletionIfUploaded(e,t,n,i,a){return"OfflineCache"!==e.uploadType&&(a?.mark(r.BQ.SerializeCachedImageDeletedEntry,void 0),i.nonBlockingDeletableCacheKeys.push(n),t.attribs&&delete t.attribs[u.eS.cacheKey],!0)}isConfigValid(e){return!!(e&&e.asyncMediaService&&e.messageProperties&&e.imageProxyService&&e.conversationId&&e.telemetryDatabag&&e.offlineCacheManager)}processKnownImage(e,t){return e.endsWith(".gif")&&(t["DataBag.giphy"]=(t["DataBag.giphy"]||0)+1),Promise.resolve(void 0)}addDiagnosticCodeToError(e){if(e.serverResponse&&e.serverResponse.status){if(e.serverResponse.status===pe.nW.UNSUPPORTED_MEDIA_TYPE)e.reason={...e.reason,errorCode:ve.IC.IMAGE_SIZE_TOO_LARGE}}}};be=(0,i.__decorate)([(0,s.hY)({name:"InlineImageSerializer",filter:["img","image"]})],be);const we=e=>{e.telemetryDatabag["DataBag.inlineImages"]=(e.telemetryDatabag["DataBag.inlineImages"]||0)+1},Te=(e,t,n)=>{e.attribs||(e.attribs={}),e.attribs.id=t.objectId,e.attribs.itemid=t.objectId,e.attribs.href=t.inlineSizeUrl,e.attribs["target-src"]=t.inlineSizeUrl,e.attribs.src=t.inlineSizeUrl,e.attribs[u.eS.itemtype]="AMS"===t.uploadType?h.A.amsImage:h.A.cachedImage,we(n)},Ie=async(e,t,n)=>{let i=null;return"BlobUrl"===t?i=await(0,Se.cP)(e):"HttpUrl"===t&&(i=await n.imageProxyService.getImageAsBlob(e)),i};var Ne=n(779898),Ae=n(193406),Ee=n(879469),Fe=n(850416),_e=n(370604),De=n(299144);let Pe=class{async transform(e,t){this._logger=t.loggerFactory.newLogger("InlineVideoSerializer","services-io-browser-compose-serializer-extensions");const{enableInlineVideoMessageClosedCaptionsMultiLanguageSupport:n}=t.coreSettings.get(o.w.Messaging),i=t.scenarioFactory.newScenario(r.Cu.InlineVideoAsyncTransform),{conversationId:a,videoMessageLieUpdater:s}=t;if(!(e&&e.attribs&&0!==Object.keys(e.attribs).length&&t.asyncMediaService&&t.offlineCacheManager&&s))return i.fail({errorCode:"unexpected_precondition"}),void this._logger.errorToTelemetry?.(`unexpected precondition : element - ${e}`,"messaging_inline_video_serializer_error_tracking",void 0,!0);this._offlineCacheManager=t.offlineCacheManager,this._asyncMediaService=t.asyncMediaService;const l=Me(e);if(!l)return i.fail({errorCode:"malformed_video_message"}),void this._logger.errorToTelemetry?.(`malformed video message: element - ${e}, additionalData - ${t}`,"messaging_inline_video_serializer_error_tracking",void 0,!0);i.appendEventData({correlationId:l.cacheKey});const c=await this.resolveAMSItem(i,a,s,l);if(n){const e=t.scenarioFactory.newScenario(r.Cu.VideoMessageTranscriptMetadataUpload);e.appendEventData({correlationId:l.cacheKey}),await this.uploadTranscriptMetadata(e,c,t.i18n,l.cacheKey,s,l.transcriptUploadStatus),e.stop()}const d=t.scenarioFactory.newScenario(r.Cu.VideoMessageThumbnailUpload);d.appendEventData({correlationId:l.cacheKey}),await this.bestEffortUploadAMSVideoThumbnail(d,c,s,l),d.stop(),await this.uploadAMSVideo(i,c,s,l),t.messageProperties.amsReferences=[...t.messageProperties.amsReferences||[],c];const u=this.createVideoMessageTag(e.attribs,l.src);return this.bestEffortCleanOfflineCacheManager(i,l.cacheKey,!!l.thumbnailUploadProgress),i.stop(),u}createVideoMessageTag(e,t){const n=(0,P.VZ)("video",{src:t,itemscope:"",itemtype:h.A.amsVideo,"data-duration":e[u.eS.duration],width:e[u.eS.width],height:e[u.eS.height]});return n.children=[(0,P.GZ)(Fe.F)],n}async resolveAMSItem(e,t,n,i){try{const a=await this.createAMSObjectIfRequired(e,t,n,i.cacheKey,i.src);return i.src=a.src,a.objectId}catch(t){throw e.fail({errorCode:"create_ams_object_failed"}),new Error(`create ams object failed:${t.toString()}`)}}async createAMSObjectIfRequired(e,t,n,i,a){if(!a){e.mark(r.BQ.ItemCreationStart);const a=await this._asyncMediaService.createVideoObject(t,i),o=(0,Fe.AS)(a.amsUrl,a.objectId);return this.bestEffortMessageLieUpdate(e,n,i,u.eS.src,o),e.mark(r.BQ.ItemCreationStop),{...a,src:o}}e.mark(r.BQ.UploadRetry);return{objectId:(0,ve.vB)(a),amsUrl:(0,Ae.Yn)(a),src:a}}async bestEffortUploadAMSVideoThumbnail(e,t,n,i){if(i.thumbnailUploadProgress&&i.thumbnailUploadProgress.progress!==i.thumbnailUploadProgress.total)try{const a=await this.uploadAMSVideoThumbnail(e,t,n,i.cacheKey);i.thumbnailUploadProgress=a}catch(t){this._logger.warn("video thumbnail upload failed",t),e.fail({errorCode:"thumbnail_upload_failed"})}}async uploadAMSVideoThumbnail(e,t,n,i){e.mark(r.BQ.ThumbnailUploadStart);const a=await this._offlineCacheManager.get((0,_e.Qw)(i)),o=await a.blob();await this._asyncMediaService.uploadVideoThumbnail(t,o,i);const s={progress:o.size,total:o.size};return this.bestEffortMessageLieUpdate(e,n,i,u.eS.thumbnailUploadProgress,(0,Fe.Vu)(s.progress,s.total)),e.mark(r.BQ.ThumbnailUploadStop),s}async uploadTranscriptMetadata(e,t,n,i,a,o){if(o!==Fe.WG.success){const o=n.locale,s=n.osLocaleInfo?.regionalFormat,l=[...(0,Ne.z)()?.navigator.languages||[]],c=(0,De.eV)(o,s,l);try{e.mark(r.BQ.TranscriptMetadataUploadStart,{message:c}),await this._asyncMediaService.uploadTranscriptMetadata(t,c||"en-us",i),this.bestEffortMessageLieUpdate(e,a,i,u.eS.transcriptUploadStatus,Fe.WG.success),e.mark(r.BQ.TranscriptMetadataUploadStop)}catch(t){e.fail({errorCode:"video_transcript_metadata_upload_failed"}),this.bestEffortMessageLieUpdate(e,a,i,u.eS.transcriptUploadStatus,Fe.WG.failure)}}}async uploadAMSVideo(e,t,n,i){try{e.mark(r.BQ.VideoUploadStart);const a=await this._offlineCacheManager.get((0,_e.Vy)(i.cacheKey)),o=await a.blob();await this._asyncMediaService.uploadVideo(t,i.uploadProgress.progress,o,this.updateMessageLieVideoUploadProgress(e,n,i),i.cacheKey),e.mark(r.BQ.VideoUploadStop)}catch(t){throw e.fail({errorCode:"video_upload_failed"}),new Error(`video upload failed:${t.toString()}`)}}async bestEffortCleanOfflineCacheManager(e,t,n){try{await this._offlineCacheManager.delete((0,_e.Vy)(t))}catch(t){this._logger.warn("video cache cleanup failed",t),e.mark(r.BQ.VideoCacheCleanFailed)}try{n&&await this._offlineCacheManager.delete((0,_e.Qw)(t))}catch(t){this._logger.warn("thumbnail cache cleanup failed",t),e.mark(r.BQ.ThumbnailCacheCleanFailed)}}updateMessageLieVideoUploadProgress(e,t,n){return i=>{const a=i+1;n.uploadProgress.progress=a,this.bestEffortMessageLieUpdate(e,t,n.cacheKey,u.eS.uploadProgress,(0,Fe.Vu)(n.uploadProgress.progress,n.uploadProgress.total))}}bestEffortMessageLieUpdate(e,t,n,i,a){try{t(n,i,a)}catch(t){e.mark(r.BQ.MessageLieUpdateFailed),this._logger.warn(t.toString())}}};Pe=(0,i.__decorate)([(0,s.hY)({name:"InlineVideo",filter:[{itemtype:h.A.amsVideo}]})],Pe);const Me=e=>{const t=d.L.DomUtils.getAttributeValue,n=t(e,u.eS.itemtype),i=t(e,u.eS.cacheKey),a=t(e,u.eS.src),o=t(e,u.eS.transcriptUploadStatus),r=t(e,u.eS.uploadProgress),s=t(e,u.eS.thumbnailUploadProgress),l=t(e,u.eS.duration),c=t(e,u.eS.width),m=t(e,u.eS.height);if(!n||!i||!r||!c||!m||!l||Number.isNaN(c)||Number.isNaN(m)||!(0,Fe.q3)(r))return;const p={itemType:n,cacheKey:i,uploadProgress:(0,Fe.Cv)(r),width:+c,height:+m,duration:+(0,Ee.K)(l),transcriptUploadStatus:o||Fe.WG.pending};return a&&(p.src=a),s&&(p.thumbnailUploadProgress=(0,Fe.Cv)(s)),p};let Re=class{async transform(e,t){if(!e||!t.messageProperties)return;const n=t.loggerFactory.newLogger("VideoMessageComposeSerializer","services-io-browser-video-message-compose-serializer"),i=t.scenarioFactory.newScenario(r.Cu.VideoMessageComposeTransform);i.mark(r.BQ.VideoMessageValidation);const o=(0,a.unescape)(d.L.DomUtils.getAttributeValue(e,U.Os)),s=d.L.DomUtils.getAttributeValue(e,U.$v);if(!o||!s)return n.errorToTelemetry?.(`The props are invalid from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null;i.mark(r.BQ.VideoMessageParsing);let l=null;try{l=JSON.parse(o)}catch(t){return n.errorToTelemetry?.(`Failed to parse props from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null}if(!l||!l.amsObjectUrl)return n.errorToTelemetry?.(`The amsObjectUrl is missing from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null;try{i.mark(r.BQ.VideoMessageUpdateCard),this._updateCard(s,l,t),i.mark(r.BQ.VideoMessageCreateTag);return this.createVideoMessageTag(l,s)}catch(e){return n.errorToTelemetry?.("Failed to create the video tag additionalData","messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null}}createVideoMessageTag(e,t){const n=(0,P.VZ)("video",{src:e.amsObjectUrl,cardId:t,itemscope:"",itemtype:h.A.amsVideo,"data-duration":(0,Fe.aE)(e.duration),width:e.width.toString(),height:e.height.toString()});return n.children=[(0,P.GZ)(Fe.F)],n}_updateCard(e,t,n){const{amsObjectId:i}=t,a=n.messageProperties.amsReferences||[];n.messageProperties.amsReferences=[...a,i];const o=n.messageProperties.cards?.filter((t=>t.cardClientId!==e))||[];n.messageProperties.cards=o}};Re=(0,i.__decorate)([(0,s.hY)({name:"VideoMessage",filter:{[U.Lm]:"VideoMessageCard"}})],Re);var xe=n(908060);const Le=(e,t,n)=>{e.forEach((e=>Oe(e,t,n)))},Oe=(e,t,n)=>{(0,xe.KQ)(e,{type:"TextBlock"},(e=>{je(e.text,t,n)})),(0,xe.KQ)(e,{type:"FactSet"},(e=>{e.facts.forEach((e=>{je(e.title,t,n),je(e.value,t,n)}))}))},je=(e,t,n)=>{const i=e.toLowerCase(),a='itemid="',o=i.indexOf(a),r=o+8;if(o>-1){const a=i.substring(r,r+1);if(t&&a){const i=Be(a,t,n);i&&(e=e.replace(new RegExp(a,"g"),i))}}},Be=(e,t,n)=>{let i="";return t.forEach((t=>{if(t.itemId===e){const{messageProperties:e,telemetryDatabag:a}=n;e.mentions||(e.mentions=[]),i=`${e.mentions.length}`;const o=t.displayName||"",r=t.mentionType||"",s=t.userId||"";a["DataBag.atmentions"]=(a["DataBag.atmentions"]||0)+1,e.mentions.push({itemId:i,displayName:o,userId:s,mentionType:r})}})),i};var Ue=n(605288);let $e=class{transform(e,t){if(!e||!t||!t.messageProperties)return;const{loggerFactory:n,coreSettings:i}=t,r=i.get(o.w.Extensibility).enableJITInstallForACv2FromComposeV2||!1,s=n.newLogger("MessageExtensionCardSerializer","services-io-browser-compose-serializer-extensions"),l=(0,a.unescape)(d.L.DomUtils.getAttributeValue(e,U.Os)),c=d.L.DomUtils.getAttributeValue(e,U.$v);if(!l)return s.error("The props was missing"),null;if(!c)return s.error("The id of the card was missing"),null;try{const n=t.messageProperties.cards||[],{card:i,renderJitInstallConsentFooter:o}=JSON.parse(l);if(!(0,a.isObject)(i))throw new Error("not valid JSON object");(0,a.isString)(i.contentType)&&i.contentType.toLowerCase()===Ue.s.Adaptive&&i.content&&((e,t)=>{const n=JSON.parse(e),i=n.body,a=(0,xe.a9)(n);a&&i&&Le(i,a,t)})(i.content,t);const{__typename:s,...u}=i;u.cardClientId=c,t.messageProperties.cards=[...n,u];const m=d.L.DomUtils.getElements({"data-tid":"jit-install-consent-footer"},e);(r?!!o:!(0,a.isEmpty)(m))&&(t.messageProperties.appIdsToInstall=(0,a.union)(t.messageProperties.appIdsToInstall,[i.appId]));const p=(0,P.VZ)("span",{content:c,itemprop:"cardId"}),g=(0,P.VZ)("span",{class:"inline-compose-card",itemid:c,itemscope:"",itemtype:h.A.inputExtension});return d.L.DomUtils.appendChild(g,p),g}catch(e){return s.error("Error while adding message extension card to message",e),null}}};$e=(0,i.__decorate)([(0,s.dL)({name:"MessageExtension",filter:{[U.Lm]:"MessageExtensionCard"}})],$e);var We=n(668625);let Ve=class{constructor(){}transform(e,t){const{loggerFactory:n}=t;if(!e)return;const i=(0,a.unescape)(d.L.DomUtils.getAttributeValue(e,U.Os));if(!i)return;const o=(0,We.j)(i);if((0,a.isEmpty)(o))return void n.newLogger("QuotedReplySerializer","services-io-browser-compose-serializer-extensions").error("Json parsing failed: ",i);const{from:r,messageId:s,preview:l,timestamp:c,userName:u}=o;if(!(r&&s&&l&&u))return void n.newLogger("QuotedReplySerializer","services-io-browser-compose-serializer-extensions").error("Json parsing failed: ",i);const m=(0,P.VZ)("blockquote",{itemscope:"",itemtype:h.A.reply,itemid:s}),p=(0,P.VZ)("strong",{itemprop:"mri",itemid:r}),g=(0,P.GZ)((0,a.escape)(u));if(d.L.DomUtils.appendChild(p,g),d.L.DomUtils.appendChild(m,p),c){const e=(0,P.VZ)("span",{itemprop:"time",itemid:c.toString()});d.L.DomUtils.appendChild(m,e)}const v=(0,P.VZ)("p",{itemprop:"preview"}),y=(0,P.GZ)((0,a.escape)(l));return d.L.DomUtils.appendChild(v,y),d.L.DomUtils.appendChild(m,v),m}};Ve=(0,i.__decorate)([(0,s.dL)({name:"QuotedReply",filter:{[U.Lm]:"QuotedReplyCard"}}),(0,i.__metadata)("design:paramtypes",[])],Ve);let He=class{transform(e){return(0,a.isEmpty)(e.children)&&d.L.DomUtils.appendChild(e,(0,P.GZ)("Â ")),e}};He=(0,i.__decorate)([(0,s.dL)({name:"TableCellSerializer",filter:"td",transient:!0})],He);let ze=class{transform(e){return e.attribs.class="copy-paste-table",e.attribs.itemprop="copy-paste-table",e}};ze=(0,i.__decorate)([(0,s.dL)({name:"TableSerializer",filter:"table",transient:!0})],ze);var qe=n(863344),Ge=n(897604);let Ye=class{transform(e,{authenticationUser:t,convId:n}){if(!e||!d.L.DomUtils.hasAttrib(e,u.eS.itemid))return;const i=(0,P.VZ)(D.S8.span),a=(0,P.GZ)((0,P.q4)(e));d.L.DomUtils.appendChild(i,a);const o=d.L.DomUtils.getAttributeValue(e,u.eS.itemid)||"",r=t?(0,qe.KB)({userAadObjectId:t.profile.objectId,tenantAadObjectId:t.profile.tenantId}):void 0;return r?.logEvent(Ge.P.ManualTagSend,{topicId:o,isTopicNameNumeric:!isNaN(parseFloat(this._getTopicName(e))),contextId:n}),i.attribs[u.eS.itemtype]=h.A.topic,i.attribs[u.eS.itemid]=o,i}_getTopicName(e){const t=(0,P.q4)(e);return t.startsWith("#")?t.substring(1):t}};Ye=(0,i.__decorate)([(0,s.dL)({name:"TopicSerializer",filter:"topic"})],Ye);var Qe=n(6680),Je=n(269483),Ke=n(694296);let Ze=class{constructor(){this._getNearbyTagData=async(e,t)=>{const{tagTtl:n,endOfDay:i}=this._getTagTtlAndEndOfDay(),{membersIds:a,placeId:o}=et(e.cache,e.conversationMembers,t,e.currentUserId);if(!o){const e="Nearby Roster: PlaceId is null or undefined, can't create nearby tag";throw t.errorToTelemetry?.(e,"chat_mention_at_nearby_serializer",void 0,!1),new Error(e)}return{nearbyMembersIds:a,placeId:o,tagTtl:n,endOfDay:i}},this._getTagTtlAndEndOfDay=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59),n=(0,Ke.Ql)(e,t,"seconds");return{tagTtl:Math.max(n,600),endOfDay:t.toString()}},this._createNearbyTagOrUploadToCache=async({additionalData:e,telemetryDatabag:t,logger:n})=>{const{nearbyMembersIds:i,placeId:a,tagTtl:o,endOfDay:r}=await this._getNearbyTagData(e,n);let s;try{s=await this._createNearbyTag(e,i,a,o,n)}catch(t){n.warn("_createNearbyTagOrUploadToCache: creating nearby tag threw and exception, uploading to cache for retry."),s=await this._uploadToCacheAndGetKey(e,i,a,r,n)}return e.nearbyTagPreviouslyCreated=s,t["Compose.nearbyRosterSize"]=i?i.length-1:0,s},this._createNearbyTag=async(e,t,n,i,a)=>{const o=await this.lazyLoadPeopleTargetingService(e,a),r=await o.createNearbyTag(e.convId,t,n,i,e.correlationId);if(!r){const e="Nearby Roster: Can't create nearby tag, people targeting service returned null";throw a.errorToTelemetry?.(e,"chat_mention_at_nearby_serializer",void 0,!1),new Error(e)}return r.id},this.lazyLoadPeopleTargetingService=async(e,t)=>{if(!e.getPeopleTargetingService){const e="Nearby Roster: Can't create nearby tag, people targeting service is not available";throw t.errorToTelemetry?.(e,"chat_mention_at_nearby_serializer",void 0,!1),new Error(e)}return e.getPeopleTargetingService()},this.createResponse=e=>new Response(e,{headers:new Headers({"Content-Type":"application/json","Cache-Control":"max-age=86400, s-maxage=0, private","Content-Length":`${e.length}`,Date:(new Date).toUTCString()})})}async transform(e,t){if(!e||!t||!t.messageProperties)return Promise.resolve(void 0);const{enableAtNearbyMention:n}=t.coreSettings.get(o.w.People),i=t.loggerFactory.newLogger("AtNearbySerializer","services-io-browser-compose-serializer-extensions");if(!n)return Promise.resolve(void 0);if(t.isExternalChat)return Promise.resolve(void 0);const{messageProperties:r,telemetryDatabag:s}=t;r.mentions||(r.mentions=[]);const l=e?.attribs?.[u.eS.type];if("nearby"!==l)return Promise.resolve(void 0);const c=`${r.mentions.length}`,m=(0,P.q4)(e);if(t.hasEdit){const n=e?.attribs?.[u.eS.mri];t.nearbyTagPreviouslyCreated=n}const p=t.nearbyTagPreviouslyCreated??await this._createNearbyTagOrUploadToCache({additionalData:t,telemetryDatabag:s,logger:i});r.mentions.push({itemId:c,displayName:m,userId:p,mentionType:l}),s["DataBag.atmentions"]=(s["DataBag.atmentions"]||0)+1;const g=(0,P.VZ)(D.S8.span),v=(0,P.GZ)((0,a.escape)(m));return d.L.DomUtils.appendChild(g,v),g.attribs[u.eS.itemtype]=h.A.mention,g.attribs[u.eS.itemscope]=e?.attribs?.[u.eS.itemscope]??"",g.attribs[u.eS.itemid]=c,Promise.resolve(g)}async _uploadToCacheAndGetKey(e,t,n,i,a){try{a.log("_uploadToCache: uploading nearby mention to offline cache storage");const o={type:"NearbyMention",convId:e.convId,nearbyMembersIds:t,placeId:n,endOfDay:i},r=JSON.stringify(o),s=this.createResponse(r),[l,c]=await e.offlineCacheManager.saveDynamic(s);return a.log(`_uploadToCache: Uploaded nearby mention to offline cache, response URL: ${c} objectId: ${l}`),e.messageProperties.offlineAssets=[...e.messageProperties.offlineAssets||[],l],l}catch(e){throw a.error("_uploadToCache: uploading nearby mention to offline cache store failed!"),e}}};Ze=(0,i.__decorate)([(0,s.hY)({name:"atNearbySerializer",filter:["mention"]})],Ze);const Xe=Je.J1`
  fragment NearbyPresenceFragment on Presence {
    id
    workLocation {
      approximateDetails {
        id
        idType
      }
    }
  }
`,et=(e,t,n,i)=>{if(!i)return{membersIds:[]};const o=[];t?.forEach((t=>{try{const n=e.readFragment({id:`Presence:${t}`,fragment:Xe});n&&o.push(n)}catch{const e="Nearby Roster: Can't calculate nearby roster, failed to find presence in cache";throw n.errorToTelemetry?.(e,"chat_mention_at_nearby_serializer",void 0,!1),new Error(e)}}));const[r,s]=(0,a.partition)(o,(e=>e.id===i)),l=r[0];return{membersIds:[...s.filter((e=>function(e,t){if(!tt(e)||!tt(t))return!1;const n=e?.approximateDetails,i=t?.approximateDetails;return n?.id===i?.id&&n?.idType===i?.idType}(e.workLocation,l.workLocation))).map((e=>e.id)),i],placeId:l.workLocation?.approximateDetails?.id}};function tt(e){return!!e?.approximateDetails}const nt=[L],it=[$,B,oe.C,L,J,Ye,He,ze,se,le.t,H,q,me,ce,$e,Ve],at=[be,G.j,Re,Qe.YG,S,Pe,Ze],ot=[j]},635899:(e,t,n)=>{"use strict";n.d(t,{eJ:()=>i,EQ:()=>a,B$:()=>o,Qv:()=>r,gI:()=>s});const i={FailedToFetchRelatedContacts:"FailedToFetchRelatedContacts",BadRequest:"BadRequest",InvalidBackendResponse:"InvalidBackendResponse",InvalidCallerOrGroup:"InvalidCallerOrGroup",InvalidUserOrGroup:"InvalidUserOrGroup",Unknown:"Unknown"},a={Active:"Active",Inactive:"Inactive"};var o,r,s;!function(e){e.FailedToFetchRelatedContacts="FailedToFetchRelatedContacts",e.BadRequest="BadRequest",e.InvalidBackendResponse="InvalidBackendResponse",e.CallerIsNotGroupOwner="CallerIsNotGroupOwner",e.Unknown="Unknown"}(o||(o={})),function(e){e.AccessDenied="AccessDenied",e.BadRequest="BadRequest",e.InvalidArgument="InvalidArgument",e.InvalidBackendResponse="InvalidBackendResponse",e.UserProfileNotFound="UserProfileNotFound",e.Unknown="Unknown"}(r||(r={})),function(e){e.Success="Success",e.Pending="Pending",e.IngestionFailed="IngestionFailed"}(s||(s={}))},770620:(e,t,n)=>{"use strict";n.d(t,{G6:()=>r,xd:()=>s,dj:()=>l,JK:()=>c,o8:()=>d,TJ:()=>u,Fr:()=>m,El:()=>p,bR:()=>h,z3:()=>v});var i=n(850434),a=n(754255),o=n(836176);const r={GENERAL_LOCALE_CODE:"localeCode",ACCOUNT_LOCALE_CODE:"accountLocaleCode",APPLICATION_LOCALE_CODE:"applicationLocaleCode",IS_LOCALE_IN_SYNC_WITH_ACCOUNT:"isLocaleInSyncWithAccount"};function s(e){return e.navigator.language||i.Xn}async function l(e){const t=await e.loadModule("osutils"),n=await(t?.getAppLocale?.());return n?.localeName}function c(e,t,n,i){const a=d(e,t,n,i);return(0,o.N6)(a).locale}function d(e,t,n,a,o,s){const l=t.state.getSearchState()||{},c=n?.newLogger("i18n","services-io-browser-i18n"),d=function({localeCode:e,language:t,setting:n},i){const a=e||t;if(g(a,i))return a;if(!n)return;let o;if(Array.isArray(n)){for(const e of n)if(e.startsWith("localeCode:")){o=e;break}}else n.startsWith("localeCode:")&&(o=n);if(!o)return;const r=o.split(":")[1];return g(r,i)?r:void 0}(l,c);if(d)return c?.infoToTelemetry?.(`QSP localeCode: ${d}`,"i18n_user_detected_locale",void 0,!0),d;const u=e?.navigator?.language;if(o&&u)return c?.infoToTelemetry?.(`navigator.language localeCode: ${u}`,"i18n_user_detected_locale",void 0,!0),u;const m=e.localStorage.getItem(r.GENERAL_LOCALE_CODE)||s;return m&&(c?.infoToTelemetry?.(`user prefered localeCode: ${m}`,"i18n_user_detected_locale",void 0,!0),e.localStorage.setItem(r.GENERAL_LOCALE_CODE,m)),m||u||a||i.Xn}function u(e){return{accountLocaleCode:e.get(r.ACCOUNT_LOCALE_CODE),applicationLocaleCode:e.get(r.APPLICATION_LOCALE_CODE),isLocaleInSyncWithAccount:e.get(r.IS_LOCALE_IN_SYNC_WITH_ACCOUNT)}}function m(e,t,n){try{const n={...u(t),localeCode:e.localStorage.getItem(r.GENERAL_LOCALE_CODE)};if(null!==n.isLocaleInSyncWithAccount&&void 0!==n.isLocaleInSyncWithAccount||t.set(r.IS_LOCALE_IN_SYNC_WITH_ACCOUNT,"1","Localization"),null===n.applicationLocaleCode||void 0===n.applicationLocaleCode){const e=n.localeCode||i.Xn;t.set(r.APPLICATION_LOCALE_CODE,e,"Localization")}}catch(e){const t=e.errorCode;n.error("Failed to set default localization data in the local storage. Error code is: ",t)}}const p=e=>{try{return Intl.DateTimeFormat.supportedLocalesOf([e],{localeMatcher:"lookup"}).length>0}catch(e){return!1}};function g(e,t){if(!e)return!1;const n=/^([A-Za-z]{2,4}([_-][A-Za-z]{2,4})?([_-]([A-Za-z]{2,9}|[0-9]{3}))?|pseudo|pseudo_rtl)$/i.test(e);return n||t?.errorToTelemetry?.("wrong locale format reiceved in QSP ","i18n_qsp_detected_locale_failure"),n}const h=e=>{const{enableLocaleSyncWithMSAccount:t,enableLocaleSyncWithOS:n}=e.get(a.w.Localization);return t||n||!1},v=async(e,t)=>{const{enableLocaleSyncWithMSAccount:n,enableLocaleSyncWithOS:i,userAccountLocaleCodePolicy:o}=e.get(a.w.Localization);if(n&&o)return o.toLocaleLowerCase();if(i){const e=await t.loadModule("osutils"),n=await(e?.getUserLocale?.());return n?.localeName?.toLocaleLowerCase()}}},269996:(e,t,n)=>{"use strict";n.d(t,{sD:()=>c,l0:()=>d,hL:()=>u});var i=n(779898),a=n(199448),o=n(850434),r=n(702183);const s="Browser does not support IndexedDB APIs",l="Error in indexedDB open request";async function c(e,t,n,c,d,u){let p;const g=(0,i.z)().indexedDB,h=new Promise(((i,h)=>{const v=d.newScenario(r.Cu.IndexedDBFetch);v.appendEventData({dataSource:n});try{g||h((0,a.$5)(o.Ir.IndexDb,o.O4.IndexDbException,s)),p=g.open(e,t),p.onerror=()=>{h((0,a.$5)(o.Ir.IndexDb,o.O4.IndexDbException,l))},p.onupgradeneeded=e=>{m(t,n,c,p,e,i,h,v)},p.onsuccess=function(e,t,n,i,r,s,l){return()=>{try{const c=e.result,d=c.transaction([t]).objectStore(t),u=l?d.getAll():d.get(n);u.onsuccess=e=>{c.close(),i.stop();const t=e.target.result;r(l?t:t&&(t.value||u.result))},u.onerror=()=>{c.close(),i.fail(),s((0,a.$5)(o.Ir.IndexDb,o.O4.IndexDbException,"Error trying to get chat service sync end point from indexedDB"))}}catch(e){i.fail(),s((0,a.$5)(o.Ir.IndexDb,o.O4.IndexDbException,`Failed to read from '${t}' object store on the indexedDB.`))}}}(p,n,c,v,i,h,u)}catch(e){v.fail({errors:e.message}),h(e)}}));return h}async function d(e,t,n,a,o){{let l;const c=(0,i.z)().indexedDB;return new Promise(((i,d)=>{const u=o.newScenario(r.Cu.IndexedDBDelete);u.appendEventData({dataSource:n});try{c||d(new Error(s)),l=c.open(e,t),l.onerror=()=>{d(new Error(s)),u.fail({errors:s})},l.onsuccess=()=>{!function(e,t,n,i,a){try{const o=e.result,r=o.transaction([t],"readwrite"),s=r.objectStore(t).clear();s.onsuccess=e=>{o.close(),n.stop(),i(e.target.result)},s.onerror=e=>{o.close(),n.fail(),a(`Error trying to delete data from indexedDB: ${e}`)}}catch(e){n.fail(),a(`Error trying to delete data from indexedDB: ${e}`)}}(l,n,u,i,d)},l.onupgradeneeded=e=>{m(t,n,a,l,e,i,d,u)}}catch(e){u.fail({errors:e.message}),d(e)}}))}}async function u(e,t,n,a,o,l){let c;const d=(0,i.z)().indexedDB,u=new Promise(((i,u)=>{const p=l.newScenario(r.Cu.IndexedDBWrite);p.appendEventData({dataSource:n});try{d||u(new Error(s)),c=d.open(e,t),c.onerror=()=>{u(new Error(s)),p.fail({errors:s})},c.onsuccess=()=>{!function(e,t,n,i,a,o){try{const r=e.result,s=r.transaction([t],"readwrite").objectStore(t);let l;n.forEach((e=>{l=s.put(e),l.onsuccess=e=>{r.close(),i.stop(),a(e.target.result.value)},l.onerror=e=>{r.close(),i.fail(),o(`Error trying to write into indexedDB: ${e}`)}}))}catch(e){i.fail(),o(`Error trying to write into indexedDB: ${e}`)}}(c,n,o,p,i,u)},c.onupgradeneeded=e=>{m(t,n,a,c,e,i,u,p)}}catch(e){p.fail({errors:e.message}),u(e)}}));return u}function m(e,t,n,i,a,o,s,l){try{a.oldVersion<e&&i.result.createObjectStore(t,{keyPath:n}),l.mark(r.BQ.IndexedDBUpgrade),o()}catch(e){l.fail(),s(`Failed to create object stores on the indexedDB: ${e}`)}}},31388:(e,t,n)=>{"use strict";n.d(t,{y:()=>a});var i=n(553882);class a{constructor(){this._executeCommandSubject=new i.t(void 0),this.executeCommand=(e,t)=>{this._executeCommandSubject.next({windowId:e,commandId:t})}}get executeCommandObservable(){return this._executeCommandSubject.asObservable()}}},436694:(e,t,n)=>{"use strict";n.d(t,{U:()=>o});var i=n(754255),a=n(780952);class o{constructor(e,t,n,i){this.logsCollectorService=t,this.coreSettings=n,this.hostCommunicationService=i,this.defaultLogsFilesDownloadDelayIntervalMs=333,this.defaultLogsFileUploadTimer=15e3,this.logger=e.newLogger("LogsFilesService","services-io-browser-logs-files")}async downloadLogsFiles(e,t=!0,n){this.logsCollectorService.setDownloadLogStatus(!0);let a=!0,o=this.defaultLogsFilesDownloadDelayIntervalMs;if(this.coreSettings){const e=this.coreSettings.get(i.w.Diagnostics);a=e.enableLogsFilesDownload||!1,o=e.logsFilesDownloadDelayIntervalMs||this.defaultLogsFilesDownloadDelayIntervalMs}if(!a)return this.logger.error(`Unabled to download logs files - logs files download is not enabled: ${a}`),!1;if(!e)return this.logger.error(`Unabled to download logs files - no host present: ${e}`),!1;const r=this.hostCommunicationService&&n;let s=0;const l=await this.logsCollectorService.callOnLogsFiles((async t=>{let i;const a=new Promise((a=>{i=e.setTimeout((async()=>{const i=r?await this.uploadLogsFileToVirtualServer(t,e,n,!1):await this.downloadLogsFile(t,e);a(i)}),s*o)})).then((t=>(void 0!==i&&e.clearTimeout(i),t)));return s++,a}),t);if(l){if(r){const e=await(this.hostCommunicationService?.loadModule("logscollection"));e?.webLogsDownloadCompleted?.({webLogsId:n})}}else{if(r)return this.logger.errorToTelemetry?.("Failed to upload all logs files to virtual server","logs_downloading"),this.downloadLogsFiles(e,!0);this.logger.error("Failed to download all logs files")}return this.logsCollectorService.setDownloadLogStatus(!1),l}downloadLogsFile(e,t){let n,i="";try{let a;a="string"==typeof e.content?new Blob([e?.content],{type:"text/plain;charset=utf-8"}):e.content,i=URL.createObjectURL(a);const o=t.document.createElement("a");o.setAttribute("href",i),o.setAttribute("download",e?.fileName),o.click(),o.remove(),n=!0}catch(t){this.logger.error(`Failed to download logs file ${e?.fileName} - error:`,t),n=!1}return i&&URL.revokeObjectURL&&URL.revokeObjectURL(i),Promise.resolve(n)}async uploadLogsFileToVirtualServer(e,t,n,i){let o=!1;try{const r=`${t.location.origin}/desktop/upload/log-collector/${n}/${e.fileName}`,s=t.fetch(r,{method:"PUT",headers:{"Content-Type":"text/plain"},body:e.content}),l=await(0,a.a)(s,this.defaultLogsFileUploadTimer);l.ok?o=!0:this.logger.error(`Failed to upload logs file to virtual server - ${e?.fileName}, isRetry - ${i}, status - ${l.statusText}`)}catch(t){this.logger.error(`Failed to upload logs file to virtual server - ${e?.fileName}, - isRetry- ${i}, - in ${this.defaultLogsFileUploadTimer} ms, - error:`,t)}return o||i?Promise.resolve(o):this.uploadLogsFileToVirtualServer(e,t,n,!0)}}},163930:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataActiveWindowsSaveReactiveVarsToHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveReactiveVarsToHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"appIds"},value:{kind:"Variable",name:{kind:"Name",value:"appIds"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},21307:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataActivityFeedQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filters"}},type:{kind:"NamedType",name:{kind:"Name",value:"ActivityFeedFilterInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"enableAvatarUrlResolutionInActivityFeeds"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isNeededForHeadlineSlice"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},defaultValue:{kind:"BooleanValue",value:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activities"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"filters"},value:{kind:"Variable",name:{kind:"Name",value:"filters"}}},{kind:"Argument",name:{kind:"Name",value:"isFirstPage"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActivitiesConnectionFragment"}},{kind:"Field",name:{kind:"Name",value:"activityConsumptionHorizonBookmark"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivityConsumptionHorizonBookmark"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"activityTimestamp"}},{kind:"Field",name:{kind:"Name",value:"chatTimestamp"}},{kind:"Field",name:{kind:"Name",value:"channelTimestamp"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"upfrontFilter"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filters"},value:{kind:"Variable",name:{kind:"Name",value:"filters"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unreadOnly"}}]}},{kind:"Field",name:{kind:"Name",value:"showNotificationSettingsRecommendationCoachmark"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}]},{kind:"Field",name:{kind:"Name",value:"trackingInfo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filters"},value:{kind:"Variable",name:{kind:"Name",value:"filters"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalFeedsCountOnBoot"}},{kind:"Field",name:{kind:"Name",value:"unseenCountOnBell"}},{kind:"Field",name:{kind:"Name",value:"totalFeedsCountOnBootForSlice"}}]}}]}}]}},...n(42857).e.definitions]}},584729:(e,t,n)=>{"use strict";n.d(t,{Q:()=>I});var i,a=n(364819);!function(e){e.Info="Info",e.Warning="Warning",e.Error="Error",e.Debug="Debug"}(i||(i={}));var o=n(937545),r=n(131647),s=n(754255),l=n(969013);const c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"defaultName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"isMailAddress"},value:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}}},{kind:"Argument",name:{kind:"Name",value:"defaultName"},value:{kind:"Variable",name:{kind:"Name",value:"defaultName"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"featureSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"coExistenceMode"}}]}}]}}]}}]},d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationGetUsersQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mriOrEmailArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mriOrEmailArray"},value:{kind:"Variable",name:{kind:"Name",value:"mriOrEmailArray"}}},{kind:"Argument",name:{kind:"Name",value:"isMailAddress"},value:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"emailForQuery"}}]}}]}}]},u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationPresenceSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presenceUpdateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"isOutOfOffice"}},{kind:"Field",name:{kind:"Name",value:"lastSeenAt"}}]}}]}}]},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationPresencesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userPresenceRequestArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPresenceRequest"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userPresenceRequestArray"},value:{kind:"Variable",name:{kind:"Name",value:"userPresenceRequestArray"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"isOutOfOffice"}},{kind:"Field",name:{kind:"Name",value:"lastSeenAt"}}]}}]}}]},p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationFireCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationUserCallingSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCallingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isCallingAllowed"}},{kind:"Field",name:{kind:"Name",value:"isPstnCallingAllowed"}}]}}]}}]},h={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationIsPstnQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uri"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"officeIntegrationIsPSTN"},arguments:[{kind:"Argument",name:{kind:"Name",value:"uri"},value:{kind:"Variable",name:{kind:"Name",value:"uri"}}}]}]}}]},v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationTenantVerifiedDomainQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantVerifiedDomain"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}]}]}}]};var y,S,f=n(639884),k=n(343468);!function(e){e[e.UnInitialized=0]="UnInitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(y||(y={})),function(e){e.FreDialogDisplayedKey="office-integration-fre-dialog-displayed",e.HasManuallyUnregisteredIMProviderKey="office-integration-has-manually-unregistered"}(S||(S={}));const C="sip:",b=new Map([["InACall","OnThePhone"],["InAConferenceCall","InAMeeting"],["InAMeeting","InAMeeting"],["Presenting","Presenting"],["OffWork","Offline"],["Available","Online"],["Inactive","Idle"],["Busy","Busy"],["DoNotDisturb","Focusing"],["BeRightBack","BeRightBack"],["Away","Away"],["Offline","Offline"],["UrgentInterruptionsOnly","Focusing"],["PresenceUnknown","Unknown"],["OutOfOffice","OutOfOffice"]]),w="Teams",T="MsTeams";class I{static Instance(e,t,n,i,a,o,r,s){return I.instance||(I.instance=new I(e,t,n,i,a,o,r,s)),I.instance}static defaultInstance(){return I.instance}constructor(e,t,n,i,l,c,d,u){this.hostCommunicationService=e,this.coreSettings=t,this.client=n,this.entityCommanding=l,this.windowProvider=c,this.localStorage=d,this.authenticationUser=u,this.initializedState=y.UnInitialized,this.unsubscribers=[],this.entityCommand={stateTransition:o.Ar.none,visibilityState:o.Rp.show,correlation:{source:r.p.OfficeIntegration}},this.presenceSubscriptionMap=new Map,this.uriToMriCacheMap=new Map,this.selfMri="",this.selfActivity="PresenceUnknown",this.debouncedUnresolvedUriMap=new Map,this.unknownUserSet=new Set,this.verifiedDomains=[],this.getUserCallingSettingsAsync=async()=>{const{data:e}=await this.client.query({query:g,variables:{}});return e.userCallingSettings},this.getIsPstnAsync=async e=>{const{data:t}=await this.client.query({query:h,variables:{uri:e}});return t.officeIntegrationIsPSTN},this.logger=i.newLogger("OfficeIntegration","services-io-data-office-integration");const m=this.coreSettings.get(s.w.People).debounceUriToMriProfileQueryInMilliSeconds||1e3;this.batchProfileQuery=(0,a.debounce)((async()=>{if(!(0,a.isEmpty)(this.debouncedUnresolvedUriMap)){const e=this.debouncedUnresolvedUriMap;this.debouncedUnresolvedUriMap=new Map,await this.resolveUrisToMrisFromServiceIntoCache(Array.from(e.values()));const t=Array.from(e.keys()),n=this.resolveUrisToMrisFromCache(t),i=t.filter((e=>n.has(e)));(0,a.isEmpty)(i)||this.handleTrackPresence(i)}}),m);const p=this.coreSettings.get(s.w.Presence).officeIntegrationPresenceSubscriptionExpiryMs||18e4;this.removeStaleSubscriptions=(0,a.debounce)((()=>{const e=Date.now(),t=this.presenceSubscriptionMap.size;this.presenceSubscriptionMap.forEach(((t,n)=>{this.selfMri!==n&&t.lastPollingTime+p<e&&(t.presenceSubscription.unsubscribe(),this.presenceSubscriptionMap.delete(n))})),this.logger.log(`removeStaleSubscriptions size from ${t} to ${this.presenceSubscriptionMap.size}`)}),p)}async initialize(){if(!this.coreSettings.get(s.w.People).enableOfficeIntegration)return!1;if(this.initializedState!==y.UnInitialized)return!1;this.initializedState=y.Initializing;const e=await this.getModule();if(e){const{isRegistered:t,isAdminAccessRequired:n,isUacEnabled:a,defaultIMProvider:o}=await(e.isRegisteredIMProvider?.())||{};if(this.logger.log(`initialize isRegistered ${t} isAdminAccessRequired ${n} isUacEnabled ${a} defaultIMProvider ${o}`),t)return this.startService(e);if(await this.canRegisterT21AsDefaultIMProvider(o?.trim()||""))if(n&&a)this.logger.log("startOfficeIntegrationFREDialog"),this.startOfficeIntegrationFREDialog();else if(n||this.isLocalStoragePropertySet(S.HasManuallyUnregisteredIMProviderKey)){const e=`Failed to register due to isAdminAccessRequired ${n} isUacEnabled \n          ${a} HasManuallyUnregisteredIMProviderKey ${this.isLocalStoragePropertySet(S.HasManuallyUnregisteredIMProviderKey)} defaultIMProvider: ${o}`;this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Warning)}else{this.logger.log("Silently register IM provider");const t=await(e.registerIMProvider?.(!1,!!a));if(0===t)return this.startService(e);{const e=`Failed to register during silent registration with result ${t}`;this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Warning,{errorCode:t?.toString(16)})}}else{const e=`cannot register due to defaultIMProvider: ${o} coExistenceMode: ${this.coExistenceMode}`;this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Warning)}return!1}return!1}async finalize(){if(!this.coreSettings.get(s.w.People).enableOfficeIntegration)return!1;if(this.initializedState!==y.Initializing)return!1;const e=await this.getModule();if(e){const{isRegistered:t}=await(e.isRegisteredIMProvider?.())||{};if(t)return this.startService(e);const n="finalize is called without IM provider registered";return this.handleLogToTelemetry(n,"office_integration_fre_register_finalize_failed",i.Warning),!1}return!1}async shutdown(){if(this.initializedState!==y.Initialized)return!1;this.initializedState=y.UnInitialized,this.unsubscribers.forEach((e=>e()));const e=await this.getModule();if(e){const t=e.stopComServer?.();return!!t}return!1}async isRegisteredIMProvider(){const e=await this.getModule();return e?.isRegisteredIMProvider?.()}async registerIMProvider(e,t,n){const a=await this.getModule();if(a){const o=await(a.registerIMProvider?.(e,t)),r=`registerIMProvider result ${o} from ${n}. isAdminAccessRequired ${e} isUacEnabled ${t}`;return this.handleLogToTelemetry(r,"office_integration_register_im_provider",i.Info,{errorCode:o?.toString(16)}),0===o}return!1}async unregisterIMProvider(e){const t=await this.getModule();if(t){const n=await(t.unregisterIMProvider?.()),a=`unregisterIMProvider result ${n} from ${e}`;return this.handleLogToTelemetry(a,"office_integration_unregister_im_provider",i.Info,{errorCode:n?.toString(16)}),0===n}return!1}async toggleIMProvider(e){const{isRegistered:t,isAdminAccessRequired:n,isUacEnabled:i}=await this.isRegisteredIMProvider()||{};if(t){this.setLocalStorageProperty(S.HasManuallyUnregisteredIMProviderKey,"true");const t=await this.unregisterIMProvider(e);return await this.waitForRegistryUpdate(),t}this.setLocalStorageProperty(S.HasManuallyUnregisteredIMProviderKey,"false");if(await this.registerIMProvider(!!n,!!i,e)){const e=await this.getModule();return!!e&&(this.startService(e),await this.waitForRegistryUpdate(),!0)}return!1}async waitForRegistryUpdate(){let e;await new Promise((t=>{e=this.windowProvider.setTimeout(t,250)})),this.windowProvider.clearTimeout(e)}isLocalStoragePropertySet(e){return"true"===this.localStorage?.get(e)}setLocalStorageProperty(e,t){this.localStorage?.set(e,t,"Platform")}async getModule(){return this.officeIntegrationModule||(this.officeIntegrationModule=await this.hostCommunicationService.loadModule("officeintegration")),this.officeIntegrationModule}async canRegisterT21AsDefaultIMProvider(e){const{enableThirdPartyIMProviderCheck:t,enableCheckCoExistenceModeForOfficeIntegration:n}=this.coreSettings.get(s.w.Presence);if(n){const t=this.authenticationUser?.loginUserName||"",{data:n}=await this.client.query({query:c,variables:{userId:t,isMailAddress:!0},context:{callerInfo:"office-integration-initialize"}});if(this.coExistenceMode=n?.user?.featureSettings?.coExistenceMode,this.logger.log(`initialize coExistenceMode ${this.coExistenceMode}`),this.coExistenceMode&&this.coExistenceMode!==k.bi.TeamsOnly)return e===w||e===T}return!t||(!e||e===w||"Lync"===e||e===T)}async startService(e){if(this.initializedState===y.Initialized)return!1;let t;this.initializedState=y.Initialized,t=e.registerForStartChat?.((e=>this.handleStartChat(e))),t&&this.unsubscribers.push(t),t=e.registerForStartCall?.(((e,t,n)=>this.handleStartCall(e,t,n))),t&&this.unsubscribers.push(t),t=e.registerForTrackPresence?.((e=>this.handleTrackPresence(e))),t&&this.unsubscribers.push(t),t=e.registerForUntrackPresence?.((e=>this.handleUntrackPresence(e))),t&&this.unsubscribers.push(t),t=e.registerForLogStatement?.(((e,t)=>this.handleLogStatement(e,t))),t&&this.unsubscribers.push(t);const n=this.authenticationUser?.loginUserName||"",{data:i}=await this.client.query({query:c,variables:{userId:n,isMailAddress:!0},context:{callerInfo:"office-integration-start"}}),a=i?.user;if(a){const e=a.userPrincipalName?.toLowerCase(),t=a.email?.toLowerCase();a.mri&&(this.selfMri=a.mri,e&&this.uriToMriCacheMap.set(e,a.mri),t&&t!==e&&this.uriToMriCacheMap.set(t,a.mri))}const o=await this.client.query({query:v,variables:{userId:n}});o.data?.tenantVerifiedDomain&&(this.verifiedDomains=o.data.tenantVerifiedDomain);return!!await(e.startComServer?.(a?.userPrincipalName||n))}startOfficeIntegrationFREDialog(){if(this.isLocalStoragePropertySet(S.FreDialogDisplayedKey))this.logger.log("Skipping FRE as it has already been displayed for user");else{this.entityCommanding.shell.openFreDialog(this.entityCommand),this.setLocalStorageProperty(S.FreDialogDisplayedKey,"true");const e="Start office integration FRE through user dialog registration";this.handleLogToTelemetry(e,"office_integration_fre_register_dialog",i.Info)}}async notifyPresence(e){const t=await this.getModule();return t?.notifyPresence?.(e)}convertLastSeenAt(e){if(e){return new Date(e).getTime()}}notifyInitialPresence(e,t){const n=[];e.presences.forEach((e=>{const i=(0,f.K)()("InACall","InAConferenceCall","InAMeeting","Presenting","OffWork","Available","Inactive","Busy","DoNotDisturb","BeRightBack","Away","Offline","UrgentInterruptionsOnly","PresenceUnknown","OutOfOffice").find((t=>t===e.activity))||"PresenceUnknown";e.id===this.selfMri&&e.activity&&(this.selfActivity=e.activity),n.push({id:e.id,requestedUri:t.get(e.id)||"",status:b.get(i)||i,lastSeenAt:this.convertLastSeenAt(e.lastSeenAt)})})),this.notifyPresence(n)}async handleTrackPresence(e){const{enableFederatedPresenceForOfficeIntegration:t}=this.coreSettings.get(s.w.People),{disableRealTimePresenceForOfficeIntegration:n,presenceForOfficeIntegrationPollingIntervalMs:i}=this.coreSettings.get(s.w.Presence);this.logger.log(`handleTrackPresence receives ${e.length} users`),t||(0,a.isEmpty)(this.verifiedDomains)||(e=e.filter((e=>{const t=e.substring(e.indexOf("@")+1);return(0,a.some)(this.verifiedDomains,(e=>e===t.toLocaleLowerCase()))})));const o=await this.mapUrisToMris(e,!0),r=[],l=new Map,c=i||12e4,d=Date.now();if(e.forEach((e=>{const t=o.get(e);if(t){const i=this.presenceSubscriptionMap.get(t);if(i){const a=i.lastPollingTime+c<d;i.lastPollingTime=d,(n&&a||!i.requestedUris.has(e)||t===this.selfMri&&"PresenceUnknown"===this.selfActivity)&&(i.requestedUris.add(e),r.push({userId:t,source:"ups"}),l.set(t,e))}else{const i=n?"local":"ups",a=this.client.subscribe({query:u,variables:{userId:t,source:i},context:{callerInfo:"office-integration"}}).subscribe((({data:e})=>{e&&this.notifyUpdatedPresence(e)})),o={requestedUris:new Set,presenceSubscription:a,lastPollingTime:d};o.requestedUris.add(e),this.presenceSubscriptionMap.set(t,o),r.push({userId:t,source:"ups"}),l.set(t,e)}}})),n&&this.removeStaleSubscriptions(),!(0,a.isEmpty)(r)){this.logger.log(`handleTrackPresence gets presences for ${e.length} users`);const{data:t}=await this.client.query({query:m,variables:{userPresenceRequestArray:r},context:{callerInfo:"office-integration"}});t&&this.notifyInitialPresence(t,l)}}async mapUrisToMris(e,t){const n=this.resolveUrisToMrisFromCache(e);if(n.size===e.length)return n;{const{enableDebounceUriToMriProfileQuery:i}=this.coreSettings.get(s.w.People),o=t&&i,r=[];return e.forEach((e=>{if(!n.has(e)){const t=e.startsWith(C)?e.substring(4):e;r.push(t),o&&this.debouncedUnresolvedUriMap.set(e,t)}})),(0,a.isEmpty)(r)?n:o?(this.batchProfileQuery(),n):(await this.resolveUrisToMrisFromServiceIntoCache(r),this.resolveUrisToMrisFromCache(e))}}async resolveUrisToMrisFromServiceIntoCache(e){if(e=e.filter((e=>!this.unknownUserSet.has(e.toLowerCase()))),(0,a.isEmpty)(e))return;const{data:t}=await this.client.query({query:d,variables:{mriOrEmailArray:e,isMailAddress:!0},context:{callerInfo:"office-integration-uri-resolution"}});t?.getUsers?.forEach((e=>{if(e.mri&&"unknown_email_address@invalid.teams.ms"!==e.email){const t=e.userPrincipalName?.toLowerCase(),n=e.email?.toLowerCase(),i=e.emailForQuery?.toLowerCase();t&&this.uriToMriCacheMap.set(t,e.mri),n&&n!==t&&this.uriToMriCacheMap.set(n,e.mri),i&&i!==t&&i!==n&&this.uriToMriCacheMap.set(i,e.mri)}else e.userPrincipalName&&this.unknownUserSet.add(e.userPrincipalName.toLowerCase())}))}resolveUrisToMrisFromCache(e){const t=new Map;return e.forEach((e=>{const n=e.toLowerCase(),i=n.startsWith(C)?n.substring(4):n,a=this.uriToMriCacheMap.get(i);a&&t.set(e,a)})),t}notifyUpdatedPresence(e){const t=e.presenceUpdateEvent;if(t){const e=t.id,n=this.presenceSubscriptionMap.get(e);if(n){const i=[],a=(0,f.K)()("InACall","InAConferenceCall","InAMeeting","Presenting","OffWork","Available","Inactive","Busy","DoNotDisturb","BeRightBack","Away","Offline","UrgentInterruptionsOnly","PresenceUnknown","OutOfOffice").find((e=>e===t.activity))||"PresenceUnknown",o=b.get(a)||a,r=this.convertLastSeenAt(t.lastSeenAt);n.requestedUris.forEach((t=>{i.push({id:e,requestedUri:t,status:o,lastSeenAt:r})})),e===this.selfMri&&t.activity&&(this.selfActivity=t.activity),this.notifyPresence(i)}}}async handleUntrackPresence(e){(await this.mapUrisToMris(e)).forEach(((e,t)=>{const n=this.presenceSubscriptionMap.get(e);n&&(n.requestedUris.delete(t),(0,a.isEmpty)(n.requestedUris)&&(n.presenceSubscription.unsubscribe(),this.presenceSubscriptionMap.delete(e)))}))}async handleStartChat(e){this.logger.log("Starting chat");const t=e.split(";").filter((e=>!!e.trim())),n=await this.mapUrisToMris(t),o=`mapped ${n.size} uris`;this.handleLogToTelemetry(o,"office_integration_handle_chat",i.Info);const r=Array.from(n.values());(0,a.isEmpty)(r)?(this.handleLogToTelemetry("No mapped uris to start chat","office_integration_handle_chat",i.Warning),this.navigateToNewChat()):this.navigateToChat(r)}async navigateToNewChat(){return this.entityCommanding.chat.chatById("newchat",{entityCommand:{stateTransition:o.Ar.new,visibilityState:o.Rp.show,correlation:{source:r.p.OfficeIntegrationChat}},entityOptions:{shouldCheckChatPolicy:!0}})}async navigateToChat(e,t=o.Ar.new){return this.entityCommanding.chat.chatWithUsers({userIds:e,entityCommand:{stateTransition:t,visibilityState:o.Rp.show,correlation:{source:r.p.OfficeIntegrationChat}},entityOptions:{shouldCheckChatPolicy:!0}})}async handleStartCall(e,t,n){const{enableOfficeIntegrationCalling:a}=this.coreSettings.get(s.w.Calling);try{const[n,o]=await Promise.all([this.getUserCallingSettingsAsync(),this.getIsPstnAsync(e)]);if(!a||o&&!n?.isPstnCallingAllowed||!o&&!n?.isCallingAllowed)return void this.handleLogToTelemetry("Office integration calling or policy is disabled","office_integration_handle_call",i.Warning,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isPSTN:o,isVideo:t,isCallingAllowed:n?.isCallingAllowed,isPstnCallingAllowed:n?.isPstnCallingAllowed})});this.handleLogToTelemetry("Starting call","office_integration_handle_call",i.Info,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isPSTN:o,isVideo:t})});const r=o?this.getPstnCallingIntent(e):await this.getVoipCallingIntentAndNavigateChat(e,t);await this.client.mutate({mutation:p,variables:{callingIntent:r}}),this.handleLogToTelemetry("Successfully triggered call","office_integration_handle_call",i.Info,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isVideo:t})})}catch(e){this.handleLogToTelemetry("Failed to start call","office_integration_handle_call",i.Error,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isVideo:t}),errors:e?.message||e})}}getPstnCallingIntent(e){return{type:"OneToOneCall",joinOptions:{outgoingAudio:!0,context:"OfficeIntegration"},coordinates:{oneToOne:{mri:(0,l.KM)(e)}}}}async getVoipCallingIntentAndNavigateChat(e,t){const n=(await this.mapUrisToMris([e])).get(e);if(!n)throw new Error("No mapped uri to start call");return await this.navigateToChat([n],o.Ar.flush),{type:"OneToOneCall",coordinates:{oneToOne:{mri:n}},joinOptions:{outgoingVideo:t,outgoingAudio:!0,context:"OfficeIntegration"}}}handleLogStatement(e,t){switch(t){case i.Info:this.logger.log(e);break;case i.Debug:this.logger.debug(e);break;case i.Error:this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Error);break;case i.Warning:this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Warning)}}handleLogToTelemetry(e,t,n,a,o=!0){switch(n){case i.Info:this.logger.infoToTelemetry?this.logger.infoToTelemetry(e,t,a,o):this.logger.log(e);break;case i.Debug:this.logger.debugToTelemetry?this.logger.debugToTelemetry(e,t,a,o):this.logger.debug(e);break;case i.Error:this.logger.errorToTelemetry?this.logger.errorToTelemetry(e,t,a,o):this.logger.error(e);break;case i.Warning:this.logger.warnToTelemetry?this.logger.warnToTelemetry(e,t,a,o):this.logger.warn(e)}}}},184506:(e,t,n)=>{"use strict";n.d(t,{H:()=>l});const i=(e,t,n)=>{const{scenarioFactory:i}=e;return n?i.findScenarioByNameAndId(t,n):i.findScenario(t)},a=(e,t)=>{try{return JSON.stringify(t)}catch{return e.warn("exception occured in getFeedDataBagString"),""}},o=(e,t,n)=>{const{scenarioFactory:i,logger:a}=e,{scenarioId:o,data:r,timeoutMs:s}=n||{},l=i.newScenario(t,{timeoutMs:s});return o&&(l.clientId=o),r&&l.appendEventData(r),a.log(`${t} - scenario started with origin: ${r?.origin}`),l},r=(e,t,n,a)=>{const{logger:o}=e,r=i(e,t,n.scenarioId);r?r.cancel({message:a}):o.warn(`${t} with Id: ${n.scenarioId} - not found hence not cancelled`)},s=(e,t,n)=>{const i=((e,t,n)=>{let i=n;const o=t.eventData.feedDataBag;if(o){let t={};try{t=JSON.parse(o)}catch{e.warn("exception occured in prevFeedDataBagStr to object conversion")}i={...t,...i}}return a(e,i)||o})(e,t,n);t.appendEventData({feedDataBag:i})},l={addScenarioDataByNameId:(e,t,n,a)=>{const{logger:o}=e,r=i(e,t,a);r?r.appendEventData(n):o.warn(`No active scenario with ScenarioName: ${t} with Id: ${a}`)},appendFeedDataBag:s,cancelScenarioByNameId:r,cancelExistingAndCreateNewScenario:(e,t,n,i)=>(r(e,t,n,i),o(e,t,n)),findScenario:i,markScenarioStepByNameId:(e,t,n,a,o)=>{const{logger:r}=e,s=i(e,t,n.scenarioId);return s?s.mark(a,n.data,o):r.warn(`${t} with Id: ${n.scenarioId} - not found hence did not mareked step`),s},newScenario:o,startScenario:(e,t,n)=>{const{logger:a}=e;let r=i(e,t,n.scenarioId);return r?a.warn(`${t} - scenario already started with origin: ${r?.eventData?.origin}`):r=o(e,t,n),r},stopScenarioByNameId:(e,t,n,a)=>{const{logger:o}=e,r=i(e,t,n.scenarioId);if(r){const{data:e}=n;r.stop(e,a),o.log(`${t} - scenario stopped with id: ${r.clientId}`)}else o.warn(`No active scenario with ScenarioName: ${t} with Id: ${n.scenarioId}`)},getFeedDataBagString:a,findScenarioAndAppendFeedDataBag:(e,t,n,i)=>{const{logger:a}=e,o=l.findScenario(e,t,i);o?s(a,o,n):a.warn(`${t} with Id: ${i} - not found hence couldn't append feedDataBag`)}}},207229:(e,t,n)=>{"use strict";var i;n.d(t,{U:()=>i}),function(e){e.all="all"}(i||(i={}))},966973:(e,t,n)=>{"use strict";var i,a;n.d(t,{n5:()=>i,E8:()=>a,C4:()=>o}),function(e){e.Chat="Chat",e.Meetings="Meetings",e.Notifications="notifications",e.GraphApps="GraphApps",e.TeamsAndChannelsCustom="Custom",e.CallGroup="call_group",e.Recommendation="Recommendation"}(i||(i={})),function(e){e.Chat="notification_settings_details_chat_subheader_text",e.Meetings="notification_settings_details_only_meetings_subheader_string",e.TeamsAndChannelsCustom="notification_settings_details_teams_channel_subheader_text"}(a||(a={}));const o="activity-settings"},743155:(e,t,n)=>{"use strict";var i,a;n.d(t,{Z:()=>i,f:()=>a}),function(e){e.FeedLoad="feedLoad",e.FeedSearch="feedSearch",e.FilterApplied="filterApplied",e.FilterCleared="filterCleared",e.FilterSearchApplied="filterSearchApplied",e.Prefetch="prefetch",e.Scroll="scroll"}(i||(i={})),function(e){e.UnreadToggleApplied="unreadToggleApplied",e.UnreadToggleCleared="unreadToggleCleared",e.UpfrontFilterApplied="upfrontFilterApplied",e.UpfrontFilterCleared="upfrontFilterCleared",e.TypeFilterApplied="typeFilterApplied",e.TypeFilterCleared="typeFilterCleared",e.QueryFilterApplied="queryFilterApplied",e.QueryFilterCleared="queryFilterCleared",e.QueryAndTypeFilterCleared="queryAndTypeFilterCleared",e.SliceChanged="sliceChanged"}(a||(a={}))},620317:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{S_:()=>i,a1:()=>a,az:()=>o,Gj:()=>r,aK:()=>s,E1:()=>l,Cy:()=>c,i:()=>d,kj:()=>u,Vs:()=>m,Nb:()=>p,z2:()=>g,h9:()=>h,v:()=>v,aJ:()=>y,YG:()=>S,tV:()=>f}),function(e){e.Any="any",e.Never="never",e.Chat="chat",e.Reply="reply",e.ReplyToReply="replyToReply",e.Like="like",e.Mention="mention",e.TeamMembershipChange="teamMembershipChange",e.AddedToTeam="addedToTeam",e.PromotedToTeamAdmin="promotedToTeamAdmin",e.Download="download",e.Follow="follow",e.CallOrMeetup="callOrMeetup",e.ThirdParty="thirdParty",e.Unread="unread",e.Inferred="inferred",e.MessageSendFailed="messageSendFailed",e.LikeInChat="likeInChat",e.MentionInChat="mentionInChat",e.MentionInCommunity="mentionInCommunity",e.ReactionInCommunity="reactionInCommunity",e.CallTransferFailed="callTransferFailed",e.Call="call",e.MissedCall="missedCall",e.Voicemail="voicemail",e.GroupRenewal="groupRenewal",e.Error="error",e.DesktopNotification="desktopNotification",e.Trending="trending",e.ShareFromChat="shareFromChat",e.PresenceStatus="presenceStatus",e.Priority="priority",e.Reaction="reaction",e.ReactionInChat="reactionInChat",e.TeamsTasks="teamsTasks",e.TeamsEngagementActivity="teamsEngagementActivity",e.DLP="dLP",e.MsGraph="msGraph",e.StaffHub="StaffHub",e.SkypeConsumerCall="SkypeConsumerCall",e.SyntheticNotification="syntheticNotification",e.UserActivity="UserActivity",e.NativeNotificationFre="NativeNotificationFre",e.Recommendation="Recommendation",e.JoinInvite="joinInvite",e.CommunityReply="communityReply",e.CommunityReplyToReply="communityReplyToReply",e.CommunityMention="communityMention",e.CommunityMembership="communityMembership",e.Calendar="calendar",e.ReactionInSubCommunity="reactionInSubCommunity",e.MentionInSubCommunity="mentionInSubCommunity",e.Community="community",e.UserContact="userContact"}(i||(i={})),function(e){e.Everyone="everyone",e.Team="team",e.Person="person",e.AddedToTeam="addedToTeam",e.PromotedToTeamAdmin="promotedToTeamAdmin",e.DownloadStarted="downloadStarted",e.Downloaded="downloaded",e.DownloadFailed="downloadFailed",e.ChannelReplyMessage="channelReplyMessage",e.ChannelNewMessage="channelNewMessage",e.Call="call",e.Meetup="meetup",e.Bot="bot",e.Channel="channel",e.Campaign="campaign",e.MissedCall="missedCall",e.Voicemail="voicemail",e.ThirtyDayNotification="thirtyDayNotification",e.RifteenDayNotification="rifteenDayNotification",e.RenewedNotification="renewedNotification",e.OneOnOneChat="oneOnOneChat",e.GroupChat="groupChat",e.ShareFromChat="shareFromChat",e.Like="like",e.Angry="angry",e.Sad="sad",e.Laugh="laugh",e.Heart="heart",e.Surprised="surprised",e.NotifySender="notifySender",e.PendingSelfJoinRequest="pendingSelfJoinRequest",e.PendingOnBehalfOfJoinRequest="pendingOnBehalfOfJoinRequest",e.NativeNotificationFre="nativeNotificationFre",e.PendingOnBehalfOfJoinRequestMultiple="pendingOnBehalfOfJoinRequestMultiple",e.TaskAssignedToYou="taskAssignedToYou",e.UrgentTaskAssignedToYou="urgentTaskAssignedToYou",e.YourTaskWasUpdated="yourTaskWasUpdated",e.YourTaskChangedToNotStarted="yourTaskChangedToNotStarted",e.YourTaskChangedToInProgress="yourTaskChangedToInProgress",e.YourTaskChangedToCompleted="yourTaskChangedToCompleted",e.YourTaskChangedToBlocked="yourTaskChangedToBlocked",e.YourTaskChangedToRemoved="yourTaskChangedToRemoved",e.YourTaskChangedToNotApplicable="yourTaskChangedToNotApplicable",e.YourTaskWasReassigned="yourTaskWasReassigned",e.YourTaskWasDeleted="yourTaskWasDeleted",e.TaskListPublishedToYourTeam="taskListPublishedToYourTeam",e.TaskListRecalledFromYourTeam="taskListRecalledFromYourTeam",e.YourTaskWasMarkedUrgent="yourTaskWasMarkedUrgent",e.YourTaskWasMarkedNotUrgent="yourTaskWasMarkedNotUrgent",e.UrgentTaskPublishedToYourTeam="urgentTaskPublishedToYourTeam",e.SmsChat="smsChat",e.NewShift="newShift",e.SchedulePublished="schedulePublished",e.NewShiftRequest="newShiftRequest",e.ShiftRequestUpdated="shiftRequestUpdated",e.ShiftUpdated="shiftUpdated",e.MissedMeetingNudge="missedMeetingNudge",e.Tag="tag",e.InviteeJoined="inviteeJoined",e.AddedToSharedChannel="addedToSharedChannel",e.TeamShareTeamOwnerNotify="teamShareTeamOwnerNotify",e.PromotedToSharedChannelOwner="promotedToSharedChannelOwner",e.ChannelOwnerUnshareTeamOwnerNotify="channelOwnerUnshareTeamOwnerNotify",e.TeamOwnerUnshareChannelOwnerNotify="teamOwnerUnshareChannelOwnerNotify",e.HostOwnerUnshareChannelOwnerNotify="hostOwnerUnshareChannelOwnerNotify",e.HostOwnerUnshareTeamOwnerNotify="hostOwnerUnshareTeamOwnerNotify",e.Community="community",e.CommunityJoinInviteCreated="communityJoinInviteCreated",e.CommunityJoinInviteAccepted="communityJoinInviteAccepted",e.CommunityMembershipJoinRequestAccepted="communityMembershipJoinRequestAccepted",e.CommunityMembershipJoinRequestCreated="communityMembershipJoinRequestCreated",e.CommunityMembershipPromotedToAdmin="communityMembershipPromotedToAdmin",e.NewCalendarEvent="newCalendarEvent",e.CalendarEventCanceled="calendarEventCanceled",e.CalendarEventUpdated="calendarEventUpdated",e.InviteeJoinedOne2One="inviteeJoinedOne2One",e.InviteeJoinedGroupChat="inviteeJoinedGroupChat",e.InviteeJoinedCommunity="inviteeJoinedCommunity",e.CommunityFeatured="communityFeatured",e.Nearby="nearby"}(a||(a={})),function(e){e.Call="call",e.Chat="chat"}(o||(o={}));const r=[i.Reaction,i.TeamMembershipChange,i.Mention,i.Follow,i.Reply,i.ReplyToReply],s=[i.MentionInChat,i.ReactionInChat,i.Priority];var l,c,d,u,m,p;!function(e){e.MobileOnly="mobile",e.DesktopWebOnly="desktopWeb",e.All="all"}(l||(l={})),function(e){e.taco="2a84919f-59d8-4441-a975-2a8c2643b741",e.calendar="ef56c0de-36fc-4ef8-b417-3d82ba9d073c"}(c||(c={})),function(e){e.toggleActivityRead="toggleActivityRead",e.deleteActivityFeedItem="deleteActivityFeedItem",e.removeActivityFeedItem="removeActivityFeedItem",e.channelNotificationSettings="channelNotificationSettings",e.missedCallFeedCallBackAction="missedCallFeedCallBackAction",e.missedCallFeedChatAction="missedCallFeedChatAction",e.notificationSettings="notificationSettings",e.turnOffLikesAndReactions="turnOffLikesAndReactions",e.muteApp="muteApp",e.turnOffChannel="turnOffChannel",e.turnOffAllTeamAndChannelMentions="turnOffAllTeamAndChannelMentions",e.turnOffRepliesFromChannel="turnOffRepliesFromChannel",e.turnOffPostsFromChannel="turnOffPostsFromChannel",e.goToSourceApp="goToSourceApp",e.popoutConversation="popoutConversation"}(d||(d={})),function(e){e.notificationSettings="notificationSettings",e.markAllAsRead="markAllAsRead"}(u||(u={})),function(e){e.mentionIcon="iconsMention",e.likeIcon="iconsReactionsLike",e.sadIcon="iconsReactionsSad",e.wowIcon="iconsReactionsWow",e.angryIcon="iconsReactionsAngry",e.heartIcon="iconsReactionsHeart",e.laughIcon="iconsReactionsLaugh",e.missedCallIcon="missedCallIcon",e.voicemailIcon="voicemailIcon",e.urgentIcon="iconsUrgent",e.defaultIcon="iconDefault",e.addedToTeamIcon="addedToTeamIcon",e.promotedToAdminIcon="promotedToAdminIcon",e.communityMentionIcon="communityMentionIcon",e.channelMentionIcon="channelMentionIcon",e.teamMentionIcon="teamMentionIcon",e.followChannelIcon="followChannelIcon",e.replyIcon="replyIcon",e.customIcon="customIcon",e.channelShareIcon="channelShareIcon",e.channelDismissIcon="channelDismissIcon",e.everyoneMentionIcon="everyoneMentionIcon",e.nearbyMentionIcon="nearbyMentionIcon",e.calendar="calendar",e.appIcon="iconsApp",e.starIcon="starIcon"}(m||(m={})),function(e){e.hasText="hasText",e.sentAFile="sentAFile",e.sentAnImage="sentAnImage",e.sentACard="sentACard",e.previewUnavailable="previewUnavailable",e.DLPMessagePreview="dlpMessagePreview"}(p||(p={}));const g=30,h=1e3;var v,y,S,f;!function(e){e.unread="unread",e.mention="mention",e.reactions="reactions",e.missedcall="missedcall",e.reply="reply",e.apps="apps",e.voicemail="voicemail",e.atmentions="atmentions"}(v||(v={})),function(e){e.states="states",e.types="types"}(y||(y={})),function(e){e.unread="unreadOnly",e.atmentions="atMentionsOnly"}(S||(S={})),function(e){e.navWithoutEarlyFetch="navWithoutEarlyFetch",e.navOnEarlyFetch="navOnEarlyFetch",e.navOnDifferentMainEntity="navOnDifferentMainEntity",e.noNavOnSameMainEntity="noNavOnSameMainEntity"}(f||(f={}))},262462:(e,t,n)=>{"use strict";var i,a,o,r;n.d(t,{pC:()=>i,v1:()=>a,uD:()=>o,pR:()=>r,c1:()=>s,sX:()=>l}),function(e){e.DEFAULT="DEFAULT",e.CHANNEL="CHANNEL",e.COMMUNITIES="COMMUNITIES"}(i||(i={})),function(e){e.Private="Private"}(a||(a={})),function(e){e.TFL="TFL",e.SFC="SFC"}(o||(o={})),function(e){e.chat="chatCampaign",e.meeting="meetingCampaign",e.files="filesCampaign",e.contactSyncConfirmation="contactSyncConfirmation",e.communityInvite="communityInviteCampaign"}(r||(r={}));const s={teamAvatar:"teamAvatar",staticImage:"staticImage",imageUrl:"imageUrl",default:"default"},l={DLP:"DLP"}},279680:(e,t,n)=>{"use strict";n.d(t,{ou:()=>m,Tc:()=>p,C5:()=>g,yw:()=>T,$G:()=>F,VF:()=>_,lN:()=>D,EU:()=>P,jy:()=>M,is:()=>R,Ss:()=>x,pH:()=>L,dq:()=>O,zx:()=>j,X8:()=>B,A8:()=>A,gb:()=>E,dG:()=>$,N6:()=>W,BD:()=>V,Nl:()=>H,l5:()=>z,mf:()=>q});var i=n(554186),a=n(754255),o=n(289242),r=n(131647),s=n(572909),l=n(634664),c=n(702183),d=n(364819);const u="remote-brb-participants-banner",m="79",p="118",g="11";function h(e){const{clientId:t}=e.get(a.w.Brb);return t}function v(e){const{licenseType:t}=e.get(a.w.UserResources);return t}function y(e,t){const{platformAdoTagPrefix:n,platformAdoTagSuffix:i}=e.get(a.w.Brb);let r=`${n||"teams"}_${i||t.config.browser}`;return n&&i&&t?.config?.platformId===o.PU.Web&&(r=t?.config?.browser?`${r}_${t?.config?.browser}`:r),r}function S(e,t,n,i,o){const{adoTagsForAllItems:r,categories:s,enableBrbTags:l}=e.get(a.w.Brb),c=s?.find((e=>e?.id===t));return[r,c?.additionalAdoTags||"",n.get(T.Ring)||"unknownRing",y(e,i),n.get(T.MTMA)?"MTMA":"",l&&o?o:""].filter((e=>e)).join(";")}function f(e,t,n){const i=t.get(T.Ring)||"",a=t.get(T.UserEmail)||"",o=i.replace("ring","R").replace("_",".")||"",r=function(e,t){return y(e,t).split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("")}(e,n);return`[${o}] ${r}: ${function(e){const t=e&&e.split("@")[1];return t&&t.substr(0,t.lastIndexOf("."))}(a)||""}: `}function k(e,t,n,i){const o=`${function(e,t,n){const i=t.get(T.Build)||"",{enableDetailedBrbTitlePrefix:o}=e.get(a.w.Brb);return i.startsWith("local")?"[LOCAL] ":i.indexOf("oncdn")>=0?"[CONTAINER] ":o?f(e,t,n):""}(t,n,i)||""}${e||""}`,{brbItemTitleMaxLength:r}=t.get(a.w.Brb);return b(o,r||1500)}function C(e,t){const{brbItemDescriptionMaxLength:n}=t.get(a.w.Brb);return b(e||"",n||5e3)}function b(e,t){return(e=e||"No text provided").length>t?`${e.substring(0,t-3)}...`:e}function w(e){let t="";const n=e.get(T.MTMA);n&&"MTMA"===n&&(t="<h3>(This is MTMA scenario, please check logs from user's other accounts under Links tab)</h3><br>");let i="";return e?.forEach(((e,t)=>{i=`${i}<b>${t}:</b> ${e}<br>`})),`<h3><strong>All the logs & screenshots (if attached) are available in the devlogs link which is present in the Links tab.</strong></h3><br>${t}${i}`.trim()}var T,I,N,A,E;async function F(e,t,n){try{const n=await t.loadModule("toasts");if(n){const t=await(n?.getFocusAssistStateAsync?.());e.set(I.FocusAssistant,t||"");const i=await(n?.getGlobalNotificationSettingsAsync?.());e.set(I.GlobalNotificationSettings,i?.global||"")}}catch(e){n.log("Failed to obtain system notification settings: ",e)}}function _(e,t,n,i,r){e.set(T.UserEmail,t?.profile?.email||t?.profile?.upn||t?.profile?.preferred_username||""),e.set(T.UserType,t?.type?.toString()||""),e.set(T.TenantID,t?.profile?.tid||""),e.set(T.Ring,n.get(a.w.Metadata)?.ring?.id||""),e.set(T.UserID,t?.profile?.oid?.toString()||"");const s=n.get(a.w.Brb)?.sendBrbMSAlias?i.config.clientType===o.sK.Maglev?t?.userName:t?.profile?.upn||t?.profile?.email:"";e.set(T.MSAlias,s||"");const{sessionId:l}=n.get(a.w.Platform);e.set(T.SessionId,l||""),e.set(T.Language,r?.locale||"")}async function D(e,t,n){try{const n=await t.loadModule("osutils");if(n){const t=await(n?.getDeviceInfo?.());e.set(T.OsVersion,t?.osVersion||""),e.set(T.UbrVersion,t?.ubrVersion||""),e.set(T.DeviceID,t?.deviceId||"unkown deviceID"),e.set(T.SystemManufacturer,t?.make||""),e.set(T.DeviceModel,t?.model||""),e.set(T.AppCenterInstallerId,t?.appCenterInstallerId||"")}}catch(e){n.log("Error while obtaining BRB device informations: ",e)}}async function P(e,t,n){try{e.set(T.slimCoreVersion,t?.SlimCore?.getVersion().toString()||"unkown slimcore version")}catch(e){n.log("Impossible fetch slimcore version: ",e)}}async function M(e,t,n,i){try{const{browser:i,browserVersion:o,clientVersion:r}=n.get(a.w.Platform);e.set(T.Browser,i||""),e.set(T.BrowserVersion,o||""),e.set(T.WebClientBuild,r||"");const{systemInfoClient:s}=n.get(a.w.Brb);e.set(T.Client,s||"");const{desktopVersion:l}=n.get(a.w.Host);e.set(T.DesktopClientVersion,l||"unknown"),e.set(T.Platform,t?.config?.platformId?.toString()||""),e.set(T.Os,t?.config?.osPlatform||"")}catch(e){i.log("Failed to obtain app information: ",e)}}async function R(e,t,n){try{const{enableCustomNotificationsForCalls:n,enableCustomNotificationsForChats:i,enableCustomNotificationsOnDesktop:o}=t.get(a.w.Core);e.set(I.CustomNotificationOnDesktop,o?"Enabled":"Disabled"),e.set(I.CustomNotificationForCalls,n?"Enabled":"Disabled"),e.set(I.CustomNotificationForChats,i?"Enabled":"Disabled")}catch(e){n.log("Failed to obtain app information: ",e)}}function x(e,t,n){try{const{callingEnableUnifiedJoinFlowForPlaceCalls:n}=t.get(a.w.Calling);e.set(N.callingEnableUnifiedJoinFlowForPlaceCalls,n?"Enabled":"Disabled")}catch(e){n.log("Failed to obtain FF callingEnableUnifiedJoinFlowForPlaceCalls status: ",e)}}async function L(e,t){const n=await(t?.getCachedUsers?.({id:(0,i.v4)(),scenarioName:c.Cu.AuthWebCachedUser,source:"brb-utils::addMTMAInfo"})),a=n?.length&&n.length>1;e.set(T.MTMA,a?"MTMA":"")}function O(e,t,n,o,r){const s={ReportTitle:k(e.text,t,o,r),ReportDescription:C(e.text,t),CategoryName:e.categoryId,UploadID:e?.diagnosticsUploadId??(0,i.v4)(),InitiatorIDs:[],ClientID:h(t),ClientVersion:U(o),CorelibVersion:"",Ring:o.get(T.Ring),SkypeAuthToken:n,TenantName:"",TenantID:o.get(T.TenantID),UserID:o.get(T.UserID),Email:o.get(T.UserEmail),MSAlias:o.get(T.MSAlias)||"",SkipEmailNotification:!1,SkipVsoTicketCreation:!1,SystemInfo:w(o),VsoTags:S(t,e.categoryId,o,r,e.routingTags),LicenseType:v(t),IsAutoBrb:"true"===o.get(T.IsAutoBrb),ClientFeedbackId:e?.clientFeedbackId??void 0,OngoingCallId:o.get(T.OngoingCallId),LastCallId:o.get(T.LastCallId),LastCallParticipantId:o.get(T.LastCallParticipantId),OngoingCallParticipantId:o.get(T.OngoingCallParticipantId)},{enabledRequestProperties:c}=t.get(a.w.Brb);if(c){const e=(0,d.pick)(s,c);return(0,l.hR)(e)}return(0,l.hR)(s)}function j(e,t,n){const{extendBrbReportsUrl:i,clientId:o}=t.get(a.w.Brb);return{baseUrl:i?.substring(0,i.lastIndexOf("/"))??"",title:e.text,clientId:o??"",clientVersion:U(n),ring:n.get(T.Ring)}}function B(e,t,n,o,r,s){const c={ReportTitle:k(e.text,o,r,s),ReportDescription:C(e.text,o),CategoryName:e.categoryId,SkypeAuthToken:t,UploadID:e?.diagnosticsUploadId??(0,i.v4)(),InitiatorIDs:[n],ClientID:h(o),ClientVersion:U(r),Email:r.get(T.UserEmail),TenantID:r.get(T.TenantID),UserID:r.get(T.UserID),Ring:r.get(T.Ring),RemoteBrb:e.isRemoteBrb,ClientFeedbackId:e?.clientFeedbackId??void 0},{enabledRequestProperties:u}=o.get(a.w.Brb);if(u){const e=(0,d.pick)(c,u);return(0,l.hR)(e)}return(0,l.hR)(c)}function U(e){return e.get(T.WebClientBuild)||"1.1.11.1111_11/1.1.1.1111111111"}function $(e,t,n,i,a){let o=i;o=o?o===E.ApiFailure?E.ApiFailure:o.includes(E.TimedOut)?E.TimedOut:E.Unknown:void 0;let r=e.get(t);return r?(r.uploadStatus=n,r.byteSize=a??r.byteSize,r.error=o??r.error):(r={uploadStatus:n,byteSize:a,error:o},e.set(t,r)),o}function W(e){let t=!0;const n=[];for(const[i,a]of e.entries()){const e=a.byteSize?`(${a.byteSize} bytes)`:"",o=`Status: ${a.uploadStatus}`;t=a.uploadStatus===A.Success&&t;const r=`FileName: ${i} ${e}, ${o}${a.error?`, error: ${a.error}`:""}`;n.push(r)}return{content:n.join("\r\n"),allLogFilesUploaded:t,summaryFileUploaded:!1}}function V(e){const t=e.split("/"),n=t.length>1?t[t.length-1]:e;return e.includes("WebLogs/Core")?`WebLogs/Core/${n}`:e.includes("WebLogs/User")?`WebLogs/User/${n}`:n}function H(e,t){e.shell.showBanner({id:u,source:r.p.RemoteBrbParticipantsBanner,bannerScenario:"remote_brb_banner",intentLevel:"Neutral",cause:"RemoteBrbBanner",text:t.stringTranslate("framework","remote_brb_participants_banner"),action:{text:t.stringTranslate("framework","remote_brb_participants_banner_privacy_statement"),command:{entity:{type:s.ck.remotebrbbanner,action:s.SY.view}},dismissOnAction:!0},dismissable:!0,duration:0})}function z(e){e.shell.dismissBanner(u,r.p.RemoteBrbParticipantsBanner)}!function(e){e.UserEmail="UserEmail",e.TenantID="TenantID",e.Ring="Ring",e.UserID="UserID",e.WebClientBuild="WebClient build",e.Build="Build",e.MTMA="MTMA",e.MSAlias="MSAlias",e.DeviceID="Device ID",e.Language="Language",e.SystemManufacturer="System Manufacturer",e.DeviceModel="Device Model",e.DesktopVersion="Desktop Version",e.slimCoreVersion="Slimcore Version",e.UbrVersion="Update Build Revision",e.Platform="Platform",e.Os="OS",e.OsVersion="OS Version",e.Browser="Browser",e.BrowserVersion="Browser Version",e.Client="Client",e.UserType="User Type",e.SessionId="Session Id",e.DesktopClientVersion="Desktop Client Version",e.AppCenterInstallerId="AppCenter Installer ID",e.IsAutoBrb="IsAutoBrb",e.OngoingCallId="OngoingCallId",e.LastCallId="LastCallId",e.LastCallParticipantId="LastCallParticipantId",e.OngoingCallParticipantId="OngoingCallParticipantId"}(T||(T={})),function(e){e.FocusAssistant="Focus Assistant",e.GlobalNotificationSettings="Global Notification Settings",e.CustomNotificationOnDesktop="Custom Notification on Desktop",e.CustomNotificationForChats="Custom Notification for Chats",e.CustomNotificationForCalls="Custom Notification for Calls"}(I||(I={})),function(e){e.callingEnableUnifiedJoinFlowForPlaceCalls="Enable Unified Join Flow For Place Calls"}(N||(N={})),function(e){e.Requested="Requested",e.Success="Success",e.Failure="Failure"}(A||(A={})),function(e){e.TimedOut="TimedOut",e.Unknown="Unknown",e.ApiFailure="ApiFailure",e.NetworkError="NetworkError"}(E||(E={}));const q=e=>{let t=[];const{enableFeedbackSubMenuInMoreOptionsMenu:n,enableBrbHeapSnapshotCheckbox:i,enableVideoVbssBrbSplitCategories:a}=e;return i||t.push(m),t=n&&a?t.concat(["2","50"]):t.concat([p,"119"]),t}},874090:(e,t,n)=>{"use strict";n.d(t,{G:()=>y});var i=n(754255),a=n(702183),o=n(854190),r=n(953730),s=n(279680),l=n(368848);const c=e=>{const t=e.loggerFactory.newLogger("BrbServiceEndpointsManager","services-io-brb");return{baseUrl:"https://brbv2",serviceName:o.p.BRB,models:{createBrbItem:u(e,t),uploadLogsFile:m(e,t),releaseBrbItem:p(e,t),extendBrbReports:d(e,t)}}},d=async(e,t)=>({allowedResponses:[r.nW.OK],constructRequest:(n,a,o,r)=>{if(!a){const e=`Skype token is not present: ${a}`;throw t.error(e),new Error(e)}const{extendBrbReportsUrl:l}=e.coreSettings.get(i.w.Brb);if(!l){const e=`Failed to retrieve extend BRB report url from core settings: ${l}`;throw t.error(e),new Error(e)}let c;try{c=(0,s.X8)(n,a,o,e.coreSettings,r,e.platformService)}catch(e){throw t.error("Failed to get extend BRB report request body:",e),e}const d=new URL(l);return{method:"POST",url:d.href,headers:{Host:d.hostname,"Content-Type":"application/json","Content-Length":`${c.length}`},body:c}},abortOnTimeout:!1}),u=async(e,t)=>({allowedResponses:[r.nW.OK],constructRequest:(n,a,o)=>{if(!n){const e=`Skype token is not present: ${n}`;throw t.error(e),new Error(e)}const{createBrbRequestUrl:r}=e.coreSettings.get(i.w.Brb);if(!r){const e=`Failed to retrieve create BRB request url from core settings: ${r}`;throw t.error(e),new Error(e)}let l;try{l=(0,s.dq)(a,e.coreSettings,n,o,e.platformService)}catch(e){throw t.error("Failed to get create BRB item request body:",e),e}const c=new URL(r);return{method:"POST",url:c.href,headers:{Host:c.hostname,"Content-Type":"application/json","Content-Length":`${l.length}`},body:l}}}),m=(e,t)=>Promise.resolve({allowedResponses:[r.nW.CREATED],constructRequest:(n,a)=>{if(!n){const e=`Create BRB item response body is not present: ${n}`;throw t.error(e),new Error(e)}if(!a){const e=`Logs file is not present: ${a}`;throw t.error(e),new Error(e)}const{enableGzipUpload:o,minSizeToGzip:r}=e.coreSettings.get(i.w.Brb,["enableGzipUpload","minSizeToGzip"]),s=new URL(n.ContainerUrl);let c,d,u;return o&&"string"==typeof a.content&&a.content.length>(r??2e3)?(c=(0,l.gzip)(a.content),d=c.length,u=!0):(c=a.content,d="string"==typeof a.content?a.content.length:a.content.size,u=!1),{method:"PUT",url:`${s.href}/${a.fileName}?${n.SASToken}`,headers:{Host:s.hostname,"Content-Type":"text/plain","Content-Length":d.toString(),"x-ms-blob-type":"BlockBlob",...u?{"Content-Encoding":"gzip"}:{}},body:c}},transformResponse:()=>Promise.resolve(!0),abortOnTimeout:!1}),p=(e,t)=>Promise.resolve({allowedResponses:[r.nW.OK],constructRequest:n=>{if(!n){const e=`Container ID is not present: ${n}`;throw t.error(e),new Error(e)}const{releaseBrbRequestUrlPrefix:a}=e.coreSettings.get(i.w.Brb);if(!a){const e=`Failed to retrieve release BRB request url prefix from core settings: ${a}`;throw t.error(e),new Error(e)}const o=new URL(`${a}${n}`);return{method:"POST",url:o.href,headers:{Host:o.hostname,"Content-Length":"0"}}},transformResponse:()=>Promise.resolve(!0),abortOnTimeout:!1});var g=n(780952),h=n(195695);class v{constructor(e,t,n,i,a,o,r,s,l,c,d,u){this.coreSettings=t,this.logsCollectorService=n,this.authenticationService=i,this.platformService=a,this.discover=o,this.host=r,this.hostCommunicationService=s,this.brbServiceApi=l,this.i18n=c,this.activeWindowsService=d,this.authenticationUser=u,this.defaultUploadDesktopLogsTimeoutMs=2e4,this.logger=e.newLogger("BrbServiceTasks","services-io-brb")}async getSystemInfo(){const e=new Map;let t;e.set("TimeStamp",(new Date).toISOString()),this.logger.debug("... starting getSystemInfo() brb");try{t=await this.authenticationService.getUser()}catch(e){this.logger.error("Failed to fetch user:",e)}(0,s.VF)(e,t,this.coreSettings,this.platformService,this.i18n);const{enableMTMA:n}=this.coreSettings.get(i.w.Core);n&&await(0,s.pH)(e,this.authenticationService),await(0,s.EU)(e,this.host,this.logger),await(0,s.jy)(e,this.platformService,this.coreSettings,this.logger),await(0,s.lN)(e,this.hostCommunicationService,this.logger),await(0,s.$G)(e,this.hostCommunicationService,this.logger),await(0,s.is)(e,this.coreSettings,this.logger),(0,s.Ss)(e,this.coreSettings,this.logger);let a=new Map;try{a=await this.logsCollectorService.getSystemInfo()||new Map}catch(e){this.logger.error("Failed to fetch system info from logs collector service:",e)}return new Map([...Array.from(e.entries()),...Array.from(a.entries())])}async createBrbItem(e,t){let n;try{const i=await this.discover.validateSkypeToken({correlation:(0,h.$q)("brb-tasks:createBrbItem")});n=await this.brbServiceApi.createBrbItem(i,e,t)}catch(e){return this.logger.error("Failed creating BRB item:",e),null}return n}async extendBrbReports(e,t,n){let i;try{const a=await this.discover.validateSkypeToken({correlation:(0,h.$q)("brb-tasks:extendBrbReports")});i=await this.brbServiceApi.extendBrbReports(e,a,t,n,this.platformService)}catch(e){return this.logger.error("Failed extending BRB report"),null}return i}async uploadWebLogsFiles(e,t,n){const o=new Map,{enableMTMA:r}=this.coreSettings.get(i.w.Core),{maxBRBLogsCountInLogFile:l}=this.coreSettings.get(i.w.Diagnostics),c=async n=>{const i=n.content instanceof Blob?n.content.size:new Blob([n.content]).size,r=`File name: ${n.fileName}, size: ${i} bytes, container: ${e.ContainerID}`;(0,s.dG)(o,n.fileName,s.A8.Requested,void 0,i);const l=(0,s.BD)(n.fileName);try{const c=await this.brbServiceApi.uploadLogsFile(e,n),d=c?s.A8.Success:s.A8.Failure;return(0,s.dG)(o,n.fileName,d,d?void 0:s.gb.ApiFailure,i),t?.mark(a.BQ.UploadWebLogsFiles,{reason:r,size:i,context:l},d?"success":"failure"),c}catch(e){return this.logger.error(`Failed to upload logs file - ${n.fileName} - error:`,e),(0,s.dG)(o,n.fileName,s.A8.Failure,e.toString(),i),t?.mark(a.BQ.UploadWebLogsFiles,{reason:r,size:i,context:l},"failure"),!1}},{validLogProviders:d}=this.coreSettings.get(i.w.Brb),u=d?[...d]:void 0;try{r&&this.authenticationUser?.id?await this.logsCollectorService.callOnUserLogsFiles([this.authenticationUser.id],c,!1,n||!1,l||void 0,u):await this.logsCollectorService.callOnLogsFiles(c,!1,n||!1,l||void 0,u)}catch(e){return this.logger.error("Failed when calling upload on all logs files:",e),o}return o}async uploadDesktopLogsFiles(e,t,n,o){const r="Desktop-Logs-and-Screenshots",l=new Map,c=await this.hostCommunicationService.loadModule("brb");if(!c)return this.logger.log("uploadDesktopLogsFiles(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),l;let d;const{enableMTMA:u}=this.coreSettings.get(i.w.Core);if(u&&this.activeWindowsService){const e=this.authenticationUser?.id,n=this.activeWindowsService.getActiveWindows(),i=[];n.forEach((t=>{t.userContextId===e&&i.push(t.id)})),d=t?.filter((e=>i.includes(e)))}else d=t;if(!c.uploadDesktopLogs)return this.logger.error("uploadDesktopLogs not available on brb module."),l;const{uploadDesktopLogsTimeoutMs:m,enableGcchTapRaPFeature:p}=this.coreSettings.get(i.w.Brb),h={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature},screenshotIds:d,piiFree:p||o},v=m??this.defaultUploadDesktopLogsTimeoutMs;try{this.logger.log(`uploadDesktopLogsFiles(): upload desktop logs and screenshots with timer to container: ${e.ContainerID}`);const t=await(0,g.a)(c.uploadDesktopLogs(h),v,`uploadDesktopLogs timed out. Ran for ${v} ms.`),i=!!t?.status;return(0,s.dG)(l,r,i?s.A8.Success:s.A8.Failure,i?void 0:s.gb.ApiFailure),n?.mark(a.BQ.UploadDesktopLogsFiles,i?void 0:{reason:`${s.gb.ApiFailure}`},i?"success":"failure"),l}catch(e){this.logger.error("Failed to upload desktop logs files. Error:",e);const t=(0,g.W)(e)?s.gb.TimedOut:s.gb.Unknown;(0,s.dG)(l,r,s.A8.Failure,t);const i=`Error: ${t}, Timer: ${v}`;return n?.mark(a.BQ.UploadDesktopLogsFiles,{reason:i,error:e.toString()},"failure"),l}}async uploadHeapSnapshotFiles(e,t){const n="Heap-Snapshot",i=new Map,o=await this.hostCommunicationService.loadModule("brb");if(!o)return this.logger.log("uploadHeapSnapshotFiles(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),i;if(!o.uploadHeapSnapshot)return this.logger.error("uploadHeapSnapshot not available on brb module."),i;const r={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature}};try{const e=await o.uploadHeapSnapshot(r),l=!!e?.status;return(0,s.dG)(i,n,l?s.A8.Success:s.A8.Failure,l?void 0:s.gb.ApiFailure),t?.mark(a.BQ.UploadHeapSnapshotFiles,l?void 0:{reason:`${s.gb.ApiFailure}`},l?"success":"failure"),i}catch(e){this.logger.error("Failed to upload heapsnapshot files. Error:",e),this.logger.errorToTelemetry?.("Failed to upload heap snapshot file","brb");const o=(0,s.dG)(i,n,s.A8.Failure,e.toString());return t?.mark(a.BQ.UploadHeapSnapshotFiles,{reason:o},"failure"),i}}async uploadMemoryTracingFile(e,t){const n="Memory-Tracing",i=new Map,o=await this.hostCommunicationService.loadModule("brb");if(!o)return this.logger.log("uploadMemoryTracingFile(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),i;if(!o.uploadMemoryTracing)return this.logger.error("uploadMemoryTracing not available on brb module."),i;const r={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature}};try{const e=await o.uploadMemoryTracing(r),l=!!e?.status;return(0,s.dG)(i,n,l?s.A8.Success:s.A8.Failure,l?void 0:s.gb.ApiFailure),t?.mark(a.BQ.UploadMemoryTracingFile,l?void 0:{reason:`${s.gb.ApiFailure}`},l?"success":"failure"),i}catch(e){this.logger.error("Failed to upload memory tracing file. Error:",e),this.logger.errorToTelemetry?.("Failed to upload memory tracing file","brb");const o=(0,s.dG)(i,n,s.A8.Failure,e.toString());return t?.mark(a.BQ.UploadMemoryTracingFile,{reason:o},"failure"),i}}async releaseBrbItem(e){let t;try{t=await this.brbServiceApi.releaseBrbItem(e)}catch(e){return this.logger.error("Failed to release the BRB item - error:",e),!1}return t}async uploadFileUploadSummary(e,t,n){const i=(0,s.N6)(t);try{const t=await this.brbServiceApi.uploadLogsFile(e,{fileName:"brb-file-upload-summary.txt",content:i.content,isPiiFree:!0});return n?.mark(a.BQ.UploadFileUploadSummary),i.summaryFileUploaded=t,i}catch(e){const t=e.toString().includes("TimedOut")?s.gb.TimedOut:s.gb.Unknown;return n?.mark(a.BQ.UploadFileUploadSummary,{reason:t},"failure"),i.summaryFileUploaded=!1,i}}}class y{constructor(e,t,n,i,a,o,r,s,l,d,u,m,p,g){this.coreSettings=t,this.hostCommunicationService=s,this.scenarioFactory=d,this.i18n=u,this.entityCommanding=g,this.defaultDisclaimer='NOTE: Data sent in feedback submissions will be "Support Data" under your agreement for Microsoft 365, including any information that would otherwise be considered "Customer Data" or "Personal Data". Please do not submit feedback that may include data you do not wish to provide to Microsoft as "Support Data".',this.logger=e.newLogger("BrbService","services-io-brb");const h=l.createApi(c);this.brbServiceTasks=new v(e,t,n,i,a,o,r,s,h,u,m,p)}registerRootToolsManager(e){try{this.rtm=e}catch(t){this.logger.error("could not get getRootToolsManager",e)}}async getSystemInfo(){let e=new Map;try{e=await this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.error("Failed to fetch system info:",e)}return Promise.resolve(e)}async getBrbFormData(){const{categories:e,disclaimer:t,enableVideoVbssBrbSplitCategories:n}=this.coreSettings.get(i.w.Brb),{enableFeedbackSubMenuInMoreOptionsMenu:a}=this.coreSettings.get(i.w.Feedback,["enableFeedbackSubMenuInMoreOptionsMenu"]),o=(0,s.mf)({enableFeedbackSubMenuInMoreOptionsMenu:!!a,enableBrbHeapSnapshotCheckbox:!0,enableVideoVbssBrbSplitCategories:!!n}),r=[];return e?.forEach((e=>{e&&!o.includes(e.id)&&r.push({id:e.id,name:e.name})})),this.logger.logNoPii?.("Returning data for BRB form",r),{disclaimer:t||this.defaultDisclaimer,categories:r}}async getBrbScreenshots(e){const t=await this.hostCommunicationService.loadModule("brb");if(!t)return void this.logger.logNoPii?.("getBrbScreenshots(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out.");this.logger.logNoPii?.("Requesting screenshots from host");const n=await(t.getScreenshotThumbnails?.({width:e.width}));return this.logger.logNoPii?.("Returning host-provided screenshots"),n?.screenshots}async createBrbItem(e,t){const{enableBrb:n}=this.coreSettings.get(i.w.Brb);if(!n)return void this.logger.logNoPii?.("Create BRB item not enabled - setting:",n);const o=this.scenarioFactory.newScenario(a.Cu.BrbCreateItem,{timeoutMs:36e5});o.appendEventData({isAutoBrb:t}),o.mark(a.BQ.BrbSubmitted);const r=await this.processCreateBrbRequest(e,!!t);if("error"!==r.kind)return o.stop(),{containerId:r.response.ContainerID};o.fail({reason:r.reason})}async extendBrbReports(e,t,n,o){const{enableBrb:r}=this.coreSettings.get(i.w.Brb),s=this.scenarioFactory.newScenario(a.Cu.BrbExtendReports);if(s.appendEventData({isAutoBrb:n}),!r){const e="Current account is not internal ring account";return this.logger.errorNoPii?.(e),s.cancel({reason:e}),!1}const l=await this.processExtendBrbReportsRequest(e,t.containerId,o);return l?s.stop():s.fail(),this.logger.logNoPii?.("Finished extending brb report"),l}async processExtendBrbReportsRequest(e,t,n){let a=new Map;try{a=await this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.errorNoPii?.("Failed to fetch system info")}let o=null;const r=e.isRemoteBrb||!1;try{e.isRemoteBrb&&this.entityCommanding&&(0,s.Nl)(this.entityCommanding,this.i18n),o=await this.brbServiceTasks.extendBrbReports(e,t,a)}catch(e){return this.logger.errorNoPii?.("Failed to Extend BRB Reports"),!1}if(!o)return this.logger.error(`Request to Extend BRB Reports failed to receive response body: ${o}`),!1;let l=!1;const{enablePIIFreeLogsUpload:c}=this.coreSettings.get(i.w.Brb),d=c||n;try{l=await this.uploadFilesToBrbItem(o,e.includeHeapSnapshot,e.screenshotIds?[...e.screenshotIds]:void 0,e.includeLogs||!1,d,r),l||this.logger.error(`Failed to upload all logs files to first party container: ${t}`),e.isRemoteBrb&&this.entityCommanding&&(0,s.l5)(this.entityCommanding)}catch(e){this.logger.error(`Error when uploading all logs files to first party container: ${t}`)}return!0}async processCreateBrbRequest(e,t){let n=new Map;try{n=await this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.error("Failed to fetch system info:",e)}n.set(s.yw.IsAutoBrb,t?"true":"");let a=null;try{a=await this.brbServiceTasks.createBrbItem(e,n)}catch(e){return this.logger.error("Failed to create BRB item:",e),{kind:"error",reason:"Failed to create BRB item"}}if(!a)return this.logger.error(`Request to create BRB item failed to receive response body: ${a}`),{kind:"error",reason:"Request to create BRB item failed to receive response body"};this.triggerRemoteEvent(e.categoryId,a.ContainerID);const{enablePIIFreeLogsUpload:o}=this.coreSettings.get(i.w.Brb),r=o||!1;let l=!1;try{l=await this.uploadFilesToBrbItem(a,e.includeHeapSnapshot,e.screenshotIds?[...e.screenshotIds]:void 0,r,o||!1)}catch(e){this.logger.error("Failed to upload all logs files:",e)}l||this.logger.errorToTelemetry?.("Failed to upload all logs files - attempting to complete BRB item","brb");const{enableBrbReleaseLogsContainer:c}=this.coreSettings.get(i.w.Brb);if(c){let e=!1;try{this.logger.logNoPii?.("Start releasing Brb item."),e=await this.brbServiceTasks.releaseBrbItem(a.ContainerID)}catch(e){return this.logger.error("Failed to release BRB item:",e),{kind:"error",reason:"Failed to release BRB item"}}if(!e){const e="Failed to release the BRB item";return this.logger.errorNoPii?.(e),{kind:"error",reason:e}}}else this.logger.logNoPii?.("Skip releasing Brb item.");return{kind:"response",response:a}}includeLogs(e=!1){const{forceIncludeLogs:t}=this.coreSettings.get(i.w.Brb,["forceIncludeLogs"]),n=t?"Hide Include Logs checkbox":"Show Include Logs checkbox",a=t||e?"and will update logs":"and will not update logs";return this.logger.logNoPii?.(`${n} ${a}`),!(!t&&!e)}async uploadFilesToBrbItem(e,t=!1,n,o,r,s=!1){const l=this.scenarioFactory.newScenario(a.Cu.BrbUploadLogs);if(!this.includeLogs(o))return this.logger.logNoPii?.("Skip upload logs"),l.stop({reason:"Skip upload"}),!0;const c=[];let d=new Map;t&&(d=await this.brbServiceTasks.uploadHeapSnapshotFiles(e,l),c.push(this.brbServiceTasks.uploadMemoryTracingFile(e,l))),c.push(this.brbServiceTasks.uploadWebLogsFiles(e,l,r));const{disableUploadDesktopLogs:u}=this.coreSettings.get(i.w.Brb);u?this.logger.logNoPii?.("Skip upload desktop logs for GCCH-TAP account."):c.push(this.brbServiceTasks.uploadDesktopLogsFiles(e,n,l,r||s));(await Promise.all(c)).forEach((e=>{e.forEach(((e,t)=>{d.set(t,e)}))}));const m=await this.brbServiceTasks.uploadFileUploadSummary(e,d,l),p=m.allLogFilesUploaded&&m.summaryFileUploaded;return p?l.stop():l.fail(),p}isRemoteBrbCategory(e){const t=new Set(["1","2","3","49","50","76","11","118","119"]);return e=e.split("_")[0],t.has(e)}triggerRemoteEvent(e,t,n){if(!this.rtm)return this.logger.warn("RootToolsManager undefined"),!1;const{enableRemoteBrbEvent:a}=this.coreSettings.get(i.w.Brb,["enableRemoteBrbEvent"]);if(!a||!this.isRemoteBrbCategory(e))return this.logger.warn("Did not trigger remote event"),!1;try{return this.rtm.sendBRBEvent({uploadId:t}),this.logger.log("Triggered remote event for container ",t),!0}catch(e){return this.logger.error("Failed to trigger remote event"),!1}}}},401565:(e,t,n)=>{"use strict";n.d(t,{V:()=>i,B:()=>a});const i="broadcast-updated-event",a={streamUpdateHubEvent:"streamUpdate",captionsUpdate:"captionsUpdate",subscribeToStreamUpdatesHubEvent:"subscribeToStreamUpdates",notifyStreamSwitch:"notifyStreamSwitch",transcriptionStateUpdate:"transcriptionStateUpdate"}},932496:(e,t,n)=>{"use strict";var i;n.d(t,{D:()=>i}),function(e){e.UNIFIED_CALENDAR_SYNCING="UNIFIED_CALENDAR_SYNCING",e.UNIFIED_CALENDAR_SYNC_FAILED="UNIFIED_CALENDAR_SYNC_FAILED",e.UNIFIED_CALENDAR_UPTO_DATE="UNIFIED_CALENDAR_UPTO_DATE",e.EMPTY="EMPTY"}(i||(i={}))},305641:(e,t,n)=>{"use strict";var i,a;n.d(t,{Kg:()=>i,h1:()=>a,aK:()=>o,zg:()=>r,c_:()=>s,k6:()=>l,Ud:()=>c,_L:()=>d,uS:()=>u,m4:()=>m,pt:()=>p}),function(e){e.InProgress="InProgress",e.Success="Success",e.Error="Error",e.PartialSuccess="PartialSuccess"}(i||(i={})),function(e){e.StatusEntity="Microsoft.SkypeSpaces.MiddleTier.Models.StatusEntity"}(a||(a={}));const o="x-serverrequestid",r="call_blocking_list_refreshed",s=36e5,l="https://teams.microsoft.com/";var c;!function(e){e.getBlockedContacts="getBlockedContacts",e.postBlockedContacts="postBlockedContacts"}(c||(c={}));const d="api/",u=[{id:c.getBlockedContacts,path:"mt/part/msft/beta/userSettings/blocklist"},{id:c.postBlockedContacts,path:"mt/part/msft/beta/userSettings/blocklist/manage"}],m="https://teams.live.com/";var p;!function(e){e.Add="Add",e.Remove="Remove"}(p||(p={}))},62652:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});const i={On:"On",Off:"Off",BannerAndFeed:"BannerAndFeed",OnlyFeed:"OnlyFeed",OnlyBanner:"OnlyBanner",All:"All",CallMentionChats:"CallMentionChats",Immediately:"Immediately",Every10Mins:"Every10Mins",Hourly:"Hourly",EveryEightHours:"EveryEightHours",Daily:"Daily",Never:"Never",AllActivity:"AllActivity",MyAtMentions:"MyAtMentions",Custom:"Custom",Feed:"Feed",Ring:"Ring",Banner:"Banner",Mute:"Mute",MuteChat:"MuteChat",Unmute:"Unmute",MuteUntilJoin:"MuteUntilJoin",Purple:"Purple",Native:"Native",Default:"Default",DefaultUrgent:"DefaultUrgent",Vibe:"Vibe",Nudge:"Nudge",Tap:"Tap",Flick:"Flick",Pluck:"Pluck",Summon:"Summon",Ping:"Ping",Prioritize:"Prioritize",Escalate:"Escalate",Alarm:"Alarm"}},500135:(e,t,n)=>{"use strict";n.d(t,{O:()=>i,uS:()=>a,Pb:()=>o,pP:()=>r,lF:()=>s});const i={addMembersToThread:"addMembersToThread",createThread:"createThread",deleteConversation:"deleteConversation",removeMemberFromThread:"removeMemberFromThread",reportUser:"reportUser",updateThreadProperties:"updateThreadProperties"},a={addMembersToThread:"beta/groups/{threadId}/members",createThread:"beta/groups/create",deleteConversation:"beta/groups/{threadId}/deleteChat",removeMemberFromThread:"beta/groups/{threadId}/members/{userMri}",reportUser:"/beta/users/{userMri}/report",updateThreadProperties:"beta/groups/{threadId}/properties"},o="ConsumerGroupsService",r="{threadId}",s="{userMri}"},497653:(e,t,n)=>{"use strict";n.d(t,{re:()=>h,yN:()=>S,nD:()=>f});var i=n(754255),a=n(854190),o=n(635439),r=n(792767),s=n(500135),l=n(384463);const c="v1/threads/{threadId}/members",d="v1/threads",u="v1/threads/{threadId}",m="v1/threads/{threadId}/members/{userMri}",p="/v1/users/{userMri}/report",g="v1/threads/{threadId}/properties",h="https://groupssvc.fl.teams.microsoft.com/teams.readwrite";function v(e){return Promise.resolve({constructRequest:e,rejectHttpError:!0})}const y=(e,t,n)=>{const i=(0,r.B)(t,n),a=(0,o.e)(v,i);return{addMembersToThread:a((0,l.Jz)(e.groupsServiceAddToRosterEndpoint||c,e.groupsServiceThreadIdParameterToken||s.pP)),createThread:a((0,l.kW)(e.groupsServiceCreateGroupEndpoint||d)).withTransform(l.ie),deleteConversation:a((0,l.qV)(e.groupsServiceDeleteConversationEndpoint||u,e.groupsServiceThreadIdParameterToken||s.pP)),removeMemberFromThread:a((0,l.qu)(e.groupsServiceRemoveFromRosterEndpoint||m,e.groupsServiceThreadIdParameterToken||s.pP,e.groupsServiceUserMriParameterToken||s.lF)),reportUser:a((0,l.Rq)(e.reportUserEndpoint||p,e.groupsServiceUserMriParameterToken||s.lF)).withTransform(l.Fy),updateConversationTopic:a((0,l.JX)(e.groupsServiceUpdatePropertiesEndpoint||g,e.groupsServiceThreadIdParameterToken||s.pP))}},S=e=>{const{coreSettings:t,platformService:n,authenticationResources:o,authenticationService:r,config:s}=e,l=t.get(i.w.ConsumerGroups);return{serviceName:a.p.GroupsServiceV2,baseUrlPromise:()=>e.discover.regionGtm("groupsServiceV2"),authResource:f(r,o,h),models:y(l,n,s)}},f=(e,t,n)=>i=>e.getUser().then((()=>{const a=t.composeAuthResources((t=>e.authorizeRequest(t,n)),t.skypeXTokenAuthResource);return a(i)}))},384463:(e,t,n)=>{"use strict";n.d(t,{Jz:()=>s,kW:()=>l,qu:()=>c,JX:()=>d,qV:()=>u,Rq:()=>m,ie:()=>p,Fy:()=>g});var i=n(854190),a=n(431779),o=n(84646),r=n(500135);const s=(e,t)=>(n,a,s=!0)=>{const l=e.replace(t,encodeURIComponent(n)),c=s?{members:a.map((e=>({id:e.id,role:o.mz.Admin,shareHistoryTime:0})))}:{members:a.map((e=>({id:e.id,role:e.role,shareHistoryTime:0})))};return{url:l,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(c),serviceName:i.p.GroupsServiceV2,apiName:r.O.addMembersToThread}},l=e=>(t,n,a,s)=>{const l="true"===n[o.iy.IsStickyThread],c=""===a,d=""===s,u={members:t.map((e=>({id:e.id,role:l?o.mz.User:o.mz.Admin}))),properties:n,inviterMri:c?void 0:a,inviteLink:d?void 0:s};return{url:e,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(u),serviceName:i.p.GroupsServiceV2,apiName:r.O.createThread}},c=(e,t,n)=>(a,o)=>({url:e.replace(t,encodeURIComponent(a)).replace(n,encodeURIComponent(o)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:i.p.GroupsServiceV2,apiName:r.O.removeMemberFromThread}),d=(e,t)=>(n,a)=>{const o={topic:a};return{url:e.replace(t,encodeURIComponent(n)),method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(o),serviceName:i.p.GroupsServiceV2,apiName:r.O.updateThreadProperties}},u=(e,t)=>n=>({url:e.replace(t,encodeURIComponent(n)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:i.p.GroupsServiceV2,apiName:r.O.deleteConversation}),m=(e,t)=>(n,a,o)=>({url:e.replace(t,encodeURIComponent(n)),method:"POST",headers:{"content-type":"application/json","x-ms-mask-identity":o?"true":"false"},body:JSON.stringify(a),serviceName:i.p.GroupsServiceV2,apiName:r.O.reportUser});async function p(e){const{status:t,headers:{location:n},body:i}=e;if(void 0===n)throw new Error("location undefined");return{status:t,threadId:(0,a.$)(n),responseBody:i}}async function g(e){const{body:t,status:n}=e;return{status:n,responseBody:t}}},449505:(e,t,n)=>{"use strict";n.d(t,{Ww:()=>i,N_:()=>o,_F:()=>r,n$:()=>s,Pv:()=>l,sh:()=>c,R5:()=>d,YK:()=>u,yK:()=>m,iH:()=>p,$R:()=>g});var i,a=n(82095);!function(e){e.feed="TeamsFeed",e.syncFeed="TeamsFeedSync"}(i||(i={}));const o={defaultSection:"TeamsFeed",defaultTimeSortedSection:"TeamsFeedTimeSorted",defaultItemsToFetch:3,defaultLoadMoreItemsCount:5,defaultItemsToCompare:3,defaultReadSignalMinDwellTime:5e3,defaultCDLLoadMoreItemsCount:5,defaultDataSyncIntervalTime:3e5,defaultDiscoverTriagingTime:3e5,defaultServerCacheRetentionTimeInHrsSinceFirstCall:72,defaultDiscoverPollingInterval:3e5,defaultMinPageSizeForLoadMoreAPI:1,optimizeHydrationConfig:{durationToAllowBackgroundHydration:864e5,defaultLastVisitedSurface:a.HH.channel,enableHydrationOnTeamsClick:!1},optimizeBackgroundSyncConfig:{enableOnStartupSyncSkip:!1,enableOnPollingSyncSkip:!1,durationToAllowBackgroundSync:864e5},resyncOnUserActivityConfig:{enableResyncOnChannelLoad:!1,enableResyncOnDiscoverLoad:!1,offsetDelayInLastVisitedDiscoverInMs:6e4},lastVisitedSection:"LastVisited"},r=3,s=1e3,l=6e4,c=2,d=["408","409","429","504"],u={maxRetryCount:r,maxDelayTimeMs:l,exponentialDelayFactor:c,retryableErrorCodes:d,initialDelayMs:s};var m,p,g;!function(e){e.api="api",e.indexDB="indexdb",e.cdlCache="cdlcache",e.apolloCache="apollocache",e.unknown="unknown"}(m||(m={})),function(e){e.polling="polling",e.startup="startup",e.switch="switch",e.scroll="scroll",e.removeContent="removeContent",e.retry="retry",e.newUpdatesPoll="newUpdatesPoll",e.optimizer="optimizer",e.startupSync="startupSync",e.pollingSync="pollingSync",e.teamsClick="teamsClick"}(p||(p={})),function(e){e.emptyApiResponse="EMPTY_API_RESPONSE",e.validationFailed="VALIDATION_FAILED",e.hydrationFailed="HYDRATION_FAILED"}(g||(g={}))},82095:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{fo:()=>i,dN:()=>a,HH:()=>o}),function(e){e.SyncEngine="syncEngine",e.UserPreferenceChanged="userPreferenceChanged",e.UnknownCallInitiator="unknownCallInitiator",e.Optimizer="optimizer",e.teamsClick="teamsClick"}(i||(i={})),function(e){e.SyncEngine="syncEngine",e.StartPollMutation="startPollMutation"}(a||(a={})),function(e){e.discover="discover",e.channel="channel"}(o||(o={}))},629838:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{iF:()=>i,mI:()=>a,ao:()=>o}),function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(i||(i={})),function(e){e.Filters="Filters",e.None="None",e.ConsumerKey="ConsumerKey"}(a||(a={})),function(e){e.OnExpiry="OnExpiry",e.Never="Never"}(o||(o={}))},843628:(e,t,n)=>{"use strict";var i;n.d(t,{x:()=>i}),function(e){e[e.Success=0]="Success",e[e.Success_NoChanges=1]="Success_NoChanges",e[e.Abandoned_ClientVeryActive=2]="Abandoned_ClientVeryActive",e[e.Abandoned_NoNetwork=3]="Abandoned_NoNetwork",e[e.Error_TimedOut=4]="Error_TimedOut",e[e.Error_TransformFailed=5]="Error_TransformFailed",e[e.Error_BrowserError=6]="Error_BrowserError",e[e.Error_Unknown=7]="Error_Unknown",e[e.NotStarted=8]="NotStarted"}(i||(i={}))},105878:(e,t,n)=>{"use strict";var i;n.d(t,{S:()=>i}),function(e){e[e.Manual=0]="Manual",e[e.WhenExpired=1]="WhenExpired"}(i||(i={}))},817922:(e,t,n)=>{"use strict";n.d(t,{DJ:()=>w,hE:()=>T,ej:()=>b});var i=n(762322),a=n(554186),o=n(105878),r=n(843628),s=n(629838);const l="c72ea287-ed77-4fa6-a480-3712406c367e";class c{constructor(e,t,n){this.serviceName=e,this.ecsParameters=n,this.logger=t.newLogger(`EcsClient_${this.serviceName}`,"services-io-ecs")}async initializeCache(e){this.cache={storage:e.storage,partitionOptions:{strategy:e.partitionBy||s.mI.None,excludeFilters:e.excludeFiltersFromPartition||[],consumerKey:e.consumerKey},invalidate:e.invalidateCache||s.ao.Never};const{configKey:t,metadataKey:n}=this.generateCacheKeys();try{const e=await this.cache.storage.getItem(t),i=await this.cache.storage.getItem(n);if(e){const n=JSON.parse(e),a=i?JSON.parse(i):{requestStatus:r.x.Success};this.data={ecsConfiguration:n,...a},this.logger.log(`Cache successfully loaded: ${t}`)}else this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}}get(){return this.cache?.invalidate===s.ao.OnExpiry&&this.cacheState===s.iF.Expired&&(this.logger.log("Cache expired, clearing cache"),this.clearCache()),this.data}get expiration(){const e=this.data?.headers?.Expires;return e&&new Date(e)}get cacheState(){return void 0===this.cache?s.iF.NoCache:this.data?this.expiration&&this.expiration.valueOf()>Date.now()?s.iF.Valid:s.iF.Expired:s.iF.NoData}getDiagnosticInfo(){return{serviceName:this.serviceName,ecsParameters:this.ecsParameters,expirationTime:this.expiration}}generateCacheKeys(){if(void 0===this.cache)throw new Error("Cannot generate keys until after initializeCache() is called");const{strategy:e,excludeFilters:t,consumerKey:n}=this.cache.partitionOptions;let i=`ecs.cache.${this.serviceName}`;switch(e){case s.mI.ConsumerKey:if(!n)throw new Error("Cannot generate key using PartitionStrategy.ConsumerKey if consumerKey is not provided");i=`${n}`;break;case s.mI.Filters:{if(!this.ecsParameters)throw new Error("Cannot generate key using PartitionStrategy.Filters if ecsParameters is not set during instantiation");const e=this.ecsParameters.filters||{};t.length&&t.forEach((t=>{e[t]&&delete e[t]}));const n=Object.values(e).filter((e=>void 0!==e||null!==e));n.length&&(i+=`.${n.join(".")}`);break}case s.mI.None:}const a=`${i}.metadata`;return this.logger.debug(`Storage Keys calculated: ${i}, ${a}`),{configKey:i,metadataKey:a}}async clearCache(){if(this.data=void 0,void 0===this.cache)return;const{configKey:e,metadataKey:t}=this.generateCacheKeys();await this.cache.storage.removeItem(e),await this.cache.storage.removeItem(t),this.logger.log(`Cache for '${e}' and ${t} cleared.`)}}var d=n(953730),u=n(364819);const m="1.2.0",p="ECSCanary=1",g="@1js/ecs-client",h=(e,t,n,i)=>Promise.resolve({constructRequest:(t,a,o)=>({apiName:"getConfiguration",url:e,method:"GET",headers:{...n,...i,...o?{"If-None-Match":o}:void 0},correlationId:t}),customTelemetry:y,transformResponse:S(t),allowedResponses:[d.nW.OK,d.nW.NOT_MODIFIED,d.nW.CREATED,d.nW.NO_CONTENT]});function v(e,t,n){const i=function(e){return`${e.domain}/config/v1/${e.client}/`}(e),a=function(e){const t=[];if((0,u.forOwn)(e.filters,((e,n)=>{(0,u.isNil)(e)||(0,u.isArray)(e)&&0===e.length||t.push(`${n}=${e}`)})),e.agents){const n=e.agents.join(",");t.push(`agents=${n}`)}return t.push(p),`${e.version}?${t.join("&")}`}(e),o=function(e){return{"X-ECS-Client-Last-Telemetry-Events":`ecs_client_library_name=${g},ecs_client_app_name=${e},ecs_client_version=${m}`}}(t);return{endpointUrl:`${i}${a}`,endpointModels:()=>({baseUrl:i,serviceName:t,models:{getConfigurationAsync:h(a,n,o,e.additionalHeaders)}})}}function y(e,t,n){return JSON.stringify({correlationId:e,serviceName:t,eTag:n,initialFetch:void 0===n})}const S=e=>async t=>{switch(e.debug(`Response headers: ${JSON.stringify(t.headers)}`),t.status){case d.nW.OK:{const n=await t.body.json(),i=t.headers.expires??n.Headers.Expires,a=t.headers.etag??n.Headers.ETag,o=n.Headers.CountryCode;return{requestStatus:r.x.Success,ecsConfiguration:n,headers:f(e,i,a,o)}}case d.nW.NOT_MODIFIED:case d.nW.CREATED:case d.nW.NO_CONTENT:return{requestStatus:r.x.Success_NoChanges,headers:f(e,t.headers.expires,t.headers.etag)};default:throw new Error(`Response status ${t.status} unexpectedly allowed`)}},f=(e,t,n,i)=>{let a=Date.parse(t);if(isNaN(a)){const e=t.match(/\d+/g);if(e&&1===e.length&&(a=Number.parseInt(t,10)),isNaN(a))throw new Error(`Invalid or missing expiration date: '${t}'`)}if(!n)throw new Error("Missing etag value");return i||e.warn("Missing country code"),{ETag:n,Expires:new Date(a),CountryCode:i}};class k extends c{constructor(e,t,n,i,a,r,s){super(e,n,t),this.ecsParameters=t,this.endpointsManager=i,this.fetchPrecheck=a,this.transformData=r,this.fetchMode=o.S.Manual,this.clientType="EcsClient";const{endpointUrl:l,endpointModels:c}=v(this.ecsParameters,this.serviceName,this.logger);this.fetchUrl=l,this.ecsApi=this.endpointsManager.createApi(c),s&&(this.data=s.data,this.cache=s.cache)}async fetch(){const e=void 0===this.eTag,t=(0,a.v4)();this.lastAttemptedFetch=new Date,this.logger.log(`Getting ECS configuration from ${this.fetchUrl}. correlationId=${t}, isInitialFetch=${e}`);const n=this.fetchPrecheck?.()||!0;if(!0!==n)return this.scheduleNextConfigurationFetch(),this.logger.debug(`${n.errorMessage}. correlationId=${t}`),{requestStatus:n.requestStatus};try{const n=await this.ecsApi.getConfigurationAsync(t,this.serviceName,this.eTag);this.logger.log(`ECS configuration fetch complete. status=${r.x[n.requestStatus]}, correlationId=${t}, isInitialFetch=${e}`),this.data=this.onSuccess(n,t),this.configIds=n.ecsConfiguration?.ConfigIDs,this.updateCache()}catch(e){return this.onError(e,t)}finally{this.scheduleNextConfigurationFetch()}return this.data}startFetchSchedule(e,t){this.host=e,this.callbackFunction=t,this.fetchMode=o.S.WhenExpired,this.logger.debug("Starting ECS configuration fetch schedule in WhenExpired mode."),this.scheduleNextConfigurationFetch()}updateParameters(e){const t=this.fetchUrl,{endpointUrl:n,endpointModels:i}=v(e,this.serviceName,this.logger);return this.fetchUrl=n,this.ecsApi=this.endpointsManager.createApi(i),this.ecsParameters=e,t!==this.fetchUrl}dispose(){this.fetchMode=o.S.Manual,this.clearConfigurationFetchSchedule()}getDiagnosticInfo(){return{serviceName:this.serviceName,configIds:this.configIds,ecsParameters:this.ecsParameters,etag:this.eTag,fetchUrl:this.fetchUrl,lastAttemptedFetch:this.lastAttemptedFetch,lastSuccessfulFetch:this.lastSuccessfulFetch,nextScheduledFetch:this.nextScheduledFetch,fetchMode:this.fetchMode,expirationTime:this.expiration}}get eTag(){return this.data?.headers?.ETag}async updateCache(){if(void 0===this.cache)return;const{storage:e}=this.cache,{configKey:t,metadataKey:n}=this.generateCacheKeys();if(!this.data?.ecsConfiguration||0===Object.keys(this.data.ecsConfiguration).length)return void this.logger.log(`updateCache() received empty data. Cache State: ${s.iF[this.cacheState]} (Storage key: ${t})`);const{ecsConfiguration:i,...a}=this.data;await e.setItem(t,JSON.stringify(i)),await e.setItem(n,JSON.stringify(a)),this.logger.log(`Cache '${t}' updated.`)}onSuccess(e,t){let n;switch(e.requestStatus){case r.x.Success:if(!e.ecsConfiguration)throw new Error("ECS configuration is unexpectedly undefined on a successful response");if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");if(!this.ecsParameters.disableSentinelConfigValidation&&!this.validateSentinelConfig(e.ecsConfiguration))throw new Error("Sentinel Config is missing from response");n=this.transformData?.(e)||e;break;case r.x.Success_NoChanges:if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");n={...this.data,requestStatus:e.requestStatus,headers:e.headers},this.data=n,this.updateCache(),this.logger.debug(`ECS configuration is unchanged. eTag=${this.eTag}, correlationId=${t}`);break;default:throw new Error(`Received unexpected request status of ${r.x[e.requestStatus]}`)}return this.lastSuccessfulFetch=this.lastAttemptedFetch,n}onError(e,t){const n=this.processErrorText(e,"unknown error");let a=r.x.Error_Unknown;switch(e.reason){case i.B.TimedOut:a=r.x.Error_TimedOut;break;case i.B.TransformFailed:a=r.x.Error_TransformFailed;break;default:a=e?.reason===i.B.RejectHttpError&&void 0===e?.serverResponse?.status?r.x.Error_BrowserError:r.x.Error_Unknown}return this.logger.error(`Fetching ECS configuration failed. error=${e}, innerExceptionMessage=${e.innerException?.message} correlationId=${t}`),{requestStatus:a,errorMessage:n}}processErrorText(e,t){let n=t;return e&&(n=Object.keys(e)?.length>0?JSON.stringify(e):e.message,e.innerException&&(n+=` innerExceptionMessage: ${e.innerException.message}`)),n}validateSentinelConfig(e){return e[l]?(this.logger.log("ECS Sentinel Config is present in ECS response at the root level"),!0):e.ECS?.[l]?(this.logger.log("ECS Sentinel Config is present in ECS response inside ECS object"),!0):(this.logger.error("ECS Sentinel Config is missing from ECS response"),!1)}clearConfigurationFetchSchedule(){this.setTimeoutHandle&&this.host&&(this.host.clearTimeout(this.setTimeoutHandle),this.setTimeoutHandle=void 0,this.logger.debug("Cleared existing queued configuration fetch"))}scheduleNextConfigurationFetch(){if(this.clearConfigurationFetchSchedule(),this.fetchMode===o.S.Manual)return void this.logger.debug("No need to queue configuration fetch in manual mode, ignoring...");if(!this.host)return void this.logger.error("No host provided, cannot schedule next configuration fetch");const e=this.calculateFetchInterval();this.setTimeoutHandle=this.host.setTimeout((async()=>{const e=await this.fetch();this.callbackFunction&&this.callbackFunction(e)}),e),this.nextScheduledFetch=new Date(Date.now()+e),this.logger.debug(`Next ECS configuration fetch will occur in ${e}ms at ${this.nextScheduledFetch}`)}calculateFetchInterval(){if(this.fetchMode===o.S.Manual)throw new Error(`Calculating fetch interval is not supported when using ${o.S[this.fetchMode]} fetch mode.`);const e=(this.expiration??new Date).valueOf()-Date.now();return e<k.MinimumRefreshIntervalInMilliseconds?(this.logger.warn(`Calculated refresh interval of ${e}ms based on expires header was below the allowed minimum of ${k.MinimumRefreshIntervalInMilliseconds}ms. Minimum value will be used instead.`),k.MinimumRefreshIntervalInMilliseconds):e}}k.MinimumRefreshIntervalInMilliseconds=18e5;class C extends c{constructor(){super(...arguments),this.clientType="LocalEcsClient"}createClient({ecsParameters:e,endpointsManager:t,loggerFactory:n,fetchPrecheck:i,transformData:a}){const o={data:this.data,cache:this.cache};return new k(this.serviceName,e,n,t,i,a,o)}}async function b({serviceName:e,cacheOptions:t,loggerFactory:n}){const i=new C(e,n);return await i.initializeCache(t),i}function w({serviceName:e,ecsParameters:t,loggerFactory:n,endpointsManager:i,fetchPrecheck:a,transformData:o}){return new k(e,t,n,i,a,o)}async function T({serviceName:e,ecsParameters:t,cacheOptions:n,loggerFactory:i,endpointsManager:a,fetchPrecheck:o,transformData:r}){const s=new k(e,t,i,a,o,r);return await s.initializeCache(n),s}},425415:(e,t,n)=>{"use strict";n.d(t,{A$:()=>i,bf:()=>a,bI:()=>o});const i="most-recent",a="first",o="last"},955626:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{Ll:()=>i,sS:()=>a,b4:()=>o}),function(e){e.NotInstalled="NotInstalled",e.InstalledNotActive="InstalledNotActive",e.InstalledActive="InstalledActive"}(i||(i={})),function(e){e.Teams1="Teams1",e.Teams2="Teams2"}(a||(a={})),function(e){e.DownloadedAndInstalled="DownloadedAndInstalled",e.FailedToDownload="FailedToDownload",e.FailedToInstall="FailedToInstall",e.DownloadPageOpened="DownloadPageOpened"}(o||(o={}))},523661:(e,t,n)=>{"use strict";var i,a,o,r,s,l,c,d,u,m;n.d(t,{V6:()=>i,w$:()=>a,t8:()=>o,qj:()=>r,x2:()=>s,NV:()=>l,Am:()=>d}),function(e){e.toastFromWeb="toastFromWeb",e.toastFromHost="toastFromHost"}(i||(i={})),function(e){e.calls="calls",e.chats="chats",e.toasts="toasts",e.signout="signout",e.extensions="extensions",e.reminders="reminders",e.channels="channels",e.activity="activity",e.campaignnotifications="campaignnotifications",e.communities="communities",e.callingdeeplink="callingdeeplink",e.communitiesevents="communitiesevents",e.settingsstore="settingsstore",e.communitiesjoinrequest="communitiesjoinrequest",e.communitiesmembers="communitiesmembers",e.alerts="alerts",e.notificationsdeeplink="notificationsdeeplink",e.files="files"}(a||(a={})),function(e){e.hide="hide",e.show="show"}(o||(o={})),function(e){e.mutate="mutate",e.view="view",e.list="list",e.join="join"}(r||(r={})),function(e){e.success="success",e.critical="critical"}(s||(s={})),function(e){e.start="start",e.quit="quit",e.restart="restart"}(l||(l={})),function(e){e.airgap08="airgap08",e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap09="airgap09"}(c||(c={})),function(e){e.available="available",e.busy="busy",e.doNotDisturb="doNotDisturb",e.beRightBack="beRightBack",e.away="away",e.offLine="offLine",e.resetAvailability="resetAvailability"}(d||(d={})),function(e){e.Accepted="Accepted",e.Tentative="Tentative",e.Declined="Declined",e.NotResponded="NotResponded"}(u||(u={})),function(e){e.inProc="inProc",e.outOfProc="outOfProc"}(m||(m={}))},736820:(e,t,n)=>{"use strict";var i,a;n.d(t,{Q:()=>i,S:()=>a}),function(e){e.ok="ok",e.error="error"}(i||(i={})),function(e){e.debugPii="debugPii",e.debug="debug",e.info="info",e.warning="warning",e.error="error"}(a||(a={}))},466193:(e,t,n)=>{"use strict";var i,a,o,r,s,l;n.d(t,{Ph:()=>i,SV:()=>a}),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Unknown="Unknown",e.Resumed="Resumed",e.Suspending="Suspending"}(i||(i={})),function(e){e.Light="Light",e.Dark="Dark",e.Contrast="Contrast",e.OSTheme="OSTheme"}(a||(a={})),function(e){e.Unknown="Unknown",e.Crashed="Crashed",e.LaunchFailed="LaunchFailed",e.OutOfMemory="OutOfMemory",e.Terminated="Terminated",e.Unexpected="Unexpected",e.Unresponsive="Unresponsive"}(o||(o={})),function(e){e.Unknown="Unknown",e.BrowserProcessExited="BrowserProcessExited",e.FrameRenderProcessExited="FrameRenderProcessExited",e.GpuProcessExited="GpuProcessExited",e.MainWindow="MainWindow",e.PpapiPluginProcessExited="PpapiPluginProcessExited",e.PpapiBrokerProcessExited="PpapiBrokerProcessExited",e.RenderProcessExited="RenderProcessExited",e.RenderProcessUnresponsive="RenderProcessUnresponsive",e.SandboxHelperProcessExited="SandboxHelperProcessExited",e.UtilityProcessExited="UtilityProcessExited"}(r||(r={})),function(e){e.Internal="Internal",e.Clone="Clone",e.Extend="Extend",e.External="External"}(s||(s={})),function(e){e.None="None",e.ConstrainedInternetAccess="ConstrainedInternetAccess",e.InternetAccess="InternetAccess"}(l||(l={}))},729720:(e,t,n)=>{"use strict";var i,a;n.d(t,{r:()=>i,C:()=>a}),function(e){e.activity="activity",e.alarm="alarm",e.alert="alert",e.attention="attention",e.busy="busy",e.error="error",e.oofDoNotDisturb="oofDoNotDisturb",e.oofAvailable="oofAvailable",e.oofAway="oofAway",e.oofBusy="oofBusy",e.oofOffline="oofOffline",e.oofUnknown="oofUnknown",e.available="available",e.away="away",e.doNotDisturb="doNotDisturb",e.offline="offline",e.unknown="unknown"}(i||(i={})),function(e){e.PinningNotSupported="PinningNotSupported",e.TeamsConsumerAppNotPinned="TeamsConsumerAppNotPinned",e.TeamsForWorkAppPinned="TeamsForWorkAppPinned",e.PinningAllowedAndSupported="PinningAllowedAndSupported",e.TeamsForLifeTrampoline="TeamsForLifeTrampoline"}(a||(a={}))},679406:(e,t,n)=>{"use strict";var i,a,o,r,s,l;n.d(t,{Br:()=>i,BY:()=>o,qu:()=>r}),function(e){e.DisabledByGroupPolicy="DisabledByGroupPolicy",e.DisabledByManifest="DisabledByManifest",e.DisabledForApplication="DisabledForApplication",e.DisabledForUser="DisabledForUser",e.Enabled="Enabled"}(i||(i={})),function(e){e[e.BR=0]="BR",e[e.BL=1]="BL",e[e.TL=2]="TL",e[e.TR=3]="TR"}(a||(a={})),function(e){e.AlarmsOnly="AlarmsOnly",e.Off="Off",e.PriorityOnly="PriorityOnly"}(o||(o={})),function(e){e.Unrestricted="Unrestricted",e.PriorityOnly="PriorityOnly",e.AlarmsOnly="AlarmsOnly"}(r||(r={})),function(e){e.UserCancelled="UserCancelled",e.ApplicationHidden="ApplicationHidden",e.TimedOut="TimedOut",e.FocusAssist="FocusAssist"}(s||(s={})),function(e){e.Unknown="Unknown",e.NotificationDisabled="NotificationDisabled",e.NotificationTypeDisabled="NotificationTypeDisabled"}(l||(l={}))},203564:(e,t,n)=>{"use strict";var i,a;n.d(t,{e:()=>i,K:()=>a}),function(e){e.PresenceUnknown="PresenceUnknown",e.Available="Available",e.AvailableIdle="AvailableIdle",e.Away="Away",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.BeRightBack="BeRightBack",e.Offline="Offline"}(i||(i={})),function(e){e.call="call",e.mention="mention",e.chat="chat",e.channel="channel",e.other="other"}(a||(a={}))},901208:(e,t,n)=>{"use strict";var i,a,o,r,s,l,c;n.d(t,{ng:()=>i,PC:()=>a,gt:()=>l}),function(e){e.None="None",e.Core="Core",e.MeetNow="MeetNow",e.Loading="Loading",e.Main="Main",e.Mini="Mini",e.ChatPopout="ChatPopout",e.Meeting="Meeting",e.Presenter="Presenter"}(i||(i={})),function(e){e.ButtonsOnly="ButtonsOnly",e.FullWidth="FullWidth"}(a||(a={})),function(e){e.TopLeft="TopLeft",e.TopRight="TopRight",e.BottomLeft="BottomLeft",e.BottomRight="BottomRight"}(o||(o={})),function(e){e.Hidden="Hidden",e.Visible="Visible",e.Disabled="Disabled"}(r||(r={})),function(e){e.Rectangle="Rectangle"}(s||(s={})),function(e){e.Meeting="Meeting",e.Send="Send"}(l||(l={})),function(e){e.Leave="Leave",e.Stay="Stay"}(c||(c={}))},881035:(e,t,n)=>{"use strict";var i;n.d(t,{N:()=>i}),function(e){e.None="none",e.DayStart="dayStart",e.MeetingPrep="meetingPrep",e.MeetingStart="meetingStart",e.MeetingStarted="meetingStarted",e.MeetingEnd="meetingEnd",e.Feedback="feedback",e.InMeetingActionStatusUpdated="inMeetingActionStatusUpdated",e.InMeetingGreeting="inMeetingGreeting",e.InMeetingShareFile="inMeetingShareFile",e.RunningLate="inMeetingRunningLate",e.ReportUsage="reportUsage"}(i||(i={}))},750400:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});class i{constructor(){}static getInstance(){return this.platformAppConversationService||(this.platformAppConversationService=new i),this.platformAppConversationService}setSubEntityDeepLinkInfo(e){this.deepLink=e}getSubEntityDeepLinkInfo(){return this.deepLink}setClientMessageId(e){this.clientMessageId=e}getClientMessageId(){return this.clientMessageId}}},251361:(e,t,n)=>{"use strict";n.d(t,{vh:()=>o,iU:()=>r,xt:()=>s,ZK:()=>l,Ob:()=>c,OF:()=>d,Us:()=>u,rp:()=>m,Dq:()=>p});var i=n(754255),a=n(397867);const o=e=>"string"==typeof e&&a.kK.indexOf(e)>-1,r=e=>e&&0!==e.length?e[0].toLowerCase()+e.substring(1):e,s=()=>{const e={};return a.tM.forEach((t=>{const n=t.split("-");2===n.length&&(e[n[1]]=n[0])})),e},l=()=>{const e={};return a.tM.forEach((t=>{const n=t.split("-");2===n.length&&(e[n[0]]=n[1])})),e},c=e=>{const t=[],n=[],i=Array.from(a.kx).concat(Array.from(a.f7)),o=new Set(i??[]);return e.forEach((e=>{o.has(e)?n.push(e):t.push(e)})),{policiesNamespaces:t,settingsNamespaces:n}},d=e=>{if(!e)return e;const t=l();Object.keys(t).forEach((n=>{const i=t[n];e[n]&&!e[i]&&(e[i]=e[n]),e[i]&&!e[n]&&(e[n]=e[i])}));const n={};u().forEach((t=>{e[t]&&(n[t]=e[t])}));const i={...e.policySettings,...n};return Object.keys(i).length>0&&(e.policySettings=i),e},u=()=>["byot","callingLineIdentityPolicy","clientPolicy","dialPlanPolicy","locationPolicy","teamsInteropPolicy","teamsMeetingPolicy","voicePolicy"],m=(e,t,n)=>{if("userPropertiesSettings"===e){const i=t,a=i?.isOnCloud?["rest","substrate"]:["ews"];for(const t of a)if("TaskTimedOut"===i?.autodiscoverSettings?.[t]?.mailboxDiscoverabilityError?.errorCode){n[e]="TaskTimedOut";break}}},p=(e,t)=>{const n=e("policies"),a=n.namespaces??[],o=t.get(i.w.Core,["unsupportedPoliciesNamespaces"]).unsupportedPoliciesNamespaces??[],r=n.controllingFeatureFlags??{};return Object.keys(r).forEach((e=>{const n=r[e];t.get(n.category)[n.flagName]||o.push(e)})),0===o.length?a:a.filter((e=>!o.includes(e)))}},397867:(e,t,n)=>{"use strict";n.d(t,{kx:()=>i,f7:()=>a,fs:()=>o,tM:()=>r,kK:()=>s});const i=["adminSettings","clientSettings","deviceStoreMetadata","educationSettings","organizationSettings","smbTenantSettings","tenantProperties","tenantSettingsV2","tenantSiteUrl","tenantSiteUrlAndDomains","tenantVoiceSettings","userPropertiesSettings","userResourcesSettings","voiceAdminSettings","teamsMessagingConfiguration","teamsLinkPolicy","teamsUserPhoneNumbers","userLanguageAccountSettings","teamsOfficeCloudPolicy"],a=["ageConsentPolicy"],o=["branchSurvivabilityPolicy","broadcastMeetingPolicy","callingLineIdentityPolicy","callingPolicy","callParkPolicy","dialPlanPolicy","educationAssignmentsAppPolicy","feedbackPolicy","filesPolicy","meetingPolicy","messagingPolicy","policySettings","shiftsPolicy","syntheticAutomatedCallPolicy","targetingPolicy","teamsAndChannelsPolicy","updateManagementPolicy","upgradePolicy","vdiPolicy","voicemailPolicy","byot","callingLineIdentity","clientPolicy","externalAccessPolicy","locationPolicy","onlineDialinConferencingPolicy","onlineVoicemailPolicy","onlineVoiceRoutingPolicy","teamsAppPermissionPolicy","teamsAppSetupPolicy","teamsBranchSurvivabilityPolicy","teamsCallingPolicy","teamsCallParkPolicy","teamsChannelsPolicy","teamsEducationAssignmentsAppPolicy","teamsEmergencyCallingPolicy","teamsEmergencyCallRoutingPolicy","teamsEnhancedEncryptionPolicy","teamsEventsPolicy","teamsFeedbackPolicy","teamsFilesPolicy","teamsInteropPolicy","teamsMediaConnectivityPolicy","teamsMediaLoggingPolicy","teamsMeetingBrandingPolicy","teamsMeetingBroadcastPolicy","teamsMeetingPolicy","teamsMessagingPolicy","teamsRoomVideoTeleConferencingPolicy","teamsShiftsPolicy","teamsSyntheticAutomatedCallPolicy","teamsTargetingPolicy","teamsUpdateManagementPolicy","teamsUpgradePolicy","teamsVdiPolicy","teamsVirtualAppointmentsPolicy","teamsVoiceApplicationsPolicy","teamsWorkLocationDetectionPolicy","tenantDialPlan","voicePolicy"],r=["callingLineIdentity-callingLineIdentityPolicy","onlineVoicemailPolicy-voicemailPolicy","teamsBranchSurvivabilityPolicy-branchSurvivabilityPolicy","teamsCallingPolicy-callingPolicy","teamsCallParkPolicy-callParkPolicy","teamsChannelsPolicy-teamsAndChannelsPolicy","teamsEducationAssignmentsAppPolicy-educationAssignmentsAppPolicy","teamsFeedbackPolicy-feedbackPolicy","teamsFilesPolicy-filesPolicy","teamsMeetingBroadcastPolicy-broadcastMeetingPolicy","teamsMeetingPolicy-meetingPolicy","teamsMessagingPolicy-messagingPolicy","teamsShiftsPolicy-shiftsPolicy","teamsSyntheticAutomatedCallPolicy-syntheticAutomatedCallPolicy","teamsTargetingPolicy-targetingPolicy","teamsUpdateManagementPolicy-updateManagementPolicy","teamsUpgradePolicy-upgradePolicy","teamsVdiPolicy-vdiPolicy","tenantDialPlan-dialPlanPolicy"],s=Array.from(i).concat(Array.from(a)).concat(Array.from(o))},162952:(e,t,n)=>{"use strict";n.d(t,{a:()=>o,F:()=>s});var i=n(754255);const a="MicrosoftTeams",o=e=>{const t=e.event.data?.();if(t){const n=r(e),i=t.telemetryItem;return{...i,data:{...i.data,...n}}}return null},r=({coreSettings:e,sessionStartGesture:t,client:n})=>{const{clientVersion:o}=e.get(i.w.Platform),{ring:r,environment:s}=e.get(i.w.Metadata),{clientType:l}=e.get(i.w.People),c=l||a,d=n?.ctx?.authenticationUser?.profile;return{hostApp:l||a,hostAppRing:r?.id||"",hostAppVersion:o??"",complianceEnvironment:s??"",sessionStartGesture:t,clientType:c,userId:d?.objectId??"",tenantId:d?.tenantId??"",puid:d?.puid??""}},s=e=>{const{environment:t}=e.get(i.w.Metadata);switch(t?.toLowerCase()){case"life":case"prod":return"Prod";case"gcc":return"GccModerate";case"gcchigh":return"GccHigh";case"dod":return"DoD";case"gallatin":return"Gallatin";case"ag08":return"AG08";case"ag09":return"AG09";default:return null}}},465742:(e,t,n)=>{"use strict";n.d(t,{r:()=>o});var i=n(657120),a=n(162952);class o{static associateIngestionKeyWithAppName(e,t,n){o.ingestionKeys.set(t,e),n&&o.middlewaresMap.set(t,n),(0,i.AR)().initializeSecondPartyLogger(t,e)}static associateIngestionKeyWithAppNameIfNecessary(e,t,n){o.isAssociated(t)||o.associateIngestionKeyWithAppName(e,t,n)}static isAssociated(e){return o.ingestionKeys.has(e)}static logEvent(e){const t=e.event.data?.().appName,n=(0,a.a)(e);if(t&&n){const e=o.executeMiddleware(t,n);(0,i.AR)().logSecondPartyEvent(t,e)}}static executeMiddleware(e,t){const n=o.middlewaresMap.get(e);return n?n.reduce(((e,t)=>t(e)),t):t}}o.ingestionKeys=new Map,o.middlewaresMap=new Map},438430:(e,t,n)=>{"use strict";n.d(t,{hL:()=>i,lE:()=>a,cd:()=>o});const i={EmptyEvent:"EmptyEvent",NotEnabled:"NotEnabled",RequiredFieldMissing:"RequiredFieldMissing",SubscriptionFailed:"SubscriptionFailed",MethodNotAvailable:"showBadge not available on taskbar module.",ModuleUnableToLoad:"HostComms is unable to load taskbar module. We are running on Web or Teams 1.0. Bailing out."},a={ModuleLoaded:"HostComms has loaded taskbar module. Setting badge.",UpdatedEvent:"Updated Taskbar Badge Count:"},o="TaskbarService"},537400:(e,t,n)=>{"use strict";n.d(t,{C:()=>o});var i=n(754255),a=n(438430);class o{constructor(e,t,n){this.coreSettings=t,this.hostCommunicationService=n,this.getBadge=e=>({icon:{countBadge:{value:e}}}),this.logger=e.newLogger(a.cd,"services-io-taskbar")}async showBadge(e){if(!this.enableTaskbarBadgeMaglev)return void this.logger.log(a.hL.NotEnabled);const t=await this.hostCommunicationService.loadModule("taskbar");if(t){if(t.showBadge)return this.logger.log(`${a.lE.ModuleLoaded} with count badge: ${e.icon?.countBadge?.value}`),t.showBadge(e);this.logger.log(a.hL.MethodNotAvailable)}else this.logger.error(a.hL.ModuleUnableToLoad)}async showBadgeCount(e){return this.showBadge(this.getBadge(e))}async resetBadge(){return this.showBadgeCount(0)}get enableTaskbarBadgeMaglev(){return!!this.coreSettings.get(i.w.Core).enableTaskbarBadgeMaglev}}},83930:(e,t,n)=>{"use strict";n.d(t,{Y:()=>r});const i="ModuleLoaded",a="Focus Assist not available on module.",o="HostComms is unable to load toast toasts module. Bailing out.";class r{constructor(e,t){this.hostCommunicationService=t,this.logger=e.newLogger("ToastSettingsService","services-io-toast-settings")}async getFocusAssistStateAsync(){const e=await this.hostCommunicationService.loadModule("toasts");if(e){if(e.getFocusAssistStateAsync)return this.logger.log(i),e.getFocusAssistStateAsync();this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice")}else this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async getGlobalNotificationSettingsAsync(e){const t=await this.hostCommunicationService.loadModule("toasts");if(t){if(t.getGlobalNotificationSettingsAsync)return this.logger.log(i),e?t.getGlobalNotificationSettingsAsync(e):t.getGlobalNotificationSettingsAsync();this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice")}else this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async registerForToastDismissed(e){const t=await this.hostCommunicationService.loadModule("toasts");t?t.registerForToastDismissed?t.registerForToastDismissed(e):this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice"):this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async registerForNotificationModeChanged(e){const t=await this.hostCommunicationService.loadModule("toasts");t?t.registerForNotificationModeChanged?t.registerForNotificationModeChanged(e):this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice"):this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async registerForFocusSessionChanged(e){const t=await this.hostCommunicationService.loadModule("toasts");t?t.registerForFocusSessionChanged?t.registerForFocusSessionChanged(e):this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice"):this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}}},49350:(e,t,n)=>{"use strict";var i,a;n.d(t,{fT:()=>o,nO:()=>r,yq:()=>s}),function(e){e.Default="Default",e.Vibe="Vibe",e.Nudge="Nudge",e.Tap="Tap",e.Flick="Flick",e.Pluck="Pluck",e.Summon="Summon",e.Ping="Ping"}(i||(i={})),function(e){e.Default="DefaultUrgent",e.Prioritize="Prioritize",e.Escalate="Escalate",e.Alarm="Alarm"}(a||(a={}));const o=[i.Default,i.Vibe,i.Nudge,i.Tap,i.Flick,i.Pluck,i.Summon,i.Ping],r=[a.Default,a.Prioritize,a.Escalate,a.Alarm],s=e=>{const t=l[e];return t||{soundFile:"00_teams_basic_notification_r4_default",labelKey:"notification_sound_type_default"}},l={[i.Default]:{soundFile:"00_teams_basic_notification_r4_default",labelKey:"notification_sound_type_default"},[i.Vibe]:{soundFile:"a2_teams_basic_notification_r4_vibe",labelKey:"notification_sound_type_vibe"},[i.Nudge]:{soundFile:"a3_teams_basic_notification_r4_nudge",labelKey:"notification_sound_type_nudge"},[i.Tap]:{soundFile:"a4_teams_basic_notification_r4_tap",labelKey:"notification_sound_type_tap"},[i.Flick]:{soundFile:"a5_teams_basic_notification_r4_flick",labelKey:"notification_sound_type_flick"},[i.Pluck]:{soundFile:"a6_teams_basic_notification_r4_pluck",labelKey:"notification_sound_type_pluck"},[i.Summon]:{soundFile:"a7_teams_basic_notification_r4_summon",labelKey:"notification_sound_type_summon"},[i.Ping]:{soundFile:"a8_teams_basic_notification_r4_ping",labelKey:"notification_sound_type_ping"},[a.Default]:{soundFile:"00_teams_basic_notification_r4_default",labelKey:"notification_sound_type_default"},[a.Prioritize]:{soundFile:"b2_teams_urgent_notification_r4_prioritize",labelKey:"notification_sound_type_prioritize"},[a.Escalate]:{soundFile:"b3_teams_urgent_notification_r4_escalate",labelKey:"notification_sound_type_escalate"},[a.Alarm]:{soundFile:"b4_teams_urgent_notification_r4_alarm",labelKey:"notification_sound_type_alarm"}}},820472:(e,t,n)=>{"use strict";n.d(t,{Uc:()=>o});var i=n(779898);const a="web_app_switcher_opt_out_redirection_fail";class o{constructor(e,t,n){this.localStorage=e,this.crossTabsService=n,this.logger=t.newLogger("WebAppSwitcherService","services-io-web-app-switcher"),this.logger.log("WebAppSwitcherService initialized")}optOutOfT2Web(e,t,n){this.crossTabsService?(this.logger.warnNoPii?.("Opting user out of T2",e),this.doRedirection(!0,!0,!0,e,t,n)):this.logger.errorToTelemetry?.("Cross tabs service is undefined",a,{commandSource:e},!0)}redirectThisTabToT1(e){this.doRedirection(!1,!1,!1,e)}doRedirection(e,t,n,o,r,s){let l;try{l=this.getT1Url(r)}catch(e){return void this.logger.errorToTelemetry?.("Failed to get T1 url",a,{commandSource:o},!0)}t&&!this.changeOptInFlag(o,s)||(e&&this.crossTabsService?.postMessage("T2WebOptOut"),this.logger.warnToTelemetry?.("Redirecting to T1 web","web_app_switcher_opt_out_redirection_success",{commandSource:o},!0),n&&this.localStorage.trySet("lastT2WebOptOutInfo",JSON.stringify({source:o??"Unknown",timestamp:Date.now()}),"Framework","Global"),(0,i.z)().location.replace(l))}changeOptInFlag(e,t="OptOut"){return this.localStorage.trySet("isOptedIntoT2Web",t,"Framework","Global")?(this.localStorage.remove("forceT2Only","Global"),this.logger.warnNoPii?.(`isOptedIntoT2Web flag successfully modified to ${t}`,e),!0):(this.logger.errorToTelemetry?.("Failed to update opt-in flag value",a,{commandSource:e},!0),!1)}getT1Url(e){const t=(0,i.z)(),n=new URL(t.location.href);if(n.pathname="/",e){const t=new URL(e),i=t.pathname+t.search+t.hash;n.hash=i}return n.searchParams.set("clientexperience","t1"),n.href}}},446372:(e,t,n)=>{"use strict";n.d(t,{Oh:()=>r,ny:()=>s,AE:()=>l,uY:()=>c,e:()=>d,nS:()=>u,Wj:()=>m,j8:()=>p,Ck:()=>h,tf:()=>v,mY:()=>y,ad:()=>S,Ww:()=>C,NJ:()=>T,oG:()=>I,m:()=>N,uZ:()=>A,Ec:()=>E,Tu:()=>F});var i=n(784728),a=n(634664),o=n(368848);const r="=====",s="Core",l="Logs",c="Core",d=(e,t)=>{const n="function"==typeof e.timeStamp.getTime?e.timeStamp:new Date(e.timeStamp),i="function"==typeof t.timeStamp.getTime?t.timeStamp:new Date(t.timeStamp);return n.getTime()-i.getTime()},u=e=>{if(!e||0===e.length)return"";let t="";return e.forEach((e=>{if(e)if(e.message?.startsWith(r)&&e.message?.endsWith(r))t+=`\n${e.message}\r\n`;else{const n="function"==typeof e.timeStamp?.toISOString?e.timeStamp.toISOString():e.timeStamp,i="string"==typeof e.levelName?e.levelName.substring(0,3):"unknownLevelName";t+=`${n} ${i}\t${e.message}\r\n`}})),(0,a.Gu)(t)},m=(e,t,n,i,a=!1)=>{if(!e)return;let r=JSON.stringify(void 0===i?t:{sessionId:i,logsArray:t});a&&(r=(0,o.gzip)(r,{to:"string"})),e.setItem(n,r)},p=(e,t,n,i)=>{if(!t)return;const a=t.getItem(n);if(a){const t=JSON.parse(a);if(Array.isArray(t)&&t.length>0){const n=t.map((e=>g(e))).sort(((e,t)=>e.timeStamp.getTime()-t.timeStamp.getTime()));e.addEvents(n)}}i&&t.removeItem(n)};function g(e){const t={message:`DiagnosticsService - Converting event from localStorage failed - ${e}`,isPiiFree:!0,level:i.$.Error,levelName:"error",timeStamp:new Date};try{const n=e;if("timeStamp"in n){if("string"==typeof n.timeStamp){if(isNaN(Date.parse(n.timeStamp)))return t;n.timeStamp=new Date(n.timeStamp)}return n}}catch{}return t}const h=(e,t,n,o,r)=>{n.length>512&&(n=n.substring(0,512)+"...");const s={message:n=(0,a.Gu)(n),level:t,levelName:i.$[t],timeStamp:r||new Date,isPiiFree:o};return e.addEvent(s),s},v=e=>e?.length?e.filter((e=>e.isPiiFree)):e,y=(e,t,n)=>{let i="";try{const a=S(e,t,!1);a&&a.logsArray.length>0&&(n&&(a.logsArray=v(a.logsArray)),i=u(a.logsArray))}catch{i="Previous session logs parsing failed"}return i},S=(e,t,n)=>{let i=e?.getItem(t);if(i)try{if("{"!==i.charAt(0)&&"["!==i.charAt(0))try{i=(0,o.ungzip)(i,{to:"string"})}catch{}const a=JSON.parse(i);if(i=null,a)return n&&e.removeItem(t),"logsArray"in a?{sessionId:a.sessionId,logsArray:a.logsArray.map((e=>g(e)))}:{sessionId:"",logsArray:a}}catch{}},f="tmp.previousSessionLogs",k="tmp.previousSessionErrorLogs",C=(e,t=!1)=>`${t?k:f}${e?`-${e}`:""}`,b="persistedDiagnostics",w="persistedErrorDiagnostics",T=(e,t=!1)=>`${t?w:b}${e?`-${e}`:""}`,I=(e,t,n,o)=>{const r=e.getBufferedEvents();if(r&&r.length>0){const s={message:`DiagnosticsService: The following logs were persisted from a previous session ${o}`,isPiiFree:!0,level:i.$.Info,levelName:"info",timeStamp:new Date};((e,t,n)=>{e&&e.setItem(t,(0,a.hR)(n))})(t,n,[{message:`DiagnosticsService: The above logs were persisted from a previous session ${o}`,isPiiFree:!0,level:i.$.Info,levelName:"info",timeStamp:r[0].timeStamp},...r,s]),e.addEvent({message:`DiagnosticsService: Persisting diagnostic events for next load. Key: ${n}`,isPiiFree:!0,level:i.$.Warn,levelName:"warn",timeStamp:new Date})}},N=(e,t)=>{try{const n=new Set([C(void 0,!0),C(void 0,!1)].concat(t.map((e=>C(e,!0))),t.map((e=>C(e,!1)))));Object.keys(e).filter((e=>(e.startsWith(f)||e.startsWith(k))&&!n.has(e))).forEach((t=>e.removeItem(t)))}catch{}},A=e=>{try{Object.keys(e).filter((e=>e.startsWith(b)||e.startsWith(w))).forEach((t=>e.removeItem(t)))}catch{}},E=(e,t)=>{try{const n=C(t,!1);e.removeItem(n);const i=C(t,!0);e.removeItem(i)}catch{}},F=e=>{try{const t="previousLoaderDiagnostics";Object.keys(e.localStorage).filter((e=>e.startsWith(f)||e.startsWith(k)||e.indexOf(t)>=0)).forEach((t=>e.localStorage.removeItem(t)))}catch{}}},635439:(e,t,n)=>{"use strict";n.d(t,{T:()=>o,e:()=>r});var i=n(482252),a=n(792767);const o=(e,t,n)=>o=>{const{discover:r,authenticationResources:l,platformService:c,config:d}=o,u=(0,a.B)(c,d),{headers:m,...p}=t,g={...u,...m};return{baseUrlPromise:()=>r.regionGtm("middleTier"),serviceName:e,authResource:l.mtAuthResource,models:n((e=>{const t=Promise.resolve({constructRequest:(0,i.E)(e,g),...p});return s(t)}))}},r=(e,t,n)=>a=>{const o=e((0,i.E)(a,t),n);return s(o)},s=e=>{const t=Object.assign(e,{allow:n=>(e.then((e=>e.allowedResponses=n)),t),withCustomTelemetry:n=>(e.then((e=>e.customTelemetry=n)),t),withRetry:n=>(e.then((e=>e.retryPolicy=n)),t),withResponse:n=>(e.then((e=>e.responseType=n)),t),withTransform:n=>(e.then((e=>e.transformResponse=n)),t)});return t}},910857:(e,t,n)=>{"use strict";function i(e,t,n){const i=new Error(e);return Object.assign(i,{reason:e,serverResponse:t,innerException:n})}n.d(t,{$:()=>i})},482252:(e,t,n)=>{"use strict";function i(e,t){return t?(...n)=>{const i=e(...n);return{...i,headers:{...t,...i.headers}}}:e}n.d(t,{E:()=>i})},977190:(e,t,n)=>{"use strict";var i;n.d(t,{M:()=>i}),function(e){e.channel="channel",e.chat="chat",e.communities="communities",e.communitiesJoinInviteView="communitiesJoinInviteView",e.communitiesJoinRequestsView="communitiesJoinRequestsView",e.communitiesMembersView="communitiesMembersView",e.communitiesCalendarEvent="communitiesCalendarEvent",e.syntheticNotificationCampaign="syntheticNotificationCampaign",e.joinInviteActivity="joinInviteActivity",e.teamPendingJoinRequest="teamPendingJoinRequest",e.manageTeamChannels="manageTeamChannels",e.manageChannelMembers="manageChannelMembers",e.msGraph="msGraph",e.calls="calls",e.communitiesL1View="communitiesL1View",e.onboardedToTeam="onboardedToTeam",e.generic="generic"}(i||(i={}))},289362:(e,t,n)=>{"use strict";n.d(t,{No:()=>r,GQ:()=>s,k5:()=>l,zH:()=>c,aA:()=>d,nd:()=>u,f4:()=>m});var i=n(369664),a=n(554186),o=n(839623);const r=(e,t,n)=>{const i=[];let a="",o="",r=!1;return t.forEach((t=>{const s=t?.type||"";for(const e of n||[])if(e.enabled){if(e.fileType?.includes(s)){a=e.appType,o=e.appId,r=!0;break}e.fileType?.includes("all")&&(r=!0)}if(r){const n=((e,t,n,i)=>({location:e.objectUrl||"",type:"MeetingChat",subType:n,metadata:{appTitle:n,appId:i,userId:t,fileTitle:e.title||"",imageUrl:e.previewUrl||"",shareUrl:e.shareUrl||"",fileId:e.id,fileType:e.type||"",baseUrl:e.baseUrl||"",siteId:e.sharepointIds?.siteId||void 0,listItemUniqueId:e.sharepointIds?.listItemUniqueId||void 0}}))(t,e,a,o);i.push(n),a="",o="",r=!1}})),i},s=(e,t,n,i)=>({meetingUrl:n??"https://teams.microsoft.com",threadId:e,messageId:i,organizerUpn:t}),l=(e,t)=>{const n=t.newScenario(e);let o=n.id;return(0,i.a)(o)||(o=(0,a.v4)()),n.appendEventData({correlationId:o}),{scenario:n,correlationId:o}};function c(e,t){const n={message:e.reason?.[o.bf.logErrorMessage],statusCode:e.reason?.[o.bf.httpStatusCode],errorCode:e.reason?.[o.bf.internalErrorCode],subError:e.reason?.[o.bf.subError],correlationId:e.reason?.[o.bf.correlationId],cmdRequestId:e.reason?.[o.bf.cmdRequestId],reportingService:e.reason?.[o.bf.reportingService]};t.fail(n)}const d=(e,t)=>((e,t)=>{let n={};e.state&&(n={...n,state:e.state});e.isShared&&(n={...n,isShared:e.isShared});e.linkScope&&(n={...n,linkScope:e.linkScope});e.hostClient&&(n={...n,hostClient:e.hostClient});e.appId&&(n={...n,appId:e.appId});e.appTitle&&(n={...n,appTitle:e.appTitle});e.fileTitle&&(n={...n,fileTitle:e.fileTitle});e.imageUrl&&(n={...n,imageUrl:e.imageUrl});e.userId&&(n={...n,userId:e.userId});e.shareUrl&&(n={...n,shareUrl:e.shareUrl});e.fileId&&(n={...n,fileId:e.fileId});e.fileType&&(n={...n,fileType:e.fileType});e.baseUrl&&(n={...n,baseUrl:e.baseUrl});e.objectUrl&&(n={...n,objectUrl:e.objectUrl});e.meetingContentMetadataObject&&(n={...n,meetingContentMetadataObject:e.meetingContentMetadataObject});e.thumbnailUrl&&(n={...n,thumbnailUrl:e.thumbnailUrl});t&&e.siteId&&(n={...n,siteId:e.siteId});t&&e.listItemUniqueId&&(n={...n,listItemUniqueId:e.listItemUniqueId});return n})(e,t),u=(e,t)=>e.map((e=>((e,t)=>{const n=e.metadata??{};return{id:e.id,location:e.location,type:e.type,subType:n.appTitle??"",metadata:d(n,t)}})(e,t)));function m(e,t,n,i,a,o,r,s,l){return{externalEntityKey:e,seriesExternalEntityKey:t,organizer:n,user:i,meetingUrl:a.meetingUrl,threadId:a.threadId,messageId:a.messageId,organizerUpn:a.organizerUpn,resources:u(o,l),organizedByUserId:r,organizedByUserUpn:s}}},421933:(e,t,n)=>{"use strict";n.d(t,{m:()=>i,w:()=>a});const i="beta/atpsafelinks/getpolicy/",a="atp-safelinks-policy"},726131:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var i=n(702183),a=n(92118),o=n(421933),r=n(754255),s=n(119872),l=n(854190),c=n(635439),d=n(953730);const u={source:"safelinks"},m=()=>({authOptions:u,url:o.m,method:"GET",serviceName:l.p.AtpSafelinksService,apiName:"safelink"}),p=(0,c.T)(l.p.AtpSafelinksService,{rejectHttpError:!0,allowedResponses:[d.bw.HTTP_2XX]},(e=>({getPolicy:e(m)}))),g=e=>{const t=(0,s.A)(e);return{getPolicy:h(t)}},h=e=>async()=>{const t=await e(m());return await t.body.json()};class v{constructor(e,t,n,i,a,o){this.send=e,this.scenarioFactory=t,this.localStorage=i,this.coreSettings=a,this.logger=n.newLogger("AtpSafelinksService","services-utilities-atp-safelinks"),this.atpSafelinksServiceTransport=((e,t,n)=>{const{enableEndpointsManagerOnAtpSafelinksService:i}=n.get(r.w.Messaging);return i?t.createApi(p):g(e)})(this.send,o,this.coreSettings)}async initPolicy(){const e=this.scenarioFactory.newScenario(i.Cu.ATPGetPolicyTask);try{await this.getPolicy(),e.stop()}catch(t){const n=`Error getting ATP Safelinks policy: ${t.message||""}`;this.logger.error(n),e.fail({errors:n})}}async getPolicy(){return this.getPolicyFromLocalStore()??this.getPolicyFromRemote()}getPolicyFromLocalStore(){let e=null;try{const t=this.localStorage.get(o.w);if(t){const n=JSON.parse(t);(0,a.q)(n.cookie,n.webAffinitizedUrl)?e=n:this.logger.log("Invalid policy found from localStorage, fetching new policy")}}catch(e){this.logger.error(`Error while getting ATP safelinks policy from localStorage: ${e}`)}return e}async getPolicyFromRemote(){let e=null;const t=this.scenarioFactory.newScenario(i.Cu.ATPGetPolicy);try{const n=await this.atpSafelinksServiceTransport.getPolicy();this.localStorage?.trySet(o.w,JSON.stringify(n),"Messaging"),this.logger.log(`ATP Policy isATPSafelinksEnabled: ${n.isATPSafelinksEnabled}`),t.stop(),e=n}catch(e){this.logger.error(`AtpSafelinks GetPolicy API failed with Error: ${e&&e.message}`),t.fail({errors:"atp_get_policy_failed"})}return e}}},625882:(e,t,n)=>{"use strict";n.d(t,{LA:()=>s,DZ:()=>d,vK:()=>u});var i=n(754255),a=n(943982);const o={access_token:{xms_cc:{values:["CP1"]}}},r=JSON.stringify(o),s=(e,t,n,a,s)=>{const d=((e,t)=>{const{caeEnabledResources:n}=t?.get(i.w.Auth)||{};return!(!e||!n||!(Array.isArray(n)&&n.findIndex((t=>e.includes(t)))>-1))})(e,s);let u=c(t,n,a);if(d&&(u=((e,t)=>{if(!t)return r;try{const e=JSON.parse(t);return e?.access_token?JSON.stringify({access_token:{...e.access_token,...o.access_token}}):r}catch(t){return void e?.errorToTelemetry?.("getClaimsForRequest: Json parsing failed","auth_add_claims_to_request",void 0,!0)}})(a,u)),n?.addEventData(["cp1"+(u?.includes("CP1")?"on":"off")]),t&&u&&u!==r){const e=l(u,a);e&&n?.addEventData([`claimsChallengeHeaderList:${e}`])}return u},l=(e,t)=>{try{const{access_token:t}=JSON.parse(e);if(t){if(t.xms_caeerror?.value&&!isNaN(Number(t.xms_caeerror.value))){const{xms_caeerror:e,...n}=t,i=`xms_caeerror_${e.value}`;return[...Object.keys(n),i].join()}return Object.keys(t).join()}return null}catch(e){return t?.errorToTelemetry?.("getClaimChallengeKeys: Json parsing failed","auth_add_claims_to_request",void 0,!0),null}},c=(e,t,n)=>{if(e&&"string"==typeof e&&""!==e.trim())try{const i=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)?(0,a.b)(e):e,o=JSON.parse(i);if(o&&"object"==typeof o)return t?.addEventData(["claim:"+ +!!i]),i;t?.addEventData(["invalidJSON"]),n?.log("Claims are not a valid json object, returning undefined.")}catch(e){t?.addEventData(["base64DecodeFail"]),n?.errorToTelemetry?.("validateAndDecodeClaims: invalid base64 string input","auth_add_claims_to_request",void 0,!0)}};var d;!function(e){e.WWW_AUTHENTICATE_HEADER="www-authenticate",e.ERROR_PREFIX="error=",e.CLAIMS_PREFIX="claims=",e.INSUFFICIENT_CLAIMS="insufficient_claims"}(d||(d={}));const u=(e,t)=>{const n={error:void 0,claims:void 0},i=e?.[d.WWW_AUTHENTICATE_HEADER];if(!i)return n;const o=i.split(",").filter(Boolean).map((e=>e.trim()));for(const e of o){const i=e.split('"');if(3===i.length)switch(i[0].toLocaleLowerCase()){case d.ERROR_PREFIX:n.error=i[1];break;case d.CLAIMS_PREFIX:n.claims=t?i[1]:(0,a.b)(i[1])}}return n}},728887:(e,t,n)=>{"use strict";n.d(t,{vU:()=>m,iq:()=>p,hG:()=>g,qi:()=>S,xy:()=>f,tT:()=>b,YL:()=>w});var i=n(455051),a=n(99425),o=n(702183),r=n(754255),s=n(625882),l=n(81670),c=n(899855),d=n(736626);const u=l.FQ.TWENTYFOUR*l.zB.ONE_HOUR;async function m(e,t,n,o,c,d,u,m,p){let g=i.Wx.Skype;const[h,k]=I(t,m),{forceRenew:C,tokenToRenew:N}=p||{};let A=!1;const{enableSTMSkypeCAECheck:E}=c.get(r.w.Auth);let{ic3NonCaeResource:F,ic3CaeResource:_}=c.get(r.w.Auth);F||(F=l.oF.IC3_GATEWAY_AAD_KEY),_||(_=l.oF.IC3_GATEWAY_CAE_KEY),A=(await n.getUser())?.type===a.aS.Anonymous,h?.addScenarioMark("ic3-gateway-token-helper-get-token-start",{commandSource:t,context:`preferredTokenTypes: ${e.map((e=>i.Wx[e]))}`});const D=A?i.Wx.Skype:f(t,c);let P;if(h?.addScenarioMark("ic3-gateway-token-helper-get-token-type-from-config",{commandSource:t,context:`SupportedTokenType: ${i.Wx[D]}`}),!A&&void 0!==d){const e="WWW-Authenticate",a=d.get(e);if(a){let e;if(h?.addScenarioMark("ic3-gateway-token-helper-parse-www-authn-header",{commandSource:t,context:"WWW-Authenticate headers present: true"}),void 0!==(e=T(a))){const t=(0,s.LA)(_,e,h,u,c);return y(_,i.Wx.CAE,n,h,k,t)}b(a)&&(h?.addScenarioMark("ic3-gateway-token-helper-parse-www-authn-header",{commandSource:t,context:"isSkypeTokenMigrationHeader: true"}),P=w(a),h?.addScenarioMark("ic3-gateway-token-helper-header-is-stm",{commandSource:t,context:`protocolFromHeader: ${i.Wx[P]}`}))}}switch(g=A?i.Wx.Skype:S(e,D,P,!!E),h?.addScenarioMark("ic3-gateway-token-helper-protocol-to-use",{commandSource:t,context:`protocolToUse: ${i.Wx[g]}`}),g){case i.Wx.Skype:return v(o,h,k,C);case i.Wx.AAD:return y(F,g,n,h,k,void 0,N);case i.Wx.CAE:return y(_,g,n,h,k);default:throw k?.({authEventData:"ic3-gateway-token-helper-get-token-end",reason:"Cannot determine protocol to use.",status:"failure"}),new Error(`cannot determine protocol to use. ${e}, ${t}, ${n}, ${o}, ${c}, ${d}`)}}const p=(e,t,n)=>{if(!e||!t)return;const i=e.get(t);if(i){if(!h(i.fallbackTime,n))return i.tokenType;e.delete(t)}},g=(e,t,n)=>{e&&t&&void 0!==n&&e.set(t,{tokenType:n,fallbackTime:(new Date).getTime()})},h=(e,t)=>{const{stmFallbackMapTimerInHr:n}=t.get(r.w.Auth),i=n?n*l.zB.ONE_HOUR:u;return(new Date).getTime()-e>i},v=async(e,t,n,a)=>{try{t?.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-start",{authEventData:`forceRenew: ${a}`}),await e.validateSkypeToken({forceRenew:a,correlation:{id:(0,d.DA)(),source:"ic3-gateway-token-helper:acquireSkypeToken"}});const o={...await e.getSkypeTokenInfoFromDiscoveryResponse({correlation:{id:(0,d.DA)(),source:"ic3-gateway-token-helper:acquireSkypeToken"}})};return o.expiration=Math.round(o.expiration/l.zB.MILLI_PER_SECOND),t?.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-end",{authEventData:`expiry in seconds: ${o.expiration}`,message:`expiry in seconds: ${o.expiration}`,status:"success"}),n?.(),{token:o,tokenType:i.Wx.Skype}}catch(e){throw t?.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-end",{error:e,status:"failure"}),n?.({error:e}),e}},y=async(e,t,n,i,a,o,r)=>{try{if(i?.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-start",{authEventData:`resource: ${e}, tokenToRenew: ${!!r}`}),n.acquireTokenV2){const s={tflClaim:r,...void 0!==o&&{claim:o}},c=await n.acquireTokenV2(e,s),d=Date.now(),u=(c?.expires-l.zB.SECONDS_PER_MINUTE)*l.zB.MILLI_PER_SECOND;return u<=d&&i?.addScenarioMark("ic3-gateway-token-helper-retry-aad-token-expiry-offset",{authEventData:`resource: ${e}, expiry in seconds: ${c.expires}, now: ${d}, time_diff: ${u-d}, fromCache: ${c.fromCache}`,message:`resource: ${e}, expiry in seconds: ${c.expires}, now: ${d}, time_diff: ${u-d}, fromCache: ${c.fromCache}`}),i?.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-end",{authEventData:`resource: ${e}, expiry_AuthService: ${c.expires}, fromCache: ${c.fromCache}`,message:`resource: ${e}, expiry_AuthService: ${c.expires}, fromCache: ${c.fromCache}`,status:"success"}),a?.(),{token:c,tokenType:t}}throw a?.({authEventData:`resource: ${e}`,reason:"IAuthenticationService does not have acquireTokenV2",status:"failure"}),new Error("IAuthenticationService does not have acquireTokenV2")}catch(t){throw i?.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-end",{authEventData:`resource: ${e}`,status:"failure",error:t}),a?.({error:t}),t}},S=(e,t,n,a)=>{e.sort(((e,t)=>t-e));const o=[e[0],t];void 0!==n&&o.push(n),o.sort(((e,t)=>e-t));const r=e.toString()===[i.Wx.CAE,i.Wx.Skype].toString(),s=t===i.Wx.AAD;return a&&r&&s?i.Wx.Skype:o[0]},f=(e,t,n,o)=>{if(void 0===e||void 0===t||o?.type===a.aS.Anonymous)return i.Wx.Skype;const{skypeTokenMigrationServiceInfo:s}=t.get(r.w.Auth),l=s?.find((t=>t?.source===e));if(void 0===l)return i.Wx.Skype;n?.addEventData([`source: ${l?.source}, isOnboarded: ${l?.isOnboarded},type: ${l?.tokenType}`]);const c=l?.isOnboarded,d=l?.tokenType;return c&&d?k(d):i.Wx.Skype},k=e=>{switch(e){case"Skype":return i.Wx.Skype;case"AAD":return i.Wx.AAD;case"CAE":return i.Wx.CAE}return e};var C;!function(e){e.TOKEN_TYPES="token_types="}(C||(C={}));const b=e=>e&&e.indexOf(C.TOKEN_TYPES)>-1&&e.indexOf(i.IO.BEARER)>-1,w=e=>{const t=e?.toLowerCase();return t?.indexOf("cae")>-1?i.Wx.CAE:t?.indexOf("aad")>-1?i.Wx.AAD:(t?.indexOf("skype"),i.Wx.Skype)},T=e=>{const t={[s.DZ.WWW_AUTHENTICATE_HEADER]:e},n=(0,s.vK)(t);return n&&n.error===s.DZ.INSUFFICIENT_CLAIMS?n.claims:void 0},I=(e,t)=>{const n=o.Cu.GetIC3GatewayToken,i={id:void 0!==t?t:(0,d.DA)(),scenarioName:n,source:e};try{const[e,t]=(0,c.we)({options:{correlation:i},source:"ic3-gateway-token-helper",scenarioName:n,subContext:"ic3-gateway-token-helper::getIC3GateWayToken",startWithoutScenario:!1});return[e,t]}catch{return[void 0,void 0]}}},422476:(e,t,n)=>{"use strict";n.d(t,{yL:()=>o,xA:()=>r,VQ:()=>s});var i=n(99425),a=n(754255);function o(e,t,n){return r(e)&&(e?.role===i.a7.Anonymous||!s(t,n))}function r(e){return!!e?.isAuthenticated}function s(e,t){const{enableTflFreProfileConsentDialog:n}=e.get(a.w.Fre);return!(!n||t&&"true"===t.get("TflFreProfileCardDisplayed"))}},141873:(e,t,n)=>{"use strict";n.d(t,{Y:()=>a});var i=n(289242);function a(e,t){const n=t?.clientTypeServiceHeader??e.config.clientType,a=t?.embedContext;return n===i.sK.CDLWorker?i.sK.CDLWorker:n===i.sK.Embed&&a?`${i.sK.Embed}-${a}`:n}},943982:(e,t,n)=>{"use strict";n.d(t,{f:()=>o,b:()=>r});var i=n(199448),a=n(850434);function o(e){if(!e)throw(0,i.$5)(a.Ir.Authentication,a.O4.InvalidInput,"parseJWT",void 0,`invalid token, value = ${e}`);try{const[,t]=e.split("."),n=r(t);return JSON.parse(n)}catch(t){throw(0,i.$5)(a.Ir.Authentication,a.O4.InvalidInput,"parseJWT",{innerError:t},`token contains dot = ${e.includes(".")}; token length = ${e.length}`)}}function r(e){if(!e)throw(0,i.$5)(a.Ir.Authentication,a.O4.InvalidInput,"base64DecodeStringUrlSafe",void 0,`invalid base64 string input, value = ${e}`);return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(atob(e)))}},642123:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});class i{constructor(e){this._cap=e,this._map=new Map}clear(){return this._map.clear()}entries(){return this._map.entries()}get(e){return this._map.get(e)}has(e){return this._map.has(e)}set(e,t){if(this._map.size>=this._cap){const e=this._map.keys().next().value;this._map.delete(e)}return this._map.set(e,t)}size(){return this._map.size}}},163166:(e,t,n)=>{"use strict";n.d(t,{L:()=>a});var i=n(364819);const a=(e,t)=>{if((0,i.isArray)(e))return t}},970840:(e,t,n)=>{"use strict";n.d(t,{X:()=>a,D:()=>o});const i=({osName:e,osVersion:t})=>{if(e?.toLowerCase()?.includes("windows")&&t)try{const e=t.match(/^(\d+)\.(\d+)\.(\d+)$/),n=4,i=1,a=2,o=3;if(e&&e.length===n){const t=parseInt(e[i],10),n=parseInt(e[a],10);return{majorVersion:t,minorVersion:n,revision:parseInt(e[o],10)}}}catch{}},a=({osName:e,osVersion:t})=>{const n=i({osName:e,osVersion:t});return void 0!==n&&(n.majorVersion>=10&&n.minorVersion>=0&&n.revision>=22e3)},o=({osName:e,osVersion:t})=>{const n=i({osName:e,osVersion:t});return void 0!==n&&(10===n.majorVersion&&0===n.minorVersion&&n.revision<22e3&&n.revision>=10240)}},369664:(e,t,n)=>{"use strict";function i(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}n.d(t,{a:()=>i})},792767:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});var i=n(754255),a=n(854190),o=n(141873);function r(e,t,n,r,s){const l={[a.f.xMsClientType]:(0,o.Y)(e,t),[a.f.xMsClientVersion]:e.config.clientVersion,[a.f.xMsSessionId]:e.host.sessionId,[a.f.xMsRequestId]:n||"",[a.f.xMsClientCaller]:r||""};return s&&s.includeUserTypeHeader&&(l[a.f.xMsUserType]=function(e){const t=e.get(i.w.Host),n=t?.userType??"";return"user"!==n&&""!==n}(s.coreSettings)?"test-user":"real-user"),l}},287572:(e,t,n)=>{"use strict";n.d(t,{xP:()=>i,Hr:()=>a,jE:()=>o,eW:()=>r,E:()=>s,up:()=>l});const i="mainAppWindowActiveEntities",a="appActiveEntitiesHistory",o="mainWindowNavHistory",r="mainWindowNavHistoryIndex",s=e=>{const t=["mainAppWindowActiveEntities","mainWindowNavHistory","mainWindowNavHistoryIndex"];return e&&t.push(`${e}-mainAppWindowActiveEntities`,`${e}-mainWindowNavHistory`,`${e}-mainWindowNavHistoryIndex`),t},l=(e,t)=>`${t?`${t}-`:""}${e}`},774478:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});const i=e=>e instanceof Date&&!isNaN(e.getTime())},231758:(e,t,n)=>{"use strict";n.d(t,{RB:()=>o,ip:()=>r,jK:()=>s});var i=n(691650),a=n(884542);function o(e){if(""===e)return null;const t=(0,a.Yn)("entity",i.l.Help,"training");return(0,a.jT)(e,t)}function r(e,t,n,i){const o=new URLSearchParams({source:n});return i&&o.append("sharedAppResource",i),(0,a.jT)(e,`app/${t}`,o.toString())}function s(e,t,n){return e&&t&&void 0!==n?(0,a.jT)(e,"marketplace",`deviceId=${t}&isTeamsRoomDevice=${n}`):""}},288952:(e,t,n)=>{"use strict";n.d(t,{s6:()=>s,Op:()=>c});var i=n(302151),a=n(850434),o=n(702183),r=n(736626);const s="serviceId",l=["merlotcity","int"];class c{constructor(e,t,n,o,r,l){this.rebootService=e,this.host=t,this.logger=n,this.authenticationService=o,this.localStorage=r,this.experienceConfig=l,this.switchRing=async e=>{await this.clearCachedIndexFile();const t={qsps:{ring:e}};this.rebootService.rebootApp(i.g.RingSwitch,i.Z.DeveloperSwitchersService,t)},this.clearContainer=async()=>{await this.clearCachedIndexFile();this.clearServiceSwitcherOverride(),this.rebootService.rebootApp(i.g.ClearContainer,i.Z.DeveloperSwitchersService,{qsps:{clearcontainer:"true"}})},this.clearServiceSwitcherOverride=()=>{this.localStorage.remove(s,"Experience")},this.clearCachedIndexFile=async()=>{try{if(void 0!==this.host.caches){const e=await this.host.caches.open(a.Xk);await e.delete(`/${this.experienceConfig?.basePath}/`)}}catch(e){this.logger.error(`Clear cached index file before switching ring failed with error: ${e}`)}}}async switchService(e){this.logger.log(`Switch service to ${e}`);const t=this.localStorage.get(s,"Experience")||void 0;if(this.localStorage.trySet(s,e,"Framework","Experience"),this.logger.infoToTelemetry?.(`switch to service ${e}`,"service_switch",{currentState:t,newState:e},!0),l.includes(e)||t&&l.includes(t)){if(!this.authenticationService.logout){const t="authenticationService.logout not implemented!";return this.logger.errorToTelemetry?.(t,"service_switch",{newState:e,error:t},!0),Promise.resolve(!1)}{const t=`logging out user to switch to service ${e}`,n={id:(0,r.DA)(),source:"developer-switchers-resolvers",scenarioName:o.Cu.AuthWebLogout};await this.authenticationService.logout({reason:t,correlation:n})}}else this.rebootService.rebootApp(i.g.ServiceSwitch,i.Z.DeveloperSwitchersService);return Promise.resolve(!0)}}},894143:(e,t,n)=>{"use strict";n.d(t,{AZ:()=>p,q_:()=>g});var i=n(251680),a=n(49180);const o=new RegExp(a.vg.oneNoteTargetRegex),r=new RegExp(a.vg.oneNoteSectionRegex),s=e=>{const t=o.exec(e);let n="";return t&&(n=t[1]),n},l=e=>{const t=r.exec(e);let n="";return t&&(n=t[1]),n};var c=n(891664);const d=new RegExp(a.vg.oneDriveFile),u=new RegExp(a.vg.sharePointFile),m=new RegExp(a.vg.spListItemPersonalUrlRegex),p=(e,t,n)=>{if(a.xp.includes(t))return null;const o=(0,i.W)(e),r=o?o.replace(a.vg.trailingSlashRegex,""):"";let s,l=null,p="";if((0,c.d0)(t)&&m.test(e)){let t=e.split(`/${a.fe.personal}/`)[1]||"";p=decodeURIComponent(t.split("/")[0]),t=e.split("/Lists/")[1]||"",s=decodeURIComponent(t.split("/")[0])}else if(d.test(e))p=a.fe.personal,s=r.split("/").pop();else if(u.test(e)){const t=r.split("/").pop()||"";p=decodeURIComponent(t);const n=2;s=decodeURIComponent(e.substring(r.length-1).split("/")[n])}if((p||s)&&(l={sourceTeamName:p,sourceChannelName:s}),t===a.tV.extension&&-1!==n?.indexOf(a.tV.extensionWithDot)){const e=v(n);e?.sectionGroup&&l&&(l.sourceChannelName=`${l.sourceChannelName} > ${e.sectionGroup}`),e?.section&&l&&(l.sourceChannelName=`${l.sourceChannelName} > ${e.section}`)}return l},g=(e,t)=>{let n=null;const i=decodeURIComponent(e);let a=s(i),o=l(a),r="";if(o.includes("/")){const e=o.lastIndexOf("/");a=a.substring(e+1),o=o.substring(e+1)}o=h(o);const c=t;t=o;const d=a.indexOf("/");if(-1!==d){const e=a.lastIndexOf("|");let n=a.substring(d+1,e);n=h(n),t=n,r=o}return n={title:t,noteBook:c,section:r},n},h=e=>e.replace(/(?:\\(.))/g,"$1"),v=e=>{let t=null,n="",i="",a="";e&&(n=decodeURIComponent(e));let o=s(n),r=l(o);if(r.includes("/")){const e=r.lastIndexOf("/");if(a=r.substring(0,e),a){const e=a.split("/");let t="";e.forEach((e=>{t=""===t?e:`${t} > ${e}`})),a=t}o=o.substring(e+1),r=r.substring(e+1)}return-1!==o.indexOf("/")&&(i=r),t={sectionGroup:h(a),section:h(i)},t}},806104:(e,t,n)=>{"use strict";n.d(t,{Sb:()=>a,dl:()=>o,IT:()=>r,nL:()=>l});var i=n(976003);const a=e=>e.startsWith("activities-"),o=e=>!!e&&e.length>0,r=e=>e?s[e]??e:"unknown-slice-id",s={[i.w.Activities_Mentions]:"mentions",[i.w.Activities_Mentions_Chat]:"mentions",[i.w.Activities_Mentions_Channel]:"mentions"},l={[i.w.Activities_Mentions]:{titleKey:"activity_slice_name_mentions",icon:i.O.Mention},[i.w.Activities_Mentions_Chat]:{titleKey:"activity_slice_name_mentions",icon:i.O.Mention},[i.w.Activities_Mentions_Channel]:{titleKey:"activity_slice_name_mentions",icon:i.O.Mention}}},976003:(e,t,n)=>{"use strict";var i,a;n.d(t,{w:()=>i,O:()=>a}),function(e){e.Activities_Mentions="activities-mentions",e.Activities_Mentions_Chat="activities-mentions-chat",e.Activities_Mentions_Channel="activities-mentions-channel"}(i||(i={})),function(e){e.Mention="mention"}(a||(a={}))},507086:(e,t,n)=>{"use strict";n.d(t,{j3:()=>i,zB:()=>a,X0:()=>o,xX:()=>r});const i={SSO_TOKEN:"OutlookSSOToken",ADDIN_ERROR:"OutlookAddInError",SSO_READY:"OutlookSSOReady",USE_CACHED_SSO_TOKEN:"OutlookUseCachedSSOToken",SSO_COMPLETE_TIME:"OutlookSSOCompleteTime",DIALOG_TRIGGER_TIME:"OutlookDialogTriggerTime",CONTEXT:"STTOutlookContext",STEP_MARKERS:"STTOutlookStepMarkers",AUTH_STRAP_ERROR:"STTOutlookAuthStrapError",AUTH_STRAP_REDIRECT_TIME:"STTOutlookAuthStrapRedirect",OAUTH_START_TIME:"OutlookOAuthStartTime",OAUTH_ELAPSED_TIME:"OutlookOAuthElapsedTime",PLATFORM_INFO:"OutlookPlatformInfo",STT_START_TIME:"STTExperienceStartTime"};var a,o,r;!function(e){e[e.HOURS_PER_DAY=24]="HOURS_PER_DAY",e[e.MINUTES_PER_HOUR=60]="MINUTES_PER_HOUR",e[e.SECONDS_PER_MINUTE=60]="SECONDS_PER_MINUTE",e[e.MILLISECS_PER_SECOND=1e3]="MILLISECS_PER_SECOND",e[e.TOKEN_EXP_MINUTE=10]="TOKEN_EXP_MINUTE",e[e.SSO_TIMEOUT_MILLISEC=7e3]="SSO_TIMEOUT_MILLISEC",e[e.SSO_RETRY_INTERVAL=100]="SSO_RETRY_INTERVAL",e[e.SSO_CLAIM_TIMEOUT_MINUTES=5]="SSO_CLAIM_TIMEOUT_MINUTES",e[e.SSO_CLAIM_TIMEOUT_MILLISEC=3e5]="SSO_CLAIM_TIMEOUT_MILLISEC",e[e.SSO_CLAIM_RETRY_INTERVAL=1e3]="SSO_CLAIM_RETRY_INTERVAL",e[e.STT_USAGE_EXPIRATION_DAYS=15]="STT_USAGE_EXPIRATION_DAYS",e[e.STT_USAGE_EXPIRATION_MILLISEC=1296e6]="STT_USAGE_EXPIRATION_MILLISEC"}(a||(a={})),function(e){e.NotProvided="NotProvided",e.Expired="Expired",e.Valid="Valid",e.Invalid="Invalid"}(o||(o={})),function(e){e.SSO="SSO",e.OAuth="OAuth"}(r||(r={}))},774948:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var i=n(825141),a=n(575061),o=n(432720);const r=(e,t,n,r)=>(0,i.F)((0,a.S)(((n,i)=>Array.from(function*(e,t,n,i){const a=e[Symbol.iterator](),o=t[Symbol.iterator]();let r=a.next(),s=o.next();for(;!s.done||!r.done;)s.done||!r.done&&s.value.id>r.value[0].id?(i(r.value[1]),r=a.next()):r.done||s.value.id<r.value[0].id?(yield[s.value,n(s.value)],s=o.next()):(yield[s.value,r.value[1]],r=a.next(),s=o.next())}(n,Array.from(i).sort(((e,t)=>e.id.localeCompare(t.id))),(t=>{try{return{type:"value",value:e(t)}}catch(e){return r&&r(t,e),{type:"error",error:e}}}),(e=>{if("error"!==e.type)return t(e.value)})))),[]),(0,o.T)((e=>e.filter((e=>"value"===e[1].type)).map((e=>n(e[0],e[1].value))))))},851490:(e,t,n)=>{"use strict";n.d(t,{x:()=>i,n:()=>a});const i=(e,t)=>e.split(" ").filter((e=>e.includes(`itemtype="${t}"`))).length,a=(e,t)=>t.map((t=>i(e,t))).reduce(((e,t)=>t+e),0)},498252:(e,t,n)=>{"use strict";n.d(t,{J:()=>r});var i=n(851490),a=n(220192);const o=(e,t)=>{const n=Date.now();if(!e)return void t.warn(`calculateTimeDifferenceToNow:: Invalid inputTime provided, returning undefined. inputTime isNull=${null===e}, isUndefined=${void 0===e}`);const i=Number(e);if(!isNaN(i))return n-i;t.warn("calculateTimeDifferenceToNow:: Invalid inputTime provided, numericRepresentation isNan=true")};function r(e){const{scenario:t,logger:n}=e;if(!t)return void n.warn(`sendMessageScenarioTelemetry:: Scenario was not provided, unable to append event data. scenario isNull=${null===t}, isUndefined=${void 0===t}`);const r=function(e){const{message:t,logger:n}=e,r=t?.content??"";return{filesCount:t?.files?.length??0,imagesCount:(0,i.n)(r,[a.A.amsImage,a.A.inlineImage,a.A.cachedImage]),videosCount:(0,i.x)(r,a.A.amsVideo),gifCount:(0,i.x)(r,a.A.giphy),stickerCount:(0,i.x)(r,a.A.sticker),emojiCount:(0,i.n)(r,[a.A.emoji,a.A.customEmoji]),loopCount:(0,i.x)(r,a.A.fluidEmbedCard),thirdPartyCount:(0,i.x)(r,a.A.inputExtension),isCrossPost:!!t?.crossPostChannels?.length,timeSinceOriginalSend:o(t?.originalSendPipelineTime,n),oamRetryCount:e.oamRetryCount,isOamRetry:e.oamRetryCount>0,isBackroomChat:"Backroom"===t?.meetingChatType,sendPipelineThreadType:t?.sendPipelineThreadType??"","Messaging.clientMessageId":t?.clientMessageId??"","Messaging.replyChainId":t?.replyChainId??""}}(e);t.appendEventData(r)}},835953:(e,t,n)=>{"use strict";n.d(t,{R:()=>m});var i=n(754255),a=n(663896);const o=e=>(t,n,o,r)=>{const{enableScopedSidePanePersistence:s}=o.get(i.w.Messaging,["enableScopedSidePanePersistence"]);if(!s)return;if(n!==a.w.Rail)return;const l=e[t]?.category;l&&r({openSidePane:l})},r=e=>(t,{clientPreferences:n,coreSettings:a})=>{if(!t.id)return;const{enableScopedSidePanePersistence:o}=a.get(i.w.Messaging);if(o){const i=e(t.type,a);if(i){const{category:e,idComparer:a}=i,o=n.getPreferences("sidePane").sidePaneOpenState,r=o?.find((e=>t.id&&a(e.id,t.id)));if(r)return r.category===e?r.hidden?"hidden":"open":"closed"}}return n.getPreferences("infoPane")[t.type]};var s=n(364819);const l=(e,t)=>(n,a,{clientPreferences:o,coreSettings:r})=>{const{enableScopedSidePanePersistence:l,scopedSidePanePersistenceLimit:d}=r.get(i.w.Messaging);if(a.id&&l){const i=e(a.type,r);if(i){const{category:e,type:r,idComparer:l}=i,[u]=(0,s.partition)(o.getPreferences("sidePane").sidePaneOpenState??[],(e=>!a.id||!l(e.id,a.id)));return"closed"!==n&&("crossSession"===r?(u.push({id:a.id,category:e,..."hidden"===n&&{hidden:!0}}),c(u,d),t.entity=void 0):t.entity={id:a.id,type:a.type}),void o.updatePreferences({sidePane:{sidePaneOpenState:u}})}}o.updatePreferences({infoPane:{[a.type]:n}})},c=(e,t)=>{const n=t??25;e.length>n&&e.splice(0,e.length-n)};var d=n(693973);const u=(e,t,n)=>(a,o,r,s,l)=>{if(o||!a||!r||!s||l!==d.Rm.standard)return;const{enableScopedSidePanePersistence:c}=s.get(i.w.Messaging);if(!c)return;if(n.entity){const e=n.entity;return n.entity=void 0,e}const{sidePaneOpenState:u}=r.sidePane;if(u?.length)for(const n of e){const e=t(n,s);if(!e)continue;const{category:i,idComparer:o}=e;for(const{id:e,category:t}of u)if(t===i&&o(a,e))return{id:e,type:n}}},m=e=>{const t=(e=>(t,n)=>{const i=e[t];if(!i)return;const{idComparer:a,isEnabled:o,...r}=i;return!o||o(n)?{...r,idComparer:a??((e,t)=>e===t)}:void 0})(e),n={};return{getSidePaneState:r(t),setSidePaneState:l(t,n),getSidePaneEndEntity:u(Object.keys(e),t,n),appendSidePaneDataToCommandScenario:o(e)}}},254889:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,g:()=>a});const i="discover",a="48:starred"},977352:(e,t,n)=>{"use strict";n.d(t,{Td:()=>i});const i="tmp.desktopTheme"},373480:(e,t,n)=>{"use strict";n.d(t,{Q:()=>o});var i=n(794171),a=n(977352);const o=(e,t)=>{try{if(e.matchMedia(i.S6.ColorContrastOverride).matches)return t?.log(`OS Theme Matches: ${i.S6.ColorContrastOverride}`),i.SV.Contrast;const n=e.localStorage.getItem(a.Td);return n||(e.matchMedia(i.S6.Dark).matches?(t?.log(`OS Theme Matches: ${i.S6.Dark}`),i.SV.Dark):e.matchMedia(i.S6.Light).matches?(t?.log(`OS Theme Matches: ${i.S6.Light}`),i.SV.Light):(t?.log("OS Theme Matches: None. Returning theme type light."),i.SV.Light))}catch(e){return void t?.log(`Couldn't resolve getOsTheme: ${e.message}`)}}},285793:(e,t,n)=>{"use strict";n.d(t,{$E:()=>r,Sd:()=>l,nv:()=>c});var i=n(678937),a=n(794171),o=n(373480);const r=e=>({[a.SV.Light]:e===i.B.life?a.Sx.DefaultTfl:a.Sx.DefaultV2,[a.SV.Dark]:e===i.B.life?a.Sx.DarkTfl:a.Sx.DarkV2,[a.SV.Contrast]:a.Sx.HighContrast}),s=(e,t)=>t[e]||a.Sx.DefaultV2,l=e=>((e,t)=>t[e]||a.SV.Light)(e,{[a.Sx.Default]:a.SV.Light,[a.Sx.DefaultV2]:a.SV.Light,[a.Sx.DefaultTfl]:a.SV.Light,[a.Sx.Dark]:a.SV.Dark,[a.Sx.DarkV2]:a.SV.Dark,[a.Sx.DarkTfl]:a.SV.Dark,[a.Sx.HighContrast]:a.SV.Contrast}),c=(e,t,n,i)=>{const a=e.getPreferences("theme")??{};return d(a,t,n,i)},d=(e,t,n,i)=>{const r=u(t);if(r)return r;if(e.followOsTheme){const e=(0,o.Q)(t,i);if(e)return s(e,n)}else if(e.userTheme)return s(e.userTheme,n);return a.Sx.DefaultV2},u=e=>{const t=new URLSearchParams(e.location.search).get("theme");if(t){const e=Object.keys(a.Sx).find((e=>e.toUpperCase()===t.toUpperCase()));return a.Sx[e]}}},334644:(e,t,n)=>{"use strict";n.d(t,{QI:()=>s,pP:()=>l,O$:()=>c});var i,a=n(463331),o=n(636310),r=n(515490);function s(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g,"Â ").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}function l(e,t,n){if(e&&t)return t.getAccountMode()===a.J.MultipleAccounts?(n.log(r.n.ReturningUserKeyForToastCollection),(0,o.Lw)(e)):void n.error(r.n.CollectionIdUndefined);n.error(r.n.NoAutheticatedUserOrTrackingService)}function c(e,t){if(!e)return t.errorToTelemetry?.("Failed to get platform service.","app_notifications_failed_to_get_browser_data",void 0,!0),!1;const{browserVersion:n,browser:a}=e.config;if(!n||!a)return t.errorToTelemetry?.(n?"Failed to get browser name.":"Failed to get browser version.","app_notifications_failed_to_get_browser_data",void 0,!0),!1;const o=n?Number(n.split(".")[0]):0;let r=!1;switch(a){case"chrome":r=o>=i.Chrome;break;case"firefox":r=o>=i.Firefox;break;case"edge":r=o>=i.Edge;break;default:t.warn("Unknown browser, could not check the version")}return r||t.warnToTelemetry?.(`out-of-tab notifications setting is not supported by Version ${n} of ${a} browser`,"out_of_tab_notifications_browser_version_check",void 0,!0),r}!function(e){e[e.Chrome=43]="Chrome",e[e.Firefox=46]="Firefox",e[e.Edge=79]="Edge"}(i||(i={}))},795269:(e,t,n)=>{"use strict";n.d(t,{as:()=>i});const i=(e,t)=>{if(e.is(t))return t;throw new TypeError}},175350:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTI1Ljk5OTMgMzBDMjUuOTk5MyAyOS40NDg0IDI1LjU1MjIgMjkuMDAxMyAyNS4wMDA2IDI5LjAwMTNDMjQuNDQ5MSAyOS4wMDEzIDI0LjAwMiAyOS40NDg0IDI0LjAwMiAzMEMyNC4wMDIgMzAuNTUxNSAyNC40NDkxIDMwLjk5ODYgMjUuMDAwNiAzMC45OTg2QzI1LjU1MjIgMzAuOTk4NiAyNS45OTkzIDMwLjU1MTUgMjUuOTk5MyAzMFpNMjUuNzQwMSAyMi4xNDY3QzI1LjY5MDEgMjEuNzgwNyAyNS4zNzYxIDIxLjQ5ODggMjQuOTk2NCAyMS40OTkxQzI0LjU4MjIgMjEuNDk5NCAyNC4yNDY3IDIxLjgzNTQgMjQuMjQ3IDIyLjI0OTdMMjQuMjUwNiAyNi43NTEzTDI0LjI1NzUgMjYuODUzQzI0LjMwNzUgMjcuMjE5MSAyNC42MjE1IDI3LjUwMSAyNS4wMDEyIDI3LjUwMDdDMjUuNDE1NCAyNy41MDAzIDI1Ljc1MDkgMjcuMTY0MyAyNS43NTA2IDI2Ljc1MDFMMjUuNzQ3IDIyLjI0ODVMMjUuNzQwMSAyMi4xNDY3Wk0yNi45NjkzIDE2LjY1ODlDMjYuMTEzIDE1LjExMTEgMjMuODg3OCAxNS4xMTExIDIzLjAzMTYgMTYuNjU4OUwxNS4yODYzIDMwLjY2MDRDMTQuNDU2OCAzMi4xNiAxNS41NDE0IDMzLjk5OTUgMTcuMjU1MiAzMy45OTk1SDMyLjc0NjJDMzQuNDYgMzMuOTk5NSAzNS41NDQ2IDMyLjE2IDM0LjcxNSAzMC42NjAzTDI2Ljk2OTMgMTYuNjU4OVpNMjQuMzQ0MiAxNy4zODVDMjQuNjI5NiAxNi44NjkxIDI1LjM3MTMgMTYuODY5MSAyNS42NTY3IDE3LjM4NUwzMy40MDI1IDMxLjM4NjVDMzMuNjc5IDMxLjg4NjMgMzMuMzE3NSAzMi40OTk1IDMyLjc0NjIgMzIuNDk5NUgxNy4yNTUyQzE2LjY4MzkgMzIuNDk5NSAxNi4zMjI0IDMxLjg4NjMgMTYuNTk4OSAzMS4zODY1TDI0LjM0NDIgMTcuMzg1WiIgZmlsbD0iIzMzMzMzMyIvPgo8L3N2Zz4K"},162917:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTIxLjIwNjkgMTdDMjEuNjY3NSAxNyAyMi4xMTUzIDE3LjE0MTMgMjIuNDkwOSAxNy40MDIzTDIyLjY0NzMgMTcuNTIxNUwyNS4wMjIgMTkuNUgzMi43NUMzMy44ODY3IDE5LjUgMzQuODI2NiAyMC4zNDMgMzQuOTc4NSAyMS40Mzc5TDM0Ljk5NDggMjEuNTk2TDM1IDIxLjc1VjMwLjc1QzM1IDMxLjk0MDkgMzQuMDc0OCAzMi45MTU2IDMyLjkwNCAzMi45OTQ4TDMyLjc1IDMzSDE3LjI1QzE2LjA1OTEgMzMgMTUuMDg0NCAzMi4wNzQ4IDE1LjAwNTIgMzAuOTA0TDE1IDMwLjc1VjE5LjI1QzE1IDE4LjA1OTEgMTUuOTI1MiAxNy4wODQ0IDE3LjA5NiAxNy4wMDUyTDE3LjI1IDE3SDIxLjIwNjlaTTIyLjY0NzMgMjIuOTc4NUMyMi4yOTM1IDIzLjI3MzMgMjEuODU5MSAyMy40NTE1IDIxLjQwMzQgMjMuNDkxNEwyMS4yMDY5IDIzLjVMMTYuNSAyMy40OTlWMzAuNzVDMTYuNSAzMS4xMjk3IDE2Ljc4MjIgMzEuNDQzNSAxNy4xNDgyIDMxLjQ5MzJMMTcuMjUgMzEuNUgzMi43NUMzMy4xMjk3IDMxLjUgMzMuNDQzNSAzMS4yMTc4IDMzLjQ5MzIgMzAuODUxOEwzMy41IDMwLjc1VjIxLjc1QzMzLjUgMjEuMzcwMyAzMy4yMTc4IDIxLjA1NjUgMzIuODUxOCAyMS4wMDY4TDMyLjc1IDIxSDI1LjAyMUwyMi42NDczIDIyLjk3ODVaTTIxLjIwNjkgMTguNUgxNy4yNUMxNi44NzAzIDE4LjUgMTYuNTU2NSAxOC43ODIyIDE2LjUwNjggMTkuMTQ4MkwxNi41IDE5LjI1VjIxLjk5OUwyMS4yMDY5IDIyQzIxLjM0NzMgMjIgMjEuNDg0MSAyMS45NjA2IDIxLjYwMjIgMjEuODg3NEwyMS42ODcxIDIxLjgyNjJMMjMuNTc4IDIwLjI0OUwyMS42ODcxIDE4LjY3MzhDMjEuNTc5MiAxOC41ODQgMjEuNDQ4OSAxOC41MjY2IDIxLjMxMTMgMTguNTA3M0wyMS4yMDY5IDE4LjVaIiBmaWxsPSIjMzMzMzMzIi8+Cjwvc3ZnPgo="},794166:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTMxLjc0OTggMzMuNDk1MUMzMi4xNjQgMzMuNDk0OSAzMi41IDMzLjgzMDYgMzIuNSAzNC4yNDQ4QzMyLjUgMzQuNjU5IDMyLjE2NDQgMzQuOTk0OSAzMS43NTAyIDM0Ljk5NTFMMTguNzUwMiAzNC45OTg4QzE4LjMzNiAzNC45OTg5IDE4IDM0LjY2MzIgMTggMzQuMjQ5QzE4IDMzLjgzNDggMTguMzM1NiAzMy40OTg5IDE4Ljc0OTggMzMuNDk4OEwzMS43NDk4IDMzLjQ5NTFaTTI1LjE0ODIgMTUuMDA2OEwyNS4yNSAxNUMyNS42Mjk3IDE1IDI1Ljk0MzUgMTUuMjgyMiAyNS45OTMyIDE1LjY0ODJMMjYgMTUuNzVMMjUuOTk5IDI5LjQzNUwyOS43MjA4IDI1LjcxNDdDMjkuOTg3MSAyNS40NDg0IDMwLjQwMzggMjUuNDI0MyAzMC42OTc0IDI1LjY0MjJMMzAuNzgxNSAyNS43MTQ4QzMxLjA0NzcgMjUuOTgxMSAzMS4wNzE5IDI2LjM5NzcgMzAuODU0IDI2LjY5MTNMMzAuNzgxNCAyNi43NzU0TDI1Ljc4MzcgMzEuNzcyMUMyNS41MTc2IDMyLjAzODEgMjUuMTAxMiAzMi4wNjI0IDI0LjgwNzYgMzEuODQ0OUwyNC43MjM1IDMxLjc3MjRMMTkuNzIgMjYuNzc1N0MxOS40MjY5IDI2LjQ4MzEgMTkuNDI2NiAyNi4wMDgyIDE5LjcxOTMgMjUuNzE1MUMxOS45ODU0IDI1LjQ0ODYgMjAuNDAyIDI1LjQyNDEgMjAuNjk1OCAyNS42NDE4TDIwLjc4IDI1LjcxNDRMMjQuNDk5IDI5LjQyOEwyNC41IDE1Ljc1QzI0LjUgMTUuMzcwMyAyNC43ODIyIDE1LjA1NjUgMjUuMTQ4MiAxNS4wMDY4TDI1LjI1IDE1TDI1LjE0ODIgMTUuMDA2OFoiIGZpbGw9IiMzMzMzMzMiLz4KPC9zdmc+Cg=="},328984:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTI1Ljk5OTMgMzBDMjUuOTk5MyAyOS40NDg0IDI1LjU1MjIgMjkuMDAxMyAyNS4wMDA2IDI5LjAwMTNDMjQuNDQ5MSAyOS4wMDEzIDI0LjAwMiAyOS40NDg0IDI0LjAwMiAzMEMyNC4wMDIgMzAuNTUxNSAyNC40NDkxIDMwLjk5ODYgMjUuMDAwNiAzMC45OTg2QzI1LjU1MjIgMzAuOTk4NiAyNS45OTkzIDMwLjU1MTUgMjUuOTk5MyAzMFpNMjUuNzQwMSAyMi4xNDY3QzI1LjY5MDEgMjEuNzgwNyAyNS4zNzYxIDIxLjQ5ODggMjQuOTk2NCAyMS40OTkxQzI0LjU4MjIgMjEuNDk5NCAyNC4yNDY3IDIxLjgzNTQgMjQuMjQ3IDIyLjI0OTdMMjQuMjUwNiAyNi43NTEzTDI0LjI1NzUgMjYuODUzQzI0LjMwNzUgMjcuMjE5MSAyNC42MjE1IDI3LjUwMSAyNS4wMDEyIDI3LjUwMDdDMjUuNDE1NCAyNy41MDAzIDI1Ljc1MDkgMjcuMTY0MyAyNS43NTA2IDI2Ljc1MDFMMjUuNzQ3IDIyLjI0ODVMMjUuNzQwMSAyMi4xNDY3Wk0yNi45NjkzIDE2LjY1ODlDMjYuMTEzIDE1LjExMTEgMjMuODg3OCAxNS4xMTExIDIzLjAzMTYgMTYuNjU4OUwxNS4yODYzIDMwLjY2MDRDMTQuNDU2OCAzMi4xNiAxNS41NDE0IDMzLjk5OTUgMTcuMjU1MiAzMy45OTk1SDMyLjc0NjJDMzQuNDYgMzMuOTk5NSAzNS41NDQ2IDMyLjE2IDM0LjcxNSAzMC42NjAzTDI2Ljk2OTMgMTYuNjU4OVpNMjQuMzQ0MiAxNy4zODVDMjQuNjI5NiAxNi44NjkxIDI1LjM3MTMgMTYuODY5MSAyNS42NTY3IDE3LjM4NUwzMy40MDI1IDMxLjM4NjVDMzMuNjc5IDMxLjg4NjMgMzMuMzE3NSAzMi40OTk1IDMyLjc0NjIgMzIuNDk5NUgxNy4yNTUyQzE2LjY4MzkgMzIuNDk5NSAxNi4zMjI0IDMxLjg4NjMgMTYuNTk4OSAzMS4zODY1TDI0LjM0NDIgMTcuMzg1WiIgZmlsbD0iIzMzMzMzMyIvPgo8L3N2Zz4K"},755309:(e,t,n)=>{var i={"./ar-sa/activity.js":[591694,581062],"./ar-sa/artifacts-platform.js":[576298,3862],"./ar-sa/audience-view-dialog.js":[837772,875992],"./ar-sa/auth.js":[919137,581062],"./ar-sa/autosuggest.js":[445512,581062],"./ar-sa/avatar.js":[33322,581062],"./ar-sa/biometric-enrollment.js":[173886,174166],"./ar-sa/breakout-rooms.js":[202179,460259],"./ar-sa/broadcast-scheduling.js":[883975,849059],"./ar-sa/broadcast.js":[766584,628090],"./ar-sa/calendar.js":[736313,182957],"./ar-sa/calling.js":[499095,873669],"./ar-sa/campaign-notifications.js":[276652,581062],"./ar-sa/carousel-multi-card.js":[null],"./ar-sa/cast.js":[903532,581062],"./ar-sa/channels.js":[200399,581062],"./ar-sa/chat-list.js":[111918,581062],"./ar-sa/coach-report.js":[882296,822444],"./ar-sa/comment-stream.js":[890159,120551],"./ar-sa/communities.js":[915530,581062],"./ar-sa/compose.js":[576915,581062],"./ar-sa/contacts.js":[140134,581062],"./ar-sa/datepicker.js":[196433,930911],"./ar-sa/desktop.js":[411767,106793],"./ar-sa/digital-signage.js":[null],"./ar-sa/discover-surface.js":[202222,993406],"./ar-sa/edu.js":[449227,307409],"./ar-sa/embed.js":[113502,581062],"./ar-sa/errors.js":[844932,581062],"./ar-sa/esp.js":[82299,158961],"./ar-sa/extensibility-ptz-extension.js":[null],"./ar-sa/extensibility-room-remote.js":[null],"./ar-sa/extensibility.js":[964994,581062],"./ar-sa/feedback.js":[953308,126752],"./ar-sa/files.js":[93444,581062],"./ar-sa/framework.js":[167903,581062],"./ar-sa/freemium-upgrade.js":[null],"./ar-sa/funstuff.js":[424058,676510],"./ar-sa/gallery.js":[809833,807835],"./ar-sa/growth.js":[33908,581062],"./ar-sa/guardians.js":[954559,764989],"./ar-sa/health.js":[960561,635645],"./ar-sa/help.js":[948544,741090],"./ar-sa/hololens.js":[171479,873669],"./ar-sa/host-controls.js":[209484,142214],"./ar-sa/jana.js":[907623,773599],"./ar-sa/lightbox.js":[415702,581062],"./ar-sa/links.js":[425218,581062],"./ar-sa/live-persona-card.js":[342927,581062],"./ar-sa/live-persona-editor.js":[351032,89410],"./ar-sa/lms-integration.js":[null],"./ar-sa/meet-for-work.js":[306502,688988],"./ar-sa/meeting-analytics.js":[704163,447569],"./ar-sa/meeting-apis-app.js":[null],"./ar-sa/meeting-bot.js":[null],"./ar-sa/meeting-collaboration.js":[57762,773468],"./ar-sa/meeting-flyout.js":[715236,581062],"./ar-sa/meeting-meet-app.js":[155186,581062],"./ar-sa/meeting-options.js":[10661,846707],"./ar-sa/meeting-recap.js":[593984,903078],"./ar-sa/meeting-room-console.js":[null],"./ar-sa/meeting-stream-app.js":[null],"./ar-sa/messaging.js":[6087,581062],"./ar-sa/mobile-attach.js":[null],"./ar-sa/mtma-missed-notifications.js":[857269,581062],"./ar-sa/nearby.js":[860984,581062],"./ar-sa/nova.js":[392169,581062],"./ar-sa/people-app.js":[null],"./ar-sa/people-picker.js":[55255,581062],"./ar-sa/people-targeting.js":[547390,818],"./ar-sa/people.js":[391456,581062],"./ar-sa/person.js":[620646,581062],"./ar-sa/phonelink-sms.js":[998811,478073],"./ar-sa/pre-core.js":[null],"./ar-sa/premium-benefits.js":[545119,388615],"./ar-sa/presence.js":[17462,581062],"./ar-sa/queues.js":[85235,887559],"./ar-sa/recurrence.js":[514281,199917],"./ar-sa/rsc-application-permissions.js":[null],"./ar-sa/search.js":[777283,930911],"./ar-sa/semantic-object.js":[318191,574345],"./ar-sa/settings.js":[259262,581062],"./ar-sa/share-in-meetings.js":[null],"./ar-sa/share-to-teams-outlook-addin.js":[null],"./ar-sa/share-to-teams-third-party.js":[null],"./ar-sa/share-to-teams.js":[523451,613659],"./ar-sa/shortcut.js":[293069,581062],"./ar-sa/shortcuts.js":[41832,581062],"./ar-sa/simple-collab.js":[750663,581062],"./ar-sa/smart-device.js":[null],"./ar-sa/survey.js":[404209,560725],"./ar-sa/sv-flyout.js":[345600,581062],"./ar-sa/teams-and-channels.js":[619678,267562],"./ar-sa/teams-insider.js":[300354,581062],"./ar-sa/telemetry.js":[505460,581062],"./ar-sa/tfl-homepage.js":[124018,581062],"./ar-sa/tfl-onboarding.js":[740867,581062],"./ar-sa/toast-notifications.js":[541461,581062],"./ar-sa/trusted-ui.js":[null],"./ar-sa/unified-search.js":[793578,613659],"./ar-sa/unsupported-browser.js":[null],"./ar-sa/url-preview.js":[922231,581062],"./ar-sa/video-capture.js":[209287,515937],"./ar-sa/video-message.js":[952242,160216],"./ar-sa/virtual-consumer-events.js":[512779,621447],"./ar-sa/virtual-events.js":[346540,695075],"./ar-sa/webinar.js":[186385,766999],"./ar-sa/welcome-bot.js":[null],"./ar-sa/whats-new.js":[17403,581062],"./ar-sa/wiki.js":[null],"./az-latn-az/activity.js":[694117,401239],"./az-latn-az/artifacts-platform.js":[822621,257255],"./az-latn-az/audience-view-dialog.js":[647887,134665],"./az-latn-az/auth.js":[547150,401239],"./az-latn-az/autosuggest.js":[947165,401239],"./az-latn-az/avatar.js":[464685,401239],"./az-latn-az/biometric-enrollment.js":[673481,101543],"./az-latn-az/breakout-rooms.js":[923488,786712],"./az-latn-az/broadcast-scheduling.js":[498532,351128],"./az-latn-az/broadcast.js":[929189,563],"./az-latn-az/calendar.js":[621450,871066],"./az-latn-az/calling.js":[588542,393330],"./az-latn-az/campaign-notifications.js":[180579,401239],"./az-latn-az/carousel-multi-card.js":[null],"./az-latn-az/cast.js":[916011,401239],"./az-latn-az/channels.js":[396016,401239],"./az-latn-az/chat-list.js":[667599,401239],"./az-latn-az/coach-report.js":[43739,312341],"./az-latn-az/comment-stream.js":[634264,916180],"./az-latn-az/communities.js":[677599,401239],"./az-latn-az/compose.js":[353446,401239],"./az-latn-az/contacts.js":[1781,401239],"./az-latn-az/datepicker.js":[447406,733996],"./az-latn-az/desktop.js":[707474,220846],"./az-latn-az/digital-signage.js":[null],"./az-latn-az/discover-surface.js":[63269,469615],"./az-latn-az/edu.js":[542662,82550],"./az-latn-az/embed.js":[263523,401239],"./az-latn-az/errors.js":[367831,401239],"./az-latn-az/esp.js":[935762,490006],"./az-latn-az/extensibility-ptz-extension.js":[null],"./az-latn-az/extensibility-room-remote.js":[null],"./az-latn-az/extensibility.js":[891679,401239],"./az-latn-az/feedback.js":[995815,963121],"./az-latn-az/files.js":[365357,401239],"./az-latn-az/framework.js":[762758,401239],"./az-latn-az/freemium-upgrade.js":[null],"./az-latn-az/funstuff.js":[571277,583823],"./az-latn-az/gallery.js":[70004,645552],"./az-latn-az/growth.js":[419051,401239],"./az-latn-az/guardians.js":[45818,350890],"./az-latn-az/health.js":[515534,584682],"./az-latn-az/help.js":[717455,638875],"./az-latn-az/hololens.js":[692332,393330],"./az-latn-az/host-controls.js":[854861,268311],"./az-latn-az/jana.js":[191856,900332],"./az-latn-az/lightbox.js":[478269,401239],"./az-latn-az/links.js":[516331,401239],"./az-latn-az/live-persona-card.js":[182058,401239],"./az-latn-az/live-persona-editor.js":[572869,60219],"./az-latn-az/lms-integration.js":[null],"./az-latn-az/meet-for-work.js":[530771,641541],"./az-latn-az/meeting-analytics.js":[987050,928630],"./az-latn-az/meeting-apis-app.js":[null],"./az-latn-az/meeting-bot.js":[null],"./az-latn-az/meeting-collaboration.js":[69227,315845],"./az-latn-az/meeting-flyout.js":[229827,401239],"./az-latn-az/meeting-meet-app.js":[387505,401239],"./az-latn-az/meeting-options.js":[548188,33320],"./az-latn-az/meeting-recap.js":[34949,534583],"./az-latn-az/meeting-room-console.js":[null],"./az-latn-az/meeting-stream-app.js":[null],"./az-latn-az/messaging.js":[488798,401239],"./az-latn-az/mobile-attach.js":[null],"./az-latn-az/mtma-missed-notifications.js":[348592,401239],"./az-latn-az/nearby.js":[95371,401239],"./az-latn-az/nova.js":[215506,401239],"./az-latn-az/people-app.js":[null],"./az-latn-az/people-picker.js":[980430,401239],"./az-latn-az/people-targeting.js":[932305,354475],"./az-latn-az/people.js":[945687,401239],"./az-latn-az/person.js":[470497,401239],"./az-latn-az/phonelink-sms.js":[865078,228094],"./az-latn-az/pre-core.js":[null],"./az-latn-az/premium-benefits.js":[664352,556660],"./az-latn-az/presence.js":[804437,401239],"./az-latn-az/queues.js":[531064,365620],"./az-latn-az/recurrence.js":[237358,969114],"./az-latn-az/rsc-application-permissions.js":[null],"./az-latn-az/search.js":[515240,733996],"./az-latn-az/semantic-object.js":[467282,313870],"./az-latn-az/settings.js":[659729,401239],"./az-latn-az/share-in-meetings.js":[null],"./az-latn-az/share-to-teams-outlook-addin.js":[null],"./az-latn-az/share-to-teams-third-party.js":[null],"./az-latn-az/share-to-teams.js":[512360,146160],"./az-latn-az/shortcut.js":[106,401239],"./az-latn-az/shortcuts.js":[828409,401239],"./az-latn-az/simple-collab.js":[42542,401239],"./az-latn-az/smart-device.js":[null],"./az-latn-az/survey.js":[77634,589122],"./az-latn-az/sv-flyout.js":[305433,401239],"./az-latn-az/teams-and-channels.js":[513253,711587],"./az-latn-az/teams-insider.js":[286083,401239],"./az-latn-az/telemetry.js":[572273,401239],"./az-latn-az/tfl-homepage.js":[179125,401239],"./az-latn-az/tfl-onboarding.js":[805704,401239],"./az-latn-az/toast-notifications.js":[687388,401239],"./az-latn-az/trusted-ui.js":[null],"./az-latn-az/unified-search.js":[346633,146160],"./az-latn-az/unsupported-browser.js":[null],"./az-latn-az/url-preview.js":[199982,401239],"./az-latn-az/video-capture.js":[495102,751430],"./az-latn-az/video-message.js":[918335,275529],"./az-latn-az/virtual-consumer-events.js":[931122,211764],"./az-latn-az/virtual-events.js":[121831,102872],"./az-latn-az/webinar.js":[881872,379908],"./az-latn-az/welcome-bot.js":[null],"./az-latn-az/whats-new.js":[170318,401239],"./az-latn-az/wiki.js":[null],"./bg-bg/activity.js":[752003,757299],"./bg-bg/artifacts-platform.js":[46407,128131],"./bg-bg/audience-view-dialog.js":[814261,486501],"./bg-bg/auth.js":[45492,757299],"./bg-bg/autosuggest.js":[163379,757299],"./bg-bg/avatar.js":[20387,757299],"./bg-bg/biometric-enrollment.js":[71375,298435],"./bg-bg/breakout-rooms.js":[797422,770006],"./bg-bg/broadcast-scheduling.js":[291454,158806],"./bg-bg/broadcast.js":[274771,240071],"./bg-bg/calendar.js":[502468,234776],"./bg-bg/calling.js":[196548,672048],"./bg-bg/campaign-notifications.js":[136601,757299],"./bg-bg/carousel-multi-card.js":[null],"./bg-bg/cast.js":[690057,757299],"./bg-bg/channels.js":[979294,757299],"./bg-bg/chat-list.js":[779097,757299],"./bg-bg/coach-report.js":[645169,964857],"./bg-bg/comment-stream.js":[927058,819226],"./bg-bg/communities.js":[247561,757299],"./bg-bg/compose.js":[25944,757299],"./bg-bg/contacts.js":[737223,757299],"./bg-bg/datepicker.js":[746952,393554],"./bg-bg/desktop.js":[832728,450692],"./bg-bg/digital-signage.js":[null],"./bg-bg/discover-surface.js":[886199,54507],"./bg-bg/edu.js":[415176,285356],"./bg-bg/embed.js":[198121,757299],"./bg-bg/errors.js":[637145,757299],"./bg-bg/esp.js":[381848,812940],"./bg-bg/extensibility-ptz-extension.js":[null],"./bg-bg/extensibility-room-remote.js":[null],"./bg-bg/extensibility.js":[86741,757299],"./bg-bg/feedback.js":[801197,598413],"./bg-bg/files.js":[74391,757299],"./bg-bg/framework.js":[809816,757299],"./bg-bg/freemium-upgrade.js":[null],"./bg-bg/funstuff.js":[729919,752011],"./bg-bg/gallery.js":[564350,605614],"./bg-bg/growth.js":[323465,757299],"./bg-bg/guardians.js":[193164,845288],"./bg-bg/health.js":[523004,258472],"./bg-bg/help.js":[431509,353071],"./bg-bg/hololens.js":[510090,672048],"./bg-bg/host-controls.js":[984247,318451],"./bg-bg/jana.js":[795198,236242],"./bg-bg/lightbox.js":[847831,757299],"./bg-bg/links.js":[808169,757299],"./bg-bg/live-persona-card.js":[527864,757299],"./bg-bg/live-persona-editor.js":[343299,649807],"./bg-bg/lms-integration.js":[null],"./bg-bg/meet-for-work.js":[409089,932521],"./bg-bg/meeting-analytics.js":[52144,425516],"./bg-bg/meeting-apis-app.js":[null],"./bg-bg/meeting-bot.js":[null],"./bg-bg/meeting-collaboration.js":[356097,150633],"./bg-bg/meeting-flyout.js":[574473,757299],"./bg-bg/meeting-meet-app.js":[890119,757299],"./bg-bg/meeting-options.js":[201950,740326],"./bg-bg/meeting-recap.js":[29319,79315],"./bg-bg/meeting-room-console.js":[null],"./bg-bg/meeting-stream-app.js":[null],"./bg-bg/messaging.js":[870252,757299],"./bg-bg/mobile-attach.js":[null],"./bg-bg/mtma-missed-notifications.js":[866646,757299],"./bg-bg/nearby.js":[751829,757299],"./bg-bg/nova.js":[980556,757299],"./bg-bg/people-app.js":[null],"./bg-bg/people-picker.js":[742016,757299],"./bg-bg/people-targeting.js":[930259,146175],"./bg-bg/people.js":[645153,757299],"./bg-bg/person.js":[669247,757299],"./bg-bg/phonelink-sms.js":[816992,155860],"./bg-bg/pre-core.js":[null],"./bg-bg/premium-benefits.js":[935186,35706],"./bg-bg/presence.js":[457763,757299],"./bg-bg/queues.js":[120485,580602],"./bg-bg/recurrence.js":[653372,709208],"./bg-bg/rsc-application-permissions.js":[null],"./bg-bg/search.js":[242994,393554],"./bg-bg/semantic-object.js":[567080,150820],"./bg-bg/settings.js":[113783,757299],"./bg-bg/share-in-meetings.js":[null],"./bg-bg/share-to-teams-outlook-addin.js":[null],"./bg-bg/share-to-teams-third-party.js":[null],"./bg-bg/share-to-teams.js":[841318,397038],"./bg-bg/shortcut.js":[387680,757299],"./bg-bg/shortcuts.js":[173023,757299],"./bg-bg/simple-collab.js":[866888,757299],"./bg-bg/smart-device.js":[null],"./bg-bg/survey.js":[347748,332032],"./bg-bg/sv-flyout.js":[282515,757299],"./bg-bg/teams-and-channels.js":[103099,102967],"./bg-bg/teams-insider.js":[810477,757299],"./bg-bg/telemetry.js":[145255,757299],"./bg-bg/tfl-homepage.js":[315007,757299],"./bg-bg/tfl-onboarding.js":[987382,757299],"./bg-bg/toast-notifications.js":[540738,757299],"./bg-bg/trusted-ui.js":[null],"./bg-bg/unified-search.js":[775283,397038],"./bg-bg/unsupported-browser.js":[null],"./bg-bg/url-preview.js":[852096,757299],"./bg-bg/video-capture.js":[552448,559868],"./bg-bg/video-message.js":[813557,770725],"./bg-bg/virtual-consumer-events.js":[506188,752186],"./bg-bg/virtual-events.js":[971193,4822],"./bg-bg/webinar.js":[246594,472970],"./bg-bg/welcome-bot.js":[null],"./bg-bg/whats-new.js":[490352,757299],"./bg-bg/wiki.js":[null],"./ca-es-valencia/activity.js":[337853,855715],"./ca-es-valencia/artifacts-platform.js":[471125,55763],"./ca-es-valencia/audience-view-dialog.js":[199959,911221],"./ca-es-valencia/auth.js":[609318,855715],"./ca-es-valencia/autosuggest.js":[126341,855715],"./ca-es-valencia/avatar.js":[130933,855715],"./ca-es-valencia/biometric-enrollment.js":[261281,758931],"./ca-es-valencia/breakout-rooms.js":[15304,939560],"./ca-es-valencia/broadcast-scheduling.js":[213100,153640],"./ca-es-valencia/broadcast.js":[257165,184495],"./ca-es-valencia/calendar.js":[438578,310594],"./ca-es-valencia/calling.js":[142198,193834],"./ca-es-valencia/campaign-notifications.js":[943995,855715],"./ca-es-valencia/carousel-multi-card.js":[null],"./ca-es-valencia/cast.js":[731795,855715],"./ca-es-valencia/channels.js":[615896,855715],"./ca-es-valencia/chat-list.js":[232071,855715],"./ca-es-valencia/coach-report.js":[53795,613953],"./ca-es-valencia/comment-stream.js":[566976,594788],"./ca-es-valencia/communities.js":[599,855715],"./ca-es-valencia/compose.js":[32558,855715],"./ca-es-valencia/contacts.js":[267293,855715],"./ca-es-valencia/datepicker.js":[395478,110348],"./ca-es-valencia/desktop.js":[438922,216134],"./ca-es-valencia/digital-signage.js":[null],"./ca-es-valencia/discover-surface.js":[324413,93227],"./ca-es-valencia/edu.js":[721150,459230],"./ca-es-valencia/embed.js":[798315,855715],"./ca-es-valencia/errors.js":[603887,855715],"./ca-es-valencia/esp.js":[131402,804798],"./ca-es-valencia/extensibility-ptz-extension.js":[null],"./ca-es-valencia/extensibility-room-remote.js":[null],"./ca-es-valencia/extensibility.js":[516615,855715],"./ca-es-valencia/feedback.js":[665407,233037],"./ca-es-valencia/files.js":[533957,855715],"./ca-es-valencia/framework.js":[501518,855715],"./ca-es-valencia/freemium-upgrade.js":[null],"./ca-es-valencia/funstuff.js":[875269,103499],"./ca-es-valencia/gallery.js":[313916,955376],"./ca-es-valencia/growth.js":[476371,855715],"./ca-es-valencia/guardians.js":[182930,736946],"./ca-es-valencia/health.js":[374278,81074],"./ca-es-valencia/help.js":[869495,788103],"./ca-es-valencia/hololens.js":[873204,193834],"./ca-es-valencia/host-controls.js":[506325,702371],"./ca-es-valencia/jana.js":[679e3,859980],"./ca-es-valencia/lightbox.js":[913589,855715],"./ca-es-valencia/links.js":[744835,855715],"./ca-es-valencia/live-persona-card.js":[549282,855715],"./ca-es-valencia/live-persona-editor.js":[629149,693927],"./ca-es-valencia/lms-integration.js":[null],"./ca-es-valencia/meet-for-work.js":[333867,771601],"./ca-es-valencia/meeting-analytics.js":[956386,360094],"./ca-es-valencia/meeting-apis-app.js":[null],"./ca-es-valencia/meeting-bot.js":[null],"./ca-es-valencia/meeting-collaboration.js":[730707,517457],"./ca-es-valencia/meeting-flyout.js":[709083,855715],"./ca-es-valencia/meeting-meet-app.js":[423897,855715],"./ca-es-valencia/meeting-options.js":[751924,940440],"./ca-es-valencia/meeting-recap.js":[608989,884291],"./ca-es-valencia/meeting-room-console.js":[null],"./ca-es-valencia/meeting-stream-app.js":[null],"./ca-es-valencia/messaging.js":[701862,855715],"./ca-es-valencia/mobile-attach.js":[null],"./ca-es-valencia/mtma-missed-notifications.js":[997720,855715],"./ca-es-valencia/nearby.js":[904883,855715],"./ca-es-valencia/nova.js":[375578,855715],"./ca-es-valencia/people-app.js":[null],"./ca-es-valencia/people-picker.js":[896214,855715],"./ca-es-valencia/people-targeting.js":[987497,310007],"./ca-es-valencia/people.js":[497439,855715],"./ca-es-valencia/person.js":[744617,855715],"./ca-es-valencia/phonelink-sms.js":[699454,928694],"./ca-es-valencia/pre-core.js":[null],"./ca-es-valencia/premium-benefits.js":[968616,428868],"./ca-es-valencia/presence.js":[929357,855715],"./ca-es-valencia/queues.js":[10048,11460],"./ca-es-valencia/recurrence.js":[117158,590338],"./ca-es-valencia/rsc-application-permissions.js":[null],"./ca-es-valencia/search.js":[290400,110348],"./ca-es-valencia/semantic-object.js":[863338,16550],"./ca-es-valencia/settings.js":[967545,855715],"./ca-es-valencia/share-in-meetings.js":[null],"./ca-es-valencia/share-to-teams-outlook-addin.js":[null],"./ca-es-valencia/share-to-teams-third-party.js":[null],"./ca-es-valencia/share-to-teams.js":[228320,610544],"./ca-es-valencia/shortcut.js":[74002,855715],"./ca-es-valencia/shortcuts.js":[554001,855715],"./ca-es-valencia/simple-collab.js":[606230,855715],"./ca-es-valencia/smart-device.js":[null],"./ca-es-valencia/survey.js":[86586,380058],"./ca-es-valencia/sv-flyout.js":[137969,855715],"./ca-es-valencia/teams-and-channels.js":[528589,593535],"./ca-es-valencia/teams-insider.js":[888907,855715],"./ca-es-valencia/telemetry.js":[947065,855715],"./ca-es-valencia/tfl-homepage.js":[880621,855715],"./ca-es-valencia/tfl-onboarding.js":[724768,855715],"./ca-es-valencia/toast-notifications.js":[177412,855715],"./ca-es-valencia/trusted-ui.js":[null],"./ca-es-valencia/unified-search.js":[603681,610544],"./ca-es-valencia/unsupported-browser.js":[null],"./ca-es-valencia/url-preview.js":[324534,855715],"./ca-es-valencia/video-capture.js":[939622,915406],"./ca-es-valencia/video-message.js":[551703,40885],"./ca-es-valencia/virtual-consumer-events.js":[667370,893444],"./ca-es-valencia/virtual-events.js":[412463,274856],"./ca-es-valencia/webinar.js":[212872,525044],"./ca-es-valencia/welcome-bot.js":[null],"./ca-es-valencia/whats-new.js":[430326,855715],"./ca-es-valencia/wiki.js":[null],"./ca-es/activity.js":[379029,76009],"./ca-es/artifacts-platform.js":[853037,101721],"./ca-es/audience-view-dialog.js":[457375,426227],"./ca-es/auth.js":[483966,76009],"./ca-es/autosuggest.js":[82797,76009],"./ca-es/avatar.js":[316221,76009],"./ca-es/biometric-enrollment.js":[397561,788377],"./ca-es/breakout-rooms.js":[493360,380304],"./ca-es/broadcast-scheduling.js":[210996,285456],"./ca-es/broadcast.js":[922837,709509],"./ca-es/calendar.js":[232602,678634],"./ca-es/calling.js":[663374,460770],"./ca-es/campaign-notifications.js":[177875,76009],"./ca-es/carousel-multi-card.js":[null],"./ca-es/cast.js":[499227,76009],"./ca-es/channels.js":[146240,76009],"./ca-es/chat-list.js":[804543,76009],"./ca-es/coach-report.js":[123019,399583],"./ca-es/comment-stream.js":[993224,437100],"./ca-es/communities.js":[782351,76009],"./ca-es/compose.js":[616182,76009],"./ca-es/contacts.js":[944389,76009],"./ca-es/datepicker.js":[807742,370596],"./ca-es/desktop.js":[48642,900318],"./ca-es/digital-signage.js":[null],"./ca-es/discover-surface.js":[543573,777729],"./ca-es/edu.js":[548598,369670],"./ca-es/embed.js":[703667,76009],"./ca-es/errors.js":[302407,76009],"./ca-es/esp.js":[500706,638886],"./ca-es/extensibility-ptz-extension.js":[null],"./ca-es/extensibility-room-remote.js":[null],"./ca-es/extensibility.js":[252687,76009],"./ca-es/feedback.js":[834903,887195],"./ca-es/files.js":[54173,76009],"./ca-es/framework.js":[275574,76009],"./ca-es/freemium-upgrade.js":[null],"./ca-es/funstuff.js":[442045,886625],"./ca-es/gallery.js":[297220,921832],"./ca-es/growth.js":[819003,76009],"./ca-es/guardians.js":[45226,158810],"./ca-es/health.js":[387614,29466],"./ca-es/help.js":[994655,423373],"./ca-es/hololens.js":[38076,460770],"./ca-es/host-controls.js":[431805,637161],"./ca-es/jana.js":[498016,729636],"./ca-es/lightbox.js":[183469,76009],"./ca-es/links.js":[685147,76009],"./ca-es/live-persona-card.js":[645210,76009],"./ca-es/live-persona-editor.js":[508053,180589],"./ca-es/lms-integration.js":[null],"./ca-es/meet-for-work.js":[433123,919471],"./ca-es/meeting-analytics.js":[111994,509830],"./ca-es/meeting-apis-app.js":[null],"./ca-es/meeting-bot.js":[null],"./ca-es/meeting-collaboration.js":[489499,137583],"./ca-es/meeting-flyout.js":[668403,76009],"./ca-es/meeting-meet-app.js":[500833,76009],"./ca-es/meeting-options.js":[789164,355328],"./ca-es/meeting-recap.js":[207925,566345],"./ca-es/meeting-room-console.js":[null],"./ca-es/meeting-stream-app.js":[null],"./ca-es/messaging.js":[939054,76009],"./ca-es/mobile-attach.js":[null],"./ca-es/mtma-missed-notifications.js":[795072,76009],"./ca-es/nearby.js":[180859,76009],"./ca-es/nova.js":[161314,76009],"./ca-es/people-app.js":[null],"./ca-es/people-picker.js":[666718,76009],"./ca-es/people-targeting.js":[329889,937725],"./ca-es/people.js":[234375,76009],"./ca-es/person.js":[129329,76009],"./ca-es/phonelink-sms.js":[613542,80334],"./ca-es/pre-core.js":[null],"./ca-es/premium-benefits.js":[784112,667980],"./ca-es/presence.js":[169445,76009],"./ca-es/queues.js":[880872,670348],"./ca-es/recurrence.js":[891166,104490],"./ca-es/rsc-application-permissions.js":[null],"./ca-es/search.js":[331352,370596],"./ca-es/semantic-object.js":[349378,342462],"./ca-es/settings.js":[571457,76009],"./ca-es/share-in-meetings.js":[null],"./ca-es/share-to-teams-outlook-addin.js":[null],"./ca-es/share-to-teams-third-party.js":[null],"./ca-es/share-to-teams.js":[559864,289960],"./ca-es/shortcut.js":[941434,76009],"./ca-es/shortcuts.js":[417993,76009],"./ca-es/simple-collab.js":[74494,76009],"./ca-es/smart-device.js":[null],"./ca-es/survey.js":[253650,346770],"./ca-es/sv-flyout.js":[191497,76009],"./ca-es/teams-and-channels.js":[501,888725],"./ca-es/teams-insider.js":[768595,76009],"./ca-es/telemetry.js":[326145,76009],"./ca-es/tfl-homepage.js":[960485,76009],"./ca-es/tfl-onboarding.js":[267960,76009],"./ca-es/toast-notifications.js":[642412,76009],"./ca-es/trusted-ui.js":[null],"./ca-es/unified-search.js":[586009,289960],"./ca-es/unsupported-browser.js":[null],"./ca-es/url-preview.js":[670910,76009],"./ca-es/video-capture.js":[210798,874742],"./ca-es/video-message.js":[753903,710451],"./ca-es/virtual-consumer-events.js":[838402,384460],"./ca-es/virtual-events.js":[541175,615120],"./ca-es/webinar.js":[682848,912316],"./ca-es/welcome-bot.js":[null],"./ca-es/whats-new.js":[537246,76009],"./ca-es/wiki.js":[null],"./cs-cz/activity.js":[719444,881616],"./cs-cz/artifacts-platform.js":[757324,525344],"./cs-cz/audience-view-dialog.js":[826354,209210],"./cs-cz/auth.js":[845847,881616],"./cs-cz/autosuggest.js":[408502,881616],"./cs-cz/avatar.js":[91784,881616],"./cs-cz/biometric-enrollment.js":[831708,212e3],"./cs-cz/breakout-rooms.js":[125593,100369],"./cs-cz/broadcast-scheduling.js":[732521,489169],"./cs-cz/broadcast.js":[70502,13732],"./cs-cz/calendar.js":[157419,409091],"./cs-cz/calling.js":[684933,27467],"./cs-cz/campaign-notifications.js":[354994,881616],"./cs-cz/carousel-multi-card.js":[null],"./cs-cz/cast.js":[447362,881616],"./cs-cz/channels.js":[357493,881616],"./cs-cz/chat-list.js":[122776,881616],"./cs-cz/coach-report.js":[244798,534190],"./cs-cz/comment-stream.js":[311969,147125],"./cs-cz/communities.js":[322204,881616],"./cs-cz/compose.js":[618885,881616],"./cs-cz/contacts.js":[73824,881616],"./cs-cz/datepicker.js":[52227,399357],"./cs-cz/desktop.js":[474237,285647],"./cs-cz/digital-signage.js":[null],"./cs-cz/discover-surface.js":[314504,705464],"./cs-cz/edu.js":[951013,553575],"./cs-cz/embed.js":[83700,881616],"./cs-cz/errors.js":[371094,881616],"./cs-cz/esp.js":[203185,556039],"./cs-cz/extensibility-ptz-extension.js":[null],"./cs-cz/extensibility-room-remote.js":[null],"./cs-cz/extensibility.js":[534720,881616],"./cs-cz/feedback.js":[793122,307666],"./cs-cz/files.js":[920294,881616],"./cs-cz/framework.js":[428313,881616],"./cs-cz/freemium-upgrade.js":[null],"./cs-cz/funstuff.js":[479484,788952],"./cs-cz/gallery.js":[288891,243577],"./cs-cz/growth.js":[235522,881616],"./cs-cz/guardians.js":[402937,321683],"./cs-cz/health.js":[760799,311571],"./cs-cz/help.js":[466902,653084],"./cs-cz/hololens.js":[356765,27467],"./cs-cz/host-controls.js":[360366,442768],"./cs-cz/jana.js":[625253,758397],"./cs-cz/lightbox.js":[521560,881616],"./cs-cz/links.js":[566200,881616],"./cs-cz/live-persona-card.js":[999381,881616],"./cs-cz/live-persona-editor.js":[96926,935420],"./cs-cz/lms-integration.js":[null],"./cs-cz/meet-for-work.js":[337012,233246],"./cs-cz/meeting-analytics.js":[638377,693735],"./cs-cz/meeting-apis-app.js":[null],"./cs-cz/meeting-bot.js":[null],"./cs-cz/meeting-collaboration.js":[261920,451358],"./cs-cz/meeting-flyout.js":[880202,881616],"./cs-cz/meeting-meet-app.js":[43960,881616],"./cs-cz/meeting-options.js":[749839,669857],"./cs-cz/meeting-recap.js":[477434,215408],"./cs-cz/meeting-room-console.js":[null],"./cs-cz/meeting-stream-app.js":[null],"./cs-cz/messaging.js":[773085,881616],"./cs-cz/mobile-attach.js":[null],"./cs-cz/mtma-missed-notifications.js":[194315,881616],"./cs-cz/nearby.js":[605762,881616],"./cs-cz/nova.js":[989579,881616],"./cs-cz/people-app.js":[null],"./cs-cz/people-picker.js":[536561,881616],"./cs-cz/people-targeting.js":[479216,119340],"./cs-cz/people.js":[284650,881616],"./cs-cz/person.js":[297972,881616],"./cs-cz/phonelink-sms.js":[342093,462175],"./cs-cz/pre-core.js":[null],"./cs-cz/premium-benefits.js":[462633,171605],"./cs-cz/presence.js":[444724,881616],"./cs-cz/queues.js":[398517,139797],"./cs-cz/recurrence.js":[849527,352771],"./cs-cz/rsc-application-permissions.js":[null],"./cs-cz/search.js":[522133,399357],"./cs-cz/semantic-object.js":[840109,37359],"./cs-cz/settings.js":[747772,881616],"./cs-cz/share-in-meetings.js":[null],"./cs-cz/share-to-teams-outlook-addin.js":[null],"./cs-cz/share-to-teams-third-party.js":[null],"./cs-cz/share-to-teams.js":[898641,35001],"./cs-cz/shortcut.js":[769699,881616],"./cs-cz/shortcuts.js":[688646,881616],"./cs-cz/simple-collab.js":[395449,881616],"./cs-cz/smart-device.js":[null],"./cs-cz/survey.js":[394195,97051],"./cs-cz/sv-flyout.js":[662770,881616],"./cs-cz/teams-and-channels.js":[163188,126036],"./cs-cz/teams-insider.js":[557580,881616],"./cs-cz/telemetry.js":[393362,881616],"./cs-cz/tfl-homepage.js":[636732,881616],"./cs-cz/tfl-onboarding.js":[443273,881616],"./cs-cz/toast-notifications.js":[510819,881616],"./cs-cz/trusted-ui.js":[null],"./cs-cz/unified-search.js":[258348,35001],"./cs-cz/unsupported-browser.js":[null],"./cs-cz/url-preview.js":[37113,881616],"./cs-cz/video-capture.js":[50033,197431],"./cs-cz/video-message.js":[91328,493434],"./cs-cz/virtual-consumer-events.js":[501117,888085],"./cs-cz/virtual-events.js":[747286,335185],"./cs-cz/webinar.js":[593051,22821],"./cs-cz/welcome-bot.js":[null],"./cs-cz/whats-new.js":[10461,881616],"./cs-cz/wiki.js":[null],"./cy-gb/activity.js":[994946,99222],"./cy-gb/artifacts-platform.js":[163454,713926],"./cy-gb/audience-view-dialog.js":[15528,683268],"./cy-gb/auth.js":[261565,99222],"./cy-gb/autosuggest.js":[905164,99222],"./cy-gb/avatar.js":[348358,99222],"./cy-gb/biometric-enrollment.js":[444474,884230],"./cy-gb/breakout-rooms.js":[647663,868811],"./cy-gb/broadcast-scheduling.js":[855779,773963],"./cy-gb/broadcast.js":[867252,315330],"./cy-gb/calendar.js":[659477,52353],"./cy-gb/calling.js":[897051,233449],"./cy-gb/campaign-notifications.js":[122608,99222],"./cy-gb/carousel-multi-card.js":[null],"./cy-gb/cast.js":[868928,99222],"./cy-gb/channels.js":[292107,99222],"./cy-gb/chat-list.js":[137810,99222],"./cy-gb/coach-report.js":[234220,746496],"./cy-gb/comment-stream.js":[145163,501383],"./cy-gb/communities.js":[626806,99222],"./cy-gb/compose.js":[166055,99222],"./cy-gb/contacts.js":[832114,99222],"./cy-gb/datepicker.js":[370717,698127],"./cy-gb/desktop.js":[194779,545749],"./cy-gb/digital-signage.js":[null],"./cy-gb/discover-surface.js":[551722,429950],"./cy-gb/edu.js":[779943,71501],"./cy-gb/embed.js":[312482,99222],"./cy-gb/errors.js":[988048,99222],"./cy-gb/esp.js":[780295,557613],"./cy-gb/extensibility-ptz-extension.js":[null],"./cy-gb/extensibility-room-remote.js":[null],"./cy-gb/extensibility.js":[961718,99222],"./cy-gb/feedback.js":[335128,649916],"./cy-gb/files.js":[18400,99222],"./cy-gb/framework.js":[322475,99222],"./cy-gb/freemium-upgrade.js":[null],"./cy-gb/funstuff.js":[460174,962142],"./cy-gb/gallery.js":[10109,725651],"./cy-gb/growth.js":[372992,99222],"./cy-gb/guardians.js":[316483,685553],"./cy-gb/health.js":[932437,98737],"./cy-gb/help.js":[443644,45434],"./cy-gb/hololens.js":[458051,233449],"./cy-gb/host-controls.js":[18480,144022],"./cy-gb/jana.js":[15627,57167],"./cy-gb/lightbox.js":[700706,99222],"./cy-gb/links.js":[935318,99222],"./cy-gb/live-persona-card.js":[799403,99222],"./cy-gb/live-persona-editor.js":[719692,518490],"./cy-gb/lms-integration.js":[null],"./cy-gb/meet-for-work.js":[974714,255632],"./cy-gb/meeting-analytics.js":[901751,695309],"./cy-gb/meeting-apis-app.js":[null],"./cy-gb/meeting-bot.js":[null],"./cy-gb/meeting-collaboration.js":[375526,931216],"./cy-gb/meeting-flyout.js":[503568,99222],"./cy-gb/meeting-meet-app.js":[136974,99222],"./cy-gb/meeting-options.js":[734705,632635],"./cy-gb/meeting-recap.js":[100900,649910],"./cy-gb/meeting-room-console.js":[null],"./cy-gb/meeting-stream-app.js":[null],"./cy-gb/messaging.js":[868387,99222],"./cy-gb/mobile-attach.js":[null],"./cy-gb/mtma-missed-notifications.js":[321937,99222],"./cy-gb/nearby.js":[835444,99222],"./cy-gb/nova.js":[215933,99222],"./cy-gb/people-app.js":[null],"./cy-gb/people-picker.js":[298907,99222],"./cy-gb/people-targeting.js":[345586,753066],"./cy-gb/people.js":[462604,99222],"./cy-gb/person.js":[830938,99222],"./cy-gb/phonelink-sms.js":[212615,522437],"./cy-gb/pre-core.js":[null],"./cy-gb/premium-benefits.js":[716507,474279],"./cy-gb/presence.js":[549650,99222],"./cy-gb/queues.js":[298319,958823],"./cy-gb/recurrence.js":[329549,961857],"./cy-gb/rsc-application-permissions.js":[null],"./cy-gb/search.js":[616423,698127],"./cy-gb/semantic-object.js":[813923,411189],"./cy-gb/settings.js":[155458,99222],"./cy-gb/share-in-meetings.js":[null],"./cy-gb/share-to-teams-outlook-addin.js":[null],"./cy-gb/share-to-teams-third-party.js":[null],"./cy-gb/share-to-teams.js":[629143,636307],"./cy-gb/shortcut.js":[213849,99222],"./cy-gb/shortcuts.js":[860028,99222],"./cy-gb/simple-collab.js":[352115,99222],"./cy-gb/smart-device.js":[null],"./cy-gb/survey.js":[833157,131737],"./cy-gb/sv-flyout.js":[714732,99222],"./cy-gb/teams-and-channels.js":[434194,838290],"./cy-gb/teams-insider.js":[374798,99222],"./cy-gb/telemetry.js":[482976,99222],"./cy-gb/tfl-homepage.js":[41398,99222],"./cy-gb/tfl-onboarding.js":[78047,99222],"./cy-gb/toast-notifications.js":[104961,99222],"./cy-gb/trusted-ui.js":[null],"./cy-gb/unified-search.js":[867662,636307],"./cy-gb/unsupported-browser.js":[null],"./cy-gb/url-preview.js":[332243,99222],"./cy-gb/video-capture.js":[631531,1533],"./cy-gb/video-message.js":[123214,967492],"./cy-gb/virtual-consumer-events.js":[371535,707111],"./cy-gb/virtual-events.js":[998392,103627],"./cy-gb/webinar.js":[48093,486615],"./cy-gb/welcome-bot.js":[null],"./cy-gb/whats-new.js":[583295,99222],"./cy-gb/wiki.js":[null],"./da-dk/activity.js":[736245,793801],"./da-dk/artifacts-platform.js":[526477,31065],"./da-dk/audience-view-dialog.js":[725887,556799],"./da-dk/auth.js":[866462,793801],"./da-dk/autosuggest.js":[690253,793801],"./da-dk/avatar.js":[160029,793801],"./da-dk/biometric-enrollment.js":[985753,201369],"./da-dk/breakout-rooms.js":[556880,678940],"./da-dk/broadcast-scheduling.js":[796692,67740],"./da-dk/broadcast.js":[970357,856765],"./da-dk/calendar.js":[558970,119106],"./da-dk/calling.js":[407982,443114],"./da-dk/campaign-notifications.js":[731187,793801],"./da-dk/carousel-multi-card.js":[null],"./da-dk/cast.js":[420859,793801],"./da-dk/channels.js":[622688,793801],"./da-dk/chat-list.js":[465247,793801],"./da-dk/coach-report.js":[427051,658947],"./da-dk/comment-stream.js":[713448,271792],"./da-dk/communities.js":[166383,793801],"./da-dk/compose.js":[725782,793801],"./da-dk/contacts.js":[269605,793801],"./da-dk/datepicker.js":[715998,521080],"./da-dk/desktop.js":[567138,371230],"./da-dk/digital-signage.js":[null],"./da-dk/discover-surface.js":[614837,8401],"./da-dk/edu.js":[392086,894486],"./da-dk/embed.js":[155091,793801],"./da-dk/errors.js":[840231,793801],"./da-dk/esp.js":[561090,791990],"./da-dk/extensibility-ptz-extension.js":[null],"./da-dk/extensibility-room-remote.js":[null],"./da-dk/extensibility.js":[853039,793801],"./da-dk/feedback.js":[476663,900375],"./da-dk/files.js":[449725,793801],"./da-dk/framework.js":[378070,793801],"./da-dk/freemium-upgrade.js":[null],"./da-dk/funstuff.js":[337949,540593],"./da-dk/gallery.js":[356196,388164],"./da-dk/growth.js":[170779,793801],"./da-dk/guardians.js":[630154,405266],"./da-dk/health.js":[904702,383378],"./da-dk/help.js":[58815,408533],"./da-dk/hololens.js":[644444,443114],"./da-dk/host-controls.js":[801501,838601],"./da-dk/jana.js":[95296,880120],"./da-dk/lightbox.js":[829069,793801],"./da-dk/links.js":[680187,793801],"./da-dk/live-persona-card.js":[502394,793801],"./da-dk/live-persona-editor.js":[940981,644917],"./da-dk/lms-integration.js":[null],"./da-dk/meet-for-work.js":[808131,659379],"./da-dk/meeting-analytics.js":[180762,518294],"./da-dk/meeting-apis-app.js":[null],"./da-dk/meeting-bot.js":[null],"./da-dk/meeting-collaboration.js":[126011,227507],"./da-dk/meeting-flyout.js":[263635,793801],"./da-dk/meeting-meet-app.js":[348097,793801],"./da-dk/meeting-options.js":[311820,904108],"./da-dk/meeting-recap.js":[752341,292905],"./da-dk/meeting-room-console.js":[null],"./da-dk/meeting-stream-app.js":[null],"./da-dk/messaging.js":[68814,793801],"./da-dk/mobile-attach.js":[null],"./da-dk/mtma-missed-notifications.js":[504672,793801],"./da-dk/nearby.js":[532635,793801],"./da-dk/nova.js":[239874,793801],"./da-dk/people-app.js":[null],"./da-dk/people-picker.js":[663294,793801],"./da-dk/people-targeting.js":[635009,468325],"./da-dk/people.js":[308199,793801],"./da-dk/person.js":[360081,793801],"./da-dk/phonelink-sms.js":[188550,901934],"./da-dk/pre-core.js":[null],"./da-dk/premium-benefits.js":[242896,705168],"./da-dk/presence.js":[773829,793801],"./da-dk/queues.js":[123848,687760],"./da-dk/recurrence.js":[952062,2434],"./da-dk/rsc-application-permissions.js":[null],"./da-dk/search.js":[594040,521080],"./da-dk/semantic-object.js":[11874,787198],"./da-dk/settings.js":[644321,793801],"./da-dk/share-in-meetings.js":[null],"./da-dk/share-to-teams-outlook-addin.js":[null],"./da-dk/share-to-teams-third-party.js":[null],"./da-dk/share-to-teams.js":[326680,298820],"./da-dk/shortcut.js":[433754,793801],"./da-dk/shortcuts.js":[20905,793801],"./da-dk/simple-collab.js":[785246,793801],"./da-dk/smart-device.js":[null],"./da-dk/survey.js":[756338,918010],"./da-dk/sv-flyout.js":[242025,793801],"./da-dk/teams-and-channels.js":[172245,775789],"./da-dk/teams-insider.js":[669939,793801],"./da-dk/telemetry.js":[259425,793801],"./da-dk/tfl-homepage.js":[374597,793801],"./da-dk/tfl-onboarding.js":[967704,793801],"./da-dk/toast-notifications.js":[686476,793801],"./da-dk/trusted-ui.js":[null],"./da-dk/unified-search.js":[42489,298820],"./da-dk/unsupported-browser.js":[null],"./da-dk/url-preview.js":[845214,793801],"./da-dk/video-capture.js":[962254,370105],"./da-dk/video-message.js":[369423,841023],"./da-dk/virtual-consumer-events.js":[12130,421648],"./da-dk/virtual-events.js":[491799,913756],"./da-dk/webinar.js":[308800,476256],"./da-dk/welcome-bot.js":[null],"./da-dk/whats-new.js":[629630,793801],"./da-dk/wiki.js":[null],"./de-de/activity.js":[574011,259291],"./de-de/artifacts-platform.js":[699647,496555],"./de-de/audience-view-dialog.js":[949565,200301],"./de-de/auth.js":[593452,259291],"./de-de/autosuggest.js":[866843,259291],"./de-de/avatar.js":[847019,259291],"./de-de/biometric-enrollment.js":[61511,666859],"./de-de/breakout-rooms.js":[261974,925414],"./de-de/broadcast-scheduling.js":[880550,314214],"./de-de/broadcast.js":[834971,654143],"./de-de/calendar.js":[435820,497216],"./de-de/calling.js":[121212,332888],"./de-de/campaign-notifications.js":[610769,259291],"./de-de/carousel-multi-card.js":[null],"./de-de/cast.js":[853713,259291],"./de-de/channels.js":[519526,259291],"./de-de/chat-list.js":[640529,259291],"./de-de/coach-report.js":[986105,903537],"./de-de/comment-stream.js":[949466,276554],"./de-de/communities.js":[423297,259291],"./de-de/compose.js":[221248,259291],"./de-de/contacts.js":[54479,259291],"./de-de/datepicker.js":[416432,82178],"./de-de/desktop.js":[853008,612540],"./de-de/digital-signage.js":[null],"./de-de/discover-surface.js":[931535,400691],"./de-de/edu.js":[703008,994724],"./de-de/embed.js":[98129,259291],"./de-de/errors.js":[966993,259291],"./de-de/esp.js":[890640,997188],"./de-de/extensibility-ptz-extension.js":[null],"./de-de/extensibility-room-remote.js":[null],"./de-de/extensibility.js":[982045,259291],"./de-de/feedback.js":[12869,974165],"./de-de/files.js":[972047,259291],"./de-de/framework.js":[676672,259291],"./de-de/freemium-upgrade.js":[null],"./de-de/funstuff.js":[666167,46611],"./de-de/gallery.js":[774374,578494],"./de-de/growth.js":[175537,259291],"./de-de/guardians.js":[300484,560016],"./de-de/health.js":[135668,445072],"./de-de/help.js":[114109,710631],"./de-de/hololens.js":[525234,332888],"./de-de/host-controls.js":[476735,304091],"./de-de/jana.js":[146470,441218],"./de-de/lightbox.js":[316751,259291],"./de-de/links.js":[102209,259291],"./de-de/live-persona-card.js":[929616,259291],"./de-de/live-persona-editor.js":[798107,482247],"./de-de/lms-integration.js":[null],"./de-de/meet-for-work.js":[934969,361441],"./de-de/meeting-analytics.js":[235560,134884],"./de-de/meeting-apis-app.js":[null],"./de-de/meeting-bot.js":[null],"./de-de/meeting-collaboration.js":[685353,48801],"./de-de/meeting-flyout.js":[172161,259291],"./de-de/meeting-meet-app.js":[422447,259291],"./de-de/meeting-options.js":[53078,344438],"./de-de/meeting-recap.js":[396223,267451],"./de-de/meeting-room-console.js":[null],"./de-de/meeting-stream-app.js":[null],"./de-de/messaging.js":[892436,259291],"./de-de/mobile-attach.js":[null],"./de-de/mtma-missed-notifications.js":[265726,259291],"./de-de/nearby.js":[655453,259291],"./de-de/nova.js":[355860,259291],"./de-de/people-app.js":[null],"./de-de/people-picker.js":[693352,259291],"./de-de/people-targeting.js":[284107,770423],"./de-de/people.js":[918313,259291],"./de-de/person.js":[230567,259291],"./de-de/phonelink-sms.js":[183560,986892],"./de-de/pre-core.js":[null],"./de-de/premium-benefits.js":[611194,709930],"./de-de/presence.js":[860187,259291],"./de-de/queues.js":[724314,243050],"./de-de/recurrence.js":[720276,406720],"./de-de/rsc-application-permissions.js":[null],"./de-de/search.js":[840778,82178],"./de-de/semantic-object.js":[235104,106268],"./de-de/settings.js":[128575,259291],"./de-de/share-in-meetings.js":[null],"./de-de/share-to-teams-outlook-addin.js":[null],"./de-de/share-to-teams-third-party.js":[null],"./de-de/share-to-teams.js":[290750,396094],"./de-de/shortcut.js":[126312,259291],"./de-de/shortcuts.js":[419831,259291],"./de-de/simple-collab.js":[249392,259291],"./de-de/smart-device.js":[null],"./de-de/survey.js":[740604,459112],"./de-de/sv-flyout.js":[689579,259291],"./de-de/teams-and-channels.js":[256323,426351],"./de-de/teams-insider.js":[656181,259291],"./de-de/telemetry.js":[668079,259291],"./de-de/tfl-homepage.js":[484279,259291],"./de-de/tfl-onboarding.js":[821838,259291],"./de-de/toast-notifications.js":[643690,259291],"./de-de/trusted-ui.js":[null],"./de-de/unified-search.js":[618987,396094],"./de-de/unsupported-browser.js":[null],"./de-de/url-preview.js":[706472,259291],"./de-de/video-capture.js":[30568,767348],"./de-de/video-message.js":[89613,484525],"./de-de/virtual-consumer-events.js":[320932,426410],"./de-de/virtual-events.js":[781057,160230],"./de-de/webinar.js":[729434,525818],"./de-de/welcome-bot.js":[null],"./de-de/whats-new.js":[482200,259291],"./de-de/wiki.js":[null],"./el-gr/activity.js":[533715,451935],"./el-gr/artifacts-platform.js":[381047,286031],"./el-gr/audience-view-dialog.js":[482405,467729],"./el-gr/auth.js":[357572,451935],"./el-gr/autosuggest.js":[192163,451935],"./el-gr/avatar.js":[691667,451935],"./el-gr/biometric-enrollment.js":[84959,972687],"./el-gr/breakout-rooms.js":[917470,125614],"./el-gr/broadcast-scheduling.js":[713966,514414],"./el-gr/broadcast.js":[126115,862939],"./el-gr/calendar.js":[152820,981760],"./el-gr/calling.js":[292788,466696],"./el-gr/campaign-notifications.js":[56489,451935],"./el-gr/carousel-multi-card.js":[null],"./el-gr/cast.js":[411929,451935],"./el-gr/channels.js":[166350,451935],"./el-gr/chat-list.js":[951337,451935],"./el-gr/coach-report.js":[434817,475805],"./el-gr/comment-stream.js":[10850,849914],"./el-gr/communities.js":[486105,451935],"./el-gr/compose.js":[176712,451935],"./el-gr/contacts.js":[241335,451935],"./el-gr/datepicker.js":[92536,381602],"./el-gr/desktop.js":[988584,149844],"./el-gr/digital-signage.js":[null],"./el-gr/discover-surface.js":[233927,858695],"./el-gr/edu.js":[710808,14668],"./el-gr/embed.js":[462361,451935],"./el-gr/errors.js":[693737,451935],"./el-gr/esp.js":[875400,500780],"./el-gr/extensibility-ptz-extension.js":[null],"./el-gr/extensibility-room-remote.js":[null],"./el-gr/extensibility.js":[126949,451935],"./el-gr/feedback.js":[113277,232361],"./el-gr/files.js":[958823,451935],"./el-gr/framework.js":[511080,451935],"./el-gr/freemium-upgrade.js":[null],"./el-gr/funstuff.js":[3599,550567],"./el-gr/gallery.js":[98030,857110],"./el-gr/growth.js":[109497,451935],"./el-gr/guardians.js":[71324,215856],"./el-gr/health.js":[837164,100912],"./el-gr/help.js":[535045,560595],"./el-gr/hololens.js":[116538,466696],"./el-gr/host-controls.js":[530247,13087],"./el-gr/jana.js":[43598,224290],"./el-gr/lightbox.js":[397479,451935],"./el-gr/links.js":[258873,451935],"./el-gr/live-persona-card.js":[301832,451935],"./el-gr/live-persona-editor.js":[574067,366387],"./el-gr/lms-integration.js":[null],"./el-gr/meet-for-work.js":[128113,848877],"./el-gr/meeting-analytics.js":[974688,638476],"./el-gr/meeting-apis-app.js":[null],"./el-gr/meeting-bot.js":[null],"./el-gr/meeting-collaboration.js":[762769,490285],"./el-gr/meeting-flyout.js":[691673,451935],"./el-gr/meeting-meet-app.js":[614807,451935],"./el-gr/meeting-options.js":[476366,528926],"./el-gr/meeting-recap.js":[446679,2623],"./el-gr/meeting-room-console.js":[null],"./el-gr/meeting-stream-app.js":[null],"./el-gr/messaging.js":[97820,451935],"./el-gr/mobile-attach.js":[null],"./el-gr/mtma-missed-notifications.js":[746054,451935],"./el-gr/nearby.js":[96485,451935],"./el-gr/nova.js":[558332,451935],"./el-gr/people-app.js":[null],"./el-gr/people-picker.js":[287728,451935],"./el-gr/people-targeting.js":[824387,523779],"./el-gr/people.js":[571377,451935],"./el-gr/person.js":[526575,451935],"./el-gr/phonelink-sms.js":[610864,722436],"./el-gr/pre-core.js":[null],"./el-gr/premium-benefits.js":[678594,859994],"./el-gr/presence.js":[943699,451935],"./el-gr/queues.js":[40098,285658],"./el-gr/recurrence.js":[345868,407616],"./el-gr/rsc-application-permissions.js":[null],"./el-gr/search.js":[885122,381602],"./el-gr/semantic-object.js":[836728,643572],"./el-gr/settings.js":[410439,451935],"./el-gr/share-in-meetings.js":[null],"./el-gr/share-to-teams-outlook-addin.js":[null],"./el-gr/share-to-teams-third-party.js":[null],"./el-gr/share-to-teams.js":[795542,648534],"./el-gr/shortcut.js":[762576,451935],"./el-gr/shortcuts.js":[816527,451935],"./el-gr/simple-collab.js":[780856,451935],"./el-gr/smart-device.js":[null],"./el-gr/survey.js":[104404,352696],"./el-gr/sv-flyout.js":[264419,451935],"./el-gr/teams-and-channels.js":[333547,600939],"./el-gr/teams-insider.js":[162589,451935],"./el-gr/telemetry.js":[196887,451935],"./el-gr/tfl-homepage.js":[440463,451935],"./el-gr/tfl-onboarding.js":[821510,451935],"./el-gr/toast-notifications.js":[317234,451935],"./el-gr/trusted-ui.js":[null],"./el-gr/unified-search.js":[68131,648534],"./el-gr/unsupported-browser.js":[null],"./el-gr/url-preview.js":[375280,451935],"./el-gr/video-capture.js":[4432,561276],"./el-gr/video-message.js":[445829,751953],"./el-gr/virtual-consumer-events.js":[184892,576474],"./el-gr/virtual-events.js":[781993,360430],"./el-gr/webinar.js":[416946,268874],"./el-gr/welcome-bot.js":[null],"./el-gr/whats-new.js":[246368,451935],"./el-gr/wiki.js":[null],"./en-gb/activity.js":[747629,442801],"./en-gb/artifacts-platform.js":[485669,956545],"./en-gb/audience-view-dialog.js":[189095,538847],"./en-gb/auth.js":[296534,442801],"./en-gb/autosuggest.js":[830165,442801],"./en-gb/avatar.js":[716741,442801],"./en-gb/biometric-enrollment.js":[332561,643201],"./en-gb/breakout-rooms.js":[711512,837036],"./en-gb/broadcast-scheduling.js":[792252,742188],"./en-gb/broadcast.js":[701565,696829],"./en-gb/calendar.js":[263170,426770],"./en-gb/calling.js":[478278,77018],"./en-gb/campaign-notifications.js":[333931,442801],"./en-gb/carousel-multi-card.js":[null],"./en-gb/cast.js":[955523,442801],"./en-gb/channels.js":[171752,442801],"./en-gb/chat-list.js":[457527,442801],"./en-gb/coach-report.js":[368147,270203],"./en-gb/comment-stream.js":[191472,627784],"./en-gb/communities.js":[701383,442801],"./en-gb/compose.js":[658238,442801],"./en-gb/contacts.js":[904749,442801],"./en-gb/datepicker.js":[846054,988176],"./en-gb/desktop.js":[361722,523382],"./en-gb/digital-signage.js":[null],"./en-gb/discover-surface.js":[144685,519449],"./en-gb/edu.js":[283182,564942],"./en-gb/embed.js":[117691,442801],"./en-gb/errors.js":[493407,442801],"./en-gb/esp.js":[427674,999470],"./en-gb/extensibility-ptz-extension.js":[null],"./en-gb/extensibility-room-remote.js":[null],"./en-gb/extensibility.js":[530743,442801],"./en-gb/feedback.js":[506223,348727],"./en-gb/files.js":[778677,442801],"./en-gb/framework.js":[928446,442801],"./en-gb/freemium-upgrade.js":[null],"./en-gb/funstuff.js":[473397,211321],"./en-gb/gallery.js":[57996,700468],"./en-gb/growth.js":[646755,442801],"./en-gb/guardians.js":[83330,603298],"./en-gb/health.js":[931094,488354],"./en-gb/help.js":[340679,86005],"./en-gb/hololens.js":[754372,77018],"./en-gb/host-controls.js":[114949,487601],"./en-gb/jana.js":[191496,830864],"./en-gb/lightbox.js":[303589,442801],"./en-gb/links.js":[159539,442801],"./en-gb/live-persona-card.js":[514770,442801],"./en-gb/live-persona-editor.js":[338349,891797],"./en-gb/lms-integration.js":[null],"./en-gb/meet-for-work.js":[525499,308459],"./en-gb/meeting-analytics.js":[335666,188750],"./en-gb/meeting-apis-app.js":[null],"./en-gb/meeting-bot.js":[null],"./en-gb/meeting-collaboration.js":[291395,526571],"./en-gb/meeting-flyout.js":[392203,442801],"./en-gb/meeting-meet-app.js":[136905,442801],"./en-gb/meeting-options.js":[736324,807356],"./en-gb/meeting-recap.js":[694541,776593],"./en-gb/meeting-room-console.js":[null],"./en-gb/meeting-stream-app.js":[null],"./en-gb/messaging.js":[904246,442801],"./en-gb/mobile-attach.js":[null],"./en-gb/mtma-missed-notifications.js":[648552,442801],"./en-gb/nearby.js":[978403,442801],"./en-gb/nova.js":[367082,442801],"./en-gb/people-app.js":[null],"./en-gb/people-picker.js":[48998,442801],"./en-gb/people-targeting.js":[978105,968581],"./en-gb/people.js":[493903,442801],"./en-gb/person.js":[504185,442801],"./en-gb/phonelink-sms.js":[28846,296390],"./en-gb/pre-core.js":[null],"./en-gb/premium-benefits.js":[622072,895848],"./en-gb/presence.js":[124317,442801],"./en-gb/queues.js":[596080,898216],"./en-gb/recurrence.js":[621526,336274],"./en-gb/rsc-application-permissions.js":[null],"./en-gb/search.js":[678224,988176],"./en-gb/semantic-object.js":[240026,223510],"./en-gb/settings.js":[812777,442801],"./en-gb/share-in-meetings.js":[null],"./en-gb/share-to-teams-outlook-addin.js":[null],"./en-gb/share-to-teams-third-party.js":[null],"./en-gb/share-to-teams.js":[805808,68596],"./en-gb/shortcut.js":[924834,442801],"./en-gb/shortcuts.js":[347873,442801],"./en-gb/simple-collab.js":[416998,442801],"./en-gb/smart-device.js":[null],"./en-gb/survey.js":[396234,740138],"./en-gb/sv-flyout.js":[703201,442801],"./en-gb/teams-and-channels.js":[93405,823021],"./en-gb/teams-insider.js":[639963,442801],"./en-gb/telemetry.js":[295689,442801],"./en-gb/tfl-homepage.js":[519389,442801],"./en-gb/tfl-onboarding.js":[274640,442801],"./en-gb/toast-notifications.js":[257300,442801],"./en-gb/trusted-ui.js":[null],"./en-gb/unified-search.js":[62769,68596],"./en-gb/unsupported-browser.js":[null],"./en-gb/url-preview.js":[634950,442801],"./en-gb/video-capture.js":[754326,615262],"./en-gb/video-message.js":[898631,823071],"./en-gb/virtual-consumer-events.js":[703674,612328],"./en-gb/virtual-events.js":[912255,71852],"./en-gb/webinar.js":[120088,875448],"./en-gb/welcome-bot.js":[null],"./en-gb/whats-new.js":[436998,442801],"./en-gb/wiki.js":[null],"./en-us/activity.js":[592150,531106],"./en-us/artifacts-platform.js":[582130,449842],"./en-us/audience-view-dialog.js":[53540,996636],"./en-us/auth.js":[648873,531106],"./en-us/autosuggest.js":[291424,531106],"./en-us/avatar.js":[870786,531106],"./en-us/biometric-enrollment.js":[101446,136498],"./en-us/breakout-rooms.js":[176731,769283],"./en-us/broadcast-scheduling.js":[626911,158083],"./en-us/broadcast.js":[669776,179310],"./en-us/calendar.js":[557681,525549],"./en-us/calling.js":[114623,413749],"./en-us/campaign-notifications.js":[389172,531106],"./en-us/carousel-multi-card.js":[null],"./en-us/cast.js":[365156,531106],"./en-us/channels.js":[184679,531106],"./en-us/chat-list.js":[208886,531106],"./en-us/coach-report.js":[182384,281816],"./en-us/comment-stream.js":[988199,377919],"./en-us/communities.js":[518258,531106],"./en-us/compose.js":[385963,531106],"./en-us/contacts.js":[891838,531106],"./en-us/datepicker.js":[959049,388007],"./en-us/desktop.js":[753503,86929],"./en-us/digital-signage.js":[null],"./en-us/discover-surface.js":[583254,885738],"./en-us/edu.js":[379219,962025],"./en-us/embed.js":[705558,531106],"./en-us/errors.js":[557036,531106],"./en-us/esp.js":[924675,964489],"./en-us/extensibility-ptz-extension.js":[null],"./en-us/extensibility-room-remote.js":[null],"./en-us/extensibility.js":[517306,531106],"./en-us/feedback.js":[274436,229812],"./en-us/files.js":[785420,531106],"./en-us/framework.js":[569911,531106],"./en-us/freemium-upgrade.js":[null],"./en-us/funstuff.js":[379138,906],"./en-us/gallery.js":[467681,227307],"./en-us/growth.js":[890700,531106],"./en-us/guardians.js":[809447,530365],"./en-us/health.js":[597209,508477],"./en-us/help.js":[983704,408006],"./en-us/hololens.js":[762479,413749],"./en-us/host-controls.js":[879716,575906],"./en-us/jana.js":[848159,230695],"./en-us/lightbox.js":[301054,531106],"./en-us/links.js":[695338,531106],"./en-us/live-persona-card.js":[51351,531106],"./en-us/live-persona-editor.js":[376928,162214],"./en-us/lms-integration.js":[null],"./en-us/meet-for-work.js":[456494,421192],"./en-us/meeting-analytics.js":[741611,102185],"./en-us/meeting-apis-app.js":[null],"./en-us/meeting-bot.js":[null],"./en-us/meeting-collaboration.js":[629050,62600],"./en-us/meeting-flyout.js":[451404,531106],"./en-us/meeting-meet-app.js":[775690,531106],"./en-us/meeting-options.js":[899789,212435],"./en-us/meeting-recap.js":[56296,916482],"./en-us/meeting-room-console.js":[null],"./en-us/meeting-stream-app.js":[null],"./en-us/messaging.js":[540671,531106],"./en-us/mobile-attach.js":[null],"./en-us/mtma-missed-notifications.js":[192493,531106],"./en-us/nearby.js":[858384,531106],"./en-us/nova.js":[340385,531106],"./en-us/people-app.js":[null],"./en-us/people-picker.js":[87439,531106],"./en-us/people-targeting.js":[174086,279766],"./en-us/people.js":[789272,531106],"./en-us/person.js":[900958,531106],"./en-us/phonelink-sms.js":[904371,316513],"./en-us/pre-core.js":[null],"./en-us/premium-benefits.js":[890679,78047],"./en-us/presence.js":[427998,531106],"./en-us/queues.js":[422667,20063],"./en-us/recurrence.js":[568561,951405],"./en-us/rsc-application-permissions.js":[null],"./en-us/search.js":[73899,388007],"./en-us/semantic-object.js":[324375,838641],"./en-us/settings.js":[462614,531106],"./en-us/share-in-meetings.js":[null],"./en-us/share-to-teams-outlook-addin.js":[null],"./en-us/share-to-teams-third-party.js":[null],"./en-us/share-to-teams.js":[744803,595435],"./en-us/shortcut.js":[572645,531106],"./en-us/shortcuts.js":[196976,531106],"./en-us/simple-collab.js":[106399,531106],"./en-us/smart-device.js":[null],"./en-us/survey.js":[481977,126405],"./en-us/sv-flyout.js":[926184,531106],"./en-us/teams-and-channels.js":[436214,316318],"./en-us/teams-insider.js":[871482,531106],"./en-us/telemetry.js":[207980,531106],"./en-us/tfl-homepage.js":[352474,531106],"./en-us/tfl-onboarding.js":[417611,531106],"./en-us/toast-notifications.js":[67821,531106],"./en-us/trusted-ui.js":[null],"./en-us/unified-search.js":[498002,595435],"./en-us/unsupported-browser.js":[null],"./en-us/url-preview.js":[144207,531106],"./en-us/video-capture.js":[813311,607353],"./en-us/video-message.js":[501658,280860],"./en-us/virtual-consumer-events.js":[644883,310879],"./en-us/virtual-events.js":[653828,4099],"./en-us/webinar.js":[761593,453871],"./en-us/welcome-bot.js":[null],"./en-us/whats-new.js":[124179,531106],"./en-us/wiki.js":[null],"./es-es/activity.js":[57045,458013],"./es-es/artifacts-platform.js":[502381,669677],"./es-es/audience-view-dialog.js":[877791,235527],"./es-es/auth.js":[751486,458013],"./es-es/autosuggest.js":[431469,458013],"./es-es/avatar.js":[922301,458013],"./es-es/biometric-enrollment.js":[334329,839981],"./es-es/breakout-rooms.js":[371440,95152],"./es-es/broadcast-scheduling.js":[147764,304],"./es-es/broadcast.js":[221781,224417],"./es-es/calendar.js":[910618,204050],"./es-es/calling.js":[939406,168618],"./es-es/campaign-notifications.js":[192339,458013],"./es-es/carousel-multi-card.js":[null],"./es-es/cast.js":[766747,458013],"./es-es/channels.js":[824256,458013],"./es-es/chat-list.js":[103487,458013],"./es-es/coach-report.js":[243531,116123],"./es-es/comment-stream.js":[871304,13316],"./es-es/communities.js":[131023,458013],"./es-es/compose.js":[892214,458013],"./es-es/contacts.js":[622405,458013],"./es-es/datepicker.js":[968958,192444],"./es-es/desktop.js":[324674,724990],"./es-es/digital-signage.js":[null],"./es-es/discover-surface.js":[434517,550165],"./es-es/edu.js":[793078,452326],"./es-es/embed.js":[142515,458013],"./es-es/errors.js":[908487,458013],"./es-es/esp.js":[745186,31494],"./es-es/extensibility-ptz-extension.js":[null],"./es-es/extensibility-room-remote.js":[null],"./es-es/extensibility.js":[777551,458013],"./es-es/feedback.js":[512919,94863],"./es-es/files.js":[493021,458013],"./es-es/framework.js":[574518,458013],"./es-es/freemium-upgrade.js":[null],"./es-es/funstuff.js":[120061,665333],"./es-es/gallery.js":[573252,622280],"./es-es/growth.js":[425083,458013],"./es-es/guardians.js":[344170,644770],"./es-es/health.js":[993694,106530],"./es-es/help.js":[262175,215753],"./es-es/hololens.js":[716092,168618],"./es-es/host-controls.js":[956669,19165],"./es-es/jana.js":[765536,35132],"./es-es/lightbox.js":[861485,458013],"./es-es/links.js":[123995,458013],"./es-es/live-persona-card.js":[200026,458013],"./es-es/live-persona-editor.js":[959701,28841],"./es-es/lms-integration.js":[null],"./es-es/meet-for-work.js":[441635,819595],"./es-es/meeting-analytics.js":[666810,592486],"./es-es/meeting-apis-app.js":[null],"./es-es/meeting-bot.js":[null],"./es-es/meeting-collaboration.js":[357979,495179],"./es-es/meeting-flyout.js":[546483,458013],"./es-es/meeting-meet-app.js":[391777,458013],"./es-es/meeting-options.js":[648492,437760],"./es-es/meeting-recap.js":[216437,525053],"./es-es/meeting-room-console.js":[null],"./es-es/meeting-stream-app.js":[null],"./es-es/messaging.js":[237998,458013],"./es-es/mobile-attach.js":[null],"./es-es/mtma-missed-notifications.js":[595328,458013],"./es-es/nearby.js":[786939,458013],"./es-es/nova.js":[428834,458013],"./es-es/people-app.js":[null],"./es-es/people-picker.js":[191582,458013],"./es-es/people-targeting.js":[220833,212761],"./es-es/people.js":[840455,458013],"./es-es/person.js":[735409,458013],"./es-es/phonelink-sms.js":[138406,514254],"./es-es/pre-core.js":[null],"./es-es/premium-benefits.js":[675056,395108],"./es-es/presence.js":[847461,458013],"./es-es/queues.js":[486952,397476],"./es-es/recurrence.js":[536030,690258],"./es-es/rsc-application-permissions.js":[null],"./es-es/search.js":[937432,192444],"./es-es/semantic-object.js":[208706,53406],"./es-es/settings.js":[249473,458013],"./es-es/share-in-meetings.js":[null],"./es-es/share-to-teams-outlook-addin.js":[null],"./es-es/share-to-teams-third-party.js":[null],"./es-es/share-to-teams.js":[437944,956232],"./es-es/shortcut.js":[619450,458013],"./es-es/shortcuts.js":[233289,458013],"./es-es/simple-collab.js":[599358,458013],"./es-es/smart-device.js":[null],"./es-es/survey.js":[859730,695674],"./es-es/sv-flyout.js":[490441,458013],"./es-es/teams-and-channels.js":[166197,719569],"./es-es/teams-insider.js":[293459,458013],"./es-es/telemetry.js":[625089,458013],"./es-es/tfl-homepage.js":[564645,458013],"./es-es/tfl-onboarding.js":[146040,458013],"./es-es/toast-notifications.js":[94060,458013],"./es-es/trusted-ui.js":[null],"./es-es/unified-search.js":[464089,956232],"./es-es/unsupported-browser.js":[null],"./es-es/url-preview.js":[19582,458013],"./es-es/video-capture.js":[735662,792310],"./es-es/video-message.js":[762415,519751],"./es-es/virtual-consumer-events.js":[474882,111588],"./es-es/virtual-events.js":[419255,329968],"./es-es/webinar.js":[958880,390964],"./es-es/welcome-bot.js":[null],"./es-es/whats-new.js":[836190,458013],"./es-es/wiki.js":[null],"./es-mx/activity.js":[629074,11862],"./es-mx/artifacts-platform.js":[844590,655590],"./es-mx/audience-view-dialog.js":[37720,190988],"./es-mx/auth.js":[142157,11862],"./es-mx/autosuggest.js":[652540,11862],"./es-mx/avatar.js":[152886,11862],"./es-mx/biometric-enrollment.js":[998922,342246],"./es-mx/breakout-rooms.js":[702303,158427],"./es-mx/broadcast-scheduling.js":[678867,63579],"./es-mx/broadcast.js":[463620,463962],"./es-mx/calendar.js":[970949,377833],"./es-mx/calling.js":[194187,317633],"./es-mx/campaign-notifications.js":[437504,11862],"./es-mx/carousel-multi-card.js":[null],"./es-mx/cast.js":[876944,11862],"./es-mx/channels.js":[433979,11862],"./es-mx/chat-list.js":[817717,11862],"./es-mx/coach-report.js":[236348,734608],"./es-mx/comment-stream.js":[165339,606111],"./es-mx/communities.js":[194054,11862],"./es-mx/compose.js":[633111,11862],"./es-mx/contacts.js":[997602,11862],"./es-mx/datepicker.js":[264141,644279],"./es-mx/desktop.js":[834027,338917],"./es-mx/digital-signage.js":[null],"./es-mx/discover-surface.js":[435898,213006],"./es-mx/edu.js":[437559,673293],"./es-mx/embed.js":[384402,11862],"./es-mx/errors.js":[261024,11862],"./es-mx/esp.js":[553847,675757],"./es-mx/extensibility-ptz-extension.js":[null],"./es-mx/extensibility-room-remote.js":[null],"./es-mx/extensibility.js":[220358,11862],"./es-mx/feedback.js":[34344,466484],"./es-mx/files.js":[276720,11862],"./es-mx/framework.js":[505211,11862],"./es-mx/freemium-upgrade.js":[null],"./es-mx/funstuff.js":[402590,904878],"./es-mx/gallery.js":[816941,78515],"./es-mx/growth.js":[555888,11862],"./es-mx/guardians.js":[934291,818553],"./es-mx/health.js":[162245,280313],"./es-mx/help.js":[150508,601826],"./es-mx/hololens.js":[206899,317633],"./es-mx/host-controls.js":[393856,573014],"./es-mx/jana.js":[842715,486967],"./es-mx/lightbox.js":[371314,11862],"./es-mx/links.js":[389798,11862],"./es-mx/live-persona-card.js":[220091,11862],"./es-mx/live-persona-editor.js":[950332,466498],"./es-mx/lms-integration.js":[null],"./es-mx/meet-for-work.js":[363178,902848],"./es-mx/meeting-analytics.js":[155495,813453],"./es-mx/meeting-apis-app.js":[null],"./es-mx/meeting-bot.js":[null],"./es-mx/meeting-collaboration.js":[423670,578432],"./es-mx/meeting-flyout.js":[99552,11862],"./es-mx/meeting-meet-app.js":[324638,11862],"./es-mx/meeting-options.js":[574113,501035],"./es-mx/meeting-recap.js":[207284,562550],"./es-mx/meeting-room-console.js":[null],"./es-mx/meeting-stream-app.js":[null],"./es-mx/messaging.js":[646291,11862],"./es-mx/mobile-attach.js":[null],"./es-mx/mtma-missed-notifications.js":[34817,11862],"./es-mx/nearby.js":[874756,11862],"./es-mx/nova.js":[516909,11862],"./es-mx/people-app.js":[null],"./es-mx/people-picker.js":[498827,11862],"./es-mx/people-targeting.js":[220962,598834],"./es-mx/people.js":[879708,11862],"./es-mx/person.js":[988234,11862],"./es-mx/phonelink-sms.js":[271639,76597],"./es-mx/pre-core.js":[null],"./es-mx/premium-benefits.js":[375051,39487],"./es-mx/presence.js":[499266,11862],"./es-mx/queues.js":[262047,558207],"./es-mx/recurrence.js":[767325,864041],"./es-mx/rsc-application-permissions.js":[null],"./es-mx/search.js":[224887,644279],"./es-mx/semantic-object.js":[963315,39045],"./es-mx/settings.js":[233810,11862],"./es-mx/share-in-meetings.js":[null],"./es-mx/share-to-teams-outlook-addin.js":[null],"./es-mx/share-to-teams-third-party.js":[null],"./es-mx/share-to-teams.js":[308167,989171],"./es-mx/shortcut.js":[296585,11862],"./es-mx/shortcuts.js":[762540,11862],"./es-mx/simple-collab.js":[534051,11862],"./es-mx/smart-device.js":[null],"./es-mx/survey.js":[705269,421393],"./es-mx/sv-flyout.js":[195644,11862],"./es-mx/teams-and-channels.js":[911810,382410],"./es-mx/teams-insider.js":[954366,11862],"./es-mx/telemetry.js":[75408,11862],"./es-mx/tfl-homepage.js":[34758,11862],"./es-mx/tfl-onboarding.js":[831279,11862],"./es-mx/toast-notifications.js":[912241,11862],"./es-mx/trusted-ui.js":[null],"./es-mx/unified-search.js":[356990,989171],"./es-mx/unsupported-browser.js":[null],"./es-mx/url-preview.js":[982851,11862],"./es-mx/video-capture.js":[628475,384989],"./es-mx/video-message.js":[129566,475212],"./es-mx/virtual-consumer-events.js":[391999,755967],"./es-mx/virtual-events.js":[602088,393243],"./es-mx/webinar.js":[360141,983759],"./es-mx/welcome-bot.js":[null],"./es-mx/whats-new.js":[758383,11862],"./es-mx/wiki.js":[null],"./et-ee/activity.js":[573922,353666],"./et-ee/artifacts-platform.js":[841182,685042],"./et-ee/audience-view-dialog.js":[213384,629036],"./et-ee/auth.js":[844253,353666],"./et-ee/autosuggest.js":[578732,353666],"./et-ee/avatar.js":[667174,353666],"./et-ee/biometric-enrollment.js":[698586,855346],"./et-ee/breakout-rooms.js":[523151,317607],"./et-ee/broadcast-scheduling.js":[511619,706407],"./et-ee/broadcast.js":[819796,882038],"./et-ee/calendar.js":[214453,659849],"./et-ee/calling.js":[434043,955937],"./et-ee/campaign-notifications.js":[447632,353666],"./et-ee/carousel-multi-card.js":[null],"./et-ee/cast.js":[275168,353666],"./et-ee/channels.js":[701931,353666],"./et-ee/chat-list.js":[788018,353666],"./et-ee/coach-report.js":[390348,443168],"./et-ee/comment-stream.js":[14635,866427],"./et-ee/communities.js":[518166,353666],"./et-ee/compose.js":[368775,353666],"./et-ee/contacts.js":[666706,353666],"./et-ee/datepicker.js":[140221,781011],"./et-ee/desktop.js":[530427,741301],"./et-ee/digital-signage.js":[null],"./et-ee/discover-surface.js":[790730,491002],"./et-ee/edu.js":[233223,871581],"./et-ee/embed.js":[800898,353666],"./et-ee/errors.js":[679728,353666],"./et-ee/esp.js":[31079,708733],"./et-ee/extensibility-ptz-extension.js":[null],"./et-ee/extensibility-room-remote.js":[null],"./et-ee/extensibility.js":[674070,353666],"./et-ee/feedback.js":[60920,278932],"./et-ee/files.js":[103872,353666],"./et-ee/framework.js":[225163,353666],"./et-ee/freemium-upgrade.js":[null],"./et-ee/funstuff.js":[231598,657754],"./et-ee/gallery.js":[895517,341119],"./et-ee/growth.js":[402592,353666],"./et-ee/guardians.js":[929955,335161],"./et-ee/health.js":[196917,339449],"./et-ee/help.js":[547164,260894],"./et-ee/hololens.js":[518307,955937],"./et-ee/host-controls.js":[553232,914818],"./et-ee/jana.js":[204971,623699],"./et-ee/lightbox.js":[277314,353666],"./et-ee/links.js":[552182,353666],"./et-ee/live-persona-card.js":[476619,353666],"./et-ee/live-persona-editor.js":[566508,146238],"./et-ee/lms-integration.js":[null],"./et-ee/meet-for-work.js":[688986,402992],"./et-ee/meeting-analytics.js":[721879,11741],"./et-ee/meeting-apis-app.js":[null],"./et-ee/meeting-bot.js":[null],"./et-ee/meeting-collaboration.js":[969862,78576],"./et-ee/meeting-flyout.js":[840368,353666],"./et-ee/meeting-meet-app.js":[782638,353666],"./et-ee/meeting-options.js":[115537,156503],"./et-ee/meeting-recap.js":[637508,826594],"./et-ee/meeting-room-console.js":[null],"./et-ee/meeting-stream-app.js":[null],"./et-ee/messaging.js":[996739,353666],"./et-ee/mobile-attach.js":[null],"./et-ee/mtma-missed-notifications.js":[878321,353666],"./et-ee/nearby.js":[704212,353666],"./et-ee/nova.js":[439837,353666],"./et-ee/people-app.js":[null],"./et-ee/people-picker.js":[682235,353666],"./et-ee/people-targeting.js":[746706,593294],"./et-ee/people.js":[761964,353666],"./et-ee/person.js":[550586,353666],"./et-ee/phonelink-sms.js":[776615,346277],"./et-ee/pre-core.js":[null],"./et-ee/premium-benefits.js":[981627,274395],"./et-ee/presence.js":[391474,353666],"./et-ee/queues.js":[33711,793115],"./et-ee/recurrence.js":[107437,26825],"./et-ee/rsc-application-permissions.js":[null],"./et-ee/search.js":[360199,781011],"./et-ee/semantic-object.js":[378243,235029],"./et-ee/settings.js":[339618,353666],"./et-ee/share-in-meetings.js":[null],"./et-ee/share-to-teams-outlook-addin.js":[null],"./et-ee/share-to-teams-third-party.js":[null],"./et-ee/share-to-teams.js":[203959,251775],"./et-ee/shortcut.js":[747385,353666],"./et-ee/shortcuts.js":[731356,353666],"./et-ee/simple-collab.js":[356947,353666],"./et-ee/smart-device.js":[null],"./et-ee/survey.js":[723621,54545],"./et-ee/sv-flyout.js":[597324,353666],"./et-ee/teams-and-channels.js":[721522,187270],"./et-ee/teams-insider.js":[331374,353666],"./et-ee/telemetry.js":[428160,353666],"./et-ee/tfl-homepage.js":[539414,353666],"./et-ee/tfl-onboarding.js":[179071,353666],"./et-ee/toast-notifications.js":[173025,353666],"./et-ee/trusted-ui.js":[null],"./et-ee/unified-search.js":[469422,251775],"./et-ee/unsupported-browser.js":[null],"./et-ee/url-preview.js":[508595,353666],"./et-ee/video-capture.js":[678859,738317],"./et-ee/video-message.js":[200750,429612],"./et-ee/virtual-consumer-events.js":[871279,507227],"./et-ee/virtual-events.js":[302616,36071],"./et-ee/webinar.js":[400509,47371],"./et-ee/welcome-bot.js":[null],"./et-ee/whats-new.js":[538335,353666],"./et-ee/wiki.js":[null],"./eu-es/activity.js":[937187,388179],"./eu-es/artifacts-platform.js":[428455,873379],"./eu-es/audience-view-dialog.js":[171989,660441],"./eu-es/auth.js":[523796,388179],"./eu-es/autosuggest.js":[331027,388179],"./eu-es/avatar.js":[792323,388179],"./eu-es/biometric-enrollment.js":[326319,43683],"./eu-es/breakout-rooms.js":[392910,335506],"./eu-es/broadcast-scheduling.js":[611550,724306],"./eu-es/broadcast.js":[79923,296431],"./eu-es/calendar.js":[529572,963696],"./eu-es/calling.js":[760164,283720],"./eu-es/campaign-notifications.js":[82425,388179],"./eu-es/carousel-multi-card.js":[null],"./eu-es/cast.js":[901993,388179],"./eu-es/channels.js":[5118,388179],"./eu-es/chat-list.js":[344505,388179],"./eu-es/coach-report.js":[630865,90597],"./eu-es/comment-stream.js":[262002,401438],"./eu-es/communities.js":[486569,388179],"./eu-es/compose.js":[316920,388179],"./eu-es/contacts.js":[752615,388179],"./eu-es/datepicker.js":[810344,925622],"./eu-es/desktop.js":[200312,336868],"./eu-es/digital-signage.js":[null],"./eu-es/discover-surface.js":[515223,598731],"./eu-es/edu.js":[307240,886828],"./eu-es/embed.js":[321865,388179],"./eu-es/errors.js":[832377,388179],"./eu-es/esp.js":[108600,732748],"./eu-es/extensibility-ptz-extension.js":[null],"./eu-es/extensibility-room-remote.js":[null],"./eu-es/extensibility.js":[295797,388179],"./eu-es/feedback.js":[47309,611457],"./eu-es/files.js":[154935,388179],"./eu-es/framework.js":[342648,388179],"./eu-es/freemium-upgrade.js":[null],"./eu-es/funstuff.js":[555039,548587],"./eu-es/gallery.js":[253982,507178],"./eu-es/growth.js":[246313,388179],"./eu-es/guardians.js":[881452,759872],"./eu-es/health.js":[920732,221632],"./eu-es/help.js":[228149,281783],"./eu-es/hololens.js":[562154,283720],"./eu-es/host-controls.js":[62103,949331],"./eu-es/jana.js":[893406,768310],"./eu-es/lightbox.js":[284215,388179],"./eu-es/links.js":[774985,388179],"./eu-es/live-persona-card.js":[252440,388179],"./eu-es/live-persona-editor.js":[478499,676183],"./eu-es/lms-integration.js":[null],"./eu-es/meet-for-work.js":[36449,228501],"./eu-es/meeting-analytics.js":[263760,510636],"./eu-es/meeting-apis-app.js":[null],"./eu-es/meeting-bot.js":[null],"./eu-es/meeting-collaboration.js":[830561,446613],"./eu-es/meeting-flyout.js":[50793,388179],"./eu-es/meeting-meet-app.js":[619860,388179],"./eu-es/meeting-options.js":[189886,322658],"./eu-es/meeting-recap.js":[904871,773555],"./eu-es/meeting-room-console.js":[null],"./eu-es/meeting-stream-app.js":[null],"./eu-es/messaging.js":[109836,388179],"./eu-es/mobile-attach.js":[null],"./eu-es/mtma-missed-notifications.js":[519158,388179],"./eu-es/nearby.js":[73333,388179],"./eu-es/nova.js":[371308,388179],"./eu-es/people-app.js":[null],"./eu-es/people-picker.js":[521312,388179],"./eu-es/people-targeting.js":[836275,271495],"./eu-es/people.js":[991297,388179],"./eu-es/person.js":[864479,388179],"./eu-es/phonelink-sms.js":[526272,725876],"./eu-es/pre-core.js":[null],"./eu-es/premium-benefits.js":[76658,783230],"./eu-es/presence.js":[595203,388179],"./eu-es/queues.js":[362290,267774],"./eu-es/recurrence.js":[789340,389552],"./eu-es/rsc-application-permissions.js":[null],"./eu-es/search.js":[163090,925622],"./eu-es/semantic-object.js":[212936,665284],"./eu-es/settings.js":[738327,388179],"./eu-es/share-in-meetings.js":[null],"./eu-es/share-to-teams-outlook-addin.js":[null],"./eu-es/share-to-teams-third-party.js":[null],"./eu-es/share-to-teams.js":[100102,841130],"./eu-es/shortcut.js":[599744,388179],"./eu-es/shortcuts.js":[23743,388179],"./eu-es/simple-collab.js":[54760,388179],"./eu-es/smart-device.js":[null],"./eu-es/survey.js":[602500,810776],"./eu-es/sv-flyout.js":[208691,388179],"./eu-es/teams-and-channels.js":[958555,191839],"./eu-es/teams-insider.js":[973197,388179],"./eu-es/telemetry.js":[460423,388179],"./eu-es/tfl-homepage.js":[15071,388179],"./eu-es/tfl-onboarding.js":[743574,388179],"./eu-es/toast-notifications.js":[915426,388179],"./eu-es/trusted-ui.js":[null],"./eu-es/unified-search.js":[783827,841130],"./eu-es/unsupported-browser.js":[null],"./eu-es/url-preview.js":[880480,388179],"./eu-es/video-capture.js":[583840,575484],"./eu-es/video-message.js":[699797,944665],"./eu-es/virtual-consumer-events.js":[835820,16062],"./eu-es/virtual-events.js":[841305,570322],"./eu-es/webinar.js":[943522,179342],"./eu-es/welcome-bot.js":[null],"./eu-es/whats-new.js":[211152,388179],"./eu-es/wiki.js":[null],"./fi-fi/activity.js":[473599,855891],"./fi-fi/artifacts-platform.js":[112627,962211],"./fi-fi/audience-view-dialog.js":[111561,306005],"./fi-fi/auth.js":[240632,855891],"./fi-fi/autosuggest.js":[705983,855891],"./fi-fi/avatar.js":[647639,855891],"./fi-fi/biometric-enrollment.js":[732147,132515],"./fi-fi/breakout-rooms.js":[573490,656450],"./fi-fi/broadcast-scheduling.js":[994802,45250],"./fi-fi/broadcast.js":[664295,768359],"./fi-fi/calendar.js":[282952,145820],"./fi-fi/calling.js":[98976,988916],"./fi-fi/campaign-notifications.js":[995685,855891],"./fi-fi/carousel-multi-card.js":[null],"./fi-fi/cast.js":[364069,855891],"./fi-fi/channels.js":[578690,855891],"./fi-fi/chat-list.js":[216069,855891],"./fi-fi/coach-report.js":[396653,135401],"./fi-fi/comment-stream.js":[751926,853350],"./fi-fi/communities.js":[372397,855891],"./fi-fi/compose.js":[236308,855891],"./fi-fi/contacts.js":[72267,855891],"./fi-fi/datepicker.js":[586796,433566],"./fi-fi/desktop.js":[904532,43480],"./fi-fi/digital-signage.js":[null],"./fi-fi/discover-surface.js":[308699,877003],"./fi-fi/edu.js":[292124,242176],"./fi-fi/embed.js":[182629,855891],"./fi-fi/errors.js":[82813,855891],"./fi-fi/esp.js":[291772,139680],"./fi-fi/extensibility-ptz-extension.js":[null],"./fi-fi/extensibility-room-remote.js":[null],"./fi-fi/extensibility.js":[354545,855891],"./fi-fi/feedback.js":[571601,874877],"./fi-fi/files.js":[230635,855891],"./fi-fi/framework.js":[373612,855891],"./fi-fi/freemium-upgrade.js":[null],"./fi-fi/funstuff.js":[686587,369387],"./fi-fi/gallery.js":[57642,384890],"./fi-fi/growth.js":[702685,855891],"./fi-fi/guardians.js":[126200,820332],"./fi-fi/health.js":[216312,798444],"./fi-fi/help.js":[205481,118095],"./fi-fi/hololens.js":[689854,988916],"./fi-fi/host-controls.js":[571779,417043],"./fi-fi/jana.js":[818410,276254],"./fi-fi/lightbox.js":[616875,855891],"./fi-fi/links.js":[584197,855891],"./fi-fi/live-persona-card.js":[87084,855891],"./fi-fi/live-persona-editor.js":[528559,982767],"./fi-fi/lms-integration.js":[null],"./fi-fi/meet-for-work.js":[467901,23513],"./fi-fi/meeting-analytics.js":[436252,382336],"./fi-fi/meeting-apis-app.js":[null],"./fi-fi/meeting-bot.js":[null],"./fi-fi/meeting-collaboration.js":[161917,650521],"./fi-fi/meeting-flyout.js":[839837,855891],"./fi-fi/meeting-meet-app.js":[687819,855891],"./fi-fi/meeting-options.js":[800802,484818],"./fi-fi/meeting-recap.js":[216867,678963],"./fi-fi/meeting-room-console.js":[null],"./fi-fi/meeting-stream-app.js":[null],"./fi-fi/messaging.js":[148e3,855891],"./fi-fi/mobile-attach.js":[null],"./fi-fi/mtma-missed-notifications.js":[662762,855891],"./fi-fi/nearby.js":[948185,855891],"./fi-fi/nova.js":[79048,855891],"./fi-fi/people-app.js":[null],"./fi-fi/people-picker.js":[709836,855891],"./fi-fi/people-targeting.js":[904575,102815],"./fi-fi/people.js":[894917,855891],"./fi-fi/person.js":[48283,855891],"./fi-fi/phonelink-sms.js":[307716,696680],"./fi-fi/pre-core.js":[null],"./fi-fi/premium-benefits.js":[617366,286726],"./fi-fi/presence.js":[616983,855891],"./fi-fi/queues.js":[88982,819846],"./fi-fi/recurrence.js":[995208,620252],"./fi-fi/rsc-application-permissions.js":[null],"./fi-fi/search.js":[360430,433566],"./fi-fi/semantic-object.js":[838580,357496],"./fi-fi/settings.js":[40963,855891],"./fi-fi/share-in-meetings.js":[null],"./fi-fi/share-to-teams-outlook-addin.js":[null],"./fi-fi/share-to-teams-third-party.js":[null],"./fi-fi/share-to-teams.js":[878778,190714],"./fi-fi/shortcut.js":[384852,855891],"./fi-fi/shortcuts.js":[482779,855891],"./fi-fi/simple-collab.js":[891548,855891],"./fi-fi/smart-device.js":[null],"./fi-fi/survey.js":[174480,483588],"./fi-fi/sv-flyout.js":[48519,855891],"./fi-fi/teams-and-channels.js":[440055,806935],"./fi-fi/teams-insider.js":[803825,855891],"./fi-fi/telemetry.js":[543259,855891],"./fi-fi/tfl-homepage.js":[443755,855891],"./fi-fi/tfl-onboarding.js":[475946,855891],"./fi-fi/toast-notifications.js":[344566,855891],"./fi-fi/trusted-ui.js":[null],"./fi-fi/unified-search.js":[967311,190714],"./fi-fi/unsupported-browser.js":[null],"./fi-fi/url-preview.js":[322916,855891],"./fi-fi/video-capture.js":[970828,449232],"./fi-fi/video-message.js":[316937,590229],"./fi-fi/virtual-consumer-events.js":[814664,519558],"./fi-fi/virtual-events.js":[703325,374914],"./fi-fi/webinar.js":[974982,102614],"./fi-fi/welcome-bot.js":[null],"./fi-fi/whats-new.js":[696300,855891],"./fi-fi/wiki.js":[null],"./fil-ph/activity.js":[137588,538374],"./fil-ph/artifacts-platform.js":[911084,177878],"./fil-ph/audience-view-dialog.js":[978386,372200],"./fil-ph/auth.js":[726135,538374],"./fil-ph/autosuggest.js":[76182,538374],"./fil-ph/avatar.js":[867496,538374],"./fil-ph/biometric-enrollment.js":[967612,277014],"./fil-ph/breakout-rooms.js":[847417,587001],"./fil-ph/broadcast-scheduling.js":[271113,850105],"./fil-ph/broadcast.js":[52294,158754],"./fil-ph/calendar.js":[635083,333451],"./fil-ph/calling.js":[685861,540099],"./fil-ph/campaign-notifications.js":[765330,538374],"./fil-ph/carousel-multi-card.js":[null],"./fil-ph/cast.js":[54882,538374],"./fil-ph/channels.js":[814677,538374],"./fil-ph/chat-list.js":[959544,538374],"./fil-ph/coach-report.js":[375198,638212],"./fil-ph/comment-stream.js":[172737,220741],"./fil-ph/communities.js":[745596,538374],"./fil-ph/compose.js":[953957,538374],"./fil-ph/contacts.js":[816064,538374],"./fil-ph/datepicker.js":[782499,682749],"./fil-ph/desktop.js":[475613,95471],"./fil-ph/digital-signage.js":[null],"./fil-ph/discover-surface.js":[774824,743902],"./fil-ph/edu.js":[885189,844695],"./fil-ph/embed.js":[743124,538374],"./fil-ph/errors.js":[820726,538374],"./fil-ph/esp.js":[548753,371959],"./fil-ph/extensibility-ptz-extension.js":[null],"./fil-ph/extensibility-room-remote.js":[null],"./fil-ph/extensibility.js":[305760,538374],"./fil-ph/feedback.js":[331138,186800],"./fil-ph/files.js":[695494,538374],"./fil-ph/framework.js":[812345,538374],"./fil-ph/freemium-upgrade.js":[null],"./fil-ph/funstuff.js":[922268,21438],"./fil-ph/gallery.js":[298779,498801],"./fil-ph/growth.js":[242082,538374],"./fil-ph/guardians.js":[600537,249819],"./fil-ph/health.js":[796415,219099],"./fil-ph/help.js":[841846,795786],"./fil-ph/hololens.js":[935037,540099],"./fil-ph/host-controls.js":[685454,87046],"./fil-ph/jana.js":[71813,666493],"./fil-ph/lightbox.js":[943352,538374],"./fil-ph/links.js":[19096,538374],"./fil-ph/live-persona-card.js":[59317,538374],"./fil-ph/live-persona-editor.js":[779070,432746],"./fil-ph/lms-integration.js":[null],"./fil-ph/meet-for-work.js":[59732,271604],"./fil-ph/meeting-analytics.js":[74313,287703],"./fil-ph/meeting-apis-app.js":[null],"./fil-ph/meeting-bot.js":[null],"./fil-ph/meeting-collaboration.js":[343936,266612],"./fil-ph/meeting-flyout.js":[330218,538374],"./fil-ph/meeting-meet-app.js":[235992,538374],"./fil-ph/meeting-options.js":[11951,45577],"./fil-ph/meeting-recap.js":[256474,848742],"./fil-ph/meeting-room-console.js":[null],"./fil-ph/meeting-stream-app.js":[null],"./fil-ph/messaging.js":[914173,538374],"./fil-ph/mobile-attach.js":[null],"./fil-ph/mtma-missed-notifications.js":[418987,538374],"./fil-ph/nearby.js":[680930,538374],"./fil-ph/nova.js":[570923,538374],"./fil-ph/people-app.js":[null],"./fil-ph/people-picker.js":[281169,538374],"./fil-ph/people-targeting.js":[270544,678746],"./fil-ph/people.js":[821962,538374],"./fil-ph/person.js":[300692,538374],"./fil-ph/phonelink-sms.js":[440237,24063],"./fil-ph/pre-core.js":[null],"./fil-ph/premium-benefits.js":[993353,269285],"./fil-ph/presence.js":[615828,538374],"./fil-ph/queues.js":[329301,766437],"./fil-ph/recurrence.js":[600535,47051],"./fil-ph/rsc-application-permissions.js":[null],"./fil-ph/search.js":[528693,682749],"./fil-ph/semantic-object.js":[425037,899727],"./fil-ph/settings.js":[355356,538374],"./fil-ph/share-in-meetings.js":[null],"./fil-ph/share-to-teams-outlook-addin.js":[null],"./fil-ph/share-to-teams-third-party.js":[null],"./fil-ph/share-to-teams.js":[675377,992113],"./fil-ph/shortcut.js":[368387,538374],"./fil-ph/shortcuts.js":[592934,538374],"./fil-ph/simple-collab.js":[851097,538374],"./fil-ph/smart-device.js":[null],"./fil-ph/survey.js":[134003,537107],"./fil-ph/sv-flyout.js":[910866,538374],"./fil-ph/teams-and-channels.js":[291668,928658],"./fil-ph/teams-insider.js":[365228,538374],"./fil-ph/telemetry.js":[157810,538374],"./fil-ph/tfl-homepage.js":[195164,538374],"./fil-ph/tfl-onboarding.js":[415657,538374],"./fil-ph/toast-notifications.js":[521219,538374],"./fil-ph/trusted-ui.js":[null],"./fil-ph/unified-search.js":[410700,992113],"./fil-ph/unsupported-browser.js":[null],"./fil-ph/url-preview.js":[45593,538374],"./fil-ph/video-capture.js":[120145,471463],"./fil-ph/video-message.js":[695840,627048],"./fil-ph/virtual-consumer-events.js":[165469,183013],"./fil-ph/virtual-events.js":[605558,302137],"./fil-ph/webinar.js":[61563,51253],"./fil-ph/welcome-bot.js":[null],"./fil-ph/whats-new.js":[718269,538374],"./fil-ph/wiki.js":[null],"./fr-ca/activity.js":[278541,971225],"./fr-ca/artifacts-platform.js":[29893,793033],"./fr-ca/audience-view-dialog.js":[777095,153655],"./fr-ca/auth.js":[140982,971225],"./fr-ca/autosuggest.js":[910709,971225],"./fr-ca/avatar.js":[559909,971225],"./fr-ca/biometric-enrollment.js":[774001,479689],"./fr-ca/breakout-rooms.js":[464760,349836],"./fr-ca/broadcast-scheduling.js":[936668,738636],"./fr-ca/broadcast.js":[433949,700389],"./fr-ca/calendar.js":[934754,212866],"./fr-ca/calling.js":[773158,272986],"./fr-ca/campaign-notifications.js":[847627,971225],"./fr-ca/carousel-multi-card.js":[null],"./fr-ca/cast.js":[692515,971225],"./fr-ca/channels.js":[121608,971225],"./fr-ca/chat-list.js":[972503,971225],"./fr-ca/coach-report.js":[778675,858243],"./fr-ca/comment-stream.js":[206800,782536],"./fr-ca/communities.js":[867239,971225],"./fr-ca/compose.js":[212766,971225],"./fr-ca/contacts.js":[59981,971225],"./fr-ca/datepicker.js":[917126,26080],"./fr-ca/desktop.js":[684890,522742],"./fr-ca/digital-signage.js":[null],"./fr-ca/discover-surface.js":[751437,186865],"./fr-ca/edu.js":[96974,88510],"./fr-ca/embed.js":[991451,971225],"./fr-ca/errors.js":[911295,971225],"./fr-ca/esp.js":[70650,409310],"./fr-ca/extensibility-ptz-extension.js":[null],"./fr-ca/extensibility-room-remote.js":[null],"./fr-ca/extensibility.js":[990423,971225],"./fr-ca/feedback.js":[969743,515231],"./fr-ca/files.js":[70357,971225],"./fr-ca/framework.js":[5150,971225],"./fr-ca/freemium-upgrade.js":[null],"./fr-ca/funstuff.js":[567573,136721],"./fr-ca/gallery.js":[757868,451332],"./fr-ca/growth.js":[412163,971225],"./fr-ca/guardians.js":[498530,839282],"./fr-ca/health.js":[709366,817394],"./fr-ca/help.js":[909351,318957],"./fr-ca/hololens.js":[849252,272986],"./fr-ca/host-controls.js":[748645,532377],"./fr-ca/jana.js":[648168,868768],"./fr-ca/lightbox.js":[120005,971225],"./fr-ca/links.js":[704019,971225],"./fr-ca/live-persona-card.js":[440690,971225],"./fr-ca/live-persona-editor.js":[124493,781005],"./fr-ca/lms-integration.js":[null],"./fr-ca/meet-for-work.js":[111963,514131],"./fr-ca/meeting-analytics.js":[401234,228670],"./fr-ca/meeting-apis-app.js":[null],"./fr-ca/meeting-bot.js":[null],"./fr-ca/meeting-collaboration.js":[760355,658963],"./fr-ca/meeting-flyout.js":[302059,971225],"./fr-ca/meeting-meet-app.js":[663081,971225],"./fr-ca/meeting-options.js":[708964,535548],"./fr-ca/meeting-recap.js":[671789,1081],"./fr-ca/meeting-room-console.js":[null],"./fr-ca/meeting-stream-app.js":[null],"./fr-ca/messaging.js":[868246,971225],"./fr-ca/mobile-attach.js":[null],"./fr-ca/mtma-missed-notifications.js":[107208,971225],"./fr-ca/nearby.js":[949507,971225],"./fr-ca/nova.js":[744650,971225],"./fr-ca/people-app.js":[null],"./fr-ca/people-picker.js":[853574,971225],"./fr-ca/people-targeting.js":[556633,153437],"./fr-ca/people.js":[639343,971225],"./fr-ca/person.js":[115481,971225],"./fr-ca/phonelink-sms.js":[395726,910822],"./fr-ca/pre-core.js":[null],"./fr-ca/premium-benefits.js":[727832,215912],"./fr-ca/presence.js":[355965,971225],"./fr-ca/queues.js":[842960,749032],"./fr-ca/recurrence.js":[113910,229826],"./fr-ca/rsc-application-permissions.js":[null],"./fr-ca/search.js":[455408,26080],"./fr-ca/semantic-object.js":[941754,268822],"./fr-ca/settings.js":[818569,971225],"./fr-ca/share-in-meetings.js":[null],"./fr-ca/share-to-teams-outlook-addin.js":[null],"./fr-ca/share-to-teams-third-party.js":[null],"./fr-ca/share-to-teams.js":[437968,833860],"./fr-ca/shortcut.js":[283010,971225],"./fr-ca/shortcuts.js":[651201,971225],"./fr-ca/simple-collab.js":[292742,971225],"./fr-ca/smart-device.js":[null],"./fr-ca/survey.js":[780394,846154],"./fr-ca/sv-flyout.js":[955969,971225],"./fr-ca/teams-and-channels.js":[150077,211573],"./fr-ca/teams-insider.js":[469307,971225],"./fr-ca/telemetry.js":[282217,971225],"./fr-ca/tfl-homepage.js":[615549,971225],"./fr-ca/tfl-onboarding.js":[656112,971225],"./fr-ca/toast-notifications.js":[871860,971225],"./fr-ca/trusted-ui.js":[null],"./fr-ca/unified-search.js":[119569,833860],"./fr-ca/unsupported-browser.js":[null],"./fr-ca/url-preview.js":[355174,971225],"./fr-ca/video-capture.js":[223670,561070],"./fr-ca/video-message.js":[143527,437879],"./fr-ca/virtual-consumer-events.js":[599578,932392],"./fr-ca/virtual-events.js":[482655,584652],"./fr-ca/webinar.js":[184888,353112],"./fr-ca/welcome-bot.js":[null],"./fr-ca/whats-new.js":[907750,971225],"./fr-ca/wiki.js":[null],"./fr-fr/activity.js":[428537,740037],"./fr-fr/artifacts-platform.js":[751505,390549],"./fr-fr/audience-view-dialog.js":[774971,705415],"./fr-fr/auth.js":[49146,740037],"./fr-fr/autosuggest.js":[219937,740037],"./fr-fr/avatar.js":[949929,740037],"./fr-fr/biometric-enrollment.js":[486757,560853],"./fr-fr/breakout-rooms.js":[356300,849660],"./fr-fr/broadcast-scheduling.js":[746592,238460],"./fr-fr/broadcast.js":[769073,858169],"./fr-fr/calendar.js":[236822,649678],"./fr-fr/calling.js":[902210,8518],"./fr-fr/campaign-notifications.js":[582311,740037],"./fr-fr/carousel-multi-card.js":[null],"./fr-fr/cast.js":[961887,740037],"./fr-fr/channels.js":[303884,740037],"./fr-fr/chat-list.js":[301219,740037],"./fr-fr/coach-report.js":[312335,724251],"./fr-fr/comment-stream.js":[391348,582704],"./fr-fr/communities.js":[43307,740037],"./fr-fr/compose.js":[15226,740037],"./fr-fr/contacts.js":[853937,740037],"./fr-fr/datepicker.js":[907642,821e3],"./fr-fr/desktop.js":[540998,273802],"./fr-fr/digital-signage.js":[null],"./fr-fr/discover-surface.js":[944753,45149],"./fr-fr/edu.js":[205874,836050],"./fr-fr/embed.js":[28327,740037],"./fr-fr/errors.js":[877011,740037],"./fr-fr/esp.js":[519406,681970],"./fr-fr/extensibility-ptz-extension.js":[null],"./fr-fr/extensibility-room-remote.js":[null],"./fr-fr/extensibility.js":[911507,740037],"./fr-fr/feedback.js":[101171,360463],"./fr-fr/files.js":[583497,740037],"./fr-fr/framework.js":[380722,740037],"./fr-fr/freemium-upgrade.js":[null],"./fr-fr/funstuff.js":[55089,562941],"./fr-fr/gallery.js":[32840,951156],"./fr-fr/growth.js":[676087,740037],"./fr-fr/guardians.js":[97662,681502],"./fr-fr/health.js":[783090,566558],"./fr-fr/help.js":[481931,53441],"./fr-fr/hololens.js":[796520,8518],"./fr-fr/host-controls.js":[667553,301189],"./fr-fr/jana.js":[977748,663688],"./fr-fr/lightbox.js":[786249,740037],"./fr-fr/links.js":[101119,740037],"./fr-fr/live-persona-card.js":[713974,740037],"./fr-fr/live-persona-editor.js":[100793,567073],"./fr-fr/lms-integration.js":[null],"./fr-fr/meet-for-work.js":[405991,603019],"./fr-fr/meeting-analytics.js":[325422,459858],"./fr-fr/meeting-apis-app.js":[null],"./fr-fr/meeting-bot.js":[null],"./fr-fr/meeting-collaboration.js":[171887,687499],"./fr-fr/meeting-flyout.js":[143151,740037],"./fr-fr/meeting-meet-app.js":[875693,740037],"./fr-fr/meeting-options.js":[654536,783372],"./fr-fr/meeting-recap.js":[801113,821477],"./fr-fr/meeting-room-console.js":[null],"./fr-fr/meeting-stream-app.js":[null],"./fr-fr/messaging.js":[932842,740037],"./fr-fr/mobile-attach.js":[null],"./fr-fr/mtma-missed-notifications.js":[842380,740037],"./fr-fr/nearby.js":[312823,740037],"./fr-fr/nova.js":[928374,740037],"./fr-fr/people-app.js":[null],"./fr-fr/people-picker.js":[127154,740037],"./fr-fr/people-targeting.js":[702197,50449],"./fr-fr/people.js":[254627,740037],"./fr-fr/person.js":[93061,740037],"./fr-fr/phonelink-sms.js":[716066,936346],"./fr-fr/pre-core.js":[null],"./fr-fr/premium-benefits.js":[621676,16080],"./fr-fr/presence.js":[699617,740037],"./fr-fr/queues.js":[192116,972496],"./fr-fr/recurrence.js":[940866,150286],"./fr-fr/rsc-application-permissions.js":[null],"./fr-fr/search.js":[282220,821e3],"./fr-fr/semantic-object.js":[456614,71466],"./fr-fr/settings.js":[57077,740037],"./fr-fr/share-in-meetings.js":[null],"./fr-fr/share-to-teams-outlook-addin.js":[null],"./fr-fr/share-to-teams-third-party.js":[null],"./fr-fr/share-to-teams.js":[24740,333684],"./fr-fr/shortcut.js":[38310,740037],"./fr-fr/shortcuts.js":[574733,740037],"./fr-fr/simple-collab.js":[248250,740037],"./fr-fr/smart-device.js":[null],"./fr-fr/survey.js":[741078,288214],"./fr-fr/sv-flyout.js":[384661,740037],"./fr-fr/teams-and-channels.js":[787625,774761],"./fr-fr/teams-insider.js":[553455,740037],"./fr-fr/telemetry.js":[537101,740037],"./fr-fr/tfl-homepage.js":[362329,740037],"./fr-fr/tfl-onboarding.js":[931684,740037],"./fr-fr/toast-notifications.js":[82520,740037],"./fr-fr/trusted-ui.js":[null],"./fr-fr/unified-search.js":[617853,333684],"./fr-fr/unsupported-browser.js":[null],"./fr-fr/url-preview.js":[363274,740037],"./fr-fr/video-capture.js":[424178,963554],"./fr-fr/video-message.js":[124715,989639],"./fr-fr/virtual-consumer-events.js":[752998,248912],"./fr-fr/virtual-events.js":[976547,84476],"./fr-fr/webinar.js":[776460,799456],"./fr-fr/welcome-bot.js":[null],"./fr-fr/whats-new.js":[896930,740037],"./fr-fr/wiki.js":[null],"./gl-es/activity.js":[134538,592362],"./gl-es/artifacts-platform.js":[285766,684442],"./gl-es/audience-view-dialog.js":[836128,13428],"./gl-es/auth.js":[939557,592362],"./gl-es/autosuggest.js":[720068,592362],"./gl-es/avatar.js":[266302,592362],"./gl-es/biometric-enrollment.js":[883074,854746],"./gl-es/breakout-rooms.js":[59271,923255],"./gl-es/broadcast-scheduling.js":[700955,312055],"./gl-es/broadcast.js":[394988,999510],"./gl-es/calendar.js":[586669,389449],"./gl-es/calling.js":[855363,957169],"./gl-es/campaign-notifications.js":[117592,592362],"./gl-es/carousel-multi-card.js":[null],"./gl-es/cast.js":[62904,592362],"./gl-es/channels.js":[87843,592362],"./gl-es/chat-list.js":[516186,592362],"./gl-es/coach-report.js":[512388,325584],"./gl-es/comment-stream.js":[49923,272803],"./gl-es/communities.js":[737310,592362],"./gl-es/compose.js":[540223,592362],"./gl-es/contacts.js":[552714,592362],"./gl-es/datepicker.js":[721269,382379],"./gl-es/desktop.js":[207075,258333],"./gl-es/digital-signage.js":[null],"./gl-es/discover-surface.js":[227602,575346],"./gl-es/edu.js":[566415,13461],"./gl-es/embed.js":[690394,592362],"./gl-es/errors.js":[455992,592362],"./gl-es/esp.js":[885103,447989],"./gl-es/extensibility-ptz-extension.js":[null],"./gl-es/extensibility-room-remote.js":[null],"./gl-es/extensibility.js":[280078,592362],"./gl-es/feedback.js":[238784,98124],"./gl-es/files.js":[913032,592362],"./gl-es/framework.js":[642083,592362],"./gl-es/freemium-upgrade.js":[null],"./gl-es/funstuff.js":[215254,284626],"./gl-es/gallery.js":[591733,148799],"./gl-es/growth.js":[757336,592362],"./gl-es/guardians.js":[153163,43833],"./gl-es/health.js":[307293,33721],"./gl-es/help.js":[21428,606030],"./gl-es/hololens.js":[749659,957169],"./gl-es/host-controls.js":[961704,637162],"./gl-es/jana.js":[210275,741419],"./gl-es/lightbox.js":[987210,592362],"./gl-es/links.js":[477662,592362],"./gl-es/live-persona-card.js":[306643,592362],"./gl-es/live-persona-editor.js":[358324,41902],"./gl-es/lms-integration.js":[null],"./gl-es/meet-for-work.js":[514274,177824],"./gl-es/meeting-analytics.js":[477439,637269],"./gl-es/meeting-apis-app.js":[null],"./gl-es/meeting-bot.js":[null],"./gl-es/meeting-collaboration.js":[353470,381536],"./gl-es/meeting-flyout.js":[591320,592362],"./gl-es/meeting-meet-app.js":[989126,592362],"./gl-es/meeting-options.js":[922681,326567],"./gl-es/meeting-recap.js":[505900,363850],"./gl-es/meeting-room-console.js":[null],"./gl-es/meeting-stream-app.js":[null],"./gl-es/messaging.js":[450747,592362],"./gl-es/mobile-attach.js":[null],"./gl-es/mtma-missed-notifications.js":[281193,592362],"./gl-es/nearby.js":[524588,592362],"./gl-es/nova.js":[859157,592362],"./gl-es/people-app.js":[null],"./gl-es/people-picker.js":[293619,592362],"./gl-es/people-targeting.js":[167642,199294],"./gl-es/people.js":[37060,592362],"./gl-es/person.js":[516658,592362],"./gl-es/phonelink-sms.js":[924511,38093],"./gl-es/pre-core.js":[null],"./gl-es/premium-benefits.js":[292819,654595],"./gl-es/presence.js":[172474,592362],"./gl-es/queues.js":[563783,730243],"./gl-es/recurrence.js":[556597,863881],"./gl-es/rsc-application-permissions.js":[null],"./gl-es/search.js":[366383,382379],"./gl-es/semantic-object.js":[182827,737661],"./gl-es/settings.js":[735674,592362],"./gl-es/share-in-meetings.js":[null],"./gl-es/share-to-teams-outlook-addin.js":[null],"./gl-es/share-to-teams-third-party.js":[null],"./gl-es/share-to-teams.js":[179775,557503],"./gl-es/shortcut.js":[461137,592362],"./gl-es/shortcuts.js":[942212,592362],"./gl-es/simple-collab.js":[352875,592362],"./gl-es/smart-device.js":[null],"./gl-es/survey.js":[771853,820129],"./gl-es/sv-flyout.js":[984903,592362],"./gl-es/teams-and-channels.js":[627978,499942],"./gl-es/teams-insider.js":[409862,592362],"./gl-es/telemetry.js":[978200,592362],"./gl-es/tfl-homepage.js":[691390,592362],"./gl-es/tfl-onboarding.js":[802119,592362],"./gl-es/toast-notifications.js":[837273,592362],"./gl-es/trusted-ui.js":[null],"./gl-es/unified-search.js":[712758,557503],"./gl-es/unsupported-browser.js":[null],"./gl-es/url-preview.js":[239723,592362],"./gl-es/video-capture.js":[549667,931781],"./gl-es/video-message.js":[555766,297652],"./gl-es/virtual-consumer-events.js":[414775,371075],"./gl-es/virtual-events.js":[793968,158071],"./gl-es/webinar.js":[42597,234291],"./gl-es/welcome-bot.js":[null],"./gl-es/whats-new.js":[642807,592362],"./gl-es/wiki.js":[null],"./he-il/activity.js":[702209,471581],"./he-il/artifacts-platform.js":[395385,577901],"./he-il/audience-view-dialog.js":[390931,164279],"./he-il/auth.js":[588002,471581],"./he-il/autosuggest.js":[526393,471581],"./he-il/avatar.js":[919009,471581],"./he-il/biometric-enrollment.js":[56173,748205],"./he-il/breakout-rooms.js":[420260,684220],"./he-il/broadcast-scheduling.js":[820440,589372],"./he-il/broadcast.js":[497193,98369],"./he-il/calendar.js":[720494,403814],"./he-il/calling.js":[499850,550318],"./he-il/campaign-notifications.js":[914159,471581],"./he-il/carousel-multi-card.js":[null],"./he-il/cast.js":[284855,471581],"./he-il/channels.js":[462564,471581],"./he-il/chat-list.js":[635019,471581],"./he-il/coach-report.js":[581703,998475],"./he-il/comment-stream.js":[762444,238192],"./he-il/communities.js":[290099,471581],"./he-il/compose.js":[652786,471581],"./he-il/contacts.js":[952553,471581],"./he-il/datepicker.js":[935474,578232],"./he-il/desktop.js":[606350,12050],"./he-il/digital-signage.js":[null],"./he-il/discover-surface.js":[128889,578469],"./he-il/edu.js":[934426,778954],"./he-il/embed.js":[351807,471581],"./he-il/errors.js":[584315,471581],"./he-il/esp.js":[238198,338346],"./he-il/extensibility-ptz-extension.js":[null],"./he-il/extensibility-room-remote.js":[null],"./he-il/extensibility.js":[703275,471581],"./he-il/feedback.js":[314971,99503],"./he-il/files.js":[418033,471581],"./he-il/framework.js":[206442,471581],"./he-il/freemium-upgrade.js":[null],"./he-il/funstuff.js":[508441,693637],"./he-il/gallery.js":[858784,38180],"./he-il/growth.js":[108495,471581],"./he-il/guardians.js":[391238,129910],"./he-il/health.js":[296666,577270],"./he-il/help.js":[808035,248217],"./he-il/hololens.js":[954752,550318],"./he-il/host-controls.js":[523353,32733],"./he-il/jana.js":[555596,420920],"./he-il/lightbox.js":[269777,471581],"./he-il/links.js":[125831,471581],"./he-il/live-persona-card.js":[404030,471581],"./he-il/live-persona-editor.js":[654977,226617],"./he-il/lms-integration.js":[null],"./he-il/meet-for-work.js":[581519,334203],"./he-il/meeting-analytics.js":[286614,919114],"./he-il/meeting-apis-app.js":[null],"./he-il/meeting-bot.js":[null],"./he-il/meeting-collaboration.js":[392647,552315],"./he-il/meeting-flyout.js":[40631,471581],"./he-il/meeting-meet-app.js":[654565,471581],"./he-il/meeting-options.js":[565360,605644],"./he-il/meeting-recap.js":[747169,268477],"./he-il/meeting-room-console.js":[null],"./he-il/meeting-stream-app.js":[null],"./he-il/messaging.js":[395842,471581],"./he-il/mobile-attach.js":[null],"./he-il/mtma-missed-notifications.js":[456996,471581],"./he-il/nearby.js":[276399,471581],"./he-il/nova.js":[336942,471581],"./he-il/people-app.js":[null],"./he-il/people-picker.js":[428906,471581],"./he-il/people-targeting.js":[909277,232937],"./he-il/people.js":[470491,471581],"./he-il/person.js":[945565,471581],"./he-il/phonelink-sms.js":[962426,174690],"./he-il/pre-core.js":[null],"./he-il/premium-benefits.js":[115236,532432],"./he-il/presence.js":[555401,471581],"./he-il/queues.js":[779980,65552],"./he-il/recurrence.js":[367434,785190],"./he-il/rsc-application-permissions.js":[null],"./he-il/search.js":[411252,578232],"./he-il/semantic-object.js":[459822,274482],"./he-il/settings.js":[748461,471581],"./he-il/share-in-meetings.js":[null],"./he-il/share-to-teams-outlook-addin.js":[null],"./he-il/share-to-teams-third-party.js":[null],"./he-il/share-to-teams.js":[21868,948836],"./he-il/shortcut.js":[843774,471581],"./he-il/shortcuts.js":[591125,471581],"./he-il/simple-collab.js":[289810,471581],"./he-il/smart-device.js":[null],"./he-il/survey.js":[769854,633598],"./he-il/sv-flyout.js":[329437,471581],"./he-il/teams-and-channels.js":[227681,448881],"./he-il/teams-insider.js":[450279,471581],"./he-il/telemetry.js":[820773,471581],"./he-il/tfl-homepage.js":[741985,471581],"./he-il/tfl-onboarding.js":[604140,471581],"./he-il/toast-notifications.js":[244080,471581],"./he-il/trusted-ui.js":[null],"./he-il/unified-search.js":[33221,948836],"./he-il/unsupported-browser.js":[null],"./he-il/url-preview.js":[519202,471581],"./he-il/video-capture.js":[68874,88026],"./he-il/video-message.js":[922387,448503],"./he-il/virtual-consumer-events.js":[971950,765264],"./he-il/virtual-events.js":[630683,919036],"./he-il/webinar.js":[482868,880224],"./he-il/welcome-bot.js":[null],"./he-il/whats-new.js":[659162,471581],"./he-il/wiki.js":[null],"./hi-in/activity.js":[440219,304659],"./hi-in/artifacts-platform.js":[593823,826787],"./hi-in/audience-view-dialog.js":[668317,622273],"./hi-in/auth.js":[525260,304659],"./hi-in/autosuggest.js":[207995,304659],"./hi-in/avatar.js":[742539,304659],"./hi-in/biometric-enrollment.js":[685543,513443],"./hi-in/breakout-rooms.js":[874166,883650],"./hi-in/broadcast-scheduling.js":[735366,272450],"./hi-in/broadcast.js":[977723,686767],"./hi-in/calendar.js":[351500,693352],"./hi-in/calling.js":[449692,318080],"./hi-in/campaign-notifications.js":[496497,304659],"./hi-in/carousel-multi-card.js":[null],"./hi-in/cast.js":[960497,304659],"./hi-in/channels.js":[655622,304659],"./hi-in/chat-list.js":[538481,304659],"./hi-in/coach-report.js":[818969,796333],"./hi-in/comment-stream.js":[152570,909518],"./hi-in/communities.js":[989025,304659],"./hi-in/compose.js":[923104,304659],"./hi-in/contacts.js":[156527,304659],"./hi-in/datepicker.js":[65296,892665],"./hi-in/desktop.js":[924272,457820],"./hi-in/digital-signage.js":[null],"./hi-in/discover-surface.js":[76015,306891],"./hi-in/edu.js":[983232,355268],"./hi-in/embed.js":[13233,304659],"./hi-in/errors.js":[612529,304659],"./hi-in/esp.js":[156464,155236],"./hi-in/extensibility-ptz-extension.js":[null],"./hi-in/extensibility-room-remote.js":[null],"./hi-in/extensibility.js":[765629,304659],"./hi-in/feedback.js":[331813,276809],"./hi-in/files.js":[830639,304659],"./hi-in/framework.js":[767648,304659],"./hi-in/freemium-upgrade.js":[null],"./hi-in/funstuff.js":[260695,256747],"./hi-in/gallery.js":[911622,852538],"./hi-in/growth.js":[623953,304659],"./hi-in/guardians.js":[281060,134584],"./hi-in/health.js":[701652,581944],"./hi-in/help.js":[746013,987927],"./hi-in/hololens.js":[96850,318080],"./hi-in/host-controls.js":[586783,865811],"./hi-in/jana.js":[337926,957734],"./hi-in/lightbox.js":[730415,304659],"./hi-in/links.js":[864225,304659],"./hi-in/live-persona-card.js":[297776,304659],"./hi-in/live-persona-editor.js":[246715,801015],"./hi-in/lms-integration.js":[null],"./hi-in/meet-for-work.js":[234905,63517],"./hi-in/meeting-analytics.js":[11208,495428],"./hi-in/meeting-apis-app.js":[null],"./hi-in/meeting-bot.js":[null],"./hi-in/meeting-collaboration.js":[554889,739101],"./hi-in/meeting-flyout.js":[249377,304659],"./hi-in/meeting-meet-app.js":[498063,304659],"./hi-in/meeting-options.js":[257398,288722],"./hi-in/meeting-recap.js":[78111,386099],"./hi-in/meeting-room-console.js":[null],"./hi-in/meeting-stream-app.js":[null],"./hi-in/messaging.js":[678215,304659],"./hi-in/mobile-attach.js":[null],"./hi-in/mtma-missed-notifications.js":[669169,304659],"./hi-in/nearby.js":[228733,304659],"./hi-in/nova.js":[428084,304659],"./hi-in/people-app.js":[null],"./hi-in/people-picker.js":[192456,304659],"./hi-in/people-targeting.js":[156523,407079],"./hi-in/people.js":[91593,304659],"./hi-in/person.js":[549383,304659],"./hi-in/phonelink-sms.js":[58664,224748],"./hi-in/pre-core.js":[null],"./hi-in/premium-benefits.js":[791386,186350],"./hi-in/presence.js":[821563,304659],"./hi-in/queues.js":[967418,685294],"./hi-in/recurrence.js":[636468,167784],"./hi-in/rsc-application-permissions.js":[null],"./hi-in/search.js":[421802,892665],"./hi-in/semantic-object.js":[406080,343036],"./hi-in/settings.js":[202271,304659],"./hi-in/share-in-meetings.js":[null],"./hi-in/share-to-teams-outlook-addin.js":[null],"./hi-in/share-to-teams-third-party.js":[null],"./hi-in/share-to-teams.js":[448606,763194],"./hi-in/shortcut.js":[40648,304659],"./hi-in/shortcuts.js":[549015,304659],"./hi-in/simple-collab.js":[118608,304659],"./hi-in/smart-device.js":[null],"./hi-in/survey.js":[621724,451536],"./hi-in/sv-flyout.js":[169995,304659],"./hi-in/teams-and-channels.js":[848867,218847],"./hi-in/teams-insider.js":[56469,304659],"./hi-in/telemetry.js":[89871,304659],"./hi-in/tfl-homepage.js":[783895,304659],"./hi-in/tfl-onboarding.js":[301742,304659],"./hi-in/toast-notifications.js":[779914,304659],"./hi-in/trusted-ui.js":[null],"./hi-in/unified-search.js":[991435,763194],"./hi-in/unsupported-browser.js":[null],"./hi-in/url-preview.js":[202120,304659],"./hi-in/video-capture.js":[586568,637460],"./hi-in/video-message.js":[649261,906497],"./hi-in/virtual-consumer-events.js":[356740,419182],"./hi-in/virtual-events.js":[773089,118466],"./hi-in/webinar.js":[56826,957438],"./hi-in/welcome-bot.js":[null],"./hi-in/whats-new.js":[738616,304659],"./hi-in/wiki.js":[null],"./hr-hr/activity.js":[835429,787509],"./hr-hr/artifacts-platform.js":[767453,854533],"./hr-hr/audience-view-dialog.js":[923791,58871],"./hr-hr/auth.js":[437902,787509],"./hr-hr/autosuggest.js":[595165,787509],"./hr-hr/avatar.js":[778413,787509],"./hr-hr/biometric-enrollment.js":[700553,541189],"./hr-hr/breakout-rooms.js":[151456,346848],"./hr-hr/broadcast-scheduling.js":[481060,735648],"./hr-hr/broadcast.js":[888677,519113],"./hr-hr/calendar.js":[86986,605250],"./hr-hr/calling.js":[2942,695066],"./hr-hr/campaign-notifications.js":[688675,787509],"./hr-hr/carousel-multi-card.js":[null],"./hr-hr/cast.js":[95083,787509],"./hr-hr/channels.js":[42480,787509],"./hr-hr/chat-list.js":[692751,787509],"./hr-hr/coach-report.js":[286491,676779],"./hr-hr/comment-stream.js":[601304,963268],"./hr-hr/communities.js":[232031,787509],"./hr-hr/compose.js":[641574,787509],"./hr-hr/contacts.js":[266293,787509],"./hr-hr/datepicker.js":[9454,147036],"./hr-hr/desktop.js":[485330,439854],"./hr-hr/digital-signage.js":[null],"./hr-hr/discover-surface.js":[455397,766509],"./hr-hr/edu.js":[385478,617910],"./hr-hr/embed.js":[60067,787509],"./hr-hr/errors.js":[686231,787509],"./hr-hr/esp.js":[752402,901526],"./hr-hr/extensibility-ptz-extension.js":[null],"./hr-hr/extensibility-room-remote.js":[null],"./hr-hr/extensibility.js":[715999,787509],"./hr-hr/feedback.js":[928423,365503],"./hr-hr/files.js":[333869,787509],"./hr-hr/framework.js":[31622,787509],"./hr-hr/freemium-upgrade.js":[null],"./hr-hr/funstuff.js":[663821,424205],"./hr-hr/gallery.js":[494772,227608],"./hr-hr/growth.js":[578027,787509],"./hr-hr/guardians.js":[730234,60370],"./hr-hr/health.js":[567054,931026],"./hr-hr/help.js":[862351,258513],"./hr-hr/hololens.js":[233004,695066],"./hr-hr/host-controls.js":[110285,348661],"./hr-hr/jana.js":[648432,989724],"./hr-hr/lightbox.js":[318653,787509],"./hr-hr/links.js":[954091,787509],"./hr-hr/live-persona-card.js":[408234,787509],"./hr-hr/live-persona-editor.js":[473093,229617],"./hr-hr/lms-integration.js":[null],"./hr-hr/meet-for-work.js":[497043,357211],"./hr-hr/meeting-analytics.js":[819562,241718],"./hr-hr/meeting-apis-app.js":[null],"./hr-hr/meeting-bot.js":[null],"./hr-hr/meeting-collaboration.js":[390763,456091],"./hr-hr/meeting-flyout.js":[415235,787509],"./hr-hr/meeting-meet-app.js":[904561,787509],"./hr-hr/meeting-options.js":[816412,322224],"./hr-hr/meeting-recap.js":[456581,326421],"./hr-hr/meeting-room-console.js":[null],"./hr-hr/meeting-stream-app.js":[null],"./hr-hr/messaging.js":[731038,787509],"./hr-hr/mobile-attach.js":[null],"./hr-hr/mtma-missed-notifications.js":[929200,787509],"./hr-hr/nearby.js":[701643,787509],"./hr-hr/nova.js":[922706,787509],"./hr-hr/people-app.js":[null],"./hr-hr/people-picker.js":[4558,787509],"./hr-hr/people-targeting.js":[148753,203425],"./hr-hr/people.js":[663063,787509],"./hr-hr/person.js":[595425,787509],"./hr-hr/phonelink-sms.js":[246454,118654],"./hr-hr/pre-core.js":[null],"./hr-hr/premium-benefits.js":[29536,345060],"./hr-hr/presence.js":[27221,787509],"./hr-hr/queues.js":[946040,878180],"./hr-hr/recurrence.js":[117230,529154],"./hr-hr/rsc-application-permissions.js":[null],"./hr-hr/search.js":[519144,147036],"./hr-hr/semantic-object.js":[595858,634638],"./hr-hr/settings.js":[856721,787509],"./hr-hr/share-in-meetings.js":[null],"./hr-hr/share-to-teams-outlook-addin.js":[null],"./hr-hr/share-to-teams-third-party.js":[null],"./hr-hr/share-to-teams.js":[288936,595736],"./hr-hr/shortcut.js":[947818,787509],"./hr-hr/shortcuts.js":[693369,787509],"./hr-hr/simple-collab.js":[444590,787509],"./hr-hr/smart-device.js":[null],"./hr-hr/survey.js":[779138,491114],"./hr-hr/sv-flyout.js":[666585,787509],"./hr-hr/teams-and-channels.js":[910757,414521],"./hr-hr/teams-insider.js":[476739,787509],"./hr-hr/telemetry.js":[758321,787509],"./hr-hr/tfl-homepage.js":[262325,787509],"./hr-hr/tfl-onboarding.js":[278600,787509],"./hr-hr/toast-notifications.js":[371164,787509],"./hr-hr/trusted-ui.js":[null],"./hr-hr/unified-search.js":[574089,595736],"./hr-hr/unsupported-browser.js":[null],"./hr-hr/url-preview.js":[683438,787509],"./hr-hr/video-capture.js":[429566,745414],"./hr-hr/video-message.js":[479423,343095],"./hr-hr/virtual-consumer-events.js":[513266,577892],"./hr-hr/virtual-events.js":[129191,581664],"./hr-hr/webinar.js":[397968,696372],"./hr-hr/welcome-bot.js":[null],"./hr-hr/whats-new.js":[658894,787509],"./hr-hr/wiki.js":[null],"./hu-hu/activity.js":[694691,681947],"./hu-hu/artifacts-platform.js":[574247,681131],"./hu-hu/audience-view-dialog.js":[359893,513581],"./hu-hu/auth.js":[239316,681947],"./hu-hu/autosuggest.js":[291411,681947],"./hu-hu/avatar.js":[664579,681947],"./hu-hu/biometric-enrollment.js":[997871,851435],"./hu-hu/breakout-rooms.js":[103438,739734],"./hu-hu/broadcast-scheduling.js":[799454,128534],"./hu-hu/broadcast.js":[283571,817599],"./hu-hu/calendar.js":[287076,757704],"./hu-hu/calling.js":[742244,558720],"./hu-hu/campaign-notifications.js":[167289,681947],"./hu-hu/carousel-multi-card.js":[null],"./hu-hu/cast.js":[617513,681947],"./hu-hu/channels.js":[278974,681947],"./hu-hu/chat-list.js":[548153,681947],"./hu-hu/coach-report.js":[226641,507377],"./hu-hu/comment-stream.js":[488882,788954],"./hu-hu/communities.js":[930601,681947],"./hu-hu/compose.js":[299e3,681947],"./hu-hu/contacts.js":[26471,681947],"./hu-hu/datepicker.js":[362280,517650],"./hu-hu/desktop.js":[182392,47972],"./hu-hu/digital-signage.js":[null],"./hu-hu/discover-surface.js":[980631,490963],"./hu-hu/edu.js":[188136,773292],"./hu-hu/embed.js":[521673,681947],"./hu-hu/errors.js":[704633,681947],"./hu-hu/esp.js":[505848,573260],"./hu-hu/extensibility-ptz-extension.js":[null],"./hu-hu/extensibility-room-remote.js":[null],"./hu-hu/extensibility.js":[231861,681947],"./hu-hu/feedback.js":[321165,147445],"./hu-hu/files.js":[354743,681947],"./hu-hu/framework.js":[546296,681947],"./hu-hu/freemium-upgrade.js":[null],"./hu-hu/funstuff.js":[312543,492403],"./hu-hu/gallery.js":[236062,740462],"./hu-hu/growth.js":[118569,681947],"./hu-hu/guardians.js":[568748,186648],"./hu-hu/health.js":[570607,599832],"./hu-hu/help.js":[943669,995303],"./hu-hu/hololens.js":[319658,558720],"./hu-hu/host-controls.js":[998167,243099],"./hu-hu/jana.js":[902897,876690],"./hu-hu/lightbox.js":[558071,681947],"./hu-hu/links.js":[974793,681947],"./hu-hu/live-persona-card.js":[913176,681947],"./hu-hu/live-persona-editor.js":[318819,932231],"./hu-hu/lms-integration.js":[null],"./hu-hu/meet-for-work.js":[972513,210849],"./hu-hu/meeting-analytics.js":[924496,913452],"./hu-hu/meeting-apis-app.js":[null],"./hu-hu/meeting-bot.js":[null],"./hu-hu/meeting-collaboration.js":[402465,428961],"./hu-hu/meeting-flyout.js":[277673,681947],"./hu-hu/meeting-meet-app.js":[862887,681947],"./hu-hu/meeting-options.js":[816894,741286],"./hu-hu/meeting-recap.js":[840935,598075],"./hu-hu/meeting-room-console.js":[null],"./hu-hu/meeting-stream-app.js":[null],"./hu-hu/messaging.js":[313484,681947],"./hu-hu/mobile-attach.js":[null],"./hu-hu/mtma-missed-notifications.js":[176694,681947],"./hu-hu/nearby.js":[429237,681947],"./hu-hu/nova.js":[603180,681947],"./hu-hu/people-app.js":[null],"./hu-hu/people-picker.js":[457376,681947],"./hu-hu/people-targeting.js":[785331,831415],"./hu-hu/people.js":[863553,681947],"./hu-hu/person.js":[736735,681947],"./hu-hu/phonelink-sms.js":[462336,436980],"./hu-hu/pre-core.js":[null],"./hu-hu/premium-benefits.js":[542066,31610],"./hu-hu/presence.js":[352707,681947],"./hu-hu/queues.js":[234546,988026],"./hu-hu/recurrence.js":[341276,655432],"./hu-hu/rsc-application-permissions.js":[null],"./hu-hu/search.js":[35346,517650],"./hu-hu/semantic-object.js":[323592,527300],"./hu-hu/settings.js":[495831,681947],"./hu-hu/share-in-meetings.js":[null],"./hu-hu/share-to-teams-outlook-addin.js":[null],"./hu-hu/share-to-teams-third-party.js":[null],"./hu-hu/share-to-teams.js":[326982,651118],"./hu-hu/shortcut.js":[357248,681947],"./hu-hu/shortcuts.js":[227391,681947],"./hu-hu/simple-collab.js":[990824,681947],"./hu-hu/smart-device.js":[null],"./hu-hu/survey.js":[474756,279632],"./hu-hu/sv-flyout.js":[412339,681947],"./hu-hu/teams-and-channels.js":[620699,671535],"./hu-hu/teams-insider.js":[909261,681947],"./hu-hu/telemetry.js":[664071,681947],"./hu-hu/tfl-homepage.js":[610847,681947],"./hu-hu/tfl-onboarding.js":[970454,681947],"./hu-hu/toast-notifications.js":[755746,681947],"./hu-hu/trusted-ui.js":[null],"./hu-hu/unified-search.js":[494355,651118],"./hu-hu/unsupported-browser.js":[null],"./hu-hu/url-preview.js":[840864,681947],"./hu-hu/video-capture.js":[3552,919420],"./hu-hu/video-message.js":[635861,797805],"./hu-hu/virtual-consumer-events.js":[593836,264442],"./hu-hu/virtual-events.js":[68185,974550],"./hu-hu/webinar.js":[409250,399178],"./hu-hu/welcome-bot.js":[null],"./hu-hu/whats-new.js":[414800,681947],"./hu-hu/wiki.js":[null],"./id-id/activity.js":[299043,119331],"./id-id/artifacts-platform.js":[192231,744947],"./id-id/audience-view-dialog.js":[263957,106229],"./id-id/auth.js":[290452,119331],"./id-id/autosuggest.js":[561939,119331],"./id-id/avatar.js":[188611,119331],"./id-id/biometric-enrollment.js":[901935,431603],"./id-id/breakout-rooms.js":[548046,3750],"./id-id/broadcast-scheduling.js":[703518,908902],"./id-id/broadcast.js":[608499,95543],"./id-id/calendar.js":[891428,427224],"./id-id/calling.js":[190628,438896],"./id-id/campaign-notifications.js":[114809,119331],"./id-id/carousel-multi-card.js":[null],"./id-id/cast.js":[668649,119331],"./id-id/channels.js":[883326,119331],"./id-id/chat-list.js":[873081,119331],"./id-id/coach-report.js":[407889,475273],"./id-id/comment-stream.js":[933490,387098],"./id-id/communities.js":[717481,119331],"./id-id/compose.js":[747384,119331],"./id-id/contacts.js":[630823,119331],"./id-id/datepicker.js":[508200,934226],"./id-id/desktop.js":[630776,814052],"./id-id/digital-signage.js":[null],"./id-id/discover-surface.js":[17303,285947],"./id-id/edu.js":[624616,955500],"./id-id/embed.js":[88009,119331],"./id-id/errors.js":[228665,119331],"./id-id/esp.js":[425976,906380],"./id-id/extensibility-ptz-extension.js":[null],"./id-id/extensibility-room-remote.js":[null],"./id-id/extensibility.js":[596789,119331],"./id-id/feedback.js":[925517,865149],"./id-id/files.js":[404727,119331],"./id-id/framework.js":[387576,119331],"./id-id/freemium-upgrade.js":[null],"./id-id/funstuff.js":[916895,235803],"./id-id/gallery.js":[200798,361726],"./id-id/growth.js":[158953,119331],"./id-id/guardians.js":[410028,853800],"./id-id/health.js":[317020,724456],"./id-id/help.js":[994805,308671],"./id-id/hololens.js":[924010,438896],"./id-id/host-controls.js":[363095,680483],"./id-id/jana.js":[660062,776914],"./id-id/lightbox.js":[162423,119331],"./id-id/links.js":[24777,119331],"./id-id/live-persona-card.js":[124056,119331],"./id-id/live-persona-editor.js":[424867,121759],"./id-id/lms-integration.js":[null],"./id-id/meet-for-work.js":[337441,700601],"./id-id/meeting-analytics.js":[135376,95660],"./id-id/meeting-apis-app.js":[null],"./id-id/meeting-bot.js":[null],"./id-id/meeting-collaboration.js":[275489,376185],"./id-id/meeting-flyout.js":[722281,119331],"./id-id/meeting-meet-app.js":[899559,119331],"./id-id/meeting-options.js":[40446,414134],"./id-id/meeting-recap.js":[689511,606659],"./id-id/meeting-room-console.js":[null],"./id-id/meeting-stream-app.js":[null],"./id-id/messaging.js":[154764,119331],"./id-id/mobile-attach.js":[null],"./id-id/mtma-missed-notifications.js":[297654,119331],"./id-id/nearby.js":[469621,119331],"./id-id/nova.js":[137964,119331],"./id-id/people-app.js":[null],"./id-id/people-picker.js":[822304,119331],"./id-id/people-targeting.js":[822003,707599],"./id-id/people.js":[387585,119331],"./id-id/person.js":[777119,119331],"./id-id/phonelink-sms.js":[827264,795316],"./id-id/pre-core.js":[null],"./id-id/premium-benefits.js":[578738,768890],"./id-id/presence.js":[957059,119331],"./id-id/queues.js":[758578,751482],"./id-id/recurrence.js":[487196,444184],"./id-id/rsc-application-permissions.js":[null],"./id-id/search.js":[559378,934226],"./id-id/semantic-object.js":[63496,307780],"./id-id/settings.js":[100183,119331],"./id-id/share-in-meetings.js":[null],"./id-id/share-to-teams-outlook-addin.js":[null],"./id-id/share-to-teams-third-party.js":[null],"./id-id/share-to-teams.js":[771590,695678],"./id-id/shortcut.js":[961600,119331],"./id-id/shortcuts.js":[552319,119331],"./id-id/simple-collab.js":[355752,119331],"./id-id/smart-device.js":[null],"./id-id/survey.js":[998788,638464],"./id-id/sv-flyout.js":[737267,119331],"./id-id/teams-and-channels.js":[238683,827495],"./id-id/teams-insider.js":[274189,119331],"./id-id/telemetry.js":[505351,119331],"./id-id/tfl-homepage.js":[792095,119331],"./id-id/tfl-onboarding.js":[415062,119331],"./id-id/toast-notifications.js":[861794,119331],"./id-id/trusted-ui.js":[null],"./id-id/unified-search.js":[455315,695678],"./id-id/unsupported-browser.js":[null],"./id-id/url-preview.js":[111392,119331],"./id-id/video-capture.js":[368480,69116],"./id-id/video-message.js":[484437,390453],"./id-id/virtual-consumer-events.js":[898540,485370],"./id-id/virtual-events.js":[512793,238566],"./id-id/webinar.js":[373986,564554],"./id-id/welcome-bot.js":[null],"./id-id/whats-new.js":[256080,119331],"./id-id/wiki.js":[null],"./is-is/activity.js":[809645,640885],"./is-is/artifacts-platform.js":[45669,722309],"./is-is/audience-view-dialog.js":[230183,860743],"./is-is/auth.js":[542934,640885],"./is-is/autosuggest.js":[334677,640885],"./is-is/avatar.js":[843333,640885],"./is-is/biometric-enrollment.js":[711953,408965],"./is-is/breakout-rooms.js":[978392,699064],"./is-is/broadcast-scheduling.js":[88700,87864],"./is-is/broadcast.js":[915645,665849],"./is-is/calendar.js":[906946,920682],"./is-is/calling.js":[216454,532098],"./is-is/campaign-notifications.js":[643499,640885],"./is-is/carousel-multi-card.js":[null],"./is-is/cast.js":[564163,640885],"./is-is/channels.js":[435816,640885],"./is-is/chat-list.js":[662135,640885],"./is-is/coach-report.js":[232659,478651],"./is-is/comment-stream.js":[922352,200460],"./is-is/communities.js":[818503,640885],"./is-is/compose.js":[797758,640885],"./is-is/contacts.js":[76461,640885],"./is-is/datepicker.js":[404006,25988],"./is-is/desktop.js":[53946,420278],"./is-is/digital-signage.js":[null],"./is-is/discover-surface.js":[213037,367021],"./is-is/edu.js":[79662,686654],"./is-is/embed.js":[89531,640885],"./is-is/errors.js":[196255,640885],"./is-is/esp.js":[116698,689118],"./is-is/extensibility-ptz-extension.js":[null],"./is-is/extensibility-room-remote.js":[null],"./is-is/extensibility.js":[381751,640885],"./is-is/feedback.js":[315759,349487],"./is-is/files.js":[517813,640885],"./is-is/framework.js":[797246,640885],"./is-is/freemium-upgrade.js":[null],"./is-is/funstuff.js":[211061,575245],"./is-is/gallery.js":[846988,987696],"./is-is/growth.js":[83171,640885],"./is-is/guardians.js":[822338,765434],"./is-is/health.js":[260054,636090],"./is-is/help.js":[513799,318977],"./is-is/hololens.js":[850308,532098],"./is-is/host-controls.js":[390149,685685],"./is-is/jana.js":[50120,385028],"./is-is/lightbox.js":[390309,640885],"./is-is/links.js":[84723,640885],"./is-is/live-persona-card.js":[334482,640885],"./is-is/live-persona-editor.js":[809133,348961],"./is-is/lms-integration.js":[null],"./is-is/meet-for-work.js":[4987,564971],"./is-is/meeting-analytics.js":[387762,826814],"./is-is/meeting-apis-app.js":[null],"./is-is/meeting-bot.js":[null],"./is-is/meeting-collaboration.js":[184963,206379],"./is-is/meeting-flyout.js":[897227,640885],"./is-is/meeting-meet-app.js":[615241,640885],"./is-is/meeting-options.js":[824772,651400],"./is-is/meeting-recap.js":[273421,40661],"./is-is/meeting-room-console.js":[null],"./is-is/meeting-stream-app.js":[null],"./is-is/messaging.js":[834486,640885],"./is-is/mobile-attach.js":[null],"./is-is/mtma-missed-notifications.js":[367208,640885],"./is-is/nearby.js":[983971,640885],"./is-is/nova.js":[363498,640885],"./is-is/people-app.js":[null],"./is-is/people-picker.js":[721574,640885],"./is-is/people-targeting.js":[16185,350161],"./is-is/people.js":[89615,640885],"./is-is/person.js":[242873,640885],"./is-is/phonelink-sms.js":[543534,210950],"./is-is/pre-core.js":[null],"./is-is/premium-benefits.js":[390456,633836],"./is-is/presence.js":[908765,640885],"./is-is/queues.js":[742320,709484],"./is-is/recurrence.js":[446358,395114],"./is-is/rsc-application-permissions.js":[null],"./is-is/search.js":[816592,25988],"./is-is/semantic-object.js":[257946,862422],"./is-is/settings.js":[371369,640885],"./is-is/share-in-meetings.js":[null],"./is-is/share-to-teams-outlook-addin.js":[null],"./is-is/share-to-teams-third-party.js":[null],"./is-is/share-to-teams.js":[771760,321648],"./is-is/shortcut.js":[81570,640885],"./is-is/shortcuts.js":[206369,640885],"./is-is/simple-collab.js":[637862,640885],"./is-is/smart-device.js":[null],"./is-is/survey.js":[196106,624722],"./is-is/sv-flyout.js":[525537,640885],"./is-is/teams-and-channels.js":[875869,568041],"./is-is/teams-insider.js":[623707,640885],"./is-is/telemetry.js":[355913,640885],"./is-is/tfl-homepage.js":[970525,640885],"./is-is/tfl-onboarding.js":[845584,640885],"./is-is/toast-notifications.js":[760212,640885],"./is-is/trusted-ui.js":[null],"./is-is/unified-search.js":[510833,321648],"./is-is/unsupported-browser.js":[null],"./is-is/url-preview.js":[243270,640885],"./is-is/video-capture.js":[864150,592206],"./is-is/video-message.js":[170055,144967],"./is-is/virtual-consumer-events.js":[115770,350316],"./is-is/virtual-events.js":[642303,933880],"./is-is/webinar.js":[971736,978364],"./is-is/welcome-bot.js":[null],"./is-is/whats-new.js":[549894,640885],"./is-is/wiki.js":[null],"./it-it/activity.js":[575171,811587],"./it-it/artifacts-platform.js":[419271,551635],"./it-it/audience-view-dialog.js":[172341,815893],"./it-it/auth.js":[783476,811587],"./it-it/autosuggest.js":[722611,811587],"./it-it/avatar.js":[637411,811587],"./it-it/biometric-enrollment.js":[39375,721939],"./it-it/breakout-rooms.js":[330734,45606],"./it-it/broadcast-scheduling.js":[672574,434406],"./it-it/broadcast.js":[720275,976503],"./it-it/calendar.js":[799556,124600],"./it-it/calling.js":[284996,278544],"./it-it/campaign-notifications.js":[172313,811587],"./it-it/carousel-multi-card.js":[null],"./it-it/cast.js":[488393,811587],"./it-it/channels.js":[829470,811587],"./it-it/chat-list.js":[356505,811587],"./it-it/coach-report.js":[478449,294249],"./it-it/comment-stream.js":[366290,68218],"./it-it/communities.js":[597705,811587],"./it-it/compose.js":[354136,811587],"./it-it/contacts.js":[910919,811587],"./it-it/datepicker.js":[692360,352946],"./it-it/desktop.js":[504408,168260],"./it-it/digital-signage.js":[null],"./it-it/discover-surface.js":[822903,401499],"./it-it/edu.js":[336968,213324],"./it-it/embed.js":[733865,811587],"./it-it/errors.js":[72793,811587],"./it-it/esp.js":[746712,50476],"./it-it/extensibility-ptz-extension.js":[null],"./it-it/extensibility-room-remote.js":[null],"./it-it/extensibility.js":[10837,811587],"./it-it/feedback.js":[120941,132445],"./it-it/files.js":[500823,811587],"./it-it/framework.js":[655512,811587],"./it-it/freemium-upgrade.js":[null],"./it-it/funstuff.js":[372223,945467],"./it-it/gallery.js":[785598,46334],"./it-it/growth.js":[462089,811587],"./it-it/guardians.js":[817036,156424],"./it-it/health.js":[74556,27080],"./it-it/help.js":[603221,401183],"./it-it/hololens.js":[675210,278544],"./it-it/host-controls.js":[47927,372739],"./it-it/jana.js":[124286,195634],"./it-it/lightbox.js":[987031,811587],"./it-it/links.js":[356137,811587],"./it-it/live-persona-card.js":[873080,811587],"./it-it/live-persona-editor.js":[98755,431167],"./it-it/lms-integration.js":[null],"./it-it/meet-for-work.js":[361025,397977],"./it-it/meeting-analytics.js":[429808,353484],"./it-it/meeting-apis-app.js":[null],"./it-it/meeting-bot.js":[null],"./it-it/meeting-collaboration.js":[220481,73561],"./it-it/meeting-flyout.js":[484553,811587],"./it-it/meeting-meet-app.js":[923847,811587],"./it-it/meeting-options.js":[831198,888630],"./it-it/meeting-recap.js":[411015,316323],"./it-it/meeting-room-console.js":[null],"./it-it/meeting-stream-app.js":[null],"./it-it/messaging.js":[437676,811587],"./it-it/mobile-attach.js":[null],"./it-it/mtma-missed-notifications.js":[705302,811587],"./it-it/nearby.js":[170581,811587],"./it-it/nova.js":[587788,811587],"./it-it/people-app.js":[null],"./it-it/people-picker.js":[332352,811587],"./it-it/people-targeting.js":[620051,449775],"./it-it/people.js":[783777,811587],"./it-it/person.js":[364799,811587],"./it-it/phonelink-sms.js":[502304,924756],"./it-it/pre-core.js":[null],"./it-it/premium-benefits.js":[254354,939162],"./it-it/presence.js":[155363,811587],"./it-it/queues.js":[620946,895578],"./it-it/recurrence.js":[554108,141560],"./it-it/rsc-application-permissions.js":[null],"./it-it/search.js":[69298,352946],"./it-it/semantic-object.js":[394280,33700],"./it-it/settings.js":[160759,811587],"./it-it/share-in-meetings.js":[null],"./it-it/share-to-teams-outlook-addin.js":[null],"./it-it/share-to-teams-third-party.js":[null],"./it-it/share-to-teams.js":[8102,956990],"./it-it/shortcut.js":[744480,811587],"./it-it/shortcuts.js":[785119,811587],"./it-it/simple-collab.js":[82203,811587],"./it-it/smart-device.js":[null],"./it-it/survey.js":[482852,850400],"./it-it/sv-flyout.js":[679379,811587],"./it-it/teams-and-channels.js":[615739,489063],"./it-it/teams-insider.js":[355949,811587],"./it-it/telemetry.js":[560999,811587],"./it-it/tfl-homepage.js":[618175,811587],"./it-it/tfl-onboarding.js":[65398,811587],"./it-it/toast-notifications.js":[118850,811587],"./it-it/trusted-ui.js":[null],"./it-it/unified-search.js":[73523,956990],"./it-it/unsupported-browser.js":[null],"./it-it/url-preview.js":[517376,811587],"./it-it/video-capture.js":[981184,976604],"./it-it/video-message.js":[769909,100117],"./it-it/virtual-consumer-events.js":[214668,171994],"./it-it/virtual-events.js":[939065,764070],"./it-it/webinar.js":[482754,306730],"./it-it/welcome-bot.js":[null],"./it-it/whats-new.js":[491312,811587],"./it-it/wiki.js":[null],"./ja-jp/activity.js":[387206,264298],"./ja-jp/artifacts-platform.js":[816066,724442],"./ja-jp/audience-view-dialog.js":[590772,678652],"./ja-jp/auth.js":[493721,264298],"./ja-jp/autosuggest.js":[820848,264298],"./ja-jp/avatar.js":[840018,264298],"./ja-jp/biometric-enrollment.js":[582966,411098],"./ja-jp/breakout-rooms.js":[293867,229763],"./ja-jp/broadcast-scheduling.js":[734895,618563],"./ja-jp/broadcast.js":[967616,669150],"./ja-jp/calendar.js":[731649,360613],"./ja-jp/calling.js":[659215,457373],"./ja-jp/campaign-notifications.js":[61796,264298],"./ja-jp/carousel-multi-card.js":[null],"./ja-jp/cast.js":[448020,264298],"./ja-jp/channels.js":[659639,264298],"./ja-jp/chat-list.js":[993510,264298],"./ja-jp/coach-report.js":[299424,223760],"./ja-jp/comment-stream.js":[486039,237751],"./ja-jp/communities.js":[474082,264298],"./ja-jp/compose.js":[813179,264298],"./ja-jp/contacts.js":[878542,264298],"./ja-jp/datepicker.js":[620441,710223],"./ja-jp/desktop.js":[438415,715009],"./ja-jp/digital-signage.js":[null],"./ja-jp/discover-surface.js":[377414,676962],"./ja-jp/edu.js":[933955,588777],"./ja-jp/embed.js":[249254,264298],"./ja-jp/errors.js":[619036,264298],"./ja-jp/esp.js":[371091,425929],"./ja-jp/extensibility-ptz-extension.js":[null],"./ja-jp/extensibility-room-remote.js":[null],"./ja-jp/extensibility.js":[666730,264298],"./ja-jp/feedback.js":[839540,784164],"./ja-jp/files.js":[705788,264298],"./ja-jp/framework.js":[724519,264298],"./ja-jp/freemium-upgrade.js":[null],"./ja-jp/funstuff.js":[26930,797634],"./ja-jp/gallery.js":[684593,657467],"./ja-jp/growth.js":[578332,264298],"./ja-jp/guardians.js":[921623,467989],"./ja-jp/health.js":[771113,869397],"./ja-jp/help.js":[933608,93830],"./ja-jp/hololens.js":[397823,457373],"./ja-jp/host-controls.js":[914516,825450],"./ja-jp/jana.js":[837903,552911],"./ja-jp/lightbox.js":[476782,264298],"./ja-jp/links.js":[115610,264298],"./ja-jp/live-persona-card.js":[124999,264298],"./ja-jp/live-persona-editor.js":[376880,390566],"./ja-jp/lms-integration.js":[null],"./ja-jp/meet-for-work.js":[432766,913312],"./ja-jp/meeting-analytics.js":[824955,728937],"./ja-jp/meeting-apis-app.js":[null],"./ja-jp/meeting-bot.js":[null],"./ja-jp/meeting-collaboration.js":[351722,540320],"./ja-jp/meeting-flyout.js":[572220,264298],"./ja-jp/meeting-meet-app.js":[502074,264298],"./ja-jp/meeting-options.js":[699485,279411],"./ja-jp/meeting-recap.js":[367064,703050],"./ja-jp/meeting-room-console.js":[null],"./ja-jp/meeting-stream-app.js":[null],"./ja-jp/messaging.js":[711695,264298],"./ja-jp/mobile-attach.js":[null],"./ja-jp/mtma-missed-notifications.js":[262077,264298],"./ja-jp/nearby.js":[256064,264298],"./ja-jp/nova.js":[152625,264298],"./ja-jp/people-app.js":[null],"./ja-jp/people-picker.js":[448159,264298],"./ja-jp/people-targeting.js":[279318,367862],"./ja-jp/people.js":[25992,264298],"./ja-jp/person.js":[489134,264298],"./ja-jp/phonelink-sms.js":[927715,707953],"./ja-jp/pre-core.js":[null],"./ja-jp/premium-benefits.js":[438343,62743],"./ja-jp/presence.js":[143214,264298],"./ja-jp/queues.js":[842491,581463],"./ja-jp/recurrence.js":[485281,820645],"./ja-jp/rsc-application-permissions.js":[null],"./ja-jp/search.js":[506203,710223],"./ja-jp/semantic-object.js":[140423,208737],"./ja-jp/settings.js":[701766,264298],"./ja-jp/share-in-meetings.js":[null],"./ja-jp/share-to-teams-outlook-addin.js":[null],"./ja-jp/share-to-teams-third-party.js":[null],"./ja-jp/share-to-teams.js":[239027,568123],"./ja-jp/shortcut.js":[945653,264298],"./ja-jp/shortcuts.js":[11200,264298],"./ja-jp/simple-collab.js":[711791,264298],"./ja-jp/smart-device.js":[null],"./ja-jp/survey.js":[928457,946061],"./ja-jp/sv-flyout.js":[395800,264298],"./ja-jp/teams-and-channels.js":[864326,407150],"./ja-jp/teams-insider.js":[900938,264298],"./ja-jp/telemetry.js":[968956,264298],"./ja-jp/tfl-homepage.js":[626250,264298],"./ja-jp/tfl-onboarding.js":[225531,264298],"./ja-jp/toast-notifications.js":[267261,264298],"./ja-jp/trusted-ui.js":[null],"./ja-jp/unified-search.js":[467938,568123],"./ja-jp/unsupported-browser.js":[null],"./ja-jp/url-preview.js":[892959,264298],"./ja-jp/video-capture.js":[215983,93849],"./ja-jp/video-message.js":[58826,962876],"./ja-jp/virtual-consumer-events.js":[121123,295575],"./ja-jp/virtual-events.js":[249236,464579],"./ja-jp/webinar.js":[941449,239239],"./ja-jp/welcome-bot.js":[null],"./ja-jp/whats-new.js":[989475,264298],"./ja-jp/wiki.js":[null],"./ka-ge/activity.js":[859817,7817],"./ka-ge/artifacts-platform.js":[983457,180185],"./ka-ge/audience-view-dialog.js":[487243,263819],"./ka-ge/auth.js":[292778,7817],"./ka-ge/autosuggest.js":[151025,7817],"./ka-ge/avatar.js":[76537,7817],"./ka-ge/biometric-enrollment.js":[394965,350489],"./ka-ge/breakout-rooms.js":[199068,541204],"./ka-ge/broadcast-scheduling.js":[395696,930004],"./ka-ge/broadcast.js":[16225,45037],"./ka-ge/calendar.js":[427366,843326],"./ka-ge/calling.js":[890066,55174],"./ka-ge/campaign-notifications.js":[594455,7817],"./ka-ge/carousel-multi-card.js":[null],"./ka-ge/cast.js":[625935,7817],"./ka-ge/channels.js":[415388,7817],"./ka-ge/chat-list.js":[688979,7817],"./ka-ge/coach-report.js":[814783,792127],"./ka-ge/comment-stream.js":[928740,842696],"./ka-ge/communities.js":[593947,7817],"./ka-ge/compose.js":[254282,7817],"./ka-ge/contacts.js":[207169,7817],"./ka-ge/datepicker.js":[790602,445872],"./ka-ge/desktop.js":[830198,79962],"./ka-ge/digital-signage.js":[null],"./ka-ge/discover-surface.js":[10721,57713],"./ka-ge/edu.js":[151778,764178],"./ka-ge/embed.js":[494519,7817],"./ka-ge/errors.js":[627203,7817],"./ka-ge/esp.js":[760702,152626],"./ka-ge/extensibility-ptz-extension.js":[null],"./ka-ge/extensibility-room-remote.js":[null],"./ka-ge/extensibility.js":[443075,7817],"./ka-ge/feedback.js":[267363,672131],"./ka-ge/files.js":[762617,7817],"./ka-ge/framework.js":[89122,7817],"./ka-ge/freemium-upgrade.js":[null],"./ka-ge/funstuff.js":[971105,21969],"./ka-ge/gallery.js":[901976,453436],"./ka-ge/growth.js":[293831,7817],"./ka-ge/guardians.js":[728814,205646],"./ka-ge/health.js":[17154,667406],"./ka-ge/help.js":[706779,259685],"./ka-ge/hololens.js":[389496,55174],"./ka-ge/host-controls.js":[833150,568969],"./ka-ge/jana.js":[55620,288560],"./ka-ge/lightbox.js":[30649,7817],"./ka-ge/links.js":[946735,7817],"./ka-ge/live-persona-card.js":[542566,7817],"./ka-ge/live-persona-editor.js":[958345,556421],"./ka-ge/lms-integration.js":[null],"./ka-ge/meet-for-work.js":[837367,507887],"./ka-ge/meeting-analytics.js":[741694,904338],"./ka-ge/meeting-apis-app.js":[null],"./ka-ge/meeting-bot.js":[null],"./ka-ge/meeting-collaboration.js":[986015,183471],"./ka-ge/meeting-flyout.js":[196575,7817],"./ka-ge/meeting-meet-app.js":[965085,7817],"./ka-ge/meeting-options.js":[83096,530468],"./ka-ge/meeting-recap.js":[437321,23273],"./ka-ge/meeting-room-console.js":[null],"./ka-ge/meeting-stream-app.js":[null],"./ka-ge/messaging.js":[844346,7817],"./ka-ge/mobile-attach.js":[null],"./ka-ge/mtma-missed-notifications.js":[145500,7817],"./ka-ge/nearby.js":[16359,7817],"./ka-ge/nova.js":[632582,7817],"./ka-ge/people-app.js":[null],"./ka-ge/people-picker.js":[423106,7817],"./ka-ge/people-targeting.js":[483845,520885],"./ka-ge/people.js":[724947,7817],"./ka-ge/person.js":[209685,7817],"./ka-ge/phonelink-sms.js":[937234,242602],"./ka-ge/pre-core.js":[null],"./ka-ge/premium-benefits.js":[117628,110760],"./ka-ge/presence.js":[395441,7817],"./ka-ge/queues.js":[389732,186408],"./ka-ge/recurrence.js":[743666,752830],"./ka-ge/rsc-application-permissions.js":[null],"./ka-ge/search.js":[429276,445872],"./ka-ge/semantic-object.js":[602070,461754],"./ka-ge/settings.js":[367141,7817],"./ka-ge/share-in-meetings.js":[null],"./ka-ge/share-to-teams-outlook-addin.js":[null],"./ka-ge/share-to-teams-third-party.js":[null],"./ka-ge/share-to-teams.js":[439604,364092],"./ka-ge/shortcut.js":[971894,7817],"./ka-ge/shortcuts.js":[689181,7817],"./ka-ge/simple-collab.js":[188170,7817],"./ka-ge/smart-device.js":[null],"./ka-ge/survey.js":[877734,180310],"./ka-ge/sv-flyout.js":[832261,7817],"./ka-ge/teams-and-channels.js":[392889,676253],"./ka-ge/teams-insider.js":[490239,7817],"./ka-ge/telemetry.js":[447005,7817],"./ka-ge/tfl-homepage.js":[425353,7817],"./ka-ge/tfl-onboarding.js":[284820,7817],"./ka-ge/toast-notifications.js":[999656,7817],"./ka-ge/trusted-ui.js":[null],"./ka-ge/unified-search.js":[366925,364092],"./ka-ge/unsupported-browser.js":[null],"./ka-ge/url-preview.js":[302938,7817],"./ka-ge/video-capture.js":[192610,854754],"./ka-ge/video-message.js":[901787,548043],"./ka-ge/virtual-consumer-events.js":[214646,343592],"./ka-ge/virtual-events.js":[52275,776020],"./ka-ge/webinar.js":[906716,437176],"./ka-ge/welcome-bot.js":[null],"./ka-ge/whats-new.js":[44018,7817],"./ka-ge/wiki.js":[null],"./kk-kz/activity.js":[677868,686952],"./kk-kz/artifacts-platform.js":[855044,371992],"./kk-kz/audience-view-dialog.js":[293978,550162],"./kk-kz/auth.js":[724751,686952],"./kk-kz/autosuggest.js":[183742,686952],"./kk-kz/avatar.js":[840208,686952],"./kk-kz/biometric-enrollment.js":[903252,58648],"./kk-kz/breakout-rooms.js":[460033,295033],"./kk-kz/broadcast-scheduling.js":[762481,200185],"./kk-kz/broadcast.js":[507694,623884],"./kk-kz/calendar.js":[555571,396203],"./kk-kz/calling.js":[393181,63395],"./kk-kz/campaign-notifications.js":[649706,686952],"./kk-kz/carousel-multi-card.js":[null],"./kk-kz/cast.js":[911690,686952],"./kk-kz/channels.js":[565213,686952],"./kk-kz/chat-list.js":[628976,686952],"./kk-kz/coach-report.js":[275398,935558],"./kk-kz/comment-stream.js":[148777,597613],"./kk-kz/communities.js":[538836,686952],"./kk-kz/compose.js":[871693,686952],"./kk-kz/contacts.js":[988296,686952],"./kk-kz/datepicker.js":[391659,967909],"./kk-kz/desktop.js":[725845,90983],"./kk-kz/digital-signage.js":[null],"./kk-kz/discover-surface.js":[291968,476832],"./kk-kz/edu.js":[307645,706927],"./kk-kz/embed.js":[234428,686952],"./kk-kz/errors.js":[709774,686952],"./kk-kz/esp.js":[608969,492495],"./kk-kz/extensibility-ptz-extension.js":[null],"./kk-kz/extensibility-room-remote.js":[null],"./kk-kz/extensibility.js":[516968,686952],"./kk-kz/feedback.js":[58426,685530],"./kk-kz/files.js":[749694,686952],"./kk-kz/framework.js":[404769,686952],"./kk-kz/freemium-upgrade.js":[null],"./kk-kz/funstuff.js":[572820,499968],"./kk-kz/gallery.js":[825091,307121],"./kk-kz/growth.js":[385194,686952],"./kk-kz/guardians.js":[102289,885019],"./kk-kz/health.js":[882839,405659],"./kk-kz/help.js":[871198,238644],"./kk-kz/hololens.js":[355845,63395],"./kk-kz/host-controls.js":[324630,248104],"./kk-kz/jana.js":[839053,326949],"./kk-kz/lightbox.js":[454704,686952],"./kk-kz/links.js":[785776,686952],"./kk-kz/live-persona-card.js":[672077,686952],"./kk-kz/live-persona-editor.js":[376598,51732],"./kk-kz/lms-integration.js":[null],"./kk-kz/meet-for-work.js":[634540,841238],"./kk-kz/meeting-analytics.js":[674817,847087],"./kk-kz/meeting-apis-app.js":[null],"./kk-kz/meeting-bot.js":[null],"./kk-kz/meeting-collaboration.js":[309992,482646],"./kk-kz/meeting-flyout.js":[800066,686952],"./kk-kz/meeting-meet-app.js":[189408,686952],"./kk-kz/meeting-options.js":[318055,255273],"./kk-kz/meeting-recap.js":[59410,20744],"./kk-kz/meeting-room-console.js":[null],"./kk-kz/meeting-stream-app.js":[null],"./kk-kz/messaging.js":[624997,686952],"./kk-kz/mobile-attach.js":[null],"./kk-kz/mtma-missed-notifications.js":[66003,686952],"./kk-kz/nearby.js":[903082,686952],"./kk-kz/nova.js":[560435,686952],"./kk-kz/people-app.js":[null],"./kk-kz/people-picker.js":[59865,686952],"./kk-kz/people-targeting.js":[808104,808868],"./kk-kz/people.js":[34482,686952],"./kk-kz/person.js":[750204,686952],"./kk-kz/phonelink-sms.js":[879093,360407],"./kk-kz/pre-core.js":[null],"./kk-kz/premium-benefits.js":[262609,814093],"./kk-kz/presence.js":[393964,686952],"./kk-kz/queues.js":[74141,347213],"./kk-kz/recurrence.js":[865647,822059],"./kk-kz/rsc-application-permissions.js":[null],"./kk-kz/search.js":[481613,967909],"./kk-kz/semantic-object.js":[334597,842695],"./kk-kz/settings.js":[800484,686952],"./kk-kz/share-in-meetings.js":[null],"./kk-kz/share-to-teams-outlook-addin.js":[null],"./kk-kz/share-to-teams-third-party.js":[null],"./kk-kz/share-to-teams.js":[175305,641073],"./kk-kz/shortcut.js":[838283,686952],"./kk-kz/shortcuts.js":[875838,686952],"./kk-kz/simple-collab.js":[333665,686952],"./kk-kz/smart-device.js":[null],"./kk-kz/survey.js":[248683,542355],"./kk-kz/sv-flyout.js":[646090,686952],"./kk-kz/teams-and-channels.js":[647740,226396],"./kk-kz/teams-insider.js":[689748,686952],"./kk-kz/telemetry.js":[391994,686952],"./kk-kz/tfl-homepage.js":[975444,686952],"./kk-kz/tfl-onboarding.js":[776321,686952],"./kk-kz/toast-notifications.js":[516363,686952],"./kk-kz/trusted-ui.js":[null],"./kk-kz/unified-search.js":[923588,641073],"./kk-kz/unsupported-browser.js":[null],"./kk-kz/url-preview.js":[625025,686952],"./kk-kz/video-capture.js":[325689,392095],"./kk-kz/video-message.js":[130104,834386],"./kk-kz/virtual-consumer-events.js":[11413,530573],"./kk-kz/virtual-events.js":[271102,529849],"./kk-kz/webinar.js":[309203,30973],"./kk-kz/welcome-bot.js":[null],"./kk-kz/whats-new.js":[106693,686952],"./kk-kz/wiki.js":[null],"./ko-kr/activity.js":[867520,415516],"./ko-kr/artifacts-platform.js":[905608,598284],"./ko-kr/audience-view-dialog.js":[44422,72390],"./ko-kr/auth.js":[523227,415516],"./ko-kr/autosuggest.js":[906322,415516],"./ko-kr/avatar.js":[791708,415516],"./ko-kr/biometric-enrollment.js":[212736,284940],"./ko-kr/breakout-rooms.js":[575693,410853],"./ko-kr/broadcast-scheduling.js":[687037,316005],"./ko-kr/broadcast.js":[881274,642984],"./ko-kr/calendar.js":[855295,415615],"./ko-kr/calling.js":[824561,512935],"./ko-kr/campaign-notifications.js":[384958,415516],"./ko-kr/carousel-multi-card.js":[null],"./ko-kr/cast.js":[250590,415516],"./ko-kr/channels.js":[641113,415516],"./ko-kr/chat-list.js":[958308,415516],"./ko-kr/coach-report.js":[890730,872642],"./ko-kr/comment-stream.js":[40069,138033],"./ko-kr/communities.js":[516256,415516],"./ko-kr/compose.js":[544577,415516],"./ko-kr/contacts.js":[969284,415516],"./ko-kr/datepicker.js":[670167,715321],"./ko-kr/desktop.js":[94521,721523],"./ko-kr/digital-signage.js":[null],"./ko-kr/discover-surface.js":[30108,599524],"./ko-kr/edu.js":[147481,547083],"./ko-kr/embed.js":[886848,415516],"./ko-kr/errors.js":[968890,415516],"./ko-kr/esp.js":[558373,358827],"./ko-kr/extensibility-ptz-extension.js":[null],"./ko-kr/extensibility-room-remote.js":[null],"./ko-kr/extensibility.js":[464780,415516],"./ko-kr/feedback.js":[811094,864542],"./ko-kr/files.js":[971866,415516],"./ko-kr/framework.js":[948269,415516],"./ko-kr/freemium-upgrade.js":[null],"./ko-kr/funstuff.js":[343128,323204],"./ko-kr/gallery.js":[326535,371565],"./ko-kr/growth.js":[138454,415516],"./ko-kr/guardians.js":[796181,338863],"./ko-kr/health.js":[305435,766447],"./ko-kr/help.js":[217210,37664],"./ko-kr/hololens.js":[289457,512935],"./ko-kr/host-controls.js":[634298,976668],"./ko-kr/jana.js":[204385,558009],"./ko-kr/lightbox.js":[370796,415516],"./ko-kr/links.js":[772,415516],"./ko-kr/live-persona-card.js":[659257,415516],"./ko-kr/live-persona-editor.js":[850042,957184],"./ko-kr/lms-integration.js":[null],"./ko-kr/meet-for-work.js":[967040,343890],"./ko-kr/meeting-analytics.js":[137861,687243],"./ko-kr/meeting-apis-app.js":[null],"./ko-kr/meeting-bot.js":[null],"./ko-kr/meeting-collaboration.js":[96812,562002],"./ko-kr/meeting-flyout.js":[780638,415516],"./ko-kr/meeting-meet-app.js":[490972,415516],"./ko-kr/meeting-options.js":[590563,618453],"./ko-kr/meeting-recap.js":[555814,854268],"./ko-kr/meeting-room-console.js":[null],"./ko-kr/meeting-stream-app.js":[null],"./ko-kr/messaging.js":[492209,415516],"./ko-kr/mobile-attach.js":[null],"./ko-kr/mtma-missed-notifications.js":[870303,415516],"./ko-kr/nearby.js":[349782,415516],"./ko-kr/nova.js":[781255,415516],"./ko-kr/people-app.js":[null],"./ko-kr/people-picker.js":[874829,415516],"./ko-kr/people-targeting.js":[723948,750352],"./ko-kr/people.js":[652046,415516],"./ko-kr/person.js":[97792,415516],"./ko-kr/phonelink-sms.js":[100689,590691],"./ko-kr/pre-core.js":[null],"./ko-kr/premium-benefits.js":[235837,96529],"./ko-kr/presence.js":[747416,415516],"./ko-kr/queues.js":[148569,595473],"./ko-kr/recurrence.js":[132611,359295],"./ko-kr/rsc-application-permissions.js":[null],"./ko-kr/search.js":[194769,715321],"./ko-kr/semantic-object.js":[47225,998355],"./ko-kr/settings.js":[265016,415516],"./ko-kr/share-in-meetings.js":[null],"./ko-kr/share-to-teams-outlook-addin.js":[null],"./ko-kr/share-to-teams-third-party.js":[null],"./ko-kr/share-to-teams.js":[379253,739693],"./ko-kr/shortcut.js":[970631,415516],"./ko-kr/shortcuts.js":[656082,415516],"./ko-kr/simple-collab.js":[789469,415516],"./ko-kr/smart-device.js":[null],"./ko-kr/survey.js":[640431,586007],"./ko-kr/sv-flyout.js":[41334,415516],"./ko-kr/teams-and-channels.js":[597344,336184],"./ko-kr/teams-insider.js":[20515,415516],"./ko-kr/telemetry.js":[219414,415516],"./ko-kr/tfl-homepage.js":[684920,415516],"./ko-kr/tfl-onboarding.js":[946077,415516],"./ko-kr/toast-notifications.js":[19655,415516],"./ko-kr/trusted-ui.js":[null],"./ko-kr/unified-search.js":[772120,739693],"./ko-kr/unsupported-browser.js":[null],"./ko-kr/url-preview.js":[743149,415516],"./ko-kr/video-capture.js":[284349,860539],"./ko-kr/video-message.js":[165700,356614],"./ko-kr/virtual-consumer-events.js":[577033,329361],"./ko-kr/virtual-events.js":[702170,645669],"./ko-kr/webinar.js":[9743,69121],"./ko-kr/welcome-bot.js":[null],"./ko-kr/whats-new.js":[268761,415516],"./ko-kr/wiki.js":[null],"./lt-lt/activity.js":[627109,499190],"./lt-lt/artifacts-platform.js":[37917,733465],"./lt-lt/audience-view-dialog.js":[609231,370075],"./lt-lt/auth.js":[390222,499190],"./lt-lt/autosuggest.js":[116061,499190],"./lt-lt/avatar.js":[801837,499190],"./lt-lt/biometric-enrollment.js":[634825,420121],"./lt-lt/breakout-rooms.js":[259744,835464],"./lt-lt/broadcast-scheduling.js":[459876,224264],"./lt-lt/broadcast.js":[4197,509901],"./lt-lt/calendar.js":[554442,25826],"./lt-lt/calling.js":[915454,844122],"./lt-lt/campaign-notifications.js":[950883,499190],"./lt-lt/carousel-multi-card.js":[null],"./lt-lt/cast.js":[275435,499190],"./lt-lt/channels.js":[329008,499190],"./lt-lt/chat-list.js":[742607,499190],"./lt-lt/coach-report.js":[594331,845935],"./lt-lt/comment-stream.js":[970520,384540],"./lt-lt/communities.js":[362847,499190],"./lt-lt/compose.js":[164006,499190],"./lt-lt/contacts.js":[934773,499190],"./lt-lt/datepicker.js":[727214,470068],"./lt-lt/desktop.js":[34386,935022],"./lt-lt/digital-signage.js":[null],"./lt-lt/discover-surface.js":[475685,996545],"./lt-lt/edu.js":[298182,61110],"./lt-lt/embed.js":[539747,499190],"./lt-lt/errors.js":[221335,499190],"./lt-lt/esp.js":[207634,330326],"./lt-lt/extensibility-ptz-extension.js":[null],"./lt-lt/extensibility-room-remote.js":[null],"./lt-lt/extensibility.js":[799135,499190],"./lt-lt/feedback.js":[445159,716867],"./lt-lt/files.js":[641581,499190],"./lt-lt/framework.js":[837766,499190],"./lt-lt/freemium-upgrade.js":[null],"./lt-lt/funstuff.js":[20621,694049],"./lt-lt/gallery.js":[396916,66016],"./lt-lt/growth.js":[272555,499190],"./lt-lt/guardians.js":[120826,466546],"./lt-lt/health.js":[852686,444658],"./lt-lt/help.js":[76879,10581],"./lt-lt/hololens.js":[625324,844122],"./lt-lt/host-controls.js":[762317,837961],"./lt-lt/jana.js":[34928,312756],"./lt-lt/lightbox.js":[411261,499190],"./lt-lt/links.js":[792555,499190],"./lt-lt/live-persona-card.js":[315242,499190],"./lt-lt/live-persona-editor.js":[824005,855349],"./lt-lt/lms-integration.js":[null],"./lt-lt/meet-for-work.js":[921875,463007],"./lt-lt/meeting-analytics.js":[120234,201270],"./lt-lt/meeting-apis-app.js":[null],"./lt-lt/meeting-bot.js":[null],"./lt-lt/meeting-collaboration.js":[778283,573663],"./lt-lt/meeting-flyout.js":[566083,499190],"./lt-lt/meeting-meet-app.js":[799921,499190],"./lt-lt/meeting-options.js":[601500,96152],"./lt-lt/meeting-recap.js":[942405,584425],"./lt-lt/meeting-room-console.js":[null],"./lt-lt/meeting-stream-app.js":[null],"./lt-lt/messaging.js":[563806,499190],"./lt-lt/mobile-attach.js":[null],"./lt-lt/mtma-missed-notifications.js":[988720,499190],"./lt-lt/nearby.js":[432523,499190],"./lt-lt/nova.js":[574930,499190],"./lt-lt/people-app.js":[null],"./lt-lt/people-picker.js":[887886,499190],"./lt-lt/people-targeting.js":[344721,450661],"./lt-lt/people.js":[282839,499190],"./lt-lt/person.js":[324001,499190],"./lt-lt/phonelink-sms.js":[772534,695742],"./lt-lt/pre-core.js":[null],"./lt-lt/premium-benefits.js":[76768,308860],"./lt-lt/presence.js":[737429,499190],"./lt-lt/queues.js":[384568,734524],"./lt-lt/recurrence.js":[517166,935330],"./lt-lt/rsc-application-permissions.js":[null],"./lt-lt/search.js":[368744,470068],"./lt-lt/semantic-object.js":[4242,686734],"./lt-lt/settings.js":[592721,499190],"./lt-lt/share-in-meetings.js":[null],"./lt-lt/share-to-teams-outlook-addin.js":[null],"./lt-lt/share-to-teams-third-party.js":[null],"./lt-lt/share-to-teams.js":[848616,871840],"./lt-lt/shortcut.js":[933098,499190],"./lt-lt/shortcuts.js":[903417,499190],"./lt-lt/simple-collab.js":[949998,499190],"./lt-lt/smart-device.js":[null],"./lt-lt/survey.js":[931138,581290],"./lt-lt/sv-flyout.js":[380441,499190],"./lt-lt/teams-and-channels.js":[212197,636605],"./lt-lt/teams-insider.js":[193539,499190],"./lt-lt/telemetry.js":[647281,499190],"./lt-lt/tfl-homepage.js":[729717,499190],"./lt-lt/tfl-onboarding.js":[141960,499190],"./lt-lt/toast-notifications.js":[422172,499190],"./lt-lt/trusted-ui.js":[null],"./lt-lt/unified-search.js":[682889,871840],"./lt-lt/unsupported-browser.js":[null],"./lt-lt/url-preview.js":[368878,499190],"./lt-lt/video-capture.js":[886206,749766],"./lt-lt/video-message.js":[309439,654299],"./lt-lt/virtual-consumer-events.js":[496306,25340],"./lt-lt/virtual-events.js":[458087,70280],"./lt-lt/webinar.js":[208784,549708],"./lt-lt/welcome-bot.js":[null],"./lt-lt/whats-new.js":[245326,499190],"./lt-lt/wiki.js":[null],"./lv-lv/activity.js":[233685,84885],"./lv-lv/artifacts-platform.js":[896237,541541],"./lv-lv/audience-view-dialog.js":[608415,8127],"./lv-lv/auth.js":[638654,84885],"./lv-lv/autosuggest.js":[255469,84885],"./lv-lv/avatar.js":[261757,84885],"./lv-lv/biometric-enrollment.js":[185209,711845],"./lv-lv/breakout-rooms.js":[512560,535160],"./lv-lv/broadcast-scheduling.js":[785268,923960],"./lv-lv/broadcast.js":[977877,39625],"./lv-lv/calendar.js":[835098,424306],"./lv-lv/calling.js":[283790,544682],"./lv-lv/campaign-notifications.js":[482579,84885],"./lv-lv/carousel-multi-card.js":[null],"./lv-lv/cast.js":[930523,84885],"./lv-lv/channels.js":[431936,84885],"./lv-lv/chat-list.js":[733759,84885],"./lv-lv/coach-report.js":[636875,862275],"./lv-lv/comment-stream.js":[760456,632396],"./lv-lv/communities.js":[185167,84885],"./lv-lv/compose.js":[672630,84885],"./lv-lv/contacts.js":[931845,84885],"./lv-lv/datepicker.js":[994558,414596],"./lv-lv/desktop.js":[777858,35838],"./lv-lv/digital-signage.js":[null],"./lv-lv/discover-surface.js":[797909,935405],"./lv-lv/edu.js":[669686,64998],"./lv-lv/embed.js":[634739,84885],"./lv-lv/errors.js":[383367,84885],"./lv-lv/esp.js":[587618,127814],"./lv-lv/extensibility-ptz-extension.js":[null],"./lv-lv/extensibility-room-remote.js":[null],"./lv-lv/extensibility.js":[381199,84885],"./lv-lv/feedback.js":[74135,343687],"./lv-lv/files.js":[35165,84885],"./lv-lv/framework.js":[581110,84885],"./lv-lv/freemium-upgrade.js":[null],"./lv-lv/funstuff.js":[344317,158029],"./lv-lv/gallery.js":[968772,90832],"./lv-lv/growth.js":[217339,84885],"./lv-lv/guardians.js":[866922,789890],"./lv-lv/health.js":[723806,733826],"./lv-lv/help.js":[726047,372529],"./lv-lv/hololens.js":[856380,544682],"./lv-lv/host-controls.js":[202237,646037],"./lv-lv/jana.js":[279328,257284],"./lv-lv/lightbox.js":[744749,84885],"./lv-lv/links.js":[799771,84885],"./lv-lv/live-persona-card.js":[160858,84885],"./lv-lv/live-persona-editor.js":[135701,628689],"./lv-lv/lms-integration.js":[null],"./lv-lv/meet-for-work.js":[799971,999027],"./lv-lv/meeting-analytics.js":[607418,688806],"./lv-lv/meeting-apis-app.js":[null],"./lv-lv/meeting-bot.js":[null],"./lv-lv/meeting-collaboration.js":[855963,686387],"./lv-lv/meeting-flyout.js":[328051,84885],"./lv-lv/meeting-meet-app.js":[539873,84885],"./lv-lv/meeting-options.js":[444140,395592],"./lv-lv/meeting-recap.js":[542773,557813],"./lv-lv/meeting-room-console.js":[null],"./lv-lv/meeting-stream-app.js":[null],"./lv-lv/messaging.js":[173614,84885],"./lv-lv/mobile-attach.js":[null],"./lv-lv/mtma-missed-notifications.js":[794688,84885],"./lv-lv/nearby.js":[579195,84885],"./lv-lv/nova.js":[989282,84885],"./lv-lv/people-app.js":[null],"./lv-lv/people-picker.js":[957342,84885],"./lv-lv/people-targeting.js":[261665,812609],"./lv-lv/people.js":[20487,84885],"./lv-lv/person.js":[649073,84885],"./lv-lv/phonelink-sms.js":[634854,447886],"./lv-lv/pre-core.js":[null],"./lv-lv/premium-benefits.js":[21699,608300],"./lv-lv/presence.js":[743973,84885],"./lv-lv/queues.js":[666984,33964],"./lv-lv/recurrence.js":[490462,910514],"./lv-lv/rsc-application-permissions.js":[null],"./lv-lv/search.js":[662296,414596],"./lv-lv/semantic-object.js":[738434,987038],"./lv-lv/settings.js":[663489,84885],"./lv-lv/share-in-meetings.js":[null],"./lv-lv/share-to-teams-outlook-addin.js":[null],"./lv-lv/share-to-teams-third-party.js":[null],"./lv-lv/share-to-teams.js":[226424,989712],"./lv-lv/shortcut.js":[315578,84885],"./lv-lv/shortcuts.js":[985353,84885],"./lv-lv/simple-collab.js":[744190,84885],"./lv-lv/smart-device.js":[null],"./lv-lv/survey.js":[37586,682106],"./lv-lv/sv-flyout.js":[259273,84885],"./lv-lv/teams-and-channels.js":[947701,949433],"./lv-lv/teams-insider.js":[226707,84885],"./lv-lv/telemetry.js":[725377,84885],"./lv-lv/tfl-homepage.js":[354853,84885],"./lv-lv/tfl-onboarding.js":[756792,84885],"./lv-lv/toast-notifications.js":[392044,84885],"./lv-lv/trusted-ui.js":[null],"./lv-lv/unified-search.js":[27161,989712],"./lv-lv/unsupported-browser.js":[null],"./lv-lv/url-preview.js":[134334,84885],"./lv-lv/video-capture.js":[399726,4726],"./lv-lv/video-message.js":[274031,292351],"./lv-lv/virtual-consumer-events.js":[733570,324780],"./lv-lv/virtual-events.js":[689655,253624],"./lv-lv/webinar.js":[405024,249404],"./lv-lv/welcome-bot.js":[null],"./lv-lv/whats-new.js":[352542,84885],"./lv-lv/wiki.js":[null],"./mk-mk/activity.js":[363157,454045],"./mk-mk/artifacts-platform.js":[305645,994797],"./mk-mk/audience-view-dialog.js":[563551,707207],"./mk-mk/auth.js":[640894,454045],"./mk-mk/autosuggest.js":[482925,454045],"./mk-mk/avatar.js":[708285,454045],"./mk-mk/biometric-enrollment.js":[503737,165101],"./mk-mk/breakout-rooms.js":[251312,344496],"./mk-mk/broadcast-scheduling.js":[317172,733296],"./mk-mk/broadcast.js":[818901,414129],"./mk-mk/calendar.js":[216730,701410],"./mk-mk/calling.js":[875214,398650],"./mk-mk/campaign-notifications.js":[12627,454045],"./mk-mk/carousel-multi-card.js":[null],"./mk-mk/cast.js":[172507,454045],"./mk-mk/channels.js":[130368,454045],"./mk-mk/chat-list.js":[184255,454045],"./mk-mk/coach-report.js":[536267,644059],"./mk-mk/comment-stream.js":[234824,435492],"./mk-mk/communities.js":[182479,454045],"./mk-mk/compose.js":[828022,454045],"./mk-mk/contacts.js":[928517,454045],"./mk-mk/datepicker.js":[167486,355612],"./mk-mk/desktop.js":[260482,461246],"./mk-mk/digital-signage.js":[null],"./mk-mk/discover-surface.js":[70677,705045],"./mk-mk/edu.js":[448886,385670],"./mk-mk/embed.js":[92147,454045],"./mk-mk/errors.js":[694471,454045],"./mk-mk/esp.js":[400994,336550],"./mk-mk/extensibility-ptz-extension.js":[null],"./mk-mk/extensibility-room-remote.js":[null],"./mk-mk/extensibility.js":[798543,454045],"./mk-mk/feedback.js":[819031,847215],"./mk-mk/files.js":[926301,454045],"./mk-mk/framework.js":[655286,454045],"./mk-mk/freemium-upgrade.js":[null],"./mk-mk/funstuff.js":[426173,211829],"./mk-mk/gallery.js":[509060,740520],"./mk-mk/growth.js":[211067,454045],"./mk-mk/guardians.js":[941290,102386],"./mk-mk/health.js":[296030,564146],"./mk-mk/help.js":[151583,558649],"./mk-mk/hololens.js":[22204,398650],"./mk-mk/host-controls.js":[977661,15197],"./mk-mk/jana.js":[654944,198300],"./mk-mk/lightbox.js":[167597,454045],"./mk-mk/links.js":[73627,454045],"./mk-mk/live-persona-card.js":[787610,454045],"./mk-mk/live-persona-editor.js":[134805,892569],"./mk-mk/lms-integration.js":[null],"./mk-mk/meet-for-work.js":[978979,375499],"./mk-mk/meeting-analytics.js":[254394,525830],"./mk-mk/meeting-apis-app.js":[null],"./mk-mk/meeting-bot.js":[null],"./mk-mk/meeting-collaboration.js":[49499,62859],"./mk-mk/meeting-flyout.js":[426355,454045],"./mk-mk/meeting-meet-app.js":[27937,454045],"./mk-mk/meeting-options.js":[452012,965696],"./mk-mk/meeting-recap.js":[753781,250941],"./mk-mk/meeting-room-console.js":[null],"./mk-mk/meeting-stream-app.js":[null],"./mk-mk/messaging.js":[318766,454045],"./mk-mk/mobile-attach.js":[null],"./mk-mk/mtma-missed-notifications.js":[13696,454045],"./mk-mk/nearby.js":[572923,454045],"./mk-mk/nova.js":[318242,454045],"./mk-mk/people-app.js":[null],"./mk-mk/people-picker.js":[212574,454045],"./mk-mk/people-targeting.js":[856993,812233],"./mk-mk/people.js":[626439,454045],"./mk-mk/person.js":[521393,454045],"./mk-mk/phonelink-sms.js":[675750,469966],"./mk-mk/pre-core.js":[null],"./mk-mk/premium-benefits.js":[311216,883268],"./mk-mk/presence.js":[153573,454045],"./mk-mk/queues.js":[272936,944516],"./mk-mk/recurrence.js":[734558,599138],"./mk-mk/rsc-application-permissions.js":[null],"./mk-mk/search.js":[239768,355612],"./mk-mk/semantic-object.js":[12226,954974],"./mk-mk/settings.js":[555585,454045],"./mk-mk/share-in-meetings.js":[null],"./mk-mk/share-to-teams-outlook-addin.js":[null],"./mk-mk/share-to-teams-third-party.js":[null],"./mk-mk/share-to-teams.js":[801464,134824],"./mk-mk/shortcut.js":[925562,454045],"./mk-mk/shortcuts.js":[314057,454045],"./mk-mk/simple-collab.js":[620350,454045],"./mk-mk/smart-device.js":[null],"./mk-mk/survey.js":[645714,929354],"./mk-mk/sv-flyout.js":[87561,454045],"./mk-mk/teams-and-channels.js":[969461,527137],"./mk-mk/teams-insider.js":[314451,454045],"./mk-mk/telemetry.js":[705857,454045],"./mk-mk/tfl-homepage.js":[373733,454045],"./mk-mk/tfl-onboarding.js":[25912,454045],"./mk-mk/toast-notifications.js":[269164,454045],"./mk-mk/trusted-ui.js":[null],"./mk-mk/unified-search.js":[827609,134824],"./mk-mk/unsupported-browser.js":[null],"./mk-mk/url-preview.js":[71038,454045],"./mk-mk/video-capture.js":[756654,227350],"./mk-mk/video-message.js":[299759,991431],"./mk-mk/virtual-consumer-events.js":[403778,116100],"./mk-mk/virtual-events.js":[299127,579312],"./mk-mk/webinar.js":[894688,195284],"./mk-mk/welcome-bot.js":[null],"./mk-mk/whats-new.js":[433310,454045],"./mk-mk/wiki.js":[null],"./nb-no/activity.js":[665732,123312],"./nb-no/artifacts-platform.js":[359772,596800],"./nb-no/audience-view-dialog.js":[989506,773170],"./nb-no/auth.js":[702599,123312],"./nb-no/autosuggest.js":[301574,123312],"./nb-no/avatar.js":[506136,123312],"./nb-no/biometric-enrollment.js":[312332,283456],"./nb-no/breakout-rooms.js":[50473,262425],"./nb-no/broadcast-scheduling.js":[391097,167577],"./nb-no/broadcast.js":[976918,529372],"./nb-no/calendar.js":[449595,540859],"./nb-no/calling.js":[275093,569859],"./nb-no/campaign-notifications.js":[923362,123312],"./nb-no/carousel-multi-card.js":[null],"./nb-no/cast.js":[249970,123312],"./nb-no/channels.js":[959749,123312],"./nb-no/chat-list.js":[420424,123312],"./nb-no/coach-report.js":[256366,79934],"./nb-no/comment-stream.js":[123217,481301],"./nb-no/communities.js":[322956,123312],"./nb-no/compose.js":[767829,123312],"./nb-no/contacts.js":[191280,123312],"./nb-no/datepicker.js":[134803,114813],"./nb-no/desktop.js":[50861,113311],"./nb-no/digital-signage.js":[null],"./nb-no/discover-surface.js":[997240,481176],"./nb-no/edu.js":[996053,511767],"./nb-no/embed.js":[819524,123312],"./nb-no/errors.js":[354694,123312],"./nb-no/esp.js":[256705,357687],"./nb-no/extensibility-ptz-extension.js":[null],"./nb-no/extensibility-room-remote.js":[null],"./nb-no/extensibility.js":[54832,123312],"./nb-no/feedback.js":[217426,393482],"./nb-no/files.js":[68694,123312],"./nb-no/framework.js":[290185,123312],"./nb-no/freemium-upgrade.js":[null],"./nb-no/funstuff.js":[234028,647928],"./nb-no/gallery.js":[175819,270881],"./nb-no/growth.js":[940690,123312],"./nb-no/guardians.js":[445801,46987],"./nb-no/health.js":[836911,36875],"./nb-no/help.js":[684326,723316],"./nb-no/hololens.js":[279405,569859],"./nb-no/host-controls.js":[425886,168112],"./nb-no/jana.js":[34837,957501],"./nb-no/lightbox.js":[778888,123312],"./nb-no/links.js":[563112,123312],"./nb-no/live-persona-card.js":[978885,123312],"./nb-no/live-persona-editor.js":[148974,185364],"./nb-no/lms-integration.js":[null],"./nb-no/meet-for-work.js":[924996,353902],"./nb-no/meeting-analytics.js":[522937,135575],"./nb-no/meeting-apis-app.js":[null],"./nb-no/meeting-bot.js":[null],"./nb-no/meeting-collaboration.js":[527248,29486],"./nb-no/meeting-flyout.js":[886522,123312],"./nb-no/meeting-meet-app.js":[34856,123312],"./nb-no/meeting-options.js":[108703,813993],"./nb-no/meeting-recap.js":[240618,946384],"./nb-no/meeting-room-console.js":[null],"./nb-no/meeting-stream-app.js":[null],"./nb-no/messaging.js":[470957,123312],"./nb-no/mobile-attach.js":[null],"./nb-no/mtma-missed-notifications.js":[78536,123312],"./nb-no/nearby.js":[642930,123312],"./nb-no/nova.js":[676251,123312],"./nb-no/people-app.js":[null],"./nb-no/people-picker.js":[876225,123312],"./nb-no/people-targeting.js":[926784,423364],"./nb-no/people.js":[279642,123312],"./nb-no/person.js":[398212,123312],"./nb-no/phonelink-sms.js":[723773,788143],"./nb-no/pre-core.js":[null],"./nb-no/premium-benefits.js":[943481,863093],"./nb-no/presence.js":[18372,123312],"./nb-no/queues.js":[812645,819509],"./nb-no/recurrence.js":[411047,438587],"./nb-no/rsc-application-permissions.js":[null],"./nb-no/search.js":[245125,114813],"./nb-no/semantic-object.js":[662109,441727],"./nb-no/settings.js":[3180,123312],"./nb-no/share-in-meetings.js":[null],"./nb-no/share-to-teams-outlook-addin.js":[null],"./nb-no/share-to-teams-third-party.js":[null],"./nb-no/share-to-teams.js":[941025,653409],"./nb-no/shortcut.js":[646515,123312],"./nb-no/shortcuts.js":[584982,123312],"./nb-no/simple-collab.js":[822857,123312],"./nb-no/smart-device.js":[null],"./nb-no/survey.js":[826723,443091],"./nb-no/sv-flyout.js":[208802,123312],"./nb-no/teams-and-channels.js":[227396,927564],"./nb-no/teams-insider.js":[41756,123312],"./nb-no/telemetry.js":[812258,123312],"./nb-no/tfl-homepage.js":[586860,123312],"./nb-no/tfl-onboarding.js":[500985,123312],"./nb-no/toast-notifications.js":[954419,123312],"./nb-no/trusted-ui.js":[null],"./nb-no/unified-search.js":[186236,653409],"./nb-no/unsupported-browser.js":[null],"./nb-no/url-preview.js":[398409,123312],"./nb-no/video-capture.js":[862177,203687],"./nb-no/video-message.js":[158960,57394],"./nb-no/virtual-consumer-events.js":[91213,95925],"./nb-no/virtual-events.js":[477862,497241],"./nb-no/webinar.js":[966187,632581],"./nb-no/welcome-bot.js":[null],"./nb-no/whats-new.js":[720109,123312],"./nb-no/wiki.js":[null],"./nl-nl/activity.js":[678177,246313],"./nl-nl/artifacts-platform.js":[172697,257785],"./nl-nl/audience-view-dialog.js":[601395,327371],"./nl-nl/auth.js":[198466,246313],"./nl-nl/autosuggest.js":[845593,246313],"./nl-nl/avatar.js":[196673,246313],"./nl-nl/biometric-enrollment.js":[108813,428089],"./nl-nl/breakout-rooms.js":[127172,25108],"./nl-nl/broadcast-scheduling.js":[648568,930260],"./nl-nl/broadcast.js":[224073,763229],"./nl-nl/calendar.js":[422542,736246],"./nl-nl/calling.js":[935018,210254],"./nl-nl/campaign-notifications.js":[126863,246313],"./nl-nl/carousel-multi-card.js":[null],"./nl-nl/cast.js":[56727,246313],"./nl-nl/channels.js":[339844,246313],"./nl-nl/chat-list.js":[30059,246313],"./nl-nl/coach-report.js":[561255,815103],"./nl-nl/comment-stream.js":[622060,335e3],"./nl-nl/communities.js":[816659,246313],"./nl-nl/compose.js":[237138,246313],"./nl-nl/contacts.js":[533577,246313],"./nl-nl/datepicker.js":[452754,316944],"./nl-nl/desktop.js":[306734,676466],"./nl-nl/digital-signage.js":[null],"./nl-nl/discover-surface.js":[331865,427393],"./nl-nl/edu.js":[897274,470394],"./nl-nl/embed.js":[803807,246313],"./nl-nl/errors.js":[975643,246313],"./nl-nl/esp.js":[186646,367898],"./nl-nl/extensibility-ptz-extension.js":[null],"./nl-nl/extensibility-room-remote.js":[null],"./nl-nl/extensibility.js":[174667,246313],"./nl-nl/feedback.js":[904379,299539],"./nl-nl/files.js":[446737,246313],"./nl-nl/framework.js":[528650,246313],"./nl-nl/freemium-upgrade.js":[null],"./nl-nl/funstuff.js":[963449,428833],"./nl-nl/gallery.js":[897984,868332],"./nl-nl/growth.js":[808431,246313],"./nl-nl/guardians.js":[205478,819078],"./nl-nl/health.js":[580986,232262],"./nl-nl/help.js":[792707,197349],"./nl-nl/hololens.js":[279584,210254],"./nl-nl/host-controls.js":[99257,807465],"./nl-nl/jana.js":[869996,159632],"./nl-nl/lightbox.js":[871281,246313],"./nl-nl/links.js":[481255,246313],"./nl-nl/live-persona-card.js":[472286,246313],"./nl-nl/live-persona-editor.js":[481953,599045],"./nl-nl/lms-integration.js":[null],"./nl-nl/meet-for-work.js":[607919,673263],"./nl-nl/meeting-analytics.js":[636854,94202],"./nl-nl/meeting-apis-app.js":[null],"./nl-nl/meeting-bot.js":[null],"./nl-nl/meeting-collaboration.js":[765223,348847],"./nl-nl/meeting-flyout.js":[584983,246313],"./nl-nl/meeting-meet-app.js":[370885,246313],"./nl-nl/meeting-options.js":[661520,999972],"./nl-nl/meeting-recap.js":[172545,69385],"./nl-nl/meeting-room-console.js":[null],"./nl-nl/meeting-stream-app.js":[null],"./nl-nl/messaging.js":[799714,246313],"./nl-nl/mobile-attach.js":[null],"./nl-nl/mtma-missed-notifications.js":[108676,246313],"./nl-nl/nearby.js":[852815,246313],"./nl-nl/nova.js":[108814,246313],"./nl-nl/people-app.js":[null],"./nl-nl/people-picker.js":[425226,246313],"./nl-nl/people-targeting.js":[727165,24117],"./nl-nl/people.js":[771771,246313],"./nl-nl/person.js":[988477,246313],"./nl-nl/phonelink-sms.js":[855322,351298],"./nl-nl/pre-core.js":[null],"./nl-nl/premium-benefits.js":[645636,86712],"./nl-nl/presence.js":[650153,246313],"./nl-nl/queues.js":[149612,43128],"./nl-nl/recurrence.js":[286506,210678],"./nl-nl/rsc-application-permissions.js":[null],"./nl-nl/search.js":[410964,316944],"./nl-nl/semantic-object.js":[716814,462354],"./nl-nl/settings.js":[697677,246313],"./nl-nl/share-in-meetings.js":[null],"./nl-nl/share-to-teams-outlook-addin.js":[null],"./nl-nl/share-to-teams-third-party.js":[null],"./nl-nl/share-to-teams.js":[124108,250860],"./nl-nl/shortcut.js":[468894,246313],"./nl-nl/shortcuts.js":[361077,246313],"./nl-nl/simple-collab.js":[355378,246313],"./nl-nl/smart-device.js":[null],"./nl-nl/survey.js":[812766,312350],"./nl-nl/sv-flyout.js":[403325,246313],"./nl-nl/teams-and-channels.js":[269121,154125],"./nl-nl/teams-insider.js":[237191,246313],"./nl-nl/telemetry.js":[308293,246313],"./nl-nl/tfl-homepage.js":[37441,246313],"./nl-nl/tfl-onboarding.js":[612556,246313],"./nl-nl/toast-notifications.js":[823696,246313],"./nl-nl/trusted-ui.js":[null],"./nl-nl/unified-search.js":[686565,250860],"./nl-nl/unsupported-browser.js":[null],"./nl-nl/url-preview.js":[660866,246313],"./nl-nl/video-capture.js":[273962,835978],"./nl-nl/video-message.js":[803123,611595],"./nl-nl/virtual-consumer-events.js":[76942,319544],"./nl-nl/virtual-events.js":[649403,259924],"./nl-nl/webinar.js":[14100,250376],"./nl-nl/welcome-bot.js":[null],"./nl-nl/whats-new.js":[656442,246313],"./nl-nl/wiki.js":[null],"./nn-no/activity.js":[940608,721396],"./nn-no/artifacts-platform.js":[82888,127044],"./nn-no/audience-view-dialog.js":[781318,722286],"./nn-no/auth.js":[715995,721396],"./nn-no/autosuggest.js":[210386,721396],"./nn-no/avatar.js":[988508,721396],"./nn-no/biometric-enrollment.js":[949632,297348],"./nn-no/breakout-rooms.js":[838925,378821],"./nn-no/broadcast-scheduling.js":[423933,767621],"./nn-no/broadcast.js":[177274,95560],"./nn-no/calendar.js":[412031,506231],"./nn-no/calling.js":[943793,537999],"./nn-no/campaign-notifications.js":[946942,721396],"./nn-no/carousel-multi-card.js":[null],"./nn-no/cast.js":[443358,721396],"./nn-no/channels.js":[714201,721396],"./nn-no/chat-list.js":[737956,721396],"./nn-no/coach-report.js":[943018,720386],"./nn-no/comment-stream.js":[819653,395241],"./nn-no/communities.js":[820320,721396],"./nn-no/compose.js":[663809,721396],"./nn-no/contacts.js":[526020,721396],"./nn-no/datepicker.js":[334935,633985],"./nn-no/desktop.js":[730105,893267],"./nn-no/digital-signage.js":[null],"./nn-no/discover-surface.js":[281180,896492],"./nn-no/edu.js":[820121,813147],"./nn-no/embed.js":[493120,721396],"./nn-no/errors.js":[165690,721396],"./nn-no/esp.js":[231013,815611],"./nn-no/extensibility-ptz-extension.js":[null],"./nn-no/extensibility-room-remote.js":[null],"./nn-no/extensibility.js":[137484,721396],"./nn-no/feedback.js":[884182,403350],"./nn-no/files.js":[578138,721396],"./nn-no/framework.js":[727917,721396],"./nn-no/freemium-upgrade.js":[null],"./nn-no/funstuff.js":[416216,528012],"./nn-no/gallery.js":[962119,806557],"./nn-no/growth.js":[818902,721396],"./nn-no/guardians.js":[575829,390279],"./nn-no/health.js":[502235,803463],"./nn-no/help.js":[409978,125232],"./nn-no/hololens.js":[362545,537999],"./nn-no/host-controls.js":[307002,766196],"./nn-no/jana.js":[397153,476673],"./nn-no/lightbox.js":[927532,721396],"./nn-no/links.js":[607044,721396],"./nn-no/live-persona-card.js":[51321,721396],"./nn-no/live-persona-editor.js":[357434,896848],"./nn-no/lms-integration.js":[null],"./nn-no/meet-for-work.js":[639744,404786],"./nn-no/meeting-analytics.js":[529925,953307],"./nn-no/meeting-apis-app.js":[null],"./nn-no/meeting-bot.js":[null],"./nn-no/meeting-collaboration.js":[900524,80370],"./nn-no/meeting-flyout.js":[43870,721396],"./nn-no/meeting-meet-app.js":[742044,721396],"./nn-no/meeting-options.js":[647267,323349],"./nn-no/meeting-recap.js":[228518,751252],"./nn-no/meeting-room-console.js":[null],"./nn-no/meeting-stream-app.js":[null],"./nn-no/messaging.js":[788209,721396],"./nn-no/mobile-attach.js":[null],"./nn-no/mtma-missed-notifications.js":[709663,721396],"./nn-no/nearby.js":[546582,721396],"./nn-no/nova.js":[974023,721396],"./nn-no/people-app.js":[null],"./nn-no/people-picker.js":[547533,721396],"./nn-no/people-targeting.js":[491372,952e3],"./nn-no/people.js":[848846,721396],"./nn-no/person.js":[294592,721396],"./nn-no/phonelink-sms.js":[773393,924963],"./nn-no/pre-core.js":[null],"./nn-no/premium-benefits.js":[3261,663305],"./nn-no/presence.js":[820504,721396],"./nn-no/queues.js":[829017,680073],"./nn-no/recurrence.js":[281027,980663],"./nn-no/rsc-application-permissions.js":[null],"./nn-no/search.js":[875217,633985],"./nn-no/semantic-object.js":[103929,102451],"./nn-no/settings.js":[338104,721396],"./nn-no/share-in-meetings.js":[null],"./nn-no/share-to-teams-outlook-addin.js":[null],"./nn-no/share-to-teams-third-party.js":[null],"./nn-no/share-to-teams.js":[642485,705437],"./nn-no/shortcut.js":[43719,721396],"./nn-no/shortcuts.js":[435730,721396],"./nn-no/simple-collab.js":[462173,721396],"./nn-no/smart-device.js":[null],"./nn-no/survey.js":[837231,266015],"./nn-no/sv-flyout.js":[337334,721396],"./nn-no/teams-and-channels.js":[774624,47480],"./nn-no/teams-insider.js":[915600,721396],"./nn-no/telemetry.js":[515414,721396],"./nn-no/tfl-homepage.js":[737208,721396],"./nn-no/tfl-onboarding.js":[209309,721396],"./nn-no/toast-notifications.js":[10695,721396],"./nn-no/trusted-ui.js":[null],"./nn-no/unified-search.js":[35352,705437],"./nn-no/unsupported-browser.js":[null],"./nn-no/url-preview.js":[47213,721396],"./nn-no/video-capture.js":[957053,695083],"./nn-no/video-message.js":[838404,6510],"./nn-no/virtual-consumer-events.js":[290569,379785],"./nn-no/virtual-events.js":[965402,97285],"./nn-no/webinar.js":[645327,58713],"./nn-no/welcome-bot.js":[null],"./nn-no/whats-new.js":[564761,721396],"./nn-no/wiki.js":[null],"./pl-pl/activity.js":[96853,677553],"./pl-pl/artifacts-platform.js":[70765,944897],"./pl-pl/audience-view-dialog.js":[364639,304947],"./pl-pl/auth.js":[933886,677553],"./pl-pl/autosuggest.js":[240493,677553],"./pl-pl/avatar.js":[456253,677553],"./pl-pl/biometric-enrollment.js":[304825,631553],"./pl-pl/breakout-rooms.js":[607344,805408],"./pl-pl/broadcast-scheduling.js":[118260,194208],"./pl-pl/broadcast.js":[310933,526085],"./pl-pl/calendar.js":[950426,430754],"./pl-pl/calling.js":[72334,793978],"./pl-pl/campaign-notifications.js":[175955,677553],"./pl-pl/carousel-multi-card.js":[null],"./pl-pl/cast.js":[465499,677553],"./pl-pl/channels.js":[864064,677553],"./pl-pl/chat-list.js":[192639,677553],"./pl-pl/coach-report.js":[709067,666311],"./pl-pl/comment-stream.js":[884827,717316],"./pl-pl/communities.js":[940047,677553],"./pl-pl/compose.js":[25142,677553],"./pl-pl/contacts.js":[662213,677553],"./pl-pl/datepicker.js":[170814,536348],"./pl-pl/desktop.js":[457602,383806],"./pl-pl/digital-signage.js":[null],"./pl-pl/discover-surface.js":[796565,734953],"./pl-pl/edu.js":[413878,106150],"./pl-pl/embed.js":[887411,677553],"./pl-pl/errors.js":[442439,677553],"./pl-pl/esp.js":[365986,426950],"./pl-pl/extensibility-ptz-extension.js":[null],"./pl-pl/extensibility-room-remote.js":[null],"./pl-pl/extensibility.js":[660815,677553],"./pl-pl/feedback.js":[552727,356155],"./pl-pl/files.js":[237917,677553],"./pl-pl/framework.js":[663670,677553],"./pl-pl/freemium-upgrade.js":[null],"./pl-pl/funstuff.js":[159869,293321],"./pl-pl/gallery.js":[706180,679864],"./pl-pl/growth.js":[959035,677553],"./pl-pl/guardians.js":[433322,636210],"./pl-pl/health.js":[43998,97970],"./pl-pl/help.js":[444575,649933],"./pl-pl/hololens.js":[755900,793978],"./pl-pl/host-controls.js":[323581,722353],"./pl-pl/jana.js":[947936,379036],"./pl-pl/lightbox.js":[901293,677553],"./pl-pl/links.js":[868891,677553],"./pl-pl/live-persona-card.js":[143130,677553],"./pl-pl/live-persona-editor.js":[856789,572461],"./pl-pl/lms-integration.js":[null],"./pl-pl/meet-for-work.js":[324899,660919],"./pl-pl/meeting-analytics.js":[609914,729958],"./pl-pl/meeting-apis-app.js":[null],"./pl-pl/meeting-bot.js":[null],"./pl-pl/meeting-collaboration.js":[261531,348279],"./pl-pl/meeting-flyout.js":[782387,677553],"./pl-pl/meeting-meet-app.js":[753825,677553],"./pl-pl/meeting-options.js":[142956,620592],"./pl-pl/meeting-recap.js":[99701,191057],"./pl-pl/meeting-room-console.js":[null],"./pl-pl/meeting-stream-app.js":[null],"./pl-pl/messaging.js":[810798,677553],"./pl-pl/mobile-attach.js":[null],"./pl-pl/mtma-missed-notifications.js":[983360,677553],"./pl-pl/nearby.js":[320891,677553],"./pl-pl/nova.js":[611234,677553],"./pl-pl/people-app.js":[null],"./pl-pl/people-picker.js":[74846,677553],"./pl-pl/people-targeting.js":[582881,767261],"./pl-pl/people.js":[890759,677553],"./pl-pl/person.js":[785713,677553],"./pl-pl/phonelink-sms.js":[21670,281614],"./pl-pl/pre-core.js":[null],"./pl-pl/premium-benefits.js":[37104,933796],"./pl-pl/presence.js":[887269,677553],"./pl-pl/queues.js":[537256,9444],"./pl-pl/recurrence.js":[737886,916962],"./pl-pl/rsc-application-permissions.js":[null],"./pl-pl/search.js":[987736,536348],"./pl-pl/semantic-object.js":[703170,712222],"./pl-pl/settings.js":[805633,677553],"./pl-pl/share-in-meetings.js":[null],"./pl-pl/share-to-teams-outlook-addin.js":[null],"./pl-pl/share-to-teams-third-party.js":[null],"./pl-pl/share-to-teams.js":[673848,471288],"./pl-pl/shortcut.js":[659258,677553],"./pl-pl/shortcuts.js":[806089,677553],"./pl-pl/simple-collab.js":[482622,677553],"./pl-pl/smart-device.js":[null],"./pl-pl/survey.js":[910034,389706],"./pl-pl/sv-flyout.js":[579593,677553],"./pl-pl/teams-and-channels.js":[734581,845237],"./pl-pl/teams-insider.js":[176723,677553],"./pl-pl/telemetry.js":[197889,677553],"./pl-pl/tfl-homepage.js":[546533,677553],"./pl-pl/tfl-onboarding.js":[381944,677553],"./pl-pl/toast-notifications.js":[991148,677553],"./pl-pl/trusted-ui.js":[null],"./pl-pl/unified-search.js":[699993,471288],"./pl-pl/unsupported-browser.js":[null],"./pl-pl/url-preview.js":[344958,677553],"./pl-pl/video-capture.js":[618926,634166],"./pl-pl/video-message.js":[645679,589171],"./pl-pl/virtual-consumer-events.js":[71554,166628],"./pl-pl/virtual-events.js":[655159,40224],"./pl-pl/webinar.js":[91808,907636],"./pl-pl/welcome-bot.js":[null],"./pl-pl/whats-new.js":[925342,677553],"./pl-pl/wiki.js":[null],"./pt-br/activity.js":[143101,978365],"./pt-br/artifacts-platform.js":[365717,383725],"./pt-br/audience-view-dialog.js":[313559,581519],"./pt-br/auth.js":[198758,978365],"./pt-br/autosuggest.js":[240709,978365],"./pt-br/avatar.js":[666357,978365],"./pt-br/biometric-enrollment.js":[336801,554029],"./pt-br/breakout-rooms.js":[683848,353592],"./pt-br/broadcast-scheduling.js":[1260,742392],"./pt-br/broadcast.js":[545229,983801],"./pt-br/calendar.js":[61426,139234],"./pt-br/calling.js":[118006,280506],"./pt-br/campaign-notifications.js":[863355,978365],"./pt-br/carousel-multi-card.js":[null],"./pt-br/cast.js":[183443,978365],"./pt-br/channels.js":[914392,978365],"./pt-br/chat-list.js":[712647,978365],"./pt-br/coach-report.js":[105635,748219],"./pt-br/comment-stream.js":[778304,7908],"./pt-br/communities.js":[375191,978365],"./pt-br/compose.js":[160046,978365],"./pt-br/contacts.js":[517661,978365],"./pt-br/datepicker.js":[920854,999164],"./pt-br/desktop.js":[82762,311942],"./pt-br/digital-signage.js":[null],"./pt-br/discover-surface.js":[473021,180213],"./pt-br/edu.js":[510270,692782],"./pt-br/embed.js":[641835,978365],"./pt-br/errors.js":[244143,978365],"./pt-br/esp.js":[920522,178894],"./pt-br/extensibility-ptz-extension.js":[null],"./pt-br/extensibility-room-remote.js":[null],"./pt-br/extensibility.js":[20295,978365],"./pt-br/feedback.js":[484607,328855],"./pt-br/files.js":[773253,978365],"./pt-br/framework.js":[517966,978365],"./pt-br/freemium-upgrade.js":[null],"./pt-br/funstuff.js":[455045,772757],"./pt-br/gallery.js":[465404,82416],"./pt-br/growth.js":[707219,978365],"./pt-br/guardians.js":[727890,355858],"./pt-br/health.js":[939398,360146],"./pt-br/help.js":[551991,284481],"./pt-br/hololens.js":[753076,280506],"./pt-br/host-controls.js":[270805,539517],"./pt-br/jana.js":[397016,841852],"./pt-br/lightbox.js":[874933,978365],"./pt-br/links.js":[344067,978365],"./pt-br/live-persona-card.js":[501282,978365],"./pt-br/live-persona-editor.js":[59677,783713],"./pt-br/lms-integration.js":[null],"./pt-br/meet-for-work.js":[609899,851083],"./pt-br/meeting-analytics.js":[498082,316590],"./pt-br/meeting-apis-app.js":[null],"./pt-br/meeting-bot.js":[null],"./pt-br/meeting-collaboration.js":[587219,935563],"./pt-br/meeting-flyout.js":[102235,978365],"./pt-br/meeting-meet-app.js":[909657,978365],"./pt-br/meeting-options.js":[164724,577256],"./pt-br/meeting-recap.js":[151261,842909],"./pt-br/meeting-room-console.js":[null],"./pt-br/meeting-stream-app.js":[null],"./pt-br/messaging.js":[304422,978365],"./pt-br/mobile-attach.js":[null],"./pt-br/mtma-missed-notifications.js":[820120,978365],"./pt-br/nearby.js":[593203,978365],"./pt-br/nova.js":[227226,978365],"./pt-br/people-app.js":[null],"./pt-br/people-picker.js":[41238,978365],"./pt-br/people-targeting.js":[43817,599985],"./pt-br/people.js":[649759,978365],"./pt-br/person.js":[963369,978365],"./pt-br/phonelink-sms.js":[303742,90358],"./pt-br/pre-core.js":[null],"./pt-br/premium-benefits.js":[195816,818500],"./pt-br/presence.js":[208205,978365],"./pt-br/queues.js":[879744,351620],"./pt-br/recurrence.js":[630118,82914],"./pt-br/rsc-application-permissions.js":[null],"./pt-br/search.js":[97952,999164],"./pt-br/semantic-object.js":[794282,177382],"./pt-br/settings.js":[402169,978365],"./pt-br/share-in-meetings.js":[null],"./pt-br/share-to-teams-outlook-addin.js":[null],"./pt-br/share-to-teams-third-party.js":[null],"./pt-br/share-to-teams.js":[565408,357488],"./pt-br/shortcut.js":[161874,978365],"./pt-br/shortcuts.js":[477393,978365],"./pt-br/simple-collab.js":[830742,978365],"./pt-br/smart-device.js":[null],"./pt-br/survey.js":[791162,858282],"./pt-br/sv-flyout.js":[80625,978365],"./pt-br/teams-and-channels.js":[108045,972233],"./pt-br/teams-insider.js":[423819,978365],"./pt-br/telemetry.js":[73785,978365],"./pt-br/tfl-homepage.js":[997357,978365],"./pt-br/tfl-onboarding.js":[176608,978365],"./pt-br/toast-notifications.js":[540420,978365],"./pt-br/trusted-ui.js":[null],"./pt-br/unified-search.js":[870945,357488],"./pt-br/unsupported-browser.js":[null],"./pt-br/url-preview.js":[524278,978365],"./pt-br/video-capture.js":[62310,640990],"./pt-br/video-message.js":[626647,865743],"./pt-br/virtual-consumer-events.js":[170218,534980],"./pt-br/virtual-events.js":[719023,72056],"./pt-br/webinar.js":[338184,377780],"./pt-br/welcome-bot.js":[null],"./pt-br/whats-new.js":[845046,978365],"./pt-br/wiki.js":[null],"./pt-pt/activity.js":[104117,799697],"./pt-pt/artifacts-platform.js":[349197,22945],"./pt-pt/audience-view-dialog.js":[753471,209651],"./pt-pt/auth.js":[324766,799697],"./pt-pt/autosuggest.js":[692493,799697],"./pt-pt/avatar.js":[294877,799697],"./pt-pt/biometric-enrollment.js":[291929,193249],"./pt-pt/breakout-rooms.js":[554192,238208],"./pt-pt/broadcast-scheduling.js":[657492,627008],"./pt-pt/broadcast.js":[951029,1845],"./pt-pt/calendar.js":[405434,359442],"./pt-pt/calling.js":[36078,500714],"./pt-pt/campaign-notifications.js":[848371,799697],"./pt-pt/carousel-multi-card.js":[null],"./pt-pt/cast.js":[598395,799697],"./pt-pt/channels.js":[386464,799697],"./pt-pt/chat-list.js":[738399,799697],"./pt-pt/coach-report.js":[668779,581831],"./pt-pt/comment-stream.js":[972968,839284],"./pt-pt/communities.js":[102511,799697],"./pt-pt/compose.js":[682902,799697],"./pt-pt/contacts.js":[590309,799697],"./pt-pt/datepicker.js":[405726,778956],"./pt-pt/desktop.js":[236386,253982],"./pt-pt/digital-signage.js":[null],"./pt-pt/discover-surface.js":[732085,648137],"./pt-pt/edu.js":[229270,579718],"./pt-pt/embed.js":[285907,799697],"./pt-pt/errors.js":[936679,799697],"./pt-pt/esp.js":[398274,14246],"./pt-pt/extensibility-ptz-extension.js":[null],"./pt-pt/extensibility-room-remote.js":[null],"./pt-pt/extensibility.js":[17647,799697],"./pt-pt/feedback.js":[979959,451451],"./pt-pt/files.js":[970621,799697],"./pt-pt/framework.js":[933270,799697],"./pt-pt/freemium-upgrade.js":[null],"./pt-pt/funstuff.js":[586589,189097],"./pt-pt/gallery.js":[567972,195480],"./pt-pt/growth.js":[991131,799697],"./pt-pt/guardians.js":[819274,758178],"./pt-pt/health.js":[565822,185762],"./pt-pt/help.js":[950847,474237],"./pt-pt/hololens.js":[258652,500714],"./pt-pt/host-controls.js":[520861,360849],"./pt-pt/jana.js":[287232,621644],"./pt-pt/lightbox.js":[145933,799697],"./pt-pt/links.js":[484283,799697],"./pt-pt/live-persona-card.js":[946618,799697],"./pt-pt/live-persona-editor.js":[478581,921885],"./pt-pt/lms-integration.js":[null],"./pt-pt/meet-for-work.js":[549251,383159],"./pt-pt/meeting-analytics.js":[413786,203526],"./pt-pt/meeting-apis-app.js":[null],"./pt-pt/meeting-bot.js":[null],"./pt-pt/meeting-collaboration.js":[760955,467639],"./pt-pt/meeting-flyout.js":[873875,799697],"./pt-pt/meeting-meet-app.js":[605953,799697],"./pt-pt/meeting-options.js":[331852,635216],"./pt-pt/meeting-recap.js":[578133,715825],"./pt-pt/meeting-room-console.js":[null],"./pt-pt/meeting-stream-app.js":[null],"./pt-pt/messaging.js":[91406,799697],"./pt-pt/mobile-attach.js":[null],"./pt-pt/mtma-missed-notifications.js":[273760,799697],"./pt-pt/nearby.js":[994203,799697],"./pt-pt/nova.js":[167426,799697],"./pt-pt/people-app.js":[null],"./pt-pt/people-picker.js":[738174,799697],"./pt-pt/people-targeting.js":[899841,971853],"./pt-pt/people.js":[888295,799697],"./pt-pt/person.js":[502481,799697],"./pt-pt/phonelink-sms.js":[664710,637806],"./pt-pt/pre-core.js":[null],"./pt-pt/premium-benefits.js":[261776,598292],"./pt-pt/presence.js":[902917,799697],"./pt-pt/queues.js":[77320,131412],"./pt-pt/recurrence.js":[769406,819474],"./pt-pt/rsc-application-permissions.js":[null],"./pt-pt/search.js":[233016,778956],"./pt-pt/semantic-object.js":[574306,119422],"./pt-pt/settings.js":[912225,799697],"./pt-pt/share-in-meetings.js":[null],"./pt-pt/share-to-teams-outlook-addin.js":[null],"./pt-pt/share-to-teams-third-party.js":[null],"./pt-pt/share-to-teams.js":[86680,986904],"./pt-pt/shortcut.js":[798234,799697],"./pt-pt/shortcuts.js":[600617,799697],"./pt-pt/simple-collab.js":[949598,799697],"./pt-pt/smart-device.js":[null],"./pt-pt/survey.js":[615538,683898],"./pt-pt/sv-flyout.js":[366953,799697],"./pt-pt/teams-and-channels.js":[667221,333285],"./pt-pt/teams-insider.js":[993651,799697],"./pt-pt/telemetry.js":[645345,799697],"./pt-pt/tfl-homepage.js":[456005,799697],"./pt-pt/tfl-onboarding.js":[52760,799697],"./pt-pt/toast-notifications.js":[715532,799697],"./pt-pt/trusted-ui.js":[null],"./pt-pt/unified-search.js":[509049,986904],"./pt-pt/unsupported-browser.js":[null],"./pt-pt/url-preview.js":[66462,799697],"./pt-pt/video-capture.js":[909902,710038],"./pt-pt/video-message.js":[38607,493875],"./pt-pt/virtual-consumer-events.js":[766114,314772],"./pt-pt/virtual-events.js":[347671,473024],"./pt-pt/webinar.js":[796224,407524],"./pt-pt/welcome-bot.js":[null],"./pt-pt/whats-new.js":[750910,799697],"./pt-pt/wiki.js":[null],"./ro-ro/activity.js":[464227,773187],"./ro-ro/artifacts-platform.js":[356903,149907],"./ro-ro/audience-view-dialog.js":[134741,211637],"./ro-ro/auth.js":[51348,773187],"./ro-ro/autosuggest.js":[556371,773187],"./ro-ro/avatar.js":[40451,773187],"./ro-ro/biometric-enrollment.js":[289071,836563],"./ro-ro/breakout-rooms.js":[428110,902022],"./ro-ro/broadcast-scheduling.js":[574302,807174],"./ro-ro/broadcast.js":[702771,50807],"./ro-ro/calendar.js":[572964,113096],"./ro-ro/calling.js":[160164,582496],"./ro-ro/campaign-notifications.js":[133113,773187],"./ro-ro/carousel-multi-card.js":[null],"./ro-ro/cast.js":[429545,773187],"./ro-ro/channels.js":[48510,773187],"./ro-ro/chat-list.js":[967353,773187],"./ro-ro/coach-report.js":[170897,714409],"./ro-ro/comment-stream.js":[813554,721034],"./ro-ro/communities.js":[711913,773187],"./ro-ro/compose.js":[716920,773187],"./ro-ro/contacts.js":[796007,773187],"./ro-ro/datepicker.js":[198568,106338],"./ro-ro/desktop.js":[600312,386532],"./ro-ro/digital-signage.js":[null],"./ro-ro/discover-surface.js":[484759,239899],"./ro-ro/edu.js":[361256,786828],"./ro-ro/embed.js":[567433,773187],"./ro-ro/errors.js":[80505,773187],"./ro-ro/esp.js":[162616,650156],"./ro-ro/extensibility-ptz-extension.js":[null],"./ro-ro/extensibility-room-remote.js":[null],"./ro-ro/extensibility.js":[405429,773187],"./ro-ro/feedback.js":[90701,263037],"./ro-ro/files.js":[400503,773187],"./ro-ro/framework.js":[481848,773187],"./ro-ro/freemium-upgrade.js":[null],"./ro-ro/funstuff.js":[598431,406651],"./ro-ro/gallery.js":[170334,100798],"./ro-ro/growth.js":[494441,773187],"./ro-ro/guardians.js":[504300,381848],"./ro-ro/health.js":[168860,325784],"./ro-ro/help.js":[755701,581791],"./ro-ro/hololens.js":[89194,582496],"./ro-ro/host-controls.js":[171735,334339],"./ro-ro/jana.js":[420958,465378],"./ro-ro/lightbox.js":[327607,773187],"./ro-ro/links.js":[20553,773187],"./ro-ro/live-persona-card.js":[992472,773187],"./ro-ro/live-persona-editor.js":[925411,930111],"./ro-ro/lms-integration.js":[null],"./ro-ro/meet-for-work.js":[146081,183897],"./ro-ro/meeting-analytics.js":[3792,410636],"./ro-ro/meeting-apis-app.js":[null],"./ro-ro/meeting-bot.js":[null],"./ro-ro/meeting-collaboration.js":[289441,871257],"./ro-ro/meeting-flyout.js":[602345,773187],"./ro-ro/meeting-meet-app.js":[367015,773187],"./ro-ro/meeting-options.js":[110654,665174],"./ro-ro/meeting-recap.js":[498151,277923],"./ro-ro/meeting-room-console.js":[null],"./ro-ro/meeting-stream-app.js":[null],"./ro-ro/messaging.js":[249036,773187],"./ro-ro/mobile-attach.js":[null],"./ro-ro/mtma-missed-notifications.js":[282870,773187],"./ro-ro/nearby.js":[321461,773187],"./ro-ro/nova.js":[415212,773187],"./ro-ro/people-app.js":[null],"./ro-ro/people-picker.js":[630944,773187],"./ro-ro/people-targeting.js":[289459,715887],"./ro-ro/people.js":[239425,773187],"./ro-ro/person.js":[112607,773187],"./ro-ro/phonelink-sms.js":[635904,884084],"./ro-ro/pre-core.js":[null],"./ro-ro/premium-benefits.js":[46194,989098],"./ro-ro/presence.js":[122243,773187],"./ro-ro/queues.js":[610418,522218],"./ro-ro/recurrence.js":[177564,996424],"./ro-ro/rsc-application-permissions.js":[null],"./ro-ro/search.js":[411218,106338],"./ro-ro/semantic-object.js":[133704,158020],"./ro-ro/settings.js":[781719,773187],"./ro-ro/share-in-meetings.js":[null],"./ro-ro/share-to-teams-outlook-addin.js":[null],"./ro-ro/share-to-teams-third-party.js":[null],"./ro-ro/share-to-teams.js":[651654,449150],"./ro-ro/shortcut.js":[643136,773187],"./ro-ro/shortcuts.js":[646591,773187],"./ro-ro/simple-collab.js":[648040,773187],"./ro-ro/smart-device.js":[null],"./ro-ro/survey.js":[850628,887344],"./ro-ro/sv-flyout.js":[831539,773187],"./ro-ro/teams-and-channels.js":[403355,535271],"./ro-ro/teams-insider.js":[566477,773187],"./ro-ro/telemetry.js":[83271,773187],"./ro-ro/tfl-homepage.js":[555103,773187],"./ro-ro/tfl-onboarding.js":[295126,773187],"./ro-ro/toast-notifications.js":[362338,773187],"./ro-ro/trusted-ui.js":[null],"./ro-ro/unified-search.js":[819027,449150],"./ro-ro/unsupported-browser.js":[null],"./ro-ro/url-preview.js":[105824,773187],"./ro-ro/video-capture.js":[177120,104796],"./ro-ro/video-message.js":[293077,495861],"./ro-ro/virtual-consumer-events.js":[655532,705578],"./ro-ro/virtual-events.js":[392857,136838],"./ro-ro/webinar.js":[343522,721146],"./ro-ro/welcome-bot.js":[null],"./ro-ro/whats-new.js":[834e3,773187],"./ro-ro/wiki.js":[null],"./ru-ru/activity.js":[689151,421443],"./ru-ru/artifacts-platform.js":[212979,519827],"./ru-ru/audience-view-dialog.js":[694601,458645],"./ru-ru/auth.js":[892920,421443],"./ru-ru/autosuggest.js":[829567,421443],"./ru-ru/avatar.js":[171159,421443],"./ru-ru/biometric-enrollment.js":[798835,206483],"./ru-ru/breakout-rooms.js":[634802,946226],"./ru-ru/broadcast-scheduling.js":[577842,851378],"./ru-ru/broadcast.js":[681447,10999],"./ru-ru/calendar.js":[498504,249340],"./ru-ru/calling.js":[662496,399412],"./ru-ru/campaign-notifications.js":[533413,421443],"./ru-ru/carousel-multi-card.js":[null],"./ru-ru/cast.js":[532709,421443],"./ru-ru/channels.js":[794242,421443],"./ru-ru/chat-list.js":[233221,421443],"./ru-ru/coach-report.js":[977133,344489],"./ru-ru/comment-stream.js":[813238,763686],"./ru-ru/communities.js":[495981,421443],"./ru-ru/compose.js":[799828,421443],"./ru-ru/contacts.js":[287819,421443],"./ru-ru/datepicker.js":[617900,486974],"./ru-ru/desktop.js":[468052,981912],"./ru-ru/digital-signage.js":[null],"./ru-ru/discover-surface.js":[424027,305243],"./ru-ru/edu.js":[37596,135200],"./ru-ru/embed.js":[337061,421443],"./ru-ru/errors.js":[89981,421443],"./ru-ru/esp.js":[37244,112256],"./ru-ru/extensibility-ptz-extension.js":[null],"./ru-ru/extensibility-room-remote.js":[null],"./ru-ru/extensibility.js":[122609,421443],"./ru-ru/feedback.js":[787153,716989],"./ru-ru/files.js":[385067,421443],"./ru-ru/framework.js":[390764,421443],"./ru-ru/freemium-upgrade.js":[null],"./ru-ru/funstuff.js":[902139,565051],"./ru-ru/gallery.js":[621162,996394],"./ru-ru/growth.js":[226205,421443],"./ru-ru/guardians.js":[143352,508940],"./ru-ru/health.js":[223480,910348],"./ru-ru/help.js":[857769,582783],"./ru-ru/hololens.js":[389054,399412],"./ru-ru/host-controls.js":[823491,982595],"./ru-ru/jana.js":[470698,329662],"./ru-ru/lightbox.js":[832427,421443],"./ru-ru/links.js":[738629,421443],"./ru-ru/live-persona-card.js":[146028,421443],"./ru-ru/live-persona-editor.js":[232047,336991],"./ru-ru/lms-integration.js":[null],"./ru-ru/meet-for-work.js":[719613,78169],"./ru-ru/meeting-analytics.js":[495196,759008],"./ru-ru/meeting-apis-app.js":[null],"./ru-ru/meeting-bot.js":[null],"./ru-ru/meeting-collaboration.js":[548477,281881],"./ru-ru/meeting-flyout.js":[901149,421443],"./ru-ru/meeting-meet-app.js":[803147,421443],"./ru-ru/meeting-options.js":[3298,873986],"./ru-ru/meeting-recap.js":[468579,383651],"./ru-ru/meeting-room-console.js":[null],"./ru-ru/meeting-stream-app.js":[null],"./ru-ru/messaging.js":[681504,421443],"./ru-ru/mobile-attach.js":[null],"./ru-ru/mtma-missed-notifications.js":[705514,421443],"./ru-ru/nearby.js":[955353,421443],"./ru-ru/nova.js":[731336,421443],"./ru-ru/people-app.js":[null],"./ru-ru/people-picker.js":[961548,421443],"./ru-ru/people-targeting.js":[19903,952527],"./ru-ru/people.js":[902085,421443],"./ru-ru/person.js":[571803,421443],"./ru-ru/phonelink-sms.js":[559428,802536],"./ru-ru/pre-core.js":[null],"./ru-ru/premium-benefits.js":[732694,680710],"./ru-ru/presence.js":[832535,421443],"./ru-ru/queues.js":[612502,213830],"./ru-ru/recurrence.js":[26312,158844],"./ru-ru/rsc-application-permissions.js":[null],"./ru-ru/search.js":[367598,486974],"./ru-ru/semantic-object.js":[41076,295928],"./ru-ru/settings.js":[740163,421443],"./ru-ru/share-in-meetings.js":[null],"./ru-ru/share-to-teams-outlook-addin.js":[null],"./ru-ru/share-to-teams-third-party.js":[null],"./ru-ru/share-to-teams.js":[423738,802218],"./ru-ru/shortcut.js":[600404,421443],"./ru-ru/shortcuts.js":[499931,421443],"./ru-ru/simple-collab.js":[143260,421443],"./ru-ru/smart-device.js":[null],"./ru-ru/survey.js":[698e3,545156],"./ru-ru/sv-flyout.js":[65671,421443],"./ru-ru/teams-and-channels.js":[540407,916007],"./ru-ru/teams-insider.js":[55537,421443],"./ru-ru/telemetry.js":[560411,421443],"./ru-ru/tfl-homepage.js":[507883,421443],"./ru-ru/tfl-onboarding.js":[20906,421443],"./ru-ru/toast-notifications.js":[531702,421443],"./ru-ru/trusted-ui.js":[null],"./ru-ru/unified-search.js":[512271,802218],"./ru-ru/unsupported-browser.js":[null],"./ru-ru/url-preview.js":[446500,421443],"./ru-ru/video-capture.js":[222540,231344],"./ru-ru/video-message.js":[568649,742869],"./ru-ru/virtual-consumer-events.js":[969992,913542],"./ru-ru/virtual-events.js":[764637,181042],"./ru-ru/webinar.js":[538502,383510],"./ru-ru/welcome-bot.js":[null],"./ru-ru/whats-new.js":[713452,421443],"./ru-ru/wiki.js":[null],"./sk-sk/activity.js":[839925,100337],"./sk-sk/artifacts-platform.js":[669965,869633],"./sk-sk/audience-view-dialog.js":[225663,37243],"./sk-sk/auth.js":[464862,100337],"./sk-sk/autosuggest.js":[168653,100337],"./sk-sk/avatar.js":[364957,100337],"./sk-sk/biometric-enrollment.js":[1881,556289],"./sk-sk/breakout-rooms.js":[962704,617616],"./sk-sk/broadcast-scheduling.js":[296468,522768],"./sk-sk/broadcast.js":[954677,90069],"./sk-sk/calendar.js":[662650,15250],"./sk-sk/calling.js":[888942,28170],"./sk-sk/campaign-notifications.js":[253747,100337],"./sk-sk/carousel-multi-card.js":[null],"./sk-sk/cast.js":[502907,100337],"./sk-sk/channels.js":[726368,100337],"./sk-sk/chat-list.js":[449567,100337],"./sk-sk/coach-report.js":[105259,195711],"./sk-sk/comment-stream.js":[119272,176244],"./sk-sk/communities.js":[644783,100337],"./sk-sk/compose.js":[690390,100337],"./sk-sk/contacts.js":[373285,100337],"./sk-sk/datepicker.js":[754846,123596],"./sk-sk/desktop.js":[531746,239710],"./sk-sk/digital-signage.js":[null],"./sk-sk/discover-surface.js":[658165,354857],"./sk-sk/edu.js":[298326,631046],"./sk-sk/embed.js":[719763,100337],"./sk-sk/errors.js":[45159,100337],"./sk-sk/esp.js":[467330,900262],"./sk-sk/extensibility-ptz-extension.js":[null],"./sk-sk/extensibility-room-remote.js":[null],"./sk-sk/extensibility.js":[358319,100337],"./sk-sk/feedback.js":[580343,770723],"./sk-sk/files.js":[14397,100337],"./sk-sk/framework.js":[362390,100337],"./sk-sk/freemium-upgrade.js":[null],"./sk-sk/funstuff.js":[441629,521609],"./sk-sk/gallery.js":[837156,176808],"./sk-sk/growth.js":[375707,100337],"./sk-sk/guardians.js":[614474,7522],"./sk-sk/health.js":[109630,997410],"./sk-sk/help.js":[140863,148125],"./sk-sk/hololens.js":[748124,28170],"./sk-sk/host-controls.js":[306781,661489],"./sk-sk/jana.js":[177344,482636],"./sk-sk/lightbox.js":[932749,100337],"./sk-sk/links.js":[761211,100337],"./sk-sk/live-persona-card.js":[841530,100337],"./sk-sk/live-persona-editor.js":[986805,496445],"./sk-sk/lms-integration.js":[null],"./sk-sk/meet-for-work.js":[313411,941679],"./sk-sk/meeting-analytics.js":[519898,254854],"./sk-sk/meeting-apis-app.js":[null],"./sk-sk/meeting-bot.js":[null],"./sk-sk/meeting-collaboration.js":[752699,602863],"./sk-sk/meeting-flyout.js":[669459,100337],"./sk-sk/meeting-meet-app.js":[907777,100337],"./sk-sk/meeting-options.js":[518028,93024],"./sk-sk/meeting-recap.js":[257621,130193],"./sk-sk/meeting-room-console.js":[null],"./sk-sk/meeting-stream-app.js":[null],"./sk-sk/messaging.js":[53134,100337],"./sk-sk/mobile-attach.js":[null],"./sk-sk/mtma-missed-notifications.js":[71712,100337],"./sk-sk/nearby.js":[221211,100337],"./sk-sk/nova.js":[321922,100337],"./sk-sk/people-app.js":[null],"./sk-sk/people-picker.js":[168574,100337],"./sk-sk/people-targeting.js":[678337,99693],"./sk-sk/people.js":[996775,100337],"./sk-sk/person.js":[565009,100337],"./sk-sk/phonelink-sms.js":[693830,58478],"./sk-sk/pre-core.js":[null],"./sk-sk/premium-benefits.js":[286224,453076],"./sk-sk/presence.js":[877509,100337],"./sk-sk/queues.js":[328776,952020],"./sk-sk/recurrence.js":[474558,475282],"./sk-sk/rsc-application-permissions.js":[null],"./sk-sk/search.js":[798968,123596],"./sk-sk/semantic-object.js":[218082,939838],"./sk-sk/settings.js":[748001,100337],"./sk-sk/share-in-meetings.js":[null],"./sk-sk/share-to-teams-outlook-addin.js":[null],"./sk-sk/share-to-teams-third-party.js":[null],"./sk-sk/share-to-teams.js":[216152,101864],"./sk-sk/shortcut.js":[537434,100337],"./sk-sk/shortcuts.js":[5225,100337],"./sk-sk/simple-collab.js":[290526,100337],"./sk-sk/smart-device.js":[null],"./sk-sk/survey.js":[961266,194394],"./sk-sk/sv-flyout.js":[226345,100337],"./sk-sk/teams-and-channels.js":[799381,393477],"./sk-sk/teams-insider.js":[175219,100337],"./sk-sk/telemetry.js":[243745,100337],"./sk-sk/tfl-homepage.js":[536453,100337],"./sk-sk/tfl-onboarding.js":[857176,100337],"./sk-sk/toast-notifications.js":[732300,100337],"./sk-sk/trusted-ui.js":[null],"./sk-sk/unified-search.js":[931961,101864],"./sk-sk/unsupported-browser.js":[null],"./sk-sk/url-preview.js":[323614,100337],"./sk-sk/video-capture.js":[467534,107478],"./sk-sk/video-message.js":[874703,321467],"./sk-sk/virtual-consumer-events.js":[659106,685908],"./sk-sk/virtual-events.js":[897623,852432],"./sk-sk/webinar.js":[273408,585380],"./sk-sk/welcome-bot.js":[null],"./sk-sk/whats-new.js":[97598,100337],"./sk-sk/wiki.js":[null],"./sl-si/activity.js":[894606,197066],"./sl-si/artifacts-platform.js":[946986,704282],"./sl-si/audience-view-dialog.js":[356556,42316],"./sl-si/auth.js":[283361,197066],"./sl-si/autosuggest.js":[265480,197066],"./sl-si/avatar.js":[655274,197066],"./sl-si/biometric-enrollment.js":[981054,874586],"./sl-si/breakout-rooms.js":[866243,996315],"./sl-si/broadcast-scheduling.js":[373831,385115],"./sl-si/broadcast.js":[91576,369126],"./sl-si/calendar.js":[593593,185077],"./sl-si/calling.js":[703383,119533],"./sl-si/campaign-notifications.js":[133164,197066],"./sl-si/carousel-multi-card.js":[null],"./sl-si/cast.js":[723052,197066],"./sl-si/channels.js":[220687,197066],"./sl-si/chat-list.js":[366574,197066],"./sl-si/coach-report.js":[851960,566104],"./sl-si/comment-stream.js":[602095,748263],"./sl-si/communities.js":[867914,197066],"./sl-si/compose.js":[362067,197066],"./sl-si/contacts.js":[487654,197066],"./sl-si/datepicker.js":[682449,537855],"./sl-si/desktop.js":[809143,363881],"./sl-si/digital-signage.js":[null],"./sl-si/discover-surface.js":[272302,960642],"./sl-si/edu.js":[178763,628209],"./sl-si/embed.js":[102110,197066],"./sl-si/errors.js":[190788,197066],"./sl-si/esp.js":[261307,990481],"./sl-si/extensibility-ptz-extension.js":[null],"./sl-si/extensibility-room-remote.js":[null],"./sl-si/extensibility.js":[951234,197066],"./sl-si/feedback.js":[963548,610068],"./sl-si/files.js":[566148,197066],"./sl-si/framework.js":[628703,197066],"./sl-si/freemium-upgrade.js":[null],"./sl-si/funstuff.js":[51898,910498],"./sl-si/gallery.js":[663209,172563],"./sl-si/growth.js":[559284,197066],"./sl-si/guardians.js":[204799,177349],"./sl-si/health.js":[868657,48005],"./sl-si/help.js":[863296,746990],"./sl-si/hololens.js":[530071,119533],"./sl-si/host-controls.js":[672140,758218],"./sl-si/jana.js":[741543,380543],"./sl-si/lightbox.js":[859286,197066],"./sl-si/links.js":[980098,197066],"./sl-si/live-persona-card.js":[462095,197066],"./sl-si/live-persona-editor.js":[337976,69134],"./sl-si/lms-integration.js":[null],"./sl-si/meet-for-work.js":[824902,282952],"./sl-si/meeting-analytics.js":[696483,768369],"./sl-si/meeting-apis-app.js":[null],"./sl-si/meeting-bot.js":[null],"./sl-si/meeting-collaboration.js":[423010,367432],"./sl-si/meeting-flyout.js":[414948,197066],"./sl-si/meeting-meet-app.js":[799730,197066],"./sl-si/meeting-options.js":[34725,395883],"./sl-si/meeting-recap.js":[780608,570666],"./sl-si/meeting-room-console.js":[null],"./sl-si/meeting-stream-app.js":[null],"./sl-si/messaging.js":[4359,197066],"./sl-si/mobile-attach.js":[null],"./sl-si/mtma-missed-notifications.js":[629877,197066],"./sl-si/nearby.js":[47544,197066],"./sl-si/nova.js":[272745,197066],"./sl-si/people-app.js":[null],"./sl-si/people-picker.js":[939735,197066],"./sl-si/people-targeting.js":[335998,104446],"./sl-si/people.js":[469088,197066],"./sl-si/person.js":[141350,197066],"./sl-si/phonelink-sms.js":[974363,159609],"./sl-si/pre-core.js":[null],"./sl-si/premium-benefits.js":[425311,558855],"./sl-si/presence.js":[582582,197066],"./sl-si/queues.js":[55859,91975],"./sl-si/recurrence.js":[223529,68405],"./sl-si/rsc-application-permissions.js":[null],"./sl-si/search.js":[544707,537855],"./sl-si/semantic-object.js":[573487,692297],"./sl-si/settings.js":[777726,197066],"./sl-si/share-in-meetings.js":[null],"./sl-si/share-to-teams-outlook-addin.js":[null],"./sl-si/share-to-teams-third-party.js":[null],"./sl-si/share-to-teams.js":[899067,520915],"./sl-si/shortcut.js":[974029,197066],"./sl-si/shortcuts.js":[917096,197066],"./sl-si/simple-collab.js":[968391,197066],"./sl-si/smart-device.js":[null],"./sl-si/survey.js":[631345,959229],"./sl-si/sv-flyout.js":[872960,197066],"./sl-si/teams-and-channels.js":[196574,518550],"./sl-si/teams-insider.js":[496706,197066],"./sl-si/telemetry.js":[357044,197066],"./sl-si/tfl-homepage.js":[878706,197066],"./sl-si/tfl-onboarding.js":[260227,197066],"./sl-si/toast-notifications.js":[766933,197066],"./sl-si/trusted-ui.js":[null],"./sl-si/unified-search.js":[222058,520915],"./sl-si/unsupported-browser.js":[null],"./sl-si/url-preview.js":[277303,197066],"./sl-si/video-capture.js":[618439,144897],"./sl-si/video-message.js":[931890,326540],"./sl-si/virtual-consumer-events.js":[676747,275335],"./sl-si/virtual-events.js":[270956,231131],"./sl-si/webinar.js":[833745,896727],"./sl-si/welcome-bot.js":[null],"./sl-si/whats-new.js":[510459,197066],"./sl-si/wiki.js":[null],"./sq-al/activity.js":[464114,266394],"./sq-al/artifacts-platform.js":[147342,479274],"./sq-al/audience-view-dialog.js":[657976,592216],"./sq-al/auth.js":[972333,266394],"./sq-al/autosuggest.js":[791004,266394],"./sq-al/avatar.js":[314326,266394],"./sq-al/biometric-enrollment.js":[548842,165930],"./sq-al/breakout-rooms.js":[793535,48891],"./sq-al/broadcast-scheduling.js":[365427,954043],"./sq-al/broadcast.js":[979876,81734],"./sq-al/calendar.js":[911717,684961],"./sq-al/calling.js":[807595,236777],"./sq-al/campaign-notifications.js":[641888,266394],"./sq-al/carousel-multi-card.js":[null],"./sq-al/cast.js":[740208,266394],"./sq-al/channels.js":[942235,266394],"./sq-al/chat-list.js":[771586,266394],"./sq-al/coach-report.js":[189596,913892],"./sq-al/comment-stream.js":[284859,537559],"./sq-al/communities.js":[21862,266394],"./sq-al/compose.js":[376311,266394],"./sq-al/contacts.js":[8898,266394],"./sq-al/datepicker.js":[829357,972575],"./sq-al/desktop.js":[771787,976581],"./sq-al/digital-signage.js":[null],"./sq-al/discover-surface.js":[601050,450338],"./sq-al/edu.js":[291863,153501],"./sq-al/embed.js":[7410,266394],"./sq-al/errors.js":[408064,266394],"./sq-al/esp.js":[408151,474301],"./sq-al/extensibility-ptz-extension.js":[null],"./sq-al/extensibility-room-remote.js":[null],"./sq-al/extensibility.js":[329318,266394],"./sq-al/feedback.js":[224456,229520],"./sq-al/files.js":[965712,266394],"./sq-al/framework.js":[560347,266394],"./sq-al/freemium-upgrade.js":[null],"./sq-al/funstuff.js":[111358,571010],"./sq-al/gallery.js":[59853,763619],"./sq-al/growth.js":[234768,266394],"./sq-al/guardians.js":[39027,911985],"./sq-al/health.js":[721765,359345],"./sq-al/help.js":[520204,903902],"./sq-al/hololens.js":[677779,236777],"./sq-al/host-controls.js":[864,827546],"./sq-al/jana.js":[503739,815263],"./sq-al/lightbox.js":[421906,266394],"./sq-al/links.js":[298438,266394],"./sq-al/live-persona-card.js":[831835,266394],"./sq-al/live-persona-editor.js":[182620,81406],"./sq-al/lms-integration.js":[null],"./sq-al/meet-for-work.js":[889226,212052],"./sq-al/meeting-analytics.js":[342023,293661],"./sq-al/meeting-apis-app.js":[null],"./sq-al/meeting-bot.js":[null],"./sq-al/meeting-collaboration.js":[504598,780180],"./sq-al/meeting-flyout.js":[198272,266394],"./sq-al/meeting-meet-app.js":[358078,266394],"./sq-al/meeting-options.js":[865729,428171],"./sq-al/meeting-recap.js":[720980,130938],"./sq-al/meeting-room-console.js":[null],"./sq-al/meeting-stream-app.js":[null],"./sq-al/messaging.js":[442419,266394],"./sq-al/mobile-attach.js":[null],"./sq-al/mtma-missed-notifications.js":[750049,266394],"./sq-al/nearby.js":[322340,266394],"./sq-al/nova.js":[706893,266394],"./sq-al/people-app.js":[null],"./sq-al/people-picker.js":[272811,266394],"./sq-al/people-targeting.js":[487362,366382],"./sq-al/people.js":[777212,266394],"./sq-al/person.js":[630762,266394],"./sq-al/phonelink-sms.js":[241719,823829],"./sq-al/pre-core.js":[null],"./sq-al/premium-benefits.js":[455787,754039],"./sq-al/presence.js":[715170,266394],"./sq-al/queues.js":[529407,313335],"./sq-al/recurrence.js":[941373,144993],"./sq-al/rsc-application-permissions.js":[null],"./sq-al/search.js":[880983,972575],"./sq-al/semantic-object.js":[319827,762469],"./sq-al/settings.js":[928178,266394],"./sq-al/share-in-meetings.js":[null],"./sq-al/share-to-teams-outlook-addin.js":[null],"./sq-al/share-to-teams-third-party.js":[null],"./sq-al/share-to-teams.js":[228391,688675],"./sq-al/shortcut.js":[221161,266394],"./sq-al/shortcuts.js":[740556,266394],"./sq-al/simple-collab.js":[894083,266394],"./sq-al/smart-device.js":[null],"./sq-al/survey.js":[384149,475257],"./sq-al/sv-flyout.js":[782300,266394],"./sq-al/teams-and-channels.js":[623906,772214],"./sq-al/teams-insider.js":[671006,266394],"./sq-al/telemetry.js":[758640,266394],"./sq-al/tfl-homepage.js":[101862,266394],"./sq-al/tfl-onboarding.js":[685647,266394],"./sq-al/toast-notifications.js":[661649,266394],"./sq-al/trusted-ui.js":[null],"./sq-al/unified-search.js":[19038,688675],"./sq-al/unsupported-browser.js":[null],"./sq-al/url-preview.js":[314083,266394],"./sq-al/video-capture.js":[508891,698669],"./sq-al/video-message.js":[548670,876440],"./sq-al/virtual-consumer-events.js":[433759,470519],"./sq-al/virtual-events.js":[987464,283707],"./sq-al/webinar.js":[21293,123527],"./sq-al/welcome-bot.js":[null],"./sq-al/whats-new.js":[64911,266394],"./sq-al/wiki.js":[null],"./sr-latn-rs/activity.js":[864079,995141],"./sr-latn-rs/artifacts-platform.js":[691555,142421],"./sr-latn-rs/audience-view-dialog.js":[39033,412679],"./sr-latn-rs/auth.js":[574088,995141],"./sr-latn-rs/autosuggest.js":[36655,995141],"./sr-latn-rs/avatar.js":[60295,995141],"./sr-latn-rs/biometric-enrollment.js":[673091,986709],"./sr-latn-rs/breakout-rooms.js":[992738,226482],"./sr-latn-rs/broadcast-scheduling.js":[551906,790898],"./sr-latn-rs/broadcast.js":[378935,806545],"./sr-latn-rs/calendar.js":[198712,607604],"./sr-latn-rs/calling.js":[470352,114316],"./sr-latn-rs/campaign-notifications.js":[529781,995141],"./sr-latn-rs/carousel-multi-card.js":[null],"./sr-latn-rs/cast.js":[515061,995141],"./sr-latn-rs/channels.js":[225266,995141],"./sr-latn-rs/chat-list.js":[648725,995141],"./sr-latn-rs/coach-report.js":[618749,683091],"./sr-latn-rs/comment-stream.js":[522438,121886],"./sr-latn-rs/communities.js":[423229,995141],"./sr-latn-rs/compose.js":[257284,995141],"./sr-latn-rs/contacts.js":[914939,995141],"./sr-latn-rs/datepicker.js":[858908,960502],"./sr-latn-rs/desktop.js":[454308,384392],"./sr-latn-rs/digital-signage.js":[null],"./sr-latn-rs/discover-surface.js":[455851,104989],"./sr-latn-rs/edu.js":[325612,881040],"./sr-latn-rs/embed.js":[331925,995141],"./sr-latn-rs/errors.js":[940941,995141],"./sr-latn-rs/esp.js":[209324,340400],"./sr-latn-rs/extensibility-ptz-extension.js":[null],"./sr-latn-rs/extensibility-room-remote.js":[null],"./sr-latn-rs/extensibility.js":[162177,995141],"./sr-latn-rs/feedback.js":[299745,162607],"./sr-latn-rs/files.js":[507003,995141],"./sr-latn-rs/framework.js":[519164,995141],"./sr-latn-rs/freemium-upgrade.js":[null],"./sr-latn-rs/funstuff.js":[48011,796413],"./sr-latn-rs/gallery.js":[16666,231306],"./sr-latn-rs/growth.js":[353741,995141],"./sr-latn-rs/guardians.js":[554184,413764],"./sr-latn-rs/health.js":[608296,981828],"./sr-latn-rs/help.js":[299737,948473],"./sr-latn-rs/hololens.js":[168366,114316],"./sr-latn-rs/host-controls.js":[681683,862213],"./sr-latn-rs/jana.js":[370810,126838],"./sr-latn-rs/lightbox.js":[319547,995141],"./sr-latn-rs/links.js":[287253,995141],"./sr-latn-rs/live-persona-card.js":[994492,995141],"./sr-latn-rs/live-persona-editor.js":[69343,93657],"./sr-latn-rs/lms-integration.js":[null],"./sr-latn-rs/meet-for-work.js":[434413,670723],"./sr-latn-rs/meeting-analytics.js":[787852,243472],"./sr-latn-rs/meeting-apis-app.js":[null],"./sr-latn-rs/meeting-bot.js":[null],"./sr-latn-rs/meeting-collaboration.js":[984397,420611],"./sr-latn-rs/meeting-flyout.js":[697453,995141],"./sr-latn-rs/meeting-meet-app.js":[91931,995141],"./sr-latn-rs/meeting-options.js":[570130,166978],"./sr-latn-rs/meeting-recap.js":[316083,877733],"./sr-latn-rs/meeting-room-console.js":[null],"./sr-latn-rs/meeting-stream-app.js":[null],"./sr-latn-rs/messaging.js":[415824,995141],"./sr-latn-rs/mobile-attach.js":[null],"./sr-latn-rs/mtma-missed-notifications.js":[432474,995141],"./sr-latn-rs/nearby.js":[629481,995141],"./sr-latn-rs/nova.js":[92408,995141],"./sr-latn-rs/people-app.js":[null],"./sr-latn-rs/people-picker.js":[719292,995141],"./sr-latn-rs/people-targeting.js":[737135,41417],"./sr-latn-rs/people.js":[168533,995141],"./sr-latn-rs/person.js":[668875,995141],"./sr-latn-rs/phonelink-sms.js":[173588,68696],"./sr-latn-rs/pre-core.js":[null],"./sr-latn-rs/premium-benefits.js":[981638,194430],"./sr-latn-rs/presence.js":[142535,995141],"./sr-latn-rs/queues.js":[854822,783166],"./sr-latn-rs/recurrence.js":[191128,513844],"./sr-latn-rs/rsc-application-permissions.js":[null],"./sr-latn-rs/search.js":[892030,960502],"./sr-latn-rs/semantic-object.js":[511812,896936],"./sr-latn-rs/settings.js":[183187,995141],"./sr-latn-rs/share-in-meetings.js":[null],"./sr-latn-rs/share-to-teams-outlook-addin.js":[null],"./sr-latn-rs/share-to-teams-third-party.js":[null],"./sr-latn-rs/share-to-teams.js":[683370,697738],"./sr-latn-rs/shortcut.js":[850052,995141],"./sr-latn-rs/shortcuts.js":[632203,995141],"./sr-latn-rs/simple-collab.js":[218380,995141],"./sr-latn-rs/smart-device.js":[null],"./sr-latn-rs/survey.js":[699648,373980],"./sr-latn-rs/sv-flyout.js":[989015,995141],"./sr-latn-rs/teams-and-channels.js":[552679,863809],"./sr-latn-rs/teams-insider.js":[172385,995141],"./sr-latn-rs/telemetry.js":[984331,995141],"./sr-latn-rs/tfl-homepage.js":[712187,995141],"./sr-latn-rs/tfl-onboarding.js":[989946,995141],"./sr-latn-rs/toast-notifications.js":[886182,995141],"./sr-latn-rs/trusted-ui.js":[null],"./sr-latn-rs/unified-search.js":[552127,697738],"./sr-latn-rs/unsupported-browser.js":[null],"./sr-latn-rs/url-preview.js":[107988,995141],"./sr-latn-rs/video-capture.js":[814748,534176],"./sr-latn-rs/video-message.js":[577369,37191],"./sr-latn-rs/virtual-consumer-events.js":[962040,365886],"./sr-latn-rs/virtual-events.js":[557197,542642],"./sr-latn-rs/webinar.js":[742518,164174],"./sr-latn-rs/welcome-bot.js":[null],"./sr-latn-rs/whats-new.js":[90652,995141],"./sr-latn-rs/wiki.js":[null],"./sv-se/activity.js":[994732,734920],"./sv-se/artifacts-platform.js":[718404,204536],"./sv-se/audience-view-dialog.js":[699546,478318],"./sv-se/auth.js":[847055,734920],"./sv-se/autosuggest.js":[451582,734920],"./sv-se/avatar.js":[637456,734920],"./sv-se/biometric-enrollment.js":[739156,891192],"./sv-se/breakout-rooms.js":[907073,757],"./sv-se/broadcast-scheduling.js":[160433,905909],"./sv-se/broadcast.js":[876462,829772],"./sv-se/calendar.js":[385779,223963],"./sv-se/calling.js":[759325,490227],"./sv-se/campaign-notifications.js":[191274,734920],"./sv-se/carousel-multi-card.js":[null],"./sv-se/cast.js":[188746,734920],"./sv-se/channels.js":[634973,734920],"./sv-se/chat-list.js":[565040,734920],"./sv-se/coach-report.js":[553990,415746],"./sv-se/comment-stream.js":[43561,376105],"./sv-se/communities.js":[564052,734920],"./sv-se/compose.js":[500045,734920],"./sv-se/contacts.js":[236552,734920],"./sv-se/datepicker.js":[43755,764257],"./sv-se/desktop.js":[307733,69927],"./sv-se/digital-signage.js":[null],"./sv-se/discover-surface.js":[830272,490464],"./sv-se/edu.js":[529149,580303],"./sv-se/embed.js":[988028,734920],"./sv-se/errors.js":[864014,734920],"./sv-se/esp.js":[279945,66415],"./sv-se/extensibility-ptz-extension.js":[null],"./sv-se/extensibility-room-remote.js":[null],"./sv-se/extensibility.js":[592616,734920],"./sv-se/feedback.js":[191738,675478],"./sv-se/files.js":[205694,734920],"./sv-se/framework.js":[854241,734920],"./sv-se/freemium-upgrade.js":[null],"./sv-se/funstuff.js":[383380,440320],"./sv-se/gallery.js":[405187,382445],"./sv-se/growth.js":[612714,734920],"./sv-se/guardians.js":[485457,851659],"./sv-se/health.js":[432407,299019],"./sv-se/help.js":[724958,337492],"./sv-se/hololens.js":[379205,490227],"./sv-se/host-controls.js":[441878,296072],"./sv-se/jana.js":[130509,123297],"./sv-se/lightbox.js":[142704,734920],"./sv-se/links.js":[431024,734920],"./sv-se/live-persona-card.js":[833037,734920],"./sv-se/live-persona-editor.js":[114262,685812],"./sv-se/lms-integration.js":[null],"./sv-se/meet-for-work.js":[975404,755154],"./sv-se/meeting-analytics.js":[219393,204111],"./sv-se/meeting-apis-app.js":[null],"./sv-se/meeting-bot.js":[null],"./sv-se/meeting-collaboration.js":[419688,958866],"./sv-se/meeting-flyout.js":[201538,734920],"./sv-se/meeting-meet-app.js":[759264,734920],"./sv-se/meeting-options.js":[929255,632357],"./sv-se/meeting-recap.js":[328210,816360],"./sv-se/meeting-room-console.js":[null],"./sv-se/meeting-stream-app.js":[null],"./sv-se/messaging.js":[175717,734920],"./sv-se/mobile-attach.js":[null],"./sv-se/mtma-missed-notifications.js":[78035,734920],"./sv-se/nearby.js":[605546,734920],"./sv-se/nova.js":[813491,734920],"./sv-se/people-app.js":[null],"./sv-se/people-picker.js":[170713,734920],"./sv-se/people-targeting.js":[191208,72388],"./sv-se/people.js":[562098,734920],"./sv-se/person.js":[120252,734920],"./sv-se/phonelink-sms.js":[974901,705111],"./sv-se/pre-core.js":[null],"./sv-se/premium-benefits.js":[341950,644169],"./sv-se/presence.js":[370284,734920],"./sv-se/queues.js":[885789,203465],"./sv-se/recurrence.js":[45999,649819],"./sv-se/rsc-application-permissions.js":[null],"./sv-se/search.js":[6733,764257],"./sv-se/semantic-object.js":[13637,21127],"./sv-se/settings.js":[954212,734920],"./sv-se/share-in-meetings.js":[null],"./sv-se/share-to-teams-outlook-addin.js":[null],"./sv-se/share-to-teams-third-party.js":[null],"./sv-se/share-to-teams.js":[660489,730797],"./sv-se/shortcut.js":[454219,734920],"./sv-se/shortcuts.js":[377982,734920],"./sv-se/simple-collab.js":[738721,734920],"./sv-se/smart-device.js":[null],"./sv-se/survey.js":[824875,398243],"./sv-se/sv-flyout.js":[994698,734920],"./sv-se/teams-and-channels.js":[736444,461788],"./sv-se/teams-insider.js":[923924,734920],"./sv-se/telemetry.js":[60538,734920],"./sv-se/tfl-homepage.js":[424468,734920],"./sv-se/tfl-onboarding.js":[941889,734920],"./sv-se/toast-notifications.js":[108043,734920],"./sv-se/trusted-ui.js":[null],"./sv-se/unified-search.js":[590212,730797],"./sv-se/unsupported-browser.js":[null],"./sv-se/url-preview.js":[642305,734920],"./sv-se/video-capture.js":[558841,472895],"./sv-se/video-message.js":[248760,762542],"./sv-se/virtual-consumer-events.js":[898133,360649],"./sv-se/virtual-events.js":[957374,235573],"./sv-se/webinar.js":[506195,207481],"./sv-se/welcome-bot.js":[null],"./sv-se/whats-new.js":[274309,734920],"./sv-se/wiki.js":[null],"./th-th/activity.js":[125133,439633],"./th-th/artifacts-platform.js":[367685,118241],"./th-th/audience-view-dialog.js":[949831,775371],"./th-th/auth.js":[673078,439633],"./th-th/autosuggest.js":[406709,439633],"./th-th/avatar.js":[505829,439633],"./th-th/biometric-enrollment.js":[976625,804897],"./th-th/breakout-rooms.js":[752248,20064],"./th-th/broadcast-scheduling.js":[338012,408864],"./th-th/broadcast.js":[550813,741829],"./th-th/calendar.js":[327906,708522],"./th-th/calling.js":[209958,797730],"./th-th/campaign-notifications.js":[250123,439633],"./th-th/carousel-multi-card.js":[null],"./th-th/cast.js":[924515,439633],"./th-th/channels.js":[738056,439633],"./th-th/chat-list.js":[52375,439633],"./th-th/coach-report.js":[895731,191311],"./th-th/comment-stream.js":[418256,825764],"./th-th/communities.js":[533799,439633],"./th-th/compose.js":[694814,439633],"./th-th/contacts.js":[238029,439633],"./th-th/datepicker.js":[254470,39772],"./th-th/desktop.js":[334618,368662],"./th-th/digital-signage.js":[null],"./th-th/discover-surface.js":[383245,935337],"./th-th/edu.js":[225742,209694],"./th-th/embed.js":[557275,439633],"./th-th/errors.js":[675839,439633],"./th-th/esp.js":[318650,644222],"./th-th/extensibility-ptz-extension.js":[null],"./th-th/extensibility-room-remote.js":[null],"./th-th/extensibility.js":[161495,439633],"./th-th/feedback.js":[336207,774355],"./th-th/files.js":[686101,439633],"./th-th/framework.js":[270558,439633],"./th-th/freemium-upgrade.js":[null],"./th-th/funstuff.js":[246549,936777],"./th-th/gallery.js":[286572,714072],"./th-th/growth.js":[205187,439633],"./th-th/guardians.js":[848290,786106],"./th-th/health.js":[598966,173114],"./th-th/help.js":[826407,512301],"./th-th/hololens.js":[235492,797730],"./th-th/host-controls.js":[717925,785],"./th-th/jana.js":[160488,398812],"./th-th/lightbox.js":[5509,439633],"./th-th/links.js":[552467,439633],"./th-th/live-persona-card.js":[435570,439633],"./th-th/live-persona-editor.js":[493133,431821],"./th-th/lms-integration.js":[null],"./th-th/meet-for-work.js":[58971,331455],"./th-th/meeting-analytics.js":[329554,833502],"./th-th/meeting-apis-app.js":[null],"./th-th/meeting-bot.js":[null],"./th-th/meeting-collaboration.js":[949091,18815],"./th-th/meeting-flyout.js":[738283,439633],"./th-th/meeting-meet-app.js":[439977,439633],"./th-th/meeting-options.js":[371812,115696],"./th-th/meeting-recap.js":[818669,779057],"./th-th/meeting-room-console.js":[null],"./th-th/meeting-stream-app.js":[null],"./th-th/messaging.js":[282390,439633],"./th-th/mobile-attach.js":[null],"./th-th/mtma-missed-notifications.js":[187912,439633],"./th-th/nearby.js":[899459,439633],"./th-th/nova.js":[964426,439633],"./th-th/people-app.js":[null],"./th-th/people-picker.js":[411078,439633],"./th-th/people-targeting.js":[22041,575997],"./th-th/people.js":[248815,439633],"./th-th/person.js":[51033,439633],"./th-th/phonelink-sms.js":[292878,187430],"./th-th/pre-core.js":[null],"./th-th/premium-benefits.js":[40792,108228],"./th-th/presence.js":[567357,439633],"./th-th/queues.js":[504528,169476],"./th-th/recurrence.js":[534710,148778],"./th-th/rsc-application-permissions.js":[null],"./th-th/search.js":[101232,39772],"./th-th/semantic-object.js":[94714,862390],"./th-th/settings.js":[544137,439633],"./th-th/share-in-meetings.js":[null],"./th-th/share-to-teams-outlook-addin.js":[null],"./th-th/share-to-teams-third-party.js":[null],"./th-th/share-to-teams.js":[180560,96600],"./th-th/shortcut.js":[238786,439633],"./th-th/shortcuts.js":[491969,439633],"./th-th/simple-collab.js":[456070,439633],"./th-th/smart-device.js":[null],"./th-th/survey.js":[23914,473714],"./th-th/sv-flyout.js":[378049,439633],"./th-th/teams-and-channels.js":[720701,226293],"./th-th/teams-insider.js":[365627,439633],"./th-th/telemetry.js":[629289,439633],"./th-th/tfl-homepage.js":[568509,439633],"./th-th/tfl-onboarding.js":[185904,439633],"./th-th/toast-notifications.js":[190196,439633],"./th-th/trusted-ui.js":[null],"./th-th/unified-search.js":[63249,96600],"./th-th/unsupported-browser.js":[null],"./th-th/url-preview.js":[276454,439633],"./th-th/video-capture.js":[118710,291950],"./th-th/video-message.js":[592615,59595],"./th-th/virtual-consumer-events.js":[267098,341060],"./th-th/virtual-events.js":[470303,254880],"./th-th/webinar.js":[242168,423060],"./th-th/welcome-bot.js":[null],"./th-th/whats-new.js":[637094,439633],"./th-th/wiki.js":[null],"./tr-tr/activity.js":[651021,998917],"./tr-tr/artifacts-platform.js":[607749,291157],"./tr-tr/audience-view-dialog.js":[273287,375783],"./tr-tr/auth.js":[671350,998917],"./tr-tr/autosuggest.js":[175778,998917],"./tr-tr/avatar.js":[736741,998917],"./tr-tr/biometric-enrollment.js":[786545,977813],"./tr-tr/breakout-rooms.js":[384184,52384],"./tr-tr/broadcast-scheduling.js":[432860,441184],"./tr-tr/broadcast.js":[534621,842457],"./tr-tr/calendar.js":[790882,676202],"./tr-tr/calling.js":[960422,385666],"./tr-tr/campaign-notifications.js":[790539,998917],"./tr-tr/carousel-multi-card.js":[null],"./tr-tr/cast.js":[222883,998917],"./tr-tr/channels.js":[494088,998917],"./tr-tr/chat-list.js":[73175,998917],"./tr-tr/coach-report.js":[38579,690747],"./tr-tr/comment-stream.js":[609872,607652],"./tr-tr/communities.js":[393575,998917],"./tr-tr/compose.js":[883678,998917],"./tr-tr/contacts.js":[432461,998917],"./tr-tr/datepicker.js":[859289,441500],"./tr-tr/desktop.js":[355802,648598],"./tr-tr/digital-signage.js":[null],"./tr-tr/discover-surface.js":[170637,209469],"./tr-tr/edu.js":[471822,897566],"./tr-tr/embed.js":[337307,998917],"./tr-tr/errors.js":[88127,998917],"./tr-tr/esp.js":[961850,848446],"./tr-tr/extensibility-ptz-extension.js":[null],"./tr-tr/extensibility-room-remote.js":[null],"./tr-tr/extensibility.js":[24215,998917],"./tr-tr/feedback.js":[825871,585231],"./tr-tr/files.js":[416213,998917],"./tr-tr/framework.js":[105822,998917],"./tr-tr/freemium-upgrade.js":[null],"./tr-tr/funstuff.js":[940053,324637],"./tr-tr/gallery.js":[428780,707960],"./tr-tr/growth.js":[72643,998917],"./tr-tr/guardians.js":[599202,489594],"./tr-tr/health.js":[369846,902778],"./tr-tr/help.js":[439719,729953],"./tr-tr/hololens.js":[221732,385666],"./tr-tr/host-controls.js":[782437,560069],"./tr-tr/jana.js":[178536,284188],"./tr-tr/lightbox.js":[492485,998917],"./tr-tr/links.js":[49875,998917],"./tr-tr/live-persona-card.js":[963250,998917],"./tr-tr/live-persona-editor.js":[385997,26689],"./tr-tr/lms-integration.js":[null],"./tr-tr/meet-for-work.js":[145755,349803],"./tr-tr/meeting-analytics.js":[923794,37726],"./tr-tr/meeting-apis-app.js":[null],"./tr-tr/meeting-bot.js":[null],"./tr-tr/meeting-collaboration.js":[713763,10987],"./tr-tr/meeting-flyout.js":[705131,998917],"./tr-tr/meeting-meet-app.js":[82281,998917],"./tr-tr/meeting-options.js":[443172,412208],"./tr-tr/meeting-recap.js":[221933,537829],"./tr-tr/meeting-room-console.js":[null],"./tr-tr/meeting-stream-app.js":[null],"./tr-tr/messaging.js":[968918,998917],"./tr-tr/mobile-attach.js":[null],"./tr-tr/mtma-missed-notifications.js":[112200,998917],"./tr-tr/nearby.js":[609987,998917],"./tr-tr/nova.js":[275018,998917],"./tr-tr/people-app.js":[null],"./tr-tr/people-picker.js":[887366,998917],"./tr-tr/people-targeting.js":[975833,758321],"./tr-tr/people.js":[299823,998917],"./tr-tr/person.js":[775961,998917],"./tr-tr/phonelink-sms.js":[429518,458214],"./tr-tr/pre-core.js":[null],"./tr-tr/premium-benefits.js":[630680,432644],"./tr-tr/presence.js":[728445,998917],"./tr-tr/queues.js":[503440,435012],"./tr-tr/recurrence.js":[278454,116458],"./tr-tr/rsc-application-permissions.js":[null],"./tr-tr/search.js":[115888,441500],"./tr-tr/semantic-object.js":[675962,977014],"./tr-tr/settings.js":[191049,998917],"./tr-tr/share-in-meetings.js":[null],"./tr-tr/share-to-teams-outlook-addin.js":[null],"./tr-tr/share-to-teams-third-party.js":[null],"./tr-tr/share-to-teams.js":[357392,90488],"./tr-tr/shortcut.js":[655490,998917],"./tr-tr/shortcuts.js":[751873,998917],"./tr-tr/simple-collab.js":[326534,998917],"./tr-tr/smart-device.js":[null],"./tr-tr/survey.js":[440874,531410],"./tr-tr/sv-flyout.js":[56641,998917],"./tr-tr/teams-and-channels.js":[727933,690249],"./tr-tr/teams-insider.js":[19451,998917],"./tr-tr/telemetry.js":[382889,998917],"./tr-tr/tfl-homepage.js":[875453,998917],"./tr-tr/tfl-onboarding.js":[59184,998917],"./tr-tr/toast-notifications.js":[133364,998917],"./tr-tr/trusted-ui.js":[null],"./tr-tr/unified-search.js":[522641,90488],"./tr-tr/unsupported-browser.js":[null],"./tr-tr/url-preview.js":[397862,998917],"./tr-tr/video-capture.js":[257462,967534],"./tr-tr/video-message.js":[177319,660007],"./tr-tr/virtual-consumer-events.js":[455386,149124],"./tr-tr/virtual-events.js":[885727,287200],"./tr-tr/webinar.js":[855800,218836],"./tr-tr/welcome-bot.js":[null],"./tr-tr/whats-new.js":[8422,998917],"./tr-tr/wiki.js":[null],"./uk-ua/activity.js":[842739,545079],"./uk-ua/artifacts-platform.js":[774807,825031],"./uk-ua/audience-view-dialog.js":[609669,526109],"./uk-ua/auth.js":[330980,545079],"./uk-ua/autosuggest.js":[364227,545079],"./uk-ua/avatar.js":[852851,545079],"./uk-ua/biometric-enrollment.js":[914047,511687],"./uk-ua/breakout-rooms.js":[84286,738074],"./uk-ua/broadcast-scheduling.js":[725518,126874],"./uk-ua/broadcast.js":[51779,196715],"./uk-ua/calendar.js":[650836,284152],"./uk-ua/calling.js":[71508,468608],"./uk-ua/campaign-notifications.js":[576265,545079],"./uk-ua/carousel-multi-card.js":[null],"./uk-ua/cast.js":[314937,545079],"./uk-ua/channels.js":[170478,545079],"./uk-ua/chat-list.js":[72137,545079],"./uk-ua/coach-report.js":[432609,631137],"./uk-ua/comment-stream.js":[472834,936446],"./uk-ua/communities.js":[513785,545079],"./uk-ua/compose.js":[850088,545079],"./uk-ua/contacts.js":[230295,545079],"./uk-ua/datepicker.js":[790488,239494],"./uk-ua/desktop.js":[880968,422484],"./uk-ua/digital-signage.js":[null],"./uk-ua/discover-surface.js":[262055,293823],"./uk-ua/edu.js":[749048,288076],"./uk-ua/embed.js":[391737,545079],"./uk-ua/errors.js":[411657,545079],"./uk-ua/esp.js":[522024,774188],"./uk-ua/extensibility-ptz-extension.js":[null],"./uk-ua/extensibility-room-remote.js":[null],"./uk-ua/extensibility.js":[551749,545079],"./uk-ua/feedback.js":[419293,562549],"./uk-ua/files.js":[388295,545079],"./uk-ua/framework.js":[836168,545079],"./uk-ua/freemium-upgrade.js":[null],"./uk-ua/funstuff.js":[447215,951519],"./uk-ua/gallery.js":[942798,883458],"./uk-ua/growth.js":[270681,545079],"./uk-ua/guardians.js":[834108,20360],"./uk-ua/health.js":[946764,467720],"./uk-ua/help.js":[305893,428771],"./uk-ua/hololens.js":[4058,468608],"./uk-ua/host-controls.js":[767527,106231],"./uk-ua/jana.js":[100142,82182],"./uk-ua/lightbox.js":[658759,545079],"./uk-ua/links.js":[378521,545079],"./uk-ua/live-persona-card.js":[874408,545079],"./uk-ua/live-persona-editor.js":[718995,407171],"./uk-ua/lms-integration.js":[null],"./uk-ua/meet-for-work.js":[750929,903825],"./uk-ua/meeting-analytics.js":[610176,911884],"./uk-ua/meeting-apis-app.js":[null],"./uk-ua/meeting-bot.js":[null],"./uk-ua/meeting-collaboration.js":[434929,565009],"./uk-ua/meeting-flyout.js":[920057,545079],"./uk-ua/meeting-meet-app.js":[180791,545079],"./uk-ua/meeting-options.js":[913710,110186],"./uk-ua/meeting-recap.js":[432311,626519],"./uk-ua/meeting-room-console.js":[null],"./uk-ua/meeting-stream-app.js":[null],"./uk-ua/messaging.js":[446780,545079],"./uk-ua/mobile-attach.js":[null],"./uk-ua/mtma-missed-notifications.js":[601766,545079],"./uk-ua/nearby.js":[49157,545079],"./uk-ua/nova.js":[494492,545079],"./uk-ua/people-app.js":[null],"./uk-ua/people-picker.js":[519888,545079],"./uk-ua/people-targeting.js":[112227,76851],"./uk-ua/people.js":[692881,545079],"./uk-ua/person.js":[390095,545079],"./uk-ua/phonelink-sms.js":[922832,242852],"./uk-ua/pre-core.js":[null],"./uk-ua/premium-benefits.js":[897762,795614],"./uk-ua/presence.js":[25504,545079],"./uk-ua/queues.js":[64002,737630],"./uk-ua/recurrence.js":[531948,301112],"./uk-ua/rsc-application-permissions.js":[null],"./uk-ua/search.js":[224738,239494],"./uk-ua/semantic-object.js":[883992,339508],"./uk-ua/settings.js":[139943,545079],"./uk-ua/share-in-meetings.js":[null],"./uk-ua/share-to-teams-outlook-addin.js":[null],"./uk-ua/share-to-teams-third-party.js":[null],"./uk-ua/share-to-teams.js":[271414,689282],"./uk-ua/shortcut.js":[913712,545079],"./uk-ua/shortcuts.js":[479855,545079],"./uk-ua/simple-collab.js":[12504,545079],"./uk-ua/smart-device.js":[null],"./uk-ua/survey.js":[650676,760144],"./uk-ua/sv-flyout.js":[461571,545079],"./uk-ua/teams-and-channels.js":[629899,931483],"./uk-ua/teams-insider.js":[665469,545079],"./uk-ua/telemetry.js":[745911,545079],"./uk-ua/tfl-homepage.js":[306543,545079],"./uk-ua/tfl-onboarding.js":[75622,545079],"./uk-ua/toast-notifications.js":[728466,545079],"./uk-ua/trusted-ui.js":[null],"./uk-ua/unified-search.js":[143235,689282],"./uk-ua/unsupported-browser.js":[null],"./uk-ua/url-preview.js":[715728,545079],"./uk-ua/video-capture.js":[231216,191388],"./uk-ua/video-message.js":[777125,810333],"./uk-ua/virtual-consumer-events.js":[900444,28446],"./uk-ua/virtual-events.js":[248969,456538],"./uk-ua/webinar.js":[782034,726510],"./uk-ua/welcome-bot.js":[null],"./uk-ua/whats-new.js":[814592,545079],"./uk-ua/wiki.js":[null],"./vi-vn/activity.js":[18940,418460],"./vi-vn/artifacts-platform.js":[67636,454060],"./vi-vn/audience-view-dialog.js":[512842,775610],"./vi-vn/auth.js":[202143,418460],"./vi-vn/autosuggest.js":[536814,418460],"./vi-vn/avatar.js":[150912,418460],"./vi-vn/biometric-enrollment.js":[312356,624364],"./vi-vn/breakout-rooms.js":[532785,404381],"./vi-vn/broadcast-scheduling.js":[998177,793181],"./vi-vn/broadcast.js":[731198,986728],"./vi-vn/calendar.js":[448099,983507],"./vi-vn/calling.js":[197069,795243],"./vi-vn/campaign-notifications.js":[445242,418460],"./vi-vn/carousel-multi-card.js":[null],"./vi-vn/cast.js":[545690,418460],"./vi-vn/channels.js":[155853,418460],"./vi-vn/chat-list.js":[191507,418460],"./vi-vn/coach-report.js":[379158,452630],"./vi-vn/comment-stream.js":[730809,297081],"./vi-vn/communities.js":[418340,418460],"./vi-vn/compose.js":[551997,418460],"./vi-vn/contacts.js":[480184,418460],"./vi-vn/datepicker.js":[901467,681777],"./vi-vn/desktop.js":[732645,642999],"./vi-vn/digital-signage.js":[null],"./vi-vn/discover-surface.js":[595920,437556],"./vi-vn/edu.js":[44557,880735],"./vi-vn/embed.js":[303660,418460],"./vi-vn/errors.js":[453918,418460],"./vi-vn/esp.js":[135545,474303],"./vi-vn/extensibility-ptz-extension.js":[null],"./vi-vn/extensibility-room-remote.js":[null],"./vi-vn/extensibility.js":[18424,418460],"./vi-vn/feedback.js":[300682,86946],"./vi-vn/files.js":[853902,418460],"./vi-vn/framework.js":[504625,418460],"./vi-vn/freemium-upgrade.js":[null],"./vi-vn/funstuff.js":[514148,129428],"./vi-vn/gallery.js":[492851,787413],"./vi-vn/growth.js":[117850,418460],"./vi-vn/guardians.js":[213857,305443],"./vi-vn/health.js":[526087,283555],"./vi-vn/help.js":[467598,483952],"./vi-vn/hololens.js":[530485,795243],"./vi-vn/host-controls.js":[798758,979612],"./vi-vn/jana.js":[104989,524465],"./vi-vn/lightbox.js":[136704,418460],"./vi-vn/links.js":[150400,418460],"./vi-vn/live-persona-card.js":[403229,418460],"./vi-vn/live-persona-editor.js":[671942,394704],"./vi-vn/lms-integration.js":[null],"./vi-vn/meet-for-work.js":[422300,737862],"./vi-vn/meeting-analytics.js":[753265,20895],"./vi-vn/meeting-apis-app.js":[null],"./vi-vn/meeting-bot.js":[null],"./vi-vn/meeting-collaboration.js":[317816,836742],"./vi-vn/meeting-flyout.js":[880274,418460],"./vi-vn/meeting-meet-app.js":[503216,418460],"./vi-vn/meeting-options.js":[171287,665325],"./vi-vn/meeting-recap.js":[787426,905788],"./vi-vn/meeting-room-console.js":[null],"./vi-vn/meeting-stream-app.js":[null],"./vi-vn/messaging.js":[45653,418460],"./vi-vn/mobile-attach.js":[null],"./vi-vn/mtma-missed-notifications.js":[323779,418460],"./vi-vn/nearby.js":[313338,418460],"./vi-vn/nova.js":[131491,418460],"./vi-vn/people-app.js":[null],"./vi-vn/people-picker.js":[233353,418460],"./vi-vn/people-targeting.js":[2200,799552],"./vi-vn/people.js":[524674,418460],"./vi-vn/person.js":[743020,418460],"./vi-vn/phonelink-sms.js":[155973,900807],"./vi-vn/pre-core.js":[null],"./vi-vn/premium-benefits.js":[304257,565145],"./vi-vn/presence.js":[553372,418460],"./vi-vn/queues.js":[653850,110041],"./vi-vn/recurrence.js":[74687,457939],"./vi-vn/rsc-application-permissions.js":[null],"./vi-vn/search.js":[323165,681777],"./vi-vn/semantic-object.js":[545941,394711],"./vi-vn/settings.js":[534132,418460],"./vi-vn/share-in-meetings.js":[null],"./vi-vn/share-to-teams-outlook-addin.js":[null],"./vi-vn/share-to-teams-third-party.js":[null],"./vi-vn/share-to-teams.js":[397753,121365],"./vi-vn/shortcut.js":[11323,418460],"./vi-vn/shortcuts.js":[321198,418460],"./vi-vn/simple-collab.js":[241873,418460],"./vi-vn/smart-device.js":[null],"./vi-vn/survey.js":[65499,980283],"./vi-vn/sv-flyout.js":[363994,418460],"./vi-vn/teams-and-channels.js":[988332,736344],"./vi-vn/teams-insider.js":[79300,418460],"./vi-vn/telemetry.js":[181226,418460],"./vi-vn/tfl-homepage.js":[168996,418460],"./vi-vn/tfl-onboarding.js":[567249,418460],"./vi-vn/toast-notifications.js":[930043,418460],"./vi-vn/trusted-ui.js":[null],"./vi-vn/unified-search.js":[821044,121365],"./vi-vn/unsupported-browser.js":[null],"./vi-vn/url-preview.js":[398833,418460],"./vi-vn/video-capture.js":[299721,614319],"./vi-vn/video-message.js":[248200,59834],"./vi-vn/virtual-consumer-events.js":[445125,281625],"./vi-vn/virtual-events.js":[922670,639197],"./vi-vn/webinar.js":[161091,297193],"./vi-vn/welcome-bot.js":[null],"./vi-vn/whats-new.js":[3381,418460],"./vi-vn/wiki.js":[null],"./zh-cn/activity.js":[911080,962360],"./zh-cn/artifacts-platform.js":[438512,617512],"./zh-cn/audience-view-dialog.js":[775486,671774],"./zh-cn/auth.js":[455267,962360],"./zh-cn/autosuggest.js":[901418,962360],"./zh-cn/avatar.js":[860308,962360],"./zh-cn/biometric-enrollment.js":[474984,787816],"./zh-cn/breakout-rooms.js":[93157,528273],"./zh-cn/broadcast-scheduling.js":[479509,433425],"./zh-cn/broadcast.js":[539698,811396],"./zh-cn/calendar.js":[619223,996935],"./zh-cn/calling.js":[571769,605071],"./zh-cn/campaign-notifications.js":[621190,962360],"./zh-cn/carousel-multi-card.js":[null],"./zh-cn/cast.js":[125526,962360],"./zh-cn/channels.js":[155601,962360],"./zh-cn/chat-list.js":[330860,962360],"./zh-cn/coach-report.js":[105570,13786],"./zh-cn/comment-stream.js":[844381,702077],"./zh-cn/communities.js":[720040,962360],"./zh-cn/compose.js":[440537,962360],"./zh-cn/contacts.js":[313052,962360],"./zh-cn/datepicker.js":[587311,200901],"./zh-cn/desktop.js":[900673,158075],"./zh-cn/digital-signage.js":[null],"./zh-cn/discover-surface.js":[809156,240480],"./zh-cn/edu.js":[322977,196563],"./zh-cn/embed.js":[266040,962360],"./zh-cn/errors.js":[295970,962360],"./zh-cn/esp.js":[99149,741555],"./zh-cn/extensibility-ptz-extension.js":[null],"./zh-cn/extensibility-room-remote.js":[null],"./zh-cn/extensibility.js":[979460,962360],"./zh-cn/feedback.js":[325022,27830],"./zh-cn/files.js":[826850,962360],"./zh-cn/framework.js":[592837,962360],"./zh-cn/freemium-upgrade.js":[null],"./zh-cn/funstuff.js":[322112,190336],"./zh-cn/gallery.js":[369279,3257],"./zh-cn/growth.js":[418318,962360],"./zh-cn/guardians.js":[991581,544119],"./zh-cn/health.js":[541475,991479],"./zh-cn/help.js":[722130,238044],"./zh-cn/hololens.js":[158697,605071],"./zh-cn/host-controls.js":[499506,523512],"./zh-cn/jana.js":[986873,559941],"./zh-cn/lightbox.js":[588660,962360],"./zh-cn/links.js":[736076,962360],"./zh-cn/live-persona-card.js":[157921,962360],"./zh-cn/live-persona-editor.js":[24226,460028],"./zh-cn/lms-integration.js":[null],"./zh-cn/meet-for-work.js":[104392,79722],"./zh-cn/meeting-analytics.js":[787469,336723],"./zh-cn/meeting-apis-app.js":[null],"./zh-cn/meeting-bot.js":[null],"./zh-cn/meeting-collaboration.js":[471684,164202],"./zh-cn/meeting-flyout.js":[918214,962360],"./zh-cn/meeting-meet-app.js":[162804,962360],"./zh-cn/meeting-options.js":[999595,558657],"./zh-cn/meeting-recap.js":[447950,826904],"./zh-cn/meeting-room-console.js":[null],"./zh-cn/meeting-stream-app.js":[null],"./zh-cn/messaging.js":[690121,962360],"./zh-cn/mobile-attach.js":[null],"./zh-cn/mtma-missed-notifications.js":[906039,962360],"./zh-cn/nearby.js":[151182,962360],"./zh-cn/nova.js":[790847,962360],"./zh-cn/people-app.js":[null],"./zh-cn/people-picker.js":[942021,962360],"./zh-cn/people-targeting.js":[754484,839436],"./zh-cn/people.js":[754246,962360],"./zh-cn/person.js":[704728,962360],"./zh-cn/phonelink-sms.js":[34217,144555],"./zh-cn/pre-core.js":[null],"./zh-cn/premium-benefits.js":[277525,461085],"./zh-cn/presence.js":[408563,962360],"./zh-cn/queues.js":[370225,994205],"./zh-cn/recurrence.js":[672587,437191],"./zh-cn/rsc-application-permissions.js":[null],"./zh-cn/search.js":[299673,200901],"./zh-cn/semantic-object.js":[115137,420507],"./zh-cn/settings.js":[649424,962360],"./zh-cn/share-in-meetings.js":[null],"./zh-cn/share-to-teams-outlook-addin.js":[null],"./zh-cn/share-to-teams-third-party.js":[null],"./zh-cn/share-to-teams.js":[570653,351609],"./zh-cn/shortcut.js":[510847,962360],"./zh-cn/shortcuts.js":[176698,962360],"./zh-cn/simple-collab.js":[110549,962360],"./zh-cn/smart-device.js":[null],"./zh-cn/survey.js":[974711,570815],"./zh-cn/sv-flyout.js":[284126,962360],"./zh-cn/teams-and-channels.js":[161624,74964],"./zh-cn/teams-insider.js":[22440,962360],"./zh-cn/telemetry.js":[791982,962360],"./zh-cn/tfl-homepage.js":[65344,962360],"./zh-cn/tfl-onboarding.js":[59365,962360],"./zh-cn/toast-notifications.js":[653791,962360],"./zh-cn/trusted-ui.js":[null],"./zh-cn/unified-search.js":[710624,351609],"./zh-cn/unsupported-browser.js":[null],"./zh-cn/url-preview.js":[379973,962360],"./zh-cn/video-capture.js":[477045,423043],"./zh-cn/video-message.js":[397644,955998],"./zh-cn/virtual-consumer-events.js":[135793,177565],"./zh-cn/virtual-events.js":[910546,763089],"./zh-cn/webinar.js":[441495,284557],"./zh-cn/welcome-bot.js":[null],"./zh-cn/whats-new.js":[749393,962360],"./zh-cn/wiki.js":[null],"./zh-tw/activity.js":[867436,370120],"./zh-tw/artifacts-platform.js":[684740,103928],"./zh-tw/audience-view-dialog.js":[879642,28434],"./zh-tw/auth.js":[305103,370120],"./zh-tw/autosuggest.js":[867326,370120],"./zh-tw/avatar.js":[194576,370120],"./zh-tw/biometric-enrollment.js":[919252,274232],"./zh-tw/breakout-rooms.js":[194305,430417],"./zh-tw/broadcast-scheduling.js":[340529,335569],"./zh-tw/broadcast.js":[269870,562572],"./zh-tw/calendar.js":[258483,141035],"./zh-tw/calling.js":[555997,401379],"./zh-tw/campaign-notifications.js":[181162,370120],"./zh-tw/carousel-multi-card.js":[null],"./zh-tw/cast.js":[646794,370120],"./zh-tw/channels.js":[507677,370120],"./zh-tw/chat-list.js":[442096,370120],"./zh-tw/coach-report.js":[622086,151558],"./zh-tw/comment-stream.js":[847145,626949],"./zh-tw/communities.js":[979796,370120],"./zh-tw/compose.js":[780365,370120],"./zh-tw/contacts.js":[625608,370120],"./zh-tw/datepicker.js":[485355,216029],"./zh-tw/desktop.js":[588053,155239],"./zh-tw/digital-signage.js":[null],"./zh-tw/discover-surface.js":[879936,349152],"./zh-tw/edu.js":[800445,280047],"./zh-tw/embed.js":[751804,370120],"./zh-tw/errors.js":[937486,370120],"./zh-tw/esp.js":[551241,773455],"./zh-tw/extensibility-ptz-extension.js":[null],"./zh-tw/extensibility-room-remote.js":[null],"./zh-tw/extensibility.js":[873640,370120],"./zh-tw/feedback.js":[64442,1498],"./zh-tw/files.js":[453118,370120],"./zh-tw/framework.js":[731297,370120],"./zh-tw/freemium-upgrade.js":[null],"./zh-tw/funstuff.js":[772436,299008],"./zh-tw/gallery.js":[201859,334729],"./zh-tw/growth.js":[169834,370120],"./zh-tw/guardians.js":[362513,305691],"./zh-tw/health.js":[989527,176347],"./zh-tw/help.js":[183006,424116],"./zh-tw/hololens.js":[251909,401379],"./zh-tw/host-controls.js":[722902,414920],"./zh-tw/jana.js":[104909,58717],"./zh-tw/lightbox.js":[15408,370120],"./zh-tw/links.js":[194800,370120],"./zh-tw/live-persona-card.js":[270925,370120],"./zh-tw/live-persona-editor.js":[309974,706452],"./zh-tw/lms-integration.js":[null],"./zh-tw/meet-for-work.js":[256428,45782],"./zh-tw/meeting-analytics.js":[657281,420207],"./zh-tw/meeting-apis-app.js":[null],"./zh-tw/meeting-bot.js":[null],"./zh-tw/meeting-collaboration.js":[867560,613910],"./zh-tw/meeting-flyout.js":[5122,370120],"./zh-tw/meeting-meet-app.js":[808928,370120],"./zh-tw/meeting-options.js":[288103,449985],"./zh-tw/meeting-recap.js":[609234,193192],"./zh-tw/meeting-room-console.js":[null],"./zh-tw/meeting-stream-app.js":[null],"./zh-tw/messaging.js":[52773,370120],"./zh-tw/mobile-attach.js":[null],"./zh-tw/mtma-missed-notifications.js":[466323,370120],"./zh-tw/nearby.js":[162666,370120],"./zh-tw/nova.js":[271539,370120],"./zh-tw/people-app.js":[null],"./zh-tw/people-picker.js":[451737,370120],"./zh-tw/people-targeting.js":[724520,519972],"./zh-tw/people.js":[119218,370120],"./zh-tw/person.js":[193724,370120],"./zh-tw/phonelink-sms.js":[772277,605783],"./zh-tw/pre-core.js":[null],"./zh-tw/premium-benefits.js":[652881,437541],"./zh-tw/presence.js":[759340,370120],"./zh-tw/queues.js":[959261,454309],"./zh-tw/recurrence.js":[487599,157995],"./zh-tw/rsc-application-permissions.js":[null],"./zh-tw/search.js":[80205,216029],"./zh-tw/semantic-object.js":[372485,892551],"./zh-tw/settings.js":[826916,370120],"./zh-tw/share-in-meetings.js":[null],"./zh-tw/share-to-teams-outlook-addin.js":[null],"./zh-tw/share-to-teams-third-party.js":[null],"./zh-tw/share-to-teams.js":[947721,683081],"./zh-tw/shortcut.js":[326923,370120],"./zh-tw/shortcuts.js":[771390,370120],"./zh-tw/simple-collab.js":[19745,370120],"./zh-tw/smart-device.js":[null],"./zh-tw/survey.js":[898347,842707],"./zh-tw/sv-flyout.js":[871754,370120],"./zh-tw/teams-and-channels.js":[186428,282716],"./zh-tw/teams-insider.js":[204948,370120],"./zh-tw/telemetry.js":[453946,370120],"./zh-tw/tfl-homepage.js":[492564,370120],"./zh-tw/tfl-onboarding.js":[745473,370120],"./zh-tw/toast-notifications.js":[820107,370120],"./zh-tw/trusted-ui.js":[null],"./zh-tw/unified-search.js":[393796,683081],"./zh-tw/unsupported-browser.js":[null],"./zh-tw/url-preview.js":[58049,370120],"./zh-tw/video-capture.js":[839865,533599],"./zh-tw/video-message.js":[46136,312658],"./zh-tw/virtual-consumer-events.js":[556309,154021],"./zh-tw/virtual-events.js":[22225,665233],"./zh-tw/webinar.js":[302867,916373],"./zh-tw/welcome-bot.js":[null],"./zh-tw/whats-new.js":[151365,370120],"./zh-tw/wiki.js":[null]};function a(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n(a)))}a.keys=()=>Object.keys(i),a.id=755309,e.exports=a},241219:e=>{"use strict";e.exports=JSON.parse('{"clientId":"4b3e8f46-56d3-427f-b1e2-d239b2ea6bca","basePath":"v2","experienceName":"react-web-client","fallbackLocale":"en-us","webAuth":{"cacheLocation":"localStorage","navigateToLoginRequestUrl":true,"top":{"popUp":false},"iframe":{"redirectPath":"auth"}},"ring":{"id":"ring0"},"cdnVersion":4,"enableDevTools":false,"useReactWebClientCoreTasks":true,"windowType":"ReactWebClient","lpcRegion":"","isLPCEnabled":true,"shouldExecuteDefaultCommand":true,"partitionCacheByExperience":true,"forceUseBrowserHistory":true,"coreTasksTimeoutMs":300000,"supportsAsyncUserContext":true,"postMessageConfig":[],"enableSupermassive":false,"enableRelay":true,"useDiagnosticsServiceV2":true}')}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/async-entry-244a09efc491d125.js.map