"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[760418],{645015:(e,n,a)=>{a.d(n,{q:()=>t});const t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsFileActionsChannelQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}}]}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}},{kind:"Field",name:{kind:"Name",value:"memberRole"}}]}}]}}]}},625631:(e,n,a)=>{a.d(n,{cj:()=>r,vj:()=>l,Cd:()=>d,zB:()=>s,VH:()=>c,XC:()=>p,Tu:()=>m});var t=a(712839),i=a(420645),o=a(363678);const r=e=>"com.microsoft.teams.callable-channel"===e||"com.microsoft.teamspace.tab.file.staticviewer.pdf"===e||"44263ed4-f1ac-4e96-93aa-d24dd50459ea"===e||"com.microsoft.teamspace.tab.web"===e,l=(e,n,a)=>{if(a){const{correlationId:t,installationScope:i,tabConfigurationData:o,threadId:r,teamId:l,isEduContext:d,isTmpLaunch:s}=a;switch(i){case"Team":return n.platform.inContextStorePostInstall({appId:e,teamId:l,correlationId:t,isEduContext:d,isTmpLaunch:s,tabConfigurationData:o,channelId:r,name:"openTabInstanceConfigDialogForChannel",inContextStoreLaunchOptions:a});case"GroupChat":return n.platform.inContextStorePostInstall({appId:e,correlationId:t,tabConfigurationData:o,isTmpLaunch:s,chatId:r,name:"openTabInstanceConfigDialogForChat",inContextStoreLaunchOptions:a})}}return Promise.resolve()},d=e=>"Student"===e||"Teacher"===e,s=async(e,n)=>{const{data:a}=await e.query({query:i.A,variables:{convId:n}});return a},c=e=>{let n=t.f4.na;switch(e){case o.hB.card:n=t.f4.card;break;case o.hB.deepLink:case o.hB.deepLinkStageView:n=t.f4.deepLink;break;case o.hB.stageViewOpenSDKApi:n=t.f4.stageViewOpenSDKApi;break;case o.hB.messageExtension:n=t.f4.messageExtension;break;case o.hB.chatTab:case o.hB.channelTab:case o.hB.sidePanel:case o.hB.privateMeetingSchedulingForm:case o.hB.channelMeetingSchedulingForm:case o.hB.tab:n=t.f4.platformExtensionTab;break;case o.hB.storeApp:n=t.f4.storeapp;break;case o.hB.personalApp:n=t.f4.personalApp;break;case o.hB.virtualEvent:n=t.f4.virtualEvent;break;case o.hB.shareToOutlook:n=t.f4.shareToOutlook;break;case o.hB.contentBubble:n=t.f4.contentBubble;break;case o.hB.adaptiveCardTab:case o.hB.adaptiveCardCollabStage:case o.hB.adaptiveCardStageModal:n=t.f4.adaptiveCardTab;break;case o.hB.botConfig:n=t.f4.botConfig;break;case o.hB.workflows:n=t.f4.workflows}return n},p=(e,n,a,t)=>!!a&&(!!e||n&&t),m=(e,n)=>"Private"===e&&!!n},361226:(e,n,a)=>{a.d(n,{X2:()=>t,LZ:()=>d,VL:()=>s,RK:()=>c,EY:()=>p,hB:()=>m,F9:()=>u,pP:()=>h,nn:()=>g});var t,i=a(648260),o=a(726723),r=a(702183),l=a(799366);!function(e){e.Start="Start",e.Stop="Stop",e.Cancel="Cancel",e.Fail="Fail"}(t||(t={}));const d=(e,n)=>{const{appId:a,appConfigEntryPoint:t,appEntryPoint:o,threadId:l,messageId:d,tabType:s,actionType:c,tabId:p}=n;switch(o){case i.v.Meeting:case i.v.ChannelMeeting:case i.v.PrivateMeetingSchedulingForm:case i.v.ChannelMeetingSchedulingForm:e.newScenario(r.Cu.PlatformTabsHeaderUpdate).appendEventData({"App.Id":a,"App.EntryPoint":o,"Thread.Id":l,"Message.Id":d,"PlatformApp.TabType":s,"PlatformApp.ActionType":c,"PlatformApp.TabId":p,"PlatformApp.ConfigEntryPoint":t})}},s=(e,n)=>{const a=e.findScenario(r.Cu.PlatformTabsHeaderUpdate);if(a){const e=a.eventData?.["PlatformApp.TabId"];n(e||"")&&a.stop()}},c=e=>{const n=e.findScenario(r.Cu.PlatformTabsHeaderUpdate);n?.cancel()},p=e=>n=>e.some((e=>e.tabInfo.tabId===n)),m=(e,n,a)=>{const i=r.Cu.ExtMeetingAppVisualIndicator,o=e.findScenario(r.Cu.ExtMeetingAppVisualIndicator);switch(n){case t.Start:const n=o||e.newScenario(i);o||n.appendEventData({"Bot.Id":a});break;case t.Stop:o?.stop();break;case t.Cancel:o?.cancel();break;case t.Fail:o?.fail()}};function u(e,n,a){const t=new l.I,i=e.showNotificationBadge;t.tabId=e.tabInfo.tabId,t.appId=e.appInfo.appId,t.appName=e.appInfo.appName;const r={panelType:o.HP.MeetingAppVisualIndicator,moduleName:o.Sn.meetingAppVisualIndicator,moduleType:o.nR.meetingAppVisualIndicator,actionOutcome:i?o.nd.meetingAppVisualIndicatorCreated:o.nd.dismissActionMeetingAppVisualIndicator,actionScenario:i?o.vB.meetingAppVisualIndicatorCreated:o.vB.dismissActionMeetingAppVisualIndicator,actionScenarioType:i?o.DB.meetingAppVisualIndicatorCreated:o.vB.dismissActionMeetingAppVisualIndicator,dataBag:t};return n.recordPanelAction(r,a,[o.E0.callType,o.E0.callMeetingContent]),t.dispose(),null}function h(e,n){e.findScenario(r.Cu.PlatformTabLaunch)?.cancel({errors:n}),e.findScenario(r.Cu.PlatformTabFrameLoading)?.cancel({errors:n})}function g(e,n){e.findScenario(r.Cu.PlatformTabLaunch)?.incomplete({errors:n}),e.findScenario(r.Cu.PlatformTabFrameLoading)?.incomplete({errors:n})}},240379:(e,n,a)=>{a.d(n,{H:()=>l});var t=a(884839),i=a(702183),o=a(364819);var r=a(325749);const l=async(e,n,a,l,d)=>{try{const{appId:s}=e,c=await(0,t.xR)(n,s,void 0,void 0,"launch-mw-stage-view-without-chat");e.isFullScreenApp=!!c&&(e=>{const n=!(0,o.isEmpty)(e.tenantId),a=e.isMicrosoftOwned??!1;return(e.isFullScreenApp??!1)&&(n||a)})(c),l?.appendEventData({"App.isFullScreenApp":e.isFullScreenApp,"StageView.OpenMode":"popout"}),l?.mark(i.BQ.StageViewAppDefFetched);const p=(0,r.Gi)(e,e.contentUrl);return a.platform.launchStageMWWithoutChat({id:p,stageOptions:e,commandSource:d})}catch(e){throw l?.mark(i.BQ.StageViewFailedBeforeCommandTrigger),e}}},300211:(e,n,a)=>{a.d(n,{p:()=>i});var t=a(325749);const i=async(e,n,a,i,o)=>{const{stageViewId:r,linkedEntity:l}=await(0,t.iE)(e,n,i);return r&&l?a.platform.launchStageMW({id:r,linkedEntity:l,stageOptions:e,commandSource:o}):Promise.reject("Entity commanding not available")}},300986:(e,n,a)=>{a.d(n,{N:()=>A});var t=a(625631),i=a(712839),o=a(726723),r=a(754255),l=a(131647),d=a(572909),s=a(937545),c=a(702183),p=a(363678),m=a(325749),u=a(884839),h=a(942832),g=a(420645);const I={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsStageViewUtilsInstalledSideLoadAppQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedScope"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"externalId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedSideLoadApp"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedScope"},value:{kind:"Variable",name:{kind:"Name",value:"installedScope"}}},{kind:"Argument",name:{kind:"Name",value:"externalId"},value:{kind:"Variable",name:{kind:"Name",value:"externalId"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ComponentsStageViewUtilsInstalledAppFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ComponentsStageViewUtilsInstalledAppFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"InstalledApp"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"installationState"}},{kind:"Field",name:{kind:"Name",value:"installedVersion"}},{kind:"Field",name:{kind:"Name",value:"definition"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ComponentsStageViewUtilsAppDefinitionFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ComponentsStageViewUtilsAppDefinitionFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AppDefinition"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"developerName"}},{kind:"Field",name:{kind:"Name",value:"developerUrl"}},{kind:"Field",name:{kind:"Name",value:"privacyUrl"}},{kind:"Field",name:{kind:"Name",value:"termsOfUseUrl"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"shortDescription"}},{kind:"Field",name:{kind:"Name",value:"longDescription"}},{kind:"Field",name:{kind:"Name",value:"smallImageUrl"}},{kind:"Field",name:{kind:"Name",value:"largeImageUrl"}},{kind:"Field",name:{kind:"Name",value:"accentColor"}},{kind:"Field",name:{kind:"Name",value:"categories"}},{kind:"Field",name:{kind:"Name",value:"validDomains"}},{kind:"Field",name:{kind:"Name",value:"externalId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"isBlocked"}},{kind:"Field",name:{kind:"Name",value:"isFullScreenApp"}},{kind:"Field",name:{kind:"Name",value:"isFullTrustApp"}},{kind:"Field",name:{kind:"Name",value:"isMicrosoftOwned"}},{kind:"Field",name:{kind:"Name",value:"showTabLoadingIndicator"}},{kind:"Field",name:{kind:"Name",value:"videoUrl"}},{kind:"Field",name:{kind:"Name",value:"devicePermissions"}},{kind:"Field",name:{kind:"Name",value:"defaultInstallScope"}},{kind:"Field",name:{kind:"Name",value:"manifestVersion"}},{kind:"Field",name:{kind:"Name",value:"disabledScopes"}},{kind:"Field",name:{kind:"Name",value:"galleryTabs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"configurationUrl"}},{kind:"Field",name:{kind:"Name",value:"canUpdateConfiguration"}},{kind:"Field",name:{kind:"Name",value:"canHaveTabConversation"}},{kind:"Field",name:{kind:"Name",value:"scopes"}},{kind:"Field",name:{kind:"Name",value:"meetingSurfaces"}},{kind:"Field",name:{kind:"Name",value:"context"}}]}},{kind:"Field",name:{kind:"Name",value:"staticTabs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entityId"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"order"}},{kind:"Field",name:{kind:"Name",value:"contentUrl"}},{kind:"Field",name:{kind:"Name",value:"contentBotId"}},{kind:"Field",name:{kind:"Name",value:"websiteUrl"}},{kind:"Field",name:{kind:"Name",value:"scopes"}},{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"containerAppIds"}}]}},{kind:"Field",name:{kind:"Name",value:"webApplicationInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"appKey"}},{kind:"Field",name:{kind:"Name",value:"resource"}},{kind:"Field",name:{kind:"Name",value:"applicationPermissions"}}]}}]}}]}.definitions]}.definitions]},v=async(e,n,a)=>{if(a)return"Team";if(n){const a=await(async(e,n,a)=>{const{data:t}=await n.query({query:g.A,variables:{convId:e},context:{callerInfo:a}});return t.chat?.isOneOnOneBotChat??!1})(n,e,"handleJITInstallForStageView");return a?"Personal":"GroupChat"}return"Personal"},k=async(e,n,a,t,i,o,r,l)=>{let d=!1,s=a;const p=await(0,u.xR)(t,e,n,a,"jit-install-for-stage-view",!0);if(r?.mark(c.BQ.StageViewAppDefFetched,{"App.isBlocked":p?.isBlocked||!1}),l?.mark(c.BQ.StageViewAppDefFetched,{"App.isBlocked":p?.isBlocked||!1}),p.isBlocked)return S(o,`App ${e} is blocked by tenant, can not show the app content`,r,l),{appInstalled:d,appInstallScope:s};const m=(0,u.Z1)("Personal",p);let h;if(m)s="Personal",r?.mark(c.BQ.StageViewInstallingInPersonalScope,{reason:`installing in personal scope: isPersonalScopeSupported: ${m}`}),l?.mark(c.BQ.StageViewInstallingInPersonalScope,{reason:`installing in personal scope: isPersonalScopeSupported: ${m}`}),h=await(0,u.Pe)(t,i,c.Cu.AppInstallationDialogInstallApp,e,"Personal",o,!0,void 0,{reason:`installing in personal scope: isPersonalScopeSupported: ${m}`,"App.Scope":"Personal",correlationId:l?.id}),d=!!h;else if("Personal"!==a&&(0,u.Z1)(a,p)){r?.mark(c.BQ.StageViewInstallingInChatChannelScope,{reason:`installing in scope: ${a}, conversationId: ${n}`}),l?.mark(c.BQ.StageViewInstallingInChatChannelScope,{reason:`installing in scope: ${a}, conversationId: ${n}`});try{h=await(0,u.Pe)(t,i,c.Cu.AppInstallationDialogInstallApp,e,a,o,!0,n,{reason:`installing in scope: ${a}, conversationId: ${n}`,correlationId:l?.id,"App.Scope":a},void 0,"jit-install-for-stage-view")}catch(e){throw o.error(`JIT-Install failed in scope: ${a}, conversationId: ${n} Reason: ${e?.message}`),e?.message?.contains("NoPermissionToInstallApp")&&S(o,`User does not have permissions to install app in threadId: ${n}, installScope: ${a}`,r,l),e}d=!!h,s=a}else S(o,`installScope: ${a} is not supported by app: ${e}`,r,l);return d&&(r?.mark(c.BQ.StageViewAppInstallationDone,{reason:`installed in ${s} scope, conversationId: ${n}`}),l?.mark(c.BQ.StageViewAppInstallationDone,{reason:`installed in ${s} scope, conversationId: ${n}`})),{appInstalled:d,appInstallScope:s}},S=(e,n,a,t)=>{e.warn(n),a?.incomplete({reason:n}),t?.incomplete({reason:n})},f=async(e,n,a,t,i,o,r,l)=>{const d={installedScope:t,externalId:a,conversationId:i};try{if(o){const{data:n}=await e.query({query:I,variables:d,fetchPolicy:"cache-first",context:{callerInfo:"jit-install-for-stage-view"}});return r?.mark(c.BQ.StageViewSideLoadQueryReturned),l?.mark(c.BQ.StageViewSideLoadQueryReturned),n?.installedSideLoadApp}return null}catch(e){return n.error(`Failed fetching side loading details for app ${a}, threadId: ${i}, scope, ${t}: ${e}`),null}};var y=a(300211);const T=(e,n,a,t,i)=>{const{enableReactStageModal:o}=n.get(r.w.Extensibility);return o?(i?.appendEventData({"StageView.OpenMode":"modal"}),a.platform.launchReactStageModal(e.appId,e,{visibilityState:s.Rp.show,stateTransition:s.Ar.extend,correlation:{source:t}}).toPromise()):a.platform.launchStage({stageOptions:e,entityCommand:{stateTransition:s.Ar.extend,visibilityState:s.Rp.show,correlation:{source:t}}}).toPromise()};var C=a(240379),N=a(645095);const b=e=>{let n=i.bY.personal;switch(e){case"Team":n=i.bY.team;case"GroupChat":n=i.bY.group}return n},A=async(e,n,a,t,l,d,s,p,g)=>{const{enableCommandingTelemetryForCollabStageMW:I,enableReactStageModal:S,enableProgrammaticPopoutStageViewOpenAPI:y,enableProgrammaticPopoutStageDeeplink:T}=n.get(r.w.Extensibility);let C,N,A=e;if(!I){const{phase1CollabStageScenario:e,endToEndScenario:n}=(0,m.d1)(t,A.entryPoint);C=e,N=n,A.launchScenarioId=n.id,A.phase1OnlyScenarioDetails={scenarioMarkerName:e.name,scenarioMarkerId:e.id}}if(d)try{A=await w(l,d,A,a,C,N)}catch(e){return Promise.reject(`Could not determine if threadId passed is chat/channel: ${e}`)}if(A.openMode=(0,m.mg)(n,A),C?.appendEventData({"App.Id":A.appId,"Thread.Id":A.convId,"PlatformApp.ScenarioCapability":i.n3.tabs,"App.EntryPoint":A.entryPoint,"StageView.OpenMode":A.openMode,"StageView.inputThreadIdDefined":!!d}),N?.appendEventData({"App.Id":A.appId,"Thread.Id":A.convId,"App.EntryPoint":A.entryPoint,"StageView.OpenMode":A.openMode,"StageView.inputThreadIdDefined":!!d}),!S&&A.openMode===m.bq.modal&&s)return C?.cancel({errors:"Opening angular modal hence cancelling react scenarios"}),N?.cancel({errors:"Opening angular modal hence cancelling react scenarios"}),E(A,n,a,s,void 0);const{appInstalled:F,appInstallScope:P}=await(async(e,n,a,t,i,o)=>{const{appId:r,convId:l,replyChainId:d,channelId:s}=e,p=s||d?void 0:l,m=d?s||l:s,g=m||p||"";let I="Personal";try{I=await v(n,p,m),e.appInstallScope=I,i?.mark(c.BQ.StageViewTargetInstallationScopeConfirmed,{reason:`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${m} is ${I}`}),o?.mark(c.BQ.StageViewTargetInstallationScopeConfirmed,{reason:`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${m} is ${I}`}),t.log(`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${m} is ${I}`);const l={conversation:{id:g,scope:I},shouldFetchPersonalApps:!0},d=await(0,u.tN)(n,t,a,r,!0,`jit-install-for-stage-view-${e.entryPoint}`,l);t.log(`Fetched Installed apps length: ${d.length} `);const s=d.find((e=>(0,h.e6)(e)));if(i?.mark(c.BQ.StageViewInstalledAppsFetched,{reason:`${d?.length} appEntitlements returned with preInstalledApp as ${!!s}, for ${I} scope and ${g} threadId.`}),o?.mark(c.BQ.StageViewInstalledAppsFetched,{reason:`${d?.length} appEntitlements returned with preInstalledApp as ${!!s}, for ${I} scope and ${g} threadId.`}),s)return i?.mark(c.BQ.StageViewAppIsPreInstalled),o?.mark(c.BQ.StageViewAppIsPreInstalled),{appInstalled:!0,appInstallScope:s.installedScope};{const l=await f(n,t,r,I,g,!d.length,i,o);if(l?.definition)return e.appId=l.definition.id||e.appId,e.appInstallScope=I,i?.appendEventData({"App.isSideLoaded":!!l.definition.externalId}),o?.appendEventData({"App.isSideLoaded":!!l.definition.externalId}),i?.mark(c.BQ.StageViewAppIsPreInstalled,{reason:`App ${l.definition.externalId} is sideloaded, with internalAppId ${l.definition.id}`}),o?.mark(c.BQ.StageViewAppIsPreInstalled,{reason:`App ${l.definition.externalId} is sideloaded, with internalAppId ${l.definition.id}`}),{appInstalled:!0,appInstallScope:I};i?.mark(c.BQ.StageViewAppIsNotPreInstalled,{reason:`${d?.length} appEntitlements returned for ${I} scope and ${g} threadId.`}),o?.mark(c.BQ.StageViewAppIsNotPreInstalled,{reason:`${d?.length} appEntitlements returned for ${I} scope and ${g} threadId.`});const{appInstalled:s,appInstallScope:p}=await k(r,g,I,n,a,t,i,o);return{appInstalled:s,appInstallScope:p}}}catch(e){return t.log(e?.message),i?.fail({errors:`JIT Install failed - ${e?.message}`}),o?.fail({errors:`JIT Install failed - ${e?.message}`}),{appInstalled:!1,appInstallScope:I}}})(A,a,t,l,C,N);if(p&&p.recordPanelAction(((e,n,a,t,r)=>{const{actionOutcome:l,panelType:d}=(0,m.lT)(a,t),s=r.createDatabag(),c={actionGesture:o.Od.auto,actionOutcome:l,actionScenario:o.vB.openStageView,actionScenarioType:o.DB.stageView,moduleName:o.Sn.stageViewMainContent,moduleType:o.nR.stageview,panelRegion:a===m.bq.modal?o.rP.dialog:o.rP.main,panelType:d,extensibilityData:{id:e,scope:n,scenarioCapability:i.n3.tabs}};return c.dataBag=s,c})(A.appId,b(P),A.openMode,A.entryPoint,p)),g){const e=g.createDatabag?.(),{actionOutcome:n,panelType:a}=(0,m.lT)(A.openMode,A.entryPoint),t={actionGesture:o.Od.auto,actionOutcome:n,actionScenario:o.vB.openStageView,actionScenarioType:o.DB.stageView,moduleName:o.Sn.stageViewMainContent,moduleType:o.nR.stageview,panelRegion:A.openMode===m.bq.modal?o.rP.dialog:o.rP.main,panelType:a,dataBag:e,extensibilityData:{id:A.appId,scope:b(P),scenarioCapability:i.n3.tabs}};g.recordPanelAction(t,l)}return F?(C?.appendEventData({"App.Scope":P}),N?.appendEventData({"App.Scope":P}),E(A,n,a,s,C,!!y,!!T).catch((e=>(N?.fail({errors:"Failed to launch"}),C?.fail({errors:"Failed to launch"}),Promise.reject(e))))):(C?.fail({errors:`App could not be installed- ${P}`}),N?.fail({errors:`App could not be installed- ${P}`}),R())},w=async(e,n,a,i,o,r)=>{let l={chat:null};try{l=await(0,t.zB)(i,n)}catch(a){o?.mark(c.BQ.ChatQueryFailed,{reason:`ChatQuery failed for inputThreadId: ${n}`}),r?.mark(c.BQ.ChatQueryFailed,{reason:`ChatQuery failed for inputThreadId: ${n}`}),e.error(`Could not determine if inputThreadId is chat/channel, ChatQuery failed for inputThreadId: ${n}`)}if(l?.chat){const{chatSubType:t,memberIds:i}=l.chat;switch(o?.mark(c.BQ.ChatQuerySuccessful,{reason:`chatSubType: ${t}, memberIds.length: ${i?.length}`}),r?.mark(c.BQ.ChatQuerySuccessful,{reason:`chatSubType: ${t}, memberIds.length: ${i?.length}`}),t){case N.vW.Channel:return e.log(`inputThreadId is a channel ${n}`),{...a,convId:n,channelId:n,replyChainId:void 0,messageId:void 0};case N.vW.Meeting:case N.vW.None:e.log(`inputThreadId is a chat ${n}`);const t={...a,convId:n,channelId:void 0,replyChainId:void 0,messageId:void 0};return i&&0!==i.length||a.openMode===m.bq.modal?t:{...t,openMode:m.bq.popout};default:return e.error("chatSubType is not present in chatQuery return, launching stage view in personal scope context"),{...a,convId:"",channelId:void 0,replyChainId:void 0,messageId:void 0}}}return o?.mark(c.BQ.ChatQueryReturnedEmptyData,{reason:`ChatQuery result is empty for inputThreadId: ${n}`}),r?.mark(c.BQ.ChatQueryReturnedEmptyData,{reason:`ChatQuery result is empty for inputThreadId: ${n}`}),e.error(`Could not determine if inputThreadId is chat/channel, ChatQuery result is empty for inputThreadId: ${n}`),{...a,convId:"",channelId:void 0,replyChainId:void 0,messageId:void 0}},E=async(e,n,a,t,i,o,r)=>{const l=F(e.entryPoint);switch(e.entryPoint){case p.hB.adaptiveCardCollabStage:return t?(0,y.p)(e,a,t,i,l):Promise.reject("Entity commanding not available");case p.hB.deepLinkStageView:if(!r)return O(e);switch(e.openMode){case m.bq.modal:return O(e);case m.bq.popoutWithChat:return e={...e,showChatTitleForHeader:!0},P(e,a,i);case m.bq.popout:return L(e);default:return O(e)}case p.hB.stageViewOpenSDKApi:if(!o)return t?T({...e,openMode:"modal"},n,t,l,i):Promise.reject("Entity commanding not available");switch(e.openMode){case m.bq.popout:return t?(0,C.H)(e,a,t,i,l):Promise.reject("Entity commanding not available");case m.bq.popoutWithChat:return t?(0,y.p)(e,a,t,i,l):Promise.reject("Entity commanding not available");case m.bq.modal:default:return t?T(e,n,t,l,i):Promise.reject("Entity commanding not available")}case p.hB.adaptiveCardStageModal:return t?T(e,n,t,l,i):Promise.reject("Entity commanding not available");default:return Promise.reject(`Stage view entry point not supported. Entrypoint: ${e.entryPoint}`)}},F=e=>{switch(e){case p.hB.stageViewOpenSDKApi:return l.p.StageViewOpenSDKApi;case p.hB.deepLinkStageView:return l.p.StageViewDeeplink;default:return l.p.AdaptiveCardInvokeButton}},P=async(e,n,a)=>{const{stageViewId:t,linkedEntity:i}=await(0,m.iE)(e,n,a);return t&&i?Promise.resolve({entityCommand:{entity:{id:t,type:d.ck.platformStage,action:d.SY.create,linkedEntity:i},command:{stateTransition:s.Ar.new,visibilityState:s.Rp.show,correlation:{id:e.correlationId,source:l.p.StageViewDeeplink,startTimestamp:e.scenarioStartTime}},entityOptions:e},metadata:{allowAnonymous:!1}}):Promise.reject("Entity commanding not available")},R=async()=>Promise.resolve({entityCommand:{entity:{type:d.ck.unsupportedcollabstageerrordialog,action:d.SY.view},command:{stateTransition:s.Ar.extend,visibilityState:s.Rp.show},entityOptions:{}},metadata:{allowAnonymous:!1}}),L=async e=>{const n=(0,m.Gi)(e,e.contentUrl);return n?Promise.resolve({entityCommand:{entity:{id:n,type:d.ck.platformstagewithoutchat,action:d.SY.view},command:{stateTransition:s.Ar.new,visibilityState:s.Rp.show,correlation:{id:e.correlationId,source:l.p.StageViewDeeplink,startTimestamp:e.scenarioStartTime}},entityOptions:e},metadata:{allowAnonymous:!1}}):Promise.reject("Entity commanding not available")},O=async e=>Promise.resolve({entityCommand:{entity:{id:e.appId,type:d.ck.platformstagemodal,action:d.SY.view},command:{visibilityState:s.Rp.show,stateTransition:s.Ar.extend,correlation:{id:e.correlationId,source:l.p.StageViewDeeplink}},entityOptions:e},metadata:{allowAnonymous:!1}})},778368:(e,n,a)=>{a.d(n,{Ze:()=>t,I_:()=>P,h5:()=>L});var t,i=a(513432),o=a(899273),r=a(902376),l=a(754255),d=a(851075),s=a(572909),c=a(129123),p=a(139150),m=a(884839),u=a(516997),h=a(661861),g=a(695116),I=a(514072),v=a(789403),k=a(895543),S=a(414250),f=a(835647),y=a(59552),T=a(192451),C=a(985290),N=a(783650),b=a(238105),A=a(702183),w=a(645015),E=a(49180),F=a(562292);!function(e){e.PlatformApp="PlatformApp",e.OneUp="OneUp",e.OneUpPageEmbed="OneUpPageEmbed"}(t||(t={}));const P=()=>{const{entityCommanding:e,scenarioFactory:n,windowHistoryNavigationService:a}=(0,o.ur)(),{entity:t,getEntityOptions:s}=(0,r.At)(),m=(0,p.m)(),{enableAppBasedFileHandlingForWXPTMP:u,enableFilesAppBasedFileHandlingForPDFTMP:h,enableFilesPDFAppIdForViewTMP:g,enableFilesAdminPreinstallCheckForPDFAppTMP:I,enableFilesAAACheckForPDFAppTMP:v,allowedInstallerAzureADAppIdsForPDFApp:k,enableAppBasedFileHandlingForOneNoteTMP:S,enableAppBasedFileHandlingForVisioTMP:f}=(0,c.w2)(l.w.Files,["enableAppBasedFileHandlingForWXPTMP","enableFilesAppBasedFileHandlingForPDFTMP","enableFilesPDFAppIdForViewTMP","enableFilesAdminPreinstallCheckForPDFAppTMP","enableFilesAAACheckForPDFAppTMP","allowedInstallerAzureADAppIdsForPDFApp","enableAppBasedFileHandlingForOneNoteTMP","enableAppBasedFileHandlingForVisioTMP"]),{enableAppsQueryOptimization:y,enablePopOutFileChicletInMultiWindow:T,enableInstalledAppQueryOptimization:C}=(0,c.w2)(l.w.Extensibility,["enableAppsQueryOptimization","enablePopOutFileChicletInMultiWindow","enableInstalledAppQueryOptimization"]),{isPrimaryWindow:N}=(0,c.w2)(l.w.Core,["isPrimaryWindow"]),b=(0,d.U)("InTeamsFileViewerResolver"),A=i.useRef(new Map);return i.useCallback((async(i,o,r,l)=>{R(B(i,!!T,!!N),o,r,l,e,t,a,s,m,!!u,!!h,!!v,g,k,!!I,!!S,!!f,!!y,!!C,b,n,A)}),[e,t,a,s,m,u,h,v,g,k,I,S,f,y,C,T,b,n,N])},R=async(e,n,a,t,i,o,r,l,d,c,p,m,h,g,I,v,k,S,f,y,T,C)=>{const N=T.newScenario(A.Cu.FileViewerResolver);try{const b=(0,u.sI)(e.fileType),w=await _(e,d,y),P=C.current;e={...e,tenantId:w?.channelByID.owningTeam?.tenantId||void 0};const R=await L(d,e.fileType,c,p,m,h,g,I,v,k,S,f,y,T);if(e.subEntityId){const n=l(s.ck.extensions,s.SY.view);r.pushToWindowHistory(o,{...n,subEntityId:e.subEntityId})}if(R)return N.mark(A.BQ.FileViewerResolverRoutingToInstalledApp),t(n,{...a,dataBagProperties:{...a.dataBagProperties,fileViewerType:"PlatformApp",fileViewerAppId:R,fileAction:E.BK.editInTeams},actionKey:"edit_in_teams"}),P.get(e.fileId)!==e.threadId&&(0,F.RL)(T,R,"personalApp",y,e.shouldOpenInMultiWindow,!0),P.set(e.fileId,e?.threadId),i.file.launchFileViewApp(R,{...e,baseUrl:e.siteUrl}),void N.stop();b===u.j_.OneUpViewer?(N.mark(A.BQ.FileViewerResolverRoutingToOneupViewer),t(n,{...a,dataBagProperties:{...a.dataBagProperties,fileViewerType:"OneUp",fileAction:E.BK.openInTeams},actionKey:"edit_in_teams"}),i.file.openInOneup(e)):(y.errorToTelemetry?.("This means no platform app installed for a office file type. Not good","files_viewer_resolver"),N.mark(A.BQ.FileViewerResolverFallback),t(n,{...a,actionKey:"edit_in_teams"}),i.file.fileById(e)),N.stop()}catch(e){const n=`Unexpected error while file viewer resolution with error code: ${e?.errorCode}`;y.errorToTelemetry?.(n,"files_viewer_resolver"),N.fail({errorCode:e?.errorCode,message:n,reason:"Unexpected error while file viewer resolution"})}},L=async(e,n,a,t,i,o,r,l,d,s,c,p,u,h)=>{const g=await O(e,n,a,t,i,o,r,l,d,s,c,p,u,h);if(g){const n=await(0,m.tN)(e,u,h,g,c,"file-viewer-route-to-platform-app",{shouldFetchPersonalApps:!0,enableInstalledAppQueryOptimization:p});if(n&&n.length>0&&(u.logNoPii?.(`getDocumentViewAppId: Pre-install check enabled: app pre-install state ${n[0].installationState}`),M(n[0])))return g}},O=async(e,n,a,t,i,o,r,l,d,s,c,p,m,A)=>{const{icon:w}=(0,u.ao)(n);switch(w){case h.f:case g.K:if(a)return"3e0a4fec-499b-4138-8e7c-71a9d88a62ed";break;case I.E:case v.j:if(a)return"d7958adf-f419-46fa-941b-1b946497ef84";break;case k.V:case S.g:if(a)return"1c256a65-83a6-4b5c-9ccf-78f8afb6f1e8";break;case f.P:if(t)return D(o,l,i,r,e,c,p,m,A);break;case y.y:case T.T:case C.v:if(d)return"0d820ecd-def2-4297-adad-78056cde7c78";break;case N.a:case b.r:if(s)return"d7958adf-f419-46fa-941b-1b946497ef95"}},D=async(e,n,a,t,i,o,r,l,d)=>{const s=e;if(s){const e=await(0,m.tN)(i,l,d,s,o,"check-status-and-give-pdf-app-for-user",{shouldFetchPersonalApps:!0,enableInstalledAppQueryOptimization:r});if(a){if(!(e&&e.length>0))return;{const n=e[0].installerIdentity?.azureAdAppId,a=n&&t?.includes(n);if(l.logNoPii?.(`getDocumentViewAppId: AAA Pre-install check enabled: Is App Installed by AAA:  ${a} and installedByAppId: ${n}}`),a)return s}}return n?e&&e.length>0?(l.logNoPii?.(`getDocumentViewAppId: Pre-install check enabled: app pre-install state ${e[0].installationState}`),"AdminPreInstalled"===e[0].installationState?s:void 0):void 0:s}},M=e=>!!e.installationState&&["Installed","InstalledAndFavorited","InstalledAndPermanent","AdminPreInstalled"].includes(e.installationState),_=async(e,n,a)=>{try{if(e.threadId){const{data:t,error:i}=await n.query({query:w.q,fetchPolicy:"cache-first",variables:{conversationId:e.threadId}});return i?void a.errorToTelemetry?.(`getChannelFields threw error ${i.message}`,"files_viewer_resolver"):t}return}catch(e){return void(e?.message?.includes("Id is not of a channel")?a.logNoPii?.(`Not called from channel ${e.message}`):a.errorToTelemetry?.(`Exception while fetching channel info ${e?.message}`,"files_viewer_resolver"))}},B=(e,n,a)=>n&&!a?{...e,shouldOpenInMultiWindow:!0}:e},639188:(e,n,a)=>{a.d(n,{S1:()=>o,Dy:()=>r,a:()=>l});var t=a(513432),i=a(729788);const o=()=>t.useContext(i.FocusManagementContext);function r(e,n){const a=t.useContext(i.FocusManagementContext),o=t.useRef(null),r=t.useCallback((t=>{!t&&o.current&&a.setObservedName(o.current,null),t&&a.setObservedName(t,e,n),r.current=o.current=t}),[a,o,e,n]);return r.current=o.current,r}function l(e,n){const a=t.useContext(i.FocusManagementContext);t.useEffect((()=>{const t=()=>{a.requestFocus(e)};return a.addFocusLostEventListener(n,t),()=>{a.removeFocusLostEventListener(n,t)}}),[n,e,a])}},325749:(e,n,a)=>{a.d(n,{bq:()=>m,iE:()=>S,$o:()=>u,pE:()=>k,lT:()=>T,Gi:()=>v,mg:()=>f,d1:()=>g,A_:()=>h});var t=a(754255),i=a(572909),o=a(726723),r=a(625631),l=a(562292),d=a(501790),s=a(702183),c=a(363678);const p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsStageViewUtilsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callByThreadId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var m;!function(e){e.modal="modal",e.popout="popout",e.popoutWithChat="popoutWithChat"}(m||(m={}));const u=(e,n)=>n?`${e};replyChainId=${n}`:e,h=(e,n,a,i)=>{const{licenseType:o}=e.get(t.w.UserResources),{enableStageviewMW:l,enableStageviewMWInChannels:d,enableCollabStageForEDU:s}=e.get(t.w.Extensibility),p=n===c.hQ.desktop;return!(!s&&(0,r.Cd)(o)||!p)&&(l&&!d?"chats"===a.type&&!i:!!d&&("chats"===a.type||"channels"===a.type))},g=(e,n)=>{const a=I(n),t=e.newScenario(a),i=e.newScenario(s.Cu.PlatformTabLaunch);return t.clientId=t.id,i.clientId=i.id,e.hoistScenarioToCore?.(t),e.hoistScenarioToCore?.(i),{phase1CollabStageScenario:t,endToEndScenario:i}},I=e=>{switch(e){case c.hB.adaptiveCardStageModal:return s.Cu.PlatformTabStageModalLaunch;case c.hB.adaptiveCardCollabStage:return s.Cu.PlatformTabCollabStageLaunch;case c.hB.deepLinkStageView:case c.hB.stageViewOpenSDKApi:default:return s.Cu.PlatformTabStageViewFrameLoading}},v=(e,n)=>`${e.appId}-${e.convId}-${n}-${e.reloadToggle}`;function k(e,n,a){const t={};try{if(e.linkedEntity?.type===i.ck.calls){const{convId:a,messageId:o}=(0,d.q0)(e,i.ck.extensions,i.SY.view,n);o&&"0"!==o?(t.channelId=a,t.parentMessageId=o,t.channelMeetingMessageId=o,t.chatId=a):t.chatId=a}else if(e.linkedEntity?.type===i.ck.channels){const{channelId:a}=e.linkedEntity?.id&&JSON.parse(e.linkedEntity?.id);t.channelId=a;const{messageId:o,replyChainId:r}=(0,d.q0)(e,i.ck.extensions,i.SY.view,n);t.replyChainId=r,t.parentMessageId=o,t.channelMeetingMessageId=o}else switch(e.type){case i.ck.channels:const{channelId:o}=e.id&&JSON.parse(e.id);t.channelId=o;break;case i.ck.chats:const r=(e.id??"").split(";replyChainId=");r.length>1&&(t.replyChainId=r[1],t.channelId=r[0]),t.chatId=r[0];break;case i.ck.extensions:const d=(0,l.Wo)(e,a,n);t.parentMessageId=d?.messageId,t.channelMeetingMessageId=d?.messageId,t.chatId=d?.messageId?void 0:d?.threadId,t.channelId=d?.messageId?d?.threadId:void 0}}catch(e){n.log("Error while parsing source view entity.",e?.message)}return t}const S=async(e,n,a)=>{try{const{convId:t}=e;a?.appendEventData({"StageView.OpenMode":"popoutWithChat"});const{data:o}=await n.query({query:p,fetchPolicy:"no-cache",variables:{conversationId:t}}),r=v(e,e.contentUrl);a?.mark(s.BQ.StageViewGetCallByThreadIdSuccessful);return{stageViewId:r,linkedEntity:o?.callByThreadId?{id:`${t}-stageview`,type:i.ck.platformstageinactivemeeting}:{id:u(t,e.replyChainId),type:i.ck.chats}}}catch(e){return a?.mark(s.BQ.StageViewFailedBeforeCommandTrigger),{}}},f=(e,n)=>{const{sdkHostType:a}=e.get(t.w.Sdk),i="Desktop"===a,{enableProgrammaticPopoutStageViewOpenAPI:o,enableProgrammaticPopoutStageDeeplink:r}=e.get(t.w.Extensibility);return n.entryPoint===c.hB.adaptiveCardCollabStage?m.popoutWithChat:n.entryPoint===c.hB.deepLinkStageView?y(n,i,!!r):y(n,i,!!o)},y=(e,n,a)=>{if(!n||!a)return m.modal;const t=e.openMode||m.popoutWithChat;return t===m.popoutWithChat?e.convId||e.channelId?e.channelId&&!e.replyChainId?m.popout:m.popoutWithChat:m.popout:t},T=(e,n)=>{switch(n){case c.hB.adaptiveCardCollabStage:return{actionOutcome:C(e),panelType:o.HP.AdaptiveCardTab};case c.hB.stageViewOpenSDKApi:return{actionOutcome:C(e),panelType:o.HP.StageViewOpenSDKAPI};case c.hB.adaptiveCardStageModal:return{actionOutcome:C(e),panelType:o.HP.CollabStageViewModal};case c.hB.deepLinkStageView:return{actionOutcome:C(e),panelType:o.HP.DeeplinkStageView};default:return{actionOutcome:C(e),panelType:o.HP.AdaptiveCardTab}}},C=e=>{switch(e){case m.modal:return o.nd.modal;case m.popout:return o.nd.popout;default:return o.nd.popoutWithChat}}},932873:(e,n,a)=>{var t,i,o;a.d(n,{pG:()=>t,Ly:()=>i,Mv:()=>o}),function(e){e.ComposeMessage="composeMessage",e.PostCompose="postCompose",e.MessageList="messageList",e.Powerbar="powerbar",e.VirtualTreeList="virtualTreeList",e.FeedsFilter="feedsFilter",e.PeoplePicker="peoplePicker",e.SearchBox="searchBox",e.Floodgate="floodgate",e.ChatListSearchFilter="chatListSearchFilter",e.ChannelListSearchFilter="channelListSearchFilter",e.CallingPerf="callingPerf",e.TeamsAndChannelsTable="teamsAndChannelsTable",e.DiscoverSurfaceFeedList="discoverSurfaceFeedList",e.AllChannelSystemMessages="channelInfoPaneAllSystemMessages",e.AllPinnedPosts="channelInfoPaneAllPinnedPosts",e.UnifiedFunPicker="unifiedFunPicker",e.CreateTeamGallery="createTeamGallery",e.AddMember="addMember",e.MeetForWorkList="meetForWorkList",e.MeetForWorkSearchFilter="meetForWorkSearchFilter",e.PeopleAppContactList="peopleAppContactList",e.SimpleCollabLeftRail="simpleCollabLeftRail",e.UserOnboardingToTeam="UserOnboardingToTeam",e.TrinityChannelsTab="TrinityChannelsTab",e.SliceViewMessgeList="SliceViewMessgeList",e.ThreadList="ThreadList"}(t||(t={})),function(e){e.CallingScreen="callingScreen",e.Chat="chat",e.ChannelL1="channelL1",e.ChannelL2="channelL2",e.ChannelSettings="channelSettings",e.ChatList="chatList",e.Communities="communitites",e.ConvUxChannelL1="convUxChannelL1",e.ConvUxChannelL2="convUxChannelL2",e.ConvUxChannelL1RightPane="convUxChannelL1RightPane",e.ConvUxChannelL2RightPane="convUxChannelL2RightPane",e.ThreadedChatL1="threadedChatL1",e.ThreadedChatL2="threadedChatlL2",e.ThreadedChatL1RightPane="threadedChatL1RightPane",e.ThreadedChatL2RightPane="threadedChatL2RightPane",e.DialPad="dialpad",e.FeedList="feedlist",e.FlyoutChatList="flyoutChatList",e.FlyoutPeopleL2="flyoutPeopleL2",e.GroupChat="groupChat",e.MeetingChat="meetingChat",e.MessageEscalation="messageEscalation",e.NewChat="newChat",e.PeopleSearch="peopleSearch",e.Floodgate="floodgate",e.ChannelList="ChannelList",e.ManageThreadMembers="manageThreadMembers",e.ManageChannelThreadMembers="manageChannelThreadMembers",e.ManagePrivateChannelThreadMembers="managePrivateChannelThreadMembers",e.ManageSharedChannelThreadMembers="manageSharedChannelThreadMembers",e.ManageTeams="manageTeams",e.ChannelInvitationsTab="channelInvitationsTab",e.DiscoverSurface="discoverSurface",e.ThreadMembersSearch="threadMembersSearch",e.SharedChannelPendingInvites="sharedChannelPendingInvites",e.PendingJoinRequests="pendingJoinRequests",e.SelectPeoplePickerExtensibility="selectPeoplePickerExtensibility",e.ChannelsTable="channelsTable",e.SpeedDial="SpeedDial",e.CommunitiesJoinRequests="communitiesJoinRequests",e.PeopleApp="peopleApp",e.CommentStreamChatPane="commentStreamChatPane",e.FollowPresenceSettings="followPresenceSettings",e.MentionSliceList="MentionSliceList",e.MiddleChatPane="middleChatPane",e.SideChatPane="sideChatPane"}(i||(i={})),function(e){e.HeartbeatMonitor="HeartbeatMonitor",e.CallingPerfMonitor="CallingPerfMonitor"}(o||(o={}))},501790:(e,n,a)=>{a.d(n,{Xp:()=>i,AX:()=>o,q0:()=>r,WD:()=>l});var t=a(572909);function i(e,n){return{entity:{type:t.ck.chats,action:t.SY.create,id:o(e)},command:n}}function o(e){return JSON.stringify(e&&e.length>0?e.sort():[])}function r(e,n,a,t){let i={};if(!e)return i;if(e.type===n&&e.action===a){const n=e.options;if(n&&"string"==typeof n)try{i=JSON.parse(n)}catch{t.warn(`Entity options are in unexpected format. Expected a valid stringified JSON object but instead received: ${String(n)}.`)}}else t.warn(`Entity options are (incorrectly) being asked for type and action that do not pertain to the entity. ${String(e.type)} != ${String(n)} or ${String(e.action)} != ${String(a)}`);return i}const l=e=>`${e.substring(0,32)}00000000${e.substring(40)}`},249649:(e,n,a)=>{a.d(n,{r:()=>t});const t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageToParentResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageToParentResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}},606855:(e,n,a)=>{a.d(n,{m:()=>t});const t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"taskModuleResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"taskModuleResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"card"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"adaptiveCardTabResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"taskModuleId"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"reason"}},{kind:"Field",name:{kind:"Name",value:"entryPoint"}}]}}]}}]}},264642:(e,n,a)=>{a.d(n,{vt:()=>u,Ru:()=>h,BY:()=>g,JU:()=>v,wX:()=>k,TD:()=>c,$E:()=>y,j8:()=>T,kR:()=>f,HR:()=>S,Qi:()=>s,wM:()=>m});var t=a(850434),i=a(199448),o=a(364819);const r={publicCommercialCloud:"teams.microsoft.com",gccHighCloud:"gov.teams.microsoft.us",dodCloud:"dod.teams.microsoft.us",dev:"local.teams.office.com",devLive:"local.teams.live.com",liveCloud:"teams.live.com",ag08Cloud:"teams.eaglex.ic.gov",ag09Cloud:"teams.microsoft.scloud",gallatinCloud:"teams.microsoftonline.cn"},l={consumerTenantId:"9188040d-6c67-4c5b-b112-36a304b66dad"},d="ParsingMeetingUrl",s=e=>{const n=decodeURIComponent(e),a=new RegExp("context=(.*)$","g").exec(n);if(!a||a.length<2)throw p(`Meeting context is not in valid format ${n}`);const t=JSON.parse(a[1]);if(!t||!t.Tid||!t.Oid)throw p("Meeting url is malformed Tid or Oid is missing");return{tenantId:t.Tid,organizerId:t.Oid}},c=e=>e.context===d&&e.code===t.O4.ErrorParsingQueryParams,p=e=>(0,i.$5)(d,t.O4.ErrorParsingQueryParams,"",void 0,e),m=(e,n)=>{const a="meet",o="meetup-join",l=new URL(e);let s;if(l.pathname.includes(a)||l.pathname.includes(o))s=l;else{if(!l.hash||!l.hash.includes(a)&&!l.hash.includes(o))throw p("Invalid URL - unsupported URL format");s=new URL(l.hash.substring(1),l.origin)}const c=n?Object.values(r).find((e=>e===s.hostname)):s.hostname;if(!c)throw(0,i.$5)(d,t.O4.InvalidCloudDomain,"",void 0,"Invalid cloud domain.");const m=s.searchParams,u=s.pathname.split("/"),h={isLegacyUrl:!1,meetingCloud:c,meetingUrl:e};if(u[2]===o){const e=m.get("context");if(5!==u.length||!e)throw p("Invalid URL - context param is missing");h.threadId=decodeURIComponent(u[3]),h.messageId=decodeURIComponent(u[4]);try{const n=JSON.parse(decodeURIComponent(e));if(!n.Tid||!n.Oid)throw p("Invalid URL - context param is invalid. Tid or Oid missing.");h.tenantId=n.Tid,h.organizerId=n.Oid,h.isBroadcastMeeting=n.IsBroadcastMeeting||void 0,h.attendeeRole=n.role||void 0,h.replyChainMessageId=n.MessageId||void 0,h.isLegacyUrl=!0}catch(n){const a=/\{\"Tid\":\"([\w\-]{36})\",\"Oid\":\"([\w\-]{36})\",\"IsBr/,t=3,i=decodeURIComponent(e).match(a);if(i?.length!==t)throw n;{const e=1,n=2;h.tenantId=i[e],h.organizerId=i[n],h.isBroadcastMeeting=!0,h.attendeeRole=void 0,h.replyChainMessageId=void 0,h.isLegacyUrl=!0}}}else{if(u[1]!==a)throw p("Invalid URL - unsupported URL format");h.meetingId=u[2],h.passCode=m.get("p")||void 0}return h},u=(e,n,a,t,i,r)=>{const l=m(e,r),d=(0,o.isEmpty)(t)?"calendar_join_meeting_utils":t;let s;return l.isLegacyUrl?(n.mark("cal_join_executing_legacy_url_flow"),s={type:"Meeting",joinOptions:{meeting:{showPrejoin:!0,isPSTN:!1,title:a},context:d},coordinates:{legacyMeeting:{meetingCloud:l.meetingCloud,conversationId:l.threadId||"",rootMessageId:l.messageId||"",messageId:l.replyChainMessageId||l.messageId||"",isChannel:"0"!==l.messageId,isAdhoc:!1,tenantId:l.tenantId||"",organizerId:l.organizerId||"",broadcast:l.isBroadcastMeeting?{role:i??"None"}:null}}}):(n.mark("cal_join_executing_non_legacy_url_flow"),s={type:"Meeting",joinOptions:{meeting:{showPrejoin:!0,isPSTN:!1,title:a},context:d},coordinates:{meetingData:{meetingUrl:e}}}),s},h=(e,n,a)=>{try{const t=new URL(e).hostname;return n===l.consumerTenantId||t!==r.liveCloud&&t!==r.devLive||a?.errorToTelemetry?.(`Expect TFW got TFL: ${e}`,"cmd_meeting_join_missing_data",void 0,!1),t}catch(t){const i=e.split("/")?.[2]?.split("@")?.pop()?.split(":").shift()||"";return n===l.consumerTenantId||i!==r.liveCloud&&i!==r.devLive||a?.errorToTelemetry?.(`Expect TFW got TFL parsing ${e}`,"cmd_meeting_join_missing_data",void 0,!1),i}},g=(e,n=!1)=>{let a=!1;if(e&&e.skypeTeamsDataObj){a=1===e.skypeTeamsDataObj.type||I(e,!!n)}return a},I=(e,n)=>{if(!e?.skypeTeamsMeetingUrl||!n)return!1;const a=new URL(e.skypeTeamsMeetingUrl),t=new URLSearchParams(a.search).get("context");if(!t)return!1;try{const{IsBroadcastMeeting:e}=JSON.parse(t);return!!e}catch(e){return t.includes("IsBroadcastMeeting")}};function v(e){return!(!e||!e.skypeTeamsDataObj||(0,o.isEmpty)(e.skypeTeamsDataObj))&&!1===e.skypeTeamsDataObj.private}function k(e){return"Group"===e?.mailboxType}const S=e=>!!e.webinarRegistration?.webinarId,f=e=>!!e.virtualEventsData?.eventId,y=e=>{try{return"meet"===new URL(e).pathname.split("/")[1]}catch(e){return!1}},T=(e,n,a,t)=>e&&n&&(a||!1!==t)},839623:(e,n,a)=>{a.d(n,{bf:()=>t,MG:()=>i,D6:()=>o,dN:()=>s,qL:()=>c,y:()=>p,ti:()=>m});var t,i,o,r,l,d=a(850434);!function(e){e.logErrorMessage="errorMessage",e.internalErrorCode="errorCode",e.correlationId="correlationId",e.httpStatusCode="httpStatusCode",e.isRecoverable="isRecoverable",e.reportingService="reportingService",e.subError="subError",e.serviceErrorMessage="serviceErrorMessage",e.cmdRequestId="requestId"}(t||(t={})),function(e){e.UNKNOWN_ERROR="UnknownError",e.FORBIDDEN="Forbidden",e.NOT_FOUND="NotFound",e.CONFLICT="Conflict",e.UNAUTHORIZED="Unauthorized",e.BAD_REQUEST="BadRequest",e.INTERNAL_SERVER_ERROR="InternalServerError",e.SERVICE_UNAVAILABLE="ServiceUnavailable",e.REQUEST_THROTTLED="RequestThrottled",e.FAILED_TO_CALL_SCHEDULING_SERVICE="FailedToCallSchedulingService",e.GATEWAY_TIMEOUT="GatewayTimeout",e[e.DEFAULT_ERROR=1e3]="DEFAULT_ERROR",e[e.BEGIN_CLIENT_ERROR_CODES=1001]="BEGIN_CLIENT_ERROR_CODES",e[e.INVALID_RESPONSE=1002]="INVALID_RESPONSE",e[e.CHANGE_KEY_NOT_FOUND=1003]="CHANGE_KEY_NOT_FOUND",e[e.EMPTY_INPUT=1004]="EMPTY_INPUT",e[e.INVALID_SECRET=1005]="INVALID_SECRET",e[e.RENEW_TOKEN_FAILED=1006]="RENEW_TOKEN_FAILED",e[e.INTERNAL_CLIENT_ERROR=1007]="INTERNAL_CLIENT_ERROR"}(i||(i={})),function(e){e.DEFAULT_BAD_REQUEST="Request is not correct, please ensure you are passing the values for each parameter.",e.DEFAULT_ERROR="Unknown error occurred",e.COLLAB_OBJECT_NOT_FOUND="Collab object could not be found for the provided external entity key",e.RESOURCE_CONFLICT="Resource conflicts with another; location URLs must be unique",e.EMPTY_INPUT="Input is empty",e.INVALID_SECRET="Invalid Secret while trying to commit resource",e.FORBIDDEN="User does not have permissions to access the requested resource",e.INVALID_RESPONSE="Response from CMD Artifact service is not valid.",e.INTERNAL_CLIENT_ERROR="An internal error was registered on the client.",e.CHANGE_KEY_NOT_FOUND="No change key in collab object returned.",e.UNAUTHORIZED="User does not have permissions to perform the requested action",e.INTERNAL_SERVER_ERROR="An error occurred with Artifacts service",e.SERVICE_UNAVAILABLE="Service is not currently available.",e.REQUEST_THROTTLED="Requests to the artifacts service are being throttled.",e.FAILED_TO_CALL_SCHEDULING_SERVICE="Artifact service was not able to call scheduling service",e.GATEWAY_TIMEOUT="A downstream service is timing out."}(o||(o={})),function(e){e.RESOURCE_CONFLICT="Conflict - Reason: Conflict",e.BAD_REQUEST="Bad Request",e.NOT_FOUND="NotFound - Reason: Not Found",e.FORBIDDEN="Permission Issue"}(r||(r={})),function(e){e.POPUP_BLOCKED="Error opening popup",e.RENEW_TOKEN_FAILED="Token Renewal Failed"}(l||(l={}));const s="Unknown",c="None",p="None",m=(new Map([[l.POPUP_BLOCKED,d.O4.AuthPopupWindowBlocked],[l.RENEW_TOKEN_FAILED,i.RENEW_TOKEN_FAILED]]),new Map([[i.UNKNOWN_ERROR,o.DEFAULT_ERROR],[i.CONFLICT,o.RESOURCE_CONFLICT],[i.NOT_FOUND,o.COLLAB_OBJECT_NOT_FOUND],[i.BAD_REQUEST,o.DEFAULT_BAD_REQUEST],[i.FORBIDDEN,o.FORBIDDEN],[i.UNAUTHORIZED,o.UNAUTHORIZED],[i.INTERNAL_SERVER_ERROR,o.INTERNAL_SERVER_ERROR],[i.SERVICE_UNAVAILABLE,o.SERVICE_UNAVAILABLE],[i.REQUEST_THROTTLED,o.REQUEST_THROTTLED],[i.INVALID_RESPONSE,o.INVALID_RESPONSE],[i.CHANGE_KEY_NOT_FOUND,o.CHANGE_KEY_NOT_FOUND],[i.FAILED_TO_CALL_SCHEDULING_SERVICE,o.FAILED_TO_CALL_SCHEDULING_SERVICE],[i.GATEWAY_TIMEOUT,o.GATEWAY_TIMEOUT]]))},691650:(e,n,a)=>{a.d(n,{l:()=>t,W:()=>i});const t={Help:"5a0e35f9-d3c8-45b6-9dd9-983ab47f1b83"},i="teams-copy-link"},884542:(e,n,a)=>{a.d(n,{Yn:()=>i,jT:()=>o,dk:()=>r,aE:()=>l});var t=a(691650);function i(e,n,a){return`${e}/${n}/${a}`}function o(e,n,a){let t=`${e}/l`;return n&&""!==n&&(t=`${t}/${n}`),a&&""!==a&&(t=`${t}?${a}`),t}function r(e,n,a,i=!1){return`\n    <div itemprop="${t.W}"><a href="${n}" title="${n}">${e}</a></div>${a?`<div itemprop="${t.W}">${a}</div>`:""}${i?"<div>&nbsp;</div>":""}`}function l(e){const n=e.location.protocol;let a=e.location.host;return"local.teams.office.com"!==a&&"local.teams.office.com:8080"!==a||(a="teams.microsoft.com"),`${n}//${a}`}},251680:(e,n,a)=>{a.d(n,{W:()=>r});var t=a(49180);const i=new RegExp(t.vg.oneDriveFile),o=new RegExp(t.vg.sharePointFile),r=(e,n)=>{if(n){const a=n.replace(t.vg.leadingAndTrailingSlashesRegex,"").split("/");a.pop();const i=a.join("/");return`${new URL(e).origin}/${i}/`}if(o.test(e)){const n=e.match(o);return n?n[0]:null}if(i.test(e)){const n=e.match(i);return n?n[0]:null}if(e){const n=e.split("/"),a=2;if(n.length>=a)return`${n[0]}//${n[a]}/`}return e}},228113:(e,n,a)=>{a.d(n,{m:()=>i});var t=a(49180);const i=e=>{switch(e){case t.jL.unauthorizedAccess:return!1;case t.jL.clientError:case t.jL.badRequest:case t.jL.internalServerError:case t.jL.serviceUnavailable:case t.jL.tooManyRequests:return!0;default:return!1}}},284398:(e,n,a)=>{var t;a.d(n,{o:()=>t}),function(e){e[e.E164=0]="E164",e[e.INTERNATIONAL=1]="INTERNATIONAL",e[e.NATIONAL=2]="NATIONAL"}(t||(t={}))},203962:(e,n,a)=>{let t;a.d(n,{g:()=>o});const i=async()=>{if(!t){const e=await Promise.all([a.e(912845),a.e(953696),a.e(273198),a.e(320494),a.e(224316),a.e(416397),a.e(120951),a.e(984552),a.e(169767),a.e(620314),a.e(914945),a.e(461500),a.e(668172),a.e(490329),a.e(311914),a.e(181316),a.e(428348),a.e(669152),a.e(842242),a.e(459959),a.e(255544),a.e(306517),a.e(215111),a.e(636192),a.e(845039),a.e(499319),a.e(122814),a.e(102216),a.e(286993),a.e(967653),a.e(36690),a.e(79899),a.e(724003),a.e(187257),a.e(785043),a.e(572891),a.e(809110),a.e(600824),a.e(168524),a.e(531240),a.e(843675),a.e(843087),a.e(24444),a.e(16945),a.e(613978),a.e(991504),a.e(307422),a.e(787318),a.e(656899),a.e(35991),a.e(965787),a.e(972751),a.e(921389),a.e(638918),a.e(467129),a.e(202564),a.e(977204),a.e(905965),a.e(569158),a.e(685119),a.e(420340),a.e(816410),a.e(747607),a.e(196395),a.e(47330),a.e(725236),a.e(422790),a.e(293970),a.e(71257),a.e(524014),a.e(625303),a.e(383414),a.e(53966),a.e(265816),a.e(327091),a.e(552331),a.e(697073),a.e(331703),a.e(104538),a.e(834558),a.e(668415),a.e(77029),a.e(428410),a.e(311576),a.e(397928),a.e(288919),a.e(615002),a.e(354884),a.e(688782),a.e(892960),a.e(708241),a.e(391700),a.e(240991),a.e(640233),a.e(677226),a.e(620368),a.e(428906),a.e(418497),a.e(86631),a.e(875452),a.e(574961),a.e(155688),a.e(374752),a.e(526689),a.e(960889),a.e(449475),a.e(646235),a.e(720453),a.e(903266)]).then(a.bind(a,412301));t=new e.PhoneNumberService}return t};class o{constructor(e,n,a){this.phoneNumberService=e,this.value=n,this.isNormalized=a}static async tryParse(e,n){const a=await i(),{regionCode:t,normalizer:r,convertAlphaCharactersToNumber:l,isMri:d}=n||{},s=o.getUserLocale(t,r?.getITUCountryPrefix(),a),{phoneNumber:c,extension:p}=o.separateExtension(a,e);let m=c;!0===l&&(m=a.convertAlphaCharactersInNumber(m));const u=r?.normalize(m),h=u?.isNormalized,g=u?.phoneNumber||m;try{let e;return e=d?a.parse(`${g}${p}`,s):a.parseAndKeepRawInput(`${g}${p}`,s),new o(a,e,h)}catch(e){return}}static async isPossibleNumber(e,n){try{const a=await i(),t=a.parse(e,o.getUserLocale(void 0,n.getITUCountryPrefix(),a));return a.isPossibleNumber(t)}catch(e){return!1}}static async isStandardFormatNormalized(e,n,a,t){if(!e)return!1;try{const r=await i(),l=n.normalize(e),d=r.parse(l.phoneNumber,o.getUserLocale(a,n.getITUCountryPrefix(),r));return r.isPossibleNumber(d)&&(t||r.isValidNumber(d))}catch(e){return!1}}static async getValidNumber(e,n,a){return o.isStandardFormatNormalized(e,n,a).then((a=>a?e:e.startsWith("+")?"":o.isStandardFormatNormalized("+".concat(e),n).then((n=>n?`+${e}`:""))))}static isValidNumberForAnyRegion(e,n){if(!e)return!1;try{const a=o.getPhoneNumberService(e).getRegionCode(o.getPhoneNumberValue(e));return!!a&&-1!==n.indexOf(a)}catch(e){return!1}}static getPhoneNumberService(e){return e.phoneNumberService}static getPhoneNumberValue(e){return e.value}static getIsNormalized(e){return e.isNormalized}static getUserLocale(e,n,a){if(e)return e;if(!n)return;let t;return n&&(t=a.getRegionCodeForCountryCode(Number(n))),t||(t="us"),t.toLowerCase()}static separateExtension(e,n){const a=n.search(e.getExtensionRegx()),t=a>-1;return{phoneNumber:t?n.substring(0,a):n,extension:t?n.substring(a):""}}}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/760418-39dc9cedb48b85fe.js.map